From abhishek.kona at gmail.com  Tue Mar  1 03:43:45 2011
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Tue, 01 Mar 2011 09:13:45 +0530
Subject: [rabbitmq-discuss] Thrift vs. Protocol Buffers as serialization
 formats
In-Reply-To: <AANLkTimo31+AASUB+=QuHLxzN5-GhbS4J2zKNLJYNHbJ@mail.gmail.com>
References: <6a761861-8f53-4903-87ef-0452cec8c9aa@k16g2000vbq.googlegroups.com>
	<AANLkTimo31+AASUB+=QuHLxzN5-GhbS4J2zKNLJYNHbJ@mail.gmail.com>
Message-ID: <4D6C6B71.5040701@gmail.com>

Hi

We use Thrift as a thin layer infront of RabbitMQ to provide Amazon SQS 
(acknowledge without keeping a channel open).  like semantics for our 
queue system.
It has been working like a charm for us.
We primarily use in Java and PHP.
Serialization has never been observed as a major bottleneck in our 
application.
So any of PB or Thrift should be good for you. (We use Thrift for its 
good RPC capabilities).

The people at https://github.com/eishay/jvm-serializers/wiki/ have 
profiled lot of available data serialization methods, you can have a look.

-Abhishek Kona



On 28/02/11 10:34 PM, Marek Majkowski wrote:
> On Mon, Feb 28, 2011 at 15:13, SimonT<simonthorogood at hotmail.com>  wrote:
>> Anyone care to share their experiences with using either of these
>> (specificially, as the 'on-the-wire' format for RabbitMQ messages)? In
>> particular, would be interested to know about:
>>
>> - Ease of managing the (re)generation of message formats for use
>> across multiple platforms (in our case, C# and Python)
>> - Serialisation/Deserialisation performance
>> - Serialized message size
> In my projects the performance of (de)serialization doesn't matter
> that much. But flexibility and simplicity matters a lot.
>
> I tend to use JSON and I'm happy with it. Language support is
> brilliand, it's simple and fast enough.
>
> Cheers,
>    Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Tue Mar  1 07:22:19 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 01 Mar 2011 07:22:19 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <91131298924006@web116.yandex.ru>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru>
Message-ID: <4D6C9EAB.6070708@rabbitmq.com>

DOBRO Sergei wrote:
>> In the list_* output you sent, which consumers/queues are in the 
>> "broken" state where their connected clients aren't receiving
>> messages?
>> 
> All the consumers, queues, bindings and connections are present.

Understood, but my question was *which specific* worker(s) (and their
associated consumers/queues) had stopped working at the time you ran
these commands?

> I just can say that when the workers stop receiving messages I
> restart them and everything goes fine. Mysticism :)

If restarting them works fine then the problem is most certainly client 
side.

As I said, you may want to tap the network to check whether messages do 
indeed still get sent to the broken workers.

Regards,

Matthias.

From rommel.carino.garcia at gmail.com  Tue Mar  1 03:55:14 2011
From: rommel.carino.garcia at gmail.com (Rom)
Date: Mon, 28 Feb 2011 19:55:14 -0800 (PST)
Subject: [rabbitmq-discuss] Maximum Frame Setting Not Working
Message-ID: <0c38630e-f53b-44fb-842f-6c0cc66ed545@k38g2000vbn.googlegroups.com>

I have successfully run a very simple message publisher with my
ConnectionFactory setting below.

                ConnectionFactory factory = new ConnectionFactory();
		factory.setUsername("rabbitmq");
		factory.setPassword("rabbitmq");
		factory.setVirtualHost("/4couchdb");
		factory.setHost("rcgarcia74");
		factory.setPort(ConnectionFactory.DEFAULT_AMQP_PORT);
		factory.setRequestedChannelMax(100);
		factory.setRequestedHeartbeat(300);

But when I start adding in the Maximum Frame size below, any number
that I put in doesn't work. Is there a variable that I need to set at
rabbitmq.conf? If it's in the conf file what's the key/vakue pair?

                factory.setRequestedFrameMax(1);

Here's the exception I'm getting.

java.io.IOException
	at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)
	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:
145)
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:
311)
	at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:
379)
	at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:
399)
	at
com.gravady.rnd.rabbitmq.MessagePublisherNoSSL.main(MessagePublisherNoSSL.java:
26)
Caused by: com.rabbitmq.client.ShutdownSignalException: connection
error; reason: java.io.EOFException
	at
com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:
81)
	at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:
47)
	at com.rabbitmq.client.impl.AMQChannel
$BlockingRpcContinuation.getReply(AMQChannel.java:342)
	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:215)
	at com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:
139)
	... 4 more
Caused by: java.io.EOFException
	at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:273)
	at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:118)
	at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:
155)
	at
com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:
393)
	at com.rabbitmq.client.impl.AMQConnection
$MainLoop.run(AMQConnection.java:421)
Exception in thread "main" java.lang.NullPointerException
	at
com.gravady.rnd.rabbitmq.MessagePublisherNoSSL.main(MessagePublisherNoSSL.java:
46)

From stammailbox at gmail.com  Tue Mar  1 09:14:14 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Tue, 1 Mar 2011 11:14:14 +0200
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <4D6BC078.8030600@rabbitmq.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
	<4D6BC078.8030600@rabbitmq.com>
Message-ID: <AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>

Hi,
Thanks for your response.

I followed your advice and here are my results.
 I see myself in the connection list when I invoke a connection from a
computer that gets the exception. I see it with "starting"  status and
instantly it disappears. (I use new exchange name and no exchange is
created)

I tried to follow your advice about the tracer but i didn't find enough info
about the file runjava.bat in 2.3.1 (it exists only in the 1.7.0 package.
not the 2.3.1.)

it happens from almost half of the servers. not only the ones with the NAT.
thanks.

On Mon, Feb 28, 2011 at 5:34 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> There is no reason why an AMQP connection won't work over NAT. This is
> equally for version 1.7.0 and 2.3.1. It is likely that the cause for this
> error is at the network layer.
>
> Does the broker logfile contain any other relevant messages other than the
> one about the abrupt disconnection?
>
> Can you get "rabbitmqctl list_connections" on the broker to list the
> connection from the client at any time?
> Are you able to establish an AMQP channel and issue the basicConsume(), or
> does the error occur earlier during connection establishment?
>
> Do you have any way of checking the state of the connection on the NAT
> device?
>
> Establishing the AMQP connection via the AMQP Tracer (
> http://www.rabbitmq.com/javadoc/com/rabbitmq/tools/Tracer.html ) might
> also provide useful diagnostic information.
>
>
>
> -Emile
>
>
>
>
>
> On 27/02/11 13:06, mysurf mail wrote:
>
>> Hi ,
>> I am writing a new mail because my last issue was solved .
>> It is just that on a certain computer my application stopped working.
>> So it is a new issue and I will explain and paste the exception below.
>>
>> Basically, I did three things :
>> 1. I upgraded from 1.7.0 to 2.3.1 (installed a new erlang also)
>> 2. I upgraded the client jars
>> 3. changed the protocol to ack = true;
>>
>> channel.basicConsume(queueName, true, queueingConsumer);
>>
>> well, that certain computer is behind a firewall, and has a NAT (Network
>> Address Translation ).
>> It did work prior to the upgrade with the NAT (mySQL also handles it
>> pretty well).
>> with the same ports.
>> Maybe it is the bidirectional channel (since I added acking? I dont
>> think so...).
>>
>> what I can see is that.
>> when the client tries to connect it writes in the logs
>>
>> Connection closed abruptly
>>
>> And now, behold, the exception :
>>
>
> [...]
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110301/304bf057/attachment-0001.htm>

From stammailbox at gmail.com  Tue Mar  1 09:15:17 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Tue, 1 Mar 2011 11:15:17 +0200
Subject: [rabbitmq-discuss] Cannot connect to rabbitmq from all computers -
	including wireshark logs.
Message-ID: <AANLkTim0zgrzrn0DV0oQWWy4r=iAHDYzF2wF8-_=0Tnd@mail.gmail.com>

I can't connect from all the computers in my production environment.
Some computers connect, and some do not.
(In a previous version of rabbit (1.7.0.), they all connected.)

on the non-connecting computers when I call factory.newConnection I wait for
a few seconds and then receive the following exception

Caused by: com.rabbitmq.client.PossibleAuthenticationFailureException:
Possibly caused by authentication failure
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:289)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:383)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:403)
	at com.programa17.mmm.modules.stopwatch.util.BasicChannel.<init>(BasicChannel.java:37)
	... 28 more
Caused by: com.rabbitmq.client.AlreadyClosedException: clean
connection shutdown; reason: Attempt to use closed channel
	at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:181)
	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:208)
	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:194)
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:281)
	... 31 more

in the wire shark a complete transaction look like this  (I  get the
purple only in the successful transaction )

AMQP............

.......copyrightS...$Copyright (C) 2007-2011 VMware,
Inc..informationS...5Licensed under the MPL.  See
http://www.rabbitmq.com/.platformS...

Erlang/OTP.productS....RabbitMQ.versionS....2.3.1....PLAIN AMQPLAIN....en_US.

........

.......productS....RabbitMQ.platformS....Java.informationS...4Licensed
under the MPL. See http://www.rabbitmq.com/.copyrightS...$Copyright
(C) 2007-2011 VMware,
Inc..versionS....2.3.1.PLAIN.....guest.guest.en_US.

...............................................(./............)....................................
.(...

toClientsEran.direct..............(...........2.

...toClientsEran.5......

........2...toClientsEran.5.........

......9.2.....toClientsEran.5

toClientsEran.toClientsEran.5......

........2...

........<.....toClientsEran.5.......

......&.<..!amq.ctag-AKZfeyr+9JOkczDfrq49pw==.

......M.<.<!amq.ctag-AKZfeyr+9JOkczDfrq49pw==.........

toClientsEran.toClientsEran.5.........<....................{"type":"com.programa17.mmm.modules.stopwatch.util.RabbitMQTest$Start","content":"{\"time\":3449321709892756,\"destinationId\":\"toClientsEran.5\"}"}.

........<.(...toManager.rtk..

........<.............

.......{"type":"com.programa17.mmm.modules.stopwatch.util.RabbitMQTest$Report","content":"{\"time\":999114088,\"destinationId\":\"toClientsEran.5\"}"}.

......

.<.P..........


Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110301/8e2ee13e/attachment.htm>

From emile at rabbitmq.com  Tue Mar  1 09:36:35 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 01 Mar 2011 09:36:35 +0000
Subject: [rabbitmq-discuss] Maximum Frame Setting Not Working
In-Reply-To: <0c38630e-f53b-44fb-842f-6c0cc66ed545@k38g2000vbn.googlegroups.com>
References: <0c38630e-f53b-44fb-842f-6c0cc66ed545@k38g2000vbn.googlegroups.com>
Message-ID: <4D6CBE23.8020902@rabbitmq.com>

Hi Rom,

On 01/03/11 03:55, Rom wrote:
> I have successfully run a very simple message publisher with my
> ConnectionFactory setting below.
>
> ConnectionFactory factory = new ConnectionFactory();
> factory.setUsername("rabbitmq"); factory.setPassword("rabbitmq");
> factory.setVirtualHost("/4couchdb"); factory.setHost("rcgarcia74");
> factory.setPort(ConnectionFactory.DEFAULT_AMQP_PORT);
> factory.setRequestedChannelMax(100);
> factory.setRequestedHeartbeat(300);
>
> But when I start adding in the Maximum Frame size below, any number
> that I put in doesn't work. Is there a variable that I need to set
> at rabbitmq.conf? If it's in the conf file what's the key/vakue
> pair?
>
> factory.setRequestedFrameMax(1);

AMQP specifies a minimum frame size of 4kb. You should see this in the 
broker logfile after that attempt:

   amqp_error,not_allowed,"frame_max=1 < 4096 min size"

The solution is to use values of 4096 or higher.

What are you trying to accomplish by changing the default frame size 
(128kb)?


Regards

Emile

From vertolet666 at yandex.ru  Tue Mar  1 09:59:10 2011
From: vertolet666 at yandex.ru (DOBRO Sergei)
Date: Tue, 01 Mar 2011 12:59:10 +0300
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D6C9EAB.6070708@rabbitmq.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
Message-ID: <295551298973551@web84.yandex.ru>

01.03.2011, 10:22, "Matthias Radestock" <matthias at rabbitmq.com>:
> DOBRO Sergei wrote:
>
>>> ?In the list_* output you sent, which consumers/queues are in the
>>> ?"broken" state where their connected clients aren't receiving
>>> ?messages?
>> ?All the consumers, queues, bindings and connections are present.
>
> Understood, but my question was *which specific* worker(s) (and their
> associated consumers/queues) had stopped working at the time you ran
> these commands?
>

O.k., let me explain what is exactly going on. 
As I said, each worker declares a queue with its own routing key and starts consuming from that queue. All their queues are bound to the same exchange of direct type.
worker1 -> queue1 -> ex.direct (routing_key1),
worker2 -> queue2 -> ex.direct (routing_key2),
......
worker6 -> queue6 -> ex.direct (routing_key6),

There are six workers. Other clients publish messages to exchange "ex.direct" with the routing key which is determined randomly from the values of array (routing_key1, routing_key2, ...., routing_key6).
So, the workers receive messages randomly too. That's why I can not tell you which worker(s) stops receiving messages.

Now let me tell you why I'm using this stupid method :). Why "stupid"? Because it's a random (not round-robin) dispatching.
But, in my case it is more stable way. Yes, I have already tried to run workers consuming messages from the same queue, but the issue occured more often. So, having round-robin pattern (one queue) all the workers stop receiving messages at once.

>
> If restarting them works fine then the problem is most certainly client
> side.
>
> As I said, you may want to tap the network to check whether messages do
> indeed still get sent to the broken workers.
>
RabbitMQ and the workers are running on the same machine. Each connection's IP is 127.0.0.1. Can you give me some advice? Which software to use to access the data flowing across the connection RabbitMQ<->worker?

Thanks.


From matthias at rabbitmq.com  Tue Mar  1 10:07:45 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 01 Mar 2011 10:07:45 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <295551298973551@web84.yandex.ru>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru>
Message-ID: <4D6CC571.8020108@rabbitmq.com>

DOBRO Sergei wrote:
> There are six workers. Other clients publish messages to exchange
> "ex.direct" with the routing key which is determined randomly from
> the values of array (routing_key1, routing_key2, ...., routing_key6).
>  So, the workers receive messages randomly too. That's why I can not
> tell you which worker(s) stops receiving messages.

So how do you know that messages are getting lost?

> RabbitMQ and the workers are running on the same machine. Each
> connection's IP is 127.0.0.1. Can you give me some advice? Which
> software to use to access the data flowing across the connection
> RabbitMQ<->worker?

Try wireshark. Or insert our tracer 
http://www.rabbitmq.com/examples.html#tracer.

Matthias.

From emile at rabbitmq.com  Tue Mar  1 10:09:25 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 01 Mar 2011 10:09:25 +0000
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>	<4D6BC078.8030600@rabbitmq.com>
	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>
Message-ID: <4D6CC5D5.7090208@rabbitmq.com>

Hi,

On 01/03/11 09:14, mysurf mail wrote:
> Hi,
> Thanks for your response.
>
> I followed your advice and here are my results.
>   I see myself in the connection list when I invoke a connection from a
> computer that gets the exception. I see it with "starting"  status and
> instantly it disappears. (I use new exchange name and no exchange is
> created)
>
> I tried to follow your advice about the tracer but i didn't find enough
> info about the file runjava.bat in 2.3.1 (it exists only in the 1.7.0
> package. not the 2.3.1.)
>
> it happens from almost half of the servers. not only the ones with the NAT.
> thanks.

Unfortunately this is not enough information to make any further guesses 
about the cause of the problem. Can you please supply a complete 
(compressed if necessary) broker logfile from one of the brokers where 
this problem occurs.

I've confirmed that runjava.bat exists in the java client and the 
complete windows bundle downloads. You can get the latest version here: 
http://www.rabbitmq.com/java-client.html . It will be helpful if you can 
connect via the tracer and send the output.

Are the failing servers all running the same version of RabbitMQ? Is it 
possible that they have some feature or configuration in common that may 
be the cause of the problem?


Emile


From simon at rabbitmq.com  Tue Mar  1 12:01:26 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 01 Mar 2011 12:01:26 +0000
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <AANLkTinAOQZwyuTyhys_ixyk3g8EGW-NS30v+OWNjR1d@mail.gmail.com>
References: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>	<20110228155125.GC32701@rabbitmq.com>	<BED156B9-E9DC-428C-88BF-C74EEA5F0FB1@jbrisbin.com>	<229274F1-CA00-455E-9FEF-66C42CB261D9@vmware.com>	<AANLkTimTG8dxLWvS0oWnC9VQA88anrDymJORP8xjP0Cu@mail.gmail.com>	<4D6C1A53.1050701@rabbitmq.com>
	<AANLkTinAOQZwyuTyhys_ixyk3g8EGW-NS30v+OWNjR1d@mail.gmail.com>
Message-ID: <4D6CE016.7090401@rabbitmq.com>

On 28/02/11 21:59, Alexis Richardson wrote:
> On Mon, Feb 28, 2011 at 9:57 PM, Michael Bridgen<mikeb at rabbitmq.com>  wrote:
>>> Another approach is to create federation models in new exchange
>>> types.
>>
>> Why have new exchange types -- why not just federate those that exist
>> already?
>
> Yes, that would be spiff too.

FTR the current design for the federation plugin (of which more soon) 
falls between these two - there is a new "x-federation" exchange type, 
but it can emulate any existing type; it doesn't have its own routing logic.

The fact of it being an exchange type may go away in the future, 
although it's actually pretty convenient.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From stammailbox at gmail.com  Tue Mar  1 12:55:03 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Tue, 1 Mar 2011 14:55:03 +0200
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <4D6CC5D5.7090208@rabbitmq.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
	<4D6BC078.8030600@rabbitmq.com>
	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>
	<4D6CC5D5.7090208@rabbitmq.com>
Message-ID: <AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>

Hi Emile,
I have a few questions:
1. On the rabbitmq server we have a few Erlang versions. Should that create
a problem .
(For now, I finished removing the older ones, so currently we have only
5.8.2 and the problem still exists
2. I have added the logs file from the rabbitmq server. I am the ip that
ends with 170.120 and my last trial had an exception.

3. Now about that tracer. I have been having some hard time finding
documentation for it.
Should I run it from the client (it comes with the client packacge) or in
the server? I am running it in the client.
my rabbit node port is 1434.  so I am running it with
.\runjava.bat co m.rabbitmq.tools.Tracer 1434 192.168.100.251 5672
are my parameters ok ?
I used rabbit node port as listenport and 5672 as connect port. I also
switched them but no luck . I didnt see anything on the cmd when I invoked
my produce command.
here it is

C:\workspace\thirdparty\rabbitmq\rabbitmq-java-client-bin-2.3.1>.\runjava.bat co
m.rabbitmq.tools.Tracer 1434 192.168.100.251 5672
Usage: Tracer [<listenport> [<connecthost> [<connectport>]]]
Invoked as: Tracer 1434 192.168.100.251 5672
com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false
com.rabbitmq.tools.Tracer.SUPPRESS_COMMAND_BODIES = false
Terminate batch job (Y/N)? y

C:\workspace\thirdparty\rabbitmq\rabbitmq-java-client-bin-2.3.1>.\runjava.bat co
m.rabbitmq.tools.Tracer 5673 192.168.100.251 1434
Usage: Tracer [<listenport> [<connecthost> [<connectport>]]]
Invoked as: Tracer 5673 192.168.100.251 1434
com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false
com.rabbitmq.tools.Tracer.SUPPRESS_COMMAND_BODIES = false


And one last thing - Our production environment is a mess currently, so I
really appreciate your assistance so far.
Thanks.


On Tue, Mar 1, 2011 at 12:09 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
>
> On 01/03/11 09:14, mysurf mail wrote:
>
>> Hi,
>> Thanks for your response.
>>
>> I followed your advice and here are my results.
>>  I see myself in the connection list when I invoke a connection from a
>> computer that gets the exception. I see it with "starting"  status and
>> instantly it disappears. (I use new exchange name and no exchange is
>> created)
>>
>> I tried to follow your advice about the tracer but i didn't find enough
>> info about the file runjava.bat in 2.3.1 (it exists only in the 1.7.0
>> package. not the 2.3.1.)
>>
>> it happens from almost half of the servers. not only the ones with the
>> NAT.
>> thanks.
>>
>
> Unfortunately this is not enough information to make any further guesses
> about the cause of the problem. Can you please supply a complete (compressed
> if necessary) broker logfile from one of the brokers where this problem
> occurs.
>
> I've confirmed that runjava.bat exists in the java client and the complete
> windows bundle downloads. You can get the latest version here:
> http://www.rabbitmq.com/java-client.html . It will be helpful if you can
> connect via the tracer and send the output.
>
> Are the failing servers all running the same version of RabbitMQ? Is it
> possible that they have some feature or configuration in common that may be
> the cause of the problem?
>
>
> Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110301/7354eab5/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: logs.rar
Type: application/rar
Size: 13428 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110301/7354eab5/attachment-0001.rar>

From simon at rabbitmq.com  Tue Mar  1 13:20:37 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 01 Mar 2011 13:20:37 +0000
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <A610E03AD50BFC4D95529A36D37FA55E1697F7B98B@GEORGE.Emea.Arm.com>
References: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>	<20110228155125.GC32701@rabbitmq.com>
	<A610E03AD50BFC4D95529A36D37FA55E1697F7B98B@GEORGE.Emea.Arm.com>
Message-ID: <4D6CF2A5.2000502@rabbitmq.com>

On 28/02/11 16:17, Chris Hampson wrote:
> Thanks Simon and Matthew for the quick responses.
>
> I was beginning to figure that perhaps what we were trying to do was
> going to be problematic, which is a shame as it would've been a very
> neat solution to what we're trying to do.
>
> In essence our use case is as follows:

<snip>

> This was essentially it, we then planned other applications on top of
> this base, it was shaping up nicely until we started experiencing the
> cluster break ups :-\
>
> I've just looked into the shovel plugin further, and it looks as if
> it may not be quite dynamic enough for our use (we don't want to be
> re-tweaking config files every time we set up a new pattern) :-( it's
> beginning to look like the best way forward for now is separate
> brokers with custom clients acting as the shovels between sites,
> consuming on one, then publishing to another as necessary.

You may be right for the time being. Which is a pity as yours is exactly 
the problem the new federation plugin is intended to solve, but it's not 
ready yet.

There's some documentation at:

http://hg.rabbitmq.com/rabbitmq-federation/file/default/README

If it sounds interesting then you might want to play with it, although I 
warn you that it's still under heavy development. But if you can live 
with a temporary solution for a while I intend for it to be more 
generally useful soon.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From Chris.Hampson at arm.com  Tue Mar  1 13:37:59 2011
From: Chris.Hampson at arm.com (Chris Hampson)
Date: Tue, 1 Mar 2011 13:37:59 +0000
Subject: [rabbitmq-discuss] Clustering over a WAN
In-Reply-To: <4D6CF2A5.2000502@rabbitmq.com>
References: <A610E03AD50BFC4D95529A36D37FA55E1697F7B953@GEORGE.Emea.Arm.com>
	<20110228155125.GC32701@rabbitmq.com>
	<A610E03AD50BFC4D95529A36D37FA55E1697F7B98B@GEORGE.Emea.Arm.com>
	<4D6CF2A5.2000502@rabbitmq.com>
Message-ID: <A610E03AD50BFC4D95529A36D37FA55E1697F7BB71@GEORGE.Emea.Arm.com>

Thanks Simon,

> You may be right for the time being. Which is a pity as yours is
> exactly
> the problem the new federation plugin is intended to solve, but it's
> not
> ready yet.

You guys have been very helpful, and have given us something to look forward to.

> There's some documentation at:
>
> http://hg.rabbitmq.com/rabbitmq-federation/file/default/README
>
> If it sounds interesting then you might want to play with it, although
> I
> warn you that it's still under heavy development. But if you can live
> with a temporary solution for a while I intend for it to be more
> generally useful soon.

When I get a chance I'll try to pop this up on a couple of virtual machines at different sites and see what we can do. :-)

Cheers,

Chris

-- IMPORTANT NOTICE: The contents of this email and any attachments are confidential and may also be privileged. If you are not the intended recipient, please notify the sender immediately and do not disclose the contents to any other person, use it for any purpose, or store or copy the information in any medium.  Thank you.


From emile at rabbitmq.com  Tue Mar  1 13:41:43 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 01 Mar 2011 13:41:43 +0000
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>	<4D6BC078.8030600@rabbitmq.com>	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>	<4D6CC5D5.7090208@rabbitmq.com>
	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>
Message-ID: <4D6CF797.4090305@rabbitmq.com>

Hi,

On 01/03/11 12:55, mysurf mail wrote:
> Hi Emile,
> I have a few questions:
> 1. On the rabbitmq server we have a few Erlang versions. Should that
> create a problem .

Keep in mind that different features of RabbitMQ have different minimum 
requirements (e.g. SSL and some plugins). This is especially important 
in a multi-version environment. It is best to use the latest version 
across the board if possible (unless it is an alpha version containing 
an A).

> (For now, I finished removing the older ones, so currently we have only
> 5.8.2 and the problem still exists
> 2. I have added the logs file from the rabbitmq server. I am the ip that
> ends with 170.120 and my last trial had an exception.

It is unusual to have the broker listen on port 1434. From the log there 
are at least 3 kinds of problems:

1 Protocol errors:
   Acknowledging with an unknown delivery tag
   Redeclaring exchanges with different parameters
   These will lead to a channel or connection closure.

2 1-Mar-2011::14:15:02
   Handshake timeout
   This will close the connection

3 1-Mar-2011::14:18:46
   Abrupt connection termination

The first can be solved by making sure that you don't acknowledge 
messages more than once, and that you declare exchanges with identical 
parameters. The second and third may have a related root cause, which 
the tracer or network diagnostic tools should help to identify.

> 3. Now about that tracer. I have been having some hard time finding
> documentation for it.
> Should I run it from the client (it comes with the client packacge) or
> in the server? I am running it in the client.
> my rabbit node port is 1434.  so I am running it with
> .\runjava.bat co m.rabbitmq.tools.Tracer 1434 192.168.100.251 5672
> are my parameters ok ?

See http://www.rabbitmq.com/examples.html#tracer .
Judging by your logfile you want to use 1434 as the connectPort argument 
instead of 5672.

> I used rabbit node port as listenport and 5672 as connect port. I also
> switched them but no luck . I didnt see anything on the cmd when I
> invoked my produce command.
> here it is

You should configure AMQP clients to connect to the tracer instead of to 
the broker directly. The port should be the one given as the first 
argument (listenPort) and the host should be the IP number of the 
machine running the tracer.




-Emile

From emile at rabbitmq.com  Tue Mar  1 13:50:20 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 01 Mar 2011 13:50:20 +0000
Subject: [rabbitmq-discuss] Every request is being processed more than
 once and giving double responses.
In-Reply-To: <192E282CAB256F41A2161A9E1BAA7C5E148046@MTW02MBX01.mindtree.com>
References: <192E282CAB256F41A2161A9E1BAA7C5E148046@MTW02MBX01.mindtree.com>
Message-ID: <4D6CF99C.6040300@rabbitmq.com>

Hi Waseem,

On 01/03/11 13:13, Waseem Hawaldar wrote:
> Hello,
>
> I am Waseem using RabbitMQ 1.8. I am facing the below mentioned issue:
>
> I fired 46 requests and after getting 3 responses , 43 requests were
> pending in request queue, Now when I restarted RabbitMQ server I am
> getting 87 responses.
>
> I observed that when I restart RabbitMQ all 46 requests are being
> processed once again without bothering about 43 pending requests.
>
> Finally after processing of all 46 requests it is processing that
> pending 43 requests. Henceforth giving 87 responses.
>
> So, I would like to know what is the solution for this.

Will you be able to run the following in between each of the steps you 
describe:

"rabbitmqctl list_queues name messages messages_ready 
messages_unacknowledged"

It is likely that unacknowledged messages are being requeued and this 
command should show where that happens.


Regards

Emile


From stammailbox at gmail.com  Tue Mar  1 14:57:17 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Tue, 1 Mar 2011 16:57:17 +0200
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <4D6CF797.4090305@rabbitmq.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
	<4D6BC078.8030600@rabbitmq.com>
	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>
	<4D6CC5D5.7090208@rabbitmq.com>
	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>
	<4D6CF797.4090305@rabbitmq.com>
Message-ID: <AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>

Hi,


I setup a trace at the client app server. Set the listen port and connection
port and got a log for the unsuccessful factory.newConnection() . I added it
in attached the tracelog.txt.

now regarding the other references you gave me

1 Protocol errors:
 Acknowledging with an unknown delivery tag
 Redeclaring exchanges with different parameters

you recommended not acking more than once. This whole thing started when we
upgraded the rabbitmq version and Matthias sujested we will change the
consumer to ack (i.e. we changed it to channel.basicConsume(queueName,
FALSE, queueingConsumer);)
(This is if I understood him right )
So How can I control the acking . How do I know if I ack more then once. I
think I never send an ack consciously. only through the subscibe .

I hope the second and the third will be solved with the trace.

and thanks again.

On Tue, Mar 1, 2011 at 3:41 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
>
> On 01/03/11 12:55, mysurf mail wrote:
>
>> Hi Emile,
>> I have a few questions:
>> 1. On the rabbitmq server we have a few Erlang versions. Should that
>> create a problem .
>>
>
> Keep in mind that different features of RabbitMQ have different minimum
> requirements (e.g. SSL and some plugins). This is especially important in a
> multi-version environment. It is best to use the latest version across the
> board if possible (unless it is an alpha version containing an A).
>
>

>  (For now, I finished removing the older ones, so currently we have only
>> 5.8.2 and the problem still exists
>> 2. I have added the logs file from the rabbitmq server. I am the ip that
>> ends with 170.120 and my last trial had an exception.
>>
>
> It is unusual to have the broker listen on port 1434. From the log there
> are at least 3 kinds of problems:
>
> 1 Protocol errors:
>  Acknowledging with an unknown delivery tag
>  Redeclaring exchanges with different parameters
>  These will lead to a channel or connection closure.
>
> 2 1-Mar-2011::14:15:02
>  Handshake timeout
>  This will close the connection
>
> 3 1-Mar-2011::14:18:46
>  Abrupt connection termination
>
> The first can be solved by making sure that you don't acknowledge messages
> more than once, and that you declare exchanges with identical parameters.
> The second and third may have a related root cause, which the tracer or
> network diagnostic tools should help to identify.
>
>
>  3. Now about that tracer. I have been having some hard time finding
>> documentation for it.
>> Should I run it from the client (it comes with the client packacge) or
>> in the server? I am running it in the client.
>> my rabbit node port is 1434.  so I am running it with
>> .\runjava.bat co m.rabbitmq.tools.Tracer 1434 192.168.100.251 5672
>> are my parameters ok ?
>>
>
> See http://www.rabbitmq.com/examples.html#tracer .
> Judging by your logfile you want to use 1434 as the connectPort argument
> instead of 5672.
>
>
>  I used rabbit node port as listenport and 5672 as connect port. I also
>> switched them but no luck . I didnt see anything on the cmd when I
>> invoked my produce command.
>> here it is
>>
>
> You should configure AMQP clients to connect to the tracer instead of to
> the broker directly. The port should be the one given as the first argument
> (listenPort) and the host should be the IP number of the machine running the
> tracer.
>
>
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110301/c5c30ca3/attachment-0001.htm>
-------------- next part --------------
C:\workspace\thirdparty\rabbitmq\rabbitmq-java-client-bin-2.3.1>.\runjava.bat co
m.rabbitmq.tools.Tracer 5673 192.168.100.251 1434


Usage: Tracer [<listenport> [<connecthost> [<connectport>]]]
Invoked as: Tracer 5673 192.168.100.251 1434
com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false
com.rabbitmq.tools.Tracer.SUPPRESS_COMMAND_BODIES = false
1298990430343: conn#0 ch#0 <- {#method<connection.start>(version-major=0,version
-minor=9,server properties={product=RabbitMQ, platform=Erlang/OTP, information=L
icensed under the MPL.  See http://www.rabbitmq.com/, copyright=Copyright (C) 20
07-2011 VMware, Inc., version=2.3.1},mechanisms=PLAIN AMQPLAIN,locales=en_US),nu
ll,""}
1298990430437: conn#0 ch#0 -> {#method<connection.start-ok>(client-properties={p
roduct=RabbitMQ, information=Licensed under the MPL. See http://www.rabbitmq.com
/, platform=Java, copyright=Copyright (C) 2007-2011 VMware, Inc., version=2.3.1}
,mechanism=PLAIN,response= guest guest,locale=en_US),null,""}
1298990430593: conn#0 ch#0 <- {#method<connection.tune>(channel-max=0,frame-max=
131072,heartbeat=0),null,""}
1298990430593: conn#0 ch#0 -> {#method<connection.tune-ok>(channel-max=0,frame-m
ax=131072,heartbeat=30),null,""}
1298990430609: conn#0 ch#0 -> {#method<connection.open>(virtual-host=/,capabilit
ies=,insist=false),null,""}
1298990430796: conn#0 ch#0 <- {#method<connection.open-ok>(known-hosts=),null,""
}
1298990430812: conn#0 ch#1 -> {#method<channel.open>(out-of-band=),null,""}
1298990431000: conn#0 ch#1 <- {#method<channel.open-ok>(channel-id=),null,""}
1298990431000: conn#0 ch#1 -> {#method<exchange.declare>(ticket=0,exchange=toMan
ager,type=direct,passive=false,durable=false,auto-delete=false,internal=false,no
wait=false,arguments={}),null,""}
1298990431296: conn#0 ch#1 <- {#method<exchange.declare-ok>(),null,""}
1298990431296: conn#0 ch#1 -> {#method<queue.declare>(ticket=0,queue=,passive=fa
lse,durable=false,exclusive=false,auto-delete=false,nowait=false,arguments={}),n
ull,""}
1298990431531: conn#0 ch#1 <- {#method<queue.declare-ok>(queue=amq.gen-Ip9tTe7JX
G83iXqJQbld7w==,message-count=0,consumer-count=0),null,""}
1298990431531: conn#0 ch#1 -> {#method<queue.bind>(ticket=0,queue=,exchange=toMa
nager,routing-key=rtk,nowait=false,arguments={}),null,""}
1298990431718: conn#0 ch#1 <- {#method<queue.bind-ok>(),null,""}
1298990431718: conn#0 ch#1 -> {#method<basic.consume>(ticket=0,queue=,consumer-t
ag=,no-local=false,no-ack=false,exclusive=false,nowait=false,arguments={}),null,
""}
1298990431921: conn#0 ch#1 <- {#method<basic.consume-ok>(consumer-tag=amq.ctag-9
f5ZhEsESDHdJtp1jbv3iA==),null,""}
1298990460625: conn#0 ch#0 -> Frame(type=8, channel=0, 0 bytes of payload)
1298990460843: conn#0 ch#0 <- Frame(type=8, channel=0, 0 bytes of payload)

From emile at rabbitmq.com  Tue Mar  1 15:59:13 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 01 Mar 2011 15:59:13 +0000
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>	<4D6BC078.8030600@rabbitmq.com>	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>	<4D6CC5D5.7090208@rabbitmq.com>	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>	<4D6CF797.4090305@rabbitmq.com>
	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>
Message-ID: <4D6D17D1.6020902@rabbitmq.com>

Hi,

On 01/03/11 14:57, mysurf mail wrote:
> Hi,
>
>
> I setup a trace at the client app server. Set the listen port and
> connection port and got a log for the unsuccessful
> factory.newConnection() . I added it in attached the tracelog.txt.

This looks like a normal trace with a successful connection 
establishment, and subsequent exchange and queue declarations. I would 
be surprised if the broker logfile contained an abrupt connection 
failure at the corresponding time. Can you please confirm? If possible 
please supply a trace of a case where an error occurs.

> now regarding the other references you gave me
>
> 1 Protocol errors:
>   Acknowledging with an unknown delivery tag
>   Redeclaring exchanges with different parameters
>
> you recommended not acking more than once. This whole thing started when
> we upgraded the rabbitmq version and Matthias sujested we will change
> the consumer to ack (i.e. we changed it to
> channel.basicConsume(queueName, FALSE, queueingConsumer);)
> (This is if I understood him right )
> So How can I control the acking . How do I know if I ack more then once.

This is more than a recommendation. From the specification:

   "a client MUST not acknowledge the same message more than once."

Check whether your client contains instances of "channel.basicAck". If 
you acknowledge messages more than once you will see a channel exception.


Emile

From pdezwart at rubiconproject.com  Tue Mar  1 17:51:45 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 01 Mar 2011 09:51:45 -0800
Subject: [rabbitmq-discuss] Building a recent rabbitmq-c with 0-8
	protocol
In-Reply-To: <yrv4cfwr7aj85.fsf@dwragg.eng.vmware.com>
Message-ID: <C9927231.18ED8%pdezwart@rubiconproject.com>

So, I am a mercurial n00b. IS there any chance you can point me to two URLs,
one for the rabbitmq-c repo, one for the rabbitmq-codegen repo, that I can
use to generate an 0-8 client library, so that I can then upgrade to 2.3.1.
The combination of:
// librabbitmq-0.1-amqp_0_8 tag
$ hg clone http://hg.rabbitmq.com/rabbitmq-c/rev/ce1eaceaee94
// rabbitmq_v1_7_2
$ hg clone http://hg.rabbitmq.com/rabbitmq-codegen/rev/c7c5876a05bb

Yields what seems to be a 0-9-1 client, since I used the steps below to try
to compile it, and had to move the 0-9-1 json spec out of the way.

Thanks for you help.
Pieter


On 2/28/11 2:26 PM, "David Wragg" <david at rabbitmq.com> wrote:

> Hi Pieter,
> 
> Pieter de Zwart <pdezwart at rubiconproject.com> writes:
>> I sincerely hope that this is stupid question with an easy answer. I am
>> trying to build a somewhat recent version of the rabbitmq-c library to use
>> with the PHP extension, but that uses the 0-8 protocol since our production
>> broker is still 1.7.2 (working on upgrading that, but that?s a separate
>> discussion.)
>> 
>> To do so, I edited the configure file to point to the amqp-rabbitmq-0.8.json
>> codegen spec, changed the Makefile to not build tools, examples and tests
>> (those broke,) and tried to un it. According to my server however, its still
>> trying to use 0-9-1 (Expected 0x000A000A method frame on channel 0, got
>> frame type 65)
>> 
>> Should this have worked? Am I maybe just installing this wrong? I cleaned
>> out all librabbitmq.so files and symlinks, so I doubt its the problem, but I
>> am looking for a sanity check here.
> 
> There is no intention for this to work.  There are AMQP
> version-dependent areas outside of the generated code.  You can see the
> complete changes that were involved in the switch of the C client to
> 0-9-1 at <http://hg.rabbitmq.com/rabbitmq-c/rev/168205522459>.
> 
> With that said, it's probably not that difficult to revert the changes.
> If you don't care about the changes outside of librabbitmq/, and you
> discard the changes to code that wasn't generated back then but is now,
> it looks to me like there are only a couple of changes relevant (to
> librabbitmq/amqp_socket.c and librabbitmq/codegen.py).
> 
> Perhaps we should be gratified that people are still running the 1.7.2
> broker in production.  But I'd strongly recommend you upgrade at the
> earliest opportunity, both for the many enhancements and for the bug
> fixes.  You do know that old 0-8 clients can still talk to the latest
> versions of the broker, so you don't have to upgrade your whole AMQP 0-8
> infrastructure at once?
> 
> David



From pdezwart at rubiconproject.com  Tue Mar  1 18:29:13 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 01 Mar 2011 10:29:13 -0800
Subject: [rabbitmq-discuss] Building a recent rabbitmq-c with 0-8
	protocol
In-Reply-To: <C9927231.18ED8%pdezwart@rubiconproject.com>
Message-ID: <C9927AF9.18EF3%pdezwart@rubiconproject.com>

Alright, I finally found an old version of the binary that works. I am going
to get this up and running and then start prepping for the the update to
2.x.

Thanks for the help David, sorry to be a PITA.

me


On 3/1/11 9:51 AM, "Pieter de Zwart" <pdezwart at rubiconproject.com> wrote:

> So, I am a mercurial n00b. IS there any chance you can point me to two
> URLs,
one for the rabbitmq-c repo, one for the rabbitmq-codegen repo, that I
> can
use to generate an 0-8 client library, so that I can then upgrade to
> 2.3.1.
The combination of:
// librabbitmq-0.1-amqp_0_8 tag
$ hg clone
> http://hg.rabbitmq.com/rabbitmq-c/rev/ce1eaceaee94
// rabbitmq_v1_7_2
$ hg
> clone http://hg.rabbitmq.com/rabbitmq-codegen/rev/c7c5876a05bb

Yields what
> seems to be a 0-9-1 client, since I used the steps below to try
to compile it,
> and had to move the 0-9-1 json spec out of the way.

Thanks for you
> help.
Pieter


On 2/28/11 2:26 PM, "David Wragg" <david at rabbitmq.com>
> wrote:

> Hi Pieter,
> 
> Pieter de Zwart <pdezwart at rubiconproject.com>
> writes:
>> I sincerely hope that this is stupid question with an easy answer.
> I am
>> trying to build a somewhat recent version of the rabbitmq-c library to
> use
>> with the PHP extension, but that uses the 0-8 protocol since our
> production
>> broker is still 1.7.2 (working on upgrading that, but that?s a
> separate
>> discussion.)
>> 
>> To do so, I edited the configure file to point
> to the amqp-rabbitmq-0.8.json
>> codegen spec, changed the Makefile to not
> build tools, examples and tests
>> (those broke,) and tried to un it.
> According to my server however, its still
>> trying to use 0-9-1 (Expected
> 0x000A000A method frame on channel 0, got
>> frame type 65)
>> 
>> Should this
> have worked? Am I maybe just installing this wrong? I cleaned
>> out all
> librabbitmq.so files and symlinks, so I doubt its the problem, but I
>> am
> looking for a sanity check here.
> 
> There is no intention for this to work.
> There are AMQP
> version-dependent areas outside of the generated code.  You
> can see the
> complete changes that were involved in the switch of the C
> client to
> 0-9-1 at <http://hg.rabbitmq.com/rabbitmq-c/rev/168205522459>.
>
> 
> With that said, it's probably not that difficult to revert the changes.
>
> If you don't care about the changes outside of librabbitmq/, and you
> discard
> the changes to code that wasn't generated back then but is now,
> it looks to
> me like there are only a couple of changes relevant (to
>
> librabbitmq/amqp_socket.c and librabbitmq/codegen.py).
> 
> Perhaps we should
> be gratified that people are still running the 1.7.2
> broker in production.
> But I'd strongly recommend you upgrade at the
> earliest opportunity, both for
> the many enhancements and for the bug
> fixes.  You do know that old 0-8
> clients can still talk to the latest
> versions of the broker, so you don't
> have to upgrade your whole AMQP 0-8
> infrastructure at once?
> 
>
> David


_______________________________________________
rabbitmq-discuss
> mailing 
> list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/ma
> ilman/listinfo/rabbitmq-discuss


-- 
the rubicon project

PIETER DE ZWART | LEAD, INTERFACES TEAM
??? P 310 207 0272 | x224
??? C 408 666 4443
??? F 323 466 7119


1925 S. BUNDY DRIVE
LOS ANGELES, CALIFORNIA 90025

WWW.RUBICONPROJECT.COM <http://www.rubiconproject.com/>


?MOST INNOVATIVE COMPANY? - AMERICAN BUSINESS AWARDS ?10
 REVV IS OPTIMIZING 1.4 MILLION ADS PER MINUTE



From vertolet666 at yandex.ru  Tue Mar  1 19:13:31 2011
From: vertolet666 at yandex.ru (DOBRO Sergei)
Date: Tue, 01 Mar 2011 22:13:31 +0300
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D6CC571.8020108@rabbitmq.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru> <4D6CC571.8020108@rabbitmq.com>
Message-ID: <590471299006811@web28.yandex.ru>

01.03.2011, 13:07, "Matthias Radestock" <matthias at rabbitmq.com>:
> DOBRO Sergei wrote:
>
>> ?There are six workers. Other clients publish messages to exchange
>> ?"ex.direct" with the routing key which is determined randomly from
>> ?the values of array (routing_key1, routing_key2, ...., routing_key6).
>> ??So, the workers receive messages randomly too. That's why I can not
>> ?tell you which worker(s) stops receiving messages.
>
> So how do you know that messages are getting lost?
>
Each worker declares a queue which has a unique name. After restarting worker it declares a new unique queue and everything works ok.
So, due to this fact I believe that messages are getting lost.

From matthias at rabbitmq.com  Tue Mar  1 19:53:39 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 01 Mar 2011 19:53:39 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <590471299006811@web28.yandex.ru>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru> <4D6CC571.8020108@rabbitmq.com>
	<590471299006811@web28.yandex.ru>
Message-ID: <4D6D4EC3.4000705@rabbitmq.com>

On 01/03/11 19:13, DOBRO Sergei wrote:
> Each worker declares a queue which has a unique name. After
> restarting worker it declares a new unique queue and everything works
> ok. So, due to this fact I believe that messages are getting lost.

How do you know something is *not* working ok? Or to put it another way, 
exactly what observation are you making that indicates something isn't 
right? Are workers perhaps logging something when they do their work, 
and you observe that some workers stop logging after a while?


Matthias.

From vertolet666 at yandex.ru  Tue Mar  1 20:50:14 2011
From: vertolet666 at yandex.ru (DOBRO Sergei)
Date: Tue, 01 Mar 2011 23:50:14 +0300
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D6D4EC3.4000705@rabbitmq.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru> <4D6CC571.8020108@rabbitmq.com>
	<590471299006811@web28.yandex.ru> <4D6D4EC3.4000705@rabbitmq.com>
Message-ID: <627461299012614@web31.yandex.ru>

01.03.2011, 22:53, "Matthias Radestock" <matthias at rabbitmq.com>:
> On 01/03/11 19:13, DOBRO Sergei wrote:
>
>> ?Each worker declares a queue which has a unique name. After
>> ?restarting worker it declares a new unique queue and everything works
>> ?ok. So, due to this fact I believe that messages are getting lost.
>
> How do you know something is *not* working ok? Or to put it another way,
> exactly what observation are you making that indicates something isn't
> right? Are workers perhaps logging something when they do their work,
> and you observe that some workers stop logging after a while?
>
When a message is received, the worker must do some updates in database and must send a message to a specific exchange as confirmation of job completed. When the issue appears some of the workers do this job and some of them do not. All the workers are logging warnings or errors when:
- bad message is received (i.e. it could not be JSON-decoded),
- getting any SQL error during transaction,
- getting any AMQP exception,
- worker is disconnected from RabbitMQ or SQL server.

If a message is received and successfully processed, no logging made.


From matthias at rabbitmq.com  Tue Mar  1 20:58:40 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 01 Mar 2011 20:58:40 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <627461299012614@web31.yandex.ru>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru> <4D6CC571.8020108@rabbitmq.com>
	<590471299006811@web28.yandex.ru> <4D6D4EC3.4000705@rabbitmq.com>
	<627461299012614@web31.yandex.ru>
Message-ID: <4D6D5E00.9010909@rabbitmq.com>

On 01/03/11 20:50, DOBRO Sergei wrote:
> When a message is received, the worker must do some updates in
> database and must send a message to a specific exchange as
> confirmation of job completed. When the issue appears some of the
> workers do this job and some of them do not.

Each job goes to just one worker though, right? How do you know what 
jobs there were and which did / didn't get processed?

Any luck yet with setting up the tracer? That would tell you for certain 
whether the broker is sending the jobs to the workers.


Regards,

Matthias.

From vertolet666 at yandex.ru  Tue Mar  1 21:22:15 2011
From: vertolet666 at yandex.ru (DOBRO Sergei)
Date: Wed, 02 Mar 2011 00:22:15 +0300
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D6D5E00.9010909@rabbitmq.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru> <4D6CC571.8020108@rabbitmq.com>
	<590471299006811@web28.yandex.ru> <4D6D4EC3.4000705@rabbitmq.com>
	<627461299012614@web31.yandex.ru> <4D6D5E00.9010909@rabbitmq.com>
Message-ID: <64901299014535@web1.yandex.ru>

01.03.2011, 23:58, "Matthias Radestock" <matthias at rabbitmq.com>:
> On 01/03/11 20:50, DOBRO Sergei wrote:
>
>> ?When a message is received, the worker must do some updates in
>> ?database and must send a message to a specific exchange as
>> ?confirmation of job completed. When the issue appears some of the
>> ?workers do this job and some of them do not.
>
> Each job goes to just one worker though, right? 
Exactly.

> How do you know what
> jobs there were and which did / didn't get processed?
>
Another client sends a message to the worker, but no database updates are made. After that (some seconds later), the client sends the same message and the job is done.

> Any luck yet with setting up the tracer?
I will certainly post a report when I set up it. Sorry, no time for that.

From matthias at rabbitmq.com  Tue Mar  1 21:29:53 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 01 Mar 2011 21:29:53 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <64901299014535@web1.yandex.ru>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru> <4D6CC571.8020108@rabbitmq.com>
	<590471299006811@web28.yandex.ru> <4D6D4EC3.4000705@rabbitmq.com>
	<627461299012614@web31.yandex.ru>
	<4D6D5E00.9010909@rabbitmq.com> <64901299014535@web1.yandex.ru>
Message-ID: <4D6D6551.4020808@rabbitmq.com>

On 01/03/11 21:22, DOBRO Sergei wrote:
> Another client sends a message to the worker, but no database updates
> are made. After that (some seconds later), the client sends the same
> message and the job is done.

How do you know whether the client has sent a message to the worker? And 
what causes the client to send the same message again? Is it waiting for 
a confirmation which does not arrive and hence re-trying? Does the 
client log the retry attempts, and that's how you know that something is 
going wrong?

Matthias.

From vertolet666 at yandex.ru  Tue Mar  1 22:13:20 2011
From: vertolet666 at yandex.ru (DOBRO Sergei)
Date: Wed, 02 Mar 2011 01:13:20 +0300
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D6D6551.4020808@rabbitmq.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru> <4D6CC571.8020108@rabbitmq.com>
	<590471299006811@web28.yandex.ru> <4D6D4EC3.4000705@rabbitmq.com>
	<627461299012614@web31.yandex.ru>
	<4D6D5E00.9010909@rabbitmq.com> <64901299014535@web1.yandex.ru>
	<4D6D6551.4020808@rabbitmq.com>
Message-ID: <636111299017601@web19.yandex.ru>



02.03.2011, 00:29, "Matthias Radestock" <matthias at rabbitmq.com>:
> On 01/03/11 21:22, DOBRO Sergei wrote:
>
>> ?Another client sends a message to the worker, but no database updates
>> ?are made. After that (some seconds later), the client sends the same
>> ?message and the job is done.
>
> How do you know whether the client has sent a message to the worker? 
>
I am the client :) I am one of the clients, actually. Sure, I can control sending messages.

> And what causes the client to send the same message again? Is it waiting for
> a confirmation which does not arrive and hence re-trying? 
Yes, each client is waiting for a confirmation from the worker. 
If it is too long (e.g. more than 5 seconds), the client can make an effort to re-send a message and get the result.

> Does the client log the retry attempts, and that's how you know that something is
> going wrong?
Yes, it does log all the messages published and it does log all the messages received.
When something is going wrong, I get my site forum flooded with messages like "Aaaaaah! Nothing works! Help me, quick!", etc. :)
That's the way how I know about that :)
I restart the workers and all of the clients become happy :)

From matthias at rabbitmq.com  Tue Mar  1 22:19:32 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 01 Mar 2011 22:19:32 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <636111299017601@web19.yandex.ru>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru> <4D6CC571.8020108@rabbitmq.com>
	<590471299006811@web28.yandex.ru> <4D6D4EC3.4000705@rabbitmq.com>
	<627461299012614@web31.yandex.ru>
	<4D6D5E00.9010909@rabbitmq.com> <64901299014535@web1.yandex.ru>
	<4D6D6551.4020808@rabbitmq.com> <636111299017601@web19.yandex.ru>
Message-ID: <4D6D70F4.80909@rabbitmq.com>

On 01/03/11 22:13, DOBRO Sergei wrote:
> I restart the workers and all of the clients become happy :)

Could workers get stuck somehow?

Matthias.

From vertolet666 at yandex.ru  Tue Mar  1 22:45:01 2011
From: vertolet666 at yandex.ru (DOBRO Sergei)
Date: Wed, 02 Mar 2011 01:45:01 +0300
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D6D70F4.80909@rabbitmq.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru> <4D6CC571.8020108@rabbitmq.com>
	<590471299006811@web28.yandex.ru> <4D6D4EC3.4000705@rabbitmq.com>
	<627461299012614@web31.yandex.ru>
	<4D6D5E00.9010909@rabbitmq.com> <64901299014535@web1.yandex.ru>
	<4D6D6551.4020808@rabbitmq.com>
	<636111299017601@web19.yandex.ru> <4D6D70F4.80909@rabbitmq.com>
Message-ID: <638441299019501@web8.yandex.ru>



02.03.2011, 01:19, "Matthias Radestock" <matthias at rabbitmq.com>:
>
> Could workers get stuck somehow?
>
Well, they have been stress-tested. I loaded them with 100 messages per second and all messages were successfully processed.
I don't think they are at high load now.

From pendletongp at gatech.edu  Tue Mar  1 23:42:06 2011
From: pendletongp at gatech.edu (Pendleton, Gordon P)
Date: Tue, 1 Mar 2011 18:42:06 -0500 (EST)
Subject: [rabbitmq-discuss] can I set databse name in the configuration file
 to override default hostname value
In-Reply-To: <122281202.297911.1299022711365.JavaMail.root@mail6.gatech.edu>
Message-ID: <1897139896.297986.1299022926373.JavaMail.root@mail6.gatech.edu>

Hi,

I am having trouble figuring out how to configure RabbitMQ to use a value other than the server hostname when naming the database file it uses.  I am using amazon ec2 so hostname changes every time an instance is started.  Because of this, I need to be able to set the name in a configuration file.  I can't find a list of configuration options so can someone tell me how to do this and which configuration file I should be using (I read there are two)?

Thanks.

From matthias at rabbitmq.com  Tue Mar  1 23:51:29 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 01 Mar 2011 23:51:29 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <638441299019501@web8.yandex.ru>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru> <4D6CC571.8020108@rabbitmq.com>
	<590471299006811@web28.yandex.ru> <4D6D4EC3.4000705@rabbitmq.com>
	<627461299012614@web31.yandex.ru>
	<4D6D5E00.9010909@rabbitmq.com> <64901299014535@web1.yandex.ru>
	<4D6D6551.4020808@rabbitmq.com>
	<636111299017601@web19.yandex.ru> <4D6D70F4.80909@rabbitmq.com>
	<638441299019501@web8.yandex.ru>
Message-ID: <4D6D8681.3080608@rabbitmq.com>

On 01/03/11 22:45, DOBRO Sergei wrote:
> Well, they have been stress-tested. I loaded them with 100 messages
> per second and all messages were successfully processed. I don't
> think they are at high load now.

It may not be a load issue. Anyway, next step is to look at some traces.


Matthias.

From matthew at rabbitmq.com  Wed Mar  2 00:25:24 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 2 Mar 2011 00:25:24 +0000
Subject: [rabbitmq-discuss] can I set databse name in the configuration
 file to override default hostname value
In-Reply-To: <1897139896.297986.1299022926373.JavaMail.root@mail6.gatech.edu>
References: <122281202.297911.1299022711365.JavaMail.root@mail6.gatech.edu>
	<1897139896.297986.1299022926373.JavaMail.root@mail6.gatech.edu>
Message-ID: <20110302002523.GA6255@wellquite.org>

On Tue, Mar 01, 2011 at 06:42:06PM -0500, Pendleton, Gordon P wrote:
> I am having trouble figuring out how to configure RabbitMQ to use a value other than the server hostname when naming the database file it uses.  I am using amazon ec2 so hostname changes every time an instance is started.  Because of this, I need to be able to set the name in a configuration file.  I can't find a list of configuration options so can someone tell me how to do this and which configuration file I should be using (I read there are two)?


You can set the env var RABBITMQ_NODENAME or set NODENAME in
/etc/rabbitmq/rabbitmq.conf

Best wishes,

Matthew

From rommel.carino.garcia at gmail.com  Wed Mar  2 02:14:58 2011
From: rommel.carino.garcia at gmail.com (Rom)
Date: Tue, 1 Mar 2011 18:14:58 -0800 (PST)
Subject: [rabbitmq-discuss] Maximum Frame Setting Not Working
In-Reply-To: <4D6CBE23.8020902@rabbitmq.com>
References: <0c38630e-f53b-44fb-842f-6c0cc66ed545@k38g2000vbn.googlegroups.com>
	<4D6CBE23.8020902@rabbitmq.com>
Message-ID: <53c8ca88-bedc-482a-8311-04b3f540d083@w36g2000vbi.googlegroups.com>

Hi Emile,

Thank you for the clarification. I did see this error in the log file.
I'm exploring rabbitmq to be our messaging platform that handles heavy
and very light payloads. There might be a node that will be dedicated
to processing mobile data which is very light and so I was thinking
that it might be a good idea to reduce the default frame size. Just a
thought.

Seems like the way to achieve that customized default behavior on the
frame size is to make changes to the rabbitmq.config file but I'm not
well familiar with the erl style configuration and the available
properties. Do you know of any references I could take a look at?

Thanks.

Rom

On Mar 1, 4:36?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Rom,
>
> On 01/03/11 03:55, Rom wrote:
>
>
>
>
>
>
>
>
>
> > I have successfully run a very simple message publisher with my
> > ConnectionFactory setting below.
>
> > ConnectionFactory factory = new ConnectionFactory();
> > factory.setUsername("rabbitmq"); factory.setPassword("rabbitmq");
> > factory.setVirtualHost("/4couchdb"); factory.setHost("rcgarcia74");
> > factory.setPort(ConnectionFactory.DEFAULT_AMQP_PORT);
> > factory.setRequestedChannelMax(100);
> > factory.setRequestedHeartbeat(300);
>
> > But when I start adding in the Maximum Frame size below, any number
> > that I put in doesn't work. Is there a variable that I need to set
> > at rabbitmq.conf? If it's in the conf file what's the key/vakue
> > pair?
>
> > factory.setRequestedFrameMax(1);
>
> AMQP specifies a minimum frame size of 4kb. You should see this in the
> broker logfile after that attempt:
>
> ? ?amqp_error,not_allowed,"frame_max=1 < 4096 min size"
>
> The solution is to use values of 4096 or higher.
>
> What are you trying to accomplish by changing the default frame size
> (128kb)?
>
> Regards
>
> Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From benbennett at gmail.com  Wed Mar  2 04:21:38 2011
From: benbennett at gmail.com (Benjamin Bennett)
Date: Tue, 1 Mar 2011 22:21:38 -0600
Subject: [rabbitmq-discuss] Realtime messaging or near realtime use rabbitmq
	?
Message-ID: <AANLkTi=EYnOwZORQCaUPS1fhRfcU_kJ03km-Q2BJOE4S@mail.gmail.com>

I am working on volunteer project that use to be funded by my
company(hardware that is). We are still hacking away on it when we
can.
Basically it is an autonomous car, not to standards that are seen in
the media but we are having fun leaving and just doing something
interesting.

I introduced rabbitmq to my day project, very boring web app and it
has worked well.

I was wonder how well do you think rabbit would perform on a system
with very few publishers and subscribers but trying to get messages
very quickly.

The control systems have outer and inner control loops , so even if
rabbit completely failed it shuts itself down.

We are using IPC but difficult to code with and only works in c /c++.

Any  recommendations? I know I would want messages to "die" on a queue
rather quickly because they would be consider stale.

From stammailbox at gmail.com  Wed Mar  2 07:01:28 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 2 Mar 2011 09:01:28 +0200
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <4D6D17D1.6020902@rabbitmq.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
	<4D6BC078.8030600@rabbitmq.com>
	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>
	<4D6CC5D5.7090208@rabbitmq.com>
	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>
	<4D6CF797.4090305@rabbitmq.com>
	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>
	<4D6D17D1.6020902@rabbitmq.com>
Message-ID: <AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>

Ok,
I will repeat my test results fully .
It happens only from certain computers.
It usually throws an exception when the command
factory.newConnection() is invoked.
the exception is ConnectionException. I have it in the initial mail of this
thread.
( I can telnet that port. I can connect from other computers. I can connect
to it with 1.7.0 clients )

I dont think I am acking until that point.


On Tue, Mar 1, 2011 at 5:59 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
>
> On 01/03/11 14:57, mysurf mail wrote:
>
>> Hi,
>>
>>
>> I setup a trace at the client app server. Set the listen port and
>> connection port and got a log for the unsuccessful
>> factory.newConnection() . I added it in attached the tracelog.txt.
>>
>
> This looks like a normal trace with a successful connection establishment,
> and subsequent exchange and queue declarations. I would be surprised if the
> broker logfile contained an abrupt connection failure at the corresponding
> time. Can you please confirm? If possible please supply a trace of a case
> where an error occurs.
>
>
>  now regarding the other references you gave me
>>
>> 1 Protocol errors:
>>  Acknowledging with an unknown delivery tag
>>  Redeclaring exchanges with different parameters
>>
>> you recommended not acking more than once. This whole thing started when
>> we upgraded the rabbitmq version and Matthias sujested we will change
>> the consumer to ack (i.e. we changed it to
>> channel.basicConsume(queueName, FALSE, queueingConsumer);)
>> (This is if I understood him right )
>> So How can I control the acking . How do I know if I ack more then once.
>>
>
> This is more than a recommendation. From the specification:
>
>  "a client MUST not acknowledge the same message more than once."
>
> Check whether your client contains instances of "channel.basicAck". If you
> acknowledge messages more than once you will see a channel exception.
>
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/8e1e771c/attachment.htm>

From stammailbox at gmail.com  Wed Mar  2 07:26:08 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 2 Mar 2011 09:26:08 +0200
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
	<4D6BC078.8030600@rabbitmq.com>
	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>
	<4D6CC5D5.7090208@rabbitmq.com>
	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>
	<4D6CF797.4090305@rabbitmq.com>
	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>
	<4D6D17D1.6020902@rabbitmq.com>
	<AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>
Message-ID: <AANLkTikSfe3aRT=dbEUWDc6dkXsmUmgcGYj_EbW9j_H1@mail.gmail.com>

Sorry,
I get PossibleAuthenticationFailureException

PlatformException: could not create connection
	at com.programa17.mmm.modules.stopwatch.util.BasicChannel.<init>(BasicChannel.java:40)
	at com.programa17.mmm.modules.stopwatch.util.BasicChannel.<init>(BasicChannel.java:23)
	at com.programa17.mmm.modules.stopwatch.util.RabbitMQTest$Manager.<init>(RabbitMQTest.java:94)
	at com.programa17.mmm.modules.stopwatch.util.RabbitMQTest.test1(RabbitMQTest.java:22)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:65)
Caused by: com.rabbitmq.client.PossibleAuthenticationFailureException:
Possibly caused by authentication failure
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:289)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:383)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:403)
	at com.programa17.mmm.modules.stopwatch.util.BasicChannel.<init>(BasicChannel.java:38)
	... 23 more
Caused by: com.rabbitmq.client.AlreadyClosedException: clean
connection shutdown; reason: Attempt to use closed channel
	at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:181)
	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:208)
	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:194)
	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:281)
	... 26 more


On Wed, Mar 2, 2011 at 9:01 AM, mysurf mail <stammailbox at gmail.com> wrote:

> Ok,
> I will repeat my test results fully .
> It happens only from certain computers.
> It usually throws an exception when the command
> factory.newConnection() is invoked.
> the exception is ConnectionException. I have it in the initial mail of this
> thread.
> ( I can telnet that port. I can connect from other computers. I can connect
> to it with 1.7.0 clients )
>
> I dont think I am acking until that point.
>
>
> On Tue, Mar 1, 2011 at 5:59 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>> Hi,
>>
>>
>> On 01/03/11 14:57, mysurf mail wrote:
>>
>>> Hi,
>>>
>>>
>>> I setup a trace at the client app server. Set the listen port and
>>> connection port and got a log for the unsuccessful
>>> factory.newConnection() . I added it in attached the tracelog.txt.
>>>
>>
>> This looks like a normal trace with a successful connection establishment,
>> and subsequent exchange and queue declarations. I would be surprised if the
>> broker logfile contained an abrupt connection failure at the corresponding
>> time. Can you please confirm? If possible please supply a trace of a case
>> where an error occurs.
>>
>>
>>  now regarding the other references you gave me
>>>
>>> 1 Protocol errors:
>>>  Acknowledging with an unknown delivery tag
>>>  Redeclaring exchanges with different parameters
>>>
>>> you recommended not acking more than once. This whole thing started when
>>> we upgraded the rabbitmq version and Matthias sujested we will change
>>> the consumer to ack (i.e. we changed it to
>>> channel.basicConsume(queueName, FALSE, queueingConsumer);)
>>> (This is if I understood him right )
>>> So How can I control the acking . How do I know if I ack more then once.
>>>
>>
>> This is more than a recommendation. From the specification:
>>
>>  "a client MUST not acknowledge the same message more than once."
>>
>> Check whether your client contains instances of "channel.basicAck". If you
>> acknowledge messages more than once you will see a channel exception.
>>
>>
>> Emile
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/456f74bf/attachment-0001.htm>

From stammailbox at gmail.com  Wed Mar  2 07:41:20 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 2 Mar 2011 09:41:20 +0200
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <AANLkTikSfe3aRT=dbEUWDc6dkXsmUmgcGYj_EbW9j_H1@mail.gmail.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
	<4D6BC078.8030600@rabbitmq.com>
	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>
	<4D6CC5D5.7090208@rabbitmq.com>
	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>
	<4D6CF797.4090305@rabbitmq.com>
	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>
	<4D6D17D1.6020902@rabbitmq.com>
	<AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>
	<AANLkTikSfe3aRT=dbEUWDc6dkXsmUmgcGYj_EbW9j_H1@mail.gmail.com>
Message-ID: <AANLkTim3tiKG4K+p23ms-qO00r66ojPk4A1m_=050mMK@mail.gmail.com>

Flash News :
I am sorry to bother you a lot this morning . But I have an interesting
finding
When I activate my client with the tracer - it connects well to the rabbitmq
server .
when I connect directly - it throws that exception .

So maybe my problem is with the connection string ?
here it is - I only replace the  ip and port
BasicChannel(Username, Password, VirtualHost, BrokerIp, BrokerPort,
Heartbeat);
BasicChannel(Username, Password, VirtualHost, "127.0.0.1",5672, Heartbeat);

and my ctor is

public BasicChannel(final String username, final String password,
final String virtualHost, final String brokerIp, final int brokerPort,
int heartbeat) {
        ConnectionFactory factory = new ConnectionFactory();
        factory.setUsername(username);
        factory.setPassword(password);
        factory.setVirtualHost(virtualHost);
        factory.setRequestedHeartbeat(heartbeat);
        factory.setHost(brokerIp);
        factory.setPort(brokerPort);

        connection = null;
        try {
            connection = factory.newConnection();
        } catch (IOException e) {
            throw new PlatformException("could not create connection", e);
        }



Thanks


On Wed, Mar 2, 2011 at 9:26 AM, mysurf mail <stammailbox at gmail.com> wrote:

> Sorry,
> I get PossibleAuthenticationFailureException
>
> PlatformException: could not create connection
> 	at com.programa17.mmm.modules.stopwatch.util.BasicChannel.<init>(BasicChannel.java:40)
> 	at com.programa17.mmm.modules.stopwatch.util.BasicChannel.<init>(BasicChannel.java:23)
> 	at com.programa17.mmm.modules.stopwatch.util.RabbitMQTest$Manager.<init>(RabbitMQTest.java:94)
> 	at com.programa17.mmm.modules.stopwatch.util.RabbitMQTest.test1(RabbitMQTest.java:22)
> 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
> 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
> 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
> 	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
> 	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
> 	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
> 	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
> 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)
> 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
> 	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
> 	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
> 	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
> 	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
> 	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
> 	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
> 	at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
> 	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:65)
> Caused by: com.rabbitmq.client.PossibleAuthenticationFailureException: Possibly caused by authentication failure
> 	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:289)
> 	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:383)
> 	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:403)
> 	at com.programa17.mmm.modules.stopwatch.util.BasicChannel.<init>(BasicChannel.java:38)
> 	... 23 more
> Caused by: com.rabbitmq.client.AlreadyClosedException: clean connection shutdown; reason: Attempt to use closed channel
> 	at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:181)
> 	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:208)
> 	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:194)
> 	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:281)
> 	... 26 more
>
>
> On Wed, Mar 2, 2011 at 9:01 AM, mysurf mail <stammailbox at gmail.com> wrote:
>
>> Ok,
>> I will repeat my test results fully .
>> It happens only from certain computers.
>> It usually throws an exception when the command
>> factory.newConnection() is invoked.
>> the exception is ConnectionException. I have it in the initial mail of
>> this thread.
>> ( I can telnet that port. I can connect from other computers. I can
>> connect to it with 1.7.0 clients )
>>
>> I dont think I am acking until that point.
>>
>>
>> On Tue, Mar 1, 2011 at 5:59 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>>
>>> Hi,
>>>
>>>
>>> On 01/03/11 14:57, mysurf mail wrote:
>>>
>>>> Hi,
>>>>
>>>>
>>>> I setup a trace at the client app server. Set the listen port and
>>>> connection port and got a log for the unsuccessful
>>>> factory.newConnection() . I added it in attached the tracelog.txt.
>>>>
>>>
>>> This looks like a normal trace with a successful connection
>>> establishment, and subsequent exchange and queue declarations. I would be
>>> surprised if the broker logfile contained an abrupt connection failure at
>>> the corresponding time. Can you please confirm? If possible please supply a
>>> trace of a case where an error occurs.
>>>
>>>
>>>  now regarding the other references you gave me
>>>>
>>>> 1 Protocol errors:
>>>>  Acknowledging with an unknown delivery tag
>>>>  Redeclaring exchanges with different parameters
>>>>
>>>> you recommended not acking more than once. This whole thing started when
>>>> we upgraded the rabbitmq version and Matthias sujested we will change
>>>> the consumer to ack (i.e. we changed it to
>>>> channel.basicConsume(queueName, FALSE, queueingConsumer);)
>>>> (This is if I understood him right )
>>>> So How can I control the acking . How do I know if I ack more then once.
>>>>
>>>
>>> This is more than a recommendation. From the specification:
>>>
>>>  "a client MUST not acknowledge the same message more than once."
>>>
>>> Check whether your client contains instances of "channel.basicAck". If
>>> you acknowledge messages more than once you will see a channel exception.
>>>
>>>
>>> Emile
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/c6d31058/attachment.htm>

From matthias at rabbitmq.com  Wed Mar  2 08:10:37 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 02 Mar 2011 08:10:37 +0000
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D6D8681.3080608@rabbitmq.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru> <4D6CC571.8020108@rabbitmq.com>
	<590471299006811@web28.yandex.ru> <4D6D4EC3.4000705@rabbitmq.com>
	<627461299012614@web31.yandex.ru>
	<4D6D5E00.9010909@rabbitmq.com> <64901299014535@web1.yandex.ru>
	<4D6D6551.4020808@rabbitmq.com>
	<636111299017601@web19.yandex.ru> <4D6D70F4.80909@rabbitmq.com>
	<638441299019501@web8.yandex.ru> <4D6D8681.3080608@rabbitmq.com>
Message-ID: <4D6DFB7D.9060401@rabbitmq.com>

Matthias Radestock wrote:
> Anyway, next step is to look at some traces.

Actually, you could try something simpler first. Run

rabbitmqctl list_connections peer_address peer_port state send_oct 
send_cnt send_pend

Identify the worker connections (shouldn't be hard since you said they 
are all local) and check on the send_* counts. Keep running that command 
every few seconds. You should see the send_oct and send_cnt going up, 
indicating that the server is sending messages to the worker. And 
send_pend should generally be 0, with the occasional blip.

When the system gets into the problematic state where you think workers 
are no longer receiving messages, repeat the above and check whether any 
of the counts have stopped moving.

Regards,

Matthias.

From jiri at krutil.com  Wed Mar  2 09:02:17 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Wed, 02 Mar 2011 10:02:17 +0100
Subject: [rabbitmq-discuss] Message returned as unroutable even if consumer
	is listening
Message-ID: <20110302100217.19874p7t6ai1x02s@webmail.active24.cz>

Hi

We are seeing some strange behaviour consistently after installing the  
2.3.1 broker on a new linux box (which did not occur yet elsewhere).

In our simple P2P setup, a client is sending messages to a server:

CLIENT -> exchange "request.CLIENT" -> queue "request" -> SERVER

We have two 2.3.1 Java client connections:
- connection SERVER is consuming from queue "request"
- connection CLIENT is sending messages to exchange "request.CLIENT"  
with routing key "request" with the immediate flag set

The queue "request" is bound to direct exchange "request.CLIENT" using  
binding key "request".

The problem is that all messages sent by CLIENT are returned by the  
broker as unroutable, even if we see a consumer listening on the  
target queue, which we believe is ready to consume messages.

Any ideas what to look at?



Excerpt from list_connections:
CLIENT  127.0.0.1   49963   running
SERVER  127.0.0.1   51526   running

Excerpt from list_channels:
<rabbit at PC14599.2.12386.23>     CLIENT      false   1       0
<rabbit at PC14599.2.12398.23>     CLIENT      false   1       0
<rabbit at PC14599.2.16100.23>     SERVER      false   1       0
<rabbit at PC14599.2.16103.23>     SERVER      false   0       0

Excerpt from list_exchanges:
request.CLIENT  direct

Excerpt from list_bindings:
request.CLIENT  exchange    request queue   request []

Excerpt from list_consumers:
request <rabbit at PC14599.2.16100.23> amq.ctag-/CYAYqR2c2xZxT2N8kSZTQ==   true


From rtrlists at googlemail.com  Wed Mar  2 09:06:26 2011
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 2 Mar 2011 09:06:26 +0000
Subject: [rabbitmq-discuss] can I set databse name in the configuration
 file to override default hostname value
In-Reply-To: <20110302002523.GA6255@wellquite.org>
References: <122281202.297911.1299022711365.JavaMail.root@mail6.gatech.edu>
	<1897139896.297986.1299022926373.JavaMail.root@mail6.gatech.edu>
	<20110302002523.GA6255@wellquite.org>
Message-ID: <AANLkTinzuRpnF_62e47yW-4utQuOjBq0R50rAZToRGTx@mail.gmail.com>

On Wed, Mar 2, 2011 at 12:25 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Tue, Mar 01, 2011 at 06:42:06PM -0500, Pendleton, Gordon P wrote:
> > I am having trouble figuring out how to configure RabbitMQ to use a value
> other than the server hostname when naming the database file it uses.  I am
> using amazon ec2 so hostname changes every time an instance is started.
>  Because of this, I need to be able to set the name in a configuration file.
>  I can't find a list of configuration options so can someone tell me how to
> do this and which configuration file I should be using (I read there are
> two)?
>
>
> You can set the env var RABBITMQ_NODENAME or set NODENAME in
> /etc/rabbitmq/rabbitmq.conf
>
>
If you're not doing any clustering and know that you will pretty much only
ever use the one instance, your can name it "localhost" and that'll make it
run on any machine. It's a bit of a shortcut if you know that you won't be
needing any Erlang style distribution anytime soon.

As soon as distributed nodes need to talk, you have to set it up properly.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/40405353/attachment-0001.htm>

From helf at hundsun.com  Wed Mar  2 09:05:33 2011
From: helf at hundsun.com (helf)
Date: Wed, 2 Mar 2011 17:05:33 +0800
Subject: [rabbitmq-discuss] Failed to build rabbitmq-server on an aix6.1
	system
Message-ID: <009001cbd8b8$fce15900$f6a40b00$@hundsun.com>

Hi,

 

Do you build the rabbitmq-server from source code on aix system
successfully? If yes, could you please share your invaluable experience?

 

I used "rabbitmq-server-generic-unix-2.3.1.tar.gz" on my aix system at
first, but it crashed during my testing. Thus, I would like to build it from
source code, but failed. 

 

Erlang R14B and rabbitmq-server-2.3.1. 

 

After I type "make" command, there will be a core dump caused by xsltproc
operation. And the "rabbit_ctl_usage.erl" is empty.

 

Below is the output:

 

bash-4.1# cd rabbitmq-server-2.3.1

bash-4.1# ls -rlt

total 256

drwxr-xr-x    2 root     system         4096 Feb  3 20:47 src

drwxr-xr-x    2 root     system         4096 Feb  3 20:47 include

-rw-r--r--    1 root     system        24891 Feb  3 20:47
LICENSE-MPL-RabbitMQ

-rw-r--r--    1 root     system          195 Feb  3 20:47 LICENSE

drwxr-xr-x    2 root     system          256 Feb  3 20:47 scripts

-rw-r--r--    1 root     system         2494 Feb  3 20:47 generate_deps

-rw-r--r--    1 root     system          494 Feb  3 20:47 generate_app

drwxr-xr-x    2 root     system          256 Feb  3 20:47 ebin

drwxr-xr-x    2 root     system         4096 Feb  3 20:47 docs

-rw-r--r--    1 root     system        18549 Feb  3 20:47 codegen.py

drwxr-xr-x    2 root     system         4096 Feb  3 20:47 codegen

-rwxr-xr-x    1 root     system         1719 Feb  3 20:47 calculate-relative

-rw-r--r--    1 root     system         3239 Feb  3 20:47 README

-rw-r--r--    1 root     system        11284 Feb  3 20:47 Makefile

-rw-r--r--    1 root     system        30654 Feb  3 20:47 INSTALL

bash-4.1# make

python codegen.py body codegen/amqp-rabbitmq-0.9.1.json
src/rabbit_framing_amqp_0_9_1.erl 

python codegen.py body codegen/amqp-rabbitmq-0.8.json
src/rabbit_framing_amqp_0_8.erl 

xsltproc --stringparam modulename "`basename src/rabbit_ctl_usage.erl .erl`"
\

                docs/usage.xsl docs/rabbitmqctl.1.xml >
src/rabbit_ctl_usage.erl.tmp

make: *** No rule to make target `deps.mk', needed by `ebin/bpqueue.beam'.
Stop.

bash-4.1# ls -lrt

total 3104

drwxr-xr-x    2 root     system         4096 Feb  3 20:47 include

-rw-r--r--    1 root     system        24891 Feb  3 20:47
LICENSE-MPL-RabbitMQ

-rw-r--r--    1 root     system          195 Feb  3 20:47 LICENSE

drwxr-xr-x    2 root     system          256 Feb  3 20:47 scripts

-rw-r--r--    1 root     system         2494 Feb  3 20:47 generate_deps

-rw-r--r--    1 root     system          494 Feb  3 20:47 generate_app

drwxr-xr-x    2 root     system          256 Feb  3 20:47 ebin

drwxr-xr-x    2 root     system         4096 Feb  3 20:47 docs

-rw-r--r--    1 root     system        18549 Feb  3 20:47 codegen.py

-rwxr-xr-x    1 root     system         1719 Feb  3 20:47 calculate-relative

-rw-r--r--    1 root     system         3239 Feb  3 20:47 README

-rw-r--r--    1 root     system        11284 Feb  3 20:47 Makefile

-rw-r--r--    1 root     system        30654 Feb  3 20:47 INSTALL

drwxr-xr-x    2 root     system         4096 Mar  2 16:06 codegen

drwxr-xr-x    2 root     system         8192 Mar  2 16:06 src

-rw-------    1 root     system      1451907 Mar  2 16:06 core

bash-4.1#

bash-4.1# ls -lrt src/rabbit_ctl_usage.erl*

-rw-r--r--    1 root     system            0 Mar  2 16:06
src/rabbit_ctl_usage.erl.tmp

bash-4.1#

bash-4.1# make -v

GNU Make 3.81

Copyright (C) 2006  Free Software Foundation, Inc.

This is free software; see the source for copying conditions.

There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE.

 

This program built for powerpc-ibm-aix5.2.0.0

bash-4.1#

 

 

Your reply will be appreciated!

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/fe286b1d/attachment.htm>

From stammailbox at gmail.com  Wed Mar  2 09:41:14 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 2 Mar 2011 11:41:14 +0200
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <AANLkTim3tiKG4K+p23ms-qO00r66ojPk4A1m_=050mMK@mail.gmail.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
	<4D6BC078.8030600@rabbitmq.com>
	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>
	<4D6CC5D5.7090208@rabbitmq.com>
	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>
	<4D6CF797.4090305@rabbitmq.com>
	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>
	<4D6D17D1.6020902@rabbitmq.com>
	<AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>
	<AANLkTikSfe3aRT=dbEUWDc6dkXsmUmgcGYj_EbW9j_H1@mail.gmail.com>
	<AANLkTim3tiKG4K+p23ms-qO00r66ojPk4A1m_=050mMK@mail.gmail.com>
Message-ID: <AANLkTim8TzRqEdQ2ejBObK_y4YFrTVVax84CoDCUncnq@mail.gmail.com>

We debugged the tracer and saw that it uses java.net.socket. The connection
was ok through the tracer.
Now,  we closed the tracer and connected directly to the rabbit.
We  attached the source and debugged factory.newconnmection() we saw the
exception occured in DataInputStream.readUnsignedByte() . (it throws an
EOFException when ch<0) .
any ideas?

On Wed, Mar 2, 2011 at 9:41 AM, mysurf mail <stammailbox at gmail.com> wrote:

> Flash News :
> I am sorry to bother you a lot this morning . But I have an interesting
> finding
> When I activate my client with the tracer - it connects well to the
> rabbitmq server .
> when I connect directly - it throws that exception .
>
> So maybe my problem is with the connection string ?
> here it is - I only replace the  ip and port
> BasicChannel(Username, Password, VirtualHost, BrokerIp, BrokerPort,
> Heartbeat);
> BasicChannel(Username, Password, VirtualHost, "127.0.0.1",5672, Heartbeat);
>
> and my ctor is
>
> public BasicChannel(final String username, final String password, final String virtualHost, final String brokerIp, final int brokerPort, int heartbeat) {
>         ConnectionFactory factory = new ConnectionFactory();
>         factory.setUsername(username);
>         factory.setPassword(password);
>         factory.setVirtualHost(virtualHost);
>         factory.setRequestedHeartbeat(heartbeat);
>         factory.setHost(brokerIp);
>         factory.setPort(brokerPort);
>
>         connection = null;
>         try {
>             connection = factory.newConnection();
>         } catch (IOException e) {
>             throw new PlatformException("could not create connection", e);
>         }
>
>
>
> Thanks
>
>
> On Wed, Mar 2, 2011 at 9:26 AM, mysurf mail <stammailbox at gmail.com> wrote:
>
>> Sorry,
>> I get PossibleAuthenticationFailureException
>>
>> PlatformException: could not create connection
>> 	at com.programa17.mmm.modules.stopwatch.util.BasicChannel.<init>(BasicChannel.java:40)
>> 	at com.programa17.mmm.modules.stopwatch.util.BasicChannel.<init>(BasicChannel.java:23)
>> 	at com.programa17.mmm.modules.stopwatch.util.RabbitMQTest$Manager.<init>(RabbitMQTest.java:94)
>> 	at com.programa17.mmm.modules.stopwatch.util.RabbitMQTest.test1(RabbitMQTest.java:22)
>> 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
>> 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
>> 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
>> 	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
>> 	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
>> 	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
>> 	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
>> 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)
>> 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
>> 	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
>> 	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
>> 	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
>> 	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
>> 	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
>> 	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
>> 	at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
>> 	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:65)
>> Caused by: com.rabbitmq.client.PossibleAuthenticationFailureException: Possibly caused by authentication failure
>> 	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:289)
>> 	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:383)
>> 	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:403)
>> 	at com.programa17.mmm.modules.stopwatch.util.BasicChannel.<init>(BasicChannel.java:38)
>> 	... 23 more
>> Caused by: com.rabbitmq.client.AlreadyClosedException: clean connection shutdown; reason: Attempt to use closed channel
>> 	at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:181)
>> 	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:208)
>> 	at com.rabbitmq.client.impl.AMQChannel.rpc(AMQChannel.java:194)
>> 	at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:281)
>> 	... 26 more
>>
>>
>> On Wed, Mar 2, 2011 at 9:01 AM, mysurf mail <stammailbox at gmail.com>wrote:
>>
>>> Ok,
>>> I will repeat my test results fully .
>>> It happens only from certain computers.
>>> It usually throws an exception when the command
>>> factory.newConnection() is invoked.
>>> the exception is ConnectionException. I have it in the initial mail of
>>> this thread.
>>> ( I can telnet that port. I can connect from other computers. I can
>>> connect to it with 1.7.0 clients )
>>>
>>> I dont think I am acking until that point.
>>>
>>>
>>> On Tue, Mar 1, 2011 at 5:59 PM, Emile Joubert <emile at rabbitmq.com>wrote:
>>>
>>>> Hi,
>>>>
>>>>
>>>> On 01/03/11 14:57, mysurf mail wrote:
>>>>
>>>>> Hi,
>>>>>
>>>>>
>>>>> I setup a trace at the client app server. Set the listen port and
>>>>> connection port and got a log for the unsuccessful
>>>>> factory.newConnection() . I added it in attached the tracelog.txt.
>>>>>
>>>>
>>>> This looks like a normal trace with a successful connection
>>>> establishment, and subsequent exchange and queue declarations. I would be
>>>> surprised if the broker logfile contained an abrupt connection failure at
>>>> the corresponding time. Can you please confirm? If possible please supply a
>>>> trace of a case where an error occurs.
>>>>
>>>>
>>>>  now regarding the other references you gave me
>>>>>
>>>>> 1 Protocol errors:
>>>>>  Acknowledging with an unknown delivery tag
>>>>>  Redeclaring exchanges with different parameters
>>>>>
>>>>> you recommended not acking more than once. This whole thing started
>>>>> when
>>>>> we upgraded the rabbitmq version and Matthias sujested we will change
>>>>> the consumer to ack (i.e. we changed it to
>>>>> channel.basicConsume(queueName, FALSE, queueingConsumer);)
>>>>> (This is if I understood him right )
>>>>> So How can I control the acking . How do I know if I ack more then
>>>>> once.
>>>>>
>>>>
>>>> This is more than a recommendation. From the specification:
>>>>
>>>>  "a client MUST not acknowledge the same message more than once."
>>>>
>>>> Check whether your client contains instances of "channel.basicAck". If
>>>> you acknowledge messages more than once you will see a channel exception.
>>>>
>>>>
>>>> Emile
>>>>
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/f60f2919/attachment-0001.htm>

From vertolet666 at yandex.ru  Wed Mar  2 09:42:03 2011
From: vertolet666 at yandex.ru (DOBRO Sergei)
Date: Wed, 02 Mar 2011 12:42:03 +0300
Subject: [rabbitmq-discuss] Losing messages, why?
In-Reply-To: <4D6DFB7D.9060401@rabbitmq.com>
References: <30958766.post@talk.nabble.com>
	<4D604FD7.6030307@rabbitmq.com>	<30989184.post@talk.nabble.com>	<0DF5FD86-F4CA-496A-BA85-029A95689507@vmware.com>	<30990022.post@talk.nabble.com>	<F78BCF638F95D74A99D036114107EDB5023948CF4F@EXCH-MBX-3.vmware.com>	<31018690.post@talk.nabble.com>
	<31019159.post@talk.nabble.com> <4D6BBB8B.2000707@rabbitmq.com>
	<36051298913090@web35.yandex.ru> <4D6BDA93.8060206@rabbitmq.com>
	<91131298924006@web116.yandex.ru> <4D6C9EAB.6070708@rabbitmq.com>
	<295551298973551@web84.yandex.ru> <4D6CC571.8020108@rabbitmq.com>
	<590471299006811@web28.yandex.ru> <4D6D4EC3.4000705@rabbitmq.com>
	<627461299012614@web31.yandex.ru>
	<4D6D5E00.9010909@rabbitmq.com> <64901299014535@web1.yandex.ru>
	<4D6D6551.4020808@rabbitmq.com>
	<636111299017601@web19.yandex.ru> <4D6D70F4.80909@rabbitmq.com>
	<638441299019501@web8.yandex.ru>
	<4D6D8681.3080608@rabbitmq.com> <4D6DFB7D.9060401@rabbitmq.com>
Message-ID: <788881299058923@web119.yandex.ru>


02.03.2011, 11:10, "Matthias Radestock" <matthias at rabbitmq.com>:
> Matthias Radestock wrote:
>
>> ?Anyway, next step is to look at some traces.
>
> Actually, you could try something simpler first. Run
>
> rabbitmqctl list_connections peer_address peer_port state send_oct
> send_cnt send_pend
>
> Identify the worker connections (shouldn't be hard since you said they
> are all local) and check on the send_* counts. Keep running that command
> every few seconds. You should see the send_oct and send_cnt going up,
> indicating that the server is sending messages to the worker. And
> send_pend should generally be 0, with the occasional blip.
>
> When the system gets into the problematic state where you think workers
> are no longer receiving messages, repeat the above and check whether any
> of the counts have stopped moving.
>

Matthias,

Your help is very appreciated. As soon as I encounter with that state, I will post a report according to your advise.

Thanks a lot.

DOBRO.

From emile at rabbitmq.com  Wed Mar  2 10:19:23 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 02 Mar 2011 10:19:23 +0000
Subject: [rabbitmq-discuss] Failed to build rabbitmq-server on an aix6.1
 system
In-Reply-To: <009001cbd8b8$fce15900$f6a40b00$@hundsun.com>
References: <009001cbd8b8$fce15900$f6a40b00$@hundsun.com>
Message-ID: <4D6E19AB.3050109@rabbitmq.com>


Hi helf,

On 02/03/11 09:05, helf wrote:
> make: *** No rule to make target `deps.mk', needed by
> `ebin/bpqueue.beam'.  Stop.


The deps.mk file does have a rule in the Makefile and it is generated by 
the generate_deps escript. I can confirm that this does work correctly 
(at least on AIX 5.3).

I would suggest that you first try to compile RabbitMQ on another 
platform (e.g. Linux). This will show you what to expect when compiling. 
It might be easiest to download and extract the latest generic unix 
release from http://www.rabbitmq.com/server.html and use that on AIX, 
assuming you have a working Erlang.


Regards

Emile

From emile at rabbitmq.com  Wed Mar  2 10:45:44 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 02 Mar 2011 10:45:44 +0000
Subject: [rabbitmq-discuss] Maximum Frame Setting Not Working
In-Reply-To: <53c8ca88-bedc-482a-8311-04b3f540d083@w36g2000vbi.googlegroups.com>
References: <0c38630e-f53b-44fb-842f-6c0cc66ed545@k38g2000vbn.googlegroups.com>	<4D6CBE23.8020902@rabbitmq.com>
	<53c8ca88-bedc-482a-8311-04b3f540d083@w36g2000vbi.googlegroups.com>
Message-ID: <4D6E1FD8.6010306@rabbitmq.com>


Hi Rom,

On 02/03/11 02:14, Rom wrote:
> Hi Emile,
>
> Thank you for the clarification. I did see this error in the log file.
> I'm exploring rabbitmq to be our messaging platform that handles heavy
> and very light payloads. There might be a node that will be dedicated
> to processing mobile data which is very light and so I was thinking
> that it might be a good idea to reduce the default frame size. Just a
> thought.

The setRequestedFrameMax() method negotiates the *maximum* frame size, 
not the default. AMQP peers may exchange tiny frames containing tiny 
payloads, even at the default framemax of 128Kb.

Setting the framemax to the lowest allowed value (4Kb) will reduce 
throughput if this causes fragmentation for a significant proportion of 
messages. Latency might be slightly better though. Benchmarking is 
suggested.

> Seems like the way to achieve that customized default behavior on the
> frame size is to make changes to the rabbitmq.config file but I'm not
> well familiar with the erl style configuration and the available
> properties. Do you know of any references I could take a look at?

There are no broker config variables that control frame size. AMQP is 
already a very slim protocol. You don't need any further configuration 
to take advantage of this!


Regards

Emile

From emile at rabbitmq.com  Wed Mar  2 11:01:07 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 02 Mar 2011 11:01:07 +0000
Subject: [rabbitmq-discuss] socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <AANLkTim8TzRqEdQ2ejBObK_y4YFrTVVax84CoDCUncnq@mail.gmail.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>	<4D6BC078.8030600@rabbitmq.com>	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>	<4D6CC5D5.7090208@rabbitmq.com>	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>	<4D6CF797.4090305@rabbitmq.com>	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>	<4D6D17D1.6020902@rabbitmq.com>	<AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>	<AANLkTikSfe3aRT=dbEUWDc6dkXsmUmgcGYj_EbW9j_H1@mail.gmail.com>	<AANLkTim3tiKG4K+p23ms-qO00r66ojPk4A1m_=050mMK@mail.gmail.com>
	<AANLkTim8TzRqEdQ2ejBObK_y4YFrTVVax84CoDCUncnq@mail.gmail.com>
Message-ID: <4D6E2373.9050508@rabbitmq.com>


Hi,

It is very strange to see an AMQP connection work perfectly via the 
tracer but fail without it.

(Does the broker listen on the same port in both cases? If not, does the 
underlying network treat both ports the same?)

Can you replicate these results with any of the built-in Java examples 
that are provided with RabbitMQ? I would suggest using the MulticastMain 
tool with and without the Tracer. This will eliminate the possibility of 
AMQP protocol errors causing the problem.

 > DataInputStream.readUnsignedByte()
This is not the cause of the problem. It probably just means that the 
underlying connection has been forcefully closed.

 > It happens only from certain computers.
Do these computers have anything in common with each other that they do 
not have in common with the computers that don't produce errors?



-Emile


On 02/03/11 09:41, mysurf mail wrote:
>
> We debugged the tracer and saw that it uses java.net.socket. The
> connection was ok through the tracer.
> Now,  we closed the tracer and connected directly to the rabbit.
> We  attached the source and debugged factory.newconnmection() we saw the
> exception occured in DataInputStream.readUnsignedByte() . (it throws an
> EOFException when ch<0) .
> any ideas?
>
> On Wed, Mar 2, 2011 at 9:41 AM, mysurf mail <stammailbox at gmail.com
> <mailto:stammailbox at gmail.com>> wrote:
>
>     Flash News :
>     I am sorry to bother you a lot this morning . But I have an
>     interesting finding
>     When I activate my client with the tracer - it connects well to the
>     rabbitmq server .
>     when I connect directly - it throws that exception .
>
>     So maybe my problem is with the connection string ?
>     here it is - I only replace the  ip and port
>     BasicChannel(Username, Password, VirtualHost, BrokerIp, BrokerPort,
>     Heartbeat);
>     BasicChannel(Username, Password, VirtualHost, "127.0.0.1",5672,
>     Heartbeat);
>
>     and my ctor is
>
>     public BasicChannel(final String username, final String password, final String virtualHost, final String brokerIp, final int brokerPort, int heartbeat) {
>              ConnectionFactory factory = new ConnectionFactory();
>              factory.setUsername(username);
>              factory.setPassword(password);
>              factory.setVirtualHost(virtualHost);
>              factory.setRequestedHeartbeat(heartbeat);
>              factory.setHost(brokerIp);
>              factory.setPort(brokerPort);
>
>              connection = null;
>              try {
>                  connection = factory.newConnection();
>              } catch (IOException e) {
>                  throw new PlatformException("could not create connection", e);
>              }
>
>
>
>     Thanks

From stammailbox at gmail.com  Wed Mar  2 12:38:36 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 2 Mar 2011 14:38:36 +0200
Subject: [rabbitmq-discuss] Fwd: socket error while using rabbitmq and a NAT
 (Network address translation)
In-Reply-To: <AANLkTikM2Tinf0qbpbOrJGbXzJHpCfZzLk_QHh3K5Lb0@mail.gmail.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
	<4D6BC078.8030600@rabbitmq.com>
	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>
	<4D6CC5D5.7090208@rabbitmq.com>
	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>
	<4D6CF797.4090305@rabbitmq.com>
	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>
	<4D6D17D1.6020902@rabbitmq.com>
	<AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>
	<AANLkTikSfe3aRT=dbEUWDc6dkXsmUmgcGYj_EbW9j_H1@mail.gmail.com>
	<AANLkTim3tiKG4K+p23ms-qO00r66ojPk4A1m_=050mMK@mail.gmail.com>
	<AANLkTim8TzRqEdQ2ejBObK_y4YFrTVVax84CoDCUncnq@mail.gmail.com>
	<4D6E2373.9050508@rabbitmq.com>
	<AANLkTikM2Tinf0qbpbOrJGbXzJHpCfZzLk_QHh3K5Lb0@mail.gmail.com>
Message-ID: <AANLkTikV54+1bcF0YwvykV40fU8B4WrCTC_DXBnqvnpm@mail.gmail.com>

Hi,
I ran the multicast main . from the computer with the good connection it
seemed to work.
from the computer with the bad connection - it seemed to not work.

I was seconds away from taking this to the IT , but then I remembered that
both computes run the RabbitMQ client 1.7.0 successfully .

Maybe you can tell me what changed in the implementation of the 2.3.1 or the
erlang??

I am adding the output file for the multicast. it has outputs from both
computers.

I really appreciate your help. I hope this will resolve soon as we are in a
mess currently in the production system.
Thanks.


On Wed, Mar 2, 2011 at 1:01 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> It is very strange to see an AMQP connection work perfectly via the tracer
> but fail without it.
>
> (Does the broker listen on the same port in both cases? If not, does the
> underlying network treat both ports the same?)
>
> Can you replicate these results with any of the built-in Java examples that
> are provided with RabbitMQ? I would suggest using the MulticastMain tool
> with and without the Tracer. This will eliminate the possibility of AMQP
> protocol errors causing the problem.
>
> > DataInputStream.readUnsignedByte()
> This is not the cause of the problem. It probably just means that the
> underlying connection has been forcefully closed.
>
>
> > It happens only from certain computers.
> Do these computers have anything in common with each other that they do not
> have in common with the computers that don't produce errors?
>
>
>
> -Emile
>
>
>
> On 02/03/11 09:41, mysurf mail wrote:
>
>>
>> We debugged the tracer and saw that it uses java.net.socket. The
>> connection was ok through the tracer.
>> Now,  we closed the tracer and connected directly to the rabbit.
>> We  attached the source and debugged factory.newconnmection() we saw the
>> exception occured in DataInputStream.readUnsignedByte() . (it throws an
>> EOFException when ch<0) .
>> any ideas?
>>
>> On Wed, Mar 2, 2011 at 9:41 AM, mysurf mail <stammailbox at gmail.com
>> <mailto:stammailbox at gmail.com>> wrote:
>>
>>    Flash News :
>>    I am sorry to bother you a lot this morning . But I have an
>>    interesting finding
>>    When I activate my client with the tracer - it connects well to the
>>    rabbitmq server .
>>    when I connect directly - it throws that exception .
>>
>>    So maybe my problem is with the connection string ?
>>    here it is - I only replace the  ip and port
>>    BasicChannel(Username, Password, VirtualHost, BrokerIp, BrokerPort,
>>    Heartbeat);
>>    BasicChannel(Username, Password, VirtualHost, "127.0.0.1",5672,
>>    Heartbeat);
>>
>>    and my ctor is
>>
>>    public BasicChannel(final String username, final String password, final
>> String virtualHost, final String brokerIp, final int brokerPort, int
>> heartbeat) {
>>             ConnectionFactory factory = new ConnectionFactory();
>>             factory.setUsername(username);
>>             factory.setPassword(password);
>>             factory.setVirtualHost(virtualHost);
>>             factory.setRequestedHeartbeat(heartbeat);
>>             factory.setHost(brokerIp);
>>             factory.setPort(brokerPort);
>>
>>             connection = null;
>>             try {
>>                 connection = factory.newConnection();
>>             } catch (IOException e) {
>>                 throw new PlatformException("could not create connection",
>> e);
>>             }
>>
>>
>>
>>    Thanks
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/4399b363/attachment.htm>
-------------- next part --------------
GoodComputer

C:\workspace\thirdparty\rabbitmq\rabbitmq-java-client-bin-2.3.1>runjava com.rabbitmq.e
starting consumer #0
starting producer #0
recving rate: 0 msg/s, min/avg/max latency: 4744/4744/4744 microseconds
sending rate: 16186 msg/s
recving rate: 11764 msg/s, min/avg/max latency: 1598/124824/277785 microseconds
recving rate: 10631 msg/s, min/avg/max latency: 267152/462700/609950 microseconds
sending rate: 16116 msg/s
sending rate: 16950 msg/s
recving rate: 11096 msg/s, min/avg/max latency: 607182/802149/941896 microseconds
sending rate: 16703 msg/s
recving rate: 11400 msg/s, min/avg/max latency: 937387/1117620/1270633 microseconds
recving rate: 11208 msg/s, min/avg/max latency: 1270782/1437044/1593934 microseconds
sending rate: 16596 msg/s
sending rate: 16562 msg/s
recving rate: 10827 msg/s, min/avg/max latency: 1593183/1797937/1986645 microseconds
recving rate: 11304 msg/s, min/avg/max latency: 1985082/2140123/2293316 microseconds
sending rate: 16652 msg/s
sending rate: 17220 msg/s
recving rate: 11227 msg/s, min/avg/max latency: 2290855/2443425/2622044 microseconds
sending rate: 16654 msg/s
recving rate: 10139 msg/s, min/avg/max latency: 2622215/2852111/3002576 microseconds
sending rate: 16555 msg/s
recving rate: 11057 msg/s, min/avg/max latency: 2995418/3177957/3362374 microseconds
sending rate: 17122 msg/s
recving rate: 11464 msg/s, min/avg/max latency: 3359459/3521971/3688621 microseconds
sending rate: 16755 msg/s
recving rate: 10929 msg/s, min/avg/max latency: 3687067/3868810/4061715 microseconds
sending rate: 16832 msg/s
recving rate: 9792 msg/s, min/avg/max latency: 4060436/4221286/4471434 microseconds
sending rate: 16683 msg/s
recving rate: 11018 msg/s, min/avg/max latency: 4471275/4637660/4818107 microseconds
sending rate: 16814 msg/s
recving rate: 11250 msg/s, min/avg/max latency: 4815837/4991481/5166424 microseconds
sending rate: 16994 msg/s
recving rate: 11511 msg/s, min/avg/max latency: 5158614/5312865/5484297 microseconds

BadComputer

C:\workspace\thirdparty\rabbitmq\rabbitmq-java-client-bin-2.3.1>runjava com.rabb
itmq.examples.MulticastMain -h 192.168.100.251 -p 1434  -e X1X1X1X1
starting consumer #0

From emile at rabbitmq.com  Wed Mar  2 12:55:25 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 02 Mar 2011 12:55:25 +0000
Subject: [rabbitmq-discuss] Fwd: socket error while using rabbitmq and a
 NAT (Network address translation)
In-Reply-To: <AANLkTikV54+1bcF0YwvykV40fU8B4WrCTC_DXBnqvnpm@mail.gmail.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>	<4D6BC078.8030600@rabbitmq.com>	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>	<4D6CC5D5.7090208@rabbitmq.com>	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>	<4D6CF797.4090305@rabbitmq.com>	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>	<4D6D17D1.6020902@rabbitmq.com>	<AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>	<AANLkTikSfe3aRT=dbEUWDc6dkXsmUmgcGYj_EbW9j_H1@mail.gmail.com>	<AANLkTim3tiKG4K+p23ms-qO00r66ojPk4A1m_=050mMK@mail.gmail.com>	<AANLkTim8TzRqEdQ2ejBObK_y4YFrTVVax84CoDCUncnq@mail.gmail.com>	<4D6E2373.9050508@rabbitmq.com>	<AANLkTikM2Tinf0qbpbOrJGbXzJHpCfZzLk_QHh3K5Lb0@mail.gmail.com>
	<AANLkTikV54+1bcF0YwvykV40fU8B4WrCTC_DXBnqvnpm@mail.gmail.com>
Message-ID: <4D6E3E3D.3020008@rabbitmq.com>

On 02/03/11 12:38, mysurf mail wrote:
>
> Hi,
> I ran the multicast main . from the computer with the good connection it
> seemed to work.
> from the computer with the bad connection - it seemed to not work.
>
> I was seconds away from taking this to the IT , but then I remembered
> that both computes run the RabbitMQ client 1.7.0 successfully .
>
> Maybe you can tell me what changed in the implementation of the 2.3.1 or
> the erlang??

The release notes should contain this information. You can get these 
from the rabbitmq-announce mailing list archives:

http://lists.rabbitmq.com/pipermail/rabbitmq-announce/

If version 1.7.0 worked, can you try to repeat the MulticastMain test, 
but using MulticastMain and client from the 1.7.0 release? You'll find 
it here:

http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.7.0/

> I am adding the output file for the multicast. it has outputs from both
> computers.

You have left out the full command issued on GoodComputer. Can you 
please supply this?

You should be aware that 1434 (UDP) is a registered port for MS SQL 
Server. Is there any reason why you are not using the default AMQP port 
(5672)? Can you try using port 5672?


Regards

Emile

From stammailbox at gmail.com  Wed Mar  2 13:25:23 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 2 Mar 2011 15:25:23 +0200
Subject: [rabbitmq-discuss] Fwd: socket error while using rabbitmq and a
 NAT (Network address translation)
In-Reply-To: <4D6E3E3D.3020008@rabbitmq.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
	<4D6BC078.8030600@rabbitmq.com>
	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>
	<4D6CC5D5.7090208@rabbitmq.com>
	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>
	<4D6CF797.4090305@rabbitmq.com>
	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>
	<4D6D17D1.6020902@rabbitmq.com>
	<AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>
	<AANLkTikSfe3aRT=dbEUWDc6dkXsmUmgcGYj_EbW9j_H1@mail.gmail.com>
	<AANLkTim3tiKG4K+p23ms-qO00r66ojPk4A1m_=050mMK@mail.gmail.com>
	<AANLkTim8TzRqEdQ2ejBObK_y4YFrTVVax84CoDCUncnq@mail.gmail.com>
	<4D6E2373.9050508@rabbitmq.com>
	<AANLkTikM2Tinf0qbpbOrJGbXzJHpCfZzLk_QHh3K5Lb0@mail.gmail.com>
	<AANLkTikV54+1bcF0YwvykV40fU8B4WrCTC_DXBnqvnpm@mail.gmail.com>
	<4D6E3E3D.3020008@rabbitmq.com>
Message-ID: <AANLkTin=N_n1vnohD0fKaPbnMLHMyQhb6K1FhTe1JkWD@mail.gmail.com>

1. multicast 1.7.0.
Ahh.. I was looking for the multicast of 1.7.0. we only kept the (rabbit
main jar).

Ok, I ran it on the computer with the bad 2.3.1. communication and it ran it
without a problem.
seemed fine. I added the output (in the 1.txt file ).

So, This computer runs multicast 1.7.0 and not 2.3.1. a riddle.

2. Commandline
you are right , I did  forget to add the cmdline of the bad computer. It is
identical in every computer because I created a batch file and copied it to
every computer.

3. 1.7.0. to 2.3.1. -
We decided on an emergency solution for the meanwhile - we run rabbitmq
2.3.1 server with 1.7.0. jars at the clients.
so far it seems ok. Are we expecting major problems?

4. SQLServer port.
We don't use it . we use my sql . I don't think it is the listening port
issue - because we are connecting via Tracer.

Thanks a bunch again
(Open Source FTW :-) ).

On Wed, Mar 2, 2011 at 2:55 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> On 02/03/11 12:38, mysurf mail wrote:
>
>>
>> Hi,
>> I ran the multicast main . from the computer with the good connection it
>> seemed to work.
>> from the computer with the bad connection - it seemed to not work.
>>
>> I was seconds away from taking this to the IT , but then I remembered
>> that both computes run the RabbitMQ client 1.7.0 successfully .
>>
>> Maybe you can tell me what changed in the implementation of the 2.3.1 or
>> the erlang??
>>
>
> The release notes should contain this information. You can get these from
> the rabbitmq-announce mailing list archives:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-announce/
>
> If version 1.7.0 worked, can you try to repeat the MulticastMain test, but
> using MulticastMain and client from the 1.7.0 release? You'll find it here:
>
> http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.7.0/
>
>
>  I am adding the output file for the multicast. it has outputs from both
>> computers.
>>
>
> You have left out the full command issued on GoodComputer. Can you please
> supply this?
>
> You should be aware that 1434 (UDP) is a registered port for MS SQL Server.
> Is there any reason why you are not using the default AMQP port (5672)? Can
> you try using port 5672?
>
>
> Regards
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/619962d4/attachment-0001.htm>
-------------- next part --------------
runjava com.rabbitmq.examples.MulticastMain -h 192.168.100.251 -p 1434  -e X1X1X1X1
starting consumer #0
starting producer #0
recving rate: 9181 msg/s, min/avg/max latency: 649/4119/21416 microseconds
sending rate: 10593 msg/s
recving rate: 11542 msg/s, min/avg/max latency: 684/4411/23102 microseconds
sending rate: 11622 msg/s
recving rate: 11485 msg/s, min/avg/max latency: 658/4310/22290 microseconds
sending rate: 11420 msg/s
recving rate: 11837 msg/s, min/avg/max latency: 683/4080/13151 microseconds
sending rate: 11761 msg/s
recving rate: 11328 msg/s, min/avg/max latency: 638/4442/27193 microseconds
sending rate: 11456 msg/s
recving rate: 7744 msg/s, min/avg/max latency: 691/16374/364184 microseconds
sending rate: 6152 msg/s
recving rate: 9992 msg/s, min/avg/max latency: 660/7694/537484 microseconds
sending rate: 11760 msg/s
recving rate: 11754 msg/s, min/avg/max latency: 663/4186/28967 microseconds
sending rate: 11882 msg/s
recving rate: 11863 msg/s, min/avg/max latency: 617/3938/17927 microseconds
sending rate: 11946 msg/s
recving rate: 11782 msg/s, min/avg/max latency: 610/4699/22992 microseconds
sending rate: 11900 msg/s



From Shixin.Song at markit.com  Wed Mar  2 13:43:35 2011
From: Shixin.Song at markit.com (Shixin Song)
Date: Wed, 2 Mar 2011 14:43:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ latency and message lost issue.
Message-ID: <C9265FDC5DBE6249ADFA9B769D3D2A170118E76F51@EUMSGMAIL001.markit.partners>

To whom it may concern,

I am testing RabbitMQ at this moment. I have installed rabbitmq server and developed C++ client library using rabbitmq C library.

I found out that RabbitMQ never drops the message which means it has 0 message loss. But in my case, the latency is much more important than the message loss. Some message loss is acceptable in order to limit the maximal message latency. Could any one inform me how to configure rabbitmq to let it drop some messages when the latency is too high or the queue is reached to a maximum value.

Best regards
Shixin

This e-mail, including accompanying communications and attachments, is strictly confidential and only for the intended recipient. Any retention, use or disclosure not expressly authorised by Markit is prohibited. This email is subject to all waivers and other terms at the following link: http://www.markit.com/en/about/legal/email-disclaimer.page

We have recently moved to our new head office located at Ropemaker Place, 25 Ropemaker Street, London, EC2Y 9LY.
Please visit http://www.markit.com/en/about/contact/contact-us.page? for contact information on our offices worldwide.

From fabiomargarido at gmail.com  Wed Mar  2 14:14:24 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Wed, 2 Mar 2011 11:14:24 -0300
Subject: [rabbitmq-discuss] Help defining appropriate queue model
Message-ID: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>

Hi there,
I'm about to use RabbitMQ in my first amqp project and am having a bit
of difficulty identifying the necessary queues and exchanges.
In our use case, there will be only one producer who publishes a
message to the broker. This message represents configuration data.
Then multiple consumers read the published configuration from the
broker during their startup process, so it shouldn't happen very
often. The message should remain in the queue after consumption so
that the following consumers are able to read it. When some
configuration data changes, the producer republishes it and alerts
(possibly through some other queue) the consumers, who then read the
configuration message again.
I know this question isn't exactly related to RabbitMQ, but reading
the AMQP spec didn't help much. Could anyone help me identify which
exchange types, queue and message parameters I need for this to work?
Thanks in advance.

Fabio.

From alexis at rabbitmq.com  Wed Mar  2 14:20:21 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 2 Mar 2011 14:20:21 +0000
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
Message-ID: <AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>

Fabio

The simplest way is probably as follows:

http://www.rabbitmq.com/tutorial-three-python.html

Note that each consumer has its own queue, which acts as a buffer on
behalf of that consumer.  The downside of this is a slow consumer may
get several configuration updates at once, so it will need to discard
the earlier ones but should act on the latest.

alexis


On Wed, Mar 2, 2011 at 2:14 PM, Fabio Margarido
<fabiomargarido at gmail.com> wrote:
> Hi there,
> I'm about to use RabbitMQ in my first amqp project and am having a bit
> of difficulty identifying the necessary queues and exchanges.
> In our use case, there will be only one producer who publishes a
> message to the broker. This message represents configuration data.
> Then multiple consumers read the published configuration from the
> broker during their startup process, so it shouldn't happen very
> often. The message should remain in the queue after consumption so
> that the following consumers are able to read it. When some
> configuration data changes, the producer republishes it and alerts
> (possibly through some other queue) the consumers, who then read the
> configuration message again.
> I know this question isn't exactly related to RabbitMQ, but reading
> the AMQP spec didn't help much. Could anyone help me identify which
> exchange types, queue and message parameters I need for this to work?
> Thanks in advance.
>
> Fabio.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From emile at rabbitmq.com  Wed Mar  2 14:21:55 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 02 Mar 2011 14:21:55 +0000
Subject: [rabbitmq-discuss] Fwd: socket error while using rabbitmq and a
 NAT (Network address translation)
In-Reply-To: <AANLkTin=N_n1vnohD0fKaPbnMLHMyQhb6K1FhTe1JkWD@mail.gmail.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>	<4D6BC078.8030600@rabbitmq.com>	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>	<4D6CC5D5.7090208@rabbitmq.com>	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>	<4D6CF797.4090305@rabbitmq.com>	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>	<4D6D17D1.6020902@rabbitmq.com>	<AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>	<AANLkTikSfe3aRT=dbEUWDc6dkXsmUmgcGYj_EbW9j_H1@mail.gmail.com>	<AANLkTim3tiKG4K+p23ms-qO00r66ojPk4A1m_=050mMK@mail.gmail.com>	<AANLkTim8TzRqEdQ2ejBObK_y4YFrTVVax84CoDCUncnq@mail.gmail.com>	<4D6E2373.9050508@rabbitmq.com>	<AANLkTikM2Tinf0qbpbOrJGbXzJHpCfZzLk_QHh3K5Lb0@mail.gmail.com>	<AANLkTikV54+1bcF0YwvykV40fU8B4WrCTC_DXBnqvnpm@mail.gmail.com>	<4D6E3E3D.3020008@rabbitmq.com>
	<AANLkTin=N_n1vnohD0fKaPbnMLHMyQhb6K1FhTe1JkWD@mail.gmail.com>
Message-ID: <4D6E5283.4060002@rabbitmq.com>


Hi,

On 02/03/11 13:25, mysurf mail wrote:
> 1. multicast 1.7.0.
> Ahh.. I was looking for the multicast of 1.7.0. we only kept the (rabbit
> main jar).
>
> Ok, I ran it on the computer with the bad 2.3.1. communication and it
> ran it without a problem.
> seemed fine. I added the output (in the 1.txt file ).
>
> So, This computer runs multicast 1.7.0 and not 2.3.1. a riddle.

You previously tried MulticastMain from version 2.3.1 with and without 
the tracer and you saw failures without the tracer. Is this correct?

Can you try running MulticastMain from version 1.7.0 with and without 
the tracer as well? From your description it doesn't sound like you have 
replicated the test in exactly the same way. You will need to use the 
tracer from the 1.7.0 release for this test.

Do you have any way of repeating this test with the client and server on 
the same LAN or on the same host, in order to eliminate the network as a 
cause of the problem? I'm assuming that all your tests are still 
traversing the NAT infrastructure.

Another option is to inspect a network traffic dump. We will need the 
binary capture file produced by wireshark or tcpdump to collect all 
traffic on the port you use for AMQP (1434 in your case) on the client 
and on the broker. Please don't send large binaries to the mailing list 
though. Rather place it somewhere where it can be retrieved from.

> 3. 1.7.0. to 2.3.1. -
> We decided on an emergency solution for the meanwhile - we run rabbitmq
> 2.3.1 server with 1.7.0. jars at the clients.
> so far it seems ok. Are we expecting major problems?

It is impossible to say without understanding the cause.




-Emile

From abhishek.kona at gmail.com  Wed Mar  2 14:42:59 2011
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 02 Mar 2011 20:12:59 +0530
Subject: [rabbitmq-discuss] RabbitMQ RoadMap
Message-ID: <4D6E5773.1080805@gmail.com>

Hey

Is there any URL where I can get to know the things the RabbitMQ team is 
working and what we can expect in the next few releases (and timelines).

This will be helpful for people to decide on using rabbitmq if case a 
feature is in the road map but not currently supported by rabbitmq.


Sorry, if I am missing the link.

-Abhishek Kona

From matthew at rabbitmq.com  Wed Mar  2 14:45:40 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 2 Mar 2011 14:45:40 +0000
Subject: [rabbitmq-discuss] RabbitMQ RoadMap
In-Reply-To: <4D6E5773.1080805@gmail.com>
References: <4D6E5773.1080805@gmail.com>
Message-ID: <20110302144539.GA31527@rabbitmq.com>

Hi,

On Wed, Mar 02, 2011 at 08:12:59PM +0530, Abhishek Kona wrote:
> Is there any URL where I can get to know the things the RabbitMQ
> team is working and what we can expect in the next few releases (and
> timelines).

Nope.

> This will be helpful for people to decide on using rabbitmq if case
> a feature is in the road map but not currently supported by
> rabbitmq.

Understood. A lot of our development is driven by user needs, so if
there are things you think are missing then please let us know and we
may adjust things as necessary. This flexibility is indeed one of the
reasons why we don't have a firm published roadmap.

Matthew

From alexis at rabbitmq.com  Wed Mar  2 14:58:08 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 2 Mar 2011 14:58:08 +0000
Subject: [rabbitmq-discuss] RabbitMQ RoadMap
In-Reply-To: <20110302144539.GA31527@rabbitmq.com>
References: <4D6E5773.1080805@gmail.com> <20110302144539.GA31527@rabbitmq.com>
Message-ID: <AANLkTikDP8xEoM_e4WWGWVETjyX804+xrVgpvW87TxMN@mail.gmail.com>

Abhishek

We're looking into ways to share more information with the community.
In the meantime we are very happy to work with customers on a case by
case basis.

You are also very welcome to ask questions on this list about specific
features.  While we don't like to put hard deadlines on things, we
like to be upfront about broad priorities.

alexis


On Wed, Mar 2, 2011 at 2:45 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> Hi,
>
> On Wed, Mar 02, 2011 at 08:12:59PM +0530, Abhishek Kona wrote:
>> Is there any URL where I can get to know the things the RabbitMQ
>> team is working and what we can expect in the next few releases (and
>> timelines).
>
> Nope.
>
>> This will be helpful for people to decide on using rabbitmq if case
>> a feature is in the road map but not currently supported by
>> rabbitmq.
>
> Understood. A lot of our development is driven by user needs, so if
> there are things you think are missing then please let us know and we
> may adjust things as necessary. This flexibility is indeed one of the
> reasons why we don't have a firm published roadmap.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From abhishek.kona at gmail.com  Wed Mar  2 15:00:50 2011
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 02 Mar 2011 20:30:50 +0530
Subject: [rabbitmq-discuss] RabbitMQ RoadMap
In-Reply-To: <20110302144539.GA31527@rabbitmq.com>
References: <4D6E5773.1080805@gmail.com> <20110302144539.GA31527@rabbitmq.com>
Message-ID: <4D6E5BA2.5060104@gmail.com>

On 02/03/11 8:15 PM, Matthew Sackman wrote:
> Understood. A lot of our development is driven by user needs, so if
> there are things you think are missing then please let us know and we
> may adjust things as necessary. This flexibility is indeed one of the
> reasons why we don't have a firm published roadmap

On the same page, I am using RabbitMQ for communication between apps 
right now and it's performance is awesome.

The features that I am missing currently for use in my future apps are :

    * Easier way to do Queue Replication (with messages). DRBD and
      heartbeat is not the solution I watn to use. It would be better to
      have an application level replication (similar to RabbitMQ
      clustering).
    * Messages reappearing in queue after No-ACKs in a set time out.
      (client should not be made to hold a connection (and channel) to
      do the same).
    * A better push model to push messages to clients (looking at Java).
      The current Consumer model I feel needs to improve for handling
      connection terminations.

Please let me know if any of these are being worked on currently or are 
demands of other users.

PS: I do not care about the AMQP protocol much and want a message queue 
engine more suited to my use case.  So this might be the cause of any of 
my feature requests not in line with the specification(my ignorance, 
please forgive).

-Thanks a ton.
Abhishek Kona
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/7e4b8526/attachment-0001.htm>

From abhishekk at flipkart.com  Wed Mar  2 14:40:36 2011
From: abhishekk at flipkart.com (Abhishek Kona)
Date: Wed, 02 Mar 2011 20:10:36 +0530
Subject: [rabbitmq-discuss] RabbitMQ RoadMap
Message-ID: <4D6E56E4.3020200@flipkart.com>

Hey

Is there any URL where I can get to know the things the RabbitMQ team is 
working and what we can expect in the next few releases (and timelines).

This will be helpful for people to decide on using rabbitmq if case a 
feature is in the road map but not currently supported by rabbitmq.


Sorry, if I am missing the link.

-Abhishek Kona

From matthew at rabbitmq.com  Wed Mar  2 15:06:21 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 2 Mar 2011 15:06:21 +0000
Subject: [rabbitmq-discuss] RabbitMQ RoadMap
In-Reply-To: <4D6E5BA2.5060104@gmail.com>
References: <4D6E5773.1080805@gmail.com> <20110302144539.GA31527@rabbitmq.com>
	<4D6E5BA2.5060104@gmail.com>
Message-ID: <20110302150619.GB31527@rabbitmq.com>

On Wed, Mar 02, 2011 at 08:30:50PM +0530, Abhishek Kona wrote:
>    * Easier way to do Queue Replication (with messages). DRBD and
>      heartbeat is not the solution I watn to use. It would be better to
>      have an application level replication (similar to RabbitMQ
>      clustering).

Yup. We are working on this. Initially it will depend on clustering too,
so it might not work well over WANs or in scenarios where network
partitions are common, but this wrinkle can be addressed later on.

>    * Messages reappearing in queue after No-ACKs in a set time out.
>      (client should not be made to hold a connection (and channel) to
>      do the same).

Ok, this is a new one. The problem you're trying to solve here is to
detect slow-consumers and to have messages sent to such consumers
rerouted if the consumer doesn't process the msg fast enough?

>    * A better push model to push messages to clients (looking at Java).
>      The current Consumer model I feel needs to improve for handling
>      connection terminations.

Interesting. Can you elaborate on how you feel it needs improving? My
understanding is that it's pretty robust atm, but then again, I don't
often use the client libraries.

> PS: I do not care about the AMQP protocol much and want a message
> queue engine more suited to my use case.  So this might be the cause
> of any of my feature requests not in line with the specification(my
> ignorance, please forgive).

We have no problems with extending the protocol to address missing
functionality from AMQP, as evidenced by our extensions page:

http://www.rabbitmq.com/extensions.html

Matthew

From stammailbox at gmail.com  Wed Mar  2 15:19:37 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 2 Mar 2011 17:19:37 +0200
Subject: [rabbitmq-discuss] Fwd: socket error while using rabbitmq and a
 NAT (Network address translation)
In-Reply-To: <4D6E5283.4060002@rabbitmq.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
	<4D6BC078.8030600@rabbitmq.com>
	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>
	<4D6CC5D5.7090208@rabbitmq.com>
	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>
	<4D6CF797.4090305@rabbitmq.com>
	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>
	<4D6D17D1.6020902@rabbitmq.com>
	<AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>
	<AANLkTikSfe3aRT=dbEUWDc6dkXsmUmgcGYj_EbW9j_H1@mail.gmail.com>
	<AANLkTim3tiKG4K+p23ms-qO00r66ojPk4A1m_=050mMK@mail.gmail.com>
	<AANLkTim8TzRqEdQ2ejBObK_y4YFrTVVax84CoDCUncnq@mail.gmail.com>
	<4D6E2373.9050508@rabbitmq.com>
	<AANLkTikM2Tinf0qbpbOrJGbXzJHpCfZzLk_QHh3K5Lb0@mail.gmail.com>
	<AANLkTikV54+1bcF0YwvykV40fU8B4WrCTC_DXBnqvnpm@mail.gmail.com>
	<4D6E3E3D.3020008@rabbitmq.com>
	<AANLkTin=N_n1vnohD0fKaPbnMLHMyQhb6K1FhTe1JkWD@mail.gmail.com>
	<4D6E5283.4060002@rabbitmq.com>
Message-ID: <AANLkTinn6VE8Z8G+V_TmnekYWMHqh3r=i38EiLKtv_B+@mail.gmail.com>

Hi,

Well, two correction.
1. I mentioned I did the with/without tracer check on our application. not
the multicast.
2. the computer which I am running the tests on does not have a NAT. I tried
to narrow it down so I found one of the comp that has that problem and does
not have a nat.

OK, and now for the new interesting part. with evidence :-) .

As you suggested I tried to do a test . with the multicast .
I will describe it

 1. made directroy name RMQTest - put both clients in different folder

C:\RMQTestEnv\rabbitmq-java-client-bin-1.7.0
C:\RMQTestEnv\rabbitmq-java-client-bin-2.3.1

2. copied a batch file that has the following command to both folders.

runjava com.rabbitmq.examples.MulticastMain -h 192.168.100.251 -p 1434  -e
X1X1X1X1

3. ran it in both folders (finished one, started the other one. not
simultaneously) .
first the 1.7.0. output

C:\RMQTestEnv\rabbitmq-java-client-bin-1.7.0>runjava
com.rabbitmq.examples.Multi
castMain -h 192.168.100.251 -p 1434  -e X1X1X1X1
starting consumer #0
starting producer #0
recving rate: 7950 msg/s, min/avg/max latency: 689/6493/26385 microseconds
sending rate: 9434 msg/s
recving rate: 10537 msg/s, min/avg/max latency: 658/4791/27949 microseconds
sending rate: 10194 msg/s
recving rate: 10390 msg/s, min/avg/max latency: 704/5161/24546 microseconds
sending rate: 10460 msg/s
recving rate: 10278 msg/s, min/avg/max latency: 655/5061/27513 microseconds
sending rate: 10513 msg/s
recving rate: 10834 msg/s, min/avg/max latency: 637/4598/28824 microseconds
sending rate: 10623 msg/s
recving rate: 10554 msg/s, min/avg/max latency: 663/15783/92337 microseconds
sending rate: 10909 msg/s

nice

now the 2.3.1.

C:\RMQTestEnv\rabbitmq-java-client-bin-2.3.1>runjava
com.rabbitmq.examples.Multi
castMain -h 192.168.100.251 -p 1434  -e X1X1X1X1
starting consumer #0

thats it. doesn't seem to work.

4. ok. now the trace thing.
added a trace of 2.3.1 and changed the multicast 2.3.1 to link to the
Tracer.

the 2.3.1 command
   runjava com.rabbitmq.examples.MulticastMain -h 127.0.0.1 -p 5672 -e
X1X1X1X1
the trace command will be then
   runjava.bat com.rabbitmq.tools.Tracer 5672 192.168.100.251 1434

and it was successfull, as you can see with the Tracer.

C:\RMQTestEnv\rabbitmq-java-client-bin-2.3.1>runjava
com.rabbitmq.examples.Multi
castMain -h 127.0.0.1 -p 5672 -e X1X1X1X1
starting consumer #0
starting producer #0
recving rate: 0 msg/s, min/avg/max latency: 18896/18896/18896 microseconds
sending rate: 2231 msg/s
recving rate: 1201 msg/s, min/avg/max latency: 16142/352034/545121
microseconds
sending rate: 2126 msg/s
recving rate: 1309 msg/s, min/avg/max latency: 518532/711257/909513
microseconds
recving rate: 1353 msg/s, min/avg/max latency: 897258/1088853/1260756
microseconds
sending rate: 2081 msg/s
recving rate: 1359 msg/s, min/avg/max latency: 1239551/1437173/1637659
microseconds
sending rate: 2119 msg/s
sending rate: 2140 msg/s
recving rate: 1292 msg/s, min/avg/max latency: 1608518/1833688/2038255
microseconds

I dont think we need tracer for 1.7.0. because 1.7.0. works even without a
tracer.

Thanks.
I know it is a long thread so far. But if you will succeed in helping us
solve this.
You will be our hero.

On Wed, Mar 2, 2011 at 4:21 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
>
> On 02/03/11 13:25, mysurf mail wrote:
>
>> 1. multicast 1.7.0.
>> Ahh.. I was looking for the multicast of 1.7.0. we only kept the (rabbit
>> main jar).
>>
>> Ok, I ran it on the computer with the bad 2.3.1. communication and it
>> ran it without a problem.
>> seemed fine. I added the output (in the 1.txt file ).
>>
>> So, This computer runs multicast 1.7.0 and not 2.3.1. a riddle.
>>
>
> You previously tried MulticastMain from version 2.3.1 with and without the
> tracer and you saw failures without the tracer. Is this correct?
>
> Can you try running MulticastMain from version 1.7.0 with and without the
> tracer as well? From your description it doesn't sound like you have
> replicated the test in exactly the same way. You will need to use the tracer
> from the 1.7.0 release for this test.
>
> Do you have any way of repeating this test with the client and server on
> the same LAN or on the same host, in order to eliminate the network as a
> cause of the problem? I'm assuming that all your tests are still traversing
> the NAT infrastructure.
>
> Another option is to inspect a network traffic dump. We will need the
> binary capture file produced by wireshark or tcpdump to collect all traffic
> on the port you use for AMQP (1434 in your case) on the client and on the
> broker. Please don't send large binaries to the mailing list though. Rather
> place it somewhere where it can be retrieved from.
>
>
>  3. 1.7.0. to 2.3.1. -
>> We decided on an emergency solution for the meanwhile - we run rabbitmq
>> 2.3.1 server with 1.7.0. jars at the clients.
>> so far it seems ok. Are we expecting major problems?
>>
>
> It is impossible to say without understanding the cause.
>
>
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/3b2f0da1/attachment.htm>

From cao at ll.mit.edu  Wed Mar  2 15:25:53 2011
From: cao at ll.mit.edu (Cao, Yican - 0661 - MITLL)
Date: Wed, 2 Mar 2011 10:25:53 -0500
Subject: [rabbitmq-discuss] AlreadyClosedException
Message-ID: <507F97A0-248E-4CAB-B277-AB72B4C4EDE8@ll.mit.edu>

Hi, 

I am experiencing this exception occasionally/randomly.

13:54:37,014 ERROR [processor.Logger (248)] Failed delivery for exchangeId: ID-testvm-45688-1297943230354-0-225. Exhausted after delivery attempt: 1 caught: com.rabbitmq.client.AlreadyClosedException: clean connection shutdown; reason: Attempt to use closed channel
com.rabbitmq.client.AlreadyClosedException: clean connection shutdown; reason: Attempt to use closed channel
	at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:195)
	at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:290)
	at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:470)
	at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:457)

RabbitMQ server and client version is 2.2.0.
I'm not sure how this channel is close. 
I did not see this in v.1.7.2. 

There is a thread on this mail-list showing a work-a-round:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-November/009759.html

I'm using similar channel.basicPublish

I would like to know what is root cause and prevent from there.

Thanks.


Yican


From emile at rabbitmq.com  Wed Mar  2 15:46:52 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 02 Mar 2011 15:46:52 +0000
Subject: [rabbitmq-discuss] Fwd: socket error while using rabbitmq and a
 NAT (Network address translation)
In-Reply-To: <AANLkTinn6VE8Z8G+V_TmnekYWMHqh3r=i38EiLKtv_B+@mail.gmail.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>	<4D6BC078.8030600@rabbitmq.com>	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>	<4D6CC5D5.7090208@rabbitmq.com>	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>	<4D6CF797.4090305@rabbitmq.com>	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>	<4D6D17D1.6020902@rabbitmq.com>	<AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>	<AANLkTikSfe3aRT=dbEUWDc6dkXsmUmgcGYj_EbW9j_H1@mail.gmail.com>	<AANLkTim3tiKG4K+p23ms-qO00r66ojPk4A1m_=050mMK@mail.gmail.com>	<AANLkTim8TzRqEdQ2ejBObK_y4YFrTVVax84CoDCUncnq@mail.gmail.com>	<4D6E2373.9050508@rabbitmq.com>	<AANLkTikM2Tinf0qbpbOrJGbXzJHpCfZzLk_QHh3K5Lb0@mail.gmail.com>	<AANLkTikV54+1bcF0YwvykV40fU8B4WrCTC_DXBnqvnpm@mail.gmail.com>	<4D6E3E3D.3020008@rabbitmq.com>	<AANLkTin=N_n1vnohD0fKaPbnMLHMyQhb6K1FhTe1JkWD@mail.gmail.com>	<4D6E5283.4060002@rabbitmq.com>
	<AANLkTinn6VE8Z8G+V_TmnekYWMHqh3r=i38EiLKtv_B+@mail.gmail.com >
Message-ID: <4D6E666C.9020803@rabbitmq.com>

Hi,

On 02/03/11 15:19, mysurf mail wrote:
> Hi,
>
> Well, two correction.
> 1. I mentioned I did the with/without tracer check on our application.
> not the multicast.
> 2. the computer which I am running the tests on does not have a NAT. I
> tried to narrow it down so I found one of the comp that has that problem
> and does not have a nat.

Thanks for all the diagnostic information. Unfortunately I'm no closer 
to venturing a guess at the root cause.

> now the 2.3.1.
>
> C:\RMQTestEnv\rabbitmq-java-client-bin-2.3.1>runjava
> com.rabbitmq.examples.Multi
> castMain -h 192.168.100.251 -p 1434  -e X1X1X1X1
> starting consumer #0
>
> thats it. doesn't seem to work.

Can you supply a network capture dump of the AMQP traffic leading up to 
this point? If you can capture traffic on the server as well as the 
client that will give us the best chance of finding the cause. Please do 
not send large binaries to the mailing list, as this will annoy 
subscribers. Either host the capture files somewhere where I can 
download them or send me a private email to make arrangements.

Other things to try would be to run the tracer on the broker instead of 
on the client and see if that makes any difference. If you do manage to 
capture a trace when the error occurs then please send that to the list.



-Emile

From fabiomargarido at gmail.com  Wed Mar  2 16:30:40 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Wed, 2 Mar 2011 13:30:40 -0300
Subject: [rabbitmq-discuss]  Help defining appropriate queue model
In-Reply-To: <AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
Message-ID: <AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>

Forgot to copy the list.

Hi Alexis, thank you for the link.
It answers some of my doubts, but there are still some bits I don't
understand. For example, the page says: "The messages will be lost if
no queue is bound to the exchange yet, but that's okay for us; if no
consumer is listening yet (i.e., the exchange hasn't been created) we
can safely discard the message.". That's not the case for me; what I
wanted to do is publish once and consume as many times as necessary.
The scenarios I can't quite grasp yet are:

* The producer publishes the message before any consumers are running;
* The consumer receives the message, dies and reboots, consumes the
same message once more.

Are these even possible?
Thanks again.

On Wed, Mar 2, 2011 at 11:20, Alexis Richardson <alexis at rabbitmq.com> wrote:
> Fabio
>
> The simplest way is probably as follows:
>
> http://www.rabbitmq.com/tutorial-three-python.html
>
> Note that each consumer has its own queue, which acts as a buffer on
> behalf of that consumer. ?The downside of this is a slow consumer may
> get several configuration updates at once, so it will need to discard
> the earlier ones but should act on the latest.
>
> alexis
>
>
> On Wed, Mar 2, 2011 at 2:14 PM, Fabio Margarido
> <fabiomargarido at gmail.com> wrote:
>> Hi there,
>> I'm about to use RabbitMQ in my first amqp project and am having a bit
>> of difficulty identifying the necessary queues and exchanges.
>> In our use case, there will be only one producer who publishes a
>> message to the broker. This message represents configuration data.
>> Then multiple consumers read the published configuration from the
>> broker during their startup process, so it shouldn't happen very
>> often. The message should remain in the queue after consumption so
>> that the following consumers are able to read it. When some
>> configuration data changes, the producer republishes it and alerts
>> (possibly through some other queue) the consumers, who then read the
>> configuration message again.
>> I know this question isn't exactly related to RabbitMQ, but reading
>> the AMQP spec didn't help much. Could anyone help me identify which
>> exchange types, queue and message parameters I need for this to work?
>> Thanks in advance.
>>
>> Fabio.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From alexis at rabbitmq.com  Wed Mar  2 16:36:57 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 2 Mar 2011 16:36:57 +0000
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
Message-ID: <AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>

Fabio

On Wed, Mar 2, 2011 at 4:30 PM, Fabio Margarido
<fabiomargarido at gmail.com> wrote:
> Forgot to copy the list.
>
> Hi Alexis, thank you for the link.
> It answers some of my doubts, but there are still some bits I don't
> understand. For example, the page says: "The messages will be lost if
> no queue is bound to the exchange yet, but that's okay for us; if no
> consumer is listening yet (i.e., the exchange hasn't been created) we
> can safely discard the message.". That's not the case for me; what I
> wanted to do is publish once and consume as many times as necessary.

In the link I sent, you publish once per update, independent of the
number of consumers.


> The scenarios I can't quite grasp yet are:
>
> * The producer publishes the message before any consumers are running;

Do you want a new consumer to see all old updates, or just the latest
update that occurred before the new consumer connects to the broker?

> * The consumer receives the message, dies and reboots, consumes the
> same message once more.

You can set things up so that the message gets requeued, but not 'in order'.

I'd tentatively suggest that you may be talking more about a cache
than message queue.

alexis



> Are these even possible?
> Thanks again.
>
> On Wed, Mar 2, 2011 at 11:20, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Fabio
>>
>> The simplest way is probably as follows:
>>
>> http://www.rabbitmq.com/tutorial-three-python.html
>>
>> Note that each consumer has its own queue, which acts as a buffer on
>> behalf of that consumer. ?The downside of this is a slow consumer may
>> get several configuration updates at once, so it will need to discard
>> the earlier ones but should act on the latest.
>>
>> alexis
>>
>>
>> On Wed, Mar 2, 2011 at 2:14 PM, Fabio Margarido
>> <fabiomargarido at gmail.com> wrote:
>>> Hi there,
>>> I'm about to use RabbitMQ in my first amqp project and am having a bit
>>> of difficulty identifying the necessary queues and exchanges.
>>> In our use case, there will be only one producer who publishes a
>>> message to the broker. This message represents configuration data.
>>> Then multiple consumers read the published configuration from the
>>> broker during their startup process, so it shouldn't happen very
>>> often. The message should remain in the queue after consumption so
>>> that the following consumers are able to read it. When some
>>> configuration data changes, the producer republishes it and alerts
>>> (possibly through some other queue) the consumers, who then read the
>>> configuration message again.
>>> I know this question isn't exactly related to RabbitMQ, but reading
>>> the AMQP spec didn't help much. Could anyone help me identify which
>>> exchange types, queue and message parameters I need for this to work?
>>> Thanks in advance.
>>>
>>> Fabio.
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From fabiomargarido at gmail.com  Wed Mar  2 16:57:14 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Wed, 2 Mar 2011 13:57:14 -0300
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
Message-ID: <AANLkTikZMYofjLYYhZc8CE6GGxzqb36Px6mAB71W8SeA@mail.gmail.com>

Hi Alexis.

On Wed, Mar 2, 2011 at 13:36, Alexis Richardson <alexis at rabbitmq.com> wrote:
> In the link I sent, you publish once per update, independent of the
> number of consumers.

OK.

>
>> The scenarios I can't quite grasp yet are:
>>
>> * The producer publishes the message before any consumers are running;
>
> Do you want a new consumer to see all old updates, or just the latest
> update that occurred before the new consumer connects to the broker?

I want the consumers to see just the latest update. But I figured that
as the queue is exclusive and so gets created only the moment it
starts running, it wouldn't get the message that was published prior
to that. If that's not the case, then I guess it should work.

>> * The consumer receives the message, dies and reboots, consumes the
>> same message once more.
>
> You can set things up so that the message gets requeued, but not 'in order'.

Order shouldn't matter, as I'm only interested in that latest update.

> I'd tentatively suggest that you may be talking more about a cache
> than message queue.

It is a kind of cache. I guess it could be done a number of different
ways, like setting up an NFS share and storing the config in a file or
maybe set something up in the application servers. But I figured that
since I already have the RabbitMQ infrastructure up and running for my
other (more orthodox) messaging needs, I might as well take advantage
of it for this case rather than having to maintain another service.
Thanks.

From Alister.Morton at tradition.com  Wed Mar  2 16:58:40 2011
From: Alister.Morton at tradition.com (Alister Morton)
Date: Wed, 2 Mar 2011 16:58:40 +0000
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>

> I'd tentatively suggest that you may be talking more about a cache
> than message queue.

Or failing that, perhaps a bit like the "real time record" model, such as used for financial data, where a consumer gets the last published update for a topic. IIRC the guys at Rabbit HQ did some work on an exchange which persists the last update to a topic - what became of that? This would fit the problem definition quite well, I think.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.

From abhishek.kona at gmail.com  Wed Mar  2 17:04:29 2011
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Wed, 02 Mar 2011 22:34:29 +0530
Subject: [rabbitmq-discuss] RabbitMQ RoadMap
In-Reply-To: <20110302150619.GB31527@rabbitmq.com>
References: <4D6E5773.1080805@gmail.com>
	<20110302144539.GA31527@rabbitmq.com>	<4D6E5BA2.5060104@gmail.com>
	<20110302150619.GB31527@rabbitmq.com>
Message-ID: <4D6E789D.4030902@gmail.com>

On 02/03/11 8:36 PM, Matthew Sackman wrote:
> On Wed, Mar 02, 2011 at 08:30:50PM +0530, Abhishek Kona wrote:
>>     * Easier way to do Queue Replication (with messages). DRBD and
>>       heartbeat is not the solution I watn to use. It would be better to
>>       have an application level replication (similar to RabbitMQ
>>       clustering).
> Yup. We are working on this. Initially it will depend on clustering too,
> so it might not work well over WANs or in scenarios where network
> partitions are common, but this wrinkle can be addressed later on.
>
Thanks and great to know.
>>     * Messages reappearing in queue after No-ACKs in a set time out.
>>       (client should not be made to hold a connection (and channel) to
>>       do the same).
> Ok, this is a new one. The problem you're trying to solve here is to
> detect slow-consumers and to have messages sent to such consumers
> rerouted if the consumer doesn't process the msg fast enough?
>
Yes. Some times tasks based on items in queue may take lot of time 
(300s), it does not make sense for the consumer to hold the connection 
for so long (also there can be connection termination, in the mean while).
>>     * A better push model to push messages to clients (looking at Java).
>>       The current Consumer model I feel needs to improve for handling
>>       connection terminations.
> Interesting. Can you elaborate on how you feel it needs improving? My
> understanding is that it's pretty robust atm, but then again, I don't
> often use the client libraries.
I need some time to put my thoughts together in this matter. But my 
concerns were earlier voiced at http://goo.gl/QnAcH . I am still looking 
at handling reconnection.
My basic issues are the clients have to keep a connection open (or keep 
polling).  There can to be a other solution (end point registrations at 
server ,  exploring solutions like - 0MQ, rest, pubsubhubbub etc for 
doing that).
>> PS: I do not care about the AMQP protocol much and want a message
>> queue engine more suited to my use case.  So this might be the cause
>> of any of my feature requests not in line with the specification(my
>> ignorance, please forgive).
> We have no problems with extending the protocol to address missing
> functionality from AMQP, as evidenced by our extensions page:
>
> http://www.rabbitmq.com/extensions.htm
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From david at rabbitmq.com  Wed Mar  2 17:09:45 2011
From: david at rabbitmq.com (David Wragg)
Date: Wed, 02 Mar 2011 17:09:45 +0000
Subject: [rabbitmq-discuss] Building a recent rabbitmq-c with 0-8
	protocol
In-Reply-To: <C9927231.18ED8%pdezwart@rubiconproject.com> (Pieter de Zwart's
	message of "Tue, 01 Mar 2011 09:51:45 -0800")
References: <C9927231.18ED8%pdezwart@rubiconproject.com>
Message-ID: <yrv4cpqq9fnza.fsf@dwragg.eng.vmware.com>

Hi Pieter,

Glad to hear from your other email that your were able to solve the
problem.

But just to avoid confusion for the record:

Pieter de Zwart <pdezwart at rubiconproject.com> writes:
> So, I am a mercurial n00b. IS there any chance you can point me to two URLs,
> one for the rabbitmq-c repo, one for the rabbitmq-codegen repo, that I can
> use to generate an 0-8 client library, so that I can then upgrade to 2.3.1.
> The combination of:
> // librabbitmq-0.1-amqp_0_8 tag
> $ hg clone http://hg.rabbitmq.com/rabbitmq-c/rev/ce1eaceaee94
> // rabbitmq_v1_7_2
> $ hg clone http://hg.rabbitmq.com/rabbitmq-codegen/rev/c7c5876a05bb
>
> Yields what seems to be a 0-9-1 client, since I used the steps below to try
> to compile it, and had to move the 0-9-1 json spec out of the way.

There's no "out of the box" way to get the current librabbitmq with 0-8
support.

You can build the last version of librabbitmq that supported 0-8 by
doing:

$ hg clone http://hg.rabbitmq.com/rabbitmq-c/
$ hg clone http://hg.rabbitmq.com/rabbitmq-codegen/
$ cd rabbitmq-c
$ hg update -C amqp_0_8
$ autoreconf -i && ./configure && make

But you will find that there are small API differences between that and
the current librabbitmq.

As I suggested in my previous email, refitting the current librabbitmq
with 0-8 support looks reasonably straightforward, but it would involve
rolling your sleeves up and editing the code.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From alexis at rabbitmq.com  Wed Mar  2 17:11:34 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 2 Mar 2011 17:11:34 +0000
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTikZMYofjLYYhZc8CE6GGxzqb36Px6mAB71W8SeA@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<AANLkTikZMYofjLYYhZc8CE6GGxzqb36Px6mAB71W8SeA@mail.gmail.com>
Message-ID: <AANLkTi=MB5nPv5c87Z-o3dyNrGQ5LOVNWRSi1EvFdCmj@mail.gmail.com>

On Wed, Mar 2, 2011 at 4:57 PM, Fabio Margarido
<fabiomargarido at gmail.com> wrote:
>>> * The producer publishes the message before any consumers are running;
>>
>> Do you want a new consumer to see all old updates, or just the latest
>> update that occurred before the new consumer connects to the broker?
>
> I want the consumers to see just the latest update. But I figured that
> as the queue is exclusive and so gets created only the moment it
> starts running, it wouldn't get the message that was published prior
> to that.

Correct.

If you want the broker to retain messages published before any
consumers appear, then get the publisher to create a queue for them.
But what happens to those messages, is an application level decision
you will have to make...



>>> * The consumer receives the message, dies and reboots, consumes the
>>> same message once more.
>>
>> You can set things up so that the message gets requeued, but not 'in order'.
>
> Order shouldn't matter, as I'm only interested in that latest update.

Yes but if a message gets requeued, it will go to the back of the
(FIFO) queue.  You can work around this by attaching an application
level stamp.


>> I'd tentatively suggest that you may be talking more about a cache
>> than message queue.
>
> It is a kind of cache. I guess it could be done a number of different
> ways, like setting up an NFS share and storing the config in a file or
> maybe set something up in the application servers. But I figured that
> since I already have the RabbitMQ infrastructure up and running for my
> other (more orthodox) messaging needs, I might as well take advantage
> of it for this case rather than having to maintain another service.
> Thanks.

No problem.

alexis

From alexis at rabbitmq.com  Wed Mar  2 17:12:21 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 2 Mar 2011 17:12:21 +0000
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>

On Wed, Mar 2, 2011 at 4:58 PM, Alister Morton
<Alister.Morton at tradition.com> wrote:
>> I'd tentatively suggest that you may be talking more about a cache
>> than message queue.
>
> Or failing that, perhaps a bit like the "real time record" model, such as used for financial data, where a consumer gets the last published update for a topic. IIRC the guys at Rabbit HQ did some work on an exchange which persists the last update to a topic - what became of that? This would fit the problem definition quite well, I think.

Yes, though I think that plugin won't work with RabbitMQ 2.3.1.  Maybe
it could be revived...

alexis


> The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.
>

From fabiomargarido at gmail.com  Wed Mar  2 17:24:11 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Wed, 2 Mar 2011 14:24:11 -0300
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
Message-ID: <AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>

On Wed, Mar 2, 2011 at 14:12, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> Or failing that, perhaps a bit like the "real time record" model, such as used for financial data, where a consumer gets the last published update for a topic. IIRC the guys at Rabbit HQ did some work on an exchange which persists the last update to a topic - what became of that? This would fit the problem definition quite well, I think.

That sounds about right.

> Yes, though I think that plugin won't work with RabbitMQ 2.3.1. ?Maybe
> it could be revived...

If you guys can provide more information on this, I'd be very interested.
Thank you.

From yoavglazner at gmail.com  Wed Mar  2 21:35:59 2011
From: yoavglazner at gmail.com (yoav glazner)
Date: Wed, 2 Mar 2011 23:35:59 +0200
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
Message-ID: <AANLkTik2GsS2wF_2j9mxf58d3KNqu_Bvy+LDn0CZm00Y@mail.gmail.com>

On Wed, Mar 2, 2011 at 7:24 PM, Fabio Margarido <fabiomargarido at gmail.com>wrote:

> On Wed, Mar 2, 2011 at 14:12, Alexis Richardson <alexis at rabbitmq.com>
> wrote:
> >> Or failing that, perhaps a bit like the "real time record" model, such
> as used for financial data, where a consumer gets the last published update
> for a topic. IIRC the guys at Rabbit HQ did some work on an exchange which
> persists the last update to a topic - what became of that? This would fit
> the problem definition quite well, I think.
>

you can make one queue named - conifg_data
and always call basic_reject() on new config messages (with newer versions
or such...)
on old config messages call basic_ack and they will be gone...

don't forget to make the queue durable and the messages persistent if that
is needed.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110302/e38f1b9d/attachment.htm>

From markjreed at gmail.com  Wed Mar  2 23:35:10 2011
From: markjreed at gmail.com (Mark J. Reed)
Date: Wed, 2 Mar 2011 18:35:10 -0500
Subject: [rabbitmq-discuss] Distribution model advice sought
Message-ID: <AANLkTinRydENc6Ve2MnsddX0EEewoaRzLDBJcAjo25ZR@mail.gmail.com>

While avoiding the current technical details of queues and exchanges
and routing so as not to bias the discussion, we have an application
where we want this to happen:

1. A producer publishes a single message.

2. N copies of that message get distributed to N consumers.

3. These N consumers are selected from a total of M consumers, each of
which has declared which of the N sets of messages it is interested in
receiving.

That's it.  Basically, there are N "topics", and each message gets
published to all of those topics - but without the producer having to
do N publishes, and with only one consumable copy of each message per
topic.

Our initial design had a single exchange with N queues bound to it;
each of the M consumers then subscribes to one of the N queues.
Simple.

But not reliable.  The problem is that a queue lives on a single node,
and if that node goes down, the queue is gone.  It's not the loss of
data from the queue - no big deal in our use case - but the fact that
the queue itself becomes unusable within the cluster, and that entire
set of consumers stop working.

We don't need durable queues or persistent messages and we certainly
don't want to get into Pacemaker; I don't care if some messages are
lost.  I just want the overall operation to survive the loss of any
given node in the cluster.  That makes me think that queues are the
wrong entity to use for the "topics".

We could do N exchanges, where each node has its own local queue bound
to one of them (and use exchange-to-exchange binding to set up a
single exchange for the producer to publish to), but then *all* the
nodes would get copies of all the messages sent to their "topic",
instead of just one.

So I'm kind of at a loss as to how best to fit our workflow into the
RabbitMQ/AMQP model in a moderately resilient fashion.  Any
suggestions appreciated.

--
Mark J. Reed <markjreed at gmail.com>

From mikeb at rabbitmq.com  Thu Mar  3 01:02:42 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 03 Mar 2011 01:02:42 +0000
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
Message-ID: <4D6EE8B2.6030507@rabbitmq.com>

>>> [..] IIRC the guys at Rabbit HQ did
>>> some work on an exchange which persists the last update to a
>>> topic - what became of that? This would fit the problem
>>> definition quite well, I think.

The rabbitmq-lvc-plugin gives you an exchange type that acts like a 
direct exchange; but when you bind a queue, the queue gets the most 
recent message for the binding key given before being routed new messages.

http://github.com/squaremo/rabbitmq-lvc-plugin


Michael

From sameek at arosys.com  Thu Mar  3 05:09:44 2011
From: sameek at arosys.com (sam_mis)
Date: Wed, 2 Mar 2011 21:09:44 -0800 (PST)
Subject: [rabbitmq-discuss]  How can get the queue depth?
Message-ID: <31056187.post@talk.nabble.com>


Hi All

I am using Java Client for Rabbitmq. I want know that how many messages are
in the queue(total no. of message remaining in the queue) without reading
the message of the queue.

Thanks
-- 
View this message in context: http://old.nabble.com/How-can-get-the-queue-depth--tp31056187p31056187.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthias at rabbitmq.com  Thu Mar  3 07:24:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 03 Mar 2011 07:24:01 +0000
Subject: [rabbitmq-discuss] Distribution model advice sought
In-Reply-To: <AANLkTinRydENc6Ve2MnsddX0EEewoaRzLDBJcAjo25ZR@mail.gmail.com>
References: <AANLkTinRydENc6Ve2MnsddX0EEewoaRzLDBJcAjo25ZR@mail.gmail.com>
Message-ID: <4D6F4211.2050709@rabbitmq.com>

Mark,

Mark J. Reed wrote:
> That's it.  Basically, there are N "topics", and each message gets
> published to all of those topics - but without the producer having to
> do N publishes, and with only one consumable copy of each message per
> topic.
> 
> Our initial design had a single exchange with N queues bound to it;
> each of the M consumers then subscribes to one of the N queues.
> Simple.

How do you avoid the producer having to publish the message N times in 
this setting? I am asking because there is a new feature appearing in 
the next release that addresses that very problem :)

> But not reliable.  The problem is that a queue lives on a single node,
> and if that node goes down, the queue is gone.  It's not the loss of
> data from the queue - no big deal in our use case - but the fact that
> the queue itself becomes unusable within the cluster, and that entire
> set of consumers stop working.

When a node goes down, taking all its queues with it, the clients 
connected to that node and consuming from the queues will have their 
connections torn down. They would notice that and could simply reconnect 
and redeclare the queues & bindings & their consumers.

The problem you are describing arises for clients that are connected to 
the other, surviving, nodes. They will have no idea that anything is 
amiss and that their consumers (in the AMQP sense, i.e. the things 
declared by basic.consume) are no longer functional.

We have yet another new feature in development which will inform clients 
when their consumers have been cancelled by the server, e.g. when the 
queue from which they were consuming has been deleted or destroyed.

In your setup, when a client receives that notification it could 
redeclare the queue & bindings & their consumers.

Until that feature makes it into a release, as a stop gap clients could 
periodically check whether the queue they are consuming from still 
exist, e.g. by issuing passive queue.declares.


Regards,

Matthias.

From mikeb at rabbitmq.com  Thu Mar  3 09:26:42 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 03 Mar 2011 09:26:42 +0000
Subject: [rabbitmq-discuss] How can get the queue depth?
In-Reply-To: <31056187.post@talk.nabble.com>
References: <31056187.post@talk.nabble.com>
Message-ID: <4D6F5ED2.1080108@rabbitmq.com>

> I am using Java Client for Rabbitmq. I want know that how many messages are
> in the queue(total no. of message remaining in the queue) without reading
> the message of the queue.

Using a passive declare (Channel.queueDeclarePassive in the Java client) 
will give you the queue depth in the reply.

If you want to sample it often, it may be better to use the management 
plugin.

Michael.

From stammailbox at gmail.com  Thu Mar  3 10:43:32 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Thu, 3 Mar 2011 12:43:32 +0200
Subject: [rabbitmq-discuss] Fwd: socket error while using rabbitmq and a
 NAT (Network address translation)
In-Reply-To: <4D6E666C.9020803@rabbitmq.com>
References: <AANLkTinD1gHsHGZmWNr+KY-k_khXQgTBin+25kuLvDhe@mail.gmail.com>
	<4D6BC078.8030600@rabbitmq.com>
	<AANLkTi=d12EhSGN0KGB1o0RYqN2rVaz03Rasuw1zVK8f@mail.gmail.com>
	<4D6CC5D5.7090208@rabbitmq.com>
	<AANLkTik1_Sfi-MDcq5kMBxP96J=aVFFjGUbJQ6EH=5ch@mail.gmail.com>
	<4D6CF797.4090305@rabbitmq.com>
	<AANLkTinHroXSm_RcHeocQFDA+10QVsyNePXQ-DbyTtzB@mail.gmail.com>
	<4D6D17D1.6020902@rabbitmq.com>
	<AANLkTikADsdZXPMVAPRk85JstpAVAPk-cWn--4Mt1SeN@mail.gmail.com>
	<AANLkTikSfe3aRT=dbEUWDc6dkXsmUmgcGYj_EbW9j_H1@mail.gmail.com>
	<AANLkTim3tiKG4K+p23ms-qO00r66ojPk4A1m_=050mMK@mail.gmail.com>
	<AANLkTim8TzRqEdQ2ejBObK_y4YFrTVVax84CoDCUncnq@mail.gmail.com>
	<4D6E2373.9050508@rabbitmq.com>
	<AANLkTikM2Tinf0qbpbOrJGbXzJHpCfZzLk_QHh3K5Lb0@mail.gmail.com>
	<AANLkTikV54+1bcF0YwvykV40fU8B4WrCTC_DXBnqvnpm@mail.gmail.com>
	<4D6E3E3D.3020008@rabbitmq.com>
	<AANLkTin=N_n1vnohD0fKaPbnMLHMyQhb6K1FhTe1JkWD@mail.gmail.com>
	<4D6E5283.4060002@rabbitmq.com>
	<AANLkTinn6VE8Z8G+V_TmnekYWMHqh3r=i38EiLKtv_B+@mail.gmail.com>
	<4D6E666C.9020803@rabbitmq.com>
Message-ID: <AANLkTikWcYpc1-ihuKMTzJHOa5vw-hqnqk=056=kEjvE@mail.gmail.com>

SOLVED!!! YEY!!!


I will explain in brief.

Our production servers are all in different LANs and none are connected to
the internet.
So, usually IT dont put DNS ip in the computer settings.
Somehow, some of the server contained DNS IP in their settings.
In their case its an IP address that doesnt lead anywhere cause this is a
closed LAN.
(why is there a DNS address? Probably because we dragged those computers
from different places and connected them to our farm).
We never bothered to deleted their old DNS settings, cause no one connected
outside.
Basically, until now we never encountered a problem with this issue. also
the rabbit 1.7.0. worked wonderfully.

Now, what we did in order to solve is delete the DNS settings
and then only 2.3.1. clients started to work.

(BTW Then we tried to add a real dns ip that we have here and it worked also
)
My wild guess is that the new thing in 2.3.1. (And it is only a guess cause
i didnt look at the source)
is that is takes the host ip string, first looks at the DNS, translate it if
DNS exists and if no
translation exists then tries to use it as an ip string. Now what if the DNS
is pointing to a non existing server?
this is the bug.

That's it.

and Thanks a lot for your time.


On Wed, Mar 2, 2011 at 5:46 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
>
> On 02/03/11 15:19, mysurf mail wrote:
>
>> Hi,
>>
>> Well, two correction.
>> 1. I mentioned I did the with/without tracer check on our application.
>> not the multicast.
>> 2. the computer which I am running the tests on does not have a NAT. I
>> tried to narrow it down so I found one of the comp that has that problem
>> and does not have a nat.
>>
>
> Thanks for all the diagnostic information. Unfortunately I'm no closer to
> venturing a guess at the root cause.
>
>
>  now the 2.3.1.
>>
>> C:\RMQTestEnv\rabbitmq-java-client-bin-2.3.1>runjava
>> com.rabbitmq.examples.Multi
>> castMain -h 192.168.100.251 -p 1434  -e X1X1X1X1
>> starting consumer #0
>>
>> thats it. doesn't seem to work.
>>
>
> Can you supply a network capture dump of the AMQP traffic leading up to
> this point? If you can capture traffic on the server as well as the client
> that will give us the best chance of finding the cause. Please do not send
> large binaries to the mailing list, as this will annoy subscribers. Either
> host the capture files somewhere where I can download them or send me a
> private email to make arrangements.
>
> Other things to try would be to run the tracer on the broker instead of on
> the client and see if that makes any difference. If you do manage to capture
> a trace when the error occurs then please send that to the list.
>
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110303/11455bff/attachment.htm>

From fabiomargarido at gmail.com  Thu Mar  3 11:06:53 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Thu, 3 Mar 2011 08:06:53 -0300
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTik2GsS2wF_2j9mxf58d3KNqu_Bvy+LDn0CZm00Y@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
	<AANLkTik2GsS2wF_2j9mxf58d3KNqu_Bvy+LDn0CZm00Y@mail.gmail.com>
Message-ID: <AANLkTim8vu6m3=KHG9w4Uj1-gin2UW7o5bqGcHuDXQd0@mail.gmail.com>

On Wed, Mar 2, 2011 at 18:35, yoav glazner <yoavglazner at gmail.com> wrote:
> you can make one queue named - conifg_data
> and always call basic_reject() on new config messages (with newer versions
> or such...)
> on old config messages call basic_ack and they will be gone...
> don't forget to make the queue durable and the messages?persistent?if that
> is needed.

Thanks for the suggestion, Yoav. I'd rather have a more elegant
solution, but I'll keep this in mind and give it a try if nothing else
works as desired.

From fabiomargarido at gmail.com  Thu Mar  3 11:20:48 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Thu, 3 Mar 2011 08:20:48 -0300
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <4D6EE8B2.6030507@rabbitmq.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
	<4D6EE8B2.6030507@rabbitmq.com>
Message-ID: <AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>

On Wed, Mar 2, 2011 at 22:02, Michael Bridgen <mikeb at rabbitmq.com> wrote:
> The rabbitmq-lvc-plugin gives you an exchange type that acts like a direct
> exchange; but when you bind a queue, the queue gets the most recent message
> for the binding key given before being routed new messages.
>
> http://github.com/squaremo/rabbitmq-lvc-plugin

This sounds really interesting. Is this the plugin Alister and Alexis
were talking about? Is it actively developed (or considered
feature-complete) and considered stable?
I've tried to get it up and running to give it a try but I'm stuck.
Following the build instructions in the github page led to the
following error when I ran (cd ../rabbitmq-erlang-client ; make clean
&& make):

escript ../rabbitmq-server/generate_deps deps.mk ebin
escript: exception error: no function clause matching
                 generate_deps__escript__1299__149734__266135:main(["deps.mk",
                                                                    "ebin"])
  in function  escript:run/2
  in call from escript:start/1
  in call from init:start_it/1
  in call from init:start_em/1
sed -e 's:%%VSN%%:0.0.0:g' < rabbit_common.app.in > rabbit_common.app
mkdir -p dist
rm -f dist/rabbit_common.ez
make -C ../rabbitmq-server
make: *** [dist/rabbit_common.ez] Error 2

If I skip these steps:

(cd rabbitmq-server ; hg up -C bug22169 ; make -j)
(cd ../rabbitmq-erlang-client ; make clean && make)

This is the error I get when trying to compile the plugin:

ERL_LIBS=build/deps:deps erlc -I include -o ebin -Wall +debug_info -pa
ebin src/rabbit_exchange_type_lvc.erl
src/rabbit_exchange_type_lvc.erl:21: field routing_key undefined in
record basic_message
src/rabbit_exchange_type_lvc.erl:27: variable 'RK' is unbound
make: *** [ebin/rabbit_exchange_type_lvc.beam] Error 1

Any thoughts?
Thanks.

From Shixin.Song at markit.com  Thu Mar  3 12:03:30 2011
From: Shixin.Song at markit.com (Shixin Song)
Date: Thu, 3 Mar 2011 13:03:30 +0100
Subject: [rabbitmq-discuss] RabbitMQ latency and message lost issue.
In-Reply-To: <C9265FDC5DBE6249ADFA9B769D3D2A170118E76F51@EUMSGMAIL001.markit.partners>
References: <C9265FDC5DBE6249ADFA9B769D3D2A170118E76F51@EUMSGMAIL001.markit.partners>
Message-ID: <C9265FDC5DBE6249ADFA9B769D3D2A170118E76F55@EUMSGMAIL001.markit.partners>

Anyone could help me? No body had this issue before?

Thanks in advance
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Shixin Song [Shixin.Song at markit.com]
Sent: Wednesday, March 02, 2011 2:43 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] RabbitMQ latency and message lost issue.

To whom it may concern,

I am testing RabbitMQ at this moment. I have installed rabbitmq server and developed C++ client library using rabbitmq C library.

I found out that RabbitMQ never drops the message which means it has 0 message loss. But in my case, the latency is much more important than the message loss. Some message loss is acceptable in order to limit the maximal message latency. Could any one inform me how to configure rabbitmq to let it drop some messages when the latency is too high or the queue is reached to a maximum value.

Best regards
Shixin

This e-mail, including accompanying communications and attachments, is strictly confidential and only for the intended recipient. Any retention, use or disclosure not expressly authorised by Markit is prohibited. This email is subject to all waivers and other terms at the following link: http://www.markit.com/en/about/legal/email-disclaimer.page

We have recently moved to our new head office located at Ropemaker Place, 25 Ropemaker Street, London, EC2Y 9LY.
Please visit http://www.markit.com/en/about/contact/contact-us.page? for contact information on our offices worldwide.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

This e-mail, including accompanying communications and attachments, is strictly confidential and only for the intended recipient. Any retention, use or disclosure not expressly authorised by Markit is prohibited. This email is subject to all waivers and other terms at the following link: http://www.markit.com/en/about/legal/email-disclaimer.page

We have recently moved to our new head office located at Ropemaker Place, 25 Ropemaker Street, London, EC2Y 9LY.
Please visit http://www.markit.com/en/about/contact/contact-us.page? for contact information on our offices worldwide.

From rob at rabbitmq.com  Thu Mar  3 12:21:13 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Thu, 03 Mar 2011 12:21:13 +0000
Subject: [rabbitmq-discuss] RabbitMQ - StackOverflowError
In-Reply-To: <20110225002059.GA6618@wellquite.org>
References: <AANLkTi=ay-fFRZ84fv0xyBDBYgzwAEuM-EVNaUX7OF_W@mail.gmail.com>	<4D662F83.7070903@rabbitmq.com>	<F582B376-4483-4789-821A-7E5A78DCD70B@gmail.com>
	<20110225002059.GA6618@wellquite.org>
Message-ID: <4D6F87B9.1070801@rabbitmq.com>

A fix for this was just pushed to default on rabbitmq-java-client.

On 25/02/11 00:21, Matthew Sackman wrote:
> On Fri, Feb 25, 2011 at 05:35:16AM +0530, GMail wrote:
>> Using version 1.8.1. Trying to understand what could be the root cause.
> The algorithm in use is recursive and seems to be exploding Java's
> stack. We don't think there's anything functionally wrong with the
> algorithm employed other than the fact it's recursive. It's currently
> being rewritten to be less recursive.
>
>> Saw one thing that lot of channels are being created but not closed. Can that be the reason?
> We think it's likely to go wrong if the channel numbers are heavily
> fragmented.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From majek04 at gmail.com  Thu Mar  3 12:26:58 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 3 Mar 2011 12:26:58 +0000
Subject: [rabbitmq-discuss] Realtime messaging or near realtime use
 rabbitmq ?
In-Reply-To: <AANLkTi=EYnOwZORQCaUPS1fhRfcU_kJ03km-Q2BJOE4S@mail.gmail.com>
References: <AANLkTi=EYnOwZORQCaUPS1fhRfcU_kJ03km-Q2BJOE4S@mail.gmail.com>
Message-ID: <AANLkTimRao8QwFv0Oc5K0MBs5HvLdUcdXet9FkDRV8tv@mail.gmail.com>

On Wed, Mar 2, 2011 at 04:21, Benjamin Bennett <benbennett at gmail.com> wrote:
> I am working on volunteer project that use to be funded by my
> company(hardware that is). We are still hacking away on it when we
> can.
> Basically it is an autonomous car, not to standards that are seen in
> the media but we are having fun leaving and just doing something
> interesting.
>
> I introduced rabbitmq to my day project, very boring web app and it
> has worked well.
>
> I was wonder how well do you think rabbit would perform on a system
> with very few publishers and subscribers but trying to get messages
> very quickly.

It should work fine if you use rabbit properly
(ie: avoid queueing, always make sure that someone is listening to
messages, etc).

> The control systems have outer and inner control loops , so even if
> rabbit completely failed it shuts itself down.
>
> We are using IPC but difficult to code with and only works in c /c++.
>
> Any ?recommendations? I know I would want messages to "die" on a queue
> rather quickly because they would be consider stale.

Take a look at queue-ttl http://www.rabbitmq.com/extensions.html#queue-ttl
(this will kill too old messages)
And at immediate flag to basic.publish (this will forbid message from
being published if it can't be delivered to a consumer immediately)
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish



Cheers,
  Marek

From majek04 at gmail.com  Thu Mar  3 12:34:18 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 3 Mar 2011 12:34:18 +0000
Subject: [rabbitmq-discuss] RabbitMQ latency and message lost issue.
In-Reply-To: <C9265FDC5DBE6249ADFA9B769D3D2A170118E76F51@EUMSGMAIL001.markit.partners>
References: <C9265FDC5DBE6249ADFA9B769D3D2A170118E76F51@EUMSGMAIL001.markit.partners>
Message-ID: <AANLkTim+pu_mFEKHViSw2=ScJH4iuCWCiSTsnk3r+kXF@mail.gmail.com>

On Wed, Mar 2, 2011 at 13:43, Shixin Song <Shixin.Song at markit.com> wrote:
> To whom it may concern,
>
> I am testing RabbitMQ at this moment. I have installed rabbitmq server and developed C++ client library using rabbitmq C library.
>
> I found out that RabbitMQ never drops the message which means it has 0 message loss. But in my case, the latency is much more important than the message loss. Some message loss is acceptable in order to limit the maximal message latency. Could any one inform me how to configure rabbitmq to let it drop some messages when the latency is too high or the queue is reached to a maximum value.
>

You can tell rabbit to drop messages 'older than' something -
http://www.rabbitmq.com/extensions.html#queue-ttl

Also take a look at immediate flag to basic.publish (this will forbid
message from
being published if it can't be delivered to a consumer immediately)
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish

But it's your responsibility to ensure that messages are being consumed
fast enough. Queue.ttl and 'immediate' may help, but eventually
RabbitMQ is a queuing system constructed to queue messages - not lose
them randomly.

Cheers,
  Marek

From majek04 at gmail.com  Thu Mar  3 12:40:52 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 3 Mar 2011 12:40:52 +0000
Subject: [rabbitmq-discuss] Message returned as unroutable even if
 consumer is listening
In-Reply-To: <20110302100217.19874p7t6ai1x02s@webmail.active24.cz>
References: <20110302100217.19874p7t6ai1x02s@webmail.active24.cz>
Message-ID: <AANLkTinkjK1cWMg3QO3wK=pNun_0i1mTR004DqCa53dE@mail.gmail.com>

On Wed, Mar 2, 2011 at 09:02, Jiri Krutil <jiri at krutil.com> wrote:
> We are seeing some strange behaviour consistently after installing the 2.3.1
> broker on a new linux box (which did not occur yet elsewhere).
>
> In our simple P2P setup, a client is sending messages to a server:
>
> CLIENT -> exchange "request.CLIENT" -> queue "request" -> SERVER
>
> We have two 2.3.1 Java client connections:
> - connection SERVER is consuming from queue "request"
> - connection CLIENT is sending messages to exchange "request.CLIENT" with
> routing key "request" with the immediate flag set
>
> The queue "request" is bound to direct exchange "request.CLIENT" using
> binding key "request".
>
> The problem is that all messages sent by CLIENT are returned by the broker
> as unroutable, even if we see a consumer listening on the target queue,
> which we believe is ready to consume messages.

You're doing something very wrong. Read this:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish

bit mandatory
This flag tells the server how to react if the message cannot be
routed to a queue. If this flag is set, the server will return an
unroutable message with a Return method. If this flag is zero, the
server silently drops the message.

bit immediate
This flag tells the server how to react if the message cannot be
routed to a queue consumer immediately. If this flag is set, the
server will return an undeliverable message with a Return method. If
this flag is zero, the server will queue the message, but with no
guarantee that it will ever be consumed.

As you can see immediate->"undelivered", mandatory->"unroutable".

You can try using rabbitmq-management plugin to debug if your
exchanges/bindings/queues are configured properly.
(you may also try rabbitmqctl, but it's harder to use)

Cheers,
  Marek

From jiri at krutil.com  Thu Mar  3 12:55:56 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Thu, 03 Mar 2011 13:55:56 +0100
Subject: [rabbitmq-discuss] Message returned as unroutable even if
 consumer is listening
In-Reply-To: <AANLkTinkjK1cWMg3QO3wK=pNun_0i1mTR004DqCa53dE@mail.gmail.com>
References: <20110302100217.19874p7t6ai1x02s@webmail.active24.cz>
	<AANLkTinkjK1cWMg3QO3wK=pNun_0i1mTR004DqCa53dE@mail.gmail.com>
Message-ID: <20110303135556.38243zh5ypci64sg@webmail.active24.cz>

Marek,

> As you can see immediate->"undelivered", mandatory->"unroutable".
>
> You can try using rabbitmq-management plugin to debug if your
> exchanges/bindings/queues are configured properly.
> (you may also try rabbitmqctl, but it's harder to use)

Thanks for your response. I think that our configuration is correct.

The thing we don't understand is that our messages are being returned  
by the broker because of "no consumers", even if we can see a consumer  
listening (both via rabbitmqctl and the management plugin).

In all other environments this design seems to work fine. We are  
trying to find out what is wrong with the single broker installation  
that does not want to accept any messages.

Cheers
Jiri


From Shixin.Song at markit.com  Thu Mar  3 12:53:32 2011
From: Shixin.Song at markit.com (Shixin Song)
Date: Thu, 3 Mar 2011 13:53:32 +0100
Subject: [rabbitmq-discuss] RabbitMQ latency and message lost issue.
In-Reply-To: <AANLkTim+pu_mFEKHViSw2=ScJH4iuCWCiSTsnk3r+kXF@mail.gmail.com>
References: <C9265FDC5DBE6249ADFA9B769D3D2A170118E76F51@EUMSGMAIL001.markit.partners>,
	<AANLkTim+pu_mFEKHViSw2=ScJH4iuCWCiSTsnk3r+kXF@mail.gmail.com>
Message-ID: <C9265FDC5DBE6249ADFA9B769D3D2A170118E76F56@EUMSGMAIL001.markit.partners>

Hi Marek,

Thanks a lot for your reply. I get the general idea about how to deal with it. Now I am looking at the first solution which to tell rabbit drop the message when it's too old. I saw the sample code from the link indicating how to do it in Java. But I am using C client library at this moment.  It seems that there is no queue declare interface at this moment. Could you indicate me that how to do it in C library. Here is the part of my code :

        conn = amqp_new_connection();

        die_on_error(sockfd = amqp_open_socket(hostName.c_str(), portNumber), "Opening socket");
        amqp_set_sockfd(conn, sockfd);
        die_on_amqp_error(amqp_login(conn, virtualHost.c_str()
                                                , 0
                                                , 131072,
                                                0,
                                                AMQP_SASL_METHOD_PLAIN,
                                                userName.c_str(),
                                                password.c_str()),
                                        "Logging in");
        amqp_channel_open(conn, 1);
        die_on_amqp_error(amqp_get_rpc_reply(conn), "Opening channel");

...............................

    die_on_error(amqp_basic_publish(conn,
                                    1,
                                    amqp_cstring_bytes("TestExchange"),
                                    amqp_cstring_bytes(topic_str.c_str()),
                                    0,
                                    0,
                                    NULL,
                                    message_bytes),
                 "Publishing");

Thanks a lot.

Best regards
Shixin

________________________________________
From: Marek Majkowski [majek04 at gmail.com]
Sent: Thursday, March 03, 2011 1:34 PM
To: Shixin Song
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ latency and message lost issue.

On Wed, Mar 2, 2011 at 13:43, Shixin Song <Shixin.Song at markit.com> wrote:
> To whom it may concern,
>
> I am testing RabbitMQ at this moment. I have installed rabbitmq server and developed C++ client library using rabbitmq C library.
>
> I found out that RabbitMQ never drops the message which means it has 0 message loss. But in my case, the latency is much more important than the message loss. Some message loss is acceptable in order to limit the maximal message latency. Could any one inform me how to configure rabbitmq to let it drop some messages when the latency is too high or the queue is reached to a maximum value.
>

You can tell rabbit to drop messages 'older than' something -
http://www.rabbitmq.com/extensions.html#queue-ttl

Also take a look at immediate flag to basic.publish (this will forbid
message from
being published if it can't be delivered to a consumer immediately)
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish

But it's your responsibility to ensure that messages are being consumed
fast enough. Queue.ttl and 'immediate' may help, but eventually
RabbitMQ is a queuing system constructed to queue messages - not lose
them randomly.

Cheers,
  Marek

This e-mail, including accompanying communications and attachments, is strictly confidential and only for the intended recipient. Any retention, use or disclosure not expressly authorised by Markit is prohibited. This email is subject to all waivers and other terms at the following link: http://www.markit.com/en/about/legal/email-disclaimer.page

We have recently moved to our new head office located at Ropemaker Place, 25 Ropemaker Street, London, EC2Y 9LY.
Please visit http://www.markit.com/en/about/contact/contact-us.page? for contact information on our offices worldwide.

From mikeb at rabbitmq.com  Thu Mar  3 12:58:54 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 03 Mar 2011 12:58:54 +0000
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>	<4D6EE8B2.6030507@rabbitmq.com>
	<AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>
Message-ID: <4D6F908E.2030209@rabbitmq.com>

On 03/03/2011 11:20 AM, Fabio Margarido wrote:
> On Wed, Mar 2, 2011 at 22:02, Michael Bridgen<mikeb at rabbitmq.com>  wrote:
>> The rabbitmq-lvc-plugin gives you an exchange type that acts like a direct
>> exchange; but when you bind a queue, the queue gets the most recent message
>> for the binding key given before being routed new messages.
>>
>> http://github.com/squaremo/rabbitmq-lvc-plugin
>
> This sounds really interesting. Is this the plugin Alister and Alexis
> were talking about?

I think so, although I'm surprised Alexis didn't know its name ..

> Is it actively developed (or considered
> feature-complete) and considered stable?

Nope; have a look at the README -- 
https://github.com/squaremo/rabbitmq-lvc-plugin/blob/master/README.md

It's labeled "experimental", though it's dead simple and there are few 
moving parts.  The biggest limitation you may face, *may* face, is that 
it's not written to be hugely scalable -- it just does the simplest 
thing possible.

I've uploaded an ez on github, which you can drop into 
rabbitmq-server/plugins/; it should work with v2.3.1 and default branch. 
  It'll be easier than compiling it yourself.

> I've tried to get it up and running to give it a try but I'm stuck.
> Following the build instructions in the github page led to the
> following error when I ran (cd ../rabbitmq-erlang-client ; make clean
> &&  make):
>
> escript ../rabbitmq-server/generate_deps deps.mk ebin
> escript: exception error: no function clause matching
>                   generate_deps__escript__1299__149734__266135:main(["deps.mk",
>                                                                      "ebin"])
>    in function  escript:run/2
>    in call from escript:start/1
>    in call from init:start_it/1
>    in call from init:start_em/1
> sed -e 's:%%VSN%%:0.0.0:g'<  rabbit_common.app.in>  rabbit_common.app
> mkdir -p dist
> rm -f dist/rabbit_common.ez
> make -C ../rabbitmq-server
> make: *** [dist/rabbit_common.ez] Error 2

Hmm. I thought that build problem had been eradicated.  Maybe it's 
because of the old branch.

> If I skip these steps:
>
> (cd rabbitmq-server ; hg up -C bug22169 ; make -j)
> (cd ../rabbitmq-erlang-client ; make clean&&  make)

Oh -- you don't need to compile to a particular branch any more.  I've 
fixed the README.

> This is the error I get when trying to compile the plugin:
>
> ERL_LIBS=build/deps:deps erlc -I include -o ebin -Wall +debug_info -pa
> ebin src/rabbit_exchange_type_lvc.erl
> src/rabbit_exchange_type_lvc.erl:21: field routing_key undefined in
> record basic_message
> src/rabbit_exchange_type_lvc.erl:27: variable 'RK' is unbound
> make: *** [ebin/rabbit_exchange_type_lvc.beam] Error 1

That's a consequence of the problem with compiling 
rabbitmq-erlang-client, above.


Michael

From matthew at rabbitmq.com  Thu Mar  3 13:07:05 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 3 Mar 2011 13:07:05 +0000
Subject: [rabbitmq-discuss] Message returned as unroutable even if
 consumer is listening
In-Reply-To: <20110303135556.38243zh5ypci64sg@webmail.active24.cz>
References: <20110302100217.19874p7t6ai1x02s@webmail.active24.cz>
	<AANLkTinkjK1cWMg3QO3wK=pNun_0i1mTR004DqCa53dE@mail.gmail.com>
	<20110303135556.38243zh5ypci64sg@webmail.active24.cz>
Message-ID: <20110303130705.GA4083@wellquite.org>

On Thu, Mar 03, 2011 at 01:55:56PM +0100, Jiri Krutil wrote:
> The thing we don't understand is that our messages are being
> returned by the broker because of "no consumers", even if we can see
> a consumer listening (both via rabbitmqctl and the management
> plugin).

Consumer must be blocked. Is it using basic.qos and failing to ack
messages fast enough? Immediate says it must be delivered to a consumer
immediately. If that consumer is not in a fit state to receive msg then
the msg will be returned.

Matthew

From majek04 at gmail.com  Thu Mar  3 13:10:56 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 3 Mar 2011 13:10:56 +0000
Subject: [rabbitmq-discuss] Message returned as unroutable even if
 consumer is listening
In-Reply-To: <20110303135556.38243zh5ypci64sg@webmail.active24.cz>
References: <20110302100217.19874p7t6ai1x02s@webmail.active24.cz>
	<AANLkTinkjK1cWMg3QO3wK=pNun_0i1mTR004DqCa53dE@mail.gmail.com>
	<20110303135556.38243zh5ypci64sg@webmail.active24.cz>
Message-ID: <AANLkTimBv+ior9wutznmsaRq4Wri9bQ9JgxKSxneBpE3@mail.gmail.com>

On Thu, Mar 3, 2011 at 12:55, Jiri Krutil <jiri at krutil.com> wrote:
> Marek,
>
>> As you can see immediate->"undelivered", mandatory->"unroutable".
>>
>> You can try using rabbitmq-management plugin to debug if your
>> exchanges/bindings/queues are configured properly.
>> (you may also try rabbitmqctl, but it's harder to use)
>
> Thanks for your response. I think that our configuration is correct.
>
> The thing we don't understand is that our messages are being returned by the
> broker because of "no consumers", even if we can see a consumer listening
> (both via rabbitmqctl and the management plugin).
>
> In all other environments this design seems to work fine. We are trying to
> find out what is wrong with the single broker installation that does not
> want to accept any messages.

Okay. You're probably using basic.qos and/or acknowledgments.

'Immediate' is interpreted by rabbit as follows:
 - pick up a consumer from 'free' consumers list
 - deliver message.

If no consumer is 'free' rabbit will return the message.

The problem is when a consumer is treated as 'free'.

The consumer is always 'free' if it's not using acknowledgments.
In such case rabbit will just push all the messages to it.
(well, it's more complicated, rabbit may still dislike the
consumer if the network connection is too slow)

If consumer is using acks _and_ is not acking messages
fast enough - rabbit will have to queue the messages.
The queue size will grow and rabbit will not be able
to 'immediately' deliver messages.

If you set basic.qos(N) - rabbit will move the consumer
off the 'free' list if the consumer has N unacknowledged
messages.
If you don't set basic.qos, I think rabbit will deliver
100 messages before moving the consumer off the 'free' state.

Is your consumer fast enough?

Cheers,
  Marek

From matthew at rabbitmq.com  Thu Mar  3 13:11:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 3 Mar 2011 13:11:55 +0000
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <4D6F908E.2030209@rabbitmq.com>
References: <AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
	<4D6EE8B2.6030507@rabbitmq.com>
	<AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>
	<4D6F908E.2030209@rabbitmq.com>
Message-ID: <20110303131155.GB4083@wellquite.org>

On Thu, Mar 03, 2011 at 12:58:54PM +0000, Michael Bridgen wrote:
> >This is the error I get when trying to compile the plugin:
> >
> >ERL_LIBS=build/deps:deps erlc -I include -o ebin -Wall +debug_info -pa
> >ebin src/rabbit_exchange_type_lvc.erl
> >src/rabbit_exchange_type_lvc.erl:21: field routing_key undefined in
> >record basic_message
> >src/rabbit_exchange_type_lvc.erl:27: variable 'RK' is unbound
> >make: *** [ebin/rabbit_exchange_type_lvc.beam] Error 1

I doubt that. #basic_message's routing_key became routing_keys when
bug23483 landed.

Matthew

From matthew at rabbitmq.com  Thu Mar  3 13:23:04 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 3 Mar 2011 13:23:04 +0000
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <20110303131155.GB4083@wellquite.org>
References: <AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
	<4D6EE8B2.6030507@rabbitmq.com>
	<AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>
	<4D6F908E.2030209@rabbitmq.com>
	<20110303131155.GB4083@wellquite.org>
Message-ID: <20110303132304.GC4083@wellquite.org>

On Thu, Mar 03, 2011 at 01:11:55PM +0000, Matthew Sackman wrote:
> I doubt that. #basic_message's routing_key became routing_keys when
> bug23483 landed.

Ahh but of course that'll only affect things if you're compiling the
latest default of the broker too. If you use the 2.3.1 broker with the
ez Mike uploaded, that should be fine.

Matthew

From david at rabbitmq.com  Thu Mar  3 13:36:47 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 03 Mar 2011 13:36:47 +0000
Subject: [rabbitmq-discuss] RabbitMQ latency and message lost issue.
In-Reply-To: <C9265FDC5DBE6249ADFA9B769D3D2A170118E76F56@EUMSGMAIL001.markit.partners>
	(Shixin Song's message of "Thu, 3 Mar 2011 13:53:32 +0100")
References: <C9265FDC5DBE6249ADFA9B769D3D2A170118E76F51@EUMSGMAIL001.markit.partners>
	<AANLkTim+pu_mFEKHViSw2=ScJH4iuCWCiSTsnk3r+kXF@mail.gmail.com>
	<C9265FDC5DBE6249ADFA9B769D3D2A170118E76F56@EUMSGMAIL001.markit.partners>
Message-ID: <yrv4cy64wwck0.fsf@dwragg.eng.vmware.com>

Hi Shixin,

Shixin Song <Shixin.Song at markit.com> writes:
> I get the general idea about how to deal with it. Now I am looking at
> the first solution which to tell rabbit drop the message when it's too
> old. I saw the sample code from the link indicating how to do it in
> Java. But I am using C client library at this moment.  It seems that
> there is no queue declare interface at this moment. Could you indicate
> me that how to do it in C library.

There is a amqp_queue_declare function in the librabbitmq API.  You can
find examples of its use in examples/amqp_listen.c and
tools/declare_queue.c.

What's not there is an example of how to pass a non-empty arguments
table.  You can find code that constructs tables in tests/test_tables.c,
so maybe you can figure it out from there.  If not, let me know, and
I'll put an example together.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From markjreed at gmail.com  Thu Mar  3 14:29:53 2011
From: markjreed at gmail.com (Mark J. Reed)
Date: Thu, 3 Mar 2011 09:29:53 -0500
Subject: [rabbitmq-discuss] Distribution model advice sought
In-Reply-To: <4D6F4211.2050709@rabbitmq.com>
References: <AANLkTinRydENc6Ve2MnsddX0EEewoaRzLDBJcAjo25ZR@mail.gmail.com>
	<4D6F4211.2050709@rabbitmq.com>
Message-ID: <AANLkTi=5goakZPbfoL_=5tX-92325eTwCV6FRm1ZZbyd@mail.gmail.com>

On Thu, Mar 3, 2011 at 2:24 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
>> Our initial design had a single exchange with N queues bound to it;
>> each of the M consumers then subscribes to one of the N queues.
>> Simple.
>
> How do you avoid the producer having to publish the message N times in this
> setting? I am asking because there is a new feature appearing in the next
> release that addresses that very problem :)

Fanout exchange.

> When a node goes down, taking all its queues with it, the clients connected
> to that node and consuming from the queues will have their connections torn
> down. They would notice that and could simply reconnect and redeclare the
> queues & bindings & their consumers.

The problem I'm seeing is that the surviving nodes seem to remember that
the queue was declared on the dead node and fail when attempting to
declare it again.

From matthias at rabbitmq.com  Thu Mar  3 14:32:29 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 03 Mar 2011 14:32:29 +0000
Subject: [rabbitmq-discuss] Distribution model advice sought
In-Reply-To: <AANLkTi=5goakZPbfoL_=5tX-92325eTwCV6FRm1ZZbyd@mail.gmail.com>
References: <AANLkTinRydENc6Ve2MnsddX0EEewoaRzLDBJcAjo25ZR@mail.gmail.com>	<4D6F4211.2050709@rabbitmq.com>
	<AANLkTi=5goakZPbfoL_=5tX-92325eTwCV6FRm1ZZbyd@mail.gmail.com>
Message-ID: <4D6FA67D.6000802@rabbitmq.com>

Mark,

On 03/03/11 14:29, Mark J. Reed wrote:
> On Thu, Mar 3, 2011 at 2:24 AM, Matthias Radestock
>> How do you avoid the producer having to publish the message N times in this
>> setting?
>
> Fanout exchange.

Ah, I didn't realise that each message goes to the same set of "topics". 
Yes, fanout is fine for that.

> The problem I'm seeing is that the surviving nodes seem to remember that
> the queue was declared on the dead node and fail when attempting to
> declare it again.

That should only happen when the queue is durable. Given that losing the 
odd message isn't a concern for you, it would make sense to declare the 
queues as non-durable.

Matthias.

From markjreed at gmail.com  Thu Mar  3 14:39:06 2011
From: markjreed at gmail.com (Mark J. Reed)
Date: Thu, 3 Mar 2011 09:39:06 -0500
Subject: [rabbitmq-discuss] Distribution model advice sought
In-Reply-To: <4D6FA67D.6000802@rabbitmq.com>
References: <AANLkTinRydENc6Ve2MnsddX0EEewoaRzLDBJcAjo25ZR@mail.gmail.com>
	<4D6F4211.2050709@rabbitmq.com>
	<AANLkTi=5goakZPbfoL_=5tX-92325eTwCV6FRm1ZZbyd@mail.gmail.com>
	<4D6FA67D.6000802@rabbitmq.com>
Message-ID: <AANLkTi=sYYjt_QAZXFeazB8VuvE2YGUe27orCRiiKMat@mail.gmail.com>

On Thu, Mar 3, 2011 at 9:32 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
>> The problem I'm seeing is that the surviving nodes seem to remember that
>> the queue was declared on the dead node and fail when attempting to
>> declare it again.
>
> That should only happen when the queue is durable. Given that losing the odd
> message isn't a concern for you, it would make sense to declare the queues
> as non-durable.

Hm; I'm not declaring the queue as durable.   Let me dig up some
detailed error/log output...



-- 
Mark J. Reed <markjreed at gmail.com>

From fabiomargarido at gmail.com  Thu Mar  3 14:41:42 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Thu, 3 Mar 2011 11:41:42 -0300
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <4D6F908E.2030209@rabbitmq.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
	<4D6EE8B2.6030507@rabbitmq.com>
	<AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>
	<4D6F908E.2030209@rabbitmq.com>
Message-ID: <AANLkTimo-XAOsd_paeJAbud=RpzertM8oEPDPLHdacO4@mail.gmail.com>

On Thu, Mar 3, 2011 at 09:58, Michael Bridgen <mikeb at rabbitmq.com> wrote:
>> This sounds really interesting. Is this the plugin Alister and Alexis
>> were talking about?
>
> I think so, although I'm surprised Alexis didn't know its name ..

Great!

> It's labeled "experimental", though it's dead simple and there are few
> moving parts. ?The biggest limitation you may face, *may* face, is that it's
> not written to be hugely scalable -- it just does the simplest thing
> possible.

I don't think scalability will be a big issue. There shouldn't be many
messages delivered through this exchange.

> I've uploaded an ez on github, which you can drop into
> rabbitmq-server/plugins/; it should work with v2.3.1 and default branch.
> ?It'll be easier than compiling it yourself.

That should make things easier, thank you very much. I'm not able to
download it though. Clicking the link brings this not very helpful
message: AccessDeniedAccess
Denied3E08616583BF12BFHF2krVMH53i4Ea8SXPND7pCE4VC3lGdOcDM0dhg96BFcax9OJ7BOBLaRHAUhU53i.
Thanks again.

From jiri at krutil.com  Thu Mar  3 15:20:47 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Thu, 03 Mar 2011 16:20:47 +0100
Subject: [rabbitmq-discuss] Message returned as unroutable even if
 consumer is listening
In-Reply-To: <AANLkTimBv+ior9wutznmsaRq4Wri9bQ9JgxKSxneBpE3@mail.gmail.com>
References: <20110302100217.19874p7t6ai1x02s@webmail.active24.cz>
	<AANLkTinkjK1cWMg3QO3wK=pNun_0i1mTR004DqCa53dE@mail.gmail.com>
	<20110303135556.38243zh5ypci64sg@webmail.active24.cz>
	<AANLkTimBv+ior9wutznmsaRq4Wri9bQ9JgxKSxneBpE3@mail.gmail.com>
Message-ID: <20110303162047.1040793h04ghorgg@webmail.active24.cz>

> Okay. You're probably using basic.qos and/or acknowledgments.

We are using both. QoS prefetch count is 100 and we do explicit acks.

But even if I restart our server and there is no load at all and the  
queue is empty, I'm still seeing this problem. Rabbitmqctl is showing  
messages_unacknowledged and messages_ready both to be zero.

I have no clue at all what could be wrong. Any hints?

Cheers
Jiri


From mikeb at rabbitmq.com  Thu Mar  3 15:55:08 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 03 Mar 2011 15:55:08 +0000
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTimo-XAOsd_paeJAbud=RpzertM8oEPDPLHdacO4@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>	<4D6EE8B2.6030507@rabbitmq.com>	<AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>	<4D6F908E.2030209@rabbitmq.com>
	<AANLkTimo-XAOsd_paeJAbud=RpzertM8oEPDPLHdacO4@mail.gmail.com>
Message-ID: <4D6FB9DC.2080800@rabbitmq.com>

>> I've uploaded an ez on github, which you can drop into
>> rabbitmq-server/plugins/; it should work with v2.3.1 and default branch.
>>   It'll be easier than compiling it yourself.
>
> That should make things easier, thank you very much. I'm not able to
> download it though. Clicking the link brings this not very helpful
> message: AccessDeniedAccess
> Denied3E08616583BF12BFHF2krVMH53i4Ea8SXPND7pCE4VC3lGdOcDM0dhg96BFcax9OJ7BOBLaRHAUhU53i.

Oh.  Looks like github's upload and download system is totally broken. 
(I've now tried to upload it a few times).

I've attached the ez so it can be stopped by mail filters instead.

mkb
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_lvc_plugin.ez
Type: application/andrew-inset
Size: 7526 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110303/4f34b9fc/attachment-0001.ez>

From glahiru at gmail.com  Thu Mar  3 16:19:17 2011
From: glahiru at gmail.com (Lahiru Gunathilake)
Date: Thu, 3 Mar 2011 21:49:17 +0530
Subject: [rabbitmq-discuss] How to configure with Qpid client
Message-ID: <AANLkTinjXLvzfU-4v3XE8KXtpfxnxgLWDdkTQ7jbX=Sz@mail.gmail.com>

Hi all,

Can someone please give some instructions on how to configure Qpid Java
client with Rabbit MQ ?

Lahiru
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110303/f76ea312/attachment.htm>

From majek04 at gmail.com  Thu Mar  3 17:00:16 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 3 Mar 2011 17:00:16 +0000
Subject: [rabbitmq-discuss] Message returned as unroutable even if
 consumer is listening
In-Reply-To: <20110303162047.1040793h04ghorgg@webmail.active24.cz>
References: <20110302100217.19874p7t6ai1x02s@webmail.active24.cz>
	<AANLkTinkjK1cWMg3QO3wK=pNun_0i1mTR004DqCa53dE@mail.gmail.com>
	<20110303135556.38243zh5ypci64sg@webmail.active24.cz>
	<AANLkTimBv+ior9wutznmsaRq4Wri9bQ9JgxKSxneBpE3@mail.gmail.com>
	<20110303162047.1040793h04ghorgg@webmail.active24.cz>
Message-ID: <AANLkTi=3jyV8mQsMJQWf80tOGArcdauqdBhbYCG8zrp9@mail.gmail.com>

On Thu, Mar 3, 2011 at 15:20, Jiri Krutil <jiri at krutil.com> wrote:
>> Okay. You're probably using basic.qos and/or acknowledgments.
>
> We are using both. QoS prefetch count is 100 and we do explicit acks.
>
> But even if I restart our server and there is no load at all and the queue
> is empty, I'm still seeing this problem. Rabbitmqctl is showing
> messages_unacknowledged and messages_ready both to be zero.
>
> I have no clue at all what could be wrong. Any hints?

And if you stop the consumer and disable the 'immediate' flag, can
you see messages to appear in the queue?

From fabiomargarido at gmail.com  Thu Mar  3 18:36:22 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Thu, 3 Mar 2011 15:36:22 -0300
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <4D6FB9DC.2080800@rabbitmq.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
	<4D6EE8B2.6030507@rabbitmq.com>
	<AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>
	<4D6F908E.2030209@rabbitmq.com>
	<AANLkTimo-XAOsd_paeJAbud=RpzertM8oEPDPLHdacO4@mail.gmail.com>
	<4D6FB9DC.2080800@rabbitmq.com>
Message-ID: <AANLkTi=rLYV90KSv4b8e=AcKiiukP=yPVy4vXLTpbCbA@mail.gmail.com>

On Thu, Mar 3, 2011 at 12:55, Michael Bridgen <mikeb at rabbitmq.com> wrote:
> Oh. ?Looks like github's upload and download system is totally broken. (I've
> now tried to upload it a few times).
>
> I've attached the ez so it can be stopped by mail filters instead.

Hi Michael.
Sorry for the extra trouble.

I've now rebooted my RabbitMQ server and run a few basic tests and
everything seems to be working as expected. Thank you again for all
your help and your work on the plugin. I'll keep building my test
scenarios and I'll let you know if something else comes up.

Just a final question: the previous README file on github said
something about including the plugin on the main RabbitMQ code, but I
figured this had been written some time ago because it mentioned
version 1.7.1. Is this still in your (and RabbitMQ developers) plans?
Best regards.

From markjreed at gmail.com  Thu Mar  3 22:02:00 2011
From: markjreed at gmail.com (Mark J. Reed)
Date: Thu, 3 Mar 2011 17:02:00 -0500
Subject: [rabbitmq-discuss] Distribution model advice sought
In-Reply-To: <AANLkTi=sYYjt_QAZXFeazB8VuvE2YGUe27orCRiiKMat@mail.gmail.com>
References: <AANLkTinRydENc6Ve2MnsddX0EEewoaRzLDBJcAjo25ZR@mail.gmail.com>
	<4D6F4211.2050709@rabbitmq.com>
	<AANLkTi=5goakZPbfoL_=5tX-92325eTwCV6FRm1ZZbyd@mail.gmail.com>
	<4D6FA67D.6000802@rabbitmq.com>
	<AANLkTi=sYYjt_QAZXFeazB8VuvE2YGUe27orCRiiKMat@mail.gmail.com>
Message-ID: <AANLkTikabYVeXVA_gd=G2c6-d4O3_2ER6NfDOwVO9zyo@mail.gmail.com>

> On Thu, Mar 3, 2011 at 9:32 AM, Matthias Radestock
> Hm; I'm not declaring the queue as durable.   Let me dig up some
> detailed error/log output...

OK, I tried a very simple test case.  Am I hitting a bug, or am I
wrong about how this should work?

I have a two-node cluster, both disk nodes, freshly reset.  I declare
a queue on one and publish to it, then pop the message off on the
other.  Then I bring the node with the queue down and try to declare
the queue on the other node.  This triggers an internal error (HTTP
541 response) and causes Rabbit to close the connection to the client
that tried to declare the queue.

Transcript with interleaved commentary and log contents below (sorry
if I should have attached them instead; not sure what the guidelines
are for this list).

This is 2.3.1 running on Ubuntu 10.04 x86_64.

ubuntu at rabbit1:~$ sudo rabbitmqctl status
Status of node rabbit at rabbit1 ...
[{running_applications,
     [{rabbit,"RabbitMQ","2.3.1"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {rabbit_management,"RabbitMQ Management Console","2.3.1"},
      {webmachine,"webmachine","1.7.0"},
      {rabbit_management_agent,"RabbitMQ Management Agent","2.3.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.3.1"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.3.1"},
      {mochiweb,"MochiMedia Web Server","1.3"},
      {inets,"INETS  CXC 138 49","5.2"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {nodes,[{disc,[rabbit at rabbit2,rabbit at rabbit1]}]},
 {running_nodes,[rabbit at rabbit2,rabbit at rabbit1]}]
...done.
ubuntu at rabbit1:~$ sudo rabbitmqctl list_queues
Listing queues ...
...done.

ubuntu at rabbit2:~$ sudo rabbitmqctl status
Status of node rabbit at rabbit2 ...
[{running_applications,
     [{rabbit,"RabbitMQ","2.3.1"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {rabbit_management,"RabbitMQ Management Console","2.3.1"},
      {webmachine,"webmachine","1.7.0"},
      {rabbit_management_agent,"RabbitMQ Management Agent","2.3.1"},
      {amqp_client,"RabbitMQ AMQP Client","2.3.1"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.3.1"},
      {mochiweb,"MochiMedia Web Server","1.3"},
      {inets,"INETS  CXC 138 49","5.2"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {nodes,[{disc,[rabbit at rabbit2,rabbit at rabbit1]}]},
 {running_nodes,[rabbit at rabbit1,rabbit at rabbit2]}]
...done.
ubuntu at rabbit2:~$ sudo rabbitmqctl list_queues
Listing queues ...
...done.

Declare and publish to a new queue:

ubuntu at rabbit1:~$ irb -rubygems -rbunny
irb(main):001:0> (b=Bunny.new).start
=> :connected
irb(main):002:0> b.queue('jiggleflop').publish("hello")
=> nil
irb(main):003:0> exit
ubuntu at rabbit1:~$ sudo rabbitmqctl list_queues name messages durable
Listing queues ...
jiggleflop    1       false
...done.


From matthias at rabbitmq.com  Thu Mar  3 22:11:02 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 03 Mar 2011 22:11:02 +0000
Subject: [rabbitmq-discuss] Distribution model advice sought
In-Reply-To: <AANLkTikabYVeXVA_gd=G2c6-d4O3_2ER6NfDOwVO9zyo@mail.gmail.com>
References: <AANLkTinRydENc6Ve2MnsddX0EEewoaRzLDBJcAjo25ZR@mail.gmail.com>	<4D6F4211.2050709@rabbitmq.com>	<AANLkTi=5goakZPbfoL_=5tX-92325eTwCV6FRm1ZZbyd@mail.gmail.com>	<4D6FA67D.6000802@rabbitmq.com>	<AANLkTi=sYYjt_QAZXFeazB8VuvE2YGUe27orCRiiKMat@mail.gmail.com>
	<AANLkTikabYVeXVA_gd=G2c6-d4O3_2ER6NfDOwVO9zyo@mail.gmail.com>
Message-ID: <4D7011F6.9020208@rabbitmq.com>

Mark,

Mark J. Reed wrote:
> OK, I tried a very simple test case.  Am I hitting a bug, or am I
> wrong about how this should work?
> 
> I have a two-node cluster, both disk nodes, freshly reset.  I declare
> a queue on one and publish to it, then pop the message off on the
> other.  Then I bring the node with the queue down and try to declare
> the queue on the other node.  This triggers an internal error (HTTP
> 541 response) and causes Rabbit to close the connection to the client
> that tried to declare the queue.

Ah yes. Same bug as 
http://old.nabble.com/Re%3A-Pika-reconnection-error-p30975002.html

Sorry, forgot about that one.

Matthias

From markjreed at gmail.com  Thu Mar  3 22:46:23 2011
From: markjreed at gmail.com (Mark J. Reed)
Date: Thu, 3 Mar 2011 17:46:23 -0500
Subject: [rabbitmq-discuss] Distribution model advice sought
In-Reply-To: <4D7011F6.9020208@rabbitmq.com>
References: <AANLkTinRydENc6Ve2MnsddX0EEewoaRzLDBJcAjo25ZR@mail.gmail.com>
	<4D6F4211.2050709@rabbitmq.com>
	<AANLkTi=5goakZPbfoL_=5tX-92325eTwCV6FRm1ZZbyd@mail.gmail.com>
	<4D6FA67D.6000802@rabbitmq.com>
	<AANLkTi=sYYjt_QAZXFeazB8VuvE2YGUe27orCRiiKMat@mail.gmail.com>
	<AANLkTikabYVeXVA_gd=G2c6-d4O3_2ER6NfDOwVO9zyo@mail.gmail.com>
	<4D7011F6.9020208@rabbitmq.com>
Message-ID: <AANLkTi=MY8z+OAzvFABjc6bKPPj9o4raHUfgJukRi+Fk@mail.gmail.com>

On Thu, Mar 3, 2011 at 5:11 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Ah yes. Same bug as
> http://old.nabble.com/Re%3A-Pika-reconnection-error-p30975002.html

OK, good, it's a bug.  So does that mean that, once that bug is fixed,
my app will work as designed?  Or will there still be problems with
clients not noticing that they need to redeclare the queue?



-- 
Mark J. Reed <markjreed at gmail.com>

From matthias at rabbitmq.com  Thu Mar  3 23:03:21 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 03 Mar 2011 23:03:21 +0000
Subject: [rabbitmq-discuss] Distribution model advice sought
In-Reply-To: <AANLkTi=MY8z+OAzvFABjc6bKPPj9o4raHUfgJukRi+Fk@mail.gmail.com>
References: <AANLkTinRydENc6Ve2MnsddX0EEewoaRzLDBJcAjo25ZR@mail.gmail.com>	<4D6F4211.2050709@rabbitmq.com>	<AANLkTi=5goakZPbfoL_=5tX-92325eTwCV6FRm1ZZbyd@mail.gmail.com>	<4D6FA67D.6000802@rabbitmq.com>	<AANLkTi=sYYjt_QAZXFeazB8VuvE2YGUe27orCRiiKMat@mail.gmail.com>	<AANLkTikabYVeXVA_gd=G2c6-d4O3_2ER6NfDOwVO9zyo@mail.gmail.com>	<4D7011F6.9020208@rabbitmq.com>
	<AANLkTi=MY8z+OAzvFABjc6bKPPj9o4raHUfgJukRi+Fk@mail.gmail.com>
Message-ID: <4D701E39.70408@rabbitmq.com>

Mark,

Mark J. Reed wrote:
> OK, good, it's a bug.  So does that mean that, once that bug is fixed,
> my app will work as designed?  Or will there still be problems with
> clients not noticing that they need to redeclare the queue?

Until we introduce the new feature I mentioned there is no way for 
clients to find out when their consumers become ineffective - whether 
that is because a queue got deleted or the node on which it resided went 
down, or any other reason.

Regards,

Matthias.

From gmr at myyearbook.com  Thu Mar  3 23:21:55 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 3 Mar 2011 18:21:55 -0500
Subject: [rabbitmq-discuss] VorpalBunny 0.2 Released
Message-ID: <3D8B99E56B4D4179ACC0CFAB07BD4944@myyearbook.com>

I'm pleased to announce the next release of VorpalBunny, the Basic.Publish over HTTP PHP client for the RabbitMQ JSON-RPC-Channel plug-in. 

0.2 is slightly less bleeding-edge than its previous version and is currently being used in our production environment on a specific message type that has a fairly low publishing velocity.

Changes:

- Increase timeouts for both JSON-RPC calls (3 seconds) and JSON-RPC Channels (5 minutes)
- Add multiple retry attempts on failure of opening a session or delivering a message
- Increase verbosity of exception messages

Download Links:

- tar.gz: https://github.com/myYearbook/VorpalBunny/tarball/0.2
- zip:  https://github.com/myYearbook/VorpalBunny/zipball/0.2

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110303/102ad1d6/attachment.htm>

From matthew at rabbitmq.com  Thu Mar  3 23:38:16 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 3 Mar 2011 23:38:16 +0000
Subject: [rabbitmq-discuss] Distribution model advice sought
In-Reply-To: <4D701E39.70408@rabbitmq.com>
References: <AANLkTinRydENc6Ve2MnsddX0EEewoaRzLDBJcAjo25ZR@mail.gmail.com>
	<4D6F4211.2050709@rabbitmq.com>
	<AANLkTi=5goakZPbfoL_=5tX-92325eTwCV6FRm1ZZbyd@mail.gmail.com>
	<4D6FA67D.6000802@rabbitmq.com>
	<AANLkTi=sYYjt_QAZXFeazB8VuvE2YGUe27orCRiiKMat@mail.gmail.com>
	<AANLkTikabYVeXVA_gd=G2c6-d4O3_2ER6NfDOwVO9zyo@mail.gmail.com>
	<4D7011F6.9020208@rabbitmq.com>
	<AANLkTi=MY8z+OAzvFABjc6bKPPj9o4raHUfgJukRi+Fk@mail.gmail.com>
	<4D701E39.70408@rabbitmq.com>
Message-ID: <20110303233814.GA31173@wellquite.org>

On Thu, Mar 03, 2011 at 11:03:21PM +0000, Matthias Radestock wrote:
> Mark J. Reed wrote:
> >OK, good, it's a bug.  So does that mean that, once that bug is fixed,
> >my app will work as designed?  Or will there still be problems with
> >clients not noticing that they need to redeclare the queue?
> 
> Until we introduce the new feature I mentioned there is no way for
> clients to find out when their consumers become ineffective -
> whether that is because a queue got deleted or the node on which it
> resided went down, or any other reason.

But that feature has been written, is pending a bit of tidying, and then
should make it for the next release.

Matthew

From markjreed at gmail.com  Thu Mar  3 23:54:24 2011
From: markjreed at gmail.com (Mark J. Reed)
Date: Thu, 3 Mar 2011 18:54:24 -0500
Subject: [rabbitmq-discuss] Distribution model advice sought
In-Reply-To: <4D701E39.70408@rabbitmq.com>
References: <AANLkTinRydENc6Ve2MnsddX0EEewoaRzLDBJcAjo25ZR@mail.gmail.com>
	<4D6F4211.2050709@rabbitmq.com>
	<AANLkTi=5goakZPbfoL_=5tX-92325eTwCV6FRm1ZZbyd@mail.gmail.com>
	<4D6FA67D.6000802@rabbitmq.com>
	<AANLkTi=sYYjt_QAZXFeazB8VuvE2YGUe27orCRiiKMat@mail.gmail.com>
	<AANLkTikabYVeXVA_gd=G2c6-d4O3_2ER6NfDOwVO9zyo@mail.gmail.com>
	<4D7011F6.9020208@rabbitmq.com>
	<AANLkTi=MY8z+OAzvFABjc6bKPPj9o4raHUfgJukRi+Fk@mail.gmail.com>
	<4D701E39.70408@rabbitmq.com>
Message-ID: <AANLkTi=YzGDn73VEnviKXHWwiHamijnp7kFMhi+Fn0bk@mail.gmail.com>

On Thu, Mar 3, 2011 at 6:03 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Until we introduce the new feature I mentioned there is no way for clients
> to find out when their consumers become ineffective - whether that is
> because a queue got deleted or the node on which it resided went down, or
> any other reason.

So basically, if a consumer declares queue A, then the consumer blocks
on receiving a message from that queue,  and then that queue goes away
before a message comes along, the consumer will not wake up.   Got it.

Thanks for the replies.  Very helpful.

-- 
Mark J. Reed <markjreed at gmail.com>

From mikeb at rabbitmq.com  Fri Mar  4 01:07:56 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 04 Mar 2011 01:07:56 +0000
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTi=rLYV90KSv4b8e=AcKiiukP=yPVy4vXLTpbCbA@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>	<4D6EE8B2.6030507@rabbitmq.com>	<AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>	<4D6F908E.2030209@rabbitmq.com>	<AANLkTimo-XAOsd_paeJAbud=RpzertM8oEPDPLHdacO4@mail.gmail.com>	<4D6FB9DC.2080800@rabbitmq.com>
	<AANLkTi=rLYV90KSv4b8e=AcKiiukP=yPVy4vXLTpbCbA@mail.gmail.com>
Message-ID: <4D703B6C.6010608@rabbitmq.com>

Fabio,

Aces, glad to hear it's working for you thus far.

On this:

 > Just a final question: the previous README file on github said
 > something about including the plugin on the main RabbitMQ code, but I
 > figured this had been written some time ago because it mentioned
 > version 1.7.1. Is this still in your (and RabbitMQ developers) plans?
 > Best regards.

  -- I was referring to the exchange plugin mechanism overall, on which 
I was finishing (largely other people's!) work at the time.  That 
mechanism has been in mainstream rabbitmq since then, and has changed a 
bit, but is pretty stable.

The Last Value Caching exchange will likely stay a plugin for the 
foreseeable future, rather than being baked into rabbitmq-server.  But 
if you follow this list you'll know this is not the last word ..

Michael

>> Oh.  Looks like github's upload and download system is totally broken. (I've
>> now tried to upload it a few times).
>>
>> I've attached the ez so it can be stopped by mail filters instead.
>
> Hi Michael.
> Sorry for the extra trouble.
>
> I've now rebooted my RabbitMQ server and run a few basic tests and
> everything seems to be working as expected. Thank you again for all
> your help and your work on the plugin. I'll keep building my test
> scenarios and I'll let you know if something else comes up.
>
> Just a final question: the previous README file on github said
> something about including the plugin on the main RabbitMQ code, but I
> figured this had been written some time ago because it mentioned
> version 1.7.1. Is this still in your (and RabbitMQ developers) plans?
> Best regards.


From gmr at myyearbook.com  Fri Mar  4 04:35:11 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 3 Mar 2011 23:35:11 -0500
Subject: [rabbitmq-discuss] Requested additions to amqp-rabbitmq-0.*.json
	file
Message-ID: <70CF4108D06347E29C2B10D7DFC6CF67@myyearbook.com>

Hi all, 

I have attached a hg generated diff of amqp-rabbitmq-0.8.json and amqp-rabbitmq-0.9.1.json that I hope is useful enough to others to make it into the main codegen json files.

This size is hardcoded in RabbitMQ src and various drivers, I'd like to add this, it's a logical addition to FRAME-MIN-SIZE which is already in the spec files.

FRAME-MAX-SIZE: 131072 

The base content frame end-frame delimiter character is specified in the spec json files (FRAME-END), in addition to this, it'd be useful to have:

FRAME-END-SIZE: 1, 
FRAME-HEADER-SIZE: 7

With these available from codegen, one can parse content frames with constants for offsets and lengths instead of hard-coded variables.

Please let me know if this has a chance to make it in, as I'd like to rely on this behavior in Pika.

Regards,

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110303/62b6307e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: codegen.diff
Type: application/octet-stream
Size: 1560 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110303/62b6307e/attachment.obj>

From sunil at shopsocially.com  Fri Mar  4 05:08:52 2011
From: sunil at shopsocially.com (Sunil Arora)
Date: Fri, 4 Mar 2011 10:38:52 +0530
Subject: [rabbitmq-discuss] RabbitMQ insights
Message-ID: <296497F3-0DD4-4096-BEB3-BB00802929BC@shopsocially.com>

Hi folks,

We have been using rabbitmq as a black box till now and we are observing consistent growth of memory footprint. So we want to analyze what's going on under the hood.

We want to explore how many messages are being consumed or pending daily? Where are our bottlenecks etc.

What is the best way to do it ?

Thanks
Sunil

From jerryk at vmware.com  Fri Mar  4 05:28:21 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Thu, 3 Mar 2011 21:28:21 -0800
Subject: [rabbitmq-discuss] RabbitMQ insights
In-Reply-To: <296497F3-0DD4-4096-BEB3-BB00802929BC@shopsocially.com>
References: <296497F3-0DD4-4096-BEB3-BB00802929BC@shopsocially.com>
Message-ID: <3CD1B2F1-256B-442E-AED3-422A8432E8EC@vmware.com>

You might want to investigate the management plugin, which you can find discussed on the Rabbit web site.  Using rabbitmqctl to list the various entities such as queues and inspect how many messages they contain and their states is also a good first step that doesn't require you to install anything...

Best regards
Jerry

Sent from my iPad.

On Mar 3, 2011, at 9:09 PM, "Sunil Arora" <sunil at shopsocially.com> wrote:

> Hi folks,
> 
> We have been using rabbitmq as a black box till now and we are observing consistent growth of memory footprint. So we want to analyze what's going on under the hood.
> 
> We want to explore how many messages are being consumed or pending daily? Where are our bottlenecks etc.
> 
> What is the best way to do it ?
> 
> Thanks
> Sunil
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From sameek at arosys.com  Fri Mar  4 05:51:02 2011
From: sameek at arosys.com (sam_mis)
Date: Thu, 3 Mar 2011 21:51:02 -0800 (PST)
Subject: [rabbitmq-discuss] can I create multiple channel for multiple
 thread work?
Message-ID: <31065140.post@talk.nabble.com>


Hi All

I have a problem/doubt with a rabbit queue .i used only one AMQP connection
and create the no. channels in respect to no. of thread.I need that 25
threads consume one rabbit queue.my publisher can put message onto the queue
and my thread consumer are listen the queue and do some processing on
message and again publish the process message into another queue,after
completion the above process he acknowledge.also i am using the 
channel.basicQos(1), one thread can get only one message until it
not  acknowledge.
it is correct way to do that?
-- 
View this message in context: http://old.nabble.com/can-I-create-multiple-channel-for-multiple-thread-work--tp31065140p31065140.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From abhishek.kona at gmail.com  Fri Mar  4 06:18:02 2011
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Fri, 04 Mar 2011 11:48:02 +0530
Subject: [rabbitmq-discuss] RabbitMQ insights
In-Reply-To: <3CD1B2F1-256B-442E-AED3-422A8432E8EC@vmware.com>
References: <296497F3-0DD4-4096-BEB3-BB00802929BC@shopsocially.com>
	<3CD1B2F1-256B-442E-AED3-422A8432E8EC@vmware.com>
Message-ID: <4D70841A.6020509@gmail.com>

Hey

If you are using Munin to monitor your systems, the RabbitMQ Munin 
Plugins is really useful (https://github.com/ask/rabbitmq-munin).
Thanks to Ask Solem Hoel for putting it up.

Underneath it uses RabbitMQ Ctl to get all stats.
We are monitoring per queue memory usage, connections maintained, 
un-acked messages  and more.

If you chose not to use munin still collecting all those numbers will be 
possible using RabbitMQCtl

-Abhishek Kona
On 04/03/11 10:58 AM, Jerry Kuch wrote:
> You might want to investigate the management plugin, which you can find discussed on the Rabbit web site.  Using rabbitmqctl to list the various entities such as queues and inspect how many messages they contain and their states is also a good first step that doesn't require you to install anything...
>
> Best regards
> Jerry
>
> Sent from my iPad.
>
> On Mar 3, 2011, at 9:09 PM, "Sunil Arora"<sunil at shopsocially.com>  wrote:
>
>> Hi folks,
>>
>> We have been using rabbitmq as a black box till now and we are observing consistent growth of memory footprint. So we want to analyze what's going on under the hood.
>>
>> We want to explore how many messages are being consumed or pending daily? Where are our bottlenecks etc.
>>
>> What is the best way to do it ?
>>
>> Thanks
>> Sunil
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From sameek at arosys.com  Fri Mar  4 06:33:04 2011
From: sameek at arosys.com (sam_mis)
Date: Thu, 3 Mar 2011 22:33:04 -0800 (PST)
Subject: [rabbitmq-discuss] How can get the queue depth?
In-Reply-To: <4D6F5ED2.1080108@rabbitmq.com>
References: <31056187.post@talk.nabble.com> <4D6F5ED2.1080108@rabbitmq.com>
Message-ID: <31065279.post@talk.nabble.com>


could you explain more detailed(idea,code) for using
Channel.queueDeclarePassive
.

Thanks


Michael Bridgen-3 wrote:
> 
>> I am using Java Client for Rabbitmq. I want know that how many messages
>> are
>> in the queue(total no. of message remaining in the queue) without reading
>> the message of the queue.
> 
> Using a passive declare (Channel.queueDeclarePassive in the Java client) 
> will give you the queue depth in the reply.
> 
> If you want to sample it often, it may be better to use the management 
> plugin.
> 
> Michael.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/How-can-get-the-queue-depth--tp31056187p31065279.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sunil at shopsocially.com  Fri Mar  4 08:17:41 2011
From: sunil at shopsocially.com (Sunil Arora)
Date: Fri, 4 Mar 2011 13:47:41 +0530
Subject: [rabbitmq-discuss] RabbitMQ insights
In-Reply-To: <4D70841A.6020509@gmail.com>
References: <296497F3-0DD4-4096-BEB3-BB00802929BC@shopsocially.com>
	<3CD1B2F1-256B-442E-AED3-422A8432E8EC@vmware.com>
	<4D70841A.6020509@gmail.com>
Message-ID: <D674D929-E431-4D46-AF37-48F55B79CE69@shopsocially.com>

Thanks Abhishek and Jerry,

Will explore your suggestions.

-Sunil
On 04-Mar-2011, at 11:48 AM, Abhishek Kona wrote:

> Hey
> 
> If you are using Munin to monitor your systems, the RabbitMQ Munin Plugins is really useful (https://github.com/ask/rabbitmq-munin).
> Thanks to Ask Solem Hoel for putting it up.
> 
> Underneath it uses RabbitMQ Ctl to get all stats.
> We are monitoring per queue memory usage, connections maintained, un-acked messages  and more.
> 
> If you chose not to use munin still collecting all those numbers will be possible using RabbitMQCtl
> 
> -Abhishek Kona
> On 04/03/11 10:58 AM, Jerry Kuch wrote:
>> You might want to investigate the management plugin, which you can find discussed on the Rabbit web site.  Using rabbitmqctl to list the various entities such as queues and inspect how many messages they contain and their states is also a good first step that doesn't require you to install anything...
>> 
>> Best regards
>> Jerry
>> 
>> Sent from my iPad.
>> 
>> On Mar 3, 2011, at 9:09 PM, "Sunil Arora"<sunil at shopsocially.com>  wrote:
>> 
>>> Hi folks,
>>> 
>>> We have been using rabbitmq as a black box till now and we are observing consistent growth of memory footprint. So we want to analyze what's going on under the hood.
>>> 
>>> We want to explore how many messages are being consumed or pending daily? Where are our bottlenecks etc.
>>> 
>>> What is the best way to do it ?
>>> 
>>> Thanks
>>> Sunil
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexandru at rabbitmq.com  Fri Mar  4 10:13:24 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 4 Mar 2011 12:13:24 +0200
Subject: [rabbitmq-discuss] How to configure with Qpid client
In-Reply-To: <AANLkTinjXLvzfU-4v3XE8KXtpfxnxgLWDdkTQ7jbX=Sz@mail.gmail.com>
References: <AANLkTinjXLvzfU-4v3XE8KXtpfxnxgLWDdkTQ7jbX=Sz@mail.gmail.com>
Message-ID: <20110304101324.GA2333@dakota.doc.ic.ac.uk>

Hi Lahiru,

We ran did some compatibility testing with the QPid clients a while ago.
The results are documented here:
  http://www.rabbitmq.com/interoperability.html

All in all, the situation was pretty bleak: due to a few bugs in the
then-current QPid release, most QPid clients were unusable with the
rabbit broker.

That said, we do pass most of their Python client tests, so it should be
possible to inter-operate.  I see they've done a new release in the
meantime, so you could try it out, but I see that all the clients in the
new release are billed as AMQP 0-10 (RabbitMQ supports 0-8 and 0-9-1).

The RabbitMQ broker is a compliant 0-8 and 0-9-1 broker, so no 
unusual configuration should be necessary.  Whether using it with a
QPid client will work or not is highly dependent on the version of QPid
used.

Hope this helps and please let us know how it goes.

Cheers,
Alex


On Thu, Mar 03, 2011 at 09:49:17PM +0530, Lahiru Gunathilake wrote:
> Hi all,
> 
> Can someone please give some instructions on how to configure Qpid Java
> client with Rabbit MQ ?
> 
> Lahiru

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From rasputnik at hellooperator.net  Fri Mar  4 11:19:29 2011
From: rasputnik at hellooperator.net (Dick Davies)
Date: Fri, 4 Mar 2011 11:19:29 +0000
Subject: [rabbitmq-discuss] STOMP authorization?
Message-ID: <AANLkTin9mBv-g-tnoJWb66UJQTdUdxkjQByLO2YMbBUO@mail.gmail.com>

Hi, I'm using the STOMP plugin happily with RabbitMQ 2.3.1.
Are there any configuration options to allow mapping STOMP topics to
AMQP 'backend' topics?

Reason I ask is I need to be able to define access control within RabbitMQ
to limit who can post to stomp topics, and currently seem unable to.

I may well be missing something, I'm fairly new to both STOMP and Rabbit.

From rob at rabbitmq.com  Fri Mar  4 11:29:13 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 04 Mar 2011 11:29:13 +0000
Subject: [rabbitmq-discuss] STOMP authorization?
In-Reply-To: <AANLkTin9mBv-g-tnoJWb66UJQTdUdxkjQByLO2YMbBUO@mail.gmail.com>
References: <AANLkTin9mBv-g-tnoJWb66UJQTdUdxkjQByLO2YMbBUO@mail.gmail.com>
Message-ID: <4D70CD09.3050405@rabbitmq.com>

Dick,

A STOMP SEND is translated into a basic.publish, so you can set up write 
permissions on the exchange that the publish is being sent to.

Which exchange to choose will depend on the STOMP destination type you 
are using. I'm guessing that you're using /topic destinations - these 
are mapped to the amq.topic destination so setting up the correct write 
permissions on that exchange should work for you.

If you are using /queue destinations, these are mapped on to the default 
exchange.

Obviously, /exchange/<name> destinations are mapped on to the named 
exchange.

Hope this helps,

Rob

On 04/03/11 11:19, Dick Davies wrote:
> Hi, I'm using the STOMP plugin happily with RabbitMQ 2.3.1.
> Are there any configuration options to allow mapping STOMP topics to
> AMQP 'backend' topics?
>
> Reason I ask is I need to be able to define access control within RabbitMQ
> to limit who can post to stomp topics, and currently seem unable to.
>
> I may well be missing something, I'm fairly new to both STOMP and Rabbit.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From rob at rabbitmq.com  Fri Mar  4 11:32:00 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 04 Mar 2011 11:32:00 +0000
Subject: [rabbitmq-discuss] How can get the queue depth?
In-Reply-To: <31065279.post@talk.nabble.com>
References: <31056187.post@talk.nabble.com> <4D6F5ED2.1080108@rabbitmq.com>
	<31065279.post@talk.nabble.com>
Message-ID: <4D70CDB0.8050809@rabbitmq.com>

Try:

Channel c = createChannel();
AMQP.Queue.DeclareOK ok = c.queueDeclarePassive("my.queue");
int messageCount = ok.getMessageCount();


On 04/03/11 06:33, sam_mis wrote:
> could you explain more detailed(idea,code) for using
> Channel.queueDeclarePassive
> .
>
> Thanks
>
>
> Michael Bridgen-3 wrote:
>>> I am using Java Client for Rabbitmq. I want know that how many messages
>>> are
>>> in the queue(total no. of message remaining in the queue) without reading
>>> the message of the queue.
>> Using a passive declare (Channel.queueDeclarePassive in the Java client)
>> will give you the queue depth in the reply.
>>
>> If you want to sample it often, it may be better to use the management
>> plugin.
>>
>> Michael.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>


From rob at rabbitmq.com  Fri Mar  4 11:35:25 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 04 Mar 2011 11:35:25 +0000
Subject: [rabbitmq-discuss] can I create multiple channel for multiple
 thread work?
In-Reply-To: <31065140.post@talk.nabble.com>
References: <31065140.post@talk.nabble.com>
Message-ID: <4D70CE7D.7080607@rabbitmq.com>

Creating a single connection and having ~25 channels will be perfectly 
fine.

I recommend using QueueingConsumer for each of the consumers on these 
channels to prevent any possible deadlock problems.

Setting channel.basicQos(1) will mean that your consumers get 
approximately fair distribution of the work, but you should ensure that 
you are using autoAck=false when setting up the consumer otherwise QoS 
settings are ignored.

Rob

On 04/03/11 05:51, sam_mis wrote:
> Hi All
>
> I have a problem/doubt with a rabbit queue .i used only one AMQP connection
> and create the no. channels in respect to no. of thread.I need that 25
> threads consume one rabbit queue.my publisher can put message onto the queue
> and my thread consumer are listen the queue and do some processing on
> message and again publish the process message into another queue,after
> completion the above process he acknowledge.also i am using the
> channel.basicQos(1), one thread can get only one message until it
> not  acknowledge.
> it is correct way to do that?


From sameek at arosys.com  Fri Mar  4 12:25:15 2011
From: sameek at arosys.com (sam_mis)
Date: Fri, 4 Mar 2011 04:25:15 -0800 (PST)
Subject: [rabbitmq-discuss] can I create multiple channel for multiple
 thread work?
In-Reply-To: <4D70CE7D.7080607@rabbitmq.com>
References: <31065140.post@talk.nabble.com> <4D70CE7D.7080607@rabbitmq.com>
Message-ID: <31067190.post@talk.nabble.com>


I have some doubt when the threads are reading messages from a queue.i want
to make it sure that one message is will be read by only one thread not
twice again.Is it required  some other configuration ?

Thanks 



Rob Harrop-5 wrote:
> 
> Creating a single connection and having ~25 channels will be perfectly 
> fine.
> 
> I recommend using QueueingConsumer for each of the consumers on these 
> channels to prevent any possible deadlock problems.
> 
> Setting channel.basicQos(1) will mean that your consumers get 
> approximately fair distribution of the work, but you should ensure that 
> you are using autoAck=false when setting up the consumer otherwise QoS 
> settings are ignored.
> 
> Rob
> 
> On 04/03/11 05:51, sam_mis wrote:
>> Hi All
>>
>> I have a problem/doubt with a rabbit queue .i used only one AMQP
>> connection
>> and create the no. channels in respect to no. of thread.I need that 25
>> threads consume one rabbit queue.my publisher can put message onto the
>> queue
>> and my thread consumer are listen the queue and do some processing on
>> message and again publish the process message into another queue,after
>> completion the above process he acknowledge.also i am using the
>> channel.basicQos(1), one thread can get only one message until it
>> not  acknowledge.
>> it is correct way to do that?
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/can-I-create-multiple-channel-for-multiple-thread-work--tp31065140p31067190.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From gmr at myyearbook.com  Fri Mar  4 12:33:05 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Fri, 4 Mar 2011 07:33:05 -0500
Subject: [rabbitmq-discuss] can I create multiple channel for multiple
	thread work?
In-Reply-To: <31067190.post@talk.nabble.com>
References: <31065140.post@talk.nabble.com> <4D70CE7D.7080607@rabbitmq.com>
	<31067190.post@talk.nabble.com>
Message-ID: <E61A53F3-BC7B-4C53-A6D0-6137D1B69169@myyearbook.com>

What client library are you using?

On Mar 4, 2011, at 7:25 AM, sam_mis <sameek at arosys.com> wrote:

> 
> I have some doubt when the threads are reading messages from a queue.i want
> to make it sure that one message is will be read by only one thread not
> twice again.Is it required  some other configuration ?
> 
> Thanks 
> 
> 
> 
> Rob Harrop-5 wrote:
>> 
>> Creating a single connection and having ~25 channels will be perfectly 
>> fine.
>> 
>> I recommend using QueueingConsumer for each of the consumers on these 
>> channels to prevent any possible deadlock problems.
>> 
>> Setting channel.basicQos(1) will mean that your consumers get 
>> approximately fair distribution of the work, but you should ensure that 
>> you are using autoAck=false when setting up the consumer otherwise QoS 
>> settings are ignored.
>> 
>> Rob
>> 
>> On 04/03/11 05:51, sam_mis wrote:
>>> Hi All
>>> 
>>> I have a problem/doubt with a rabbit queue .i used only one AMQP
>>> connection
>>> and create the no. channels in respect to no. of thread.I need that 25
>>> threads consume one rabbit queue.my publisher can put message onto the
>>> queue
>>> and my thread consumer are listen the queue and do some processing on
>>> message and again publish the process message into another queue,after
>>> completion the above process he acknowledge.also i am using the
>>> channel.basicQos(1), one thread can get only one message until it
>>> not  acknowledge.
>>> it is correct way to do that?
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> -- 
> View this message in context: http://old.nabble.com/can-I-create-multiple-channel-for-multiple-thread-work--tp31065140p31067190.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jiri at krutil.com  Fri Mar  4 13:03:55 2011
From: jiri at krutil.com (Jiri Krutil)
Date: Fri, 04 Mar 2011 14:03:55 +0100
Subject: [rabbitmq-discuss] Message returned as unroutable even if
 consumer is listening
In-Reply-To: <AANLkTi=3jyV8mQsMJQWf80tOGArcdauqdBhbYCG8zrp9@mail.gmail.com>
References: <20110302100217.19874p7t6ai1x02s@webmail.active24.cz>
	<AANLkTinkjK1cWMg3QO3wK=pNun_0i1mTR004DqCa53dE@mail.gmail.com>
	<20110303135556.38243zh5ypci64sg@webmail.active24.cz>
	<AANLkTimBv+ior9wutznmsaRq4Wri9bQ9JgxKSxneBpE3@mail.gmail.com>
	<20110303162047.1040793h04ghorgg@webmail.active24.cz>
	<AANLkTi=3jyV8mQsMJQWf80tOGArcdauqdBhbYCG8zrp9@mail.gmail.com>
Message-ID: <20110304140355.10216zaa5dy1ot8g@webmail.active24.cz>

> And if you stop the consumer and disable the 'immediate' flag, can
> you see messages to appear in the queue?

Even with the immediate flag disabled the messages would still not  
enqueue on the broker.

However, we have reinstalled the broker from scratch on this one  
problematic box and the problem went away...


From michael.s.klishin at gmail.com  Sat Mar  5 00:52:52 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 5 Mar 2011 03:52:52 +0300
Subject: [rabbitmq-discuss] What is internal parameter of exchange.declare
	for?
Message-ID: <AANLkTi=7ha-yvdL51QOpV2F5mZDt0M_GE-y58ccO8T_J@mail.gmail.com>

Hi,

In amqp-rabbitmq-0.9.1.json file used by code generator I see that
exchange.declare has internal parameter:

{"type": "bit", "name": "internal", "default-value": false}

and it does, indeed, appear in Erlang framing code. AMQP 0.9.1 protocol
documentation [1] simply mentions 3 reserved parameters
without saying anything about them (even domain is not specified).

As far as I understand, this is something implementation-specific. Can
someone from RabbitMQ team shed some light
on this parameter?

Thank you.

[1] http://bit.ly/htCzCX

-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110305/bfcc7d5f/attachment.htm>

From alexandru at rabbitmq.com  Sat Mar  5 01:07:23 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Sat, 5 Mar 2011 03:07:23 +0200
Subject: [rabbitmq-discuss] What is internal parameter of
 exchange.declare for?
In-Reply-To: <AANLkTi=7ha-yvdL51QOpV2F5mZDt0M_GE-y58ccO8T_J@mail.gmail.com>
References: <AANLkTi=7ha-yvdL51QOpV2F5mZDt0M_GE-y58ccO8T_J@mail.gmail.com>
Message-ID: <20110305010723.GA2354@dakota.doc.ic.ac.uk>

Hi,

The first hint is in rabbitmqctl's manpage:
  http://www.rabbitmq.com/man/rabbitmqctl.1.man.html

  ``internal
    Whether the exchange is internal, i.e. cannot be directly published to
    by a client.''

Which raises the question, ``Why on earth would you have an exchange
that cannot be published to?''.  The answer is exchange-to-exchange
bindings:
  http://www.rabbitmq.com/extensions.html#exchange-bindings

And here's the blogpost that sheds a little more light on the subject:
  http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/

Hope this helps.

Cheers,
Alex

On Sat, Mar 05, 2011 at 03:52:52AM +0300, Michael Klishin wrote:
> Hi,
> 
> In amqp-rabbitmq-0.9.1.json file used by code generator I see that
> exchange.declare has internal parameter:
> 
> {"type": "bit", "name": "internal", "default-value": false}
> 
> and it does, indeed, appear in Erlang framing code. AMQP 0.9.1 protocol
> documentation [1] simply mentions 3 reserved parameters
> without saying anything about them (even domain is not specified).
> 
> As far as I understand, this is something implementation-specific. Can
> someone from RabbitMQ team shed some light
> on this parameter?
> 
> Thank you.
> 
> [1] http://bit.ly/htCzCX
> 
> -- 
> MK

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Sat Mar  5 01:20:01 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sat, 05 Mar 2011 01:20:01 +0000
Subject: [rabbitmq-discuss] What is internal parameter of
 exchange.declare for?
In-Reply-To: <20110305010723.GA2354@dakota.doc.ic.ac.uk>
References: <AANLkTi=7ha-yvdL51QOpV2F5mZDt0M_GE-y58ccO8T_J@mail.gmail.com>
	<20110305010723.GA2354@dakota.doc.ic.ac.uk>
Message-ID: <4D718FC1.3020705@rabbitmq.com>

On 05/03/2011 1:07AM, Alexandru Scvor?ov wrote:
> Hi,
>
> The first hint is in rabbitmqctl's manpage:
>    http://www.rabbitmq.com/man/rabbitmqctl.1.man.html
>
>    ``internal
>      Whether the exchange is internal, i.e. cannot be directly published to
>      by a client.''
>
> Which raises the question, ``Why on earth would you have an exchange
> that cannot be published to?''.  The answer is exchange-to-exchange
> bindings:
>    http://www.rabbitmq.com/extensions.html#exchange-bindings
>
> And here's the blogpost that sheds a little more light on the subject:
>    http://www.rabbitmq.com/blog/2010/10/19/exchange-to-exchange-bindings/

Some history:

"internal" was originally specified in AMQP 0-8. The 0-8 spec says:

       If set, the exchange may not be used directly by publishers, but
       only when bound to other exchanges. Internal exchanges are used to
       construct wiring that is not visible to applications.

This was deprecated in AMQP 0-9-1, which is why it shows up as 
"reserved-3". It was deprecated since neither AMQP 0-8 or 0-9-1 have the 
concept of exchange to exchange bindings (despite the strong 
implications of the above quote!)

When we implemented exchange to exchange bindings as an extension to 
AMQP 0-9-1 we decided to implement internal exchanges despite the 
deprecation, as they are now useful.

Similarly, "reserved-2" in 0-9-1's exchange.declare corresponds to 0-8's 
"auto-delete" field. This means "delete the exchange when something has 
bound to it and then everything has unbound from it", which again only 
really makes sense in the context of exchange to exchange bindings, so 
again we've effectively undeprecated it.

"reserved-1" corresponds to the "ticket" field that's on most methods 
which was an attempt to optimise access control. We still ignore that.

Cheers, Simon

From michael.s.klishin at gmail.com  Sat Mar  5 01:33:30 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 5 Mar 2011 04:33:30 +0300
Subject: [rabbitmq-discuss] What is internal parameter of
	exchange.declare for?
In-Reply-To: <20110305010723.GA2354@dakota.doc.ic.ac.uk>
References: <AANLkTi=7ha-yvdL51QOpV2F5mZDt0M_GE-y58ccO8T_J@mail.gmail.com>
	<20110305010723.GA2354@dakota.doc.ic.ac.uk>
Message-ID: <AANLkTi=n5vSBQb2oQfqAoQj6-MYcTtpZpQWoEs+0G9JR@mail.gmail.com>

2011/3/5 Alexandru Scvor?ov

> Hope this helps.


Definitely does, thank you!
-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110305/e3e8cc3b/attachment-0001.htm>

From taicki at gmail.com  Sun Mar  6 02:07:15 2011
From: taicki at gmail.com (Taek Joo Kim)
Date: Sat, 5 Mar 2011 21:07:15 -0500
Subject: [rabbitmq-discuss] Question about new pika usage
Message-ID: <AANLkTi=HeCxtGNr_COYAUBjcjnS1fmnX6Pvcbxqbn91x@mail.gmail.com>

Hi, all.

In pika 0.5.2, I created multiple connections to rabbitmq, then made a
socket map and passed it to pika.asyncore_loop(). Then I could poll
multiple sockets. In pika 0.9.x, I saw the source code, but did not
find the way to do this. The purpose of making multiple connections is
to subscribe multiple queues.

I have two questions.
1. Is this a proper way to subscribe multiple queues?
2. If it is, is there any way to do this in 0.9.x?

Thanks,
Taek

From gmr at myyearbook.com  Sun Mar  6 02:14:30 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sat, 5 Mar 2011 21:14:30 -0500
Subject: [rabbitmq-discuss] Question about new pika usage
In-Reply-To: <AANLkTi=HeCxtGNr_COYAUBjcjnS1fmnX6Pvcbxqbn91x@mail.gmail.com>
References: <AANLkTi=HeCxtGNr_COYAUBjcjnS1fmnX6Pvcbxqbn91x@mail.gmail.com>
Message-ID: <D9F2471F31824AC8A3148629D8D68A0A@myyearbook.com>


On Saturday, March 5, 2011 at 9:07 PM, Taek Joo Kim wrote: 
> Hi, all.
> 
> In pika 0.5.2, I created multiple connections to rabbitmq, then made a
> socket map and passed it to pika.asyncore_loop(). Then I could poll
> multiple sockets. In pika 0.9.x, I saw the source code, but did not
> find the way to do this. The purpose of making multiple connections is
> to subscribe multiple queues.
> 
> I have two questions.
> 1. Is this a proper way to subscribe multiple queues?
Just issue multiple channel.basic_consume commands to different queues with different callback mechanisms with any of the async connection adapters. You do not need multiple connections or channels to consume multiple queues.

With BlockingConnection there will be support for multiple queue consumers in the next release. 
> 2. If it is, is there any way to do this in 0.9.x?
> 

Check out the documentation at http://tonyg.github.com/pika, if it's not straight forward on how to get the 2nd queue consumer going, let me know.

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110305/19465fc0/attachment.htm>

From taicki at gmail.com  Sun Mar  6 02:31:30 2011
From: taicki at gmail.com (Taek Joo Kim)
Date: Sat, 5 Mar 2011 21:31:30 -0500
Subject: [rabbitmq-discuss] Question about new pika usage
In-Reply-To: <D9F2471F31824AC8A3148629D8D68A0A@myyearbook.com>
References: <AANLkTi=HeCxtGNr_COYAUBjcjnS1fmnX6Pvcbxqbn91x@mail.gmail.com>
	<D9F2471F31824AC8A3148629D8D68A0A@myyearbook.com>
Message-ID: <AANLkTinxP3+g=Aw=_fLA9mHEg8N9W1azpVwU7hFKs_TV@mail.gmail.com>

On Sat, Mar 5, 2011 at 9:14 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

>
>  On Saturday, March 5, 2011 at 9:07 PM, Taek Joo Kim wrote:
>
> Hi, all.
>
> In pika 0.5.2, I created multiple connections to rabbitmq, then made a
> socket map and passed it to pika.asyncore_loop(). Then I could poll
> multiple sockets. In pika 0.9.x, I saw the source code, but did not
> find the way to do this. The purpose of making multiple connections is
> to subscribe multiple queues.
>
> I have two questions.
> 1. Is this a proper way to subscribe multiple queues?
>
> Just issue multiple channel.basic_consume commands to different queues with
> different callback mechanisms with any of the async connection adapters.
>  You do not need multiple connections or channels to consume multiple
> queues.
>
> With BlockingConnection there will be support for multiple queue consumers
> in the next release.
>

Thank you for the answer. I just did a simple test and it seems to work.

The reason I made multiple connections is that getting items from several
queues did not work well when I created one connection and multiple channels
from that one connection. At that time I called channel.basic_consume in
each channel. So instead I created multiple connections and had one channel
from each.

Taek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110305/cfc2b15f/attachment.htm>

From sameek at arosys.com  Mon Mar  7 03:39:59 2011
From: sameek at arosys.com (sam_mis)
Date: Sun, 6 Mar 2011 19:39:59 -0800 (PST)
Subject: [rabbitmq-discuss] can I create multiple channel for multiple
 thread work?
In-Reply-To: <E61A53F3-BC7B-4C53-A6D0-6137D1B69169@myyearbook.com>
References: <31065140.post@talk.nabble.com> <4D70CE7D.7080607@rabbitmq.com>
	<31067190.post@talk.nabble.com>
	<E61A53F3-BC7B-4C53-A6D0-6137D1B69169@myyearbook.com>
Message-ID: <31084682.post@talk.nabble.com>


I am using rabbitmq-java-client-2.0.0.

Gavin M. Roy-3 wrote:
> 
> What client library are you using?
> 
> On Mar 4, 2011, at 7:25 AM, sam_mis <sameek at arosys.com> wrote:
> 
>> 
>> I have some doubt when the threads are reading messages from a queue.i
>> want
>> to make it sure that one message is will be read by only one thread not
>> twice again.Is it required  some other configuration ?
>> 
>> Thanks 
>> 
>> 
>> 
>> Rob Harrop-5 wrote:
>>> 
>>> Creating a single connection and having ~25 channels will be perfectly 
>>> fine.
>>> 
>>> I recommend using QueueingConsumer for each of the consumers on these 
>>> channels to prevent any possible deadlock problems.
>>> 
>>> Setting channel.basicQos(1) will mean that your consumers get 
>>> approximately fair distribution of the work, but you should ensure that 
>>> you are using autoAck=false when setting up the consumer otherwise QoS 
>>> settings are ignored.
>>> 
>>> Rob
>>> 
>>> On 04/03/11 05:51, sam_mis wrote:
>>>> Hi All
>>>> 
>>>> I have a problem/doubt with a rabbit queue .i used only one AMQP
>>>> connection
>>>> and create the no. channels in respect to no. of thread.I need that 25
>>>> threads consume one rabbit queue.my publisher can put message onto the
>>>> queue
>>>> and my thread consumer are listen the queue and do some processing on
>>>> message and again publish the process message into another queue,after
>>>> completion the above process he acknowledge.also i am using the
>>>> channel.basicQos(1), one thread can get only one message until it
>>>> not  acknowledge.
>>>> it is correct way to do that?
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> 
>> 
>> -- 
>> View this message in context:
>> http://old.nabble.com/can-I-create-multiple-channel-for-multiple-thread-work--tp31065140p31067190.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/can-I-create-multiple-channel-for-multiple-thread-work--tp31065140p31084682.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From donal.lhooo at gmail.com  Mon Mar  7 09:56:07 2011
From: donal.lhooo at gmail.com (Rachmad Dony Rudiyantoro)
Date: Mon, 7 Mar 2011 16:56:07 +0700
Subject: [rabbitmq-discuss] SSL client error using 2.3.1
Message-ID: <AANLkTi=WD0vafz+15YHvXU2mFXWWuvx1h28CmkC+Ltkc@mail.gmail.com>

Hallo,

I have a problem with RabbitMQ using SSL. I can use SSL over a local
network or 'localhost'. But I can not use it through the Internet.
Here is a log from Rabbitmq Server:

=INFO REPORT==== 7-Mar-2011::13:35:00 ===
starting TCP connection <0.389.0> from 222.124.46.13:21522

=ERROR REPORT==== 7-Mar-2011::13:35:05 ===
error on TCP connection <0.389.0>:{ssl_upgrade_error,timeout}

=INFO REPORT==== 7-Mar-2011::13:35:05 ===
closing TCP connection <0.389.0>


and log from Java client :

javax.net.ssl.SSLHandshakeException: Remote host closed connection
during handshake
       at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:837)
       at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1158)
       at sun.security.ssl.SSLSocketImpl.writeRecord(SSLSocketImpl.java:652)
       at sun.security.ssl.AppOutputStream.write(AppOutputStream.java:78)
       at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:82)
       at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:140)
       at java.io.DataOutputStream.flush(DataOutputStream.java:123)
       at com.rabbitmq.client.impl.SocketFrameHandler.sendHeader(SocketFrameHandler.java:117)
       at com.rabbitmq.client.impl.SocketFrameHandler.sendHeader(SocketFrameHandler.java:130)
       at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:235)
       at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:383)
       at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:403)
       at ExampleWithSSL.main(ExampleWithSSL.java:59)
Caused by: java.io.EOFException: SSL peer shut down incorrectly
       at sun.security.ssl.InputRecord.read(InputRecord.java:352)
       at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:818)


My SSL configuration is as follows:

[
 {rabbit, [
    {ssl_listeners, [{"0.0.0.0",5671}]},
    {ssl_options, [{cacertfile,"/opt/ssl/demoCA/cacert.pem"},
                   {certfile,"/opt/ssl/server/cert.pem"},
                   {keyfile,"/opt/ssl/server/key.pem"},
                   {verify,verify_peer},
                   {fail_if_no_peer_cert,false}]}
  ]}
].


I am using RabbitMQ 2.3.1 and Erlang R14B01.


Thanks,

Rachmad Doni R.

From emile at rabbitmq.com  Mon Mar  7 10:50:27 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 07 Mar 2011 10:50:27 +0000
Subject: [rabbitmq-discuss] AlreadyClosedException
In-Reply-To: <507F97A0-248E-4CAB-B277-AB72B4C4EDE8@ll.mit.edu>
References: <507F97A0-248E-4CAB-B277-AB72B4C4EDE8@ll.mit.edu>
Message-ID: <4D74B873.50001@rabbitmq.com>

Hi Yican,

On 02/03/11 15:25, Cao, Yican - 0661 - MITLL wrote:
> Hi,
>
> I am experiencing this exception occasionally/randomly.
>
> 13:54:37,014 ERROR [processor.Logger (248)] Failed delivery for exchangeId: ID-testvm-45688-1297943230354-0-225. Exhausted after delivery attempt: 1 caught: com.rabbitmq.client.AlreadyClosedException: clean connection shutdown; reason: Attempt to use closed channel
> com.rabbitmq.client.AlreadyClosedException: clean connection shutdown; reason: Attempt to use closed channel
> 	at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:195)
> 	at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:290)
> 	at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:470)
> 	at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:457)

Was anything logged to the broker logfile? It is possible that the 
broker closed the connection because a protocol error occurred. The 
reason should appear in the logfile.



Regards

Emile


From matthias at rabbitmq.com  Mon Mar  7 11:02:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 07 Mar 2011 11:02:01 +0000
Subject: [rabbitmq-discuss] Requested additions to
 amqp-rabbitmq-0.*.json file
In-Reply-To: <70CF4108D06347E29C2B10D7DFC6CF67@myyearbook.com>
References: <70CF4108D06347E29C2B10D7DFC6CF67@myyearbook.com>
Message-ID: <4D74BB29.2080404@rabbitmq.com>

Gavin,

On 04/03/11 04:35, Gavin M. Roy wrote:
> I have attached a hg generated diff of amqp-rabbitmq-0.8.json and
> amqp-rabbitmq-0.9.1.json that I hope is useful enough to others to make
> it into the main codegen json files.
>
> This size is hardcoded in RabbitMQ src and various drivers, I'd like to
> add this, it's a logical addition to FRAME-MIN-SIZE which is already in
> the spec files.
>
> FRAME-MAX-SIZE: 131072

There is no FRAME-MAX-SIZE defined in the spec. The only reason the 
rabbit broker uses the above value in negotiation is that a) some 
clients (notably some versions of qpid) break when given 0 (i.e. 
"unlimited"), and b) some clients break when given 2^32-1.

> in addition to this, it'd be useful to have:
>
> FRAME-END-SIZE: 1,
> FRAME-HEADER-SIZE: 7
>
> With these available from codegen, one can parse content frames with
> constants for offsets and lengths instead of hard-coded variables.

The above constants are intimately tied to the framing layer of the AMQP 
codec. That layer is defined in the main AMQP spec document, not the 
XML/json.

Regards,

Matthias.

From rob at rabbitmq.com  Mon Mar  7 16:57:46 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Mon, 7 Mar 2011 16:57:46 +0000
Subject: [rabbitmq-discuss] can I create multiple channel for multiple
	thread work?
In-Reply-To: <31084682.post@talk.nabble.com>
References: <31065140.post@talk.nabble.com> <4D70CE7D.7080607@rabbitmq.com>
	<31067190.post@talk.nabble.com>
	<E61A53F3-BC7B-4C53-A6D0-6137D1B69169@myyearbook.com>
	<31084682.post@talk.nabble.com>
Message-ID: <A5120AD6-2CA9-4AAC-8DF6-A4E3CAECCAB2@rabbitmq.com>

If all the consumers are attached to the same queue then only one of them will see a given message from that queue.

The number of threads involved has no bearing on this. If you are seeing unexpected behaviour you should check that multiple copies of a message are not finding their way into the queue. Also, you should try upgrading to the latest Java client.

Regards,

Rob

On 7 Mar 2011, at 03:39, sam_mis <sameek at arosys.com> wrote:

> 
> I am using rabbitmq-java-client-2.0.0.
> 
> Gavin M. Roy-3 wrote:
>> 
>> What client library are you using?
>> 
>> On Mar 4, 2011, at 7:25 AM, sam_mis <sameek at arosys.com> wrote:
>> 
>>> 
>>> I have some doubt when the threads are reading messages from a queue.i
>>> want
>>> to make it sure that one message is will be read by only one thread not
>>> twice again.Is it required  some other configuration ?
>>> 
>>> Thanks 
>>> 
>>> 
>>> 
>>> Rob Harrop-5 wrote:
>>>> 
>>>> Creating a single connection and having ~25 channels will be perfectly 
>>>> fine.
>>>> 
>>>> I recommend using QueueingConsumer for each of the consumers on these 
>>>> channels to prevent any possible deadlock problems.
>>>> 
>>>> Setting channel.basicQos(1) will mean that your consumers get 
>>>> approximately fair distribution of the work, but you should ensure that 
>>>> you are using autoAck=false when setting up the consumer otherwise QoS 
>>>> settings are ignored.
>>>> 
>>>> Rob
>>>> 
>>>> On 04/03/11 05:51, sam_mis wrote:
>>>>> Hi All
>>>>> 
>>>>> I have a problem/doubt with a rabbit queue .i used only one AMQP
>>>>> connection
>>>>> and create the no. channels in respect to no. of thread.I need that 25
>>>>> threads consume one rabbit queue.my publisher can put message onto the
>>>>> queue
>>>>> and my thread consumer are listen the queue and do some processing on
>>>>> message and again publish the process message into another queue,after
>>>>> completion the above process he acknowledge.also i am using the
>>>>> channel.basicQos(1), one thread can get only one message until it
>>>>> not  acknowledge.
>>>>> it is correct way to do that?
>>>> 
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> 
>>> 
>>> -- 
>>> View this message in context:
>>> http://old.nabble.com/can-I-create-multiple-channel-for-multiple-thread-work--tp31065140p31067190.html
>>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> -- 
> View this message in context: http://old.nabble.com/can-I-create-multiple-channel-for-multiple-thread-work--tp31065140p31084682.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110307/6fde4591/attachment.htm>

From cao at ll.mit.edu  Mon Mar  7 17:21:00 2011
From: cao at ll.mit.edu (Cao, Yican - 0661 - MITLL)
Date: Mon, 7 Mar 2011 12:21:00 -0500
Subject: [rabbitmq-discuss] AlreadyClosedException
In-Reply-To: <4D74B873.50001@rabbitmq.com>
References: <507F97A0-248E-4CAB-B277-AB72B4C4EDE8@ll.mit.edu>
	<4D74B873.50001@rabbitmq.com>
Message-ID: <BA9BA0A6-DD17-490D-8626-244D3F4DDD87@ll.mit.edu>

Hi Emile,

There is no obvious error msg in server side log file...
and there is no indication when it will happen, it only showed up  
twice. I 'm still monitoring it try to get at what condition it will  
occur... Thanks


Yican

On Mar 7, 2011, at 5:50 AM, Emile Joubert wrote:

> Hi Yican,
>
> On 02/03/11 15:25, Cao, Yican - 0661 - MITLL wrote:
>> Hi,
>>
>> I am experiencing this exception occasionally/randomly.
>>
>> 13:54:37,014 ERROR [processor.Logger (248)] Failed delivery for  
>> exchangeId: ID-testvm-45688-1297943230354-0-225. Exhausted after  
>> delivery attempt: 1 caught:  
>> com.rabbitmq.client.AlreadyClosedException: clean connection  
>> shutdown; reason: Attempt to use closed channel
>> com.rabbitmq.client.AlreadyClosedException: clean connection  
>> shutdown; reason: Attempt to use closed channel
>> 	at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen 
>> (AMQChannel.java:195)
>> 	at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:290)
>> 	at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:470)
>> 	at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:457)
>
> Was anything logged to the broker logfile? It is possible that the
> broker closed the connection because a protocol error occurred. The
> reason should appear in the logfile.
>
>
>
> Regards
>
> Emile
>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3543 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110307/e7877dfc/attachment-0001.bin>

From sbrocard.ext at miyowa.com  Mon Mar  7 09:34:00 2011
From: sbrocard.ext at miyowa.com (Sylvain Brocard)
Date: Mon, 7 Mar 2011 10:34:00 +0100
Subject: [rabbitmq-discuss] Error during queue declare
Message-ID: <AANLkTi=2_hNggKkHmuMVwTJOSNJ99qD9ed7YS9y2zAjm@mail.gmail.com>

Hi,

I was playing around with RabbitMQ in cluster (3 nodes) and I got this error
below. I'm using the latest version (2.3.1). This error seems to have killed
my client connection to the node. When I got this error, I was trying to
test my client when one node is stopped. This seems to happen when i was
trying to declare a queue (non durable, not exclusive, not auto-delete). The
only way I've found to fix my issue was to restart the nodes one by one. Any
idea ?

=ERROR REPORT==== 4-Mar-2011::14:55:55 ===
** Generic server <0.7238.90> terminating
** Last message in was {init,false}
** When Server state ==
{q,{amqqueue,{resource,<<"/">>,queue,<<"fail.over">>},
                                     false,false,none,[],<0.7238.90>},
                           none,false,rabbit_variable_queue,undefined,
                           {[],[]},
                           {[],[]},
                           undefined,undefined,undefined,undefined,
                           {state,none,undefined},
                           {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                   [],[]}}},
                           undefined,undefined}
** Reason for termination ==
** {bad_return_value,
       {error,
           {badarg,
               [{erlang,is_process_alive,[<14486.17603.0>]},
                {rabbit_amqqueue,'-internal_declare/2-fun-3-',2},
                {rabbit_misc,'-execute_mnesia_tx_with_tail/1-fun-0-',1},
                {mnesia_tm,apply_fun,3},
                {mnesia_tm,execute_transaction,5},
                {worker_pool_worker,handle_call,3},
                {gen_server2,handle_msg,2},
                {proc_lib,wake_up,3}]}}}

=ERROR REPORT==== 4-Mar-2011::14:55:55 ===
** Generic server <0.7237.90> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'queue.declare',0,<<"fail.over">>,false,
                                   false,false,false,false,[]},
                               none}}
** When Server state == {ch,running,1,<0.7234.90>,<0.7236.90>,undefined,
                            #Fun<rabbit_channel_sup.0.123274458>,none,
                            {sets,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            1,
                            {[],[]},
                            {[],[]},
                            {user,<<"guest">>,true,
                                rabbit_auth_backend_internal,
                                {internal_user,<<"guest">>,

 <<1,91,202,31,107,169,107,11,120,174,233,
                                      122,50,219,120,164,33,32,240,166>>,
                                    true}},
                            <<"/">>,<<>>,
                            {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,

 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            <0.7232.90>,
                            {state,none,undefined},
                            false,1,
                            {0,nil},
                            []}
** Reason for termination ==
** {{{bad_return_value,
         {error,
             {badarg,
                 [{erlang,is_process_alive,[<14486.17603.0>]},
                  {rabbit_amqqueue,'-internal_declare/2-fun-3-',2},
                  {rabbit_misc,'-execute_mnesia_tx_with_tail/1-fun-0-',1},
                  {mnesia_tm,apply_fun,3},
                  {mnesia_tm,execute_transaction,5},
                  {worker_pool_worker,handle_call,3},
                  {gen_server2,handle_msg,2},
                  {proc_lib,wake_up,3}]}}},
     {gen_server2,call,[<0.7238.90>,{init,false}]}},
    [{gen_server2,call,2},
     {rabbit_amqqueue,declare,5},
     {rabbit_channel,handle_method,3},
     {rabbit_channel,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,init_p,5}]}

=ERROR REPORT==== 4-Mar-2011::14:55:55 ===
connection <0.7234.90> (running), channel 1 - error:
{{{bad_return_value,
      {error,
          {badarg,
              [{erlang,is_process_alive,[<14486.17603.0>]},
               {rabbit_amqqueue,'-internal_declare/2-fun-3-',2},
               {rabbit_misc,'-execute_mnesia_tx_with_tail/1-fun-0-',1},
               {mnesia_tm,apply_fun,3},
               {mnesia_tm,execute_transaction,5},
               {worker_pool_worker,handle_call,3},
               {gen_server2,handle_msg,2},
               {proc_lib,wake_up,3}]}}},
  {gen_server2,call,[<0.7238.90>,{init,false}]}},
 [{gen_server2,call,2},
  {rabbit_amqqueue,declare,5},
  {rabbit_channel,handle_method,3},
  {rabbit_channel,handle_cast,2},
  {gen_server2,handle_msg,2},
  {proc_lib,init_p,5}]}

=WARNING REPORT==== 4-Mar-2011::14:55:55 ===
Non-AMQP exit reason '{{{bad_return_value,
                         {error,
                          {badarg,
                           [{erlang,is_process_alive,[<14486.17603.0>]},

 {rabbit_amqqueue,'-internal_declare/2-fun-3-',2},
                            {rabbit_misc,
                             '-execute_mnesia_tx_with_tail/1-fun-0-',1},
                            {mnesia_tm,apply_fun,3},
                            {mnesia_tm,execute_transaction,5},
                            {worker_pool_worker,handle_call,3},
                            {gen_server2,handle_msg,2},
                            {proc_lib,wake_up,3}]}}},
                        {gen_server2,call,[<0.7238.90>,{init,false}]}},
                       [{gen_server2,call,2},
                        {rabbit_amqqueue,declare,5},
                        {rabbit_channel,handle_method,3},
                        {rabbit_channel,handle_cast,2},
                        {gen_server2,handle_msg,2},
                        {proc_lib,init_p,5}]}'


Thanks for reading me !

Sylvain
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110307/0d1284e3/attachment.htm>

From bfox at soe.ucsd.edu  Mon Mar  7 17:16:05 2011
From: bfox at soe.ucsd.edu (Fox, Brian)
Date: Mon, 7 Mar 2011 09:16:05 -0800
Subject: [rabbitmq-discuss] Good way to pause a consumer?  (java)
In-Reply-To: <4D74BB29.2080404@rabbitmq.com>
References: <70CF4108D06347E29C2B10D7DFC6CF67@myyearbook.com>
	<4D74BB29.2080404@rabbitmq.com>
Message-ID: <044C9387-EA79-4886-A784-24C3AC4A90E5@ucsd.edu>

Hi -

Is there a way to pause a consumer in the Java 2.3.1 client?  

The idea is to evenly consume messages from a queue using a distributed system of many consumers.  As it stands, I think the consumer with the best network connection will consume the most messages, which is bad if that system is CPU bound.

Any ideas on preventing this?  I tried autoAck false without any apparent effect. 

Thanks, 
Brian

From matthew at rabbitmq.com  Mon Mar  7 17:31:08 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 7 Mar 2011 17:31:08 +0000
Subject: [rabbitmq-discuss] Error during queue declare
In-Reply-To: <AANLkTi=2_hNggKkHmuMVwTJOSNJ99qD9ed7YS9y2zAjm@mail.gmail.com>
References: <AANLkTi=2_hNggKkHmuMVwTJOSNJ99qD9ed7YS9y2zAjm@mail.gmail.com>
Message-ID: <20110307173107.GI32306@rabbitmq.com>

On Mon, Mar 07, 2011 at 10:34:00AM +0100, Sylvain Brocard wrote:
> I was playing around with RabbitMQ in cluster (3 nodes) and I got this error
> below. I'm using the latest version (2.3.1). This error seems to have killed
> my client connection to the node. When I got this error, I was trying to
> test my client when one node is stopped. This seems to happen when i was
> trying to declare a queue (non durable, not exclusive, not auto-delete). The
> only way I've found to fix my issue was to restart the nodes one by one. Any
> idea ?

This bug has previously been reported and is fixed on default now. It'll
be in the next release. If you're happy compiling from source, following
the instructions at http://www.rabbitmq.com/build-server.html will allow
you to build a bug-reduced version!

Best wishes,

Matthew

>            {badarg,
>                [{erlang,is_process_alive,[<14486.17603.0>]},
>                 {rabbit_amqqueue,'-internal_declare/2-fun-3-',2},

From matthew at rabbitmq.com  Mon Mar  7 17:33:30 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 7 Mar 2011 17:33:30 +0000
Subject: [rabbitmq-discuss] Good way to pause a consumer?  (java)
In-Reply-To: <044C9387-EA79-4886-A784-24C3AC4A90E5@ucsd.edu>
References: <70CF4108D06347E29C2B10D7DFC6CF67@myyearbook.com>
	<4D74BB29.2080404@rabbitmq.com>
	<044C9387-EA79-4886-A784-24C3AC4A90E5@ucsd.edu>
Message-ID: <20110307173330.GJ32306@rabbitmq.com>

On Mon, Mar 07, 2011 at 09:16:05AM -0800, Fox, Brian wrote:
> Is there a way to pause a consumer in the Java 2.3.1 client?  

Yes, but that's not really what you want...

> The idea is to evenly consume messages from a queue using a distributed system of many consumers.  As it stands, I think the consumer with the best network connection will consume the most messages, which is bad if that system is CPU bound.
> 
> Any ideas on preventing this?  I tried autoAck false without any apparent effect. 

Use a lowish basic.qos value (e.g. 10 or less), then consume, and don't
set noAck (i.e. ack manually, after processing each message). That'll
ensure that messages are evenly distributed to consumers as they work
through their backlog, and no consumer gets flooded with work to do,
regardless of their network.

Matthew

From rishdev at gmail.com  Mon Mar  7 18:51:07 2011
From: rishdev at gmail.com (RishiDev)
Date: Mon, 7 Mar 2011 10:51:07 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMq client for jdk1.4
Message-ID: <dbe9948f-86bb-463c-994d-2af336f398d8@y36g2000pra.googlegroups.com>

Hi,

Are there RabbitMq client libraries for jdk1.4 or any workaround for
integration with jdk1.4 based java applications?

I think oldest of client library that I saw on this URL:
http://www.rabbitmq.com/releases/rabbitmq-java-client/
is v1.4.0 which is built using jdk1.5. Let me know if need to look
some place else.

Thanks,
Rishi

From matthias at rabbitmq.com  Mon Mar  7 21:23:32 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 07 Mar 2011 21:23:32 +0000
Subject: [rabbitmq-discuss] SSL client error using 2.3.1
In-Reply-To: <AANLkTi=WD0vafz+15YHvXU2mFXWWuvx1h28CmkC+Ltkc@mail.gmail.com>
References: <AANLkTi=WD0vafz+15YHvXU2mFXWWuvx1h28CmkC+Ltkc@mail.gmail.com>
Message-ID: <4D754CD4.8090006@rabbitmq.com>

Rachmad,

Rachmad Dony Rudiyantoro wrote:
> I have a problem with RabbitMQ using SSL. I can use SSL over a local
> network or 'localhost'. But I can not use it through the Internet.

That would strongly suggest an issue with firewalls.

Do non-ssl connections to rabbit through the internet get established fine?


Matthias

From davidjohnobrien at gmail.com  Mon Mar  7 22:47:28 2011
From: davidjohnobrien at gmail.com (David O'Brien)
Date: Mon, 7 Mar 2011 22:47:28 +0000
Subject: [rabbitmq-discuss] helloworld java and .net
Message-ID: <AANLkTi=ZV+QjAdrmWOA5-XY2aspp0pn_dBuk3yyCFoOu@mail.gmail.com>

I am attempting to follow
http://www.rabbitmq.com/tutorial-one-java.html but using the .NET
client.

My sender appears to work fine:
private static String QUEUE_NAME = "hello";

        static void Main(string[] args)
        {
            ConnectionFactory factory = new ConnectionFactory();
            factory.HostName = "localhost";

            IConnection connection = factory.CreateConnection();
            IModel channel = connection.CreateModel();

            channel.QueueDeclare(QUEUE_NAME, false, false, false, null);

            string message = "Hello from .NET";
            channel.BasicPublish("", QUEUE_NAME, null,
Encoding.UTF8.GetBytes(message));

            Console.WriteLine(" [x] Sent '" + message + "'");

            channel.Close();
            connection.Close();
        }


My receiver works fine except after the first pass through the try
block it closes the SharedQueue resulting in an exception the next
time a message is received

private static String QUEUE_NAME = "hello";

        static void Main(string[] args)
        {
            ConnectionFactory factory = new ConnectionFactory();
            factory.HostName = "localhost";

            IConnection connection = factory.CreateConnection();
            connection.ConnectionShutdown += new
RabbitMQ.Client.Events.ConnectionShutdownEventHandler(connection_ConnectionShutdown);

            IModel channel = connection.CreateModel();

            channel.QueueDeclare(QUEUE_NAME, false, false, false, null);
            Console.WriteLine(" [*] Waiting for messages. To exit
press CTRL+C");

            QueueingBasicConsumer consumer = new QueueingBasicConsumer(channel);
            channel.BasicConsume(QUEUE_NAME, true, consumer);

            while (true)
            {
                try
                {
                    BasicDeliverEventArgs e =
(BasicDeliverEventArgs)consumer.Queue.Dequeue();
                    IBasicProperties props = e.BasicProperties;

                    byte[] body = e.Body;
                    String message = Encoding.UTF8.GetString(body);
                    Console.WriteLine(" [x] Received '" + message + "'");
                    // ... process the message
                    channel.BasicAck(e.DeliveryTag, false);
                }
                catch (OperationInterruptedException ex)
                {
                    // The consumer was removed, either through
                    // channel or connection closure, or through the
                    // action of IModel.BasicCancel().
                    break;
                }


                //QueueingBasicConsumer.Delivery delivery =
consumer.nextDelivery();
                //String message = new String(delivery.getBody());

            }

How can set up the .NET client to operate as the Java one does ie it
continues to listen for new messages?

From donal.lhooo at gmail.com  Tue Mar  8 02:35:25 2011
From: donal.lhooo at gmail.com (Rachmad Dony R)
Date: Tue, 8 Mar 2011 09:35:25 +0700
Subject: [rabbitmq-discuss] SSL client error using 2.3.1
In-Reply-To: <4D754CD4.8090006@rabbitmq.com>
References: <AANLkTi=WD0vafz+15YHvXU2mFXWWuvx1h28CmkC+Ltkc@mail.gmail.com>
	<4D754CD4.8090006@rabbitmq.com>
Message-ID: <AANLkTim67rv2KVarvUyAVhUgaVJ+2YF01KgFgj7STK-K@mail.gmail.com>

Hallo Matthias,

Yes, it's fine when I use non-ssl connections to rabbit through the
internet. I will set back the configuration of the firewall. thanks
for advice Matthias.

Regards,
Rachmad Doni.

On 3/8/11, Matthias Radestock <matthias at rabbitmq.com> wrote:
> Rachmad,
>
> Rachmad Dony Rudiyantoro wrote:
>> I have a problem with RabbitMQ using SSL. I can use SSL over a local
>> network or 'localhost'. But I can not use it through the Internet.
>
> That would strongly suggest an issue with firewalls.
>
> Do non-ssl connections to rabbit through the internet get established fine?
>
>
> Matthias
>

From sunil at shopsocially.com  Tue Mar  8 07:02:38 2011
From: sunil at shopsocially.com (Sunil Arora)
Date: Tue, 8 Mar 2011 12:32:38 +0530
Subject: [rabbitmq-discuss] rabbitmqctl list_queues explanation needed
Message-ID: <FF4FA520-0221-4DEB-9C68-2B62C42EF252@shopsocially.com>

Hi folks,

We are trying to determine what is going under the hood in our rabbitmq server because It because unresponsive last night and we have to restart it. When I say unresponsive, it means it was no longer accepting AMQP connections from our webservers.

When we run following command:

/usr/sbin/rabbitmqctl list_queues name memory messages messages_unacknowledged consumers

We see a stream of output given as follows which has around 10K entries.

.......
.......
b9e5e34bcb6c46229baf5bfdfc0deb81	21688	1	0	0
bf52747edf2a4b1dbe919a0439bc03fa	21688	1	0	0
39254dd407374dba9dd9f67fc7157613	21688	1	0	0
7bc47977255e4414a975bbdfc9fbc7d3	21688	1	0	0


Now, I do not understand why memory is being consumed if  messages are acknowledged already. Our expectation is once the message has been delivered and consumed, ack'd, it should not consume any memory in the system.

Are we reading this correctly ??

Is there any configuration to flush these messages?

We are using 2.3.1 version of rabbitmq on ubuntu server.

Thanks
Sunil

From emile at rabbitmq.com  Tue Mar  8 09:56:20 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 Mar 2011 09:56:20 +0000
Subject: [rabbitmq-discuss] rabbitmqctl list_queues explanation needed
In-Reply-To: <FF4FA520-0221-4DEB-9C68-2B62C42EF252@shopsocially.com>
References: <FF4FA520-0221-4DEB-9C68-2B62C42EF252@shopsocially.com>
Message-ID: <4D75FD44.6000909@rabbitmq.com>

Hi Sunil,

On 08/03/11 07:02, Sunil Arora wrote:
> Hi folks,
>
> We are trying to determine what is going under the hood in our
> rabbitmq server because It because unresponsive last night and we
> have to restart it. When I say unresponsive, it means it was no
> longer accepting AMQP connections from our webservers.

That means the broker probably came under memory pressure. The logfile 
should confirm that. Rabbit will start accepting connections as soon as 
enough memory is freed. The broker will continue to deliver messages to 
consumers while under memory pressure.

> When we run following command:
>
> /usr/sbin/rabbitmqctl list_queues name memory messages
> messages_unacknowledged consumers
>
> We see a stream of output given as follows which has around 10K
> entries.
>
> b9e5e34bcb6c46229baf5bfdfc0deb81	21688	1	0	0
> bf52747edf2a4b1dbe919a0439bc03fa	21688	1	0	0
> 39254dd407374dba9dd9f67fc7157613	21688	1	0	0
> 7bc47977255e4414a975bbdfc9fbc7d3	21688	1	0	0
>
>
> Now, I do not understand why memory is being consumed if  messages
> are acknowledged already. Our expectation is once the message has
> been delivered and consumed, ack'd, it should not consume any memory
> in the system.

The broker forgets about messages as soon as they are acknowledged, so 
acknowledged messages can't be responsible for memory usage. The memory 
reported by "rabbitmqctl list_queues" is for all call stack, heap and 
internal structures associated with the internal Erlang queue process. 
In your case the total memory used by queues will amount to about 200Mb 
if each queue contains 1 message.

If your application doesn't need 10000 simultaneously active queues then 
you should drained and delete them. Otherwise you will need to add more 
RAM to your broker.

Rabbit has the ability to hibernate inactive queue processes, which will 
save some memory. Frequently checking the queue status using 
"rabbitmqctl list_queues" or use of the management & monitoring plugin 
could prevent that from happening.


Regards

Emile


From sunil at shopsocially.com  Tue Mar  8 10:15:00 2011
From: sunil at shopsocially.com (Sunil Arora)
Date: Tue, 8 Mar 2011 15:45:00 +0530
Subject: [rabbitmq-discuss] rabbitmqctl list_queues explanation needed
In-Reply-To: <4D75FD44.6000909@rabbitmq.com>
References: <FF4FA520-0221-4DEB-9C68-2B62C42EF252@shopsocially.com>
	<4D75FD44.6000909@rabbitmq.com>
Message-ID: <008C9FE0-AA67-4541-B027-40FE6C47DF89@shopsocially.com>

Thanks Emile,

This is indeed helpful.

I investigated more and found out the reason behind those increasing queues.

We are using celeryd (http://celeryproject.com) and we were suppose to turn off a particular settings to disable this growing queues. celery was dumping new queue for every background job that was being posted to RabbitMQ and we didn't need that.

Now I want to delete these acknowledged messages. what is the best way to do it ?  I do not want to flush to unacknowledged messages.

Thanks
Sunil



On 08-Mar-2011, at 3:26 PM, Emile Joubert wrote:

> Hi Sunil,
> 
> On 08/03/11 07:02, Sunil Arora wrote:
>> Hi folks,
>> 
>> We are trying to determine what is going under the hood in our
>> rabbitmq server because It because unresponsive last night and we
>> have to restart it. When I say unresponsive, it means it was no
>> longer accepting AMQP connections from our webservers.
> 
> That means the broker probably came under memory pressure. The logfile should confirm that. Rabbit will start accepting connections as soon as enough memory is freed. The broker will continue to deliver messages to consumers while under memory pressure.
> 
>> When we run following command:
>> 
>> /usr/sbin/rabbitmqctl list_queues name memory messages
>> messages_unacknowledged consumers
>> 
>> We see a stream of output given as follows which has around 10K
>> entries.
>> 
>> b9e5e34bcb6c46229baf5bfdfc0deb81	21688	1	0	0
>> bf52747edf2a4b1dbe919a0439bc03fa	21688	1	0	0
>> 39254dd407374dba9dd9f67fc7157613	21688	1	0	0
>> 7bc47977255e4414a975bbdfc9fbc7d3	21688	1	0	0
>> 
>> 
>> Now, I do not understand why memory is being consumed if  messages
>> are acknowledged already. Our expectation is once the message has
>> been delivered and consumed, ack'd, it should not consume any memory
>> in the system.
> 
> The broker forgets about messages as soon as they are acknowledged, so acknowledged messages can't be responsible for memory usage. The memory reported by "rabbitmqctl list_queues" is for all call stack, heap and internal structures associated with the internal Erlang queue process. In your case the total memory used by queues will amount to about 200Mb if each queue contains 1 message.
> 
> If your application doesn't need 10000 simultaneously active queues then you should drained and delete them. Otherwise you will need to add more RAM to your broker.
> 
> Rabbit has the ability to hibernate inactive queue processes, which will save some memory. Frequently checking the queue status using "rabbitmqctl list_queues" or use of the management & monitoring plugin could prevent that from happening.
> 
> 
> Regards
> 
> Emile
> 


From simon at rabbitmq.com  Tue Mar  8 10:17:08 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 Mar 2011 10:17:08 +0000
Subject: [rabbitmq-discuss] rabbitmqctl list_queues explanation needed
In-Reply-To: <4D75FD44.6000909@rabbitmq.com>
References: <FF4FA520-0221-4DEB-9C68-2B62C42EF252@shopsocially.com>
	<4D75FD44.6000909@rabbitmq.com>
Message-ID: <4D760224.6040200@rabbitmq.com>

On 08/03/11 09:56, Emile Joubert wrote:
> Rabbit has the ability to hibernate inactive queue processes, which will
> save some memory. Frequently checking the queue status using
> "rabbitmqctl list_queues"

Yes.

> or use of the management & monitoring plugin
> could prevent that from happening.

No.


The management plugin will not stop processes from hibernating. Frequent 
use of rabbitmqctl list_* will.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Tue Mar  8 10:19:51 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 08 Mar 2011 10:19:51 +0000
Subject: [rabbitmq-discuss] RabbitMq client for jdk1.4
In-Reply-To: <dbe9948f-86bb-463c-994d-2af336f398d8@y36g2000pra.googlegroups.com>
References: <dbe9948f-86bb-463c-994d-2af336f398d8@y36g2000pra.googlegroups.com>
Message-ID: <4D7602C7.3020203@rabbitmq.com>

On 07/03/11 18:51, RishiDev wrote:
> Hi,
>
> Are there RabbitMq client libraries for jdk1.4 or any workaround for
> integration with jdk1.4 based java applications?

The last version of the Java client with support for Java 1.4 was 2.2.0. 
Note that the 1.4 versions have always been a separate download. You 
want 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.2.0/rabbitmq-java-client-java1.4bin-2.2.0.tar.gz 
or 
http://www.rabbitmq.com/releases/rabbitmq-java-client/v2.2.0/rabbitmq-java-client-java1.4bin-2.2.0.zip, 
according to taste.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From emile at rabbitmq.com  Tue Mar  8 10:26:40 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 Mar 2011 10:26:40 +0000
Subject: [rabbitmq-discuss] rabbitmqctl list_queues explanation needed
In-Reply-To: <008C9FE0-AA67-4541-B027-40FE6C47DF89@shopsocially.com>
References: <FF4FA520-0221-4DEB-9C68-2B62C42EF252@shopsocially.com>
	<4D75FD44.6000909@rabbitmq.com>
	<008C9FE0-AA67-4541-B027-40FE6C47DF89@shopsocially.com>
Message-ID: <4D760460.5070909@rabbitmq.com>

Hi Sunil,

On 08/03/11 10:15, Sunil Arora wrote:
> Thanks Emile,
>
> This is indeed helpful.
>
> I investigated more and found out the reason behind those increasing
> queues.
>
> We are using celeryd (http://celeryproject.com) and we were suppose
> to turn off a particular settings to disable this growing queues.
> celery was dumping new queue for every background job that was being
> posted to RabbitMQ and we didn't need that.
>
> Now I want to delete these acknowledged messages. what is the best
> way to do it ?  I do not want to flush to unacknowledged messages.

You can't have acknowledged messages in a queue. Acknowledging a 
messages tells the broker to forget about it.

You don't have unacknowledged messages. The "messages_unacknowledged" 
column in your output is empty.

You have a single message in each queue which can be removed by 
consuming it.


Regards

Emile

From emile at rabbitmq.com  Tue Mar  8 11:00:09 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 08 Mar 2011 11:00:09 +0000
Subject: [rabbitmq-discuss] helloworld java and .net
In-Reply-To: <AANLkTi=ZV+QjAdrmWOA5-XY2aspp0pn_dBuk3yyCFoOu@mail.gmail.com>
References: <AANLkTi=ZV+QjAdrmWOA5-XY2aspp0pn_dBuk3yyCFoOu@mail.gmail.com>
Message-ID: <4D760C39.9020301@rabbitmq.com>


Hi David,

The problem you describe is caused by the combination of these two lines:

>              channel.BasicConsume(QUEUE_NAME, true, consumer);
>                      channel.BasicAck(e.DeliveryTag, false);

both of which cause messages to be acknowledged. You will see entries 
similar to this in the broker logfile:

{amqp_error,precondition_failed,"unknown delivery tag 1",'basic.ack'}

The most common cause of this message is acknowledging messages more 
than once.

The solution is to consume without autoAck:

                 channel.BasicConsume(QUEUE_NAME, false, consumer);

or remove the explicit basicAck() (this is what all the other 
implementations do).

You may also wish to compare your solution with the (as yet) unpublished 
version in the "dotnet" folder of the github repository.


Regards

Emile


From sunil at shopsocially.com  Tue Mar  8 13:41:28 2011
From: sunil at shopsocially.com (Sunil Arora)
Date: Tue, 08 Mar 2011 19:11:28 +0530
Subject: [rabbitmq-discuss] rabbitmqctl list_queues explanation needed
Message-ID: <4l14hk8vav5n815ladvkgjlg.1299591688271@email.android.com>

Is there a simple way to purge those messages without consuming them.
These are unwanted messages generated due to mis configuration of one of our components i.e. Celery.
Thanks
Sunil
Sent from Samsung mobile

Emile Joubert <emile at rabbitmq.com> wrote:

>Hi Sunil,
>
>On 08/03/11 10:15, Sunil Arora wrote:
>> Thanks Emile,
>>
>> This is indeed helpful.
>>
>> I investigated more and found out the reason behind those increasing
>> queues.
>>
>> We are using celeryd (http://celeryproject.com) and we were suppose
>> to turn off a particular settings to disable this growing queues.
>> celery was dumping new queue for every background job that was being
>> posted to RabbitMQ and we didn't need that.
>>
>> Now I want to delete these acknowledged messages. what is the best
>> way to do it ?  I do not want to flush to unacknowledged messages.
>
>You can't have acknowledged messages in a queue. Acknowledging a 
>messages tells the broker to forget about it.
>
>You don't have unacknowledged messages. The "messages_unacknowledged" 
>column in your output is empty.
>
>You have a single message in each queue which can be removed by 
>consuming it.
>
>
>Regards
>
>Emile

From matthew at rabbitmq.com  Tue Mar  8 13:46:34 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 8 Mar 2011 13:46:34 +0000
Subject: [rabbitmq-discuss] rabbitmqctl list_queues explanation needed
In-Reply-To: <4l14hk8vav5n815ladvkgjlg.1299591688271@email.android.com>
References: <4l14hk8vav5n815ladvkgjlg.1299591688271@email.android.com>
Message-ID: <20110308134633.GA18961@rabbitmq.com>

On Tue, Mar 08, 2011 at 07:11:28PM +0530, Sunil Arora wrote:
> Is there a simple way to purge those messages without consuming them.

Yes. The queue.purge AMQP method will purge the queue of unconsumed
messages.

Matthew

From andi.constantin at mediasat.ro  Tue Mar  8 15:18:09 2011
From: andi.constantin at mediasat.ro (Andi Constantin)
Date: Tue, 08 Mar 2011 17:18:09 +0200
Subject: [rabbitmq-discuss] routing key
Message-ID: <4D7648B1.9000902@mediasat.ro>

Hello!

Is it possible to have a routing key which is NOT case-sensitive ?

Thanks,
Andi.

From matthew at rabbitmq.com  Tue Mar  8 15:20:11 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 8 Mar 2011 15:20:11 +0000
Subject: [rabbitmq-discuss] routing key
In-Reply-To: <4D7648B1.9000902@mediasat.ro>
References: <4D7648B1.9000902@mediasat.ro>
Message-ID: <20110308152010.GB27322@rabbitmq.com>

On Tue, Mar 08, 2011 at 05:18:09PM +0200, Andi Constantin wrote:
> Is it possible to have a routing key which is NOT case-sensitive ?

Nope.

Matthew

From mikeb at rabbitmq.com  Tue Mar  8 15:24:07 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 08 Mar 2011 15:24:07 +0000
Subject: [rabbitmq-discuss] routing key
In-Reply-To: <20110308152010.GB27322@rabbitmq.com>
References: <4D7648B1.9000902@mediasat.ro>
	<20110308152010.GB27322@rabbitmq.com>
Message-ID: <4D764A17.301@rabbitmq.com>

On 03/08/2011 03:20 PM, Matthew Sackman wrote:
> On Tue, Mar 08, 2011 at 05:18:09PM +0200, Andi Constantin wrote:
>> Is it possible to have a routing key which is NOT case-sensitive ?
>
> Nope.

Well, I think the question is "Is it possible to have a routing-key 
matching algorithm that is not case-sensitive?", to which the answer is 
indeed "Nope".

Of course, you can lowercase all routing keys and binding keys for the 
same effect.

Michael

From andi.constantin at mediasat.ro  Tue Mar  8 15:36:12 2011
From: andi.constantin at mediasat.ro (Andi Constantin)
Date: Tue, 08 Mar 2011 17:36:12 +0200
Subject: [rabbitmq-discuss] routing key
In-Reply-To: <4D764A17.301@rabbitmq.com>
References: <4D7648B1.9000902@mediasat.ro>
	<20110308152010.GB27322@rabbitmq.com> <4D764A17.301@rabbitmq.com>
Message-ID: <4D764CEC.3050009@mediasat.ro>

Yes, that was the back-up plan, thank you !

Andi.


On 3/8/2011 5:24 PM, Michael Bridgen wrote:
> On 03/08/2011 03:20 PM, Matthew Sackman wrote:
>> On Tue, Mar 08, 2011 at 05:18:09PM +0200, Andi Constantin wrote:
>>> Is it possible to have a routing key which is NOT case-sensitive ?
>>
>> Nope.
>
> Well, I think the question is "Is it possible to have a routing-key 
> matching algorithm that is not case-sensitive?", to which the answer 
> is indeed "Nope".
>
> Of course, you can lowercase all routing keys and binding keys for the 
> same effect.
>
> Michael
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From mark.pork at gmail.com  Tue Mar  8 16:08:53 2011
From: mark.pork at gmail.com (butterdave2)
Date: Tue, 8 Mar 2011 08:08:53 -0800 (PST)
Subject: [rabbitmq-discuss] Re try and Throttling
Message-ID: <31098579.post@talk.nabble.com>


Is there anything in Rabbit that can control the amount of times a consumer
may "retry" a message?
There may be instances when a message has something about it that will cause
it to "fail" downstream in the Consumer code. I wouldn't want to continue to
hammer away...

I can programmatically include the number of retry attempts with the message
(a kind of metadata) and then design the Consumer to query this field. (then
once we hit our MAX_RETRY, we will do something else to it...)

Also in similar fashion, is there any control around "throttling" or slowing
down the consumption of messages from a queue?

Apologies if this has been brought up before.

Thanks,

DP
-- 
View this message in context: http://old.nabble.com/Retry-and-Throttling-tp31098579p31098579.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From venkatveludandi at yahoo.com  Wed Mar  9 00:16:48 2011
From: venkatveludandi at yahoo.com (venkat veludandi)
Date: Tue, 8 Mar 2011 16:16:48 -0800 (PST)
Subject: [rabbitmq-discuss] Incorrect number of messages saved to the queue
	after RabbitMQ broker failure
Message-ID: <596397.26474.qm@web39423.mail.mud.yahoo.com>

Good evening.
After consuming few published messages, if I bring down the RabbitMQ broker (hard failure) and bring it back, the number of messages saved to queue is incorrect.
For example, I publish 100 messages. After consuming 10 messages, I bring down the broker and bring it back. Run: rabbitmqctl list_queues messages_ready, I see the count of messages_ready as 100 instead of 90. 
Could you please let me know if there is?anything wrong with the following Producer and consumer code:
?
Thanks
Venkat
===========================
TestProducer.java
-------------------------
public class TestProducer {

public static void main(String[] args) {
for(int i=0; i < 100; i++) {
String msg = "M" + i;
try {
RabbitMQProducer.INSTANCE.run(msg);
} catch(Exception e) {
System.out.println("exception occurred");
break;
}
}
}
}
=============================================================
RabbitMQProducer.java:
--------------------------------
public class RabbitMQProducer {

public static final RabbitMQProducer INSTANCE = new RabbitMQProducer();

private RabbitMQProducer() {}

public void run(String msg) {
String hostName = "localhost";
String port = "5672";
int portNumber = Integer.valueOf(port);;
Connection conn = null;
try {

ConnectionFactory cf = new ConnectionFactory(); 
cf.setHost(hostName);
cf.setPort(portNumber);
cf.setUsername("guest");
cf.setPassword("guest");
conn = cf.newConnection();
Channel ch = conn.createChannel();
ch.exchangeDeclare("mdb.testq.exchange", "topic", true);
ch.queueDeclare("mdb.testq.queue", true, false, false, null);
ch.txSelect();
ch.basicPublish("mdb.testq.exchange", "mdb.testq.queue", MessageProperties.PERSISTENT_BASIC, msg.getBytes());
ch.txCommit();
ch.close();
conn.close();

} catch (IOException e) {
e.printStackTrace();
}

}

}
=================================================================
public class RabbitConsumer {
private int count = 0;

private void runConsumer() {
Connection conn = null;
try {

String hostName = "localhost";
String port = "5672";
int portNumber = Integer.valueOf(port);
ConnectionFactory cf = new ConnectionFactory(); 
cf.setHost(hostName);
cf.setPort(portNumber);
cf.setUsername("guest");
cf.setPassword("guest");
conn = cf.newConnection();
Channel channel = conn.createChannel();
channel.exchangeDeclare("mdb.testq.exchange", "topic", true);
channel.queueBind("mdb.testq.queue", "mdb.testq.exchange", "#");
Consumer consumer = new QueueingConsumer(channel);
channel.basicQos(1);
channel.basicConsume("mdb.testq.queue", false, consumer);
boolean running = true;
while(running) {

QueueingConsumer.Delivery delivery;
try {
delivery = ((QueueingConsumer) consumer).nextDelivery();
Thread.currentThread().sleep(500);
count++;
System.out.println("count: "+count);
channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
} catch (Exception e) {
e.printStackTrace();
break;
} 
}
} catch (IOException e) {
e.printStackTrace();
}

}

public static void main(String[] args) {
RabbitConsumer rc = new RabbitConsumer();
rc.runConsumer();
}
}


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110308/a194e5d8/attachment-0001.htm>

From jerryk at vmware.com  Wed Mar  9 00:24:39 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Tue, 8 Mar 2011 16:24:39 -0800
Subject: [rabbitmq-discuss] Incorrect number of messages saved to the
 queue	after RabbitMQ broker failure
In-Reply-To: <596397.26474.qm@web39423.mail.mud.yahoo.com>
References: <596397.26474.qm@web39423.mail.mud.yahoo.com>
Message-ID: <4076B622-20FF-47EE-8F5F-BFF2E8B444BF@vmware.com>

Hi, Venkat...

If you haven't ACKed your 10 consumed messages, either by using the auto-ACK setting in your consuming code, or by explicitly invoking basic.ack, the broker will maintain those messages, since it isn't certain that a client has taken responsibility.  The intent of this behavior is to guard against the case where a consumer crashes after getting a message but before doing whatever work it had planned to do on it.

Best regards,
Jerry

On Mar 8, 2011, at 4:16 PM, venkat veludandi wrote:

> Good evening.
> After consuming few published messages, if I bring down the RabbitMQ broker (hard failure) and bring it back, the number of messages saved to queue is incorrect.
> For example, I publish 100 messages. After consuming 10 messages, I bring down the broker and bring it back. Run: rabbitmqctl list_queues messages_ready, I see the count of messages_ready as 100 instead of 90.
> Could you please let me know if there is anything wrong with the following Producer and consumer code:
>  
> Thanks
> Venkat
> ===========================
> TestProducer.java
> -------------------------
> public class TestProducer {
> 
> 
> public static void main(String[] args) {
> 
> for(int i=0; i < 100; i++) {
> 
> String msg = "M" + i;
> 
> try {
> 
> RabbitMQProducer.INSTANCE.run(msg);
> 
> } catch(Exception e) {
> 
> System.out.println("exception occurred");
> 
> break;
> 
> }
> 
> }
> 
> }
> 
> }
> 
> =============================================================
> 
> RabbitMQProducer.java:
> 
> --------------------------------
> 
> public class RabbitMQProducer {
> 
> 
> public static final RabbitMQProducer INSTANCE = new RabbitMQProducer();
> 
> 
> private RabbitMQProducer() {}
> 
> 
> public void run(String msg) {
> 
> String hostName = "localhost";
> 
> String port = "5672";
> 
> int portNumber = Integer.valueOf(port);;
> 
> Connection conn = null;
> 
> try {
> 
> 
> ConnectionFactory cf = new ConnectionFactory();
> 
> cf.setHost(hostName);
> 
> cf.setPort(portNumber);
> 
> cf.setUsername("guest");
> 
> cf.setPassword("guest");
> 
> conn = cf.newConnection();
> 
> Channel ch = conn.createChannel();
> 
> ch.exchangeDeclare("mdb.testq.exchange", "topic", true);
> 
> ch.queueDeclare("mdb.testq.queue", true, false, false, null);
> 
> ch.txSelect();
> 
> ch.basicPublish("mdb.testq.exchange", "mdb.testq.queue", MessageProperties.PERSISTENT_BASIC, msg.getBytes());
> 
> ch.txCommit();
> 
> ch.close();
> 
> conn.close();
> 
> 
> } catch (IOException e) {
> 
> e.printStackTrace();
> 
> }
> 
> 
> }
> 
> 
> }
> 
> =================================================================
> 
> public class RabbitConsumer {
> 
> private int count = 0;
> 
> 
> private void runConsumer() {
> 
> Connection conn = null;
> 
> try {
> 
> 
> String hostName = "localhost";
> 
> String port = "5672";
> 
> int portNumber = Integer.valueOf(port);
> 
> ConnectionFactory cf = new ConnectionFactory();
> 
> cf.setHost(hostName);
> 
> cf.setPort(portNumber);
> 
> cf.setUsername("guest");
> 
> cf.setPassword("guest");
> 
> conn = cf.newConnection();
> 
> Channel channel = conn.createChannel();
> 
> channel.exchangeDeclare("mdb.testq.exchange", "topic", true);
> 
> channel.queueBind("mdb.testq.queue", "mdb.testq.exchange", "#");
> 
> Consumer consumer = new QueueingConsumer(channel);
> 
> channel.basicQos(1);
> 
> channel.basicConsume("mdb.testq.queue", false, consumer);
> 
> boolean running = true;
> 
> while(running) {
> 
> 
> QueueingConsumer.Delivery delivery;
> 
> try {
> 
> delivery = ((QueueingConsumer) consumer).nextDelivery();
> 
> Thread.currentThread().sleep(500);
> 
> count++;
> 
> System.out.println("count: "+count);
> 
> channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
> 
> } catch (Exception e) {
> 
> e.printStackTrace();
> 
> break;
> 
> }
> 
> }
> 
> } catch (IOException e) {
> 
> e.printStackTrace();
> 
> }
> 
> 
> }
> 
> 
> public static void main(String[] args) {
> 
> RabbitConsumer rc = new RabbitConsumer();
> 
> rc.runConsumer();
> 
> }
> 
> }
> 
> 
> <ATT00001..txt>


From matthew at rabbitmq.com  Wed Mar  9 00:34:08 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 9 Mar 2011 00:34:08 +0000
Subject: [rabbitmq-discuss] Incorrect number of messages saved to the
 queue after RabbitMQ broker failure
In-Reply-To: <596397.26474.qm@web39423.mail.mud.yahoo.com>
References: <596397.26474.qm@web39423.mail.mud.yahoo.com>
Message-ID: <20110309003408.GA23760@wellquite.org>

On Tue, Mar 08, 2011 at 04:16:48PM -0800, venkat veludandi wrote:
> After consuming few published messages, if I bring down the RabbitMQ broker (hard failure) and bring it back, the number of messages saved to queue is incorrect.
> For example, I publish 100 messages. After consuming 10 messages, I bring down the broker and bring it back. Run: rabbitmqctl list_queues messages_ready, I see the count of messages_ready as 100 instead of 90. 
> Could you please let me know if there is?anything wrong with the following Producer and consumer code:

Ok, so the publishing side of things is fine: by the time you get the
tx.commit_ok back, the server has correctly written the messages to
disk.

On the acking side, because you're not using transactions, there is no
guarantee given as to when the ack is written to disk. Consequently,
as your test shows, ack'd messages can come back to life in the event of
a hard kill. However, in this case you will find that messages you
subsequently consume upon recovery will have the is_delivered property
set (indeed, it will in fact be set for all messages recovered by the
queue as the queue, in the case of a hard kill, has to be conservative
and assume that all messages in the queue _may_ have been previously
delivered).

To eliminate this problem, you can issue acks within a transaction.
Then, once again, by the time you get the tx.commit_ok back, you know
the ack has been recorded.

On the whole, we do not advise people to try and seek exactly-once
semantics. It is very difficult if not impossible to get anywhere near
exactly-once - this isn't just with RabbitMQ: this is a standard
theoretical result. You can easily have "at least once" and "at most
once" delivery. The former is generally preferred as it means you won't
lose messages, but your consumers have to deal with the possibility of
duplication. This is usually possible.

Thus once you've embraced this, you will find performance is several
orders of magnitude better if you use confirms when publishing[0], and
normal acks when consuming. At that point there is likely no need to use
transactions at all. Try to ensure your downstream operations are
idempotent and thus can naturally cope with duplication of the
occasional message.

Matthew

[0] http://www.rabbitmq.com/extensions.html#confirms

From matthew at rabbitmq.com  Wed Mar  9 00:35:56 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 9 Mar 2011 00:35:56 +0000
Subject: [rabbitmq-discuss] Incorrect number of messages saved to the
 queue	after RabbitMQ broker failure
In-Reply-To: <4076B622-20FF-47EE-8F5F-BFF2E8B444BF@vmware.com>
References: <596397.26474.qm@web39423.mail.mud.yahoo.com>
	<4076B622-20FF-47EE-8F5F-BFF2E8B444BF@vmware.com>
Message-ID: <20110309003555.GB23760@wellquite.org>

On Tue, Mar 08, 2011 at 04:24:39PM -0800, Jerry Kuch wrote:
> If you haven't ACKed your 10 consumed messages, either by using the auto-ACK setting in your consuming code, or by explicitly invoking basic.ack, the broker will maintain those messages, since it isn't certain that a client has taken responsibility.  The intent of this behavior is to guard against the case where a consumer crashes after getting a message but before doing whatever work it had planned to do on it.

As the code shows, he is acking the messages just fine.

Matthew

From asafdav2 at gmail.com  Tue Mar  8 21:15:44 2011
From: asafdav2 at gmail.com (asaf david)
Date: Tue, 8 Mar 2011 13:15:44 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Streaming
In-Reply-To: <27304228.post@talk.nabble.com>
Message-ID: <683728.29.1299618944112.JavaMail.geo-discussion-forums@yqfy10>

Did you end up implementing this? If possible, I'd really love seeing the 
code as i have to do the same thing exactly
thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110308/0ab26b7b/attachment-0001.htm>

From asafdav2 at gmail.com  Tue Mar  8 21:52:04 2011
From: asafdav2 at gmail.com (asaf david)
Date: Tue, 8 Mar 2011 13:52:04 -0800 (PST)
Subject: [rabbitmq-discuss] chunking a file to many messages
Message-ID: <25859673.87.1299621124348.JavaMail.geo-discussion-forums@yqiz8>

hello
I'm a RabbitMQ beginner. I need to handle a case where several clients can 
produce files for processing, which should be done in some servers. I've 
realized there is no native support for files transfers, so I'm going to 
chunk a produced file to many small messages are transfer them (similar to 
the answer given here<https://groups.google.com/d/msg/rabbitmq-discuss/-G39l-JJtp4/OTSd9FUJdfEJ>), 
and reassemble them to a whole file at the server. However there are two 
points i'm not sure about:

   1. How do i make sure that different messages that belong to the same 
   file won't end up in different servers? I want a fair dispatching between 
   the servers on a per-file base, not per-message
   2. How do I make sure that messages won't be reordered? should i attach 
   an identifier to each message to mark it's location in the original file?

thanks in advance :)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110308/a944ae02/attachment-0001.htm>

From jbeaulau at cisco.com  Wed Mar  9 00:03:55 2011
From: jbeaulau at cisco.com (John Beaulaurier -X (jbeaulau - Advanced Network Info at Cisco))
Date: Tue, 8 Mar 2011 16:03:55 -0800
Subject: [rabbitmq-discuss] Install error erlang not found but is installed
Message-ID: <F3F69139C275F848A1DB1518DC2C21680FEB97FB@xmb-sjc-22c.amer.cisco.com>

Hello,

 

Could use some assistance in installing RabbitMQ.

 

OS: RHEL 4

RabbitMQ server-2.3.1-1.noarch.rpm

erlang R14B01 or R12B-3

 

I installed erlang R14B01 from source to default location and tested
successfully. Then I performed a test install of the RabbitMQ rpm, but
receive a dependency error

stating that erlang R12B-3 is required, but noted on the RabbitMQ
download page R12b-3 and up is supported. I removed R14B01 and installed

R12B-3 to default location tested successfully and still same dependency
error when trying to install the RabbitMQ rpm.

 

Thanks

-John 

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110308/c692cc4f/attachment-0001.htm>

From jmrivas at amper.es  Wed Mar  9 07:38:26 2011
From: jmrivas at amper.es (=?ISO-8859-1?Q?Jos=E9_Manuel_Rivas_de_Arriba?=)
Date: Wed, 9 Mar 2011 08:38:26 +0100
Subject: [rabbitmq-discuss] Network routing in RabbitMQ
Message-ID: <OF6D7FEF95.DA06D18F-ONC125784E.0029DCEA-C125784E.002A2E36@amper.es>



Hello everybody,

I?m evaluating if RabbitMQ fulfills our requirements.

Our system needs to send messages with different priorities from one computer to another computer, that are into
different subnetworks whose connectivity are through different L3 switches.

Do you know if this is possible with RabbitMQ? Is network routing implemented? Are priority queues implemented?

Thanks in advance,
Jose



                                         
                                         
                                         
      Jos? Manuel Rivas de Arriba        
                                         
      Dpto. Ingenier?a del SW            
                                         
                                         
                                         
      C/ Marconi 3                       
                                         
      Parque Tecnol?gico de Madrid       
                                         
      28760 Tres Cantos (Madrid)         
                                         
      Spain                              
                                         
                                         
                                         
      Tel.: + 34 913 626 007             
                                         
      Fax.: + 34 917 243 010             
                                         
      e-mail:jmrivas at amper.es            
                                         








-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/57bf5778/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 0F751280.jpg
Type: image/jpeg
Size: 3508 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/57bf5778/attachment.jpg>

From vdeepak at yahoo-inc.com  Wed Mar  9 08:52:48 2011
From: vdeepak at yahoo-inc.com (Deepak Vijayvergiy)
Date: Wed, 9 Mar 2011 14:22:48 +0530
Subject: [rabbitmq-discuss] chunking a file to many messages
In-Reply-To: <25859673.87.1299621124348.JavaMail.geo-discussion-forums@yqiz8>
References: <25859673.87.1299621124348.JavaMail.geo-discussion-forums@yqiz8>
Message-ID: <5826D751-3BAA-481D-A7EE-C19594103122@yahoo-inc.com>

Hi Asaf,
I think, if you publish with the different routing keys, and on the consumer side, a server will be bound to a queue with a binding key per file, so you can have a fair dispatching on per file base.
For the re-ordering part, I have thought about the unique identifier when I was designing about my stuff, I haven't implemented that yet, but that's how I have thought for it, unless someone suggests somethings better.

Thanks
Regards
Deepak

On Mar 9, 2011, at 3:22 AM, asaf david wrote:

hello
I'm a RabbitMQ beginner. I need to handle a case where several clients can produce files for processing, which should be done in some servers. I've realized there is no native support for files transfers, so I'm going to chunk a produced file to many small messages are transfer them (similar to the answer given here<https://groups.google.com/d/msg/rabbitmq-discuss/-G39l-JJtp4/OTSd9FUJdfEJ>), and reassemble them to a whole file at the server. However there are two points i'm not sure about:

 1.  How do i make sure that different messages that belong to the same file won't end up in different servers? I want a fair dispatching between the servers on a per-file base, not per-message
 2.  How do I make sure that messages won't be reordered? should i attach an identifier to each message to mark it's location in the original file?

thanks in advance :)

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/b67b5d2f/attachment.htm>

From emile at rabbitmq.com  Wed Mar  9 09:58:18 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 09 Mar 2011 09:58:18 +0000
Subject: [rabbitmq-discuss] Install error erlang not found but is
	installed
In-Reply-To: <F3F69139C275F848A1DB1518DC2C21680FEB97FB@xmb-sjc-22c.amer.cisco.com>
References: <F3F69139C275F848A1DB1518DC2C21680FEB97FB@xmb-sjc-22c.amer.cisco.com>
Message-ID: <4D774F3A.8050601@rabbitmq.com>

Hi John,

On 09/03/11 00:03, John Beaulaurier -X (jbeaulau - Advanced Network Info 
at Cisco) wrote:

> I installed erlang R14B01 from source to default location and tested
> successfully. Then I performed a test install of the RabbitMQ rpm, but
> receive a dependency error

This is a package management issue. If you built Erlang R14B01 from 
source instead of installing it from a package then the package manager 
has no way of knowing that the dependency has been met. One way of 
getting around this is to turn off dependency checking when installing 
the RabbitMQ rpm. The RPM website has more information about dependency 
management: http://rpm.org/

Some users have also had some success installing from a modified Erlang 
SRPM:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010629.html

If you have a choice between R14B01 and R12B-3 then use R14B01.


Regards

Emile

From matthias at rabbitmq.com  Wed Mar  9 10:00:20 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 09 Mar 2011 10:00:20 +0000
Subject: [rabbitmq-discuss] rabbitmqctl list_queues explanation needed
In-Reply-To: <20110308134633.GA18961@rabbitmq.com>
References: <4l14hk8vav5n815ladvkgjlg.1299591688271@email.android.com>
	<20110308134633.GA18961@rabbitmq.com>
Message-ID: <4D774FB4.2000401@rabbitmq.com>

Matthew Sackman wrote:
> On Tue, Mar 08, 2011 at 07:11:28PM +0530, Sunil Arora wrote:
>> Is there a simple way to purge those messages without consuming them.
> 
> Yes. The queue.purge AMQP method will purge the queue of unconsumed
> messages.

The management plug-in allows you to do that as well.


Matthias.

From vdeepak at yahoo-inc.com  Wed Mar  9 10:26:56 2011
From: vdeepak at yahoo-inc.com (Deepak Vijayvergiy)
Date: Wed, 9 Mar 2011 15:56:56 +0530
Subject: [rabbitmq-discuss] Performance and scalability measurement with my
 publisher-subscriber clients testing
Message-ID: <4583DF6A-62EA-41BC-9FAD-F98F3BF314CD@yahoo-inc.com>

Hi,
I have created the framework for publisher-subscriber and created publisher and consumer clients for basic testing as well. Now, I also want to test the performance as well, as in, I want to give the numbers like -
(1) How many messages, my publisher client will be able to publish per second or rate?
(2) How many messages my consumer will be able to consume (per second) .. rate? (a) with messages already in the queue (b) parallely publishing as well

Earlier I have tried doing same by some time functions before and after 1 and last mess respectively, but I don't think that was a proper way. Please let me know if you have done the same measurement?

Thanks
Regards
Deepak

From simon at rabbitmq.com  Wed Mar  9 10:51:08 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 09 Mar 2011 10:51:08 +0000
Subject: [rabbitmq-discuss] rabbitmqctl list_queues explanation needed
In-Reply-To: <4D774FB4.2000401@rabbitmq.com>
References: <4l14hk8vav5n815ladvkgjlg.1299591688271@email.android.com>	<20110308134633.GA18961@rabbitmq.com>
	<4D774FB4.2000401@rabbitmq.com>
Message-ID: <4D775B9C.7060901@rabbitmq.com>

On 09/03/11 10:00, Matthias Radestock wrote:
> Matthew Sackman wrote:
>> On Tue, Mar 08, 2011 at 07:11:28PM +0530, Sunil Arora wrote:
>>> Is there a simple way to purge those messages without consuming them.
>>
>> Yes. The queue.purge AMQP method will purge the queue of unconsumed
>> messages.
>
> The management plug-in allows you to do that as well.

If you have a large number of queues you need to purge (which I think 
from your post you might have), you might find it useful to use the 
command line tool for the management plugin - rabbitmqadmin - in a loop 
like so:

$ rabbitmqadmin -f tsv -q list queues name | grep some_pattern | while 
read queue ; do rabbitmqadmin purge queue name=${queue} ; done

where some_pattern matches the queues you wish to purge.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Wed Mar  9 11:01:29 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 09 Mar 2011 11:01:29 +0000
Subject: [rabbitmq-discuss] Install error erlang not found but
	is	installed
In-Reply-To: <4D774F3A.8050601@rabbitmq.com>
References: <F3F69139C275F848A1DB1518DC2C21680FEB97FB@xmb-sjc-22c.amer.cisco.com>
	<4D774F3A.8050601@rabbitmq.com>
Message-ID: <4D775E09.20500@rabbitmq.com>

On 09/03/11 09:58, Emile Joubert wrote:
> Some users have also had some success installing from a modified Erlang
> SRPM:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-January/010629.html

Actually there is now a binary RPM for R14B01 available.

Mentioned here: 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-February/011117.html

I think you just add http://repos.fedorapeople.org/repos/peter/erlang/ 
to yum, although I'm not a RHEL / CentOS user.

> If you have a choice between R14B01 and R12B-3 then use R14B01.

Very much so.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From yoavglazner at gmail.com  Wed Mar  9 11:29:57 2011
From: yoavglazner at gmail.com (yoav glazner)
Date: Wed, 9 Mar 2011 13:29:57 +0200
Subject: [rabbitmq-discuss] Monitoring - computer names instead of IPs
Message-ID: <AANLkTikaaOKdH99d24bSSkNwE=PgtY4jwOWmbZJ8nh3w@mail.gmail.com>

Hi,

First I must say that I enjoy RabbitMQ and its management plugin.
now I would like to ask, how hard will it be to display computer names
instead of IPs in the managment plugin?
will this feature be available in future releases?

Many thanks,

Yoav Glazner
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/d862a54a/attachment.htm>

From sunil at shopsocially.com  Wed Mar  9 11:55:20 2011
From: sunil at shopsocially.com (Sunil Arora)
Date: Wed, 9 Mar 2011 17:25:20 +0530
Subject: [rabbitmq-discuss] rabbitmqctl list_queues explanation needed
In-Reply-To: <4D775B9C.7060901@rabbitmq.com>
References: <4l14hk8vav5n815ladvkgjlg.1299591688271@email.android.com>	<20110308134633.GA18961@rabbitmq.com>
	<4D774FB4.2000401@rabbitmq.com> <4D775B9C.7060901@rabbitmq.com>
Message-ID: <F242EB50-EEE2-438A-9D0D-D94D0935B727@shopsocially.com>

Thanks Simon,

We used rabbitmqctl reset :)  to clear up the mess and then reconfigured. It was easy :)

But with all this exercise and email-exchange we had, we feel more confident about RabbitMQ now.

The user list has been really helpful. Keep it up!

#cheers
Sunil


On 09-Mar-2011, at 4:21 PM, Simon MacMullen wrote:

> On 09/03/11 10:00, Matthias Radestock wrote:
>> Matthew Sackman wrote:
>>> On Tue, Mar 08, 2011 at 07:11:28PM +0530, Sunil Arora wrote:
>>>> Is there a simple way to purge those messages without consuming them.
>>> 
>>> Yes. The queue.purge AMQP method will purge the queue of unconsumed
>>> messages.
>> 
>> The management plug-in allows you to do that as well.
> 
> If you have a large number of queues you need to purge (which I think from your post you might have), you might find it useful to use the command line tool for the management plugin - rabbitmqadmin - in a loop like so:
> 
> $ rabbitmqadmin -f tsv -q list queues name | grep some_pattern | while read queue ; do rabbitmqadmin purge queue name=${queue} ; done
> 
> where some_pattern matches the queues you wish to purge.
> 
> Cheers, Simon
> -- 
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From nitesh at wikinvest.com  Wed Mar  9 12:38:49 2011
From: nitesh at wikinvest.com (Nite)
Date: Wed, 9 Mar 2011 04:38:49 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-server init script
Message-ID: <13842102.914.1299674329215.JavaMail.geo-discussion-forums@prfx21>

Hi Guys
I am installing rabbitmq-server from source. Where can I find a good init 
script to put in /etc/init.d to run rabbitmq as a service?

Thanks.
Nite
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/c28662ae/attachment.htm>

From chris.penkin at gmail.com  Wed Mar  9 12:38:53 2011
From: chris.penkin at gmail.com (Penkin)
Date: Wed, 9 Mar 2011 04:38:53 -0800 (PST)
Subject: [rabbitmq-discuss] MSMQ Integration
Message-ID: <7809d0f9-9a9c-4f7c-8685-55539ba2c9c0@r4g2000prm.googlegroups.com>

Are there any tools available that we can install and set to watch an
MSMQ Queue and pull the messages from it and push them straight to a
RabbitMQ Queue?

From dmaher at milestonelab.com  Wed Mar  9 13:20:09 2011
From: dmaher at milestonelab.com (Daniel Maher)
Date: Wed, 09 Mar 2011 14:20:09 +0100
Subject: [rabbitmq-discuss] Problem with a constantly increasing memory
	footprint
Message-ID: <1299676809.2472.44.camel@danstation>

Hello,

We are running a two node RabbitMQ cluster, and on _one_ of those nodes
the memory footprint used by beam.smp grows steadily and constantly over
time, regardless of the usage pattern.  I've been pulling my hair out
trying to figure out why, and while it's helped me to learn quite a bit
about administrating RabbitMQ (which is a good thing), it hasn't
resulted in a solution for the memory creep.

The particulars:
Debian Squeeze 64bit
Rabbit 2.3.1 / Erlang R14A
Mnesia storage to disc

If I restart RabbitMQ on the problem node, the footprint will drop
dramatically (logical), but will then continue to rise over time once
again.

I've been using Collectd to graph the footprint as reported by
rabbitmqctl as well as my pmap directly.  I don't know if this list
supports attachments, so i've put the two graphs here:
http://min.us/m5IxKc8LKTWqz
They are both graphs of a week in scope.  The first graph is the memory
usage as reported by rabbitmqctl in bytes, and the second is that
reported by pmap in kilobytes.

Any insight - or perhaps ideas on how to go about debugging the issue -
would be greatly appreciated.  Thank you, all.

-- 
Daniel Maher
? can't talk, too busy calculating computrons. ?


From alexis at rabbitmq.com  Wed Mar  9 13:38:50 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 9 Mar 2011 13:38:50 +0000
Subject: [rabbitmq-discuss] MSMQ Integration
In-Reply-To: <7809d0f9-9a9c-4f7c-8685-55539ba2c9c0@r4g2000prm.googlegroups.com>
References: <7809d0f9-9a9c-4f7c-8685-55539ba2c9c0@r4g2000prm.googlegroups.com>
Message-ID: <AANLkTikh9ViF47u5j-uLw_3jSfNu5UjZ8+gVSNRY=Vid@mail.gmail.com>

On Wed, Mar 9, 2011 at 12:38 PM, Penkin <chris.penkin at gmail.com> wrote:
> Are there any tools available that we can install and set to watch an
> MSMQ Queue and pull the messages from it and push them straight to a
> RabbitMQ Queue?

Maybe.

Have a look here - http://www.rabbitmq.com/devtools.html#dotnet-dev

At worst you could write a stateless custom relay from our .NET code
and Microsoft's...

alexis

From alexandru at rabbitmq.com  Wed Mar  9 13:51:51 2011
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Wed, 9 Mar 2011 13:51:51 +0000
Subject: [rabbitmq-discuss] rabbitmq-server init script
In-Reply-To: <13842102.914.1299674329215.JavaMail.geo-discussion-forums@prfx21>
References: <13842102.914.1299674329215.JavaMail.geo-discussion-forums@prfx21>
Message-ID: <20110309135151.GA14426@dakota.eng.vmware.com>

Hi,

There's one in
  packaging/common/rabbitmq-server.init

Cheers,
Alex

On Wed, Mar 09, 2011 at 04:38:49AM -0800, Nite wrote:
> Hi Guys
> I am installing rabbitmq-server from source. Where can I find a good init 
> script to put in /etc/init.d to run rabbitmq as a service?
> 
> Thanks.
> Nite

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From majek04 at gmail.com  Wed Mar  9 13:59:40 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 9 Mar 2011 13:59:40 +0000
Subject: [rabbitmq-discuss] Re try and Throttling
In-Reply-To: <31098579.post@talk.nabble.com>
References: <31098579.post@talk.nabble.com>
Message-ID: <AANLkTi=q9cKzLKAKfh+q4OriU2NJYwiFDvLUBYstn=5w@mail.gmail.com>

On Tue, Mar 8, 2011 at 16:08, butterdave2 <mark.pork at gmail.com> wrote:
>
> Is there anything in Rabbit that can control the amount of times a consumer
> may "retry" a message?

No, but if the message is redelivered you should see "redelivered"
field being set
to "True".

> There may be instances when a message has something about it that will cause
> it to "fail" downstream in the Consumer code. I wouldn't want to continue to
> hammer away...

Correct. But rabbit can't know if your consumer died due to the message
or due to something else, power failure or something.

It's the programmers responsibility to handle dying-consumer case.

> I can programmatically include the number of retry attempts with the message
> (a kind of metadata) and then design the Consumer to query this field. (then
> once we hit our MAX_RETRY, we will do something else to it...)

Sounds good.

> Also in similar fashion, is there any control around "throttling" or slowing
> down the consumption of messages from a queue?

You can't control that, Rabbit is designed to deliver messages when it can.
But you can use basic.qos to do something similar. Or, if you're desperate
you may just run basic.get with regular intervals.

Cheers,
  Marek

From majek04 at gmail.com  Wed Mar  9 14:02:08 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 9 Mar 2011 14:02:08 +0000
Subject: [rabbitmq-discuss] Monitoring - computer names instead of IPs
In-Reply-To: <AANLkTikaaOKdH99d24bSSkNwE=PgtY4jwOWmbZJ8nh3w@mail.gmail.com>
References: <AANLkTikaaOKdH99d24bSSkNwE=PgtY4jwOWmbZJ8nh3w@mail.gmail.com>
Message-ID: <AANLkTikoL1MhK9dKq8qc10uTLM_uAJK=4-fVRN6xVAyj@mail.gmail.com>

On Wed, Mar 9, 2011 at 11:29, yoav glazner <yoavglazner at gmail.com> wrote:
> First I must say that I enjoy RabbitMQ and its management plugin.
> now I would like to ask, how hard will it be to display computer names
> instead of IPs in the managment plugin?
> will this feature be available in future releases?

I don't think so. Resolving ip addresses to dns names is a resource-intensive
process and it doesn't scale well with loads of connections.

Why do you think it's an important feature?

Cheers,
  Marek

From armstrong.whit at gmail.com  Wed Mar  9 14:03:24 2011
From: armstrong.whit at gmail.com (Whit Armstrong)
Date: Wed, 9 Mar 2011 09:03:24 -0500
Subject: [rabbitmq-discuss] MSMQ Integration
In-Reply-To: <AANLkTikh9ViF47u5j-uLw_3jSfNu5UjZ8+gVSNRY=Vid@mail.gmail.com>
References: <7809d0f9-9a9c-4f7c-8685-55539ba2c9c0@r4g2000prm.googlegroups.com>
	<AANLkTikh9ViF47u5j-uLw_3jSfNu5UjZ8+gVSNRY=Vid@mail.gmail.com>
Message-ID: <AANLkTi=jQ4-eXA6vd26sBHgEGE=7Jk8Ko4dxX2TjxBFR@mail.gmail.com>

Has anyone done the same for IBM MQ?

Thanks,
Whit


On Wed, Mar 9, 2011 at 8:38 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> On Wed, Mar 9, 2011 at 12:38 PM, Penkin <chris.penkin at gmail.com> wrote:
>> Are there any tools available that we can install and set to watch an
>> MSMQ Queue and pull the messages from it and push them straight to a
>> RabbitMQ Queue?
>
> Maybe.
>
> Have a look here - http://www.rabbitmq.com/devtools.html#dotnet-dev
>
> At worst you could write a stateless custom relay from our .NET code
> and Microsoft's...
>
> alexis
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From majek04 at gmail.com  Wed Mar  9 14:05:02 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 9 Mar 2011 14:05:02 +0000
Subject: [rabbitmq-discuss] Network routing in RabbitMQ
In-Reply-To: <OF6D7FEF95.DA06D18F-ONC125784E.0029DCEA-C125784E.002A2E36@amper.es>
References: <OF6D7FEF95.DA06D18F-ONC125784E.0029DCEA-C125784E.002A2E36@amper.es>
Message-ID: <AANLkTim5W9VDyOApAUSf8y86b_2FhKr8BwTP8ZLH+PnC@mail.gmail.com>

On Wed, Mar 9, 2011 at 07:38, Jos? Manuel Rivas de Arriba
<jmrivas at amper.es> wrote:
> I?m evaluating if RabbitMQ fulfills our requirements.
>
> Our system needs to send messages with different priorities from one computer to another computer, that are into different subnetworks whose connectivity are through different L3 switches.
>
> Do you know if this is possible with RabbitMQ? Is network routing implemented? Are priority queues implemented?

Priorities are not natively implemented in RabbitMQ. But, in most
cases you may do priorities in your app. We usually recommend creating
one queue for each priority, and consuming from
them in priority order.

Hope that helps.

Cheers,
  Marek

From simon at rabbitmq.com  Wed Mar  9 14:09:30 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 09 Mar 2011 14:09:30 +0000
Subject: [rabbitmq-discuss] Monitoring - computer names instead of IPs
In-Reply-To: <AANLkTikoL1MhK9dKq8qc10uTLM_uAJK=4-fVRN6xVAyj@mail.gmail.com>
References: <AANLkTikaaOKdH99d24bSSkNwE=PgtY4jwOWmbZJ8nh3w@mail.gmail.com>
	<AANLkTikoL1MhK9dKq8qc10uTLM_uAJK=4-fVRN6xVAyj@mail.gmail.com>
Message-ID: <4D778A1A.4020205@rabbitmq.com>

On 09/03/11 14:02, Marek Majkowski wrote:
> On Wed, Mar 9, 2011 at 11:29, yoav glazner<yoavglazner at gmail.com>  wrote:
>> First I must say that I enjoy RabbitMQ and its management plugin.
>> now I would like to ask, how hard will it be to display computer names
>> instead of IPs in the managment plugin?
>> will this feature be available in future releases?
>
> I don't think so. Resolving ip addresses to dns names is a resource-intensive
> process and it doesn't scale well with loads of connections.

Hmm, yeah, but it could happen in the background, with a cache and it 
could turn itself off if it was taking too long. I've wondered about 
doing this, but I don't know if it would get through the QA process.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From alexis at rabbitmq.com  Wed Mar  9 14:11:55 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 9 Mar 2011 14:11:55 +0000
Subject: [rabbitmq-discuss] MSMQ Integration
In-Reply-To: <AANLkTi=jQ4-eXA6vd26sBHgEGE=7Jk8Ko4dxX2TjxBFR@mail.gmail.com>
References: <7809d0f9-9a9c-4f7c-8685-55539ba2c9c0@r4g2000prm.googlegroups.com>
	<AANLkTikh9ViF47u5j-uLw_3jSfNu5UjZ8+gVSNRY=Vid@mail.gmail.com>
	<AANLkTi=jQ4-eXA6vd26sBHgEGE=7Jk8Ko4dxX2TjxBFR@mail.gmail.com>
Message-ID: <AANLkTikU0gXbSi7y0PiDe5TGw99yvd_SeEhkazBhPBv6@mail.gmail.com>

Whit,

On Wed, Mar 9, 2011 at 2:03 PM, Whit Armstrong <armstrong.whit at gmail.com> wrote:
> Has anyone done the same for IBM MQ?

We have heard of customers doing things like that but don't have a
'native' relay yet.

You might also want to take a look at Spring AMQP and Spring
Integration which have tooling to connect to IBM MQ and RabbitMQ.

alexis




> Thanks,
> Whit
>
>
> On Wed, Mar 9, 2011 at 8:38 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> On Wed, Mar 9, 2011 at 12:38 PM, Penkin <chris.penkin at gmail.com> wrote:
>>> Are there any tools available that we can install and set to watch an
>>> MSMQ Queue and pull the messages from it and push them straight to a
>>> RabbitMQ Queue?
>>
>> Maybe.
>>
>> Have a look here - http://www.rabbitmq.com/devtools.html#dotnet-dev
>>
>> At worst you could write a stateless custom relay from our .NET code
>> and Microsoft's...
>>
>> alexis
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From jmrivas at amper.es  Wed Mar  9 14:15:09 2011
From: jmrivas at amper.es (=?ISO-8859-1?Q?Jos=E9_Manuel_Rivas_de_Arriba?=)
Date: Wed, 9 Mar 2011 15:15:09 +0100
Subject: [rabbitmq-discuss] Network routing in RabbitMQ
In-Reply-To: <AANLkTim5W9VDyOApAUSf8y86b_2FhKr8BwTP8ZLH+PnC@mail.gmail.com>
References: <OF6D7FEF95.DA06D18F-ONC125784E.0029DCEA-C125784E.002A2E36@amper.es>
	<AANLkTim5W9VDyOApAUSf8y86b_2FhKr8BwTP8ZLH+PnC@mail.gmail.com>
Message-ID: <OF15B8A3E6.ABA97EA7-ONC125784E.004E08C7-C125784E.004E8066@amper.es>


On Wed, Mar 9, 2011 at 07:38, Jos? Manuel Rivas de Arriba
<jmrivas at amper.es> wrote:
> I?m evaluating if RabbitMQ fulfills our requirements.
>
> Our system needs to send messages with different priorities from one computer to another computer, that are into
different subnetworks whose connectivity are through different L3 switches.
>
> Do you know if this is possible with RabbitMQ? Is network routing implemented? Are priority queues implemented?

Priorities are not natively implemented in RabbitMQ. But, in most
cases you may do priorities in your app. We usually recommend creating
one queue for each priority, and consuming from
them in priority order.

Hope that helps.

Cheers,
  Marek


******************************************************************
Thanks Marek,

Do you know if network routing is natively implemented in RabbitMQ or it must be solved by our application?

Best regards,
Jose
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/158726ee/attachment.htm>

From brendan.doyle at epicadvertising.com  Wed Mar  9 14:41:36 2011
From: brendan.doyle at epicadvertising.com (Brendan Doyle)
Date: Wed, 9 Mar 2011 08:41:36 -0600
Subject: [rabbitmq-discuss] Install error erlang not found but is
 installed
In-Reply-To: <F3F69139C275F848A1DB1518DC2C21680FEB97FB@xmb-sjc-22c.amer.cisco.com>
Message-ID: <C99CFB10.15381%brendan.doyle@epicadvertising.com>

John

I believe It is looking for an installed erlang rpm.  If you have installed erlang from source because there is no suitably up to date erlang package for your distribution, that's fine.  As long as the erlang binaries are in the global PATH, you can install the rabbitmq rpm with '--nodeps' option and it works fine.  At least in my experience so far ;)

Brendan

From: "John Beaulaurier -X (jbeaulau - Advanced Network Info at Cisco)" <jbeaulau at cisco.com<mailto:jbeaulau at cisco.com>>
Date: Tue, 8 Mar 2011 18:03:55 -0600
To: "rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>" <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: [rabbitmq-discuss] Install error erlang not found but is installed

Hello,

Could use some assistance in installing RabbitMQ.

OS: RHEL 4
RabbitMQ server-2.3.1-1.noarch.rpm
erlang R14B01 or R12B-3

I installed erlang R14B01 from source to default location and tested successfully. Then I performed a test install of the RabbitMQ rpm, but receive a dependency error
stating that erlang R12B-3 is required, but noted on the RabbitMQ download page R12b-3 and up is supported. I removed R14B01 and installed
R12B-3 to default location tested successfully and still same dependency error when trying to install the RabbitMQ rpm.

Thanks
-John



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/6d81268d/attachment.htm>

From gmr at myyearbook.com  Wed Mar  9 14:55:36 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 9 Mar 2011 09:55:36 -0500
Subject: [rabbitmq-discuss] Problem with a constantly increasing memory
 footprint
In-Reply-To: <1299676809.2472.44.camel@danstation>
References: <1299676809.2472.44.camel@danstation>
Message-ID: <5A9B2162772C446896E5CB30E55ADD68@myyearbook.com>

I've noticed this behavior as well. In my case, I was over saturating a single node in a cluster. I solved my problem by expanding my cluster size and balancing my publishers across the cluster. You might want to check the rabbitmq.log/rabbmq-sasl.log file and see if you notice any weird behavior in there, such as abnormal connection terminations.

Hope this helps,

Gavin
On Wednesday, March 9, 2011 at 8:20 AM, Daniel Maher wrote:
Hello,
> 
> We are running a two node RabbitMQ cluster, and on _one_ of those nodes
> the memory footprint used by beam.smp grows steadily and constantly over
> time, regardless of the usage pattern. I've been pulling my hair out
> trying to figure out why, and while it's helped me to learn quite a bit
> about administrating RabbitMQ (which is a good thing), it hasn't
> resulted in a solution for the memory creep.
> 
> The particulars:
> Debian Squeeze 64bit
> Rabbit 2.3.1 / Erlang R14A
> Mnesia storage to disc
> 
> If I restart RabbitMQ on the problem node, the footprint will drop
> dramatically (logical), but will then continue to rise over time once
> again.
> 
> I've been using Collectd to graph the footprint as reported by
> rabbitmqctl as well as my pmap directly. I don't know if this list
> supports attachments, so i've put the two graphs here:
> http://min.us/m5IxKc8LKTWqz
> They are both graphs of a week in scope. The first graph is the memory
> usage as reported by rabbitmqctl in bytes, and the second is that
> reported by pmap in kilobytes.
> 
> Any insight - or perhaps ideas on how to go about debugging the issue -
> would be greatly appreciated. Thank you, all.
> 
> -- 
> Daniel Maher
> ? can't talk, too busy calculating computrons. ?
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/5ba52829/attachment-0001.htm>

From mark.pork at gmail.com  Wed Mar  9 15:00:33 2011
From: mark.pork at gmail.com (butterdave2)
Date: Wed, 9 Mar 2011 07:00:33 -0800 (PST)
Subject: [rabbitmq-discuss] Re  try and Throttling
In-Reply-To: <AANLkTi=q9cKzLKAKfh+q4OriU2NJYwiFDvLUBYstn=5w@mail.gmail.com>
References: <31098579.post@talk.nabble.com>
	<AANLkTi=q9cKzLKAKfh+q4OriU2NJYwiFDvLUBYstn=5w@mail.gmail.com>
Message-ID: <31107114.post@talk.nabble.com>


What about simulating a delay by not republishing a message back (via
channel.basicReject) onto the queue by the Consumer code? If I'm not
mistaken, as long as the Channel is kept alive, that message can be held out
of the queue indefinitely.

On another note, could a new plugin provide the global delay settings on
Rabbit?

DP



Marek Majkowski wrote:
> 
> On Tue, Mar 8, 2011 at 16:08, butterdave2 <mark.pork at gmail.com> wrote:
>>
>> Is there anything in Rabbit that can control the amount of times a
>> consumer
>> may "retry" a message?
> 
> No, but if the message is redelivered you should see "redelivered"
> field being set
> to "True".
> 
>> There may be instances when a message has something about it that will
>> cause
>> it to "fail" downstream in the Consumer code. I wouldn't want to continue
>> to
>> hammer away...
> 
> Correct. But rabbit can't know if your consumer died due to the message
> or due to something else, power failure or something.
> 
> It's the programmers responsibility to handle dying-consumer case.
> 
>> I can programmatically include the number of retry attempts with the
>> message
>> (a kind of metadata) and then design the Consumer to query this field.
>> (then
>> once we hit our MAX_RETRY, we will do something else to it...)
> 
> Sounds good.
> 
>> Also in similar fashion, is there any control around "throttling" or
>> slowing
>> down the consumption of messages from a queue?
> 
> You can't control that, Rabbit is designed to deliver messages when it
> can.
> But you can use basic.qos to do something similar. Or, if you're desperate
> you may just run basic.get with regular intervals.
> 
> Cheers,
>   Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Retry-and-Throttling-tp31098579p31107114.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From majek04 at gmail.com  Wed Mar  9 16:04:53 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 9 Mar 2011 16:04:53 +0000
Subject: [rabbitmq-discuss] Network routing in RabbitMQ
In-Reply-To: <OF15B8A3E6.ABA97EA7-ONC125784E.004E08C7-C125784E.004E8066@amper.es>
References: <OF6D7FEF95.DA06D18F-ONC125784E.0029DCEA-C125784E.002A2E36@amper.es>
	<AANLkTim5W9VDyOApAUSf8y86b_2FhKr8BwTP8ZLH+PnC@mail.gmail.com>
	<OF15B8A3E6.ABA97EA7-ONC125784E.004E08C7-C125784E.004E8066@amper.es>
Message-ID: <AANLkTimVDHhFEq94g26XeVeN97T8xuMfSyHY3-Z6zrmV@mail.gmail.com>

On Wed, Mar 9, 2011 at 14:15, Jos? Manuel Rivas de Arriba
<jmrivas at amper.es> wrote:
> Do you know if network routing is natively implemented in RabbitMQ or it
> must be solved by our application?

Well, rabbitmq has a concept of exchanges that are responsible
for the routing of the messages. They can definitely handle some complexity.

Take a look here:
http://www.rabbitmq.com/tutorial-five-python.html

From bfox at soe.ucsd.edu  Wed Mar  9 16:10:21 2011
From: bfox at soe.ucsd.edu (Fox, Brian)
Date: Wed, 9 Mar 2011 08:10:21 -0800
Subject: [rabbitmq-discuss] Network routing in RabbitMQ
In-Reply-To: <AANLkTim5W9VDyOApAUSf8y86b_2FhKr8BwTP8ZLH+PnC@mail.gmail.com>
References: <OF6D7FEF95.DA06D18F-ONC125784E.0029DCEA-C125784E.002A2E36@amper.es>
	<AANLkTim5W9VDyOApAUSf8y86b_2FhKr8BwTP8ZLH+PnC@mail.gmail.com>
Message-ID: <949F5C5B-D7DF-48A6-8487-2AE00A31C4BA@ucsd.edu>

Hi there!


From bfox at soe.ucsd.edu  Wed Mar  9 16:11:29 2011
From: bfox at soe.ucsd.edu (Fox, Brian)
Date: Wed, 9 Mar 2011 08:11:29 -0800
Subject: [rabbitmq-discuss] Max vhosts
In-Reply-To: <949F5C5B-D7DF-48A6-8487-2AE00A31C4BA@ucsd.edu>
References: <OF6D7FEF95.DA06D18F-ONC125784E.0029DCEA-C125784E.002A2E36@amper.es>
	<AANLkTim5W9VDyOApAUSf8y86b_2FhKr8BwTP8ZLH+PnC@mail.gmail.com>
	<949F5C5B-D7DF-48A6-8487-2AE00A31C4BA@ucsd.edu>
Message-ID: <7fd27c67-aea6-4b8f-8718-bcdadf53856c@XHUB1.AD.UCSD.EDU>

[Now with subject corrected goodness]

Hi there!


From simon at rabbitmq.com  Wed Mar  9 16:15:22 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 09 Mar 2011 16:15:22 +0000
Subject: [rabbitmq-discuss] Max vhosts
In-Reply-To: <7fd27c67-aea6-4b8f-8718-bcdadf53856c@XHUB1.AD.UCSD.EDU>
References: <OF6D7FEF95.DA06D18F-ONC125784E.0029DCEA-C125784E.002A2E36@amper.es>	<AANLkTim5W9VDyOApAUSf8y86b_2FhKr8BwTP8ZLH+PnC@mail.gmail.com>	<949F5C5B-D7DF-48A6-8487-2AE00A31C4BA@ucsd.edu>
	<7fd27c67-aea6-4b8f-8718-bcdadf53856c@XHUB1.AD.UCSD.EDU>
Message-ID: <4D77A79A.6090208@rabbitmq.com>

On 09/03/11 16:11, Fox, Brian wrote:

> From the FAQ:  How many virtual hosts can I run and where?  There is
> no hard limit to the number of virtual hosts that can be configured
> within a RabbitMQ cluster, save available disk and memory resources.
>
> Is this true for a crazy number of virtual hosts, say 10,000?  And
> there's no performance cost for this?  Can anyone offer a success
> story?

I haven't seen anyone create that many. But a vhost is only really a row 
in an Mnesia table, so you should be able to create a lot, where "a lot" 
is > 10,000.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From majek04 at gmail.com  Wed Mar  9 16:39:13 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 9 Mar 2011 16:39:13 +0000
Subject: [rabbitmq-discuss] Re try and Throttling
In-Reply-To: <31107114.post@talk.nabble.com>
References: <31098579.post@talk.nabble.com>
	<AANLkTi=q9cKzLKAKfh+q4OriU2NJYwiFDvLUBYstn=5w@mail.gmail.com>
	<31107114.post@talk.nabble.com>
Message-ID: <AANLkTi=6wpFGYrEgCyYPZBxYYeRZFyD0zwK5RjWx74kX@mail.gmail.com>

On Wed, Mar 9, 2011 at 15:00, butterdave2 <mark.pork at gmail.com> wrote:
>
> What about simulating a delay by not republishing a message back (via
> channel.basicReject) onto the queue by the Consumer code? If I'm not
> mistaken, as long as the Channel is kept alive, that message can be held out
> of the queue indefinitely.

This is correct if you're using acknowledgments.

> On another note, could a new plugin provide the global delay settings on
> Rabbit?

I don't think that's possible.




> Marek Majkowski wrote:
>>
>> On Tue, Mar 8, 2011 at 16:08, butterdave2 <mark.pork at gmail.com> wrote:
>>>
>>> Is there anything in Rabbit that can control the amount of times a
>>> consumer
>>> may "retry" a message?
>>
>> No, but if the message is redelivered you should see "redelivered"
>> field being set
>> to "True".
>>
>>> There may be instances when a message has something about it that will
>>> cause
>>> it to "fail" downstream in the Consumer code. I wouldn't want to continue
>>> to
>>> hammer away...
>>
>> Correct. But rabbit can't know if your consumer died due to the message
>> or due to something else, power failure or something.
>>
>> It's the programmers responsibility to handle dying-consumer case.
>>
>>> I can programmatically include the number of retry attempts with the
>>> message
>>> (a kind of metadata) and then design the Consumer to query this field.
>>> (then
>>> once we hit our MAX_RETRY, we will do something else to it...)
>>
>> Sounds good.
>>
>>> Also in similar fashion, is there any control around "throttling" or
>>> slowing
>>> down the consumption of messages from a queue?
>>
>> You can't control that, Rabbit is designed to deliver messages when it
>> can.
>> But you can use basic.qos to do something similar. Or, if you're desperate
>> you may just run basic.get with regular intervals.
>>
>> Cheers,
>> ? Marek
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> View this message in context: http://old.nabble.com/Retry-and-Throttling-tp31098579p31107114.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From yoavglazner at gmail.com  Wed Mar  9 17:28:32 2011
From: yoavglazner at gmail.com (yoav glazner)
Date: Wed, 9 Mar 2011 19:28:32 +0200
Subject: [rabbitmq-discuss] Monitoring - computer names instead of IPs
In-Reply-To: <AANLkTikoL1MhK9dKq8qc10uTLM_uAJK=4-fVRN6xVAyj@mail.gmail.com>
References: <AANLkTikaaOKdH99d24bSSkNwE=PgtY4jwOWmbZJ8nh3w@mail.gmail.com>
	<AANLkTikoL1MhK9dKq8qc10uTLM_uAJK=4-fVRN6xVAyj@mail.gmail.com>
Message-ID: <AANLkTinyRGj62X-V0N8mmAy8xxo=W-XiMvU=hKcMKy2M@mail.gmail.com>

On Wed, Mar 9, 2011 at 4:02 PM, Marek Majkowski <majek04 at gmail.com> wrote:

> On Wed, Mar 9, 2011 at 11:29, yoav glazner <yoavglazner at gmail.com> wrote:
> > First I must say that I enjoy RabbitMQ and its management plugin.
> > now I would like to ask, how hard will it be to display computer names
> > instead of IPs in the managment plugin?
> > will this feature be available in future releases?
>
> I don't think so. Resolving ip addresses to dns names is a
> resource-intensive
> process and it doesn't scale well with loads of connections.
>
> Why do you think it's an important feature?


For me as a developer its not that important but when showing the monitoring
to management/operators it looks more friendly when you have names instead
of numbers
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/05189b72/attachment.htm>

From pauljones23 at gmail.com  Wed Mar  9 17:43:01 2011
From: pauljones23 at gmail.com (Paul Jones)
Date: Wed, 9 Mar 2011 17:43:01 +0000
Subject: [rabbitmq-discuss] Monitoring - computer names instead of IPs
In-Reply-To: <4D778A1A.4020205@rabbitmq.com>
References: <AANLkTikaaOKdH99d24bSSkNwE=PgtY4jwOWmbZJ8nh3w@mail.gmail.com>
	<AANLkTikoL1MhK9dKq8qc10uTLM_uAJK=4-fVRN6xVAyj@mail.gmail.com>
	<4D778A1A.4020205@rabbitmq.com>
Message-ID: <AANLkTim1T6FJsUdQpnHqbFnPuMCuxqVSb6_7oSm_GBYs@mail.gmail.com>

On Wed, Mar 9, 2011 at 2:09 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

>
> Hmm, yeah, but it could happen in the background, with a cache and it could
> turn itself off if it was taking too long. I've wondered about doing this,
> but I don't know if it would get through the QA process.
>

Could it perhaps just be done in the Web layer by Javascript? Add a REST
call to the management API to resolve IPs, and just replace them in the HTML
as they resolve. That way, you don't even need to write your own cache.

Paul.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/4ac8d7fe/attachment-0001.htm>

From nitesh at wikinvest.com  Wed Mar  9 18:55:32 2011
From: nitesh at wikinvest.com (Nite)
Date: Wed, 9 Mar 2011 10:55:32 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-server init script
In-Reply-To: <20110309135151.GA14426@dakota.eng.vmware.com>
Message-ID: <14035820.548.1299696932953.JavaMail.geo-discussion-forums@prfc6>

Weird, my build does not have a package directory.
Do I have to give any special build parameters?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/56e4a139/attachment.htm>

From asafdav2 at gmail.com  Wed Mar  9 20:32:02 2011
From: asafdav2 at gmail.com (asaf david)
Date: Wed, 9 Mar 2011 12:32:02 -0800 (PST)
Subject: [rabbitmq-discuss] chunking a file to many messages
In-Reply-To: <5826D751-3BAA-481D-A7EE-C19594103122@yahoo-inc.com>
Message-ID: <17802357.11.1299702722518.JavaMail.geo-discussion-forums@vbbbu5>

Hi Deepak and thanks for your answer

   1. I'm not sure this will work, as the server (= the consumer) has no 
   a-priori knowledge about the files that are about to be sent.. so how can it 
   bind queues to their names? maybe i just misunderstood your answer
   2. In that case, does it mean that the consumer has the responsibility of 
   re-ordering the chunks based on their id's? this is not entirely trivial as 
   i don't want to hold a buffer with the size of the complete file and place 
   the chunks in it..

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/4f7735b9/attachment.htm>

From alexandru at rabbitmq.com  Wed Mar  9 21:12:42 2011
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Wed, 9 Mar 2011 23:12:42 +0200
Subject: [rabbitmq-discuss] rabbitmq-server init script
In-Reply-To: <14035820.548.1299696932953.JavaMail.geo-discussion-forums@prfc6>
References: <20110309135151.GA14426@dakota.eng.vmware.com>
	<14035820.548.1299696932953.JavaMail.geo-discussion-forums@prfc6>
Message-ID: <20110309211242.GA2355@dakota.doc.ic.ac.uk>

Ah, no.  That directory is in our source tree, but isn't included in the
source distribution.  Here's the 2.3.1 one:
  http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_3_1/packaging/common/rabbitmq-server.init

Cheers,
Alex

On Wed, Mar 09, 2011 at 10:55:32AM -0800, Nite wrote:
> Weird, my build does not have a package directory.
> Do I have to give any special build parameters?

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From vlad at rabbitmq.com  Wed Mar  9 21:15:32 2011
From: vlad at rabbitmq.com (Vlad Alexandru Ionescu)
Date: Wed, 09 Mar 2011 21:15:32 +0000
Subject: [rabbitmq-discuss] chunking a file to many messages
In-Reply-To: <25859673.87.1299621124348.JavaMail.geo-discussion-forums@yqiz8>
References: <25859673.87.1299621124348.JavaMail.geo-discussion-forums@yqiz8>
Message-ID: <4D77EDF4.20105@rabbitmq.com>


Hi,

To answer 1:
A setup I could imagine would be to have a "work queue", in which each 
message would consist of a file identifier and a queue name. Your 
servers can pick up jobs from this queue in a round-robin fashion. 
Whenever you want to send a new file with your clients, you first 
declare a new queue for your file (let's call it "file queue"), and then 
publish a message to the "work queue" mentioned above (with the name of 
the "file queue"). Then you continue publishing bits of the file to the 
"file queue". The servers that serve a job from the "work queue" would 
subscribe to the "file queue", whose name was picked up from the job's 
message.

And to answer 2:
RabbitMQ guarantees ordering of the messages, as long as the messages in 
question follow the exact same path through the clients and the broker 
(same publisher, same exchange, same queue and same consumer). With the 
setup described above, you should be good to go without extra identifiers.

Hope that makes sense,
Vlad.


On 03/08/2011 09:52 PM, asaf david wrote:
> hello
> I'm a RabbitMQ beginner. I need to handle a case where several clients 
> can produce files for processing, which should be done in some 
> servers. I've realized there is no native support for files transfers, 
> so I'm going to chunk a produced file to many small messages are 
> transfer them (similar to the answer given here 
> <https://groups.google.com/d/msg/rabbitmq-discuss/-G39l-JJtp4/OTSd9FUJdfEJ>), 
> and reassemble them to a whole file at the server. However there are 
> two points i'm not sure about:
>
>    1. How do i make sure that different messages that belong to the
>       same file won't end up in different servers? I want a fair
>       dispatching between the servers on a per-file base, not per-message
>    2. How do I make sure that messages won't be reordered? should i
>       attach an identifier to each message to mark it's location in
>       the original file?
>
> thanks in advance :)
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/8aed0320/attachment.htm>

From alfonso.pantoja at gmail.com  Wed Mar  9 22:47:18 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Wed, 9 Mar 2011 23:47:18 +0100
Subject: [rabbitmq-discuss] Error code 404 NOT_FOUND when declaring a
 queue in a clustered server (using .NET client)
In-Reply-To: <20110225111700.GF2332@dakota.eng.vmware.com>
References: <AANLkTin31yWLEqLWWaTFRqEKMNVvMxwL_PAq1-Ww=TW3@mail.gmail.com>
	<20110225111700.GF2332@dakota.eng.vmware.com>
Message-ID: <AANLkTika117M8TV7XnMAz-yz=qb4T95280A13JeV1fUf@mail.gmail.com>

Hi Alex,

Sorry, my mistake
You are right. The queues were declared on the offline node.
Due to the way to solve this is to bring back up that node we'll have
decided
that every consumer will point to the server that holds the queues
it needs, so a shutdown on the other node won't affect it .


Thank you


Alfonso Pantoja




2011/2/25 Alexandru Scvor?ov <alexandru at rabbitmq.com>

> Hi,
>
> In a cluster, if a there's a durable queue on a down'ed node,
> redeclaring that queue on another node will fail with NOT_FOUND.  The
> only way to solve this is to bring back up the node holding the queue.
>
> This seems to be what you're seeing, but you say all the queues were
> declared on the online node.  Are you sure that's the case?
>
> Does bringing the other node up solve the problem?
>
> Once up, can you delete the queue, redeclare it on SERVER_1, take down
> SERVER_2 again and check if the problem still happens?
>
> BTW, in the next message, you seem to have reversed SERVER_1 and
> SERVER_2.
>
> Cheers,
> Alex
>
> On Fri, Feb 25, 2011 at 11:57:25AM +0100, Alfonso Pantoja wrote:
> > Hi,
> >
> > Today I've got a code=404  NOT_FOUND  error when declaring a queue in a
> > clustered server.
> > We have 2 servers in that cluster. SERVER_1 and SERVER_2.
> > The message reported that the queue the consumer wanted to declare didn't
> > exist which hasn't too much sense...
> >
> > The AMQP operation
> > was interrupted: AMQP close-reason, initiated by Peer, code=404,
> > text="NOT_FOUND - no queue  'alfonsoqueue' in vhost '/'"
> >
> >
> > SERVER_2 was offline and the .NET consumer tried to connect to SERVER1
> (we
> > don't use the array of addresses feature, we point the consumer directly
> to
> > one single server).
> > The queues were created on server SERVER_1 and there were no queues in
> >  webadmin queue listing of SERVER_2.
> >
> > By the way all our queues and exchanges are durable and the first thing
> the
> > consumer do is to a
> > channel.DeclareQueue(name=queue_name, durable=true)
> > In the source code I see this declaration is performed using
> nowait=false,
> > exclusive=false...
> >
> > My
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/2aacd032/attachment.htm>

From nitesh at wikinvest.com  Wed Mar  9 23:29:42 2011
From: nitesh at wikinvest.com (Nite)
Date: Wed, 9 Mar 2011 15:29:42 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-server init script
In-Reply-To: <20110309211242.GA2355@dakota.doc.ic.ac.uk>
Message-ID: <10240645.66.1299713382335.JavaMail.geo-discussion-forums@prig8>

Thanks very much, Alex.

--
Nite
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/5bc29d35/attachment-0001.htm>

From nitesh at wikinvest.com  Thu Mar 10 00:12:36 2011
From: nitesh at wikinvest.com (Nite)
Date: Wed, 9 Mar 2011 16:12:36 -0800 (PST)
Subject: [rabbitmq-discuss] Fine grain access control when using STOMP
Message-ID: <19408795.123.1299715956437.JavaMail.geo-discussion-forums@prfx21>

Hi,
I am trying to replace my ActiveMQ stomp server with RabbitMQ, but am having 
some trouble replicating the same level of access control that I get with 
ActiveMQ. For example, on ActiveMQ, I can specify:

<authorizationMap> <authorizationEntries> <authorizationEntry topic=">" 
write="admins" read="admins" admin="admins" /> <authorizationEntry topic=
"foo.>" write="foo" read="foo" admin="foo" /> </authorizationEntries> 
</authorizationMap>


So admins have access to all topics, but the foo user has access to only the 
topics that begin with the words "foo.", e.g. foo.ping

On rabbitmq, the farthest I can go using rabbitmqctl is:

*./rabbitmqctl set_permissions  foo "amq\.gen.*|amq\.topic$" 
"amq\.gen.*|amq\.topic$" "amq\.gen.*|amq\.topic$"*

Which restricts the user "foo" to access only the topics exchange. How can I 
further restrict foo's access to topics that begin with foo. ?

--
Thanks
Nite




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/301e0384/attachment.htm>

From muesli.john at gmail.com  Thu Mar 10 02:52:08 2011
From: muesli.john at gmail.com (Muesli John)
Date: Wed, 9 Mar 2011 21:52:08 -0500
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <4D551A5E.2050804@rabbitmq.com>
References: <4D51392F.8000508@telecom-sudparis.eu>
	<4D5513B9.1010202@rabbitmq.com> <4D551A5E.2050804@rabbitmq.com>
Message-ID: <AANLkTiny4ALZV-R832fXF3MvU=XDmqY0QBcj4sJEO180@mail.gmail.com>

Hi,

How exactly is this patch to be used? How do I run it?

Thanks.

MJ.

On Fri, Feb 11, 2011 at 6:15 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 11/02/11 10:47, Simon MacMullen wrote:
>
>> If you can't get this working, then you can of course stick with the
>> 2.2.0 client and an upgraded server. But being stuck with an old client
>> isn't fun, so I'll have a think about how easy it would be to patch the
>> old homebrew SASL back in for Android.
>>
>
> Attached is a minimal patch to remove javax.security.sasl from 2.3.1's
> AMQConnection.java and do PLAIN by hand. Any other class that imports
> javax.security.sasl can just be deleted.
>
> I haven't tested this on Android, and it will blow up if the server has
> PLAIN disabled, but it may help you.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110309/221efdbb/attachment.htm>

From simon at rabbitmq.com  Thu Mar 10 12:44:38 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 10 Mar 2011 12:44:38 +0000
Subject: [rabbitmq-discuss] Monitoring - computer names instead of IPs
In-Reply-To: <AANLkTim1T6FJsUdQpnHqbFnPuMCuxqVSb6_7oSm_GBYs@mail.gmail.com>
References: <AANLkTikaaOKdH99d24bSSkNwE=PgtY4jwOWmbZJ8nh3w@mail.gmail.com>	<AANLkTikoL1MhK9dKq8qc10uTLM_uAJK=4-fVRN6xVAyj@mail.gmail.com>	<4D778A1A.4020205@rabbitmq.com>
	<AANLkTim1T6FJsUdQpnHqbFnPuMCuxqVSb6_7oSm_GBYs@mail.gmail.com>
Message-ID: <4D78C7B6.2060905@rabbitmq.com>

On 09/03/11 17:43, Paul Jones wrote:
> Could it perhaps just be done in the Web layer by Javascript? Add a REST
> call to the management API to resolve IPs, and just replace them in the
> HTML as they resolve. That way, you don't even need to write your own cache.

That doesn't appeal much. I think it would be much nicer to do this in 
the HTTP API itself, that way other consumers of the API can get the 
benefit.

I'll file a bug for it, anyway.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From fabiomargarido at gmail.com  Thu Mar 10 13:36:02 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Thu, 10 Mar 2011 10:36:02 -0300
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <4D703B6C.6010608@rabbitmq.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
	<4D6EE8B2.6030507@rabbitmq.com>
	<AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>
	<4D6F908E.2030209@rabbitmq.com>
	<AANLkTimo-XAOsd_paeJAbud=RpzertM8oEPDPLHdacO4@mail.gmail.com>
	<4D6FB9DC.2080800@rabbitmq.com>
	<AANLkTi=rLYV90KSv4b8e=AcKiiukP=yPVy4vXLTpbCbA@mail.gmail.com>
	<4D703B6C.6010608@rabbitmq.com>
Message-ID: <AANLkTik=+kvtcQmaaB-BWuq9QWFpxqrp1oDey5dPzvtU@mail.gmail.com>

Hi Michael.

I've worked a bit more on my tests by now and another doubt has come
up. Is there any way to make messages exchanged through x-lvc
persistent? The scenario I'm exercising is: the publisher sends a
message to the broker, it is consumed a few times, the broker dies and
starts up again, then a few new consumers try to receive the message.
I can't get this to work yet.


From mark.pork at gmail.com  Thu Mar 10 14:28:19 2011
From: mark.pork at gmail.com (butterdave2)
Date: Thu, 10 Mar 2011 06:28:19 -0800 (PST)
Subject: [rabbitmq-discuss] Re  try and Throttling
In-Reply-To: <AANLkTi=6wpFGYrEgCyYPZBxYYeRZFyD0zwK5RjWx74kX@mail.gmail.com>
References: <31098579.post@talk.nabble.com>
	<AANLkTi=q9cKzLKAKfh+q4OriU2NJYwiFDvLUBYstn=5w@mail.gmail.com>
	<31107114.post@talk.nabble.com>
	<AANLkTi=6wpFGYrEgCyYPZBxYYeRZFyD0zwK5RjWx74kX@mail.gmail.com>
Message-ID: <31116158.post@talk.nabble.com>


Thanks for speedy reply!

Too bad about the "delay plugin" thought...:(

So, one last (hopefully) request. 

What are some common patterns around delaying a message then?

One solution I've found on the forum is to put in an "expiry date" on the
message. This simple approach would just have the Producer inspecting the
message before processing, else requeue.

However, the one downfall of this approach results in a lot of needless
"chatter" between the Server and the Producer. Can I process? Can I process?
Can I process? Can I process?, ....

Any other ideas or suggestions?

Much appreciated!

DP






Marek Majkowski wrote:
> 
> On Wed, Mar 9, 2011 at 15:00, butterdave2 <mark.pork at gmail.com> wrote:
>>
>> What about simulating a delay by not republishing a message back (via
>> channel.basicReject) onto the queue by the Consumer code? If I'm not
>> mistaken, as long as the Channel is kept alive, that message can be held
>> out
>> of the queue indefinitely.
> 
> This is correct if you're using acknowledgments.
> 
>> On another note, could a new plugin provide the global delay settings on
>> Rabbit?
> 
> I don't think that's possible.
> 
> 
> 
> 
>> Marek Majkowski wrote:
>>>
>>> On Tue, Mar 8, 2011 at 16:08, butterdave2 <mark.pork at gmail.com> wrote:
>>>>
>>>> Is there anything in Rabbit that can control the amount of times a
>>>> consumer
>>>> may "retry" a message?
>>>
>>> No, but if the message is redelivered you should see "redelivered"
>>> field being set
>>> to "True".
>>>
>>>> There may be instances when a message has something about it that will
>>>> cause
>>>> it to "fail" downstream in the Consumer code. I wouldn't want to
>>>> continue
>>>> to
>>>> hammer away...
>>>
>>> Correct. But rabbit can't know if your consumer died due to the message
>>> or due to something else, power failure or something.
>>>
>>> It's the programmers responsibility to handle dying-consumer case.
>>>
>>>> I can programmatically include the number of retry attempts with the
>>>> message
>>>> (a kind of metadata) and then design the Consumer to query this field.
>>>> (then
>>>> once we hit our MAX_RETRY, we will do something else to it...)
>>>
>>> Sounds good.
>>>
>>>> Also in similar fashion, is there any control around "throttling" or
>>>> slowing
>>>> down the consumption of messages from a queue?
>>>
>>> You can't control that, Rabbit is designed to deliver messages when it
>>> can.
>>> But you can use basic.qos to do something similar. Or, if you're
>>> desperate
>>> you may just run basic.get with regular intervals.
>>>
>>> Cheers,
>>> ? Marek
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> --
>> View this message in context:
>> http://old.nabble.com/Retry-and-Throttling-tp31098579p31107114.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Retry-and-Throttling-tp31098579p31116158.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From majek04 at gmail.com  Thu Mar 10 17:40:24 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 10 Mar 2011 17:40:24 +0000
Subject: [rabbitmq-discuss] Re try and Throttling
In-Reply-To: <31116158.post@talk.nabble.com>
References: <31098579.post@talk.nabble.com>
	<AANLkTi=q9cKzLKAKfh+q4OriU2NJYwiFDvLUBYstn=5w@mail.gmail.com>
	<31107114.post@talk.nabble.com>
	<AANLkTi=6wpFGYrEgCyYPZBxYYeRZFyD0zwK5RjWx74kX@mail.gmail.com>
	<31116158.post@talk.nabble.com>
Message-ID: <AANLkTinJHoqrr60bvryjrMgYZ_GVXchahVs5-4BM3Zxa@mail.gmail.com>

On Thu, Mar 10, 2011 at 14:28, butterdave2 <mark.pork at gmail.com> wrote:
> Thanks for speedy reply!
>
> Too bad about the "delay plugin" thought...:(
>
> So, one last (hopefully) request.
>
> What are some common patterns around delaying a message then?
>
> One solution I've found on the forum is to put in an "expiry date" on the
> message. This simple approach would just have the Producer inspecting the
> message before processing, else requeue.
>
> However, the one downfall of this approach results in a lot of needless
> "chatter" between the Server and the Producer. Can I process? Can I process?
> Can I process? Can I process?, ....

Maybe post it to another queue, and rarely pickup from there?

From joe.garro at gmail.com  Thu Mar 10 17:49:38 2011
From: joe.garro at gmail.com (Joe Garro)
Date: Thu, 10 Mar 2011 09:49:38 -0800
Subject: [rabbitmq-discuss] Valid Routing Keys on Direct Exchange
Message-ID: <AANLkTi=GVtWn5BCs_WohbwyB6TuPy-jw_dnkkPvSAzzj@mail.gmail.com>

Hello,

Take sample 4 on the Getting Started documentation, I can successful
implement this in .NET. However, for a while I was trying to specify my
routing keys as follows on a direct exchange all bound to one queue.

Log.Info
Log.Warn
Log.Error

When I attempt to send messages with any of those routing keys nothing
happens.

If I remove "Log." from the routing key for both binding and sending, then
messages are routed successfully.

Is there a limitation on using "." in routing keys on a direct exchange?

Thanks,
Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110310/454bcb10/attachment.htm>

From shomron at gmail.com  Thu Mar 10 19:57:51 2011
From: shomron at gmail.com (Oren Shomron)
Date: Thu, 10 Mar 2011 11:57:51 -0800 (PST)
Subject: [rabbitmq-discuss] Client IP based user login permissions
Message-ID: <ccd2fd9e-af59-4921-9c85-04363b906800@k10g2000prh.googlegroups.com>

Hi everyone,

Are there any plans for client ip permissions mapping, similar to
PostgreSQL's pg_hba.conf, where you would be able to define which
users are allowed to login from which ip's?

Are there any workarounds to achieve such functionality, like running
the broker on multiple ports, having the different ports use different
virtual hosts, and using firewall rules to enforce the whole thing?

Thanks,
  - Oren

From brian.thomason at canonical.com  Thu Mar 10 20:22:11 2011
From: brian.thomason at canonical.com (Brian Thomason)
Date: Thu, 10 Mar 2011 15:22:11 -0500
Subject: [rabbitmq-discuss] rabbitmq 2.3 and SERVER_START_ARGS
Message-ID: <AANLkTing1sFhCWG_fyc=c6Yd3NwPtg1H3v=8cqveiRP5@mail.gmail.com>

Hi,

I was packaging up the stomp plugin for rabbitmq 2.2.0 and was
using SERVER_START_ARGS in /etc/rabbitmq/rabbitmq.conf (actually, since
rabbitmq just sources that file, I setup a .d directory and
had /etc/rabbitmq/rabbitmq.conf source that dir so plugins could drop-in
their own config snippets) to set the ports that stomp should listen on.

I see that the config file has changed in rabbitmq 2.3, but according to the
docs, the env vars in rabbitmq.conf should still be honored; however, that
doesn't appear to be working.

Has the SERVER_START_ARGS env var been changed to something else or as of
2.3, is there simply no way to change stomp ports without using the new
config file format?

Regards,

Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110310/3286a9dc/attachment-0001.htm>

From lee at rightscale.com  Fri Mar 11 04:03:42 2011
From: lee at rightscale.com (Lee Kirchhoff)
Date: Thu, 10 Mar 2011 20:03:42 -0800
Subject: [rabbitmq-discuss] Failure during shutdown with v2.3.1
Message-ID: <AANLkTim6SSfPEWQf9C_q5GxeEsX534+sCTSbNADdHeGx@mail.gmail.com>

Hi,

I recently upgraded from RabbitMQ 1.8.1 to 2.3.1 and am running in Mac and
Ubuntu enviroments. I have a plugin that uses the amqp_client to access a
local queue. With 2.3.1 when shutting down I get the error below, which I
never encountered previously. There is no load when the shutdown is
happening.

I tried to determine the cause. It appears that it may be something of a
race in that when I insert a 500 msec delay in
amqp_channels_manger:handle_channel_down/4 I get the initial internal error
indication, but no following error report. My plugin is listed before the
amqp_client application when I do a 'rabbitmqctl status' so I it should be
the first getting a chance to shutdown and close its amqp connection, i.e.,
before the amqp_client shuts down, but I suppose applications shutdown
asynchronously.

Is this a bug or am I violating some RabbitMQ design assumption. Like I
said, it wasn't happening with 1.8.1 over the last 10 months of use.

Lee Kirchhoff


=WARNING REPORT==== 10-Mar-2011::16:19:53 ===
Connection (<0.258.0>) closing: internal error in channel (<0.263.0>):
shutdown

=INFO REPORT==== 10-Mar-2011::16:19:53 ===
stopped TCP Listener on 0.0.0.0:5672

=ERROR REPORT==== 10-Mar-2011::16:19:53 ===
** Generic server <0.258.0> terminating
** Last message in was {'$gen_cast',channels_terminated}
** When Server state == {state,amqp_direct_connection,
                         {state,'rabbit at Lee-Kirchoffs-MacBook-Pro-9',
                          {user,<<"admin">>,false,
                           rabbit_auth_backend_internal,
                           {internal_user,<<"admin">>,

<<167,250,242,115,130,251,81,144,147,129,52,74,15,
                              106,4,17,219,130,101,154>>,
                            false}},
                          <<"/right_net">>,<0.261.0>,
                          {internal_error,541,<<>>}},
                         <0.256.0>,<0.259.0>,
                         {amqp_params,<<"admin">>,<<"71a8B521">>,
                          <<"/right_net">>,"localhost",5672,
                          'rabbit at Lee-Kirchoffs-MacBook-Pro-9',0,0,0,none,
                          [#Fun<amqp_auth_mechanisms.plain.3>,
                           #Fun<amqp_auth_mechanisms.amqplain.3>],
                          []},
                         0,
                         [{<<"copyright">>,longstr,
                           <<"Copyright (C) 2007-2011 VMware, Inc.">>},
                          {<<"information">>,longstr,
                           <<"Licensed under the MPL.  See
http://www.rabbitmq.com/">>},
                          {<<"platform">>,longstr,<<"Erlang/OTP">>},
                          {<<"product">>,longstr,<<"RabbitMQ">>},
                          {<<"version">>,longstr,<<"%%VSN%%">>}],
                         #Fun<amqp_connection_sup.1.27217533>,
                         #Fun<amqp_connection_sup.2.105785818>,
                         {closing,internal_error,
                          {'connection.close',541,<<>>,0,0},
                          none}}
** Reason for termination ==
** {internal_error,541,<<>>}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110310/bb2fea91/attachment.htm>

From chen650 at yahoo.com  Fri Mar 11 05:48:08 2011
From: chen650 at yahoo.com (alex chen)
Date: Thu, 10 Mar 2011 21:48:08 -0800 (PST)
Subject: [rabbitmq-discuss] server crashes with very fast consumers
Message-ID: <486630.9133.qm@web31810.mail.mud.yahoo.com>

Hi,

I am testing rabbit server with SSD.  The broker process would crash when many 
consumers start to consume backed up messages.  Because SSD if very fast, the 
consuming rate reached more than 200 MB/sec.  After several minutes, the broker 
process would use all cpu resources (800% on 8 cores) and crash.

The setup is almost exactly the same as before:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-August/008420.html
The only difference is I am using SSD instead of regular hard disk this time.  
with regular hard disk, the consuming rate was around 30 MB/sec, so broker's cpu 
usage was not maxed out.

I tested both server 2.0.0 and 2.3.1, both crashed with SSD, but did not crash 
with regular hd.
I am wondering if anyone has done similar test with SSD?
thanks.

-alex



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110310/0e8dcea0/attachment.htm>

From dhivya.swaminathan at tcs.com  Fri Mar 11 06:19:58 2011
From: dhivya.swaminathan at tcs.com (Dhivya Swaminathan)
Date: Fri, 11 Mar 2011 11:49:58 +0530
Subject: [rabbitmq-discuss] RabbitMq Installation
Message-ID: <OF760FFF55.F37FE12A-ON65257850.0022C98F-65257850.0022C995@tcs.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110311/c0d49e72/attachment.htm>

From matthias at rabbitmq.com  Fri Mar 11 06:42:13 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 11 Mar 2011 06:42:13 +0000
Subject: [rabbitmq-discuss] RabbitMq Installation
In-Reply-To: <OF760FFF55.F37FE12A-ON65257850.0022C98F-65257850.0022C995@tcs.com>
References: <OF760FFF55.F37FE12A-ON65257850.0022C98F-65257850.0022C995@tcs.com>
Message-ID: <4D79C445.3060105@rabbitmq.com>

Dhivya,

Dhivya Swaminathan wrote:
> [318467 at CEG318 RabbitMQ]$ sudo rpm -ivh rabbitmq-server-2.3.1-1.noarch.rpm
> warning: rabbitmq-server-2.3.1-1.noarch.rpm: Header V4 DSA signature: 
> NOKEY, key ID 056e8e56
> error: Failed dependencies:
>     erlang >= R12B-3 is needed by rabbitmq-server-2.3.1-1.noarch
> [318467 at CEG318 RabbitMQ]$
> 
> 1.Whether we need to provide any R12B-3 rpm files?
> 2.If so,Where is it available?
> 3.Orelse how this problem is solved using EPEL?

See the section on "RPM-based Linux" at 
http://www.rabbitmq.com/server.html, in particular this bit:

<quote>
To enable EPEL on your Red Hat machine, see the EPEL FAQ 
(http://fedoraproject.org/wiki/EPEL/FAQ#howtouse). Then just "yum 
install erlang".
</quote>

Please also read the paragraph just below that, which explain how to get 
hold of a more recent version of Erlang than what ships with EPEL.

Regards,

Matthias.

From matthias at rabbitmq.com  Fri Mar 11 06:48:34 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 11 Mar 2011 06:48:34 +0000
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <486630.9133.qm@web31810.mail.mud.yahoo.com>
References: <486630.9133.qm@web31810.mail.mud.yahoo.com>
Message-ID: <4D79C5C2.7010104@rabbitmq.com>

Alex,

alex chen wrote:
> I am testing rabbit server with SSD.  The broker process would crash 
> when many consumers start to consume backed up messages.  Because SSD if 
> very fast, the consuming rate reached more than 200 MB/sec.  After 
> several minutes, the broker process would use all cpu resources (800% on 
> 8 cores) and crash.
> [...]
> I tested both server 2.0.0 and 2.3.1, both crashed with SSD, but did not 
> crash with regular hd.

I'm not surprised that 2.0.0 runs into problems, but 2.3.1 should really 
handle this just fine. Is there anything of interest in any of the logs? 
Did you get a crash dump?

> I am wondering if anyone has done similar test with SSD?

Yes, we have run tests against SSD.

Can you post your test code?


Regards,

Matthias.

From chen650 at yahoo.com  Fri Mar 11 08:28:31 2011
From: chen650 at yahoo.com (alex chen)
Date: Fri, 11 Mar 2011 00:28:31 -0800 (PST)
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <4D79C5C2.7010104@rabbitmq.com>
References: <486630.9133.qm@web31810.mail.mud.yahoo.com>
	<4D79C5C2.7010104@rabbitmq.com>
Message-ID: <111862.43754.qm@web31808.mail.mud.yahoo.com>





> I'm not surprised that 2.0.0 runs into problems, but 2.3.1 should really handle 
>this just fine. Is there anything of interest in any of the logs? Did you get a 
>crash dump?

nothing interesting in the logs.  did not get a crash dump.

> Yes, we have run tests against SSD.
> Can you post your test code?


it is the same rabbitmq-c consumer code that i attached in previous thread:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-August/008585.html
The problem can be reproduced by first publishing 20 GB of messages (each 
message is 20 KB) into 1000 queues, then start 1000 consumers at the same time 
to consume those messages.  within 1 minute the broker would crash.

Thanks for looking into this.

-alex



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110311/c31562a5/attachment-0001.htm>

From matthias at rabbitmq.com  Fri Mar 11 08:38:44 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 11 Mar 2011 08:38:44 +0000
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <111862.43754.qm@web31808.mail.mud.yahoo.com>
References: <486630.9133.qm@web31810.mail.mud.yahoo.com>
	<4D79C5C2.7010104@rabbitmq.com>
	<111862.43754.qm@web31808.mail.mud.yahoo.com>
Message-ID: <4D79DF94.6030606@rabbitmq.com>

Alex,

alex chen wrote:
>  > Can you post your test code?
> 
> it is the same rabbitmq-c consumer code that i attached in previous thread:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-August/008585.html
> The problem can be reproduced by first publishing 20 GB of messages 
> (each message is 20 KB) into 1000 queues, then start 1000 consumers at 
> the same time to consume those messages.  within 1 minute the broker 
> would crash.

Any chance you could script the above to the point where all one needs 
to do is:
1) start clean rabbit
2) run test script
3) wait for broker to die
?

I want to make sure that in trying to reproduce the problem we follow 
*exactly* the same steps.

Regards,

Matthias.

From emile at rabbitmq.com  Fri Mar 11 10:25:18 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 11 Mar 2011 10:25:18 +0000
Subject: [rabbitmq-discuss] Valid Routing Keys on Direct Exchange
In-Reply-To: <AANLkTi=GVtWn5BCs_WohbwyB6TuPy-jw_dnkkPvSAzzj@mail.gmail.com>
References: <AANLkTi=GVtWn5BCs_WohbwyB6TuPy-jw_dnkkPvSAzzj@mail.gmail.com>
Message-ID: <4D79F88E.2020301@rabbitmq.com>

Hi Joe


On 10/03/11 17:49, Joe Garro wrote:
> Hello,
>
> Take sample 4 on the Getting Started documentation, I can successful
> implement this in .NET. However, for a while I was trying to specify my
> routing keys as follows on a direct exchange all bound to one queue.
>
> Log.Info
> Log.Warn
> Log.Error
>
> When I attempt to send messages with any of those routing keys nothing
> happens.

I'm not able to reproduce your results. Routing keys containing dots 
work just fine for me. Are you sure you are using a direct exchange?

Regards

Emile

From simon at rabbitmq.com  Fri Mar 11 10:29:26 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Mar 2011 10:29:26 +0000
Subject: [rabbitmq-discuss] rabbitmq 2.3 and SERVER_START_ARGS
In-Reply-To: <AANLkTing1sFhCWG_fyc=c6Yd3NwPtg1H3v=8cqveiRP5@mail.gmail.com>
References: <AANLkTing1sFhCWG_fyc=c6Yd3NwPtg1H3v=8cqveiRP5@mail.gmail.com>
Message-ID: <4D79F986.7010907@rabbitmq.com>

On 10/03/11 20:22, Brian Thomason wrote:
> Has the SERVER_START_ARGS env var been changed to something else or as
> of 2.3, is there simply no way to change stomp ports without using the
> new config file format?

Hi Brian. No, the SERVER_START_ARGS variable has not changed.

However, this variable basically allows you to add fragments of the 
*new* config format, so the contents of SERVER_START_ARGS will need to 
change - from something like:

SERVER_START_ARGS='-rabbit_stomp listeners [{"a.b.c.d",61613}]'

in 2.2.0 to

SERVER_START_ARGS='-rabbit_stomp tcp_listeners [{"a.b.c.d",61613}]'

in 2.3.1.

(We made this change to make it consistent with the main rabbit AMQP 
configuration.)

Other changes in 2.3.1 in this area:

* The stomp adapter defaults to listening on all interfaces, rather than 
just 127.0.0.1

* You can specify just a port number (e.g. [61613]) to specify all 
interfaces with a different port

Finally, can I ask what benefit you're getting from using the old 
configuration file? We'd like to do away with it at some point, and it 
would be nice to be sure we weren't breaking anything :)

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Fri Mar 11 10:36:41 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Mar 2011 10:36:41 +0000
Subject: [rabbitmq-discuss] Client IP based user login permissions
In-Reply-To: <ccd2fd9e-af59-4921-9c85-04363b906800@k10g2000prh.googlegroups.com>
References: <ccd2fd9e-af59-4921-9c85-04363b906800@k10g2000prh.googlegroups.com>
Message-ID: <4D79FB39.8010305@rabbitmq.com>

On 10/03/11 19:57, Oren Shomron wrote:
> Are there any plans for client ip permissions mapping, similar to
> PostgreSQL's pg_hba.conf, where you would be able to define which
> users are allowed to login from which ip's?

Hi Oren. There are vague plans in my head, but figuring out how it would 
interact with everything else in the world of authentication is not 
completely obvious.

Knowing your use case would help.

> Are there any workarounds to achieve such functionality, like running
> the broker on multiple ports, having the different ports use different
> virtual hosts, and using firewall rules to enforce the whole thing?

I'm afraid that wouldn't work - you can't map virtual hosts to ports.

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From rob at rabbitmq.com  Fri Mar 11 14:27:52 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 11 Mar 2011 14:27:52 +0000
Subject: [rabbitmq-discuss] Fine grain access control when using STOMP
In-Reply-To: <19408795.123.1299715956437.JavaMail.geo-discussion-forums@prfx21>
References: <19408795.123.1299715956437.JavaMail.geo-discussion-forums@prfx21>
Message-ID: <4D7A3168.3000901@rabbitmq.com>

Nite,

There is no way to restrict user access to particular routing key patterns.

One approach that might approximate this is to use separate topic 
exchanges for the topics you want. You can then address these in the 
STOMP adapter using /exchange/<topic.exchange.name>/<routing.key>

Regards,

Rob

On 10/03/11 00:12, Nite wrote:
> Hi,
> I am trying to replace my ActiveMQ stomp server with RabbitMQ, but am
> having some trouble replicating the same level of access control that I
> get with ActiveMQ. For example, on ActiveMQ, I can specify:
>
> <authorizationMap> <authorizationEntries> <authorizationEntry topic=">"
> write="admins" read="admins" admin="admins" /> <authorizationEntry
> topic="foo.>" write="foo" read="foo" admin="foo" />
> </authorizationEntries> </authorizationMap>
>
>
> So admins have access to all topics, but the foo user has access to only
> the topics that begin with the words "foo.", e.g. foo.ping
>
> On rabbitmq, the farthest I can go using rabbitmqctl is:
>
> *./rabbitmqctl set_permissions foo "amq\.gen.*|amq\.topic$"
> "amq\.gen.*|amq\.topic$" "amq\.gen.*|amq\.topic$"*
>
> Which restricts the user "foo" to access only the topics exchange. How
> can I further restrict foo's access to topics that begin with foo. ?
>
> --
> Thanks
> Nite
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From allen.kim at epicadvertising.com  Fri Mar 11 15:40:31 2011
From: allen.kim at epicadvertising.com (Allen Kim)
Date: Fri, 11 Mar 2011 09:40:31 -0600
Subject: [rabbitmq-discuss] Rabbitmq-Shovel Timer-Based Publishing Possible?
Message-ID: <C99FAC9F.3366%allen.kim@epicadvertising.com>

We have been using customized rabbit_shovel plugin to pass messages around data centers.
It mainly had two features; message-count-based ack. and time-based ack.

We are planning to switch to new shovel plugin comes with 2.3.1, and currently testing on it.
It works great, but I miss timer-based publish, which is very useful in the midnight with low number of message.

Is that feature already exists, and I don't know? Or is there a way to do it using rabbit-shovel plugin?

Thanks

Allen Kim




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110311/73efe07a/attachment.htm>

From rishdev at gmail.com  Fri Mar 11 16:02:05 2011
From: rishdev at gmail.com (RishiDev)
Date: Fri, 11 Mar 2011 08:02:05 -0800 (PST)
Subject: [rabbitmq-discuss] Consumer - threw an exception for channel
	AMQChannel
Message-ID: <dce543bd-800f-4a2a-af20-9801ce1826d9@t19g2000prd.googlegroups.com>

Hi,

I have about 10K large msgs (each ~3 MB) in a queue. Started running a
java consumer client on the queue and after receiving 16 msgs I got
following exception. Please help resolve/understand the issue.

Consumer com.rabbitmq.client.QueueingConsumer at 15b9e68 (amq.ctag-bEjkq
+5EqqmXsp1idK9rrg==) method handleDelivery for channel
AMQChannel(amqp://guest at localhost:5672/,1) threw an exception for
channel AMQChannel(amqp://guest at localhost:5672/,1):
java.lang.OutOfMemoryError
com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
reason: Attempt to use closed channel
	at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:
195)
	at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:290)
	at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:284)
	at com.rabbitmq.client.impl.ChannelN.basicAck(ChannelN.java:669)
	at
com.octanner.jmspoc.rabbitmq.RabbitMQConsumer.receiveMsgs(RabbitMQConsumer.java:
69)
	at
com.octanner.jmspoc.rabbitmq.RabbitMQConsumer.main(RabbitMQConsumer.java:
77)
Exception in thread "main"

Thanks,
Rishi

From rob at rabbitmq.com  Fri Mar 11 16:30:19 2011
From: rob at rabbitmq.com (Rob Harrop)
Date: Fri, 11 Mar 2011 16:30:19 +0000
Subject: [rabbitmq-discuss] Consumer - threw an exception for channel
 AMQChannel
In-Reply-To: <dce543bd-800f-4a2a-af20-9801ce1826d9@t19g2000prd.googlegroups.com>
References: <dce543bd-800f-4a2a-af20-9801ce1826d9@t19g2000prd.googlegroups.com>
Message-ID: <4D7A4E1B.6070202@rabbitmq.com>

What heap size do you have configured for your JVM? It's is entirely 
possible that if you're using the default sizes that 16 3MB msgs will 
cause you to start hitting the OOM exception.

Regards,

Rob

On 11/03/11 16:02, RishiDev wrote:
> Hi,
>
> I have about 10K large msgs (each ~3 MB) in a queue. Started running a
> java consumer client on the queue and after receiving 16 msgs I got
> following exception. Please help resolve/understand the issue.
>
> Consumer com.rabbitmq.client.QueueingConsumer at 15b9e68 (amq.ctag-bEjkq
> +5EqqmXsp1idK9rrg==) method handleDelivery for channel
> AMQChannel(amqp://guest at localhost:5672/,1) threw an exception for
> channel AMQChannel(amqp://guest at localhost:5672/,1):
> java.lang.OutOfMemoryError
> com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
> reason: Attempt to use closed channel
> 	at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:
> 195)
> 	at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:290)
> 	at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:284)
> 	at com.rabbitmq.client.impl.ChannelN.basicAck(ChannelN.java:669)
> 	at
> com.octanner.jmspoc.rabbitmq.RabbitMQConsumer.receiveMsgs(RabbitMQConsumer.java:
> 69)
> 	at
> com.octanner.jmspoc.rabbitmq.RabbitMQConsumer.main(RabbitMQConsumer.java:
> 77)
> Exception in thread "main"
>
> Thanks,
> Rishi
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From shomron at gmail.com  Fri Mar 11 16:43:25 2011
From: shomron at gmail.com (Oren Shomron)
Date: Fri, 11 Mar 2011 08:43:25 -0800 (PST)
Subject: [rabbitmq-discuss] Client IP based user login permissions
In-Reply-To: <4D79FB39.8010305@rabbitmq.com>
Message-ID: <12162749.351.1299861805836.JavaMail.geo-discussion-forums@vbbfl13>

Hi Simon,

My use case is something like this:

I'm working on a distributed system, which consists of externally facing 
HTTP servers that can kick off events through RabbitMQ, as well as 
internally facing components which need to react to those external events 
but also send internal privileged events to each other.

I am trying to protect against a situation where a compromised external HTTP 
server could send privileged events  to our internal components.

Right now I have created two users and two exchanges, one for internal and 
one external.

The external user can only post to the external exchange. I have an internal 
component bound to the external exchange which performs validation on those 
incoming events before forwarding them on to the internal exchange. The rest 
of the internal components only bind to the internal exchange and know that 
the events they receive have been validated.

I would like another line of defense - if the external machine were 
compromised and the internal rabbit user's credentials were stolen somehow, 
there's nothing stopping that external machine from using those internal 
credentials and compromising the whole system. The firewall allows that 
machine to talk to RabbitMQ, but no one is enforcing that only the correct, 
limited user can log in over that channel.

The only way I see of doing it right now would be to have completely 
separate RabbitMQ instances, and have that validation component talk to both 
instances and forward between them, but this would increase complexity.

Let me know if that makes any sense.

Thanks in advance!
  - Oren
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110311/3456f98c/attachment.htm>

From marcel.meyer at gmail.com  Fri Mar 11 17:07:32 2011
From: marcel.meyer at gmail.com (Marcel Meyer)
Date: Fri, 11 Mar 2011 12:07:32 -0500
Subject: [rabbitmq-discuss] Reddit news
Message-ID: <AANLkTikM25E3k_zf53v-PT+B2N+aa=YzP_eT-t9na2+N@mail.gmail.com>

Hi there Rabbit Community,

I am researching queues and found this thread about reddit's gripes (
http://www.reddit.com/tb/c2spc) and noticed that RabbitMQ Support reached
out to them.

Were there issues resolved? They upgraded ERTS as a "stopgap" fix, but
wanted to yank the technology all together. Did they?

Regards,
Marcel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110311/20e1a022/attachment.htm>

From alexis at rabbitmq.com  Fri Mar 11 17:13:49 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 11 Mar 2011 17:13:49 +0000
Subject: [rabbitmq-discuss] Reddit news
In-Reply-To: <AANLkTikM25E3k_zf53v-PT+B2N+aa=YzP_eT-t9na2+N@mail.gmail.com>
References: <AANLkTikM25E3k_zf53v-PT+B2N+aa=YzP_eT-t9na2+N@mail.gmail.com>
Message-ID: <AANLkTikaU19=feRbbmUH7t7G28-a_=WKO-pvTshRgWm7@mail.gmail.com>

Hi Marcel

Yes, I believe so.   Matthew went to see them.  As I recall the main
issues were actually not with Rabbit, but some of how they had used
messaging was worth discussing.

alexis


On Fri, Mar 11, 2011 at 5:07 PM, Marcel Meyer <marcel.meyer at gmail.com> wrote:
> Hi there Rabbit Community,
> I am researching queues and found this?thread about reddit's gripes
> (http://www.reddit.com/tb/c2spc) and noticed that RabbitMQ Support reached
> out to them.
> Were there issues resolved? They upgraded ERTS as a "stopgap" fix, but
> wanted to yank the technology all together. Did they?
> Regards,
> Marcel
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From brian.thomason at gmail.com  Fri Mar 11 17:47:26 2011
From: brian.thomason at gmail.com (brian.thomason at gmail.com)
Date: Fri, 11 Mar 2011 12:47:26 -0500
Subject: [rabbitmq-discuss] rabbitmq 2.3 and SERVER_START_ARGS
In-Reply-To: <4D79F986.7010907@rabbitmq.com>
References: <AANLkTing1sFhCWG_fyc=c6Yd3NwPtg1H3v=8cqveiRP5@mail.gmail.com>
	<4D79F986.7010907@rabbitmq.com>
Message-ID: <AANLkTinpaPsYFaO-6T=bbnPSTJFkjHE3U0OxhXE6QYa6@mail.gmail.com>

Many thanks Simon,

That did the trick!


> Finally, can I ask what benefit you're getting from using the old
> configuration file? We'd like to do away with it at some point, and it would
> be nice to be sure we weren't breaking anything :)
>
>
Yes, it's due to the modularity it provides.  Here is my rabbitmq.conf file:

for CONFIGFILE in `ls /etc/rabbitmq/rabbitmq.conf.d |sort -r`; do
    . /etc/rabbitmq/rabbitmq.conf.d/$CONFIGFILE
done


From simon at rabbitmq.com  Fri Mar 11 17:51:55 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 11 Mar 2011 17:51:55 +0000
Subject: [rabbitmq-discuss] rabbitmq 2.3 and SERVER_START_ARGS
In-Reply-To: <AANLkTinpaPsYFaO-6T=bbnPSTJFkjHE3U0OxhXE6QYa6@mail.gmail.com>
References: <AANLkTing1sFhCWG_fyc=c6Yd3NwPtg1H3v=8cqveiRP5@mail.gmail.com>	<4D79F986.7010907@rabbitmq.com>
	<AANLkTinpaPsYFaO-6T=bbnPSTJFkjHE3U0OxhXE6QYa6@mail.gmail.com>
Message-ID: <4D7A613B.1050904@rabbitmq.com>

On 11/03/11 17:47, brian.thomason at gmail.com wrote:
>  From there each plugin package can just install its snippet
> to  /etc/rabbitmq/rabbitmq.conf.d. Any chance when this config file is
> done away with a .d type implementation can be made to replace it?

Yes, I was assuming we'd do that. Glad it wasn't anything weird you 
wanted :)

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From marcel.meyer at gmail.com  Fri Mar 11 19:30:03 2011
From: marcel.meyer at gmail.com (Marcel Meyer)
Date: Fri, 11 Mar 2011 14:30:03 -0500
Subject: [rabbitmq-discuss] Reddit news
In-Reply-To: <AANLkTikaU19=feRbbmUH7t7G28-a_=WKO-pvTshRgWm7@mail.gmail.com>
References: <AANLkTikM25E3k_zf53v-PT+B2N+aa=YzP_eT-t9na2+N@mail.gmail.com>
	<AANLkTikaU19=feRbbmUH7t7G28-a_=WKO-pvTshRgWm7@mail.gmail.com>
Message-ID: <AANLkTim2MTCHwnGR0t+iiTM388NVZu4+VwS9VckzEX2Y@mail.gmail.com>

Great! Do you know whether this was documented as some anti-pattern? Is
there more about the specific issues they faced?

On Fri, Mar 11, 2011 at 12:13 PM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> Hi Marcel
>
> Yes, I believe so.   Matthew went to see them.  As I recall the main
> issues were actually not with Rabbit, but some of how they had used
> messaging was worth discussing.
>
> alexis
>
>
> On Fri, Mar 11, 2011 at 5:07 PM, Marcel Meyer <marcel.meyer at gmail.com>
> wrote:
> > Hi there Rabbit Community,
> > I am researching queues and found this thread about reddit's gripes
> > (http://www.reddit.com/tb/c2spc) and noticed that RabbitMQ Support
> reached
> > out to them.
> > Were there issues resolved? They upgraded ERTS as a "stopgap" fix, but
> > wanted to yank the technology all together. Did they?
> > Regards,
> > Marcel
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110311/de8d75f7/attachment.htm>

From taylste at gmail.com  Sat Mar 12 08:06:18 2011
From: taylste at gmail.com (Steven Taylor)
Date: Sat, 12 Mar 2011 08:06:18 +0000
Subject: [rabbitmq-discuss] Subscription Pattern in .net
Message-ID: <AANLkTim=9nDjV9UVmudcC3dh4XdK9DjHT5uLiUHew6-M@mail.gmail.com>

Hi,

I like the Consumer pattern, but I wanted a timed version of it.  FYI: the
Consumer pattern is basically a message enumerator/iterator that you can use
in a foreach statement.  i.e. when a message turns up, you get another pass
through the loop during which your code can decide what to do with the
message.  Consumer lives in the RabbitMQ.Client.MessagePatterns namespace.

For me, Foreach is neat approach as It hides uneccessesary detail.

 I finally managed to dig into some of the RabbitMQ source code.  Is source
code better than documentation?  Maybe.

Anyway, the functionality I wanted was always there.  How did I miss that?
There's a version of the Next function that has a parameter for a timed
wait.

So, instead of:

using(Subscription sub=new Subscription(ch,QueueNme)) {
  foreach(BasicDeliverEventArgs ev in sub) {
    DoRQMessage(ev.Body);
    // do work here
    ch.BasicAck(ev.DeliveryTag,true);
  }
  sub.Ack();
}

Use this instead...

using(Subscription sub=new Subscription(ch,QueueNme)) {
  BasicDeliverEventArgs message;
  while(true) {
    sub.Next(5000,out message); // wait up to 5 seconds
    if(message==null) {
      // logic to deal with the timeout
      break; // kill the loop if that's what you want
    }
    // do work here
    ch.BasicAck(message.DeliveryTag,true);
  }
}

Note: behind the scenes foreach uses IEnumerator.MoveNext(), which being
parameterless, in turn calls the Next() function, not the timed version
above "sub.Next(5000,out message); ".  There's nothing stopping us putting
in a simple if branch that accessess module level variables set by a
constructor for a slightly neater approach.

So what is the policy on updating the Mercurial repository?  If I get a
spare chance, and this is desirable, I'll alter Subscribe with an additional
constructor that has a timer argument.  Then those of us that care can
continue to use the foreach statement.
e.g. using(Subscription sub=new Subscription(ch,QueueNme,5000))  ...
foreach(BasicDeliverEventArgs ev in sub)

Does anyone like this change?  There's not a big difference between doing a
foreach and a while.  Just a tiny bit neater IMO.

cheers,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110312/f5d06129/attachment-0001.htm>

From gmr at myyearbook.com  Sat Mar 12 22:06:43 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sat, 12 Mar 2011 17:06:43 -0500
Subject: [rabbitmq-discuss] Pika Location Change
Message-ID: <1F99B42E1322483EA1E133DFADB02654@myyearbook.com>

Just as a heads up, while we're working on getting 0.9.5 released, Pika has moved! 

The main repo for Pika is now located at:

https://github.com/pika/pika

Regards,

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110312/15b15216/attachment.htm>

From alexis at rabbitmq.com  Sat Mar 12 22:07:04 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sat, 12 Mar 2011 22:07:04 +0000
Subject: [rabbitmq-discuss] Reddit news
In-Reply-To: <AANLkTim2MTCHwnGR0t+iiTM388NVZu4+VwS9VckzEX2Y@mail.gmail.com>
References: <AANLkTikM25E3k_zf53v-PT+B2N+aa=YzP_eT-t9na2+N@mail.gmail.com>
	<AANLkTikaU19=feRbbmUH7t7G28-a_=WKO-pvTshRgWm7@mail.gmail.com>
	<AANLkTim2MTCHwnGR0t+iiTM388NVZu4+VwS9VckzEX2Y@mail.gmail.com>
Message-ID: <AANLkTikvw3j9QGm478gAK-yzWzmq4d6XxOajRtECn029@mail.gmail.com>

Marcel

On Fri, Mar 11, 2011 at 7:30 PM, Marcel Meyer <marcel.meyer at gmail.com> wrote:
> Great!?Do you know whether this was documented as some anti-pattern? Is
> there more about the specific issues they faced?

I'm afraid I don't recall enough about it to say much that is of use :-(

I don't think there was any specific lesson worth documenting .. other
than that emailing this list is the best place to get help fast.

One thing we (always) want to get better at is getting people quick
answers to: "when should I use a queue / pubsub / etc".  If you have
any ideas, let us know.

alexis



> On Fri, Mar 11, 2011 at 12:13 PM, Alexis Richardson <alexis at rabbitmq.com>
> wrote:
>>
>> Hi Marcel
>>
>> Yes, I believe so. ? Matthew went to see them. ?As I recall the main
>> issues were actually not with Rabbit, but some of how they had used
>> messaging was worth discussing.
>>
>> alexis
>>
>>
>> On Fri, Mar 11, 2011 at 5:07 PM, Marcel Meyer <marcel.meyer at gmail.com>
>> wrote:
>> > Hi there Rabbit Community,
>> > I am researching queues and found this?thread about reddit's gripes
>> > (http://www.reddit.com/tb/c2spc) and noticed that RabbitMQ Support
>> > reached
>> > out to them.
>> > Were there issues resolved? They upgraded ERTS as a "stopgap" fix, but
>> > wanted to yank the technology all together. Did they?
>> > Regards,
>> > Marcel
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>

From gmr at myyearbook.com  Sat Mar 12 23:12:29 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sat, 12 Mar 2011 18:12:29 -0500
Subject: [rabbitmq-discuss] 2.0: The Future of Pika
Message-ID: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>

I've been listening to a lot of the conversations at PyCon about asynchronous development. The basic sentiment I've picked up on is that Callback Passing Style (CPS) is not currently in favor in the Python community. This in addition to the popular use of the BlockingConnection in Pika has lead me to think about how to plan Pika's future enhancements. After some conversation with Tony, I believe I have an outline that should appeal to Python developers while keeping Pika asynchronous at its core and retaining CPS. I think that CPS is very powerful and believe it's still very important to Pika's future.

After I release 0.9.5, I will start development on Pika 2.0 which will be an effort to create a more pythonic approach to using Pika while retaining the ability to use CSP and keeping it asynchronous at its core.

The roadmap for changes to Pika 2.0:

- Backwards incompatible change that drops Python 2.4, 2.5 support
- Adding Python 3 support
- Remove existing connection adapter system
- Implement new pattern for use, behavior based use focused on both Asynchronous callback passing style and "Pythonic" development.
- Both behaviors available from the same API calling same classes and methods
- Async:
- Merge existing connections into one connection system with IOLoop override
- Supporting internal IOLoop, tornado, twisted
- Pythonic:
- high-level blocking on synchronous AMQP commands
- Generator for receiving messages from Basic.Publish
- API notation closer to AMQP spec for implementation.
- *.*Ok frames will only be passed back in CPS use.
- Calling methods like queue.declare will return a success indicator and attributes returned in the Ok frame will be assigned to attributes of the class.
- basic.consume and basic.get will return a single object with a materialized view of the Method, Header and Body frames.
- Build in support for specific broker types and pure AMQP 0-9-1.


Here's an example of what I expect Pika 2.0 to look like for non-CSP use. Note this is more of an idea of how it will work for someone using Pika than a spec or actual code. 

from pika.rabbitmq import Connection
from pika import Basic
from pika import Channel
from pika import Exchange
from pika import Queue

from sys import exit

# All the attributes can be passed in via constructor or assigned
connection = Connection()
connection.host = 'localhost'
connection.port = 5762
connection.user = 'guest'
connection.pass = 'guest'
connection.vhost = '/'

# Not much new here
try:
connection.open()
except pika.ConnectException as e:
print "Could not connect: %s" % e
sys.exit(0)

# Channel construction outside of connection context, instead pass
# the Connection in
channel = Channel()
try:
channel.open(connection)
except pika.TimeoutException as e:
print "Could not open a channel: %s" % e
except pika.ConnectionClosedException as e:
print "Could not open a channel, the connection is closed" 

# All the attributes can be passed in via constructor or assigned
exchange = Exchange(channel)
exchange.name = 'test'
exchange.type = 'fanout'
exchange.durable = True
exchange.declare()

# All the attributes can be passed in via constructor or assigned
queue = Queue(channel)
queue.name = 'my_queue'
queue.auto_delete = False
queue.durable = True
queue.passive = False

# Declare the queue and expect a bool
if not queue.declare():
raise Exception("Could not declare my queue")

# Print info about the queue that was mapped automatically when
# Queue.DeclareOk was received 
print 'Queue "%s"' % queue.name
print ' Depth  : ' % queue.message_count
print ' Consumers : %i' % queue.consumer_count 

# Bind the queue
queue.bind(exchange=exchange, routing_key='test.my_queue')

# A generator returns one object for a message
for message in Basic.consume(my_channel, routing_key="test.my_queue"):
print 'Delivery Tag  : %s' % message.delivery_tag
print 'Channel : %i' % message.channel
print 'Body Size : %i' % len(message.body)
print 'Properties'
print ' Content-Type : %s' % message.properties.content_type
print ' Timestamp : %s' % message.properties.timestamp
print ' User Id : %s' % message.properties.user_id
print ' App Id  : %s' % message.properties.app_id
print 'Body  : %s' % message.body

I am looking for feedback on this direction. Do these changes and the example make sense to existing Pika and RabbitMQ uses? Would you change anything about this direction? What would you improve?

Regards,

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110312/9762e6be/attachment.htm>

From jasonjwwilliams at gmail.com  Sat Mar 12 23:51:11 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sat, 12 Mar 2011 16:51:11 -0700
Subject: [rabbitmq-discuss] 2.0: The Future of Pika
In-Reply-To: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>
References: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>
Message-ID: <AANLkTinyLkiZd6v14EAsXpRy4uPMKS75OqYkhZn9FWP7@mail.gmail.com>

I like the cleanness of the new style, and think the blocking adapter is the
core of what Pika brings to the party. Whether you're using Eventlet,
Tornado or Twisted, all of the async frameworks have their
own idiosyncrasies that it seems to me make it difficult to have one unified
adapter for async.

Also, the 0.9 series already broke backwards compatibility once. Doing it
again with 2.0 I think would make folks already dependent on it circumspect
about doing development with the 0.9 series. If the API is going to change
again I would recommend that the old API be turned into a wrapper around the
new approach, that way anyone developing with the 0.9 series has a clear
upgrade path without their projects breaking. It'll allow folks to develop
new projects on Pika today knowing they'll still work tomorrow, and that
they can ease into the new style as it's available.

Just my thoughts. :)

-J

On Sat, Mar 12, 2011 at 4:12 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

>  I've been listening to a lot of the conversations at PyCon about
> asynchronous development. The basic sentiment I've picked up on is that
> Callback Passing Style (CPS) is not currently in favor in the Python
> community.  This in addition to the popular use of the BlockingConnection in
> Pika has lead me to think about how to plan Pika's future enhancements.
> After some conversation with Tony, I believe I have an outline that should
> appeal to Python developers while keeping Pika asynchronous at its core and
> retaining CPS. I think that CPS is very powerful and believe it's still very
> important to Pika's future.
>
> After I release 0.9.5, I will start development on Pika 2.0 which will be
> an effort to create a more pythonic approach to using Pika while retaining
> the ability to use CSP and keeping it asynchronous at its core.
>
> The roadmap for changes to Pika 2.0:
>
> - Backwards incompatible change that drops Python 2.4, 2.5 support
> - Adding Python 3 support
> - Remove existing connection adapter system
> - Implement new pattern for use, behavior based use focused on
> both Asynchronous callback passing style and "Pythonic" development.
>   - Both behaviors available from the same API calling same classes and
> methods
>   - Async:
>     - Merge existing connections into one connection system with IOLoop
> override
>       - Supporting internal IOLoop, tornado, twisted
>   - Pythonic:
>     - high-level blocking on synchronous AMQP commands
>     - Generator for receiving messages from Basic.Publish
> - API notation closer to AMQP spec for implementation.
> - *.*Ok frames will only be passed back in CPS use.
>   - Calling methods like queue.declare will return a success indicator and
> attributes returned in the Ok frame will be assigned to attributes of the
> class.
> - basic.consume and basic.get will return a single object with a
> materialized view of the Method, Header and Body frames.
> - Build in support for specific broker types and pure AMQP 0-9-1.
>
> Here's an example of what I expect Pika 2.0 to look like for non-CSP use.
> Note this is more of an idea of how it will work for someone using Pika than
> a spec or actual code.
>
>     from pika.rabbitmq import Connection
>     from pika import Basic
>     from pika import Channel
>     from pika import Exchange
>     from pika import Queue
>
>     from sys import exit
>
>     # All the attributes can be passed in via constructor or assigned
>     connection = Connection()
>     connection.host = 'localhost'
>     connection.port = 5762
>     connection.user = 'guest'
>     connection.pass = 'guest'
>     connection.vhost = '/'
>
>     # Not much new here
>     try:
>         connection.open()
>     except pika.ConnectException as e:
>         print "Could not connect: %s" % e
>         sys.exit(0)
>
>     # Channel construction outside of connection context, instead pass
>     # the Connection in
>     channel = Channel()
>     try:
>         channel.open(connection)
>     except pika.TimeoutException as e:
>         print "Could not open a channel: %s" % e
>     except pika.ConnectionClosedException as e:
>         print "Could not open a channel, the connection is closed"
>
>     # All the attributes can be passed in via constructor or assigned
>     exchange = Exchange(channel)
>     exchange.name = 'test'
>     exchange.type = 'fanout'
>     exchange.durable = True
>     exchange.declare()
>
>     # All the attributes can be passed in via constructor or assigned
>     queue = Queue(channel)
>     queue.name = 'my_queue'
>     queue.auto_delete = False
>     queue.durable = True
>     queue.passive = False
>
>     # Declare the queue and expect a bool
>     if not queue.declare():
>         raise Exception("Could not declare my queue")
>
>     # Print info about the queue that was mapped automatically when
>     # Queue.DeclareOk was received
>     print 'Queue "%s"' % queue.name
>     print ' Depth     : ' % queue.message_count
>     print ' Consumers : %i' % queue.consumer_count
>
>     # Bind the queue
>     queue.bind(exchange=exchange, routing_key='test.my_queue')
>
>     # A generator returns one object for a message
>     for message in Basic.consume(my_channel, routing_key="test.my_queue"):
>         print 'Delivery Tag   : %s' % message.delivery_tag
>         print 'Channel        : %i' % message.channel
>         print 'Body Size      : %i' % len(message.body)
>         print 'Properties'
>         print '  Content-Type : %s' % message.properties.content_type
>         print '  Timestamp    : %s' % message.properties.timestamp
>         print '  User Id      : %s' % message.properties.user_id
>         print '  App Id       : %s' % message.properties.app_id
>         print 'Body           : %s' % message.body
>
> I am looking for feedback on this direction. Do these changes and the
> example make sense to existing Pika and RabbitMQ uses?  Would you change
> anything about this direction? What would you improve?
>
> Regards,
>
> Gavin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110312/d94da775/attachment-0001.htm>

From matthias at rabbitmq.com  Sun Mar 13 10:30:47 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 13 Mar 2011 10:30:47 +0000
Subject: [rabbitmq-discuss] 2.0: The Future of Pika
In-Reply-To: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>
References: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>
Message-ID: <4D7C9CD7.4090803@rabbitmq.com>

Gavin M. Roy wrote:
>   - Calling methods like queue.declare will return a success indicator 
> and attributes returned in the Ok frame will be assigned to attributes 
> of the class.

What do instances of classes represent? Looks like they'd have to 
contain a mixture of attributes with completely different purposes. In 
particular there is a conflation of attributes for AMQP entities and 
AMQP commands.

For example, 'passive' is not an attribute of an AMQP queue; it's a flag 
on the queue.declare command. And 'message_count' is only something you 
get as a return of queue.declare, so accessing that attribute in any 
other context is meaningless.


Matthias.

From rishdev at gmail.com  Sun Mar 13 11:46:07 2011
From: rishdev at gmail.com (RishiDev)
Date: Sun, 13 Mar 2011 04:46:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer - threw an exception for channel
	AMQChannel
In-Reply-To: <4D7A4E1B.6070202@rabbitmq.com>
References: <dce543bd-800f-4a2a-af20-9801ce1826d9@t19g2000prd.googlegroups.com>
	<4D7A4E1B.6070202@rabbitmq.com>
Message-ID: <bc7b221e-1896-4b47-917b-a062cfd207bb@r4g2000prm.googlegroups.com>

I am running this test program from within eclipse. My eclipse.ini
file has below properties.
-startup
plugins/org.eclipse.equinox.launcher_1.1.0.v20100507.jar
--launcher.library
plugins/org.eclipse.equinox.launcher.win32.win32.x86_1.1.0.v20100503
-product
org.eclipse.epp.package.java.product
--launcher.defaultAction
openFile
--launcher.XXMaxPermSize
256M
-showsplash
org.eclipse.platform
--launcher.XXMaxPermSize
256m
--launcher.defaultAction
openFile
-vm
C:/programs/java/jdk1.6.0_012/bin
-vmargs
-Dosgi.requiredJavaVersion=1.5
-Xms512m
-Xmx1024m

I believe problem is coming because in while loop I am converting the
byte[] into string using new String(byte[]).
Below line of code is the cause:
msgContent=new String(delivery.getBody());

GC does tries to free up memory, still I think it doesn't take care of
string objects sitting in heap as soon as they are not needed. While
loop is running @ full throttle.
Here is memory (Runtime.getRuntime().freeMemory()) pattern on receipt
of each msg:
Intial Memory 4831168
0 : Memory = 4300664
1 : Memory = 12289864
2 : Memory = 12289912
3 : Memory = 15001624
4 : Memory = 12289528
5 : Memory = 14513344
6 : Memory = 14513120
7 : Memory = 13986864
8 : Memory = 14382256
9 : Memory = 13986760
10 : Memory = 16178360
11 : Memory = 16178336
12 : Memory = 16440544
13 : Memory = 16309256
14 : Memory = 16569344
15 : Memory = 17710224
16 : Memory = 16571624
17 : Memory = 13634552
18 : Memory = 13958824
19 : Memory = 16146296
20 : Memory = 17551288
21 : Memory = 14966368
22 : Memory = 17026856
23 : Memory = 14966496
24 : Memory = 15320384
25 : Memory = 16183312
26 : Memory = 16359344
27 : Memory = 20692472
28 : Memory = 23010888
29 : Memory = 21177504
30 : Memory = 21222064
31 : Memory = 22916800
32 : Memory = 22916624
33 : Memory = 25201640
34 : Memory = 28177344
35 : Memory = 29973712
36 : Memory = 28923024
37 : Memory = 26630152
38 : Memory = 26850696
39 : Memory = 29737008
40 : Memory = 30523536
41 : Memory = 27552984
42 : Memory = 31575736
43 : Memory = 29255120
44 : Memory = 29977904
45 : Memory = 28688760
46 : Memory = 30220600
47 : Memory = 32055928
48 : Memory = 31662688
49 : Memory = 27281776
50 : Memory = 32715880
51 : Memory = 31796376
52 : Memory = 29213632
53 : Memory = 26370440
54 : Memory = 26370112
55 : Memory = 31009408
56 : Memory = 31929120
57 : Memory = 28557568
58 : Memory = 29215280
59 : Memory = 29215360
60 : Memory = 31402672
61 : Memory = 23395400
62 : Memory = 26461160
63 : Memory = 29963944
64 : Memory = 30881736
65 : Memory = 26107536
66 : Memory = 28036680
67 : Memory = 27117232
68 : Memory = 26371872
69 : Memory = 26371648
70 : Memory = 27903384
71 : Memory = 30095208
72 : Memory = 26369784
73 : Memory = 23526928
74 : Memory = 25320624
75 : Memory = 25583208
76 : Memory = 24274456
77 : Memory = 19631280
78 : Memory = 24536536
79 : Memory = 26986152
80 : Memory = 26594952
81 : Memory = 20682104
82 : Memory = 17836880
83 : Memory = 20682152
84 : Memory = 20682176
85 : Memory = 17836736
86 : Memory = 17836680
87 : Memory = 18060384
88 : Memory = 17706216
89 : Memory = 14336712
90 : Memory = 14467672
91 : Memory = 9302712
92 : Memory = 6459032
93 : Memory = 8777240
94 : Memory = 5633480
95 : Memory = 8517688
96 : Memory = 7337728
97 : Memory = 7337984

Please advice.

Thanks,
Rishi

On Mar 11, 9:30?pm, Rob Harrop <r... at rabbitmq.com> wrote:
> What heap size do you have configured for your JVM? It's is entirely
> possible that if you're using the default sizes that 16 3MB msgs will
> cause you to start hitting the OOM exception.
>
> Regards,
>
> Rob
>
> On 11/03/11 16:02, RishiDev wrote:
>
> > Hi,
>
> > I have about 10K large msgs (each ~3 MB) in a queue. Started running a
> > java consumer client on the queue and after receiving 16 msgs I got
> > following exception. Please help resolve/understand the issue.
>
> > Consumer com.rabbitmq.client.QueueingConsumer at 15b9e68 (amq.ctag-bEjkq
> > +5EqqmXsp1idK9rrg==) method handleDelivery for channel
> > AMQChannel(amqp://guest at localhost:5672/,1) threw an exception for
> > channel AMQChannel(amqp://guest at localhost:5672/,1):
> > java.lang.OutOfMemoryError
> > com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
> > reason: Attempt to use closed channel
> > ? ?at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:
> > 195)
> > ? ?at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:290)
> > ? ?at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:284)
> > ? ?at com.rabbitmq.client.impl.ChannelN.basicAck(ChannelN.java:669)
> > ? ?at
> > com.octanner.jmspoc.rabbitmq.RabbitMQConsumer.receiveMsgs(RabbitMQConsumer.java:
> > 69)
> > ? ?at
> > com.octanner.jmspoc.rabbitmq.RabbitMQConsumer.main(RabbitMQConsumer.java:
> > 77)
> > Exception in thread "main"
>
> > Thanks,
> > Rishi
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rishdev at gmail.com  Sun Mar 13 11:50:19 2011
From: rishdev at gmail.com (RishiDev)
Date: Sun, 13 Mar 2011 04:50:19 -0700 (PDT)
Subject: [rabbitmq-discuss] queue supervisor and recovery takes 10 mins
Message-ID: <2d549663-45ca-4301-903f-35f4dd8d4e7c@f31g2000pri.googlegroups.com>

Hi,

In my local rabbitmq installation "starting queue supervisor and queue
recovery" takes about 10+ mins while starting the server. Most likely
it is because I have about 9000+ msgs (each ~3MB) sitting in one of
the queues.
Is there a way we can make it faster? Suppose in production
environment for some reasons messaging system needs a restart then
waiting for so long for messaging servers to come online can be quite
painful.

Thanks,
Rishi

From matthias at rabbitmq.com  Sun Mar 13 12:11:32 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 13 Mar 2011 12:11:32 +0000
Subject: [rabbitmq-discuss] queue supervisor and recovery takes 10 mins
In-Reply-To: <2d549663-45ca-4301-903f-35f4dd8d4e7c@f31g2000pri.googlegroups.com>
References: <2d549663-45ca-4301-903f-35f4dd8d4e7c@f31g2000pri.googlegroups.com>
Message-ID: <4D7CB474.3010802@rabbitmq.com>

Rishi,

RishiDev wrote:
> In my local rabbitmq installation "starting queue supervisor and queue
> recovery" takes about 10+ mins while starting the server. Most likely
> it is because I have about 9000+ msgs (each ~3MB) sitting in one of
> the queues.

How are you shutting down rabbit? If when starting rabbit a message like

=WARNING REPORT==== 13-Mar-2011::12:08:18 ===
msg_store_persistent: rebuilding indices from scratch

appears in the rabbit.log file then rabbit wasn't shut down cleanly and 
start up will take a while to recover the messages.

If, by contrast, rabbit was shut down cleanly, e.g. with 'rabbitmqctl 
stop', then the subsequent start up should be near instantaneous.


Matthias.

From gmr at myyearbook.com  Sun Mar 13 16:25:58 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sun, 13 Mar 2011 12:25:58 -0400
Subject: [rabbitmq-discuss] 2.0: The Future of Pika
In-Reply-To: <4D7C9CD7.4090803@rabbitmq.com>
References: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>
	<4D7C9CD7.4090803@rabbitmq.com>
Message-ID: <AANLkTi=hTA559G5uDoHRF=TaP8G68h51pU-exjbWcNnb@mail.gmail.com>

Thanks for the feedback, this is the type of conversation I need to have as
I'm fleshing things out.

On Sun, Mar 13, 2011 at 6:30 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

>
> What do instances of classes represent? Looks like they'd have to contain a
> mixture of attributes with completely different purposes.


Quite possibly, again the goal being simplification and making it more
pythonic. If you have a Queue (within Rabbit and in a general sense),
message-count and consumer-count are of course transient, but they are still
an attribute of a queue.

The problem with this notion is the transient nature of the values. They
are potentially invalid as soon as they are returned. Perhaps, while keeping
a more pythonic idiom in mind, it might be better for synchronous command
response syntax to be like:

     message_count, consumer_count = queue.declare(channel)


> In particular there is a conflation of attributes for AMQP entities and
> AMQP commands.
>

That was the initial thought, where it adds value. Where it confuses, it
should not be done.

For example, 'passive' is not an attribute of an AMQP queue; it's a flag on
> the queue.declare command.


Right, in this case, it's probably better to pass that as an argument in the
method call.


> And 'message_count' is only something you get as a return of queue.declare,
> so accessing that attribute in any other context is meaningless.
>

Per my point on this above, I absolutely agree here. I'm trying to walk a
line of simplification while staying true to the protocol. I there there is
a win in simplification, for example, in the aggregation of content from the
multiple frames of Basic.Deliver and Basic.GetOk. I don't think a developer
will be shorted in having one object containing all of the values of the
three frames.

The major change for the driver, from my perspective, is the removal of
auto-generated driver mixin rpc command methods to having a object model
closer to what is seen in spec.py, with the AMQP methods accessed through
their class directly.  Think Basic.ack(channel, delivery_tag) instead of
channel.basic_ack(delivery_tag).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110313/d9dca00c/attachment.htm>

From matthias at rabbitmq.com  Sun Mar 13 17:20:52 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 13 Mar 2011 17:20:52 +0000
Subject: [rabbitmq-discuss] 2.0: The Future of Pika
In-Reply-To: <AANLkTi=hTA559G5uDoHRF=TaP8G68h51pU-exjbWcNnb@mail.gmail.com>
References: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>
	<4D7C9CD7.4090803@rabbitmq.com>
	<AANLkTi=hTA559G5uDoHRF=TaP8G68h51pU-exjbWcNnb@mail.gmail.com>
Message-ID: <4D7CFCF4.2060001@rabbitmq.com>

Gavin,

Gavin M. Roy wrote:
> The major change for the driver, from my perspective, is the removal of 
> auto-generated driver mixin rpc command methods to having a object model 
> closer to what is seen in spec.py, with the AMQP methods accessed 
> through their class directly.  Think Basic.ack(channel, delivery_tag) 
> instead of channel.basic_ack(delivery_tag).

It's a common misconception about AMQP that the spec's class/method 
terminology implies some sort of sensible mapping to the corresponding 
OO terms. It does not.

What state is associated with instances of the Basic class?

Or with instances of the Queue class?

When I have an instance of Queue in your proposed API, what does it 
represent?

1) All queues of any name, in any vhost, in any broker
2) All queues of any name, in any vhost, in a particular broker
3) All queues of any name, in a particular vhost & broker
4) A queue of a specific name, in any vhost, in any broker
5) A queue of a specific name, in any vhost, in a particular broker
6) A queue of a specific name, in a particular vhost & broker
?

To me only (1) makes sense, which leaves instances stateless, so all you 
are really doing is grouping a whole bunch of "static" methods under 
different headings ("queue", "exchange", etc).

(6) would make some sense too. The Queue constructor would take the 
channel and queue name.


Regards,

Matthias.

From br at versly.com  Sun Mar 13 22:07:43 2011
From: br at versly.com (Benjamin Renaud)
Date: Sun, 13 Mar 2011 15:07:43 -0700
Subject: [rabbitmq-discuss] Client connect/disconnect events on the server
	side
Message-ID: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>

Our REST server would like to be notified when clients connect and
disconnect. Is there a facility (standard event?) in RabbitMQ for
this?

Thanks!
Benjamin

-- 
ben renaud
versly.com
br at versly.com

From br at versly.com  Sun Mar 13 22:11:26 2011
From: br at versly.com (Benjamin Renaud)
Date: Sun, 13 Mar 2011 15:11:26 -0700
Subject: [rabbitmq-discuss] RabbitMQ client running behind a firewall
Message-ID: <AANLkTimHAh9HqxCFQBPDrnKfZJdaMN6jpe-THZs2qoRr@mail.gmail.com>

Hi Everyone,

Our RabbitMQ server runs in the cloud, and our customers' client will
often be running behind a firewall. Requiring them to open up 5672 is
not going to be a great option. Is there an HTTP tunneling facility we
can use, or some kind of a relay server?

Thanks,
Benjamin

-- 
ben renaud
versly.com
br at versly.com

From james.anderson at setf.de  Mon Mar 14 08:34:47 2011
From: james.anderson at setf.de (james anderson)
Date: Mon, 14 Mar 2011 09:34:47 +0100
Subject: [rabbitmq-discuss] 2.0: The Future of Pika
In-Reply-To: <4D7CFCF4.2060001@rabbitmq.com>
References: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>
	<4D7C9CD7.4090803@rabbitmq.com>
	<AANLkTi=hTA559G5uDoHRF=TaP8G68h51pU-exjbWcNnb@mail.gmail.com>
	<4D7CFCF4.2060001@rabbitmq.com>
Message-ID: <CE9A6AD4-DE0A-4D04-B36D-60A73DFB0310@setf.de>


On 2011-03-13, at 18:20 , Matthias Radestock wrote:

> Gavin,
>
> Gavin M. Roy wrote:
>> The major change for the driver, from my perspective, is the  
>> removal of auto-generated driver mixin rpc command methods to  
>> having a object model closer to what is seen in spec.py, with the  
>> AMQP methods accessed through their class directly.  Think  
>> Basic.ack(channel, delivery_tag) instead of channel.basic_ack 
>> (delivery_tag).
>
> It's a common misconception about AMQP that the spec's class/method  
> terminology implies some sort of sensible mapping to the  
> corresponding OO terms. It does not.
>
> What state is associated with instances of the Basic class?
>
> Or with instances of the Queue class?
>
> When I have an instance of Queue in your proposed API, what does it  
> represent?
>
> 1) All queues of any name, in any vhost, in any broker
> 2) All queues of any name, in any vhost, in a particular broker
> 3) All queues of any name, in a particular vhost & broker
> 4) A queue of a specific name, in any vhost, in any broker
> 5) A queue of a specific name, in any vhost, in a particular broker
> 6) A queue of a specific name, in a particular vhost & broker?
> ?

any one of those.
it depends on which of its attributes have been constrained by  
assigned values.
(1) is the class' interface (as you note below). most likely an  
instance would correspond to (3) or (6), but the particulars would  
depend on the application's control patterns.

>
> To me only (1) makes sense, which leaves instances stateless, so  
> all you are really doing is grouping a whole bunch of "static"  
> methods under different headings ("queue", "exchange", etc).
>
> (6) would make some sense too. The Queue constructor would take the  
> channel and queue name.


From majek04 at gmail.com  Mon Mar 14 10:27:12 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 14 Mar 2011 10:27:12 +0000
Subject: [rabbitmq-discuss] 2.0: The Future of Pika
In-Reply-To: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>
References: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>
Message-ID: <AANLkTimLtQvb2nMoq7zW=+VLUFYVRGF2HTh--rW_KX+0@mail.gmail.com>

On Sat, Mar 12, 2011 at 23:12, Gavin M. Roy <gmr at myyearbook.com> wrote:
[...]
> The basic sentiment I've picked up on is that
> Callback Passing Style (CPS) is not currently in favor in the Python
> community.

It never has been. That's why Twisted is still perceived as a separate
library (as opposed to, for example EventMachine for ruby, which
often is treated as a core part of the ruby framework).

> The roadmap for changes to Pika 2.0:
[...]
> - Remove existing connection adapter system
> - Implement new pattern for use, behavior based use focused on
> both?Asynchronous callback passing style and "Pythonic" development.
> ??- Both behaviors available from the same API calling same classes and
> methods
> ??- Async:
> ?? ?- Merge existing connections into one connection system with IOLoop
> override
> ?? ? ?- Supporting internal IOLoop, tornado, twisted
> ??- Pythonic:
> ?? ?- high-level blocking on synchronous AMQP commands
> ?? ?- Generator for receiving messages from Basic.Publish

That's a quite interesting approach. But non-trivial python
generators are hard to compose. Beware.

> - API notation closer to AMQP spec for implementation.

Sounds good.

> - *.*Ok frames will only be passed back in CPS use.

That means using 'no-wait' whenever possible.
But what if the thing will crash a channel
(trigger an amqp channel-error). How would you notify
a user that the channel can't be used any more?

For example: queue.unbind() with bad parameters may
trigger a channel-wide NotFound error.

[...]
> I am looking for feedback on this direction. Do these changes and the
> example make sense to existing Pika and RabbitMQ uses? ?Would you change
> anything about this direction? What would you improve?

You may find this inspiring:
https://github.com/ask/kombu/blob/master/examples/complete_receive.py#L39
https://github.com/majek/puka/blob/master/examples/stress_amqp.py#L60-62

Cheers,
 Marek

From steve at rabbitmq.com  Mon Mar 14 11:08:23 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 14 Mar 2011 11:08:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <AANLkTiny4ALZV-R832fXF3MvU=XDmqY0QBcj4sJEO180@mail.gmail.com>
References: <4D51392F.8000508@telecom-sudparis.eu>
	<4D5513B9.1010202@rabbitmq.com> <4D551A5E.2050804@rabbitmq.com>
	<AANLkTiny4ALZV-R832fXF3MvU=XDmqY0QBcj4sJEO180@mail.gmail.com>
Message-ID: <DEB8EA3F-D6D1-40AC-9222-FBB510B1B971@rabbitmq.com>

Dear MJ,

[Due to a glitch in the mail here my reply may not have reached you, and I certainly didn't put it on the m/l.  Here is a better answer:]

The patch file Simon put up is a simple diff file which modifies the src/com/rabbitmq/client/impl/AMQConnection.java file in the source code of the java-client plug-in.

The way to use it is to get the rabbitmq-java-client source, apply the patch to the java file (patch, or hg patch or however you want) and then re-build the java-client.

If you have not done so, I recommend looking at the plug-in development page, section Getting Started[1], on the rabbit  website www.rabbitmq.com, which guides you through the checkout of the plug-in development umbrella repository, in which the java-client plug-in can be re-built.

Hope this helps,

Steve Powell
[1] http://www.rabbitmq.com/plugin-development.html#getting-started

On 10 Mar 2011, at 02:52, Muesli John wrote:

> Hi,
> 
> How exactly is this patch to be used? How do I run it?
> 
> Thanks.
> 
> MJ.
> 
> On Fri, Feb 11, 2011 at 6:15 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> . . . <elided> . . .
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110314/ef1e4012/attachment.htm>

From steve at rabbitmq.com  Mon Mar 14 11:36:31 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 14 Mar 2011 11:36:31 +0000
Subject: [rabbitmq-discuss] RabbitMQ Java Client 2.3.1 on Android
In-Reply-To: <DEB8EA3F-D6D1-40AC-9222-FBB510B1B971@rabbitmq.com>
References: <4D51392F.8000508@telecom-sudparis.eu>
	<4D5513B9.1010202@rabbitmq.com> <4D551A5E.2050804@rabbitmq.com>
	<AANLkTiny4ALZV-R832fXF3MvU=XDmqY0QBcj4sJEO180@mail.gmail.com>
	<DEB8EA3F-D6D1-40AC-9222-FBB510B1B971@rabbitmq.com>
Message-ID: <CEED0F1C-BFBC-4C5D-BD80-1A8C3BC508D8@rabbitmq.com>

Whoops -- Matthias pointed out the java-client repository isn't in public-umbrella (Java client isn't a plug-in), so my 'helpful' instructions are bogus.

Better, go and look at this http://www.rabbitmq.com/build-java-client.html to see how to build the java-client.

In those instructions, the 'ant dist' build step will produce a jar in the build/lib directory called rabbitmq-client.jar.

[If you clone the java-client repository in the public-umbrella, you will find that the codegen repository is gotten for you, so that is why I misled myself (and you) -- sorry.]

On 14 Mar 2011, at 11:08, Steve Powell wrote:

> Dear MJ,
> 
> [Due to a glitch in the mail here my reply may not have reached you, and I certainly didn't put it on the m/l.  Here is a better answer:]
> 
> The patch file Simon put up is a simple diff file which modifies the src/com/rabbitmq/client/impl/AMQConnection.java file in the source code of the java-client plug-in.
> 
> The way to use it is to get the rabbitmq-java-client source, apply the patch to the java file (patch, or hg patch or however you want) and then re-build the java-client.
> 
> If you have not done so, I recommend looking at the plug-in development page, section Getting Started[1], on the rabbit  website www.rabbitmq.com, which guides you through the checkout of the plug-in development umbrella repository, in which the java-client plug-in can be re-built.
> 
> Hope this helps,
> 
> Steve Powell
> [1] http://www.rabbitmq.com/plugin-development.html#getting-started
> 
> On 10 Mar 2011, at 02:52, Muesli John wrote:
>> . . .<elided>. . .
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110314/c485d95f/attachment.htm>

From stastny at 101ideas.cz  Mon Mar 14 11:43:10 2011
From: stastny at 101ideas.cz (=?UTF-8?B?SmFrdWIgxaDFpWFzdG7DvQ==?=)
Date: Mon, 14 Mar 2011 11:43:10 +0000
Subject: [rabbitmq-discuss] 2.0: The Future of Pika
In-Reply-To: <AANLkTimLtQvb2nMoq7zW=+VLUFYVRGF2HTh--rW_KX+0@mail.gmail.com>
References: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>
	<AANLkTimLtQvb2nMoq7zW=+VLUFYVRGF2HTh--rW_KX+0@mail.gmail.com>
Message-ID: <AANLkTika5QsVvOaEOvJvX6A=eFrTOE5Hk9PSSZi_MsEa@mail.gmail.com>

Just a technical note about Ruby and EventMachine, I would not say
it's treated as a core part of the ruby framework. There are some libraries
(not many though) which are EventMachine-only, like current AMQP gem, but
it's just because it's hard to write library which can run asynchronously
with EventMachine a well as synchronously without it. So it's probably the
same as in Python with Twisted, I guess.

Jakub

http://www.flickr.com/photos/jakub-stastny
http://twitter.com/botanicus



On 14 March 2011 10:27, Marek Majkowski <majek04 at gmail.com> wrote:

> On Sat, Mar 12, 2011 at 23:12, Gavin M. Roy <gmr at myyearbook.com> wrote:
> [...]
> > The basic sentiment I've picked up on is that
> > Callback Passing Style (CPS) is not currently in favor in the Python
> > community.
>
> It never has been. That's why Twisted is still perceived as a separate
> library (as opposed to, for example EventMachine for ruby, which
> often is treated as a core part of the ruby framework).
>
> > The roadmap for changes to Pika 2.0:
> [...]
> > - Remove existing connection adapter system
> > - Implement new pattern for use, behavior based use focused on
> > both Asynchronous callback passing style and "Pythonic" development.
> >   - Both behaviors available from the same API calling same classes and
> > methods
> >   - Async:
> >     - Merge existing connections into one connection system with IOLoop
> > override
> >       - Supporting internal IOLoop, tornado, twisted
> >   - Pythonic:
> >     - high-level blocking on synchronous AMQP commands
> >     - Generator for receiving messages from Basic.Publish
>
> That's a quite interesting approach. But non-trivial python
> generators are hard to compose. Beware.
>
> > - API notation closer to AMQP spec for implementation.
>
> Sounds good.
>
> > - *.*Ok frames will only be passed back in CPS use.
>
> That means using 'no-wait' whenever possible.
> But what if the thing will crash a channel
> (trigger an amqp channel-error). How would you notify
> a user that the channel can't be used any more?
>
> For example: queue.unbind() with bad parameters may
> trigger a channel-wide NotFound error.
>
> [...]
> > I am looking for feedback on this direction. Do these changes and the
> > example make sense to existing Pika and RabbitMQ uses?  Would you change
> > anything about this direction? What would you improve?
>
> You may find this inspiring:
> https://github.com/ask/kombu/blob/master/examples/complete_receive.py#L39
> https://github.com/majek/puka/blob/master/examples/stress_amqp.py#L60-62
>
> Cheers,
>  Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110314/87d33bca/attachment.htm>

From Denis.Conan at telecom-sudparis.eu  Mon Mar 14 14:09:12 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Mon, 14 Mar 2011 15:09:12 +0100
Subject: [rabbitmq-discuss] Pika and multi-threading
In-Reply-To: <AANLkTikMTVgv2DWfUxD8G6n9Sgd_zx51w5W22biHRsQq@mail.gmail.com>
References: <4D63D3EB.1030400@telecom-sudparis.eu>
	<AANLkTikMTVgv2DWfUxD8G6n9Sgd_zx51w5W22biHRsQq@mail.gmail.com>
Message-ID: <4D7E2188.3040101@telecom-sudparis.eu>

Le 22/02/2011 17:02, Gavin M. Roy a ?crit :
> 2011/2/22 Denis Conan<Denis.Conan at telecom-sudparis.eu>:
>>
>> Hi all,
>>
>> The Pika Web site says: "Pika does not have any notion of threading in the
>> code. If you want to use Pika with threading, make sure you have a Pika
>> connection per thread, created in that thread. It is not safe to share one
>> Pika connection across threads."
>>
>> When using the continuation-passing style mode with SelectConnection, what
>> about the singleton object IOLoop? I created a connection on the main thread
>> for a vhost, and then a second connection for a different vhost in a new
>> thread, but callbacks of the main threads for the first vhost are called. Am
>> I missing something?
>
> You're not, this is something I'm working through now. In essence,
> there is a logical separation in the pika code between the core of how
> pika does what it does and the connection adapters. The singleton
> model for ioloops was a later addition that broke the model with
> regard to threads. I have been working on fixing this to be thread
> safe and will have something out soon on it.
>

Hi all,

has this issue been solved?

CU

Denis

From gmr at myyearbook.com  Mon Mar 14 14:18:29 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 14 Mar 2011 10:18:29 -0400
Subject: [rabbitmq-discuss] Pika and multi-threading
In-Reply-To: <4D7E2188.3040101@telecom-sudparis.eu>
References: <4D63D3EB.1030400@telecom-sudparis.eu>
	<AANLkTikMTVgv2DWfUxD8G6n9Sgd_zx51w5W22biHRsQq@mail.gmail.com>
	<4D7E2188.3040101@telecom-sudparis.eu>
Message-ID: <27E1DE12-2DC9-4AA9-AB53-02863D971F2F@myyearbook.com>


On Mar 14, 2011, at 10:09 AM, Denis Conan <Denis.Conan at telecom-sudparis.eu> wrote:

> Le 22/02/2011 17:02, Gavin M. Roy a ?crit :
>> 2011/2/22 Denis Conan<Denis.Conan at telecom-sudparis.eu>:
>>> 
>>> Hi all,
>>> 
>>> The Pika Web site says: "Pika does not have any notion of threading in the
>>> code. If you want to use Pika with threading, make sure you have a Pika
>>> connection per thread, created in that thread. It is not safe to share one
>>> Pika connection across threads."
>>> 
>>> When using the continuation-passing style mode with SelectConnection, what
>>> about the singleton object IOLoop? I created a connection on the main thread
>>> for a vhost, and then a second connection for a different vhost in a new
>>> thread, but callbacks of the main threads for the first vhost are called. Am
>>> I missing something?
>> 
>> You're not, this is something I'm working through now. In essence,
>> there is a logical separation in the pika code between the core of how
>> pika does what it does and the connection adapters. The singleton
>> model for ioloops was a later addition that broke the model with
>> regard to threads. I have been working on fixing this to be thread
>> safe and will have something out soon on it.
>> 
> 
> Hi all,
> 
> has this issue been solved?

Yes it is addressed in the soon to be released 0.9.5 which is waiting on documentation updates and full regression testing on Rabbit 2.0 and higher. I am planning on tagging and pushing this release to pypi this week.
> 

Gavin

From andi.constantin at mediasat.ro  Mon Mar 14 14:43:38 2011
From: andi.constantin at mediasat.ro (Andi Constantin)
Date: Mon, 14 Mar 2011 16:43:38 +0200
Subject: [rabbitmq-discuss] diacritics in bindings
Message-ID: <4D7E299A.80000@mediasat.ro>

Hello !

I used a diacritic character in a binding:
mo.route.1733.S,tefan.#


And rabbitmqadmin does not work any more:

root# rabbitmqadmin list bindings
Traceback (most recent call last):
   File "/bin/rabbitmqadmin", line 407, in <module>
     main()
   File "/bin/rabbitmqadmin", line 149, in main
     method()
   File "/bin/rabbitmqadmin", line 213, in invoke_list
     format_list(self.get(uri), self.options)
   File "/bin/rabbitmqadmin", line 290, in format_list
     formatter_instance.display(json_list)
   File "/bin/rabbitmqadmin", line 299, in display
     int(self.options.depth))
   File "/bin/rabbitmqadmin", line 334, in list_to_table
     add('', 1, item, add_to_row)
   File "/bin/rabbitmqadmin", line 318, in add
     fun(column, item[key])
   File "/bin/rabbitmqadmin", line 324, in add_to_row
     row[column_ix[col]] = str(val)
UnicodeEncodeError: 'ascii' codec can't encode character u'\u015e' in 
position 14: ordinal not in range(128)

The rabbit works fine, i just cannot user rabbitmqadmin anymore.
Have any idea of how to fix this ?

Thanks,
Andi

root# rabbitmqctl status
Status of node iepureX at crimson ...
[{running_applications,
      [{rabbit_management,"RabbitMQ Management Console","2.1.1"},
       {webmachine,"webmachine","1.7.0"},
       {amqp_client,"RabbitMQ AMQP Client","2.1.1"},
       {rabbit,"RabbitMQ","2.1.1"},
       {os_mon,"CPO  CXC 138 46","2.2.4"},
       {sasl,"SASL  CXC 138 11","2.1.8"},
       {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.1.1"},
       {mochiweb,"MochiMedia Web Server","1.3"},
       {crypto,"CRYPTO version 1","1.6.3"},
       {inets,"INETS  CXC 138 49","5.2"},
       {mnesia,"MNESIA  CXC 138 12","4.4.12"},
       {stdlib,"ERTS  CXC 138 10","1.16.4"},
       {kernel,"ERTS  CXC 138 10","2.13.4"}]},
  {nodes,[{disc,[iepureX at crimson]}]},
  {running_nodes,[iepureX at crimson]}]
...done.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110314/55d16dce/attachment.htm>

From Denis.Conan at telecom-sudparis.eu  Mon Mar 14 14:49:55 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Mon, 14 Mar 2011 15:49:55 +0100
Subject: [rabbitmq-discuss] Pika and multi-threading
In-Reply-To: <27E1DE12-2DC9-4AA9-AB53-02863D971F2F@myyearbook.com>
References: <4D63D3EB.1030400@telecom-sudparis.eu>
	<AANLkTikMTVgv2DWfUxD8G6n9Sgd_zx51w5W22biHRsQq@mail.gmail.com>
	<4D7E2188.3040101@telecom-sudparis.eu>
	<27E1DE12-2DC9-4AA9-AB53-02863D971F2F@myyearbook.com>
Message-ID: <4D7E2B13.3080604@telecom-sudparis.eu>

Le 14/03/2011 15:18, Gavin M. Roy a ?crit :
>
> On Mar 14, 2011, at 10:09 AM, Denis Conan<Denis.Conan at telecom-sudparis.eu>  wrote:
>
>> Le 22/02/2011 17:02, Gavin M. Roy a ?crit :
>>> 2011/2/22 Denis Conan<Denis.Conan at telecom-sudparis.eu>:
>>>>
>>>> Hi all,
>>>>
>>>> The Pika Web site says: "Pika does not have any notion of threading in the
>>>> code. If you want to use Pika with threading, make sure you have a Pika
>>>> connection per thread, created in that thread. It is not safe to share one
>>>> Pika connection across threads."
>>>>
>>>> When using the continuation-passing style mode with SelectConnection, what
>>>> about the singleton object IOLoop? I created a connection on the main thread
>>>> for a vhost, and then a second connection for a different vhost in a new
>>>> thread, but callbacks of the main threads for the first vhost are called. Am
>>>> I missing something?
>>>
>>> You're not, this is something I'm working through now. In essence,
>>> there is a logical separation in the pika code between the core of how
>>> pika does what it does and the connection adapters. The singleton
>>> model for ioloops was a later addition that broke the model with
>>> regard to threads. I have been working on fixing this to be thread
>>> safe and will have something out soon on it.
>>>
>>
>> Hi all,
>>
>> has this issue been solved?
>
> Yes it is addressed in the soon to be released 0.9.5 which is waiting on documentation updates and full regression testing on Rabbit 2.0 and higher. I am planning on tagging and pushing this release to pypi this week.

That's ok
thank you very much in advance

>>
>
> Gavin

denis

From majek04 at gmail.com  Mon Mar 14 15:01:32 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 14 Mar 2011 15:01:32 +0000
Subject: [rabbitmq-discuss] Reddit news
In-Reply-To: <AANLkTim2MTCHwnGR0t+iiTM388NVZu4+VwS9VckzEX2Y@mail.gmail.com>
References: <AANLkTikM25E3k_zf53v-PT+B2N+aa=YzP_eT-t9na2+N@mail.gmail.com>
	<AANLkTikaU19=feRbbmUH7t7G28-a_=WKO-pvTshRgWm7@mail.gmail.com>
	<AANLkTim2MTCHwnGR0t+iiTM388NVZu4+VwS9VckzEX2Y@mail.gmail.com>
Message-ID: <AANLkTi=c95-b0+Dtuc0W5cpTuZ8FzQoptzni9NmEa_vg@mail.gmail.com>


From vukasin at toroman.name  Mon Mar 14 15:28:17 2011
From: vukasin at toroman.name (Vukasin Toroman)
Date: Mon, 14 Mar 2011 16:28:17 +0100
Subject: [rabbitmq-discuss] Messages not showing up
Message-ID: <30D19C8C-E8A9-4FB1-A492-8E499BB12678@toroman.name>

Hi everyone,

we have been using rabbitmq for a while now to route documents through a processing workflow. each step is represented by one or more processes working on one queue. the messages are small (maybe a few k) but there are quite a few of them (multiple thousand per second). This has been working fine for a while but then we have noticed that the rates (each step of the processing workflow delivers stats) do not add up. namely we seem to be losing messages (around 200 messages/sec) and this is quite discerning. The reason is that these messages do not show up in the queue and are also not visible as being recieved and un-acked. we are using non-durable queues and a combination of java and python processing clients. 

oh yes, this only happens after the system has been running for a while and a traffic spike has occurred. the rabbitmq process also seems to be gaining memory. 

we are using 2.3.1-1 version of rabbitmq-server on ubuntu 10.4 (amd64)

thank you for you help,
vukasin



From gmr at myyearbook.com  Mon Mar 14 15:53:10 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 14 Mar 2011 11:53:10 -0400
Subject: [rabbitmq-discuss] Messages not showing up
In-Reply-To: <30D19C8C-E8A9-4FB1-A492-8E499BB12678@toroman.name>
References: <30D19C8C-E8A9-4FB1-A492-8E499BB12678@toroman.name>
Message-ID: <3B66EE1D58E842BE9DA5760110C24609@myyearbook.com>


On Monday, March 14, 2011 at 11:28 AM, Vukasin Toroman wrote: 
> Hi everyone,
> 
> we have been using rabbitmq for a while now to route documents through a processing workflow. each step is represented by one or more processes working on one queue. the messages are small (maybe a few k) but there are quite a few of them (multiple thousand per second). This has been working fine for a while but then we have noticed that the rates (each step of the processing workflow delivers stats) do not add up. namely we seem to be losing messages (around 200 messages/sec) and this is quite discerning. The reason is that these messages do not show up in the queue and are also not visible as being recieved and un-acked. we are using non-durable queues and a combination of java and python processing clients.
How are you quantifying the counts? Do you keep track on your own outside of RabbitMQ message counts on your consumers and publishers? 
> oh yes, this only happens after the system has been running for a while and a traffic spike has occurred. the rabbitmq process also seems to be gaining memory. 
> 

I have found that if I am over saturating a single node with regard to message throughput, I see a pattern where memory use increases without being able to reconcile where it is used. During spikes like this, I did see abnormal behavior with messages as well. 

In my case, I was seeing this behavior when throughput exceeded ~25k messages per second being published into a single node on a single exchange while consuming from multiple queues bound to the exchange connected to other nodes in the rabbitmq cluster. 

To address this, I changed the publishing strategy and added a few nodes to the cluster. I still use the same exchange and routing key structure, however I am now publishing into the exchange across multiple nodes instead of one. I have not seen any issues since this change and am now operating at 2x the previous message velocity across the cluster.

Hope this helps,

Gavin


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110314/1f89ff54/attachment.htm>

From gmr at myyearbook.com  Mon Mar 14 16:21:08 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 14 Mar 2011 12:21:08 -0400
Subject: [rabbitmq-discuss] 2.0: The Future of Pika
In-Reply-To: <4D7CFCF4.2060001@rabbitmq.com>
References: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>
	<4D7C9CD7.4090803@rabbitmq.com>
	<AANLkTi=hTA559G5uDoHRF=TaP8G68h51pU-exjbWcNnb@mail.gmail.com>
	<4D7CFCF4.2060001@rabbitmq.com>
Message-ID: <D427530C099C4C31B6F489A111720625@myyearbook.com>


On Sunday, March 13, 2011 at 1:20 PM, Matthias Radestock wrote:
> Gavin,
> 
> Gavin M. Roy wrote:
> > The major change for the driver, from my perspective, is the removal of 
> > auto-generated driver mixin rpc command methods to having a object model 
> > closer to what is seen in spec.py, with the AMQP methods accessed 
> > through their class directly. Think Basic.ack(channel, delivery_tag) 
> > instead of channel.basic_ack(delivery_tag).
> 
> It's a common misconception about AMQP that the spec's class/method 
> terminology implies some sort of sensible mapping to the corresponding 
> OO terms. It does not.
Right, I am familiar with the differences.
> What state is associated with instances of the Basic class?
> 
> 

In what I am proposing to change, there would be no state for Basic class. 
> Or with instances of the Queue class?
> 
> 6) A queue of a specific name, in a particular vhost & broker
More specifically a queue of a specific name on a specific channel.
> (6) would make some sense too. The Queue constructor would take the 
> channel and queue name.
*nod*

I want to reduce the work involved for the developer in areas where we can denote some level of state.

This is obviously a big change from the current client which is one of the reasons I raise the concept here.

Regards,

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110314/0fcf47e4/attachment.htm>

From steve at rabbitmq.com  Mon Mar 14 16:53:56 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 14 Mar 2011 16:53:56 +0000
Subject: [rabbitmq-discuss] Consumer - threw an exception for channel
	AMQChannel
In-Reply-To: <bc7b221e-1896-4b47-917b-a062cfd207bb@r4g2000prm.googlegroups.com>
References: <dce543bd-800f-4a2a-af20-9801ce1826d9@t19g2000prd.googlegroups.com>
	<4D7A4E1B.6070202@rabbitmq.com>
	<bc7b221e-1896-4b47-917b-a062cfd207bb@r4g2000prm.googlegroups.com>
Message-ID: <78D0945F-E0CF-4932-AC36-EC07023AB54E@rabbitmq.com>

Hi Rishi,

I think that new String(delivery.getBody()) will generate a String occupying about two times as much storage as the byte array, so 16 messages is about 96MB.

It is extremely unlikely that gc would fail to recover storage that was unreachable, so you cannot be losing the references to the new String() s.

It is possible that you have a reference to the String s kept around in your code, or else, the Eclipse execution environment is keeping these references for tracing/debugging purposes, which wouldn't happen in a product environment.

The details you give look OK for Eclipse, though what you say implies that the problem of OoM only happens when 'running at full throttle'.  Is that why you can give me memory patterns for beyond 16 messages?

I've run a few tests of my own in Eclipse, and as far as I can see strings are garbage collected (each takes about 6.3MB for a 3MB array), though my simple tests aren't using rabbit.

Maybe we could help if we saw more of your consumer loop.  What do you do with those String s?

Steve Powell
On 13 Mar 2011, at 11:46, RishiDev wrote:

> I am running this test program from within eclipse. My eclipse.ini
> file has below properties.
> -startup
> plugins/org.eclipse.equinox.launcher_1.1.0.v20100507.jar
> --launcher.library
> plugins/org.eclipse.equinox.launcher.win32.win32.x86_1.1.0.v20100503
> -product
> org.eclipse.epp.package.java.product
> --launcher.defaultAction
> openFile
> --launcher.XXMaxPermSize
> 256M
> -showsplash
> org.eclipse.platform
> --launcher.XXMaxPermSize
> 256m
> --launcher.defaultAction
> openFile
> -vm
> C:/programs/java/jdk1.6.0_012/bin
> -vmargs
> -Dosgi.requiredJavaVersion=1.5
> -Xms512m
> -Xmx1024m
> 
> I believe problem is coming because in while loop I am converting the
> byte[] into string using new String(byte[]).
> Below line of code is the cause:
> msgContent=new String(delivery.getBody());
> 
> GC does tries to free up memory, still I think it doesn't take care of
> string objects sitting in heap as soon as they are not needed. While
> loop is running @ full throttle.
> Here is memory (Runtime.getRuntime().freeMemory()) pattern on receipt
> of each msg:
> Intial Memory 4831168
> 0 : Memory = 4300664
> 1 : Memory = 12289864
> 2 : Memory = 12289912
> 3 : Memory = 15001624
> 4 : Memory = 12289528
> 5 : Memory = 14513344
> 6 : Memory = 14513120
> 7 : Memory = 13986864
> 8 : Memory = 14382256
> 9 : Memory = 13986760
> 10 : Memory = 16178360
> 11 : Memory = 16178336
> 12 : Memory = 16440544
> 13 : Memory = 16309256
> 14 : Memory = 16569344
> 15 : Memory = 17710224
> 16 : Memory = 16571624
> 17 : Memory = 13634552
> 18 : Memory = 13958824
> 19 : Memory = 16146296
> 20 : Memory = 17551288
> 21 : Memory = 14966368
> 22 : Memory = 17026856
> 23 : Memory = 14966496
> 24 : Memory = 15320384
> 25 : Memory = 16183312
> 26 : Memory = 16359344
> 27 : Memory = 20692472
> 28 : Memory = 23010888
> 29 : Memory = 21177504
> 30 : Memory = 21222064
> 31 : Memory = 22916800
> 32 : Memory = 22916624
> 33 : Memory = 25201640
> 34 : Memory = 28177344
> 35 : Memory = 29973712
> 36 : Memory = 28923024
> 37 : Memory = 26630152
> 38 : Memory = 26850696
> 39 : Memory = 29737008
> 40 : Memory = 30523536
> 41 : Memory = 27552984
> 42 : Memory = 31575736
> 43 : Memory = 29255120
> 44 : Memory = 29977904
> 45 : Memory = 28688760
> 46 : Memory = 30220600
> 47 : Memory = 32055928
> 48 : Memory = 31662688
> 49 : Memory = 27281776
> 50 : Memory = 32715880
> 51 : Memory = 31796376
> 52 : Memory = 29213632
> 53 : Memory = 26370440
> 54 : Memory = 26370112
> 55 : Memory = 31009408
> 56 : Memory = 31929120
> 57 : Memory = 28557568
> 58 : Memory = 29215280
> 59 : Memory = 29215360
> 60 : Memory = 31402672
> 61 : Memory = 23395400
> 62 : Memory = 26461160
> 63 : Memory = 29963944
> 64 : Memory = 30881736
> 65 : Memory = 26107536
> 66 : Memory = 28036680
> 67 : Memory = 27117232
> 68 : Memory = 26371872
> 69 : Memory = 26371648
> 70 : Memory = 27903384
> 71 : Memory = 30095208
> 72 : Memory = 26369784
> 73 : Memory = 23526928
> 74 : Memory = 25320624
> 75 : Memory = 25583208
> 76 : Memory = 24274456
> 77 : Memory = 19631280
> 78 : Memory = 24536536
> 79 : Memory = 26986152
> 80 : Memory = 26594952
> 81 : Memory = 20682104
> 82 : Memory = 17836880
> 83 : Memory = 20682152
> 84 : Memory = 20682176
> 85 : Memory = 17836736
> 86 : Memory = 17836680
> 87 : Memory = 18060384
> 88 : Memory = 17706216
> 89 : Memory = 14336712
> 90 : Memory = 14467672
> 91 : Memory = 9302712
> 92 : Memory = 6459032
> 93 : Memory = 8777240
> 94 : Memory = 5633480
> 95 : Memory = 8517688
> 96 : Memory = 7337728
> 97 : Memory = 7337984
> 
> Please advice.
> 
> Thanks,
> Rishi
> 
> On Mar 11, 9:30 pm, Rob Harrop <r... at rabbitmq.com> wrote:
>> What heap size do you have configured for your JVM? It's is entirely
>> possible that if you're using the default sizes that 16 3MB msgs will
>> cause you to start hitting the OOM exception.
>> 
>> Regards,
>> 
>> Rob
>> 
>> On 11/03/11 16:02, RishiDev wrote:
>> 
>>> Hi,
>> 
>>> I have about 10K large msgs (each ~3 MB) in a queue. Started running a
>>> java consumer client on the queue and after receiving 16 msgs I got
>>> following exception. Please help resolve/understand the issue.
>> 
>>> Consumer com.rabbitmq.client.QueueingConsumer at 15b9e68 (amq.ctag-bEjkq
>>> +5EqqmXsp1idK9rrg==) method handleDelivery for channel
>>> AMQChannel(amqp://guest at localhost:5672/,1) threw an exception for
>>> channel AMQChannel(amqp://guest at localhost:5672/,1):
>>> java.lang.OutOfMemoryError
>>> com.rabbitmq.client.AlreadyClosedException: clean connection shutdown;
>>> reason: Attempt to use closed channel
>>>    at com.rabbitmq.client.impl.AMQChannel.ensureIsOpen(AMQChannel.java:
>>> 195)
>>>    at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:290)
>>>    at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:284)
>>>    at com.rabbitmq.client.impl.ChannelN.basicAck(ChannelN.java:669)
>>>    at
>>> com.octanner.jmspoc.rabbitmq.RabbitMQConsumer.receiveMsgs(RabbitMQConsumer.java:
>>> 69)
>>>    at
>>> com.octanner.jmspoc.rabbitmq.RabbitMQConsumer.main(RabbitMQConsumer.java:
>>> 77)
>>> Exception in thread "main"
>> 
>>> Thanks,
>>> Rishi
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From michael.s.klishin at gmail.com  Mon Mar 14 16:57:22 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 14 Mar 2011 19:57:22 +0300
Subject: [rabbitmq-discuss] 2.0: The Future of Pika
In-Reply-To: <D427530C099C4C31B6F489A111720625@myyearbook.com>
References: <DC9D9D6B80D64C7E8500F37F480AA7AF@myyearbook.com>
	<4D7C9CD7.4090803@rabbitmq.com>
	<AANLkTi=hTA559G5uDoHRF=TaP8G68h51pU-exjbWcNnb@mail.gmail.com>
	<4D7CFCF4.2060001@rabbitmq.com>
	<D427530C099C4C31B6F489A111720625@myyearbook.com>
Message-ID: <AANLkTim1z3B1uiKsXA=ztX+97ZGrAbfxN7+oPVM1hREB@mail.gmail.com>

This is how queue instances work in Ruby's amqp gem and after 2+ years I can
tell it works pretty well (causes no confusion
to developers). Just my 2?.

2011/3/14 Gavin M. Roy <gmr at myyearbook.com>

> More specifically a queue of a specific name on a specific channel.


-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110314/b9451d5a/attachment.htm>

From vukasin at toroman.name  Mon Mar 14 17:20:36 2011
From: vukasin at toroman.name (Vukasin Toroman)
Date: Mon, 14 Mar 2011 18:20:36 +0100
Subject: [rabbitmq-discuss] Messages not showing up
In-Reply-To: <30D19C8C-E8A9-4FB1-A492-8E499BB12678@toroman.name>
References: <30D19C8C-E8A9-4FB1-A492-8E499BB12678@toroman.name>
Message-ID: <A2A45E2E-1541-4C51-A1DC-D605541E24B1@toroman.name>

ok,

the messages seem to still be in the system (so not gone, which good :-) ). after restarting one of the message producers all of the "missing" messages started at once appearing in the queue as expected. is there a known issue with long-running producers?

best regards,
vukasin


On Mar 14, 2011, at 16:28 , Vukasin Toroman wrote:

> Hi everyone,
> 
> we have been using rabbitmq for a while now to route documents through a processing workflow. each step is represented by one or more processes working on one queue. the messages are small (maybe a few k) but there are quite a few of them (multiple thousand per second). This has been working fine for a while but then we have noticed that the rates (each step of the processing workflow delivers stats) do not add up. namely we seem to be losing messages (around 200 messages/sec) and this is quite discerning. The reason is that these messages do not show up in the queue and are also not visible as being recieved and un-acked. we are using non-durable queues and a combination of java and python processing clients. 
> 
> oh yes, this only happens after the system has been running for a while and a traffic spike has occurred. the rabbitmq process also seems to be gaining memory. 
> 
> we are using 2.3.1-1 version of rabbitmq-server on ubuntu 10.4 (amd64)
> 
> thank you for you help,
> vukasin
> 
> 


From simon at rabbitmq.com  Mon Mar 14 17:21:03 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 Mar 2011 17:21:03 +0000
Subject: [rabbitmq-discuss] diacritics in bindings
In-Reply-To: <4D7E299A.80000@mediasat.ro>
References: <4D7E299A.80000@mediasat.ro>
Message-ID: <4D7E4E7F.6090907@rabbitmq.com>

On 14/03/11 14:43, Andi Constantin wrote:
> Hello !

Hi.

> I used a diacritic character in a binding:
> mo.route.1733.?tefan.#
>
> And rabbitmqadmin does not work any more:

Well, that's embarrassing. I've just committed a fix, which should be in 
the next release but which you can temporarily get from:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/5535c05ec840/bin/rabbitmqadmin

You should be aware that the format of the declare / delete / purge / 
close subcommands has changed since 2.1.1, they now take both mandatory 
and optional arguments in name=value format.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From vukasin at toroman.name  Mon Mar 14 17:29:51 2011
From: vukasin at toroman.name (Vukasin Toroman)
Date: Mon, 14 Mar 2011 18:29:51 +0100
Subject: [rabbitmq-discuss] Messages not showing up
In-Reply-To: <3B66EE1D58E842BE9DA5760110C24609@myyearbook.com>
References: <30D19C8C-E8A9-4FB1-A492-8E499BB12678@toroman.name>
	<3B66EE1D58E842BE9DA5760110C24609@myyearbook.com>
Message-ID: <B2F1953C-A80F-44F6-AF23-7C0F8541654F@toroman.name>

I am keeping counts in my consumers (and producers). But as I stated in my other mail, the messages were there but were not making it into the queues until the producer was restarted (?!) which is quite strange since after that, everything kinda went back to normal (probably until the next spike). 

thx,
vukasin



On Mar 14, 2011, at 16:53 , Gavin M. Roy wrote:

> 
> On Monday, March 14, 2011 at 11:28 AM, Vukasin Toroman wrote:
> 
>> Hi everyone,
>> 
>> we have been using rabbitmq for a while now to route documents through a processing workflow. each step is represented by one or more processes working on one queue. the messages are small (maybe a few k) but there are quite a few of them (multiple thousand per second). This has been working fine for a while but then we have noticed that the rates (each step of the processing workflow delivers stats) do not add up. namely we seem to be losing messages (around 200 messages/sec) and this is quite discerning. The reason is that these messages do not show up in the queue and are also not visible as being recieved and un-acked. we are using non-durable queues and a combination of java and python processing clients.
> How are you quantifying the counts?  Do you keep track on your own outside of RabbitMQ message counts on your consumers and publishers? 
>> oh yes, this only happens after the system has been running for a while and a traffic spike has occurred. the rabbitmq process also seems to be gaining memory.
> I have found that if I am over saturating a single node with regard to message throughput, I see a pattern where memory use increases without being able to reconcile where it is used. During spikes like this, I did see abnormal behavior with messages as well.  
> 
> In my case, I was seeing this behavior when throughput exceeded ~25k messages per second being published into a single node on a single exchange while consuming from multiple queues bound to the exchange connected to other nodes in the rabbitmq cluster. 
> 
> To address this, I changed the publishing strategy and added a few nodes to the cluster. I still use the same exchange and routing key structure, however I am now publishing into the exchange across multiple nodes instead of one. I have not seen any issues since this change and am now operating at 2x the previous message velocity across the cluster.
> 
> Hope this helps,
> 
> Gavin
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110314/b0079938/attachment.htm>

From simon at rabbitmq.com  Mon Mar 14 18:18:56 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 Mar 2011 18:18:56 +0000
Subject: [rabbitmq-discuss] RabbitMQ client running behind a firewall
In-Reply-To: <AANLkTimHAh9HqxCFQBPDrnKfZJdaMN6jpe-THZs2qoRr@mail.gmail.com>
References: <AANLkTimHAh9HqxCFQBPDrnKfZJdaMN6jpe-THZs2qoRr@mail.gmail.com>
Message-ID: <4D7E5C10.5010909@rabbitmq.com>

On 13/03/11 22:11, Benjamin Renaud wrote:
> Our RabbitMQ server runs in the cloud, and our customers' client will
> often be running behind a firewall. Requiring them to open up 5672 is
> not going to be a great option. Is there an HTTP tunneling facility we
> can use,

Hmm. AMQP won't trivially tunnel on HTTP since we need asynchronous 
communication both ways. The rabbitmq-jsonrpc-channel plugin attempts to 
square this circle somewhat, with a certain amount of polling involved. 
It was originally designed to take messaging to the browser but we've 
had reports of people using generic clients with it.

http://www.rabbitmq.com/plugins.html#rabbitmq-jsonrpc-channel

We're also looking to expand our HTTP story, there are a bunch of 
projects in progress which hopefully will bear fruit soon.

 > or some kind of a relay server?

Hmm, I'm not sure what this would even look like. There's a simplistic 
AMQP proxy in the Java client (designed for debugging) but I'm guessing 
you're not looking for AMQP-AMQP relaying?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Mon Mar 14 18:21:15 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 Mar 2011 18:21:15 +0000
Subject: [rabbitmq-discuss] Client connect/disconnect events on the
 server side
In-Reply-To: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>
References: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>
Message-ID: <4D7E5C9B.8070901@rabbitmq.com>

On 13/03/11 22:07, Benjamin Renaud wrote:
> Our REST server would like to be notified when clients connect and
> disconnect. Is there a facility (standard event?) in RabbitMQ for
> this?

Not ATM. I wonder about implementing such a thing since it occasionally 
gets asked about, although I'm not sure what it would look like. Are you 
talking about something that would send the sort of information that the 
management plugin shows for connections, but as events on connect / 
disconnect? Or something else?

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Mon Mar 14 18:30:43 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 14 Mar 2011 18:30:43 +0000
Subject: [rabbitmq-discuss] Client IP based user login permissions
In-Reply-To: <12162749.351.1299861805836.JavaMail.geo-discussion-forums@vbbfl13>
References: <12162749.351.1299861805836.JavaMail.geo-discussion-forums@vbbfl13>
Message-ID: <4D7E5ED3.5010701@rabbitmq.com>

On 11/03/11 16:43, Oren Shomron wrote:
> Let me know if that makes any sense.

Thanks, that does make sense.

 > The only way I see of doing it right now would be to have completely
 > separate RabbitMQ instances, and have that validation component talk to
 > both instances and forward between them, but this would increase 
complexity.

It would, but you're right, this is the only way at the moment.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From therevoltingx at gmail.com  Mon Mar 14 19:27:09 2011
From: therevoltingx at gmail.com (Miguel Morales)
Date: Mon, 14 Mar 2011 12:27:09 -0700
Subject: [rabbitmq-discuss] Client connect/disconnect events on the
	server side
In-Reply-To: <4D7E5C9B.8070901@rabbitmq.com>
References: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>
	<4D7E5C9B.8070901@rabbitmq.com>
Message-ID: <AANLkTikAB8K0kaNku0i4AgY42_tu0egM2kPS=5BsW++W@mail.gmail.com>

I too would be interested in this.  Not sure if anything like this exists
but basically it could be some sort of callback mechanism where we are
notified of when a client has connected/disconnected to the broker.


On Mon, Mar 14, 2011 at 11:21 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 13/03/11 22:07, Benjamin Renaud wrote:
>
>> Our REST server would like to be notified when clients connect and
>> disconnect. Is there a facility (standard event?) in RabbitMQ for
>> this?
>>
>
> Not ATM. I wonder about implementing such a thing since it occasionally
> gets asked about, although I'm not sure what it would look like. Are you
> talking about something that would send the sort of information that the
> management plugin shows for connections, but as events on connect /
> disconnect? Or something else?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
~ Jeremiah:9:23-24
Android 2D MMORPG: http://solrpg.com/ http://www.youtube.com/user/revoltingx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110314/37de796b/attachment.htm>

From matthias at rabbitmq.com  Mon Mar 14 19:43:59 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 14 Mar 2011 19:43:59 +0000
Subject: [rabbitmq-discuss] Client connect/disconnect events on
 the	server side
In-Reply-To: <AANLkTikAB8K0kaNku0i4AgY42_tu0egM2kPS=5BsW++W@mail.gmail.com>
References: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>	<4D7E5C9B.8070901@rabbitmq.com>
	<AANLkTikAB8K0kaNku0i4AgY42_tu0egM2kPS=5BsW++W@mail.gmail.com>
Message-ID: <4D7E6FFF.9080602@rabbitmq.com>

Miguel,

On 14/03/11 19:27, Miguel Morales wrote:
> I too would be interested in this.  Not sure if anything like this
> exists but basically it could be some sort of callback mechanism where
> we are notified of when a client has connected/disconnected to the broker.

What do you need this for?

And what information would have to be passed to such a callback?

If you are just interested in network-level connect/disconnect events 
then a simple TCP proxy could give you that information.

Or you could do some live processing of rabbit's log files, which, 
amongst other things, contain all connect/disconnect events. Or you 
could get the log events over AMQP by binding to the amq.rabbitmq.log 
topic exchange.


Regards,

Matthias.

From therevoltingx at gmail.com  Mon Mar 14 19:53:03 2011
From: therevoltingx at gmail.com (Miguel Morales)
Date: Mon, 14 Mar 2011 12:53:03 -0700
Subject: [rabbitmq-discuss] Client connect/disconnect events on the
	server side
In-Reply-To: <4D7E6FFF.9080602@rabbitmq.com>
References: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>
	<4D7E5C9B.8070901@rabbitmq.com>
	<AANLkTikAB8K0kaNku0i4AgY42_tu0egM2kPS=5BsW++W@mail.gmail.com>
	<4D7E6FFF.9080602@rabbitmq.com>
Message-ID: <AANLkTimPGYp-G9WD5Hn-wWqpud2oQoqx8Xw_vy5HiyDA@mail.gmail.com>

Mathias,

Well I haven't researched this, but it's something that I need to implement
in the near future.
Basically, I have a public broker which clients (android devices in my case)
connect and disconnect.  When they log-in it would be considered that they
are 'active' if they log-out it would be considered that they are
'inactive.'

This is important because other clients need to know information about
'active' clients.

I haven't done much research into it because I'm avoiding it until I get
closer to release it to the real world.

I am indeed interested in network connects/disconnects, but I would also
need to know the username of the client that just logged in.
(for example, if the client suddenly disconnects I need to set their status
to 'inactive' in my global database.)

Other than that, I think my best choice would be to bind to the
amq.rabbitmq.log exchange (didn't know about it before) and parse the log
messages.
However, that seems a bit brittle for me (might change between versions),
but it would work well.

Thanks for your suggestions, it might help the original poster as well.

On Mon, Mar 14, 2011 at 12:43 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Miguel,
>
>
> On 14/03/11 19:27, Miguel Morales wrote:
>
>> I too would be interested in this.  Not sure if anything like this
>> exists but basically it could be some sort of callback mechanism where
>> we are notified of when a client has connected/disconnected to the broker.
>>
>
> What do you need this for?
>
> And what information would have to be passed to such a callback?
>
> If you are just interested in network-level connect/disconnect events then
> a simple TCP proxy could give you that information.
>
> Or you could do some live processing of rabbit's log files, which, amongst
> other things, contain all connect/disconnect events. Or you could get the
> log events over AMQP by binding to the amq.rabbitmq.log topic exchange.
>
>
> Regards,
>
> Matthias.
>



-- 
~ Jeremiah:9:23-24
Android 2D MMORPG: http://solrpg.com/ http://www.youtube.com/user/revoltingx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110314/982b41ad/attachment.htm>

From matthias at rabbitmq.com  Mon Mar 14 20:42:19 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 14 Mar 2011 20:42:19 +0000
Subject: [rabbitmq-discuss] Client connect/disconnect events on the
 server side
In-Reply-To: <AANLkTimPGYp-G9WD5Hn-wWqpud2oQoqx8Xw_vy5HiyDA@mail.gmail.com>
References: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>	<4D7E5C9B.8070901@rabbitmq.com>	<AANLkTikAB8K0kaNku0i4AgY42_tu0egM2kPS=5BsW++W@mail.gmail.com>	<4D7E6FFF.9080602@rabbitmq.com>
	<AANLkTimPGYp-G9WD5Hn-wWqpud2oQoqx8Xw_vy5HiyDA@mail.gmail.com>
Message-ID: <4D7E7DAB.2060000@rabbitmq.com>

Miguel,

Miguel Morales wrote:
> Well I haven't researched this, but it's something that I need to 
> implement in the near future. Basically, I have a public broker which
> clients (android devices in my case) connect and disconnect.  When
> they log-in it would be considered that they are 'active' if they
> log-out it would be considered that they are 'inactive.'
> 
> This is important because other clients need to know information
> about 'active' clients.

Ah, so this is about 'presence'. That has come up a few times before. 
Might be worth searching the archives.

> I am indeed interested in network connects/disconnects, but I would
> also need to know the username of the client that just logged in. 
> (for example, if the client suddenly disconnects I need to set their
>  status to 'inactive' in my global database.)

Is the fact that a client has connected with a particular user name 
really indicating presence? Or is their presence perhaps only 
established when they start consuming from a queue?

> Other than that, I think my best choice would be to bind to the 
> amq.rabbitmq.log exchange (didn't know about it before) and parse the
>  log messages. However, that seems a bit brittle for me (might change
> between versions), but it would work well.

Unfortunately (for you) there is no log message containing the user name.


Matthias.

From br at versly.com  Mon Mar 14 20:51:06 2011
From: br at versly.com (Benjamin Renaud)
Date: Mon, 14 Mar 2011 13:51:06 -0700
Subject: [rabbitmq-discuss] Client connect/disconnect events on the
	server side
In-Reply-To: <4D7E7DAB.2060000@rabbitmq.com>
References: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>
	<4D7E5C9B.8070901@rabbitmq.com>
	<AANLkTikAB8K0kaNku0i4AgY42_tu0egM2kPS=5BsW++W@mail.gmail.com>
	<4D7E6FFF.9080602@rabbitmq.com>
	<AANLkTimPGYp-G9WD5Hn-wWqpud2oQoqx8Xw_vy5HiyDA@mail.gmail.com>
	<4D7E7DAB.2060000@rabbitmq.com>
Message-ID: <AANLkTimADBS=i4mArMn8aa3W6FbUL+5NdEbJiGkgYYp0@mail.gmail.com>

So we need it because our clients collaborate on the same resource,
and we want to use the connection essentially as 'presence'
information - that someone is working on the the same resource.

Ideally, we'd pass in a user id when connecting, and we could register
(on the exchange perhaps) to know when that a client comes in and out.

We have to deal with the issue where a user shuts their laptop and the
client goes away. It seems like Rabbit would be well positioned to
tell us that.

BR

On Mon, Mar 14, 2011 at 1:42 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Miguel,
>
> Miguel Morales wrote:
>>
>> Well I haven't researched this, but it's something that I need to
>> implement in the near future. Basically, I have a public broker which
>> clients (android devices in my case) connect and disconnect. ?When
>> they log-in it would be considered that they are 'active' if they
>> log-out it would be considered that they are 'inactive.'
>>
>> This is important because other clients need to know information
>> about 'active' clients.
>
> Ah, so this is about 'presence'. That has come up a few times before. Might
> be worth searching the archives.
>
>> I am indeed interested in network connects/disconnects, but I would
>> also need to know the username of the client that just logged in. (for
>> example, if the client suddenly disconnects I need to set their
>> ?status to 'inactive' in my global database.)
>
> Is the fact that a client has connected with a particular user name really
> indicating presence? Or is their presence perhaps only established when they
> start consuming from a queue?
>
>> Other than that, I think my best choice would be to bind to the
>> amq.rabbitmq.log exchange (didn't know about it before) and parse the
>> ?log messages. However, that seems a bit brittle for me (might change
>> between versions), but it would work well.
>
> Unfortunately (for you) there is no log message containing the user name.
>
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
ben renaud
versly.com
br at versly.com

From therevoltingx at gmail.com  Mon Mar 14 23:01:59 2011
From: therevoltingx at gmail.com (Miguel Morales)
Date: Mon, 14 Mar 2011 16:01:59 -0700
Subject: [rabbitmq-discuss] Client connect/disconnect events on the
	server side
In-Reply-To: <4D7E7DAB.2060000@rabbitmq.com>
References: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>
	<4D7E5C9B.8070901@rabbitmq.com>
	<AANLkTikAB8K0kaNku0i4AgY42_tu0egM2kPS=5BsW++W@mail.gmail.com>
	<4D7E6FFF.9080602@rabbitmq.com>
	<AANLkTimPGYp-G9WD5Hn-wWqpud2oQoqx8Xw_vy5HiyDA@mail.gmail.com>
	<4D7E7DAB.2060000@rabbitmq.com>
Message-ID: <AANLkTikZ28MVSJDWz9yUcDZyhvsjEg7ms7VW+ZfiaVi2@mail.gmail.com>

Mathias,


> Is the fact that a client has connected with a particular user name really
> indicating presence? Or is their presence perhaps only established when they
> start consuming from a queue?
>
>
Well, presence is established when they subscribe to an exchange.  The way I
have it now is that they have to 'announce' themselves when they log in by
publishing a message.

However, I currently have no way of knowing when they disconnect and be able
to tell the other clients that the user is no longer active.


> Unfortunately (for you) there is no log message containing the user name.
>
> Damn that sucks, I'll have to look through the archives and see if other
people give hints as to a proper solution.

Thanks,
Miguel.


-- 
~ Jeremiah:9:23-24
Android 2D MMORPG: http://solrpg.com/ http://www.youtube.com/user/revoltingx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110314/04cdbeed/attachment.htm>

From marcel.meyer at gmail.com  Mon Mar 14 23:09:01 2011
From: marcel.meyer at gmail.com (Marcel Meyer)
Date: Mon, 14 Mar 2011 19:09:01 -0400
Subject: [rabbitmq-discuss] Reddit news
In-Reply-To: <AANLkTi=c95-b0+Dtuc0W5cpTuZ8FzQoptzni9NmEa_vg@mail.gmail.com>
References: <AANLkTikM25E3k_zf53v-PT+B2N+aa=YzP_eT-t9na2+N@mail.gmail.com>
	<AANLkTikaU19=feRbbmUH7t7G28-a_=WKO-pvTshRgWm7@mail.gmail.com>
	<AANLkTim2MTCHwnGR0t+iiTM388NVZu4+VwS9VckzEX2Y@mail.gmail.com>
	<AANLkTi=c95-b0+Dtuc0W5cpTuZ8FzQoptzni9NmEa_vg@mail.gmail.com>
Message-ID: <AANLkTi=btNbWFP0kXq_6kRKGZfi0FJDXmFCTr4Fdn4oB@mail.gmail.com>

Thanks for the info Marek.

So how does Rabbit 2+ deal with saturation?

On 3/14/11, Marek Majkowski <majek04 at gmail.com> wrote:
> From what I understood, they run into a pretty common misunderstanding.
>
> Basically the system that consumed messages, for some
> reason, was too slow. That, obviously, put a lot of stress
> on RabbitMQ, and as it was before rabbit 2.0, at some point
> Rabbit just died due to out-of-memory situation.
>
> Reddit guys were unhappy to see Rabbit go down, but
> in fact Rabbit was not the source of their problems.
> It was just a side-effect of something else misbehaving.
>
> Cheers,
>   Marek
>
> On Fri, Mar 11, 2011 at 19:30, Marcel Meyer <marcel.meyer at gmail.com> wrote:
>> Great!?Do you know whether this was documented as some anti-pattern? Is
>> there more about the specific issues they faced?
>> On Fri, Mar 11, 2011 at 12:13 PM, Alexis Richardson <alexis at rabbitmq.com>
>> wrote:
>>>
>>> Hi Marcel
>>>
>>> Yes, I believe so. ? Matthew went to see them. ?As I recall the main
>>> issues were actually not with Rabbit, but some of how they had used
>>> messaging was worth discussing.
>>>
>>> alexis
>>>
>>>
>>> On Fri, Mar 11, 2011 at 5:07 PM, Marcel Meyer <marcel.meyer at gmail.com>
>>> wrote:
>>> > Hi there Rabbit Community,
>>> > I am researching queues and found this?thread about reddit's gripes
>>> > (http://www.reddit.com/tb/c2spc) and noticed that RabbitMQ Support
>>> > reached
>>> > out to them.
>>> > Were there issues resolved? They upgraded ERTS as a "stopgap" fix, but
>>> > wanted to yank the technology all together. Did they?
>>> > Regards,
>>> > Marcel
>>> > _______________________________________________
>>> > rabbitmq-discuss mailing list
>>> > rabbitmq-discuss at lists.rabbitmq.com
>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> >
>>> >
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>

From matthias at rabbitmq.com  Mon Mar 14 23:29:12 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 14 Mar 2011 23:29:12 +0000
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <881183.67741.qm@web31810.mail.mud.yahoo.com>
References: <486630.9133.qm@web31810.mail.mud.yahoo.com>
	<4D79C5C2.7010104@rabbitmq.com>
	<111862.43754.qm@web31808.mail.mud.yahoo.com>
	<4D79DF94.6030606@rabbitmq.com>
	<881183.67741.qm@web31810.mail.mud.yahoo.com>
Message-ID: <4D7EA4C8.4040502@rabbitmq.com>

Alex,

alex chen wrote:
>  > Any chance you could script the above to the point where all one 
> needs to do is:
>  > 1) start clean rabbit
>  > 2) run test script
>  > 3) wait for broker to die
> 
> The test scripts are exactly the same as before:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-August/008570.html

It would really help if you consolidated all that into a simple set up 
as I mention above. As it stands we have to piece together the test code 
and scripts from various emails. That a) takes time, and b) increases 
the chances that we will be doing something slightly different and thus 
not be able to reproduce the problem.

Regards,

Matthias.
PS: please keep rabbitmq-discuss on the cc.

From 176047528 at qq.com  Tue Mar 15 00:50:43 2011
From: 176047528 at qq.com (=?ISO-8859-1?B?eWFvaHVp?=)
Date: Tue, 15 Mar 2011 08:50:43 +0800
Subject: [rabbitmq-discuss] |Spam| Rabbitmq performence test
Message-ID: <tencent_7653C8EA0DDC4AA01859A1D9@qq.com>

hi,
   
   I do a performence test on my machine using java client with the script runperftest.sh , the message rate is only 4500msg/s. 
  cpu  4 core 3.0G
  memory 4G 
 
 someone can show your result?

 thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110315/ce0929be/attachment.htm>

From vdeepak at yahoo-inc.com  Tue Mar 15 04:31:21 2011
From: vdeepak at yahoo-inc.com (Deepak Vijayvergiy)
Date: Tue, 15 Mar 2011 10:01:21 +0530
Subject: [rabbitmq-discuss] Client connect/disconnect events on
	the	server side
In-Reply-To: <AANLkTikZ28MVSJDWz9yUcDZyhvsjEg7ms7VW+ZfiaVi2@mail.gmail.com>
References: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>
	<4D7E5C9B.8070901@rabbitmq.com>
	<AANLkTikAB8K0kaNku0i4AgY42_tu0egM2kPS=5BsW++W@mail.gmail.com>
	<4D7E6FFF.9080602@rabbitmq.com>
	<AANLkTimPGYp-G9WD5Hn-wWqpud2oQoqx8Xw_vy5HiyDA@mail.gmail.com>
	<4D7E7DAB.2060000@rabbitmq.com>
	<AANLkTikZ28MVSJDWz9yUcDZyhvsjEg7ms7VW+ZfiaVi2@mail.gmail.com>
Message-ID: <4572A3A6-AD57-4F18-B85F-09FF307DF9DE@yahoo-inc.com>

Hi Miguel,
Even I have the same scenario, and I have my clients announcing(publishing) their connect and disconnect at the time of log-in and log-off resp. I have a deamon process running which is a pure consumer listening on 'register.*'.
Would be interested to know if some better way exists.

Thanks
Regards
Deepak

On Mar 15, 2011, at 4:31 AM, Miguel Morales wrote:

Mathias,

Is the fact that a client has connected with a particular user name really indicating presence? Or is their presence perhaps only established when they start consuming from a queue?


Well, presence is established when they subscribe to an exchange.  The way I have it now is that they have to 'announce' themselves when they log in by publishing a message.

However, I currently have no way of knowing when they disconnect and be able to tell the other clients that the user is no longer active.

Unfortunately (for you) there is no log message containing the user name.

Damn that sucks, I'll have to look through the archives and see if other people give hints as to a proper solution.

Thanks,
Miguel.


--
~ Jeremiah:9:23-24
Android 2D MMORPG: http://solrpg.com/ http://www.youtube.com/user/revoltingx
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110315/fba2f5bc/attachment.htm>

From Waseem_Hawaldar at mindtree.com  Tue Mar 15 07:31:09 2011
From: Waseem_Hawaldar at mindtree.com (Waseem Hawaldar)
Date: Tue, 15 Mar 2011 07:31:09 +0000
Subject: [rabbitmq-discuss] Program to get list_queues from client RabbitMQ.
Message-ID: <192E282CAB256F41A2161A9E1BAA7C5E14F07F@MTW02MBX01.mindtree.com>

Hello ,
I want to write a small program which can give me list_queues data from client RabbitMQ  without using command prompt. So may I know how this can be done.

Regards,
Waseem

________________________________

http://www.mindtree.com/email/disclaimer.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110315/b6ffa8f8/attachment.htm>

From paul.theodoropoulos at gmail.com  Tue Mar 15 04:27:52 2011
From: paul.theodoropoulos at gmail.com (paul)
Date: Mon, 14 Mar 2011 21:27:52 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-server init script
In-Reply-To: <20110309211242.GA2355@dakota.doc.ic.ac.uk>
References: <20110309135151.GA14426@dakota.eng.vmware.com>
	<14035820.548.1299696932953.JavaMail.geo-discussion-forums@prfc6>
	<20110309211242.GA2355@dakota.doc.ic.ac.uk>
Message-ID: <85c27985-2592-418d-b160-fa713a31f2fd@11g2000prf.googlegroups.com>

just a note - the init script sets USER, but never uses the var
anywhere in the script. had a recurring issue with rabbitmq failing to
start after a reboot (centOS). merely adding the following after all
the vars are declared fixes the issue:

chown -R $USER:$USER $INIT_LOG_DIR

should probably be folded into the script...

On Mar 9, 2:12?pm, Alexandru Scvortov <alexan... at rabbitmq.com> wrote:
> Ah, no. ?That directory is in our source tree, but isn't included in the
> source distribution. ?Here's the 2.3.1 one:
> ?http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_3_1/packaging...
>
> Cheers,
> Alex
>
> On Wed, Mar 09, 2011 at 10:55:32AM -0800, Nite wrote:
> > Weird, my build does not have a package directory.
> > Do I have to give any special build parameters?
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From vorad.1100 at gmail.com  Tue Mar 15 07:11:20 2011
From: vorad.1100 at gmail.com (vorad)
Date: Tue, 15 Mar 2011 09:11:20 +0200
Subject: [rabbitmq-discuss] acquiring channels per connection
Message-ID: <AANLkTik60yoaMptM=pk6c-AD=5SSZX=Vd9wPcUa0WW-e@mail.gmail.com>

Hi guys,

I am trying to figure out what's the best way to work with rabbitmq - I am
working on implementing a couple of basic HTTP requests that do some queue
management (with the Pika library and Tornado as web server). One of the
first issues I had was how do I actually get the errors out of Pika when
these happen (say when you're trying to delete a queue that doesn't exist)
and it seems I figured that out, hopefully (channel.add_on_close_callback)

Now, the way I tought this was that I have one rabbitmq connection per
application/web server and one channel as well, which seems pretty bad now
that I look back, since I can't really do particular error logic per request
with only one channel per application. So I am trying to switch away from
this to having one channel per http request. How expensive would be to do
this (one channel per request) from the rabbitmq perspective and also from
the Pika's perspective ? And also, does this look like a good approach,
given the fact that I'll have lots of http connections? I know that RabbitMQ
was made to scale to a big number of channels.

Thanks!


PS: Please add me to CC or hit Reply All when answering this email as I'm
not subscribe to this mailing list.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110315/fc1c2061/attachment.htm>

From andi.constantin at mediasat.ro  Tue Mar 15 08:50:07 2011
From: andi.constantin at mediasat.ro (Andi Constantin)
Date: Tue, 15 Mar 2011 10:50:07 +0200
Subject: [rabbitmq-discuss] diacritics in bindings
In-Reply-To: <4D7E4E7F.6090907@rabbitmq.com>
References: <4D7E299A.80000@mediasat.ro> <4D7E4E7F.6090907@rabbitmq.com>
Message-ID: <4D7F283F.2000009@mediasat.ro>

Hi Simon !

Thank you for the fix! Now it's working fine
| /     | msat.x.mo        | msat.q.sva.kltest              | 
queue            | mo.route.1276.?tefan.#         | 
mo.route.1276.%C5%9Etefan.%23    |

But when i try to redirect the output i have the same error, ex:

rabbitmqadmin list bindings > file1
or
rabbitmqadmin list bindings | grep fan

Traceback (most recent call last):
   File "/bin/rabbitmqadmin", line 588, in <module>
     main()
   File "/bin/rabbitmqadmin", line 175, in main
     method()
   File "/bin/rabbitmqadmin", line 247, in invoke_list
     format_list(self.get(uri), self.args[1:], self.options)
   File "/bin/rabbitmqadmin", line 332, in format_list
     formatter_instance.display(json_list)
   File "/bin/rabbitmqadmin", line 345, in display
     self.display_list(columns, table)
   File "/bin/rabbitmqadmin", line 434, in display_list
     self.ascii_table(total)
   File "/bin/rabbitmqadmin", line 446, in ascii_table
     self.ascii_row(col_widths, row, "<")
   File "/bin/rabbitmqadmin", line 454, in ascii_row
     print txt
UnicodeEncodeError: 'ascii' codec can't encode character u'\u015e' in 
position 95: ordinal not in range(128)


Thanks,
Andi.


On 3/14/2011 7:21 PM, Simon MacMullen wrote:
> On 14/03/11 14:43, Andi Constantin wrote:
>> Hello !
>
> Hi.
>
>> I used a diacritic character in a binding:
>> mo.route.1733.?tefan.#
>>
>> And rabbitmqadmin does not work any more:
>
> Well, that's embarrassing. I've just committed a fix, which should be 
> in the next release but which you can temporarily get from:
>
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/5535c05ec840/bin/rabbitmqadmin 
>
>
> You should be aware that the format of the declare / delete / purge / 
> close subcommands has changed since 2.1.1, they now take both 
> mandatory and optional arguments in name=value format.
>
> Cheers, Simon
>


From emile at rabbitmq.com  Tue Mar 15 09:19:44 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 15 Mar 2011 09:19:44 +0000
Subject: [rabbitmq-discuss] Program to get list_queues from client
	RabbitMQ.
In-Reply-To: <192E282CAB256F41A2161A9E1BAA7C5E14F07F@MTW02MBX01.mindtree.com>
References: <192E282CAB256F41A2161A9E1BAA7C5E14F07F@MTW02MBX01.mindtree.com>
Message-ID: <4D7F2F30.9010007@rabbitmq.com>

Hi Waseem,

On 15/03/11 07:31, Waseem Hawaldar wrote:
> Hello ,
>
> I want to write a small program which can give me list_queues data from
> client RabbitMQ without using command prompt. So may I know how this can
> be done.

The management & monitoring plugin provides a commandline tool 
(rabbitmqadmin) and an HTTP API that can provide this information:

http://www.rabbitmq.com/management.html#http-api


Regards

Emile

From matthias at rabbitmq.com  Tue Mar 15 09:32:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 Mar 2011 09:32:10 +0000
Subject: [rabbitmq-discuss] Rabbitmq-Shovel Timer-Based Publishing
	Possible?
In-Reply-To: <C99FAC9F.3366%allen.kim@epicadvertising.com>
References: <C99FAC9F.3366%allen.kim@epicadvertising.com>
Message-ID: <4D7F321A.5010502@rabbitmq.com>

Allen,

On 11/03/11 15:40, Allen Kim wrote:
> We are planning to switch to new shovel plugin comes with 2.3.1, and
> currently testing on it.
> It works great, but I miss timer-based publish, which is very useful in
> the midnight with low number of message.

Can you explain what you mean by "timer-based publish" in the context of 
the shovel?

Regards,

Matthias.

From majek04 at gmail.com  Tue Mar 15 10:27:00 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 15 Mar 2011 10:27:00 +0000
Subject: [rabbitmq-discuss] Reddit news
In-Reply-To: <AANLkTi=btNbWFP0kXq_6kRKGZfi0FJDXmFCTr4Fdn4oB@mail.gmail.com>
References: <AANLkTikM25E3k_zf53v-PT+B2N+aa=YzP_eT-t9na2+N@mail.gmail.com>
	<AANLkTikaU19=feRbbmUH7t7G28-a_=WKO-pvTshRgWm7@mail.gmail.com>
	<AANLkTim2MTCHwnGR0t+iiTM388NVZu4+VwS9VckzEX2Y@mail.gmail.com>
	<AANLkTi=c95-b0+Dtuc0W5cpTuZ8FzQoptzni9NmEa_vg@mail.gmail.com>
	<AANLkTi=btNbWFP0kXq_6kRKGZfi0FJDXmFCTr4Fdn4oB@mail.gmail.com>
Message-ID: <AANLkTim+D2Fe+XZ_7_-CeJRTHytHLPfHSFS5Mwz=0JO6@mail.gmail.com>

On Mon, Mar 14, 2011 at 23:09, Marcel Meyer <marcel.meyer at gmail.com> wrote:
> Thanks for the info Marek.
>
> So how does Rabbit 2+ deal with saturation?

Rabbit 2.0+ has few mechanisms to deal with that.

First, it's important to understand that Rabbit tries to
take advantage of available memory. If your messages
fit into the memory - rabbit should be fast.

Once you hit the memory limit (usually set to 0.4 available RAM),
rabbit will start swapping out messages to disk to free memory.

If you have fast enough disk (ie: ssd) that shouldn't slow
down things too much.

But if you're producing messages faster than Rabbit is able
to put them on the disk - Rabbit memory usage will continue to grow.

At some point, to prevent running out of memory rabbit
will use the last measure - it will just stop accepting
new messages (by not doing recv() on connections that
try to do basic.publish).

If that happens, Rabbit should be able to catch the breath,
swap out some remaining messages, and eventually unblock
receiving.

Cheers,
  Marek

> On 3/14/11, Marek Majkowski <majek04 at gmail.com> wrote:
>> From what I understood, they run into a pretty common misunderstanding.
>>
>> Basically the system that consumed messages, for some
>> reason, was too slow. That, obviously, put a lot of stress
>> on RabbitMQ, and as it was before rabbit 2.0, at some point
>> Rabbit just died due to out-of-memory situation.
>>
>> Reddit guys were unhappy to see Rabbit go down, but
>> in fact Rabbit was not the source of their problems.
>> It was just a side-effect of something else misbehaving.
>>
>> Cheers,
>> ? Marek
>>
>> On Fri, Mar 11, 2011 at 19:30, Marcel Meyer <marcel.meyer at gmail.com> wrote:
>>> Great!?Do you know whether this was documented as some anti-pattern? Is
>>> there more about the specific issues they faced?
>>> On Fri, Mar 11, 2011 at 12:13 PM, Alexis Richardson <alexis at rabbitmq.com>
>>> wrote:
>>>>
>>>> Hi Marcel
>>>>
>>>> Yes, I believe so. ? Matthew went to see them. ?As I recall the main
>>>> issues were actually not with Rabbit, but some of how they had used
>>>> messaging was worth discussing.
>>>>
>>>> alexis
>>>>
>>>>
>>>> On Fri, Mar 11, 2011 at 5:07 PM, Marcel Meyer <marcel.meyer at gmail.com>
>>>> wrote:
>>>> > Hi there Rabbit Community,
>>>> > I am researching queues and found this?thread about reddit's gripes
>>>> > (http://www.reddit.com/tb/c2spc) and noticed that RabbitMQ Support
>>>> > reached
>>>> > out to them.
>>>> > Were there issues resolved? They upgraded ERTS as a "stopgap" fix, but
>>>> > wanted to yank the technology all together. Did they?
>>>> > Regards,
>>>> > Marcel
>>>> > _______________________________________________
>>>> > rabbitmq-discuss mailing list
>>>> > rabbitmq-discuss at lists.rabbitmq.com
>>>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> >
>>>> >
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>

From simon at rabbitmq.com  Tue Mar 15 10:31:41 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 15 Mar 2011 10:31:41 +0000
Subject: [rabbitmq-discuss] diacritics in bindings
In-Reply-To: <4D7F283F.2000009@mediasat.ro>
References: <4D7E299A.80000@mediasat.ro> <4D7E4E7F.6090907@rabbitmq.com>
	<4D7F283F.2000009@mediasat.ro>
Message-ID: <4D7F400D.5010902@rabbitmq.com>

On 15/03/11 08:50, Andi Constantin wrote:
> But when i try to redirect the output i have the same error, ex:

Sigh. Stupid Python!

Try this version:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/a9ca2d3ce01f/bin/rabbitmqadmin

(And thanks for the bug report.)

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Tue Mar 15 10:39:58 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 15 Mar 2011 10:39:58 +0000
Subject: [rabbitmq-discuss] |Spam|  |Spam| Rabbitmq performence test
In-Reply-To: <tencent_7653C8EA0DDC4AA01859A1D9@qq.com>
References: <tencent_7653C8EA0DDC4AA01859A1D9@qq.com>
Message-ID: <20110315103955.GA30443@rabbitmq.com>

On Tue, Mar 15, 2011 at 08:50:43AM +0800, yaohui wrote:
>    I do a performence test on my machine using java client with the script runperftest.sh , the message rate is only 4500msg/s. 
>   cpu  4 core 3.0G
>   memory 4G 

runperftest.sh does not attempt to run balanced tests. They merely exist
to measure changes between releases. If you construct a more balanced
test (i.e. ingress and egress rates are equal) with something like
MulticastMain, then you should be able to get much higher throughput.

Matthew

From Waseem_Hawaldar at mindtree.com  Tue Mar 15 11:29:53 2011
From: Waseem_Hawaldar at mindtree.com (Waseem Hawaldar)
Date: Tue, 15 Mar 2011 11:29:53 +0000
Subject: [rabbitmq-discuss] Program to get list_queues from client
	RabbitMQ.
In-Reply-To: <4D7F2F30.9010007@rabbitmq.com>
References: <192E282CAB256F41A2161A9E1BAA7C5E14F07F@MTW02MBX01.mindtree.com>
	<4D7F2F30.9010007@rabbitmq.com>
Message-ID: <192E282CAB256F41A2161A9E1BAA7C5E14F1C8@MTW02MBX01.mindtree.com>

        I think this is a server side plugins. But, I am need of implementing some small utility for this. Please provide me with some necessary details for implementing this.


Regards,
Waseem




-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Tuesday, March 15, 2011 2:50 PM
To: Waseem Hawaldar
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: Program to get list_queues from client RabbitMQ.

Hi Waseem,

On 15/03/11 07:31, Waseem Hawaldar wrote:
> Hello ,
>
> I want to write a small program which can give me list_queues data from
> client RabbitMQ without using command prompt. So may I know how this can
> be done.

The management & monitoring plugin provides a commandline tool
(rabbitmqadmin) and an HTTP API that can provide this information:

http://www.rabbitmq.com/management.html#http-api


Regards

Emile

________________________________

http://www.mindtree.com/email/disclaimer.html

From andi.constantin at mediasat.ro  Tue Mar 15 11:55:04 2011
From: andi.constantin at mediasat.ro (Andi Constantin)
Date: Tue, 15 Mar 2011 13:55:04 +0200
Subject: [rabbitmq-discuss] diacritics in bindings
In-Reply-To: <4D7F400D.5010902@rabbitmq.com>
References: <4D7E299A.80000@mediasat.ro> <4D7E4E7F.6090907@rabbitmq.com>
	<4D7F283F.2000009@mediasat.ro> <4D7F400D.5010902@rabbitmq.com>
Message-ID: <4D7F5398.4060907@mediasat.ro>

It's great !

Thank you !
Andi.

On 3/15/2011 12:31 PM, Simon MacMullen wrote:
> On 15/03/11 08:50, Andi Constantin wrote:
>> But when i try to redirect the output i have the same error, ex:
>
> Sigh. Stupid Python!
>
> Try this version:
>
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/a9ca2d3ce01f/bin/rabbitmqadmin 
>
>
> (And thanks for the bug report.)
>
> Cheers, Simon
>


From emile at rabbitmq.com  Tue Mar 15 12:51:07 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 15 Mar 2011 12:51:07 +0000
Subject: [rabbitmq-discuss] Program to get list_queues from client
	RabbitMQ.
In-Reply-To: <192E282CAB256F41A2161A9E1BAA7C5E14F1C8@MTW02MBX01.mindtree.com>
References: <192E282CAB256F41A2161A9E1BAA7C5E14F07F@MTW02MBX01.mindtree.com>
	<4D7F2F30.9010007@rabbitmq.com>
	<192E282CAB256F41A2161A9E1BAA7C5E14F1C8@MTW02MBX01.mindtree.com>
Message-ID: <4D7F60BB.1090501@rabbitmq.com>

Hi Waseem,

Queue enumeration does not form part of the AMQP specification, so there 
is no way of implementing this using only AMQP.

If you are unable to install a plugin to help then another option is to 
implement the same interface that rabbitmqctl uses internally to 
communicate with the broker:

http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_3_1/src/rabbit_control.erl#l232

If your utility must be written in Java then the Jinterface 
documentation will be useful:

http://www.erlang.org/doc/apps/jinterface/jinterface_users_guide.html


Regards

Emile




On 15/03/11 11:29, Waseem Hawaldar wrote:
> I think this is a server side plugins. But, I am need of implementing
> some small utility for this. Please provide me with some necessary
> details for implementing this.
>
>
> Regards, Waseem
>
>
>
>
> -----Original Message----- From: Emile Joubert
> [mailto:emile at rabbitmq.com] Sent: Tuesday, March 15, 2011 2:50 PM To:
> Waseem Hawaldar Cc: rabbitmq-discuss at lists.rabbitmq.com Subject: Re:
> Program to get list_queues from client RabbitMQ.
>
> Hi Waseem,
>
> On 15/03/11 07:31, Waseem Hawaldar wrote:
>> Hello ,
>>
>> I want to write a small program which can give me list_queues data
>> from client RabbitMQ without using command prompt. So may I know
>> how this can be done.
>
> The management&  monitoring plugin provides a commandline tool
> (rabbitmqadmin) and an HTTP API that can provide this information:
>
> http://www.rabbitmq.com/management.html#http-api


From emile at rabbitmq.com  Tue Mar 15 13:08:48 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 15 Mar 2011 13:08:48 +0000
Subject: [rabbitmq-discuss] Subscription Pattern in .net
In-Reply-To: <AANLkTim=9nDjV9UVmudcC3dh4XdK9DjHT5uLiUHew6-M@mail.gmail.com>
References: <AANLkTim=9nDjV9UVmudcC3dh4XdK9DjHT5uLiUHew6-M@mail.gmail.com>
Message-ID: <4D7F64E0.8060505@rabbitmq.com>

Hi Steven,

Thanks for your message about the Subscription class in the .net client.


On 12/03/11 08:06, Steven Taylor wrote:
> Hi,
> I like the Consumer pattern, but I wanted a timed version of it.  FYI:
> the Consumer pattern is basically a message enumerator/iterator that you
> can use in a foreach statement.  i.e. when a message turns up, you get
> another pass through the loop during which your code can decide what to
> do with the message.  Consumer lives in the
> RabbitMQ.Client.MessagePatterns namespace.
> For me, Foreach is neat approach as It hides uneccessesary detail.

IEnumerator.MoveNext() currently waits an indefinite amount of time 
until a message arrives. If I understand correctly, you want a version 
of with a timeout, supplied in the constructor.

Would the enumeration need to be restartable? You may need a different 
implementation of Reset() in that case and this substantially changes 
the semantics of Subscription. I'm not sure how well this fits with 
IEnumerator. Your use-case appears to be reading messages until a large 
gap appears between message. At first glance that looks insufficiently 
general to justify changing the IEnumerator implementation.

The Next(TimeOut,out Msg) method was intended to meet your needs if you 
want a timeout. The example you provided using this looks fine.

> So what is the policy on updating the Mercurial repository?

You could also fork our github repository here:
https://github.com/rabbitmq/rabbitmq-dotnet-client
This would be a way of building consensus for your proposal.

Code that you contribute that does get accepted in the main mercurial 
repository will need a signed contributor agreement.


Regards

Emile

From stammailbox at gmail.com  Tue Mar 15 14:16:51 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Tue, 15 Mar 2011 16:16:51 +0200
Subject: [rabbitmq-discuss] RabbitMQ - how do I delete all messages from a
	single queue
Message-ID: <AANLkTimVuQnwrOZ+zZVXeEeB95SXjD4ZeUNjY5xN9HZo@mail.gmail.com>

Hi,
maybe it is a beginners question, but I have a queue and i would like to
clean it before I start each time.
How do I delete all messages from it?
10x
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110315/86db9f52/attachment.htm>

From videlalvaro at gmail.com  Tue Mar 15 14:19:07 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 15 Mar 2011 15:19:07 +0100
Subject: [rabbitmq-discuss] RabbitMQ - how do I delete all messages from
	a single queue
In-Reply-To: <AANLkTimVuQnwrOZ+zZVXeEeB95SXjD4ZeUNjY5xN9HZo@mail.gmail.com>
References: <AANLkTimVuQnwrOZ+zZVXeEeB95SXjD4ZeUNjY5xN9HZo@mail.gmail.com>
Message-ID: <256CFEB2-2806-47A6-AE0C-CC9ABCC1099C@gmail.com>

There's a purge command in AMQP.

Check your AMQP library docs, because it varies from library to library.

Cheers,

Alvaro

On Mar 15, 2011, at 3:16 PM, mysurf mail wrote:

> Hi,
> maybe it is a beginners question, but I have a queue and i would like to clean it before I start each time. 
> How do I delete all messages from it? 
> 10x 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From mark.pork at gmail.com  Tue Mar 15 14:19:14 2011
From: mark.pork at gmail.com (butterdave2)
Date: Tue, 15 Mar 2011 07:19:14 -0700 (PDT)
Subject: [rabbitmq-discuss]  Rabbit Shovel Plugin
Message-ID: <31153075.post@talk.nabble.com>


I'm interested in seeing if Shovel can meet some of my messaging
requirements.
On the plugins page, a rabbitmq-shovel-2.3.1.ez is provided. Can I just pop
this into the plugins dir? Or do I have to build it from source?

thanks!

DP
-- 
View this message in context: http://old.nabble.com/Rabbit-Shovel-Plugin-tp31153075p31153075.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From mark.pork at gmail.com  Tue Mar 15 14:19:14 2011
From: mark.pork at gmail.com (butterdave2)
Date: Tue, 15 Mar 2011 07:19:14 -0700 (PDT)
Subject: [rabbitmq-discuss]  Rabbit Shovel Plugin
Message-ID: <31153073.post@talk.nabble.com>


I'm interested in seeing if Shovel can meet some of my messaging
requirements.
On the plugins page, a rabbitmq-shovel-2.3.1.ez is provided. Can I just pop
this into the plugins dir? Or do I have to build it from source?

thanks!

DP
-- 
View this message in context: http://old.nabble.com/Rabbit-Shovel-Plugin-tp31153073p31153073.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From matthew at rabbitmq.com  Tue Mar 15 14:18:57 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 15 Mar 2011 14:18:57 +0000
Subject: [rabbitmq-discuss] RabbitMQ - how do I delete all messages from
 a single queue
In-Reply-To: <AANLkTimVuQnwrOZ+zZVXeEeB95SXjD4ZeUNjY5xN9HZo@mail.gmail.com>
References: <AANLkTimVuQnwrOZ+zZVXeEeB95SXjD4ZeUNjY5xN9HZo@mail.gmail.com>
Message-ID: <20110315141856.GC30443@rabbitmq.com>

On Tue, Mar 15, 2011 at 04:16:51PM +0200, mysurf mail wrote:
> maybe it is a beginners question, but I have a queue and i would like to
> clean it before I start each time.
> How do I delete all messages from it?

queue.purge removes all messages from a queue which are not pending
acknowledgement.

Matthew

From simon at rabbitmq.com  Tue Mar 15 14:19:35 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 15 Mar 2011 14:19:35 +0000
Subject: [rabbitmq-discuss] RabbitMQ - how do I delete all messages from
 a	single queue
In-Reply-To: <AANLkTimVuQnwrOZ+zZVXeEeB95SXjD4ZeUNjY5xN9HZo@mail.gmail.com>
References: <AANLkTimVuQnwrOZ+zZVXeEeB95SXjD4ZeUNjY5xN9HZo@mail.gmail.com>
Message-ID: <4D7F7577.5050303@rabbitmq.com>

On 15/03/11 14:16, mysurf mail wrote:
> maybe it is a beginners question, but I have a queue and i would like to
> clean it before I start each time.
> How do I delete all messages from it?

See queue.purge:

http://www.rabbitmq.com/amqp-0-9-1-quickref.html#queue.purge

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From stammailbox at gmail.com  Tue Mar 15 15:26:42 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Tue, 15 Mar 2011 17:26:42 +0200
Subject: [rabbitmq-discuss] RabbitMQ - how do I delete all messages from
 a single queue
In-Reply-To: <4D7F7577.5050303@rabbitmq.com>
References: <AANLkTimVuQnwrOZ+zZVXeEeB95SXjD4ZeUNjY5xN9HZo@mail.gmail.com>
	<4D7F7577.5050303@rabbitmq.com>
Message-ID: <AANLkTim_zNmTFcO1COizOiPgpvayprzWBWg9Sy8vFYH3@mail.gmail.com>

thank you

On Tue, Mar 15, 2011 at 4:19 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 15/03/11 14:16, mysurf mail wrote:
>
>> maybe it is a beginners question, but I have a queue and i would like to
>> clean it before I start each time.
>> How do I delete all messages from it?
>>
>
> See queue.purge:
>
> http://www.rabbitmq.com/amqp-0-9-1-quickref.html#queue.purge
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110315/fab36647/attachment-0001.htm>

From allen.kim at epicadvertising.com  Tue Mar 15 15:33:03 2011
From: allen.kim at epicadvertising.com (Allen Kim)
Date: Tue, 15 Mar 2011 10:33:03 -0500
Subject: [rabbitmq-discuss] Rabbitmq-Shovel Timer-Based Publishing
 Possible?
In-Reply-To: <4D7F321A.5010502@rabbitmq.com>
Message-ID: <C9A4FBF5.34C5%allen.kim@epicadvertising.com>

Timer-based publish(shovel) means publishing on every seconds or minute
regardless of number of queue stacked.
In our case, if we publish only on based on number of queues, it will
publish very busy during day time and slowly at night.

The worst case that I see is it does not shovel when there is no queue
increasing.
I want queues shovelled every few seconds, guaranteed, so that other
cluser receive messages not too late.

Here I attached the custom shovel that we have used, which does
timer-based publish and queue-based publish both.

Hope you can see the attachment and also, hope I explains well.

Allen Kim


On 11-03-15 5:32 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Allen,
>
>On 11/03/11 15:40, Allen Kim wrote:
>> We are planning to switch to new shovel plugin comes with 2.3.1, and
>> currently testing on it.
>> It works great, but I miss timer-based publish, which is very useful in
>> the midnight with low number of message.
>
>Can you explain what you mean by "timer-based publish" in the context of
>the shovel?
>
>Regards,
>
>Matthias.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_shovel_queue_watcher.erl
Type: application/octet-stream
Size: 6653 bytes
Desc: rabbit_shovel_queue_watcher.erl
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110315/d89fee54/attachment.obj>

From matthias at rabbitmq.com  Tue Mar 15 19:02:33 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 15 Mar 2011 19:02:33 +0000
Subject: [rabbitmq-discuss] Client connect/disconnect events on
 the	server side
In-Reply-To: <4572A3A6-AD57-4F18-B85F-09FF307DF9DE@yahoo-inc.com>
References: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>
	<4D7E5C9B.8070901@rabbitmq.com>
	<AANLkTikAB8K0kaNku0i4AgY42_tu0egM2kPS=5BsW++W@mail.gmail.com>
	<4D7E6FFF.9080602@rabbitmq.com>
	<AANLkTimPGYp-G9WD5Hn-wWqpud2oQoqx8Xw_vy5HiyDA@mail.gmail.com>
	<4D7E7DAB.2060000@rabbitmq.com>
	<AANLkTikZ28MVSJDWz9yUcDZyhvsjEg7ms7VW+ZfiaVi2@mail.gmail.com>
	<4572A3A6-AD57-4F18-B85F-09FF307DF9DE@yahoo-inc.com>
Message-ID: <4D7FB7C9.8010205@rabbitmq.com>

On 15/03/11 04:31, Deepak Vijayvergiy wrote:
> Hi Miguel,
> Even I have the same scenario, and I have my clients
> announcing(publishing) their connect and disconnect at the time of
> log-in and log-off resp. I have a deamon process running which is a pure
> consumer listening on 'register.*'.
> Would be interested to know if some better way exists.

'presence' is a highly application dependent concept. Support for it in 
the messaging system itself could only accommodate a very restricted set 
of use cases. So it's best handled by applications.

One fairly generic and flexible way is to get clients to publish a 
presence message every so often to some dedicated exchange. That message 
can contain all kinds of application specific information, e.g. to 
identify the user, what their status is, etc. An app can then consume 
these messages, update some db with status information, send status 
change messages to clients interested and authorised to see them (e.g. 
'friends'). The app can also detect the absence of the messages and mark 
the user as absent.

In this scheme

- the notion of presence is not tied to the lifetime of connections, or 
queues, or bindings

- the notion of users (or, more generally, 'the things of which we want 
to know the presence') is not tied to that of AMQP users

- presence can be more than just a flag, i.e. all kinds of complex 
status information can be transmitted


Regards,

Matthias.

From therevoltingx at gmail.com  Tue Mar 15 19:44:12 2011
From: therevoltingx at gmail.com (Miguel Morales)
Date: Tue, 15 Mar 2011 12:44:12 -0700
Subject: [rabbitmq-discuss] Client connect/disconnect events on the
	server side
In-Reply-To: <4D7FB7C9.8010205@rabbitmq.com>
References: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>
	<4D7E5C9B.8070901@rabbitmq.com>
	<AANLkTikAB8K0kaNku0i4AgY42_tu0egM2kPS=5BsW++W@mail.gmail.com>
	<4D7E6FFF.9080602@rabbitmq.com>
	<AANLkTimPGYp-G9WD5Hn-wWqpud2oQoqx8Xw_vy5HiyDA@mail.gmail.com>
	<4D7E7DAB.2060000@rabbitmq.com>
	<AANLkTikZ28MVSJDWz9yUcDZyhvsjEg7ms7VW+ZfiaVi2@mail.gmail.com>
	<4572A3A6-AD57-4F18-B85F-09FF307DF9DE@yahoo-inc.com>
	<4D7FB7C9.8010205@rabbitmq.com>
Message-ID: <AANLkTinTU9ryoTrGHs1cRHAhbvVB8Hzh1dxm3WTe+Gyr@mail.gmail.com>

> 'presence' is a highly application dependent concept. Support for it in the
> messaging system itself could only accommodate a very restricted set of use
> cases. So it's best handled by applications.
>
>
Yeah, definetly.  It would be *kind of* cool to have that built into
rabbitmq but not a necessity by any means.  There are several points where
one may want to hook into such as when the connection happens, when a bind
has been made, etc.


> One fairly generic and flexible way is to get clients to publish a presence
> message every so often to some dedicated exchange. That message can contain
> all kinds of application specific information, e.g. to identify the user,
> what their status is, etc. An app can then consume these messages, update
> some db with status information, send status change messages to clients
> interested and authorised to see them (e.g. 'friends'). The app can also
> detect the absence of the messages and mark the user as absent.
>
>
Yeah, this was the road I was heading toward.  In my use case this is fine.
 However, I think that it might be difficult for an app that doesn't require
the client to publish any messages in order to be active.  For example, in a
cell phone where one wants to send the least amount of data but still wants
to receive any small messages from the server.
Also, if one wants to detect absence as soon as possible.  The client would
have to rapidly be transmitting status packets.

The other option would be to map the users by their ip and detect events via
a tcp proxy as you suggested earlier.

In this scheme
>
> - the notion of presence is not tied to the lifetime of connections, or
> queues, or bindings
>
> - the notion of users (or, more generally, 'the things of which we want to
> know the presence') is not tied to that of AMQP users
>
> - presence can be more than just a flag, i.e. all kinds of complex status
> information can be transmitted
>
>
I think this is a fundamental flaw in my setup is that clients are tied to
users.
But even is a single user scheme is implemented, it would still be difficult
to detect when clients connect/disconnect in real time.  I'm probably
missing something though.

The way I'm going to detect this is by having the client have another tcp
socket connection open to another port on my server.  Then a server side app
that listens on that port can detect if the client connected/disconnected at
the socket level.  (It uses the same credentials as the rabbitmq server so
the client has to 'log-in' to both services.)

Thanks for your help,
Miguel.


> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
~ Jeremiah:9:23-24
Android 2D MMORPG: http://solrpg.com/ http://www.youtube.com/user/revoltingx
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110315/4c9e048c/attachment.htm>

From br at versly.com  Tue Mar 15 20:05:10 2011
From: br at versly.com (Benjamin Renaud)
Date: Tue, 15 Mar 2011 13:05:10 -0700
Subject: [rabbitmq-discuss] Client connect/disconnect events on the
	server side
In-Reply-To: <4D7FB7C9.8010205@rabbitmq.com>
References: <AANLkTimVx5SG==W3T=yb8kt5eUhGm=XuBhWs_HMBm5L3@mail.gmail.com>
	<4D7E5C9B.8070901@rabbitmq.com>
	<AANLkTikAB8K0kaNku0i4AgY42_tu0egM2kPS=5BsW++W@mail.gmail.com>
	<4D7E6FFF.9080602@rabbitmq.com>
	<AANLkTimPGYp-G9WD5Hn-wWqpud2oQoqx8Xw_vy5HiyDA@mail.gmail.com>
	<4D7E7DAB.2060000@rabbitmq.com>
	<AANLkTikZ28MVSJDWz9yUcDZyhvsjEg7ms7VW+ZfiaVi2@mail.gmail.com>
	<4572A3A6-AD57-4F18-B85F-09FF307DF9DE@yahoo-inc.com>
	<4D7FB7C9.8010205@rabbitmq.com>
Message-ID: <AANLkTi=3tj1wmEx0XH0viLugRAAGzYF4sinv79uBVZ8N@mail.gmail.com>

Hi Matthias,

Yes presence is a very application-specific bit of information.

Being notified of when a client connects or disconnect (even if rabbit
tries to auto-reconnect or other nice features under the covers) would
help application developers develop their own notion of presence.

In other words, rabbit is the one persistent connection we have to our
clients. When the rabbit connection disconnects or reconnects, Rabbit
is the only bit of software with that information.

Without having Rabbit interpret that information (let me do the
interpreting) it would be great to just know the information.

Benjamin

On Tue, Mar 15, 2011 at 12:02 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> On 15/03/11 04:31, Deepak Vijayvergiy wrote:
>>
>> Hi Miguel,
>> Even I have the same scenario, and I have my clients
>> announcing(publishing) their connect and disconnect at the time of
>> log-in and log-off resp. I have a deamon process running which is a pure
>> consumer listening on 'register.*'.
>> Would be interested to know if some better way exists.
>
> 'presence' is a highly application dependent concept. Support for it in the
> messaging system itself could only accommodate a very restricted set of use
> cases. So it's best handled by applications.
>
> One fairly generic and flexible way is to get clients to publish a presence
> message every so often to some dedicated exchange. That message can contain
> all kinds of application specific information, e.g. to identify the user,
> what their status is, etc. An app can then consume these messages, update
> some db with status information, send status change messages to clients
> interested and authorised to see them (e.g. 'friends'). The app can also
> detect the absence of the messages and mark the user as absent.
>
> In this scheme
>
> - the notion of presence is not tied to the lifetime of connections, or
> queues, or bindings
>
> - the notion of users (or, more generally, 'the things of which we want to
> know the presence') is not tied to that of AMQP users
>
> - presence can be more than just a flag, i.e. all kinds of complex status
> information can be transmitted
>
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
ben renaud
versly.com
br at versly.com

From taylste at gmail.com  Tue Mar 15 20:31:07 2011
From: taylste at gmail.com (Steven Taylor)
Date: Tue, 15 Mar 2011 20:31:07 +0000
Subject: [rabbitmq-discuss] Subscription Pattern in .net
In-Reply-To: <4D7F64E0.8060505@rabbitmq.com>
References: <AANLkTim=9nDjV9UVmudcC3dh4XdK9DjHT5uLiUHew6-M@mail.gmail.com>
	<4D7F64E0.8060505@rabbitmq.com>
Message-ID: <AANLkTin9q7ArdVAcLjmtUN3o5LYPzfRYobor-5m4CcTw@mail.gmail.com>

>
>  IEnumerator.MoveNext() currently waits an indefinite amount of time until
>> a message arrives. If I understand correctly, you want a version of with a
>> timeout, supplied in the constructor.
>>
>> Would the enumeration need to be restartable? You may need a different
>> implementation of Reset() in that case and this substantially changes the
>> semantics of Subscription. I'm not sure how well this fits with IEnumerator.
>> Your use-case appears to be reading messages until a large gap appears
>> between message. At first glance that looks insufficiently general to
>> justify changing the IEnumerator implementation.
>>
>> The Next(TimeOut,out Msg) method was intended to meet your needs if you
>> want a timeout. The example you provided using this looks fine.
>
>
The goal was finer-grained control, while trying to hide detail.  This is
slightly unrelated, but it looks to me as though there are a few rough edges
we could sand back.  e.g. channel has a "CreateBasicProperties" method that
we can use in BasicPublish.  No big deal, but BasicPublish could have an
overload which creates its own properties, as this method knows its context
already (i.e. the method is in Channel, so go create your own basic
properties, basicPublish!!)

No reset required for the enumerator.

The context is: A. send off a bunch of messages asynchronously, and B. wait
for a reply.  C. If messages don't turn up in a reasonable period of time,
stop waiting.  If the messages do turn up, good, continue.  In essence, I'm
replicating the "Join" that you use after threading off a list of tasks, but
via messaging.

I know there are heavier-duty implementations such as remote method
invocation over RabbitMQ, but this approach seemed simpler to me.  Perhaps a
whole new pattern should be created for this need.  At the moment I'm using
the slightly less elegant method that you mentioned.  It doesn't really get
in the way that much.  However, being in a community that has helped out, I
thought, hmmm... maybe i could at least return the favour in a small way.



>
> So what is the policy on updating the Mercurial repository?
>>
>
> You could also fork our github repository here:
> https://github.com/rabbitmq/rabbitmq-dotnet-client
> This would be a way of building consensus for your proposal.
>
> Code that you contribute that does get accepted in the main mercurial
> repository will need a signed contributor agreement.
>
>
> Regards
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110315/1dfbb1b9/attachment.htm>

From irrer at umich.edu  Tue Mar 15 23:00:28 2011
From: irrer at umich.edu (Jim Irrer)
Date: Tue, 15 Mar 2011 19:00:28 -0400
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development guide
	example
In-Reply-To: <AANLkTimrO50n6Wr+E19+HwR2JPMsSRDGiFwgnW2QM0q8@mail.gmail.com>
References: <AANLkTincy5uC=PN=CBnBBX_W6Q4gxFU1JwOaVCyE2OEq@mail.gmail.com>
	<20101020000140.GA28186@wellquite.org>
	<AANLkTi=PMzkFzuBjN4nNF7QDnKS7S0eE2HqHqiCr=-sc@mail.gmail.com>
	<AANLkTimrO50n6Wr+E19+HwR2JPMsSRDGiFwgnW2QM0q8@mail.gmail.com>
Message-ID: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>

If I checkout the latest server code, will I get the bug23274 fix?

If not, what is the Mercurial command to get it?

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


---------- Forwarded message ----------
From: Alexis Richardson <alexis at rabbitmq.com>
Date: Wed, Oct 20, 2010 at 6:00 AM
Subject: Re: [rabbitmq-discuss] Problem with plugin development guide
example
To: Tim Pizey <timp at paneris.org>
Cc: rabbitmq-discuss at lists.rabbitmq.com


Tim,

Hello :-)

On Wed, Oct 20, 2010 at 9:47 AM, Tim Pizey <timp at paneris.org> wrote:
>
> Thank you for your rapid reply.
>
> However, I have wasted 2 hours in self-doubt and error;
> how difficult is it to update an introductory document,
> and to put its content into a CI environment  so that
> someone notices when it breaks?

I'm sorry you had a bad experience.  We are working as hard as we can
on multiple fronts ranging from better HA to better docs.  The answer
to your question is that it *is* difficult to do that because we don't
have a CI environment right now.  Yes, it would help in lots of ways
to have one!


> My actual objective is to get rabbithub running, but I thought
> I would do the "Hello world" exercise as a warm up, never having
> used this tool chain before.

Mike, cc'd, may be able to give you some pointers on RabbitHub..

alexis



> thanks for the reply
> Tim
>
>
>
>
> --
> Tim Pizey
> http://pizey.net/~timp
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110315/6fb53ed9/attachment.htm>

From lucasas at gmail.com  Tue Mar 15 21:34:16 2011
From: lucasas at gmail.com (Lucas Souza)
Date: Tue, 15 Mar 2011 14:34:16 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java library
Message-ID: <384fba16-a405-45a8-bbcc-6e016162ea9a@s18g2000prg.googlegroups.com>

Hi everybody...

How can I connect in a cluster using Java client library?


From yaohui1984 at qq.com  Wed Mar 16 03:31:11 2011
From: yaohui1984 at qq.com (=?ISO-8859-1?B?eWFvaHVp?=)
Date: Wed, 16 Mar 2011 11:31:11 +0800
Subject: [rabbitmq-discuss] |Spam|  |Spam| Rabbitmq performence test
Message-ID: <tencent_79666A147BC926DE6BD9E042@qq.com>

>>On Tue, Mar 15, 2011 at 08:50:43AM +0800, yaohui wrote:
>>    I do a performence test on my machine using java client with the script runperftest.sh , the message rate is only 4500msg/s. 
>>   cpu  4 core 3.0G
>>   memory 4G 

>runperftest.sh does not attempt to run balanced tests. They merely exist
>to measure changes between releases. If you construct a more balanced
>test (i.e. ingress and egress rates are equal) with something like
>MulticastMain, then you should be able to get much higher throughput.

>Matthew
  
 thanks , but the resuslt of MulticastMain is the same. is that the highest throughput?
  
 $ ./runjava.sh com.rabbitmq.examples.MulticastMain 
starting consumer #0
starting producer #0
recving rate: 1862 msg/s, min/avg/max latency: 10404/223044/312928 microseconds
sending rate: 2682 msg/s, basic returns: 0 ret/s
recving rate: 2538 msg/s, min/avg/max latency: 1929/32845/178580 microseconds
sending rate: 2561 msg/s, basic returns: 0 ret/s
recving rate: 3708 msg/s, min/avg/max latency: 1416/6034/20017 microseconds
sending rate: 3872 msg/s, basic returns: 0 ret/s
recving rate: 2914 msg/s, min/avg/max latency: 1715/24759/146310 microseconds
sending rate: 3534 msg/s, basic returns: 0 ret/s
recving rate: 4946 msg/s, min/avg/max latency: 37165/102972/165359 microseconds
sending rate: 4593 msg/s, basic returns: 0 ret/s
recving rate: 4668 msg/s, min/avg/max latency: 1344/7352/41319 microseconds
sending rate: 4506 msg/s, basic returns: 0 ret/s
recving rate: 4601 msg/s, min/avg/max latency: 1594/5973/20759 microseconds
sending rate: 4699 msg/s, basic returns: 0 ret/s
recving rate: 4706 msg/s, min/avg/max latency: 1750/9571/47925 microseconds
sending rate: 4604 msg/s, basic returns: 0 ret/s
recving rate: 4558 msg/s, min/avg/max latency: 1128/9604/63932 microseconds
sending rate: 4577 msg/s, basic returns: 0 ret/s
recving rate: 4459 msg/s, min/avg/max latency: 1849/16323/65218 microseconds
sending rate: 4465 msg/s, basic returns: 0 ret/s
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110316/015be660/attachment.htm>

From emile at rabbitmq.com  Wed Mar 16 09:43:19 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 16 Mar 2011 09:43:19 +0000
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
 library
In-Reply-To: <384fba16-a405-45a8-bbcc-6e016162ea9a@s18g2000prg.googlegroups.com>
References: <384fba16-a405-45a8-bbcc-6e016162ea9a@s18g2000prg.googlegroups.com>
Message-ID: <4D808637.3080609@rabbitmq.com>

Hi Lucas,

On 15/03/11 21:34, Lucas Souza wrote:
> Hi everybody...
>
> How can I connect in a cluster using Java client library?

A rabbit client (including the Java client) will work unchanged whether 
connecting to single or a clustered broker. When connecting to a 
cluster, it makes little difference which node in the cluster a client 
connects to (except for queue declarations).

You should take a look at the clustering guide for instructions on how 
to set up a cluster using the rabbitmqctl commandline utility:
http://www.rabbitmq.com/clustering.html

Regards

Emile


From edp at micro-p.com  Wed Mar 16 10:00:23 2011
From: edp at micro-p.com (Ed Pursey)
Date: Wed, 16 Mar 2011 10:00:23 +0000
Subject: [rabbitmq-discuss] Oracle ERP
Message-ID: <9FB2809E61882943BDDDF088FBFA1876026BCD@ma-ex-01.micro-p.com>

Hi,

Is there anybody out there who has used RabbitMQ to handle the communication between a website and an Oracle ERP solution? If so, I would really appreciate some feedback on your experiences.

With regards,

Ed

Ed Pursey
Oracle Development Manager
E:ed.pursey at micro-p.com
P: 01282 776776
W: http://www.micro-p.com
Micro Peripherals Limited.
Registered Office: Shorten Brook Way, Altham Business Park, Altham,
Accrington, Lancs.  BB5 5YJ.  Tel: (01282) 776776   Fax: (01282) 770001
Micro Peripherals Limited. Registered in England No. 11511931. VAT No. GB 864 4387 91
---------------------------------------------------------------------------------------------------------------------------
DISCLAIMER:
This e-mail and attachments are confidential and are intended solely for the use of the individual to
whom it is addressed. Any views or opinions presented are solely those of the author and do not
necessarily represent those of Micro Peripherals Limited.
If you are not the intended recipient, be advised that you have received this Email in error and that
any use, dissemination, forwarding, printing, or copying of this Email is strictly prohibited. If this
transmission is received in error please notify the sender immediately and delete this message from
your E-mail system.
All electronic transmissions to and from Micro Peripherals Ltd are recorded and may be monitored.
---------------------------------------------------------------------------------------------------------------------------

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110316/7dc125bd/attachment.htm>

From matthew at rabbitmq.com  Wed Mar 16 10:01:31 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 16 Mar 2011 10:01:31 +0000
Subject: [rabbitmq-discuss] |Spam|  |Spam| Rabbitmq performence test
In-Reply-To: <tencent_79666A147BC926DE6BD9E042@qq.com>
References: <tencent_79666A147BC926DE6BD9E042@qq.com>
Message-ID: <20110316100131.GB12427@wellquite.org>

On Wed, Mar 16, 2011 at 11:31:11AM +0800, yaohui wrote:
> >>On Tue, Mar 15, 2011 at 08:50:43AM +0800, yaohui wrote:
> >>    I do a performence test on my machine using java client with the script runperftest.sh , the message rate is only 4500msg/s. 
> >>   cpu  4 core 3.0G
> >>   memory 4G 
> 
> >runperftest.sh does not attempt to run balanced tests. They merely exist
> >to measure changes between releases. If you construct a more balanced
> >test (i.e. ingress and egress rates are equal) with something like
> >MulticastMain, then you should be able to get much higher throughput.
>   
>  thanks , but the resuslt of MulticastMain is the same. is that the highest throughput?

MulticastMain takes many options, and should be carefully adjusted to
match the performance of your system. The fact that in your run, latency
does not increase suggests that Rabbit is not overloaded, but MCM is
not able to publish messages as fast as it should be able to.

For example on my desktop at home (Q9450 @ 2.6GHz, 4GB, 2.6.32), I get:

> sh build/dist/runjava.sh com.rabbitmq.examples.MulticastMain 
starting consumer #0
starting producer #0
recving rate: 1785 msg/s, min/avg/max latency: 1442/29312/60038 microseconds
sending rate: 26664 msg/s
recving rate: 10155 msg/s, min/avg/max latency: 52340/300171/615841 microseconds
sending rate: 24188 msg/s
recving rate: 14501 msg/s, min/avg/max latency: 614822/986783/1240903 microseconds

I.e. the sending rate is too high, so latency increases rapidly. If I
limit that, I can get it stable at 16.5kHz:

> sh build/dist/runjava.sh com.rabbitmq.examples.MulticastMain -r 16500
starting consumer #0
starting producer #0
recving rate: 9004 msg/s, min/avg/max latency: 347/173694/338583 microseconds
sending rate: 16501 msg/s
recving rate: 14708 msg/s, min/avg/max latency: 332890/419962/452755 microseconds
sending rate: 16501 msg/s
recving rate: 16891 msg/s, min/avg/max latency: 416239/432187/445180 microseconds
sending rate: 16501 msg/s
recving rate: 16645 msg/s, min/avg/max latency: 392858/405681/419339 microseconds
sending rate: 16501 msg/s
recving rate: 16741 msg/s, min/avg/max latency: 393234/414833/431492 microseconds
sending rate: 16501 msg/s

Note how after an initial spike, the receiving rate stays consistently
above the sending rate and the latency starts to drop.

Finally, if I add -a to stop the consumer having to send back acks:

> sh build/dist/runjava.sh com.rabbitmq.examples.MulticastMain -r 24000 -a
starting consumer #0
starting producer #0
recving rate: 12173 msg/s, min/avg/max latency: 377/151754/325200 microseconds
sending rate: 24000 msg/s
recving rate: 25855 msg/s, min/avg/max latency: 294027/343956/388849 microseconds
sending rate: 23977 msg/s
recving rate: 26798 msg/s, min/avg/max latency: 176395/222305/295340 microseconds
sending rate: 23977 msg/s
recving rate: 27465 msg/s, min/avg/max latency: 31190/111042/178470 microseconds
sending rate: 23977 msg/s
recving rate: 24411 msg/s, min/avg/max latency: 1926/13614/32481 microseconds
sending rate: 24000 msg/s
recving rate: 24126 msg/s, min/avg/max latency: 2419/8967/18779 microseconds
sending rate: 23984 msg/s

It's stable at 24kHz. It's actually stable at just below 25kHz, but the
trace is much longer to show that. Finally, if I do multiple consumers,
the outbound rates multiply so you can get silly numbers:

> sh build/dist/runjava.sh com.rabbitmq.examples.MulticastMain -r 4800 -a -e e -t fanout -y 10
starting consumer #0
starting consumer #1
starting consumer #2
starting consumer #3
starting consumer #4
starting consumer #5
starting consumer #6
starting consumer #7
starting consumer #8
starting consumer #9
starting producer #0
recving rate: 19908 msg/s, min/avg/max latency: 374/213387/449689 microseconds
sending rate: 4801 msg/s
recving rate: 43505 msg/s, min/avg/max latency: 159054/457996/891523 microseconds
sending rate: 4801 msg/s
recving rate: 48327 msg/s, min/avg/max latency: 133656/460732/1393276 microseconds
sending rate: 4796 msg/s
recving rate: 49496 msg/s, min/avg/max latency: 105081/409588/1873754 microseconds
sending rate: 4801 msg/s
recving rate: 51456 msg/s, min/avg/max latency: 100556/388283/2161097 microseconds
sending rate: 4801 msg/s
recving rate: 50709 msg/s, min/avg/max latency: 12505/458151/2138811 microseconds
sending rate: 4801 msg/s
recving rate: 47776 msg/s, min/avg/max latency: 2074/365075/1354416 microseconds
sending rate: 4801 msg/s
recving rate: 48505 msg/s, min/avg/max latency: 23075/354988/964308 microseconds
sending rate: 4801 msg/s
recving rate: 48564 msg/s, min/avg/max latency: 7803/307815/625464 microseconds
sending rate: 4801 msg/s

Now, we never quote these numbers because they're incredibly misleading
if you just generally say "Rabbit can do 50kHz". It can, but in this
case, in a 1-in 10-out scenario. In a 1-in, 1-out, it can't do 50kHz.

Anywho, I don't know why you're not geting the same performance figures.

I'm not really sure where to start looking to tune things. Probably try
to use various system monitoring tools to try to figure out where the
bottlenecks are.

Matthew

From alexis at rabbitmq.com  Wed Mar 16 10:12:58 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 16 Mar 2011 10:12:58 +0000
Subject: [rabbitmq-discuss] Oracle ERP
In-Reply-To: <9FB2809E61882943BDDDF088FBFA1876026BCD@ma-ex-01.micro-p.com>
References: <9FB2809E61882943BDDDF088FBFA1876026BCD@ma-ex-01.micro-p.com>
Message-ID: <AANLkTik-kBQSwDHgbKE78Fqq7niA3Qt3ZxmXw43o9xG_@mail.gmail.com>

Ed,

The short answer is "yes" but the customers with this use case may not
be on the list.

I'll follow up privately.

alexis

On Wed, Mar 16, 2011 at 10:00 AM, Ed Pursey <edp at micro-p.com> wrote:
> Hi,
>
>
>
> Is there anybody out there who has used RabbitMQ to handle the communication
> between a website and an Oracle ERP solution? If so, I would really
> appreciate some feedback on your experiences.
>
>
>
> With regards,
>
>
>
> Ed
>
>
>
> Ed Pursey
> Oracle Development Manager
>
> E:ed.pursey at micro-p.com
> P: 01282 776776
> W: http://www.micro-p.com
>
> Micro Peripherals Limited.
> Registered Office: Shorten Brook Way, Altham Business Park, Altham,
> Accrington, Lancs.? BB5 5YJ.? Tel: (01282) 776776?? Fax: (01282) 770001
> Micro Peripherals Limited. Registered in England No. 11511931. VAT No. GB
> 864 4387 91
>
> ---------------------------------------------------------------------------------------------------------------------------
> DISCLAIMER:
> This e-mail and attachments are confidential and are intended solely for the
> use of the individual to
> whom it is addressed. Any views or opinions presented are solely those of
> the author and do not
> necessarily represent those of Micro Peripherals Limited.
> If you are not the intended recipient, be advised that you have received
> this Email in error and that
> any use, dissemination, forwarding, printing, or copying of this Email is
> strictly prohibited. If this
> transmission is received in error please notify the sender immediately and
> delete this message from
> your E-mail system.
> All electronic transmissions to and from Micro Peripherals Ltd are recorded
> and may be monitored.
> ---------------------------------------------------------------------------------------------------------------------------
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From emile at rabbitmq.com  Wed Mar 16 10:23:28 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 16 Mar 2011 10:23:28 +0000
Subject: [rabbitmq-discuss] Subscription Pattern in .net
In-Reply-To: <AANLkTin9q7ArdVAcLjmtUN3o5LYPzfRYobor-5m4CcTw@mail.gmail.com>
References: <AANLkTim=9nDjV9UVmudcC3dh4XdK9DjHT5uLiUHew6-M@mail.gmail.com>	<4D7F64E0.8060505@rabbitmq.com>
	<AANLkTin9q7ArdVAcLjmtUN3o5LYPzfRYobor-5m4CcTw@mail.gmail.com>
Message-ID: <4D808FA0.1080208@rabbitmq.com>

Hi Steven,

On 15/03/11 20:31, Steven Taylor wrote:
> This
> is slightly unrelated, but it looks to me as though there are a few
> rough edges we could sand back.  e.g. channel has a
> "CreateBasicProperties" method that we can use in BasicPublish.  No big
> deal, but BasicPublish could have an overload which creates its own
> properties, as this method knows its context already (i.e. the method is
> in Channel, so go create your own basic properties, basicPublish!!)

That would be similar to supplying null properties. So far there has 
been insufficient demand for an overloaded publish method, because it is 
simple enough to supply null properties.

> No reset required for the enumerator.

I agree that it makes no sense to reset a subscription, but the 
enumerator is useless after MoveNext returns false without a Reset(), 
according to the IEnumerator documentation.

> The context is: A. send off a bunch of messages asynchronously, and B.
> wait for a reply.  C. If messages don't turn up in a reasonable period
> of time, stop waiting.

What is the state of the enumerator at this point? Should it be 
considered "irrecoverably invalidated" as the docs suggests? Does it 
make sense for a gap between messages to invalidate the enumeration in 
this way?

Your use-case is not general enough justify changes to the Subscription 
class. If there is sufficient demand then we will gladly reconsider your 
proposal, but perhaps under a different name or in a different class.

> However, being in a
> community that has helped out, I thought, hmmm... maybe i could at least
> return the favour in a small way.

Thanks for the feedback. We appreciate the suggestions. It is through 
suggestions like yours that rabbit continues to evolve.



Regards

Emile

From matthew at rabbitmq.com  Wed Mar 16 10:49:57 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 16 Mar 2011 10:49:57 +0000
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <486630.9133.qm@web31810.mail.mud.yahoo.com>
References: <486630.9133.qm@web31810.mail.mud.yahoo.com>
Message-ID: <20110316104957.GC12427@wellquite.org>

Hi Alex,

On Thu, Mar 10, 2011 at 09:48:08PM -0800, alex chen wrote:
> I am testing rabbit server with SSD.  The broker process would crash when many 
> consumers start to consume backed up messages.  Because SSD if very fast, the 
> consuming rate reached more than 200 MB/sec.  After several minutes, the broker 
> process would use all cpu resources (800% on 8 cores) and crash.

I test all the time on an Intel G2 drive. I've never seen it cause a
crash, even in scenarios such as yours. Furthermore, I find it somewhat
unlikely that if the server process did die, it didn't spit out any sort
of error on its way out. There must be /something/ somewhere that
suggests a bit more as to what went wrong, whether it's in syslog, or
dmesg, or rabbit's various logs.

I did however yesterday find and fix a bug where inexplicably a function
that normally takes about 0.5s ended up in some very strange cases
taking > 80s. After a lot of head scratching and debugging, I never
understood why this variance existed. However, I rewrote the function
and it's now much faster all the time. This particular bug has been
through QA and is now on default and should be in the next release, thus
if you want to try compiling from default and repeating your test, we'd
be interested in knowing whether you see any change.

Matthew

From majek04 at gmail.com  Wed Mar 16 11:56:30 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 16 Mar 2011 11:56:30 +0000
Subject: [rabbitmq-discuss] Performance and scalability measurement with
 my publisher-subscriber clients testing
In-Reply-To: <4583DF6A-62EA-41BC-9FAD-F98F3BF314CD@yahoo-inc.com>
References: <AcveRISVNcBMF0dvR9KlizGOkO8LTg==>
	<4583DF6A-62EA-41BC-9FAD-F98F3BF314CD@yahoo-inc.com>
Message-ID: <AANLkTikv0PsureszEvNgCv+OVYgz559VmFzHcLDEc78c@mail.gmail.com>

On Wed, Mar 9, 2011 at 10:26, Deepak Vijayvergiy <vdeepak at yahoo-inc.com> wrote:
> I have created the framework for publisher-subscriber and created publisher and consumer clients for basic testing as well. Now, I also want to test the performance as well, as in, I want to give the numbers like -
> (1) How many messages, my publisher client will be able to publish per second or rate?
> (2) How many messages my consumer will be able to consume (per second) .. rate? (a) with messages already in the queue (b) parallely publishing as well
>
> Earlier I have tried doing same by some time functions before and after 1 and last mess respectively, but I don't think that was a proper way. Please let me know if you have done the same measurement?

We do have a tool for doing simple measurements, see MulticastMain
in our java client.  Sample usage:
   http://www.rabbitmq.com/ec2.html#testing
(dig the mailing list archives for more examples)

Doing benchmarks properly, even as simple as you described, is pretty hard.

With 1) you will measure performance of the client. Unless you're using
publisher-acks.

2) It all depends, if data in-memory or on the disk, is it cached by the OS,
how big is the queue, how many queues are handled by rabbit and so on.

2b) That one is quite interesting, but you have to be very careful to keep
the queue balanced. Publishing is usually faster than consuming.

Rabbit is not a rocket science and there are some significant bottlenecks.
If you start swapping to disk or if you use persistent messages -
things will be much slower.

Usually the best approach is to test the whole solution end-to-end
rather than focusing on dry RabbitMQ benchmarks. That way you can
be sure that the numbers actually mean something you're interested
in. Raw benchmarks like publishes/sec or consumes/sec doesn't
say anything useful.

Cheers,
  Marek

From vdeepak at yahoo-inc.com  Wed Mar 16 12:06:28 2011
From: vdeepak at yahoo-inc.com (Deepak Vijayvergiy)
Date: Wed, 16 Mar 2011 17:36:28 +0530
Subject: [rabbitmq-discuss] Performance and scalability measurement with
 my publisher-subscriber clients testing
In-Reply-To: <AANLkTikv0PsureszEvNgCv+OVYgz559VmFzHcLDEc78c@mail.gmail.com>
References: <AcveRISVNcBMF0dvR9KlizGOkO8LTg==>
	<4583DF6A-62EA-41BC-9FAD-F98F3BF314CD@yahoo-inc.com>
	<AANLkTikv0PsureszEvNgCv+OVYgz559VmFzHcLDEc78c@mail.gmail.com>
Message-ID: <D74E9E6B-16C5-4E5B-88AC-F7751273F397@yahoo-inc.com>

Thanks Marek for the good points.
I am thinking of having 1 publisher and a few consumers consuming from the same queue, so that I don't get queue full (as publisher will be faster than subscriber).
In that scenario, I will try to publish messages continuously and see the rate of publisher as well as consumer, and while mentioning the performance numbers, will give the setup details as well.

Also, another question regarding the rabbitmq queue space, I see that its limited to 1.58 GB, is that the size on the  disk by default or its the RAM size?
How shall I configure it if I want to increase it?

Thanks
Regards
Deepak

On Mar 16, 2011, at 5:26 PM, Marek Majkowski wrote:

> On Wed, Mar 9, 2011 at 10:26, Deepak Vijayvergiy <vdeepak at yahoo-inc.com> wrote:
>> I have created the framework for publisher-subscriber and created publisher and consumer clients for basic testing as well. Now, I also want to test the performance as well, as in, I want to give the numbers like -
>> (1) How many messages, my publisher client will be able to publish per second or rate?
>> (2) How many messages my consumer will be able to consume (per second) .. rate? (a) with messages already in the queue (b) parallely publishing as well
>> 
>> Earlier I have tried doing same by some time functions before and after 1 and last mess respectively, but I don't think that was a proper way. Please let me know if you have done the same measurement?
> 
> We do have a tool for doing simple measurements, see MulticastMain
> in our java client.  Sample usage:
>   http://www.rabbitmq.com/ec2.html#testing
> (dig the mailing list archives for more examples)
> 
> Doing benchmarks properly, even as simple as you described, is pretty hard.
> 
> With 1) you will measure performance of the client. Unless you're using
> publisher-acks.
> 
> 2) It all depends, if data in-memory or on the disk, is it cached by the OS,
> how big is the queue, how many queues are handled by rabbit and so on.
> 
> 2b) That one is quite interesting, but you have to be very careful to keep
> the queue balanced. Publishing is usually faster than consuming.
> 
> Rabbit is not a rocket science and there are some significant bottlenecks.
> If you start swapping to disk or if you use persistent messages -
> things will be much slower.
> 
> Usually the best approach is to test the whole solution end-to-end
> rather than focusing on dry RabbitMQ benchmarks. That way you can
> be sure that the numbers actually mean something you're interested
> in. Raw benchmarks like publishes/sec or consumes/sec doesn't
> say anything useful.
> 
> Cheers,
>  Marek


From alexandru at rabbitmq.com  Wed Mar 16 12:16:53 2011
From: alexandru at rabbitmq.com (Alexandru Scvor??ov)
Date: Wed, 16 Mar 2011 12:16:53 +0000
Subject: [rabbitmq-discuss] rabbitmq-server init script
In-Reply-To: <85c27985-2592-418d-b160-fa713a31f2fd@11g2000prf.googlegroups.com>
References: <20110309135151.GA14426@dakota.eng.vmware.com>
	<14035820.548.1299696932953.JavaMail.geo-discussion-forums@prfc6>
	<20110309211242.GA2355@dakota.doc.ic.ac.uk>
	<85c27985-2592-418d-b160-fa713a31f2fd@11g2000prf.googlegroups.com>
Message-ID: <20110316121653.GA17092@dakota.eng.vmware.com>

Hi,

> just a note - the init script sets USER, but never uses the var
> anywhere in the script.

You're right about USER.  We don't use it anywhere.

> had a recurring issue with rabbitmq failing to
> start after a reboot (centOS). merely adding the following after all
> the vars are declared fixes the issue:
> 
> chown -R $USER:$USER $INIT_LOG_DIR

That's interesting.  Did you add some code to run rabbitmq as non-root?

What is your INIT_LOG_DIR? (did you change it to a location that gets
wiped on restart?)

I see we don't automatically `mkdir $INIT_LOG_DIR` in the init script.
How are you creating it?

Cheers,
Alex

On Mon, Mar 14, 2011 at 09:27:52PM -0700, paul wrote:
> just a note - the init script sets USER, but never uses the var
> anywhere in the script. had a recurring issue with rabbitmq failing to
> start after a reboot (centOS). merely adding the following after all
> the vars are declared fixes the issue:
> 
> chown -R $USER:$USER $INIT_LOG_DIR
> 
> should probably be folded into the script...
> 
> On Mar 9, 2:12?pm, Alexandru Scvortov <alexan... at rabbitmq.com> wrote:
> > Ah, no. ?That directory is in our source tree, but isn't included in the
> > source distribution. ?Here's the 2.3.1 one:
> > ?http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_3_1/packaging...
> >
> > Cheers,
> > Alex
> >
> > On Wed, Mar 09, 2011 at 10:55:32AM -0800, Nite wrote:
> > > Weird, my build does not have a package directory.
> > > Do I have to give any special build parameters?
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From majek04 at gmail.com  Wed Mar 16 13:02:35 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 16 Mar 2011 13:02:35 +0000
Subject: [rabbitmq-discuss] Performance and scalability measurement with
 my publisher-subscriber clients testing
In-Reply-To: <D74E9E6B-16C5-4E5B-88AC-F7751273F397@yahoo-inc.com>
References: <4583DF6A-62EA-41BC-9FAD-F98F3BF314CD@yahoo-inc.com>
	<AANLkTikv0PsureszEvNgCv+OVYgz559VmFzHcLDEc78c@mail.gmail.com>
	<D74E9E6B-16C5-4E5B-88AC-F7751273F397@yahoo-inc.com>
Message-ID: <AANLkTi=6ooBNyeM54uTdUhXj3Pu6Z6G0=QNeJz7VGpQy@mail.gmail.com>

On Wed, Mar 16, 2011 at 12:06, Deepak Vijayvergiy <vdeepak at yahoo-inc.com> wrote:
> Thanks Marek for the good points.
> I am thinking of having 1 publisher and a few consumers consuming from the same queue, so that I don't get queue full (as publisher will be faster than subscriber).
> In that scenario, I will try to publish messages continuously and see the rate of publisher as well as consumer, and while mentioning the performance numbers, will give the setup details as well.
>
> Also, another question regarding the rabbitmq queue space, I see that its limited to 1.58 GB, is that the size on the ?disk by default or its the RAM size?
> How shall I configure it if I want to increase it?

You're probably speaking about Memory Limit line in your logs:
  http://www.rabbitmq.com/extensions.html#memsup

That indicates that Rabbit will try to keep its RAM usage below the value.
In the docs you will see how to increase this value.

It doesn't have much to do with the maximum queue size.

Marek

> On Mar 16, 2011, at 5:26 PM, Marek Majkowski wrote:
>
>> On Wed, Mar 9, 2011 at 10:26, Deepak Vijayvergiy <vdeepak at yahoo-inc.com> wrote:
>>> I have created the framework for publisher-subscriber and created publisher and consumer clients for basic testing as well. Now, I also want to test the performance as well, as in, I want to give the numbers like -
>>> (1) How many messages, my publisher client will be able to publish per second or rate?
>>> (2) How many messages my consumer will be able to consume (per second) .. rate? (a) with messages already in the queue (b) parallely publishing as well
>>>
>>> Earlier I have tried doing same by some time functions before and after 1 and last mess respectively, but I don't think that was a proper way. Please let me know if you have done the same measurement?
>>
>> We do have a tool for doing simple measurements, see MulticastMain
>> in our java client. ?Sample usage:
>> ? http://www.rabbitmq.com/ec2.html#testing
>> (dig the mailing list archives for more examples)
>>
>> Doing benchmarks properly, even as simple as you described, is pretty hard.
>>
>> With 1) you will measure performance of the client. Unless you're using
>> publisher-acks.
>>
>> 2) It all depends, if data in-memory or on the disk, is it cached by the OS,
>> how big is the queue, how many queues are handled by rabbit and so on.
>>
>> 2b) That one is quite interesting, but you have to be very careful to keep
>> the queue balanced. Publishing is usually faster than consuming.
>>
>> Rabbit is not a rocket science and there are some significant bottlenecks.
>> If you start swapping to disk or if you use persistent messages -
>> things will be much slower.
>>
>> Usually the best approach is to test the whole solution end-to-end
>> rather than focusing on dry RabbitMQ benchmarks. That way you can
>> be sure that the numbers actually mean something you're interested
>> in. Raw benchmarks like publishes/sec or consumes/sec doesn't
>> say anything useful.
>>
>> Cheers,
>> ?Marek
>
>

From lucasas at gmail.com  Wed Mar 16 13:48:22 2011
From: lucasas at gmail.com (Lucas Souza)
Date: Wed, 16 Mar 2011 10:48:22 -0300
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
	library
In-Reply-To: <4D808637.3080609@rabbitmq.com>
References: <384fba16-a405-45a8-bbcc-6e016162ea9a@s18g2000prg.googlegroups.com>
	<4D808637.3080609@rabbitmq.com>
Message-ID: <AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>

Give me a example, please.

Can I try this example on Java Client Library:

ConnectionFactory factory = new ConnectionFactory();
Address[] addresses = {new Address("localhost", 12345), new
Address("localhost", 12346)};
factory.newConnection(addresses);

If I'll do this, how can I know what node of cluster I'm connected?

If node 1 down, but node 2 still up, how can I reconnect in node 1?

Thanks Emile.

Regards.

Lucas Ap. Souza



On 16 March 2011 06:43, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Lucas,
>
> On 15/03/11 21:34, Lucas Souza wrote:
>
>> Hi everybody...
>>
>> How can I connect in a cluster using Java client library?
>>
>
> A rabbit client (including the Java client) will work unchanged whether
> connecting to single or a clustered broker. When connecting to a cluster, it
> makes little difference which node in the cluster a client connects to
> (except for queue declarations).
>
> You should take a look at the clustering guide for instructions on how to
> set up a cluster using the rabbitmqctl commandline utility:
> http://www.rabbitmq.com/clustering.html
>
> Regards
>
> Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110316/8d39738f/attachment.htm>

From emile at rabbitmq.com  Wed Mar 16 14:23:17 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 16 Mar 2011 14:23:17 +0000
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
 library
In-Reply-To: <AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>
References: <384fba16-a405-45a8-bbcc-6e016162ea9a@s18g2000prg.googlegroups.com>	<4D808637.3080609@rabbitmq.com>
	<AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>
Message-ID: <4D80C7D5.5050701@rabbitmq.com>

Hi Lucas,

On 16/03/11 13:48, Lucas Souza wrote:

> ConnectionFactory factory = new ConnectionFactory();
> Address[] addresses = {new Address("localhost", 12345), new
> Address("localhost", 12346)};
> factory.newConnection(addresses);
>
> If I'll do this, how can I know what node of cluster I'm connected?

It shouldn't matter which node you are connected to (unless you care 
about the locations of queues). Clients see an identical view of the 
world regardless of which broker in the same cluster they connect to.

A channel can query the underlying connection. You can find the address 
of the clustered node that way if necessary.

> If node 1 down, but node 2 still up, how can I reconnect in node 1?

The factory connection does not offer robust reconnection logic. If you 
want clients to reconnect then take a look at the message patterns library:

http://hg.rabbitmq.com/rabbitmq-java-messagepatterns

This is a higher-level library that offers reconnection logic, which is 
sufficiently flexible for use with clusters.


Regards

Emile


From lucasas at gmail.com  Wed Mar 16 14:46:44 2011
From: lucasas at gmail.com (Lucas Souza)
Date: Wed, 16 Mar 2011 07:46:44 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
	library
In-Reply-To: <4D80C7D5.5050701@rabbitmq.com>
References: <384fba16-a405-45a8-bbcc-6e016162ea9a@s18g2000prg.googlegroups.com>
	<4D808637.3080609@rabbitmq.com>
	<AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>
	<4D80C7D5.5050701@rabbitmq.com>
Message-ID: <0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>

Thanks Emile, I understand that does not matter to the client which
node his are connected.

But, I'm exploring the source code of rabbitmq java client library and
saw the class https://github.com/rabbitmq/rabbitmq-java-client/blob/master/src/com/rabbitmq/client/ConnectionFactory.java

In this class when I send multiples addresses, it connect in only one.
What node adress should I send to newConnection method?

Sorry if I'm wrong, but I understand that if I send a address of a
node valid, the connection returned is always references this node.

Thank you again.

Regards

On 16 mar, 11:23, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Lucas,
>
> On 16/03/11 13:48, Lucas Souza wrote:
>
> > ConnectionFactory factory = new ConnectionFactory();
> > Address[] addresses = {new Address("localhost", 12345), new
> > Address("localhost", 12346)};
> > factory.newConnection(addresses);
>
> > If I'll do this, how can I know what node of cluster I'm connected?
>
> It shouldn't matter which node you are connected to (unless you care
> about the locations of queues). Clients see an identical view of the
> world regardless of which broker in the same cluster they connect to.
>
> A channel can query the underlying connection. You can find the address
> of the clustered node that way if necessary.
>
> > If node 1 down, but node 2 still up, how can I reconnect in node 1?
>
> The factory connection does not offer robust reconnection logic. If you
> want clients to reconnect then take a look at the message patterns library:
>
> http://hg.rabbitmq.com/rabbitmq-java-messagepatterns
>
> This is a higher-level library that offers reconnection logic, which is
> sufficiently flexible for use with clusters.
>
> Regards
>
> Emile
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Wed Mar 16 15:12:44 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 16 Mar 2011 15:12:44 +0000
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
 library
In-Reply-To: <0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>
References: <384fba16-a405-45a8-bbcc-6e016162ea9a@s18g2000prg.googlegroups.com>	<4D808637.3080609@rabbitmq.com>	<AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>	<4D80C7D5.5050701@rabbitmq.com>
	<0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>
Message-ID: <4D80D36C.5070505@rabbitmq.com>

Hi Lucas,

On 16/03/11 14:46, Lucas Souza wrote:
> But, I'm exploring the source code of rabbitmq java client library and
> saw the class https://github.com/rabbitmq/rabbitmq-java-client/blob/master/src/com/rabbitmq/client/ConnectionFactory.java
>
> In this class when I send multiples addresses, it connect in only one.
> What node adress should I send to newConnection method?

If you are connecting to single broker then use setHost() and 
newConnection(). If you are connecting to a cluster then can do the 
same, using the address of any of the cluster nodes, or you can use 
newConnection(Address[]), where the parameter is an array of cluster 
node addresses.

> Sorry if I'm wrong, but I understand that if I send a address of a
> node valid, the connection returned is always references this node.

Yes.



Regards

Emile

From lucasas at gmail.com  Wed Mar 16 15:20:29 2011
From: lucasas at gmail.com (Lucas Souza)
Date: Wed, 16 Mar 2011 08:20:29 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
	library
In-Reply-To: <4D80D36C.5070505@rabbitmq.com>
References: <384fba16-a405-45a8-bbcc-6e016162ea9a@s18g2000prg.googlegroups.com>
	<4D808637.3080609@rabbitmq.com>
	<AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>
	<4D80C7D5.5050701@rabbitmq.com>
	<0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>
	<4D80D36C.5070505@rabbitmq.com>
Message-ID: <a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>

Thanks Emile, and to finish... :D

Wheter I want connecting in 4 nodes of the cluster, I need to have 4
connection, one per node, that's it?

I dont see any benefits in the client side if I have to do this
process. Am I wrong?

Thank so much Emile.

Regards.

On 16 mar, 12:12, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Lucas,
>
> On 16/03/11 14:46, Lucas Souza wrote:
>
> > But, I'm exploring the source code of rabbitmq java client library and
> > saw the classhttps://github.com/rabbitmq/rabbitmq-java-client/blob/master/src/com/...
>
> > In this class when I send multiples addresses, it connect in only one.
> > What node adress should I send to newConnection method?
>
> If you are connecting to single broker then use setHost() and
> newConnection(). If you are connecting to a cluster then can do the
> same, using the address of any of the cluster nodes, or you can use
> newConnection(Address[]), where the parameter is an array of cluster
> node addresses.
>
> > Sorry if I'm wrong, but I understand that if I send a address of a
> > node valid, the connection returned is always references this node.
>
> Yes.
>
> Regards
>
> Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Wed Mar 16 15:28:43 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 16 Mar 2011 15:28:43 +0000
Subject: [rabbitmq-discuss] Failure during shutdown with v2.3.1
In-Reply-To: <AANLkTim6SSfPEWQf9C_q5GxeEsX534+sCTSbNADdHeGx@mail.gmail.com>
References: <AANLkTim6SSfPEWQf9C_q5GxeEsX534+sCTSbNADdHeGx@mail.gmail.com>
Message-ID: <20110316152842.GD12427@wellquite.org>

Hi Lee,

On Thu, Mar 10, 2011 at 08:03:42PM -0800, Lee Kirchhoff wrote:
> I recently upgraded from RabbitMQ 1.8.1 to 2.3.1 and am running in Mac and
> Ubuntu enviroments. I have a plugin that uses the amqp_client to access a
> local queue. With 2.3.1 when shutting down I get the error below, which I
> never encountered previously. There is no load when the shutdown is
> happening.

Yeah, it's not really an error, it's just that currently the connection
closing handling in the erlang client is a little funky. Basically,
it'll go away if you ensure that you manually close the channels and
then the connections. The application shutdown stuff will not close
things down at the moment without these sorts of log entries popping
out. We have a plan to fix this, though really the issue is to do with a
combination of inflexibility Erlang's logging policies and signals being
issued by terminating processes.

In short, you can ignore entries like this - if it's giving you
something like:
** Last message in was {'$gen_cast',channels_terminated}

> I tried to determine the cause. It appears that it may be something of a
> race in that when I insert a 500 msec delay in
> amqp_channels_manger:handle_channel_down/4 I get the initial internal error
> indication, but no following error report. My plugin is listed before the
> amqp_client application when I do a 'rabbitmqctl status' so I it should be
> the first getting a chance to shutdown and close its amqp connection, i.e.,
> before the amqp_client shuts down, but I suppose applications shutdown
> asynchronously.

I believe applications should be shut down according to the inverse
dependencies in the app files. Thus your application should depend on
both rabbit and amqp_client (the erlang client is now its own
application). Thus when your application shuts down, it should have a
chance to close down all channels and connections nicely, before either
amqp_client or rabbit applications start to shutdown. This should, I
believe, avoid these log entries.

Best wishes,

Matthew

From matthias at rabbitmq.com  Wed Mar 16 15:29:58 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 16 Mar 2011 15:29:58 +0000
Subject: [rabbitmq-discuss] Rabbit Shovel Plugin
In-Reply-To: <31153075.post@talk.nabble.com>
References: <31153075.post@talk.nabble.com>
Message-ID: <4D80D776.3000404@rabbitmq.com>

On 15/03/11 14:19, butterdave2 wrote:
> I'm interested in seeing if Shovel can meet some of my messaging
> requirements.
> On the plugins page, a rabbitmq-shovel-2.3.1.ez is provided. Can I just pop
> this into the plugins dir? Or do I have to build it from source?

See the explanation on the very same page at 
http://www.rabbitmq.com/plugins.html#overview

<quote>
The simplest way to install plugins is to download all the required .ez 
files from this page, drop them in your plugins directory and restart 
RabbitMQ.
</quote>

And at http://www.rabbitmq.com/plugins.html#rabbitmq-shovel it says
<quote>
To use this plugin the following files are required:
     * amqp_client
     * rabbitmq-shovel
</quote>

...which links to the two .ez files you'll need.


Regards,

Matthias.

From majek04 at gmail.com  Wed Mar 16 15:42:01 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 16 Mar 2011 15:42:01 +0000
Subject: [rabbitmq-discuss] acquiring channels per connection
In-Reply-To: <AANLkTik60yoaMptM=pk6c-AD=5SSZX=Vd9wPcUa0WW-e@mail.gmail.com>
References: <AANLkTik60yoaMptM=pk6c-AD=5SSZX=Vd9wPcUa0WW-e@mail.gmail.com>
Message-ID: <AANLkTikQQGnGZm-HBc8hCjhxYaq4uxyRj+RQKxwCQscO@mail.gmail.com>

On Tue, Mar 15, 2011 at 07:11, vorad <vorad.1100 at gmail.com> wrote:
> I am trying to figure out what's the best way to work with rabbitmq - I am
> working on implementing a couple of basic HTTP requests that do some queue
> management (with the Pika library and Tornado as web server). One of the
> first issues I had was how do I actually get the errors out of Pika when
> these happen (say when you're trying to delete a queue that doesn't exist)
> and it seems I figured that out, hopefully (channel.add_on_close_callback)
> Now, the way I tought this was that I have one rabbitmq connection per
> application/web server and one channel as well, which seems pretty bad now
> that I look back, since I can't really do particular error logic per request
> with only one channel per application. So I am trying to switch away from
> this to having one channel per http request. How expensive would be to do
> this (one channel per request) from the rabbitmq perspective and also from
> the Pika's perspective ?

Well, not that expensive if your RabbitMQ is close to the web server.
Opening channel is a synchronous action - a full roundtrip is required.

To avoid that roundtrip you may hava a pool and reuse open channels.

> And also, does this look like a good approach,
> given the fact that I'll have lots of http connections? I know that RabbitMQ
> was made to scale to a big number of channels.

Rabbit can handle many channels.

From matthias at rabbitmq.com  Wed Mar 16 15:46:52 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 16 Mar 2011 15:46:52 +0000
Subject: [rabbitmq-discuss] Rabbitmq-Shovel Timer-Based Publishing
	Possible?
In-Reply-To: <C9A4FBF5.34C5%allen.kim@epicadvertising.com>
References: <C9A4FBF5.34C5%allen.kim@epicadvertising.com>
Message-ID: <4D80DB6C.9060804@rabbitmq.com>

Allen,

On 15/03/11 15:33, Allen Kim wrote:
> Timer-based publish(shovel) means publishing on every seconds or minute
> regardless of number of queue stacked.
> In our case, if we publish only on based on number of queues, it will
> publish very busy during day time and slowly at night.
>
> The worst case that I see is it does not shovel when there is no queue
> increasing.
> I want queues shovelled every few seconds, guaranteed, so that other
> cluser receive messages not too late.

The shovel maintains permanent connections and reconnects them on 
failure. Messages get shovelled straight away.

Does that meet your requirements? Perhaps I am misunderstanding your use 
case, but I don't see the benefit of shovelling at regular intervals 
only instead of all the time.

Regards,

Matthias.

From gmr at myyearbook.com  Wed Mar 16 15:54:14 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 16 Mar 2011 11:54:14 -0400
Subject: [rabbitmq-discuss] acquiring channels per connection
In-Reply-To: <AANLkTikQQGnGZm-HBc8hCjhxYaq4uxyRj+RQKxwCQscO@mail.gmail.com>
References: <AANLkTik60yoaMptM=pk6c-AD=5SSZX=Vd9wPcUa0WW-e@mail.gmail.com>
	<AANLkTikQQGnGZm-HBc8hCjhxYaq4uxyRj+RQKxwCQscO@mail.gmail.com>
Message-ID: <E95DBDA418DD4E019939BC54870BFBA5@myyearbook.com>


On Wednesday, March 16, 2011 at 11:42 AM, Marek Majkowski wrote: 
> On Tue, Mar 15, 2011 at 07:11, vorad <vorad.1100 at gmail.com> wrote:
> > How expensive would be to do
> > this (one channel per request) from the rabbitmq perspective and also from
> > the Pika's perspective ?
> 
> Well, not that expensive if your RabbitMQ is close to the web server.
> Opening channel is a synchronous action - a full roundtrip is required.
> 
> To avoid that roundtrip you may hava a pool and reuse open channels.
In addition, you're not buying anything by using more connections as they'll still use the same single process IOLoop.

For what it's worth, I use Pika and Tornado with one connection and channel per Tornado backend and hold on to the for the life of the backend, across multiple RequestHandler invocations.

If you want to use multiple channels, I recommend having a sound reason for it. At the protocol level, it's nothing more than a numeric identifier for the frame routing. At the python level it's a set of two class instances which need to reside in memory. I can't think of a reason in my web applications that I would use more than one channel.

For example, if you want to listen on multiple queues, just have multiple callbacks for channel.basic_consume.

I guess my main point is using more channels and more connections doesn't offer any real value and adds additional overhead since you're bound to the same single process for responding to events.

I would imagine if you could saturate a socket without saturating CPU that there could be some value, but offhand I can't imagine that is possible, as the OS's use of CPU would be saturated.

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110316/07305b46/attachment-0001.htm>

From gmr at myyearbook.com  Wed Mar 16 15:57:18 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 16 Mar 2011 11:57:18 -0400
Subject: [rabbitmq-discuss] acquiring channels per connection
In-Reply-To: <E95DBDA418DD4E019939BC54870BFBA5@myyearbook.com>
References: <AANLkTik60yoaMptM=pk6c-AD=5SSZX=Vd9wPcUa0WW-e@mail.gmail.com>
	<AANLkTikQQGnGZm-HBc8hCjhxYaq4uxyRj+RQKxwCQscO@mail.gmail.com>
	<E95DBDA418DD4E019939BC54870BFBA5@myyearbook.com>
Message-ID: <29C280218CA04797900C10D9403A49E1@myyearbook.com>


On Wednesday, March 16, 2011 at 11:54 AM, Gavin M. Roy wrote: 
> 
> If you want to use multiple channels, I recommend having a sound reason for it.

One use case that hit me when I hit send would be to have different credentials when publishing or consuming. I would not recommend connecting and creating channels on each request however, as a new connection requires multiple synchronous communication steps, in addition to the synchronous channel opening. 

Note that in Pika this is not blocking, however it will cause your app to return responses much slower than if you just setup a connection and channel on application construction.

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110316/bb98e9b0/attachment.htm>

From majek04 at gmail.com  Wed Mar 16 15:58:06 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 16 Mar 2011 15:58:06 +0000
Subject: [rabbitmq-discuss] acquiring channels per connection
In-Reply-To: <E95DBDA418DD4E019939BC54870BFBA5@myyearbook.com>
References: <AANLkTik60yoaMptM=pk6c-AD=5SSZX=Vd9wPcUa0WW-e@mail.gmail.com>
	<AANLkTikQQGnGZm-HBc8hCjhxYaq4uxyRj+RQKxwCQscO@mail.gmail.com>
	<E95DBDA418DD4E019939BC54870BFBA5@myyearbook.com>
Message-ID: <AANLkTi=4gS2HtLU43wWOJL_U0E1sDeXTjrLmP7c7ad5s@mail.gmail.com>

On Wed, Mar 16, 2011 at 15:54, Gavin M. Roy <gmr at myyearbook.com> wrote:
> On Wednesday, March 16, 2011 at 11:42 AM, Marek Majkowski wrote:
> On Tue, Mar 15, 2011 at 07:11, vorad <vorad.1100 at gmail.com> wrote:
>
> ?How expensive would be to do
> this (one channel per request) from the rabbitmq perspective and also from
> the Pika's perspective ?
>
> Well, not that expensive if your RabbitMQ is close to the web server.
> Opening channel is a synchronous action - a full roundtrip is required.
>
> To avoid that roundtrip you may hava a pool and reuse open channels.
>
> In addition, you're not buying anything by using more connections?as they'll
> still use the same single process IOLoop.
> For what it's worth, I use Pika and Tornado with one connection and?channel
> per Tornado backend and hold on to the for the life of the backend, across
> multiple RequestHandler invocations.
> If you want to use multiple channels, I recommend having a sound reason for
> it. At the protocol level, it's nothing more than a numeric identifier for
> the frame routing.

Limiting an error scope is usually a good reason for using channels.

> At the python level it's a set of two class instances
> which need to reside in memory. I can't think of a reason in my web
> applications that I would use more than one channel.
> For example, if you want to listen on multiple queues, just have multiple
> callbacks for channel.basic_consume.
> I guess my main point is using more channels and more connections doesn't
> offer any real value and adds additional overhead since you're bound to the
> same single process for responding to events.
> I would imagine if you could saturate a socket without saturating CPU that
> there could be some value, but offhand I can't imagine that is possible, as
> the OS's use of CPU would be saturated.
> Gavin

From emile at rabbitmq.com  Wed Mar 16 16:07:24 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 16 Mar 2011 16:07:24 +0000
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
 library
In-Reply-To: <a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>
References: <384fba16-a405-45a8-bbcc-6e016162ea9a@s18g2000prg.googlegroups.com>	<4D808637.3080609@rabbitmq.com>	<AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>	<4D80C7D5.5050701@rabbitmq.com>	<0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>	<4D80D36C.5070505@rabbitmq.com>
	<a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>
Message-ID: <4D80E03C.1040503@rabbitmq.com>

On 16/03/11 15:20, Lucas Souza wrote:
> Thanks Emile, and to finish... :D
>
> Wheter I want connecting in 4 nodes of the cluster, I need to have 4
> connection, one per node, that's it?

No, clients only require a single connection, to any of the nodes in the 
cluster. Apart from queue declarations it does not matter which node a 
client connects to.

Regards

Emile



From lucasas at gmail.com  Wed Mar 16 16:13:33 2011
From: lucasas at gmail.com (Lucas Souza)
Date: Wed, 16 Mar 2011 09:13:33 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
	library
In-Reply-To: <4D80E03C.1040503@rabbitmq.com>
References: <384fba16-a405-45a8-bbcc-6e016162ea9a@s18g2000prg.googlegroups.com>
	<4D808637.3080609@rabbitmq.com>
	<AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>
	<4D80C7D5.5050701@rabbitmq.com>
	<0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>
	<4D80D36C.5070505@rabbitmq.com>
	<a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>
	<4D80E03C.1040503@rabbitmq.com>
Message-ID: <8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>

If I'm connected on node A, and my cluster is composed by node A and
node B, if node A down, will I have to connect in node B explicitily?

Always I have to choice a node to connect?

Regards.

On 16 mar, 13:07, Emile Joubert <em... at rabbitmq.com> wrote:
> On 16/03/11 15:20, Lucas Souza wrote:
>
> > Thanks Emile, and to finish... :D
>
> > Wheter I want connecting in 4 nodes of the cluster, I need to have 4
> > connection, one per node, that's it?
>
> No, clients only require a single connection, to any of the nodes in the
> cluster. Apart from queue declarations it does not matter which node a
> client connects to.
>
> Regards
>
> Emile
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From allen.kim at epicadvertising.com  Wed Mar 16 16:50:18 2011
From: allen.kim at epicadvertising.com (Allen Kim)
Date: Wed, 16 Mar 2011 11:50:18 -0500
Subject: [rabbitmq-discuss] Rabbitmq-Shovel Timer-Based Publishing
 Possible?
In-Reply-To: <4D80DB6C.9060804@rabbitmq.com>
Message-ID: <C9A66266.35A5%allen.kim@epicadvertising.com>

Message volume fluctuates from extremely high to very low depending on the
time of day.

We use a relatively large transaction size on the outbound, publishing,
connection to get high enough throughput on a high latency link for the
peak times of day.  However, at the off peak times of day, it can take up
to a few minutes for the shovel to accumulate enough messages to hit the
configured transaction commit size.

Allowing a configurable transaction size plus commit timer adds some
flexibility.  At peak times, the transaction size counter is always hit
first.  At low times, the timer hits first and ensures that  message
delivery does not stall.


Allen


On 11-03-16 11:46 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Allen,
>
>On 15/03/11 15:33, Allen Kim wrote:
>> Timer-based publish(shovel) means publishing on every seconds or minute
>> regardless of number of queue stacked.
>> In our case, if we publish only on based on number of queues, it will
>> publish very busy during day time and slowly at night.
>>
>> The worst case that I see is it does not shovel when there is no queue
>> increasing.
>> I want queues shovelled every few seconds, guaranteed, so that other
>> cluser receive messages not too late.
>
>The shovel maintains permanent connections and reconnects them on
>failure. Messages get shovelled straight away.
>
>Does that meet your requirements? Perhaps I am misunderstanding your use
>case, but I don't see the benefit of shovelling at regular intervals
>only instead of all the time.
>
>Regards,
>
>Matthias.


From scott at beamdog.com  Wed Mar 16 17:05:04 2011
From: scott at beamdog.com (Scott Brooks)
Date: Wed, 16 Mar 2011 11:05:04 -0600
Subject: [rabbitmq-discuss] Rabbitmq-Shovel Timer-Based Publishing
	Possible?
In-Reply-To: <4D80DB6C.9060804@rabbitmq.com>
References: <C9A4FBF5.34C5%allen.kim@epicadvertising.com>
	<4D80DB6C.9060804@rabbitmq.com>
Message-ID: <AANLkTimhYCdPzaEdbUBD9Mhk9vWXFjqxJvJhDF8Yn5Tn@mail.gmail.com>

I think the situation is as follows.

tx_size is set to something large so that it's still a transactional
commit, but is fast enough for the peak day time traffic, but at night
it may take a while before tx_size messages are ready to be committed.

I think they are looking for a way to have the transactions be
committed when tx_size is reached, or after specified period of time.

Scott Brooks

On Wed, Mar 16, 2011 at 9:46 AM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Allen,
>
> On 15/03/11 15:33, Allen Kim wrote:
>>
>> Timer-based publish(shovel) means publishing on every seconds or minute
>> regardless of number of queue stacked.
>> In our case, if we publish only on based on number of queues, it will
>> publish very busy during day time and slowly at night.
>>
>> The worst case that I see is it does not shovel when there is no queue
>> increasing.
>> I want queues shovelled every few seconds, guaranteed, so that other
>> cluser receive messages not too late.
>
> The shovel maintains permanent connections and reconnects them on failure.
> Messages get shovelled straight away.
>
> Does that meet your requirements? Perhaps I am misunderstanding your use
> case, but I don't see the benefit of shovelling at regular intervals only
> instead of all the time.
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From emile at rabbitmq.com  Wed Mar 16 17:10:00 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 16 Mar 2011 17:10:00 +0000
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
 library
In-Reply-To: <8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>
References: <384fba16-a405-45a8-bbcc-6e016162ea9a@s18g2000prg.googlegroups.com>	<4D808637.3080609@rabbitmq.com>	<AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>	<4D80C7D5.5050701@rabbitmq.com>	<0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>	<4D80D36C.5070505@rabbitmq.com>	<a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>	<4D80E03C.1040503@rabbitmq.com>
	<8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>
Message-ID: <4D80EEE8.1050808@rabbitmq.com>

Hi Lucas,

On 16/03/11 16:13, Lucas Souza wrote:
> If I'm connected on node A, and my cluster is composed by node A and
> node B, if node A down, will I have to connect in node B explicitily?
>
> Always I have to choice a node to connect?

If you want clients to reconnect when nodes disappear then take a look 
at the message patterns library, as mentioned previously. Clients can 
reconnect to any of the nodes that are still running.

Keep in mind that rabbit clusters are intended to provide scalability 
rather than availability.

Regards

Emile

From lucasas at gmail.com  Wed Mar 16 17:31:36 2011
From: lucasas at gmail.com (Lucas Souza)
Date: Wed, 16 Mar 2011 10:31:36 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
	library
In-Reply-To: <4D80EEE8.1050808@rabbitmq.com>
References: <384fba16-a405-45a8-bbcc-6e016162ea9a@s18g2000prg.googlegroups.com>
	<4D808637.3080609@rabbitmq.com>
	<AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>
	<4D80C7D5.5050701@rabbitmq.com>
	<0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>
	<4D80D36C.5070505@rabbitmq.com>
	<a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>
	<4D80E03C.1040503@rabbitmq.com>
	<8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>
	<4D80EEE8.1050808@rabbitmq.com>
Message-ID: <1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>

Emile, and how about publishing messages....

If a connect on node A, I have to consume this message only on node A.
If I'll go on node B, the message does not exist there, right?

Is there any way to make replication on RabbitMQ?

Regards

On 16 mar, 14:10, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Lucas,
>
> On 16/03/11 16:13, Lucas Souza wrote:
>
> > If I'm connected on node A, and my cluster is composed by node A and
> > node B, if node A down, will I have to connect in node B explicitily?
>
> > Always I have to choice a node to connect?
>
> If you want clients to reconnect when nodes disappear then take a look
> at the message patterns library, as mentioned previously. Clients can
> reconnect to any of the nodes that are still running.
>
> Keep in mind that rabbit clusters are intended to provide scalability
> rather than availability.
>
> Regards
>
> Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Wed Mar 16 17:34:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 16 Mar 2011 17:34:55 +0000
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
 library
In-Reply-To: <1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>
References: <4D808637.3080609@rabbitmq.com>
	<AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>
	<4D80C7D5.5050701@rabbitmq.com>
	<0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>
	<4D80D36C.5070505@rabbitmq.com>
	<a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>
	<4D80E03C.1040503@rabbitmq.com>
	<8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>
	<4D80EEE8.1050808@rabbitmq.com>
	<1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>
Message-ID: <20110316173454.GE12427@wellquite.org>

On Wed, Mar 16, 2011 at 10:31:36AM -0700, Lucas Souza wrote:
> Emile, and how about publishing messages....
> 
> If a connect on node A, I have to consume this message only on node A.
> If I'll go on node B, the message does not exist there, right?

Wrong. A cluster is one logical broker. ALL resources are visible from
any node within the cluster. Thus if you publish a msg whilst connected
to node A, it can be routed to a queue on node B, and be consumber by
another client connected to node C.

Matthew

From paul.theodoropoulos at gmail.com  Wed Mar 16 18:28:20 2011
From: paul.theodoropoulos at gmail.com (paul)
Date: Wed, 16 Mar 2011 11:28:20 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-server init script
In-Reply-To: <20110316121653.GA17092@dakota.eng.vmware.com>
References: <20110309135151.GA14426@dakota.eng.vmware.com>
	<14035820.548.1299696932953.JavaMail.geo-discussion-forums@prfc6>
	<20110309211242.GA2355@dakota.doc.ic.ac.uk>
	<85c27985-2592-418d-b160-fa713a31f2fd@11g2000prf.googlegroups.com>
	<20110316121653.GA17092@dakota.eng.vmware.com>
Message-ID: <62d14743-e9c6-436b-9f32-fc9a1fe6a4b1@b13g2000prf.googlegroups.com>



On Mar 16, 5:16?am, Alexandru Scvor??ov <alexan... at rabbitmq.com>
wrote:
> > chown -R $USER:$USER $INIT_LOG_DIR
>
> That's interesting. ?Did you add some code to run rabbitmq as non-root?

nope.

> What is your INIT_LOG_DIR? (did you change it to a location that gets
> wiped on restart?)

i installed from the RPM, which created the rabbitmq log directory in
the appropriate place, and with the appropriate ownership as
rabbitmq:rabbitmq - it's just that on restart apparently the logs
would be created owned by root which would block startup.
>
> I see we don't automatically `mkdir $INIT_LOG_DIR` in the init script.
> How are you creating it?

as above - was created at /var/log/rabbitmq by the rpm.

From lucasas at gmail.com  Wed Mar 16 19:10:34 2011
From: lucasas at gmail.com (Lucas Souza)
Date: Wed, 16 Mar 2011 12:10:34 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
	library
In-Reply-To: <20110316173454.GE12427@wellquite.org>
References: <4D808637.3080609@rabbitmq.com>
	<AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>
	<4D80C7D5.5050701@rabbitmq.com>
	<0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>
	<4D80D36C.5070505@rabbitmq.com>
	<a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>
	<4D80E03C.1040503@rabbitmq.com>
	<8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>
	<4D80EEE8.1050808@rabbitmq.com>
	<1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>
	<20110316173454.GE12427@wellquite.org>
Message-ID: <0ccca993-b80b-4443-adce-cbccf59dd9ee@a21g2000prj.googlegroups.com>

Hello Matthew, thank you for your reply...

If I use Java Client Library, this behavior is automatic?

For example, if the real message was published on node A, and node A
downs,
and I connect on node B, will I receive the message?

Regards.

On 16 mar, 14:34, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Wed, Mar 16, 2011 at 10:31:36AM -0700, Lucas Souza wrote:
> > Emile, and how about publishing messages....
>
> > If a connect on node A, I have to consume this message only on node A.
> > If I'll go on node B, the message does not exist there, right?
>
> Wrong. A cluster is one logical broker. ALL resources are visible from
> any node within the cluster. Thus if you publish a msg whilst connected
> to node A, it can be routed to a queue on node B, and be consumber by
> another client connected to node C.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From clint_gilbert at hms.harvard.edu  Wed Mar 16 21:52:27 2011
From: clint_gilbert at hms.harvard.edu (Clint Gilbert)
Date: Wed, 16 Mar 2011 17:52:27 -0400
Subject: [rabbitmq-discuss] RabbitMQ and server-push
Message-ID: <4D81311B.2060105@hms.harvard.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I'm sorry if this has been covered already.  A quick search of the
mailing list archives and RabbitMQ website didn't turn up any answers
for my specific question.

I'd like a way for a server to push back one to many events to a
client, over HTTP, without that client listening on a non-firewalled
port.  (The client can only make outbound connections through a
firewall.)  basically, the client should be able to connect to the
server, observe the server, tell the server to do something, and receive
notifications about how that 'something' is going.  Both the client and
server will be written in JVM languages.

I need - more or less - a 70s-style socket with (ideally) higher-level
support from RabbitMQ for things like reliable delivery, message
serialization, etc.

Bonus points for being able to runnel over HTTP and deploy in recent
(but not Servlet API 3.0-capable) app servers like Tomcat 6.

Can RabbitMQ do what I need?


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk2BMRsACgkQ5IyIbnMUeTvc9wCeIphio8zt9uYn6m5hMeEJ+78h
uaMAni3qqoNCoFL2WO+DCj7wxbNABZ1N
=UOHb
-----END PGP SIGNATURE-----

From matthias at rabbitmq.com  Wed Mar 16 22:00:22 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 16 Mar 2011 22:00:22 +0000
Subject: [rabbitmq-discuss] Rabbitmq-Shovel Timer-Based Publishing
	Possible?
In-Reply-To: <C9A66266.35A5%allen.kim@epicadvertising.com>
References: <C9A66266.35A5%allen.kim@epicadvertising.com>
Message-ID: <4D8132F6.8070504@rabbitmq.com>

Allen,

Allen Kim wrote:
> Message volume fluctuates from extremely high to very low depending on the
> time of day.
> 
> We use a relatively large transaction size on the outbound, publishing,
> connection to get high enough throughput on a high latency link for the
> peak times of day.  However, at the off peak times of day, it can take up
> to a few minutes for the shovel to accumulate enough messages to hit the
> configured transaction commit size.
> 
> Allowing a configurable transaction size plus commit timer adds some
> flexibility.  At peak times, the transaction size counter is always hit
> first.  At low times, the timer hits first and ensures that  message
> delivery does not stall.

So you are employing transactions in order to get guaranteed delivery, 
right?

I can see at least two alternative approaches here...

1) instead of committing after a certain size/time, grow the tx as long 
as there are messages and only commit when there is a gap.

2) use confirms (http://www.rabbitmq.com/extensions.html#confirms) and 
only ack a message to the source once it has been confirmed by the 
destination.

Both approaches require zero config - no obscure time/count knobs to 
tweak - which makes them rather appealing.

Unfortunately the shovel currently doesn't support either of these. I've 
filed a bug to look into the latter.


Regards,

Matthias.

From gmr at myyearbook.com  Wed Mar 16 22:00:54 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 16 Mar 2011 18:00:54 -0400
Subject: [rabbitmq-discuss] RabbitMQ and server-push
In-Reply-To: <4D81311B.2060105@hms.harvard.edu>
References: <4D81311B.2060105@hms.harvard.edu>
Message-ID: <BD125F57B5454884B481DAFD9D822CC1@myyearbook.com>


On Wednesday, March 16, 2011 at 5:52 PM, Clint Gilbert wrote: 
> -----BEGIN PGP SIGNED MESSAGE-----
> I'd like a way for a server to push back one to many events to a
> client, over HTTP, without that client listening on a non-firewalled
> port. 
> 
> Can RabbitMQ do what I need?
It's obviously not Java and what not, but I have a light-weight PHP client for pushing messages to RabbitMQ over the RabbitMQ JSON-RPC Channel Plugin: 

https://github.com/myyearbook/vorpalbunny

It may be able to serve as a model for you are trying to do with HTTP.

Hope this helps,

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110316/769ebe0e/attachment.htm>

From clint_gilbert at hms.harvard.edu  Wed Mar 16 22:07:30 2011
From: clint_gilbert at hms.harvard.edu (Clint Gilbert)
Date: Wed, 16 Mar 2011 18:07:30 -0400
Subject: [rabbitmq-discuss] RabbitMQ and server-push
In-Reply-To: <BD125F57B5454884B481DAFD9D822CC1@myyearbook.com>
References: <4D81311B.2060105@hms.harvard.edu>
	<BD125F57B5454884B481DAFD9D822CC1@myyearbook.com>
Message-ID: <4D8134A2.709@hms.harvard.edu>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Great, thank you for your response!  Your code appears to just publish
messages to a server - or am I missing something?  Is it possible to
have the client establish a connection to the server, optionally send a
message to the server, and then wait for (and process) one or many
messages from the server?

On 03/16/2011 06:00 PM, Gavin M. Roy wrote:
> 
> On Wednesday, March 16, 2011 at 5:52 PM, Clint Gilbert wrote:
> 
>> -----BEGIN PGP SIGNED MESSAGE-----
>> I'd like a way for a server to push back one to many events to a
>> client, over HTTP, without that client listening on a non-firewalled
>> port. 
>>
>> Can RabbitMQ do what I need?
> It's obviously not Java and what not, but I have a light-weight PHP client for 
> pushing messages to RabbitMQ over the RabbitMQ JSON-RPC Channel Plugin:
> 
> https://github.com/myyearbook/vorpalbunny
> 
> It may be able to serve as a model for you are trying to do with HTTP.
> 
> Hope this helps,
> 
> Gavin

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iEYEARECAAYFAk2BNKIACgkQ5IyIbnMUeTvrrgCeOGEIQvRfNLljuAvfe1erpbWw
JikAn0z65+d/wJBV6qK3nckd3EMJQi6o
=2/qk
-----END PGP SIGNATURE-----

From gmr at myyearbook.com  Wed Mar 16 22:20:57 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 16 Mar 2011 18:20:57 -0400
Subject: [rabbitmq-discuss] RabbitMQ and server-push
In-Reply-To: <4D8134A2.709@hms.harvard.edu>
References: <4D81311B.2060105@hms.harvard.edu>
	<BD125F57B5454884B481DAFD9D822CC1@myyearbook.com>
	<4D8134A2.709@hms.harvard.edu>
Message-ID: <9327B5D023DE4F4180DCC163939691CA@myyearbook.com>


On Wednesday, March 16, 2011 at 6:07 PM, Clint Gilbert wrote: 
> Great, thank you for your response! Your code appears to just publish
> messages to a server - or am I missing something? Is it possible to
> have the client establish a connection to the server, optionally send a
> message to the server, and then wait for (and process) one or many
> messages from the server?
I can't speak to the stay connected, as I don't know if the plugin does comet style long polling, but it is possible to do most everything. The one thing I'd be curious about, and just need to investigate, is do the JavaScript demos for the plugin is Basic.Consume. If they so, I imagine it would need to keep the connection open. A worst case would be a Basic.Get poll.

My goal was basically reuse of sessions in the RPC plugin to make publishing as fast and easy as possible with HTTP (no multiple requests).

It appears the core use case of the plugin is to create a channel/session for each client and use that for consuming and sending. Check out the JSON-RPC channel plugin and the examples, which both can easy be installed in a Rabbit server. It should give you a good idea of what is possible and includes a chat demo.

The biggest issue with the plugin is the lack of documentation. I am going to contribute that back along with a fully working Python client for it (not just publish), but it is lower on my priority list at the moment.

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110316/3bd40365/attachment-0001.htm>

From sameek at arosys.com  Thu Mar 17 05:03:27 2011
From: sameek at arosys.com (sam_mis)
Date: Wed, 16 Mar 2011 22:03:27 -0700 (PDT)
Subject: [rabbitmq-discuss]  can I check queue exists or not?
Message-ID: <31169963.post@talk.nabble.com>


Hi All

I am using Rabbitmq Java client.I have certain doubt in mind :

1.Message queue is logical or physical existence in the memory?
2.Who creates the message queue; Producer/Consumer?
3.How can I know that message queue exist or not before publishing the
message into a queue?
   Is possible or not.if possible then please explain How?

Thanks
-- 
View this message in context: http://old.nabble.com/can-I-check-queue-exists-or-not--tp31169963p31169963.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From chen650 at yahoo.com  Thu Mar 17 05:27:51 2011
From: chen650 at yahoo.com (alex chen)
Date: Wed, 16 Mar 2011 22:27:51 -0700 (PDT)
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <20110316104957.GC12427@wellquite.org>
References: <486630.9133.qm@web31810.mail.mud.yahoo.com>
	<20110316104957.GC12427@wellquite.org>
Message-ID: <78220.69521.qm@web31810.mail.mud.yahoo.com>

Hi Matthew,

Thanks for investigating this problem! I tried rabbitmq-server from hg tip, but 
it still crashed when the message consuming rate reached 300 MB/sec.  When you 
ran the test, did you load at least 60 GB messages to 1000 queues?  each message 
is 20 KB in size.

My machine is RAID-10 with 4 SSD disks:  
480GB (1%) RAID-10/2 == 4 x 240GB SSD SATA/300
Maybe your test machine has only 1 SSD disk so the consuming rate could not 
reach 300 MB/sec?

Thanks.

-alex



________________________________
From: Matthew Sackman <matthew at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Wed, March 16, 2011 3:49:57 AM
Subject: Re: [rabbitmq-discuss] server crashes with very fast consumers

Hi Alex,

On Thu, Mar 10, 2011 at 09:48:08PM -0800, alex chen wrote:
> I am testing rabbit server with SSD.  The broker process would crash when many 

> consumers start to consume backed up messages.  Because SSD if very fast, the 
> consuming rate reached more than 200 MB/sec.  After several minutes, the broker 
>
> process would use all cpu resources (800% on 8 cores) and crash.

I test all the time on an Intel G2 drive. I've never seen it cause a
crash, even in scenarios such as yours. Furthermore, I find it somewhat
unlikely that if the server process did die, it didn't spit out any sort
of error on its way out. There must be /something/ somewhere that
suggests a bit more as to what went wrong, whether it's in syslog, or
dmesg, or rabbit's various logs.

I did however yesterday find and fix a bug where inexplicably a function
that normally takes about 0.5s ended up in some very strange cases
taking > 80s. After a lot of head scratching and debugging, I never
understood why this variance existed. However, I rewrote the function
and it's now much faster all the time. This particular bug has been
through QA and is now on default and should be in the next release, thus
if you want to try compiling from default and repeating your test, we'd
be interested in knowing whether you see any change.

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110316/2b4de9ad/attachment.htm>

From jdetreville at vmware.com  Thu Mar 17 05:34:05 2011
From: jdetreville at vmware.com (John DeTreville)
Date: Wed, 16 Mar 2011 22:34:05 -0700
Subject: [rabbitmq-discuss] can I check queue exists or not?
In-Reply-To: <31169963.post@talk.nabble.com>
References: <31169963.post@talk.nabble.com>
Message-ID: <D4857712-9F1F-49DC-B61E-DAF135A21889@vmware.com>

Sam,

A message queue is a logical construct. You don't get to know how it is stored, but you don't need to know, because you access it through an interface. 

You create a queue by declaring it. Declaring it twice is the same as declaring it once, so it's reasonable for producers and consumers both to declare the queues they use. 

Cheers,
John


On Mar 16, 2011, at 22:04, "sam_mis" <sameek at arosys.com> wrote:

> 
> Hi All
> 
> I am using Rabbitmq Java client.I have certain doubt in mind :
> 
> 1.Message queue is logical or physical existence in the memory?
> 2.Who creates the message queue; Producer/Consumer?
> 3.How can I know that message queue exist or not before publishing the
> message into a queue?
>   Is possible or not.if possible then please explain How?
> 
> Thanks
> -- 
> View this message in context: http://old.nabble.com/can-I-check-queue-exists-or-not--tp31169963p31169963.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From chen650 at yahoo.com  Thu Mar 17 05:39:20 2011
From: chen650 at yahoo.com (alex chen)
Date: Wed, 16 Mar 2011 22:39:20 -0700 (PDT)
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <27AB7A37-AC50-4D8C-8725-CE5C613BD677@vmware.com>
References: <486630.9133.qm@web31810.mail.mud.yahoo.com>
	<4D79C5C2.7010104@rabbitmq.com>
	<111862.43754.qm@web31808.mail.mud.yahoo.com>
	<4D79DF94.6030606@rabbitmq.com>
	<881183.67741.qm@web31810.mail.mud.yahoo.com>
	<4D7EA4C8.4040502@rabbitmq.com>
	<27AB7A37-AC50-4D8C-8725-CE5C613BD677@vmware.com>
Message-ID: <936622.81265.qm@web31816.mail.mud.yahoo.com>

John,

I tried building my previous patched amqp_consumer with latest rabbitmq-c, 
however, the build breaks because the current amqp.h does not support 
AMQP_SIMPLE_RPC anymore.  Ideally amqp.h should support the following function, 
as commented in my patch:

/* amqp.h should support this */
int amqp_basic_qos(amqp_connection_state_t state,
                           amqp_channel_t channel,
                           uint32_t prefetch_size,
                           uint16_t prefetch_count,
                           amqp_boolean_t global)

It would be nice if rabbitmq-c maintainer could add this api.  otherwise, i have 
to take a look at the src code and see if it can be implemented.


thanks.

-alex


________________________________
From: John DeTreville <john at detreville.org>
To: alex chen <chen650 at yahoo.com>
Cc: rabbitmq <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Wed, March 16, 2011 7:04:08 PM
Subject: Re: [rabbitmq-discuss] server crashes with very fast consumers

Alex,

I'm trying to reproduce your problems and I'm having a very hard time doing so.

Your example code is based on your own modifications to the sources in the 
rabbitmq-c/examples directory in some revision from last summer, which itself 
depends on some revision of rabbitmq-codegen from last summer. I'm having a hard 
time building it.

I'm guessing you've run all of this much more recently. Could you please mail us 
a bind.sh, producer.sh, and consumer.sh that work with the current 
rabbitmq-c/examples directory? Could you also add your modifications to the 
source code in the current rabbitmq-c/examples directory? This would help a 
great deal.

Even so, I've been able to reproduce some crashes, but I very much doubt they're 
the same crashes that you're seeing. Again, please tell me exactly what to do to 
reproduce your problem, starting with the current version of rabbitmq-c. Thank 
you.

Cheers,
John

On Mar 14, 2011, at 4:29 PM, Matthias Radestock wrote:

> Alex,
> 
> alex chen wrote:
>>> Any chance you could script the above to the point where all one 
>> needs to do is:
>>> 1) start clean rabbit
>>> 2) run test script
>>> 3) wait for broker to die
>> 
>> The test scripts are exactly the same as before:
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-August/008570.html
> 
> It would really help if you consolidated all that into a simple set up 
> as I mention above. As it stands we have to piece together the test code 
> and scripts from various emails. That a) takes time, and b) increases 
> the chances that we will be doing something slightly different and thus 
> not be able to reproduce the problem.
> 
> Regards,
> 
> Matthias.
> PS: please keep rabbitmq-discuss on the cc.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110316/de4cf3d5/attachment.htm>

From vdeepak at yahoo-inc.com  Thu Mar 17 05:48:41 2011
From: vdeepak at yahoo-inc.com (Deepak Vijayvergiy)
Date: Thu, 17 Mar 2011 11:18:41 +0530
Subject: [rabbitmq-discuss] can I check queue exists or not?
In-Reply-To: <D4857712-9F1F-49DC-B61E-DAF135A21889@vmware.com>
References: <31169963.post@talk.nabble.com>
	<D4857712-9F1F-49DC-B61E-DAF135A21889@vmware.com>
Message-ID: <B9F131D0-0FC4-4814-B89C-123CF40E928A@yahoo-inc.com>

Hi,
>> 2.Who creates the message queue; Producer/Consumer?
I think, queue creation is more about consumer, because a queue is bound to a binding key which is more of a consumer's concern instead of Producer.

>> 3.How can I know that message queue exist or not before publishing the message into a queue?
When you publish, you publish with routing key and its broker's work to route it to the queue having binding key which satisfies producer's routing key.
I mean, you can publish with routing key as PUB.ENABLE, and then you can publish with PUB.DISABLE. At the consumer side, it can have single queue for both routing keys (the binding key will be PUB.*) or it can have 2 separate queues.

Thanks
Regards
Deepak


On Mar 17, 2011, at 11:04 AM, John DeTreville wrote:

> Sam,
> 
> A message queue is a logical construct. You don't get to know how it is stored, but you don't need to know, because you access it through an interface. 
> 
> You create a queue by declaring it. Declaring it twice is the same as declaring it once, so it's reasonable for producers and consumers both to declare the queues they use. 
> 
> Cheers,
> John
> 
> 
> On Mar 16, 2011, at 22:04, "sam_mis" <sameek at arosys.com> wrote:
> 
>> 
>> Hi All
>> 
>> I am using Rabbitmq Java client.I have certain doubt in mind :
>> 
>> 1.Message queue is logical or physical existence in the memory?
>> 2.Who creates the message queue; Producer/Consumer?
>> 3.How can I know that message queue exist or not before publishing the
>> message into a queue?
>>  Is possible or not.if possible then please explain How?
>> 
>> Thanks
>> -- 
>> View this message in context: http://old.nabble.com/can-I-check-queue-exists-or-not--tp31169963p31169963.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From deven at dns.com  Thu Mar 17 06:17:38 2011
From: deven at dns.com (Deven Phillips)
Date: Thu, 17 Mar 2011 02:17:38 -0400
Subject: [rabbitmq-discuss] Question on Java Client
Message-ID: <4D81A782.9080209@dns.com>

I am working in an environment where Java/Python interop is important, 
so I have been trying to get the Java RabbitMQ client API and the 
Django/Celery tasks to work together. I can now successfully submit jobs 
to the CeleryD task queue and have them executed, but the call to 
channel.basicPublish() hangs.... It appears to be blocking while waiting 
on a response, but using a traffic sniffer, I see that the response has 
been received already. Could anyone suggest steps to find the cause? Is 
there a way to turn up the logging on the RabbitMQ API?

Anyhow, Thanks in advance for the assistance. Here are the vital stats:

Platform: Ubuntu 64 - 10.10 (Maverick)
RabbitMQ Version: 1.7.2
RabbitMQ API Version: 1.7.2
Celery Version: 2.2.4
Python Version: 2.6.5

Example Code:

package com.dns.celery.publisher;

import com.rabbitmq.client.AMQP;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.Channel;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.GregorianCalendar;
import java.util.TimeZone;
import java.util.UUID;
import org.apache.log4j.Appender;
import org.apache.log4j.ConsoleAppender;
import org.apache.log4j.Level;
import org.apache.log4j.Logger;
import org.apache.log4j.PatternLayout;

/**
  * A test application to submit a job to RabbitMQ which is compatible 
with Celery tasks.
  * @author <a href="deven at dns.com">Deven Phillips</a>
  */
public class Main {

     /**
      * @param args the command line arguments
      */
     public static void main(String[] args) throws Exception {
         Logger rootLog = Logger.getRootLogger() ;
         Appender console = new ConsoleAppender(new 
PatternLayout("%d{yyyy-MM-dd HH:mm:ss,SSS} - %5p [%t] (%F:%L) - %m%n")) ;
         rootLog.addAppender(console) ;
         rootLog.setLevel(Level.DEBUG) ;
         String queueName = "my_queue" ;

         ConnectionFactory factory = new ConnectionFactory();
         Connection connection = factory.newConnection("127.0.0.1");
         Channel channel = connection.createChannel();

         channel.queueDeclare(queueName, false, false, false, true, null);

         String uuId = UUID.randomUUID().toString() ;
         rootLog.info("TASK ID: "+uuId) ;
         DateFormat df1 = new SimpleDateFormat("yyyy-MM-dd") ;
         df1.setTimeZone(TimeZone.getTimeZone("GMT"));
         DateFormat df2 = new SimpleDateFormat("HH:mm:ss.S") ;
         df2.setTimeZone(TimeZone.getTimeZone("GMT"));
         Calendar cal = new GregorianCalendar() ;
         String eta = 
df1.format(cal.getTime())+"T"+df2.format(cal.getTime())+"0000" ;
         String messageBody = "{\"id\": \""+uuId+"\",\"task\": 
\"dns.tasks.build.domain\", \"args\": [76182], \"kwargs\": {}, 
\"retries\": 0, \"eta\": \""+eta+"\"}" ;
         rootLog.info(messageBody);
         byte[] msgBytes = messageBody.getBytes("ASCII") ;
         rootLog.info("Made it here!!") ;
         channel.basicPublish(queueName, queueName,
                      new AMQP.BasicProperties
                        ("application/json", null, null, null,
                         null, null, null, null,
                         null, null, null, "guest",
                         null, null),messageBody.getBytes("ASCII")) ;
     }
}

From benbennett at gmail.com  Thu Mar 17 07:09:05 2011
From: benbennett at gmail.com (Benjamin Bennett)
Date: Thu, 17 Mar 2011 02:09:05 -0500
Subject: [rabbitmq-discuss] Question on Java Client
Message-ID: <AANLkTim_=FxY7ZigEYzA8rK4cmDpSf_nFOmOw2fur1cc@mail.gmail.com>

Don't see any bindings. I would take a look at the samples at
http://www.rabbitmq.com/api-guide.html.i I would update your rabbit versions
too.
On Mar 17, 2011 1:18 AM, "Deven Phillips" <deven at dns.com> wrote:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110317/eaafc26e/attachment.htm>

From matthias at rabbitmq.com  Thu Mar 17 07:17:39 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 17 Mar 2011 07:17:39 +0000
Subject: [rabbitmq-discuss] Question on Java Client
In-Reply-To: <4D81A782.9080209@dns.com>
References: <4D81A782.9080209@dns.com>
Message-ID: <4D81B593.3020203@rabbitmq.com>

Deven Phillips wrote:
> the call to channel.basicPublish() hangs.... It appears to be
> blocking while waiting on a response, but using a traffic sniffer, I
> see that the response has been received already.

publishing is asynchronous - there is no response. Are you sure the 
program is actually blocked in that part of the code?

You are not closing the connection at the end. Since connections have a 
(non-daemon) thread backing them, the program will not exit while the 
connection is still alive. I suspect that's what it is happening here.

Regards,

Matthias.

From chen650 at yahoo.com  Thu Mar 17 07:32:11 2011
From: chen650 at yahoo.com (alex chen)
Date: Thu, 17 Mar 2011 00:32:11 -0700 (PDT)
Subject: [rabbitmq-discuss] server crashes with very fast consumers
Message-ID: <612060.14390.qm@web31807.mail.mud.yahoo.com>

Matthew,

> Maybe your test machine has only 1 SSD disk so the consuming rate could not 
>reach 300 MB/sec?


I was wrong in the previous email.  I tested it on regular disk and it still 
crashed.  The strange thing is that server-2.0.0 also crashed, which did not 
happen before. 


one thing i found is broker always shows "Memory limit set to 1638MB." in the 
log.  We have 16 GB RAM so it should be 40% of the RAM by default.   I will try 
to investigate more tomorrow.

-alex


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110317/43129da0/attachment.htm>

From deven at dns.com  Thu Mar 17 08:01:04 2011
From: deven at dns.com (Deven Phillips)
Date: Thu, 17 Mar 2011 04:01:04 -0400
Subject: [rabbitmq-discuss] Question on Java Client
In-Reply-To: <4D81B593.3020203@rabbitmq.com>
References: <4D81A782.9080209@dns.com> <4D81B593.3020203@rabbitmq.com>
Message-ID: <4D81BFC0.1010903@dns.com>

Matthias,

     Thanks much. That was exactly it...

Deven

On 03/17/2011 03:17 AM, Matthias Radestock wrote:
> Deven Phillips wrote:
>> the call to channel.basicPublish() hangs.... It appears to be
>> blocking while waiting on a response, but using a traffic sniffer, I
>> see that the response has been received already.
>
> publishing is asynchronous - there is no response. Are you sure the 
> program is actually blocked in that part of the code?
>
> You are not closing the connection at the end. Since connections have 
> a (non-daemon) thread backing them, the program will not exit while 
> the connection is still alive. I suspect that's what it is happening 
> here.
>
> Regards,
>
> Matthias.


From s4nchez at gmail.com  Thu Mar 17 09:58:43 2011
From: s4nchez at gmail.com (Ivan Sanchez)
Date: Thu, 17 Mar 2011 02:58:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin trashing a server?
Message-ID: <18287cca-8852-4d0d-890a-fb10af4472be@u8g2000yqh.googlegroups.com>


   Hi all,

   Yesterday we upgraded a rabbitmq cluster (4 disk nodes) to 2.3.1
and included the management plugin. After an hour or so under some
load, the management web UI stopped working on all nodes (requests
would just hang), and we noticed one of the nodes was using all
available CPU. Only after removing the plugin from all nodes and
restarting the cluster things went back to normal.

   Is there any known issue with the management plugin which could
cause that behaviour? If not, is there anything else I could do to
help identifying the problem?

   Thank you,

--
Ivan Sanchez

From dmaher at milestonelab.com  Thu Mar 17 10:26:30 2011
From: dmaher at milestonelab.com (Daniel Maher)
Date: Thu, 17 Mar 2011 11:26:30 +0100
Subject: [rabbitmq-discuss] Management plugin trashing a server?
In-Reply-To: <18287cca-8852-4d0d-890a-fb10af4472be@u8g2000yqh.googlegroups.com>
References: <18287cca-8852-4d0d-890a-fb10af4472be@u8g2000yqh.googlegroups.com>
Message-ID: <1300357590.2410.8.camel@danstation>

On Thu, 2011-03-17 at 02:58 -0700, Ivan Sanchez wrote:
> Hi all,
> 
>    Yesterday we upgraded a rabbitmq cluster (4 disk nodes) to 2.3.1
> and included the management plugin. After an hour or so under some
> load, the management web UI stopped working on all nodes (requests
> would just hang), and we noticed one of the nodes was using all
> available CPU. Only after removing the plugin from all nodes and
> restarting the cluster things went back to normal.
> 
>    Is there any known issue with the management plugin which could
> cause that behaviour? If not, is there anything else I could do to
> help identifying the problem?

Our two-node cluster had exactly the same thing happen to it just the
other day, actually - has anyone else had a similar experience with the
management plugin ?

-- 
Daniel Maher
? can't talk, too busy calculating computrons. ?


From alexandru at rabbitmq.com  Thu Mar 17 10:29:55 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 17 Mar 2011 12:29:55 +0200
Subject: [rabbitmq-discuss] rabbitmq-server init script
In-Reply-To: <62d14743-e9c6-436b-9f32-fc9a1fe6a4b1@b13g2000prf.googlegroups.com>
References: <20110309135151.GA14426@dakota.eng.vmware.com>
	<14035820.548.1299696932953.JavaMail.geo-discussion-forums@prfc6>
	<20110309211242.GA2355@dakota.doc.ic.ac.uk>
	<85c27985-2592-418d-b160-fa713a31f2fd@11g2000prf.googlegroups.com>
	<20110316121653.GA17092@dakota.eng.vmware.com>
	<62d14743-e9c6-436b-9f32-fc9a1fe6a4b1@b13g2000prf.googlegroups.com>
Message-ID: <20110317102955.GA2365@dakota.doc.ic.ac.uk>

I'm having trouble reproducing this.

On a fresh Centos install, the RPM does what it's supposed to do (and what
you say it does).  In /var/log/rabbitmq, there are some log files owned by
root and some owned by rabbitmq, but the root files are only ever accessed
by the init script, and that should be fine.

Is this what you're seeing?

  Starting rabbitmq-server: /etc/init.d/rabbitmq-server: line 43:
  /var/log/rabbitmq/startup_log: Permission denied
  TIMEOUT - check /var/log//rabbitmq/startup_{log,err}
  rabbitmq_server.

If so, are you starting the service as a non-root user?

Cheers,
Alex

On Wed, Mar 16, 2011 at 11:28:20AM -0700, paul wrote:
> 
> 
> On Mar 16, 5:16?am, Alexandru Scvor??ov <alexan... at rabbitmq.com>
> wrote:
> > > chown -R $USER:$USER $INIT_LOG_DIR
> >
> > That's interesting. ?Did you add some code to run rabbitmq as non-root?
> 
> nope.
> 
> > What is your INIT_LOG_DIR? (did you change it to a location that gets
> > wiped on restart?)
> 
> i installed from the RPM, which created the rabbitmq log directory in
> the appropriate place, and with the appropriate ownership as
> rabbitmq:rabbitmq - it's just that on restart apparently the logs
> would be created owned by root which would block startup.
> >
> > I see we don't automatically `mkdir $INIT_LOG_DIR` in the init script.
> > How are you creating it?
> 
> as above - was created at /var/log/rabbitmq by the rpm.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Thu Mar 17 10:39:24 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Mar 2011 10:39:24 +0000
Subject: [rabbitmq-discuss] Management plugin trashing a server?
In-Reply-To: <18287cca-8852-4d0d-890a-fb10af4472be@u8g2000yqh.googlegroups.com>
References: <18287cca-8852-4d0d-890a-fb10af4472be@u8g2000yqh.googlegroups.com>
Message-ID: <4D81E4DC.8090707@rabbitmq.com>

On 17/03/11 09:58, Ivan Sanchez wrote:
>     Is there any known issue with the management plugin which could
> cause that behaviour? If not, is there anything else I could do to
> help identifying the problem?

Nothing known, no. Is there anything suspicious looking in the logs from 
when this happened? (Or can you upload the logs somewhere so I can have 
a look at them if they don't contain anything sensitive?)

Cheers, Simon
-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From david at rabbitmq.com  Thu Mar 17 12:17:04 2011
From: david at rabbitmq.com (David Wragg)
Date: Thu, 17 Mar 2011 12:17:04 +0000
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <936622.81265.qm@web31816.mail.mud.yahoo.com> (alex chen's
	message of "Wed, 16 Mar 2011 22:39:20 -0700 (PDT)")
References: <486630.9133.qm@web31810.mail.mud.yahoo.com>
	<4D79C5C2.7010104@rabbitmq.com>
	<111862.43754.qm@web31808.mail.mud.yahoo.com>
	<4D79DF94.6030606@rabbitmq.com>
	<881183.67741.qm@web31810.mail.mud.yahoo.com>
	<4D7EA4C8.4040502@rabbitmq.com>
	<27AB7A37-AC50-4D8C-8725-CE5C613BD677@vmware.com>
	<936622.81265.qm@web31816.mail.mud.yahoo.com>
Message-ID: <yrv4cipvi6iwv.fsf@dwragg.eng.vmware.com>

Hi Alex,

alex chen <chen650 at yahoo.com> writes:
> I tried building my previous patched amqp_consumer with latest rabbitmq-c, 
> however, the build breaks because the current amqp.h does not support 
> AMQP_SIMPLE_RPC anymore.  Ideally amqp.h should support the following function, 
> as commented in my patch:
>
> /* amqp.h should support this */
> int amqp_basic_qos(amqp_connection_state_t state,
>                            amqp_channel_t channel,
>                            uint32_t prefetch_size,
>                            uint16_t prefetch_count,
>                            amqp_boolean_t global)
>
> It would be nice if rabbitmq-c maintainer could add this api.
> otherwise, i have to take a look at the src code and see if it can be
> implemented.

rabbitmq-c already has this API.  Many API functions, including this
one, are now generated from the AMQP spec, in order to ensure full
coverage of AMQP methods.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From matthew at rabbitmq.com  Thu Mar 17 12:27:39 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 17 Mar 2011 12:27:39 +0000
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development guide
 example
In-Reply-To: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
Message-ID: <20110317122738.GB2414@rabbitmq.com>

On Tue, Mar 15, 2011 at 07:00:28PM -0400, Jim Irrer wrote:
> If I checkout the latest server code, will I get the bug23274 fix?

Nope. bug23274 has been abandoned. bug23568 replaces it, but is yet to
go through QA. None of the documentation regarding writing plugins has
been updated.

> If not, what is the Mercurial command to get it?

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568

But you'll need to make sure all the plugins are also on branch bug23568
for them to work with the new build system.

If you're writing plugins from scratch, be sure to read the
rabbitmq-public-umbrella/README.makefiles file, which has a helpful
section on "Creating a new package".

Matthew

From allen.kim at epicadvertising.com  Thu Mar 17 14:01:01 2011
From: allen.kim at epicadvertising.com (Allen Kim)
Date: Thu, 17 Mar 2011 09:01:01 -0500
Subject: [rabbitmq-discuss] Rabbitmq-Shovel Timer-Based Publishing
 Possible?
In-Reply-To: <4D8132F6.8070504@rabbitmq.com>
Message-ID: <C9A787EF.360C%allen.kim@epicadvertising.com>

Replying in the context

On 11-03-16 6:00 PM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:


>Allen,
>
>Allen Kim wrote:
>> Message volume fluctuates from extremely high to very low depending on
>>the
>> time of day.
>> 
>> We use a relatively large transaction size on the outbound, publishing,
>> connection to get high enough throughput on a high latency link for the
>> peak times of day.  However, at the off peak times of day, it can take
>>up
>> to a few minutes for the shovel to accumulate enough messages to hit the
>> configured transaction commit size.
>> 
>> Allowing a configurable transaction size plus commit timer adds some
>> flexibility.  At peak times, the transaction size counter is always hit
>> first.  At low times, the timer hits first and ensures that  message
>> delivery does not stall.
>
>So you are employing transactions in order to get guaranteed delivery,
>right?

Sorry, I am not talking about guaranteed delivery, but I am talking about
delivery on time.

Think about this situation,

Data center A has a transaction, which must be passed to data center B IN
5 seconds.

I haven't thought about guaranteed delivery that you mentioned, which
sounds really good.



>
>I can see at least two alternative approaches here...
>
>1) instead of committing after a certain size/time, grow the tx as long
>as there are messages and only commit when there is a gap.

I don't get "when there is a gap". Gap between what?
>
>2) use confirms (http://www.rabbitmq.com/extensions.html#confirms) and
>only ack a message to the source once it has been confirmed by the
>destination.
>
>Both approaches require zero config - no obscure time/count knobs to
>tweak - which makes them rather appealing.
>
>Unfortunately the shovel currently doesn't support either of these. I've
>filed a bug to look into the latter.
>
>
>Regards,
>
>Matthias.


From matthias at rabbitmq.com  Thu Mar 17 14:04:53 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 17 Mar 2011 14:04:53 +0000
Subject: [rabbitmq-discuss] Rabbitmq-Shovel Timer-Based Publishing
	Possible?
In-Reply-To: <C9A787EF.360C%allen.kim@epicadvertising.com>
References: <C9A787EF.360C%allen.kim@epicadvertising.com>
Message-ID: <4D821505.2090601@rabbitmq.com>

Allen,

Allen Kim wrote:
> Sorry, I am not talking about guaranteed delivery, but I am talking about
> delivery on time.
> 
> Think about this situation,
> 
> Data center A has a transaction, which must be passed to data center B IN
> 5 seconds.

Where do AMQP transactions come into it? Why are you using them? I 
*thought* you employed them in order to ensure that messages got handled 
by the destination broker before ack'ing them to the source. That's what 
I mean by guaranteed delivery.

If you didn't use tx then the whole time/size-based batching wouldn't arise.


Matthias.

From lucasas at gmail.com  Thu Mar 17 14:18:52 2011
From: lucasas at gmail.com (Lucas Souza)
Date: Thu, 17 Mar 2011 07:18:52 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
	library
In-Reply-To: <0ccca993-b80b-4443-adce-cbccf59dd9ee@a21g2000prj.googlegroups.com>
References: <4D808637.3080609@rabbitmq.com>
	<AANLkTimRb0E6L6GzW62_h3Dyu0NOGrU+U+Wrt74eppwp@mail.gmail.com>
	<4D80C7D5.5050701@rabbitmq.com>
	<0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>
	<4D80D36C.5070505@rabbitmq.com>
	<a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>
	<4D80E03C.1040503@rabbitmq.com>
	<8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>
	<4D80EEE8.1050808@rabbitmq.com>
	<1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>
	<20110316173454.GE12427@wellquite.org>
	<0ccca993-b80b-4443-adce-cbccf59dd9ee@a21g2000prj.googlegroups.com>
Message-ID: <3e6a38de-13cc-44d8-876c-da39751d2029@gn5g2000vbb.googlegroups.com>

Anyone can help me?

On 16 mar, 16:10, Lucas Souza <luca... at gmail.com> wrote:
> Hello Matthew, thank you for your reply...
>
> If I use Java Client Library, this behavior is automatic?
>
> For example, if the real message was published on node A, and node A
> downs,
> and I connect on node B, will I receive the message?
>
> Regards.
>
> On 16 mar, 14:34, Matthew Sackman <matt... at rabbitmq.com> wrote:> On Wed, Mar 16, 2011 at 10:31:36AM -0700, Lucas Souza wrote:
> > > Emile, and how about publishing messages....
>
> > > If a connect on node A, I have to consume this message only on node A.
> > > If I'll go on node B, the message does not exist there, right?
>
> > Wrong. A cluster is one logical broker. ALL resources are visible from
> > any node within the cluster. Thus if you publish a msg whilst connected
> > to node A, it can be routed to a queue on node B, and be consumber by
> > another client connected to node C.
>
> > Matthew
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Thu Mar 17 14:23:02 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 17 Mar 2011 14:23:02 +0000
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
 library
In-Reply-To: <3e6a38de-13cc-44d8-876c-da39751d2029@gn5g2000vbb.googlegroups.com>
References: <0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>
	<4D80D36C.5070505@rabbitmq.com>
	<a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>
	<4D80E03C.1040503@rabbitmq.com>
	<8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>
	<4D80EEE8.1050808@rabbitmq.com>
	<1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>
	<20110316173454.GE12427@wellquite.org>
	<0ccca993-b80b-4443-adce-cbccf59dd9ee@a21g2000prj.googlegroups.com>
	<3e6a38de-13cc-44d8-876c-da39751d2029@gn5g2000vbb.googlegroups.com>
Message-ID: <20110317142301.GE2414@rabbitmq.com>

On Thu, Mar 17, 2011 at 07:18:52AM -0700, Lucas Souza wrote:
> Anyone can help me?

I'm sure we can!

> On 16 mar, 16:10, Lucas Souza <luca... at gmail.com> wrote:
> > If I use Java Client Library, this behavior is automatic?
> >
> > For example, if the real message was published on node A, and node A
> > downs,
> > and I connect on node B, will I receive the message?

Ok, so it's a bit more complex: each queue resides on a single node. As
a result, if that node fails, then the queue and its contents are lost.
There are a number of ways of working around this, ranging from
publishing to multiple redundant queues, to the pacemaker work
(http://www.rabbitmq.com/pacemaker.html), to experimental work in
development on mirrored queues.

Queues _reside_ on the node to which the client was connected when the
client created the queue initially. The queue is addressable from any
node within the cluster, both from a publishing and consuming pov.

Matthew

From s4nchez at gmail.com  Thu Mar 17 14:31:21 2011
From: s4nchez at gmail.com (Ivan Sanchez)
Date: Thu, 17 Mar 2011 07:31:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin trashing a server?
In-Reply-To: <4D81E4DC.8090707@rabbitmq.com>
References: <18287cca-8852-4d0d-890a-fb10af4472be@u8g2000yqh.googlegroups.com>
	<4D81E4DC.8090707@rabbitmq.com>
Message-ID: <d2491b27-4f4e-4980-ac13-e6b435050569@q36g2000yqn.googlegroups.com>

  Hi Simon,

  Thanks for the answer. Our log had a bunch of:

=ERROR REPORT==== 16-Mar-2011::10:09:53 ===
exception on TCP connection <0.364.0> from ******************:64318
{channel0_error,starting,
                {amqp_error,access_refused,
                            "AMQPLAIN login refused: user 'flash' -
invalid credentials",
                            'connection.start_ok'}}

   The user 'flash' is a valid login, and the only place it's used is
from our own app, where the password is properly set.

   In the logs I can see 4000+ of these in a 5 minutes periods shortly
after the server was started. They all came from external TCP
connections (none from our servers). After removing the plugins we
didn't get any of those errors anymore.

  Please let me know if there's any other info that could help on this
issue. And thanks again for the attention.

--
Ivan

On Mar 17, 10:39?am, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 17/03/11 09:58, Ivan Sanchez wrote:
>
> > ? ? Is there any known issue with the management plugin which could
> > cause that behaviour? If not, is there anything else I could do to
> > help identifying the problem?
>
> Nothing known, no. Is there anything suspicious looking in the logs from
> when this happened? (Or can you upload the logs somewhere so I can have
> a look at them if they don't contain anything sensitive?)
>
> Cheers, Simon
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From lucasas at gmail.com  Thu Mar 17 14:54:18 2011
From: lucasas at gmail.com (Lucas Souza)
Date: Thu, 17 Mar 2011 07:54:18 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
	library
In-Reply-To: <20110317142301.GE2414@rabbitmq.com>
References: <0753039c-a9b2-4fa1-a068-e723746d41e2@o30g2000pra.googlegroups.com>
	<4D80D36C.5070505@rabbitmq.com>
	<a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>
	<4D80E03C.1040503@rabbitmq.com>
	<8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>
	<4D80EEE8.1050808@rabbitmq.com>
	<1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>
	<20110316173454.GE12427@wellquite.org>
	<0ccca993-b80b-4443-adce-cbccf59dd9ee@a21g2000prj.googlegroups.com>
	<3e6a38de-13cc-44d8-876c-da39751d2029@gn5g2000vbb.googlegroups.com>
	<20110317142301.GE2414@rabbitmq.com>
Message-ID: <971b2162-2f92-4721-82f1-64b9c229e4e1@t13g2000vbo.googlegroups.com>

Is there other way to do this?

The guys here complain the DRBD mode.

Suppose that I decide to not use DRBD and Pacemaker to do replication
of messages. What will be the improvements that I win when using
RabbitMQ Clusters?

Actually, I'll need HA, not scalability. I guess that I dont need a
cluster, right?



On 17 mar, 11:23, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Thu, Mar 17, 2011 at 07:18:52AM -0700, Lucas Souza wrote:
> > Anyone can help me?
>
> I'm sure we can!
>
> > On 16 mar, 16:10, Lucas Souza <luca... at gmail.com> wrote:
> > > If I use Java Client Library, this behavior is automatic?
>
> > > For example, if the real message was published on node A, and node A
> > > downs,
> > > and I connect on node B, will I receive the message?
>
> Ok, so it's a bit more complex: each queue resides on a single node. As
> a result, if that node fails, then the queue and its contents are lost.
> There are a number of ways of working around this, ranging from
> publishing to multiple redundant queues, to the pacemaker work
> (http://www.rabbitmq.com/pacemaker.html), to experimental work in
> development on mirrored queues.
>
> Queues _reside_ on the node to which the client was connected when the
> client created the queue initially. The queue is addressable from any
> node within the cluster, both from a publishing and consuming pov.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Thu Mar 17 15:21:32 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 17 Mar 2011 15:21:32 +0000
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
 library
In-Reply-To: <971b2162-2f92-4721-82f1-64b9c229e4e1@t13g2000vbo.googlegroups.com>
References: <a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>
	<4D80E03C.1040503@rabbitmq.com>
	<8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>
	<4D80EEE8.1050808@rabbitmq.com>
	<1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>
	<20110316173454.GE12427@wellquite.org>
	<0ccca993-b80b-4443-adce-cbccf59dd9ee@a21g2000prj.googlegroups.com>
	<3e6a38de-13cc-44d8-876c-da39751d2029@gn5g2000vbb.googlegroups.com>
	<20110317142301.GE2414@rabbitmq.com>
	<971b2162-2f92-4721-82f1-64b9c229e4e1@t13g2000vbo.googlegroups.com>
Message-ID: <20110317152131.GF2414@rabbitmq.com>

On Thu, Mar 17, 2011 at 07:54:18AM -0700, Lucas Souza wrote:
> Actually, I'll need HA, not scalability. I guess that I dont need a
> cluster, right?

Correct! As the pacemaker guide says, you don't _have_ to use DRBD. Any
reliable shared storage mechanism will be fine.

Matthew

From lucasas at gmail.com  Thu Mar 17 15:34:30 2011
From: lucasas at gmail.com (Lucas Souza)
Date: Thu, 17 Mar 2011 08:34:30 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
	library
In-Reply-To: <20110317152131.GF2414@rabbitmq.com>
References: <a2c7e0c0-d37f-454e-ba36-95207134bd28@z3g2000prz.googlegroups.com>
	<4D80E03C.1040503@rabbitmq.com>
	<8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>
	<4D80EEE8.1050808@rabbitmq.com>
	<1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>
	<20110316173454.GE12427@wellquite.org>
	<0ccca993-b80b-4443-adce-cbccf59dd9ee@a21g2000prj.googlegroups.com>
	<3e6a38de-13cc-44d8-876c-da39751d2029@gn5g2000vbb.googlegroups.com>
	<20110317142301.GE2414@rabbitmq.com>
	<971b2162-2f92-4721-82f1-64b9c229e4e1@t13g2000vbo.googlegroups.com>
	<20110317152131.GF2414@rabbitmq.com>
Message-ID: <488b7e40-ed8e-4597-9a3e-2022b1d0a024@d16g2000yqd.googlegroups.com>

Do you know some interesting mechanism?

Thanks a lot

On 17 mar, 12:21, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Thu, Mar 17, 2011 at 07:54:18AM -0700, Lucas Souza wrote:
> > Actually, I'll need HA, not scalability. I guess that I dont need a
> > cluster, right?
>
> Correct! As the pacemaker guide says, you don't _have_ to use DRBD. Any
> reliable shared storage mechanism will be fine.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Thu Mar 17 15:37:09 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 17 Mar 2011 15:37:09 +0000
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
 library
In-Reply-To: <488b7e40-ed8e-4597-9a3e-2022b1d0a024@d16g2000yqd.googlegroups.com>
References: <8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>
	<4D80EEE8.1050808@rabbitmq.com>
	<1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>
	<20110316173454.GE12427@wellquite.org>
	<0ccca993-b80b-4443-adce-cbccf59dd9ee@a21g2000prj.googlegroups.com>
	<3e6a38de-13cc-44d8-876c-da39751d2029@gn5g2000vbb.googlegroups.com>
	<20110317142301.GE2414@rabbitmq.com>
	<971b2162-2f92-4721-82f1-64b9c229e4e1@t13g2000vbo.googlegroups.com>
	<20110317152131.GF2414@rabbitmq.com>
	<488b7e40-ed8e-4597-9a3e-2022b1d0a024@d16g2000yqd.googlegroups.com>
Message-ID: <20110317153709.GG2414@rabbitmq.com>

On Thu, Mar 17, 2011 at 08:34:30AM -0700, Lucas Souza wrote:
> Do you know some interesting mechanism?

Many. Pacemaker and DRBD is one option. Otherwise things like ENBD might
be worth a look, otherwise SANs or NASs should be ok.

Matthew

From lucasas at gmail.com  Thu Mar 17 15:52:40 2011
From: lucasas at gmail.com (Lucas Souza)
Date: Thu, 17 Mar 2011 08:52:40 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
	library
In-Reply-To: <20110317153709.GG2414@rabbitmq.com>
References: <8c1adaaa-4d2c-4991-918d-6340b95de5ae@k10g2000prh.googlegroups.com>
	<4D80EEE8.1050808@rabbitmq.com>
	<1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>
	<20110316173454.GE12427@wellquite.org>
	<0ccca993-b80b-4443-adce-cbccf59dd9ee@a21g2000prj.googlegroups.com>
	<3e6a38de-13cc-44d8-876c-da39751d2029@gn5g2000vbb.googlegroups.com>
	<20110317142301.GE2414@rabbitmq.com>
	<971b2162-2f92-4721-82f1-64b9c229e4e1@t13g2000vbo.googlegroups.com>
	<20110317152131.GF2414@rabbitmq.com>
	<488b7e40-ed8e-4597-9a3e-2022b1d0a024@d16g2000yqd.googlegroups.com>
	<20110317153709.GG2414@rabbitmq.com>
Message-ID: <3cd77dbe-939c-4d97-bb01-5cae1f2de349@m7g2000vbq.googlegroups.com>

I'll look that...

Do you recommend that I use a HAProxy in front my Rabbits? Or Can I do
this:

ConnectionFactory factory = new ConnectionFactory();
Address[] addresses = {new Address("localhost", 12345), new
Address("localhost", 12346)};
factory.newConnection(addresses);

Thanks :D

On 17 mar, 12:37, Matthew Sackman <matt... at rabbitmq.com> wrote:
> On Thu, Mar 17, 2011 at 08:34:30AM -0700, Lucas Souza wrote:
> > Do you know some interesting mechanism?
>
> Many. Pacemaker and DRBD is one option. Otherwise things like ENBD might
> be worth a look, otherwise SANs or NASs should be ok.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Thu Mar 17 16:10:16 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 17 Mar 2011 16:10:16 +0000
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
 library
In-Reply-To: <3cd77dbe-939c-4d97-bb01-5cae1f2de349@m7g2000vbq.googlegroups.com>
References: <1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>
	<20110316173454.GE12427@wellquite.org>
	<0ccca993-b80b-4443-adce-cbccf59dd9ee@a21g2000prj.googlegroups.com>
	<3e6a38de-13cc-44d8-876c-da39751d2029@gn5g2000vbb.googlegroups.com>
	<20110317142301.GE2414@rabbitmq.com>
	<971b2162-2f92-4721-82f1-64b9c229e4e1@t13g2000vbo.googlegroups.com>
	<20110317152131.GF2414@rabbitmq.com>
	<488b7e40-ed8e-4597-9a3e-2022b1d0a024@d16g2000yqd.googlegroups.com>
	<20110317153709.GG2414@rabbitmq.com>
	<3cd77dbe-939c-4d97-bb01-5cae1f2de349@m7g2000vbq.googlegroups.com>
Message-ID: <20110317161015.GH2414@rabbitmq.com>

Greetings!

On Thu, Mar 17, 2011 at 08:52:40AM -0700, Lucas Souza wrote:
> Do you recommend that I use a HAProxy in front my Rabbits? Or Can I do
> this:
> 
> ConnectionFactory factory = new ConnectionFactory();
> Address[] addresses = {new Address("localhost", 12345), new
> Address("localhost", 12346)};
> factory.newConnection(addresses);

You can certainly do that. However, that's baking into your code both
ports and addresses, which means that should you need to migrate your
cluster/ha-setup elsewhere, you'll have to recompile your clients. Thus
it might be better to us something like ha-proxy, or maybe just
DNS (round-robin or not) with a very short TTL will suffice. There are
many ways to skin this particular Rabbit...

Matthew

From allen.kim at epicadvertising.com  Thu Mar 17 16:11:40 2011
From: allen.kim at epicadvertising.com (Allen Kim)
Date: Thu, 17 Mar 2011 11:11:40 -0500
Subject: [rabbitmq-discuss] Rabbitmq-Shovel Timer-Based Publishing
 Possible?
In-Reply-To: <4D821505.2090601@rabbitmq.com>
Message-ID: <C9A7A526.3651%allen.kim@epicadvertising.com>

I might have confused you using term transaction. My apologize if I did.
what I meant was a message.

For us, AMQP transaction is also required, since we do not ack. messages
one by one.

We are sending thousands of messages to other d.c., then commit when it is
reached to certain size.

I *also* want to commit the transaction by timer, so that I can *see* that
message is delivered and cleaned up(acknowledged).

I might have guessed wrongly that message is not delivered/consumed before
transaction is committed.
If you say the message is delivered/consumed before the transaction
committed(unacknowledged), it is good enough for us.

Allen

On 11-03-17 10:04 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Allen,
>
>Allen Kim wrote:
>> Sorry, I am not talking about guaranteed delivery, but I am talking
>>about
>> delivery on time.
>> 
>> Think about this situation,
>> 
>> Data center A has a transaction, which must be passed to data center B
>>IN
>> 5 seconds.
>
>Where do AMQP transactions come into it? Why are you using them? I
>*thought* you employed them in order to ensure that messages got handled
>by the destination broker before ack'ing them to the source. That's what
>I mean by guaranteed delivery.
>
>If you didn't use tx then the whole time/size-based batching wouldn't
>arise.
>
>
>Matthias.


From matthias at rabbitmq.com  Thu Mar 17 16:19:20 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 17 Mar 2011 16:19:20 +0000
Subject: [rabbitmq-discuss] Rabbitmq-Shovel Timer-Based Publishing
	Possible?
In-Reply-To: <C9A7A526.3651%allen.kim@epicadvertising.com>
References: <C9A7A526.3651%allen.kim@epicadvertising.com>
Message-ID: <4D823488.70106@rabbitmq.com>

Allen,

Allen Kim wrote:
> I might have guessed wrongly that message is not delivered/consumed before
> transaction is committed.
> If you say the message is delivered/consumed before the transaction
> committed(unacknowledged), it is good enough for us.

Reliable publication requires use of either tx or confirm mode. The 
latter is far more efficient. The two recommendations I posted for 
handling your use case without resorting to timers or counters - one 
using tx and one using confirm - were based on the assumption that your 
use of tx was solely in order to ensure guaranteed message transmission. 
That does indeed appear to be the case.

Regards,

Matthias.

From lucasas at gmail.com  Thu Mar 17 17:10:21 2011
From: lucasas at gmail.com (Lucas Souza)
Date: Thu, 17 Mar 2011 10:10:21 -0700 (PDT)
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
	library
In-Reply-To: <20110317161015.GH2414@rabbitmq.com>
References: <1eeeb583-33eb-4753-9e91-8eca86d291dc@j13g2000pro.googlegroups.com>
	<20110316173454.GE12427@wellquite.org>
	<0ccca993-b80b-4443-adce-cbccf59dd9ee@a21g2000prj.googlegroups.com>
	<3e6a38de-13cc-44d8-876c-da39751d2029@gn5g2000vbb.googlegroups.com>
	<20110317142301.GE2414@rabbitmq.com>
	<971b2162-2f92-4721-82f1-64b9c229e4e1@t13g2000vbo.googlegroups.com>
	<20110317152131.GF2414@rabbitmq.com>
	<488b7e40-ed8e-4597-9a3e-2022b1d0a024@d16g2000yqd.googlegroups.com>
	<20110317153709.GG2414@rabbitmq.com>
	<3cd77dbe-939c-4d97-bb01-5cae1f2de349@m7g2000vbq.googlegroups.com>
	<20110317161015.GH2414@rabbitmq.com>
Message-ID: <5ef3f6a4-ec0f-46f6-84c5-e21f4bacd8a6@f2g2000yqf.googlegroups.com>

Thanks for help me Matthew...

Coming soon I'll post what I did. You clarified my ideas.

Regards

On 17 mar, 13:10, Matthew Sackman <matt... at rabbitmq.com> wrote:
> Greetings!
>
> On Thu, Mar 17, 2011 at 08:52:40AM -0700, Lucas Souza wrote:
> > Do you recommend that I use a HAProxy in front my Rabbits? Or Can I do
> > this:
>
> > ConnectionFactory factory = new ConnectionFactory();
> > Address[] addresses = {new Address("localhost", 12345), new
> > Address("localhost", 12346)};
> > factory.newConnection(addresses);
>
> You can certainly do that. However, that's baking into your code both
> ports and addresses, which means that should you need to migrate your
> cluster/ha-setup elsewhere, you'll have to recompile your clients. Thus
> it might be better to us something like ha-proxy, or maybe just
> DNS (round-robin or not) with a very short TTL will suffice. There are
> many ways to skin this particular Rabbit...
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Thu Mar 17 17:16:44 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 17 Mar 2011 17:16:44 +0000
Subject: [rabbitmq-discuss] How can I connect in a cluster using Java
 library
In-Reply-To: <5ef3f6a4-ec0f-46f6-84c5-e21f4bacd8a6@f2g2000yqf.googlegroups.com>
References: <0ccca993-b80b-4443-adce-cbccf59dd9ee@a21g2000prj.googlegroups.com>
	<3e6a38de-13cc-44d8-876c-da39751d2029@gn5g2000vbb.googlegroups.com>
	<20110317142301.GE2414@rabbitmq.com>
	<971b2162-2f92-4721-82f1-64b9c229e4e1@t13g2000vbo.googlegroups.com>
	<20110317152131.GF2414@rabbitmq.com>
	<488b7e40-ed8e-4597-9a3e-2022b1d0a024@d16g2000yqd.googlegroups.com>
	<20110317153709.GG2414@rabbitmq.com>
	<3cd77dbe-939c-4d97-bb01-5cae1f2de349@m7g2000vbq.googlegroups.com>
	<20110317161015.GH2414@rabbitmq.com>
	<5ef3f6a4-ec0f-46f6-84c5-e21f4bacd8a6@f2g2000yqf.googlegroups.com>
Message-ID: <20110317171643.GI2414@rabbitmq.com>

On Thu, Mar 17, 2011 at 10:10:21AM -0700, Lucas Souza wrote:
> Thanks for help me Matthew...

Glad to help.

> Coming soon I'll post what I did. You clarified my ideas.

Sounds good.

Matthew

From gmr at myyearbook.com  Thu Mar 17 17:26:49 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 17 Mar 2011 13:26:49 -0400
Subject: [rabbitmq-discuss] Max Cluster Size?
Message-ID: <4D824459.8040306@myyearbook.com>

Is there a pre-established recommended or practical max-cluster size?

In a particular architecture discussion focused around event processing, 
I am contemplating using a local RabbitMQ node per web server to capture 
events locally. A small pool of consumers would then crunch the data 
from across the cluster in as real-time of a basis as is possible. If I 
went down this route, I'd be starting with a ~500 node cluster and would 
size consumers to match message velocity and would need to be able to at 
least double the cluster size.

The alternative is to use a much smaller cluster and use JSON-RPC 
Channel plugin.

Thanks in advance,

Gavin


From tonygarnockjones+rabbitmq at gmail.com  Thu Mar 17 17:36:20 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Thu, 17 Mar 2011 13:36:20 -0400
Subject: [rabbitmq-discuss] Max Cluster Size?
In-Reply-To: <4D824459.8040306@myyearbook.com>
References: <4D824459.8040306@myyearbook.com>
Message-ID: <AANLkTimdHKKv==ESD5bBiS7O=XoQTsNthdkTp8RU1rLp@mail.gmail.com>

Last I heard, Erlang distribution (and hence RabbitMQ clustering)
doesn't scale well past around 32-64 nodes. That could be seriously
out-of-date information, of course :-)

You might be better using a centralised smaller cluster or some kind
of relay tool for inter-broker communication.

Regards,
  Tony

On 17 March 2011 13:26, Gavin M. Roy <gmr at myyearbook.com> wrote:
> Is there a pre-established recommended or practical max-cluster size?
>
> In a particular architecture discussion focused around event processing, I
> am contemplating using a local RabbitMQ node per web server to capture
> events locally. A small pool of consumers would then crunch the data from
> across the cluster in as real-time of a basis as is possible. If I went down
> this route, I'd be starting with a ~500 node cluster and would size
> consumers to match message velocity and would need to be able to at least
> double the cluster size.
>
> The alternative is to use a much smaller cluster and use JSON-RPC Channel
> plugin.
>
> Thanks in advance,
>
> Gavin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Thu Mar 17 18:12:28 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 17 Mar 2011 18:12:28 +0000
Subject: [rabbitmq-discuss] Management plugin trashing a server?
In-Reply-To: <d2491b27-4f4e-4980-ac13-e6b435050569@q36g2000yqn.googlegroups.com>
References: <18287cca-8852-4d0d-890a-fb10af4472be@u8g2000yqh.googlegroups.com>	<4D81E4DC.8090707@rabbitmq.com>
	<d2491b27-4f4e-4980-ac13-e6b435050569@q36g2000yqn.googlegroups.com>
Message-ID: <4D824F0C.5080509@rabbitmq.com>

On 17/03/11 14:31, Ivan Sanchez wrote:
>    Thanks for the answer. Our log had a bunch of:
>
> =ERROR REPORT==== 16-Mar-2011::10:09:53 ===
> exception on TCP connection<0.364.0>  from ******************:64318
> {channel0_error,starting,
>                  {amqp_error,access_refused,
>                              "AMQPLAIN login refused: user 'flash' -
> invalid credentials",
>                              'connection.start_ok'}}
>
>     The user 'flash' is a valid login, and the only place it's used is
> from our own app, where the password is properly set.
>
>     In the logs I can see 4000+ of these in a 5 minutes periods shortly
> after the server was started. They all came from external TCP
> connections (none from our servers). After removing the plugins we
> didn't get any of those errors anymore.

Hmm. I'm very inclined to think that must be a coincidence.

That log message is not one that can be produced by the management 
plugin - that's a remote host trying and failing to connect over AMQP.

Interestingly it's using the (slightly) oddball AMQPLAIN authentication 
mechanism, which implies it's either the RabbitMQ Erlang client from 
2.2.0 or earlier (or something that uses that, like rabbitmq-shovel), or 
one of the old QPid clients. Does that sound like anything that could be 
on your network?

I would certainly be inclined to find out who owns the hosts in question 
and go and have a word.

Of course, the fact that this was able to make the server hang is not 
great. There are some anti-DOS provisions in recent versions of 
RabbitMQ, but they don't really help when a ton of hosts are all trying 
to connect at once.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From paul.theodoropoulos at gmail.com  Thu Mar 17 18:56:17 2011
From: paul.theodoropoulos at gmail.com (paul)
Date: Thu, 17 Mar 2011 11:56:17 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-server init script
In-Reply-To: <20110317102955.GA2365@dakota.doc.ic.ac.uk>
References: <20110309135151.GA14426@dakota.eng.vmware.com>
	<14035820.548.1299696932953.JavaMail.geo-discussion-forums@prfc6>
	<20110309211242.GA2355@dakota.doc.ic.ac.uk>
	<85c27985-2592-418d-b160-fa713a31f2fd@11g2000prf.googlegroups.com>
	<20110316121653.GA17092@dakota.eng.vmware.com>
	<62d14743-e9c6-436b-9f32-fc9a1fe6a4b1@b13g2000prf.googlegroups.com>
	<20110317102955.GA2365@dakota.doc.ic.ac.uk>
Message-ID: <b4b9452b-fc62-453f-9a40-dcc97e33878d@s18g2000prg.googlegroups.com>



On Mar 17, 3:29?am, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> I'm having trouble reproducing this.
>
> On a fresh Centos install, the RPM does what it's supposed to do (and what
> you say it does). ?In /var/log/rabbitmq, there are some log files owned by
> root and some owned by rabbitmq, but the root files are only ever accessed
> by the init script, and that should be fine.
>
> Is this what you're seeing?
>
> ? Starting rabbitmq-server: /etc/init.d/rabbitmq-server: line 43:
> ? /var/log/rabbitmq/startup_log: Permission denied
> ? TIMEOUT - check /var/log//rabbitmq/startup_{log,err}
> ? rabbitmq_server.

i believe that's the error, yeah.


> If so, are you starting the service as a non-root user?

no, it just starts from the init script run as user root - the only
changes i made to the init script are as described in my previous
message. but after it starts up, the processes are running under
rabbitmq ownership -


[root at app06 rabbitmq]# ps -ecf|grep rabb
rabbitmq  2545     1 TS   24 Mar14 ?        00:00:00 /usr/local/lib/
erlang/erts-5.8.2/bin/epmd -daemon
rabbitmq  2556     1 TS   21 Mar14 ?        00:02:56 /usr/local/lib/
erlang/erts-5.8.2/bin/beam.smp -W w -K true -A30 -P 1048576 -- -root /
usr/local/lib/erlang -progname erl -- -home /var/lib/rabbitmq -- -
noshell -noinput -sname rabbit at app06 -boot /var/lib/rabbitmq/mnesia/
rabbit at app06-plugins-expand/rabbit -kernel inet_default_listen_options
[{nodelay,true}] -kernel inet_default_connect_options [{nodelay,true}]
-sasl errlog_type error -kernel error_logger {file,"/var/log/rabbitmq/
rabbit at app06.log"} -sasl sasl_error_logger {file,"/var/log/rabbitmq/
rabbit at app06-sasl.log"} -os_mon start_cpu_sup true -os_mon
start_disksup false -os_mon start_memsup false -mnesia dir "/var/lib/
rabbitmq/mnesia/rabbit at app06" -noshell -noinput
rabbitmq  2625  2556 TS   24 Mar14 ?        00:00:00 inet_gethost 4
rabbitmq  2626  2625 TS   21 Mar14 ?        00:00:00 inet_gethost 4
rabbitmq  2627  2556 TS   21 Mar14 ?        00:00:00 /usr/local/lib/
erlang/lib/os_mon-2.2.5/priv/bin/cpu_sup


without the change in ownership of the logfiles, it starts
successfully (seemingly) but only a couple of procs are left running
(i don't remember which, sorry - i think just the first one listed
above)

From fabiomargarido at gmail.com  Thu Mar 17 19:55:19 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Thu, 17 Mar 2011 16:55:19 -0300
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTik=+kvtcQmaaB-BWuq9QWFpxqrp1oDey5dPzvtU@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
	<4D6EE8B2.6030507@rabbitmq.com>
	<AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>
	<4D6F908E.2030209@rabbitmq.com>
	<AANLkTimo-XAOsd_paeJAbud=RpzertM8oEPDPLHdacO4@mail.gmail.com>
	<4D6FB9DC.2080800@rabbitmq.com>
	<AANLkTi=rLYV90KSv4b8e=AcKiiukP=yPVy4vXLTpbCbA@mail.gmail.com>
	<4D703B6C.6010608@rabbitmq.com>
	<AANLkTik=+kvtcQmaaB-BWuq9QWFpxqrp1oDey5dPzvtU@mail.gmail.com>
Message-ID: <AANLkTik8M_Wr2O4+q_q33iEC2rxkrar6Zjsdy+p_7EfO@mail.gmail.com>

Hi Michael,

sorry to keep bothering you, but do you have a word on this last question?
Thank you.

On Thu, Mar 10, 2011 at 10:36, Fabio Margarido <fabiomargarido at gmail.com>wrote:

> Hi Michael.
>
> I've worked a bit more on my tests by now and another doubt has come
> up. Is there any way to make messages exchanged through x-lvc
> persistent? The scenario I'm exercising is: the publisher sends a
> message to the broker, it is consumed a few times, the broker dies and
> starts up again, then a few new consumers try to receive the message.
> I can't get this to work yet.
>
> From what I've seen in my tests, the exchange only works with
> exclusive queues, is that correct? I've tried creating a named,
> durable queue for all consumers to read from, but in this case the
> message can only be consumed once.
>
> Is there something I'm missing?
>
> Thank you.
>
> On Thu, Mar 3, 2011 at 22:07, Michael Bridgen <mikeb at rabbitmq.com> wrote:
> > Fabio,
> >
> > Aces, glad to hear it's working for you thus far.
> >
> > On this:
> >
> >> Just a final question: the previous README file on github said
> >> something about including the plugin on the main RabbitMQ code, but I
> >> figured this had been written some time ago because it mentioned
> >> version 1.7.1. Is this still in your (and RabbitMQ developers) plans?
> >> Best regards.
> >
> >  -- I was referring to the exchange plugin mechanism overall, on which I
> was
> > finishing (largely other people's!) work at the time.  That mechanism has
> > been in mainstream rabbitmq since then, and has changed a bit, but is
> pretty
> > stable.
> >
> > The Last Value Caching exchange will likely stay a plugin for the
> > foreseeable future, rather than being baked into rabbitmq-server.  But if
> > you follow this list you'll know this is not the last word ..
> >
> > Michael
> >
> >>> Oh.  Looks like github's upload and download system is totally broken.
> >>> (I've
> >>> now tried to upload it a few times).
> >>>
> >>> I've attached the ez so it can be stopped by mail filters instead.
> >>
> >> Hi Michael.
> >> Sorry for the extra trouble.
> >>
> >> I've now rebooted my RabbitMQ server and run a few basic tests and
> >> everything seems to be working as expected. Thank you again for all
> >> your help and your work on the plugin. I'll keep building my test
> >> scenarios and I'll let you know if something else comes up.
> >>
> >> Just a final question: the previous README file on github said
> >> something about including the plugin on the main RabbitMQ code, but I
> >> figured this had been written some time ago because it mentioned
> >> version 1.7.1. Is this still in your (and RabbitMQ developers) plans?
> >> Best regards.
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110317/ad98902d/attachment-0001.htm>

From chen650 at yahoo.com  Fri Mar 18 03:48:58 2011
From: chen650 at yahoo.com (alex chen)
Date: Thu, 17 Mar 2011 20:48:58 -0700 (PDT)
Subject: [rabbitmq-discuss] server crashes with very fast consumers
Message-ID: <96847.77155.qm@web31808.mail.mud.yahoo.com>

Matthew:


> one thing i found is broker always shows "Memory limit set to 1638MB." in the 
>log.  We have 16 GB RAM so it should be 40% of the RAM by default.   I will try 
>to  investigate more tomorrow.

It turns out that I was running the broker using 32 bit binary, that is why the 
memory limit is 40% * 4GB = 1.6 GB.  the broker would crash if there are more 
than 50 GB of messages in 1000 queues.  When this happened, the  memory usage 
reached 4 GB.
If I run the broker using 64 bit,  it does not crash because it could get more 
than 6 GB of memory.   It was able to consume all the messages at rate of 
100-200 MB/sec.

Thanks.

-alex


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110317/fd5f0577/attachment.htm>

From htinlinnhtun at gmail.com  Fri Mar 18 03:41:35 2011
From: htinlinnhtun at gmail.com (Lin Tun)
Date: Thu, 17 Mar 2011 23:41:35 -0400
Subject: [rabbitmq-discuss] Exchange and queue design/best practices for
	social event updates
Message-ID: <AANLkTi=gYxck4sN7JPr_f-fe6CEveTD0FN6WfVu-cyaU@mail.gmail.com>

Hi All,

I'm new to RabbitMQ and planning to use RabbitMQ in our social application.
Would like to receive more advices on design approaches and best practices
form you all.

The following is the basic requirements of our system:

The whole application is called community.  Inside community we have groups.
In each group, user can have discussion topics within the group.
User can share file/resource to community.
There is a wall page for user.  Also there is a wall page for the group.



(EVENT-1 :: if user share a file/resource to community)

- update on wall of that user

- update on wall of all friends

- add to moderation queue

*TARGET*: self, friends;

*ACTION*: update wall, add to moderation


(EVENT-2 :: if someone comments on shared file/resource of community)

- update on wall of that user (primary actor)

- update on wall of all other people (other actors) who also commented on
the resource

- update on wall of all friends of primary actor

- notify to all other people (other actors) who also commented on the
resource

*TARGET*: primary actor, friends, other actors;

*ACTION*: update wall, notify


(EVENT-3 :: admin delete particular file/resource from community)
- clean up work
- notify the owner
*TARGET*: owner
*ACTION*: clean up, notify


(EVENT-4 :: if user post a conversation to certain discussion topic within
the group)

- update to group wall

- update to group members' wall

- notify to all group members

- classify trending of the discussion

*TARGET*: group, group members

*ACTION*: update wall, notify, classify trending



This is my initial plan:

- planning to use *topic exchange* for that.

- use queues binding such as ( #.self , #.friends, #.group, #.groupmembers,
#.otheractors )


But my concern is:

-  how do we mix together the *TARGET* and *ACTION* so that one routing key
will cover all possible combination?

- do I require to send 2 messages with different routing keys to get the
possible combination?  (which I don't really want to since the publisher
will have too much knowledge about the business rule)

- Is it the right approach?  Or should I just have either of ACTION or
TARGET and have the consumer decide based on the event type?

- What is the recommended number of exchanges for such situation?

- Would be great if you could suggest the good naming practice for queue and
exchange.


OR if my approach is not appropriate, please kindly suggest the workaround
and fixes so that I could learn.


Thanks guys.

Alex
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110317/0d60a51b/attachment.htm>

From john at detreville.org  Fri Mar 18 04:45:57 2011
From: john at detreville.org (John DeTreville)
Date: Thu, 17 Mar 2011 21:45:57 -0700
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <96847.77155.qm@web31808.mail.mud.yahoo.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
Message-ID: <E029FC4C-CDE0-4FF2-B23F-486A577A95E2@detreville.org>

Alex,

When your broker crashes, does it produce anything interesting in the console output or in the log files?

Cheers,
John


On Mar 17, 2011, at 20:48, alex chen <chen650 at yahoo.com> wrote:

> Matthew:
> 
> > one thing i found is broker always shows "Memory limit set to 1638MB." in the log.  We have 16 GB RAM so it should be 40% of the RAM by default.  I will try to investigate more tomorrow.
> 
> It turns out that I was running the broker using 32 bit binary, that is why the memory limit is 40% * 4GB = 1.6 GB.  the broker would crash if there are more than 50 GB of messages in 1000 queues.  When this happened, the  memory usage reached 4 GB.
> If I run the broker using 64 bit,  it does not crash because it could get more than 6 GB of memory.   It was able to consume all the messages at rate of 100-200 MB/sec.
> 
> Thanks.
> 
> -alex
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110317/38ec5f5f/attachment.htm>

From chen650 at yahoo.com  Fri Mar 18 07:54:00 2011
From: chen650 at yahoo.com (alex chen)
Date: Fri, 18 Mar 2011 00:54:00 -0700 (PDT)
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <E029FC4C-CDE0-4FF2-B23F-486A577A95E2@detreville.org>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<E029FC4C-CDE0-4FF2-B23F-486A577A95E2@detreville.org>
Message-ID: <997811.21941.qm@web31805.mail.mud.yahoo.com>

John,


> When your broker crashes, does it produce anything interesting in the console 
>output or in the log files?

sometimes the log showed reaching memory limit, nothing else interesting.

-alex


On Mar 17, 2011, at 20:48, alex chen <chen650 at yahoo.com> wrote:


Matthew:
>
>
>> one thing i found is broker always shows "Memory limit set to 1638MB." in the 
>>log.  We have 16 GB RAM so it should be 40% of the RAM by default.   I will try 
>>to  investigate more tomorrow.
>
>It turns out that I was running the broker using 32 bit binary, that is why the 
>memory limit is 40% * 4GB = 1.6 GB.  the broker would crash if there are more 
>than 50 GB of messages in 1000 queues.  When this happened, the  memory usage 
>reached 4 GB.
>If I run the broker using 64 bit,  it does not crash because it could get more 
>than 6 GB of memory.   It was able to consume all the messages at rate of 
>100-200 MB/sec.
>
>Thanks.
>
>-alex
>
>
>
>
>
_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110318/0b636d63/attachment-0001.htm>

From matthew at rabbitmq.com  Fri Mar 18 09:04:03 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 18 Mar 2011 09:04:03 +0000
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <96847.77155.qm@web31808.mail.mud.yahoo.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
Message-ID: <20110318090403.GC2752@rabbitmq.com>

Hi Alex,

On Thu, Mar 17, 2011 at 08:48:58PM -0700, alex chen wrote:
> memory limit is 40% * 4GB = 1.6 GB.  the broker would crash if there are more 
> than 50 GB of messages in 1000 queues.  When this happened, the  memory usage 
> reached 4 GB.
> If I run the broker using 64 bit,  it does not crash because it could get more 
> than 6 GB of memory.   It was able to consume all the messages at rate of 
> 100-200 MB/sec.

Good to hear, and that must be one fast running Rabbit! I'll check the
memory limits code - we can detect whether we're in a 32-bit VM or not I
think, so if so, it seems likely to make sense we take
0.4 * min[4GB, RAM]. Certainly, in general, Rabbit just shouldn't crash.

Matthew

From s4nchez at gmail.com  Fri Mar 18 09:12:53 2011
From: s4nchez at gmail.com (Ivan Sanchez)
Date: Fri, 18 Mar 2011 02:12:53 -0700 (PDT)
Subject: [rabbitmq-discuss] Management plugin trashing a server?
In-Reply-To: <4D824F0C.5080509@rabbitmq.com>
References: <18287cca-8852-4d0d-890a-fb10af4472be@u8g2000yqh.googlegroups.com>
	<4D81E4DC.8090707@rabbitmq.com>
	<d2491b27-4f4e-4980-ac13-e6b435050569@q36g2000yqn.googlegroups.com>
	<4D824F0C.5080509@rabbitmq.com>
Message-ID: <9a5178a1-0a48-4f5d-b2ce-3a45912161f3@n10g2000yqf.googlegroups.com>

   We are still using the java rabbitmq client 2.1. We also use a amqp
0.8 actionscript3 library to connect from flash (only place where the
user 'flash' is used).

   Agreed that it seems like a coincidence all this authentication
errors. Unfortunately there was nothing else unusual in the logs.

   Thanks for the help, anyway. If there's anything else I could look
for please let me know.

--
Ivan

On Mar 17, 6:12?pm, Simon MacMullen <si... at rabbitmq.com> wrote:
> On 17/03/11 14:31, Ivan Sanchez wrote:
>
> > ? ?Thanks for the answer. Our log had a bunch of:
>
> > =ERROR REPORT==== 16-Mar-2011::10:09:53 ===
> > exception on TCP connection<0.364.0> ?from ******************:64318
> > {channel0_error,starting,
> > ? ? ? ? ? ? ? ? ?{amqp_error,access_refused,
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?"AMQPLAIN login refused: user 'flash' -
> > invalid credentials",
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?'connection.start_ok'}}
>
> > ? ? The user 'flash' is a valid login, and the only place it's used is
> > from our own app, where the password is properly set.
>
> > ? ? In the logs I can see 4000+ of these in a 5 minutes periods shortly
> > after the server was started. They all came from external TCP
> > connections (none from our servers). After removing the plugins we
> > didn't get any of those errors anymore.
>
> Hmm. I'm very inclined to think that must be a coincidence.
>
> That log message is not one that can be produced by the management
> plugin - that's a remote host trying and failing to connect over AMQP.
>
> Interestingly it's using the (slightly) oddball AMQPLAIN authentication
> mechanism, which implies it's either the RabbitMQ Erlang client from
> 2.2.0 or earlier (or something that uses that, like rabbitmq-shovel), or
> one of the old QPid clients. Does that sound like anything that could be
> on your network?
>
> I would certainly be inclined to find out who owns the hosts in question
> and go and have a word.
>
> Of course, the fact that this was able to make the server hang is not
> great. There are some anti-DOS provisions in recent versions of
> RabbitMQ, but they don't really help when a ton of hosts are all trying
> to connect at once.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From abhishek.kona at gmail.com  Fri Mar 18 09:20:12 2011
From: abhishek.kona at gmail.com (Abhishek Kona)
Date: Fri, 18 Mar 2011 14:50:12 +0530
Subject: [rabbitmq-discuss] RabbitMQ Not Starting up
Message-ID: <4D8323CC.5040009@gmail.com>

Hey
RabbitMQ is not starting, the error log has :
Error: {node_already_running,'rabbit at sb-node2',3026}

RabbitMQCtl says do node is running, but I cannot see my queues and 
cannot telnet into the rabbitmq port as well.

What can be the issue.

-Abhishek Kona

From emile at rabbitmq.com  Fri Mar 18 10:00:42 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 18 Mar 2011 10:00:42 +0000
Subject: [rabbitmq-discuss] RabbitMQ Not Starting up
In-Reply-To: <4D8323CC.5040009@gmail.com>
References: <4D8323CC.5040009@gmail.com>
Message-ID: <4D832D4A.1040208@rabbitmq.com>

Hi Abhishek,

On 18/03/11 09:20, Abhishek Kona wrote:
> Hey
> RabbitMQ is not starting, the error log has :
> Error: {node_already_running,'rabbit at sb-node2',3026}

The problem is that you are trying to run two brokers with the same node 
name. Use this command to confirm whether rabbit is already running:

rabbitmqctl -n rabbit at sb-node2 status

You need to shut the running broker down before starting a new one. The 
rabbitmqctl tool can be used to do this:

rabbitmqctl -n rabbit at sb-node2 stop

Also see the information in the installation troubleshooting guide:

http://www.rabbitmq.com/install.html#troubleshooting


Regards

Emile


From simon at rabbitmq.com  Fri Mar 18 10:34:11 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 18 Mar 2011 10:34:11 +0000
Subject: [rabbitmq-discuss] Management plugin trashing a server?
In-Reply-To: <9a5178a1-0a48-4f5d-b2ce-3a45912161f3@n10g2000yqf.googlegroups.com>
References: <18287cca-8852-4d0d-890a-fb10af4472be@u8g2000yqh.googlegroups.com>	<4D81E4DC.8090707@rabbitmq.com>	<d2491b27-4f4e-4980-ac13-e6b435050569@q36g2000yqn.googlegroups.com>	<4D824F0C.5080509@rabbitmq.com>
	<9a5178a1-0a48-4f5d-b2ce-3a45912161f3@n10g2000yqf.googlegroups.com>
Message-ID: <4D833523.9030006@rabbitmq.com>

On 18/03/11 09:12, Ivan Sanchez wrote:
>     Thanks for the help, anyway. If there's anything else I could look
> for please let me know.

I'd be interested to know how many clients were connecting and at what 
rate. It's possible we could be doing more to defend against DOS. Feel 
free to reply off list if that would be more comfortable.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From irrer at umich.edu  Fri Mar 18 16:22:31 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 18 Mar 2011 12:22:31 -0400
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development guide
	example
In-Reply-To: <20110317122738.GB2414@rabbitmq.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>
Message-ID: <AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>

That was helpful - I got farther - but not there yet.

I did the checkout of the umbrella with the command above:

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568

but I did the 'make co' without any special parameters, so I assumed
that it did hg commands with respect to the bug23568 branch.

I built the metronome project as outlined on the Rabbit site and added
the rabbit_metronome-0.0.0.ez and amqp_client.ez files to the
rabbitmq-public-umbrella/rabbitmq-server/plugins directory, but when I
start it up I get:

linus:make run
RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="5679"
RABBITMQ_LOG_BASE="/tmp" RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-bunny-mnesia"
RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-bunny-plugins-scratch" \
                RABBITMQ_ALLOW_INPUT=true \
                RABBITMQ_SERVER_START_ARGS="" \
                ./scripts/rabbitmq-server
Activating RabbitMQ plugins ...
*WARNING* Undefined function amqp_connection:start_direct/0
*WARNING* Undefined function gb_trees:map/2
*WARNING* Undefined function os:timestamp/0
*WARNING* Undefined function random:seed/1
*WARNING* Undefined function ssl:ssl_accept/3
2 plugins activated:
* amqp_client-0.0.0
* rabbit_metronome-0.0.0

Erlang (BEAM) emulator version 5.6.5 [source] [64-bit] [smp:2]
[async-threads:30] [hipe] [kernel-poll:true]


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
| v%%VSN%%  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : bunny at linus
app descriptor :
/devel/home/irrer/tmp/erl/r2/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
home dir       : /home/irrer
config file(s) : (none)
cookie hash    : JG6HnrDO2nMIVTU2s7iwoA==
log            : /tmp/bunny.log
sasl log       : /tmp/bunny-sasl.log
database dir   : /tmp/rabbitmq-bunny-mnesia
erlang version : 5.6.5

starting file handle cache server
...done
starting worker pool
...done
starting database
...done
starting codec correctness check
...done
-- external infrastructure ready
starting statistics event manager
...done
starting logging server
...done
starting plugin registry
...done
starting auth mechanism amqplain
...done
starting auth mechanism cr-demo
...done
starting auth mechanism plain
...done
starting exchange type direct
...done
starting exchange type fanout
...done
starting exchange type headers
...done
starting exchange type topic
...done
-- kernel ready
starting node monitor
...done
starting cluster delegate
...done
starting guid generator
...done
starting alarm handler
...done
starting memory monitor
...done
-- core initialized
starting empty DB check
...done
starting exchange recovery
...done
starting queue supervisor and queue recovery
...done
-- message delivery logic ready
starting error log relay
...done
starting networking
...done
starting notify cluster nodes
...done
starting direct_client
...done

broker running
Eshell V5.6.5  (abort with ^G)
(bunny at linus)1> Erlang has closed
                                 {"Kernel pid
terminated",application_controller,"{application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}})

And as advertised it creates a big honkin' dump file.

I also had to create symbolic links so that the code would build.  In my
rabbitmq-public-umbrella/rabbit_metronome directory I created:

amqp_client -> ../rabbitmq-erlang-client/dist/amqp_client
rabbit_common -> ../rabbitmq-erlang-client/dist/rabbit_common

The server works fine if run without adding plugins, but when I add them
it bombs, so I know the plugins are the problem (Right?).

I'm new to Erlang (interesting language), so all I did was cut and paste
the example Erlang code, so if that code is out of date then it would be a
problem.

Also: I changed the port to 5679 so it would not interfere with the official
installed RabbitMQ server on the same machine, and I set RABBITMQ_NODENAME
to 'bunny'.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Mar 17, 2011 at 8:27 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Tue, Mar 15, 2011 at 07:00:28PM -0400, Jim Irrer wrote:
> > If I checkout the latest server code, will I get the bug23274 fix?
>
> Nope. bug23274 has been abandoned. bug23568 replaces it, but is yet to
> go through QA. None of the documentation regarding writing plugins has
> been updated.
>
> > If not, what is the Mercurial command to get it?
>
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568
>
> But you'll need to make sure all the plugins are also on branch bug23568
> for them to work with the new build system.
>
> If you're writing plugins from scratch, be sure to read the
> rabbitmq-public-umbrella/README.makefiles file, which has a helpful
> section on "Creating a new package".
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110318/b29b7074/attachment.htm>

From mikeb at rabbitmq.com  Fri Mar 18 16:31:50 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 18 Mar 2011 16:31:50 +0000
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTik8M_Wr2O4+q_q33iEC2rxkrar6Zjsdy+p_7EfO@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>	<4D6EE8B2.6030507@rabbitmq.com>	<AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>	<4D6F908E.2030209@rabbitmq.com>	<AANLkTimo-XAOsd_paeJAbud=RpzertM8oEPDPLHdacO4@mail.gmail.com>	<4D6FB9DC.2080800@rabbitmq.com>	<AANLkTi=rLYV90KSv4b8e=AcKiiukP=yPVy4vXLTpbCbA@mail.gmail.com>	<4D703B6C.6010608@rabbitmq.com>	<AANLkTik=+kvtcQmaaB-BWuq9QWFpxqrp1oDey5dPzvtU@mail.gmail.com>
	<AANLkTik8M_Wr2O4+q_q33iEC2rxkrar6Zjsdy+p_7EfO@mail.gmail.com>
Message-ID: <4D8388F6.9000401@rabbitmq.com>

Fabio,

> I've worked a bit more on my tests by now and another doubt has come
> up. Is there any way to make messages exchanged through x-lvc
> persistent? The scenario I'm exercising is: the publisher sends a
> message to the broker, it is consumed a few times, the broker dies
> and starts up again, then a few new consumers try to receive the
> message. I can't get this to work yet.

Right, at the minute the last values are transient. It probably wouldn't 
take much coding to make it save things to disk for durable exchanges.

> From what I've seen in my tests, the exchange only works with
> exclusive queues, is that correct? I've tried creating a named,
> durable queue for all consumers to read from, but in this case the
> message can only be consumed once. On Thu, Mar 10, 2011 at 10:36,
> Fabio Margarido <fabiomargarido at gmail.com
> <mailto:fabiomargarido at gmail.com>> wrote:

It will work with any queue.   However, if you have many consumers to a 
queue, each message will be delivered to one consumer only -- that's the 
semantics of AMQP queues.  So, in your case, I think you want a queue 
for each consumer anyway.

Michael

> I've worked a bit more on my tests by now and another doubt has come
> up. Is there any way to make messages exchanged through x-lvc
> persistent? The scenario I'm exercising is: the publisher sends a
> message to the broker, it is consumed a few times, the broker dies
> and starts up again, then a few new consumers try to receive the
> message. I can't get this to work yet.
>
> From what I've seen in my tests, the exchange only works with
> exclusive queues, is that correct? I've tried creating a named,
> durable queue for all consumers to read from, but in this case the
> message can only be consumed once.
>
> Is there something I'm missing?
>
> Thank you.
>
> On Thu, Mar 3, 2011 at 22:07, Michael Bridgen <mikeb at rabbitmq.com
> <mailto:mikeb at rabbitmq.com>> wrote:
>> Fabio,
>>
>> Aces, glad to hear it's working for you thus far.
>>
>> On this:
>>
>>> Just a final question: the previous README file on github said
>>> something about including the plugin on the main RabbitMQ code,
> but I
>>> figured this had been written some time ago because it mentioned
>>> version 1.7.1. Is this still in your (and RabbitMQ developers)
> plans?
>>> Best regards.
>>
>> -- I was referring to the exchange plugin mechanism overall, on
> which I was
>> finishing (largely other people's!) work at the time.  That
> mechanism has
>> been in mainstream rabbitmq since then, and has changed a bit,
> but is pretty
>> stable.
>>
>> The Last Value Caching exchange will likely stay a plugin for the
>> foreseeable future, rather than being baked into rabbitmq-server.
> But if
>> you follow this list you'll know this is not the last word ..
>>
>> Michael
>>
>>>> Oh.  Looks like github's upload and download system is totally
> broken.
>>>> (I've now tried to upload it a few times).
>>>>
>>>> I've attached the ez so it can be stopped by mail filters
>>>> instead.
>>>
>>> Hi Michael. Sorry for the extra trouble.
>>>
>>> I've now rebooted my RabbitMQ server and run a few basic tests
>>> and everything seems to be working as expected. Thank you again
>>> for all your help and your work on the plugin. I'll keep building
>>> my test scenarios and I'll let you know if something else comes
>>> up.
>>>
>>> Just a final question: the previous README file on github said
>>> something about including the plugin on the main RabbitMQ code,
> but I
>>> figured this had been written some time ago because it mentioned
>>> version 1.7.1. Is this still in your (and RabbitMQ developers)
> plans?
>>> Best regards.
>>
>>
>
>


From jerryk at vmware.com  Fri Mar 18 16:56:40 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 18 Mar 2011 09:56:40 -0700
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development
	guide	example
In-Reply-To: <AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>,
	<AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
Message-ID: <F78BCF638F95D74A99D036114107EDB5028DD5DB15@EXCH-MBX-3.vmware.com>

Hi, Jim...

Can you look in the directory Rabbit's dropping logs into (see RABBIT_LOG_BASE in the broker's startup preamble) and take a peek at the rabbit and SASL logs?  There may be a bit more information in there on what made the metronome application unhappy when it tried to start up...

Best regards,
Jerry

________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jim Irrer [irrer at umich.edu]
Sent: Friday, March 18, 2011 9:22 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Cc: Jim Irrer
Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide      example

That was helpful - I got farther - but not there yet.

I did the checkout of the umbrella with the command above:

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568

but I did the 'make co' without any special parameters, so I assumed
that it did hg commands with respect to the bug23568 branch.

I built the metronome project as outlined on the Rabbit site and added
the rabbit_metronome-0.0.0.ez and amqp_client.ez files to the
rabbitmq-public-umbrella/rabbitmq-server/plugins directory, but when I
start it up I get:

linus:make run
RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="5679" RABBITMQ_LOG_BASE="/tmp" RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-bunny-mnesia" RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-bunny-plugins-scratch" \
                RABBITMQ_ALLOW_INPUT=true \
                RABBITMQ_SERVER_START_ARGS="" \
                ./scripts/rabbitmq-server
Activating RabbitMQ plugins ...
*WARNING* Undefined function amqp_connection:start_direct/0
*WARNING* Undefined function gb_trees:map/2
*WARNING* Undefined function os:timestamp/0
*WARNING* Undefined function random:seed/1
*WARNING* Undefined function ssl:ssl_accept/3
2 plugins activated:
* amqp_client-0.0.0
* rabbit_metronome-0.0.0

Erlang (BEAM) emulator version 5.6.5 [source] [64-bit] [smp:2] [async-threads:30] [hipe] [kernel-poll:true]


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
| v%%VSN%%  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : bunny at linus
app descriptor : /devel/home/irrer/tmp/erl/r2/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
home dir       : /home/irrer
config file(s) : (none)
cookie hash    : JG6HnrDO2nMIVTU2s7iwoA==
log            : /tmp/bunny.log
sasl log       : /tmp/bunny-sasl.log
database dir   : /tmp/rabbitmq-bunny-mnesia
erlang version : 5.6.5

starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting statistics event manager                                     ...done
starting logging server                                               ...done
starting plugin registry                                              ...done
starting auth mechanism amqplain                                      ...done
starting auth mechanism cr-demo                                       ...done
starting auth mechanism plain                                         ...done
starting exchange type direct                                         ...done
starting exchange type fanout                                         ...done
starting exchange type headers                                        ...done
starting exchange type topic                                          ...done
-- kernel ready
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting alarm handler                                                ...done
starting memory monitor                                               ...done
-- core initialized
starting empty DB check                                               ...done
starting exchange recovery                                            ...done
starting queue supervisor and queue recovery                          ...done
-- message delivery logic ready
starting error log relay                                              ...done
starting networking                                                   ...done
starting notify cluster nodes                                         ...done
starting direct_client                                                ...done

broker running
Eshell V5.6.5  (abort with ^G)
(bunny at linus)1> Erlang has closed
                                 {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}})

And as advertised it creates a big honkin' dump file.

I also had to create symbolic links so that the code would build.  In my
rabbitmq-public-umbrella/rabbit_metronome directory I created:

amqp_client -> ../rabbitmq-erlang-client/dist/amqp_client
rabbit_common -> ../rabbitmq-erlang-client/dist/rabbit_common

The server works fine if run without adding plugins, but when I add them
it bombs, so I know the plugins are the problem (Right?).

I'm new to Erlang (interesting language), so all I did was cut and paste
the example Erlang code, so if that code is out of date then it would be a problem.

Also: I changed the port to 5679 so it would not interfere with the official
installed RabbitMQ server on the same machine, and I set RABBITMQ_NODENAME
to 'bunny'.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu<mailto:irrer at umich.edu>       (734) 647-4409<tel:%28734%29%20647-4409>
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Mar 17, 2011 at 8:27 AM, Matthew Sackman <matthew at rabbitmq.com<mailto:matthew at rabbitmq.com>> wrote:
On Tue, Mar 15, 2011 at 07:00:28PM -0400, Jim Irrer wrote:
> If I checkout the latest server code, will I get the bug23274 fix?

Nope. bug23274 has been abandoned. bug23568 replaces it, but is yet to
go through QA. None of the documentation regarding writing plugins has
been updated.

> If not, what is the Mercurial command to get it?

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568

But you'll need to make sure all the plugins are also on branch bug23568
for them to work with the new build system.

If you're writing plugins from scratch, be sure to read the
rabbitmq-public-umbrella/README.makefiles file, which has a helpful
section on "Creating a new package".

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthew at rabbitmq.com  Fri Mar 18 17:11:21 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 18 Mar 2011 17:11:21 +0000
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <20110318090403.GC2752@rabbitmq.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>
Message-ID: <20110318171120.GM2414@rabbitmq.com>

On Fri, Mar 18, 2011 at 09:04:03AM +0000, Matthew Sackman wrote:
> On Thu, Mar 17, 2011 at 08:48:58PM -0700, alex chen wrote:
> > memory limit is 40% * 4GB = 1.6 GB.  the broker would crash if there are more 
> > than 50 GB of messages in 1000 queues.  When this happened, the  memory usage 
> > reached 4 GB.
> > If I run the broker using 64 bit,  it does not crash because it could get more 
> > than 6 GB of memory.   It was able to consume all the messages at rate of 
> > 100-200 MB/sec.
> 
> Good to hear, and that must be one fast running Rabbit! I'll check the
> memory limits code - we can detect whether we're in a 32-bit VM or not I
> think, so if so, it seems likely to make sense we take
> 0.4 * min[4GB, RAM]. Certainly, in general, Rabbit just shouldn't crash.

Gah, clearly, if it's limiting you to 1.6GB then it's already doing the
right thing - it's detecting the 4GB limit already. The crash/malloc
fail is not the right thing however.

Over lunch we did manage to come up with a hypothesis as to what's going
wrong, and a quick subsequent test showed this to be accurate. I've now
fixed the bug and whilst it's pending QA, I'd be interested in whether
it fixes your crash even under a 32-bit Erlang VM. If you have the time
and are comfortable compiling Rabbit from scratch, try the branch called
"bug23968" and repeat you're test. It should not crash, even under a
32-bit VM, and it should use substantially less memory too.

Matthew

From jerryk at vmware.com  Fri Mar 18 17:30:34 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 18 Mar 2011 10:30:34 -0700
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development
	guide	example
In-Reply-To: <AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>,
	<AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
Message-ID: <F78BCF638F95D74A99D036114107EDB5028DD5DB18@EXCH-MBX-3.vmware.com>

Hi, Jim...

Someone on the Rabbit team just pointed out to me that metronome currently doesn't work.  We have a bug reported internally on it.

Can you say a bit about what you're trying to do with it?  Are you aiming to write a Rabbit plugin of your own and were planning to use metronome for guidance? 

Jerry
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jim Irrer [irrer at umich.edu]
Sent: Friday, March 18, 2011 9:22 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Cc: Jim Irrer
Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide      example

That was helpful - I got farther - but not there yet.

I did the checkout of the umbrella with the command above:

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568

but I did the 'make co' without any special parameters, so I assumed
that it did hg commands with respect to the bug23568 branch.

I built the metronome project as outlined on the Rabbit site and added
the rabbit_metronome-0.0.0.ez and amqp_client.ez files to the
rabbitmq-public-umbrella/rabbitmq-server/plugins directory, but when I
start it up I get:

linus:make run
RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="5679" RABBITMQ_LOG_BASE="/tmp" RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-bunny-mnesia" RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-bunny-plugins-scratch" \
                RABBITMQ_ALLOW_INPUT=true \
                RABBITMQ_SERVER_START_ARGS="" \
                ./scripts/rabbitmq-server
Activating RabbitMQ plugins ...
*WARNING* Undefined function amqp_connection:start_direct/0
*WARNING* Undefined function gb_trees:map/2
*WARNING* Undefined function os:timestamp/0
*WARNING* Undefined function random:seed/1
*WARNING* Undefined function ssl:ssl_accept/3
2 plugins activated:
* amqp_client-0.0.0
* rabbit_metronome-0.0.0

Erlang (BEAM) emulator version 5.6.5 [source] [64-bit] [smp:2] [async-threads:30] [hipe] [kernel-poll:true]


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
| v%%VSN%%  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : bunny at linus
app descriptor : /devel/home/irrer/tmp/erl/r2/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
home dir       : /home/irrer
config file(s) : (none)
cookie hash    : JG6HnrDO2nMIVTU2s7iwoA==
log            : /tmp/bunny.log
sasl log       : /tmp/bunny-sasl.log
database dir   : /tmp/rabbitmq-bunny-mnesia
erlang version : 5.6.5

starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting statistics event manager                                     ...done
starting logging server                                               ...done
starting plugin registry                                              ...done
starting auth mechanism amqplain                                      ...done
starting auth mechanism cr-demo                                       ...done
starting auth mechanism plain                                         ...done
starting exchange type direct                                         ...done
starting exchange type fanout                                         ...done
starting exchange type headers                                        ...done
starting exchange type topic                                          ...done
-- kernel ready
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting alarm handler                                                ...done
starting memory monitor                                               ...done
-- core initialized
starting empty DB check                                               ...done
starting exchange recovery                                            ...done
starting queue supervisor and queue recovery                          ...done
-- message delivery logic ready
starting error log relay                                              ...done
starting networking                                                   ...done
starting notify cluster nodes                                         ...done
starting direct_client                                                ...done

broker running
Eshell V5.6.5  (abort with ^G)
(bunny at linus)1> Erlang has closed
                                 {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}})

And as advertised it creates a big honkin' dump file.

I also had to create symbolic links so that the code would build.  In my
rabbitmq-public-umbrella/rabbit_metronome directory I created:

amqp_client -> ../rabbitmq-erlang-client/dist/amqp_client
rabbit_common -> ../rabbitmq-erlang-client/dist/rabbit_common

The server works fine if run without adding plugins, but when I add them
it bombs, so I know the plugins are the problem (Right?).

I'm new to Erlang (interesting language), so all I did was cut and paste
the example Erlang code, so if that code is out of date then it would be a problem.

Also: I changed the port to 5679 so it would not interfere with the official
installed RabbitMQ server on the same machine, and I set RABBITMQ_NODENAME
to 'bunny'.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu<mailto:irrer at umich.edu>       (734) 647-4409<tel:%28734%29%20647-4409>
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Mar 17, 2011 at 8:27 AM, Matthew Sackman <matthew at rabbitmq.com<mailto:matthew at rabbitmq.com>> wrote:
On Tue, Mar 15, 2011 at 07:00:28PM -0400, Jim Irrer wrote:
> If I checkout the latest server code, will I get the bug23274 fix?

Nope. bug23274 has been abandoned. bug23568 replaces it, but is yet to
go through QA. None of the documentation regarding writing plugins has
been updated.

> If not, what is the Mercurial command to get it?

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568

But you'll need to make sure all the plugins are also on branch bug23568
for them to work with the new build system.

If you're writing plugins from scratch, be sure to read the
rabbitmq-public-umbrella/README.makefiles file, which has a helpful
section on "Creating a new package".

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From Joe.Kearney at gsacapital.com  Fri Mar 18 17:33:05 2011
From: Joe.Kearney at gsacapital.com (Kearney, Joe)
Date: Fri, 18 Mar 2011 17:33:05 +0000
Subject: [rabbitmq-discuss] browse messages on a queue
Message-ID: <9319F360221C65428EA819A4E8DC34ED028DF6395D@OPMBOX21UK.options-it.com>

Hi,

I'm interested in finding or writing a tool to monitor messages on a rabbit queue, in particular to be able to view messages waiting on the queue. The use case is for occasional monitoring and debugging; I'm not suggesting using a browse/read-only function in normal processing.

This was raised on this mail group last July (http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-July/008004.html). Two pertinent quotes from that thread:

  > The only way you can get at the messages is through the normal AMQP methods that consume the messages (basic.consume and basic.get).  But these are not simple read-only operations of the type you might want for monitoring of the messages within a queue.

  > it's actually quite hard to come up with a sensible semantics for it that isn't too constraining on implementations

Has there been any progress on a built-in way to do this? Any thoughts on when/whether this might be introduced?
 
Alternatively, can you comment on a sensible way to fake it? The naive implementation that springs to mind is simply to get a few messages from the head of the queue in a transaction and roll it back. Clearly this is more heavyweight than it need be, but are there any reasons that this behaviour should really be avoided for manual monitoring, until such a time as real read-only browsing is supported?

Thanks,
Joe

From jerryk at vmware.com  Fri Mar 18 17:32:47 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 18 Mar 2011 10:32:47 -0700
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development
	guide	example
In-Reply-To: <AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>,
	<AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
Message-ID: <F78BCF638F95D74A99D036114107EDB5028DD5DB19@EXCH-MBX-3.vmware.com>

Jim:

I also have a vague recollection that a month or two ago I found a couple out of date spots in the plugin development guide that might cause you grief.  I did put together a basic plugin for other reasons, that I could conceivably husk out and share with you as a starting point you might find convenient?

Best regards,
Jerry
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jim Irrer [irrer at umich.edu]
Sent: Friday, March 18, 2011 9:22 AM
To: rabbitmq-discuss at lists.rabbitmq.com
Cc: Jim Irrer
Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide      example

That was helpful - I got farther - but not there yet.

I did the checkout of the umbrella with the command above:

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568

but I did the 'make co' without any special parameters, so I assumed
that it did hg commands with respect to the bug23568 branch.

I built the metronome project as outlined on the Rabbit site and added
the rabbit_metronome-0.0.0.ez and amqp_client.ez files to the
rabbitmq-public-umbrella/rabbitmq-server/plugins directory, but when I
start it up I get:

linus:make run
RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="5679" RABBITMQ_LOG_BASE="/tmp" RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-bunny-mnesia" RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-bunny-plugins-scratch" \
                RABBITMQ_ALLOW_INPUT=true \
                RABBITMQ_SERVER_START_ARGS="" \
                ./scripts/rabbitmq-server
Activating RabbitMQ plugins ...
*WARNING* Undefined function amqp_connection:start_direct/0
*WARNING* Undefined function gb_trees:map/2
*WARNING* Undefined function os:timestamp/0
*WARNING* Undefined function random:seed/1
*WARNING* Undefined function ssl:ssl_accept/3
2 plugins activated:
* amqp_client-0.0.0
* rabbit_metronome-0.0.0

Erlang (BEAM) emulator version 5.6.5 [source] [64-bit] [smp:2] [async-threads:30] [hipe] [kernel-poll:true]


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
| v%%VSN%%  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : bunny at linus
app descriptor : /devel/home/irrer/tmp/erl/r2/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
home dir       : /home/irrer
config file(s) : (none)
cookie hash    : JG6HnrDO2nMIVTU2s7iwoA==
log            : /tmp/bunny.log
sasl log       : /tmp/bunny-sasl.log
database dir   : /tmp/rabbitmq-bunny-mnesia
erlang version : 5.6.5

starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting statistics event manager                                     ...done
starting logging server                                               ...done
starting plugin registry                                              ...done
starting auth mechanism amqplain                                      ...done
starting auth mechanism cr-demo                                       ...done
starting auth mechanism plain                                         ...done
starting exchange type direct                                         ...done
starting exchange type fanout                                         ...done
starting exchange type headers                                        ...done
starting exchange type topic                                          ...done
-- kernel ready
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting alarm handler                                                ...done
starting memory monitor                                               ...done
-- core initialized
starting empty DB check                                               ...done
starting exchange recovery                                            ...done
starting queue supervisor and queue recovery                          ...done
-- message delivery logic ready
starting error log relay                                              ...done
starting networking                                                   ...done
starting notify cluster nodes                                         ...done
starting direct_client                                                ...done

broker running
Eshell V5.6.5  (abort with ^G)
(bunny at linus)1> Erlang has closed
                                 {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}})

And as advertised it creates a big honkin' dump file.

I also had to create symbolic links so that the code would build.  In my
rabbitmq-public-umbrella/rabbit_metronome directory I created:

amqp_client -> ../rabbitmq-erlang-client/dist/amqp_client
rabbit_common -> ../rabbitmq-erlang-client/dist/rabbit_common

The server works fine if run without adding plugins, but when I add them
it bombs, so I know the plugins are the problem (Right?).

I'm new to Erlang (interesting language), so all I did was cut and paste
the example Erlang code, so if that code is out of date then it would be a problem.

Also: I changed the port to 5679 so it would not interfere with the official
installed RabbitMQ server on the same machine, and I set RABBITMQ_NODENAME
to 'bunny'.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu<mailto:irrer at umich.edu>       (734) 647-4409<tel:%28734%29%20647-4409>
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Mar 17, 2011 at 8:27 AM, Matthew Sackman <matthew at rabbitmq.com<mailto:matthew at rabbitmq.com>> wrote:
On Tue, Mar 15, 2011 at 07:00:28PM -0400, Jim Irrer wrote:
> If I checkout the latest server code, will I get the bug23274 fix?

Nope. bug23274 has been abandoned. bug23568 replaces it, but is yet to
go through QA. None of the documentation regarding writing plugins has
been updated.

> If not, what is the Mercurial command to get it?

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568

But you'll need to make sure all the plugins are also on branch bug23568
for them to work with the new build system.

If you're writing plugins from scratch, be sure to read the
rabbitmq-public-umbrella/README.makefiles file, which has a helpful
section on "Creating a new package".

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From david at rabbitmq.com  Fri Mar 18 17:42:59 2011
From: david at rabbitmq.com (David Wragg)
Date: Fri, 18 Mar 2011 17:42:59 +0000
Subject: [rabbitmq-discuss] Problem with plugin development guide example
In-Reply-To: <AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
	(Jim Irrer's message of "Fri, 18 Mar 2011 12:22:31 -0400")
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>
	<AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
Message-ID: <yrv4cfwqkiau4.fsf_-_@dwragg.eng.vmware.com>

Jim Irrer <irrer at umich.edu> writes:
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568

bug23568 is a major overhaul of our plugin build system.  It is
documented in README.makefiles, but the plugin development instructions
on the website won't get updated until it is merged and released.
Trying to use that branch while referring to the website can only lead
to confusion.

To be honest, I don't think outside parties should be using that branch
unless they are comfortable with Erlang development and the idea that
they are using a branch that is as yet unmerged for good reasons.

I don't know what "the bug23274 fix" is that led you to use this branch,
but you are probably better off working around whatever that issue is
than trying bug23568.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
SpringSource, a division of VMware

From irrer at umich.edu  Fri Mar 18 19:11:24 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 18 Mar 2011 15:11:24 -0400
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development guide
	example
In-Reply-To: <F78BCF638F95D74A99D036114107EDB5028DD5DB18@EXCH-MBX-3.vmware.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>
	<AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5DB18@EXCH-MBX-3.vmware.com>
Message-ID: <AANLkTikyq7dk6uo+91wHhOebAAoHj3yu=AVHNzbM1kOR@mail.gmail.com>

Jerry -

I was only using metronome as a guide to write plugins.

My real goal is to write a tracing plugin that dumps:


   - all messages sent and received
   - queue create+delete
   - exchange create+delete

to a persistent store (file or database) for later analysis.

First step was to build server (That was easy, good job RabbitMQ).

Next is to get a trivial (hello world) plugin working.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Mar 18, 2011 at 1:30 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Jim...
>
> Someone on the Rabbit team just pointed out to me that metronome currently
> doesn't work.  We have a bug reported internally on it.
>
> Can you say a bit about what you're trying to do with it?  Are you aiming
> to write a Rabbit plugin of your own and were planning to use metronome for
> guidance?
>
> Jerry
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [
> rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jim Irrer [
> irrer at umich.edu]
> Sent: Friday, March 18, 2011 9:22 AM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Cc: Jim Irrer
> Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide
>      example
>
> That was helpful - I got farther - but not there yet.
>
> I did the checkout of the umbrella with the command above:
>
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568
>
> but I did the 'make co' without any special parameters, so I assumed
> that it did hg commands with respect to the bug23568 branch.
>
> I built the metronome project as outlined on the Rabbit site and added
> the rabbit_metronome-0.0.0.ez and amqp_client.ez files to the
> rabbitmq-public-umbrella/rabbitmq-server/plugins directory, but when I
> start it up I get:
>
> linus:make run
> RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="5679"
> RABBITMQ_LOG_BASE="/tmp" RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-bunny-mnesia"
> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-bunny-plugins-scratch" \
>                RABBITMQ_ALLOW_INPUT=true \
>                RABBITMQ_SERVER_START_ARGS="" \
>                ./scripts/rabbitmq-server
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function amqp_connection:start_direct/0
> *WARNING* Undefined function gb_trees:map/2
> *WARNING* Undefined function os:timestamp/0
> *WARNING* Undefined function random:seed/1
> *WARNING* Undefined function ssl:ssl_accept/3
> 2 plugins activated:
> * amqp_client-0.0.0
> * rabbit_metronome-0.0.0
>
> Erlang (BEAM) emulator version 5.6.5 [source] [64-bit] [smp:2]
> [async-threads:30] [hipe] [kernel-poll:true]
>
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> | v%%VSN%%  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : bunny at linus
> app descriptor :
> /devel/home/irrer/tmp/erl/r2/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
> home dir       : /home/irrer
> config file(s) : (none)
> cookie hash    : JG6HnrDO2nMIVTU2s7iwoA==
> log            : /tmp/bunny.log
> sasl log       : /tmp/bunny-sasl.log
> database dir   : /tmp/rabbitmq-bunny-mnesia
> erlang version : 5.6.5
>
> starting file handle cache server
> ...done
> starting worker pool
>  ...done
> starting database
> ...done
> starting codec correctness check
>  ...done
> -- external infrastructure ready
> starting statistics event manager
> ...done
> starting logging server
> ...done
> starting plugin registry
>  ...done
> starting auth mechanism amqplain
>  ...done
> starting auth mechanism cr-demo
> ...done
> starting auth mechanism plain
> ...done
> starting exchange type direct
> ...done
> starting exchange type fanout
> ...done
> starting exchange type headers
>  ...done
> starting exchange type topic
>  ...done
> -- kernel ready
> starting node monitor
> ...done
> starting cluster delegate
> ...done
> starting guid generator
> ...done
> starting alarm handler
>  ...done
> starting memory monitor
> ...done
> -- core initialized
> starting empty DB check
> ...done
> starting exchange recovery
>  ...done
> starting queue supervisor and queue recovery
>  ...done
> -- message delivery logic ready
> starting error log relay
>  ...done
> starting networking
> ...done
> starting notify cluster nodes
> ...done
> starting direct_client
>  ...done
>
> broker running
> Eshell V5.6.5  (abort with ^G)
> (bunny at linus)1> Erlang has closed
>                                 {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}})
>
> And as advertised it creates a big honkin' dump file.
>
> I also had to create symbolic links so that the code would build.  In my
> rabbitmq-public-umbrella/rabbit_metronome directory I created:
>
> amqp_client -> ../rabbitmq-erlang-client/dist/amqp_client
> rabbit_common -> ../rabbitmq-erlang-client/dist/rabbit_common
>
> The server works fine if run without adding plugins, but when I add them
> it bombs, so I know the plugins are the problem (Right?).
>
> I'm new to Erlang (interesting language), so all I did was cut and paste
> the example Erlang code, so if that code is out of date then it would be a
> problem.
>
> Also: I changed the port to 5679 so it would not interfere with the
> official
> installed RabbitMQ server on the same machine, and I set RABBITMQ_NODENAME
> to 'bunny'.
>
> Thanks,
>
> - Jim
>
> Jim Irrer     irrer at umich.edu<mailto:irrer at umich.edu>       (734) 647-4409
> <tel:%28734%29%20647-4409>
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Thu, Mar 17, 2011 at 8:27 AM, Matthew Sackman <matthew at rabbitmq.com
> <mailto:matthew at rabbitmq.com>> wrote:
> On Tue, Mar 15, 2011 at 07:00:28PM -0400, Jim Irrer wrote:
> > If I checkout the latest server code, will I get the bug23274 fix?
>
> Nope. bug23274 has been abandoned. bug23568 replaces it, but is yet to
> go through QA. None of the documentation regarding writing plugins has
> been updated.
>
> > If not, what is the Mercurial command to get it?
>
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568
>
> But you'll need to make sure all the plugins are also on branch bug23568
> for them to work with the new build system.
>
> If you're writing plugins from scratch, be sure to read the
> rabbitmq-public-umbrella/README.makefiles file, which has a helpful
> section on "Creating a new package".
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:
> rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110318/02df910e/attachment.htm>

From irrer at umich.edu  Fri Mar 18 19:13:05 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 18 Mar 2011 15:13:05 -0400
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development guide
	example
In-Reply-To: <F78BCF638F95D74A99D036114107EDB5028DD5DB15@EXCH-MBX-3.vmware.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>
	<AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5DB15@EXCH-MBX-3.vmware.com>
Message-ID: <AANLkTikwaZFHWTA2TpDd5ooS+ez82J7v73HRw5pn5sZ2@mail.gmail.com>

With known problems in metronome this is probably obsolete, but
here goes anyway:

'make run' creates the following files in /tmp:

bunny-sasl.log shows:

=CRASH REPORT==== 18-Mar-2011::14:52:03 ===
  crasher:
    pid: <0.247.0>
    registered_name: []
    exception exit: {undef,[{amqp_connection,start_direct,[]},
                            {rabbit_metronome_worker,init,1},
                            {gen_server,init_it,6},
                            {proc_lib,init_p_do_apply,3}]}
      in function  gen_server:init_it/6
    initial call: rabbit_metronome_worker:init/1
    ancestors: [rabbit_metronome_sup,<0.245.0>]
    messages: []
    links: [<0.246.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 233
    stack_size: 23
    reductions: 139
  neighbours:

=SUPERVISOR REPORT==== 18-Mar-2011::14:52:03 ===
     Supervisor: {local,rabbit_metronome_sup}
     Context:    start_error
     Reason:     {undef,[{amqp_connection,start_direct,[]},
                         {rabbit_metronome_worker,init,1},
                         {gen_server,init_it,6},
                         {proc_lib,init_p_do_apply,3}]}
     Offender:   [{pid,undefined},
                  {name,rabbit_metronome_worker},
                  {mfa,{rabbit_metronome_worker,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,10000},
                  {child_type,worker}]


=CRASH REPORT==== 18-Mar-2011::14:52:03 ===
  crasher:
    pid: <0.244.0>
    registered_name: []
    exception exit: {shutdown,{rabbit_metronome,start,[normal,[]]}}
      in function  application_master:init/4
    initial call: application_master:init/4
    ancestors: [<0.243.0>]
    messages: [{'EXIT',<0.245.0>,normal}]
    links: [<0.243.0>,<0.6.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 233
    stack_size: 23
    reductions: 100
  neighbours:




bunny.log shows:

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
Memory limit set to 1416MB.

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
Added vhost <<"/">>

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
Created user <<"guest">>

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
Set user admin flag for user <<"guest">> to true

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 18-Mar-2011::14:52:03 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
started TCP Listener on [::]:5679

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
    application: rabbit_metronome
    exited: {shutdown,{rabbit_metronome,start,[normal,[]]}}
    type: permanent

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
stopped TCP Listener on [::]:5679

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Mar 18, 2011 at 12:56 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Jim...
>
> Can you look in the directory Rabbit's dropping logs into (see
> RABBIT_LOG_BASE in the broker's startup preamble) and take a peek at the
> rabbit and SASL logs?  There may be a bit more information in there on what
> made the metronome application unhappy when it tried to start up...
>
> Best regards,
> Jerry
>
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [
> rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jim Irrer [
> irrer at umich.edu]
> Sent: Friday, March 18, 2011 9:22 AM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Cc: Jim Irrer
> Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide
>      example
>
> That was helpful - I got farther - but not there yet.
>
> I did the checkout of the umbrella with the command above:
>
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568
>
> but I did the 'make co' without any special parameters, so I assumed
> that it did hg commands with respect to the bug23568 branch.
>
> I built the metronome project as outlined on the Rabbit site and added
> the rabbit_metronome-0.0.0.ez and amqp_client.ez files to the
> rabbitmq-public-umbrella/rabbitmq-server/plugins directory, but when I
> start it up I get:
>
> linus:make run
> RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="5679"
> RABBITMQ_LOG_BASE="/tmp" RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-bunny-mnesia"
> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-bunny-plugins-scratch" \
>                RABBITMQ_ALLOW_INPUT=true \
>                RABBITMQ_SERVER_START_ARGS="" \
>                ./scripts/rabbitmq-server
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function amqp_connection:start_direct/0
> *WARNING* Undefined function gb_trees:map/2
> *WARNING* Undefined function os:timestamp/0
> *WARNING* Undefined function random:seed/1
> *WARNING* Undefined function ssl:ssl_accept/3
> 2 plugins activated:
> * amqp_client-0.0.0
> * rabbit_metronome-0.0.0
>
> Erlang (BEAM) emulator version 5.6.5 [source] [64-bit] [smp:2]
> [async-threads:30] [hipe] [kernel-poll:true]
>
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> | v%%VSN%%  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : bunny at linus
> app descriptor :
> /devel/home/irrer/tmp/erl/r2/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
> home dir       : /home/irrer
> config file(s) : (none)
> cookie hash    : JG6HnrDO2nMIVTU2s7iwoA==
> log            : /tmp/bunny.log
> sasl log       : /tmp/bunny-sasl.log
> database dir   : /tmp/rabbitmq-bunny-mnesia
> erlang version : 5.6.5
>
> starting file handle cache server
> ...done
> starting worker pool
>  ...done
> starting database
> ...done
> starting codec correctness check
>  ...done
> -- external infrastructure ready
> starting statistics event manager
> ...done
> starting logging server
> ...done
> starting plugin registry
>  ...done
> starting auth mechanism amqplain
>  ...done
> starting auth mechanism cr-demo
> ...done
> starting auth mechanism plain
> ...done
> starting exchange type direct
> ...done
> starting exchange type fanout
> ...done
> starting exchange type headers
>  ...done
> starting exchange type topic
>  ...done
> -- kernel ready
> starting node monitor
> ...done
> starting cluster delegate
> ...done
> starting guid generator
> ...done
> starting alarm handler
>  ...done
> starting memory monitor
> ...done
> -- core initialized
> starting empty DB check
> ...done
> starting exchange recovery
>  ...done
> starting queue supervisor and queue recovery
>  ...done
> -- message delivery logic ready
> starting error log relay
>  ...done
> starting networking
> ...done
> starting notify cluster nodes
> ...done
> starting direct_client
>  ...done
>
> broker running
> Eshell V5.6.5  (abort with ^G)
> (bunny at linus)1> Erlang has closed
>                                 {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}})
>
> And as advertised it creates a big honkin' dump file.
>
> I also had to create symbolic links so that the code would build.  In my
> rabbitmq-public-umbrella/rabbit_metronome directory I created:
>
> amqp_client -> ../rabbitmq-erlang-client/dist/amqp_client
> rabbit_common -> ../rabbitmq-erlang-client/dist/rabbit_common
>
> The server works fine if run without adding plugins, but when I add them
> it bombs, so I know the plugins are the problem (Right?).
>
> I'm new to Erlang (interesting language), so all I did was cut and paste
> the example Erlang code, so if that code is out of date then it would be a
> problem.
>
> Also: I changed the port to 5679 so it would not interfere with the
> official
> installed RabbitMQ server on the same machine, and I set RABBITMQ_NODENAME
> to 'bunny'.
>
> Thanks,
>
> - Jim
>
> Jim Irrer     irrer at umich.edu<mailto:irrer at umich.edu>       (734) 647-4409
> <tel:%28734%29%20647-4409>
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Thu, Mar 17, 2011 at 8:27 AM, Matthew Sackman <matthew at rabbitmq.com
> <mailto:matthew at rabbitmq.com>> wrote:
> On Tue, Mar 15, 2011 at 07:00:28PM -0400, Jim Irrer wrote:
> > If I checkout the latest server code, will I get the bug23274 fix?
>
> Nope. bug23274 has been abandoned. bug23568 replaces it, but is yet to
> go through QA. None of the documentation regarding writing plugins has
> been updated.
>
> > If not, what is the Mercurial command to get it?
>
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568
>
> But you'll need to make sure all the plugins are also on branch bug23568
> for them to work with the new build system.
>
> If you're writing plugins from scratch, be sure to read the
> rabbitmq-public-umbrella/README.makefiles file, which has a helpful
> section on "Creating a new package".
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:
> rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110318/116870ca/attachment-0001.htm>

From irrer at umich.edu  Fri Mar 18 19:20:42 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 18 Mar 2011 15:20:42 -0400
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development guide
	example
In-Reply-To: <F78BCF638F95D74A99D036114107EDB5028DD5DB19@EXCH-MBX-3.vmware.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>
	<AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5DB19@EXCH-MBX-3.vmware.com>
Message-ID: <AANLkTi=7-zNYj1dhY=iNKUh2ipn1_paKGaLwXbTK51Eq@mail.gmail.com>

With known problems in metronome this is probably obsolete, but
here goes anyway:

I'm guessing that one of these are what you were referring to:

bunny-sasl.log:

=CRASH REPORT==== 18-Mar-2011::14:52:03 ===
  crasher:
    pid: <0.247.0>
    registered_name: []
    exception exit: {undef,[{amqp_connection,start_direct,[]},
                            {rabbit_metronome_worker,init,1},
                            {gen_server,init_it,6},
                            {proc_lib,init_p_do_apply,3}]}
      in function  gen_server:init_it/6
    initial call: rabbit_metronome_worker:init/1
    ancestors: [rabbit_metronome_sup,<0.245.0>]
    messages: []
    links: [<0.246.0>]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 233
    stack_size: 23
    reductions: 139
  neighbours:

=SUPERVISOR REPORT==== 18-Mar-2011::14:52:03 ===
     Supervisor: {local,rabbit_metronome_sup}
     Context:    start_error
     Reason:     {undef,[{amqp_connection,start_direct,[]},
                         {rabbit_metronome_worker,init,1},
                         {gen_server,init_it,6},
                         {proc_lib,init_p_do_apply,3}]}
     Offender:   [{pid,undefined},
                  {name,rabbit_metronome_worker},
                  {mfa,{rabbit_metronome_worker,start_link,[]}},
                  {restart_type,permanent},
                  {shutdown,10000},
                  {child_type,worker}]


=CRASH REPORT==== 18-Mar-2011::14:52:03 ===
  crasher:
    pid: <0.244.0>
    registered_name: []
    exception exit: {shutdown,{rabbit_metronome,start,[normal,[]]}}
      in function  application_master:init/4
    initial call: application_master:init/4
    ancestors: [<0.243.0>]
    messages: [{'EXIT',<0.245.0>,normal}]
    links: [<0.243.0>,<0.6.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 233
    stack_size: 23
    reductions: 100
  neighbours:


bunny.log:

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
Memory limit set to 1416MB.

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
Added vhost <<"/">>

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
Created user <<"guest">>

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
Set user admin flag for user <<"guest">> to true

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 18-Mar-2011::14:52:03 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
started TCP Listener on [::]:5679

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
    application: rabbit_metronome
    exited: {shutdown,{rabbit_metronome,start,[normal,[]]}}
    type: permanent

=INFO REPORT==== 18-Mar-2011::14:52:03 ===
stopped TCP Listener on [::]:5679


Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Mar 18, 2011 at 1:32 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Jim:
>
> I also have a vague recollection that a month or two ago I found a couple
> out of date spots in the plugin development guide that might cause you
> grief.  I did put together a basic plugin for other reasons, that I could
> conceivably husk out and share with you as a starting point you might find
> convenient?
>
> Best regards,
> Jerry
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [
> rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jim Irrer [
> irrer at umich.edu]
> Sent: Friday, March 18, 2011 9:22 AM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Cc: Jim Irrer
> Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide
>      example
>
> That was helpful - I got farther - but not there yet.
>
> I did the checkout of the umbrella with the command above:
>
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568
>
> but I did the 'make co' without any special parameters, so I assumed
> that it did hg commands with respect to the bug23568 branch.
>
> I built the metronome project as outlined on the Rabbit site and added
> the rabbit_metronome-0.0.0.ez and amqp_client.ez files to the
> rabbitmq-public-umbrella/rabbitmq-server/plugins directory, but when I
> start it up I get:
>
> linus:make run
> RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="5679"
> RABBITMQ_LOG_BASE="/tmp" RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-bunny-mnesia"
> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-bunny-plugins-scratch" \
>                RABBITMQ_ALLOW_INPUT=true \
>                RABBITMQ_SERVER_START_ARGS="" \
>                ./scripts/rabbitmq-server
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function amqp_connection:start_direct/0
> *WARNING* Undefined function gb_trees:map/2
> *WARNING* Undefined function os:timestamp/0
> *WARNING* Undefined function random:seed/1
> *WARNING* Undefined function ssl:ssl_accept/3
> 2 plugins activated:
> * amqp_client-0.0.0
> * rabbit_metronome-0.0.0
>
> Erlang (BEAM) emulator version 5.6.5 [source] [64-bit] [smp:2]
> [async-threads:30] [hipe] [kernel-poll:true]
>
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> | v%%VSN%%  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : bunny at linus
> app descriptor :
> /devel/home/irrer/tmp/erl/r2/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
> home dir       : /home/irrer
> config file(s) : (none)
> cookie hash    : JG6HnrDO2nMIVTU2s7iwoA==
> log            : /tmp/bunny.log
> sasl log       : /tmp/bunny-sasl.log
> database dir   : /tmp/rabbitmq-bunny-mnesia
> erlang version : 5.6.5
>
> starting file handle cache server
> ...done
> starting worker pool
>  ...done
> starting database
> ...done
> starting codec correctness check
>  ...done
> -- external infrastructure ready
> starting statistics event manager
> ...done
> starting logging server
> ...done
> starting plugin registry
>  ...done
> starting auth mechanism amqplain
>  ...done
> starting auth mechanism cr-demo
> ...done
> starting auth mechanism plain
> ...done
> starting exchange type direct
> ...done
> starting exchange type fanout
> ...done
> starting exchange type headers
>  ...done
> starting exchange type topic
>  ...done
> -- kernel ready
> starting node monitor
> ...done
> starting cluster delegate
> ...done
> starting guid generator
> ...done
> starting alarm handler
>  ...done
> starting memory monitor
> ...done
> -- core initialized
> starting empty DB check
> ...done
> starting exchange recovery
>  ...done
> starting queue supervisor and queue recovery
>  ...done
> -- message delivery logic ready
> starting error log relay
>  ...done
> starting networking
> ...done
> starting notify cluster nodes
> ...done
> starting direct_client
>  ...done
>
> broker running
> Eshell V5.6.5  (abort with ^G)
> (bunny at linus)1> Erlang has closed
>                                 {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}})
>
> And as advertised it creates a big honkin' dump file.
>
> I also had to create symbolic links so that the code would build.  In my
> rabbitmq-public-umbrella/rabbit_metronome directory I created:
>
> amqp_client -> ../rabbitmq-erlang-client/dist/amqp_client
> rabbit_common -> ../rabbitmq-erlang-client/dist/rabbit_common
>
> The server works fine if run without adding plugins, but when I add them
> it bombs, so I know the plugins are the problem (Right?).
>
> I'm new to Erlang (interesting language), so all I did was cut and paste
> the example Erlang code, so if that code is out of date then it would be a
> problem.
>
> Also: I changed the port to 5679 so it would not interfere with the
> official
> installed RabbitMQ server on the same machine, and I set RABBITMQ_NODENAME
> to 'bunny'.
>
> Thanks,
>
> - Jim
>
> Jim Irrer     irrer at umich.edu<mailto:irrer at umich.edu>       (734) 647-4409
> <tel:%28734%29%20647-4409>
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Thu, Mar 17, 2011 at 8:27 AM, Matthew Sackman <matthew at rabbitmq.com
> <mailto:matthew at rabbitmq.com>> wrote:
> On Tue, Mar 15, 2011 at 07:00:28PM -0400, Jim Irrer wrote:
> > If I checkout the latest server code, will I get the bug23274 fix?
>
> Nope. bug23274 has been abandoned. bug23568 replaces it, but is yet to
> go through QA. None of the documentation regarding writing plugins has
> been updated.
>
> > If not, what is the Mercurial command to get it?
>
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568
>
> But you'll need to make sure all the plugins are also on branch bug23568
> for them to work with the new build system.
>
> If you're writing plugins from scratch, be sure to read the
> rabbitmq-public-umbrella/README.makefiles file, which has a helpful
> section on "Creating a new package".
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:
> rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110318/02e20749/attachment-0001.htm>

From irrer at umich.edu  Fri Mar 18 19:50:36 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 18 Mar 2011 15:50:36 -0400
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development guide
	example
In-Reply-To: <F78BCF638F95D74A99D036114107EDB5028DD5DB19@EXCH-MBX-3.vmware.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>
	<AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5DB19@EXCH-MBX-3.vmware.com>
Message-ID: <AANLkTimDB0SkjUo9dRiSbwJwUBLLT+Q_OCsjrb==_n4-@mail.gmail.com>

Jerry -

Yes, that would be great.  All I'm looking for is a hello world example of
a plugin to get me started.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Mar 18, 2011 at 1:32 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Jim:
>
> I also have a vague recollection that a month or two ago I found a couple
> out of date spots in the plugin development guide that might cause you
> grief.  I did put together a basic plugin for other reasons, that I could
> conceivably husk out and share with you as a starting point you might find
> convenient?
>
> Best regards,
> Jerry
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [
> rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Jim Irrer [
> irrer at umich.edu]
> Sent: Friday, March 18, 2011 9:22 AM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Cc: Jim Irrer
> Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide
>      example
>
> That was helpful - I got farther - but not there yet.
>
> I did the checkout of the umbrella with the command above:
>
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568
>
> but I did the 'make co' without any special parameters, so I assumed
> that it did hg commands with respect to the bug23568 branch.
>
> I built the metronome project as outlined on the Rabbit site and added
> the rabbit_metronome-0.0.0.ez and amqp_client.ez files to the
> rabbitmq-public-umbrella/rabbitmq-server/plugins directory, but when I
> start it up I get:
>
> linus:make run
> RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="5679"
> RABBITMQ_LOG_BASE="/tmp" RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-bunny-mnesia"
> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-bunny-plugins-scratch" \
>                RABBITMQ_ALLOW_INPUT=true \
>                RABBITMQ_SERVER_START_ARGS="" \
>                ./scripts/rabbitmq-server
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function amqp_connection:start_direct/0
> *WARNING* Undefined function gb_trees:map/2
> *WARNING* Undefined function os:timestamp/0
> *WARNING* Undefined function random:seed/1
> *WARNING* Undefined function ssl:ssl_accept/3
> 2 plugins activated:
> * amqp_client-0.0.0
> * rabbit_metronome-0.0.0
>
> Erlang (BEAM) emulator version 5.6.5 [source] [64-bit] [smp:2]
> [async-threads:30] [hipe] [kernel-poll:true]
>
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> | v%%VSN%%  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : bunny at linus
> app descriptor :
> /devel/home/irrer/tmp/erl/r2/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
> home dir       : /home/irrer
> config file(s) : (none)
> cookie hash    : JG6HnrDO2nMIVTU2s7iwoA==
> log            : /tmp/bunny.log
> sasl log       : /tmp/bunny-sasl.log
> database dir   : /tmp/rabbitmq-bunny-mnesia
> erlang version : 5.6.5
>
> starting file handle cache server
> ...done
> starting worker pool
>  ...done
> starting database
> ...done
> starting codec correctness check
>  ...done
> -- external infrastructure ready
> starting statistics event manager
> ...done
> starting logging server
> ...done
> starting plugin registry
>  ...done
> starting auth mechanism amqplain
>  ...done
> starting auth mechanism cr-demo
> ...done
> starting auth mechanism plain
> ...done
> starting exchange type direct
> ...done
> starting exchange type fanout
> ...done
> starting exchange type headers
>  ...done
> starting exchange type topic
>  ...done
> -- kernel ready
> starting node monitor
> ...done
> starting cluster delegate
> ...done
> starting guid generator
> ...done
> starting alarm handler
>  ...done
> starting memory monitor
> ...done
> -- core initialized
> starting empty DB check
> ...done
> starting exchange recovery
>  ...done
> starting queue supervisor and queue recovery
>  ...done
> -- message delivery logic ready
> starting error log relay
>  ...done
> starting networking
> ...done
> starting notify cluster nodes
> ...done
> starting direct_client
>  ...done
>
> broker running
> Eshell V5.6.5  (abort with ^G)
> (bunny at linus)1> Erlang has closed
>                                 {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}})
>
> And as advertised it creates a big honkin' dump file.
>
> I also had to create symbolic links so that the code would build.  In my
> rabbitmq-public-umbrella/rabbit_metronome directory I created:
>
> amqp_client -> ../rabbitmq-erlang-client/dist/amqp_client
> rabbit_common -> ../rabbitmq-erlang-client/dist/rabbit_common
>
> The server works fine if run without adding plugins, but when I add them
> it bombs, so I know the plugins are the problem (Right?).
>
> I'm new to Erlang (interesting language), so all I did was cut and paste
> the example Erlang code, so if that code is out of date then it would be a
> problem.
>
> Also: I changed the port to 5679 so it would not interfere with the
> official
> installed RabbitMQ server on the same machine, and I set RABBITMQ_NODENAME
> to 'bunny'.
>
> Thanks,
>
> - Jim
>
> Jim Irrer     irrer at umich.edu<mailto:irrer at umich.edu>       (734) 647-4409
> <tel:%28734%29%20647-4409>
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Thu, Mar 17, 2011 at 8:27 AM, Matthew Sackman <matthew at rabbitmq.com
> <mailto:matthew at rabbitmq.com>> wrote:
> On Tue, Mar 15, 2011 at 07:00:28PM -0400, Jim Irrer wrote:
> > If I checkout the latest server code, will I get the bug23274 fix?
>
> Nope. bug23274 has been abandoned. bug23568 replaces it, but is yet to
> go through QA. None of the documentation regarding writing plugins has
> been updated.
>
> > If not, what is the Mercurial command to get it?
>
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568
>
> But you'll need to make sure all the plugins are also on branch bug23568
> for them to work with the new build system.
>
> If you're writing plugins from scratch, be sure to read the
> rabbitmq-public-umbrella/README.makefiles file, which has a helpful
> section on "Creating a new package".
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:
> rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110318/c2951dea/attachment.htm>

From james.aimonetti at gmail.com  Fri Mar 18 18:52:29 2011
From: james.aimonetti at gmail.com (James Aimonetti)
Date: Fri, 18 Mar 2011 11:52:29 -0700
Subject: [rabbitmq-discuss] Managing channels,
	esp wrt short lived publishers/consumers
Message-ID: <4D83A9ED.80607@gmail.com>

Hey list,

I'm trying to figure out the best way to manage channel creation in my 
app. Currently, any process that needs to publish or consume gets a 
channel and I realize it is probably horribly inefficient, but as a 
prototype I wasn't too concerned. Now that we're moving forward, I want 
to get this cleaned up before I get too much further along.

I have a setup something like:

[App, App, App] <---> [AMQP] <--> Engine <--> Client

So a client makes a request to the Engine, which creates two processes, 
one to publish events from the client, and one to consume commands from 
the Apps and relay them to the client.

[App, App, App] <--> [AMQP] <-- ReqEvts <-- Client
[App, App, App] <--> [AMQP] --> ReqCtl --> Client

Ideally we'll be handling several hundreds of requests per second from 
clients. So the ReqEvts process pumps 10 or so messages in rapid 
succession at the beginning of a request, heartbeats every 20 or so 
seconds, then pumps another 10 or so messages at the end of the request. 
Requests may last 1 second (so setup and tear down bursts happen almost 
on top of each other) or may last minutes or hours. Meanwhile, the 
ReqCtl receives commands from a targeted exchange from the Apps to relay 
to the Client.

Each App has a queue that it binds to a targeted exchange and one or 
more topic exchanges. In general it receives most messages off the topic 
exchanges and publishes to the targeted exchange.

So, hopefully that gives a broad overview. The Apps and the Engine 
pieces are all on different servers.

So right now each server has an instance of rabbitmq running, and is 
clustered to all the other servers (Apps and Engine, currently four 
total servers but expandable). What I'm not sure about is how to manage 
each server's connection and channels. Each server has a gen_server 
managing the connection to rabbit, as well as the channels. So when a 
pid requests to publish or consume or declare a queue, the gen_server 
checks if the pid is known and uses that channel, or creates a new 
channel and stores the association. With all of these potentially 
short-lived consumers and publishers, I see a LOT of channel 
creation/destruction going on and wonder if there's a better way? Should 
I not have hidden channels behind a gen_server?

My initial thought is to have a dedicated channel for all publishers on 
the server to send over, a dedicated channel for any queue declarations, 
and a channel for each process that is consuming from a queue. Am I 
serializing too much with this setup? Other ideas for how to manage 
channels?

Any guidance is appreciated!

Thanks,
James

From jerryk at vmware.com  Fri Mar 18 21:02:19 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 18 Mar 2011 14:02:19 -0700
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development guide
 example
In-Reply-To: <AANLkTimDB0SkjUo9dRiSbwJwUBLLT+Q_OCsjrb==_n4-@mail.gmail.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>
	<AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5DB19@EXCH-MBX-3.vmware.com>,
	<AANLkTimDB0SkjUo9dRiSbwJwUBLLT+Q_OCsjrb==_n4-@mail.gmail.com>
Message-ID: <F78BCF638F95D74A99D036114107EDB5028DD5DB3B@EXCH-MBX-3.vmware.com>

Hi, Jim.

Attached is a gzipped tar file containing rabbitmq-empty-plugin, a close to absolutely bare bones plugin I made by stripping down one of my projects.

If you uncompress it under your checkout of rabbitmq-public-umbrella, you should be able to just go into that directory and type 'make'.

Then go over to your rabbitmq-server directory, which should be a sibling of the directory where the uncompressed empty plugin lives under your public-umbrella.  In the plugins subdirectory of rabbitmq-server create a symbolic link:

ln -s ../../rabbitmq-empty-plugin rabbitmq-empty-plugin

Now 'make run' to start up your broker.

If all goes well you'll see "rabbit_empty_plugin-0.1.0" appear in the "plugins activated" section of the broker's start-up preamble.

Once the Erlang REPL prompt appears again you can try:

appmon:start().

Explore the app tree that appears and you should see rabbit_empty_plugin present as a child of your rabbit process.  If you double click on the rabbit_empty_plugin node you'll see the supervision tree for the empty plugin.

Note that at the moment it really does nothing except start up.  The rabbit_empty_plugin is an instance of the Erlang 'application' behaviour, and it starts an OTP supervisor called 'rabbit_empty_sup' which lords over an Erlang process called 'rabbit_empty_worker', enforcing the restart policy indicated in the code with an iron, OTP-ish fist.

By grepping around for where the word "empty" appears in the .erl and .app files, and the Makefile, you should be able to mutate this into the basis of your very own Rabbit plugin.

Good luck.  Please let us know if we can help out further.

Best regards,
Jerry

P.S.  You mentioned that you were new to Erlang.  The Manning book below:

http://www.manning.com/logan/

is a good resource, and has better coverage of the OTP libraries and design principles than you'll find in many other places.  Armstrong's book is also likely to be helpful to you if you're going to be using Erlang much:

http://www.pragprog.com/titles/jaerlang/programming-erlang

________________________________________
From: jimirrer at gmail.com [jimirrer at gmail.com] On Behalf Of Jim Irrer [irrer at umich.edu]
Sent: Friday, March 18, 2011 12:50 PM
To: Jerry Kuch
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide example

Jerry -

Yes, that would be great.  All I'm looking for is a hello world example of
a plugin to get me started.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu<mailto:irrer at umich.edu>       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Mar 18, 2011 at 1:32 PM, Jerry Kuch <jerryk at vmware.com<mailto:jerryk at vmware.com>> wrote:
Jim:

I also have a vague recollection that a month or two ago I found a couple out of date spots in the plugin development guide that might cause you grief.  I did put together a basic plugin for other reasons, that I could conceivably husk out and share with you as a starting point you might find convenient?

Best regards,
Jerry
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com> [rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of Jim Irrer [irrer at umich.edu<mailto:irrer at umich.edu>]
Sent: Friday, March 18, 2011 9:22 AM
To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Cc: Jim Irrer
Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide      example

That was helpful - I got farther - but not there yet.

I did the checkout of the umbrella with the command above:

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568

but I did the 'make co' without any special parameters, so I assumed
that it did hg commands with respect to the bug23568 branch.

I built the metronome project as outlined on the Rabbit site and added
the rabbit_metronome-0.0.0.ez and amqp_client.ez files to the
rabbitmq-public-umbrella/rabbitmq-server/plugins directory, but when I
start it up I get:

linus:make run
RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="5679" RABBITMQ_LOG_BASE="/tmp" RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-bunny-mnesia" RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-bunny-plugins-scratch" \
               RABBITMQ_ALLOW_INPUT=true \
               RABBITMQ_SERVER_START_ARGS="" \
               ./scripts/rabbitmq-server
Activating RabbitMQ plugins ...
*WARNING* Undefined function amqp_connection:start_direct/0
*WARNING* Undefined function gb_trees:map/2
*WARNING* Undefined function os:timestamp/0
*WARNING* Undefined function random:seed/1
*WARNING* Undefined function ssl:ssl_accept/3
2 plugins activated:
* amqp_client-0.0.0
* rabbit_metronome-0.0.0

Erlang (BEAM) emulator version 5.6.5 [source] [64-bit] [smp:2] [async-threads:30] [hipe] [kernel-poll:true]


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
| v%%VSN%%  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : bunny at linus
app descriptor : /devel/home/irrer/tmp/erl/r2/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
home dir       : /home/irrer
config file(s) : (none)
cookie hash    : JG6HnrDO2nMIVTU2s7iwoA==
log            : /tmp/bunny.log
sasl log       : /tmp/bunny-sasl.log
database dir   : /tmp/rabbitmq-bunny-mnesia
erlang version : 5.6.5

starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting statistics event manager                                     ...done
starting logging server                                               ...done
starting plugin registry                                              ...done
starting auth mechanism amqplain                                      ...done
starting auth mechanism cr-demo                                       ...done
starting auth mechanism plain                                         ...done
starting exchange type direct                                         ...done
starting exchange type fanout                                         ...done
starting exchange type headers                                        ...done
starting exchange type topic                                          ...done
-- kernel ready
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting alarm handler                                                ...done
starting memory monitor                                               ...done
-- core initialized
starting empty DB check                                               ...done
starting exchange recovery                                            ...done
starting queue supervisor and queue recovery                          ...done
-- message delivery logic ready
starting error log relay                                              ...done
starting networking                                                   ...done
starting notify cluster nodes                                         ...done
starting direct_client                                                ...done

broker running
Eshell V5.6.5  (abort with ^G)
(bunny at linus)1> Erlang has closed
                                {"Kernel pid terminated",application_controller,"{application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) ({application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}})

And as advertised it creates a big honkin' dump file.

I also had to create symbolic links so that the code would build.  In my
rabbitmq-public-umbrella/rabbit_metronome directory I created:

amqp_client -> ../rabbitmq-erlang-client/dist/amqp_client
rabbit_common -> ../rabbitmq-erlang-client/dist/rabbit_common

The server works fine if run without adding plugins, but when I add them
it bombs, so I know the plugins are the problem (Right?).

I'm new to Erlang (interesting language), so all I did was cut and paste
the example Erlang code, so if that code is out of date then it would be a problem.

Also: I changed the port to 5679 so it would not interfere with the official
installed RabbitMQ server on the same machine, and I set RABBITMQ_NODENAME
to 'bunny'.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu<mailto:irrer at umich.edu><mailto:irrer at umich.edu<mailto:irrer at umich.edu>>       (734) 647-4409<tel:%28734%29%20647-4409><tel:%28734%29%20647-4409>
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Mar 17, 2011 at 8:27 AM, Matthew Sackman <matthew at rabbitmq.com<mailto:matthew at rabbitmq.com><mailto:matthew at rabbitmq.com<mailto:matthew at rabbitmq.com>>> wrote:
On Tue, Mar 15, 2011 at 07:00:28PM -0400, Jim Irrer wrote:
> If I checkout the latest server code, will I get the bug23274 fix?

Nope. bug23274 has been abandoned. bug23568 replaces it, but is yet to
go through QA. None of the documentation regarding writing plugins has
been updated.

> If not, what is the Mercurial command to get it?

hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568

But you'll need to make sure all the plugins are also on branch bug23568
for them to work with the new build system.

If you're writing plugins from scratch, be sure to read the
rabbitmq-public-umbrella/README.makefiles file, which has a helpful
section on "Creating a new package".

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com><mailto:rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq-empty-plugin.tar.gz
Type: application/x-gzip
Size: 4353 bytes
Desc: rabbitmq-empty-plugin.tar.gz
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110318/1a3e76f9/attachment-0001.bin>

From irrer at umich.edu  Fri Mar 18 21:36:39 2011
From: irrer at umich.edu (Jim Irrer)
Date: Fri, 18 Mar 2011 17:36:39 -0400
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development guide
	example
In-Reply-To: <F78BCF638F95D74A99D036114107EDB5028DD5DB3B@EXCH-MBX-3.vmware.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>
	<AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5DB19@EXCH-MBX-3.vmware.com>
	<AANLkTimDB0SkjUo9dRiSbwJwUBLLT+Q_OCsjrb==_n4-@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5DB3B@EXCH-MBX-3.vmware.com>
Message-ID: <AANLkTinNEpCRunEWshkF2HxgG7r=6XM7qroc2wpaRXL9@mail.gmail.com>

Yes - that works!

Suggestion: Add the trivial plugin to the standard build so that
it stays up to date with coding changes.  Developers love examples
that work, which has been one of the reasons for Rabbit's success.

Jerry - Thank you very much,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Fri, Mar 18, 2011 at 5:02 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> Hi, Jim.
>
> Attached is a gzipped tar file containing rabbitmq-empty-plugin, a close to
> absolutely bare bones plugin I made by stripping down one of my projects.
>
> If you uncompress it under your checkout of rabbitmq-public-umbrella, you
> should be able to just go into that directory and type 'make'.
>
> Then go over to your rabbitmq-server directory, which should be a sibling
> of the directory where the uncompressed empty plugin lives under your
> public-umbrella.  In the plugins subdirectory of rabbitmq-server create a
> symbolic link:
>
> ln -s ../../rabbitmq-empty-plugin rabbitmq-empty-plugin
>
> Now 'make run' to start up your broker.
>
> If all goes well you'll see "rabbit_empty_plugin-0.1.0" appear in the
> "plugins activated" section of the broker's start-up preamble.
>
> Once the Erlang REPL prompt appears again you can try:
>
> appmon:start().
>
> Explore the app tree that appears and you should see rabbit_empty_plugin
> present as a child of your rabbit process.  If you double click on the
> rabbit_empty_plugin node you'll see the supervision tree for the empty
> plugin.
>
> Note that at the moment it really does nothing except start up.  The
> rabbit_empty_plugin is an instance of the Erlang 'application' behaviour,
> and it starts an OTP supervisor called 'rabbit_empty_sup' which lords over
> an Erlang process called 'rabbit_empty_worker', enforcing the restart policy
> indicated in the code with an iron, OTP-ish fist.
>
> By grepping around for where the word "empty" appears in the .erl and .app
> files, and the Makefile, you should be able to mutate this into the basis of
> your very own Rabbit plugin.
>
> Good luck.  Please let us know if we can help out further.
>
> Best regards,
> Jerry
>
> P.S.  You mentioned that you were new to Erlang.  The Manning book below:
>
> http://www.manning.com/logan/
>
> is a good resource, and has better coverage of the OTP libraries and design
> principles than you'll find in many other places.  Armstrong's book is also
> likely to be helpful to you if you're going to be using Erlang much:
>
> http://www.pragprog.com/titles/jaerlang/programming-erlang
>
> ________________________________________
> From: jimirrer at gmail.com [jimirrer at gmail.com] On Behalf Of Jim Irrer [
> irrer at umich.edu]
> Sent: Friday, March 18, 2011 12:50 PM
> To: Jerry Kuch
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide
> example
>
> Jerry -
>
> Yes, that would be great.  All I'm looking for is a hello world example of
> a plugin to get me started.
>
> Thanks,
>
> - Jim
>
> Jim Irrer     irrer at umich.edu<mailto:irrer at umich.edu>       (734) 647-4409
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Fri, Mar 18, 2011 at 1:32 PM, Jerry Kuch <jerryk at vmware.com<mailto:
> jerryk at vmware.com>> wrote:
> Jim:
>
> I also have a vague recollection that a month or two ago I found a couple
> out of date spots in the plugin development guide that might cause you
> grief.  I did put together a basic plugin for other reasons, that I could
> conceivably husk out and share with you as a starting point you might find
> convenient?
>
> Best regards,
> Jerry
> ________________________________________
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com> [
> rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com>] On Behalf Of Jim Irrer [
> irrer at umich.edu<mailto:irrer at umich.edu>]
> Sent: Friday, March 18, 2011 9:22 AM
> To: rabbitmq-discuss at lists.rabbitmq.com<mailto:
> rabbitmq-discuss at lists.rabbitmq.com>
> Cc: Jim Irrer
> Subject: Re: [rabbitmq-discuss] Fwd: Problem with plugin development guide
>      example
>
> That was helpful - I got farther - but not there yet.
>
> I did the checkout of the umbrella with the command above:
>
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568
>
> but I did the 'make co' without any special parameters, so I assumed
> that it did hg commands with respect to the bug23568 branch.
>
> I built the metronome project as outlined on the Rabbit site and added
> the rabbit_metronome-0.0.0.ez and amqp_client.ez files to the
> rabbitmq-public-umbrella/rabbitmq-server/plugins directory, but when I
> start it up I get:
>
> linus:make run
> RABBITMQ_NODE_IP_ADDRESS="" RABBITMQ_NODE_PORT="5679"
> RABBITMQ_LOG_BASE="/tmp" RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-bunny-mnesia"
> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-bunny-plugins-scratch" \
>               RABBITMQ_ALLOW_INPUT=true \
>               RABBITMQ_SERVER_START_ARGS="" \
>               ./scripts/rabbitmq-server
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function amqp_connection:start_direct/0
> *WARNING* Undefined function gb_trees:map/2
> *WARNING* Undefined function os:timestamp/0
> *WARNING* Undefined function random:seed/1
> *WARNING* Undefined function ssl:ssl_accept/3
> 2 plugins activated:
> * amqp_client-0.0.0
> * rabbit_metronome-0.0.0
>
> Erlang (BEAM) emulator version 5.6.5 [source] [64-bit] [smp:2]
> [async-threads:30] [hipe] [kernel-poll:true]
>
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> | v%%VSN%%  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2011 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : bunny at linus
> app descriptor :
> /devel/home/irrer/tmp/erl/r2/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
> home dir       : /home/irrer
> config file(s) : (none)
> cookie hash    : JG6HnrDO2nMIVTU2s7iwoA==
> log            : /tmp/bunny.log
> sasl log       : /tmp/bunny-sasl.log
> database dir   : /tmp/rabbitmq-bunny-mnesia
> erlang version : 5.6.5
>
> starting file handle cache server
> ...done
> starting worker pool
>  ...done
> starting database
> ...done
> starting codec correctness check
>  ...done
> -- external infrastructure ready
> starting statistics event manager
> ...done
> starting logging server
> ...done
> starting plugin registry
>  ...done
> starting auth mechanism amqplain
>  ...done
> starting auth mechanism cr-demo
> ...done
> starting auth mechanism plain
> ...done
> starting exchange type direct
> ...done
> starting exchange type fanout
> ...done
> starting exchange type headers
>  ...done
> starting exchange type topic
>  ...done
> -- kernel ready
> starting node monitor
> ...done
> starting cluster delegate
> ...done
> starting guid generator
> ...done
> starting alarm handler
>  ...done
> starting memory monitor
> ...done
> -- core initialized
> starting empty DB check
> ...done
> starting exchange recovery
>  ...done
> starting queue supervisor and queue recovery
>  ...done
> -- message delivery logic ready
> starting error log relay
>  ...done
> starting networking
> ...done
> starting notify cluster nodes
> ...done
> starting direct_client
>  ...done
>
> broker running
> Eshell V5.6.5  (abort with ^G)
> (bunny at linus)1> Erlang has closed
>                                {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit_metronome,{shutdown,{rabbit_metronome,start,[normal,[]]}}})
>
> And as advertised it creates a big honkin' dump file.
>
> I also had to create symbolic links so that the code would build.  In my
> rabbitmq-public-umbrella/rabbit_metronome directory I created:
>
> amqp_client -> ../rabbitmq-erlang-client/dist/amqp_client
> rabbit_common -> ../rabbitmq-erlang-client/dist/rabbit_common
>
> The server works fine if run without adding plugins, but when I add them
> it bombs, so I know the plugins are the problem (Right?).
>
> I'm new to Erlang (interesting language), so all I did was cut and paste
> the example Erlang code, so if that code is out of date then it would be a
> problem.
>
> Also: I changed the port to 5679 so it would not interfere with the
> official
> installed RabbitMQ server on the same machine, and I set RABBITMQ_NODENAME
> to 'bunny'.
>
> Thanks,
>
> - Jim
>
> Jim Irrer     irrer at umich.edu<mailto:irrer at umich.edu><mailto:
> irrer at umich.edu<mailto:irrer at umich.edu>>       (734) 647-4409
> <tel:%28734%29%20647-4409><tel:%28734%29%20647-4409>
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Thu, Mar 17, 2011 at 8:27 AM, Matthew Sackman <matthew at rabbitmq.com
> <mailto:matthew at rabbitmq.com><mailto:matthew at rabbitmq.com<mailto:
> matthew at rabbitmq.com>>> wrote:
> On Tue, Mar 15, 2011 at 07:00:28PM -0400, Jim Irrer wrote:
> > If I checkout the latest server code, will I get the bug23274 fix?
>
> Nope. bug23274 has been abandoned. bug23568 replaces it, but is yet to
> go through QA. None of the documentation regarding writing plugins has
> been updated.
>
> > If not, what is the Mercurial command to get it?
>
> hg clone http://hg.rabbitmq.com/rabbitmq-public-umbrella -r bug23568
>
> But you'll need to make sure all the plugins are also on branch bug23568
> for them to work with the new build system.
>
> If you're writing plugins from scratch, be sure to read the
> rabbitmq-public-umbrella/README.makefiles file, which has a helpful
> section on "Creating a new package".
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:
> rabbitmq-discuss at lists.rabbitmq.com><mailto:
> rabbitmq-discuss at lists.rabbitmq.com<mailto:
> rabbitmq-discuss at lists.rabbitmq.com>>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110318/d30c2b0a/attachment-0001.htm>

From jerryk at vmware.com  Fri Mar 18 22:06:59 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 18 Mar 2011 15:06:59 -0700
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development guide
 example
In-Reply-To: <AANLkTinNEpCRunEWshkF2HxgG7r=6XM7qroc2wpaRXL9@mail.gmail.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>
	<AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5DB19@EXCH-MBX-3.vmware.com>
	<AANLkTimDB0SkjUo9dRiSbwJwUBLLT+Q_OCsjrb==_n4-@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5DB3B@EXCH-MBX-3.vmware.com>,
	<AANLkTinNEpCRunEWshkF2HxgG7r=6XM7qroc2wpaRXL9@mail.gmail.com>
Message-ID: <F78BCF638F95D74A99D036114107EDB5028DD5DB3E@EXCH-MBX-3.vmware.com>

> Yes - that works!

Great!  Glad to hear it was helpful.

> Suggestion: Add the trivial plugin to the standard build so that
> it stays up to date with coding changes.  Developers love examples
> that work, which has been one of the reasons for Rabbit's success.

Thanks very much for the suggestion.  We've had a couple of internal
discussions lately about ways we might help automate the keeping of
things like samples, documentation and tutorials up to date with the
reality of the code and APIs.  I hope we'll do better in the future,
and apologize that you had a bumpy initial experience.

> Jerry - Thank you very much,

No worries.  Please feel free to ping us any time...

Best regards,
Jerry

From chen650 at yahoo.com  Fri Mar 18 23:48:53 2011
From: chen650 at yahoo.com (alex chen)
Date: Fri, 18 Mar 2011 16:48:53 -0700 (PDT)
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <20110318171120.GM2414@rabbitmq.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>
	<20110318171120.GM2414@rabbitmq.com>
Message-ID: <819166.65905.qm@web31806.mail.mud.yahoo.com>

Matthew,


> Over lunch we did manage to come up with a hypothesis as to what's going
> wrong, and a quick subsequent test showed this to be accurate. I've now
> fixed the bug and whilst it's pending QA, I'd be interested in whether
> it fixes your crash even under a 32-bit Erlang VM. If you have the time
> and are comfortable compiling Rabbit from scratch, try the branch called
> "bug23968" and repeat you're test. It should not crash, even under a
> 32-bit VM, and it should use substantially less memory too.

I did "hg update -C bug23968", but the broker still crashed under 32 bit VM.
it did not crash under 64 bit though.

-alex


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110318/69339761/attachment.htm>

From jerryk at vmware.com  Sat Mar 19 00:01:06 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Fri, 18 Mar 2011 17:01:06 -0700
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <819166.65905.qm@web31806.mail.mud.yahoo.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>
	<20110318171120.GM2414@rabbitmq.com>,
	<819166.65905.qm@web31806.mail.mud.yahoo.com>
Message-ID: <F78BCF638F95D74A99D036114107EDB5028DD5DB76@EXCH-MBX-3.vmware.com>

> > Over lunch we did manage to come up with a hypothesis as to what's going
> > wrong, and a quick subsequent test showed this to be accurate. I've now
> > fixed the bug and whilst it's pending QA, I'd be interested in whether
> > it fixes your crash even under a 32-bit Erlang VM. If you have the time
> > and are comfortable compiling Rabbit from scratch, try the branch called
> > "bug23968" and repeat you're test. It should not crash, even under a
> > 32-bit VM, and it should use substantially less memory too.
>
> I did "hg update -C bug23968", but the broker still crashed under 32 bit VM.
> it did not crash under 64 bit though.

Also, in case neither John D. nor me has posted it yet, the crashes we
saw in his office under an attempt to replicate a scenario similar to
the one Alex describes were also on a 32-bit Erlang VM.

Jerry




From matthias at rabbitmq.com  Sat Mar 19 15:45:20 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 19 Mar 2011 15:45:20 +0000
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <819166.65905.qm@web31806.mail.mud.yahoo.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>	<20110318090403.GC2752@rabbitmq.com>	<20110318171120.GM2414@rabbitmq.com>
	<819166.65905.qm@web31806.mail.mud.yahoo.com>
Message-ID: <4D84CF90.4060104@rabbitmq.com>

Alex,

alex chen wrote:
> I did "hg update -C bug23968", but the broker still crashed under 32 bit VM.
> it did not crash under 64 bit though.

Interesting.

As requested before, it would be really helpful if you updated your 
tests to work with the latest C client, scripted the entire test run and 
posted the code.

Regards,

Matthias.

From sahmed1020 at gmail.com  Mon Mar 21 03:15:06 2011
From: sahmed1020 at gmail.com (S Ahmed)
Date: Sun, 20 Mar 2011 23:15:06 -0400
Subject: [rabbitmq-discuss] How to spawn multiple worker processes (in Ruby)
	to respond to messages
Message-ID: <AANLkTimWVOhtr2keUH9tQAebVy=BkrCgAJf0-2cO_rUb@mail.gmail.com>

I want to have multiple worker processes to respond to messages in a
particular queue.

Some tasks may take longer to process than others.

In Ruby, what options do I have to spawn 3-4 processes to run at the same
time?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110320/d62a82d9/attachment.htm>

From chen650 at yahoo.com  Mon Mar 21 05:04:46 2011
From: chen650 at yahoo.com (alex chen)
Date: Sun, 20 Mar 2011 22:04:46 -0700 (PDT)
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <4D84CF90.4060104@rabbitmq.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>
	<20110318171120.GM2414@rabbitmq.com>
	<819166.65905.qm@web31806.mail.mud.yahoo.com>
	<4D84CF90.4060104@rabbitmq.com>
Message-ID: <364553.11668.qm@web31811.mail.mud.yahoo.com>

Matthias,


> As requested before, it would be really helpful if you updated your tests to 
>work with the latest C client, scripted the entire test run and posted the code.

I have changed the amqp_consumer.c to build with the latest c client.  will do 
some testing and simplify the scripts a bit tomorrow, then post the tests to the 
list.
 
-alex



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110320/2691f937/attachment.htm>

From jdetreville at vmware.com  Mon Mar 21 05:46:36 2011
From: jdetreville at vmware.com (John DeTreville)
Date: Sun, 20 Mar 2011 22:46:36 -0700
Subject: [rabbitmq-discuss] browse messages on a queue
In-Reply-To: <9319F360221C65428EA819A4E8DC34ED028DF6395D@OPMBOX21UK.options-it.com>
References: <9319F360221C65428EA819A4E8DC34ED028DF6395D@OPMBOX21UK.options-it.com>
Message-ID: <9968CC83-00A5-4320-8D30-999599BAF2EF@vmware.com>

Joe,

RabbitMQ lets you write your own plug-ins for storing queues. We're producing a few accompanying samples now, including one that stores all messages in a MySQL database. Its performance might be much lower than the standard queue implementation, but it would allow you to watch messages go by.

This MySQL plug-in should be out soon, but certainly not this month.

Cheers,
John

On Mar 18, 2011, at 10:33 AM, Kearney, Joe wrote:

> Hi,
> 
> I'm interested in finding or writing a tool to monitor messages on a rabbit queue, in particular to be able to view messages waiting on the queue. The use case is for occasional monitoring and debugging; I'm not suggesting using a browse/read-only function in normal processing.
> 
> This was raised on this mail group last July (http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-July/008004.html). Two pertinent quotes from that thread:
> 
>> The only way you can get at the messages is through the normal AMQP methods that consume the messages (basic.consume and basic.get).  But these are not simple read-only operations of the type you might want for monitoring of the messages within a queue.
> 
>> it's actually quite hard to come up with a sensible semantics for it that isn't too constraining on implementations
> 
> Has there been any progress on a built-in way to do this? Any thoughts on when/whether this might be introduced?
> 
> Alternatively, can you comment on a sensible way to fake it? The naive implementation that springs to mind is simply to get a few messages from the head of the queue in a transaction and roll it back. Clearly this is more heavyweight than it need be, but are there any reasons that this behaviour should really be avoided for manual monitoring, until such a time as real read-only browsing is supported?
> 
> Thanks,
> Joe
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From taylste at gmail.com  Mon Mar 21 08:02:56 2011
From: taylste at gmail.com (Steven Taylor)
Date: Mon, 21 Mar 2011 08:02:56 +0000
Subject: [rabbitmq-discuss] vhostpath
Message-ID: <AANLkTi=zeXg7PKMJkzFCTQvwEA1P_Kt0_NrxWCGU8P=7@mail.gmail.com>

Hi,

I can't find a definition on rabbitmq.com for vhostpath, apart from that you
can create/delete one + assign users to it... a channel can operate in
one... queues can be assigned on?

Okay, so it's a grouped permissions thing... and we are imagining that a
queue (or an X lives) on a "virtual" server or host.

Does this terminology come from the UNIX / LINUX world?  You might put a
few alternative perspectives on what a vhost is... or a definition for it
for those of us that are reaquanting ourselves with UNIX / LINUX.

In the course of writing this email, I've mostly worked it out now, but I
sent the email on anyway as I know you want to keep making it easier for
people to use RabbitMQ.

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110321/6c72f10b/attachment.htm>

From timp at paneris.org  Mon Mar 21 09:44:03 2011
From: timp at paneris.org (Tim Pizey)
Date: Mon, 21 Mar 2011 09:44:03 +0000
Subject: [rabbitmq-discuss] Fwd: Problem with plugin development guide
	example
In-Reply-To: <F78BCF638F95D74A99D036114107EDB5028DD5DB3E@EXCH-MBX-3.vmware.com>
References: <AANLkTimxUfcR-0fZpLCW6R3Wt1ftn05Wvvzs1YEVoBpy@mail.gmail.com>
	<20110317122738.GB2414@rabbitmq.com>
	<AANLkTi=5Xza_xvUhVPJaLGAJaKjvhFkhsCNFoknjyTW+@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5DB19@EXCH-MBX-3.vmware.com>
	<AANLkTimDB0SkjUo9dRiSbwJwUBLLT+Q_OCsjrb==_n4-@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5DB3B@EXCH-MBX-3.vmware.com>
	<AANLkTinNEpCRunEWshkF2HxgG7r=6XM7qroc2wpaRXL9@mail.gmail.com>
	<F78BCF638F95D74A99D036114107EDB5028DD5DB3E@EXCH-MBX-3.vmware.com>
Message-ID: <AANLkTimJE6wGLN0J=CktRwpLQLnCHJ-W9+Xqd2fA6_G1@mail.gmail.com>

On 18 March 2011 22:06, Jerry Kuch wrote:

>> Suggestion: Add the trivial plugin to the standard build so that
>> it stays up to date with coding changes. ?Developers love examples
>> that work, which has been one of the reasons for Rabbit's success.
>
> Thanks very much for the suggestion. ?We've had a couple of internal
> discussions lately about ways we might help automate the keeping of
> things like samples, documentation and tutorials up to date with the
> reality of the code and APIs.

Set the examples up in Jenkins.

> I hope we'll do better in the future,
> and apologize that you had a bumpy initial experience.

Presumably you are getting quite good take up from developers,
so what path are those that do not fall into the pothole that Jim and
I did taking?

Documented examples failing is quite some fail.

Looking forwards to playing when the primrose path is a little flatter.

cheers
Tim


-- 
Tim Pizey
http://pizey.net/~timp

From emile at rabbitmq.com  Mon Mar 21 09:53:51 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 21 Mar 2011 09:53:51 +0000
Subject: [rabbitmq-discuss] vhostpath
In-Reply-To: <AANLkTi=zeXg7PKMJkzFCTQvwEA1P_Kt0_NrxWCGU8P=7@mail.gmail.com>
References: <AANLkTi=zeXg7PKMJkzFCTQvwEA1P_Kt0_NrxWCGU8P=7@mail.gmail.com>
Message-ID: <4D87202F.5040507@rabbitmq.com>

Hi Steven,

On 21/03/11 08:02, Steven Taylor wrote:
> Hi,
> I can't find a definition on rabbitmq.com <http://rabbitmq.com> for
> vhostpath

[...]

Thanks for pointing this out. The AMQP specification has details in 
section 3.1.2:

"""
A virtual host comprises its own name space, a set of exchanges, message 
queues, and all associated objects. Each connection MUST BE associated 
with a single virtual host
"""

At the time of writing the specification was here:
http://www.amqp.org/confluence/download/attachments/720900/amqp0-9-1.pdf


Regards

Emile

From stastny at 101ideas.cz  Mon Mar 21 09:54:50 2011
From: stastny at 101ideas.cz (=?UTF-8?B?SmFrdWIgxaDFpWFzdG7DvQ==?=)
Date: Mon, 21 Mar 2011 09:54:50 +0000
Subject: [rabbitmq-discuss] How to spawn multiple worker processes (in
 Ruby) to respond to messages
In-Reply-To: <AANLkTimWVOhtr2keUH9tQAebVy=BkrCgAJf0-2cO_rUb@mail.gmail.com>
References: <AANLkTimWVOhtr2keUH9tQAebVy=BkrCgAJf0-2cO_rUb@mail.gmail.com>
Message-ID: <AANLkTinuEkiJ6774KWcC15_ALQcp0pDUiYsBvQFqKEZ1@mail.gmail.com>

Ahmed, I think the best is to use Kernel#fork: just let your script load all
the dependencies and do all the setup except the actual connection to AMQP,
then fork how many times you need and then in the fork just run AMQP.start.
Something like:

require "xxx"
# some setup

n.times do
  pid = fork do
    AMQP.start do
      MQ.new.queue ....
    end
  end
end

And probably Process.detach(pid)

Jakub

http://www.flickr.com/photos/jakub-stastny
http://twitter.com/botanicus



On 21 March 2011 03:15, S Ahmed <sahmed1020 at gmail.com> wrote:

> I want to have multiple worker processes to respond to messages in a
> particular queue.
>
> Some tasks may take longer to process than others.
>
> In Ruby, what options do I have to spawn 3-4 processes to run at the same
> time?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110321/a49bb8eb/attachment-0001.htm>

From taylste at gmail.com  Mon Mar 21 11:52:16 2011
From: taylste at gmail.com (Steven Taylor)
Date: Mon, 21 Mar 2011 11:52:16 +0000
Subject: [rabbitmq-discuss] vhostpath
In-Reply-To: <4D87202F.5040507@rabbitmq.com>
References: <AANLkTi=zeXg7PKMJkzFCTQvwEA1P_Kt0_NrxWCGU8P=7@mail.gmail.com>
	<4D87202F.5040507@rabbitmq.com>
Message-ID: <AANLkTimdB11p=FnYPoVnfsqCjeE80QqjrMrf=WgZuP=p@mail.gmail.com>

Hi,

if an exchange / queue is defined in a vhost (being a distinct namespace),
are there other benefits such as:

when a new queue is created, it wont cause a reparse / graph node rebuild of
*all* routing keys, only those in this particular vhost/namespace?  i.e.
RabbitMQ (can't remember exact Rabbit terminology) use a topology/graph
based search algorithm to make topic exchanges message destination
resolution more efficient.

Is this statement True or False?  Not sure how important this is.  Not sure
how expensive the routing graph rebuild thing is... it just occured to me
while thinking about a certain senario.

...
Also, thanks for the info... I know you guys live and breathe the AQMP spec,
but most of us aren't going to read it if we don't have to.  I think many
newcommers will have this perspective.  That said, I do plan on looking at
the AQMP spec at some point.

thanks,
-Steven

On 21 March 2011 09:53, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Steven,
>
>
> On 21/03/11 08:02, Steven Taylor wrote:
>
>> Hi,
>> I can't find a definition on rabbitmq.com <http://rabbitmq.com> for
>> vhostpath
>>
>
> [...]
>
> Thanks for pointing this out. The AMQP specification has details in section
> 3.1.2:
>
> """
> A virtual host comprises its own name space, a set of exchanges, message
> queues, and all associated objects. Each connection MUST BE associated with
> a single virtual host
> """
>
> At the time of writing the specification was here:
> http://www.amqp.org/confluence/download/attachments/720900/amqp0-9-1.pdf
>
>
> Regards
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110321/7db24120/attachment.htm>

From emile at rabbitmq.com  Mon Mar 21 12:09:01 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 21 Mar 2011 12:09:01 +0000
Subject: [rabbitmq-discuss] vhostpath
In-Reply-To: <AANLkTimdB11p=FnYPoVnfsqCjeE80QqjrMrf=WgZuP=p@mail.gmail.com>
References: <AANLkTi=zeXg7PKMJkzFCTQvwEA1P_Kt0_NrxWCGU8P=7@mail.gmail.com>	<4D87202F.5040507@rabbitmq.com>
	<AANLkTimdB11p=FnYPoVnfsqCjeE80QqjrMrf=WgZuP=p@mail.gmail.com>
Message-ID: <4D873FDD.6020401@rabbitmq.com>

Hi Steven,

On 21/03/11 11:52, Steven Taylor wrote:
> Hi,
> if an exchange / queue is defined in a vhost (being a distinct
> namespace), are there other benefits such as:
> when a new queue is created, it wont cause a reparse / graph node
> rebuild of *all* routing keys, only those in this particular
> vhost/namespace?

The broker automatically creates some associated default exchanges when 
you add a vhost, so adding a vhost is a very cheap operation. None of 
the actions you mention occur at the time of vhost creation.

> i.e. RabbitMQ (can't remember exact Rabbit
> terminology) use a topology/graph based search algorithm to make topic
> exchanges message destination resolution more efficient.
> Is this statement True or False?

Rabbit uses a trie implementation for efficient topic routing. The 
relevant blog post has further details:

http://www.rabbitmq.com/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1/


Regards

Emile

From hedelson at vmware.com  Mon Mar 21 14:35:47 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Mon, 21 Mar 2011 08:35:47 -0600
Subject: [rabbitmq-discuss] High-performance routing strategies
Message-ID: <C9ACBE63.3232%hedelson@vmware.com>

I am curious to know what routing strategies and broker topologies are being
implemented for performance in similar scenarios of:

* One broker must handle the load of 1000 distributed agents/clients
* A cluster of brokers handles 10,000 or more distributed agents/clients

For each agent there innumerable routing configurations, are you going with
more exchanges and queues/less routing keys or hierarchical routing schemes
for instance and fewer exchanges and queues? Do you have test data to share
that supports the choice you can share with me?
 
Helena 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110321/ccf28b33/attachment.htm>

From videlalvaro at gmail.com  Mon Mar 21 15:10:38 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 21 Mar 2011 16:10:38 +0100
Subject: [rabbitmq-discuss] A project I've been working on
Message-ID: <5CA2D4DB-A7B6-407C-9253-3793848AC394@gmail.com>

Hi list,

Lately I've been working on a project to improve the monitoring and administration tools for RabbitMQ.

So for example, we have an RPC setup. We would like to know how many messages is the RPC processing per minute, what's the fastest reply it generated, what was the slowest one, and so on.

I've implemented a process that can watch the RPC Server and produce some statistics based on the collected information.

Another interesting use case is to be able to log or inspect the messages send to a consumer, say if you want to do that during a certain period of time where we want to debug the application. Once we have debugged it, we would like to remove the *inspection* step and send the messages to the final destination directly to avoid overhead. Of course we don't want to stop the producer or consumer applications and change the code to accomplish that.

I think this can be really helpful when monitoring message flow across the network. I'm basing my implementation on the patterns explained in the "Enterprise Integration Patterns" book.

I've created very basic demo videos where I showcase what my proof of concept can do so far.

In the first video I implement the Smart Proxy pattern(http://www.eaipatterns.com/SmartProxy.html), where I track the messages on a RPC setup and generate stats based on them.

http://vimeo.com/20966661

On the second video I implement the Detour pattern(http://www.eaipatterns.com/Detour.html), that I use to detour messages, to be able to introduce inspection steps.

http://vimeo.com/20966841

Both the Detour Process and Smart Proxy process are controlled via a Control Bus that tells them to become active, to listen on an exchange and publish to another exchange and so on.

I would like to get your feedback about what do you think regarding the "usefulness" of this project.

I know the web interface that it has now is pretty ugly and everything looks very geeky now, but I think the main idea of having a Web based Control bus where we can activate/deactivate consumers and so on is quite interesting.

Looking forward for your feedback,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110321/6303f90c/attachment.htm>

From matthew at rabbitmq.com  Mon Mar 21 15:43:00 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 21 Mar 2011 15:43:00 +0000
Subject: [rabbitmq-discuss] High-performance routing strategies
In-Reply-To: <C9ACBE63.3232%hedelson@vmware.com>
References: <C9ACBE63.3232%hedelson@vmware.com>
Message-ID: <20110321154259.GD6721@rabbitmq.com>

Helena,

On Mon, Mar 21, 2011 at 08:35:47AM -0600, Helena Edelson wrote:
> I am curious to know what routing strategies and broker topologies are being
> implemented for performance in similar scenarios of:
> 
> * One broker must handle the load of 1000 distributed agents/clients
> * A cluster of brokers handles 10,000 or more distributed agents/clients

Neither of these scenarios will necessarily induce high load in
RabbitMQ.

100,000 queues on a single broker is fine - I've just created that on my
desktop with no problems. You could likely get to well over a million
with a bit of tuning and enough RAM.

Exchanges and bindings are even cheaper in terms of the memory cost.

Doing 10,000+ connections to a single node is also fine. There is
something somewhere which affects connection creation in RabbitMQ which
causes a log_2(N) slow down on connection establishment: i.e. whilst
initially, I can do about 1000 new connections a second, beyond 10,000
or so connections, the rate of connection establishment slows a little.

What does induce load is binding/exchange churn rate and message rate
and message size.

A sustained load of N thousand binding creation/deletion events per
second will likely overwhelm a single machine, and due to the fact that
such changes have to be distributed to all nodes in a cluster will
likely also induce substantial load on a large cluster too. Isolating
such things really requires stuff like federation which AMQP isn't
really well suited to, in the general case.

Matthew

From videlalvaro at gmail.com  Mon Mar 21 15:46:39 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 21 Mar 2011 16:46:39 +0100
Subject: [rabbitmq-discuss] High-performance routing strategies
In-Reply-To: <20110321154259.GD6721@rabbitmq.com>
References: <C9ACBE63.3232%hedelson@vmware.com>
	<20110321154259.GD6721@rabbitmq.com>
Message-ID: <91986DA9-5564-44F1-B208-C8475D2D8F8E@gmail.com>

Hi,

I was testing queue number limits the other day, one thing to watch is the number of erlang processes. If I'm not mistaken a new queue implies a new Erlang Process. Probably the same with exchanges?

Cheers,

Alvaro

On Mar 21, 2011, at 4:43 PM, Matthew Sackman wrote:

> Helena,
> 
> On Mon, Mar 21, 2011 at 08:35:47AM -0600, Helena Edelson wrote:
>> I am curious to know what routing strategies and broker topologies are being
>> implemented for performance in similar scenarios of:
>> 
>> * One broker must handle the load of 1000 distributed agents/clients
>> * A cluster of brokers handles 10,000 or more distributed agents/clients
> 
> Neither of these scenarios will necessarily induce high load in
> RabbitMQ.
> 
> 100,000 queues on a single broker is fine - I've just created that on my
> desktop with no problems. You could likely get to well over a million
> with a bit of tuning and enough RAM.
> 
> Exchanges and bindings are even cheaper in terms of the memory cost.
> 
> Doing 10,000+ connections to a single node is also fine. There is
> something somewhere which affects connection creation in RabbitMQ which
> causes a log_2(N) slow down on connection establishment: i.e. whilst
> initially, I can do about 1000 new connections a second, beyond 10,000
> or so connections, the rate of connection establishment slows a little.
> 
> What does induce load is binding/exchange churn rate and message rate
> and message size.
> 
> A sustained load of N thousand binding creation/deletion events per
> second will likely overwhelm a single machine, and due to the fact that
> such changes have to be distributed to all nodes in a cluster will
> likely also induce substantial load on a large cluster too. Isolating
> such things really requires stuff like federation which AMQP isn't
> really well suited to, in the general case.
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthew at rabbitmq.com  Mon Mar 21 15:59:23 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 21 Mar 2011 15:59:23 +0000
Subject: [rabbitmq-discuss] High-performance routing strategies
In-Reply-To: <91986DA9-5564-44F1-B208-C8475D2D8F8E@gmail.com>
References: <C9ACBE63.3232%hedelson@vmware.com>
	<20110321154259.GD6721@rabbitmq.com>
	<91986DA9-5564-44F1-B208-C8475D2D8F8E@gmail.com>
Message-ID: <20110321155923.GB5248@rabbitmq.com>

On Mon, Mar 21, 2011 at 04:46:39PM +0100, Alvaro Videla wrote:
> I was testing queue number limits the other day, one thing to watch is the number of erlang processes. If I'm not mistaken a new queue implies a new Erlang Process. Probably the same with exchanges?

Yes, followed by no. A queue is an Erlang process. By default, we set
the erlang VM with a process limit of 1M, but that can be raised.

An exchange is not a process. An exchange is just a row in mnesia. This
is why exchanges survive the death of the creating node in a cluster,
but queues do not.

Matthew

From videlalvaro at gmail.com  Mon Mar 21 16:03:00 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 21 Mar 2011 17:03:00 +0100
Subject: [rabbitmq-discuss] High-performance routing strategies
In-Reply-To: <20110321155923.GB5248@rabbitmq.com>
References: <C9ACBE63.3232%hedelson@vmware.com>
	<20110321154259.GD6721@rabbitmq.com>
	<91986DA9-5564-44F1-B208-C8475D2D8F8E@gmail.com>
	<20110321155923.GB5248@rabbitmq.com>
Message-ID: <E056F310-13FA-426C-9352-229A631EB59D@gmail.com>

Thanks for the info regarding exchanges.

About 1 Erlang processes per queue, I guess it's easier to run out of memory before running out of erlang processes, so It shouldn't be such an issue anyway.

Alvaro

On Mar 21, 2011, at 4:59 PM, Matthew Sackman wrote:

> On Mon, Mar 21, 2011 at 04:46:39PM +0100, Alvaro Videla wrote:
>> I was testing queue number limits the other day, one thing to watch is the number of erlang processes. If I'm not mistaken a new queue implies a new Erlang Process. Probably the same with exchanges?
> 
> Yes, followed by no. A queue is an Erlang process. By default, we set
> the erlang VM with a process limit of 1M, but that can be raised.
> 
> An exchange is not a process. An exchange is just a row in mnesia. This
> is why exchanges survive the death of the creating node in a cluster,
> but queues do not.
> 
> Matthew


From irrer at umich.edu  Mon Mar 21 16:14:32 2011
From: irrer at umich.edu (Jim Irrer)
Date: Mon, 21 Mar 2011 12:14:32 -0400
Subject: [rabbitmq-discuss] browse messages on a queue
In-Reply-To: <9968CC83-00A5-4320-8D30-999599BAF2EF@vmware.com>
References: <9319F360221C65428EA819A4E8DC34ED028DF6395D@OPMBOX21UK.options-it.com>
	<9968CC83-00A5-4320-8D30-999599BAF2EF@vmware.com>
Message-ID: <AANLkTimK4UmT7Ue_o1HG2mN_bRuScz7URk2F1Sk716n_@mail.gmail.com>

John -

I was in the process of writing a plugin to get the same functionality:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-March/011936.html

What is the time frame for yours?

I had already been working some ideas for functionality, including writing
to
a device or a database, and would like to know more details of what
you are doing.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Mon, Mar 21, 2011 at 1:46 AM, John DeTreville <jdetreville at vmware.com>wrote:

> Joe,
>
> RabbitMQ lets you write your own plug-ins for storing queues. We're
> producing a few accompanying samples now, including one that stores all
> messages in a MySQL database. Its performance might be much lower than the
> standard queue implementation, but it would allow you to watch messages go
> by.
>
> This MySQL plug-in should be out soon, but certainly not this month.
>
> Cheers,
> John
>
> On Mar 18, 2011, at 10:33 AM, Kearney, Joe wrote:
>
> > Hi,
> >
> > I'm interested in finding or writing a tool to monitor messages on a
> rabbit queue, in particular to be able to view messages waiting on the
> queue. The use case is for occasional monitoring and debugging; I'm not
> suggesting using a browse/read-only function in normal processing.
> >
> > This was raised on this mail group last July (
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-July/008004.html).
> Two pertinent quotes from that thread:
> >
> >> The only way you can get at the messages is through the normal AMQP
> methods that consume the messages (basic.consume and basic.get).  But these
> are not simple read-only operations of the type you might want for
> monitoring of the messages within a queue.
> >
> >> it's actually quite hard to come up with a sensible semantics for it
> that isn't too constraining on implementations
> >
> > Has there been any progress on a built-in way to do this? Any thoughts on
> when/whether this might be introduced?
> >
> > Alternatively, can you comment on a sensible way to fake it? The naive
> implementation that springs to mind is simply to get a few messages from the
> head of the queue in a transaction and roll it back. Clearly this is more
> heavyweight than it need be, but are there any reasons that this behaviour
> should really be avoided for manual monitoring, until such a time as real
> read-only browsing is supported?
> >
> > Thanks,
> > Joe
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110321/46f872cb/attachment.htm>

From hedelson at vmware.com  Mon Mar 21 16:47:53 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Mon, 21 Mar 2011 10:47:53 -0600
Subject: [rabbitmq-discuss] High-performance routing strategies
In-Reply-To: <20110321154259.GD6721@rabbitmq.com>
Message-ID: <C9ACDD59.3304%hedelson@vmware.com>

Thanks Matthew, this is great information. I have just a few more questions
in-line below:


On 3/21/11 9:43 AM, "Matthew Sackman" <matthew at rabbitmq.com> wrote:

> Helena,
> 
> On Mon, Mar 21, 2011 at 08:35:47AM -0600, Helena Edelson wrote:
>> I am curious to know what routing strategies and broker topologies are being
>> implemented for performance in similar scenarios of:
>> 
>> * One broker must handle the load of 1000 distributed agents/clients
>> * A cluster of brokers handles 10,000 or more distributed agents/clients
> 
> Neither of these scenarios will necessarily induce high load in
> RabbitMQ.
> 
> 100,000 queues on a single broker is fine - I've just created that on my
> desktop with no problems. You could likely get to well over a million
> with a bit of tuning and enough RAM.

Can you direct me toward acknowledged, tested RAM requirements? I've seen
some information pass by in the list and other docs but would like to see
something concrete.

> 
> Exchanges and bindings are even cheaper in terms of the memory cost.
> 

Rephrasing:
Say I have an application consisting of a server to 20,000 agents. Each
agent-server request/response conversation can be broken down into 15 basic
classification types with say 5 sub-conversation types. If I leverage topic
exchanges for their behavioral flexibility, primarily use hierarchical
routing keys and say, create a topic per major classification/conversation
and use more specific routing keys for sub-converstations creating more
lower-cost Bindinds, are you saying that is not more performant than going
with an exponential amount of direct exchanges and more queues? I can
partition and load balance the queues that would handle the very large
message payloads easily enough, but for general high-traffic small JSON
payloads/quick turn around for instance, what is the recommendation?
 
> Doing 10,000+ connections to a single node is also fine. There is
> something somewhere which affects connection creation in RabbitMQ which
> causes a log_2(N) slow down on connection establishment: i.e. whilst
> initially, I can do about 1000 new connections a second, beyond 10,000
> or so connections, the rate of connection establishment slows a little.
>

With regard to connections and channels, I wonder if someone can point me to
data or research on thread behavior, leveraging threads going to
sleep/waking up vs creating/closing connections for each client request to
the broker.

 
> What does induce load is binding/exchange churn rate and message rate
> and message size.
> 
> A sustained load of N thousand binding creation/deletion events per
> second will likely overwhelm a single machine, and due to the fact that
> such changes have to be distributed to all nodes in a cluster will
> likely also induce substantial load on a large cluster too. Isolating
> such things really requires stuff like federation which AMQP isn't
> really well suited to, in the general case.

If I am delegating to a Queue to handle runtime requests to create queues,
exchanges, and bindings, might that take care of resultant capacity issues?
I have typically federated JMS brokers and wonder about a similar
topology/configuration.
 
> Matthew
> 



From jasonjwwilliams at gmail.com  Mon Mar 21 18:49:03 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Mon, 21 Mar 2011 12:49:03 -0600
Subject: [rabbitmq-discuss] A project I've been working on
In-Reply-To: <5CA2D4DB-A7B6-407C-9253-3793848AC394@gmail.com>
References: <5CA2D4DB-A7B6-407C-9253-3793848AC394@gmail.com>
Message-ID: <AANLkTi=PiW=Yv9YcynZEqTxDCEgcWp-pj9uq8_pm55fA@mail.gmail.com>

I think this is really cool, and I like the ability to wire tap the going
ons of Rabbit without touching the original program. I'd lean towards having
this be a plugin.

-J

On Mon, Mar 21, 2011 at 9:10 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi list,
>
> Lately I've been working on a project to improve the monitoring and
> administration tools for RabbitMQ.
>
> So for example, we have an RPC setup. We would like to know how many
> messages is the RPC processing per minute, what's the fastest reply it
> generated, what was the slowest one, and so on.
>
> I've implemented a process that can watch the RPC Server and produce some
> statistics based on the collected information.
>
> Another interesting use case is to be able to log or inspect the messages
> send to a consumer, say if you want to do that during a certain period of
> time where we want to debug the application. Once we have debugged it, we
> would like to remove the *inspection* step and send the messages to the
> final destination directly to avoid overhead. Of course we don't want to
> stop the producer or consumer applications and change the code to accomplish
> that.
>
> I think this can be really helpful when monitoring message flow across the
> network. I'm basing my implementation on the patterns explained in the
> "Enterprise Integration Patterns" book.
>
> I've created very basic demo videos where I showcase what my proof of
> concept can do so far.
>
> In the first video I implement the Smart Proxy pattern(
> http://www.eaipatterns.com/SmartProxy.html), where I track the messages on
> a RPC setup and generate stats based on them.
>
> http://vimeo.com/20966661
>
> On the second video I implement the Detour pattern(
> http://www.eaipatterns.com/Detour.html), that I use to detour messages, to
> be able to introduce inspection steps.
>
> http://vimeo.com/20966841
>
> Both the Detour Process and Smart Proxy process are controlled via a
> Control Bus that tells them to become active, to listen on an exchange and
> publish to another exchange and so on.
>
> I would like to get your feedback about what do you think regarding the
> "usefulness" of this project.
>
> I know the web interface that it has now is pretty ugly and everything
> looks very geeky now, but I think the main idea of having a Web based
> Control bus where we can activate/deactivate consumers and so on is quite
> interesting.
>
> Looking forward for your feedback,
>
> Alvaro
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110321/7379844b/attachment.htm>

From gmr at myyearbook.com  Mon Mar 21 22:10:14 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 21 Mar 2011 18:10:14 -0400
Subject: [rabbitmq-discuss] Management Plugin Additions
Message-ID: <338030F4D3954E22A403B3C47D5C4CA7@myyearbook.com>

I am looking at a project where we would like to append operational data to the Management Plugin user interface that would allow our teams to have a consolidated view of our cluster and consumer status. The plan is just to append a JavaScript include that would append what is needed to the user interface. 

Examples of use might be active consumer locations or a note about a queue that could impact what someone may do when it starts to back up.

The initial thought is to allow for a new "priv/www" directory to be specified in rabbitmq.config, where I can extend the existing templates including our 1 javascript file which would append the functionality we would like to the UI.

Is there a better way to handle this? All we really want is to just append the one external JavaScript include.

Alternatively, the easiest implementation is to download the appropriate plugin version from the repo, change the HTML, recompile and distribute. However this adds a bit of overhead with each new RabbitMQ upgrade that could be avoided with such a configuration variable.

If we create such a patch, would it be considered for inclusion so we don't have to maintain our own version of the plugin?

Regards,

Gavin 

From chen650 at yahoo.com  Tue Mar 22 02:15:53 2011
From: chen650 at yahoo.com (alex chen)
Date: Mon, 21 Mar 2011 19:15:53 -0700 (PDT)
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <4D84CF90.4060104@rabbitmq.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>
	<20110318171120.GM2414@rabbitmq.com>
	<819166.65905.qm@web31806.mail.mud.yahoo.com>
	<4D84CF90.4060104@rabbitmq.com>
Message-ID: <431712.78403.qm@web31802.mail.mud.yahoo.com>

Matthias,


> As requested before, it would be really helpful if you updated your tests to 
>work with the latest C client, scripted the entire test run and posted the code.

Attached please find rabbit_test.tar.gz that contains the test scripts.
See the README file on how to run it.   
thanks.

-alex



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110321/b43ea91d/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_test.tar.gz
Type: application/x-gzip
Size: 4902 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110321/b43ea91d/attachment-0001.bin>

From dhivya.swaminathan at tcs.com  Tue Mar 22 06:42:34 2011
From: dhivya.swaminathan at tcs.com (Dhivya Swaminathan)
Date: Tue, 22 Mar 2011 12:12:34 +0530
Subject: [rabbitmq-discuss] Creating queues using web console
Message-ID: <OF0D8155C4.EDBE0336-ON6525785B.0024DB22-6525785B.0024DB2D@tcs.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110322/0140f9d1/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Rabbit.png
Type: image/png
Size: 110630 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110322/0140f9d1/attachment-0001.png>

From shammi at arosys.com  Tue Mar 22 09:01:50 2011
From: shammi at arosys.com (cheepu)
Date: Tue, 22 Mar 2011 02:01:50 -0700 (PDT)
Subject: [rabbitmq-discuss]  checking no of message in queue
Message-ID: <31208079.post@talk.nabble.com>


Hi
	I am checking the number of message in the queue.
I am using the fillowing code for this.

 channel.exchangeDeclare("exchange", "direct",true);
 queuemessageSize=channel.queueDeclarePassive("queue").getMessageCount();
          
I am using the same connection object. but the channel for both task is
different.

I started two thread( consumer thread to consume msg from queue and a thread
to check no of message in queue) which are running continuously but I can
pause and stop the consumer thread.
I did the following steps:
1. Produced 20 message 
	Result: queue depth is 0 because all the messages are consumed by the
consumer thread
	This is expected result.
2. Next I paused the consumer thread. and then again produced 20 message.
	Result: queue depth is 0( This is unexpected because there are 20 messages
in queue) and message is not consumed by the consumer thread( because they
are paused ).

3. Next I stopped the consumer:
	Result: Now I am getting the no of message in the queue ie 20.

Question:
	Why when the consumer is sleeping then my queue size ( ie message in queue)
is zero?
I want the queue size at the time when the consumer in the paused state.
What wrong I am doing and what should I do? 


Thanks
	
	
-- 
View this message in context: http://old.nabble.com/checking-no-of-message-in-queue-tp31208079p31208079.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Tue Mar 22 09:43:42 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 22 Mar 2011 09:43:42 +0000
Subject: [rabbitmq-discuss] checking no of message in queue
In-Reply-To: <31208079.post@talk.nabble.com>
References: <31208079.post@talk.nabble.com>
Message-ID: <4D886F4E.5080807@rabbitmq.com>

Hi cheepu,

Op 22/03/2011 09:01, het cheepu geskryf:
>
> Hi
> 	I am checking the number of message in the queue.
> I am using the fillowing code for this.
>
>   channel.exchangeDeclare("exchange", "direct",true);
>   queuemessageSize=channel.queueDeclarePassive("queue").getMessageCount();
>
> I am using the same connection object. but the channel for both task is
> different.
>
> I started two thread( consumer thread to consume msg from queue and a thread
> to check no of message in queue) which are running continuously but I can
> pause and stop the consumer thread.
> I did the following steps:
> 1. Produced 20 message
> 	Result: queue depth is 0 because all the messages are consumed by the
> consumer thread
> 	This is expected result.
> 2. Next I paused the consumer thread. and then again produced 20 message.
> 	Result: queue depth is 0( This is unexpected because there are 20 messages
> in queue) and message is not consumed by the consumer thread( because they
> are paused ).
>
> 3. Next I stopped the consumer:
> 	Result: Now I am getting the no of message in the queue ie 20.
>
> Question:
> 	Why when the consumer is sleeping then my queue size ( ie message in queue)
> is zero?

This could happen if you are using the  QueueingConsumer in auto-ack 
mode, because the the QueueingConsumer will accept messages from the 
broker and store them in memory on the client. You don't say exactly 
what the consumer thread does - if it just dequeues messages from the 
QueueingConsumer then that is a possible explanation for your observations.

You can use the following command before and after each of your 3 steps 
to confirm:

rabbitmqctl list_queues name messages messages_ready messages_unacknowledged


Regards

Emile

From shammi at arosys.com  Tue Mar 22 10:34:20 2011
From: shammi at arosys.com (cheepu)
Date: Tue, 22 Mar 2011 03:34:20 -0700 (PDT)
Subject: [rabbitmq-discuss] checking no of message in queue
In-Reply-To: <4D886F4E.5080807@rabbitmq.com>
References: <31208079.post@talk.nabble.com> <4D886F4E.5080807@rabbitmq.com>
Message-ID: <31208529.post@talk.nabble.com>


Hi,
 
I am using the QueueingConsumer and using the following code for the
explicit acknowledgement 

 delivery = consumer.nextDelivery(500);
channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);

I am using java library for this and how can i get in this case the number
of messages?

Thanks


Emile Joubert-2 wrote:
> 
> Hi cheepu,
> 
> Op 22/03/2011 09:01, het cheepu geskryf:
>>
>> Hi
>> 	I am checking the number of message in the queue.
>> I am using the fillowing code for this.
>>
>>   channel.exchangeDeclare("exchange", "direct",true);
>>  
>> queuemessageSize=channel.queueDeclarePassive("queue").getMessageCount();
>>
>> I am using the same connection object. but the channel for both task is
>> different.
>>
>> I started two thread( consumer thread to consume msg from queue and a
>> thread
>> to check no of message in queue) which are running continuously but I can
>> pause and stop the consumer thread.
>> I did the following steps:
>> 1. Produced 20 message
>> 	Result: queue depth is 0 because all the messages are consumed by the
>> consumer thread
>> 	This is expected result.
>> 2. Next I paused the consumer thread. and then again produced 20 message.
>> 	Result: queue depth is 0( This is unexpected because there are 20
>> messages
>> in queue) and message is not consumed by the consumer thread( because
>> they
>> are paused ).
>>
>> 3. Next I stopped the consumer:
>> 	Result: Now I am getting the no of message in the queue ie 20.
>>
>> Question:
>> 	Why when the consumer is sleeping then my queue size ( ie message in
>> queue)
>> is zero?
> 
> This could happen if you are using the  QueueingConsumer in auto-ack 
> mode, because the the QueueingConsumer will accept messages from the 
> broker and store them in memory on the client. You don't say exactly 
> what the consumer thread does - if it just dequeues messages from the 
> QueueingConsumer then that is a possible explanation for your
> observations.
> 
> You can use the following command before and after each of your 3 steps 
> to confirm:
> 
> rabbitmqctl list_queues name messages messages_ready
> messages_unacknowledged
> 
> 
> Regards
> 
> Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/checking-no-of-message-in-queue-tp31208079p31208529.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From simon at rabbitmq.com  Tue Mar 22 10:38:33 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 22 Mar 2011 10:38:33 +0000
Subject: [rabbitmq-discuss] Creating queues using web console
In-Reply-To: <OF0D8155C4.EDBE0336-ON6525785B.0024DB22-6525785B.0024DB2D@tcs.com>
References: <OF0D8155C4.EDBE0336-ON6525785B.0024DB22-6525785B.0024DB2D@tcs.com>
Message-ID: <4D887C29.1000005@rabbitmq.com>

On 22/03/11 06:42, Dhivya Swaminathan wrote:
> Hi,
>
> I have successfully configured the management console and it runs
> successfully in http://localhost:55672/mgmt/#/.I have created a user and
> I am able to do all the activities except creating a queue,exchange etc.
>
> The problem is while creating a queue/exchange it asks for
> authentication and fails to authenticate the same username and
> password.What could be the problem?Whether we need to create queues
> using console or through code.Please suggest.

Hi Dhivya. I suspect that the problem is that you have not granted 
permissions for this user to access the vhost you're using. When you 
initially create a user they don't have permission to access anything.

At this point the HTTP API will reject access. Unfortunately the web 
browser will typically respond to this by just popping up the 
authenticate dialog again, which is not very clear.

Since this is a semi-common issue, I'll put some sort of warning on the 
user detail page.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Tue Mar 22 10:52:31 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 22 Mar 2011 10:52:31 +0000
Subject: [rabbitmq-discuss] Management Plugin Additions
In-Reply-To: <338030F4D3954E22A403B3C47D5C4CA7@myyearbook.com>
References: <338030F4D3954E22A403B3C47D5C4CA7@myyearbook.com>
Message-ID: <4D887F6F.4070100@rabbitmq.com>

Hi Gavin.

On 21/03/11 22:10, Gavin M. Roy wrote:
> I am looking at a project where we would like to append operational
> data to the Management Plugin user interface that would allow our
> teams to have a consolidated view of our cluster and consumer status.
> The plan is just to append a JavaScript include that would append
> what is needed to the user interface.
>
> Examples of use might be active consumer locations or a note about a
> queue that could impact what someone may do when it starts to back
> up.
>
> The initial thought is to allow for a new "priv/www" directory to be
> specified in rabbitmq.config, where I can extend the existing
> templates including our 1 javascript file which would append the
> functionality we would like to the UI.

This is quite interesting, because I've been having somewhat similar 
thoughts about extending the management UI. rabbitmq-shovel already 
holds some status information that it would be useful to see, and the 
upcoming rabbitmq-federation probably will too. Other plugins might have 
similar needs.

I think my case is a superset of yours though; I need to be able to 
extend the HTTP API (probably by plugging modules into the webmachine 
dispatch table) as well as plugging into the Javascript.

Of course, I haven't actually *done* anything yet.

> Is there a better way to handle this? All we really want is to just
> append the one external JavaScript include.
>
> Alternatively, the easiest implementation is to download the
> appropriate plugin version from the repo, change the HTML, recompile
> and distribute. However this adds a bit of overhead with each new
> RabbitMQ upgrade that could be avoided with such a configuration
> variable.

Hmm, I suspect that may be the best approach in the short term.

> If we create such a patch, would it be considered for inclusion so we
> don't have to maintain our own version of the plugin?

Probably not, as it's likely to get trampled by what I'm planning to do 
I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From emile at rabbitmq.com  Tue Mar 22 13:27:34 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 22 Mar 2011 13:27:34 +0000
Subject: [rabbitmq-discuss] checking no of message in queue
In-Reply-To: <31208529.post@talk.nabble.com>
References: <31208079.post@talk.nabble.com> <4D886F4E.5080807@rabbitmq.com>
	<31208529.post@talk.nabble.com>
Message-ID: <4D88A3C6.2090807@rabbitmq.com>

Hi cheepu,

Op 22/03/2011 10:34, het cheepu geskryf:
>
> Hi,
>
> I am using the QueueingConsumer

If you are using QueueingConsumer then the broker will deliver messages 
to the consumer, indepently from whether you dequeue them from the 
QueueingConsumer using nextDelivery(). That is why the number of 
messages is 0 in step 2.

I would suggest using the "rabbitmqctl list_queues" command to confirm 
that nextDelivery() makes no difference to the broker.

 > and using the following code for the explicit acknowledgement
 >
>   delivery = consumer.nextDelivery(500);
> channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);

This explicit message acknowledgement shows that you are not using 
auto-ack, as I previously thought.

> I am using java library for this and how can i get in this case the number
> of messages?

Your previous sample code using passive queue declaration with 
getMessageCount() is correct.

---

As an aside, you can use QoS, which is a consumer-initiated means of 
flow control in this situation. Setting prefetchCount to 1 will prevent 
all messages from being sent to the QueueingConsumer immediately without 
acknowledgement. See the method spec here:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.qos
http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.qos


Regards

Emile



From matthew at rabbitmq.com  Tue Mar 22 14:58:07 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 22 Mar 2011 14:58:07 +0000
Subject: [rabbitmq-discuss] RabbitMQ with halfword emulator in R14B02
Message-ID: <20110322145807.GC24025@rabbitmq.com>

Howdy,

Just a quick note to say that if you're living on the bleeding edge,
there seem to be some issues with the halfword emulator: certainly our
test suites don't pass with it, though individual tests with external
clients like our Java client seem fine. R14B02 without the halfword
emulator (i.e. default compilation or --disable-hipe) seems fine though.

Matthew

From gmr at myyearbook.com  Tue Mar 22 15:36:47 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 22 Mar 2011 11:36:47 -0400
Subject: [rabbitmq-discuss] pika and queue_delete on TornadoConnection
In-Reply-To: <049ac014-0538-4f0e-b7a2-dce55706d667@v31g2000vbs.googlegroups.com>
References: <f23b3964-fcba-4a1a-b73a-40f1c753a1e9@t16g2000vbi.googlegroups.com>
	<049ac014-0538-4f0e-b7a2-dce55706d667@v31g2000vbs.googlegroups.com>
Message-ID: <E005769FB0C54B37AC77CB4992DA3ED7@myyearbook.com>

Hi all,

Unfortunately 0.9.4 is a fairly buggy release. It may not be related to queue_delete.

I'll take a look and get back to you. 0.9.5 is soon to be released, just have documentation changes to finish.

Regards,

Gavin 
On Thursday, March 17, 2011 at 7:34 AM, curlup wrote:
subscribe on this.
> could you please post here a solution if you`ll find it?
> i`m interested but right now i have no time to take a look.
> 
> On Mar 14, 9:41 pm, vorad <vorad.1... at gmail.com> wrote:
> > Hi guys,
> > 
> > I am offering a web service to a rabbitmq server through Tornado and I
> > am using the new pika code base (v0.9.4)
> > One of the issues or things that I don't quite grasp is how I can
> > catch errors when using queue_delete. If I am trying to delete a non-
> > existent queue, rabbitmq will raise an amqperror that I can see in my
> > logs, but it seems I miss that when using queue_delete.
> > 
> > How can I catch that and implement the appropriate business logic?
> > 
> > Thanks and sorry if I am a little bit off-topic with this one.
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110322/7dbcb3a8/attachment.htm>

From vorad.1100 at gmail.com  Tue Mar 22 18:23:32 2011
From: vorad.1100 at gmail.com (vorad)
Date: Tue, 22 Mar 2011 20:23:32 +0200
Subject: [rabbitmq-discuss] acquiring channels per connection
In-Reply-To: <E95DBDA418DD4E019939BC54870BFBA5@myyearbook.com>
References: <AANLkTik60yoaMptM=pk6c-AD=5SSZX=Vd9wPcUa0WW-e@mail.gmail.com>
	<AANLkTikQQGnGZm-HBc8hCjhxYaq4uxyRj+RQKxwCQscO@mail.gmail.com>
	<E95DBDA418DD4E019939BC54870BFBA5@myyearbook.com>
Message-ID: <AANLkTikaOOqUNVvgixbHjEns_oh75ad3zjdY9QDP8yHW@mail.gmail.com>

Ok, my main concern about having one channel per application/tornado
instance is that I wouldn't know what's the request that corresponds to a
particular error when I catch it. That's the way I do it now (one channel
per application) and I still haven't figured things out on the error side.

Other than this it feels like adding another pool of objects to manage it's
not such a good idea so if I can stick with one connection and one channel
it would be great.

Thanks for your feedback.

On Wed, Mar 16, 2011 at 5:54 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:

>
>  On Wednesday, March 16, 2011 at 11:42 AM, Marek Majkowski wrote:
>
> On Tue, Mar 15, 2011 at 07:11, vorad <vorad.1100 at gmail.com> wrote:
>
>  How expensive would be to do
> this (one channel per request) from the rabbitmq perspective and also from
> the Pika's perspective ?
>
>
> Well, not that expensive if your RabbitMQ is close to the web server.
> Opening channel is a synchronous action - a full roundtrip is required.
>
> To avoid that roundtrip you may hava a pool and reuse open channels.
>
> In addition, you're not buying anything by using more connections as
> they'll still use the same single process IOLoop.
>
> For what it's worth, I use Pika and Tornado with one connection and channel
> per Tornado backend and hold on to the for the life of the backend, across
> multiple RequestHandler invocations.
>
> If you want to use multiple channels, I recommend having a sound reason for
> it. At the protocol level, it's nothing more than a numeric identifier for
> the frame routing. At the python level it's a set of two class instances
> which need to reside in memory. I can't think of a reason in my web
> applications that I would use more than one channel.
>
> For example, if you want to listen on multiple queues, just have multiple
> callbacks for channel.basic_consume.
>
> I guess my main point is using more channels and more connections doesn't
> offer any real value and adds additional overhead since you're bound to the
> same single process for responding to events.
>
> I would imagine if you could saturate a socket without saturating CPU that
> there could be some value, but offhand I can't imagine that is possible, as
> the OS's use of CPU would be saturated.
>
> Gavin
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110322/a1bc8006/attachment.htm>

From jasonjwwilliams at gmail.com  Tue Mar 22 22:21:42 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 22 Mar 2011 16:21:42 -0600
Subject: [rabbitmq-discuss] Clustering Internals
Message-ID: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>

Hi Guys,

I had a couple of questions regarding the clustering internals. Was
wondering if someone could clear up a couple of questions I have?

1.) When a node dies, it used to be that the queue was auto-recreated on
another node and if the downed node rejoined it's queue contents went poof.
The old contents died but at least you were assured new messages didn't get
blackholed. Now it looks like the entire queue goes poof...bindings and all.
It's not recreated until a consumer redeclares and binds it.

2.) Exchanges to my understanding are differing in that they are fully
replicated through the cluster. But does this extend to messages in-flight
in the exchange? If a node dies, do the messages in-flight go poof or do
other nodes pass them on since the exchange is replicated?

Thank you in advance for your help.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110322/30466b78/attachment.htm>

From matthew at rabbitmq.com  Tue Mar 22 23:52:34 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 22 Mar 2011 23:52:34 +0000
Subject: [rabbitmq-discuss] Clustering Internals
In-Reply-To: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>
References: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>
Message-ID: <20110322235234.GA5696@wellquite.org>

Hi Jason,

On Tue, Mar 22, 2011 at 04:21:42PM -0600, Jason J. W. Williams wrote:
> 1.) When a node dies, it used to be that the queue was auto-recreated on
> another node

I don't think that was ever the case...

> and if the downed node rejoined it's queue contents went poof.
> The old contents died but at least you were assured new messages didn't get
> blackholed. Now it looks like the entire queue goes poof...bindings and all.
> It's not recreated until a consumer redeclares and binds it.

What used to happen was:

1. node goes down, all queues on that node disappear.
2. another client, connected to a surviving node, could recreated the
vanished queues, and use them.

This was a bug and we fixed it. The reason that it was a bug was because
when the original node came back up, it could end up thinking that it's
version of a queue, which had since been recreated elsewhere, was now
the canonical version of the queue. What then happened to queue
contents, and in particular the routing of acks, was extremely broken.

The current behaviour is that in step (2) above, other clients, still
connected to the cluster, will find if they try to redeclare a queue on
a failed node, they get back a 404, but only if the original queue was
durable. If the original queue was not durable then the redeclaration
will succeed and there is no problem. If the original was durable, then
if the failed node comes back up then the queue should spring back to
life, recovering persistent messages off disk as you'd expect.

> 2.) Exchanges to my understanding are differing in that they are fully
> replicated through the cluster.

Correct. Exchanges and bindings are merely rows in mnesia and thus do
not belong or reside on any particular node.

> But does this extend to messages in-flight
> in the exchange? If a node dies, do the messages in-flight go poof or do
> other nodes pass them on since the exchange is replicated?

The act of routing a message is that the channel in which the message
has been publishes looks up the Pids of the queues to which the message
is destined. It then sends the message to those Pids. Depending on the
publish mode (e.g. presence or otherwise of flags such as immediate or
mandatory) it may or may not be important as to whether processes
corresponding to those Pids are still alive.

Whilst you can use mandatory to ensure that a message makes it to at
least one queue, and whilst sending a message to an exchange that
doesn't exist will cause a channel error, you can not assert that a
publish message went to the "correct" number of queues: it always goes
to the correct number of queues as determined at the point of routing.
Thus the 0-or-some that mandatory gives you is the best you can hope
for, generally, without significant additional changes to AMQP.

Best wishes,

Matthew

From jasonjwwilliams at gmail.com  Wed Mar 23 00:06:43 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 22 Mar 2011 18:06:43 -0600
Subject: [rabbitmq-discuss] Clustering Internals
In-Reply-To: <20110322235234.GA5696@wellquite.org>
References: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>
	<20110322235234.GA5696@wellquite.org>
Message-ID: <AANLkTi=d0umuEjLoW9HdZtwOxuU_oKahEEQpJmL4uUfJ@mail.gmail.com>

Hi Matthew,

Thank you for the detailed explanation.


>
> The act of routing a message is that the channel in which the message
> has been publishes looks up the Pids of the queues to which the message
> is destined. It then sends the message to those Pids. Depending on the
> publish mode (e.g. presence or otherwise of flags such as immediate or
> mandatory) it may or may not be important as to whether processes
> corresponding to those Pids are still alive.
>
> Whilst you can use mandatory to ensure that a message makes it to at
> least one queue, and whilst sending a message to an exchange that
> doesn't exist will cause a channel error, you can not assert that a
> publish message went to the "correct" number of queues: it always goes
> to the correct number of queues as determined at the point of routing.
> Thus the 0-or-some that mandatory gives you is the best you can hope
> for, generally, without significant additional changes to AMQP.
>
>
So there really are no guarantees as to the contents of an exchange on
failure of a node. You can just be sure that the exchange will exist as
expected on the other nodes.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110322/4f1c09eb/attachment.htm>

From stammailbox at gmail.com  Wed Mar 23 08:48:40 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 23 Mar 2011 10:48:40 +0200
Subject: [rabbitmq-discuss] rabbitmq - implement a proxy with RPC
Message-ID: <AANLkTimVCPew_eZ=2CKJF207WHe42Y2VJ5FaOYbAttQU@mail.gmail.com>

Hi,
I would like to implement an rpc with rabbitmq.
As with other rpc frameworks I would like to use an interface (skeleton) in
the client and an interface with implementor on the server .
Then I would be able to call the remote methods like they were in my local
client.

so far I see RpcClient.stringCall which I will need to parse the string
request myself.

Is there any implementation as i described ?

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110323/adf9d073/attachment.htm>

From emile at rabbitmq.com  Wed Mar 23 09:37:05 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 23 Mar 2011 09:37:05 +0000
Subject: [rabbitmq-discuss] rabbitmq - implement a proxy with RPC
In-Reply-To: <AANLkTimVCPew_eZ=2CKJF207WHe42Y2VJ5FaOYbAttQU@mail.gmail.com>
References: <AANLkTimVCPew_eZ=2CKJF207WHe42Y2VJ5FaOYbAttQU@mail.gmail.com>
Message-ID: <4D89BF41.5010204@rabbitmq.com>

Hi,

On 23/03/11 08:48, mysurf mail wrote:
> Hi,
> I would like to implement an rpc with rabbitmq.
> As with other rpc frameworks I would like to use an interface (skeleton)
> in the client and an interface with implementor on the server .
> Then I would be able to call the remote methods like they were in my
> local client.
>
> so far I see RpcClient.stringCall which I will need to parse the string
> request myself.
>
> Is there any implementation as i described ?

I assume you want a Java solution - RpcClient and RpcServer comes 
closest to what you need. It should be possible to extend those to work 
as you describe though.

The .net client comes with a WCF two-way implementation that defines 
interfaces for messages in the way you describe. See the TwoWayTest 
calculator example.

Regards

Emile

From stammailbox at gmail.com  Wed Mar 23 10:00:30 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 23 Mar 2011 12:00:30 +0200
Subject: [rabbitmq-discuss] rabbitmq - implement a proxy with RPC
In-Reply-To: <4D89BF41.5010204@rabbitmq.com>
References: <AANLkTimVCPew_eZ=2CKJF207WHe42Y2VJ5FaOYbAttQU@mail.gmail.com>
	<4D89BF41.5010204@rabbitmq.com>
Message-ID: <AANLkTimUUZM0F7YJDQO9-h=tHT_rf5FriC+M+1r92VJL@mail.gmail.com>

Do you have a solution that lets me use an interface in the client?
I think I found the JSonRpcClient to be the closest

On Wed, Mar 23, 2011 at 11:37 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
>
> On 23/03/11 08:48, mysurf mail wrote:
>
>> Hi,
>> I would like to implement an rpc with rabbitmq.
>> As with other rpc frameworks I would like to use an interface (skeleton)
>> in the client and an interface with implementor on the server .
>> Then I would be able to call the remote methods like they were in my
>> local client.
>>
>> so far I see RpcClient.stringCall which I will need to parse the string
>> request myself.
>>
>> Is there any implementation as i described ?
>>
>
> I assume you want a Java solution - RpcClient and RpcServer comes closest
> to what you need. It should be possible to extend those to work as you
> describe though.
>
> The .net client comes with a WCF two-way implementation that defines
> interfaces for messages in the way you describe. See the TwoWayTest
> calculator example.
>
> Regards
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110323/f95202d1/attachment.htm>

From simon at rabbitmq.com  Wed Mar 23 10:22:31 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 Mar 2011 10:22:31 +0000
Subject: [rabbitmq-discuss] Fw: Re:  Creating queues using web console
In-Reply-To: <OF139E7817.5C8F4A73-ON6525785C.002587D4-6525785C.0025A76B@tcs.com>
References: <OF139E7817.5C8F4A73-ON6525785C.002587D4-6525785C.0025A76B@tcs.com>
Message-ID: <4D89C9E7.5090102@rabbitmq.com>

Hi Dhivya.

As far as I can see the vhost / user / permission you have set up should 
work - I replicated them on my box and they did.

Questions to debug this further:

  * Which browser are you using?
  * What happens if you close the browser and start again?
    (Browsers can end up caching the creds)
  * What happens if you try to create a queue using rabbitmqadmin?
    (Download from http://localhost:55672/cli and do something like
     ./rabbitmqadmin -u dhivya -p your_pw -V Firstvh \
         declare queue name=dhivya-test)

Cheers, Simon

On 23/03/11 06:51, Dhivya Swaminathan wrote:
> Hi Simon,
>
> Is my quoted procedure wrong or any thing am missing out.Need help urgently.
>
>
> Dhivya Swaminathan
> Tata Consultancy Services
> Mailto: dhivya.swaminathan at tcs.com
> Website: http://www.tcs.com
> ____________________________________________
> Experience certainty. IT Services
> Business Solutions
> Outsourcing
> ____________________________________________
>
> -----Forwarded by Dhivya Swaminathan/MUM/TCS on 03/23/2011 12:19PM -----
>
>     To: simon at rabbitmq.com
>     From: Dhivya Swaminathan/MUM/TCS
>     Date: 03/22/2011 05:01PM
>     Subject: Re: [rabbitmq-discuss] Creating queues using web console
>
>     Hi Simon,
>
>     I have created a vhost called Firstvh and has given all the read and
>     write permissions.For ur reference.
>
>     As u said the authentication window is popping again n again.Pls
>     suggest a solution.
>
>
>     Dhivya Swaminathan
>     Tata Consultancy Services
>     Mailto: dhivya.swaminathan at tcs.com
>     Website: http://www.tcs.com
>     ____________________________________________
>     Experience certainty. IT Services
>     Business Solutions
>     Outsourcing
>     ____________________________________________
>
>     -----rabbitmq-discuss-bounces at lists.rabbitmq.com wrote: -----
>
>         To: rabbitmq-discuss at lists.rabbitmq.com
>         From: Simon MacMullen
>         Sent by: rabbitmq-discuss-bounces at lists.rabbitmq.com
>         Date: 03/22/2011 04:09PM
>         Subject: Re: [rabbitmq-discuss] Creating queues using web console
>
>         On 22/03/11 06:42, Dhivya Swaminathan wrote:
>         >  Hi,
>         >
>         >  I have successfully configured the management console and it runs
>         >  successfully inhttp://localhost:55672/mgmt/#/.I  have created a user and
>         >  I am able to do all the activities except creating a queue,exchange etc.
>         >
>         >  The problem is while creating a queue/exchange it asks for
>         >  authentication and fails to authenticate the same username and
>         >  password.What could be the problem?Whether we need to create queues
>         >  using console or through code.Please suggest.
>
>         Hi Dhivya. I suspect that the problem is that you have not granted
>         permissions for this user to access the vhost you're using. When you
>         initially create a user they don't have permission to access anything.
>
>         At this point the HTTP API will reject access. Unfortunately the web
>         browser will typically respond to this by just popping up the
>         authenticate dialog again, which is not very clear.
>
>         Since this is a semi-common issue, I'll put some sort of warning on the
>         user detail page.
>
>         Cheers, Simon
>
>         --
>         Simon MacMullen
>         Staff Engineer, RabbitMQ
>         SpringSource, a division of VMware
>
>         _______________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.rabbitmq.com
>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> =====-----=====-----=====
> Notice: The information contained in this e-mail
> message and/or attachments to it may contain
> confidential or privileged information. If you are
> not the intended recipient, any dissemination, use,
> review, distribution, printing or copying of the
> information contained in this e-mail message
> and/or attachments to it are strictly prohibited. If
> you have received this communication in error,
> please notify us by reply e-mail or telephone and
> immediately and permanently delete the message
> and any attachments. Thank you
>
>


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From emile at rabbitmq.com  Wed Mar 23 10:34:45 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 23 Mar 2011 10:34:45 +0000
Subject: [rabbitmq-discuss] rabbitmq - implement a proxy with RPC
In-Reply-To: <AANLkTimUUZM0F7YJDQO9-h=tHT_rf5FriC+M+1r92VJL@mail.gmail.com>
References: <AANLkTimVCPew_eZ=2CKJF207WHe42Y2VJ5FaOYbAttQU@mail.gmail.com>	<4D89BF41.5010204@rabbitmq.com>
	<AANLkTimUUZM0F7YJDQO9-h=tHT_rf5FriC+M+1r92VJL@mail.gmail.com>
Message-ID: <4D89CCC5.8010208@rabbitmq.com>

Hi,

If JSonRpcClient meets your needs then that is great news. Make sure 
that the JSON serialisation works for all parameters and return values 
you may wish to use. The JSON implementation is less general than other 
Java remoting alternatives, but in keeping with AMQP it does have the 
advantage of being platform-neutral.


Regards

Emile



On 23/03/11 10:00, mysurf mail wrote:
> Do you have a solution that lets me use an interface in the client?
> I think I found the JSonRpcClient to be the closest
>
> On Wed, Mar 23, 2011 at 11:37 AM, Emile Joubert <emile at rabbitmq.com
> <mailto:emile at rabbitmq.com>> wrote:
>
>     Hi,
>
>
>     On 23/03/11 08:48, mysurf mail wrote:
>
>         Hi,
>         I would like to implement an rpc with rabbitmq.
>         As with other rpc frameworks I would like to use an interface
>         (skeleton)
>         in the client and an interface with implementor on the server .
>         Then I would be able to call the remote methods like they were in my
>         local client.
>
>         so far I see RpcClient.stringCall which I will need to parse the
>         string
>         request myself.
>
>         Is there any implementation as i described ?
>
>
>     I assume you want a Java solution - RpcClient and RpcServer comes
>     closest to what you need. It should be possible to extend those to
>     work as you describe though.
>
>     The .net client comes with a WCF two-way implementation that defines
>     interfaces for messages in the way you describe. See the TwoWayTest
>     calculator example.

From alexandru at rabbitmq.com  Wed Mar 23 11:14:47 2011
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Wed, 23 Mar 2011 11:14:47 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.4.0 Release
Message-ID: <20110323111447.GA10386@dakota.eng.vmware.com>

The RabbitMQ team is delighted to announce the release of RabbitMQ
2.4.0.

This release fixes a number of bugs and introduces some enhancements,
including fast routing for topic exchanges, sender-selected distribution
and server-side consumer cancellation notifications.

See the attached release notes for more details.

Binary and source distributions of the new release can be found in the
usual place at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to
this latest release.

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
info at rabbitmq.com.

Regards,
         The RabbitMQ Team

-------------- next part --------------
Release: RabbitMQ 2.4.0

Release Highlights
==================

server
------
bug fixes
- in a cluster, don't fail with an internal-error when re-declaring a
  queue on a connection to a node other than the queue's "home" node
- in a cluster, report a not-found error instead of internal-error
  when attempting to re-declare a durable queue whose node is
  unavailable
- do not ignore the RABBITMQ_LOG_BASE variable on Windows
- fix a bug causing SSL connections to die on Erlang prior to R14
  when using "rabbitmqctl list_connections" with the SSL options
- various minor fixes

enhancements
- greatly speed up routing for topic exchanges with many bindings
- propagate memory alarms across cluster, thus reacting better to
  memory pressure on individual nodes.
- sender-selected distribution (i.e. add support for the CC and BCC
  headers).  See
    http://www.rabbitmq.com/extensions.html#sender-selected-distribution
  for more information.
- server-side consumer cancellation notifications.  See
    http://www.rabbitmq.com/extensions.html#consumer-cancel-notify
  for more information.
- have the server present its AMQP extensions in a "capabilities"
  field in server-properties.  See
    http://www.rabbitmq.com/extensions.html#capabilities
  for more information.
- determine file descriptor limits accurately on Windows, usually
  resulting in much higher limits than previously, which allows more
  connections and improves performance
- indicate in the logs when the file descriptor limit has been reached
  (causing the server to not accept any further connections)
- allow SASL mechanisms to veto themselves based on socket type
- rename rabbitmq.conf to rabbitmq-env.conf, to avoid confusion with
  rabbitmq.config
- improve performance of publisher confirms
- various other minor enhancements and performance improvements


java client
-----------
bug fixes
- prevent stack overflow when connections have large numbers channels
- do not require a working reverse DNS when establishing connections

enhancements
- ConnectionFactory accepts a connection timeout parameter
- allow prioritisation of SASL mechanisms
- support for server-side consumer cancellation notifications
- have the client present its AMQP extensions in a "capabilities"
  field in client-properties
- rename ReturnListener.handleBasicReturn to handleReturn


.net client
-----------
bug fixes
- WCF bindings specified in configuration files are no longer ignored

enhancements
- support for server-side consumer cancellation notifications
- have the client present its AMQP extensions in a "capabilities"
  field in client-properties
- support IPv6


management plugin
-----------------
bug fixes
- hide passwords in the web UI
- fix rabbitmqadmin's handling of Unicode strings

enhancements
- present the managed socket and open file counts and respective limits
- better memory usage reporting for hibernating queues
- better support for serving the web interface through a proxy
- allow users to choose which node a queue is declared on
- show memory alarm states for nodes
- show statistics for basic.returns
- publish/receive messages via HTTP; this is intended for testing /
  learning / debugging, not as a general solution for HTTP messaging


STOMP plugin
------------
bug fixes
- prevent crash when publishing from STOMP, but subscribing from
  non-STOMP
- correctly process publishes spanning multiple network packets
- do not crash when publishing with undefined headers
- receipts for SEND frames wait on confirms
- do not issue a DISCONNECT with receipt when a clean shutdown has
  *not* occurred

enhancements
- add documentation. See http://www.rabbitmq.com/stomp.html
- significant performance improvements
- extend flow-control on back pressure through the STOMP gateway
  preventing the STOMP from overloading the server
- support for the "persistent" header
- support for multiple NACK


SSL authentication mechanism plugin
-----------------------------------
enhancements
- only offer this mechanism on SSL connections


build and packaging
-------------------
enhancements
- Windows installer for the broker
- remove the rabbitmq-multi script in order to simplify startup and
  improve error reporting
- add the "cond-restart" and "try-restart" options to the init script
- specify runlevels in the rabbitmq-server.init script
- make the java client jar an OSGi bundle
- Debian package only depends on erlang-nox

Upgrading
=========
To upgrade a non-clustered RabbitMQ from release 2.1.1 or later, simply
install the new version. All configuration and persistent message data
is retained.

To upgrade a non-clustered RabbitMQ from release 2.1.0, first upgrade
to 2.1.1 (which retains all data), and then to the current version as
described above.

To upgrade a clustered RabbitMQ or from releases prior to 2.1.0, if
the RabbitMQ installation does not contain any important data then
simply install the new version. RabbitMQ will move the existing data
to a backup location before creating a fresh, empty database. A
warning is recorded in the logs. If your RabbitMQ installation
contains important data then we recommend you contact
support at rabbitmq.com for assistance with the upgrade.

From stammailbox at gmail.com  Wed Mar 23 11:31:49 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 23 Mar 2011 13:31:49 +0200
Subject: [rabbitmq-discuss] rabbitmq - implement a proxy with RPC
In-Reply-To: <4D89CCC5.8010208@rabbitmq.com>
References: <AANLkTimVCPew_eZ=2CKJF207WHe42Y2VJ5FaOYbAttQU@mail.gmail.com>
	<4D89BF41.5010204@rabbitmq.com>
	<AANLkTimUUZM0F7YJDQO9-h=tHT_rf5FriC+M+1r92VJL@mail.gmail.com>
	<4D89CCC5.8010208@rabbitmq.com>
Message-ID: <AANLkTikahqjLPqBSeCKYcDR2vcfLVBEV_+bO+L9ZJd-z@mail.gmail.com>

Hi,
All I want is the usage of an interface in the client . can the regular rpc
client supply me this>

and in another note :
I am experiencing problems in creating JsonRpcClient.
when debugging it - it stays on that line forever (doesnt move to the next
line of code)
when attaching the source I see it uses the primitive call of the RpcClient
when it asks
system.describe. I dont see it reaches to the server.
Should I supply something ?
here is my client code

JsonRpcClient client = null;
Connection conn = null;
Channel ch;
try {
       ConnectionFactory ConnFactory = new ConnectionFactory();
       ConnFactory.setHost(props.getProperty("Host"));
       ConnFactory.setPort(Integer.parseInt(props.getProperty("Port")));
       conn = ConnFactory.newConnection();
       ch = conn.createChannel();
       Channel channel = getServerChannel().getChannel();
       client = new JsonRpcClient(channel, "", "positions");
} catch (IOException e) {
    throw new RuntimeException(e);
} catch (JsonRpcException e) {
    throw new RuntimeException(e);
}
return (PositionServerServices)
client.createProxy(PositionServerServices.class);

And in the server i am doing
server = new JsonRpcServer(channel, "PositionsQueue",
PositionServerServices.class, positionServerInternalServices);

(and positionServerInternalServices is my implemntor of the interface. )


10x



On Wed, Mar 23, 2011 at 12:34 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> If JSonRpcClient meets your needs then that is great news. Make sure that
> the JSON serialisation works for all parameters and return values you may
> wish to use. The JSON implementation is less general than other Java
> remoting alternatives, but in keeping with AMQP it does have the advantage
> of being platform-neutral.
>
>
> Regards
>
> Emile
>
>
>
>
> On 23/03/11 10:00, mysurf mail wrote:
>
>> Do you have a solution that lets me use an interface in the client?
>> I think I found the JSonRpcClient to be the closest
>>
>> On Wed, Mar 23, 2011 at 11:37 AM, Emile Joubert <emile at rabbitmq.com
>> <mailto:emile at rabbitmq.com>> wrote:
>>
>>    Hi,
>>
>>
>>    On 23/03/11 08:48, mysurf mail wrote:
>>
>>        Hi,
>>        I would like to implement an rpc with rabbitmq.
>>        As with other rpc frameworks I would like to use an interface
>>        (skeleton)
>>        in the client and an interface with implementor on the server .
>>        Then I would be able to call the remote methods like they were in
>> my
>>        local client.
>>
>>        so far I see RpcClient.stringCall which I will need to parse the
>>        string
>>        request myself.
>>
>>        Is there any implementation as i described ?
>>
>>
>>    I assume you want a Java solution - RpcClient and RpcServer comes
>>    closest to what you need. It should be possible to extend those to
>>    work as you describe though.
>>
>>    The .net client comes with a WCF two-way implementation that defines
>>    interfaces for messages in the way you describe. See the TwoWayTest
>>    calculator example.
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110323/a96b8b0f/attachment.htm>

From stammailbox at gmail.com  Wed Mar 23 11:52:18 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 23 Mar 2011 13:52:18 +0200
Subject: [rabbitmq-discuss] RabbitMQ 2.4.0 Release
In-Reply-To: <20110323111447.GA10386@dakota.eng.vmware.com>
References: <20110323111447.GA10386@dakota.eng.vmware.com>
Message-ID: <AANLkTinbBmrT_5pSnzaJkUFPK3AbVqTbLOuhe7YaQDfm@mail.gmail.com>

Is there a "backward client compatability"?
Can we install the new server and still use earlier versions of clients
(gradually update them)?


On Wed, Mar 23, 2011 at 1:14 PM, Alexandru Scvortov
<alexandru at rabbitmq.com>wrote:

> The RabbitMQ team is delighted to announce the release of RabbitMQ
> 2.4.0.
>
> This release fixes a number of bugs and introduces some enhancements,
> including fast routing for topic exchanges, sender-selected distribution
> and server-side consumer cancellation notifications.
>
> See the attached release notes for more details.
>
> Binary and source distributions of the new release can be found in the
> usual place at http://www.rabbitmq.com/download.html
>
> We recommend that all users of earlier versions of RabbitMQ upgrade to
> this latest release.
>
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and
> enhancements in future releases. Mail us via the RabbitMQ discussion
> list at rabbitmq-discuss at lists.rabbitmq.com, or directly at
> info at rabbitmq.com.
>
> Regards,
>         The RabbitMQ Team
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110323/b3ad4cf8/attachment.htm>

From simon at rabbitmq.com  Wed Mar 23 12:05:25 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 23 Mar 2011 12:05:25 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.4.0 Release
In-Reply-To: <AANLkTinbBmrT_5pSnzaJkUFPK3AbVqTbLOuhe7YaQDfm@mail.gmail.com>
References: <20110323111447.GA10386@dakota.eng.vmware.com>
	<AANLkTinbBmrT_5pSnzaJkUFPK3AbVqTbLOuhe7YaQDfm@mail.gmail.com>
Message-ID: <4D89E205.9040002@rabbitmq.com>

On 23/03/11 11:52, mysurf mail wrote:
> Is there a "backward client compatability"?
> Can we install the new server and still use earlier versions of clients
> (gradually update them)?

Yes.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Wed Mar 23 12:07:12 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 23 Mar 2011 12:07:12 +0000
Subject: [rabbitmq-discuss] RabbitMQ 2.4.0 Release
In-Reply-To: <AANLkTinbBmrT_5pSnzaJkUFPK3AbVqTbLOuhe7YaQDfm@mail.gmail.com>
References: <20110323111447.GA10386@dakota.eng.vmware.com>
	<AANLkTinbBmrT_5pSnzaJkUFPK3AbVqTbLOuhe7YaQDfm@mail.gmail.com>
Message-ID: <20110323120712.GB19387@rabbitmq.com>

On Wed, Mar 23, 2011 at 01:52:18PM +0200, mysurf mail wrote:
> Is there a "backward client compatability"?
> Can we install the new server and still use earlier versions of clients
> (gradually update them)?

Yes. This is always the case. Even when we introduce extensions to AMQP,
we do it in a backwards-compatible way.

Matthew

From stammailbox at gmail.com  Wed Mar 23 12:30:28 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 23 Mar 2011 14:30:28 +0200
Subject: [rabbitmq-discuss] rabbitmq - implement a proxy with RPC
In-Reply-To: <AANLkTikahqjLPqBSeCKYcDR2vcfLVBEV_+bO+L9ZJd-z@mail.gmail.com>
References: <AANLkTimVCPew_eZ=2CKJF207WHe42Y2VJ5FaOYbAttQU@mail.gmail.com>
	<4D89BF41.5010204@rabbitmq.com>
	<AANLkTimUUZM0F7YJDQO9-h=tHT_rf5FriC+M+1r92VJL@mail.gmail.com>
	<4D89CCC5.8010208@rabbitmq.com>
	<AANLkTikahqjLPqBSeCKYcDR2vcfLVBEV_+bO+L9ZJd-z@mail.gmail.com>
Message-ID: <AANLkTinkmyr0wjvnjv-zTBrd5y4gC=g77b9--tQ7OkzV@mail.gmail.com>

BTW in the "Host" I placed a good ip address :)

On Wed, Mar 23, 2011 at 1:31 PM, mysurf mail <stammailbox at gmail.com> wrote:

> Hi,
> All I want is the usage of an interface in the client . can the regular rpc
> client supply me this>
>
> and in another note :
> I am experiencing problems in creating JsonRpcClient.
> when debugging it - it stays on that line forever (doesnt move to the next
> line of code)
> when attaching the source I see it uses the primitive call of the RpcClient
> when it asks
> system.describe. I dont see it reaches to the server.
> Should I supply something ?
> here is my client code
>
> JsonRpcClient client = null;
> Connection conn = null;
> Channel ch;
> try {
>        ConnectionFactory ConnFactory = new ConnectionFactory();
>        ConnFactory.setHost(props.getProperty("Host"));
>        ConnFactory.setPort(Integer.parseInt(props.getProperty("Port")));
>        conn = ConnFactory.newConnection();
>        ch = conn.createChannel();
>        Channel channel = getServerChannel().getChannel();
>        client = new JsonRpcClient(channel, "", "positions");
> } catch (IOException e) {
>     throw new RuntimeException(e);
> } catch (JsonRpcException e) {
>     throw new RuntimeException(e);
> }
> return (PositionServerServices) client.createProxy(PositionServerServices.class);
>
> And in the server i am doing
> server = new JsonRpcServer(channel, "PositionsQueue", PositionServerServices.class, positionServerInternalServices);
>
> (and positionServerInternalServices is my implemntor of the interface. )
>
>
> 10x
>
>
>
> On Wed, Mar 23, 2011 at 12:34 PM, Emile Joubert <emile at rabbitmq.com>wrote:
>
>> Hi,
>>
>> If JSonRpcClient meets your needs then that is great news. Make sure that
>> the JSON serialisation works for all parameters and return values you may
>> wish to use. The JSON implementation is less general than other Java
>> remoting alternatives, but in keeping with AMQP it does have the advantage
>> of being platform-neutral.
>>
>>
>> Regards
>>
>> Emile
>>
>>
>>
>>
>> On 23/03/11 10:00, mysurf mail wrote:
>>
>>> Do you have a solution that lets me use an interface in the client?
>>> I think I found the JSonRpcClient to be the closest
>>>
>>> On Wed, Mar 23, 2011 at 11:37 AM, Emile Joubert <emile at rabbitmq.com
>>> <mailto:emile at rabbitmq.com>> wrote:
>>>
>>>    Hi,
>>>
>>>
>>>    On 23/03/11 08:48, mysurf mail wrote:
>>>
>>>        Hi,
>>>        I would like to implement an rpc with rabbitmq.
>>>        As with other rpc frameworks I would like to use an interface
>>>        (skeleton)
>>>        in the client and an interface with implementor on the server .
>>>        Then I would be able to call the remote methods like they were in
>>> my
>>>        local client.
>>>
>>>        so far I see RpcClient.stringCall which I will need to parse the
>>>        string
>>>        request myself.
>>>
>>>        Is there any implementation as i described ?
>>>
>>>
>>>    I assume you want a Java solution - RpcClient and RpcServer comes
>>>    closest to what you need. It should be possible to extend those to
>>>    work as you describe though.
>>>
>>>    The .net client comes with a WCF two-way implementation that defines
>>>    interfaces for messages in the way you describe. See the TwoWayTest
>>>    calculator example.
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110323/7d5baaec/attachment.htm>

From matthew at rabbitmq.com  Wed Mar 23 12:36:35 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 23 Mar 2011 12:36:35 +0000
Subject: [rabbitmq-discuss] Clustering Internals
In-Reply-To: <AANLkTi=d0umuEjLoW9HdZtwOxuU_oKahEEQpJmL4uUfJ@mail.gmail.com>
References: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>
	<20110322235234.GA5696@wellquite.org>
	<AANLkTi=d0umuEjLoW9HdZtwOxuU_oKahEEQpJmL4uUfJ@mail.gmail.com>
Message-ID: <20110323123635.GD19387@rabbitmq.com>

On Tue, Mar 22, 2011 at 06:06:43PM -0600, Jason J. W. Williams wrote:
> So there really are no guarantees as to the contents of an exchange on
> failure of a node. You can just be sure that the exchange will exist as
> expected on the other nodes.

It's wrong to think of an exchange as having "contents". An exchange
really just names a collection of routing rules (i.e. bindings). At no
point is a message ever held "in" an exchange.

But otherwise, yes, exchanges just exist on every node, but the bindings
of that exchange will vary dynamically with the actions of clients and
the failure or restoration of nodes within the cluster.

Matthew

From matthew at rabbitmq.com  Wed Mar 23 13:11:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 23 Mar 2011 13:11:55 +0000
Subject: [rabbitmq-discuss] High-performance routing strategies
In-Reply-To: <C9ACDD59.3304%hedelson@vmware.com>
References: <20110321154259.GD6721@rabbitmq.com>
	<C9ACDD59.3304%hedelson@vmware.com>
Message-ID: <20110323131154.GE19387@rabbitmq.com>

Hi,

On Mon, Mar 21, 2011 at 10:47:53AM -0600, Helena Edelson wrote:
> > 100,000 queues on a single broker is fine - I've just created that on my
> > desktop with no problems. You could likely get to well over a million
> > with a bit of tuning and enough RAM.
> 
> Can you direct me toward acknowledged, tested RAM requirements? I've seen
> some information pass by in the list and other docs but would like to see
> something concrete.

Erm, we don't really have anything concrete... there are a couple of
issues: one is that Rabbit dynamically pushes messages to disk to free
up RAM, so it's not correct to think that the memory footprint of a
queue is dependent on its contents. The other issue is that after a
queue is idle for a while (10 seconds or more), it'll "hibernate" which
causes a GC of that queue. As a result, this can dramatically shrink the
amount of memory the queue requires. So for example, it might be
possbile to have, say, 1000 empty queues in 10MB of RAM, but only when
they're idle. When they're all active (even if empty), they might,
depending on memory fragmentation and such like, consume much more
memory.

So, some quick testing:

                                             VSZ     RSS (both in kB)
on startup, no queues, no connections:    203092   89492
no queues, 2000 network connections:      265820  146996
 (so we're talking about 32kB per connection)
no queues, close 2000 connections:        263996  145632
 (typical for a VM: it doesn't hand back RAM to the OS immediately)

-> restart rabbit
no queues, 1 connection, 2000 channels:   266052  147000
 (similarly, around 32kB per channel)

-> restart rabbit
1 connection, 1 channel, 2000 queues:     308764 187400
 (a bit more - around 50kB per queue)

Now that's with all processes "active". Them hibernating at this stage
is difficult to observe because the Erlang VM does not hand back memory
to the OS asap. However, it can be observed if you have a large process
that hibernates and has very fragmented memory (the amount reclaimed can
be sufficient to force the VM to hand back memory to the OS). Or if you
have a test that just steadily increases the memory footprint of Rabbit
then the effect of hibernation of idle processes would be to reduce the
rate of increase of memory use.

> Say I have an application consisting of a server to 20,000 agents. Each
> agent-server request/response conversation can be broken down into 15 basic
> classification types with say 5 sub-conversation types. If I leverage topic
> exchanges for their behavioral flexibility, primarily use hierarchical
> routing keys and say, create a topic per major classification/conversation
> and use more specific routing keys for sub-converstations creating more
> lower-cost Bindinds, are you saying that is not more performant than going
> with an exponential amount of direct exchanges and more queues? I can
> partition and load balance the queues that would handle the very large
> message payloads easily enough, but for general high-traffic small JSON
> payloads/quick turn around for instance, what is the recommendation?

The recommendation is to do both and see which one works better for
you! ;) Generally, if you have a finite domain of routing keys, then
many fanout exchanges might be the right thing (literally, one exchange
per routing key). If you have a potentially infinite number of routing
keys, then that won't work, so you'll have to go with topic exchanges.
Quite where direct exchanges fit in here is difficult to pin-point,
except that they're a faster form of topic exchanges provided you don't
need the wild card.

However, as I've said before, it's likely to be binding churn that can
kill you, so if you're creating lots of new queues and bindings to those
queues whenever consumers attach then you might run into problems. Thus
if you have a exchanges 'X1' ... 'Xn' to which lots of msgs are being
published, and then whenever consumer 'Cm' connects, it has to create
bindings from its own queue to all of 'X1' ... 'Xn' then you might have
problems, depending on the rate of connections. One neat solution is for
each consumer to have its own secondary exchange 'Ym'. Then use
exchange-to-exchange bindings to bind all of 'X1' ... 'Xn' to 'Ym'.
These bindings then always exist (make sure 'Ym' is not auto-delete).
Then, whenever consumer 'Cm' connects, all it has to do is create its
queue and bind that queue to 'Ym'. Make 'Ym' a fanout exchange, and you
should find this is very fast, and reduces the binding churn rate to 1
per connection, rather than potentially n per connection.

> With regard to connections and channels, I wonder if someone can point me to
> data or research on thread behavior, leveraging threads going to
> sleep/waking up vs creating/closing connections for each client request to
> the broker.

Erlang is a multithreaded VM, and happily takes advantage of multiple
cores. It presents green threads to the programmer (which are called
'processes' because unlike threads, they conceptually do not share an
address space - the fact that in practise they do is merely an
implementation detail). I'm not quite sure of the research you're asking
for but nothing really springs to mind that I've read recently.

> If I am delegating to a Queue to handle runtime requests to create queues,
> exchanges, and bindings, might that take care of resultant capacity issues?
> I have typically federated JMS brokers and wonder about a similar
> topology/configuration.

I'm afraid I don't really follow: in AMQP it's the channel that provides
functionality such as creating queues, exchanges, bindings et al. Queues
are merely FIFO structures that buffer messages. I suspect my confusion
here is most likely one of terminology.

Matthew

From stammailbox at gmail.com  Wed Mar 23 14:24:56 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 23 Mar 2011 16:24:56 +0200
Subject: [rabbitmq-discuss] problems with parameters in jsonrpc
Message-ID: <AANLkTi=XZGQkRg01OZy4rVbbaC0zrVjMWaMhwr3Ot-7+@mail.gmail.com>

using rpc json client and server,
I can call a function only with null value in the parameters.

otherwise the reflection doesnt seem to work.
any idea ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110323/42db14da/attachment.htm>

From mikeb at rabbitmq.com  Wed Mar 23 14:47:41 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 23 Mar 2011 14:47:41 +0000
Subject: [rabbitmq-discuss] Exchange and queue design/best practices for
 social event updates
In-Reply-To: <AANLkTi=gYxck4sN7JPr_f-fe6CEveTD0FN6WfVu-cyaU@mail.gmail.com>
References: <AANLkTi=gYxck4sN7JPr_f-fe6CEveTD0FN6WfVu-cyaU@mail.gmail.com>
Message-ID: <4D8A080D.2040900@rabbitmq.com>

Hi Alex,

> The following is the basic requirements of our system:
>
> The whole application is called community.  Inside community we have groups.
> In each group, user can have discussion topics within the group.
> User can share file/resource to community.
> There is a wall page for user.  Also there is a wall page for the group.
>
>
>
[...]

>
> This is my initial plan:

In general, mapping your application domain directly to a messaging 
system isn't a good approach.  Instead, you ought to determine what 
kinds of services your application needs from the messaging system, then 
work out how to implement them.

Usually the required services boil down to a fairly small set of 
messaging patterns.  These are explained in our tutorials:
http://www.rabbitmq.com/getstarted.html

Software architecture is of course subject to fashion, but this book 
seems to be a fairly stable point: http://www.eaipatterns.com/

> - planning to use *topic exchange* for that.

Topic exchanges make a good "message bus" stand-in, so that may be 
appropriate for notifications.

> - use queues binding such as ( #.self , #.friends, #.group,
> #.groupmembers, #.otheractors )
>
>
> But my concern is:
>
> -  how do we mix together the *TARGET* and *ACTION* so that one routing
> key will cover all possible combination?

I think you will want different semantics for different actions, so I 
wouldn't lump them together.

For example, for updates, you really just want to queue things until you 
can process them; in this case, you'd use the work queue pattern, and 
send things directly to a particular queue.

> - do I require to send 2 messages with different routing keys to get the
> possible combination?  (which I don't really want to since the publisher
> will have too much knowledge about the business rule)

Yes, you will want to insulate the components that produce events from 
those that process them.  But inevitably, some components will want to 
accomplish more than one thing -- e.g., queue a job to resize a picture 
AND respond to the user -- in which case it may have to send more than 
one message.

> - Is it the right approach?  Or should I just have either of ACTION or
> TARGET and have the consumer decide based on the event type?
>
> - What is the recommended number of exchanges for such situation?

Exchanges are cheap.  Just think of them as namespaces for routing.  So 
the answer is "As many as you need".

> - Would be great if you could suggest the good naming practice for queue
> and exchange.

For queues that are work queues, supply a name meaningful to your 
application.  For convenience, queues that are tied to a particular 
application resource and need to be durable, can be named for that 
resource -- e.g., "<user>-notifications".  For any other queues, let the 
server name them.

For exchanges, supply a name meaningful to your application.


Kind regards,
Michael

From emile at rabbitmq.com  Wed Mar 23 15:12:37 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 23 Mar 2011 15:12:37 +0000
Subject: [rabbitmq-discuss] problems with parameters in jsonrpc
In-Reply-To: <AANLkTi=XZGQkRg01OZy4rVbbaC0zrVjMWaMhwr3Ot-7+@mail.gmail.com>
References: <AANLkTi=XZGQkRg01OZy4rVbbaC0zrVjMWaMhwr3Ot-7+@mail.gmail.com>
Message-ID: <4D8A0DE5.5000608@rabbitmq.com>


Hi,

On 23/03/11 14:24, mysurf mail wrote:
> using rpc json client and server,
> I can call a function only with null value in the parameters.
>
> otherwise the reflection doesnt seem to work.
> any idea ?

Are your parameters properly JSON-serialisable? If null is the only 
value that works then it is possible that the serialisation has failed.

The Java client example directory has code that illustrates how to use 
JSON RPC - see HelloJsonServer and HelloJsonClient.

Regards

Emile

From stammailbox at gmail.com  Wed Mar 23 15:33:55 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 23 Mar 2011 17:33:55 +0200
Subject: [rabbitmq-discuss] problems with parameters in jsonrpc
In-Reply-To: <4D8A0DE5.5000608@rabbitmq.com>
References: <AANLkTi=XZGQkRg01OZy4rVbbaC0zrVjMWaMhwr3Ot-7+@mail.gmail.com>
	<4D8A0DE5.5000608@rabbitmq.com>
Message-ID: <AANLkTiks5-bM58HbST7bB-UXzJ+UMab9xBrx5pnTidgY@mail.gmail.com>

Hi,
Not all were serializable but - all were jsonable .
I thought the parameters go through json serializing.

with json serialization you can serialize and deserialize when some clients
have newer object and some older instances of an object. so we use gson.

now i wrote the program so it gson-serialize an object and then send its
strings between the machines.
I would prefer though if it was gson serialization to the params (as the
name hints).
thanks.

On Wed, Mar 23, 2011 at 5:12 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
>
> On 23/03/11 14:24, mysurf mail wrote:
>
>> using rpc json client and server,
>> I can call a function only with null value in the parameters.
>>
>> otherwise the reflection doesnt seem to work.
>> any idea ?
>>
>
> Are your parameters properly JSON-serialisable? If null is the only value
> that works then it is possible that the serialisation has failed.
>
> The Java client example directory has code that illustrates how to use JSON
> RPC - see HelloJsonServer and HelloJsonClient.
>
> Regards
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110323/cfc4b6b4/attachment.htm>

From jasonjwwilliams at gmail.com  Wed Mar 23 16:14:34 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 23 Mar 2011 10:14:34 -0600
Subject: [rabbitmq-discuss] Clustering Internals
In-Reply-To: <20110323123635.GD19387@rabbitmq.com>
References: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>
	<20110322235234.GA5696@wellquite.org>
	<AANLkTi=d0umuEjLoW9HdZtwOxuU_oKahEEQpJmL4uUfJ@mail.gmail.com>
	<20110323123635.GD19387@rabbitmq.com>
Message-ID: <AANLkTimLOXPgoBtgHwcwZxjd0kzipM+aNwhHxCj8HG6Z@mail.gmail.com>

So mandatory or not, the channel doesn't release the publisher until it's
routed the message? So if a node crash were to occur while a message was
being routed the publisher could assume the message was lost because the the
publisher would still be waiting to be released when they lost connection?

My understanding previously was that when you publish it's fire-and-forget
while the routing occurs...you're instantly released while the routing is in
process.

-J

On Wed, Mar 23, 2011 at 6:36 AM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Tue, Mar 22, 2011 at 06:06:43PM -0600, Jason J. W. Williams wrote:
> > So there really are no guarantees as to the contents of an exchange on
> > failure of a node. You can just be sure that the exchange will exist as
> > expected on the other nodes.
>
> It's wrong to think of an exchange as having "contents". An exchange
> really just names a collection of routing rules (i.e. bindings). At no
> point is a message ever held "in" an exchange.
>
> But otherwise, yes, exchanges just exist on every node, but the bindings
> of that exchange will vary dynamically with the actions of clients and
> the failure or restoration of nodes within the cluster.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110323/f91fe509/attachment.htm>

From msteele at beringmedia.com  Wed Mar 23 20:29:04 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Wed, 23 Mar 2011 16:29:04 -0400
Subject: [rabbitmq-discuss] Scaling Rabbit
Message-ID: <AANLkTikhRzuv229ixeDArqywiGumVshoJycmQf_ahTve@mail.gmail.com>

Hi folks,

I've been noodling a scale problem for a while, and wanted some input.

Here's my scenario:

I have a relatively small number of publishers (1000), who I expect will
want to publish a very large number of messages (let's say 10 billion
messages a day) to a about 10 exchanges.

My naive first stab at trying to get this to scale using rabbit would be

   - Create 10 direct exchanges
   - Create 100 queues to each of the exchanges (randomly distributed onto
   several nodes in a rabbit cluster).
   - Bind each of the queues to a topic (random number from 1-100)
   - Attach consumers to each of these queues (insert load balancer here)
   - Have publishers randomly pick a number from 1-100 and use that as the
   routing key

Does this approach make sense for getting scale?

Cheers

Mark Steele
Bering Media Inc.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110323/cb0d6cb9/attachment.htm>

From irrer at umich.edu  Wed Mar 23 22:10:16 2011
From: irrer at umich.edu (Jim Irrer)
Date: Wed, 23 Mar 2011 18:10:16 -0400
Subject: [rabbitmq-discuss] Scaling Rabbit
In-Reply-To: <AANLkTikhRzuv229ixeDArqywiGumVshoJycmQf_ahTve@mail.gmail.com>
References: <AANLkTikhRzuv229ixeDArqywiGumVshoJycmQf_ahTve@mail.gmail.com>
Message-ID: <AANLkTik3WUs5q80BLDp=Tqb0OJOUTf3vhEtRFFbDh8Xa@mail.gmail.com>

To better understand - The 10 billion messages each need to be processed
with the same
sort of processing?  The reason for having 10 direct exchanges would be that
there are 10 different kinds of
messages, is that true, or was your intent to have the message producers
have a
role in choosing a consumer?

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Wed, Mar 23, 2011 at 4:29 PM, Mark Steele <msteele at beringmedia.com>wrote:

> Hi folks,
>
> I've been noodling a scale problem for a while, and wanted some input.
>
> Here's my scenario:
>
> I have a relatively small number of publishers (1000), who I expect will
> want to publish a very large number of messages (let's say 10 billion
> messages a day) to a about 10 exchanges.
>
> My naive first stab at trying to get this to scale using rabbit would be
>
>    - Create 10 direct exchanges
>    - Create 100 queues to each of the exchanges (randomly distributed onto
>    several nodes in a rabbit cluster).
>    - Bind each of the queues to a topic (random number from 1-100)
>    - Attach consumers to each of these queues (insert load balancer here)
>    - Have publishers randomly pick a number from 1-100 and use that as the
>    routing key
>
> Does this approach make sense for getting scale?
>
> Cheers
>
> Mark Steele
> Bering Media Inc.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110323/f4fd6a9b/attachment-0001.htm>

From Denis.Conan at telecom-sudparis.eu  Thu Mar 24 08:58:08 2011
From: Denis.Conan at telecom-sudparis.eu (Denis Conan)
Date: Thu, 24 Mar 2011 09:58:08 +0100
Subject: [rabbitmq-discuss] rabbitmq - implement a proxy with RPC
In-Reply-To: <4D89CCC5.8010208@rabbitmq.com>
References: <AANLkTimVCPew_eZ=2CKJF207WHe42Y2VJ5FaOYbAttQU@mail.gmail.com>	<4D89BF41.5010204@rabbitmq.com>	<AANLkTimUUZM0F7YJDQO9-h=tHT_rf5FriC+M+1r92VJL@mail.gmail.com>
	<4D89CCC5.8010208@rabbitmq.com>
Message-ID: <4D8B07A0.80503@telecom-sudparis.eu>

Le 23/03/2011 11:34, Emile Joubert a ?crit :
> Hi,
>
> If JSonRpcClient meets your needs then that is great news. Make sure
> that the JSON serialisation works for all parameters and return values
> you may wish to use. The JSON implementation is less general than other
> Java remoting alternatives, but in keeping with AMQP it does have the
> advantage of being platform-neutral.

Hi,

first of all, thank you for the work done on the framework and the support.

What do you mean by "platform-neutral"?

To the best of my knowledge, the current implementation does not work on 
Android OS for instance, does it?

CU

-- 
Denis Conan

From emile at rabbitmq.com  Thu Mar 24 10:33:10 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 24 Mar 2011 10:33:10 +0000
Subject: [rabbitmq-discuss] rabbitmq - implement a proxy with RPC
In-Reply-To: <4D8B07A0.80503@telecom-sudparis.eu>
References: <AANLkTimVCPew_eZ=2CKJF207WHe42Y2VJ5FaOYbAttQU@mail.gmail.com>	<4D89BF41.5010204@rabbitmq.com>	<AANLkTimUUZM0F7YJDQO9-h=tHT_rf5FriC+M+1r92VJL@mail.gmail.com>
	<4D89CCC5.8010208@rabbitmq.com>
	<4D8B07A0.80503@telecom-sudparis.eu>
Message-ID: <4D8B1DE6.1050100@rabbitmq.com>


Hi Denis,

On 24/03/11 08:58, Denis Conan wrote:
> Le 23/03/2011 11:34, Emile Joubert a ?crit :
>> Hi,
>>
>> If JSonRpcClient meets your needs then that is great news. Make sure
>> that the JSON serialisation works for all parameters and return values
>> you may wish to use. The JSON implementation is less general than other
>> Java remoting alternatives, but in keeping with AMQP it does have the
>> advantage of being platform-neutral.
>
> Hi,
>
> first of all, thank you for the work done on the framework and the support.
>
> What do you mean by "platform-neutral"?

The comment about platform-neutral was made in relation to the JSON RPC 
implementation which is part of the rabbit java client. The request and 
responses are encoded in JSON which opens the door to RPC servers 
written in any language with an AMQP library. This would not be the case 
had the encoding been Java-specific, which is typical for Java remoting 
solutions.


Regards

Emile

From msteele at beringmedia.com  Thu Mar 24 13:30:43 2011
From: msteele at beringmedia.com (Mark Steele)
Date: Thu, 24 Mar 2011 09:30:43 -0400
Subject: [rabbitmq-discuss] Scaling Rabbit
In-Reply-To: <AANLkTik3WUs5q80BLDp=Tqb0OJOUTf3vhEtRFFbDh8Xa@mail.gmail.com>
References: <AANLkTikhRzuv229ixeDArqywiGumVshoJycmQf_ahTve@mail.gmail.com>
	<AANLkTik3WUs5q80BLDp=Tqb0OJOUTf3vhEtRFFbDh8Xa@mail.gmail.com>
Message-ID: <AANLkTi=rRq1Bg04JfRTnyfyxsysBf_dSDZtKoPiDmEqf@mail.gmail.com>

The idea here is that in a perfect world, I would have only 1 queue per
exchange. However that won't scale since queues only exists on the node on
which they are declared.

To get around this, I want to create more queues across all the nodes, and
distribute the load based on routing keys. The random pick of a routing key
by the producer is simply to distribute load on the pre-created queues (that
are spread across the nodes in the cluster).


Mark Steele
Bering Media Inc.



On Wed, Mar 23, 2011 at 6:10 PM, Jim Irrer <irrer at umich.edu> wrote:

> To better understand - The 10 billion messages each need to be processed
> with the same
> sort of processing?  The reason for having 10 direct exchanges would be
> that there are 10 different kinds of
> messages, is that true, or was your intent to have the message producers
> have a
> role in choosing a consumer?
>
> Thanks,
>
> - Jim
>
> Jim Irrer     irrer at umich.edu       (734) 647-4409
> University of Michigan Hospital Radiation Oncology
> 519 W. William St.             Ann Arbor, MI 48103
>
>
> On Wed, Mar 23, 2011 at 4:29 PM, Mark Steele <msteele at beringmedia.com>wrote:
>
>> Hi folks,
>>
>> I've been noodling a scale problem for a while, and wanted some input.
>>
>> Here's my scenario:
>>
>> I have a relatively small number of publishers (1000), who I expect will
>> want to publish a very large number of messages (let's say 10 billion
>> messages a day) to a about 10 exchanges.
>>
>> My naive first stab at trying to get this to scale using rabbit would be
>>
>>    - Create 10 direct exchanges
>>    - Create 100 queues to each of the exchanges (randomly distributed
>>    onto several nodes in a rabbit cluster).
>>    - Bind each of the queues to a topic (random number from 1-100)
>>    - Attach consumers to each of these queues (insert load balancer here)
>>    - Have publishers randomly pick a number from 1-100 and use that as
>>    the routing key
>>
>> Does this approach make sense for getting scale?
>>
>> Cheers
>>
>> Mark Steele
>> Bering Media Inc.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110324/0eb7300a/attachment.htm>

From matthew at rabbitmq.com  Thu Mar 24 13:59:44 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 24 Mar 2011 13:59:44 +0000
Subject: [rabbitmq-discuss] Clustering Internals
In-Reply-To: <AANLkTimLOXPgoBtgHwcwZxjd0kzipM+aNwhHxCj8HG6Z@mail.gmail.com>
References: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>
	<20110322235234.GA5696@wellquite.org>
	<AANLkTi=d0umuEjLoW9HdZtwOxuU_oKahEEQpJmL4uUfJ@mail.gmail.com>
	<20110323123635.GD19387@rabbitmq.com>
	<AANLkTimLOXPgoBtgHwcwZxjd0kzipM+aNwhHxCj8HG6Z@mail.gmail.com>
Message-ID: <20110324135943.GD29884@rabbitmq.com>

Hi Jason,

On Wed, Mar 23, 2011 at 10:14:34AM -0600, Jason J. W. Williams wrote:
> So mandatory or not, the channel doesn't release the publisher until it's
> routed the message? So if a node crash were to occur while a message was
> being routed the publisher could assume the message was lost because the the
> publisher would still be waiting to be released when they lost connection?

I seem to be succeeding in making you more confused, not less.

There is one conceptual thing called a "channel". But that conceptual
thing has representation on the client and in the broker. Thus when I
talk about "the channel process", I'm almost always meaning the channel
process on the broker, that handles all actions issued by the client
upon that channel.

It is the channel process that "performs routing": i.e. the
determination of which queue processes a given message should be sent on
to. This action requires no input from any queues at all: it is
currently just a series of database lookups. When the channel has
finished figuring out which queues the message should be sent to, it
just sends the message to those queues.

Now if there are no mandatory/immediate flags set then the publish from
the channel to the queue is entirely fire and forget: there is
absolutely no indication to the channel whether or not the queue still
exists or when it received the msg or when it processed the msg.

If the mandatory or immediate flag is set, then the channel must do a
synchronous call to each queue to which the msg is being sent in order
to find out what happens to the msg and thus return the correct response
(if any) to the client-side channel.

Mandatory is a MAY analysis or a disjunction: i.e. of the set of queues
to which the msg is apparently meant to be sent, provided at least one
of those queues receives the msg (i.e. has not been deleted or otherwise
lost between the act of routing and the act of sending the msg to the
queue), then no error occurs.

Likewise, Immediate indicates that of all the queues to which the msg is
sent, provided one of those queues is able to immediately chuck the msg
out to a consumer, all is well. The additional complexity with immediate
is that of the queues which could not send the msg straight out to a
consumer, the queue does not enqueue the msg. Immediate and mandatory
are both really mis-features of AMQP and should not be used.

> My understanding previously was that when you publish it's fire-and-forget
> while the routing occurs...you're instantly released while the routing is in
> process.

I don't know to what you're referring when you say "you're instantly
released" - _what_ is instantly release?

Matthew

From charly.hamy at gmail.com  Thu Mar 24 14:35:35 2011
From: charly.hamy at gmail.com (Charly Hamy)
Date: Thu, 24 Mar 2011 15:35:35 +0100
Subject: [rabbitmq-discuss] Spying on "mandatory" messages
Message-ID: <AANLkTi=jDe6rbg9AYLzXEkaWk186SeLC_uH1ovoK1ojq@mail.gmail.com>

Hi all,

I'm currently using RabbitMQ to "build" a software platform allowing various
components to plug and communicate to each-other on two modes :
request/response ("point to point") and pub/sub.

For the req/res scenario, I'm using the mandatory flag on my messages, so
that sending a request message to a disconnected component (no corresponding
queue declared on the broker) returns an error to the sender. This works as
expected.

But now, I would want to plug new components to spy on those flows of
requests and responses, without interfering with the ongoing
communications... which is not by default compatible with my use of the
mandatory flag : when a "spy" component is monitorng request/response
messages, those messages end-up in its queue, then even if the actual target
component for those messages is not present on the broker (no queue), no
error is returned to the sender.

What I'm looking for is a way to have "mandatory" messages delivered to a
queue bound to an exchange with a special kind of binding, so that the
delivery to the queue doesn't count as one, from the exchange point of view,
and so that a "no delivery" error may still be returned to the sender, if no
queue with a matching standard binding to that exchange stores the message.

I've started to dive into RabbitMQ's source code, but before spending too
much energy into this I wanted to know if there was any simpler solution to
my problem - some secret binding parameter, a plug-in... - and if that idea
seemed reasonable to the RabbitMQ gurus :)

Thanks for your help!

Charly
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110324/73ee8cde/attachment.htm>

From matthew at rabbitmq.com  Thu Mar 24 15:05:17 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 24 Mar 2011 15:05:17 +0000
Subject: [rabbitmq-discuss] Spying on "mandatory" messages
In-Reply-To: <AANLkTi=jDe6rbg9AYLzXEkaWk186SeLC_uH1ovoK1ojq@mail.gmail.com>
References: <AANLkTi=jDe6rbg9AYLzXEkaWk186SeLC_uH1ovoK1ojq@mail.gmail.com>
Message-ID: <20110324150517.GE29884@rabbitmq.com>

Hi Charly,

On Thu, Mar 24, 2011 at 03:35:35PM +0100, Charly Hamy wrote:
> For the req/res scenario, I'm using the mandatory flag on my messages, so
> that sending a request message to a disconnected component (no corresponding
> queue declared on the broker) returns an error to the sender. This works as
> expected.

Well... you're using mandatory as a poor-man's form of resource
monitoring.

> But now, I would want to plug new components to spy on those flows of
> requests and responses, without interfering with the ongoing
> communications... which is not by default compatible with my use of the
> mandatory flag : when a "spy" component is monitorng request/response
> messages, those messages end-up in its queue, then even if the actual target
> component for those messages is not present on the broker (no queue), no
> error is returned to the sender.

Indeed, which is why mandatory is probably a mis-feature and should not
be used. Basically, AMQP does not really provide any sort of sane
resource monitoring. We've added in the 2.4.0 release consumer-death
notifications, but that's not going to help you here. You really have a
choice: make the queue non-exclusive and non-autodelete. Thus it always
stays there and will always receive messages. Then, you have your
clients just consume from it. The queue will do round-robining between
the consumers and all should be well, but you might have reasons why you
want the queue to be exclusive or autodelete. The other option is to use
some other tool to do monitoring of your consumers and to address that
problem outside of AMQP/RabbitMQ.

Best wishes,

Matthew

From videlalvaro at gmail.com  Thu Mar 24 15:16:20 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 24 Mar 2011 16:16:20 +0100
Subject: [rabbitmq-discuss] Spying on "mandatory" messages
In-Reply-To: <20110324150517.GE29884@rabbitmq.com>
References: <AANLkTi=jDe6rbg9AYLzXEkaWk186SeLC_uH1ovoK1ojq@mail.gmail.com>
	<20110324150517.GE29884@rabbitmq.com>
Message-ID: <7494EE23-3862-42C1-B52D-50BEA0CCE52E@gmail.com>

Hi,

For spying messages on an RPC setup I'm working on an implementation of the Smart Proxy messaging pattern: http://www.eaipatterns.com/SmartProxy.html perhaps you could implement that too.

This is what I've done so far: http://vimeo.com/20966661 which is at early stage of development and very alpha.

Also take a look at the Wire Tap messaging pattern: http://www.eaipatterns.com/WireTap.html

I guess most of the patterns from that book can be implemented with RabbitMQ, and some of them are already there but with different nomenclature.

Hope this helps,

Alvaro

On Mar 24, 2011, at 4:05 PM, Matthew Sackman wrote:

> Hi Charly,
> 
> On Thu, Mar 24, 2011 at 03:35:35PM +0100, Charly Hamy wrote:
>> For the req/res scenario, I'm using the mandatory flag on my messages, so
>> that sending a request message to a disconnected component (no corresponding
>> queue declared on the broker) returns an error to the sender. This works as
>> expected.
> 
> Well... you're using mandatory as a poor-man's form of resource
> monitoring.
> 
>> But now, I would want to plug new components to spy on those flows of
>> requests and responses, without interfering with the ongoing
>> communications... which is not by default compatible with my use of the
>> mandatory flag : when a "spy" component is monitorng request/response
>> messages, those messages end-up in its queue, then even if the actual target
>> component for those messages is not present on the broker (no queue), no
>> error is returned to the sender.
> 
> Indeed, which is why mandatory is probably a mis-feature and should not
> be used. Basically, AMQP does not really provide any sort of sane
> resource monitoring. We've added in the 2.4.0 release consumer-death
> notifications, but that's not going to help you here. You really have a
> choice: make the queue non-exclusive and non-autodelete. Thus it always
> stays there and will always receive messages. Then, you have your
> clients just consume from it. The queue will do round-robining between
> the consumers and all should be well, but you might have reasons why you
> want the queue to be exclusive or autodelete. The other option is to use
> some other tool to do monitoring of your consumers and to address that
> problem outside of AMQP/RabbitMQ.
> 
> Best wishes,
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From irrer at umich.edu  Thu Mar 24 16:19:08 2011
From: irrer at umich.edu (Jim Irrer)
Date: Thu, 24 Mar 2011 12:19:08 -0400
Subject: [rabbitmq-discuss] Scaling Rabbit
In-Reply-To: <AANLkTi=rRq1Bg04JfRTnyfyxsysBf_dSDZtKoPiDmEqf@mail.gmail.com>
References: <AANLkTikhRzuv229ixeDArqywiGumVshoJycmQf_ahTve@mail.gmail.com>
	<AANLkTik3WUs5q80BLDp=Tqb0OJOUTf3vhEtRFFbDh8Xa@mail.gmail.com>
	<AANLkTi=rRq1Bg04JfRTnyfyxsysBf_dSDZtKoPiDmEqf@mail.gmail.com>
Message-ID: <AANLkTimGHM+-eQ3G6VqRXMPU6+vZfco9i-CNDtn6HfJD@mail.gmail.com>

Then your original idea should work.

With scaling like this you should be concerned about one of the
consumers failing.  Something like having 2 or more consumers
for each of the 100 types of messages but maybe that's what
you meant.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Thu, Mar 24, 2011 at 9:30 AM, Mark Steele <msteele at beringmedia.com>wrote:

> The idea here is that in a perfect world, I would have only 1 queue per
> exchange. However that won't scale since queues only exists on the node on
> which they are declared.
>
> To get around this, I want to create more queues across all the nodes, and
> distribute the load based on routing keys. The random pick of a routing key
> by the producer is simply to distribute load on the pre-created queues (that
> are spread across the nodes in the cluster).
>
>
> Mark Steele
> Bering Media Inc.
>
>
>
> On Wed, Mar 23, 2011 at 6:10 PM, Jim Irrer <irrer at umich.edu> wrote:
>
>> To better understand - The 10 billion messages each need to be processed
>> with the same
>> sort of processing?  The reason for having 10 direct exchanges would be
>> that there are 10 different kinds of
>> messages, is that true, or was your intent to have the message producers
>> have a
>> role in choosing a consumer?
>>
>> Thanks,
>>
>> - Jim
>>
>> Jim Irrer     irrer at umich.edu       (734) 647-4409
>> University of Michigan Hospital Radiation Oncology
>> 519 W. William St.             Ann Arbor, MI 48103
>>
>>
>> On Wed, Mar 23, 2011 at 4:29 PM, Mark Steele <msteele at beringmedia.com>wrote:
>>
>>> Hi folks,
>>>
>>> I've been noodling a scale problem for a while, and wanted some input.
>>>
>>> Here's my scenario:
>>>
>>> I have a relatively small number of publishers (1000), who I expect will
>>> want to publish a very large number of messages (let's say 10 billion
>>> messages a day) to a about 10 exchanges.
>>>
>>> My naive first stab at trying to get this to scale using rabbit would be
>>>
>>>    - Create 10 direct exchanges
>>>    - Create 100 queues to each of the exchanges (randomly distributed
>>>    onto several nodes in a rabbit cluster).
>>>    - Bind each of the queues to a topic (random number from 1-100)
>>>    - Attach consumers to each of these queues (insert load balancer
>>>    here)
>>>    - Have publishers randomly pick a number from 1-100 and use that as
>>>    the routing key
>>>
>>> Does this approach make sense for getting scale?
>>>
>>> Cheers
>>>
>>> Mark Steele
>>> Bering Media Inc.
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110324/34553d67/attachment.htm>

From Jan.Andersson at UNIBET.com  Thu Mar 24 16:38:02 2011
From: Jan.Andersson at UNIBET.com (Jan Andersson)
Date: Thu, 24 Mar 2011 16:38:02 +0000
Subject: [rabbitmq-discuss] parallel consuming from one queue
Message-ID: <4412D9D8F22D764F87903CF7FA46B2DC14D50B6A@UNILONEX01.unibet.com>

Hi,

Hi,
we are trying to setup something that we hoped would be pretty straight 
forward but can't seem to get it to work.
We want to consume messages from a persistent queue and use ack:s. 
However all of our attempts end in us consuming one message off the 
queue and then no one else (thread or process) can consume messages off 
the queue until that message has been ack:ed.

This is in Java, we set up one channel per thread like this:
[code]
channel = connection.createChannel();
channel.exchangeDeclare(configuration.getExchangeName(), "topic", true);
channel.queueDeclare(queueName, true); // durable queue
channel.queueBind(queueName, configuration.getExchangeName(), routingKey);
consumer = new QueueingConsumer(channel);
channel.basicConsume(queueName, false, consumer);
[/code]

The ack is done like this:
[code]
channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
[/code]

Might be hard to answer this but if anyone could point us in the right 
direction that would be great!

thanks
Jan


The information in this email is confidential and may be legally privileged.
If you are not the intended recipient, you must not read, use or disseminate that information
and upon reception, permanently delete the original and destroy any copies.
Although this email and any attachments are believed to be free of any virus
or any other defect which might affect any computer or IT system into which
they are received and opened, it is the responsibility of the recipient to
ensure that they are virus free and no responsibility is accepted by Unibet
for any loss or damage arising in any way from receipt or use thereof.


From emile at rabbitmq.com  Thu Mar 24 16:50:37 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 24 Mar 2011 16:50:37 +0000
Subject: [rabbitmq-discuss] parallel consuming from one queue
In-Reply-To: <4412D9D8F22D764F87903CF7FA46B2DC14D50B6A@UNILONEX01.unibet.com>
References: <4412D9D8F22D764F87903CF7FA46B2DC14D50B6A@UNILONEX01.unibet.com>
Message-ID: <4D8B765D.4090900@rabbitmq.com>

Hi Jan,

On 24/03/11 16:38, Jan Andersson wrote:
> Hi,
>
> Hi,
> we are trying to setup something that we hoped would be pretty straight
> forward but can't seem to get it to work.
> We want to consume messages from a persistent queue and use ack:s.
> However all of our attempts end in us consuming one message off the
> queue and then no one else (thread or process) can consume messages off
> the queue until that message has been ack:ed.
>
> This is in Java, we set up one channel per thread like this:
> [code]
> channel = connection.createChannel();
> channel.exchangeDeclare(configuration.getExchangeName(), "topic", true);
> channel.queueDeclare(queueName, true); // durable queue
> channel.queueBind(queueName, configuration.getExchangeName(), routingKey);
> consumer = new QueueingConsumer(channel);

channel.basicQos(SMALL_NUMBER);

> channel.basicConsume(queueName, false, consumer);
> [/code]
>
> The ack is done like this:
> [code]
> channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
> [/code]
>
> Might be hard to answer this but if anyone could point us in the right
> direction that would be great!

You should set QoS on each channel. The first QueueingConsumer has taken 
all the messages - that's why no other consumers can retrieve messages. 
Setting QoS will prevent the broker from delivering more than the set 
number of messages without acknowledgement and allow other consumers to 
retrieve some messages.

Regards

Emile

From jon at jbrisbin.com  Thu Mar 24 19:34:45 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 24 Mar 2011 14:34:45 -0500
Subject: [rabbitmq-discuss] 2.4.0 Java jars in maven?
Message-ID: <CFC363D8-9BE0-4915-A837-151F0CD65D95@jbrisbin.com>

Just wondering if the 2.4.0 Java jars are in a Maven repo anywhere? I don't see them in central but didn't know if they were on the SpringSource release repo or something?

I'm working on updating my Log4J appender to work with the latest stuff...

Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From jon at jbrisbin.com  Thu Mar 24 19:38:29 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 24 Mar 2011 14:38:29 -0500
Subject: [rabbitmq-discuss] Updated homebrew and rebar forks
Message-ID: <27B80900-A87C-4EF7-8DC7-A5481B4C2932@jbrisbin.com>

Homebrew was super fast today! I submitted a pull request and it's already been updated. You can brew update && brew install rabbitmq to get version 2.4.0

I also updated the rebar-friendly forks of rabbit_common and amqp_client to use version 2.4.0. I haven't checked the webhooks plugin yet, but that's on my list.

https://github.com/jbrisbin/rabbit_common
https://github.com/jbrisbin/amqp_client

Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110324/f48bd519/attachment.htm>

From irmo.manie at gmail.com  Thu Mar 24 19:41:16 2011
From: irmo.manie at gmail.com (Irmo Manie)
Date: Thu, 24 Mar 2011 20:41:16 +0100
Subject: [rabbitmq-discuss] 2.4.0 Java jars in maven?
In-Reply-To: <CFC363D8-9BE0-4915-A837-151F0CD65D95@jbrisbin.com>
References: <CFC363D8-9BE0-4915-A837-151F0CD65D95@jbrisbin.com>
Message-ID: <AANLkTikQfCHRORJF1=1EQgrE=twwtYZR6w2VhhFnGiKg@mail.gmail.com>


From simon at rabbitmq.com  Thu Mar 24 19:43:35 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 24 Mar 2011 19:43:35 +0000
Subject: [rabbitmq-discuss] 2.4.0 Java jars in maven?
In-Reply-To: <CFC363D8-9BE0-4915-A837-151F0CD65D95@jbrisbin.com>
References: <CFC363D8-9BE0-4915-A837-151F0CD65D95@jbrisbin.com>
Message-ID: <4D8B9EE7.1070603@rabbitmq.com>

On 24/03/2011 7:34PM, Jon Brisbin wrote:
> Just wondering if the 2.4.0 Java jars are in a Maven repo anywhere? I
> don't see them in central but didn't know if they were on the
> SpringSource release repo or something?

There was the usual trouble uploading them on release day. Normally when 
that happens we just retry every day until it works. Not sure if that's 
happened yet this time though.

> I'm working on updating my Log4J appender to work with the latest
> stuff...

Cool!

On 24/03/2011 7:41PM, Irmo Manie wrote:
 >  From http://www.rabbitmq.com/java-client.html
 >
 > "There usually is a few weeks lag between a new release and its
 > appearance in the central Maven repository. Be patient."

Weeks? Blimey, that's out of date. As mentioned above, we try to do it 
on release day, but the Maven servers are anything but cooperative.

Cheers, Simon

From jasonjwwilliams at gmail.com  Thu Mar 24 20:17:06 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 24 Mar 2011 14:17:06 -0600
Subject: [rabbitmq-discuss] Clustering Internals
In-Reply-To: <20110324135943.GD29884@rabbitmq.com>
References: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>
	<20110322235234.GA5696@wellquite.org>
	<AANLkTi=d0umuEjLoW9HdZtwOxuU_oKahEEQpJmL4uUfJ@mail.gmail.com>
	<20110323123635.GD19387@rabbitmq.com>
	<AANLkTimLOXPgoBtgHwcwZxjd0kzipM+aNwhHxCj8HG6Z@mail.gmail.com>
	<20110324135943.GD29884@rabbitmq.com>
Message-ID: <AANLkTikSNMpiq_nc6SEzPRHd8mBVnCfePHT356QME=AU@mail.gmail.com>

Hi Matthew,

I really appreciate the detailed explanation. I believe I understand what
you're saying.


> I don't know to what you're referring when you say "you're instantly
> released" - _what_ is instantly release?


By "instantly released" I mean the client doesn't wait for a return_ok or
error on a publish command.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110324/10f8ea29/attachment.htm>

From irmo.manie at gmail.com  Thu Mar 24 20:43:20 2011
From: irmo.manie at gmail.com (Irmo Manie)
Date: Thu, 24 Mar 2011 21:43:20 +0100
Subject: [rabbitmq-discuss] 2.4.0 Java jars in maven?
In-Reply-To: <4D8B9EE7.1070603@rabbitmq.com>
References: <CFC363D8-9BE0-4915-A837-151F0CD65D95@jbrisbin.com>
	<4D8B9EE7.1070603@rabbitmq.com>
Message-ID: <AANLkTi=vruJ6WW1rgx5rej_-50e5Qg7LFSDEOeE-fhwt@mail.gmail.com>

> Weeks? Blimey, that's out of date. As mentioned above, we try to do it on
> release day, but the Maven servers are anything but cooperative.

Ah cool, then I can expect it any day then. Was also already wondering
why the docs says weeks, seemed a bit too much.
Anyway, when it's there I can also update akka with the latest, so
that will be included in the shortly upcoming 1.1 release :-)

From matthew at rabbitmq.com  Thu Mar 24 23:09:51 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 24 Mar 2011 23:09:51 +0000
Subject: [rabbitmq-discuss] Clustering Internals
In-Reply-To: <AANLkTikSNMpiq_nc6SEzPRHd8mBVnCfePHT356QME=AU@mail.gmail.com>
References: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>
	<20110322235234.GA5696@wellquite.org>
	<AANLkTi=d0umuEjLoW9HdZtwOxuU_oKahEEQpJmL4uUfJ@mail.gmail.com>
	<20110323123635.GD19387@rabbitmq.com>
	<AANLkTimLOXPgoBtgHwcwZxjd0kzipM+aNwhHxCj8HG6Z@mail.gmail.com>
	<20110324135943.GD29884@rabbitmq.com>
	<AANLkTikSNMpiq_nc6SEzPRHd8mBVnCfePHT356QME=AU@mail.gmail.com>
Message-ID: <20110324230951.GA24985@wellquite.org>

On Thu, Mar 24, 2011 at 02:17:06PM -0600, Jason J. W. Williams wrote:
> By "instantly released" I mean the client doesn't wait for a return_ok or
> error on a publish command.

Correct. Basic.Publish is an async method which is entirely fire and
forget. Any responses to it are equally async. The distinction is
important: pipelining is possible of async methods whereas it is not of
sync methods. Thus you can't issue two queue.declares after each other
without waiting for the first queue.declare_ok to come back, where as
you can issue two basic.publishes straight after each other and then
later on, the first evokes a basic.return.

Matthew

From jasonjwwilliams at gmail.com  Thu Mar 24 23:16:50 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 24 Mar 2011 17:16:50 -0600
Subject: [rabbitmq-discuss] Clustering Internals
In-Reply-To: <20110324230951.GA24985@wellquite.org>
References: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>
	<20110322235234.GA5696@wellquite.org>
	<AANLkTi=d0umuEjLoW9HdZtwOxuU_oKahEEQpJmL4uUfJ@mail.gmail.com>
	<20110323123635.GD19387@rabbitmq.com>
	<AANLkTimLOXPgoBtgHwcwZxjd0kzipM+aNwhHxCj8HG6Z@mail.gmail.com>
	<20110324135943.GD29884@rabbitmq.com>
	<AANLkTikSNMpiq_nc6SEzPRHd8mBVnCfePHT356QME=AU@mail.gmail.com>
	<20110324230951.GA24985@wellquite.org>
Message-ID: <AANLkTimiOMpjS=4VJ+t8hpQ7Z8AA7N_kzDU4Q5w6tUgX@mail.gmail.com>

>
> Correct. Basic.Publish is an async method which is entirely fire and
> forget. Any responses to it are equally async. The distinction is
> important: pipelining is possible of async methods whereas it is not of
> sync methods. Thus you can't issue two queue.declares after each other
> without waiting for the first queue.declare_ok to come back, where as
> you can issue two basic.publishes straight after each other and then
> later on, the first evokes a basic.return.


The side-effect for publishing being that the channel on the server side can
still be in the process of routing the message while the client has already
moved on to the next publish command.  So if the server node dies, without
transactions or publisher confirms the client has no idea that the message
has gone poof before it got routed. Would that be a correct description?

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110324/a2eb27e8/attachment.htm>

From matthew at rabbitmq.com  Thu Mar 24 23:53:25 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 24 Mar 2011 23:53:25 +0000
Subject: [rabbitmq-discuss] Clustering Internals
In-Reply-To: <AANLkTimiOMpjS=4VJ+t8hpQ7Z8AA7N_kzDU4Q5w6tUgX@mail.gmail.com>
References: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>
	<20110322235234.GA5696@wellquite.org>
	<AANLkTi=d0umuEjLoW9HdZtwOxuU_oKahEEQpJmL4uUfJ@mail.gmail.com>
	<20110323123635.GD19387@rabbitmq.com>
	<AANLkTimLOXPgoBtgHwcwZxjd0kzipM+aNwhHxCj8HG6Z@mail.gmail.com>
	<20110324135943.GD29884@rabbitmq.com>
	<AANLkTikSNMpiq_nc6SEzPRHd8mBVnCfePHT356QME=AU@mail.gmail.com>
	<20110324230951.GA24985@wellquite.org>
	<AANLkTimiOMpjS=4VJ+t8hpQ7Z8AA7N_kzDU4Q5w6tUgX@mail.gmail.com>
Message-ID: <20110324235324.GC24985@wellquite.org>

On Thu, Mar 24, 2011 at 05:16:50PM -0600, Jason J. W. Williams wrote:
> The side-effect for publishing being that the channel on the server side can
> still be in the process of routing the message while the client has already
> moved on to the next publish command.  So if the server node dies, without
> transactions or publisher confirms the client has no idea that the message
> has gone poof before it got routed. Would that be a correct description?

Yes. And this is fundamentally why you can't have exactly-once delivery:
either you have fire and forget, in which case msgs can be lost in
transit to the broker, or you use transactions or confirms, at which
point the tx.commit_ok or the confirm back to the client can be lost
thus making the client retransmit messages to a non-failed broker where
those msgs actually were received and processed by the broker, it's just
the client never received the notification that that had occurred.

Matthew

From jasonjwwilliams at gmail.com  Fri Mar 25 00:00:54 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 24 Mar 2011 18:00:54 -0600
Subject: [rabbitmq-discuss] Clustering Internals
In-Reply-To: <20110324235324.GC24985@wellquite.org>
References: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>
	<20110322235234.GA5696@wellquite.org>
	<AANLkTi=d0umuEjLoW9HdZtwOxuU_oKahEEQpJmL4uUfJ@mail.gmail.com>
	<20110323123635.GD19387@rabbitmq.com>
	<AANLkTimLOXPgoBtgHwcwZxjd0kzipM+aNwhHxCj8HG6Z@mail.gmail.com>
	<20110324135943.GD29884@rabbitmq.com>
	<AANLkTikSNMpiq_nc6SEzPRHd8mBVnCfePHT356QME=AU@mail.gmail.com>
	<20110324230951.GA24985@wellquite.org>
	<AANLkTimiOMpjS=4VJ+t8hpQ7Z8AA7N_kzDU4Q5w6tUgX@mail.gmail.com>
	<20110324235324.GC24985@wellquite.org>
Message-ID: <AANLkTinmPZ618Ys=EwctEV3bocgU8WOx+MVVWXAYTCEu@mail.gmail.com>

> Yes. And this is fundamentally why you can't have exactly-once delivery:
> either you have fire and forget, in which case msgs can be lost in
> transit to the broker, or you use transactions or confirms, at which
> point the tx.commit_ok or the confirm back to the client can be lost
> thus making the client retransmit messages to a non-failed broker where
> those msgs actually were received and processed by the broker, it's just
> the client never received the notification that that had occurred.


 Thank you Matthew. :) I appreciate your patience with me.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110324/541593a8/attachment-0001.htm>

From alexis at rabbitmq.com  Fri Mar 25 00:04:32 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 25 Mar 2011 00:04:32 +0000
Subject: [rabbitmq-discuss] Clustering Internals
In-Reply-To: <AANLkTinmPZ618Ys=EwctEV3bocgU8WOx+MVVWXAYTCEu@mail.gmail.com>
References: <AANLkTi=J3ejBcwrUOO7W-1Ou3Hmv0k3AzjoRRV4EqYEQ@mail.gmail.com>
	<20110322235234.GA5696@wellquite.org>
	<AANLkTi=d0umuEjLoW9HdZtwOxuU_oKahEEQpJmL4uUfJ@mail.gmail.com>
	<20110323123635.GD19387@rabbitmq.com>
	<AANLkTimLOXPgoBtgHwcwZxjd0kzipM+aNwhHxCj8HG6Z@mail.gmail.com>
	<20110324135943.GD29884@rabbitmq.com>
	<AANLkTikSNMpiq_nc6SEzPRHd8mBVnCfePHT356QME=AU@mail.gmail.com>
	<20110324230951.GA24985@wellquite.org>
	<AANLkTimiOMpjS=4VJ+t8hpQ7Z8AA7N_kzDU4Q5w6tUgX@mail.gmail.com>
	<20110324235324.GC24985@wellquite.org>
	<AANLkTinmPZ618Ys=EwctEV3bocgU8WOx+MVVWXAYTCEu@mail.gmail.com>
Message-ID: <AANLkTi=Ezz5CgJ-Ay+ubnQoBioN-913hBm0_eJ+Shk9+@mail.gmail.com>

"no exactly once" is a variant of the CAP argument.


On Fri, Mar 25, 2011 at 12:00 AM, Jason J. W. Williams
<jasonjwwilliams at gmail.com> wrote:
>
>> Yes. And this is fundamentally why you can't have exactly-once delivery:
>> either you have fire and forget, in which case msgs can be lost in
>> transit to the broker, or you use transactions or confirms, at which
>> point the tx.commit_ok or the confirm back to the client can be lost
>> thus making the client retransmit messages to a non-failed broker where
>> those msgs actually were received and processed by the broker, it's just
>> the client never received the notification that that had occurred.
>
> ?Thank you Matthew. :) I appreciate your patience with me.
> -J
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From dhickey at gmail.com  Thu Mar 24 23:13:03 2011
From: dhickey at gmail.com (Dex)
Date: Thu, 24 Mar 2011 16:13:03 -0700 (PDT)
Subject: [rabbitmq-discuss] EndOfStreamException SharedQueue closed with
	.net client
Message-ID: <cc044d0d-66c7-4fba-bfa1-b2517dc3a2aa@s11g2000yqh.googlegroups.com>

Hi all,

new to RabbitMQ here :) Version 2.4.0, erlang 5.8.3, win7 x64, .Net 4

Learning the API, I've based the code below on the examples in the
dotnet client user guide.

When run, the Task thread will dequeue the message fine, but will
throw when starting to de-queue again:

System.IO.EndOfStreamException was unhandled by user code
  Message=SharedQueue closed
  Source=RabbitMQ.Client
  StackTrace:
       at RabbitMQ.Util.SharedQueue.EnsureIsOpen()
       at RabbitMQ.Util.SharedQueue.Dequeue()
       at RabbitMQTest.Program.<Main>b__0() in c:\dev\RabbitMQTest
\Program.cs:line 33
       at System.Threading.Tasks.Task.InnerInvoke()
       at System.Threading.Tasks.Task.Execute()
  InnerException:

Stepping through the program I notice that consumer.Queue.m_isOpen is
true just before the second Dequeue is attempted. Of course it's false
just after the exception is thrown.

Can anyone see anything wrong with my code? Any pointers would be
great.

Many thanks.

----------

using System;
using System.Text;
using System.Threading.Tasks;
using RabbitMQ.Client;
using RabbitMQ.Client.Events;
using RabbitMQ.Client.Exceptions;

internal class Program
{
	private static void Main(string[] args)
	{
		const string exchangeName = "exchange";
		const string routingKey = "routingkey";

		Task.Factory.StartNew(() =>
		{
			const string consumerQueue = "consumer";
			IConnection consumerConnection = new
ConnectionFactory().CreateConnection();
			IModel consumerChannel = consumerConnection.CreateModel();
			consumerChannel.ExchangeDeclare(exchangeName, ExchangeType.Direct);
			consumerChannel.QueueDeclare(consumerQueue, false, false, false,
null);
			consumerChannel.QueueBind(consumerQueue, exchangeName, routingKey,
null);

			var consumer = new QueueingBasicConsumer(consumerChannel);
			consumerChannel.BasicConsume(consumerQueue, true, consumer);
			while (true)
			{
				try
				{
					// System.IO.EndOfStreamException ("SharedQueue closed") on
second dequeue
					var e = (BasicDeliverEventArgs)consumer.Queue.Dequeue();
					byte[] body = e.Body;
					Console.WriteLine(Encoding.UTF8.GetString(body));
					consumerChannel.BasicAck(e.DeliveryTag, false);
				}
				catch (OperationInterruptedException ex)
				{
					break;
				}
			}
			consumerConnection.Close();
			consumerChannel.Close();
		});

		Console.WriteLine("Press enter to send message.");
		Console.ReadLine();

		IConnection producerConnection = new
ConnectionFactory().CreateConnection();
		IModel producerChannel = producerConnection.CreateModel();
		byte[] messageBodyBytes = Encoding.UTF8.GetBytes("Hello, world!");
		producerChannel.BasicPublish(exchangeName, routingKey, null,
messageBodyBytes);

		Console.ReadLine();
	}
}

From sean at sean-bollin.com  Fri Mar 25 01:40:52 2011
From: sean at sean-bollin.com (seanbollin)
Date: Thu, 24 Mar 2011 18:40:52 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ memory (RSS) slowly rising. Help!
Message-ID: <4511df37-6b1b-4a17-b8a5-dbaae213bb29@a11g2000pro.googlegroups.com>

Hi all,

I don't understand why my RabbitMQ process memory is growing slowly
over time.

Here is the RSS I'm monitoring:

38660    01:17:58 15928 /home/example//lib/erlang/erts-5.8.3/bin/
beam.smp -W w -K true -A30 -P 1048576 -- -root /home/example//lib/
erlang -progname erl -- -home /home/example -- -noshell -noinput -
sname rabbit at web188 -boot /home/example/mnesia/rabbit at web188-p

The 38660 grows slowly over time.

To add to the confusion, when I run: ./rabbitmqctl list_queues
messages

It consistently displays 0 messages.

This leads me to believe that the memory should stabilize.

Why is the memory consistently rising?

From Jan.Andersson at UNIBET.com  Fri Mar 25 08:10:45 2011
From: Jan.Andersson at UNIBET.com (Jan Andersson)
Date: Fri, 25 Mar 2011 08:10:45 +0000
Subject: [rabbitmq-discuss] parallel consuming from one queue
In-Reply-To: <4D8B765D.4090900@rabbitmq.com>
References: <4412D9D8F22D764F87903CF7FA46B2DC14D50B6A@UNILONEX01.unibet.com>
	<4D8B765D.4090900@rabbitmq.com>
Message-ID: <4412D9D8F22D764F87903CF7FA46B2DC14D50B6B@UNILONEX01.unibet.com>

On 03/24/2011 05:50 PM, Emile Joubert wrote:
> Hi Jan,
>
> On 24/03/11 16:38, Jan Andersson wrote:
>> Hi,
>>
>> Hi,
>> we are trying to setup something that we hoped would be pretty straight
>> forward but can't seem to get it to work.
>> We want to consume messages from a persistent queue and use ack:s.
>> However all of our attempts end in us consuming one message off the
>> queue and then no one else (thread or process) can consume messages off
>> the queue until that message has been ack:ed.
>>
>> This is in Java, we set up one channel per thread like this:
>> [code]
>> channel = connection.createChannel();
>> channel.exchangeDeclare(configuration.getExchangeName(), "topic", true);
>> channel.queueDeclare(queueName, true); // durable queue
>> channel.queueBind(queueName, configuration.getExchangeName(), 
>> routingKey);
>> consumer = new QueueingConsumer(channel);
>
> channel.basicQos(SMALL_NUMBER);
>
>> channel.basicConsume(queueName, false, consumer);
>> [/code]
>>
>> The ack is done like this:
>> [code]
>> channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
>> [/code]
>>
>> Might be hard to answer this but if anyone could point us in the right
>> direction that would be great!
>
> You should set QoS on each channel. The first QueueingConsumer has 
> taken all the messages - that's why no other consumers can retrieve 
> messages. Setting QoS will prevent the broker from delivering more 
> than the set number of messages without acknowledgement and allow 
> other consumers to retrieve some messages.
>
> Regards
>
> Emile


Hi,
after setting the QoS like "channel.basicQos(1);" we can pickup messages 
in parallel.
However, every message gets the deliveryTag set to 1. So when we ack the 
2nd, 3rd... message we get the error:

channel error; reason: 
{#method<channel.close>(reply-code=406,reply-text=PRECONDITION_FAILED - 
unknown delivery tag 1,class-id=60,method-id=80),null,""}

Are we consuming the messages in the wrong way somehow?
(QueueingConsumer.Delivery delivery = consumer.nextDelivery();)

thanks for your quick reply,
regards
Jan

The information in this email is confidential and may be legally privileged.
If you are not the intended recipient, you must not read, use or disseminate that information
and upon reception, permanently delete the original and destroy any copies.
Although this email and any attachments are believed to be free of any virus
or any other defect which might affect any computer or IT system into which
they are received and opened, it is the responsibility of the recipient to
ensure that they are virus free and no responsibility is accepted by Unibet
for any loss or damage arising in any way from receipt or use thereof.


From Jan.Andersson at UNIBET.com  Fri Mar 25 10:16:54 2011
From: Jan.Andersson at UNIBET.com (Jan Andersson)
Date: Fri, 25 Mar 2011 10:16:54 +0000
Subject: [rabbitmq-discuss] parallel consuming from one queue
In-Reply-To: <4412D9D8F22D764F87903CF7FA46B2DC14D50B6B@UNILONEX01.unibet.com>
References: <4412D9D8F22D764F87903CF7FA46B2DC14D50B6A@UNILONEX01.unibet.com>
	<4D8B765D.4090900@rabbitmq.com>
	<4412D9D8F22D764F87903CF7FA46B2DC14D50B6B@UNILONEX01.unibet.com>
Message-ID: <4412D9D8F22D764F87903CF7FA46B2DC14D50B6C@UNILONEX01.unibet.com>

On 03/25/2011 09:10 AM, Jan Andersson wrote:
> On 03/24/2011 05:50 PM, Emile Joubert wrote:
>> Hi Jan,
>>
>> On 24/03/11 16:38, Jan Andersson wrote:
>>> Hi,
>>>
>>> Hi,
>>> we are trying to setup something that we hoped would be pretty straight
>>> forward but can't seem to get it to work.
>>> We want to consume messages from a persistent queue and use ack:s.
>>> However all of our attempts end in us consuming one message off the
>>> queue and then no one else (thread or process) can consume messages off
>>> the queue until that message has been ack:ed.
>>>
>>> This is in Java, we set up one channel per thread like this:
>>> [code]
>>> channel = connection.createChannel();
>>> channel.exchangeDeclare(configuration.getExchangeName(), "topic", true);
>>> channel.queueDeclare(queueName, true); // durable queue
>>> channel.queueBind(queueName, configuration.getExchangeName(),
>>> routingKey);
>>> consumer = new QueueingConsumer(channel);
>> channel.basicQos(SMALL_NUMBER);
>>
>>> channel.basicConsume(queueName, false, consumer);
>>> [/code]
>>>
>>> The ack is done like this:
>>> [code]
>>> channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
>>> [/code]
>>>
>>> Might be hard to answer this but if anyone could point us in the right
>>> direction that would be great!
>> You should set QoS on each channel. The first QueueingConsumer has
>> taken all the messages - that's why no other consumers can retrieve
>> messages. Setting QoS will prevent the broker from delivering more
>> than the set number of messages without acknowledgement and allow
>> other consumers to retrieve some messages.
>>
>> Regards
>>
>> Emile
>
> Hi,
> after setting the QoS like "channel.basicQos(1);" we can pickup messages
> in parallel.
> However, every message gets the deliveryTag set to 1. So when we ack the
> 2nd, 3rd... message we get the error:
>
> channel error; reason:
> {#method<channel.close>(reply-code=406,reply-text=PRECONDITION_FAILED -
> unknown delivery tag 1,class-id=60,method-id=80),null,""}
>
> Are we consuming the messages in the wrong way somehow?
> (QueueingConsumer.Delivery delivery = consumer.nextDelivery();)
>
> thanks for your quick reply,
> regards
> Jan
>
This was our own fault, we reused the same channel by mistake.
sorry for the bother,
Janne
The information in this email is confidential and may be legally privileged.
If you are not the intended recipient, you must not read, use or disseminate that information
and upon reception, permanently delete the original and destroy any copies.
Although this email and any attachments are believed to be free of any virus
or any other defect which might affect any computer or IT system into which
they are received and opened, it is the responsibility of the recipient to
ensure that they are virus free and no responsibility is accepted by Unibet
for any loss or damage arising in any way from receipt or use thereof.


From emile at rabbitmq.com  Fri Mar 25 10:16:48 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 25 Mar 2011 10:16:48 +0000
Subject: [rabbitmq-discuss] EndOfStreamException SharedQueue closed with
 .net client
In-Reply-To: <cc044d0d-66c7-4fba-bfa1-b2517dc3a2aa@s11g2000yqh.googlegroups.com>
References: <cc044d0d-66c7-4fba-bfa1-b2517dc3a2aa@s11g2000yqh.googlegroups.com>
Message-ID: <4D8C6B90.1080003@rabbitmq.com>

Hi Dex,

On 24/03/11 23:13, Dex wrote:
> Hi all,
>
> new to RabbitMQ here :) Version 2.4.0, erlang 5.8.3, win7 x64, .Net 4
>
> Learning the API, I've based the code below on the examples in the
> dotnet client user guide.
>
> When run, the Task thread will dequeue the message fine, but will
> throw when starting to de-queue again:

The problem is the combination of these two lines:

> 			consumerChannel.BasicConsume(consumerQueue, true, consumer);

> 					consumerChannel.BasicAck(e.DeliveryTag, false);

You are consuming from the queue in auto-ack mode and explicitly 
acknowledging the message. This amounts to a duplicate acknowledgement 
which is forbidden. The broker is required by the AMQP specification to 
raise a channel exception in this situation. The exception you see is a 
result of this.

The solution is either to set the auto-ack flag to false when 
registering the consumer or to remove the explicit acknowledgement.

You are closing the channel and connection in the wrong order in the 
task, but the previous error prevents this code from being reached.

In this case you only need a single connection. You can create a 
consumer channel and a producer channel over the same connection. At the 
moment your program won't terminate, because the separate consumer 
connection remains open and the task doesn't know that the main thread 
has terminated.


Regards

Emile





From oj at buffered.io  Fri Mar 25 10:36:19 2011
From: oj at buffered.io (OJ Reeves)
Date: Fri, 25 Mar 2011 20:36:19 +1000
Subject: [rabbitmq-discuss] Fault-tolerant subscriptions using the .NET
	client
Message-ID: <gloz7ig9l7c8fgroaxjezwJv4X.penango@mail.gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/3908e831/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Verify This Message with Penango.p7s
Type: application/pkcs7-signature
Size: 3530 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/3908e831/attachment-0001.bin>

From dhickey at gmail.com  Fri Mar 25 10:54:00 2011
From: dhickey at gmail.com (Dex)
Date: Fri, 25 Mar 2011 03:54:00 -0700 (PDT)
Subject: [rabbitmq-discuss] EndOfStreamException SharedQueue closed with
	.net client
In-Reply-To: <4D8C6B90.1080003@rabbitmq.com>
References: <cc044d0d-66c7-4fba-bfa1-b2517dc3a2aa@s11g2000yqh.googlegroups.com>
	<4D8C6B90.1080003@rabbitmq.com>
Message-ID: <694ad0cd-9d19-48fa-87d5-1177c6efdebe@1g2000yqq.googlegroups.com>

Thanks Emile, that did the trick.

I think section 2.8 of the dotnet user guide may be a bit out of date?
The example there has the line

>  consumerChannel.BasicConsume(consumerQueue, null, consumer);

It appears the second parameter is not valid for a bool. It also has
the line

> channel.BasicAck(e.DeliveryTag, false);

So hence my mis-understanding.

Also, I would not hold this code up as a 'correct' example of
anything! I was just trying to get a reproduction of my issue in a
simple way....

Thanks again.

On Mar 25, 10:16?am, Emile Joubert <em... at rabbitmq.com> wrote:
> Hi Dex,
>
> On 24/03/11 23:13, Dex wrote:
>
> > Hi all,
>
> > new to RabbitMQ here :) Version 2.4.0, erlang 5.8.3, win7 x64, .Net 4
>
> > Learning the API, I've based the code below on the examples in the
> > dotnet client user guide.
>
> > When run, the Task thread will dequeue the message fine, but will
> > throw when starting to de-queue again:
>
> The problem is the combination of these two lines:
>
> > ? ? ? ? ? ? ? ? ? ?consumerChannel.BasicConsume(consumerQueue, true, consumer);
> > ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?consumerChannel.BasicAck(e.DeliveryTag, false);
>
> You are consuming from the queue in auto-ack mode and explicitly
> acknowledging the message. This amounts to a duplicate acknowledgement
> which is forbidden. The broker is required by the AMQP specification to
> raise a channel exception in this situation. The exception you see is a
> result of this.
>
> The solution is either to set the auto-ack flag to false when
> registering the consumer or to remove the explicit acknowledgement.
>
> You are closing the channel and connection in the wrong order in the
> task, but the previous error prevents this code from being reached.
>
> In this case you only need a single connection. You can create a
> consumer channel and a producer channel over the same connection. At the
> moment your program won't terminate, because the separate consumer
> connection remains open and the task doesn't know that the main thread
> has terminated.
>
> Regards
>
> Emile
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Fri Mar 25 11:46:57 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 25 Mar 2011 11:46:57 +0000
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-http
Message-ID: <4D8C80B1.8090401@rabbitmq.com>

Hi all. I got a bit bored yesterday, so I wrote a plugin. It lets you 
authenticate / authorise RabbitMQ users by making requests to a web 
server rather than using the internal database. It comes with a simple 
Django-based example.

https://github.com/simonmacmullen/rabbitmq-auth-backend-http

Let me know if anyone finds this useful.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From holger.hoffstaette at googlemail.com  Fri Mar 25 11:48:25 2011
From: holger.hoffstaette at googlemail.com (Holger Hoffstaette)
Date: Fri, 25 Mar 2011 12:48:25 +0100
Subject: [rabbitmq-discuss] 2.4.0 Java jars in maven?
References: <CFC363D8-9BE0-4915-A837-151F0CD65D95@jbrisbin.com>
	<4D8B9EE7.1070603@rabbitmq.com>
Message-ID: <pan.2011.03.25.11.48.23.669888@googlemail.com>

On Thu, 24 Mar 2011 19:43:35 +0000, Simon MacMullen wrote:

> Weeks? Blimey, that's out of date. As mentioned above, we try to do it on
> release day, but the Maven servers are anything but cooperative.

Not sure if you know this, but there has been a UK mirror for some time
now:

http://www.sonatype.com/people/2010/10/new-official-maven-central-repository-in-europe/

and

http://www.sonatype.com/people/2011/03/enhancements-to-maven-central/

Don't know if you can publish to the UK mirror, but for reading it's been
quite good for me.

-h



From bruce.bushby at gmail.com  Fri Mar 25 12:05:46 2011
From: bruce.bushby at gmail.com (bruce bushby)
Date: Fri, 25 Mar 2011 12:05:46 +0000
Subject: [rabbitmq-discuss] "local queue" ...."remote queue"
Message-ID: <AANLkTi=VRXJ4yNQriuU5SceNw-v9ZFcOuFxCaAcZiW6V@mail.gmail.com>

Hi

I was wondering what others are doing with regards to "queuing" local
messages for deliver when the network is available.


From oj at buffered.io  Fri Mar 25 12:17:29 2011
From: oj at buffered.io (OJ Reeves)
Date: Fri, 25 Mar 2011 22:17:29 +1000
Subject: [rabbitmq-discuss] Fault-tolerant subscriptions using the .NET
	client
In-Reply-To: <gloz7ig9l7c8fgroaxjezwJv4X.penango@mail.gmail.com>
References: <gloz7ig9l7c8fgroaxjezwJv4X.penango@mail.gmail.com>
Message-ID: <glp2tltjjatnniesvhjezwJv4X.penango@mail.gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/43c998e7/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Verify This Message with Penango.p7s
Type: application/pkcs7-signature
Size: 3530 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/43c998e7/attachment.bin>

From emile at rabbitmq.com  Fri Mar 25 13:55:03 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 25 Mar 2011 13:55:03 +0000
Subject: [rabbitmq-discuss] Fault-tolerant subscriptions using the .NET
 client
In-Reply-To: <glp2tltjjatnniesvhjezwJv4X.penango@mail.gmail.com>
References: <gloz7ig9l7c8fgroaxjezwJv4X.penango@mail.gmail.com>
	<glp2tltjjatnniesvhjezwJv4X.penango@mail.gmail.com>
Message-ID: <4D8C9EB7.1060304@rabbitmq.com>

Hi OJ,

On 25/03/11 12:17, OJ Reeves wrote:
> Hi again,
>
> After a bit of investigation and information from a friend, I went down
> the path of periodically checking the IsOpen property on the Connection
> object. If false, then I go through the process of attempting to
> re-establish the connection.
>
> Is this a valid approach? Is it the recommended approach?

That doesn't sound optimal. Ideally you want a solution that will notice 
as soon as a network error occurs. Your solution would introduce a delay 
during which the connection might be down, but IsOpen has not been 
called yet.

>     If I simulate a network issue by stopping the RabbitMQ server, the
>     subscriber is not informed about the connection loss.

The subscriber is notified by being disposed. You should find that the 
Dispose() method on Subscription gets called as soon as a connection 
error occurs.

>     What I would like to do is put something in place which is able to
>     detect a connection failure and get things working again.

A possible solution is to wrap some reconnection logic around connection 
establishment. Another would be to make use of the higher-level 
reconnection features in the messaging patterns library:
http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/

This assume that a new subscription gets established if the connection 
breaks.


Regards


Emile


From majek04 at gmail.com  Fri Mar 25 14:14:12 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 25 Mar 2011 14:14:12 +0000
Subject: [rabbitmq-discuss] Managing channels,
	esp wrt short lived publishers/consumers
In-Reply-To: <4D83A9ED.80607@gmail.com>
References: <4D83A9ED.80607@gmail.com>
Message-ID: <AANLkTim_QNZpjAr_33Jsn4vwZGyVeAsG4PcOjNuuF7z4@mail.gmail.com>

James,

On Fri, Mar 18, 2011 at 18:52, James Aimonetti
<james.aimonetti at gmail.com> wrote:
> I'm trying to figure out the best way to manage channel creation in my app.
> Currently, any process that needs to publish or consume gets a channel and I
> realize it is probably horribly inefficient, but as a prototype I wasn't too
> concerned. Now that we're moving forward, I want to get this cleaned up
> before I get too much further along.
>
> I have a setup something like:
>
> [App, App, App] <---> [AMQP] <--> Engine <--> Client
>
> So a client makes a request to the Engine, which creates two processes, one
> to publish events from the client, and one to consume commands from the Apps
> and relay them to the client.
>
> [App, App, App] <--> [AMQP] <-- ReqEvts <-- Client
> [App, App, App] <--> [AMQP] --> ReqCtl --> Client
>
> Ideally we'll be handling several hundreds of requests per second from
> clients. So the ReqEvts process pumps 10 or so messages in rapid succession
> at the beginning of a request, heartbeats every 20 or so seconds, then pumps
> another 10 or so messages at the end of the request. Requests may last 1
> second (so setup and tear down bursts happen almost on top of each other) or
> may last minutes or hours. Meanwhile, the ReqCtl receives commands from a
> targeted exchange from the Apps to relay to the Client.
>
> Each App has a queue that it binds to a targeted exchange and one or more
> topic exchanges. In general it receives most messages off the topic
> exchanges and publishes to the targeted exchange.
>
> So, hopefully that gives a broad overview. The Apps and the Engine pieces
> are all on different servers.
>
> So right now each server has an instance of rabbitmq running, and is
> clustered to all the other servers (Apps and Engine, currently four total
> servers but expandable). What I'm not sure about is how to manage each
> server's connection and channels. Each server has a gen_server managing the
> connection to rabbit, as well as the channels. So when a pid requests to
> publish or consume or declare a queue, the gen_server checks if the pid is
> known and uses that channel, or creates a new channel and stores the
> association. With all of these potentially short-lived consumers and
> publishers, I see a LOT of channel creation/destruction going on and wonder
> if there's a better way? Should I not have hidden channels behind a
> gen_server?

Having a pool of channels is quite a common practice.

> My initial thought is to have a dedicated channel for all publishers on the
> server to send over, a dedicated channel for any queue declarations, and a
> channel for each process that is consuming from a queue. Am I serializing
> too much with this setup?

That should be fine. Some people use a single channel for all the stuff.

Channel is a weird abstraction, it's mainly responsible for:
 - scoping errors (ie: channel is closed on error)
 - message ordering (messages sent through a channel will be delivered in order)
 - also, some resources may be associated with channel,
   and its state may change when the channel is closed (autodelete queues,
   unacknowledged messages)
 - parallelization of synchronous actions (like queue.declare)

Basically, if you don't need this features, you can just use a single channel.
In other case you must use multiple channels, but managing the lifetime
of a channel is your decision.

For example you may want to destroy channels often to
isolate errors (ie: if one channel fails for some reason, you
want it to affect only a single 'request' in your app)

In your case, it looks like you only need the 'parallelization' feature,
so using a pool of channels should do.

Cheers,
  Marek

From charly.hamy at gmail.com  Fri Mar 25 14:15:03 2011
From: charly.hamy at gmail.com (Charly Hamy)
Date: Fri, 25 Mar 2011 15:15:03 +0100
Subject: [rabbitmq-discuss] Spying on "mandatory" messages
In-Reply-To: <7494EE23-3862-42C1-B52D-50BEA0CCE52E@gmail.com>
References: <AANLkTi=jDe6rbg9AYLzXEkaWk186SeLC_uH1ovoK1ojq@mail.gmail.com>
	<20110324150517.GE29884@rabbitmq.com>
	<7494EE23-3862-42C1-B52D-50BEA0CCE52E@gmail.com>
Message-ID: <AANLkTimzFnXDWnUWpB2Ub246uOU61EYO-49RaWHBHhcH@mail.gmail.com>

Matthew, Alvaro,

thanks for your answers and your reactivity!

I understand that the "mandatory" feature definitely lacks flexibility to be
used for one-to-many communications and that there is no easy workaround.

The "non auto-delete, non exclusive queue" solution would not be suitable to
my case, I really need messages to be dropped, and the sender to be alerted.
The Smart Proxy approach is interesting, but doesn't seem compatible with
the use of the mandatory flag, and the return alerts associated.

I've managed - with 10 lines of erlang - to let queues have an additional
boolean "spy" parameter, and have the "spy" queues deliver the mandatory
messages without this counting as a correct delivery, from the router point
of view. Twisted, but it's working. (and it's much simpler than having "spy"
bindings, the routing and delivery being two separated mechanisms).

My modifications:

*rabbit.hrl :*
*(edition of the amqqueue record, line 47)*
*
*
     -record(amqqueue, {name, durable, auto_delete, exclusive_owner = none,
spy=false,
                   arguments, pid}).


*rabbit_amqqueue.erl :*
*
*
*(line 115, spec of deliver/2 edited )*

* -spec(deliver/2 :: (pid(), rabbit_types:delivery()) -> boolean()|spy).*

*
*
*(edition of rabbit_amqqueue:declare)*

declare(QueueName, Durable, AutoDelete, Args, Owner) ->
    ok = check_declare_arguments(QueueName, Args),
    Q = start_queue_process(#amqqueue{name = QueueName,
                                      durable = Durable,
                                      auto_delete = AutoDelete,
                                      arguments = Args,
                                      spy = case lists:keyfind(<<"spy">>, 1,
Args) of
                                             false -> false;
                                             _ -> true
                                      end,
                                      exclusive_owner = Owner,
                                      pid = none}),
    case gen_server2:call(Q#amqqueue.pid, {init, false}, infinity) of
        not_found -> rabbit_misc:not_found(QueueName);
        Q1        -> Q1
    end.


*(edition of rabbit_amqqueue:deliver/2)*
*
*
     deliver(QPid, Delivery = #delivery{immediate = true}) ->
          gen_server2:call(QPid, {deliver_immediately, Delivery}, infinity);
     deliver(QPid, Delivery = #delivery{mandatory = true}) ->
          case gen_server2:call(QPid, {deliver, Delivery}, infinity) of
               spy -> spy;
               _ -> true
          end;
     deliver(QPid, Delivery) ->
          gen_server2:cast(QPid, {deliver, Delivery}),
          true.


*rabbit_amqqueue_router.erl :*
*(edition of rabbit_router:fold_deliveries/2, line 105)*

     fold_deliveries({Pid, true},{_, Handled}) -> {true, [Pid|Handled]};
     fold_deliveries({_,  spy}, {false, Handled}) -> {false, Handled};
     fold_deliveries({_,  _},{_, Handled}) -> {true, Handled}.


For the moment, I think I'll go with this :)
Thanks again for your help.

Charly
*
*

On Thu, Mar 24, 2011 at 4:16 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> For spying messages on an RPC setup I'm working on an implementation of the
> Smart Proxy messaging pattern: http://www.eaipatterns.com/SmartProxy.htmlperhaps you could implement that too.
>
> This is what I've done so far: http://vimeo.com/20966661 which is at early
> stage of development and very alpha.
>
> Also take a look at the Wire Tap messaging pattern:
> http://www.eaipatterns.com/WireTap.html
>
> I guess most of the patterns from that book can be implemented with
> RabbitMQ, and some of them are already there but with different
> nomenclature.
>
> Hope this helps,
>
> Alvaro
>
> On Mar 24, 2011, at 4:05 PM, Matthew Sackman wrote:
>
> > Hi Charly,
> >
> > On Thu, Mar 24, 2011 at 03:35:35PM +0100, Charly Hamy wrote:
> >> For the req/res scenario, I'm using the mandatory flag on my messages,
> so
> >> that sending a request message to a disconnected component (no
> corresponding
> >> queue declared on the broker) returns an error to the sender. This works
> as
> >> expected.
> >
> > Well... you're using mandatory as a poor-man's form of resource
> > monitoring.
> >
> >> But now, I would want to plug new components to spy on those flows of
> >> requests and responses, without interfering with the ongoing
> >> communications... which is not by default compatible with my use of the
> >> mandatory flag : when a "spy" component is monitorng request/response
> >> messages, those messages end-up in its queue, then even if the actual
> target
> >> component for those messages is not present on the broker (no queue), no
> >> error is returned to the sender.
> >
> > Indeed, which is why mandatory is probably a mis-feature and should not
> > be used. Basically, AMQP does not really provide any sort of sane
> > resource monitoring. We've added in the 2.4.0 release consumer-death
> > notifications, but that's not going to help you here. You really have a
> > choice: make the queue non-exclusive and non-autodelete. Thus it always
> > stays there and will always receive messages. Then, you have your
> > clients just consume from it. The queue will do round-robining between
> > the consumers and all should be well, but you might have reasons why you
> > want the queue to be exclusive or autodelete. The other option is to use
> > some other tool to do monitoring of your consumers and to address that
> > problem outside of AMQP/RabbitMQ.
> >
> > Best wishes,
> >
> > Matthew
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/bcfcad29/attachment.htm>

From Paulo.Machado at ima-zlw-ifu.rwth-aachen.de  Fri Mar 25 14:17:09 2011
From: Paulo.Machado at ima-zlw-ifu.rwth-aachen.de (Machado, Paulo)
Date: Fri, 25 Mar 2011 14:17:09 +0000
Subject: [rabbitmq-discuss] AMQP 1.0 implementation release plans
Message-ID: <9FD4F7E95B9DF94392137E39DCA67E099FA810@zlw-ima-exchg01.win.zlw-ima.rwth-aachen.de>

Hello list,

I would like to know if there's already plans of releasing rabbitmq implementation of version 1.0 of amqp, since the specification recently reached the "recommendation" status.

thanks,
Paulo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/0147b41d/attachment.htm>

From fabiomargarido at gmail.com  Fri Mar 25 14:25:54 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Fri, 25 Mar 2011 11:25:54 -0300
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <4D8388F6.9000401@rabbitmq.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>
	<AANLkTiktSFY5fni+in+t0ZrfGhQCobk7u8Ras=vRpSJT@mail.gmail.com>
	<AANLkTi=sy+sDL0WtDZ4HVGT-pBagFx5E71hut_yH_r=B@mail.gmail.com>
	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>
	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>
	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>
	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>
	<4D6EE8B2.6030507@rabbitmq.com>
	<AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>
	<4D6F908E.2030209@rabbitmq.com>
	<AANLkTimo-XAOsd_paeJAbud=RpzertM8oEPDPLHdacO4@mail.gmail.com>
	<4D6FB9DC.2080800@rabbitmq.com>
	<AANLkTi=rLYV90KSv4b8e=AcKiiukP=yPVy4vXLTpbCbA@mail.gmail.com>
	<4D703B6C.6010608@rabbitmq.com>
	<AANLkTik=+kvtcQmaaB-BWuq9QWFpxqrp1oDey5dPzvtU@mail.gmail.com>
	<AANLkTik8M_Wr2O4+q_q33iEC2rxkrar6Zjsdy+p_7EfO@mail.gmail.com>
	<4D8388F6.9000401@rabbitmq.com>
Message-ID: <AANLkTi=zVkut1_JhGMvi_Tj0UBmLdX+1quZLy7bXnQvW@mail.gmail.com>

Hi Michael.

On Fri, Mar 18, 2011 at 13:31, Michael Bridgen <mikeb at rabbitmq.com> wrote:
>
> Right, at the minute the last values are transient. It probably wouldn't
> take much coding to make it save things to disk for durable exchanges.
>

OK, that figures... :) I know nothing of Erlang, but I'll take an overall
look and try to come up with an acceptable solution for my case. Would that
be a feature useful enough that you'd consider including in your code?

It will work with any queue. However, if you have many consumers to a queue,
> each message will be delivered to one consumer only -- that's the semantics
> of AMQP queues.  So, in your case, I think you want a queue for each
> consumer anyway.


Sorry for not being clearer, that's what I meant by 'exclusive' queues, not
the exclusive on AMQP terminology.
Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/fcb943fd/attachment-0001.htm>

From alexis at rabbitmq.com  Fri Mar 25 14:26:31 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 25 Mar 2011 14:26:31 +0000
Subject: [rabbitmq-discuss] AMQP 1.0 implementation release plans
In-Reply-To: <9FD4F7E95B9DF94392137E39DCA67E099FA810@zlw-ima-exchg01.win.zlw-ima.rwth-aachen.de>
References: <9FD4F7E95B9DF94392137E39DCA67E099FA810@zlw-ima-exchg01.win.zlw-ima.rwth-aachen.de>
Message-ID: <AANLkTimE_yXK+TY4u=ODH442+wwG072iReOH180Fion7@mail.gmail.com>

Paulo

1-0 is not GA yet - "recommended" just means "ready for prototyping".

Please see the 1-0 plugin in the RabbitMQ repo:
http://hg.rabbitmq.com/rabbitmq-amqp1.0/

Currently - as far as I know - only Rabbit has a 1-0 broker
capability.  However, there are several other prototypes around, some
of which are open source.

alexis


On Fri, Mar 25, 2011 at 2:17 PM, Machado, Paulo
<Paulo.Machado at ima-zlw-ifu.rwth-aachen.de> wrote:
> Hello list,
>
> I would like to know if there's already plans of releasing rabbitmq
> implementation of version 1.0 of amqp, since the specification recently
> reached the "recommendation" status.
>
> thanks,
> Paulo
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From mikeb at rabbitmq.com  Fri Mar 25 14:29:40 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Fri, 25 Mar 2011 14:29:40 +0000
Subject: [rabbitmq-discuss] AMQP 1.0 implementation release plans
In-Reply-To: <9FD4F7E95B9DF94392137E39DCA67E099FA810@zlw-ima-exchg01.win.zlw-ima.rwth-aachen.de>
References: <9FD4F7E95B9DF94392137E39DCA67E099FA810@zlw-ima-exchg01.win.zlw-ima.rwth-aachen.de>
Message-ID: <4D8CA6D4.3090303@rabbitmq.com>

> I would like to know if there's already plans of releasing rabbitmq
> implementation of version 1.0 of amqp, since the specification recently
> reached the "recommendation" status.

There are not only plans, there is an implementation of AMQP 1.0 for 
RabbitMQ: https://github.com/rabbitmq/rabbitmq-amqp1.0

However, the specification is not yet stable.  It is in fact being 
actively worked on.  See the top story at http://amqp.org/ for instance.

Regards,
Michael

From fabiomargarido at gmail.com  Fri Mar 25 14:30:07 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Fri, 25 Mar 2011 11:30:07 -0300
Subject: [rabbitmq-discuss] How to obtain local address used in a
	connection
In-Reply-To: <AANLkTikNLUB1_QNmPnr-Covyb6QxkHMQKszBffTHZ3bs@mail.gmail.com>
References: <AANLkTikNLUB1_QNmPnr-Covyb6QxkHMQKszBffTHZ3bs@mail.gmail.com>
Message-ID: <AANLkTikJ+p_On=uKYzZm3tUEgxAb6HLOj=vKzmuHMiMV@mail.gmail.com>

Sorry, I forgot: I'm using the Java client.

On Fri, Mar 25, 2011 at 11:29, Fabio Margarido <fabiomargarido at gmail.com>wrote:

> Hi there,
>
> is there a ready way to obtain (from the Connection object or some other
> means) which of the local machine's IP addresses was used to connect to the
> broker?
> Thanks in advance.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/0ac6145e/attachment.htm>

From fabiomargarido at gmail.com  Fri Mar 25 14:29:27 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Fri, 25 Mar 2011 11:29:27 -0300
Subject: [rabbitmq-discuss] How to obtain local address used in a connection
Message-ID: <AANLkTikNLUB1_QNmPnr-Covyb6QxkHMQKszBffTHZ3bs@mail.gmail.com>

Hi there,

is there a ready way to obtain (from the Connection object or some other
means) which of the local machine's IP addresses was used to connect to the
broker?
Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/c53da41b/attachment.htm>

From simon at rabbitmq.com  Fri Mar 25 14:37:41 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 25 Mar 2011 14:37:41 +0000
Subject: [rabbitmq-discuss] How to obtain local address used in
	a	connection
In-Reply-To: <AANLkTikJ+p_On=uKYzZm3tUEgxAb6HLOj=vKzmuHMiMV@mail.gmail.com>
References: <AANLkTikNLUB1_QNmPnr-Covyb6QxkHMQKszBffTHZ3bs@mail.gmail.com>
	<AANLkTikJ+p_On=uKYzZm3tUEgxAb6HLOj=vKzmuHMiMV@mail.gmail.com>
Message-ID: <4D8CA8B5.9030105@rabbitmq.com>

Something like (untested, top of my head):

Connection c = ...;
((SocketFrameHandler) ((AMQConnection) 
c).getFrameHandler())._socket.getLocalAddress();

Not sure if that counts as "ready"...

Cheers, Simon

On 25/03/11 14:30, Fabio Margarido wrote:
> Sorry, I forgot: I'm using the Java client.
>
> On Fri, Mar 25, 2011 at 11:29, Fabio Margarido <fabiomargarido at gmail.com
> <mailto:fabiomargarido at gmail.com>> wrote:
>
>     Hi there,
>
>     is there a ready way to obtain (from the Connection object or some
>     other means) which of the local machine's IP addresses was used to
>     connect to the broker?
>     Thanks in advance.
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From simon at rabbitmq.com  Fri Mar 25 14:40:01 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 25 Mar 2011 14:40:01 +0000
Subject: [rabbitmq-discuss] How to obtain local address used
	in	a	connection
In-Reply-To: <4D8CA8B5.9030105@rabbitmq.com>
References: <AANLkTikNLUB1_QNmPnr-Covyb6QxkHMQKszBffTHZ3bs@mail.gmail.com>	<AANLkTikJ+p_On=uKYzZm3tUEgxAb6HLOj=vKzmuHMiMV@mail.gmail.com>
	<4D8CA8B5.9030105@rabbitmq.com>
Message-ID: <4D8CA941.3090606@rabbitmq.com>

Or, look at the management plugin to get a server-wide view.

Cheers, Simon

On 25/03/11 14:37, Simon MacMullen wrote:
> Something like (untested, top of my head):
>
> Connection c = ...;
> ((SocketFrameHandler) ((AMQConnection)
> c).getFrameHandler())._socket.getLocalAddress();
>
> Not sure if that counts as "ready"...
>
> Cheers, Simon
>
> On 25/03/11 14:30, Fabio Margarido wrote:
>> Sorry, I forgot: I'm using the Java client.
>>
>> On Fri, Mar 25, 2011 at 11:29, Fabio Margarido <fabiomargarido at gmail.com
>> <mailto:fabiomargarido at gmail.com>> wrote:
>>
>> Hi there,
>>
>> is there a ready way to obtain (from the Connection object or some
>> other means) which of the local machine's IP addresses was used to
>> connect to the broker?
>> Thanks in advance.
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Fri Mar 25 14:58:43 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 25 Mar 2011 14:58:43 +0000
Subject: [rabbitmq-discuss] Spying on "mandatory" messages
In-Reply-To: <AANLkTimzFnXDWnUWpB2Ub246uOU61EYO-49RaWHBHhcH@mail.gmail.com>
References: <AANLkTi=jDe6rbg9AYLzXEkaWk186SeLC_uH1ovoK1ojq@mail.gmail.com>
	<20110324150517.GE29884@rabbitmq.com>
	<7494EE23-3862-42C1-B52D-50BEA0CCE52E@gmail.com>
	<AANLkTimzFnXDWnUWpB2Ub246uOU61EYO-49RaWHBHhcH@mail.gmail.com>
Message-ID: <20110325145842.GC24102@rabbitmq.com>

Charly,

This is most impressive! I have a few comments on the code though...

On Fri, Mar 25, 2011 at 03:15:03PM +0100, Charly Hamy wrote:
> *rabbit_amqqueue.erl :*
> *(line 115, spec of deliver/2 edited )*
> 
> * -spec(deliver/2 :: (pid(), rabbit_types:delivery()) -> boolean()|spy).*

Traditionally, atoms in specs should be quoted, so 'spy', not spy. This
has no bearing on much other than for consistency with the rest of the
code base (and perhaps syntax highlighting too).

> declare(QueueName, Durable, AutoDelete, Args, Owner) ->
>     ok = check_declare_arguments(QueueName, Args),
>     Q = start_queue_process(#amqqueue{name = QueueName,
>                                       durable = Durable,
>                                       auto_delete = AutoDelete,
>                                       arguments = Args,
>                                       spy = case lists:keyfind(<<"spy">>, 1,
> Args) of
>                                              false -> false;
>                                              _ -> true
>                                       end,
>                                       exclusive_owner = Owner,
>                                       pid = none}),

I'd probably bring that out to a Spy variable. Also, take a look at
rabbit_misc:table_lookup/2. Also, you might want to delay that
inspection until you're in amqqueue_process:delay - though
unfortunately, because it needs to be in the mnesia record, you'll have
to do it before the call to amqqueue:internal_declare, rather than as
part of process_args. It probably doesn't make too much difference
either way...

> *(edition of rabbit_amqqueue:deliver/2)*
> *
> *
>      deliver(QPid, Delivery = #delivery{immediate = true}) ->
>           gen_server2:call(QPid, {deliver_immediately, Delivery}, infinity);
>      deliver(QPid, Delivery = #delivery{mandatory = true}) ->
>           case gen_server2:call(QPid, {deliver, Delivery}, infinity) of
>                spy -> spy;
>                _ -> true

Purely cosmetic: we'd vertically align the -> arrows there.

I would imagine you're missing a diff here: surely the handle_call in
amqqueue_process for the mandatory delivery that should be returning
true|spy?

> *rabbit_amqqueue_router.erl :*
> *(edition of rabbit_router:fold_deliveries/2, line 105)*
> 
>      fold_deliveries({Pid, true},{_, Handled}) -> {true, [Pid|Handled]};
>      fold_deliveries({_,  spy}, {false, Handled}) -> {false, Handled};
>      fold_deliveries({_,  _},{_, Handled}) -> {true, Handled}.

Neat: so a response of spy causes the delivery to that queue to be
ignored from the pov of mandatory.

This is very impressive for a first hack on Rabbit.

Matthew

From matthew at rabbitmq.com  Fri Mar 25 15:04:38 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 25 Mar 2011 15:04:38 +0000
Subject: [rabbitmq-discuss] Spying on "mandatory" messages
In-Reply-To: <20110325145842.GC24102@rabbitmq.com>
References: <AANLkTi=jDe6rbg9AYLzXEkaWk186SeLC_uH1ovoK1ojq@mail.gmail.com>
	<20110324150517.GE29884@rabbitmq.com>
	<7494EE23-3862-42C1-B52D-50BEA0CCE52E@gmail.com>
	<AANLkTimzFnXDWnUWpB2Ub246uOU61EYO-49RaWHBHhcH@mail.gmail.com>
	<20110325145842.GC24102@rabbitmq.com>
Message-ID: <20110325150437.GE24102@rabbitmq.com>

On Fri, Mar 25, 2011 at 02:58:43PM +0000, Matthew Sackman wrote:
> I'd probably bring that out to a Spy variable. Also, take a look at
> rabbit_misc:table_lookup/2. Also, you might want to delay that
> inspection until you're in amqqueue_process:delay

Erm, I meant amqqueue_process:declare there. Fingers don't work...

Matthew

From fabiomargarido at gmail.com  Fri Mar 25 15:59:11 2011
From: fabiomargarido at gmail.com (Fabio Margarido)
Date: Fri, 25 Mar 2011 12:59:11 -0300
Subject: [rabbitmq-discuss] How to obtain local address used in a
	connection
In-Reply-To: <4D8CA8B5.9030105@rabbitmq.com>
References: <AANLkTikNLUB1_QNmPnr-Covyb6QxkHMQKszBffTHZ3bs@mail.gmail.com>
	<AANLkTikJ+p_On=uKYzZm3tUEgxAb6HLOj=vKzmuHMiMV@mail.gmail.com>
	<4D8CA8B5.9030105@rabbitmq.com>
Message-ID: <AANLkTikM93Xr5Vd=nkTMh9S76bKg-h3DUaV+XmopdoHq@mail.gmail.com>

On Fri, Mar 25, 2011 at 11:37, Simon MacMullen <simon at rabbitmq.com> wrote:
>
> Connection c = ...;
> ((SocketFrameHandler) ((AMQConnection)
> c).getFrameHandler())._socket.getLocalAddress();
>
> Not sure if that counts as "ready"...
>

Ready enough for me, as long as it's safe. :)
I've done a quick test, seems to work as intended.
Thank you very much.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/1056e316/attachment.htm>

From james at 2600hz.com  Fri Mar 25 15:51:11 2011
From: james at 2600hz.com (James Aimonetti)
Date: Fri, 25 Mar 2011 08:51:11 -0700
Subject: [rabbitmq-discuss] Managing channels,
	esp wrt short lived publishers/consumers
In-Reply-To: <AANLkTim_QNZpjAr_33Jsn4vwZGyVeAsG4PcOjNuuF7z4@mail.gmail.com>
References: <4D83A9ED.80607@gmail.com>
	<AANLkTim_QNZpjAr_33Jsn4vwZGyVeAsG4PcOjNuuF7z4@mail.gmail.com>
Message-ID: <4D8CB9EF.5040000@2600hz.com>

Marek,

Thanks for the feedback. I was uncertain about the role channels played; 
nice to have some clarification. I've been busy implementing the pool of 
channels and have been encouraged by initial tests.

Looking forward to the RabbitMQ talk at the Erlang Factory today.

James


On 03/25/2011 07:14 AM, Marek Majkowski wrote:
> James,
>
> On Fri, Mar 18, 2011 at 18:52, James Aimonetti
> <james.aimonetti at gmail.com>  wrote:
>> I'm trying to figure out the best way to manage channel creation in my app.
>> Currently, any process that needs to publish or consume gets a channel and I
>> realize it is probably horribly inefficient, but as a prototype I wasn't too
>> concerned. Now that we're moving forward, I want to get this cleaned up
>> before I get too much further along.
>>
>> I have a setup something like:
>>
>> [App, App, App]<--->  [AMQP]<-->  Engine<-->  Client
>>
>> So a client makes a request to the Engine, which creates two processes, one
>> to publish events from the client, and one to consume commands from the Apps
>> and relay them to the client.
>>
>> [App, App, App]<-->  [AMQP]<-- ReqEvts<-- Client
>> [App, App, App]<-->  [AMQP] -->  ReqCtl -->  Client
>>
>> Ideally we'll be handling several hundreds of requests per second from
>> clients. So the ReqEvts process pumps 10 or so messages in rapid succession
>> at the beginning of a request, heartbeats every 20 or so seconds, then pumps
>> another 10 or so messages at the end of the request. Requests may last 1
>> second (so setup and tear down bursts happen almost on top of each other) or
>> may last minutes or hours. Meanwhile, the ReqCtl receives commands from a
>> targeted exchange from the Apps to relay to the Client.
>>
>> Each App has a queue that it binds to a targeted exchange and one or more
>> topic exchanges. In general it receives most messages off the topic
>> exchanges and publishes to the targeted exchange.
>>
>> So, hopefully that gives a broad overview. The Apps and the Engine pieces
>> are all on different servers.
>>
>> So right now each server has an instance of rabbitmq running, and is
>> clustered to all the other servers (Apps and Engine, currently four total
>> servers but expandable). What I'm not sure about is how to manage each
>> server's connection and channels. Each server has a gen_server managing the
>> connection to rabbit, as well as the channels. So when a pid requests to
>> publish or consume or declare a queue, the gen_server checks if the pid is
>> known and uses that channel, or creates a new channel and stores the
>> association. With all of these potentially short-lived consumers and
>> publishers, I see a LOT of channel creation/destruction going on and wonder
>> if there's a better way? Should I not have hidden channels behind a
>> gen_server?
> Having a pool of channels is quite a common practice.
>
>> My initial thought is to have a dedicated channel for all publishers on the
>> server to send over, a dedicated channel for any queue declarations, and a
>> channel for each process that is consuming from a queue. Am I serializing
>> too much with this setup?
> That should be fine. Some people use a single channel for all the stuff.
>
> Channel is a weird abstraction, it's mainly responsible for:
>   - scoping errors (ie: channel is closed on error)
>   - message ordering (messages sent through a channel will be delivered in order)
>   - also, some resources may be associated with channel,
>     and its state may change when the channel is closed (autodelete queues,
>     unacknowledged messages)
>   - parallelization of synchronous actions (like queue.declare)
>
> Basically, if you don't need this features, you can just use a single channel.
> In other case you must use multiple channels, but managing the lifetime
> of a channel is your decision.
>
> For example you may want to destroy channels often to
> isolate errors (ie: if one channel fails for some reason, you
> want it to affect only a single 'request' in your app)
>
> In your case, it looks like you only need the 'parallelization' feature,
> so using a pool of channels should do.
>
> Cheers,
>    Marek


-- 
James Aimonetti
Distributed Systems Engineer / DJ MC_

2600hz | http://2600hz.com
sip:james at 2600hz.com
tel: 415.886.7905


From namakh at gmail.com  Fri Mar 25 17:26:44 2011
From: namakh at gmail.com (Andy Namakhis)
Date: Fri, 25 Mar 2011 13:26:44 -0400
Subject: [rabbitmq-discuss] Status of rabbitmq-jsonrpc and
	rabbitmq-jsonrpc-channel plugins
Message-ID: <AANLkTi=ahfYwyYkE_7pD-MT=ggx-bJbZeQ0ucRqgY+=B@mail.gmail.com>

Hi,

I was informed by a source that the rabbitmq-jsonrpc and
rabbitmq-jsonrpc-channel plugins were being deprecated and would no linger
be supported. However, I am unable to find any reference whatsoever to this
assertion online and/or in any documentation. Are these plugins maintained
and will continue to be maintained?

Thanks,
Andy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/e59f34b8/attachment.htm>

From shomron at gmail.com  Fri Mar 25 17:32:51 2011
From: shomron at gmail.com (Oren Shomron)
Date: Fri, 25 Mar 2011 10:32:51 -0700 (PDT)
Subject: [rabbitmq-discuss] "local queue" ...."remote queue"
In-Reply-To: <AANLkTi=VRXJ4yNQriuU5SceNw-v9ZFcOuFxCaAcZiW6V@mail.gmail.com>
Message-ID: <31749068.494.1301074371354.JavaMail.geo-discussion-forums@yqdn5>

I have the exact same issue - I need 100% reliable message delivery, and I'm 
not interested in coding my own local persistent message queue for the cases 
when Rabbit is unavailable. There's a lot of extra complexity involved, and 
I'm surprised the framework doesn't handle this as it seems it would be 
relevant in many-a-project.

   - Oren
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/966a1b93/attachment.htm>

From charly.hamy at gmail.com  Fri Mar 25 17:36:53 2011
From: charly.hamy at gmail.com (Charly Hamy)
Date: Fri, 25 Mar 2011 18:36:53 +0100
Subject: [rabbitmq-discuss] Spying on "mandatory" messages
In-Reply-To: <20110325150437.GE24102@rabbitmq.com>
References: <AANLkTi=jDe6rbg9AYLzXEkaWk186SeLC_uH1ovoK1ojq@mail.gmail.com>
	<20110324150517.GE29884@rabbitmq.com>
	<7494EE23-3862-42C1-B52D-50BEA0CCE52E@gmail.com>
	<AANLkTimzFnXDWnUWpB2Ub246uOU61EYO-49RaWHBHhcH@mail.gmail.com>
	<20110325145842.GC24102@rabbitmq.com>
	<20110325150437.GE24102@rabbitmq.com>
Message-ID: <AANLkTindHyKmuBkvVR2t9uCs8wginUjSdaS8E+a152d=@mail.gmail.com>

Matthew,


> This is very impressive for a first hack on Rabbit.
Thanks, I'm flattered! :)
I tried to follow your comments to improve the code...


> I would imagine you're missing a diff here: surely the handle_call in
> amqqueue_process for the mandatory delivery that should be returning
> true|spy?

You're right! I forgot to post that piece, here to everything's not working
that well...


My final list of changes :

*
rabbit.hrl :
(edition of the amqqueue record, line 47)

     -record(amqqueue, {name, durable, auto_delete, exclusive_owner = none,
spy=false,
                   arguments, pid}).


rabbit_amqqueue.erl :

(line 115, spec of deliver/2 edited )

 -spec(deliver/2 :: (pid(), rabbit_types:delivery()) -> boolean()|'spy').


(edition of rabbit_amqqueue:deliver/2)

     deliver(QPid, Delivery = #delivery{immediate = true}) ->
          gen_server2:call(QPid, {deliver_immediately, Delivery}, infinity);
     deliver(QPid, Delivery = #delivery{mandatory = true}) ->
          case gen_server2:call(QPid, {deliver, Delivery}, infinity) of
               spy -> spy;
               _ -> true
          end;
     deliver(QPid, Delivery) ->
          gen_server2:cast(QPid, {deliver, Delivery}),
          true.

rabbit_amqqueue_process.erl :

(edition of rabbit_amqqueue_process:declare/3)

declare(Recover, From,
            State = #q{q
 = Qparam = #amqqueue{
name = QName,
durable = IsDurable,
arguments = Args
},
            backing_queue = BQ,
backing_queue_state = undefined,
            stats_timer = StatsTimer
}) ->
    Spy = case rabbit_misc:table_lookup(Args, <<"spy">>) of
{'bool', true} -> true;
             _ -> false
    end,
    Q = Qparam#amqqueue{ spy = Spy},
    case rabbit_amqqueue:internal_declare(Q, Recover) of
        not_found -> {stop, normal, not_found, State};
        Q         -> gen_server2:reply(From, {new, Q}),
                     ok = file_handle_cache:register_callback(
                            rabbit_amqqueue, set_maximum_since_use,
                            [self()]),
                     ok = rabbit_memory_monitor:register(
                            self(), {rabbit_amqqueue,
                                     set_ram_duration_target, [self()]}),
                     BQS = bq_init(BQ, QName, IsDurable, Recover),
                     State1 = process_args(State#q{backing_queue_state =
BQS, q=Q}),
                     rabbit_event:notify(queue_created,
                                         infos(?CREATION_EVENT_KEYS,
State1)),
                     rabbit_event:if_enabled(StatsTimer,
                                             fun() -> emit_stats(State1)
end),
                     noreply(State1);
        Q1        -> {stop, normal, {existing, Q1}, State}
    end.


( edition of rabbit_amqqueue_procces:handle_call({deliver, _} ..., line 846
)

handle_call({deliver, Delivery}, From, State) ->
    %% Synchronous, "mandatory" delivery mode. Reply asap.
    case (State#q.q)#amqqueue.spy of
true  -> gen_server2:reply(From, spy);
false -> gen_server2:reply(From, true)
    end,
    noreply(deliver_or_enqueue(Delivery, State));


rabbit_amqqueue_router.erl :
(edition of rabbit_router:fold_deliveries/2, line 105)

     fold_deliveries({Pid, true},{_, Handled}) -> {true, [Pid|Handled]};
     fold_deliveries({_,  spy}, {false, Handled}) -> {false, Handled};
     fold_deliveries({_,  _},{_, Handled}) -> {true, Handled}.

*

I encountered no problem for the moment, testing that feature with the java
API.


On Fri, Mar 25, 2011 at 4:04 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Fri, Mar 25, 2011 at 02:58:43PM +0000, Matthew Sackman wrote:
> > I'd probably bring that out to a Spy variable. Also, take a look at
> > rabbit_misc:table_lookup/2. Also, you might want to delay that
> > inspection until you're in amqqueue_process:delay
>
> Erm, I meant amqqueue_process:declare there. Fingers don't work...
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/1c04f739/attachment-0001.htm>

From alexis at rabbitmq.com  Fri Mar 25 18:15:15 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 25 Mar 2011 18:15:15 +0000
Subject: [rabbitmq-discuss] Status of rabbitmq-jsonrpc and
 rabbitmq-jsonrpc-channel plugins
In-Reply-To: <AANLkTi=ahfYwyYkE_7pD-MT=ggx-bJbZeQ0ucRqgY+=B@mail.gmail.com>
References: <AANLkTi=ahfYwyYkE_7pD-MT=ggx-bJbZeQ0ucRqgY+=B@mail.gmail.com>
Message-ID: <AANLkTimxaEKYCTU=3KeYxwnJxnt_P6ifXSggd_Nxk9xN@mail.gmail.com>

Andy

Someone else will provide details but: we aim to provide something better!

Alexis


On 25/03/2011, Andy Namakhis <namakh at gmail.com> wrote:
> Hi,
>
> I was informed by a source that the rabbitmq-jsonrpc and
> rabbitmq-jsonrpc-channel plugins were being deprecated and would no linger
> be supported. However, I am unable to find any reference whatsoever to this
> assertion online and/or in any documentation. Are these plugins maintained
> and will continue to be maintained?
>
> Thanks,
> Andy
>

-- 
Sent from my mobile device

From simon at rabbitmq.com  Fri Mar 25 18:31:16 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 25 Mar 2011 18:31:16 +0000
Subject: [rabbitmq-discuss] Status of rabbitmq-jsonrpc and
 rabbitmq-jsonrpc-channel plugins
In-Reply-To: <AANLkTimxaEKYCTU=3KeYxwnJxnt_P6ifXSggd_Nxk9xN@mail.gmail.com>
References: <AANLkTi=ahfYwyYkE_7pD-MT=ggx-bJbZeQ0ucRqgY+=B@mail.gmail.com>
	<AANLkTimxaEKYCTU=3KeYxwnJxnt_P6ifXSggd_Nxk9xN@mail.gmail.com>
Message-ID: <4D8CDF74.8010501@rabbitmq.com>

On 25/03/11 18:15, Alexis Richardson wrote:
> Someone else will provide details but: we aim to provide something better!

But at the moment it's not really costing us much if anything to keep it 
alive. So while it's unlikely to change much, we'll probably keep it 
around for quite a while.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From shomron at gmail.com  Fri Mar 25 18:46:02 2011
From: shomron at gmail.com (Oren Shomron)
Date: Fri, 25 Mar 2011 11:46:02 -0700 (PDT)
Subject: [rabbitmq-discuss] "local queue" ...."remote queue"
In-Reply-To: <AANLkTimDJQX_U9dLO3snz2DdwS_mSYqQ=TQ-e0pH=m3P@mail.gmail.com>
Message-ID: <7883725.104.1301078762092.JavaMail.geo-discussion-forums@yqhu20>

RabbitMQ offers persistent messaging over durable exchanges - * if you can 
get your message published in the first place *

The issue is what a publisher should do with a message when he is unable for 
whatever reason to reach the broker.

I feel that this is not a problem that should be dealt with on the 
application layer, but rather through the messaging infrastructure.

  -  Oren

On Friday, March 25, 2011 1:37:30 PM UTC-4, momania wrote:
>
> Rabbitmq offers persistent messaging over durable exchanges and
> queues, so I don't see where you are missing anything :-)
>
> On Fri, Mar 25, 2011 at 6:32 PM, Oren Shomron <sho... at gmail.com> wrote:
> > I have the exact same issue - I need 100% reliable message delivery, and 
> I'm
> > not interested in coding my own local persistent message queue for the 
> cases
> > when Rabbit is unavailable. There's a lot of extra complexity involved, 
> and
> > I'm surprised the framework doesn't handle this as it seems it would be
> > relevant in many-a-project.
> >    - Oren
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq... at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/4f2763af/attachment.htm>

From oyvind at tjervaag.com  Fri Mar 25 18:55:40 2011
From: oyvind at tjervaag.com (=?iso-8859-1?Q?=D8yvind_Tjervaag?=)
Date: Fri, 25 Mar 2011 19:55:40 +0100
Subject: [rabbitmq-discuss] MSMQ Integration
In-Reply-To: <AANLkTi=jQ4-eXA6vd26sBHgEGE=7Jk8Ko4dxX2TjxBFR@mail.gmail.com>
References: <7809d0f9-9a9c-4f7c-8685-55539ba2c9c0@r4g2000prm.googlegroups.com>
	<AANLkTikh9ViF47u5j-uLw_3jSfNu5UjZ8+gVSNRY=Vid@mail.gmail.com>
	<AANLkTi=jQ4-eXA6vd26sBHgEGE=7Jk8Ko4dxX2TjxBFR@mail.gmail.com>
Message-ID: <37FB6908-9BA7-4988-B672-C9781858F365@tjervaag.com>

Hi! Catching up on old mail... 

I've written a "shovel" windows service that moves messages between IBM Websphere MQ and RabbitMQ. Can't share the whole project, but IBMs .NET libs are fairly easy to work with after some head-scrathing..

It's implemented as simple as:

while (1) {
  msg = read_from_rabbit();
  put_to_WS(msg);
  rabbit_ack(msg);
}

.. in _very_ simplified terms...

So sorry for not sharing proper code, but I'd be happy to help on any specific issues :)

/?yvind

On Mar 9, 2011, at 3:03 PM, Whit Armstrong wrote:

> Has anyone done the same for IBM MQ?
> 
> Thanks,
> Whit
> 
> 
> On Wed, Mar 9, 2011 at 8:38 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>> 
>> 
>> Maybe.
>> 
>> Have a look here - http://www.rabbitmq.com/devtools.html#dotnet-dev
>> 
>> At worst you could write a stateless custom relay from our .NET code
>> and Microsoft's...
>> 
>> alexis

From endy.kalu at gmail.com  Fri Mar 25 19:13:17 2011
From: endy.kalu at gmail.com (endy kalu)
Date: Fri, 25 Mar 2011 15:13:17 -0400
Subject: [rabbitmq-discuss] Use Case for RabbitMQ
Message-ID: <AANLkTikvJw5R7ZLHT=p3niWnFcstL+0H4yasnOjy8W12@mail.gmail.com>

I am new to RabbitMQ and Messaging in general. I am building an inventory
management system and exploring using a messaging system to maintain up to
date inventory quantities across several geographical locations. There will
be internet service in these locations but speed is really an issue.
My questions are:
1) Is RabbitMQ or messaging suitable for this.  I like the fact that it can
push out data and queued till consumed.
2) I am .Net and wondering if RabbitMQ can be "embedded" and distributed
with my application.
3) If using RabbitMQ, I am a bit unsure of the architecture. I have pondered
having RabbitMQ running in all the locations as it seems it's the only way
to have all server push and receive data.
4) I am new to this. I just want to know that this use case is suitable for
MQ.

I'll really appreciate your thoughts or any direction you can point me.


Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110325/71dce287/attachment.htm>

From oj at buffered.io  Fri Mar 25 20:35:43 2011
From: oj at buffered.io (OJ Reeves)
Date: Sat, 26 Mar 2011 06:35:43 +1000
Subject: [rabbitmq-discuss] Fault-tolerant subscriptions using the .NET
	client
In-Reply-To: <gloz7ig9l7c8fgroaxjezwJv4X.penango@mail.gmail.com>
References: <gloz7ig9l7c8fgroaxjezwJv4X.penango@mail.gmail.com>
Message-ID: <glpkmc5gris3y5phdhjezwJv4X.penango@mail.gmail.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110326/beb77b91/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Verify This Message with Penango.p7s
Type: application/pkcs7-signature
Size: 3530 bytes
Desc: S/MIME Cryptographic Signature
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110326/beb77b91/attachment-0001.bin>

From max.bridgewater at gmail.com  Sat Mar 26 00:38:33 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Fri, 25 Mar 2011 20:38:33 -0400
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-http
In-Reply-To: <4D8C80B1.8090401@rabbitmq.com>
References: <4D8C80B1.8090401@rabbitmq.com>
Message-ID: <AANLkTikBZN0BuSL4hDkx-fSHDPXgSMB15W7TDqL74gcz@mail.gmail.com>

Hi Simon,

Thanks you for this plugin. It opens some few more doors. Is there by
any chance a quick hack that would allow transforming it into
something that would make authentication via RabbitMQ-RPC instead of
HTTP? That is, instead of sending the request to a HTTP server, a
message is sent to a specific exchange. I could then bind this
exchange to a queue where my authentication component would be
listening.

Thanks,
Max.

On Fri, Mar 25, 2011 at 7:46 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> Hi all. I got a bit bored yesterday, so I wrote a plugin. It lets you
> authenticate / authorise RabbitMQ users by making requests to a web server
> rather than using the internal database. It comes with a simple Django-based
> example.
>
> https://github.com/simonmacmullen/rabbitmq-auth-backend-http
>
> Let me know if anyone finds this useful.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From max.bridgewater at gmail.com  Sat Mar 26 05:53:15 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Sat, 26 Mar 2011 01:53:15 -0400
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-http
In-Reply-To: <4D8C80B1.8090401@rabbitmq.com>
References: <4D8C80B1.8090401@rabbitmq.com>
Message-ID: <AANLkTikdA=7AvgLRZWLRj1ZRedkCc-e2Qh+UdSqqXHLe@mail.gmail.com>

Hi,

I built the plugin and tried it with the following configuration:

[
{rabbit, [{auth_backends, [rabbit_auth_backend_http]}, {cluster_nodes,
[rabbit at mqt,rabbit_1 at mqt,rabbit_2 at mqt]}]},
{rabbit_auth_backend_http,
   [{user_path,     "http://127.0.0.1:8080/uac"},
    {vhost_path,    "http://127.0.0.1:8080/uac"},
    {resource_path, "http://127.0.0.1:8080/uac"}]}
].

The logs say that the plugin was started successfully. The HTTP server
is build to send "allow" for all requests. Right now, however, no
request is being sent to my web server.
Any idea?

Max.




On Fri, Mar 25, 2011 at 7:46 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> Hi all. I got a bit bored yesterday, so I wrote a plugin. It lets you
> authenticate / authorise RabbitMQ users by making requests to a web server
> rather than using the internal database. It comes with a simple Django-based
> example.
>
> https://github.com/simonmacmullen/rabbitmq-auth-backend-http
>
> Let me know if anyone finds this useful.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> Staff Engineer, RabbitMQ
> SpringSource, a division of VMware
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Sat Mar 26 13:00:49 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sat, 26 Mar 2011 13:00:49 +0000
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-http
In-Reply-To: <AANLkTikBZN0BuSL4hDkx-fSHDPXgSMB15W7TDqL74gcz@mail.gmail.com>
References: <4D8C80B1.8090401@rabbitmq.com>
	<AANLkTikBZN0BuSL4hDkx-fSHDPXgSMB15W7TDqL74gcz@mail.gmail.com>
Message-ID: <4D8DE381.3000606@rabbitmq.com>

On 26/03/2011 12:38AM, Max Bridgewater wrote:
> Thanks you for this plugin. It opens some few more doors.

Thanks!

> Is there by
> any chance a quick hack that would allow transforming it into
> something that would make authentication via RabbitMQ-RPC instead of
> HTTP?

I would view that as a sufficiently different thing to be a different 
plugin, but it's one that I will probably get around to writing at some 
point fairly soon.

On 26/03/2011 5:53AM, Max Bridgewater wrote:
 > I built the plugin and tried it with the following configuration:

Hmm, the link to the binary plugin on github should really be more 
prominent.

 > [
 > {rabbit, [{auth_backends, [rabbit_auth_backend_http]}, {cluster_nodes,
 > [rabbit at mqt,rabbit_1 at mqt,rabbit_2 at mqt]}]},
 > {rabbit_auth_backend_http,
 >     [{user_path,     "http://127.0.0.1:8080/uac"},
 >      {vhost_path,    "http://127.0.0.1:8080/uac"},
 >      {resource_path, "http://127.0.0.1:8080/uac"}]}
 > ].
 >
 > The logs say that the plugin was started successfully. The HTTP server
 > is build to send "allow" for all requests. Right now, however, no
 > request is being sent to my web server.
 > Any idea?

Hmm, that's odd. Do any failure-looking things turn up in the logs?

Ah, I just thought: nowhere in the documentation do I mention that this 
requires at least 2.3.1. You're not using it with an older server are you?

Cheers, Simon

From max.bridgewater at gmail.com  Sat Mar 26 13:04:09 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Sat, 26 Mar 2011 09:04:09 -0400
Subject: [rabbitmq-discuss] rabbitmq-auth-backend-http
In-Reply-To: <4D8DE381.3000606@rabbitmq.com>
References: <4D8C80B1.8090401@rabbitmq.com>
	<AANLkTikBZN0BuSL4hDkx-fSHDPXgSMB15W7TDqL74gcz@mail.gmail.com>
	<4D8DE381.3000606@rabbitmq.com>
Message-ID: <AANLkTimOsxFK1aiKSSKdP+PpK4DZGLWTZaqp+BtNKAWg@mail.gmail.com>

Yes, I'm using 2.3.1. The surprising thing is that I can't see any
error message anywhere besides the authentication failure on the
client side.

On Sat, Mar 26, 2011 at 9:00 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 26/03/2011 12:38AM, Max Bridgewater wrote:
>>
>> Thanks you for this plugin. It opens some few more doors.
>
> Thanks!
>
>> Is there by
>> any chance a quick hack that would allow transforming it into
>> something that would make authentication via RabbitMQ-RPC instead of
>> HTTP?
>
> I would view that as a sufficiently different thing to be a different
> plugin, but it's one that I will probably get around to writing at some
> point fairly soon.
>
> On 26/03/2011 5:53AM, Max Bridgewater wrote:
>> I built the plugin and tried it with the following configuration:
>
> Hmm, the link to the binary plugin on github should really be more
> prominent.
>
>> [
>> {rabbit, [{auth_backends, [rabbit_auth_backend_http]}, {cluster_nodes,
>> [rabbit at mqt,rabbit_1 at mqt,rabbit_2 at mqt]}]},
>> {rabbit_auth_backend_http,
>> ? ? [{user_path, ? ? "http://127.0.0.1:8080/uac"},
>> ? ? ?{vhost_path, ? ?"http://127.0.0.1:8080/uac"},
>> ? ? ?{resource_path, "http://127.0.0.1:8080/uac"}]}
>> ].
>>
>> The logs say that the plugin was started successfully. The HTTP server
>> is build to send "allow" for all requests. Right now, however, no
>> request is being sent to my web server.
>> Any idea?
>
> Hmm, that's odd. Do any failure-looking things turn up in the logs?
>
> Ah, I just thought: nowhere in the documentation do I mention that this
> requires at least 2.3.1. You're not using it with an older server are you?
>
> Cheers, Simon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From max.bridgewater at gmail.com  Sun Mar 27 02:04:27 2011
From: max.bridgewater at gmail.com (Max Bridgewater)
Date: Sat, 26 Mar 2011 21:04:27 -0400
Subject: [rabbitmq-discuss] Virtual Hosts in the HTTP Auth Plugin
Message-ID: <AANLkTimD_DcMQpeyvMeLVh0=ofyBQtHJ54m-ECNGUS0n@mail.gmail.com>

Hi Simon,

I got the HTTP auth plugin working now.  I feel, however, that there
is a bit of inconsistency in the way it works. To authenticate a user
X with password Y in virtual host Z, it requires that Z be created
using rabbitmqctl while it does not require the same for the user. The
user is indeed authenticated against the HTTP server but only if the
embedded authentication mechanism knows of the virtual host. I was
under the impression that vhosts are only used for message scoping and
access control and therefore, their management could also be
delegated.

Your thought?

At the bare minimum, maybe it would be worth mentioning to the plugin
users that vhosts would need to be created in the traditional way.
Cheers,
Max.

From advaitalai at gmail.com  Sun Mar 27 06:31:53 2011
From: advaitalai at gmail.com (Advait Alai)
Date: Sun, 27 Mar 2011 11:01:53 +0530
Subject: [rabbitmq-discuss] Cluster size limit
Message-ID: <AANLkTikfZAKPcOyJpHR_pXBLXdHuFTUqw_BAQetQkaG5@mail.gmail.com>

Hi,

I'm trying to add 150 nodes to a RabbitMQ cluster. After around 50 nodes,
the stop-reset-cluster-start iteration starts giving the error:

Stopping node rabbit at node130 ...
...done.
Resetting node rabbit at node130 ...
...done.
Clustering node rabbit at node130 with [rabbit at node117] ...
...done.
Starting node rabbit at node130 ...
Error: {cannot_start_application,rabbit,
           {bad_return,
               {{rabbit,start,[normal,[]]},
                {'EXIT',{rabbit,failure_during_boot}}}}}

Note that I am sequentially adding nodes to build a cluster (as an
initialization step) before creating any queues/exchanges or running any
amqp script.

How do I solve this problem? Is it because RabbitMQ imposes a hard cluster
size limit?

Also, does RabbitMQ scale well to around 1000 nodes?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110327/08073fb1/attachment.htm>

From jerryk at vmware.com  Sun Mar 27 17:08:42 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Sun, 27 Mar 2011 09:08:42 -0700
Subject: [rabbitmq-discuss] Cluster size limit
In-Reply-To: <AANLkTikfZAKPcOyJpHR_pXBLXdHuFTUqw_BAQetQkaG5@mail.gmail.com>
References: <AANLkTikfZAKPcOyJpHR_pXBLXdHuFTUqw_BAQetQkaG5@mail.gmail.com>
Message-ID: <6AC7EB36-058C-494F-9A98-AC7865577774@vmware.com>

150 is a pretty big sounding cluster...  Out of curiosity, what's motivating you to go so big (if you don't mind saying)?

On that note, because RabbitMQ clustering is based on Erlang distribution, the current practical limit you'll probably run up against is somewhat lower than the 150 you have in mind.  Something more like 32 to 64.   

If you can say more about your goals it's likely that someone on the Rabbit team can suggest something helpful.

Jerry

Sent from my iPad.

On Mar 26, 2011, at 10:32 PM, "Advait Alai" <advaitalai at gmail.com> wrote:

> Hi,
> 
> I'm trying to add 150 nodes to a RabbitMQ cluster. After around 50 nodes, the stop-reset-cluster-start iteration starts giving the error:
> 
> Stopping node rabbit at node130 ...
> ...done.
> Resetting node rabbit at node130 ...
> ...done.
> Clustering node rabbit at node130 with [rabbit at node117] ...
> ...done.
> Starting node rabbit at node130 ...
> Error: {cannot_start_application,rabbit,
>            {bad_return,
>                {{rabbit,start,[normal,[]]},
>                 {'EXIT',{rabbit,failure_during_boot}}}}}
> 
> Note that I am sequentially adding nodes to build a cluster (as an initialization step) before creating any queues/exchanges or running any amqp script.
> 
> How do I solve this problem? Is it because RabbitMQ imposes a hard cluster size limit?
> 
> Also, does RabbitMQ scale well to around 1000 nodes?
> 
> Thanks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From stammailbox at gmail.com  Sun Mar 27 17:32:54 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Sun, 27 Mar 2011 18:32:54 +0200
Subject: [rabbitmq-discuss] How to define a timeout on jsonRpcClient calls
Message-ID: <AANLkTi=6QfUjMXiKeMz7d9mTqUC71RXWhUg7jXQKn46b@mail.gmail.com>

How do I define a timeout for procedures using  jsonRpcClient calls
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110327/ea08237b/attachment.htm>

From advaitalai at gmail.com  Sun Mar 27 19:11:03 2011
From: advaitalai at gmail.com (Advait Alai)
Date: Sun, 27 Mar 2011 23:41:03 +0530
Subject: [rabbitmq-discuss] Cluster size limit
In-Reply-To: <6AC7EB36-058C-494F-9A98-AC7865577774@vmware.com>
References: <AANLkTikfZAKPcOyJpHR_pXBLXdHuFTUqw_BAQetQkaG5@mail.gmail.com>
	<6AC7EB36-058C-494F-9A98-AC7865577774@vmware.com>
Message-ID: <AANLkTimpAATqF_1xB7-1hjb_KGodHOP+rno3dPPZx3En@mail.gmail.com>

Thanks for the reply --

On Sun, Mar 27, 2011 at 9:38 PM, Jerry Kuch <jerryk at vmware.com> wrote:

> 150 is a pretty big sounding cluster...  Out of curiosity, what's
> motivating you to go so big (if you don't mind saying)?
>

I am doing a QoS analysis of publish-subscribe overlays using RabbitMQ in
wide area networks (These are country wide networks, so even a 1000 nodes
might be insufficient :-)) So stuff like packet delay, loss, out-of-order
delivery etc.


> On that note, because RabbitMQ clustering is based on Erlang distribution,
> the current practical limit you'll probably run up against is somewhat lower
> than the 150 you have in mind.  Something more like 32 to 64.
>

Is there a configuration that would let me scale to >64 nodes, even if it
would not be practical? And in case Erlang does not scale well, I'll
probably have to resort to entirely another middleware -- any suggestions
that would work on a larger number of nodes?


> If you can say more about your goals it's likely that someone on the Rabbit
> team can suggest something helpful.
>

The analysis I'm carrying out on >100 nodes is actually on a single system.
These 'nodes' are actually many light weight linux containers (more or less
virtual machines) connected by a simulated NS3 network topology. But I doubt
this would be the cause of the clustering problem, as <50 nodes were
clustering without any difficulty.



>
> On Mar 26, 2011, at 10:32 PM, "Advait Alai" <advaitalai at gmail.com> wrote:
>
> > Hi,
> >
> > I'm trying to add 150 nodes to a RabbitMQ cluster. After around 50 nodes,
> the stop-reset-cluster-start iteration starts giving the error:
> >
> > Stopping node rabbit at node130 ...
> > ...done.
> > Resetting node rabbit at node130 ...
> > ...done.
> > Clustering node rabbit at node130 with [rabbit at node117] ...
> > ...done.
> > Starting node rabbit at node130 ...
> > Error: {cannot_start_application,rabbit,
> >            {bad_return,
> >                {{rabbit,start,[normal,[]]},
> >                 {'EXIT',{rabbit,failure_during_boot}}}}}
> >
> > Note that I am sequentially adding nodes to build a cluster (as an
> initialization step) before creating any queues/exchanges or running any
> amqp script.
> >
> > How do I solve this problem? Is it because RabbitMQ imposes a hard
> cluster size limit?
> >
> > Also, does RabbitMQ scale well to around 1000 nodes?
> >
> > Thanks
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110327/05b20fdc/attachment.htm>

From jdetreville at vmware.com  Sun Mar 27 19:46:19 2011
From: jdetreville at vmware.com (John DeTreville)
Date: Sun, 27 Mar 2011 11:46:19 -0700
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <431712.78403.qm@web31802.mail.mud.yahoo.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>	<20110318171120.GM2414@rabbitmq.com>
	<819166.65905.qm@web31806.mail.mud.yahoo.com>
	<4D84CF90.4060104@rabbitmq.com>
	<431712.78403.qm@web31802.mail.mud.yahoo.com>
Message-ID: <66F360D5-AB78-4FEC-9874-592CF12F602B@vmware.com>

Alex,

I apologize for the delay in getting back to you.

I'm running your updated tests. I had to make small changes to your declare.sh, publish.sh and consume.sh to make them work when run from a directory other than $AMQP_UTIL_DIR. (I've attached the changes.) I also had to do an initial "sudo make install" from rabbitmq-c.

When I run run.sh, it fails to fork some of the producers and some of the consumers because of Unix kernel limitations, which also cause some of the commands in common.sh to fail. I'm assuming for the moment that these failures are not affecting the tests.

That said, the tests are not failing. This is not too surprising since the machine I'm running them on is rather slow. (Each of the producers and consumers is managing a little under 2 msgs/second.)

My more modern computer on which I usually run tests is out for repairs. Once I get it back, I'll rerun these tests and see if I can reproduce your problem.

Cheers,
John

-------------- next part --------------
A non-text attachment was scrubbed...
Name: consume.sh
Type: application/octet-stream
Size: 225 bytes
Desc: consume.sh
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110327/5c3f427e/attachment.obj>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110327/5c3f427e/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: declare.sh
Type: application/octet-stream
Size: 227 bytes
Desc: declare.sh
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110327/5c3f427e/attachment-0001.obj>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110327/5c3f427e/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: publish.sh
Type: application/octet-stream
Size: 318 bytes
Desc: publish.sh
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110327/5c3f427e/attachment-0002.obj>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110327/5c3f427e/attachment-0002.htm>

From alexis at rabbitmq.com  Sun Mar 27 20:27:12 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sun, 27 Mar 2011 20:27:12 +0100
Subject: [rabbitmq-discuss] Cluster size limit
In-Reply-To: <AANLkTimpAATqF_1xB7-1hjb_KGodHOP+rno3dPPZx3En@mail.gmail.com>
References: <AANLkTikfZAKPcOyJpHR_pXBLXdHuFTUqw_BAQetQkaG5@mail.gmail.com>
	<6AC7EB36-058C-494F-9A98-AC7865577774@vmware.com>
	<AANLkTimpAATqF_1xB7-1hjb_KGodHOP+rno3dPPZx3En@mail.gmail.com>
Message-ID: <AANLkTikBNfcuykCwYdgB_T1ahn_UQGb-htGCM-qT2FJ+@mail.gmail.com>

Advait

Interesting project!

However - RabbitMQ clustering is not designed as a way to create
pubsub overlays for the wide area.  Its primary goal is scalability of
one broker by adding nodes on the same LAN.  This is for, eg, cases
where the number of subscriptions (or "bindings") on the broker grows
beyond what one machine can physically cope with.

Now, this does not stop you wiring up 1,000s of RabbitMQ brokers.  But
using RabbitMQ clustering is the wrong way to do that.  Can you tell
us a bit more about the pubsub topology you want to study, please?
That may help us suggest the optimal way to solve your problem..

Also, can you explain why QoS studies require the study of 1,000s of
nodes?  Perhaps you mean 1,000s of clients?

alexis




On Sun, Mar 27, 2011 at 7:11 PM, Advait Alai <advaitalai at gmail.com> wrote:
> Thanks for the reply --
> On Sun, Mar 27, 2011 at 9:38 PM, Jerry Kuch <jerryk at vmware.com> wrote:
>>
>> 150 is a pretty big sounding cluster... ?Out of curiosity, what's
>> motivating you to go so big (if you don't mind saying)?
>
> I am doing a QoS analysis of publish-subscribe overlays using RabbitMQ in
> wide area networks (These are country wide networks, so even a 1000 nodes
> might be insufficient :-)) So stuff like packet delay, loss, out-of-order
> delivery etc.
>
>>
>> On that note, because RabbitMQ clustering is based on Erlang distribution,
>> the current practical limit you'll probably run up against is somewhat lower
>> than the 150 you have in mind. ?Something more like 32 to 64.
>
> Is there a configuration that would let me scale to >64 nodes, even if it
> would not be practical? And in case Erlang does not scale well, I'll
> probably have to resort to entirely another middleware -- any suggestions
> that would work on a larger number of nodes?
>
>>
>> If you can say more about your goals it's likely that someone on the
>> Rabbit team can suggest something helpful.
>
> The analysis I'm carrying out on >100 nodes is actually on a single system.
> These 'nodes' are actually many light weight linux containers (more or less
> virtual machines) connected by a simulated NS3 network topology. But I doubt
> this would be the cause of the clustering problem, as <50 nodes were
> clustering without any difficulty.
>
>>
>> On Mar 26, 2011, at 10:32 PM, "Advait Alai" <advaitalai at gmail.com> wrote:
>>
>> > Hi,
>> >
>> > I'm trying to add 150 nodes to a RabbitMQ cluster. After around 50
>> > nodes, the stop-reset-cluster-start iteration starts giving the error:
>> >
>> > Stopping node rabbit at node130 ...
>> > ...done.
>> > Resetting node rabbit at node130 ...
>> > ...done.
>> > Clustering node rabbit at node130 with [rabbit at node117] ...
>> > ...done.
>> > Starting node rabbit at node130 ...
>> > Error: {cannot_start_application,rabbit,
>> > ? ? ? ? ? ?{bad_return,
>> > ? ? ? ? ? ? ? ?{{rabbit,start,[normal,[]]},
>> > ? ? ? ? ? ? ? ? {'EXIT',{rabbit,failure_during_boot}}}}}
>> >
>> > Note that I am sequentially adding nodes to build a cluster (as an
>> > initialization step) before creating any queues/exchanges or running any
>> > amqp script.
>> >
>> > How do I solve this problem? Is it because RabbitMQ imposes a hard
>> > cluster size limit?
>> >
>> > Also, does RabbitMQ scale well to around 1000 nodes?
>> >
>> > Thanks
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From chen650 at yahoo.com  Sun Mar 27 21:29:35 2011
From: chen650 at yahoo.com (alex chen)
Date: Sun, 27 Mar 2011 13:29:35 -0700 (PDT)
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <66F360D5-AB78-4FEC-9874-592CF12F602B@vmware.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>
	<20110318171120.GM2414@rabbitmq.com>
	<819166.65905.qm@web31806.mail.mud.yahoo.com>
	<4D84CF90.4060104@rabbitmq.com>
	<431712.78403.qm@web31802.mail.mud.yahoo.com>
	<66F360D5-AB78-4FEC-9874-592CF12F602B@vmware.com>
Message-ID: <747873.7872.qm@web31801.mail.mud.yahoo.com>

John,

Thanks for looking into this problem!


> When I run run.sh, it fails to fork some of the producers and some of the 
>consumers because of Unix kernel limitations, which also > cause some of the 
>commands in common.sh to fail. I'm assuming for the moment that these failures 
>are not affecting the tests.


Actually these failures would affect the tests.  The goal of the tests is 
consuming 50 GB of messages from 1000 queues simultaneously.  If run.sh could 
not start 1000 producers, there won't be 50 GB messages backed up in the 
broker.  amqp_producer.c can be modified to publish those messages into 1000 
topics with single process, however, we still need to start 1000 consumers to 
consume messages simultaneously.   I am using RHEL5 and did not run into any 
kernel limitations with 1000 producers and 1000 consumers.  Have you tried 
"ulimit" to workaround it?

-alex
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110327/2a64c70f/attachment.htm>

From advaitalai at gmail.com  Sun Mar 27 21:33:25 2011
From: advaitalai at gmail.com (Advait Alai)
Date: Mon, 28 Mar 2011 02:03:25 +0530
Subject: [rabbitmq-discuss] Cluster size limit
In-Reply-To: <AANLkTikBNfcuykCwYdgB_T1ahn_UQGb-htGCM-qT2FJ+@mail.gmail.com>
References: <AANLkTikfZAKPcOyJpHR_pXBLXdHuFTUqw_BAQetQkaG5@mail.gmail.com>
	<6AC7EB36-058C-494F-9A98-AC7865577774@vmware.com>
	<AANLkTimpAATqF_1xB7-1hjb_KGodHOP+rno3dPPZx3En@mail.gmail.com>
	<AANLkTikBNfcuykCwYdgB_T1ahn_UQGb-htGCM-qT2FJ+@mail.gmail.com>
Message-ID: <AANLkTingd1xVZmBuBaa1-8Y9LudyQvGdiw83yzvAnHb=@mail.gmail.com>

>
> However - RabbitMQ clustering is not designed as a way to create
> pubsub overlays for the wide area.  Its primary goal is scalability of
> one broker by adding nodes on the same LAN.  This is for, eg, cases
> where the number of subscriptions (or "bindings") on the broker grows
> beyond what one machine can physically cope with.
>
> Now, this does not stop you wiring up 1,000s of RabbitMQ brokers.  But
> using RabbitMQ clustering is the wrong way to do that.  Can you tell
> us a bit more about the pubsub topology you want to study, please?
> That may help us suggest the optimal way to solve your problem..
>

The topology looks like this: http://imgur.com/8iep0 (taken from
http://ctieware.eng.monash.edu.au/twiki/bin/view/Simulation/LargePacket-switchingNetworkTopologies
)

The terminal nodes shown in the topology are either publishers or
subscribers, and I want RabbitMQ to run as a middleware over the entire
network. The network (routers and links) are simulated by NS3, So it is
essentially a set of point to point links, where each link is a separate
network. The terminal nodes are VMs (that would run the amqp/rabbitmq
scripts) which I am attempting to cluster so they can use a common set of
queues and exchanges. So all terminal nodes are in different LANs.

Also, can you explain why QoS studies require the study of 1,000s of
> nodes?  Perhaps you mean 1,000s of clients?
>

I'm not sure I understood -- I'm trying to provide high fidelity results, so
I thought the testbed should be atleast of the same order of size as the
network on which it needs to be deployed (>50000 nodes). There are a few
strict IEEE standards regarding this network that specify the minimum QoS
guarantees required.

Is there an easier way to do this?

Thanks

On Sun, Mar 27, 2011 at 7:11 PM, Advait Alai <advaitalai at gmail.com> wrote:
> > Thanks for the reply --
> > On Sun, Mar 27, 2011 at 9:38 PM, Jerry Kuch <jerryk at vmware.com> wrote:
> >>
> >> 150 is a pretty big sounding cluster...  Out of curiosity, what's
> >> motivating you to go so big (if you don't mind saying)?
> >
> > I am doing a QoS analysis of publish-subscribe overlays using RabbitMQ in
> > wide area networks (These are country wide networks, so even a 1000 nodes
> > might be insufficient :-)) So stuff like packet delay, loss, out-of-order
> > delivery etc.
> >
> >>
> >> On that note, because RabbitMQ clustering is based on Erlang
> distribution,
> >> the current practical limit you'll probably run up against is somewhat
> lower
> >> than the 150 you have in mind.  Something more like 32 to 64.
> >
> > Is there a configuration that would let me scale to >64 nodes, even if it
> > would not be practical? And in case Erlang does not scale well, I'll
> > probably have to resort to entirely another middleware -- any suggestions
> > that would work on a larger number of nodes?
> >
> >>
> >> If you can say more about your goals it's likely that someone on the
> >> Rabbit team can suggest something helpful.
> >
> > The analysis I'm carrying out on >100 nodes is actually on a single
> system.
> > These 'nodes' are actually many light weight linux containers (more or
> less
> > virtual machines) connected by a simulated NS3 network topology. But I
> doubt
> > this would be the cause of the clustering problem, as <50 nodes were
> > clustering without any difficulty.
> >
> >>
> >> On Mar 26, 2011, at 10:32 PM, "Advait Alai" <advaitalai at gmail.com>
> wrote:
> >>
> >> > Hi,
> >> >
> >> > I'm trying to add 150 nodes to a RabbitMQ cluster. After around 50
> >> > nodes, the stop-reset-cluster-start iteration starts giving the error:
> >> >
> >> > Stopping node rabbit at node130 ...
> >> > ...done.
> >> > Resetting node rabbit at node130 ...
> >> > ...done.
> >> > Clustering node rabbit at node130 with [rabbit at node117] ...
> >> > ...done.
> >> > Starting node rabbit at node130 ...
> >> > Error: {cannot_start_application,rabbit,
> >> >            {bad_return,
> >> >                {{rabbit,start,[normal,[]]},
> >> >                 {'EXIT',{rabbit,failure_during_boot}}}}}
> >> >
> >> > Note that I am sequentially adding nodes to build a cluster (as an
> >> > initialization step) before creating any queues/exchanges or running
> any
> >> > amqp script.
> >> >
> >> > How do I solve this problem? Is it because RabbitMQ imposes a hard
> >> > cluster size limit?
> >> >
> >> > Also, does RabbitMQ scale well to around 1000 nodes?
> >> >
> >> > Thanks
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110328/f50b9146/attachment.htm>

From alexis at rabbitmq.com  Sun Mar 27 22:25:59 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Sun, 27 Mar 2011 22:25:59 +0100
Subject: [rabbitmq-discuss] Cluster size limit
In-Reply-To: <AANLkTingd1xVZmBuBaa1-8Y9LudyQvGdiw83yzvAnHb=@mail.gmail.com>
References: <AANLkTikfZAKPcOyJpHR_pXBLXdHuFTUqw_BAQetQkaG5@mail.gmail.com>
	<6AC7EB36-058C-494F-9A98-AC7865577774@vmware.com>
	<AANLkTimpAATqF_1xB7-1hjb_KGodHOP+rno3dPPZx3En@mail.gmail.com>
	<AANLkTikBNfcuykCwYdgB_T1ahn_UQGb-htGCM-qT2FJ+@mail.gmail.com>
	<AANLkTingd1xVZmBuBaa1-8Y9LudyQvGdiw83yzvAnHb=@mail.gmail.com>
Message-ID: <BANLkTinRp5uU2cqJiZz=HknsUHEWiqETkw@mail.gmail.com>

Advait

There is no benefit to clustering terminal nodes which (as I
understand it) are not sharing internal state with each other.
Instead look to share queues and exchanges by running them on brokers,
and connecting multiple terminal nodes to those brokers.

You should run RabbitMQ clients at terminal nodes.  Connect them to
brokers running at non-terminal nodes.  For broker-broker links, use
Shovel.  We are working on a federation model that is more flexible
than shovel - if you are interested, talk to Simon (cc'd).

Does this help?

alexis




On Sun, Mar 27, 2011 at 9:33 PM, Advait Alai <advaitalai at gmail.com> wrote:
>> However - RabbitMQ clustering is not designed as a way to create
>> pubsub overlays for the wide area. ?Its primary goal is scalability of
>> one broker by adding nodes on the same LAN. ?This is for, eg, cases
>> where the number of subscriptions (or "bindings") on the broker grows
>> beyond what one machine can physically cope with.
>>
>> Now, this does not stop you wiring up 1,000s of RabbitMQ brokers. ?But
>> using RabbitMQ clustering is the wrong way to do that. ?Can you tell
>> us a bit more about the pubsub topology you want to study, please?
>> That may help us suggest the optimal way to solve your problem..
>
> The topology looks like this:?http://imgur.com/8iep0?(taken
> from?http://ctieware.eng.monash.edu.au/twiki/bin/view/Simulation/LargePacket-switchingNetworkTopologies)
> The terminal nodes shown in the topology are either publishers or
> subscribers, and I want RabbitMQ to run as a middleware over the entire
> network. The network (routers and links) are simulated by NS3, So it is
> essentially a set of point to point links, where each link is a separate
> network. The terminal nodes are VMs (that would run the amqp/rabbitmq
> scripts) which I am attempting to cluster so they can use a common set of
> queues and exchanges. So all terminal nodes are in different LANs.
>>
>> Also, can you explain why QoS studies require the study of 1,000s of
>> nodes? ?Perhaps you mean 1,000s of clients?
>
> I'm not sure I understood -- I'm trying to provide high fidelity results, so
> I thought the testbed should be atleast of the same order of size as the
> network on which it needs to be deployed (>50000 nodes). There are a few
> strict IEEE standards regarding this network that specify the minimum QoS
> guarantees required.
> Is there an easier way to do this?
> Thanks
>>
>> On Sun, Mar 27, 2011 at 7:11 PM, Advait Alai <advaitalai at gmail.com> wrote:
>> > Thanks for the reply --
>> > On Sun, Mar 27, 2011 at 9:38 PM, Jerry Kuch <jerryk at vmware.com> wrote:
>> >>
>> >> 150 is a pretty big sounding cluster... ?Out of curiosity, what's
>> >> motivating you to go so big (if you don't mind saying)?
>> >
>> > I am doing a QoS analysis of publish-subscribe overlays using RabbitMQ
>> > in
>> > wide area networks (These are country wide networks, so even a 1000
>> > nodes
>> > might be insufficient :-)) So stuff like packet delay, loss,
>> > out-of-order
>> > delivery etc.
>> >
>> >>
>> >> On that note, because RabbitMQ clustering is based on Erlang
>> >> distribution,
>> >> the current practical limit you'll probably run up against is somewhat
>> >> lower
>> >> than the 150 you have in mind. ?Something more like 32 to 64.
>> >
>> > Is there a configuration that would let me scale to >64 nodes, even if
>> > it
>> > would not be practical? And in case Erlang does not scale well, I'll
>> > probably have to resort to entirely another middleware -- any
>> > suggestions
>> > that would work on a larger number of nodes?
>> >
>> >>
>> >> If you can say more about your goals it's likely that someone on the
>> >> Rabbit team can suggest something helpful.
>> >
>> > The analysis I'm carrying out on >100 nodes is actually on a single
>> > system.
>> > These 'nodes' are actually many light weight linux containers (more or
>> > less
>> > virtual machines) connected by a simulated NS3 network topology. But I
>> > doubt
>> > this would be the cause of the clustering problem, as <50 nodes were
>> > clustering without any difficulty.
>> >
>> >>
>> >> On Mar 26, 2011, at 10:32 PM, "Advait Alai" <advaitalai at gmail.com>
>> >> wrote:
>> >>
>> >> > Hi,
>> >> >
>> >> > I'm trying to add 150 nodes to a RabbitMQ cluster. After around 50
>> >> > nodes, the stop-reset-cluster-start iteration starts giving the
>> >> > error:
>> >> >
>> >> > Stopping node rabbit at node130 ...
>> >> > ...done.
>> >> > Resetting node rabbit at node130 ...
>> >> > ...done.
>> >> > Clustering node rabbit at node130 with [rabbit at node117] ...
>> >> > ...done.
>> >> > Starting node rabbit at node130 ...
>> >> > Error: {cannot_start_application,rabbit,
>> >> > ? ? ? ? ? ?{bad_return,
>> >> > ? ? ? ? ? ? ? ?{{rabbit,start,[normal,[]]},
>> >> > ? ? ? ? ? ? ? ? {'EXIT',{rabbit,failure_during_boot}}}}}
>> >> >
>> >> > Note that I am sequentially adding nodes to build a cluster (as an
>> >> > initialization step) before creating any queues/exchanges or running
>> >> > any
>> >> > amqp script.
>> >> >
>> >> > How do I solve this problem? Is it because RabbitMQ imposes a hard
>> >> > cluster size limit?
>> >> >
>> >> > Also, does RabbitMQ scale well to around 1000 nodes?
>> >> >
>> >> > Thanks
>> >> > _______________________________________________
>> >> > rabbitmq-discuss mailing list
>> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>

From advaitalai at gmail.com  Mon Mar 28 08:14:08 2011
From: advaitalai at gmail.com (Advait Alai)
Date: Mon, 28 Mar 2011 12:44:08 +0530
Subject: [rabbitmq-discuss] Cluster size limit
In-Reply-To: <BANLkTinRp5uU2cqJiZz=HknsUHEWiqETkw@mail.gmail.com>
References: <AANLkTikfZAKPcOyJpHR_pXBLXdHuFTUqw_BAQetQkaG5@mail.gmail.com>
	<6AC7EB36-058C-494F-9A98-AC7865577774@vmware.com>
	<AANLkTimpAATqF_1xB7-1hjb_KGodHOP+rno3dPPZx3En@mail.gmail.com>
	<AANLkTikBNfcuykCwYdgB_T1ahn_UQGb-htGCM-qT2FJ+@mail.gmail.com>
	<AANLkTingd1xVZmBuBaa1-8Y9LudyQvGdiw83yzvAnHb=@mail.gmail.com>
	<BANLkTinRp5uU2cqJiZz=HknsUHEWiqETkw@mail.gmail.com>
Message-ID: <AANLkTin47sO5gcQ=-LzAH55PdTNn+C1EzUHM6EdwLVLJ@mail.gmail.com>

Alexis,

Thanks for the inputs.

On Mon, Mar 28, 2011 at 2:55 AM, Alexis Richardson <alexis at rabbitmq.com>wrote:

> Advait
>
> There is no benefit to clustering terminal nodes which (as I
> understand it) are not sharing internal state with each other.
> Instead look to share queues and exchanges by running them on brokers,
> and connecting multiple terminal nodes to those brokers.
>

I am running the entire setup -- VMs and the network on a single system. Does
that count as sharing the same internal state? The VMs mount the same bare
file system, so, for example, I could skip replicating erlang-cookies before
clustering (/var/lib/rabbitmq is common). Of course, they have
virtualized/individual network stacks and interfaces.


> You should run RabbitMQ clients at terminal nodes.  Connect them to
> brokers running at non-terminal nodes.  For broker-broker links, use
> Shovel.  We are working on a federation model that is more flexible
> than shovel - if you are interested, talk to Simon (cc'd).
>

Ah, this might be a problem, as I cannot run any third party applications on
non terminal nodes. These nodes are primitives of NS-3 -- just objects
responsible for routing etc. Since I did not have any control on non
terminal nodes, I had to cluster terminal nodes and assumed that the
middleware would take care of setting up overlay paths from publishers to
subscribers. My bad, should've understood how clustering worked before
starting :-/

But coming back to the errors cropping up, is there a way to increase the
cluster limit size, even if there is no added benefit of clustering this
way?

@Simon -- could you please direct me to any documentation for the federation
model I could use here? Thanks


> On Sun, Mar 27, 2011 at 9:33 PM, Advait Alai <advaitalai at gmail.com> wrote:
> >> However - RabbitMQ clustering is not designed as a way to create
> >> pubsub overlays for the wide area.  Its primary goal is scalability of
> >> one broker by adding nodes on the same LAN.  This is for, eg, cases
> >> where the number of subscriptions (or "bindings") on the broker grows
> >> beyond what one machine can physically cope with.
> >>
> >> Now, this does not stop you wiring up 1,000s of RabbitMQ brokers.  But
> >> using RabbitMQ clustering is the wrong way to do that.  Can you tell
> >> us a bit more about the pubsub topology you want to study, please?
> >> That may help us suggest the optimal way to solve your problem..
> >
> > The topology looks like this: http://imgur.com/8iep0 (taken
> > from
> http://ctieware.eng.monash.edu.au/twiki/bin/view/Simulation/LargePacket-switchingNetworkTopologies
> )
> > The terminal nodes shown in the topology are either publishers or
> > subscribers, and I want RabbitMQ to run as a middleware over the entire
> > network. The network (routers and links) are simulated by NS3, So it is
> > essentially a set of point to point links, where each link is a separate
> > network. The terminal nodes are VMs (that would run the amqp/rabbitmq
> > scripts) which I am attempting to cluster so they can use a common set of
> > queues and exchanges. So all terminal nodes are in different LANs.
> >>
> >> Also, can you explain why QoS studies require the study of 1,000s of
> >> nodes?  Perhaps you mean 1,000s of clients?
> >
> > I'm not sure I understood -- I'm trying to provide high fidelity results,
> so
> > I thought the testbed should be atleast of the same order of size as the
> > network on which it needs to be deployed (>50000 nodes). There are a few
> > strict IEEE standards regarding this network that specify the minimum QoS
> > guarantees required.
> > Is there an easier way to do this?
> > Thanks
> >>
> >> On Sun, Mar 27, 2011 at 7:11 PM, Advait Alai <advaitalai at gmail.com>
> wrote:
> >> > Thanks for the reply --
> >> > On Sun, Mar 27, 2011 at 9:38 PM, Jerry Kuch <jerryk at vmware.com>
> wrote:
> >> >>
> >> >> 150 is a pretty big sounding cluster...  Out of curiosity, what's
> >> >> motivating you to go so big (if you don't mind saying)?
> >> >
> >> > I am doing a QoS analysis of publish-subscribe overlays using RabbitMQ
> >> > in
> >> > wide area networks (These are country wide networks, so even a 1000
> >> > nodes
> >> > might be insufficient :-)) So stuff like packet delay, loss,
> >> > out-of-order
> >> > delivery etc.
> >> >
> >> >>
> >> >> On that note, because RabbitMQ clustering is based on Erlang
> >> >> distribution,
> >> >> the current practical limit you'll probably run up against is
> somewhat
> >> >> lower
> >> >> than the 150 you have in mind.  Something more like 32 to 64.
> >> >
> >> > Is there a configuration that would let me scale to >64 nodes, even if
> >> > it
> >> > would not be practical? And in case Erlang does not scale well, I'll
> >> > probably have to resort to entirely another middleware -- any
> >> > suggestions
> >> > that would work on a larger number of nodes?
> >> >
> >> >>
> >> >> If you can say more about your goals it's likely that someone on the
> >> >> Rabbit team can suggest something helpful.
> >> >
> >> > The analysis I'm carrying out on >100 nodes is actually on a single
> >> > system.
> >> > These 'nodes' are actually many light weight linux containers (more or
> >> > less
> >> > virtual machines) connected by a simulated NS3 network topology. But I
> >> > doubt
> >> > this would be the cause of the clustering problem, as <50 nodes were
> >> > clustering without any difficulty.
> >> >
> >> >>
> >> >> On Mar 26, 2011, at 10:32 PM, "Advait Alai" <advaitalai at gmail.com>
> >> >> wrote:
> >> >>
> >> >> > Hi,
> >> >> >
> >> >> > I'm trying to add 150 nodes to a RabbitMQ cluster. After around 50
> >> >> > nodes, the stop-reset-cluster-start iteration starts giving the
> >> >> > error:
> >> >> >
> >> >> > Stopping node rabbit at node130 ...
> >> >> > ...done.
> >> >> > Resetting node rabbit at node130 ...
> >> >> > ...done.
> >> >> > Clustering node rabbit at node130 with [rabbit at node117] ...
> >> >> > ...done.
> >> >> > Starting node rabbit at node130 ...
> >> >> > Error: {cannot_start_application,rabbit,
> >> >> >            {bad_return,
> >> >> >                {{rabbit,start,[normal,[]]},
> >> >> >                 {'EXIT',{rabbit,failure_during_boot}}}}}
> >> >> >
> >> >> > Note that I am sequentially adding nodes to build a cluster (as an
> >> >> > initialization step) before creating any queues/exchanges or
> running
> >> >> > any
> >> >> > amqp script.
> >> >> >
> >> >> > How do I solve this problem? Is it because RabbitMQ imposes a hard
> >> >> > cluster size limit?
> >> >> >
> >> >> > Also, does RabbitMQ scale well to around 1000 nodes?
> >> >> >
> >> >> > Thanks
> >> >> > _______________________________________________
> >> >> > rabbitmq-discuss mailing list
> >> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> >> >
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110328/1b0ec0f6/attachment.htm>

From rtrlists at googlemail.com  Mon Mar 28 10:42:48 2011
From: rtrlists at googlemail.com (Robert Raschke)
Date: Mon, 28 Mar 2011 10:42:48 +0100
Subject: [rabbitmq-discuss] Use Case for RabbitMQ
In-Reply-To: <AANLkTikvJw5R7ZLHT=p3niWnFcstL+0H4yasnOjy8W12@mail.gmail.com>
References: <AANLkTikvJw5R7ZLHT=p3niWnFcstL+0H4yasnOjy8W12@mail.gmail.com>
Message-ID: <AANLkTimhMmNg=gGVrAaJ0s01oC48qAnkaiB5XRTSf0uh@mail.gmail.com>

On Fri, Mar 25, 2011 at 7:13 PM, endy kalu <endy.kalu at gmail.com> wrote:

> I am new to RabbitMQ and Messaging in general. I am building an inventory
> management system and exploring using a messaging system to maintain up to
> date inventory quantities across several geographical locations. There will
> be internet service in these locations but speed is really an issue.
> My questions are:
> 1) Is RabbitMQ or messaging suitable for this.  I like the fact that it can
> push out data and queued till consumed.
> 2) I am .Net and wondering if RabbitMQ can be "embedded" and distributed
> with my application.
> 3) If using RabbitMQ, I am a bit unsure of the architecture. I have
> pondered having RabbitMQ running in all the locations as it seems it's the
> only way to have all server push and receive data.
> 4) I am new to this. I just want to know that this use case is suitable for
> MQ.
>
> I'll really appreciate your thoughts or any direction you can point me.
>
>
The way I see messaging systems is for ease of communication and also
particularly the ease of dealing with a variety of communication patterns
(one to one, broadcast, publish subscribe, etc.).

If you are thinking about using a messaging system as temporary storage,
relying on the fact that you have a queue of persisted messages, then you
have to investigate your sizing constraints. That is, what happens if no one
consumes your persistant messages, when does the message system shut down,
and how do your producers cope with that?

If your primary concern is to "push out data and queued till consumed", then
you might be better off with a DB. Mostly because it is much easier to
reason about and there is an enormous amount of information around to help
you with sizing it correctly.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110328/c091b11f/attachment.htm>

From stammailbox at gmail.com  Mon Mar 28 13:32:27 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Mon, 28 Mar 2011 14:32:27 +0200
Subject: [rabbitmq-discuss] How to define a timeout on jsonRpcClient calls
In-Reply-To: <B8CC5B24-1226-4935-9149-AE76A12BEEA8@vmware.com>
References: <AANLkTi=6QfUjMXiKeMz7d9mTqUC71RXWhUg7jXQKn46b@mail.gmail.com>
	<B8CC5B24-1226-4935-9149-AE76A12BEEA8@vmware.com>
Message-ID: <AANLkTin-tYbKD_4CsTpOSM54Z8e4x_nhe2K31tuji00N@mail.gmail.com>

hi,
thanks for the reply.

Regarding "Actually we have a bug out to let you set a timeout,"
I didn't quite understand. Does this means it is on your todo list?
Is there a plan for a patch?

the case I want to deal with is pretty common :
I have a JsonRpcServer and I want to deal with requests that linger in the
server for too long.
(Lets say a lock occurs on the server side). I would like to set a time out
so that an exception will occur on the client  - and let me deal with it on
the client side.

Is there something like this?
10x.


Does this mean that this is on the todo list? and that

On Sun, Mar 27, 2011 at 10:36 PM, Jerry Kuch <jerryk at vmware.com> wrote:

>
> > > How do I define a timeout for procedures using  jsonRpcClient calls
> > > <ATT00001..txt>
>
> Hi:
>
> Actually we have a bug out to let you set a timeout, at least for initial
> creation of a client and its connection to a server.  I don't believe you
> can do it directly with how the interface the client currently exposes.
>
> I assume your issue is likely that you don't want your client hanging in
> its constructor if the server isn't started?
>
> Jerry
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110328/e5711ab7/attachment.htm>

From gswallow at exacttarget.com  Mon Mar 28 14:37:23 2011
From: gswallow at exacttarget.com (Greg Swallow)
Date: Mon, 28 Mar 2011 09:37:23 -0400
Subject: [rabbitmq-discuss] init script
Message-ID: <C9B60753.218E3%gswallow@exacttarget.com>

Hi,

I have questions about the init script.  I'm working with the version here:

http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_4_0/packaging/common/rabbitmq-server.init

I modified it a bit.  See below.  Specifically, I am curious about what this "$CONTROL wait > /dev/null 2>&1" line is.  I tried running "rabbitmqctl wait" and got an error back out of rabbitmqctl.  Am I missing something in my install?

Thanks.

--- rabbitmq-server.init.orig   2011-03-28 09:29:10.000000000 -0400
+++ rabbitmq-server.init        2011-03-28 09:32:47.000000000 -0400
@@ -16,16 +16,17 @@
 # Short-Description: Enable AMQP service provided by RabbitMQ broker
 ### END INIT INFO

-PATH=/sbin:/usr/sbin:/bin:/usr/bin
+PREFIX_DIR=/opt/rabbitmq/rabbitmq-2.4.0
+PATH=${PREFIX_DIR}/sbin:/sbin:/sbin:/usr/sbin:/bin:/usr/bin
 NAME=rabbitmq-server
 DAEMON=/usr/sbin/${NAME}
 CONTROL=/usr/sbin/rabbitmqctl
 DESC=rabbitmq-server
-USER=rabbitmq
+RUNAS_USER=rabbitmq
 ROTATE_SUFFIX=
 INIT_LOG_DIR=/var/log/rabbitmq
-
-LOCK_FILE= # This is filled in when building packages
+HOME=/var/lib/rabbitmq
+LOCK_FILE=/var/lock/rabbitmq.pid

 test -x $DAEMON || exit 0

@@ -41,7 +42,6 @@
         set +e
         setsid sh -c "$DAEMON > ${INIT_LOG_DIR}/startup_log \
             2> ${INIT_LOG_DIR}/startup_err" &
-        $CONTROL wait >/dev/null 2>&1
         RETVAL=$?
         set -e
         case "$RETVAL" in
@@ -101,7 +101,7 @@
     set -e
 }

-restart_running_rabbitmq () {
+restart_running_rabbitmq() {
     status_rabbitmq quiet
     if [ $RETVAL = 0 ] ; then
         restart_rabbitmq
@@ -116,6 +116,15 @@
     start_rabbitmq
 }

+become_rabbitmq() {
+    if [ "$USER" != "$RUNAS_USER" ]; then
+       su $RUNAS_USER -c "$*"
+       exit 0;
+    fi
+}
+
+become_rabbitmq $0 $*
+
 case "$1" in
     start)
         echo -n "Starting $DESC: "



ExactTarget
Greg Swallow
System Administrator
Phone | 317 524-5250
Yahoo IM | gswallow01
Email  | gswallow at exacttarget.com<mailto:gswallow at exacttarget.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110328/7fbe2007/attachment.htm>

From info at gerd-stolpmann.de  Mon Mar 28 15:08:01 2011
From: info at gerd-stolpmann.de (Gerd Stolpmann)
Date: Mon, 28 Mar 2011 16:08:01 +0200
Subject: [rabbitmq-discuss] [ANN] Netamqp, a client for AMQP-0-9-1 in Ocaml
Message-ID: <1301321281.8429.509.camel@thinkpad>

Hi,

the ocaml team at Mylife is proud to release another library to the
public: Netamqp is a client of the AMQP-0-9-1 protocol. Netamqp is an
independent implementation of such a client, and not simply a wrapper
around a C library.  Netamqp has been tested against RabbitMQ.

The Netamqp client allows synchronous and asynchronous message
processing, the latter with the help of Ocamlnet's event loop.

The homepage is at: http://oss.wink.com/netamqp/. See there for download
links, and the online manual.

There is a GODI package for Ocaml 3.12: godi-netamqp.

Gerd
-- 
------------------------------------------------------------
Gerd Stolpmann, Bad Nauheimer Str.3, 64289 Darmstadt,Germany 
gerd at gerd-stolpmann.de          http://www.gerd-stolpmann.de
Phone: +49-6151-153855                  Fax: +49-6151-997714
------------------------------------------------------------


From simon at rabbitmq.com  Mon Mar 28 16:07:57 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 Mar 2011 16:07:57 +0100
Subject: [rabbitmq-discuss] Virtual Hosts in the HTTP Auth Plugin
In-Reply-To: <AANLkTimD_DcMQpeyvMeLVh0=ofyBQtHJ54m-ECNGUS0n@mail.gmail.com>
References: <AANLkTimD_DcMQpeyvMeLVh0=ofyBQtHJ54m-ECNGUS0n@mail.gmail.com>
Message-ID: <4D90A44D.8090803@rabbitmq.com>

On 27/03/11 02:04, Max Bridgewater wrote:
> I got the HTTP auth plugin working now.  I feel, however, that there
> is a bit of inconsistency in the way it works. To authenticate a user
> X with password Y in virtual host Z, it requires that Z be created
> using rabbitmqctl while it does not require the same for the user. The
> user is indeed authenticated against the HTTP server but only if the
> embedded authentication mechanism knows of the virtual host. I was
> under the impression that vhosts are only used for message scoping and
> access control and therefore, their management could also be
> delegated.

Hi Max.

The problem is that AMQP defines the default exchange and the "amq.xxx" 
exchanges to exist in every virtual host. We therefore need to create 
these when the vhost is created.

Alternatively we could create them automatically when a vhost is first 
accessed, but this then raises the question of when such vhosts ever go 
away.

> At the bare minimum, maybe it would be worth mentioning to the plugin
> users that vhosts would need to be created in the traditional way.

Sure, I'll change the docs.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Mon Mar 28 16:09:04 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 28 Mar 2011 16:09:04 +0100
Subject: [rabbitmq-discuss] init script
In-Reply-To: <C9B60753.218E3%gswallow@exacttarget.com>
References: <C9B60753.218E3%gswallow@exacttarget.com>
Message-ID: <20110328150904.GB18713@rabbitmq.com>

Hi Greg,

On Mon, Mar 28, 2011 at 09:37:23AM -0400, Greg Swallow wrote:
> I have questions about the init script.  I'm working with the version here:
> http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_4_0/packaging/common/rabbitmq-server.init
> 
> I modified it a bit.

Why? Just curious - is there something you think we should be
incorporating into the init script ourselves?

> Specifically, I am curious about what this "$CONTROL wait > /dev/null 2>&1" line is.  I tried running "rabbitmqctl wait" and got an error back out of rabbitmqctl.  Am I missing something in my install?

see man rabbitmqctl:

              This command will wait for the RabbitMQ application to
              start at the node. As long as the Erlang node is up but
              the RabbitMQ application is down it will wait
              indefinitely. If the node itself goes down, or takes
              more than five seconds to come up, it will fail.

It was introduced in the 2.4.0 release.

Matthew

From videlalvaro at gmail.com  Mon Mar 28 16:10:24 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 28 Mar 2011 17:10:24 +0200
Subject: [rabbitmq-discuss] [ANN] Netamqp,
	a client for AMQP-0-9-1 in Ocaml
In-Reply-To: <1301321281.8429.509.camel@thinkpad>
References: <1301321281.8429.509.camel@thinkpad>
Message-ID: <DE9BCDF4-3785-48F0-99EF-F73ECFB32C75@gmail.com>

Nice!

Just in time. I was setting up a Windows machine to do learn Fsharp with RabbitMQ, now I can try OCAML :D

On Mar 28, 2011, at 4:08 PM, Gerd Stolpmann wrote:

> Hi,
> 
> the ocaml team at Mylife is proud to release another library to the
> public: Netamqp is a client of the AMQP-0-9-1 protocol. Netamqp is an
> independent implementation of such a client, and not simply a wrapper
> around a C library.  Netamqp has been tested against RabbitMQ.
> 
> The Netamqp client allows synchronous and asynchronous message
> processing, the latter with the help of Ocamlnet's event loop.
> 
> The homepage is at: http://oss.wink.com/netamqp/. See there for download
> links, and the online manual.
> 
> There is a GODI package for Ocaml 3.12: godi-netamqp.
> 
> Gerd
> -- 
> ------------------------------------------------------------
> Gerd Stolpmann, Bad Nauheimer Str.3, 64289 Darmstadt,Germany 
> gerd at gerd-stolpmann.de          http://www.gerd-stolpmann.de
> Phone: +49-6151-153855                  Fax: +49-6151-997714
> ------------------------------------------------------------
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Mon Mar 28 17:46:29 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 28 Mar 2011 17:46:29 +0100
Subject: [rabbitmq-discuss] rabbitmq-management-2.4.0.ez updated
Message-ID: <4D90BB65.9040303@rabbitmq.com>

Hi all. I spotted a couple of regressions in rabbitmq-management after 
it went out: non-admin users being unable to see the queues tab in the 
web UI, and some error conditions triggering a 500 rather than a 
meaningful error code.

I've therefore updated the rabbitmq-management-2.4.0.ez binary plugin 
file on the website, and tagged the hg repository rabbitmq_v2_4_0_1.

If you're concerned about these regressions you should redownload and 
reinstall rabbitmq-management-2.4.0.ez. The updated version should show 
up as 2.4.0.1 in rabbitmqctl status and the applications list on the 
node details page.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From matthew at rabbitmq.com  Mon Mar 28 17:46:35 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 28 Mar 2011 17:46:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ memory (RSS) slowly rising. Help!
In-Reply-To: <4511df37-6b1b-4a17-b8a5-dbaae213bb29@a11g2000pro.googlegroups.com>
References: <4511df37-6b1b-4a17-b8a5-dbaae213bb29@a11g2000pro.googlegroups.com>
Message-ID: <20110328164635.GF18713@rabbitmq.com>

Hi,

On Thu, Mar 24, 2011 at 06:40:52PM -0700, seanbollin wrote:
> I don't understand why my RabbitMQ process memory is growing slowly
> over time.
> 
> Here is the RSS I'm monitoring:
> 
> 38660    01:17:58 15928 /home/example//lib/erlang/erts-5.8.3/bin/
> beam.smp -W w -K true -A30 -P 1048576 -- -root /home/example//lib/
> erlang -progname erl -- -home /home/example -- -noshell -noinput -
> sname rabbit at web188 -boot /home/example/mnesia/rabbit at web188-p
> 
> The 38660 grows slowly over time.
> 
> To add to the confusion, when I run: ./rabbitmqctl list_queues
> messages
> 
> It consistently displays 0 messages.
> 
> This leads me to believe that the memory should stabilize.
> 
> Why is the memory consistently rising?

Most likely memory fragmentation. Until the GC runs, you may see RAM
usage slowly creep up. It will eventually stabilise, but it could take
quite a long time before that happens.

Matthew

From matthew at rabbitmq.com  Mon Mar 28 17:50:50 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 28 Mar 2011 17:50:50 +0100
Subject: [rabbitmq-discuss] "local queue" ...."remote queue"
In-Reply-To: <AANLkTi=VRXJ4yNQriuU5SceNw-v9ZFcOuFxCaAcZiW6V@mail.gmail.com>
References: <AANLkTi=VRXJ4yNQriuU5SceNw-v9ZFcOuFxCaAcZiW6V@mail.gmail.com>
Message-ID: <20110328165050.GG18713@rabbitmq.com>

Hi Bruce,

On Fri, Mar 25, 2011 at 12:05:46PM +0000, bruce bushby wrote:
> I was wondering what others are doing with regards to "queuing" local
> messages for deliver when the network is available.
> 
> From my limited experience playing to "rabbitmq-c client" and Python "pika",
> their focus is the ability to deliver a message immediately and report an
> error if they cannot contact the server.
> 
> Implementing messaging from a M2M platform, there will be times when there
> is no communication between the client and the server...but the application
> may still want to submit messages which should be queued until such time as
> the "local queue" so to speak can contact the server and delivery the
> messages.
> 
> In summary, leaving the "retry/retransmission" of message to the
> messaging infrastructure...rather then have the application monitor/poll
> connectivity to the server.
> 
> Is something like this possible?

Yes. What we recommend is that you have Rabbit installed locally, and
then configure it with the shovel plugin which will periodically try to
connect to the "downstream" Rabbit and send the messages out. One nice
way to configure this is to have the same exchange name on the local and
remote broker, but on the local, it's a fanout. On the remote it can be
whatever you need it to be. Then, the shovel, local, can just create a
single queue and catch everything sent to the local exchange. When it
connects to the downstream remote broker, it'll republish the msgs to
the same exchange name, but because the type of the exchange there can
be different, all sorts of other routing decisions can take place as
needed. I.e. it ensures that the local broker topology can be as simple
as possible (one exchange, one queue, one shovel).

Matthew

From taylste at gmail.com  Mon Mar 28 18:19:18 2011
From: taylste at gmail.com (Steven Taylor)
Date: Mon, 28 Mar 2011 18:19:18 +0100
Subject: [rabbitmq-discuss] "local queue" ...."remote queue"
In-Reply-To: <20110328165050.GG18713@rabbitmq.com>
References: <AANLkTi=VRXJ4yNQriuU5SceNw-v9ZFcOuFxCaAcZiW6V@mail.gmail.com>
	<20110328165050.GG18713@rabbitmq.com>
Message-ID: <AANLkTimmZW7RBzC7+DED4FnSyT8Gm0jJX2y2zOiBM7mz@mail.gmail.com>

It's not completely invisible, but it's a pretty good solution all in all.

Does it suit the target use-case?

-Steven

On 28 March 2011 17:50, Matthew Sackman <matthew at rabbitmq.com> wrote:

> Hi Bruce,
>
> On Fri, Mar 25, 2011 at 12:05:46PM +0000, bruce bushby wrote:
> > I was wondering what others are doing with regards to "queuing" local
> > messages for deliver when the network is available.
> >
> > From my limited experience playing to "rabbitmq-c client" and Python
> "pika",
> > their focus is the ability to deliver a message immediately and report an
> > error if they cannot contact the server.
> >
> > Implementing messaging from a M2M platform, there will be times when
> there
> > is no communication between the client and the server...but the
> application
> > may still want to submit messages which should be queued until such time
> as
> > the "local queue" so to speak can contact the server and delivery the
> > messages.
> >
> > In summary, leaving the "retry/retransmission" of message to the
> > messaging infrastructure...rather then have the application monitor/poll
> > connectivity to the server.
> >
> > Is something like this possible?
>
> Yes. What we recommend is that you have Rabbit installed locally, and
> then configure it with the shovel plugin which will periodically try to
> connect to the "downstream" Rabbit and send the messages out. One nice
> way to configure this is to have the same exchange name on the local and
> remote broker, but on the local, it's a fanout. On the remote it can be
> whatever you need it to be. Then, the shovel, local, can just create a
> single queue and catch everything sent to the local exchange. When it
> connects to the downstream remote broker, it'll republish the msgs to
> the same exchange name, but because the type of the exchange there can
> be different, all sorts of other routing decisions can take place as
> needed. I.e. it ensures that the local broker topology can be as simple
> as possible (one exchange, one queue, one shovel).
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110328/e91b2d51/attachment.htm>

From matthew at rabbitmq.com  Mon Mar 28 18:19:36 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 28 Mar 2011 18:19:36 +0100
Subject: [rabbitmq-discuss] Cluster size limit
In-Reply-To: <AANLkTikfZAKPcOyJpHR_pXBLXdHuFTUqw_BAQetQkaG5@mail.gmail.com>
References: <AANLkTikfZAKPcOyJpHR_pXBLXdHuFTUqw_BAQetQkaG5@mail.gmail.com>
Message-ID: <20110328171936.GH18713@rabbitmq.com>

Hi Advait,

On Sun, Mar 27, 2011 at 11:01:53AM +0530, Advait Alai wrote:
> I'm trying to add 150 nodes to a RabbitMQ cluster. After around 50 nodes,
> the stop-reset-cluster-start iteration starts giving the error:
> 
> Stopping node rabbit at node130 ...
> ...done.
> Resetting node rabbit at node130 ...
> ...done.
> Clustering node rabbit at node130 with [rabbit at node117] ...
> ...done.
> Starting node rabbit at node130 ...
> Error: {cannot_start_application,rabbit,
>            {bad_return,
>                {{rabbit,start,[normal,[]]},
>                 {'EXIT',{rabbit,failure_during_boot}}}}}

Hmm, curious. I don't know why that happens. I've just successfully
built a cluster of 100 nodes. I'm building from source, so using the
Makefile. I did:

1. Edit the Makefile. Around line 153, remove the
		RABBITMQ_ALLOW_INPUT=true \
  line completely.

2. rabbitmq-server$ for t in $(seq 1 100); do make RABBITMQ_NODENAME=rabbit_$t RABBITMQ_NODE_PORT=$(echo "5672+$t"|bc) TMPDIR=/home/matthew/ssd/ cleandb run & done

3. rabbitmq-server/scripts$ for t in $(seq 2 100); do ./rabbitmqctl -n rabbit_$t at hazel stop_app ; ./rabbitmqctl -n rabbit_$t at hazel reset && ./rabbitmqctl -n rabbit_$t at hazel cluster rabbit_1 at hazel rabbit_$t at hazel && ./rabbitmqctl -n rabbit_$t at hazel start_app; done

4. Go make a cuppa tea.

It takes a while, and slows down on a quadratic (which isn't surprising
because we're forming an all-to-all mesh), and it eats up a lot of RAM.
But it did get there for me:

rabbitmq-server/scripts$ ./rabbitmqctl -n 'rabbit_1 at hazel' status
Status of node rabbit_1 at hazel ...
[{pid,7933},
 {running_applications,[{rabbit,"RabbitMQ","%%VSN%%"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.17"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9.3"},
                        {stdlib,"ERTS  CXC 138 10","1.17.3"},
                        {kernel,"ERTS  CXC 138 10","2.14.3"}]},
 {nodes,[{disc,[rabbit_100 at hazel,rabbit_99 at hazel,rabbit_98 at hazel,
                rabbit_97 at hazel,rabbit_96 at hazel,rabbit_95 at hazel,
                rabbit_94 at hazel,rabbit_93 at hazel,rabbit_92 at hazel,
                rabbit_91 at hazel,rabbit_90 at hazel,rabbit_89 at hazel,
                rabbit_88 at hazel,rabbit_87 at hazel,rabbit_86 at hazel,
                rabbit_85 at hazel,rabbit_84 at hazel,rabbit_83 at hazel,
                rabbit_82 at hazel,rabbit_81 at hazel,rabbit_80 at hazel,
                rabbit_79 at hazel,rabbit_78 at hazel,rabbit_77 at hazel,
                rabbit_76 at hazel,rabbit_75 at hazel,rabbit_74 at hazel,
                rabbit_73 at hazel,rabbit_72 at hazel,rabbit_71 at hazel,
                rabbit_70 at hazel,rabbit_69 at hazel,rabbit_68 at hazel,
                rabbit_67 at hazel,rabbit_66 at hazel,rabbit_65 at hazel,
                rabbit_64 at hazel,rabbit_63 at hazel,rabbit_62 at hazel,
                rabbit_61 at hazel,rabbit_60 at hazel,rabbit_59 at hazel,
                rabbit_58 at hazel,rabbit_57 at hazel,rabbit_56 at hazel,
                rabbit_55 at hazel,rabbit_54 at hazel,rabbit_53 at hazel,
                rabbit_52 at hazel,rabbit_51 at hazel,rabbit_50 at hazel,
                rabbit_49 at hazel,rabbit_48 at hazel,rabbit_47 at hazel,
                rabbit_46 at hazel,rabbit_45 at hazel,rabbit_44 at hazel,
                rabbit_43 at hazel,rabbit_42 at hazel,rabbit_41 at hazel,
                rabbit_40 at hazel,rabbit_39 at hazel,rabbit_38 at hazel,
                rabbit_37 at hazel,rabbit_36 at hazel,rabbit_35 at hazel,
                rabbit_34 at hazel,rabbit_33 at hazel,rabbit_32 at hazel,
                rabbit_31 at hazel,rabbit_30 at hazel,rabbit_29 at hazel,
                rabbit_28 at hazel,rabbit_27 at hazel,rabbit_26 at hazel,
                rabbit_25 at hazel,rabbit_24 at hazel,rabbit_23 at hazel,
                rabbit_22 at hazel,rabbit_21 at hazel,rabbit_20 at hazel,
                rabbit_19 at hazel,rabbit_18 at hazel,rabbit_17 at hazel,
                rabbit_16 at hazel,rabbit_15 at hazel,rabbit_14 at hazel,
                rabbit_13 at hazel,rabbit_12 at hazel,rabbit_11 at hazel,
                rabbit_10 at hazel,rabbit_9 at hazel,rabbit_8 at hazel,rabbit_7 at hazel,
                rabbit_6 at hazel,rabbit_5 at hazel,rabbit_4 at hazel,rabbit_3 at hazel,
                rabbit_2 at hazel,rabbit_1 at hazel]}]},
 {running_nodes,[rabbit_100 at hazel,rabbit_99 at hazel,rabbit_98 at hazel,
                 rabbit_97 at hazel,rabbit_96 at hazel,rabbit_95 at hazel,
                 rabbit_94 at hazel,rabbit_93 at hazel,rabbit_92 at hazel,
                 rabbit_91 at hazel,rabbit_90 at hazel,rabbit_89 at hazel,
                 rabbit_88 at hazel,rabbit_87 at hazel,rabbit_86 at hazel,
                 rabbit_85 at hazel,rabbit_84 at hazel,rabbit_83 at hazel,
                 rabbit_82 at hazel,rabbit_81 at hazel,rabbit_80 at hazel,
                 rabbit_79 at hazel,rabbit_78 at hazel,rabbit_77 at hazel,
                 rabbit_76 at hazel,rabbit_75 at hazel,rabbit_74 at hazel,
                 rabbit_73 at hazel,rabbit_72 at hazel,rabbit_71 at hazel,
                 rabbit_70 at hazel,rabbit_69 at hazel,rabbit_68 at hazel,
                 rabbit_67 at hazel,rabbit_66 at hazel,rabbit_65 at hazel,
                 rabbit_64 at hazel,rabbit_63 at hazel,rabbit_62 at hazel,
                 rabbit_61 at hazel,rabbit_60 at hazel,rabbit_59 at hazel,
                 rabbit_58 at hazel,rabbit_57 at hazel,rabbit_56 at hazel,
                 rabbit_55 at hazel,rabbit_54 at hazel,rabbit_53 at hazel,
                 rabbit_52 at hazel,rabbit_51 at hazel,rabbit_50 at hazel,
                 rabbit_49 at hazel,rabbit_48 at hazel,rabbit_47 at hazel,
                 rabbit_46 at hazel,rabbit_45 at hazel,rabbit_44 at hazel,
                 rabbit_43 at hazel,rabbit_42 at hazel,rabbit_41 at hazel,
                 rabbit_40 at hazel,rabbit_39 at hazel,rabbit_38 at hazel,
                 rabbit_37 at hazel,rabbit_36 at hazel,rabbit_35 at hazel,
                 rabbit_34 at hazel,rabbit_33 at hazel,rabbit_32 at hazel,
                 rabbit_31 at hazel,rabbit_30 at hazel,rabbit_29 at hazel,
                 rabbit_28 at hazel,rabbit_27 at hazel,rabbit_26 at hazel,
                 rabbit_25 at hazel,rabbit_24 at hazel,rabbit_23 at hazel,
                 rabbit_22 at hazel,rabbit_21 at hazel,rabbit_20 at hazel,
                 rabbit_19 at hazel,rabbit_18 at hazel,rabbit_17 at hazel,
                 rabbit_16 at hazel,rabbit_15 at hazel,rabbit_14 at hazel,
                 rabbit_13 at hazel,rabbit_12 at hazel,rabbit_11 at hazel,
                 rabbit_10 at hazel,rabbit_9 at hazel,rabbit_8 at hazel,rabbit_7 at hazel,
                 rabbit_6 at hazel,rabbit_5 at hazel,rabbit_4 at hazel,rabbit_3 at hazel,
                 rabbit_2 at hazel,rabbit_1 at hazel]}]
...done.

Matthew

From not.drew.stevens at gmail.com  Mon Mar 28 19:14:57 2011
From: not.drew.stevens at gmail.com (Not Drew Stevens)
Date: Mon, 28 Mar 2011 11:14:57 -0700
Subject: [rabbitmq-discuss] RabbitMQ install issue on Centos 5.5
Message-ID: <4D90D021.9070009@gmail.com>

I've been trying to get rabbitmq-server-2.4.0 up and running on Centos
5.5 on an Amazon AWS instance.

My instance uses the following kernel:  2.6.18-xenU-ec2-v1.2

I've tried installation of erland and rabbitmq-server using:
1) yum repos
2) direct rpm installation
3) compiling from source.

In every case, I get the following message when attempting to start the
RabbitMQ-Server process:

pthread/ethr_event.c:98: Fatal error in wait__(): Function not
implemented (38)

Any help would be appreciated.

Thanks,
Drew





From matthias at rabbitmq.com  Mon Mar 28 19:28:56 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Mar 2011 19:28:56 +0100
Subject: [rabbitmq-discuss] "local queue" ...."remote queue"
In-Reply-To: <7883725.104.1301078762092.JavaMail.geo-discussion-forums@yqhu20>
References: <7883725.104.1301078762092.JavaMail.geo-discussion-forums@yqhu20>
Message-ID: <4D90D368.5000503@rabbitmq.com>

Oren,

On 25/03/11 18:46, Oren Shomron wrote:
> RabbitMQ offers persistent messaging over durable exchanges - * if you
> can get your message published in the first place *
>
> The issue is what a publisher should do with a message when he is unable
> for whatever reason to reach the broker.
>
> I feel that this is not a problem that should be dealt with on the
> application layer, but rather through the messaging infrastructure.

You could get publishers to connect to a local broker residing in their 
network or even machine, and configure that broker with the 
rabbitmq-shovel plug-in to shovel messages to the main broker.

That kind of setup masks failures of the network and main broker. But it 
does of course introduce a different failure point, i.e. the local 
broker. What if that one fails?

The messaging infrastructure libraries the app uses could do their own 
buffering, but memory is bounded and disks can fail...

In the end, no matter how far you push the boundaries of the messaging 
infrastructure, there is always the possibility of some fault occurring 
which prevents the application from publishing messages, at least 
temporarily. The app either needs to accept that risk or handle the failure.

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Mar 28 19:45:27 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Mar 2011 19:45:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ install issue on Centos 5.5
In-Reply-To: <4D90D021.9070009@gmail.com>
References: <4D90D021.9070009@gmail.com>
Message-ID: <4D90D747.3020507@rabbitmq.com>

Drew,

On 28/03/11 19:14, Not Drew Stevens wrote:
> I've been trying to get rabbitmq-server-2.4.0 up and running on Centos
> 5.5 on an Amazon AWS instance.
>
> My instance uses the following kernel:  2.6.18-xenU-ec2-v1.2
>
> I've tried installation of erland and rabbitmq-server using:
> 1) yum repos
> 2) direct rpm installation
> 3) compiling from source.
>
> In every case, I get the following message when attempting to start the
> RabbitMQ-Server process:
>
> pthread/ethr_event.c:98: Fatal error in wait__(): Function not
> implemented (38)

We had a similar problem reported by a user last week. It looks like 
some compatibility issue with Erlang and certain custom Linux kernels.

You say above that you tried compiling from source. Did that include 
Erlang? If so, what version did you try and did the compilation succeed?


Regards,

Matthias.

From not.drew.stevens at gmail.com  Mon Mar 28 19:59:01 2011
From: not.drew.stevens at gmail.com (Not Drew Stevens)
Date: Mon, 28 Mar 2011 11:59:01 -0700
Subject: [rabbitmq-discuss] RabbitMQ install issue on Centos 5.5
In-Reply-To: <4D90D747.3020507@rabbitmq.com>
References: <4D90D021.9070009@gmail.com> <4D90D747.3020507@rabbitmq.com>
Message-ID: <4D90DA75.4000509@gmail.com>


On 3/28/11 11:45 AM, Matthias Radestock wrote:
> Drew,
>
> On 28/03/11 19:14, Not Drew Stevens wrote:
>> I've been trying to get rabbitmq-server-2.4.0 up and running on Centos
>> 5.5 on an Amazon AWS instance.
>>
>> My instance uses the following kernel:  2.6.18-xenU-ec2-v1.2
>>
>> I've tried installation of erland and rabbitmq-server using:
>> 1) yum repos
>> 2) direct rpm installation
>> 3) compiling from source.
>>
>> In every case, I get the following message when attempting to start the
>> RabbitMQ-Server process:
>>
>> pthread/ethr_event.c:98: Fatal error in wait__(): Function not
>> implemented (38)
>
> We had a similar problem reported by a user last week. It looks like
> some compatibility issue with Erlang and certain custom Linux kernels.
>
> You say above that you tried compiling from source. Did that include
> Erlang? If so, what version did you try and did the compilation succeed?
>
>
> Regards,
>
> Matthias.
>
Matthias,

In all three cases, (repos, rpms and source compile) I installed Erlang
version R14B02.

The compilation was successfully. When I say successful, I mean that I
could start up the erlang console.  (I will admit that I did not try to
do anything very complicated in the console)

Maybe I'll try to install a previous version of Erlang to see if that
makes a difference.

Drew




From matthias at rabbitmq.com  Mon Mar 28 20:09:41 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 28 Mar 2011 20:09:41 +0100
Subject: [rabbitmq-discuss] RabbitMQ install issue on Centos 5.5
In-Reply-To: <4D90DA75.4000509@gmail.com>
References: <4D90D021.9070009@gmail.com> <4D90D747.3020507@rabbitmq.com>
	<4D90DA75.4000509@gmail.com>
Message-ID: <4D90DCF5.2080903@rabbitmq.com>

Drew,

On 28/03/11 19:59, Not Drew Stevens wrote:
> In all three cases, (repos, rpms and source compile) I installed Erlang
> version R14B02.

I didn't realise there were repos/rpms for the latest erlang. Where did 
you find them?

> [...]
> Maybe I'll try to install a previous version of Erlang to see if that
> makes a difference.

That is certainly worth a try. I recommend R13B04 - the last in the R13 
series - in case this problem was introduced in R14.


Matthias.

From jdetreville at vmware.com  Mon Mar 28 22:21:28 2011
From: jdetreville at vmware.com (John DeTreville)
Date: Mon, 28 Mar 2011 14:21:28 -0700
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <747873.7872.qm@web31801.mail.mud.yahoo.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>
	<20110318171120.GM2414@rabbitmq.com>
	<819166.65905.qm@web31806.mail.mud.yahoo.com>
	<4D84CF90.4060104@rabbitmq.com>
	<431712.78403.qm@web31802.mail.mud.yahoo.com>
	<66F360D5-AB78-4FEC-9874-592CF12F602B@vmware.com>
	<747873.7872.qm@web31801.mail.mud.yahoo.com>
Message-ID: <F1A58F27-8C33-428A-8256-B4C486A7BBCE@vmware.com>

My ulimit says "unimited."

I will try to build an RHEL system to try this out. My guess, though, is that it also will exhibit no problems. (For example, it will have a limited amount of RAM, as it will be a VM.)

Cheers,
John

On Mar 27, 2011, at 1:29 PM, alex chen wrote:

John,

Thanks for looking into this problem!

> When I run run.sh<http://run.sh>, it fails to fork some of the producers and some of the consumers because of Unix kernel limitations, which also > cause some of the commands in common.sh<http://common.sh> to fail. I'm assuming for the moment that these failures are not affecting the tests.

Actually these failures would affect the tests.  The goal of the tests is consuming 50 GB of messages from 1000 queues simultaneously.  If run.sh could not start 1000 producers, there won't be 50 GB messages backed up in the broker.  amqp_producer.c can be modified to publish those messages into 1000 topics with single process, however, we still need to start 1000 consumers to consume messages simultaneously.   I am using RHEL5 and did not run into any kernel limitations with 1000 producers and 1000 consumers.  Have you tried "ulimit" to workaround it?

-alex


From matthew at rabbitmq.com  Mon Mar 28 22:33:21 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 28 Mar 2011 22:33:21 +0100
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <F1A58F27-8C33-428A-8256-B4C486A7BBCE@vmware.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>
	<20110318171120.GM2414@rabbitmq.com>
	<819166.65905.qm@web31806.mail.mud.yahoo.com>
	<4D84CF90.4060104@rabbitmq.com>
	<431712.78403.qm@web31802.mail.mud.yahoo.com>
	<66F360D5-AB78-4FEC-9874-592CF12F602B@vmware.com>
	<747873.7872.qm@web31801.mail.mud.yahoo.com>
	<F1A58F27-8C33-428A-8256-B4C486A7BBCE@vmware.com>
Message-ID: <20110328213321.GA2406@wellquite.org>

On Mon, Mar 28, 2011 at 02:21:28PM -0700, John DeTreville wrote:
> My ulimit says "unimited."


From emile at rabbitmq.com  Mon Mar 28 23:11:28 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 28 Mar 2011 23:11:28 +0100
Subject: [rabbitmq-discuss] How to define a timeout on jsonRpcClient
	calls
In-Reply-To: <AANLkTi=6QfUjMXiKeMz7d9mTqUC71RXWhUg7jXQKn46b@mail.gmail.com>
References: <AANLkTi=6QfUjMXiKeMz7d9mTqUC71RXWhUg7jXQKn46b@mail.gmail.com>
Message-ID: <4D910790.6090501@rabbitmq.com>

Hi,

Op 27/03/2011 17:32, het mysurf mail geskryf:
> How do I define a timeout for procedures using  jsonRpcClient calls

The present RPC implementation does not feature a timeout. If you want 
to experiment with a timeout then you can try to modify the 2-argument 
version of RpcClient.primitiveCall to use 
BlockingCell.uninterruptibleGet with a timeout. You will also need to 
add appropriate exception handling.

Regards

Emile

From not.drew.stevens at gmail.com  Mon Mar 28 23:23:58 2011
From: not.drew.stevens at gmail.com (Not Drew Stevens)
Date: Mon, 28 Mar 2011 15:23:58 -0700
Subject: [rabbitmq-discuss] RabbitMQ install issue on Centos 5.5
In-Reply-To: <4D90DCF5.2080903@rabbitmq.com>
References: <4D90D021.9070009@gmail.com> <4D90D747.3020507@rabbitmq.com>
	<4D90DA75.4000509@gmail.com> <4D90DCF5.2080903@rabbitmq.com>
Message-ID: <4D910A7E.9020307@gmail.com>



On 3/28/11 12:09 PM, Matthias Radestock wrote:
> Drew,
>
> On 28/03/11 19:59, Not Drew Stevens wrote:
>> In all three cases, (repos, rpms and source compile) I installed Erlang
>> version R14B02.
>
> I didn't realise there were repos/rpms for the latest erlang. Where
> did you find them?

Looks like I was wrong about this part of the post.  I was using the
R14B rpms from
(http://repos.fedorapeople.org/repos/peter/erlang/epel-erlang.repo)
>
>> [...]
>> Maybe I'll try to install a previous version of Erlang to see if that
>> makes a difference.
>
> That is certainly worth a try. I recommend R13B04 - the last in the
> R13 series - in case this problem was introduced in R14.
>
>
I was successful with the R13B04 release (from source) followed by repo
install of rabbitmq-server.

Thanks for the encouragement.

What's interesting, is that when compiled R14B, I got the following
error that did not occur when compiling R14B02 the first time:
(NOTE: I started from a fresh OS install for all of these tests)
....
erlc -W  +debug_info +inline -o../ebin hipe_rtl.erl
pthread/ethr_event.c:92: Fatal error in wait__(): Function not
implemented (38)
make[3]: *** [../ebin/hipe_rtl.beam] Aborted
....

and R14B01 produced something similar but different:
....
erlc -W  +debug_info +inline -o../ebin hipe_rtl.erl
pthread/ethr_event.c:92: Fatal error in wait__(): Function not
implemented (38)
../include/internal/pthread/ethr_event.h:86: Fatal error in
ethr_event_set(): Function not implemented (38)
make[3]: *** [../ebin/hipe_rtl.beam] Aborted

then when I recompiled R14B02 one more time, I did get the error.
....
erlc -W  +debug_info +inline -o../ebin hipe_rtl.erl
pthread/ethr_event.c:98: Fatal error in wait__(): Function not
implemented (38)
make[3]: *** [../ebin/hipe_rtl.beam] Aborted
....

I'm not sure what I did differently the first time I compiled R14B02,
but I know I'm not crazy because I still have the terminal log for the
one time it worked. Not sure what was different.




From jerryk at vmware.com  Mon Mar 28 23:25:05 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 28 Mar 2011 15:25:05 -0700
Subject: [rabbitmq-discuss] How to define a timeout on
	jsonRpcClient	calls
In-Reply-To: <4D910790.6090501@rabbitmq.com>
References: <AANLkTi=6QfUjMXiKeMz7d9mTqUC71RXWhUg7jXQKn46b@mail.gmail.com>
	<4D910790.6090501@rabbitmq.com>
Message-ID: <C87624D8-CC3F-4574-BFBE-4C1CEDBA5561@vmware.com>

Ah, sorry I didn't get to this earlier.  Emile's exactly right, and the bug/work item I mentioned earlier is to make just the change he describes in the client.  It's from last November but I'm not sure if we've decided to do it just yet or not...  

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On Mar 28, 2011, at 3:12 PM, "Emile Joubert" <emile at rabbitmq.com> wrote:

> Hi,
> 
> Op 27/03/2011 17:32, het mysurf mail geskryf:
>> How do I define a timeout for procedures using  jsonRpcClient calls
> 
> The present RPC implementation does not feature a timeout. If you want 
> to experiment with a timeout then you can try to modify the 2-argument 
> version of RpcClient.primitiveCall to use 
> BlockingCell.uninterruptibleGet with a timeout. You will also need to 
> add appropriate exception handling.
> 
> Regards
> 
> Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jdetreville at vmware.com  Mon Mar 28 23:38:48 2011
From: jdetreville at vmware.com (John DeTreville)
Date: Mon, 28 Mar 2011 15:38:48 -0700
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <747873.7872.qm@web31801.mail.mud.yahoo.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>
	<20110318171120.GM2414@rabbitmq.com>
	<819166.65905.qm@web31806.mail.mud.yahoo.com>
	<4D84CF90.4060104@rabbitmq.com>
	<431712.78403.qm@web31802.mail.mud.yahoo.com>
	<66F360D5-AB78-4FEC-9874-592CF12F602B@vmware.com>
	<747873.7872.qm@web31801.mail.mud.yahoo.com>
Message-ID: <C15A4C85-A461-4845-92BD-2C826C5453EE@vmware.com>

One more question. You say RabbitMQ crashes when you run these tests? And it crashes without writing anything interesting in th logs? Or printing anything to the console? It just exits?

Cheers,
John

On Mar 27, 2011, at 1:29 PM, alex chen wrote:

John,

Thanks for looking into this problem!

> When I run run.sh<http://run.sh>, it fails to fork some of the producers and some of the consumers because of Unix kernel limitations, which also > cause some of the commands in common.sh<http://common.sh> to fail. I'm assuming for the moment that these failures are not affecting the tests.

Actually these failures would affect the tests.  The goal of the tests is consuming 50 GB of messages from 1000 queues simultaneously.  If run.sh could not start 1000 producers, there won't be 50 GB messages backed up in the broker.  amqp_producer.c can be modified to publish those messages into 1000 topics with single process, however, we still need to start 1000 consumers to consume messages simultaneously.   I am using RHEL5 and did not run into any kernel limitations with 1000 producers and 1000 consumers.  Have you tried "ulimit" to workaround it?

-alex


From gmr at myyearbook.com  Tue Mar 29 07:04:48 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 29 Mar 2011 02:04:48 -0400
Subject: [rabbitmq-discuss] Pika v0.9.5 Released
Message-ID: <DD9E447E2601498A9480A265FFE1A7E1@myyearbook.com>

I am pleased to announce that Pika v0.9.5 is now available for download. Pika AMQP 0-9-1/RabbitMQ 2.0+ client library for Python.

Pika v0.9.5 adds over 100 additional unit and functional tests covering Python 2.4 through Python 2.7 and addresses major bugs found in v0.9.4. 

All users of the 0.9 tree of Pika are highly encouraged to upgrade to v0.9.5.

Pika's home has moved to https://github.com/pika and documentation is now available at http://pika.github.com.

Thanks to Brian K. Jones, Jason J. W. Williams, Marek Majkowski, Peter Magnusson and Samuel Stauffer for bug-fixes, suggestions and contributions to this release.

Pika v0.9.5 is mainly a bug fix version and is intended to be the last version in the 0.9 tree, however please report any issues at https://github.com/pika/pika/issues

Pika may be installed via source from http://pypi.python.org/packages/source/p/pika/pika-0.9.5.tar.gz (md5: 38527f6977bf0a0b204710b93b0c6417)

It is also available for installation via easy_install and pip:

 pip install pika / easy_install pika

Changelog
- Scope changes with adapter IOLoops and CallbackManager allowing for cleaner, multi-threaded operation
- Add support for Confirm.Select with channel.Channel.confirm_delivery()
- Add examples of delivery confirmation to examples (demo_send_confirmed.py)
- Update uses of log.warn with warning.warn for TCP Back-pressure alerting
- License boilerplate updated to simplify license text in source files
- Increment the timeout in select_connection.SelectPoller reducing CPU utilization
- Bug fix in Heartbeat frame delivery addressing issue #35
- Remove abuse of pika.log.method_call through a majority of the code
- Rename of key modules: table to data, frames to frame
- Cleanup of frame module and related classes
- Restructure of tests and test runner
- Update functional tests to respect RABBITMQ_HOST, RABBITMQ_PORT environment variables
- Bug fixes to reconnection_strategies module
- Fix the scale of timeout for PollPoller to be specified in milliseconds
- Remove mutable default arguments in RPC calls
- Add data type validation to RPC calls
- Move optional credentials erasing out of connection.Connection into credentials module
- Add support to allow for additional external credential types
- Add a NullHandler to prevent the 'No handlers could be found for logger "pika"' error message when not using pika.log in a client app at all.
- Clean up all examples to make them easier to read and use
- Move documentation into its own repository https://github.com/pika/documentation
- channel.py:
- Move channel.MAX_CHANNELS constant from connection.CHANNEL_MAX
- Add default value of None to ChannelTransport.rpc
- Validate callback and acceptable replies parameters in ChannelTransport.RPC
- Remove unused connection attribute from Channel
- connection.py:
- Remove unused import of struct
- Remove direct import of pika.credentials.PlainCredentials
- Change to import pika.credentials
- Move CHANNEL_MAX to channel.MAX_CHANNELS
- Change ConnectionParameters initialization parameter heartbeat to boolean
- Validate all inbound parameter types in ConnectionParameters
- Remove the Connection._erase_credentials stub method in favor of letting the Credentials object deal with that itself.
- Warn if the credentials object intends on erasing the credentials and a reconnection strategy other than NullReconnectionStrategy is specified.
- Change the default types for callback and acceptable_replies in Connection._rpc
- Validate the callback and acceptable_replies data types in Connection._rpc
- adapters.blocking_connection.BlockingConnection:
- Addition of _adapter_disconnect to blocking_connection.BlockingConnection
- Add timeout methods to BlockingConnection addressing issue #41
- BlockingConnection didn't allow you register more than one consumer callback because basic_consume was overridden to block immediately. New behavior allows you to do so.
- Removed overriding of base basic_consume and basic_cancel methods. Now uses underlying Channel versions of those methods.
- Added start_consuming() method to BlockingChannel to start the consumption loop.
- Updated stop_consuming() to iterate through all the registered consumers in self._consumers and issue a basic_cancel.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110329/3a37278c/attachment.htm>

From matthias at rabbitmq.com  Tue Mar 29 07:57:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 29 Mar 2011 07:57:10 +0100
Subject: [rabbitmq-discuss] EndOfStreamException SharedQueue closed with
 .net client
In-Reply-To: <694ad0cd-9d19-48fa-87d5-1177c6efdebe@1g2000yqq.googlegroups.com>
References: <cc044d0d-66c7-4fba-bfa1-b2517dc3a2aa@s11g2000yqh.googlegroups.com>	<4D8C6B90.1080003@rabbitmq.com>
	<694ad0cd-9d19-48fa-87d5-1177c6efdebe@1g2000yqq.googlegroups.com>
Message-ID: <4D9182C6.5010809@rabbitmq.com>

Dex,

Dex wrote:
> I think section 2.8 of the dotnet user guide may be a bit out of date?
> The example there has the line
> 
>>  consumerChannel.BasicConsume(consumerQueue, null, consumer);
> 
> It appears the second parameter is not valid for a bool.

We've corrected this; the updated guide will go out with the next 
release. Thanks for reporting this.


Matthias.

From chen650 at yahoo.com  Tue Mar 29 08:10:36 2011
From: chen650 at yahoo.com (alex chen)
Date: Tue, 29 Mar 2011 00:10:36 -0700 (PDT)
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <C15A4C85-A461-4845-92BD-2C826C5453EE@vmware.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>
	<20110318171120.GM2414@rabbitmq.com>
	<819166.65905.qm@web31806.mail.mud.yahoo.com>
	<4D84CF90.4060104@rabbitmq.com>
	<431712.78403.qm@web31802.mail.mud.yahoo.com>
	<66F360D5-AB78-4FEC-9874-592CF12F602B@vmware.com>
	<747873.7872.qm@web31801.mail.mud.yahoo.com>
	<C15A4C85-A461-4845-92BD-2C826C5453EE@vmware.com>
Message-ID: <307339.45118.qm@web31811.mail.mud.yahoo.com>

John,


> One more question. You say RabbitMQ crashes when you run these tests? And it 
>crashes without writing anything interesting in th logs? Or printing anything to 
>the console? It just exits?

It crashed without any errors in the log.  

I found a problem with my the amqp_consumer.c that I sent last week.  it did not 
send acknowledgement after consuming the messages.  Attached please find the 
updated amqp_consumer with ack enabled.  please use this for testing.

Currently the tests would send 3000 messages to each queue (MESSAGE_COUNT=3000 
in common.sh).
If you find some fast consumers already finish consuming 3000 messages much 
earlier than other consumers, please change MESSAGE_COUNT=5000.  this would 
reliably reproduce the broker crash.  if you ran 

"top | grep beam" while all 1000 consumers are running, you can see its memory 
usage grows to more than 3500 MB before it crashes.

Thanks.

-alex
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110329/ef6c2cfe/attachment-0001.htm>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: amqp_consumer.c
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110329/ef6c2cfe/attachment.txt>

From mikeb at rabbitmq.com  Tue Mar 29 12:35:55 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 29 Mar 2011 12:35:55 +0100
Subject: [rabbitmq-discuss] Help defining appropriate queue model
In-Reply-To: <AANLkTi=zVkut1_JhGMvi_Tj0UBmLdX+1quZLy7bXnQvW@mail.gmail.com>
References: <AANLkTimScpu9s7ny+Uu090ZB_cK6mU1Xa=bmvs54zmbu@mail.gmail.com>	<AANLkTin0ponp6E5yvxx4eU7OpDm5=MY9QiOKPWLiHqs=@mail.gmail.com>	<AANLkTinnbawLiJY_u3rfe+wWBSEa=ZVgAR6Oy_5=44wQ@mail.gmail.com>	<5A46D132C446C04B9EFE8AD14E78910696B33FA01C@SVR-2K3-BH-EMC.tradition.int>	<AANLkTinHjCTFLLsDKpM7jsAedp0AtVtAd=xPMbcN60Zd@mail.gmail.com>	<AANLkTimnTeMqfphuXUQ8DorVetjzxzyZ5KuQDUVQ9qAH@mail.gmail.com>	<4D6EE8B2.6030507@rabbitmq.com>	<AANLkTim+a3AYkvBNEP1Xo4K76HSbNHNzFCz3nLQtGb6P@mail.gmail.com>	<4D6F908E.2030209@rabbitmq.com>	<AANLkTimo-XAOsd_paeJAbud=RpzertM8oEPDPLHdacO4@mail.gmail.com>	<4D6FB9DC.2080800@rabbitmq.com>	<AANLkTi=rLYV90KSv4b8e=AcKiiukP=yPVy4vXLTpbCbA@mail.gmail.com>	<4D703B6C.6010608@rabbitmq.com>	<AANLkTik=+kvtcQmaaB-BWuq9QWFpxqrp1oDey5dPzvtU@mail.gmail.com>	<AANLkTik8M_Wr2O4+q_q33iEC2rxkrar6Zjsdy+p_7EfO@mail.gmail.com>	<4D8388F6.9000401@rabbitmq.com>
	<AANLkTi=zVkut1_JhGMvi_Tj0UBmLdX+1quZLy7bXnQvW@mail.gmail.com>
Message-ID: <4D91C41B.3070707@rabbitmq.com>

Fabio,

>     Right, at the minute the last values are transient. It probably
>     wouldn't take much coding to make it save things to disk for durable
>     exchanges.
>
>
> OK, that figures... :) I know nothing of Erlang, but I'll take an
> overall look and try to come up with an acceptable solution for my case.
> Would that be a feature useful enough that you'd consider including in
> your code?

Sure!  Here's a sketch: use two mnesia tables, one ram only, for 
non-durable exchanges, and one on disk, for durable exchanges.  In a 
single node this will be relatively easy; if you use a cluster, you'll 
need to find out which nodes have on-disk state.


Michael

From paulo.machado at ima-zlw-ifu.rwth-aachen.de  Tue Mar 29 14:03:26 2011
From: paulo.machado at ima-zlw-ifu.rwth-aachen.de (Paulo Machado)
Date: Tue, 29 Mar 2011 15:03:26 +0200
Subject: [rabbitmq-discuss] AMQP 1.0 implementation release plans
In-Reply-To: <4D8CA6D4.3090303@rabbitmq.com>
References: <9FD4F7E95B9DF94392137E39DCA67E099FA810@zlw-ima-exchg01.win.zlw-ima.rwth-aachen.de>
	<4D8CA6D4.3090303@rabbitmq.com>
Message-ID: <4D91D89E.709@ima-zlw-ifu.rwth-aachen.de>

On 03/25/2011 03:29 PM, Michael Bridgen wrote:
> There are not only plans, there is an implementation of AMQP 1.0 for 
> RabbitMQ: https://github.com/rabbitmq/rabbitmq-amqp1.0

Great, thanks. I have it up and running.
But I have another doubt, concerning the clients. Only the java client 
has a branch that's the same of the rabbitmq-server supporting the 
rabbitmq-amqp1.0(bug23749).
Does this means this is the only client that I can use to communicate 
with the ampq1.0 enabled broker?

tks

Regards
Paulo Machado

From mikeb at rabbitmq.com  Tue Mar 29 13:49:03 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 29 Mar 2011 13:49:03 +0100
Subject: [rabbitmq-discuss] AMQP 1.0 implementation release plans
In-Reply-To: <4D91D89E.709@ima-zlw-ifu.rwth-aachen.de>
References: <9FD4F7E95B9DF94392137E39DCA67E099FA810@zlw-ima-exchg01.win.zlw-ima.rwth-aachen.de>	<4D8CA6D4.3090303@rabbitmq.com>
	<4D91D89E.709@ima-zlw-ifu.rwth-aachen.de>
Message-ID: <4D91D53F.1020909@rabbitmq.com>

>> There are not only plans, there is an implementation of AMQP 1.0 for
>> RabbitMQ: https://github.com/rabbitmq/rabbitmq-amqp1.0
>
> Great, thanks. I have it up and running.
> But I have another doubt, concerning the clients. Only the java client
> has a branch that's the same of the rabbitmq-server supporting the
> rabbitmq-amqp1.0(bug23749).
> Does this means this is the only client that I can use to communicate
> with the ampq1.0 enabled broker?

We don't have any client implementations of AMQP 1.0.  The only one I 
know of in the wild is the de-facto "reference implementation" at 
http://github.com/rhs/amqp/

As I mentioned, the 1.0 specification in still in development.  May I 
ask why you are interested in 1.0 specifically?

Kind regards,
Michael

From stammailbox at gmail.com  Tue Mar 29 14:14:16 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Tue, 29 Mar 2011 15:14:16 +0200
Subject: [rabbitmq-discuss] How to define a timeout on jsonRpcClient
	calls
In-Reply-To: <4D910790.6090501@rabbitmq.com>
References: <AANLkTi=6QfUjMXiKeMz7d9mTqUC71RXWhUg7jXQKn46b@mail.gmail.com>
	<4D910790.6090501@rabbitmq.com>
Message-ID: <AANLkTi=4nWkNnQSFDSrt0ACpjyzcxxF1SeSF6uAQZUwh@mail.gmail.com>

Hi Emile,
Thanks for your   response.  I love it that you try not to leave questions
unanswered.

I saw the place you pointed for me to change (line 174). As I understand,
 you suggest I would change it and recompile the rabbitmq source ? That is
possible but it would be a pain every time I will want to upgrade a client
version.

so I have two questions
1. I know that you are being asked that question a lot - but can I get a
patch?
2. If I will go down in the root of changing the source -  you mentioned it
is an experience. Do you know if someone else did it and if it works fine?



On Tue, Mar 29, 2011 at 12:11 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> Op 27/03/2011 17:32, het mysurf mail geskryf:
>
>  How do I define a timeout for procedures using  jsonRpcClient calls
>>
>
> The present RPC implementation does not feature a timeout. If you want to
> experiment with a timeout then you can try to modify the 2-argument version
> of RpcClient.primitiveCall to use BlockingCell.uninterruptibleGet with a
> timeout. You will also need to add appropriate exception handling.
>
> Regards
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110329/fcfc7f76/attachment.htm>

From paulo.machado at ima-zlw-ifu.rwth-aachen.de  Tue Mar 29 14:51:52 2011
From: paulo.machado at ima-zlw-ifu.rwth-aachen.de (Paulo Machado)
Date: Tue, 29 Mar 2011 15:51:52 +0200
Subject: [rabbitmq-discuss] AMQP 1.0 implementation release plans
In-Reply-To: <4D91D53F.1020909@rabbitmq.com>
References: <9FD4F7E95B9DF94392137E39DCA67E099FA810@zlw-ima-exchg01.win.zlw-ima.rwth-aachen.de>
	<4D8CA6D4.3090303@rabbitmq.com>
	<4D91D89E.709@ima-zlw-ifu.rwth-aachen.de>
	<4D91D53F.1020909@rabbitmq.com>
Message-ID: <4D91E3F8.80205@ima-zlw-ifu.rwth-aachen.de>

On 03/29/2011 02:49 PM, Michael Bridgen wrote:
>>> There are not only plans, there is an implementation of AMQP 1.0 for
>>> RabbitMQ: https://github.com/rabbitmq/rabbitmq-amqp1.0
>>
>> Great, thanks. I have it up and running.
>> But I have another doubt, concerning the clients. Only the java client
>> has a branch that's the same of the rabbitmq-server supporting the
>> rabbitmq-amqp1.0(bug23749).
>> Does this means this is the only client that I can use to communicate
>> with the ampq1.0 enabled broker?
>
> We don't have any client implementations of AMQP 1.0.  The only one I 
> know of in the wild is the de-facto "reference implementation" at 
> http://github.com/rhs/amqp/
>
> As I mentioned, the 1.0 specification in still in development.  May I 
> ask why you are interested in 1.0 specifically?


As I answer to Rob Godfrey it's a matter of academic interest for brand 
new stuff, not realy a personal choice.


>
> Kind regards,
> Michael
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From stammailbox at gmail.com  Tue Mar 29 14:32:57 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Tue, 29 Mar 2011 15:32:57 +0200
Subject: [rabbitmq-discuss] Using listeners in json rpc server/client
Message-ID: <AANLkTikeS5mEs+EU2BTn1jDHkwvsXBHJJSAHmz=wQ-1L@mail.gmail.com>

Hi,
I am trying to detach two processes to two different machines using jsonrpc
server/client architecture (which gives me a very nice solution).
currently  I only have to deal with listeners issue.

Explanation:
 process in components A used to send listeners subscribing to certain data
To Component B .

Now, Component A,B being in different computers I cant send te listener in
the remote rpc solution.
The listener that will be re-created in server B will have to open Channel
to send the data to channel A.
It seems that for this part only I should use the  regular queuing system in
rabbit .
Each client will open a different queue and will add routing keys with the
data it needs to subscribe to.

My questions:
1. Is that design good? In places there used to be listeners transport
for subscribing to data I  will leave the jsonrpc solution and the
listeners?
2. what is the reccomended way to choose a name for the queue for each
client
* Currently I am using uuid as the queue name when a client opens it and I
send it also to the server.
* I cant get the computer name (I dont use JNI) and I dont want to put it in
property file.
3. When a client dies sudddenly (unexpected ) who will close his queue ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110329/193b2a5b/attachment.htm>

From gmr at myyearbook.com  Tue Mar 29 14:45:37 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Tue, 29 Mar 2011 09:45:37 -0400
Subject: [rabbitmq-discuss] AMQP 1.0 implementation release plans
In-Reply-To: <4D91E3F8.80205@ima-zlw-ifu.rwth-aachen.de>
References: <9FD4F7E95B9DF94392137E39DCA67E099FA810@zlw-ima-exchg01.win.zlw-ima.rwth-aachen.de>
	<4D8CA6D4.3090303@rabbitmq.com>
	<4D91D89E.709@ima-zlw-ifu.rwth-aachen.de>
	<4D91D53F.1020909@rabbitmq.com>
	<4D91E3F8.80205@ima-zlw-ifu.rwth-aachen.de>
Message-ID: <E085D3FF06A24384A9651A8465CD0F12@myyearbook.com>


On Tuesday, March 29, 2011 at 9:51 AM, Paulo Machado wrote: 
> On 03/29/2011 02:49 PM, Michael Bridgen wrote:
> > As I mentioned, the 1.0 specification in still in development. May I 
> > ask why you are interested in 1.0 specifically?
> 
> 
> As I answer to Rob Godfrey it's a matter of academic interest for brand 
> new stuff, not realy a personal choice.
I can't speak for other people who maintain clients, but I'm not likely to look at adding 1-0 support to Pika until the spec is finalized and RabbitMQ releases a stable 1-0 release. 

Michael, is there even a 1-0 codegen xml/json file yet?

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110329/065257b8/attachment-0001.htm>

From emile at rabbitmq.com  Tue Mar 29 14:48:09 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 29 Mar 2011 14:48:09 +0100
Subject: [rabbitmq-discuss] How to define a timeout on jsonRpcClient
	calls
In-Reply-To: <AANLkTi=4nWkNnQSFDSrt0ACpjyzcxxF1SeSF6uAQZUwh@mail.gmail.com>
References: <AANLkTi=6QfUjMXiKeMz7d9mTqUC71RXWhUg7jXQKn46b@mail.gmail.com>	<4D910790.6090501@rabbitmq.com>
	<AANLkTi=4nWkNnQSFDSrt0ACpjyzcxxF1SeSF6uAQZUwh@mail.gmail.com>
Message-ID: <4D91E319.5070005@rabbitmq.com>

Hi,

On 29/03/11 14:14, mysurf mail wrote:

> I saw the place you pointed for me to change (line 174). As I
> understand,  you suggest I would change it and recompile the rabbitmq
> source ? That is possible but it would be a pain every time I will want
> to upgrade a client version.

I agree - it is not convenient to maintain your own set of patches. We 
are planning on introducing this feature in the core library though.

> so I have two questions
> 1. I know that you are being asked that question a lot - but can I get a
> patch?

We prefer to distribute code via the rabbit source repositories, rather 
than patches.

> 2. If I will go down in the root of changing the source -  you mentioned
> it is an experience. Do you know if someone else did it and if it works
> fine?

A bug has been filed to implement your suggestion. The implementation 
will appear on the branch named "bug23515". Unfortunately it is not 
possible to predict when this might be complete, but keep an eye on 
future release notes.


Regards

Emile

From mikeb at rabbitmq.com  Tue Mar 29 14:52:38 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Tue, 29 Mar 2011 14:52:38 +0100
Subject: [rabbitmq-discuss] AMQP 1.0 implementation release plans
In-Reply-To: <E085D3FF06A24384A9651A8465CD0F12@myyearbook.com>
References: <9FD4F7E95B9DF94392137E39DCA67E099FA810@zlw-ima-exchg01.win.zlw-ima.rwth-aachen.de>	<4D8CA6D4.3090303@rabbitmq.com>	<4D91D89E.709@ima-zlw-ifu.rwth-aachen.de>	<4D91D53F.1020909@rabbitmq.com>	<4D91E3F8.80205@ima-zlw-ifu.rwth-aachen.de>
	<E085D3FF06A24384A9651A8465CD0F12@myyearbook.com>
Message-ID: <4D91E426.2070005@rabbitmq.com>

>>> As I mentioned, the 1.0 specification in still in development. May I
>>> ask why you are interested in 1.0 specifically?
>>
>>
>> As I answer to Rob Godfrey it's a matter of academic interest for brand
>> new stuff, not realy a personal choice.

> I can't speak for other people who maintain clients, but I'm not likely
> to look at adding 1-0 support to Pika until the spec is finalized and
> RabbitMQ releases a stable 1-0 release.

Sensible.

> Michael, is there even a 1-0 codegen xml/json file yet?

One could probably generate frame types from 
https://github.com/rhs/amqp/blob/master/transport.xml, but we don't at 
the minute.

mkb

From emile at rabbitmq.com  Tue Mar 29 15:02:42 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 29 Mar 2011 15:02:42 +0100
Subject: [rabbitmq-discuss] Fault-tolerant subscriptions using the .NET
 client
In-Reply-To: <glpkmc5gris3y5phdhjezwJv4X.penango@mail.gmail.com>
References: <gloz7ig9l7c8fgroaxjezwJv4X.penango@mail.gmail.com>
	<glpkmc5gris3y5phdhjezwJv4X.penango@mail.gmail.com>
Message-ID: <4D91E682.2060306@rabbitmq.com>

Hi OJ,

On 25/03/11 20:35, OJ Reeves wrote:

> I am surprised to hear that the Dispose() method is called when the
> connection is broken yet subsequent calls to subscription.Next()
> continue to function and return 'true'. This seems a little
> counter-intuitive to me. I would expect that attempting to called Next()
> on a subscription that has been disposed would result in some kind of error.

That's not what I see. As soon as a connection error occurs, the 
subscription is disposed and calls to Next() return null. Perhaps 
Dispose() is not getting called in your case. One possible reason for 
that is an incorrectly trapped exception.

Regards

Emile

From emile at rabbitmq.com  Tue Mar 29 15:17:45 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 29 Mar 2011 15:17:45 +0100
Subject: [rabbitmq-discuss] problems with parameters in jsonrpc
In-Reply-To: <AANLkTiks5-bM58HbST7bB-UXzJ+UMab9xBrx5pnTidgY@mail.gmail.com>
References: <AANLkTi=XZGQkRg01OZy4rVbbaC0zrVjMWaMhwr3Ot-7+@mail.gmail.com>	<4D8A0DE5.5000608@rabbitmq.com>
	<AANLkTiks5-bM58HbST7bB-UXzJ+UMab9xBrx5pnTidgY@mail.gmail.com>
Message-ID: <4D91EA09.9040000@rabbitmq.com>

Hi,

On 23/03/11 15:33, mysurf mail wrote:

> I would prefer though if it was gson serialization to the params (as the
> name hints).
> thanks.

Unfortunately that is unlikely to happen. There are several JSON 
libraries available with different strengths and weaknesses. If the 
supplied serialisation classes don't meet your needs then you should be 
able to adapt the code for use with your choice of library with relative 
ease. You are invited to fork the rabbit git repository if others might 
benefit from your changes:

https://github.com/rabbitmq/rabbitmq-java-client



Regards

Emile

From bruce.bushby at gmail.com  Tue Mar 29 15:26:10 2011
From: bruce.bushby at gmail.com (bruce bushby)
Date: Tue, 29 Mar 2011 15:26:10 +0100
Subject: [rabbitmq-discuss] "local queue" ...."remote queue"
In-Reply-To: <20110328165050.GG18713@rabbitmq.com>
References: <AANLkTi=VRXJ4yNQriuU5SceNw-v9ZFcOuFxCaAcZiW6V@mail.gmail.com>
	<20110328165050.GG18713@rabbitmq.com>
Message-ID: <AANLkTi=KG4x9MLRXpkNrbDXOQbU5oRusPHT79kphbNgp@mail.gmail.com>

Hi Matthew

"....shovel plugin" sounds very interesting and from what you've
described....exactly what I'm after, thank you!

I'll look into it tonight and update the discussion with any success!

Bruce





On Mon, Mar 28, 2011 at 5:50 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> Hi Bruce,
>
> On Fri, Mar 25, 2011 at 12:05:46PM +0000, bruce bushby wrote:
> > I was wondering what others are doing with regards to "queuing" local
> > messages for deliver when the network is available.
> >
> > From my limited experience playing to "rabbitmq-c client" and Python
> "pika",
> > their focus is the ability to deliver a message immediately and report an
> > error if they cannot contact the server.
> >
> > Implementing messaging from a M2M platform, there will be times when
> there
> > is no communication between the client and the server...but the
> application
> > may still want to submit messages which should be queued until such time
> as
> > the "local queue" so to speak can contact the server and delivery the
> > messages.
> >
> > In summary, leaving the "retry/retransmission" of message to the
> > messaging infrastructure...rather then have the application monitor/poll
> > connectivity to the server.
> >
> > Is something like this possible?
>
> Yes. What we recommend is that you have Rabbit installed locally, and
> then configure it with the shovel plugin which will periodically try to
> connect to the "downstream" Rabbit and send the messages out. One nice
> way to configure this is to have the same exchange name on the local and
> remote broker, but on the local, it's a fanout. On the remote it can be
> whatever you need it to be. Then, the shovel, local, can just create a
> single queue and catch everything sent to the local exchange. When it
> connects to the downstream remote broker, it'll republish the msgs to
> the same exchange name, but because the type of the exchange there can
> be different, all sorts of other routing decisions can take place as
> needed. I.e. it ensures that the local broker topology can be as simple
> as possible (one exchange, one queue, one shovel).
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110329/1986fac6/attachment.htm>

From emile at rabbitmq.com  Tue Mar 29 15:50:21 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 29 Mar 2011 15:50:21 +0100
Subject: [rabbitmq-discuss] Using listeners in json rpc server/client
In-Reply-To: <AANLkTikeS5mEs+EU2BTn1jDHkwvsXBHJJSAHmz=wQ-1L@mail.gmail.com>
References: <AANLkTikeS5mEs+EU2BTn1jDHkwvsXBHJJSAHmz=wQ-1L@mail.gmail.com>
Message-ID: <4D91F1AD.7020309@rabbitmq.com>

On 29/03/11 14:32, mysurf mail wrote:

> 1. Is that design good? In places there used to be listeners
> transport for subscribing to data I  will leave the jsonrpc solution
> and the listeners?

In a heterogeneous environment different components can communicate with 
each other via a broker, regardless of their address. If that is your 
design then it's good.

> 2. what is the reccomended way to choose a name for the queue for
> each client

You should name queues in a way that makes sense in your application. If 
queues are transient or the name doesn't matter then you can have the 
broker assign random names by supplying an empty string for the queue name.

> 3. When a client dies sudddenly (unexpected ) who will close his
> queue ?

You can set the queue to be auto-delete. When the last consumer 
disconnects the queue will then be deleted automatically.

Regards

Emile

From lakemalcom at gmail.com  Tue Mar 29 18:19:21 2011
From: lakemalcom at gmail.com (Luke McCollum)
Date: Tue, 29 Mar 2011 10:19:21 -0700
Subject: [rabbitmq-discuss] Rabbit MQ crashes on startup?
Message-ID: <AANLkTimzvP2mGmOZ92C0q=20hiBhfobmh8cB9vFaseCY@mail.gmail.com>

I get this:


Starting rabbitmq-server: TIMEOUT - check /var/log/rabbitmq/startup_{log,err}


The startup log/err files are both empty, but in the main log, I see this:

=INFO REPORT==== 29-Mar-2011::09:55:40 ===
Limiting to approx 924 file handles

=INFO REPORT==== 29-Mar-2011::09:55:40 ===
Memory limit set to 196MB.

=INFO REPORT==== 29-Mar-2011::09:55:40 ===
Rolling persister log to
"/var/lib/rabbitmq/mnesia/rabbit at vm-lb-01/rabbit_persister.LOG.previous"

=INFO REPORT==== 29-Mar-2011::09:55:40 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 29-Mar-2011::09:55:43 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:59103

=INFO REPORT==== 29-Mar-2011::09:55:43 ===
starting TCP connection <0.197.0> from 127.0.0.1:59103

=INFO REPORT==== 29-Mar-2011::09:55:44 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:59118

=INFO REPORT==== 29-Mar-2011::09:55:44 ===
starting TCP connection <0.206.0> from 127.0.0.1:59118

=WARNING REPORT==== 29-Mar-2011::09:55:46 ===
exception on TCP connection <0.197.0> from 127.0.0.1:59103
connection_closed_abruptly

=INFO REPORT==== 29-Mar-2011::09:55:46 ===
closing TCP connection <0.197.0> from 127.0.0.1:59103

=INFO REPORT==== 29-Mar-2011::09:55:50 ===
Rolling persister log to
"/var/lib/rabbitmq/mnesia/rabbit at vm-lb-01/rabbit_persister.LOG.previous"

=ERROR REPORT==== 29-Mar-2011::09:55:50 ===
** Generic server rabbit_persister terminating
** Last message in was timeout
** When Server state == {pstate,rabbit_persister,0,infinity,[],[],
                            {psnapshot,
                                {dict,0,16,16,8,80,48,
                                    {[],[],[],[],[],[],[],[],[],[],[],[],[],
                                     [],[],[]},
                                    {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                                      [],[],[]}}},
                                135217,139314,0}}
** Reason for termination ==
** {{badmatch,{error,{file_error,"/var/lib/rabbitmq/mnesia/rabbit at vm-lb-01/rabbit_persister.LOG",
                                 enospc}}},
    [{rabbit_persister,take_snapshot,3},
     {rabbit_persister,take_snapshot,2},
     {rabbit_persister,maybe_take_snapshot,2},
     {rabbit_persister,flush,2},
     {rabbit_persister,handle_info,2},
     {gen_server,handle_msg,5},
     {proc_lib,init_p_do_apply,3}]}

=INFO REPORT==== 29-Mar-2011::09:55:50 ===
stopped TCP Listener on 0.0.0.0:5672

=ERROR REPORT==== 29-Mar-2011::09:55:50 ===
** gen_event handler rabbit_sasl_report_file_h crashed.
** Was installed in error_logger
** Last event was: {error_report,<0.9.0>,
                    {<0.180.0>,crash_report,
                     [[{initial_call,
                        {disk_log,init,['Argument__1','Argument__2']}},
                       {pid,<0.180.0>},
                       {registered_name,[]},
                       {error_info,
                        {exit,
                         {{failed,
                           {error,
                            {file_error,

"/var/lib/rabbitmq/mnesia/rabbit at vm-lb-01/rabbit_persister.LOG",
                             enospc}}},
                          [{disk_log,reopen,3}]},
                         [{disk_log,do_exit,4},{proc_lib,init_p_do_apply,3}]}},
                       {ancestors,
                        [disk_log_sup,kernel_safe_sup,kernel_sup,<0.10.0>]},
                       {messages,[]},
                       {links,[<0.78.0>]},
                       {dictionary,[]},
                       {trap_exit,true},
                       {status,running},
                       {heap_size,610},
                       {stack_size,24},
                       {reductions,4523}],
                      []]}}
** When handler state == {<0.48.0>,
                          "/var/log/rabbitmq/rabbit at vm-lb-01-sasl.log",error}
** Reason == {badarg,[{io,format,
                          [<0.48.0>,
                           ["\n",61,"CRASH REPORT",61,61,61,61,32,"29",45,
                            "Mar",45,"2011",58,58,"09",58,"55",58,"50",32,61,
                            61,61,"\n",126,115],
                           ["  crasher:\n    initial call:
disk_log:init/2\n    pid: <0.180.0>\n    registered_name: [


What is wrong?

From lakemalcom at gmail.com  Tue Mar 29 18:26:59 2011
From: lakemalcom at gmail.com (Luke McCollum)
Date: Tue, 29 Mar 2011 10:26:59 -0700
Subject: [rabbitmq-discuss] Rabbit MQ crashes on startup?
In-Reply-To: <AANLkTimzvP2mGmOZ92C0q=20hiBhfobmh8cB9vFaseCY@mail.gmail.com>
References: <AANLkTimzvP2mGmOZ92C0q=20hiBhfobmh8cB9vFaseCY@mail.gmail.com>
Message-ID: <AANLkTim0_PwY1gg-hG1QLcFTf8abMayqpy9FHvwkmELe@mail.gmail.com>

I think I found my own answer! It looks like the tiny disk on this
virtual machine is full. Whoops!

On Tue, Mar 29, 2011 at 10:19 AM, Luke McCollum <lakemalcom at gmail.com> wrote:
> I get this:
>
>
> Starting rabbitmq-server: TIMEOUT - check /var/log/rabbitmq/startup_{log,err}
>
>
> The startup log/err files are both empty, but in the main log, I see this:
>
> =INFO REPORT==== 29-Mar-2011::09:55:40 ===
> Limiting to approx 924 file handles
>
> =INFO REPORT==== 29-Mar-2011::09:55:40 ===
> Memory limit set to 196MB.
>
> =INFO REPORT==== 29-Mar-2011::09:55:40 ===
> Rolling persister log to
> "/var/lib/rabbitmq/mnesia/rabbit at vm-lb-01/rabbit_persister.LOG.previous"
>
> =INFO REPORT==== 29-Mar-2011::09:55:40 ===
> started TCP Listener on 0.0.0.0:5672
>
> =INFO REPORT==== 29-Mar-2011::09:55:43 ===
> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:59103
>
> =INFO REPORT==== 29-Mar-2011::09:55:43 ===
> starting TCP connection <0.197.0> from 127.0.0.1:59103
>
> =INFO REPORT==== 29-Mar-2011::09:55:44 ===
> accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:59118
>
> =INFO REPORT==== 29-Mar-2011::09:55:44 ===
> starting TCP connection <0.206.0> from 127.0.0.1:59118
>
> =WARNING REPORT==== 29-Mar-2011::09:55:46 ===
> exception on TCP connection <0.197.0> from 127.0.0.1:59103
> connection_closed_abruptly
>
> =INFO REPORT==== 29-Mar-2011::09:55:46 ===
> closing TCP connection <0.197.0> from 127.0.0.1:59103
>
> =INFO REPORT==== 29-Mar-2011::09:55:50 ===
> Rolling persister log to
> "/var/lib/rabbitmq/mnesia/rabbit at vm-lb-01/rabbit_persister.LOG.previous"
>
> =ERROR REPORT==== 29-Mar-2011::09:55:50 ===
> ** Generic server rabbit_persister terminating
> ** Last message in was timeout
> ** When Server state == {pstate,rabbit_persister,0,infinity,[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{psnapshot,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{dict,0,16,16,8,80,48,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? [],[],[]},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?{{[],[],[],[],[],[],[],[],[],[],[],[],[],
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?[],[],[]}}},
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?135217,139314,0}}
> ** Reason for termination ==
> ** {{badmatch,{error,{file_error,"/var/lib/rabbitmq/mnesia/rabbit at vm-lb-01/rabbit_persister.LOG",
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? enospc}}},
> ? ?[{rabbit_persister,take_snapshot,3},
> ? ? {rabbit_persister,take_snapshot,2},
> ? ? {rabbit_persister,maybe_take_snapshot,2},
> ? ? {rabbit_persister,flush,2},
> ? ? {rabbit_persister,handle_info,2},
> ? ? {gen_server,handle_msg,5},
> ? ? {proc_lib,init_p_do_apply,3}]}
>
> =INFO REPORT==== 29-Mar-2011::09:55:50 ===
> stopped TCP Listener on 0.0.0.0:5672
>
> =ERROR REPORT==== 29-Mar-2011::09:55:50 ===
> ** gen_event handler rabbit_sasl_report_file_h crashed.
> ** Was installed in error_logger
> ** Last event was: {error_report,<0.9.0>,
> ? ? ? ? ? ? ? ? ? ?{<0.180.0>,crash_report,
> ? ? ? ? ? ? ? ? ? ? [[{initial_call,
> ? ? ? ? ? ? ? ? ? ? ? ?{disk_log,init,['Argument__1','Argument__2']}},
> ? ? ? ? ? ? ? ? ? ? ? {pid,<0.180.0>},
> ? ? ? ? ? ? ? ? ? ? ? {registered_name,[]},
> ? ? ? ? ? ? ? ? ? ? ? {error_info,
> ? ? ? ? ? ? ? ? ? ? ? ?{exit,
> ? ? ? ? ? ? ? ? ? ? ? ? {{failed,
> ? ? ? ? ? ? ? ? ? ? ? ? ? {error,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?{file_error,
>
> "/var/lib/rabbitmq/mnesia/rabbit at vm-lb-01/rabbit_persister.LOG",
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? enospc}}},
> ? ? ? ? ? ? ? ? ? ? ? ? ?[{disk_log,reopen,3}]},
> ? ? ? ? ? ? ? ? ? ? ? ? [{disk_log,do_exit,4},{proc_lib,init_p_do_apply,3}]}},
> ? ? ? ? ? ? ? ? ? ? ? {ancestors,
> ? ? ? ? ? ? ? ? ? ? ? ?[disk_log_sup,kernel_safe_sup,kernel_sup,<0.10.0>]},
> ? ? ? ? ? ? ? ? ? ? ? {messages,[]},
> ? ? ? ? ? ? ? ? ? ? ? {links,[<0.78.0>]},
> ? ? ? ? ? ? ? ? ? ? ? {dictionary,[]},
> ? ? ? ? ? ? ? ? ? ? ? {trap_exit,true},
> ? ? ? ? ? ? ? ? ? ? ? {status,running},
> ? ? ? ? ? ? ? ? ? ? ? {heap_size,610},
> ? ? ? ? ? ? ? ? ? ? ? {stack_size,24},
> ? ? ? ? ? ? ? ? ? ? ? {reductions,4523}],
> ? ? ? ? ? ? ? ? ? ? ?[]]}}
> ** When handler state == {<0.48.0>,
> ? ? ? ? ? ? ? ? ? ? ? ? ?"/var/log/rabbitmq/rabbit at vm-lb-01-sasl.log",error}
> ** Reason == {badarg,[{io,format,
> ? ? ? ? ? ? ? ? ? ? ? ? ?[<0.48.0>,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ["\n",61,"CRASH REPORT",61,61,61,61,32,"29",45,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?"Mar",45,"2011",58,58,"09",58,"55",58,"50",32,61,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ?61,61,"\n",126,115],
> ? ? ? ? ? ? ? ? ? ? ? ? ? [" ?crasher:\n ? ?initial call:
> disk_log:init/2\n ? ?pid: <0.180.0>\n ? ?registered_name: [
>
>
> What is wrong?
>

From matthias at rabbitmq.com  Tue Mar 29 18:35:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 29 Mar 2011 18:35:10 +0100
Subject: [rabbitmq-discuss] Rabbit MQ crashes on startup?
In-Reply-To: <AANLkTim0_PwY1gg-hG1QLcFTf8abMayqpy9FHvwkmELe@mail.gmail.com>
References: <AANLkTimzvP2mGmOZ92C0q=20hiBhfobmh8cB9vFaseCY@mail.gmail.com>
	<AANLkTim0_PwY1gg-hG1QLcFTf8abMayqpy9FHvwkmELe@mail.gmail.com>
Message-ID: <4D92184E.4070004@rabbitmq.com>

Luke,

On 29/03/11 18:26, Luke McCollum wrote:
> It looks like the tiny disk on this virtual machine is full.

Indeed it is.

Btw, you are running a rather ancient version of rabbit. I strongly 
recommend you upgrade.


Regards,

Matthias.

From jasonjwwilliams at gmail.com  Tue Mar 29 20:44:01 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 29 Mar 2011 13:44:01 -0600
Subject: [rabbitmq-discuss] Rolling upgrade of a cluster
Message-ID: <AANLkTikjfrMn4PGhr6nRm6QPWqFYNtL1tJmjtMy1p-j7@mail.gmail.com>

When you upgrade a cluster from one version (>2.1.1) to another by simply
unpacking the new version of RabbitMQ and doing a rolling upgrade, do you
just lose the queues and queue contents, or do you also lose the exchange,
vhost and permission definitions?

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110329/5ad7a834/attachment.htm>

From simon at rabbitmq.com  Tue Mar 29 21:57:22 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 29 Mar 2011 21:57:22 +0100
Subject: [rabbitmq-discuss] Rolling upgrade of a cluster
In-Reply-To: <AANLkTikjfrMn4PGhr6nRm6QPWqFYNtL1tJmjtMy1p-j7@mail.gmail.com>
References: <AANLkTikjfrMn4PGhr6nRm6QPWqFYNtL1tJmjtMy1p-j7@mail.gmail.com>
Message-ID: <4D9247B2.5000301@rabbitmq.com>

On 29/03/2011 8:44PM, Jason J. W. Williams wrote:
> When you upgrade a cluster from one version (>2.1.1) to another by
> simply unpacking the new version of RabbitMQ and doing a rolling
> upgrade, do you just lose the queues and queue contents, or do you also
> lose the exchange, vhost and permission definitions?

You lose everything.

But - exciting news! We recently merged the cluster upgrade code, so the 
next release will upgrade >= 2.1.1 clusters *almost* seamlessly[0].

Cheers, Simon

[0] You have to shut the cluster down to do the upgrade, and pay a tiny 
bit of attention to the order you do things in.

From jasonjwwilliams at gmail.com  Tue Mar 29 22:01:22 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 29 Mar 2011 15:01:22 -0600
Subject: [rabbitmq-discuss] Rolling upgrade of a cluster
In-Reply-To: <4D9247B2.5000301@rabbitmq.com>
References: <AANLkTikjfrMn4PGhr6nRm6QPWqFYNtL1tJmjtMy1p-j7@mail.gmail.com>
	<4D9247B2.5000301@rabbitmq.com>
Message-ID: <AANLkTimMFnw_92uu3xo-nsJXpJZmTL1+7i25OriLqiiC@mail.gmail.com>

>
>
> But - exciting news! We recently merged the cluster upgrade code, so the
> next release will upgrade >= 2.1.1 clusters *almost* seamlessly[0].
>
> Cheers, Simon
>
> [0] You have to shut the cluster down to do the upgrade, and pay a tiny bit
> of attention to the order you do things in.
>

OK so you won't lose everything but you will have downtime. Is rolling
upgrade on the roadmap?

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110329/a9336189/attachment.htm>

From matthew at rabbitmq.com  Tue Mar 29 22:03:57 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 29 Mar 2011 22:03:57 +0100
Subject: [rabbitmq-discuss] Rolling upgrade of a cluster
In-Reply-To: <AANLkTimMFnw_92uu3xo-nsJXpJZmTL1+7i25OriLqiiC@mail.gmail.com>
References: <AANLkTikjfrMn4PGhr6nRm6QPWqFYNtL1tJmjtMy1p-j7@mail.gmail.com>
	<4D9247B2.5000301@rabbitmq.com>
	<AANLkTimMFnw_92uu3xo-nsJXpJZmTL1+7i25OriLqiiC@mail.gmail.com>
Message-ID: <20110329210357.GT4716@wellquite.org>

On Tue, Mar 29, 2011 at 03:01:22PM -0600, Jason J. W. Williams wrote:
> OK so you won't lose everything but you will have downtime. Is rolling
> upgrade on the roadmap?

Yes, but it's a long way away.

Matthew

From jasonjwwilliams at gmail.com  Tue Mar 29 22:15:37 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 29 Mar 2011 15:15:37 -0600
Subject: [rabbitmq-discuss] Rolling upgrade of a cluster
In-Reply-To: <20110329210357.GT4716@wellquite.org>
References: <AANLkTikjfrMn4PGhr6nRm6QPWqFYNtL1tJmjtMy1p-j7@mail.gmail.com>
	<4D9247B2.5000301@rabbitmq.com>
	<AANLkTimMFnw_92uu3xo-nsJXpJZmTL1+7i25OriLqiiC@mail.gmail.com>
	<20110329210357.GT4716@wellquite.org>
Message-ID: <AANLkTik95e_rBvhMNruO_3_retKJRqfCJdDQFWAgv9RM@mail.gmail.com>

On Tue, Mar 29, 2011 at 3:03 PM, Matthew Sackman <matthew at rabbitmq.com>wrote:

> On Tue, Mar 29, 2011 at 03:01:22PM -0600, Jason J. W. Williams wrote:
> > OK so you won't lose everything but you will have downtime. Is rolling
> > upgrade on the roadmap?
>
> Yes, but it's a long way away.


That's good to know. I suppose the amount of downtime needed for the
automatic upgrade to complete will vary by the number of queues and metadata
to be migrated?

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110329/0f5f7c3c/attachment-0001.htm>

From matthew at rabbitmq.com  Tue Mar 29 22:36:47 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 29 Mar 2011 22:36:47 +0100
Subject: [rabbitmq-discuss] Rolling upgrade of a cluster
In-Reply-To: <AANLkTik95e_rBvhMNruO_3_retKJRqfCJdDQFWAgv9RM@mail.gmail.com>
References: <AANLkTikjfrMn4PGhr6nRm6QPWqFYNtL1tJmjtMy1p-j7@mail.gmail.com>
	<4D9247B2.5000301@rabbitmq.com>
	<AANLkTimMFnw_92uu3xo-nsJXpJZmTL1+7i25OriLqiiC@mail.gmail.com>
	<20110329210357.GT4716@wellquite.org>
	<AANLkTik95e_rBvhMNruO_3_retKJRqfCJdDQFWAgv9RM@mail.gmail.com>
Message-ID: <20110329213646.GU4716@wellquite.org>

On Tue, Mar 29, 2011 at 03:15:37PM -0600, Jason J. W. Williams wrote:
> That's good to know. I suppose the amount of downtime needed for the
> automatic upgrade to complete will vary by the number of queues and metadata
> to be migrated?

Depends on the nature of the upgrade steps to be performed. Worst case
is linear on the number of msgs on disk, but upgrades like that only
happen when we change the on-disk format, which doesn't happen very
often.

Matthew

From jasonjwwilliams at gmail.com  Tue Mar 29 22:41:01 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 29 Mar 2011 15:41:01 -0600
Subject: [rabbitmq-discuss] Rolling upgrade of a cluster
In-Reply-To: <20110329213646.GU4716@wellquite.org>
References: <AANLkTikjfrMn4PGhr6nRm6QPWqFYNtL1tJmjtMy1p-j7@mail.gmail.com>
	<4D9247B2.5000301@rabbitmq.com>
	<AANLkTimMFnw_92uu3xo-nsJXpJZmTL1+7i25OriLqiiC@mail.gmail.com>
	<20110329210357.GT4716@wellquite.org>
	<AANLkTik95e_rBvhMNruO_3_retKJRqfCJdDQFWAgv9RM@mail.gmail.com>
	<20110329213646.GU4716@wellquite.org>
Message-ID: <AANLkTi=0uypFZDGbVBSMS64eLZ7qwQ=RtoKLmnXkPR2=@mail.gmail.com>

>
> Depends on the nature of the upgrade steps to be performed. Worst case
> is linear on the number of msgs on disk, but upgrades like that only
> happen when we change the on-disk format, which doesn't happen very
> often.


That makes sense. Thanks for explaining.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110329/e7333c21/attachment.htm>

From jasonjwwilliams at gmail.com  Tue Mar 29 23:19:45 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 29 Mar 2011 16:19:45 -0600
Subject: [rabbitmq-discuss] Replacement for rabbitmq-multi
Message-ID: <AANLkTi=xWfrL=TA01-T8kqWZpYVFvLaaO0H7HDdgiUeS@mail.gmail.com>

What is the rabbitmq-multi replacement for starting a cluster on your local
machine?

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110329/4e86ab90/attachment.htm>

From jdetreville at vmware.com  Wed Mar 30 01:38:39 2011
From: jdetreville at vmware.com (John DeTreville)
Date: Tue, 29 Mar 2011 17:38:39 -0700
Subject: [rabbitmq-discuss] browse messages on a queue
In-Reply-To: <AANLkTimK4UmT7Ue_o1HG2mN_bRuScz7URk2F1Sk716n_@mail.gmail.com>
References: <9319F360221C65428EA819A4E8DC34ED028DF6395D@OPMBOX21UK.options-it.com>
	<9968CC83-00A5-4320-8D30-999599BAF2EF@vmware.com>
	<AANLkTimK4UmT7Ue_o1HG2mN_bRuScz7URk2F1Sk716n_@mail.gmail.com>
Message-ID: <F4E874F1-E70E-48DE-AF24-724F40D49D37@vmware.com>

I've taken the conversation with Jim Irrer off-line. Sorry.

Cheers,
John

On Mar 21, 2011, at 9:14 AM, Jim Irrer wrote:

John -

I was in the process of writing a plugin to get the same functionality:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-March/011936.html

What is the time frame for yours?

I had already been working some ideas for functionality, including writing to
a device or a database, and would like to know more details of what
you are doing.

Thanks,

- Jim

Jim Irrer     irrer at umich.edu<mailto:irrer at umich.edu>       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Mon, Mar 21, 2011 at 1:46 AM, John DeTreville <jdetreville at vmware.com<mailto:jdetreville at vmware.com>> wrote:
Joe,

RabbitMQ lets you write your own plug-ins for storing queues. We're producing a few accompanying samples now, including one that stores all messages in a MySQL database. Its performance might be much lower than the standard queue implementation, but it would allow you to watch messages go by.

This MySQL plug-in should be out soon, but certainly not this month.

Cheers,
John

On Mar 18, 2011, at 10:33 AM, Kearney, Joe wrote:

> Hi,
>
> I'm interested in finding or writing a tool to monitor messages on a rabbit queue, in particular to be able to view messages waiting on the queue. The use case is for occasional monitoring and debugging; I'm not suggesting using a browse/read-only function in normal processing.
>
> This was raised on this mail group last July (http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2010-July/008004.html). Two pertinent quotes from that thread:
>
>> The only way you can get at the messages is through the normal AMQP methods that consume the messages (basic.consume and basic.get).  But these are not simple read-only operations of the type you might want for monitoring of the messages within a queue.
>
>> it's actually quite hard to come up with a sensible semantics for it that isn't too constraining on implementations
>
> Has there been any progress on a built-in way to do this? Any thoughts on when/whether this might be introduced?
>
> Alternatively, can you comment on a sensible way to fake it? The naive implementation that springs to mind is simply to get a few messages from the head of the queue in a transaction and roll it back. Clearly this is more heavyweight than it need be, but are there any reasons that this behaviour should really be avoided for manual monitoring, until such a time as real read-only browsing is supported?
>
> Thanks,
> Joe
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From jdetreville at vmware.com  Wed Mar 30 02:34:12 2011
From: jdetreville at vmware.com (John DeTreville)
Date: Tue, 29 Mar 2011 18:34:12 -0700
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <20110328213321.GA2406@wellquite.org>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>	<20110318171120.GM2414@rabbitmq.com>
	<819166.65905.qm@web31806.mail.mud.yahoo.com>
	<4D84CF90.4060104@rabbitmq.com>
	<431712.78403.qm@web31802.mail.mud.yahoo.com>
	<66F360D5-AB78-4FEC-9874-592CF12F602B@vmware.com>
	<747873.7872.qm@web31801.mail.mud.yahoo.com>
	<F1A58F27-8C33-428A-8256-B4C486A7BBCE@vmware.com>
	<20110328213321.GA2406@wellquite.org>
Message-ID: <33B3713B-277F-47BF-8038-E039D798934F@vmware.com>

I think you mean "ulimit -u", but you're right.

Cheers,
John

On Mar 28, 2011, at 2:33 PM, Matthew Sackman wrote:

> On Mon, Mar 28, 2011 at 02:21:28PM -0700, John DeTreville wrote:
>> My ulimit says "unimited."
> 
> From man bash: "If no option is given, then -f is assumed". I.e. it's
> reporting by default the maximum file size. You want "ulimit -n"
> 
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jdetreville at vmware.com  Wed Mar 30 02:54:58 2011
From: jdetreville at vmware.com (John DeTreville)
Date: Tue, 29 Mar 2011 18:54:58 -0700
Subject: [rabbitmq-discuss] server crashes with very fast consumers
In-Reply-To: <307339.45118.qm@web31811.mail.mud.yahoo.com>
References: <96847.77155.qm@web31808.mail.mud.yahoo.com>
	<20110318090403.GC2752@rabbitmq.com>
	<20110318171120.GM2414@rabbitmq.com>
	<819166.65905.qm@web31806.mail.mud.yahoo.com>
	<4D84CF90.4060104@rabbitmq.com>
	<431712.78403.qm@web31802.mail.mud.yahoo.com>
	<66F360D5-AB78-4FEC-9874-592CF12F602B@vmware.com>
	<747873.7872.qm@web31801.mail.mud.yahoo.com>
	<C15A4C85-A461-4845-92BD-2C826C5453EE@vmware.com>
	<307339.45118.qm@web31811.mail.mud.yahoo.com>
Message-ID: <42AB4A0C-8448-42F4-ADFC-ECB228554054@vmware.com>

My laptop has a lower ulimit hardwired in. I'll build a VM running another OS.

Cheers,
John

On Mar 29, 2011, at 12:10 AM, alex chen wrote:

John,

> One more question. You say RabbitMQ crashes when you run these tests? And it crashes without writing anything interesting in th logs? Or printing anything to the console? It just exits?

It crashed without any errors in the log.

I found a problem with my the amqp_consumer.c that I sent last week.  it did not send acknowledgement after consuming the messages.  Attached please find the updated amqp_consumer with ack enabled.  please use this for testing.

Currently the tests would send 3000 messages to each queue (MESSAGE_COUNT=3000 in common.sh).
If you find some fast consumers already finish consuming 3000 messages much earlier than other consumers, please change MESSAGE_COUNT=5000.  this would reliably reproduce the broker crash.  if you ran
"top | grep beam" while all 1000 consumers are running, you can see its memory usage grows to more than 3500 MB before it crashes.

Thanks.

-alex

<amqp_consumer.c>


From gmr at myyearbook.com  Wed Mar 30 05:41:14 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 30 Mar 2011 00:41:14 -0400
Subject: [rabbitmq-discuss] AMQP numeric data types
Message-ID: <E7AE81D81EDA454A9C17AB8FB5FB63E4@myyearbook.com>

Are all numeric data types specified in the AMQP 0-9-1 spec supported in RabbitMQ?

Specifically are both the signed and unsigned sizes for short, long and long-long supported?

Regards,

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/913cd8e7/attachment.htm>

From taylste at gmail.com  Wed Mar 30 08:07:53 2011
From: taylste at gmail.com (Steven Taylor)
Date: Wed, 30 Mar 2011 08:07:53 +0100
Subject: [rabbitmq-discuss] Using listeners in json rpc server/client
In-Reply-To: <4D91F1AD.7020309@rabbitmq.com>
References: <AANLkTikeS5mEs+EU2BTn1jDHkwvsXBHJJSAHmz=wQ-1L@mail.gmail.com>
	<4D91F1AD.7020309@rabbitmq.com>
Message-ID: <AANLkTi=SbBRQG8+Sep3Mp8Fejugb8ii3Or6Vygqr9GtX@mail.gmail.com>

"You should name queues in a way that makes sense in your application. If
queues are transient or the name doesn't matter then you can have the broker
assign random names by supplying an empty string for the queue name."

neat.  Didn't know about that.  Perhaps place it in a "random" exchange so
as not to polute the routing key namespace.

-Steven

On 29 March 2011 15:50, Emile Joubert <emile at rabbitmq.com> wrote:

> On 29/03/11 14:32, mysurf mail wrote:
>
>  1. Is that design good? In places there used to be listeners
>> transport for subscribing to data I  will leave the jsonrpc solution
>> and the listeners?
>>
>
> In a heterogeneous environment different components can communicate with
> each other via a broker, regardless of their address. If that is your design
> then it's good.
>
>
>  2. what is the reccomended way to choose a name for the queue for
>> each client
>>
>
> You should name queues in a way that makes sense in your application. If
> queues are transient or the name doesn't matter then you can have the broker
> assign random names by supplying an empty string for the queue name.
>
>
>  3. When a client dies sudddenly (unexpected ) who will close his
>> queue ?
>>
>
> You can set the queue to be auto-delete. When the last consumer disconnects
> the queue will then be deleted automatically.
>
> Regards
>
> Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/dbd01d12/attachment-0001.htm>

From julian at boxsolutions.com  Wed Mar 30 08:49:02 2011
From: julian at boxsolutions.com (Julian Charles Ball)
Date: Wed, 30 Mar 2011 08:49:02 +0100
Subject: [rabbitmq-discuss] 32-bit or 64-bit RabbitMQ?
Message-ID: <AANLkTimP4mavXgGtkEH9_N6+o=WJsiudqJmL4dgnkajE@mail.gmail.com>

Hi

Just wondering if there's a quick way to tell which version we are running?
 Server is Debian 5 x64 and we had a RabbitMQ service failure recently,
initial investigation discovered a possible issue if running 32-bit RabbitMQ
on a 64-bit server so if anyone can help me eliminate this possibility by
confirming what version RabbitMQ we are running that would be very helpful.

Thanks in advance.

- - - - - - -
Julian Charles Ball
:: BOX ::

Call me on +44 (0)20 3394 1652 (office) or +44 (0)7737 123341 (mobile)
Email me on julian at boxsolutions.com
Visit us at www.boxsolutions.com

Find out more information about BOX's ONE Media Manager at
www.onemediamanager.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/216c112d/attachment.htm>

From stammailbox at gmail.com  Wed Mar 30 09:02:12 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 30 Mar 2011 10:02:12 +0200
Subject: [rabbitmq-discuss] A message is sent but no queue to listen.
Message-ID: <AANLkTinaYb5NSTcV4czB=5f_Z6JCdpPXouW3M2jPLbMs@mail.gmail.com>

I have two more questions regarding the rabbitmq mechanism
1. if a message is produced with a routing key and no queue is bounded to
that key. where does it go ? Is it deleted?

I have a server that computes a result and some client which subscribe only
to some groups of results.
currently the server doesnt manage a group of routing keys but just sends
 each result to the Rabbitmq
Lets say 90 precesnt of the results will be listened to and will have
queues. the other 10% will disappear?
should I manange an active list of routing key in the server.

2. Upon producing two messages I get "attempt to use a closed channel" on
the second produced command.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/f54e1d2d/attachment.htm>

From jakub at rabbitmq.com  Wed Mar 30 09:25:26 2011
From: jakub at rabbitmq.com (Jakub Stastny)
Date: Wed, 30 Mar 2011 09:25:26 +0100
Subject: [rabbitmq-discuss] AMQP numeric data types
In-Reply-To: <E7AE81D81EDA454A9C17AB8FB5FB63E4@myyearbook.com>
References: <E7AE81D81EDA454A9C17AB8FB5FB63E4@myyearbook.com>
Message-ID: <C6DBBA6E-16C5-411B-B008-8E6DEE0E9EB6@rabbitmq.com>

Gavin,

the supported types are listed in RabbitMQ errata: http://dev.rabbitmq.com/wiki/Amqp091Errata#section_3

So to respond your question, it looks like the unsigned ones aren't supported.

Jakub

El 30 Mar 2011, a las 05:41, Gavin M. Roy escribi?:

> Are all numeric data types specified in the AMQP 0-9-1 spec supported in RabbitMQ?
> 
> Specifically are both the signed and unsigned sizes for short, long and long-long supported?
> 
> Regards,
> 
> Gavin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/63b66c05/attachment.htm>

From alex at kinishi.com  Wed Mar 30 09:44:48 2011
From: alex at kinishi.com (Alexander Goldstone)
Date: Wed, 30 Mar 2011 09:44:48 +0100
Subject: [rabbitmq-discuss] STOMP Plugin 2.4.0 Issue
Message-ID: <B1A24578-1DB2-4568-9965-F62A2092A800@kinishi.com>

Are there any known issues with the STOMP plugin for RabbitMQ 2.4.0 ?

I am used to connecting to the STOMP plugin via Telnet and issuing CONNECT, SEND and SUBSCRIBE frames by hand. For previous versions of RabbitMQ this has all worked fine. Now, for a clean install of RabbitMQ 2.4.0 on Ubuntu 10.10, I am not even able to successfully CONNECT using something like:

		CONNECT
		login:guest
		passcode:guest

		^@

I send a line-break after the passcode and then send another line-break but the server closes the connection before I am able to send the NULL frame terminator. The server does not output any error messages.

Similarly, if I follow the "Testing the adapter" example at http://www.rabbitmq.com/stomp.html then the server closes the connection after the second time I send "dummy" but it does not output an error message.

The RabbitMQ Management Plugin shows the STOMP plugin is listening on port 61613.

The Erlang version provided as standard for Ubuntu 10.10 seems to be R13B03 and th output from "rabbitmqctl status" looks like this:

[{pid,28410},
 {running_applications,
     [{rabbit_management,"RabbitMQ Management Console","2.4.0"},
      {webmachine,"webmachine","1.7.0"},
      {rabbit_management_agent,"RabbitMQ Management Agent","2.4.0"},
      {amqp_client,"RabbitMQ AMQP Client","2.4.0"},
      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.4.0"},
      {mochiweb,"MochiMedia Web Server","1.3"},
      {inets,"INETS  CXC 138 49","5.2"},
      {rabbit_stomp,"Embedded Rabbit Stomp Adapter","2.4.0"},
      {rabbit,"RabbitMQ","2.4.0"},
      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
      {os_mon,"CPO  CXC 138 46","2.2.4"},
      {sasl,"SASL  CXC 138 11","2.1.8"},
      {stdlib,"ERTS  CXC 138 10","1.16.4"},
      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
 {nodes,[{disc,[rabbit at tatooine]}]},
 {running_nodes,[rabbit at tatooine]}]
...done.

I'm assuming this isn't a problem for everyone using the STOMP plugin otherwise someone would have mentioned it by now so if I can provide any further information to help work out what is wrong on my setup then please let me know.

Thanks,

Alex

From simon at rabbitmq.com  Wed Mar 30 10:05:18 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 Mar 2011 10:05:18 +0100
Subject: [rabbitmq-discuss] 32-bit or 64-bit RabbitMQ?
In-Reply-To: <AANLkTimP4mavXgGtkEH9_N6+o=WJsiudqJmL4dgnkajE@mail.gmail.com>
References: <AANLkTimP4mavXgGtkEH9_N6+o=WJsiudqJmL4dgnkajE@mail.gmail.com>
Message-ID: <4D92F24E.2070405@rabbitmq.com>

On 30/03/11 08:49, Julian Charles Ball wrote:
> Just wondering if there's a quick way to tell which version we are
> running?  Server is Debian 5 x64 and we had a RabbitMQ service failure
> recently, initial investigation discovered a possible issue if running
> 32-bit RabbitMQ on a 64-bit server so if anyone can help me eliminate
> this possibility by confirming what version RabbitMQ we are running that
> would be very helpful.

It's really a question of which Erlang you're using - RabbitMQ is 
platform independent bytecode. Check the architecture of the erlang-base 
or erlang-base-hipe package (e.g. with apt-cache show).

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From emile at rabbitmq.com  Wed Mar 30 10:31:04 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 30 Mar 2011 10:31:04 +0100
Subject: [rabbitmq-discuss] A message is sent but no queue to listen.
In-Reply-To: <AANLkTinaYb5NSTcV4czB=5f_Z6JCdpPXouW3M2jPLbMs@mail.gmail.com>
References: <AANLkTinaYb5NSTcV4czB=5f_Z6JCdpPXouW3M2jPLbMs@mail.gmail.com>
Message-ID: <4D92F858.2000207@rabbitmq.com>

On 30/03/11 09:02, mysurf mail wrote:
> I have two more questions regarding the rabbitmq mechanism
> 1. if a message is produced with a routing key and no queue is bounded
> to that key. where does it go ? Is it deleted?

By default unroutable messages are discarded. If the mandatory flag was 
set then the message will be returned using the basic.return method. You 
can receive these messages by registering a ReturnListener if using Java.

Also look at alternate exchanges, which are another way of dealing with 
messages that cannot be routed, either because there were no bound 
queues or no matching bindings:

http://www.rabbitmq.com/extensions.html#alternate-exchange

> 2. Upon producing two messages I get "attempt to use a closed channel"
> on the second produced command.

That means that an exception was raised by the server upon publication 
of the first message. Check that the exchange you are publishing to 
exists. The broker logfile should contain further information.


Regards

Emile

From stammailbox at gmail.com  Wed Mar 30 10:38:12 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 30 Mar 2011 11:38:12 +0200
Subject: [rabbitmq-discuss] Using listeners in json rpc server/client
In-Reply-To: <AANLkTi=SbBRQG8+Sep3Mp8Fejugb8ii3Or6Vygqr9GtX@mail.gmail.com>
References: <AANLkTikeS5mEs+EU2BTn1jDHkwvsXBHJJSAHmz=wQ-1L@mail.gmail.com>
	<4D91F1AD.7020309@rabbitmq.com>
	<AANLkTi=SbBRQG8+Sep3Mp8Fejugb8ii3Or6Vygqr9GtX@mail.gmail.com>
Message-ID: <AANLkTimpH9qw0vuTO2JHMctTNgEXovuJiOA+BBEyFuWm@mail.gmail.com>

Yes . That's indeed a great option.
But it still  raises questions I dont understand.

usually I do the two rows

channel.queueDeclare( [emptyStringForQueuename], bool,bool,bool... );
channel.queueBind([emptyStringForQueuename],excName,RoutingKey);

1. how does the channel know which queue to bind. what if it has two queues
with random name?

2. How will I add a new binding to a random named queue?
10x.



On Wed, Mar 30, 2011 at 9:07 AM, Steven Taylor <taylste at gmail.com> wrote:

> "You should name queues in a way that makes sense in your application. If
> queues are transient or the name doesn't matter then you can have the broker
> assign random names by supplying an empty string for the queue name."
>
> neat.  Didn't know about that.  Perhaps place it in a "random" exchange so
> as not to polute the routing key namespace.
>
> -Steven
>
> On 29 March 2011 15:50, Emile Joubert <emile at rabbitmq.com> wrote:
>
>> On 29/03/11 14:32, mysurf mail wrote:
>>
>>  1. Is that design good? In places there used to be listeners
>>> transport for subscribing to data I  will leave the jsonrpc solution
>>> and the listeners?
>>>
>>
>> In a heterogeneous environment different components can communicate with
>> each other via a broker, regardless of their address. If that is your design
>> then it's good.
>>
>>
>>  2. what is the reccomended way to choose a name for the queue for
>>> each client
>>>
>>
>> You should name queues in a way that makes sense in your application. If
>> queues are transient or the name doesn't matter then you can have the broker
>> assign random names by supplying an empty string for the queue name.
>>
>>
>>  3. When a client dies sudddenly (unexpected ) who will close his
>>> queue ?
>>>
>>
>> You can set the queue to be auto-delete. When the last consumer
>> disconnects the queue will then be deleted automatically.
>>
>> Regards
>>
>> Emile
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/0dcd5475/attachment-0001.htm>

From mli at rmmsoft.com.cn  Wed Mar 30 10:40:53 2011
From: mli at rmmsoft.com.cn (Ming Li)
Date: Wed, 30 Mar 2011 09:40:53 +0000
Subject: [rabbitmq-discuss] ERL crashes when messages are being pumped into
 a queue under win32 envir
Message-ID: <19F7DB1491CA0149AF64F65336540FEA0E63DA47@server.rmmsoft.com.cn>

1.       using RabbitMQ2.4.0(windows bundle).winxp, creates an exchange and a queue.

2.       use multiple sender to send messages into the created queue, only a single receiver receiving message from the same queue.

3.       while running, what i discovered is that the ERL's RAM usage continue to increase and then crash when it reaches a certain percentage



Is there a way to prevent it from crashing?



Here are my receiver and sender source code:



Receiver:

RabbitMQ.Client.ConnectionFactory cf = new RabbitMQ.Client.ConnectionFactory();
            cf.UserName = RabbitMQ.Client.ConnectionFactory.DefaultUser;
            cf.Password = RabbitMQ.Client.ConnectionFactory.DefaultPass;
            cf.VirtualHost = RabbitMQ.Client.ConnectionFactory.DefaultVHost;
            cf.Protocol = RabbitMQ.Client.Protocols.FromEnvironment();
            cf.HostName = "192.168.3.43";
            cf.Address = "192.168.3.43";
            cf.Port = 9007;

            RabbitMQ.Client.IConnection IC = cf.CreateConnection();
            RabbitMQ.Client.IModel IM = IC.CreateModel();

            string qu = "Queue11"/*IM.QueueDeclare()*/;
            IM.QueueDeclare(qu, false, false, true, null);
            IM.BasicGet(qu, true);

            IM.BasicReturn += new RabbitMQ.Client.Events.BasicReturnEventHandler(IM_BasicReturn);
            RabbitMQ.Client.QueueingBasicConsumer _consumer = new RabbitMQ.Client.QueueingBasicConsumer(IM);

            IM.BasicConsume(qu, true, _consumer);
            int iCount = 0;
            while (true)
            {
                RabbitMQ.Client.Events.BasicDeliverEventArgs e = null;

                object obj = _consumer.Queue.Dequeue();
                if (obj == null || (e = obj as RabbitMQ.Client.Events.BasicDeliverEventArgs) == null)
                {
                   }
         }

Sender:

RabbitMQ.Client.ConnectionFactory cf = new RabbitMQ.Client.ConnectionFactory();
            cf.UserName = RabbitMQ.Client.ConnectionFactory.DefaultUser;
            cf.Password = RabbitMQ.Client.ConnectionFactory.DefaultPass;
            cf.VirtualHost = RabbitMQ.Client.ConnectionFactory.DefaultVHost;
            cf.Protocol = RabbitMQ.Client.Protocols.FromEnvironment();
            cf.HostName = "192.168.3.43";
            cf.Address = "192.168.3.43";
            cf.Port = 9007;

            SingleQuoteResponse res = new SingleQuoteResponse();
            T_Quote tq = new T_Quote();
            tq.SecurityDesc = "ssssssssss";
            res.Quote = tq;

            RabbitMQ.Client.IConnection IC = cf.CreateConnection();
            RabbitMQ.Client.IModel IM = IC.CreateModel();

            for (int j = 0; j < 100000000; j++)
            {
                IM.BasicPublish("", "Queue11", null, ESHelper.asES(ref res).ToBytes());
                Console.WriteLine("Sended :" + j.ToString());
            }

         if (IM != null)
            {
                IM.Close();
                IM.Dispose();
            }
            if (IM != null)
            {
                IC.Close();
                IC.Dispose();
            }

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/40cc68c9/attachment-0001.htm>

From Alister.Morton at tradition.com  Wed Mar 30 10:54:20 2011
From: Alister.Morton at tradition.com (Alister Morton)
Date: Wed, 30 Mar 2011 10:54:20 +0100
Subject: [rabbitmq-discuss] Using listeners in json rpc server/client
In-Reply-To: <AANLkTimpH9qw0vuTO2JHMctTNgEXovuJiOA+BBEyFuWm@mail.gmail.com>
References: <AANLkTikeS5mEs+EU2BTn1jDHkwvsXBHJJSAHmz=wQ-1L@mail.gmail.com>
	<4D91F1AD.7020309@rabbitmq.com>
	<AANLkTi=SbBRQG8+Sep3Mp8Fejugb8ii3Or6Vygqr9GtX@mail.gmail.com>
	<AANLkTimpH9qw0vuTO2JHMctTNgEXovuJiOA+BBEyFuWm@mail.gmail.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E78910696FC3BFEEB@SVR-2K3-BH-EMC.tradition.int>

channel.queueDeclare( [emptyStringForQueuename], bool,bool,bool... );
channel.queueBind([emptyStringForQueuename],excName,RoutingKey);

1. how does the channel know which queue to bind. what if it has two queues with random name?

2. How will I add a new binding to a random named queue?

queueDeclare returns the name of the queue it declared, so you would change it to

string qname = channel.queueDeclare( [emptyStringForQueuename], bool,bool,bool... );
channel.queueBind(qname,excName,RoutingKey);


________________________________
The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/20637f1e/attachment.htm>

From matthias at rabbitmq.com  Wed Mar 30 11:07:25 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 30 Mar 2011 11:07:25 +0100
Subject: [rabbitmq-discuss] Using listeners in json rpc server/client
In-Reply-To: <5A46D132C446C04B9EFE8AD14E78910696FC3BFEEB@SVR-2K3-BH-EMC.tradition.int>
References: <AANLkTikeS5mEs+EU2BTn1jDHkwvsXBHJJSAHmz=wQ-1L@mail.gmail.com>	<4D91F1AD.7020309@rabbitmq.com>	<AANLkTi=SbBRQG8+Sep3Mp8Fejugb8ii3Or6Vygqr9GtX@mail.gmail.com>	<AANLkTimpH9qw0vuTO2JHMctTNgEXovuJiOA+BBEyFuWm@mail.gmail.com>
	<5A46D132C446C04B9EFE8AD14E78910696FC3BFEEB@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <4D9300DD.8030106@rabbitmq.com>

On 30/03/11 10:54, Alister Morton wrote:
> channel.queueDeclare([emptyStringForQueuename], bool,bool,bool... );
>
> channel.queueBind([emptyStringForQueuename],excName,RoutingKey);
>
> 1. how does the channel know which queue to bind. what if it has two
> queues with random name?
>
> 2. How will I add a new binding to a random named queue?
>
> queueDeclare returns the name of the queue it declared, so you would
> change it to
>
> string qname = channel.queueDeclare([emptyStringForQueuename],
> bool,bool,bool... );
>
> channel.queueBind(qname,excName,RoutingKey);

There is also a concept of "most recently declared queue" for every 
channel. Any operation in which an empty queue name is specified 
references that queue.

So you can actually quite happily create a server-named queue, bind it 
and start consuming from it - all without the client ever needing to 
know the name of that queue.


Regards,

Matthias.

From stammailbox at gmail.com  Wed Mar 30 14:28:55 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 30 Mar 2011 15:28:55 +0200
Subject: [rabbitmq-discuss] How to define a timeout on jsonRpcClient
	calls
In-Reply-To: <4D91E319.5070005@rabbitmq.com>
References: <AANLkTi=6QfUjMXiKeMz7d9mTqUC71RXWhUg7jXQKn46b@mail.gmail.com>
	<4D910790.6090501@rabbitmq.com>
	<AANLkTi=4nWkNnQSFDSrt0ACpjyzcxxF1SeSF6uAQZUwh@mail.gmail.com>
	<4D91E319.5070005@rabbitmq.com>
Message-ID: <AANLkTi=Mn5PDoStB7dDRk+boozeoNUrJtkttdONx+gk0@mail.gmail.com>

Hi All,
Still regarding the JsonRpc
1. I would also love to control the  json rpc channel properties -   mainly
autodelete.
You see, the queues of JSONRpcClient are not deleted when the client go of.
and since they clients queue name is randomly given, the queues are packed
each restart.

2. in the example = client server constructor
HelloJSonClient - jsonrpc client gets Hello in the routing key
HelloJsonServer - jsonrpc server gets Hello in the queuename

Why should the routing key in the client be assigned? where is the
connection between the two?
Shouldn't it be autogenereated like the queue name in the client side?
thanks.

On Tue, Mar 29, 2011 at 3:48 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
>
> On 29/03/11 14:14, mysurf mail wrote:
>
>  I saw the place you pointed for me to change (line 174). As I
>> understand,  you suggest I would change it and recompile the rabbitmq
>> source ? That is possible but it would be a pain every time I will want
>> to upgrade a client version.
>>
>
> I agree - it is not convenient to maintain your own set of patches. We are
> planning on introducing this feature in the core library though.
>
>
>  so I have two questions
>> 1. I know that you are being asked that question a lot - but can I get a
>> patch?
>>
>
> We prefer to distribute code via the rabbit source repositories, rather
> than patches.
>
>
>  2. If I will go down in the root of changing the source -  you mentioned
>> it is an experience. Do you know if someone else did it and if it works
>> fine?
>>
>
> A bug has been filed to implement your suggestion. The implementation will
> appear on the branch named "bug23515". Unfortunately it is not possible to
> predict when this might be complete, but keep an eye on future release
> notes.
>
>
> Regards
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/95bea417/attachment.htm>

From emile at rabbitmq.com  Wed Mar 30 14:55:09 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 30 Mar 2011 14:55:09 +0100
Subject: [rabbitmq-discuss] How to define a timeout on jsonRpcClient
	calls
In-Reply-To: <AANLkTi=Mn5PDoStB7dDRk+boozeoNUrJtkttdONx+gk0@mail.gmail.com>
References: <AANLkTi=6QfUjMXiKeMz7d9mTqUC71RXWhUg7jXQKn46b@mail.gmail.com>	<4D910790.6090501@rabbitmq.com>	<AANLkTi=4nWkNnQSFDSrt0ACpjyzcxxF1SeSF6uAQZUwh@mail.gmail.com>	<4D91E319.5070005@rabbitmq.com>
	<AANLkTi=Mn5PDoStB7dDRk+boozeoNUrJtkttdONx+gk0@mail.gmail.com>
Message-ID: <4D93363D.7070403@rabbitmq.com>

Hi,

On 30/03/11 14:28, mysurf mail wrote:
> Hi All,
> Still regarding the JsonRpc
> 1. I would also love to control the  json rpc channel properties -
> mainly autodelete.

The RpcClient already creates autodelete queues. See the 
RpcClient.setupReplyQueue() method.

> You see, the queues of JSONRpcClient are not deleted when the client go of.
> and since they clients queue name is randomly given, the queues are
> packed each restart.

The queues contain RPC replies are autodelete queues and should 
disappear when no longer required. If they are not being deleted then 
the associated consumer is probably still connected. You can use the 
"rabbitmqctl list_consumers" command to confirm.

> 2. in the example = client server constructor
> HelloJSonClient - jsonrpc client gets Hello in the routing key
> HelloJsonServer - jsonrpc server gets Hello in the queuename
>
> Why should the routing key in the client be assigned? where is the
> connection between the two?
> Shouldn't it be autogenereated like the queue name in the client side?
> thanks.

In the example, the "Hello" queue is created by the server. The server 
listens for requests in this queue. It is possible to use a 
server-generated queue name, but that would demand that the server 
communicates the random name to the client by some other means before 
they can exchange information. It is more convenient for the client and 
server to agree on a name beforehand and use that.

Regards

Emile

From simon at rabbitmq.com  Wed Mar 30 15:00:46 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 Mar 2011 15:00:46 +0100
Subject: [rabbitmq-discuss] Replacement for rabbitmq-multi
In-Reply-To: <AANLkTi=xWfrL=TA01-T8kqWZpYVFvLaaO0H7HDdgiUeS@mail.gmail.com>
References: <AANLkTi=xWfrL=TA01-T8kqWZpYVFvLaaO0H7HDdgiUeS@mail.gmail.com>
Message-ID: <4D93378E.6020602@rabbitmq.com>

On 29/03/11 23:19, Jason J. W. Williams wrote:
> What is the rabbitmq-multi replacement for starting a cluster on your
> local machine?

The short answer is do it yourself, although that shouldn't be too 
frightening. This is talked about here:

http://www.rabbitmq.com/clustering.html#single-machine

FTR we took rabbitmq-multi out because:

* It did not handle the case where a broker wants to open other ports
   than 5672, and thus was not compatible with SSL, STOMP, the
   management plugin etc.
* It didn't actually set up a cluster, just a set of nodes.
* It had a couple of minor bugs in it that would not be easy to fix.
* It was another thing to document, and confuse people with.
* Its original purpose (help start a local cluster to work around poor
   SMP performance in Erlang) was obsolete.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From stammailbox at gmail.com  Wed Mar 30 15:09:18 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 30 Mar 2011 16:09:18 +0200
Subject: [rabbitmq-discuss] How to define a timeout on jsonRpcClient
	calls
In-Reply-To: <4D93363D.7070403@rabbitmq.com>
References: <AANLkTi=6QfUjMXiKeMz7d9mTqUC71RXWhUg7jXQKn46b@mail.gmail.com>
	<4D910790.6090501@rabbitmq.com>
	<AANLkTi=4nWkNnQSFDSrt0ACpjyzcxxF1SeSF6uAQZUwh@mail.gmail.com>
	<4D91E319.5070005@rabbitmq.com>
	<AANLkTi=Mn5PDoStB7dDRk+boozeoNUrJtkttdONx+gk0@mail.gmail.com>
	<4D93363D.7070403@rabbitmq.com>
Message-ID: <AANLkTinNGgKTUT7EUj3U=1U9TkpHyEwgDd3YHvtLap19@mail.gmail.com>

I know I bug you a lot today :-) . But I am realy having a lot of issues
with the rabbit and you assitance is awsome.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/ed1c1046/attachment.htm>

From stammailbox at gmail.com  Wed Mar 30 15:19:44 2011
From: stammailbox at gmail.com (mysurf mail)
Date: Wed, 30 Mar 2011 16:19:44 +0200
Subject: [rabbitmq-discuss] multiple routing keys on a queue.
Message-ID: <AANLkTi=cx-t38xmad18ALurkrV=UmvKiOz7ixeoX0XfT@mail.gmail.com>

Hi guys,
me again :-)

I need a reference please to a multiple routing keys binded queue.
You see, I created a queue and binded it once with
channel.queuebind()
and another time with
channel.queuebind()

until i got this two bindings on the same queue.
but upon publishing - only the first bounded message was transfered
successfully.
(I even replaced the orders and still - only the first. so my publishing is
ok)

What i didnt do - is define the channel.basicConsumer with a new subscriber.
should I do it ? I want the old subsciver to get more messages. what did I
do wrong?

Here is a list of my queues is
you can see that amq.gen-4ae4QUbSNevC/RgM+8C9CA== is binded to two keys.

but the message goes only to the first key (did I mention it already?)

Listing queues ...
amq.gen-4ae4QUbSNevC/RgM+8C9CA==        0
amq.gen-sgZK0bSc0W3QEXda8m1vIQ==        0
PositionsQueue  1
...done.

rabbitmqctl.bat list_bindings

Listing bindings ...
        exchange        PositionsQueue  queue   PositionsQueue  []
        exchange        amq.gen-4ae4QUbSNevC/RgM+8C9CA==        queue
 amq.gen-4ae4QUbSNevC/RgM+8C9CA==
        exchange        amq.gen-sgZK0bSc0W3QEXda8m1vIQ==        queue
 amq.gen-sgZK0bSc0W3QEXda8m1vIQ==
Positions_Exchange      exchange
amq.gen-4ae4QUbSNevC/RgM+8C9CA==        queue   Account:Account1
Positions_Exchange      exchange
amq.gen-4ae4QUbSNevC/RgM+8C9CA==        queue   Portfolio:Portfolio1
...done.

10x a lot
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/cf45af67/attachment.htm>

From alfonso.pantoja at gmail.com  Wed Mar 30 15:43:37 2011
From: alfonso.pantoja at gmail.com (Alfonso)
Date: Wed, 30 Mar 2011 07:43:37 -0700 (PDT)
Subject: [rabbitmq-discuss] Unexpected server crash and .NET API: disconnect
	is not detected?
Message-ID: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>

Hi,

This is a difficult one: I've observed a couple of times that my
consumer (.NET API 2.2.0) doesn't notice when the server that is
running RabbitMQ (2.2.0) crashes.
Please note that I mean server crash -unexpected shutdown, OS crash,
etc.- not RabbitMQ crash.

My application is consuming from a queue using "foreach" to get the
messages and I has an event handler attached to the onShutdown event.
Time ago disconnection tests consisting of disconnecting the consumer
from the web admin console were made and the event handler was fired
always. So disconnections are caught and logged properly.

The problem is that the consumer got stuck when the server crashed and
it didn't notice that the connection was gone (due to a server crash)
so it was impossible to log a disconnection error.
In the code there is a while loop for reconnecting when the connection
fails but didn't loop because my guess is that the code were stuck in
the "foreach".

Am I missing something or this could be and issue?


Alfonso









From jeroen.janssen at gmail.com  Wed Mar 30 15:33:49 2011
From: jeroen.janssen at gmail.com (Jeroen Janssen)
Date: Wed, 30 Mar 2011 07:33:49 -0700 (PDT)
Subject: [rabbitmq-discuss] Server error during queue.declare call
Message-ID: <74120ebb-0ea0-4b3c-9739-44b3dd35ce99@p13g2000yqh.googlegroups.com>

Hello,

I've been trying to find info about this in the mailinglist, but I
couldn't find the exact scenario (since most of the seemingly related
issues deal with clusters).

Hopefully someone will recognize the problem and/or can help solve
this issue?

We are using the RabbitMQ 2.2.0 on a single server setup (no cluster)
with a client using the py-amqplib library.

The client sometimes hangs in the queue declare call. And the server
logging contains the following error report:

=ERROR REPORT==== 30-Mar-2011::12:06:44 ===
** Generic server <0.23453.72> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'queue.declare',0,
                                   <<"a6aa528f-5ab7-11e0-8739-
b8ac6f88dcc2">>,
                                   false,false,false,true,false,
                                   [{<<"x-expires">>,signedint,
300000}]},
                               none}}
** When Server state == {ch,running,
1,<0.23414.72>,<0.23449.72>,undefined,
                            #Fun<rabbit_channel_sup.0.58069862>,none,
                            {set,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[],
[],[],
                                  [],[]},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[],
[],[],
                                   [],[]}}},
                            1,
                            {[],[]},
                            {[],[]},
                            <<"guest">>,<<"/">>,<<>>,
                            {dict,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[],[],
[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[],
[],[],[],
                                    [],[]}}},
                            {dict,0,16,16,8,80,48,
                                  {[],[],[],[],[],[],[],[],[],[],[],[],
[],[],
                                   [],[]},
                                  {{[],[],[],[],[],[],[],[],[],[],[],
[],[],[],
                                    [],[]}}},
                            <0.23411.72>,
                            {state,none,undefined}}
** Reason for termination ==
** {{timeout,{gen_server2,call,[<0.23461.72>,{init,false}]}},
    [{gen_server2,call,2},
     {rabbit_amqqueue,declare,5},
     {rabbit_channel,handle_method,3},
     {rabbit_channel,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,init_p_do_apply,3}]}

Does anyone know if this is a (known) issue with rabbitmq 2.2.0 or py-
amqplib? Or is this a 'new' issue?

Best regards,

Jeroen Janssen

From matthew at rabbitmq.com  Wed Mar 30 16:34:35 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 30 Mar 2011 16:34:35 +0100
Subject: [rabbitmq-discuss] Server error during queue.declare call
In-Reply-To: <74120ebb-0ea0-4b3c-9739-44b3dd35ce99@p13g2000yqh.googlegroups.com>
References: <74120ebb-0ea0-4b3c-9739-44b3dd35ce99@p13g2000yqh.googlegroups.com>
Message-ID: <20110330153435.GB3737@rabbitmq.com>

Hi Jeroen,

On Wed, Mar 30, 2011 at 07:33:49AM -0700, Jeroen Janssen wrote:
> We are using the RabbitMQ 2.2.0 on a single server setup (no cluster)
> with a client using the py-amqplib library.
>
> ** Reason for termination ==
> ** {{timeout,{gen_server2,call,[<0.23461.72>,{init,false}]}},
>     [{gen_server2,call,2},

Yes, this is a known issue and has been fixed now. Please upgrade to the
latest version 2.4.0 and you should find this issue goes away.

Best wishes,

Matthew

From emile at rabbitmq.com  Wed Mar 30 16:36:53 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 30 Mar 2011 16:36:53 +0100
Subject: [rabbitmq-discuss] Unexpected server crash and .NET API:
 disconnect is not detected?
In-Reply-To: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>
References: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>
Message-ID: <4D934E15.6080207@rabbitmq.com>

Hi Alfonso,

On 30/03/11 15:43, Alfonso wrote:
> Hi,
>
> This is a difficult one: I've observed a couple of times that my
> consumer (.NET API 2.2.0) doesn't notice when the server that is
> running RabbitMQ (2.2.0) crashes.
> Please note that I mean server crash -unexpected shutdown, OS crash,
> etc.- not RabbitMQ crash.
>
> My application is consuming from a queue using "foreach" to get the
> messages and I has an event handler attached to the onShutdown event.

I'm not able to reproduce this using version 2.2.0 of the broker and the 
.NET client, implementing the the Subscription pattern. A connectivity 
problem immediately causes an OperationInterruptedException to be thrown 
from ConnectionBase.Dispose().

> Time ago disconnection tests consisting of disconnecting the consumer
> from the web admin console were made and the event handler was fired
> always. So disconnections are caught and logged properly.
>
> The problem is that the consumer got stuck when the server crashed and
> it didn't notice that the connection was gone (due to a server crash)
> so it was impossible to log a disconnection error.
> In the code there is a while loop for reconnecting when the connection
> fails but didn't loop because my guess is that the code were stuck in
> the "foreach".
>
> Am I missing something or this could be and issue?

Is it possible that you are preventing an exception from the socket from 
affecting the Subscription? Posting a minimal piece of code for 
demonstration may be useful.



Regards

Emile



From steve at rabbitmq.com  Wed Mar 30 16:41:31 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 30 Mar 2011 16:41:31 +0100
Subject: [rabbitmq-discuss] STOMP Plugin 2.4.0 Issue
In-Reply-To: <B1A24578-1DB2-4568-9965-F62A2092A800@kinishi.com>
References: <B1A24578-1DB2-4568-9965-F62A2092A800@kinishi.com>
Message-ID: <E88C70A4-ED99-4747-8D5B-7335C79E9A8D@rabbitmq.com>

Hi Alexander,

I'm able to run happily on the (in-house) 'best-so-far' version of rabbitmq-stomp:
---------------------------------------------------8<----cut-here-----------
15:29:30 :> telnet localhost 61613
Trying ::1...
Connected to localhost.
Escape character is '^]'.
CONNECT
login:guest
passcode:guest

^@
CONNECTED
session:session-A/W+DDK95d4+ZZehxZHkZQ==
heartbeat:0,0
version:1.0

DISCONNECT

^@
Connection closed by foreign host.

15:30:31 :>
---------------------------------------------------8<----cut-here-----------
but this is, I admit, a development version, so the next thing I tried is to download my own fresh RabbitMQ 2.4.0....

(I'm on Mac, so I used macports to install rabbitmq-server (@2.4.0) and put amqp-client-2.4.0.ez and rabbit-somp-2.4.0.ez in the plugins directory, ran 
'sudo rabbitmq-server' and repeated the above experiment.)

And it worked identically for me.  So, this is probably a set-up issue for you.  Can you provide the installation steps you went through, please? Oh, and the versions of Erlang and so on are very useful, too, thanks.

Here is my 'rabbitmqctl status' output for comparison:

[{pid,73212},
 {running_applications,[{amqp_client,"RabbitMQ AMQP Client","2.4.0"},
                        {rabbit_stomp,"Embedded Rabbit Stomp Adapter","2.4.0"},
                        {rabbit,"RabbitMQ","2.4.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.16"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9.2"},
                        {stdlib,"ERTS  CXC 138 10","1.17.2"},
                        {kernel,"ERTS  CXC 138 10","2.14.2"}]},
 {nodes,[{disc,['rabbit at spowell-desktop']}]},
 {running_nodes,['rabbit at spowell-desktop']}]

I appear to be running a more modern version of Erlang and its friends here, but the next step would be for me to try this on an Ubuntu client (which I can probably do, but it will take me a little time to set one up.)

Please just come back here if you need me to try that.

Steve Powell

On 30 Mar 2011, at 09:44, Alexander Goldstone wrote:

> Are there any known issues with the STOMP plugin for RabbitMQ 2.4.0 ?
> 
> I am used to connecting to the STOMP plugin via Telnet and issuing CONNECT, SEND and SUBSCRIBE frames by hand. For previous versions of RabbitMQ this has all worked fine. Now, for a clean install of RabbitMQ 2.4.0 on Ubuntu 10.10, I am not even able to successfully CONNECT using something like:
> 
> 		CONNECT
> 		login:guest
> 		passcode:guest
> 
> 		^@
> 
> I send a line-break after the passcode and then send another line-break but the server closes the connection before I am able to send the NULL frame terminator. The server does not output any error messages.
> 
> Similarly, if I follow the "Testing the adapter" example at http://www.rabbitmq.com/stomp.html then the server closes the connection after the second time I send "dummy" but it does not output an error message.
> 
> The RabbitMQ Management Plugin shows the STOMP plugin is listening on port 61613.
> 
> The Erlang version provided as standard for Ubuntu 10.10 seems to be R13B03 and th output from "rabbitmqctl status" looks like this:
> 
> [{pid,28410},
> {running_applications,
>     [{rabbit_management,"RabbitMQ Management Console","2.4.0"},
>      {webmachine,"webmachine","1.7.0"},
>      {rabbit_management_agent,"RabbitMQ Management Agent","2.4.0"},
>      {amqp_client,"RabbitMQ AMQP Client","2.4.0"},
>      {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.4.0"},
>      {mochiweb,"MochiMedia Web Server","1.3"},
>      {inets,"INETS  CXC 138 49","5.2"},
>      {rabbit_stomp,"Embedded Rabbit Stomp Adapter","2.4.0"},
>      {rabbit,"RabbitMQ","2.4.0"},
>      {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>      {os_mon,"CPO  CXC 138 46","2.2.4"},
>      {sasl,"SASL  CXC 138 11","2.1.8"},
>      {stdlib,"ERTS  CXC 138 10","1.16.4"},
>      {kernel,"ERTS  CXC 138 10","2.13.4"}]},
> {nodes,[{disc,[rabbit at tatooine]}]},
> {running_nodes,[rabbit at tatooine]}]
> ...done.
> 
> I'm assuming this isn't a problem for everyone using the STOMP plugin otherwise someone would have mentioned it by now so if I can provide any further information to help work out what is wrong on my setup then please let me know.
> 
> Thanks,
> 
> Alex
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alex at kinishi.com  Wed Mar 30 17:32:18 2011
From: alex at kinishi.com (Alexander Goldstone)
Date: Wed, 30 Mar 2011 17:32:18 +0100
Subject: [rabbitmq-discuss] STOMP Plugin 2.4.0 Issue
In-Reply-To: <E88C70A4-ED99-4747-8D5B-7335C79E9A8D@rabbitmq.com>
References: <B1A24578-1DB2-4568-9965-F62A2092A800@kinishi.com>
	<E88C70A4-ED99-4747-8D5B-7335C79E9A8D@rabbitmq.com>
Message-ID: <628F04E2-D47A-478C-A809-735644C08FBF@kinishi.com>


Hi Steve,

Thank you for taking the time to look at this for me.

I started with a regular 64-Bit Ubuntu 10.10 running on an Amazon EC2 micro instance.

I changed the hostname of the instance and then ran:

		sudo apt-get update && sudo apt-get upgrade -y

I then copied and pasted the rabbitmq-user-data.sh script documented at:

		http://www.rabbitmq.com/ec2.html

Once the latest (2.4.0) rabbitmq was installed using that script I installed the plugins:

cd /usr/lib/rabbitmq/lib/rabbitmq_server-2.4.0/plugins/
sudo wget http://www.rabbitmq.com/releases/plugins/v2.4.0/mochiweb-2.4.0.ez
sudo wget http://www.rabbitmq.com/releases/plugins/v2.4.0/webmachine-2.4.0.ez
sudo wget http://www.rabbitmq.com/releases/plugins/v2.4.0/amqp_client-2.4.0.ez
sudo wget http://www.rabbitmq.com/releases/plugins/v2.4.0/rabbitmq-mochiweb-2.4.0.ez
sudo wget http://www.rabbitmq.com/releases/plugins/v2.4.0/rabbitmq-management-agent-2.4.0.ez
sudo wget http://www.rabbitmq.com/releases/plugins/v2.4.0/rabbitmq-management-2.4.0.ez
sudo wget http://www.rabbitmq.com/releases/plugins/v2.4.0/rabbit_stomp-2.4.0.ez
sudo /etc/init.d/rabbitmq-server restart

I did not manually install erlang itself but I can see that the version I have ended up with after the above is R13B03.

I didn't do anything else so I can't see what I could have done differently. This same process worked for the previous version of rabbitmq for which I was able to telnet and use the STOMP plugin fine.

I just removed all plugins except amqp_client-2.4.0.ez and rabbit_stomp-2.4.0.ez and restarted rabbitmq as this was the only difference I could see between your tests and mine (other than the operating system and erlang version).

Removing the other plugins and restarting rabbitmq had no impact on this issue so I would really appreciate you repeating your test on an Ubuntu client as that would seem to be the only difference between your tests and mine.

If there is anything else I should try and/or any other details I can provide that would be useful then please let me know.

Thanks,

Alex

On 30 Mar 2011, at 16:41, Steve Powell wrote:

> Hi Alexander,
> 
> I'm able to run happily on the (in-house) 'best-so-far' version of rabbitmq-stomp:
> ---------------------------------------------------8<----cut-here-----------
> 15:29:30 :> telnet localhost 61613
> Trying ::1...
> Connected to localhost.
> Escape character is '^]'.
> CONNECT
> login:guest
> passcode:guest
> 
> ^@
> CONNECTED
> session:session-A/W+DDK95d4+ZZehxZHkZQ==
> heartbeat:0,0
> version:1.0
> 
> DISCONNECT
> 
> ^@
> Connection closed by foreign host.
> 
> 15:30:31 :>
> ---------------------------------------------------8<----cut-here-----------
> but this is, I admit, a development version, so the next thing I tried is to download my own fresh RabbitMQ 2.4.0....
> 
> (I'm on Mac, so I used macports to install rabbitmq-server (@2.4.0) and put amqp-client-2.4.0.ez and rabbit-somp-2.4.0.ez in the plugins directory, ran 
> 'sudo rabbitmq-server' and repeated the above experiment.)
> 
> And it worked identically for me.  So, this is probably a set-up issue for you.  Can you provide the installation steps you went through, please? Oh, and the versions of Erlang and so on are very useful, too, thanks.
> 
> Here is my 'rabbitmqctl status' output for comparison:
> 
> [{pid,73212},
> {running_applications,[{amqp_client,"RabbitMQ AMQP Client","2.4.0"},
>                        {rabbit_stomp,"Embedded Rabbit Stomp Adapter","2.4.0"},
>                        {rabbit,"RabbitMQ","2.4.0"},
>                        {mnesia,"MNESIA  CXC 138 12","4.4.16"},
>                        {os_mon,"CPO  CXC 138 46","2.2.5"},
>                        {sasl,"SASL  CXC 138 11","2.1.9.2"},
>                        {stdlib,"ERTS  CXC 138 10","1.17.2"},
>                        {kernel,"ERTS  CXC 138 10","2.14.2"}]},
> {nodes,[{disc,['rabbit at spowell-desktop']}]},
> {running_nodes,['rabbit at spowell-desktop']}]
> 
> I appear to be running a more modern version of Erlang and its friends here, but the next step would be for me to try this on an Ubuntu client (which I can probably do, but it will take me a little time to set one up.)
> 
> Please just come back here if you need me to try that.
> 
> Steve Powell
> 
> On 30 Mar 2011, at 09:44, Alexander Goldstone wrote:
> 
>> Are there any known issues with the STOMP plugin for RabbitMQ 2.4.0 ?
>> 
>> I am used to connecting to the STOMP plugin via Telnet and issuing CONNECT, SEND and SUBSCRIBE frames by hand. For previous versions of RabbitMQ this has all worked fine. Now, for a clean install of RabbitMQ 2.4.0 on Ubuntu 10.10, I am not even able to successfully CONNECT using something like:
>> 
>> 		CONNECT
>> 		login:guest
>> 		passcode:guest
>> 
>> 		^@
>> 
>> I send a line-break after the passcode and then send another line-break but the server closes the connection before I am able to send the NULL frame terminator. The server does not output any error messages.
>> 
>> Similarly, if I follow the "Testing the adapter" example at http://www.rabbitmq.com/stomp.html then the server closes the connection after the second time I send "dummy" but it does not output an error message.
>> 
>> The RabbitMQ Management Plugin shows the STOMP plugin is listening on port 61613.
>> 
>> The Erlang version provided as standard for Ubuntu 10.10 seems to be R13B03 and th output from "rabbitmqctl status" looks like this:
>> 
>> [{pid,28410},
>> {running_applications,
>>    [{rabbit_management,"RabbitMQ Management Console","2.4.0"},
>>     {webmachine,"webmachine","1.7.0"},
>>     {rabbit_management_agent,"RabbitMQ Management Agent","2.4.0"},
>>     {amqp_client,"RabbitMQ AMQP Client","2.4.0"},
>>     {rabbit_mochiweb,"RabbitMQ Mochiweb Embedding","2.4.0"},
>>     {mochiweb,"MochiMedia Web Server","1.3"},
>>     {inets,"INETS  CXC 138 49","5.2"},
>>     {rabbit_stomp,"Embedded Rabbit Stomp Adapter","2.4.0"},
>>     {rabbit,"RabbitMQ","2.4.0"},
>>     {mnesia,"MNESIA  CXC 138 12","4.4.12"},
>>     {os_mon,"CPO  CXC 138 46","2.2.4"},
>>     {sasl,"SASL  CXC 138 11","2.1.8"},
>>     {stdlib,"ERTS  CXC 138 10","1.16.4"},
>>     {kernel,"ERTS  CXC 138 10","2.13.4"}]},
>> {nodes,[{disc,[rabbit at tatooine]}]},
>> {running_nodes,[rabbit at tatooine]}]
>> ...done.
>> 
>> I'm assuming this isn't a problem for everyone using the STOMP plugin otherwise someone would have mentioned it by now so if I can provide any further information to help work out what is wrong on my setup then please let me know.
>> 
>> Thanks,
>> 
>> Alex
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 






From jeroen.janssen at gmail.com  Wed Mar 30 17:33:43 2011
From: jeroen.janssen at gmail.com (Jeroen Janssen)
Date: Wed, 30 Mar 2011 09:33:43 -0700 (PDT)
Subject: [rabbitmq-discuss] Server error during queue.declare call
In-Reply-To: <20110330153435.GB3737@rabbitmq.com>
References: <74120ebb-0ea0-4b3c-9739-44b3dd35ce99@p13g2000yqh.googlegroups.com>
	<20110330153435.GB3737@rabbitmq.com>
Message-ID: <ebd88951-f27b-4cf3-82e0-2bb9dab752de@27g2000yqv.googlegroups.com>

On Mar 30, 5:34?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> > ** Reason for termination ==
> > ** {{timeout,{gen_server2,call,[<0.23461.72>,{init,false}]}},
> > ? ? [{gen_server2,call,2},
>
> Yes, this is a known issue and has been fixed now. Please upgrade to the
> latest version 2.4.0 and you should find this issue goes away.

Ok, that is good to hear!

Now, I'm just wondering about the following:
we are running the EPEL rabbitmq 2.2 rpm on a RHEL 5 machine (on
erlang 14B).

I noticed the EPEL repository doesn't have any 2.4 rpms.

Am I correct to assume that I can just switch to use the rabbitmq-
server-2.4.0-1.noarch.rpm
from the rabbitmq download page and just replace the 2.2 EPEL version?
(persistency of old data is not an issue for us at the moment).

I'll probably do this tomorrow since I do not have access to the
actual machine at the moment.

Best regards,

Jeroen Janssen

From steve at rabbitmq.com  Wed Mar 30 17:52:09 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Wed, 30 Mar 2011 17:52:09 +0100
Subject: [rabbitmq-discuss] STOMP Plugin 2.4.0 Issue
In-Reply-To: <628F04E2-D47A-478C-A809-735644C08FBF@kinishi.com>
References: <B1A24578-1DB2-4568-9965-F62A2092A800@kinishi.com>
	<E88C70A4-ED99-4747-8D5B-7335C79E9A8D@rabbitmq.com>
	<628F04E2-D47A-478C-A809-735644C08FBF@kinishi.com>
Message-ID: <F49EF021-008C-4AE9-998F-931F8DE18C96@rabbitmq.com>

Thanks for that information.

I have obtained an Ubuntu 10.4 virtual machine and (fairly) quickly installed rabbitmq 2.4.0 using the *.deb package from our web-pages.
The version of Erlang I have there is the same as yours.

I tried 'telnet localhost 61613' CONNECTing, and... I get the same problem as you do.  So I can reproduce the error.
Next step is to debug it. (I may try building from scratch first -- it's not too hard.)

Thank you for reporting this.  We'll treat diagnosis as fairly urgent.  Is anyone else seeing this on anything other than Ubuntu 10.*?

I'll get back to you as soon as I figure out what is causing this.

Steve Powell
On 30 Mar 2011, at 17:32, Alexander Goldstone wrote:
> (elided)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/73cbc000/attachment-0001.htm>

From simon at rabbitmq.com  Wed Mar 30 18:00:23 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 30 Mar 2011 18:00:23 +0100
Subject: [rabbitmq-discuss] Server error during queue.declare call
In-Reply-To: <ebd88951-f27b-4cf3-82e0-2bb9dab752de@27g2000yqv.googlegroups.com>
References: <74120ebb-0ea0-4b3c-9739-44b3dd35ce99@p13g2000yqh.googlegroups.com>	<20110330153435.GB3737@rabbitmq.com>
	<ebd88951-f27b-4cf3-82e0-2bb9dab752de@27g2000yqv.googlegroups.com>
Message-ID: <4D9361A7.7070305@rabbitmq.com>

On 30/03/11 17:33, Jeroen Janssen wrote:
> Am I correct to assume that I can just switch to use the rabbitmq-
> server-2.4.0-1.noarch.rpm
> from the rabbitmq download page and just replace the 2.2 EPEL version?

Yes. The RPM in EPEL is essentially the same as the one we release.

> (persistency of old data is not an issue for us at the moment).

If you're not using clustering, you'll keep everything upgrading from 
2.1.1 or later.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From aaron at agoragames.com  Wed Mar 30 19:34:24 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 30 Mar 2011 14:34:24 -0400
Subject: [rabbitmq-discuss] 2.4.0 channel and connection close behavior
Message-ID: <AANLkTimBaHTn4OmWEgovJh9qartMJLjb9fuatY_fBj9X@mail.gmail.com>

I was debugging our new driver (coming soon!) with 2.4.0 and
encountered a change in behavior during the shutdown process of my
test.

The test is a simple stress test, opening N channels with their own
dedicated auto_delete queue and continuously looping messages through
it.  After the first message, each channel publishes a message when it
receives the last published message.

When I hit ctrl-c, the test sends a channel close for all channels
(queued behind a pending publish if there is one), followed by a
connection close frame, then shuts down after receiving close_ok on
the connection. Once close() has been called on a channel, no further
publish calls are made.

In 2.3.0 and prior, I could send the connection close even if there
were pending channel closures, but in 2.4.0, if I send a channel close
followed immediately by a connection close, I stop receiving frames
altogether.  This occurred with one channel (beyond 0) and 500
channels.  I didn't enable heartbeats so perhaps frame processing was
still alive but I simply never received a close_ok on the channel or
connection.

I assume that this is a bug but could easily be a stricter
interpretation of the spec.



I'm looking forward to finally turning this code loose on the
community, it's been a long time coming and delayed by all those
things we actually get paid for.  My personal goal is first public
release by the end of April.

cheers,
Aaron

-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From jon at jbrisbin.com  Wed Mar 30 20:32:01 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Wed, 30 Mar 2011 14:32:01 -0500
Subject: [rabbitmq-discuss] Problems starting 2.4.0 on OS X w/ mgmt plugins
Message-ID: <71B3B674-43F9-41C8-8E61-DF10EB6CEF33@jbrisbin.com>

I see references to this problem scattered about archives but I didn't see any solution, so thought I'd ping the group.

I'm using the Homebrew install of RabbitMQ 2.4.0 and the latest-and-greatest management plugins. When I start the broker, it gives me some warnings and then stops loading. When I hit ^C twice, it continues to start the broker. 

The management plugin seems to be working, but it just won't start cleanly. It didn't do this originally, but has started doing it now every time. Don't know if I subsequently installed something it doesn't like or what...

Here's my console output:

Activating RabbitMQ plugins ...
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function webmachine_resource:start_link/2
6 plugins activated:
* amqp_client-2.4.0
* mochiweb-1.3
* rabbit_management-2.4.0.1
* rabbit_management_agent-2.4.0
* rabbit_mochiweb-2.4.0
* webmachine-1.7.0

^C
BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
      (v)ersion (k)ill (D)b-tables (d)istribution
^C

^^^^^^^^
This is where I kill it...then it continues on fine...


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.4.0  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at jbrisbin
app descriptor : /usr/local/Cellar/rabbitmq/2.4.0/lib/rabbitmq/erlang/lib/rabbitmq-2.4.0/ebin/rabbit.app
home dir       : /Users/jbrisbin
config file(s) : (none)
cookie hash    : XseAPjfnLNBJwJJ074sjQw==
log            : /usr/local/var/log/rabbitmq/rabbit at jbrisbin.log
sasl log       : /usr/local/var/log/rabbitmq/rabbit at jbrisbin-sasl.log
database dir   : /usr/local/var/lib/rabbitmq/mnesia/rabbit at jbrisbin
erlang version : 5.8.3

starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting plugin registry                                              ...done
starting auth mechanism cr-demo                                       ...done
starting auth mechanism amqplain                                      ...done
starting auth mechanism plain                                         ...done
starting statistics event manager                                     ...done
starting logging server                                               ...done
starting exchange type direct                                         ...done
starting exchange type fanout                                         ...done
starting exchange type headers                                        ...done
starting exchange type topic                                          ...done
-- kernel ready
starting alarm handler                                                ...done
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting memory monitor                                               ...done
-- core initialized
starting empty DB check                                               ...done
starting exchange recovery                                            ...done
starting management agent                                             ...done
starting management statistics database                               ...done
starting queue supervisor and queue recovery                          ...done
-- message delivery logic ready
starting error log relay                                              ...done
starting networking                                                   ...done
starting direct_client                                                ...done
starting notify cluster nodes                                         ...done

broker running
** Found 0 name clashes in code paths 


I'm using R14B02 (Homebrew).

Logs show nothing of import, though I included them below for the sake of completeness.

Any ideas?

Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin


rabbit at jbrisbin.log:

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
Limiting to approx 156 file handles (138 sockets)

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
Memory limit set to 2852MB.

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
Statistics database started.

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 30-Mar-2011::14:11:32 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
Management agent started.

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
Management plugin started.
HTTP API:       http://jbrisbin:55672/api/
Management UI:  http://jbrisbin:55672/mgmt/





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/cdc406f7/attachment-0001.htm>

From matthew at rabbitmq.com  Wed Mar 30 20:41:32 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 30 Mar 2011 20:41:32 +0100
Subject: [rabbitmq-discuss] 2.4.0 channel and connection close behavior
In-Reply-To: <AANLkTimBaHTn4OmWEgovJh9qartMJLjb9fuatY_fBj9X@mail.gmail.com>
References: <AANLkTimBaHTn4OmWEgovJh9qartMJLjb9fuatY_fBj9X@mail.gmail.com>
Message-ID: <20110330194131.GA1577@wellquite.org>

On Wed, Mar 30, 2011 at 02:34:24PM -0400, Aaron Westendorf wrote:
> In 2.3.0 and prior, I could send the connection close even if there
> were pending channel closures, but in 2.4.0, if I send a channel close
> followed immediately by a connection close, I stop receiving frames
> altogether.  This occurred with one channel (beyond 0) and 500
> channels.  I didn't enable heartbeats so perhaps frame processing was
> still alive but I simply never received a close_ok on the channel or
> connection.
> 
> I assume that this is a bug but could easily be a stricter
> interpretation of the spec.

I think it's a different interpretation of the spec. Certainly we
changed some code in those areas to solve another genuine bug, where a
close_oks were not being sent (the issue is: if both a client and the
server send channel.close (or connection.close) to each other at the
same time (they pass in mid-air), _both_ client and server should reply
with (channel|connection).close_ok.

Now in the course of fixing that, we may have changed behaviour
elsewhere, but I believe that the spec is silent as to what should
happen if the client sends channel.close and then immediately follows
that with connection.close. The only guarantee you'll have is that you
should get back the connection.close_ok. I don't believe the spec says
that the connection.close_ok should be delayed until all pending channel
closes complete - after all, why special case the channel.close? - no
other methods are waited upon when a connection.close occurs.

However, from your description above, it sounds like you're not even
getting the connection.close_ok back. Is that really the case?

Matthew

From jbrisbin at vmware.com  Wed Mar 30 20:21:08 2011
From: jbrisbin at vmware.com (Jonathan Brisbin)
Date: Wed, 30 Mar 2011 12:21:08 -0700
Subject: [rabbitmq-discuss] Problems starting 2.4.0 on OS X w/ mgmt plugins
Message-ID: <888D1862-46B7-401B-AE2D-E0FFA5EAD55E@vmware.com>

I see references to this problem scattered about archives but I didn't see any solution, so thought I'd ping the group.

I'm using the Homebrew install of RabbitMQ 2.4.0 and the latest-and-greatest management plugins. When I start the broker, it gives me some warnings and then stops loading. When I hit ^C twice, it continues to start the broker. 

The management plugin seems to be working, but it just won't start cleanly. It didn't do this originally, but has started doing it now every time. Don't know if I subsequently installed something it doesn't like or what...

Here's my console output:

Activating RabbitMQ plugins ...
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function webmachine_resource:start_link/2
6 plugins activated:
* amqp_client-2.4.0
* mochiweb-1.3
* rabbit_management-2.4.0.1
* rabbit_management_agent-2.4.0
* rabbit_mochiweb-2.4.0
* webmachine-1.7.0

^C
BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
       (v)ersion (k)ill (D)b-tables (d)istribution
^C

^^^^^^^^
This is where I kill it...then it continues on fine...


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.4.0  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at jbrisbin
app descriptor : /usr/local/Cellar/rabbitmq/2.4.0/lib/rabbitmq/erlang/lib/rabbitmq-2.4.0/ebin/rabbit.app
home dir       : /Users/jbrisbin
config file(s) : (none)
cookie hash    : XseAPjfnLNBJwJJ074sjQw==
log            : /usr/local/var/log/rabbitmq/rabbit at jbrisbin.log
sasl log       : /usr/local/var/log/rabbitmq/rabbit at jbrisbin-sasl.log
database dir   : /usr/local/var/lib/rabbitmq/mnesia/rabbit at jbrisbin
erlang version : 5.8.3

starting file handle cache server                                     ...done
starting worker pool                                                  ...done
starting database                                                     ...done
starting codec correctness check                                      ...done
-- external infrastructure ready
starting plugin registry                                              ...done
starting auth mechanism cr-demo                                       ...done
starting auth mechanism amqplain                                      ...done
starting auth mechanism plain                                         ...done
starting statistics event manager                                     ...done
starting logging server                                               ...done
starting exchange type direct                                         ...done
starting exchange type fanout                                         ...done
starting exchange type headers                                        ...done
starting exchange type topic                                          ...done
-- kernel ready
starting alarm handler                                                ...done
starting node monitor                                                 ...done
starting cluster delegate                                             ...done
starting guid generator                                               ...done
starting memory monitor                                               ...done
-- core initialized
starting empty DB check                                               ...done
starting exchange recovery                                            ...done
starting management agent                                             ...done
starting management statistics database                               ...done
starting queue supervisor and queue recovery                          ...done
-- message delivery logic ready
starting error log relay                                              ...done
starting networking                                                   ...done
starting direct_client                                                ...done
starting notify cluster nodes                                         ...done

broker running
** Found 0 name clashes in code paths 


I'm using R14B02 (Homebrew).

Logs show nothing of import, though I included them below for the sake of completeness.

Any ideas?

Thanks!

Jon Brisbin
SpringSource (a division of VMware)

Twitter: @j_brisbin


rabbit at jbrisbin.log:

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
Limiting to approx 156 file handles (138 sockets)

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
Memory limit set to 2852MB.

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
Statistics database started.

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 30-Mar-2011::14:11:32 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
Management agent started.

=INFO REPORT==== 30-Mar-2011::14:11:32 ===
Management plugin started.
HTTP API:       http://jbrisbin:55672/api/
Management UI:  http://jbrisbin:55672/mgmt/
 



From jasonjwwilliams at gmail.com  Wed Mar 30 21:19:59 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 30 Mar 2011 14:19:59 -0600
Subject: [rabbitmq-discuss] Ubuntu + RabbitMQ 2.4.0 EC2 AMI
Message-ID: <AANLkTimzM4=W4UeGNA37zCorYaTvVmEGkYvN1RL9H5GW@mail.gmail.com>

Hi All,

As a part of writing the clustering chapter for RabbitMQ in Action we've put
together an Amazon EC2 machine image (AMI) to make setting up a cluster
easier. We've made it public and it should be generic enough for anyone
wanting to play with RabbitMQ, not just readers of the book. Our hope is to
keep it updated with the latest Rabbit as they come off the factory floor
(the reason we built it was a lack of current Rabbit AMIs).

The AMI is an Ubuntu 10.04LTS 64-bit OS image with RabbitMQ 2.4.0 installed
from the official DEB. Be sure to change the .erlang.cookie in
/var/lib/rabbitmq if you actually want to use this in a production
environment for security reasons.

To use the AMI just search for AMI ID  ami-6b32612e when you launch new
instances.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/3b4708bf/attachment.htm>

From aaron at agoragames.com  Wed Mar 30 21:35:05 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Wed, 30 Mar 2011 16:35:05 -0400
Subject: [rabbitmq-discuss] 2.4.0 channel and connection close behavior
In-Reply-To: <20110330194131.GA1577@wellquite.org>
References: <AANLkTimBaHTn4OmWEgovJh9qartMJLjb9fuatY_fBj9X@mail.gmail.com>
	<20110330194131.GA1577@wellquite.org>
Message-ID: <AANLkTi=xQP6FnO8Frn_3_P6hgmEH2+8iSrvMB7GsDjvH@mail.gmail.com>

On Wed, Mar 30, 2011 at 3:41 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> However, from your description above, it sounds like you're not even
> getting the connection.close_ok back. Is that really the case?

That is correct; I receive no additional frames after two close frames
are sent.  I can confirm that frame processing is still happening
though, because I had to clean up an edge case where I published a
message after the channel close frame, and Rabbit sent a connection
close because of my error.

Regarding your interpretation of whether a channel close_ok should be
expected, I agree.

If only we could fix relativity, these damn "already on the wire" race
conditions would just go away.

-Aaron


-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From matthew at rabbitmq.com  Wed Mar 30 21:44:05 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 30 Mar 2011 21:44:05 +0100
Subject: [rabbitmq-discuss] 2.4.0 channel and connection close behavior
In-Reply-To: <AANLkTi=xQP6FnO8Frn_3_P6hgmEH2+8iSrvMB7GsDjvH@mail.gmail.com>
References: <AANLkTimBaHTn4OmWEgovJh9qartMJLjb9fuatY_fBj9X@mail.gmail.com>
	<20110330194131.GA1577@wellquite.org>
	<AANLkTi=xQP6FnO8Frn_3_P6hgmEH2+8iSrvMB7GsDjvH@mail.gmail.com>
Message-ID: <20110330204404.GB1577@wellquite.org>

On Wed, Mar 30, 2011 at 04:35:05PM -0400, Aaron Westendorf wrote:
> On Wed, Mar 30, 2011 at 3:41 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> > However, from your description above, it sounds like you're not even
> > getting the connection.close_ok back. Is that really the case?
> 
> That is correct; I receive no additional frames after two close frames
> are sent.  I can confirm that frame processing is still happening
> though, because I had to clean up an edge case where I published a
> message after the channel close frame, and Rabbit sent a connection
> close because of my error.

Are there any errors in either of the logs when this happens? There may
well be something in the sasl log, but I think this is likely a bug.

Matthew

From jasonjwwilliams at gmail.com  Wed Mar 30 22:17:19 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 30 Mar 2011 15:17:19 -0600
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a cluster.
Message-ID: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>

Hi Guys,

I've run into an interesting edge case that I don't seem to have a solution
for. I've got a local cluster with three nodes (2 disk, 1 RAM) called:
rabbit, rabbit_1 and rabbit_2.

If I attach a consumer (https://gist.github.com/895274) to rabbit_1
(declares queue, exchange and bindings) and start consuming, I can publish (
https://gist.github.com/895275) to rabbit or rabbit_2 and the messages are
consumed as expected. At this point the queue is living on rabbit and my
consumer for it is attached to rabbit_1.

If I shutdown rabbit, the queue on it disappears as expected (the queue at
this point is non-durable). However, the queue's consumer on rabbit_1 sits
there fat dumb and happy even though no queue exists anymore. Is this
expected behavior?

To further test, I changed the queue to a durable one and replayed the
previous events. Except this time since the consumer was still fat dumb and
happy, I restarted the rabbit node. Then I published again. Still nothing on
the consumer and the queue (which had returned) had a queue count of 0.
Doing a list_bindings showed the binding to still exist. But no amount of
publishing would end up in the restored queue or the consumer. The only
thing that allowed the queue to receive messages again (and the consumer to
receive them) was to redeclare the binding. This seems like an error since
the binding was reported as still existing.

Any help or pointers are greatly appreciated, as with this behavior
consumers of queue in a cluster could sit forever and never consume a
message after a failed node (and if the queue was durable, messages appear
to be blackholed despite the node being restored). This was on RabbitMQ
2.4.0 on OS X 10.6.7.

Thank you in advance.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/e94339c1/attachment-0001.htm>

From matthew at rabbitmq.com  Wed Mar 30 22:23:51 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 30 Mar 2011 22:23:51 +0100
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
Message-ID: <20110330212351.GC1577@wellquite.org>

On Wed, Mar 30, 2011 at 03:17:19PM -0600, Jason J. W. Williams wrote:
> I've run into an interesting edge case that I don't seem to have a solution
> for. I've got a local cluster with three nodes (2 disk, 1 RAM) called:
> rabbit, rabbit_1 and rabbit_2.
> 
> If I attach a consumer (https://gist.github.com/895274) to rabbit_1
> (declares queue, exchange and bindings) and start consuming, I can publish (
> https://gist.github.com/895275) to rabbit or rabbit_2 and the messages are
> consumed as expected. At this point the queue is living on rabbit and my
> consumer for it is attached to rabbit_1.
> 
> If I shutdown rabbit, the queue on it disappears as expected (the queue at
> this point is non-durable). However, the queue's consumer on rabbit_1 sits
> there fat dumb and happy even though no queue exists anymore. Is this
> expected behavior?

Yes. And addressed in 2.4.0. See
http://www.rabbitmq.com/extensions.html#consumer-cancel-notify

> To further test, I changed the queue to a durable one and replayed the
> previous events. Except this time since the consumer was still fat dumb and
> happy, I restarted the rabbit node. Then I published again. Still nothing on
> the consumer and the queue (which had returned) had a queue count of 0.
> Doing a list_bindings showed the binding to still exist. But no amount of
> publishing would end up in the restored queue or the consumer. The only
> thing that allowed the queue to receive messages again (and the consumer to
> receive them) was to redeclare the binding. This seems like an error since
> the binding was reported as still existing.

Actually, if you did a basic.cancel and then a basic.consume then you
should find you can start consuming from the queue again. That is the
expected strategy in light of the above notification extension.

Matthew

From jasonjwwilliams at gmail.com  Wed Mar 30 22:26:30 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 30 Mar 2011 15:26:30 -0600
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <20110330212351.GC1577@wellquite.org>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
	<20110330212351.GC1577@wellquite.org>
Message-ID: <AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>

>
> Actually, if you did a basic.cancel and then a basic.consume then you
> should find you can start consuming from the queue again. That is the
> expected strategy in light of the above notification extension.
>

Why does the queue count stay at 0 though until the rebind? That wouldn't
have anything to do with the consumption being re-established no?

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/00ad70d2/attachment.htm>

From matthew at rabbitmq.com  Wed Mar 30 22:28:07 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 30 Mar 2011 22:28:07 +0100
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <20110330212351.GC1577@wellquite.org>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
	<20110330212351.GC1577@wellquite.org>
Message-ID: <20110330212806.GD1577@wellquite.org>

On Wed, Mar 30, 2011 at 10:23:51PM +0100, Matthew Sackman wrote:
> Actually, if you did a basic.cancel and then a basic.consume then you
> should find you can start consuming from the queue again. That is the
> expected strategy in light of the above notification extension.

Err, the basic.cancel is unnecessary: the client and server both tidy up
any state associated with the subscription when they receive the
notification. You should just need the new basic.consume. However, this
behaviour is certainly specific to 2.4.0 clients and broker: prior to
this, if you have reason to suspect the queue had silently gone away,
you'd have to cancel and then reconsume otherwise at the very least,
you'd have a (very very slow) memory leak.

Matthew

From matthew at rabbitmq.com  Wed Mar 30 22:31:13 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 30 Mar 2011 22:31:13 +0100
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
	<20110330212351.GC1577@wellquite.org>
	<AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>
Message-ID: <20110330213113.GE1577@wellquite.org>

On Wed, Mar 30, 2011 at 03:26:30PM -0600, Jason J. W. Williams wrote:
> > Actually, if you did a basic.cancel and then a basic.consume then you
> > should find you can start consuming from the queue again. That is the
> > expected strategy in light of the above notification extension.
> 
> Why does the queue count stay at 0 though until the rebind? That wouldn't
> have anything to do with the consumption being re-established no?

Once the queue comes back up, provided the exchange to which it was
bound was _also_ durable, the bindings will be recreated. At that point
new msgs published to the queue should appear in the queue.

As for msgs that were previously sent to the queue before the node died,
a) they could have been consumed and ack'd by the consumer
b) they might not have been published persistent
c) they might have not been sync'd to disk so didn't get recovered

I'm afraid I don't have time right now to check your code to see if any
of these hypothesis hold true.

Matthew

From jasonjwwilliams at gmail.com  Wed Mar 30 22:40:00 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 30 Mar 2011 15:40:00 -0600
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <20110330213113.GE1577@wellquite.org>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
	<20110330212351.GC1577@wellquite.org>
	<AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>
	<20110330213113.GE1577@wellquite.org>
Message-ID: <AANLkTikS6BkFx-Rnunth2PfymCsfoVFG3_NDMzeJm4Ec@mail.gmail.com>

>
> Once the queue comes back up, provided the exchange to which it was
> bound was _also_ durable, the bindings will be recreated. At that point
> new msgs published to the queue should appear in the queue.
>
> As for msgs that were previously sent to the queue before the node died,
> a) they could have been consumed and ack'd by the consumer
> b) they might not have been published persistent
> c) they might have not been sync'd to disk so didn't get recovered
>

That's not what's happening. Previous messages aren't the issue...I expect
those to be blackholed. Once the node is back up, the queue and the bindings
show:

Phantome:rabbitmq-server  $ sudo /opt/rabbitmq-server/sbin/rabbitmqctl -n
rabbit_1 at Phantome list_queues
Listing queues ...
cluster_test 0
...done.
Phantome:rabbitmq-server  $ sudo /opt/rabbitmq-server/sbin/rabbitmqctl -n
rabbit_1 at Phantome list_bindings
Listing bindings ...
exchange cluster_test queue cluster_test []
...done.


If you publish at this point into the exchange, assuming the binding has
been restored as indicated, the queue shows still empty:

Phantome:rabbitmq-server  $ sudo /opt/rabbitmq-server/sbin/rabbitmqctl -n
rabbit_1 at Phantome list_queues
Listing queues ...
cluster_test 0
...done.


The queue doesn't start to fill with publishes until you redeclare the
binding.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/7abd8e86/attachment.htm>

From matthew at rabbitmq.com  Wed Mar 30 22:47:59 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 30 Mar 2011 22:47:59 +0100
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <AANLkTikS6BkFx-Rnunth2PfymCsfoVFG3_NDMzeJm4Ec@mail.gmail.com>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
	<20110330212351.GC1577@wellquite.org>
	<AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>
	<20110330213113.GE1577@wellquite.org>
	<AANLkTikS6BkFx-Rnunth2PfymCsfoVFG3_NDMzeJm4Ec@mail.gmail.com>
Message-ID: <20110330214759.GF1577@wellquite.org>

On Wed, Mar 30, 2011 at 03:40:00PM -0600, Jason J. W. Williams wrote:
> The queue doesn't start to fill with publishes until you redeclare the
> binding.

Very interesting. I assume the exchange in a fanout exchange (I see no
routing key in your list_bindings output). When in this "broken" state,
what happens if you publish to the queue with mandatory set?

Matthew

From jasonjwwilliams at gmail.com  Wed Mar 30 22:58:23 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 30 Mar 2011 15:58:23 -0600
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <20110330214759.GF1577@wellquite.org>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
	<20110330212351.GC1577@wellquite.org>
	<AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>
	<20110330213113.GE1577@wellquite.org>
	<AANLkTikS6BkFx-Rnunth2PfymCsfoVFG3_NDMzeJm4Ec@mail.gmail.com>
	<20110330214759.GF1577@wellquite.org>
Message-ID: <AANLkTinN2v_MXEpe=UTh2VHaOx++Me9QP=ih7AkMZyNO@mail.gmail.com>

>
> Very interesting. I assume the exchange in a fanout exchange (I see no
> routing key in your list_bindings output). When in this "broken" state,
> what happens if you publish to the queue with mandatory set?


The exchange is a direct exchange. With mandatory set it doesn't raise any
exceptions.

I'm noticing the output of list_bindings is different after the node restart
and then after the redeclare.

Before Restart:

Listing bindings ...
exchange cluster_test queue cluster_test []
cluster_test exchange cluster_test queue cluster_test []
...done.

While Node Is Down:
Listing bindings ...
...done.

After Restart:

Listing bindings ...
exchange cluster_test queue cluster_test []
...done.


It looks like there's an extra binding that doesn't get recreated.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/772f004a/attachment-0001.htm>

From matthew at rabbitmq.com  Wed Mar 30 23:10:54 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 30 Mar 2011 23:10:54 +0100
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <AANLkTinN2v_MXEpe=UTh2VHaOx++Me9QP=ih7AkMZyNO@mail.gmail.com>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
	<20110330212351.GC1577@wellquite.org>
	<AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>
	<20110330213113.GE1577@wellquite.org>
	<AANLkTikS6BkFx-Rnunth2PfymCsfoVFG3_NDMzeJm4Ec@mail.gmail.com>
	<20110330214759.GF1577@wellquite.org>
	<AANLkTinN2v_MXEpe=UTh2VHaOx++Me9QP=ih7AkMZyNO@mail.gmail.com>
Message-ID: <20110330221054.GG1577@wellquite.org>

On Wed, Mar 30, 2011 at 03:58:23PM -0600, Jason J. W. Williams wrote:
> > Very interesting. I assume the exchange in a fanout exchange (I see no
> > routing key in your list_bindings output). When in this "broken" state,
> > what happens if you publish to the queue with mandatory set?
> 
> The exchange is a direct exchange. With mandatory set it doesn't raise any
> exceptions.

Curious... though it shouldn't return an exception - it should return
the msg with a basic.return. I have no idea whether pika supports that
or where it would appear.

> I'm noticing the output of list_bindings is different after the node restart
> and then after the redeclare.
> 
> Before Restart:
> 
> Listing bindings ...
> exchange cluster_test queue cluster_test []

That's the binding from the default nameless exchange to the
"cluster_test" queue with the routing_key of "cluster_test".

> cluster_test exchange cluster_test queue cluster_test []

That's the binding from the cluster_test exchange to the cluster_test
queue with the binding key cluster_test.

> Listing bindings ...
> exchange cluster_test queue cluster_test []
> ...done.

The latter binding has gone. I suspect your exchange has not been
declared durable. Your pika code certainly doesn't make any attempt to
set the exchange declaration durable. As with queues, durable is
different from auto_delete.

> It looks like there's an extra binding that doesn't get recreated.

Binding recreation is dependent on both the exchange and queue being
durable, even if the exchange survives due to the fact it's part of a
cluster.

Matthew

From jasonjwwilliams at gmail.com  Wed Mar 30 23:11:19 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 30 Mar 2011 16:11:19 -0600
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <AANLkTinN2v_MXEpe=UTh2VHaOx++Me9QP=ih7AkMZyNO@mail.gmail.com>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
	<20110330212351.GC1577@wellquite.org>
	<AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>
	<20110330213113.GE1577@wellquite.org>
	<AANLkTikS6BkFx-Rnunth2PfymCsfoVFG3_NDMzeJm4Ec@mail.gmail.com>
	<20110330214759.GF1577@wellquite.org>
	<AANLkTinN2v_MXEpe=UTh2VHaOx++Me9QP=ih7AkMZyNO@mail.gmail.com>
Message-ID: <AANLkTi==KOQe--7mq5ShHO8cswJQpdNizZP_BWQnK=xL@mail.gmail.com>

On Wed, Mar 30, 2011 at 3:58 PM, Jason J. W. Williams <
jasonjwwilliams at gmail.com> wrote:

> Very interesting. I assume the exchange in a fanout exchange (I see no
>> routing key in your list_bindings output). When in this "broken" state,
>> what happens if you publish to the queue with mandatory set?
>
>
> The exchange is a direct exchange. With mandatory set it doesn't raise any
> exceptions.
>
> I'm noticing the output of list_bindings is different after the node
> restart and then after the redeclare.
>
> Before Restart:
>
> Listing bindings ...
> exchange cluster_test queue cluster_test []
> cluster_test exchange cluster_test queue cluster_test []
> ...done.
>
> While Node Is Down:
> Listing bindings ...
> ...done.
>
> After Restart:
>
> Listing bindings ...
>  exchange cluster_test queue cluster_test []
> ...done.
>
>
> It looks like there's an extra binding that doesn't get recreated.
>
> -J
>

Of related note at Alvaro's suggestion I tried publishing into the ""
exchange with the queue as the routing key when the binding is
non-functional. That puts the message into the queue as expected.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/ebe0895a/attachment.htm>

From jasonjwwilliams at gmail.com  Wed Mar 30 23:14:16 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 30 Mar 2011 16:14:16 -0600
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <20110330221054.GG1577@wellquite.org>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
	<20110330212351.GC1577@wellquite.org>
	<AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>
	<20110330213113.GE1577@wellquite.org>
	<AANLkTikS6BkFx-Rnunth2PfymCsfoVFG3_NDMzeJm4Ec@mail.gmail.com>
	<20110330214759.GF1577@wellquite.org>
	<AANLkTinN2v_MXEpe=UTh2VHaOx++Me9QP=ih7AkMZyNO@mail.gmail.com>
	<20110330221054.GG1577@wellquite.org>
Message-ID: <AANLkTi=QPDaHPn=o=jmuWfZMmE8diLbHJ1JeaCQ1=fCx@mail.gmail.com>

>
> > It looks like there's an extra binding that doesn't get recreated.
>
> Binding recreation is dependent on both the exchange and queue being
> durable, even if the exchange survives due to the fact it's part of a
> cluster.


That would make sense. I was under the (erroneous) impression making the
exchange durable only mattered if the exchange was lost (e.g. cluster went
down or a standalone node failed). Thank you for working through it with me.
I'll see what we can do about getting cancellation notifications into Pika
and the book.

-J
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110330/d3ffb936/attachment.htm>

From matthew at rabbitmq.com  Wed Mar 30 23:16:38 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 30 Mar 2011 23:16:38 +0100
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <AANLkTi=QPDaHPn=o=jmuWfZMmE8diLbHJ1JeaCQ1=fCx@mail.gmail.com>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
	<20110330212351.GC1577@wellquite.org>
	<AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>
	<20110330213113.GE1577@wellquite.org>
	<AANLkTikS6BkFx-Rnunth2PfymCsfoVFG3_NDMzeJm4Ec@mail.gmail.com>
	<20110330214759.GF1577@wellquite.org>
	<AANLkTinN2v_MXEpe=UTh2VHaOx++Me9QP=ih7AkMZyNO@mail.gmail.com>
	<20110330221054.GG1577@wellquite.org>
	<AANLkTi=QPDaHPn=o=jmuWfZMmE8diLbHJ1JeaCQ1=fCx@mail.gmail.com>
Message-ID: <20110330221637.GH1577@wellquite.org>

On Wed, Mar 30, 2011 at 04:14:16PM -0600, Jason J. W. Williams wrote:
> That would make sense. I was under the (erroneous) impression making the
> exchange durable only mattered if the exchange was lost (e.g. cluster went
> down or a standalone node failed). Thank you for working through it with me.
> I'll see what we can do about getting cancellation notifications into Pika
> and the book.

No probs at all. I agree it would be good for pika to catch up with some
of the features we've been adding to AMQP, but I realise there's likely
a lot of code in flux atm. Please let us know if any of the
documentation regarding our extensions is unclear. If in doubt though,
using the Java Tracer and/or wireshark is probably the most immediate
way for you to see what our clients are sending and receiving from the
broker.

Best wishes,

Matthew

From jasonjwwilliams at gmail.com  Wed Mar 30 23:21:32 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 30 Mar 2011 16:21:32 -0600
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <20110330221637.GH1577@wellquite.org>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>
	<20110330212351.GC1577@wellquite.org>
	<AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>
	<20110330213113.GE1577@wellquite.org>
	<AANLkTikS6BkFx-Rnunth2PfymCsfoVFG3_NDMzeJm4Ec@mail.gmail.com>
	<20110330214759.GF1577@wellquite.org>
	<AANLkTinN2v_MXEpe=UTh2VHaOx++Me9QP=ih7AkMZyNO@mail.gmail.com>
	<20110330221054.GG1577@wellquite.org>
	<AANLkTi=QPDaHPn=o=jmuWfZMmE8diLbHJ1JeaCQ1=fCx@mail.gmail.com>
	<20110330221637.GH1577@wellquite.org>
Message-ID: <AANLkTi=UrR+o+WCbwR0F=31KUxpXRFm0Yh=izCrZ2-Kc@mail.gmail.com>

> No probs at all. I agree it would be good for pika to catch up with some
> of the features we've been adding to AMQP, but I realise there's likely
> a lot of code in flux atm. Please let us know if any of the
> documentation regarding our extensions is unclear. If in doubt though,
> using the Java Tracer and/or wireshark is probably the most immediate
> way for you to see what our clients are sending and receiving from the
> broker.

Cancellation notifications are really core to writing good
cluster-aware clients, so I'm hopeful we can get it into Pika. I was
going through the docs on capabilities presentation, was little
unclear what format the table needs to be in. The spec seems to expect
a string there so I assume the table is encoded either in something
like Erlang or JSON. Going from the docs, would this be the right
capabilities string to pass to enable cancellation notification?

'{"consumer_cancel_notify" = true}'

Thank you again very much!

-J

From matthew at rabbitmq.com  Wed Mar 30 23:37:50 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 30 Mar 2011 23:37:50 +0100
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <AANLkTi=UrR+o+WCbwR0F=31KUxpXRFm0Yh=izCrZ2-Kc@mail.gmail.com>
References: <20110330212351.GC1577@wellquite.org>
	<AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>
	<20110330213113.GE1577@wellquite.org>
	<AANLkTikS6BkFx-Rnunth2PfymCsfoVFG3_NDMzeJm4Ec@mail.gmail.com>
	<20110330214759.GF1577@wellquite.org>
	<AANLkTinN2v_MXEpe=UTh2VHaOx++Me9QP=ih7AkMZyNO@mail.gmail.com>
	<20110330221054.GG1577@wellquite.org>
	<AANLkTi=QPDaHPn=o=jmuWfZMmE8diLbHJ1JeaCQ1=fCx@mail.gmail.com>
	<20110330221637.GH1577@wellquite.org>
	<AANLkTi=UrR+o+WCbwR0F=31KUxpXRFm0Yh=izCrZ2-Kc@mail.gmail.com>
Message-ID: <20110330223750.GI1577@wellquite.org>

On Wed, Mar 30, 2011 at 04:21:32PM -0600, Jason J. W. Williams wrote:
> The spec seems to expect
> a string there so I assume the table is encoded either in something
> like Erlang or JSON.

The table is a normal AMQP table, with keys as shortstrs, and values as
bools. It's exactly the same type of table as server_properties or
client_properties.

Matthew

From jasonjwwilliams at gmail.com  Wed Mar 30 23:42:10 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 30 Mar 2011 16:42:10 -0600
Subject: [rabbitmq-discuss] Pathological dead queue behavior in a
	cluster.
In-Reply-To: <20110330223750.GI1577@wellquite.org>
References: <20110330212351.GC1577@wellquite.org>
	<AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>
	<20110330213113.GE1577@wellquite.org>
	<AANLkTikS6BkFx-Rnunth2PfymCsfoVFG3_NDMzeJm4Ec@mail.gmail.com>
	<20110330214759.GF1577@wellquite.org>
	<AANLkTinN2v_MXEpe=UTh2VHaOx++Me9QP=ih7AkMZyNO@mail.gmail.com>
	<20110330221054.GG1577@wellquite.org>
	<AANLkTi=QPDaHPn=o=jmuWfZMmE8diLbHJ1JeaCQ1=fCx@mail.gmail.com>
	<20110330221637.GH1577@wellquite.org>
	<AANLkTi=UrR+o+WCbwR0F=31KUxpXRFm0Yh=izCrZ2-Kc@mail.gmail.com>
	<20110330223750.GI1577@wellquite.org>
Message-ID: <AANLkTinJrsLWqttHypaABS0_z=2m9Th3BDNf4La9gsm4@mail.gmail.com>

> The table is a normal AMQP table, with keys as shortstrs, and values as
> bools. It's exactly the same type of table as server_properties or
> client_properties.

OK...that means Pika isn't interpreting capabilities properly (expects
a string instead of a Python dict like client_properties). Thank you.
I'll leave you alone now for the evening. :)

-J

From matthias at rabbitmq.com  Thu Mar 31 05:41:44 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 31 Mar 2011 05:41:44 +0100
Subject: [rabbitmq-discuss] Pathological dead queue behavior in
	a	cluster.
In-Reply-To: <20110330221054.GG1577@wellquite.org>
References: <AANLkTikNdoO1hd=MfkPr93KwrY8gVsyM=oeYGdAhCq4C@mail.gmail.com>	<20110330212351.GC1577@wellquite.org>	<AANLkTinGZwjDxN-xKeVNkSyv3XuYMQX07ES4Sj9RTS9_@mail.gmail.com>	<20110330213113.GE1577@wellquite.org>	<AANLkTikS6BkFx-Rnunth2PfymCsfoVFG3_NDMzeJm4Ec@mail.gmail.com>	<20110330214759.GF1577@wellquite.org>	<AANLkTinN2v_MXEpe=UTh2VHaOx++Me9QP=ih7AkMZyNO@mail.gmail.com>
	<20110330221054.GG1577@wellquite.org>
Message-ID: <4D940608.1030402@rabbitmq.com>

Matthew Sackman wrote:
> Binding recreation is dependent on both the exchange and queue being
> durable, even if the exchange survives due to the fact it's part of a
> cluster.

Simon and I were discussing that very scenario today and concluded that 
rabbit is probably exhibiting the wrong behaviour here. I have filed a bug.

An interesting related issue is whether a client should be able to 
add/remove bindings for such queues while they are unavailable. I reckon 
the answer is 'no'.


Matthias.

From matthias at rabbitmq.com  Thu Mar 31 07:22:11 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 31 Mar 2011 07:22:11 +0100
Subject: [rabbitmq-discuss] Problems starting 2.4.0 on OS X w/ mgmt
	plugins
In-Reply-To: <71B3B674-43F9-41C8-8E61-DF10EB6CEF33@jbrisbin.com>
References: <71B3B674-43F9-41C8-8E61-DF10EB6CEF33@jbrisbin.com>
Message-ID: <4D941D93.6040402@rabbitmq.com>

Jon,

Jon Brisbin wrote:
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function fdsrv:bind_socket/2
> *WARNING* Undefined function fdsrv:start/0
> *WARNING* Undefined function fdsrv:stop/0
> *WARNING* Undefined function webmachine_resource:start_link/2
> 6 plugins activated:
> * amqp_client-2.4.0
> * mochiweb-1.3
> * rabbit_management-2.4.0.1
> * rabbit_management_agent-2.4.0
> * rabbit_mochiweb-2.4.0
> * webmachine-1.7.0
> 
> ^C
> BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
>       (v)ersion (k)ill (D)b-tables (d)istribution
> ^C
> 
> ^^^^^^^^
> This is where I kill it...then it continues on fine...

Do you encounter the same behaviour w/o any plug-ins installed? I 
suspect you do, but please check.

FWIW, I reckon rabbit gets stuck at
http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_4_0/src/rabbit_prelaunch.erl#l250

Does your hostname (jbrisbin) resolve? Is the epmd process running after 
you have started rabbit for the first time? And can you connect to epmd 
on your hostname ('telnet jbrisbin 4369')?


Regards,

Matthias.

From dhivya.swaminathan at tcs.com  Thu Mar 31 07:25:07 2011
From: dhivya.swaminathan at tcs.com (Dhivya Swaminathan)
Date: Thu, 31 Mar 2011 11:55:07 +0530
Subject: [rabbitmq-discuss] Erlang installation not detected
Message-ID: <OF59F00E9D.4E2CE490-ON65257864.002341F5-65257864.00234241@tcs.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/8855c850/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit1.png
Type: image/png
Size: 68078 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/8855c850/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit2.png
Type: image/png
Size: 64243 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/8855c850/attachment-0003.png>

From videlalvaro at gmail.com  Thu Mar 31 07:27:46 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 31 Mar 2011 08:27:46 +0200
Subject: [rabbitmq-discuss] Erlang installation not detected
In-Reply-To: <OF59F00E9D.4E2CE490-ON65257864.002341F5-65257864.00234241@tcs.com>
References: <OF59F00E9D.4E2CE490-ON65257864.002341F5-65257864.00234241@tcs.com>
Message-ID: <F7263DF6-1720-4F58-9E20-B19550E96FBB@gmail.com>

Hi,

Do you have erlang and the erl command  in your PATH? Try this command:

which erl

That should point where "erl" is. If you get a blank answer, then try adding erlang to your PATH.

On Mar 31, 2011, at 8:25 AM, Dhivya Swaminathan wrote:

> Hi,
> 
> I am using RHEL v6 and I have installed erlang (otp_src-14B01) and downloaded rabbitmq-server-generic-unix-2.3.1.tar.gz.But while running rabbitmq server that is
> 
> sudo ./rabbitmq-server
> 
> It is giving error erl not found.Any idea on why it is not detecting erlang?Attached screenshots for ur reference.
> 
> 
> 
> 
> 
> Dhivya Swaminathan
> Tata Consultancy Services
> Mailto: dhivya.swaminathan at tcs.com
> Website: http://www.tcs.com
> ____________________________________________
> Experience certainty.	IT Services
> Business Solutions
> Outsourcing
> ____________________________________________
> =====-----=====-----=====
> Notice: The information contained in this e-mail
> message and/or attachments to it may contain 
> confidential or privileged information. If you are 
> not the intended recipient, any dissemination, use, 
> review, distribution, printing or copying of the 
> information contained in this e-mail message 
> and/or attachments to it are strictly prohibited. If 
> you have received this communication in error, 
> please notify us by reply e-mail or telephone and 
> immediately and permanently delete the message 
> and any attachments. Thank you
> 
> 
> <rabbit1.png><rabbit2.png>_______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/410bd637/attachment.htm>

From dhivya.swaminathan at tcs.com  Thu Mar 31 07:35:51 2011
From: dhivya.swaminathan at tcs.com (Dhivya Swaminathan)
Date: Thu, 31 Mar 2011 12:05:51 +0530
Subject: [rabbitmq-discuss] Erlang installation not detected
In-Reply-To: <F7263DF6-1720-4F58-9E20-B19550E96FBB@gmail.com>
References: <F7263DF6-1720-4F58-9E20-B19550E96FBB@gmail.com>,
	<OF59F00E9D.4E2CE490-ON65257864.002341F5-65257864.00234241@tcs.com>
Message-ID: <OF263386F1.C65D185A-ON65257864.00243DCE-65257864.00243DFD@tcs.com>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/90e6ab0f/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit3.png
Type: image/png
Size: 56708 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/90e6ab0f/attachment-0001.png>

From alfonso.pantoja at gmail.com  Thu Mar 31 10:38:31 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 31 Mar 2011 11:38:31 +0200
Subject: [rabbitmq-discuss] Unexpected server crash and .NET API:
 disconnect is not detected?
In-Reply-To: <4D934E15.6080207@rabbitmq.com>
References: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>
	<4D934E15.6080207@rabbitmq.com>
Message-ID: <AANLkTimGNpQpjBUBEBKCOKN1BwTB1uUvmSQFeLh8QJ-5@mail.gmail.com>

Hi Emile,

I'm using a class based on Subscription (the core functionality is the same
as Subscription in v2.2.0 and the only differences are that I have new
methods and made public a pair of private properties) called from a
RpcServer class (which I also made my own modifications but calls my custom
Subscription class the same way as the v2.2.0 provided classes)

I can reproduce the issue (but I'm not sure if it is a expected behavior) by
doing the following steps:

1. Send  messages to a queue
2. Start a consumer application
3. Disable the network connection in order to simulate an unexpected crash.

What I see is that the my custom RpcServer class which recover  the messages
keep looping with the foreach although there connection is closed.

public void MainLoop()
{

            foreach (BasicDeliverEventArgs evt in m_subscription)
            {
                    ProcessRequest(evt);
            }

 }

In my custom Subscription class I see that the method Next is returning all
events even if the consumer is not running and no exception is launched when
is called by foreach loop.
(note: Next() is identical to Subscription class in v2.2.0 because I didn't
modiy it)

        public BasicDeliverEventArgs Next()
        {
            try
            {
                QueueingBasicConsumer consumer = m_consumer;
                if (consumer == null)
                {
                    // Closed!
                    m_latestEvent = null;
                }
                else
                {

                    m_latestEvent =
(BasicDeliverEventArgs)consumer.Queue.Dequeue();
                }
            }
            catch (EndOfStreamException)
            {
                m_latestEvent = null;
            }
            return m_latestEvent;
        }


My question is: should consumer.Queue.Dequeue() raise an exception when
"consumer" property IsRunning is false?
Currently this is not happening.

In my code a workaround could be to check consumer.IsRunning and assign
m_lastestEvent to null when if it is "false" and in MainLoop handle that or
to launch an excepcion which would cause MainLoop to end.

Any advice would be appreaciated.

Thank you in advance.


Regards,

Alfonso







2011/3/30 Emile Joubert <emile at rabbitmq.com>

> Hi Alfonso,
>
>
> On 30/03/11 15:43, Alfonso wrote:
>
>> Hi,
>>
>> This is a difficult one: I've observed a couple of times that my
>> consumer (.NET API 2.2.0) doesn't notice when the server that is
>> running RabbitMQ (2.2.0) crashes.
>> Please note that I mean server crash -unexpected shutdown, OS crash,
>> etc.- not RabbitMQ crash.
>>
>> My application is consuming from a queue using "foreach" to get the
>> messages and I has an event handler attached to the onShutdown event.
>>
>
> I'm not able to reproduce this using version 2.2.0 of the broker and the
> .NET client, implementing the the Subscription pattern. A connectivity
> problem immediately causes an OperationInterruptedException to be thrown
> from ConnectionBase.Dispose().
>
>
>  Time ago disconnection tests consisting of disconnecting the consumer
>> from the web admin console were made and the event handler was fired
>> always. So disconnections are caught and logged properly.
>>
>> The problem is that the consumer got stuck when the server crashed and
>> it didn't notice that the connection was gone (due to a server crash)
>> so it was impossible to log a disconnection error.
>> In the code there is a while loop for reconnecting when the connection
>> fails but didn't loop because my guess is that the code were stuck in
>> the "foreach".
>>
>> Am I missing something or this could be and issue?
>>
>
> Is it possible that you are preventing an exception from the socket from
> affecting the Subscription? Posting a minimal piece of code for
> demonstration may be useful.
>
>
>
> Regards
>
> Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/1247d780/attachment.htm>

From alfonso.pantoja at gmail.com  Thu Mar 31 10:49:32 2011
From: alfonso.pantoja at gmail.com (Alfonso)
Date: Thu, 31 Mar 2011 02:49:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Unexpected server crash and .NET API:
	disconnect is not detected?
In-Reply-To: <AANLkTimGNpQpjBUBEBKCOKN1BwTB1uUvmSQFeLh8QJ-5@mail.gmail.com>
References: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>
	<4D934E15.6080207@rabbitmq.com>
	<AANLkTimGNpQpjBUBEBKCOKN1BwTB1uUvmSQFeLh8QJ-5@mail.gmail.com>
Message-ID: <7216746d-435e-4fbb-85a4-82ab2013ffb1@e26g2000vbz.googlegroups.com>

One more thing regarding my previous message:

1. I disabled the newtwork connection from my development machine
(RabbitMQ server is on another machine).

2. I've see that the connection is still in some way "alive" even if I
kill the application because it appears on RabbitMQ web admin as
"running" but not sure if its a problem with my implementation or  it
is a issue regarding QueueingBasicConsumer.
Maybe this is happening due to foreach keep looping so my code keeps
trying to process messages and sending acks or rejects to the server
which always fail because there is no connection.

Regards,


Alfonso


On 31 mar, 11:38, Alfonso Pantoja <alfonso.pant... at gmail.com> wrote:
> Hi Emile,
>
> I'm using a class based on Subscription (the core functionality is the same
> as Subscription in v2.2.0 and the only differences are that I have new
> methods and made public a pair of private properties) called from a
> RpcServer class (which I also made my own modifications but calls my custom
> Subscription class the same way as the v2.2.0 provided classes)
>
> I can reproduce the issue (but I'm not sure if it is a expected behavior) by
> doing the following steps:
>
> 1. Send ?messages to a queue
> 2. Start a consumer application
> 3. Disable the network connection in order to simulate an unexpected crash.
>
> What I see is that the my custom RpcServer class which recover ?the messages
> keep looping with the foreach although there connection is closed.
>
> public void MainLoop()
> {
>
> ? ? ? ? ? ? foreach (BasicDeliverEventArgs evt in m_subscription)
> ? ? ? ? ? ? {
> ? ? ? ? ? ? ? ? ? ? ProcessRequest(evt);
> ? ? ? ? ? ? }
>
> ?}
>
> In my custom Subscription class I see that the method Next is returning all
> events even if the consumer is not running and no exception is launched when
> is called by foreach loop.
> (note: Next() is identical to Subscription class in v2.2.0 because I didn't
> modiy it)
>
> ? ? ? ? public BasicDeliverEventArgs Next()
> ? ? ? ? {
> ? ? ? ? ? ? try
> ? ? ? ? ? ? {
> ? ? ? ? ? ? ? ? QueueingBasicConsumer consumer = m_consumer;
> ? ? ? ? ? ? ? ? if (consumer == null)
> ? ? ? ? ? ? ? ? {
> ? ? ? ? ? ? ? ? ? ? // Closed!
> ? ? ? ? ? ? ? ? ? ? m_latestEvent = null;
> ? ? ? ? ? ? ? ? }
> ? ? ? ? ? ? ? ? else
> ? ? ? ? ? ? ? ? {
>
> ? ? ? ? ? ? ? ? ? ? m_latestEvent =
> (BasicDeliverEventArgs)consumer.Queue.Dequeue();
> ? ? ? ? ? ? ? ? }
> ? ? ? ? ? ? }
> ? ? ? ? ? ? catch (EndOfStreamException)
> ? ? ? ? ? ? {
> ? ? ? ? ? ? ? ? m_latestEvent = null;
> ? ? ? ? ? ? }
> ? ? ? ? ? ? return m_latestEvent;
> ? ? ? ? }
>
> My question is: should consumer.Queue.Dequeue() raise an exception when
> "consumer" property IsRunning is false?
> Currently this is not happening.
>
> In my code a workaround could be to check consumer.IsRunning and assign
> m_lastestEvent to null when if it is "false" and in MainLoop handle that or
> to launch an excepcion which would cause MainLoop to end.
>
> Any advice would be appreaciated.
>
> Thank you in advance.
>
> Regards,
>
> Alfonso
>
> 2011/3/30 Emile Joubert <em... at rabbitmq.com>
>
>
>
>
>

From mli at rmmsoft.com.cn  Thu Mar 31 10:53:07 2011
From: mli at rmmsoft.com.cn (Ming Li)
Date: Thu, 31 Mar 2011 09:53:07 +0000
Subject: [rabbitmq-discuss] RabbitMQ crashes when messages are being pumped
 into a queue under win32 envir
Message-ID: <19F7DB1491CA0149AF64F65336540FEA0E63E8C2@server.rmmsoft.com.cn>



1.       using RabbitMQ2.4.0(windows bundle).winxp, creates an exchange and a queue.

2.       use multiple sender to send messages into the created queue, only a single receiver receiving message from the same queue.

3.       while running, what i discovered is that the ERL's RAM usage continue to increase and then crash when it reaches a certain percentage



Is there a way to prevent it from crashing?



Here are my receiver and sender source code:



Receiver:

RabbitMQ.Client.ConnectionFactory cf = new RabbitMQ.Client.ConnectionFactory();
            cf.UserName = RabbitMQ.Client.ConnectionFactory.DefaultUser;
            cf.Password = RabbitMQ.Client.ConnectionFactory.DefaultPass;
            cf.VirtualHost = RabbitMQ.Client.ConnectionFactory.DefaultVHost;
            cf.Protocol = RabbitMQ.Client.Protocols.FromEnvironment();
            cf.HostName = "192.168.3.43";
            cf.Address = "192.168.3.43";
            cf.Port = 9007;

            RabbitMQ.Client.IConnection IC = cf.CreateConnection();
            RabbitMQ.Client.IModel IM = IC.CreateModel();

            string qu = "Queue11"/*IM.QueueDeclare()*/;
            IM.QueueDeclare(qu, false, false, true, null);
            IM.BasicGet(qu, true);

            IM.BasicReturn += new RabbitMQ.Client.Events.BasicReturnEventHandler(IM_BasicReturn);
            RabbitMQ.Client.QueueingBasicConsumer _consumer = new RabbitMQ.Client.QueueingBasicConsumer(IM);

            IM.BasicConsume(qu, true, _consumer);
            int iCount = 0;
            while (true)
            {
                RabbitMQ.Client.Events.BasicDeliverEventArgs e = null;

                object obj = _consumer.Queue.Dequeue();
                if (obj == null || (e = obj as RabbitMQ.Client.Events.BasicDeliverEventArgs) == null)
                {
                   }
         }

Sender:

RabbitMQ.Client.ConnectionFactory cf = new RabbitMQ.Client.ConnectionFactory();
            cf.UserName = RabbitMQ.Client.ConnectionFactory.DefaultUser;
            cf.Password = RabbitMQ.Client.ConnectionFactory.DefaultPass;
            cf.VirtualHost = RabbitMQ.Client.ConnectionFactory.DefaultVHost;
            cf.Protocol = RabbitMQ.Client.Protocols.FromEnvironment();
            cf.HostName = "192.168.3.43";
            cf.Address = "192.168.3.43";
            cf.Port = 9007;

            SingleQuoteResponse res = new SingleQuoteResponse();
            T_Quote tq = new T_Quote();
            tq.SecurityDesc = "ssssssssss";
            res.Quote = tq;

            RabbitMQ.Client.IConnection IC = cf.CreateConnection();
            RabbitMQ.Client.IModel IM = IC.CreateModel();

            for (int j = 0; j < 100000000; j++)
            {
                IM.BasicPublish("", "Queue11", null, ESHelper.asES(ref res).ToBytes());
                Console.WriteLine("Sended :" + j.ToString());
            }

         if (IM != null)
            {
                IM.Close();
                IM.Dispose();
            }
            if (IM != null)
            {
                IC.Close();
                IC.Dispose();
            }

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/144b53f2/attachment-0001.htm>

From emile at rabbitmq.com  Thu Mar 31 11:26:34 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 31 Mar 2011 11:26:34 +0100
Subject: [rabbitmq-discuss] Unexpected server crash and .NET
 API:	disconnect is not detected?
In-Reply-To: <7216746d-435e-4fbb-85a4-82ab2013ffb1@e26g2000vbz.googlegroups.com>
References: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>	<4D934E15.6080207@rabbitmq.com>	<AANLkTimGNpQpjBUBEBKCOKN1BwTB1uUvmSQFeLh8QJ-5@mail.gmail.com>
	<7216746d-435e-4fbb-85a4-82ab2013ffb1@e26g2000vbz.googlegroups.com>
Message-ID: <4D9456DA.3060207@rabbitmq.com>

Hi Alfonso,

I'm still not able to reproduce the problem you describe. As far as I 
can see the subscription and the underlying connection are properly 
disposed and the shutdown eventhandler is called if the connection is 
interrupted.

As previously suggested, is it possible that some of your modifications 
prevent the socket exception from affecting the Subscription? Are you 
able to reproduce the problem without any modifications to the rabbit 
library?

On 31/03/11 10:49, Alfonso wrote:
> One more thing regarding my previous message:
>
> 1. I disabled the newtwork connection from my development machine
> (RabbitMQ server is on another machine).
>
> 2. I've see that the connection is still in some way "alive" even if I

You can confirm whether the connection is alive by running "rabbitmqctl 
list_connections" or "netstat".



Regards

Emile

From emile at rabbitmq.com  Thu Mar 31 12:31:37 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 31 Mar 2011 12:31:37 +0100
Subject: [rabbitmq-discuss] [ANN] Netamqp,
 a client for AMQP-0-9-1 in Ocaml
In-Reply-To: <1301321281.8429.509.camel@thinkpad>
References: <1301321281.8429.509.camel@thinkpad>
Message-ID: <4D946619.60101@rabbitmq.com>

Hi Gerd,

On 28/03/11 15:08, Gerd Stolpmann wrote:
> Hi,
>
> the ocaml team at Mylife is proud to release another library to the
> public: Netamqp is a client of the AMQP-0-9-1 protocol.

We'd be delighted to add this library to the list at 
http://www.rabbitmq.com/devtools.html .


BTW, if you want to make use of all the rabbit extensions then you can 
run the codegen from this XML file:

http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/docs/specs/amqp0-9-1.xml


Regards

Emile

From mrkafk at gmail.com  Thu Mar 31 12:37:37 2011
From: mrkafk at gmail.com (Marcin Krol)
Date: Thu, 31 Mar 2011 13:37:37 +0200
Subject: [rabbitmq-discuss] make node a disk node
Message-ID: <4D946781.1030809@gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello everyone,

For the life of me I can't find this info in documentation: how to make
a node a disk node?

http://www.rabbitmq.com/clustering.html#change-type

"We can change the type of a node from ram to disk and vice versa. Say
we wanted to reverse the types of rabbit at rabbit2 and rabbit at rabbit3,
turning the former from a ram node into a disk node and the latter from
a disk node into a ram node. To do that we simply stop the RabbitMQ
application, change the type with an appropriate cluster command, and
restart the application."

Err... what is "an appropriate cluster command"? manpage of rabbitmqctl
does not say anything about that!

Help is appreciated.

Regards,
mk
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.14 (MingW32)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQEcBAEBAgAGBQJNlGeBAAoJEFMgHzhQQ7hOY/gH/2PofejPxg4DJufKqXJ43FlH
ExJrJNIEQFjmULjPkNNydPN6sbq6M6QLtZvE4SuwmxiR0lfhVWiSQuQ0SdEbjThg
Oc5eyNLU1VYbwzMmMhsyaYc7ViXpoxpU4GxQ48V9Sr4VhVMsG0oYj6f3T9qr6PwJ
kvll8AgjmTwxHog6FPd/6+BkEltchmb1vZGcD3M3qwW23uupN32RyzKFovYrnm88
GgXhIsXFZYzybux7lXxY+zC4PW8TiXalyxRtMjtWSRqPoaom9sgu7aVNKpSpICsK
SmAfRqiSVVl5d/yZoY9uq3kz80+NpqyfLAcR7lWnuR5c282HkPHbrqPJb0S2IEI=
=2zSV
-----END PGP SIGNATURE-----

From alfonso.pantoja at gmail.com  Thu Mar 31 12:52:58 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 31 Mar 2011 13:52:58 +0200
Subject: [rabbitmq-discuss] Unexpected server crash and .NET API:
 disconnect is not detected?
In-Reply-To: <4D9456DA.3060207@rabbitmq.com>
References: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>
	<4D934E15.6080207@rabbitmq.com>
	<AANLkTimGNpQpjBUBEBKCOKN1BwTB1uUvmSQFeLh8QJ-5@mail.gmail.com>
	<7216746d-435e-4fbb-85a4-82ab2013ffb1@e26g2000vbz.googlegroups.com>
	<4D9456DA.3060207@rabbitmq.com>
Message-ID: <AANLkTimu34oKeqca7kTgcxNSS72rxq1vjUBMoFGrrSr+@mail.gmail.com>

Emile,

I've compared Subscription class with my custom subscription using Beyond
compare
and the only differences are:


1. I've added custom binding methods
2. I deleted "shouldDelete" logic because don't wanted to remove queues


I can confirm the RabbitMQ is listing the connection.

In fact in queues appear something like this.

Listing connections ...
guest   192.168.0.121   62966   running

(checked after more than 5 minutes after killing the application)
Using TCPVIEW  (SysInternals tools) there is no connection from my machine
to the server.


Name  | Node |  Parameters  | status |  Ready |  unacked   | Total  |
incoming |  deliver/get  | ack

alfonsoqueue | rabbit at nodename | D | Idle | 0 | 1000 | 1000 |   |  0/s|   |

In connection and channels (web admin) I can see the connection in state
Running

Regards,

Alfonso

2011/3/31 Emile Joubert <emile at rabbitmq.com>

> Hi Alfonso,
>
> I'm still not able to reproduce the problem you describe. As far as I can
> see the subscription and the underlying connection are properly disposed and
> the shutdown eventhandler is called if the connection is interrupted.
>
> As previously suggested, is it possible that some of your modifications
> prevent the socket exception from affecting the Subscription? Are you able
> to reproduce the problem without any modifications to the rabbit library?
>
> On 31/03/11 10:49, Alfonso wrote:
>
>> One more thing regarding my previous message:
>>
>> 1. I disabled the newtwork connection from my development machine
>> (RabbitMQ server is on another machine).
>>
>> 2. I've see that the connection is still in some way "alive" even if I
>>
>
> You can confirm whether the connection is alive by running "rabbitmqctl
> list_connections" or "netstat".
>
>
>
> Regards
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/9da2e4aa/attachment.htm>

From alexandru at rabbitmq.com  Thu Mar 31 13:59:49 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Thu, 31 Mar 2011 15:59:49 +0300
Subject: [rabbitmq-discuss] make node a disk node
In-Reply-To: <4D946781.1030809@gmail.com>
References: <4D946781.1030809@gmail.com>
Message-ID: <20110331125949.GA2335@dakota>

Hi,

The disk nodes in the cluster are the nodes that follow the "rabbitmqctl
cluster" command, so to turn a node into a disk node, just run the
cluster command again adding it to the list of disk nodes.

In the docs, rabbit at rabbit2 becomes a disk node after
  rabbit2$ rabbitmqctl cluster rabbit at rabbit1 rabbit at rabbit2
  Clustering node rabbit at rabbit2 with [rabbit at rabbit1, rabbit at rabbit2]
  ...done.

Hope this helps.

Cheers,
Alex

On Thu, Mar 31, 2011 at 01:37:37PM +0200, Marcin Krol wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hello everyone,
> 
> For the life of me I can't find this info in documentation: how to make
> a node a disk node?
> 
> http://www.rabbitmq.com/clustering.html#change-type
> 
> "We can change the type of a node from ram to disk and vice versa. Say
> we wanted to reverse the types of rabbit at rabbit2 and rabbit at rabbit3,
> turning the former from a ram node into a disk node and the latter from
> a disk node into a ram node. To do that we simply stop the RabbitMQ
> application, change the type with an appropriate cluster command, and
> restart the application."
> 
> Err... what is "an appropriate cluster command"? manpage of rabbitmqctl
> does not say anything about that!
> 
> Help is appreciated.
> 
> Regards,
> mk
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v2.0.14 (MingW32)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
> 
> iQEcBAEBAgAGBQJNlGeBAAoJEFMgHzhQQ7hOY/gH/2PofejPxg4DJufKqXJ43FlH
> ExJrJNIEQFjmULjPkNNydPN6sbq6M6QLtZvE4SuwmxiR0lfhVWiSQuQ0SdEbjThg
> Oc5eyNLU1VYbwzMmMhsyaYc7ViXpoxpU4GxQ48V9Sr4VhVMsG0oYj6f3T9qr6PwJ
> kvll8AgjmTwxHog6FPd/6+BkEltchmb1vZGcD3M3qwW23uupN32RyzKFovYrnm88
> GgXhIsXFZYzybux7lXxY+zC4PW8TiXalyxRtMjtWSRqPoaom9sgu7aVNKpSpICsK
> SmAfRqiSVVl5d/yZoY9uq3kz80+NpqyfLAcR7lWnuR5c282HkPHbrqPJb0S2IEI=
> =2zSV
> -----END PGP SIGNATURE-----
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Thu Mar 31 13:02:32 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 31 Mar 2011 13:02:32 +0100
Subject: [rabbitmq-discuss] make node a disk node
In-Reply-To: <20110331125949.GA2335@dakota>
References: <4D946781.1030809@gmail.com> <20110331125949.GA2335@dakota>
Message-ID: <4D946D58.6060907@rabbitmq.com>

On 31/03/11 13:59, Alexandru Scvor?ov wrote:
> The disk nodes in the cluster are the nodes that follow the "rabbitmqctl
> cluster" command, so to turn a node into a disk node, just run the
> cluster command again adding it to the list of disk nodes.
>
> In the docs, rabbit at rabbit2 becomes a disk node after
>    rabbit2$ rabbitmqctl cluster rabbit at rabbit1 rabbit at rabbit2
>    Clustering node rabbit at rabbit2 with [rabbit at rabbit1, rabbit at rabbit2]
>    ...done.

See also 
http://www.rabbitmq.com/man/rabbitmqctl.1.man.html#Cluster%20management

<quote>
If the current node is to become a disk node it needs to appear in the 
cluster node list. Otherwise it becomes a ram node.
</quote>


Matthias.

From steve at rabbitmq.com  Thu Mar 31 13:10:44 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 31 Mar 2011 13:10:44 +0100
Subject: [rabbitmq-discuss] STOMP Plugin 2.4.0 Issue
In-Reply-To: <F49EF021-008C-4AE9-998F-931F8DE18C96@rabbitmq.com>
References: <B1A24578-1DB2-4568-9965-F62A2092A800@kinishi.com>
	<E88C70A4-ED99-4747-8D5B-7335C79E9A8D@rabbitmq.com>
	<628F04E2-D47A-478C-A809-735644C08FBF@kinishi.com>
	<F49EF021-008C-4AE9-998F-931F8DE18C96@rabbitmq.com>
Message-ID: <F4DB5DA1-3C6F-4302-A6D6-10473C0571AC@rabbitmq.com>

Alex,
It appears that the stomp adapter uses an Erlang module (binary) that only appeared in R14 of the language.  When starting the server you see the message:
    *WARNING* Undefined function binary:split/2
as it loads the plugins.  This is out of the rabbitmq-stomp-2.4.0.ez plugin.
You (and me on Ubuntu) are running with Erlang R13B03 and this deficiency is discovered only when running the plugin.

This is definitely a bug, since we state:
    In order to compile or run the server, you will need to have downloaded and installed Erlang/OTP, version R12B-3 or higher.
on the RabbitMQ Server page (http://www.rabbitmq.com/server.html).

We've raised this bug (24012) and will fix this in the next release.

The easiest solution is to load and run a later version of Erlang/Otp -- anything R14 and after should be fine. You should be able to find a *.deb package somwhere (!easier said than done - though there is this one 'http://launchpad.net/~morpheus-level28/+archive/erlang' you could try).

Alternatively, if you need a patch I can supply one -- although this may not be the best performing code -- contact me if you want this. I have tried the patch out and it fixes the (immediate) problem for me!

Steve Powell
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/c61185f7/attachment-0001.htm>

From emile at rabbitmq.com  Thu Mar 31 13:26:10 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 31 Mar 2011 13:26:10 +0100
Subject: [rabbitmq-discuss] Unexpected server crash and .NET API:
 disconnect is not detected?
In-Reply-To: <AANLkTimu34oKeqca7kTgcxNSS72rxq1vjUBMoFGrrSr+@mail.gmail.com>
References: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>	<4D934E15.6080207@rabbitmq.com>	<AANLkTimGNpQpjBUBEBKCOKN1BwTB1uUvmSQFeLh8QJ-5@mail.gmail.com>	<7216746d-435e-4fbb-85a4-82ab2013ffb1@e26g2000vbz.googlegroups.com>	<4D9456DA.3060207@rabbitmq.com>
	<AANLkTimu34oKeqca7kTgcxNSS72rxq1vjUBMoFGrrSr+@mail.gmail.com>
Message-ID: <4D9472E2.8020806@rabbitmq.com>

Hi Alfonso,

On 31/03/11 12:52, Alfonso Pantoja wrote:
> Listing connections ...
> guest   192.168.0.121   62966   running
>
> (checked after more than 5 minutes after killing the application)
> Using TCPVIEW  (SysInternals tools) there is no connection from my
> machine to the server.

It sounds like the broker thinks there is a connection but the client 
has already left. AMQP contains a heartbeat feature that will detect 
this situation and tear down the connection if the client doesn't 
respond. You can turn heartbeats on using 
ConnectionFactory.RequestedHeartbeat.

Regards

Emile

From info at gerd-stolpmann.de  Thu Mar 31 14:11:23 2011
From: info at gerd-stolpmann.de (Gerd Stolpmann)
Date: Thu, 31 Mar 2011 15:11:23 +0200
Subject: [rabbitmq-discuss] [ANN] Netamqp,
 a client for AMQP-0-9-1 in Ocaml
In-Reply-To: <4D946619.60101@rabbitmq.com>
References: <1301321281.8429.509.camel@thinkpad> <4D946619.60101@rabbitmq.com>
Message-ID: <1301577083.8429.851.camel@thinkpad>

Am Donnerstag, den 31.03.2011, 12:31 +0100 schrieb Emile Joubert:
> Hi Gerd,
> 
> On 28/03/11 15:08, Gerd Stolpmann wrote:
> > Hi,
> >
> > the ocaml team at Mylife is proud to release another library to the
> > public: Netamqp is a client of the AMQP-0-9-1 protocol.
> 
> We'd be delighted to add this library to the list at 
> http://www.rabbitmq.com/devtools.html .

Please do.

> BTW, if you want to make use of all the rabbit extensions then you can 
> run the codegen from this XML file:
> 
> http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/docs/specs/amqp0-9-1.xml

We have seen this already, and may consider adding it for a future
release.

Gerd
-- 
------------------------------------------------------------
Gerd Stolpmann, Bad Nauheimer Str.3, 64289 Darmstadt,Germany 
gerd at gerd-stolpmann.de          http://www.gerd-stolpmann.de
Phone: +49-6151-153855                  Fax: +49-6151-997714
------------------------------------------------------------


From matthew at rabbitmq.com  Thu Mar 31 14:22:26 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 31 Mar 2011 14:22:26 +0100
Subject: [rabbitmq-discuss] 2.4.0 channel and connection close behavior
In-Reply-To: <20110330204404.GB1577@wellquite.org>
References: <AANLkTimBaHTn4OmWEgovJh9qartMJLjb9fuatY_fBj9X@mail.gmail.com>
	<20110330194131.GA1577@wellquite.org>
	<AANLkTi=xQP6FnO8Frn_3_P6hgmEH2+8iSrvMB7GsDjvH@mail.gmail.com>
	<20110330204404.GB1577@wellquite.org>
Message-ID: <20110331132225.GB23386@rabbitmq.com>

On Wed, Mar 30, 2011 at 09:44:05PM +0100, Matthew Sackman wrote:
> Are there any errors in either of the logs when this happens? There may
> well be something in the sasl log, but I think this is likely a bug.

I've read through the code and I think it's fine. Constructing a test is
a little tricky actually because most of our clients are "sensible" and
make channel.close a synchronous blocking operation, thus it's difficult
to send in the connection.close before getting the channel.close_ok
back.

If you can reliably make it happen, (and verify with our Tracer and/or
wireshark), then it would be helpful if you could let us see the code.

Matthew

From aaron at agoragames.com  Thu Mar 31 14:56:45 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 31 Mar 2011 09:56:45 -0400
Subject: [rabbitmq-discuss] 2.4.0 channel and connection close behavior
In-Reply-To: <20110331132225.GB23386@rabbitmq.com>
References: <AANLkTimBaHTn4OmWEgovJh9qartMJLjb9fuatY_fBj9X@mail.gmail.com>
	<20110330194131.GA1577@wellquite.org>
	<AANLkTi=xQP6FnO8Frn_3_P6hgmEH2+8iSrvMB7GsDjvH@mail.gmail.com>
	<20110330204404.GB1577@wellquite.org>
	<20110331132225.GB23386@rabbitmq.com>
Message-ID: <AANLkTikgJkD_jc6wP2TV=QogDOUkAC7MJ2do9tdNA5oC@mail.gmail.com>

I'm going to revisit this in the afternoon and see what additional
information I can glean.

Regarding synchronous messaging, my reading of the AMQP spec is that
synchronous operations are isolated per channel, and I've coded our
driver accordingly. Is there really an expectation of a global lock
per connection?


There's really nothing special about why we haven't open sourced this
yet, just that we want to have it complete, documented and with
reasonable test coverage before putting a public face on it.  If I
can't make any progress on fixing the bug, it doesn't affect our
client deliverables, and we can solve it when we finally release.

-Aaron

On Thu, Mar 31, 2011 at 9:22 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Wed, Mar 30, 2011 at 09:44:05PM +0100, Matthew Sackman wrote:
>> Are there any errors in either of the logs when this happens? There may
>> well be something in the sasl log, but I think this is likely a bug.
>
> I've read through the code and I think it's fine. Constructing a test is
> a little tricky actually because most of our clients are "sensible" and
> make channel.close a synchronous blocking operation, thus it's difficult
> to send in the connection.close before getting the channel.close_ok
> back.
>
> If you can reliably make it happen, (and verify with our Tracer and/or
> wireshark), then it would be helpful if you could let us see the code.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From alfonso.pantoja at gmail.com  Thu Mar 31 15:23:22 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 31 Mar 2011 16:23:22 +0200
Subject: [rabbitmq-discuss] Unexpected server crash and .NET API:
 disconnect is not detected?
In-Reply-To: <4D9472E2.8020806@rabbitmq.com>
References: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>
	<4D934E15.6080207@rabbitmq.com>
	<AANLkTimGNpQpjBUBEBKCOKN1BwTB1uUvmSQFeLh8QJ-5@mail.gmail.com>
	<7216746d-435e-4fbb-85a4-82ab2013ffb1@e26g2000vbz.googlegroups.com>
	<4D9456DA.3060207@rabbitmq.com>
	<AANLkTimu34oKeqca7kTgcxNSS72rxq1vjUBMoFGrrSr+@mail.gmail.com>
	<4D9472E2.8020806@rabbitmq.com>
Message-ID: <AANLkTinTBcewBJYqyzOAC479j7ab7VQ4US23gSveJh_O@mail.gmail.com>

Emile,

I've just turned on RequestedHeartbeat and it works. Thank you very much.

By the way, what are the benefits/drawbacks of using lower or higher values
in RequestedHeartBeat?


Regards,

Alfonso

2011/3/31 Emile Joubert <emile at rabbitmq.com>

> Hi Alfonso,
>
>
> On 31/03/11 12:52, Alfonso Pantoja wrote:
>
>> Listing connections ...
>> guest   192.168.0.121   62966   running
>>
>> (checked after more than 5 minutes after killing the application)
>> Using TCPVIEW  (SysInternals tools) there is no connection from my
>> machine to the server.
>>
>
> It sounds like the broker thinks there is a connection but the client has
> already left. AMQP contains a heartbeat feature that will detect this
> situation and tear down the connection if the client doesn't respond. You
> can turn heartbeats on using ConnectionFactory.RequestedHeartbeat.
>
> Regards
>
> Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/9f44d0a0/attachment.htm>

From matthew at rabbitmq.com  Thu Mar 31 15:30:11 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 31 Mar 2011 15:30:11 +0100
Subject: [rabbitmq-discuss] 2.4.0 channel and connection close behavior
In-Reply-To: <AANLkTikgJkD_jc6wP2TV=QogDOUkAC7MJ2do9tdNA5oC@mail.gmail.com>
References: <AANLkTimBaHTn4OmWEgovJh9qartMJLjb9fuatY_fBj9X@mail.gmail.com>
	<20110330194131.GA1577@wellquite.org>
	<AANLkTi=xQP6FnO8Frn_3_P6hgmEH2+8iSrvMB7GsDjvH@mail.gmail.com>
	<20110330204404.GB1577@wellquite.org>
	<20110331132225.GB23386@rabbitmq.com>
	<AANLkTikgJkD_jc6wP2TV=QogDOUkAC7MJ2do9tdNA5oC@mail.gmail.com>
Message-ID: <20110331143011.GC23386@rabbitmq.com>

On Thu, Mar 31, 2011 at 09:56:45AM -0400, Aaron Westendorf wrote:
> Regarding synchronous messaging, my reading of the AMQP spec is that
> synchronous operations are isolated per channel, and I've coded our
> driver accordingly. Is there really an expectation of a global lock
> per connection?

No, there's no such expectation, and your reading is correct.

Matthew

From emile at rabbitmq.com  Thu Mar 31 15:34:27 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 31 Mar 2011 15:34:27 +0100
Subject: [rabbitmq-discuss] Unexpected server crash and .NET API:
 disconnect is not detected?
In-Reply-To: <AANLkTinTBcewBJYqyzOAC479j7ab7VQ4US23gSveJh_O@mail.gmail.com>
References: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>	<4D934E15.6080207@rabbitmq.com>	<AANLkTimGNpQpjBUBEBKCOKN1BwTB1uUvmSQFeLh8QJ-5@mail.gmail.com>	<7216746d-435e-4fbb-85a4-82ab2013ffb1@e26g2000vbz.googlegroups.com>	<4D9456DA.3060207@rabbitmq.com>	<AANLkTimu34oKeqca7kTgcxNSS72rxq1vjUBMoFGrrSr+@mail.gmail.com>	<4D9472E2.8020806@rabbitmq.com>
	<AANLkTinTBcewBJYqyzOAC479j7ab7VQ4US23gSveJh_O@mail.gmail.com>
Message-ID: <4D9490F3.2000101@rabbitmq.com>

On 31/03/11 15:23, Alfonso Pantoja wrote:
> Emile,
>
> I've just turned on RequestedHeartbeat and it works. Thank you very much.
>
> By the way, what are the benefits/drawbacks of using lower or higher
> values in RequestedHeartBeat?

The benefits of frequent heartbeats are that connection problems will be 
detected sooner. The drawback is the network overhead. Heartbeat frames 
are very small so this should not pose a problem unless the network link 
is very expensive, or you have thousands of connections with heartbeats, 
or you are pushing the performance envelope.


Emile

From gmr at myyearbook.com  Thu Mar 31 15:45:40 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 31 Mar 2011 10:45:40 -0400
Subject: [rabbitmq-discuss] Problems starting 2.4.0 on OS X w/ mgmt
	plugins
In-Reply-To: <4D941D93.6040402@rabbitmq.com>
References: <71B3B674-43F9-41C8-8E61-DF10EB6CEF33@jbrisbin.com>
	<4D941D93.6040402@rabbitmq.com>
Message-ID: <AANLkTimc-B=0j5HgsbZL2n3exZz=zB1PiCVKuDm+2=GO@mail.gmail.com>

For what it's worth, I run into this on OSX as well from time to time with
previous versions. When it happens, a CTRL-C where its hung gets things
moving again.

I'll look for hostname resolution issues when/if I see it again.

Gavin

On Thu, Mar 31, 2011 at 2:22 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Jon,
>
>
> Jon Brisbin wrote:
>
>> Activating RabbitMQ plugins ...
>> *WARNING* Undefined function fdsrv:bind_socket/2
>> *WARNING* Undefined function fdsrv:start/0
>> *WARNING* Undefined function fdsrv:stop/0
>> *WARNING* Undefined function webmachine_resource:start_link/2
>> 6 plugins activated:
>> * amqp_client-2.4.0
>> * mochiweb-1.3
>> * rabbit_management-2.4.0.1
>> * rabbit_management_agent-2.4.0
>> * rabbit_mochiweb-2.4.0
>> * webmachine-1.7.0
>>
>> ^C
>> BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
>>      (v)ersion (k)ill (D)b-tables (d)istribution
>> ^C
>>
>> ^^^^^^^^
>> This is where I kill it...then it continues on fine...
>>
>
> Do you encounter the same behaviour w/o any plug-ins installed? I suspect
> you do, but please check.
>
> FWIW, I reckon rabbit gets stuck at
>
> http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_4_0/src/rabbit_prelaunch.erl#l250
>
> Does your hostname (jbrisbin) resolve? Is the epmd process running after
> you have started rabbit for the first time? And can you connect to epmd on
> your hostname ('telnet jbrisbin 4369')?
>
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/7b248b8d/attachment-0001.htm>

From emile at rabbitmq.com  Thu Mar 31 15:47:34 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 31 Mar 2011 15:47:34 +0100
Subject: [rabbitmq-discuss] Unexpected server crash and .NET API:
 disconnect is not detected?
In-Reply-To: <4D9490F3.2000101@rabbitmq.com>
References: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>	<4D934E15.6080207@rabbitmq.com>	<AANLkTimGNpQpjBUBEBKCOKN1BwTB1uUvmSQFeLh8QJ-5@mail.gmail.com>	<7216746d-435e-4fbb-85a4-82ab2013ffb1@e26g2000vbz.googlegroups.com>	<4D9456DA.3060207@rabbitmq.com>	<AANLkTimu34oKeqca7kTgcxNSS72rxq1vjUBMoFGrrSr+@mail.gmail.com>	<4D9472E2.8020806@rabbitmq.com>	<AANLkTinTBcewBJYqyzOAC479j7ab7VQ4US23gSveJh_O@mail.gmail.com>
	<4D9490F3.2000101@rabbitmq.com>
Message-ID: <4D949406.40601@rabbitmq.com>

On 31/03/11 15:34, Emile Joubert wrote:
> On 31/03/11 15:23, Alfonso Pantoja wrote:

>> By the way, what are the benefits/drawbacks of using lower or higher
>> values in RequestedHeartBeat?

>  or you have thousands of connections with heartbeats,

A very large number of connections with frequent heartbeats can easily 
keep the broker CPU tied up, so that is another drawback in addition to 
the network overhead.


-Emile

From emile at rabbitmq.com  Thu Mar 31 16:25:40 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 31 Mar 2011 16:25:40 +0100
Subject: [rabbitmq-discuss] ERL crashes when messages are being pumped
 into a queue under win32 envir
In-Reply-To: <19F7DB1491CA0149AF64F65336540FEA0E63DA47@server.rmmsoft.com.cn>
References: <19F7DB1491CA0149AF64F65336540FEA0E63DA47@server.rmmsoft.com.cn>
Message-ID: <4D949CF4.4070504@rabbitmq.com>

Hi Ming,

On 30/03/11 10:40, Ming Li wrote:
> 1.using RabbitMQ2.4.0(windows bundle).winxp,creates an exchange and a queue.
>
> 2.use multiple sender to send messages into the created queue,only a
> single receiverreceiving message from the same queue.
>
> 3.while running, what i discovered is that the ERL's RAM usage continue
> to increase and then crash when it reaches a certain percentage
>
> Is there a way to prevent it from crashing?

Are you sure it's the broker that runs out of memory and not the 
receiver? Is the receiver and the rabbit broker running on the same 
hardware?

I see that the channel is not setting QoS. This will cause the broker to 
deliver messages to the receiver QueueingBasicConsumer as quickly as it 
can, and the receiver could run out of memory as a result. This is more 
likely to occur if the consumer is slower than the sender. The solution 
to this problem is to set the QoS prefetch count (IModel.BasicQos) to a 
small number and use explicit acknowledgements.

If it really is the broker that runs out of memory could you confirm 
whether the broker logfile contains entries with both "alarm_handler" 
and "vm_memory_high_watermark"? What else appears in the broker logfile 
near the time of the crash?

-Emile


From jon at jbrisbin.com  Thu Mar 31 16:26:47 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 31 Mar 2011 10:26:47 -0500
Subject: [rabbitmq-discuss] Problems starting 2.4.0 on OS X w/ mgmt
	plugins
In-Reply-To: <AANLkTimc-B=0j5HgsbZL2n3exZz=zB1PiCVKuDm+2=GO@mail.gmail.com>
References: <71B3B674-43F9-41C8-8E61-DF10EB6CEF33@jbrisbin.com>
	<4D941D93.6040402@rabbitmq.com>
	<AANLkTimc-B=0j5HgsbZL2n3exZz=zB1PiCVKuDm+2=GO@mail.gmail.com>
Message-ID: <9CB974F6-39BE-480A-813C-2753F0D48B0D@jbrisbin.com>

It does seem to be related to hostname resolution issues. I think its a firewall issue because when I'm working at the library and on their WiFi, it always gets hung at this spot. When I'm on my home WiFi, though, I don't see problems.

I still get the warnings, either way. But I don't think that's directly related to this network issue.

jb


On Mar 31, 2011, at 9:45 AM, Gavin M. Roy wrote:

> For what it's worth, I run into this on OSX as well from time to time with previous versions. When it happens, a CTRL-C where its hung gets things moving again.
> 
> I'll look for hostname resolution issues when/if I see it again.
> 
> Gavin
> 
> On Thu, Mar 31, 2011 at 2:22 AM, Matthias Radestock <matthias at rabbitmq.com> wrote:
> Jon,
> 
> 
> Jon Brisbin wrote:
> Activating RabbitMQ plugins ...
> *WARNING* Undefined function fdsrv:bind_socket/2
> *WARNING* Undefined function fdsrv:start/0
> *WARNING* Undefined function fdsrv:stop/0
> *WARNING* Undefined function webmachine_resource:start_link/2
> 6 plugins activated:
> * amqp_client-2.4.0
> * mochiweb-1.3
> * rabbit_management-2.4.0.1
> * rabbit_management_agent-2.4.0
> * rabbit_mochiweb-2.4.0
> * webmachine-1.7.0
> 
> ^C
> BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
>      (v)ersion (k)ill (D)b-tables (d)istribution
> ^C
> 
> ^^^^^^^^
> This is where I kill it...then it continues on fine...
> 
> Do you encounter the same behaviour w/o any plug-ins installed? I suspect you do, but please check.
> 
> FWIW, I reckon rabbit gets stuck at
> http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_4_0/src/rabbit_prelaunch.erl#l250
> 
> Does your hostname (jbrisbin) resolve? Is the epmd process running after you have started rabbit for the first time? And can you connect to epmd on your hostname ('telnet jbrisbin 4369')?
> 
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/19504b55/attachment.htm>

From simon at rabbitmq.com  Thu Mar 31 16:30:39 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 31 Mar 2011 16:30:39 +0100
Subject: [rabbitmq-discuss] Problems starting 2.4.0 on OS X w/
	mgmt	plugins
In-Reply-To: <9CB974F6-39BE-480A-813C-2753F0D48B0D@jbrisbin.com>
References: <71B3B674-43F9-41C8-8E61-DF10EB6CEF33@jbrisbin.com>	<4D941D93.6040402@rabbitmq.com>	<AANLkTimc-B=0j5HgsbZL2n3exZz=zB1PiCVKuDm+2=GO@mail.gmail.com>
	<9CB974F6-39BE-480A-813C-2753F0D48B0D@jbrisbin.com>
Message-ID: <4D949E1F.6070100@rabbitmq.com>

On 31/03/11 16:26, Jon Brisbin wrote:
> I still get the warnings, either way. But I don't think that's directly
> related to this network issue.

Those particular warnings are harmless - there are bits inside of 
mochiweb and webmachine which are on code paths we never hit but which 
reference code which is unlikely to be installed (fdsrv) or does not 
exist (webmachine_resource).

I wanted to whitelist those particular warnings but it's a bit of a 
contentious issue.

Cheers, Simon

-- 
Simon MacMullen
Staff Engineer, RabbitMQ
SpringSource, a division of VMware


From emile at rabbitmq.com  Thu Mar 31 17:10:41 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 31 Mar 2011 17:10:41 +0100
Subject: [rabbitmq-discuss] multiple routing keys on a queue.
In-Reply-To: <AANLkTi=cx-t38xmad18ALurkrV=UmvKiOz7ixeoX0XfT@mail.gmail.com>
References: <AANLkTi=cx-t38xmad18ALurkrV=UmvKiOz7ixeoX0XfT@mail.gmail.com>
Message-ID: <4D94A781.4080304@rabbitmq.com>

Hi,

On 30/03/11 15:19, mysurf mail wrote:

> but the message goes only to the first key (did I mention it already?)
>
> Listing queues ...
> amq.gen-4ae4QUbSNevC/RgM+8C9CA==        0
> amq.gen-sgZK0bSc0W3QEXda8m1vIQ==        0
> PositionsQueue  1
> ...done.
>
> rabbitmqctl.bat list_bindings
>
> Listing bindings ...
>          exchange        PositionsQueue  queue   PositionsQueue  []
>          exchange        amq.gen-4ae4QUbSNevC/RgM+8C9CA==        queue   amq.gen-4ae4QUbSNevC/RgM+8C9CA==
>          exchange        amq.gen-sgZK0bSc0W3QEXda8m1vIQ==        queue   amq.gen-sgZK0bSc0W3QEXda8m1vIQ==
> Positions_Exchange      exchange        amq.gen-4ae4QUbSNevC/RgM+8C9CA==        queue   Account:Account1
> Positions_Exchange      exchange        amq.gen-4ae4QUbSNevC/RgM+8C9CA==        queue   Portfolio:Portfolio1
> ...done.

I assume you are publishing to the "Positions_Exchange" exchange with a 
routing key of "Account:Account1" or "Portfolio:Portfolio1". Messages 
will end up in queue "amq.gen-4ae4QUbSNevC/RgM+8C9CA==" in either case.

If you are expecting one publish command to produce two messages in the 
same queue then that won't happen. See the documentation of queue.bind:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.bind

In particular:

"""
A server MUST not deliver the same message more than once to a queue, 
even if the queue has multiple bindings that match the message.
"""


-Emile

From jon at jbrisbin.com  Thu Mar 31 19:19:13 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 31 Mar 2011 13:19:13 -0500
Subject: [rabbitmq-discuss] State monad question
Message-ID: <553401FF-592A-4E72-84EE-9A1968C824E5@jbrisbin.com>

Saw the traffic today about the State/Cut stuff and looked at the code. But I feel like the guy who misses the joke and everyone else is laughing.

Can someone throw me a bone here and let me in on why the hubbub? What's the significance? Look at this as a teachable moment. ;)

Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From jon at jbrisbin.com  Thu Mar 31 19:21:17 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 31 Mar 2011 13:21:17 -0500
Subject: [rabbitmq-discuss] Problems starting 2.4.0 on OS X w/ mgmt
	plugins
In-Reply-To: <4D949E1F.6070100@rabbitmq.com>
References: <71B3B674-43F9-41C8-8E61-DF10EB6CEF33@jbrisbin.com>	<4D941D93.6040402@rabbitmq.com>	<AANLkTimc-B=0j5HgsbZL2n3exZz=zB1PiCVKuDm+2=GO@mail.gmail.com>
	<9CB974F6-39BE-480A-813C-2753F0D48B0D@jbrisbin.com>
	<4D949E1F.6070100@rabbitmq.com>
Message-ID: <555C4881-BE60-4D18-AAFC-696332C39CAD@jbrisbin.com>


On Mar 31, 2011, at 10:30 AM, Simon MacMullen wrote:

> Those particular warnings are harmless - there are bits inside of mochiweb and webmachine which are on code paths we never hit but which reference code which is unlikely to be installed (fdsrv) or does not exist (webmachine_resource).
> 
> I wanted to whitelist those particular warnings but it's a bit of a contentious issue.

Thanks for the clarification! 

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From alfonso.pantoja at gmail.com  Thu Mar 31 19:42:24 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Thu, 31 Mar 2011 20:42:24 +0200
Subject: [rabbitmq-discuss] Unexpected server crash and .NET API:
 disconnect is not detected?
In-Reply-To: <4D949406.40601@rabbitmq.com>
References: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>
	<4D934E15.6080207@rabbitmq.com>
	<AANLkTimGNpQpjBUBEBKCOKN1BwTB1uUvmSQFeLh8QJ-5@mail.gmail.com>
	<7216746d-435e-4fbb-85a4-82ab2013ffb1@e26g2000vbz.googlegroups.com>
	<4D9456DA.3060207@rabbitmq.com>
	<AANLkTimu34oKeqca7kTgcxNSS72rxq1vjUBMoFGrrSr+@mail.gmail.com>
	<4D9472E2.8020806@rabbitmq.com>
	<AANLkTinTBcewBJYqyzOAC479j7ab7VQ4US23gSveJh_O@mail.gmail.com>
	<4D9490F3.2000101@rabbitmq.com> <4D949406.40601@rabbitmq.com>
Message-ID: <AANLkTim5ncT_HJdy4dGbPW1_9rO2S3kHivN4WorAr5jW@mail.gmail.com>

That's is interesting.
We won't have many consumer/publisher applications but there will be quite
frequent (intensive) incoming messages. Also in this scenario it is critical
to detect unexpected disconnections.
So I'd better add support for customize this value in order to gain fine
control on production.

Thanks again

Regards,

Alfonso




2011/3/31 Emile Joubert <emile at rabbitmq.com>

> On 31/03/11 15:34, Emile Joubert wrote:
>
>> On 31/03/11 15:23, Alfonso Pantoja wrote:
>>
>
>  By the way, what are the benefits/drawbacks of using lower or higher
>>> values in RequestedHeartBeat?
>>>
>>
>   or you have thousands of connections with heartbeats,
>>
>
> A very large number of connections with frequent heartbeats can easily keep
> the broker CPU tied up, so that is another drawback in addition to the
> network overhead.
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/8f93c5f8/attachment-0001.htm>

From matthias at rabbitmq.com  Thu Mar 31 19:59:13 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 31 Mar 2011 19:59:13 +0100
Subject: [rabbitmq-discuss] Unexpected server crash and .NET API:
 disconnect is not detected?
In-Reply-To: <AANLkTim5ncT_HJdy4dGbPW1_9rO2S3kHivN4WorAr5jW@mail.gmail.com>
References: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>	<4D934E15.6080207@rabbitmq.com>	<AANLkTimGNpQpjBUBEBKCOKN1BwTB1uUvmSQFeLh8QJ-5@mail.gmail.com>	<7216746d-435e-4fbb-85a4-82ab2013ffb1@e26g2000vbz.googlegroups.com>	<4D9456DA.3060207@rabbitmq.com>	<AANLkTimu34oKeqca7kTgcxNSS72rxq1vjUBMoFGrrSr+@mail.gmail.com>	<4D9472E2.8020806@rabbitmq.com>	<AANLkTinTBcewBJYqyzOAC479j7ab7VQ4US23gSveJh_O@mail.gmail.com>	<4D9490F3.2000101@rabbitmq.com>
	<4D949406.40601@rabbitmq.com>
	<AANLkTim5ncT_HJdy4dGbPW1_9rO2S3kHivN4WorAr5jW@mail.gmail.com>
Message-ID: <4D94CF01.2070709@rabbitmq.com>

Alfonso,

Alfonso Pantoja wrote:
> That's is interesting.
> We won't have many consumer/publisher applications but there will be 
> quite frequent (intensive) incoming messages. Also in this scenario it 
> is critical to detect unexpected disconnections.
> So I'd better add support for customize this value in order to gain fine 
> control on production.

Requiring heartbeats is by no means normal. They are usually only 
necessary when something weird is going on in the network infrastructure 
or client/server machine setup. Unfortunately that is all too common.

Btw, another downside to short heartbeats is that if a client machine 
gets heavily loaded then connections may get dropped due to missed 
heartbeats.

So, as a general rule, configure the heartbeat interval to be as long as 
possible.

Regards,

Matthias.

From jon at jbrisbin.com  Thu Mar 31 20:21:52 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 31 Mar 2011 14:21:52 -0500
Subject: [rabbitmq-discuss] question on custom exchanges
Message-ID: <0A4FB18B-B15A-4840-8EDB-8B2EF9E55BE1@jbrisbin.com>

Sorry for the bang-bang, scatter-shot nature of these questions, but...

How would I go about creating resources that are unique to a given custom exchange? For example, if I have hostname and port parameters as arguments to my custom exchange, how can I manage a process that is unique to that exchange (because it connects to a possibly-unique combo of hostname and port) from my module? 

Do I construct some key based on vhost and exchange name and store a Pid in an ets table or something?

What is the lifecycle of a custom exchange module? Does it even have one?

Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin



From videlalvaro at gmail.com  Thu Mar 31 21:23:10 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 31 Mar 2011 22:23:10 +0200
Subject: [rabbitmq-discuss] State monad question
In-Reply-To: <553401FF-592A-4E72-84EE-9A1968C824E5@jbrisbin.com>
References: <553401FF-592A-4E72-84EE-9A1968C824E5@jbrisbin.com>
Message-ID: <E081B956-DF75-4D90-9015-D9CEB121BEAE@gmail.com>

Hi Jon,

For what I've talked with Matthew on twitter you could do something to avoid the "staircasing" as described here:

http://book.realworldhaskell.org/read/programming-with-monads.html

As you can see there, you could avoid those nested case expressions. 

If this is a joke from Matthew I don't know. For me is a pretty cool implementation of Monads in Erlang.

Hope this helps, and I hope I understood something too :)

Alvaro

On Mar 31, 2011, at 8:19 PM, Jon Brisbin wrote:

> Saw the traffic today about the State/Cut stuff and looked at the code. But I feel like the guy who misses the joke and everyone else is laughing.
> 
> Can someone throw me a bone here and let me in on why the hubbub? What's the significance? Look at this as a teachable moment. ;)
> 
> Thanks!
> 
> Jon Brisbin
> 
> http://jbrisbin.com
> Twitter: @j_brisbin
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/2c1c4c09/attachment.htm>

From jon at jbrisbin.com  Thu Mar 31 21:51:15 2011
From: jon at jbrisbin.com (Jon Brisbin)
Date: Thu, 31 Mar 2011 15:51:15 -0500
Subject: [rabbitmq-discuss] State monad question
In-Reply-To: <E081B956-DF75-4D90-9015-D9CEB121BEAE@gmail.com>
References: <553401FF-592A-4E72-84EE-9A1968C824E5@jbrisbin.com>
	<E081B956-DF75-4D90-9015-D9CEB121BEAE@gmail.com>
Message-ID: <8B65104B-219B-4801-83F1-8151B57373F7@jbrisbin.com>


On Mar 31, 2011, at 3:23 PM, Alvaro Videla wrote:

> For what I've talked with Matthew on twitter you could do something to avoid the "staircasing" as described here:
> 
> http://book.realworldhaskell.org/read/programming-with-monads.html
> 
> As you can see there, you could avoid those nested case expressions. 

Ahhh...I see said the blind man. :)

I've been reading up on Haskell lately, so that makes some modicum of sense.

Wish I understood the theory better. :/

jb


> 
> If this is a joke from Matthew I don't know. For me is a pretty cool implementation of Monads in Erlang.
> 
> Hope this helps, and I hope I understood something too :)
> 
> Alvaro
> 
> On Mar 31, 2011, at 8:19 PM, Jon Brisbin wrote:
> 
>> Saw the traffic today about the State/Cut stuff and looked at the code. But I feel like the guy who misses the joke and everyone else is laughing.
>> 
>> Can someone throw me a bone here and let me in on why the hubbub? What's the significance? Look at this as a teachable moment. ;)
>> 
>> Thanks!
>> 
>> Jon Brisbin
>> 
>> http://jbrisbin.com
>> Twitter: @j_brisbin
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


Thanks!

Jon Brisbin

http://jbrisbin.com
Twitter: @j_brisbin


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/fe58fe72/attachment.htm>

From aaron at agoragames.com  Thu Mar 31 22:04:10 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Thu, 31 Mar 2011 17:04:10 -0400
Subject: [rabbitmq-discuss] 2.4.0 channel and connection close behavior
In-Reply-To: <20110331132225.GB23386@rabbitmq.com>
References: <AANLkTimBaHTn4OmWEgovJh9qartMJLjb9fuatY_fBj9X@mail.gmail.com>
	<20110330194131.GA1577@wellquite.org>
	<AANLkTi=xQP6FnO8Frn_3_P6hgmEH2+8iSrvMB7GsDjvH@mail.gmail.com>
	<20110330204404.GB1577@wellquite.org>
	<20110331132225.GB23386@rabbitmq.com>
Message-ID: <AANLkTi=8gRVZvKXvL=w2rA=iB8XKyH9NkZoAy8KEeEGX@mail.gmail.com>

I can reliably reproduce. I have tcpdump output which is the easiest
for me to generate. If that's not helpful, then we'll just wait until
I can wrap this up and release it.

-Aaron

On Thu, Mar 31, 2011 at 9:22 AM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> On Wed, Mar 30, 2011 at 09:44:05PM +0100, Matthew Sackman wrote:
>> Are there any errors in either of the logs when this happens? There may
>> well be something in the sasl log, but I think this is likely a bug.
>
> I've read through the code and I think it's fine. Constructing a test is
> a little tricky actually because most of our clients are "sensible" and
> make channel.close a synchronous blocking operation, thus it's difficult
> to send in the connection.close before getting the channel.close_ok
> back.
>
> If you can reliably make it happen, (and verify with our Tracer and/or
> wireshark), then it would be helpful if you could let us see the code.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From matthias at rabbitmq.com  Thu Mar 31 22:14:52 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 31 Mar 2011 22:14:52 +0100
Subject: [rabbitmq-discuss] 2.4.0 channel and connection close behavior
In-Reply-To: <AANLkTi=8gRVZvKXvL=w2rA=iB8XKyH9NkZoAy8KEeEGX@mail.gmail.com>
References: <AANLkTimBaHTn4OmWEgovJh9qartMJLjb9fuatY_fBj9X@mail.gmail.com>	<20110330194131.GA1577@wellquite.org>	<AANLkTi=xQP6FnO8Frn_3_P6hgmEH2+8iSrvMB7GsDjvH@mail.gmail.com>	<20110330204404.GB1577@wellquite.org>	<20110331132225.GB23386@rabbitmq.com>
	<AANLkTi=8gRVZvKXvL=w2rA=iB8XKyH9NkZoAy8KEeEGX@mail.gmail.com>
Message-ID: <4D94EECC.6070904@rabbitmq.com>

Aaron,

Aaron Westendorf wrote:
> I can reliably reproduce. I have tcpdump output which is the easiest
> for me to generate.

Please send us the tcpdump. If it's more than a few k then put it online 
somewhere rather than sending to the list. Thanks.

Regards,

Matthias.

From alfonso.pantoja at gmail.com  Thu Mar 31 23:26:19 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Fri, 1 Apr 2011 00:26:19 +0200
Subject: [rabbitmq-discuss] Unexpected server crash and .NET API:
 disconnect is not detected?
In-Reply-To: <4D94CF01.2070709@rabbitmq.com>
References: <232ed03b-a76c-412a-958c-12292ca56636@32g2000vbe.googlegroups.com>
	<4D934E15.6080207@rabbitmq.com>
	<AANLkTimGNpQpjBUBEBKCOKN1BwTB1uUvmSQFeLh8QJ-5@mail.gmail.com>
	<7216746d-435e-4fbb-85a4-82ab2013ffb1@e26g2000vbz.googlegroups.com>
	<4D9456DA.3060207@rabbitmq.com>
	<AANLkTimu34oKeqca7kTgcxNSS72rxq1vjUBMoFGrrSr+@mail.gmail.com>
	<4D9472E2.8020806@rabbitmq.com>
	<AANLkTinTBcewBJYqyzOAC479j7ab7VQ4US23gSveJh_O@mail.gmail.com>
	<4D9490F3.2000101@rabbitmq.com> <4D949406.40601@rabbitmq.com>
	<AANLkTim5ncT_HJdy4dGbPW1_9rO2S3kHivN4WorAr5jW@mail.gmail.com>
	<4D94CF01.2070709@rabbitmq.com>
Message-ID: <AANLkTikk-wxEt7u7Y+o1XCFCWydz+UCSX93CotxLjarH@mail.gmail.com>

Matthias,

If requiring heartbeats is not usual then something is wrong with our
development RabbitMQ server? As I said it seems not detect unexpected client
disconnections.
Server and client machine (machine from the consumer is launched) are on the
same IP range.
What may be the cause of not detecting clients unexpected disconnections?
(by the way, the server in fact are 2 clustered servers running under ubuntu
10 server and client machine is Windows Vista)

Regards,


Alfonso



2011/3/31 Matthias Radestock <matthias at rabbitmq.com>

> Alfonso,
>
>
> Alfonso Pantoja wrote:
>
>> That's is interesting.
>> We won't have many consumer/publisher applications but there will be quite
>> frequent (intensive) incoming messages. Also in this scenario it is critical
>> to detect unexpected disconnections.
>> So I'd better add support for customize this value in order to gain fine
>> control on production.
>>
>
> Requiring heartbeats is by no means normal. They are usually only necessary
> when something weird is going on in the network infrastructure or
> client/server machine setup. Unfortunately that is all too common.
>
> Btw, another downside to short heartbeats is that if a client machine gets
> heavily loaded then connections may get dropped due to missed heartbeats.
>
> So, as a general rule, configure the heartbeat interval to be as long as
> possible.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110401/9ef386be/attachment-0001.htm>

From Richard.Bolen at gxs.com  Thu Mar 31 21:41:14 2011
From: Richard.Bolen at gxs.com (Richard.Bolen at gxs.com)
Date: Thu, 31 Mar 2011 16:41:14 -0400
Subject: [rabbitmq-discuss] Message Groups
Message-ID: <F023B4AFE64FC7419B5F2B6341BEC716AA0DEB12FF@AMERICASMAIL01.internal.gxs.com>

I'm new to AMQP and I was wondering how to use rabbitMQ to implement a messaging pattern.  I would like to have a pool of workers that process messages from a queue.  There are various message types but they each type can belong to a specific person.  The messages must be processed in the order they are received on a per-person basis.

For activeMQ they call this message groups.  What activeMQ does is bind the worker to a group ID and as long as messages are in the queue for that group ID, it will route them to the same worker.  Once there are no messages for that group ID on the queue, the worker is freed to process other messages.  Is there a similar pattern for AMQP/rabbitMQ?

Thanks,
Rich Bolen
GXS Engineering
T: +1.919.786.5156 | F: +1.919.786.5255
www.gxs.com<http://www.gxs.com/>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/e535255b/attachment.htm>

From Richard.Bolen at gxs.com  Thu Mar 31 21:41:56 2011
From: Richard.Bolen at gxs.com (Richard.Bolen at gxs.com)
Date: Thu, 31 Mar 2011 16:41:56 -0400
Subject: [rabbitmq-discuss] Searchable version of the list archives?
Message-ID: <F023B4AFE64FC7419B5F2B6341BEC716AA0DEB1302@AMERICASMAIL01.internal.gxs.com>

Is there a searchable version of the rabbitmq list archives?

Rich Bolen
GXS Engineering
T: +1.919.786.5156 | F: +1.919.786.5255
www.gxs.com<http://www.gxs.com/>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/74db842a/attachment.htm>

