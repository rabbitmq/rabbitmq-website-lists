From mikeb at rabbitmq.com  Thu Sep  1 00:52:18 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 01 Sep 2011 00:52:18 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <CAHZAEpeNWAXruHuKykOq2gh5HYn=r-ruGXm1dAtXcoAUY3QP5A@mail.gmail.com>
References: <4E5E35C5.1050204@rabbitmq.com>	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>	<4E5EA5C9.3020708@rabbitmq.com>	<CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>	<20110831214824.GA30087@wellquite.org>
	<CAHZAEpeNWAXruHuKykOq2gh5HYn=r-ruGXm1dAtXcoAUY3QP5A@mail.gmail.com>
Message-ID: <4E5EC932.6060402@rabbitmq.com>

>> The problem there is where do you stop? You're programming into your
>> group definition the fact that you know that these nodes are in
>> different racks, behind different switches, on different machines,
>> possibly on different UPSs. One problem is that Rabbit knows none of
>> this.

[and]

> In my opinion you stop at leaving it to the user define the
> availability "separation" groups/areas.

Surely the point is that RabbitMQ must be told about the appropriate 
mirroring, yet it's very unlikely to be the person writing an 
application that knows it (and especially not in terms of the Erlang 
node names!), so putting it in the queue.declare method is rather erm, 
hopeful. It really should be part of the operational interface, not the 
application interface.

-Michael

From jasonjwwilliams at gmail.com  Thu Sep  1 01:07:07 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Wed, 31 Aug 2011 18:07:07 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <4E5EC932.6060402@rabbitmq.com>
References: <4E5E35C5.1050204@rabbitmq.com>
	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>
	<4E5EA5C9.3020708@rabbitmq.com>
	<CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>
	<20110831214824.GA30087@wellquite.org>
	<CAHZAEpeNWAXruHuKykOq2gh5HYn=r-ruGXm1dAtXcoAUY3QP5A@mail.gmail.com>
	<4E5EC932.6060402@rabbitmq.com>
Message-ID: <CAHZAEpe6r4wjy+G1E9u07+9vf+ngiYbtps-YdkP8PQTdyG3inw@mail.gmail.com>

> Surely the point is that RabbitMQ must be told about the appropriate
> mirroring, yet it's very unlikely to be the person writing an application
> that knows it (and especially not in terms of the Erlang node names!), so
> putting it in the queue.declare method is rather erm, hopeful. It really
> should be part of the operational interface, not the application interface.

Put very succinctly. :)

-J

From iain.hull at workday.com  Thu Sep  1 08:49:11 2011
From: iain.hull at workday.com (Iain Hull)
Date: Thu, 1 Sep 2011 02:49:11 -0500
Subject: [rabbitmq-discuss] Java client Channel.Close blocking
	indefinitely
In-Reply-To: <4E5E5666.1030204@rabbitmq.com>
References: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>
	<4E5E5666.1030204@rabbitmq.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A36703A2F3A4@34093-C5-EVS1.exchange.rackspace.com>

Hi Matthias,

Thanks for your response, yes you are right. I reran the test last night
with 2.6.0 and the same thing happened.  

Below is the output from the rabbit log file.  It clearly shows an alarm
set at 19:28:20 and then cleared at 23:45:45, then set at 23:45:46 and
cleared at 03:49:42 then finally set again at 03:49:43 and not cleared.

This matches the activity in test also.

I have obviously overwhelming the RabbitMQ server, this is ok (it is the
purpose of my test), and this is running on my laptop not a production
server.  Here are the details from the web interface

Name                rabbit at IHULL-01    
File descriptors    install_handle_from_sysinternals / 1024
Socket descriptors  3 / 829    
Erlang processes    28323 / 32768 
Memory              1.0GB (?) 819.2MB high watermark
Uptime              16h 13m
Version             2.6.0 / R14B03
Type                Disc Stats *

I am very impressed that the web interface continues to work when the
server is not responding (this is good news for our Nagios scripts). 

The next questions are
* How to prevent this happening to the server? I will start researching
this now, but any pointers would be appreciated.
* How to help the client react to this situation? Blocking indefinitely
is not very nice, my primary use case is best effort delivery, and I
cannot block up application threads I need to log a failure and move on.
Either I move all RabbitMQ calls to their own thread or I find a way to
notice a potential blockage and drop messages early.  Again any
suggestions of how people have handled this situation would be
appreciated.

Regards,
Iain.

=INFO REPORT==== 31-Aug-2011::19:25:50 ===
    alarm_handler:
{set,{{vm_memory_high_watermark,'rabbit at IHULL-01'},[]}}

=INFO REPORT==== 31-Aug-2011::19:28:19 ===
vm_memory_high_watermark clear. Memory used:858765904 allowed:858993459

=INFO REPORT==== 31-Aug-2011::19:28:19 ===
    alarm_handler: {clear,{vm_memory_high_watermark,'rabbit at IHULL-01'}}

=INFO REPORT==== 31-Aug-2011::19:28:20 ===
vm_memory_high_watermark set. Memory used:874341656 allowed:858993459

=INFO REPORT==== 31-Aug-2011::19:28:20 ===
    alarm_handler:
{set,{{vm_memory_high_watermark,'rabbit at IHULL-01'},[]}}

=INFO REPORT==== 31-Aug-2011::23:45:45 ===
vm_memory_high_watermark clear. Memory used:857987848 allowed:858993459

=INFO REPORT==== 31-Aug-2011::23:45:45 ===
    alarm_handler: {clear,{vm_memory_high_watermark,'rabbit at IHULL-01'}}

=INFO REPORT==== 31-Aug-2011::23:45:46 ===
vm_memory_high_watermark set. Memory used:890960640 allowed:858993459

=INFO REPORT==== 31-Aug-2011::23:45:46 ===
    alarm_handler:
{set,{{vm_memory_high_watermark,'rabbit at IHULL-01'},[]}}

=INFO REPORT==== 1-Sep-2011::03:49:42 ===
vm_memory_high_watermark clear. Memory used:858210744 allowed:858993459

=INFO REPORT==== 1-Sep-2011::03:49:42 ===
    alarm_handler: {clear,{vm_memory_high_watermark,'rabbit at IHULL-01'}}

=INFO REPORT==== 1-Sep-2011::03:49:43 ===
vm_memory_high_watermark set. Memory used:872273912 allowed:858993459

=INFO REPORT==== 1-Sep-2011::03:49:43 ===
    alarm_handler:
{set,{{vm_memory_high_watermark,'rabbit at IHULL-01'},[]}}


-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: 31 August 2011 16:43
To: Iain Hull
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Java client Channel.Close blocking
indefinitely

Iain,

On 31/08/11 10:46, Iain Hull wrote:
> During one of my tests a call to Channel.Close blocked and never
> returned.
> [...]
> I am not sure if this is relevant but I noticed some information in
the
> logs indicating that the memory high_watermark was hit around the time
> the test stopped.

When the high watermark is hit all connections on which a publish is 
received get blocked. So no data will make it through from these 
connections, and that includes Channel.Close.

The server should eventually recover from this, by paging messages to 
disk or delivering them to consumers. Did that happen in your case, i.e.

did the logs show the alarm getting cleared?

Regards,

Matthias.

From matthias at rabbitmq.com  Thu Sep  1 09:05:41 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 01 Sep 2011 09:05:41 +0100
Subject: [rabbitmq-discuss] Java client Channel.Close
	blocking	indefinitely
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A36703A2F3A4@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>	<4E5E5666.1030204@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703A2F3A4@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <4E5F3CD5.7070402@rabbitmq.com>

Iain,

On 01/09/11 08:49, Iain Hull wrote:
> Thanks for your response, yes you are right. I reran the test last night
> with 2.6.0 and the same thing happened.
>
> Below is the output from the rabbit log file.  It clearly shows an alarm
> set at 19:28:20 and then cleared at 23:45:45, then set at 23:45:46 and
> cleared at 03:49:42 then finally set again at 03:49:43 and not cleared.
> [...]
> Erlang processes    28323 / 32768
> [...]
> The next questions are
> * How to prevent this happening to the server? I will start researching
> this now, but any pointers would be appreciated.
> * How to help the client react to this situation? Blocking indefinitely
> is not very nice,

Generally the memory alarm should always clear eventually. However, 
there are some exceptions...

You have 28323 Erlang processes. That suggests you have lots of channels 
or lots of queues. Each of these has a memory footprint. If your app 
really needs that many channels/queues then you need to run rabbit on a 
machine with more memory, or set up a cluster to divide the 
channels/queues between multiple nodes.

[as an aside, it is curious that the limit for the erlang processes is 
reported as 32k - the default rabbit config sets it to 1M; have you 
changed the config / start up scripts?]


Regards,

Matthias.

From matthew at rabbitmq.com  Thu Sep  1 09:06:08 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 1 Sep 2011 09:06:08 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <4E5EC932.6060402@rabbitmq.com>
References: <4E5E35C5.1050204@rabbitmq.com>
	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>
	<4E5EA5C9.3020708@rabbitmq.com>
	<CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>
	<20110831214824.GA30087@wellquite.org>
	<CAHZAEpeNWAXruHuKykOq2gh5HYn=r-ruGXm1dAtXcoAUY3QP5A@mail.gmail.com>
	<4E5EC932.6060402@rabbitmq.com>
Message-ID: <20110901080608.GB18474@wellquite.org>

On Thu, Sep 01, 2011 at 12:52:18AM +0100, Michael Bridgen wrote:
> Surely the point is that RabbitMQ must be told about the appropriate
> mirroring, yet it's very unlikely to be the person writing an
> application that knows it (and especially not in terms of the Erlang
> node names!), so putting it in the queue.declare method is rather
> erm, hopeful. It really should be part of the operational interface,
> not the application interface.

Indeed. Personally, I'd be keen to extend AMQP with additional methods
that allow such things to be manipulated, thus allowing such management
to be done by any client with the necessary credentials. I find this
much more appealing than extending mgmt or rabbitmqctl.

It's interesting how the "semantic equiv check" on queue.declare (in the
case of redeclaring) should almost certainly _not_ care about such
mutable aspects of queues.

Matthew

From matthias at rabbitmq.com  Thu Sep  1 09:20:33 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 01 Sep 2011 09:20:33 +0100
Subject: [rabbitmq-discuss] When are messages persisted to disk?
In-Reply-To: <20110831223127.GB30087@wellquite.org>
References: <89E8DDB5-D93B-4F7A-9F56-A551BCBF1761@gmail.com>
	<20110831223127.GB30087@wellquite.org>
Message-ID: <4E5F4051.9090807@rabbitmq.com>

On 31/08/11 23:31, Matthew Sackman wrote:
> On Thu, Sep 01, 2011 at 12:14:07AM +0200, Alvaro Videla wrote:
>> Are there situations where the message is directly delivered to the
>> consumer without being persisted to disk?
>
> Yes. Or at least once a certain bug makes it through QA, then it
> will be.

Or even now. When as soon as a message enters the queue it is delivered 
to a consumer that is consuming in no-ack mode.

Matthias.

From simon at rabbitmq.com  Thu Sep  1 09:28:20 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 01 Sep 2011 09:28:20 +0100
Subject: [rabbitmq-discuss] Generic server rabbit_mgmt_db terminating
In-Reply-To: <CANDStergjWejZ-q7N3NBk+7qw7+6_9PFVtkTZGvMOGjtRbC3HA@mail.gmail.com>
References: <CANDStergjWejZ-q7N3NBk+7qw7+6_9PFVtkTZGvMOGjtRbC3HA@mail.gmail.com>
Message-ID: <4E5F4224.9080700@rabbitmq.com>

On 31/08/2011 1:19PM, Conor Glynn wrote:
> =ERROR REPORT==== 30-Aug-2011::20:46:01 ===
> ** Generic server rabbit_mgmt_db terminating
> ** Last message in was {get_overview,all}
> ** When Server state == {state,[{channel_exchange_stats,2599211068},
>                                  {channel_queue_exchange_stats,2599215165},
>                                  {channel_queue_stats,2599206971},
>                                  {channel_stats,2599202874},
>                                  {connection_stats,2599198777},
>                                  {queue_stats,2599194675}]}
> ** Reason for termination ==
> ** {{badmatch,[]},
>      [{rabbit_mgmt_db,augment_queue_pid,2},
>       {rabbit_mgmt_db,augment,4},
>       {rabbit_mgmt_db,'-augment/3-lc$^0/1-0-',3},
>       {rabbit_mgmt_db,'-augment/3-lc$^0/1-0-',3},
>       {rabbit_mgmt_db,augment,3},
>       {rabbit_mgmt_db,'-handle_call/3-lc$^4/1-4-',4},
>       {rabbit_mgmt_db,'-handle_call/3-lc$^4/1-4-',4},
>       {rabbit_mgmt_db,'-handle_call/3-fun-2-',4}]}

Quick drive-by holiday posting: Yes, Matthew is right. This is a bug 
caused by the mgmt plugin looking up details for a queue which has since 
disappeared, so you're likely to see it when queues are churning. It was 
fixed in 2.3.0, but really you should upgrade to 2.6.0 :)

Cheers, Simon

From steve at rabbitmq.com  Thu Sep  1 10:37:49 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Thu, 1 Sep 2011 10:37:49 +0100
Subject: [rabbitmq-discuss] STOMP & wildcard subscriptions
In-Reply-To: <20110831140103.2d52.abe10f7e5afbbb3a79ce619739541149@cern.ch>
References: <20110831140103.2d52.abe10f7e5afbbb3a79ce619739541149@cern.ch>
Message-ID: <031D15B9-8E75-4B31-B70E-1C1F8E76D91A@rabbitmq.com>

Lionel,

The STOMP specification says nothing about wildcard subscriptions, or destinations, leaving the semantics of destinations, and even the link between SENDs to a destination and MESSAGEs returned as a result of SUBSCRIBEs entirely up to the server implementation.

The section in the RabbitMQ STOMP page on Topic Destinations refers to the topic exchange 'amq.topic' which, if you look in the RabbitMQ documentation, explains why your 'wildcard subscriptions against a topic' work.  And that it is a feature. It also explains the rules for wildcards.

The fact that it doesn't "work" for queues is also a feature, and this should be discoverable by the same process.

I suspect this behaviour varies from STOMP implementation to STOMP implementation.
Cheers,
Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.

On 31 Aug 2011, at 13:05, Lionel Cons wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014773.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110901/74946945/attachment.htm>

From majek04 at gmail.com  Thu Sep  1 10:54:19 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 1 Sep 2011 10:54:19 +0100
Subject: [rabbitmq-discuss] HA - queues do not move?
In-Reply-To: <CABzX+qwXN8wVwqgFZEzCJdBKo9RjS=Au=BtsSBo5VnvvFc=v7Q@mail.gmail.com>
References: <2d54b36f-b377-45b7-80a0-dc1c8ca0a6ee@b20g2000vbz.googlegroups.com>
	<CABzX+qwXN8wVwqgFZEzCJdBKo9RjS=Au=BtsSBo5VnvvFc=v7Q@mail.gmail.com>
Message-ID: <CABzX+qzZwEe2vT=KZk9VkPqOD8OME1AeJ+mk7yN7iUs+g+iEPw@mail.gmail.com>

On Wed, Aug 31, 2011 at 15:36, Marek Majkowski <majek04 at gmail.com> wrote:
> On Mon, Aug 29, 2011 at 21:31, John Jeffers <john.jeffers at gmail.com> wrote:
>> (I'm new to Rabbit, so please forgive me if this is a dumb question)
>>
>> I followed the instructions at http://www.rabbitmq.com/pacemaker.html
>> to build a two-node HA environment. ?My nodes are RabbitMQ 2.5.1 on
>> CentOS 6 64-bit, and I'm using a network share for shared storage
>> instead of DRBD.
>>
>> The nodes failover just fine, and most things seem to be working as
>> expected, however, I've noticed that when I take Node 1 down and it
>> fails over to Node 2, the queues and messages on Node 1 do not move to
>> Node 2. ?Is this expected behavior? ?I expected that the point of the
>> shared storage would be so that messages would not be lost in the
>> event of a failover, but maybe my expectations are incorrect?
>
> Have you set 'persistenece' flag on the queues and 'durability' flag
> on messages?

Also, you are not using clustering with pacemaker, right?

Cheers,
  Marek

From iain.hull at workday.com  Thu Sep  1 12:04:18 2011
From: iain.hull at workday.com (Iain Hull)
Date: Thu, 1 Sep 2011 06:04:18 -0500
Subject: [rabbitmq-discuss] Java client Channel.Close blocking
	indefinitely
In-Reply-To: <4E5F3CD5.7070402@rabbitmq.com>
References: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>	<4E5E5666.1030204@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703A2F3A4@34093-C5-EVS1.exchange.rackspace.com>
	<4E5F3CD5.7070402@rabbitmq.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A36703A2F446@34093-C5-EVS1.exchange.rackspace.com>

Hi Matthias,

On 01/09/11 09:06, Matthias Radestock wrote:
> You have 28323 Erlang processes. That suggests you have lots of
channels 
> or lots of queues. Each of these has a memory footprint. If your app 
> really needs that many channels/queues then you need to run rabbit on
a 
> machine with more memory, or set up a cluster to divide the 
> channels/queues between multiple nodes.
My test is designed to add more queues until Rabbit stops working, at
this stage it has created 32,000 there are 16 threads with a Channel
each trying to send and receive messages to a section of these queues at
any one time until all queues have been sent to.

The purpose of my testing is to discover the upper limits of RabbitMQ
and what happens when they are breached.  Now that I know that channels
add to the memory footprint of the server I will have to modify my test.


Our proposed production environment will have two rabbit servers, with a
complete set of queues on each. The client code handles failover and
load balancing (we could not wait for RabbitMQ HA).  Producers select a
rabbit server at random and use a single channel to talk to a group of
queues.  Consumers receive a messages from all queues on all rabbit
server, and uses a different channel for each.  The consumers will be
running in a clustered ESB so there could be multiple consumer nodes
(e.g. 2 or 4).  We are using lots of queues, the application is
multi-tenanted and each tenant must use its own queue to ensure fairness
between tenants.  We expect most of these queues to be quite most of the
time with bursts of activity on a small number of tenants at a time, but
one very busy tenant cannot be allowed to starve another.

Thus to support 32 logical queues for 1000 tenants I will require 32000
RabbitMQ queues on two servers.  If there are 4 ESB nodes there will be
at least 32000 * 4 channels on each server.  The production servers will
be a lot larger than my laptop, probably 24Gb of ram, and I will start
testing with these once they arrive.

My current goal it to discover the parameters that contribute to maxing
out the server.  I will now reduce the number of queues and increase the
channels to find the new breaking point, until the hardware arrives.

On 01/09/11 09:06, Matthias Radestock wrote:
> [as an aside, it is curious that the limit for the erlang processes is

> reported as 32k - the default rabbit config sets it to 1M; have you 
> changed the config / start up scripts?]
That is strange I am currently running 2.6.0 on windows without a config
file.  I also have 8 Gb of ram but I am running 32 bit erlang, so maybe
that explains the low 819.2MB high watermark.  Production will running
on CentOS with 24 Gb or 32 Gb of ram and I expect to increase the
vm_memory_high_watermark to use most of this.

Regards,
Iain.

From mikeb at rabbitmq.com  Thu Sep  1 12:15:47 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 01 Sep 2011 12:15:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <20110901080608.GB18474@wellquite.org>
References: <4E5E35C5.1050204@rabbitmq.com>	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>	<4E5EA5C9.3020708@rabbitmq.com>	<CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>	<20110831214824.GA30087@wellquite.org>	<CAHZAEpeNWAXruHuKykOq2gh5HYn=r-ruGXm1dAtXcoAUY3QP5A@mail.gmail.com>	<4E5EC932.6060402@rabbitmq.com>
	<20110901080608.GB18474@wellquite.org>
Message-ID: <4E5F6963.1080405@rabbitmq.com>

On 09/01/2011 09:06 AM, Matthew Sackman wrote:
> On Thu, Sep 01, 2011 at 12:52:18AM +0100, Michael Bridgen wrote:
>> Surely the point is that RabbitMQ must be told about the appropriate
>> mirroring, yet it's very unlikely to be the person writing an
>> application that knows it (and especially not in terms of the Erlang
>> node names!), so putting it in the queue.declare method is rather
>> erm, hopeful. It really should be part of the operational interface,
>> not the application interface.
>
> Indeed. Personally, I'd be keen to extend AMQP with additional methods
> that allow such things to be manipulated, thus allowing such management
> to be done by any client with the necessary credentials. I find this
> much more appealing than extending mgmt or rabbitmqctl.

I really wouldn't. I don't think the model should be adulterated with 
operational concerns (that's why, for instance, the "durable" flag is daft).

What I wouldn't mind is if there was management interface encoded in 
AMQP.  There's sort of provision already there for it, in the system 
exchange type.  Qpid has a whole framework (QMF) based on this approach, 
though I think it rather too keen to be generic.

> It's interesting how the "semantic equiv check" on queue.declare (in the
> case of redeclaring) should almost certainly _not_ care about such
> mutable aspects of queues.

Yes, good observation. In fact I'd say that anything that appears in the 
fields or arguments that doesn't seem like it should be part of that 
equivalence check, ought not to be in the arguments. ("Durable" fails 
this test, for example)

-M

From emile at rabbitmq.com  Thu Sep  1 12:31:07 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 01 Sep 2011 12:31:07 +0100
Subject: [rabbitmq-discuss] Java client Channel.Close
	blocking	indefinitely
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A36703A2F446@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>	<4E5E5666.1030204@rabbitmq.com>	<925DDDE9D69E7143B3252E2D4680A36703A2F3A4@34093-C5-EVS1.exchange.rackspace.com>	<4E5F3CD5.7070402@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703A2F446@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <4E5F6CFB.9060205@rabbitmq.com>

Hi Iain,

On 01/09/11 12:04, Iain Hull wrote:
> On 01/09/11 09:06, Matthias Radestock wrote:
>> [as an aside, it is curious that the limit for the erlang processes is
>> reported as 32k - the default rabbit config sets it to 1M; have you 
>> changed the config / start up scripts?]
> That is strange I am currently running 2.6.0 on windows without a config
> file.  I also have 8 Gb of ram but I am running 32 bit erlang, so maybe
> that explains the low 819.2MB high watermark.  Production will running
> on CentOS with 24 Gb or 32 Gb of ram and I expect to increase the
> vm_memory_high_watermark to use most of this.

It turns out that when running as a windows service we don't raise the
process limit from the default of 32k to 1M. I will file a bug to fix
that. In the meantime you can either run rabbit as an application or add
the "+P 1048576" erl argument to rabbitmq-service.bat manually until
that fix gets released.

You should be aware that there are some differences between the Windows
and Unix Erlang VMs. The Windows VM is 32bit and limited to 2GB RAM.


-Emile

From matthias at rabbitmq.com  Thu Sep  1 12:31:39 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 01 Sep 2011 12:31:39 +0100
Subject: [rabbitmq-discuss] Java client Channel.Close blocking
	indefinitely
In-Reply-To: <4E5F6CFB.9060205@rabbitmq.com>
References: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>	<4E5E5666.1030204@rabbitmq.com>	<925DDDE9D69E7143B3252E2D4680A36703A2F3A4@34093-C5-EVS1.exchange.rackspace.com>	<4E5F3CD5.7070402@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703A2F446@34093-C5-EVS1.exchange.rackspace.com>
	<4E5F6CFB.9060205@rabbitmq.com>
Message-ID: <4E5F6D1B.3080008@rabbitmq.com>

On 01/09/11 12:31, Emile Joubert wrote:
> You should be aware that there are some differences between the Windows
> and Unix Erlang VMs. The Windows VM is 32bit and limited to 2GB RAM.

Also, the memory footprint of channels, queues, etc  will be different 
on Linux 64-bit.

Matthias.

From demeshchuk at gmail.com  Thu Sep  1 06:24:17 2011
From: demeshchuk at gmail.com (Dmitry Demeshchuk)
Date: Thu, 1 Sep 2011 09:24:17 +0400
Subject: [rabbitmq-discuss] Recycling messages that have been consumed but
	not acked
Message-ID: <CANH2pzsqDfSQQSiHxFCKqTkQ16voQSgUawmr7i51xxZi2WKKCg@mail.gmail.com>

Hello,

We have an Erlang application that uses multiple nodes each with
several rabbitmq consumers connected to different queues. When a node
goes down, its consumers are rebalanced among the rest running nodes.

However, there's a problem. It may take minutes between message
consumption and acking, so most likely when a node goes down, there
are some messages that have been consumed but haven't been acked. And
seems like in that case the newly spawned consumers that are
rebalanced to the other nodes don't get those unacked messages, since
they are already considered to be consumed.

So, my question is, is there a way to make all unacked messages in a
queue become ready for consumption again?

Thank you.

-- 
Best regards,
Dmitry Demeshchuk

From demeshchuk at gmail.com  Thu Sep  1 06:30:32 2011
From: demeshchuk at gmail.com (Dmitry Demeshchuk)
Date: Thu, 1 Sep 2011 09:30:32 +0400
Subject: [rabbitmq-discuss] Recycling messages that have been consumed
	but not acked
In-Reply-To: <CANH2pzsqDfSQQSiHxFCKqTkQ16voQSgUawmr7i51xxZi2WKKCg@mail.gmail.com>
References: <CANH2pzsqDfSQQSiHxFCKqTkQ16voQSgUawmr7i51xxZi2WKKCg@mail.gmail.com>
Message-ID: <CANH2pzv9Fejbt31BDVrTnpfnP-HVGeHniK5r7LBpJqD8NmLiiw@mail.gmail.com>

Looks like basic.recover is what I want, right?

On Thu, Sep 1, 2011 at 9:24 AM, Dmitry Demeshchuk <demeshchuk at gmail.com> wrote:
> Hello,
>
> We have an Erlang application that uses multiple nodes each with
> several rabbitmq consumers connected to different queues. When a node
> goes down, its consumers are rebalanced among the rest running nodes.
>
> However, there's a problem. It may take minutes between message
> consumption and acking, so most likely when a node goes down, there
> are some messages that have been consumed but haven't been acked. And
> seems like in that case the newly spawned consumers that are
> rebalanced to the other nodes don't get those unacked messages, since
> they are already considered to be consumed.
>
> So, my question is, is there a way to make all unacked messages in a
> queue become ready for consumption again?
>
> Thank you.
>
> --
> Best regards,
> Dmitry Demeshchuk
>



-- 
Best regards,
Dmitry Demeshchuk

From iain.hull at workday.com  Thu Sep  1 14:10:23 2011
From: iain.hull at workday.com (Iain Hull)
Date: Thu, 1 Sep 2011 08:10:23 -0500
Subject: [rabbitmq-discuss] Java client Channel.Close blocking
	indefinitely
In-Reply-To: <4E5F6D1B.3080008@rabbitmq.com>
References: <925DDDE9D69E7143B3252E2D4680A367039E44CB@34093-C5-EVS1.exchange.rackspace.com>	<4E5E5666.1030204@rabbitmq.com>	<925DDDE9D69E7143B3252E2D4680A36703A2F3A4@34093-C5-EVS1.exchange.rackspace.com>	<4E5F3CD5.7070402@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703A2F446@34093-C5-EVS1.exchange.rackspace.com>
	<4E5F6CFB.9060205@rabbitmq.com> <4E5F6D1B.3080008@rabbitmq.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A36703A2F53A@34093-C5-EVS1.exchange.rackspace.com>

Thanks Matthias and Emile,

I will modify the service settings.  I plan to re-run the tests once the
hardware arrives.

Iain.

-----Original Message-----
From: Matthias Radestock [mailto:matthias at rabbitmq.com] 
Sent: 01 September 2011 12:32
To: Iain Hull
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Java client Channel.Close blocking
indefinitely

On 01/09/11 12:31, Emile Joubert wrote:
> You should be aware that there are some differences between the
Windows
> and Unix Erlang VMs. The Windows VM is 32bit and limited to 2GB RAM.

Also, the memory footprint of channels, queues, etc  will be different 
on Linux 64-bit.

Matthias.

From Matthew.Whitfield at i2owater.com  Thu Sep  1 16:11:38 2011
From: Matthew.Whitfield at i2owater.com (Matthew Whitfield)
Date: Thu, 1 Sep 2011 16:11:38 +0100
Subject: [rabbitmq-discuss] A few questions about RabbitMQ and the .NET
	Client
Message-ID: <2E9FF226505B9647B7929A019E274D9F2B5E7EBA3A@ZIG.i20water.local>

I have a few questions - and I'd be very grateful if someone could point me in the right direction as to where to read more about the answers.
 1)      Headers exchanges

a.       I can see headers exchanges mentioned on http://www.rabbitmq.com/tutorials/amqp-concepts.html but I can't find any reference to it in the .NET client (for instance, it's missing from the ExchangeType class) - even though the prototypes for ExchangeDeclare and QueueBind would seem to allow for a headers exchange to be handled. Is this just something that is 'on the list'?

b.      I can't find any documentation on exactly how header matching works. I can see it mentioned in section 3.1.3.4 of the AMQP 0.9.1 spec, but I can't see any examples. For instance, if I wanted to match on messages where the 'type' header was 'action', the 'sub-type' header contained any value and the 'source' header was 'distribution' - would that be possible?

2)      TxSelect, TxCommit and TxRollback

a.       I can't really find any good examples of the usage or implications of transactions. My use case is that I want to receive a message, then generate 100 messages which either all get routed to their queue or not (basically an atomic publish) before acking the message that I receive. This is, in part, to allow for message durability to be handled in the broker (as per the 'Not on message persistence' that is about two-thirds of the way down http://www.rabbitmq.com/tutorials/tutorial-two-python.html). I wanted to know how TxCommit would react if the broker commit failed, and for this I had to re-compile the source because the documentation doesn't say anything about it. As far as I can see a failed commit throws an UnexpectedMessageException. Is that right?

b.      While researching this, I found a recent commit which has the comment 'don't use tx in examples. The less it's mentioned the better.'. Why is that?

c.       In that commit, a message was changed to mention BasicQos instead of TxCommit - is that really the intention? Is there anywhere I can read more about that as the API documentation doesn't give much away...
Thanks very much!
Matt




[cid:image8658fe.jpg at 013a9b2c.719a46e7]


[cid:image8add09.jpg at 6d2f03f6.d0934c84]
Matthew Whitfield
Software Architect


[cid:imageac9a58.jpg at 688a3584.86b24148]
i2O Water Ltd
4 Benham Road
Southampton Science Park
Southampton SO16 7QJ, UK


[cid:imagea9f0fe.jpg at 0a7e4a5d.fc96419a]
t:   +44 2380 111577
m: +44 7766 951222
www.i2owater.com<http://www.i2owater.com/>
Registered in the UK
5617487



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110901/e75425ee/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image8658fe.jpg at 013a9b2c.719a46e7
Type: image/jpeg
Size: 2373 bytes
Desc: image8658fe.jpg at 013a9b2c.719a46e7
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110901/e75425ee/attachment.jpeg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image8add09.jpg at 6d2f03f6.d0934c84
Type: image/jpeg
Size: 701 bytes
Desc: image8add09.jpg at 6d2f03f6.d0934c84
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110901/e75425ee/attachment-0001.jpeg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: imageac9a58.jpg at 688a3584.86b24148
Type: image/jpeg
Size: 701 bytes
Desc: imageac9a58.jpg at 688a3584.86b24148
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110901/e75425ee/attachment-0002.jpeg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: imagea9f0fe.jpg at 0a7e4a5d.fc96419a
Type: image/jpeg
Size: 701 bytes
Desc: imagea9f0fe.jpg at 0a7e4a5d.fc96419a
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110901/e75425ee/attachment-0003.jpeg>

From majek04 at gmail.com  Thu Sep  1 16:20:56 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Thu, 1 Sep 2011 16:20:56 +0100
Subject: [rabbitmq-discuss] Unable to install RabbitMQ 2.6.0 using
	MacPorts
In-Reply-To: <50BBC9A8-323C-40CD-825B-E2CCC995DD77@gilt.com>
References: <03154477-FE38-49D0-8546-DE18C51FA09E@gilt.com>
	<4E5E679B.8040001@rabbitmq.com>
	<85FCAD13-6B51-4C80-9894-C8E6A15931F3@gilt.com>
	<CABzX+qzhwBuqCXz5jjMjSsnwMLY4Y9Q1d3_0jBLr_-cvChn5GQ@mail.gmail.com>
	<50BBC9A8-323C-40CD-825B-E2CCC995DD77@gilt.com>
Message-ID: <CABzX+qyyDvWMrp8s6Ly_A1K=npdfx+yG-hJhz7UBea95t3LAwg@mail.gmail.com>

Ray,

Indeed, I'm able to reproduce the issue.
It looks like macports 2.x introduced incompatible changes
and our Portfile stopped working.

I'll try to fix the issue.

Cheers,
  Marek


On Wed, Aug 31, 2011 at 18:50, Raymond Murthi <rmurthi at gilt.com> wrote:
> Hi Marek,
>
> Unfortunately not. Cleaning my caches does not help either. I also did the selfupdate and upgrade earlier but to no avail.
>
> I'll dig further if this is a known issue and will let you know if there's a solution / work around.
>
>
> Thanks,
> -Ray
>
> On Aug 31, 2011, at 1:29 PM, Marek Majkowski wrote:
>
>> Raymond,
>>
>> Do try running:
>> port selfupdate
>> port upgrade outdated
>> port install rabbitmq-server
>>
>> if that doesn't help, you may need to clear caches (if, for example
>> download was broken):
>> port clean --all rabbitmq-server
>>
>> Hope that helps
>> Marek
>>
>> On Wed, Aug 31, 2011 at 17:59, Raymond Murthi <rmurthi at gilt.com> wrote:
>>> Hi Matthias,
>>>
>>> Sure. This is the debug messages:
>>>
>>> tar: Error exit delayed from previous errors.
>>> ? ?while executing
>>> "exec /usr/bin/tar -zqxOf {rabbitmq-server.tgz} +CONTENTS"
>>> ? ?("eval" body line 1)
>>> ? ?invoked from within
>>> "eval exec $cmdline"
>>> ? ?(procedure "macports::fetch_port" line 24)
>>> ? ?invoked from within
>>> "macports::fetch_port $url 0"
>>> ? ?(procedure "macports::getportdir" line 24)
>>> ? ?invoked from within
>>> "macports::getportdir $porturl $portdir"
>>> ? ?(procedure "mportopen" line 27)
>>> ? ?invoked from within
>>> "mportopen $porturl [array get options] [array get requested_variations]"
>>>
>>>
>>>
>>> Thanks,
>>> -Ray
>>>
>>> On Aug 31, 2011, at 12:55 PM, Matthias Radestock wrote:
>>>
>>>> Ray,
>>>>
>>>> On 31/08/11 17:41, Raymond Murthi wrote:
>>>>> I got this error when trying to install the latest RabbitMQ version
>>>>> through MacPorts. I have added RabbitMQ repo in my sources.conf and did
>>>>> a port sync before running port install.
>>>>>
>>>>> Error: Unable to open port: tar: +CONTENTS: Not found in archive
>>>>> tar: Error exit delayed from previous errors.
>>>>
>>>> Is there anything noteworthy in the output when running the port
>>>> commands with debug (-d) turned on?
>>>>
>>>> Regards,
>>>>
>>>> Matthias.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Thu Sep  1 16:35:55 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 1 Sep 2011 16:35:55 +0100
Subject: [rabbitmq-discuss] RabbitMQ Visualiser Preview for RabbitMQ 2.6.0
Message-ID: <20110901153553.GA22785@rabbitmq.com>

"Nothing appears for ages, and then three come along at once!"

Having had RabbitMQ launch on Cloud Foundary and Heroku
( http://www.rabbitmq.com/blog/2011/09/01/rabbitmq-on-heroku/ ), the
2.6.0 release coming out with many new features ( http://t.co/84Zrh4A );
I can now announce the next preview version of the RabbitMQ Visualiser.

Installation:
1. You need to be running RabbitMQ 2.6.0, and you need to have installed
   the Management Plugin (see
   http://www.rabbitmq.com/management.html#installation ).

Then, in your plugins directory:

2. Delete rabbitmq_management-2.6.0.ez

3. Download
http://www.rabbitmq.com/releases/plugins/v2.6.0-visualiser-preview/rabbitmq_management-2.6.0-visualiser-preview.ez
and
http://www.rabbitmq.com/releases/plugins/v2.6.0-visualiser-preview/rabbitmq_management_visualiser-2.6.0-visualiser-preview.ez
into your plugins directory.

4. Restart RabbitMQ.

You should now find the management webpage has a "Visualiser" tab. To
get a sense of what you should be able to see, point your browser at
http://guest:guest at dev.rabbitmq.com/mgmt/visualiser/
where I have got it set up and running, along with a client that's
slowly creating and removing resources on the broker.

See
http://hg.rabbitmq.com/rabbitmq-management-visualiser/file/default/README
for a README that includes which browsers work best, how things are laid
out, and what you can click on, double click on, drag and prod.

Note that whenever you release an item and it snaps back to its
idealised location, you are required to say out loud "Boiinnnnnnng!".

Feedback very welcome.

Matthew

From pkwarren at gmail.com  Thu Sep  1 17:38:09 2011
From: pkwarren at gmail.com (Philip K. Warren)
Date: Thu, 1 Sep 2011 11:38:09 -0500
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 failing to start (Debian Package)
Message-ID: <CAEUMe+TWvGBEUO7b6=eMLc3rPS=nP1PkyJKwhw3E7Efsj841Lg@mail.gmail.com>

I have installed the RabbitMQ Debian package from the Apt repository
located here: http://www.rabbitmq.com/debian.html#apt. Previous
releases worked great, but the latest release is failing to start
after a reboot. I believe it is due to small PID file handling changes
between 2.5.1 and 2.6.0 and the fact that Ubuntu is mounting /var/run
as a tmpfs filesystem (so it is wiped after every reboot).

This is what /var/log/rabbitmq/startup_err is reporting:

mkdir: cannot create directory `/var/run/rabbitmq': Permission denied
/usr/lib/rabbitmq/bin/rabbitmq-server: 71: cannot create
/var/run/rabbitmq/pid: Directory nonexistent

I think the rabbitmq-server init script needs to create the
/var/run/rabbitmq directory if it doesn't exist, as the rabbitmq user
doesn't have permission to create the directory.

I have temporarily made this change to the init script to get it working:

--- 2_6_0/etc/init.d/rabbitmq-server	2011-08-26 10:42:19.000000000 -0500
+++ /etc/init.d/rabbitmq-server	2011-09-01 11:36:59.537220755 -0500
@@ -41,6 +41,13 @@
     else
         RETVAL=0
         set +e
+        # BEGIN LOCAL MODIFICATIONS
+        if [ ! -d /var/run/rabbitmq ]; then
+            mkdir /var/run/rabbitmq
+            chmod 0755 /var/run/rabbitmq
+            chown $USER:$USER /var/run/rabbitmq
+        fi
+        # END LOCAL MODIFICATIONS
         setsid sh -c "RABBITMQ_PID_FILE=$PID_FILE $DAEMON > \
             ${INIT_LOG_DIR}/startup_log 2> ${INIT_LOG_DIR}/startup_err" &
         $CONTROL wait $PID_FILE >/dev/null 2>&1

-- 
Philip K. Warren

From emile at rabbitmq.com  Thu Sep  1 18:05:46 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 01 Sep 2011 18:05:46 +0100
Subject: [rabbitmq-discuss] A few questions about RabbitMQ and the .NET
 Client
In-Reply-To: <2E9FF226505B9647B7929A019E274D9F2B5E7EBA3A@ZIG.i20water.local>
References: <2E9FF226505B9647B7929A019E274D9F2B5E7EBA3A@ZIG.i20water.local>
Message-ID: <4E5FBB6A.3040600@rabbitmq.com>

Hi Matthew,

On 01/09/11 16:11, Matthew Whitfield wrote:
> I have a few questions ? and I?d be very grateful if someone could point
> me in the right direction as to where to read more about the answers.
> 
>  1)      Headers exchanges
> 
> a.       I can see headers exchanges mentioned on
> http://www.rabbitmq.com/tutorials/amqp-concepts.html but I can?t find
> any reference to it in the .NET client (for instance, it?s missing from
> the ExchangeType class) ? even though the prototypes for ExchangeDeclare
> and QueueBind would seem to allow for a headers exchange to be handled.
> Is this just something that is ?on the list??

You are right, ExchangeType omits the header exchange for some reason.
I'll make sure that gets added. The ExchangeType class could be
misleading though. The AMQP extension mechanism means that it is not
possible to tell ahead of time which exchange types exist on the broker.

You can supply the string "headers" to Model.ExchangeDeclare() instead
of using ExchangeType. The header exchange type is fully implemented in
the broker though.

> b.      I can?t find any documentation on exactly how header matching
> works. I can see it mentioned in section 3.1.3.4 of the AMQP 0.9.1 spec,
> but I can?t see any examples. For instance, if I wanted to match on
> messages where the ?type? header was ?action?, the ?sub-type? header
> contained any value and the ?source? header was ?distribution? ? would
> that be possible?

The specification is a good source of information. Also see
http://www.rabbitmq.com/tutorials/amqp-concepts.html#exchange-headers

There's no explicit support for booleans, but you can emulate this with
exchange bindings. If you bind an intermediate exchange and a queue in
series then both bindings have to match before messages will end up in
the queue.

> 2)      TxSelect, TxCommit and TxRollback
> 
> a.       I can?t really find any good examples of the usage or
> implications of transactions. My use case is that I want to receive a
> message, then generate 100 messages which either all get routed to their
> queue or not (basically an atomic publish) before acking the message
> that I receive. This is, in part, to allow for message durability to be
> handled in the broker (as per the ?Not on message persistence? that is
> about two-thirds of the way down

A better way to guarantee that messages have safely been written to disk
is to use publish confirms:
http://www.rabbitmq.com/extensions.html#confirms

> b.      While researching this, I found a recent commit which has the
> comment ?don't use tx in examples. The less it's mentioned the better.?.
> Why is that?

Take a look at http://www.rabbitmq.com/specification.html#tx for
information on the changing support for transactions.

> c.       In that commit, a message was changed to mention BasicQos
> instead of TxCommit ? is that really the intention? Is there anywhere I
> can read more about that as the API documentation doesn?t give much away?

I assume you are referring to
http://hg.rabbitmq.com/rabbitmq-dotnet-client/rev/270f6d6a4b1c

That relates to section 4.4 in the .net user guide:
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.6.0/rabbitmq-dotnet-client-2.6.0-user-guide.pdf

In that case the point being made is about race conditions, which holds
regardless of which API method is used. You should not assume that the
code is equivalent.


Regards

Emile

From john.jeffers at gmail.com  Thu Sep  1 19:11:34 2011
From: john.jeffers at gmail.com (John Jeffers)
Date: Thu, 1 Sep 2011 11:11:34 -0700 (PDT)
Subject: [rabbitmq-discuss] HA - queues do not move?
In-Reply-To: <CABzX+qwXN8wVwqgFZEzCJdBKo9RjS=Au=BtsSBo5VnvvFc=v7Q@mail.gmail.com>
References: <2d54b36f-b377-45b7-80a0-dc1c8ca0a6ee@b20g2000vbz.googlegroups.com>
	<CABzX+qwXN8wVwqgFZEzCJdBKo9RjS=Au=BtsSBo5VnvvFc=v7Q@mail.gmail.com>
Message-ID: <94aa0396-5b75-4690-abdb-b2be8b034e98@er4g2000vbb.googlegroups.com>

Thank you Marek! This is exactly what I needed to know.  I changed the
code I was using to create queues and publish messages, and now the
persistent messages are failing over.  For anyone who might need this
in the future, here is the code that is working for me (using the .NET
API, RabbitMQ version 2.5.1).

// Create the Exchange and Queue with Durable flags set to True.
using (IConnection connection =
connectionFactory.CreateConnection())  // Assumes that you have a
ConnectionFactory object instantiated.
{
    using (IModel model = connection.CreateModel())
    {
        model.ExchangeDeclare("exchangeName", ExchangeType.Direct,
true);
        model.QueueDeclare("queueName", true, false, false, null);

        model.QueueBind("queueName", "exchangeName", "routingKey",
null);

        IBasicProperties basicProperties =
model.CreateBasicProperties();
        basicProperties.DeliveryMode = 2; // Message persistence --
required for failover.
        model.BasicPublish("exchangeName", "routingKey",
basicProperties, Encoding.UTF8.GetBytes("message"));
    }
}


On Aug 31, 8:36?am, Marek Majkowski <maje... at gmail.com> wrote:
> On Mon, Aug 29, 2011 at 21:31, John Jeffers <john.jeff... at gmail.com> wrote:
> > (I'm new to Rabbit, so please forgive me if this is a dumb question)
>
> > I followed the instructions athttp://www.rabbitmq.com/pacemaker.html
> > to build a two-node HA environment. ?My nodes are RabbitMQ 2.5.1 on
> > CentOS 6 64-bit, and I'm using a network share for shared storage
> > instead of DRBD.
>
> > The nodes failover just fine, and most things seem to be working as
> > expected, however, I've noticed that when I take Node 1 down and it
> > fails over to Node 2, the queues and messages on Node 1 do not move to
> > Node 2. ?Is this expected behavior? ?I expected that the point of the
> > shared storage would be so that messages would not be lost in the
> > event of a failover, but maybe my expectations are incorrect?
>
> Have you set 'persistenece' flag on the queues and 'durability' flag
> on messages?
>
> Chees,
> ? Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jasonjwwilliams at gmail.com  Thu Sep  1 19:19:47 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 1 Sep 2011 12:19:47 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <20110901080608.GB18474@wellquite.org>
References: <4E5E35C5.1050204@rabbitmq.com>
	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>
	<4E5EA5C9.3020708@rabbitmq.com>
	<CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>
	<20110831214824.GA30087@wellquite.org>
	<CAHZAEpeNWAXruHuKykOq2gh5HYn=r-ruGXm1dAtXcoAUY3QP5A@mail.gmail.com>
	<4E5EC932.6060402@rabbitmq.com>
	<20110901080608.GB18474@wellquite.org>
Message-ID: <CAHZAEpfai2AXv-dogR52CgOfSh4NYVPxgZ9+y6w=pCVsZ8EA5Q@mail.gmail.com>

> Indeed. Personally, I'd be keen to extend AMQP with additional methods
> that allow such things to be manipulated, thus allowing such management
> to be done by any client with the necessary credentials. I find this
> much more appealing than extending mgmt or rabbitmqctl.

Extending AMQP with in-band management would be really interesting.
Before the REST API came along it was something I really wanted to
see. However, I'm really not crazy about extending client-oriented
commands like queue.declare to control HA. In my experience, things
like HA should be as transparent as possible to the
data/client-oriented primitives they make more resilient. For example,
when creating a table in MySQL you don't specify how or where it
should be replicated. That's an operational consideration subject to
flux that should be transparent to the clients/applications using the
service. Similarly in Riak, you only supply the replication factor
when storing data. You don't tell Riak which nodes to put the data on
or if you have the DC-replication plugin, which clusters to replicate
to. It should be possible to change the particulars of
HA/clustering/replication without having to change the clients. It
seems to me to make the clients brittle and subject to breaking every
time you operationally change Rabbit. The "all nodes" setting really
isn't a solution to that. To me, the rule of thumb for deciding where
to control an HA/replication argument should be "will the arguments
have to change if have a topology change? (e.g. remove, rename, or
re-locate a node)". If the answer is yes, then it should be controlled
from a management instead of client/app interface.

-J

From spirt40 at gmail.com  Thu Sep  1 19:31:26 2011
From: spirt40 at gmail.com (Roman Khomenko)
Date: Thu, 1 Sep 2011 21:31:26 +0300
Subject: [rabbitmq-discuss] Notify when "Worker" die
Message-ID: <CAK9RAoo4OPPCJkDz_2D+YTnkH2svEQNXUbh5ABuF_d8DzyKByQ@mail.gmail.com>

I developed Work Queues like in tutorial. But I don't need to rerun task.

Now my worker:
- get TASK and TASK_ID
- if TASK_ID in MemCache:
     write to DB: TASK FAIL
     basic_ack
- else:
    write MemCache TASK_ID
    DO_TASK
    basic_ack

I think it's now beautiful method. Can I get "TRY COUNT" from message?
Or can RabbitMQ send this task to another queue if first Task run died?

Thanks!

-------------
Best regards, Roman Khomenko
http://tutamc.com

From hedelson at vmware.com  Thu Sep  1 19:48:21 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Thu, 1 Sep 2011 11:48:21 -0700
Subject: [rabbitmq-discuss] Problems logging into mgmt console with rabbit
	2.6
Message-ID: <BDE140BF4C952041931EF8CAAC83341D026B6B8DDE@exch-mbx-111.vmware.com>

Hi, after the quick upgrade, and a few fresh re-installs to see the problem, I am surprisingly unable to log into the mgmt console with the anonymous user.
It keeps rejecting me, even after, as noted, reinstalls, deleting the mnesia dir, restarting the browser, removing all associated cookies/settings, and 

This is not working either but perhaps user error?
hedelson:~ hedelson$ sudo rabbitmqadmin declare user name=admin password=admin tags=administrator
Password:
*** Access refused: /users/adminhedelson:~ hedelson$ sudo rabbitmqadmin declare user name=admin password=admin tags=administrator


Thanks,
Helena  

From matthias at rabbitmq.com  Thu Sep  1 19:59:39 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 01 Sep 2011 19:59:39 +0100
Subject: [rabbitmq-discuss] Problems logging into mgmt console with
 rabbit 2.6
In-Reply-To: <BDE140BF4C952041931EF8CAAC83341D026B6B8DDE@exch-mbx-111.vmware.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8DDE@exch-mbx-111.vmware.com>
Message-ID: <4E5FD61B.8060509@rabbitmq.com>

Helena,

On 01/09/11 19:48, Helena Edelson wrote:
> Hi, after the quick upgrade, and a few fresh re-installs to see the
> problem, I am surprisingly unable to log into the mgmt console with
> the anonymous user. It keeps rejecting me, even after, as noted,
> reinstalls, deleting the mnesia dir, restarting the browser, removing
> all associated cookies/settings, and
>
> This is not working either but perhaps user error? hedelson:~
> hedelson$ sudo rabbitmqadmin declare user name=admin password=admin
> tags=administrator Password: *** Access refused:
> /users/adminhedelson:~ hedelson$ sudo rabbitmqadmin declare user
> name=admin password=admin tags=administrator

See http://www.rabbitmq.com/management.html#permissions

By default none of the users have access to management functionality.
This needs to be enabled with rabbitmqctl.


Matthias.

From hedelson at vmware.com  Thu Sep  1 20:08:25 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Thu, 1 Sep 2011 12:08:25 -0700
Subject: [rabbitmq-discuss] Problems logging into mgmt console with
	rabbit 2.6
In-Reply-To: <BDE140BF4C952041931EF8CAAC83341D026B6B8DDE@exch-mbx-111.vmware.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8DDE@exch-mbx-111.vmware.com>
Message-ID: <BDE140BF4C952041931EF8CAAC83341D026B6B8DE0@exch-mbx-111.vmware.com>

Issue resolved.

Thanks,
Helena
________________________________________
From: Helena Edelson
Sent: Thursday, September 01, 2011 12:48 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Problems logging into mgmt console with rabbit 2.6

Hi, after the quick upgrade, and a few fresh re-installs to see the problem, I am surprisingly unable to log into the mgmt console with the anonymous user.
It keeps rejecting me, even after, as noted, reinstalls, deleting the mnesia dir, restarting the browser, removing all associated cookies/settings, and

This is not working either but perhaps user error?
hedelson:~ hedelson$ sudo rabbitmqadmin declare user name=admin password=admin tags=administrator
Password:
*** Access refused: /users/adminhedelson:~ hedelson$ sudo rabbitmqadmin declare user name=admin password=admin tags=administrator


Thanks,
Helena

From fearsome.lucidity at gmail.com  Thu Sep  1 20:16:17 2011
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Thu, 1 Sep 2011 12:16:17 -0700
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
Message-ID: <CAFDmHdPNRx=5cXgqQe8yV3_24kJj=X35uZCTHpnDhVKtCeZz5Q@mail.gmail.com>

Congratulations on releasing 2.6.0.  We've been looking forward to mirrored
queues, and the federation plugin will be put to use once we deploy to more
than one Amazon region.

I've gone through he mirrored queue documentation and its largely clear.
 The only question I was left with is what happens to the persisted messages
in a durable mirrored queue of a slave that is restarting and does not find
a master.  The docs say that if the master exists the slave will clear is
queue before joining, as its queue may be stale compared to that of the
master, but its silent on what happens if the master does not exists.

This also begs the question as to whether we must now be careful about the
order that nodes must be restarted after a full cluster shutdown.  Must we
ensure that the last node shutdown that was participating in a mirrored
queue, and thus the one that became master last, is the one that is
restarted first, so that the last master is online when slaves join the
cluster?

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110901/3fa4f99d/attachment.htm>

From mjayanthi at gmail.com  Fri Sep  2 00:54:27 2011
From: mjayanthi at gmail.com (Murthy Jayanthi)
Date: Thu, 1 Sep 2011 16:54:27 -0700
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
In-Reply-To: <4E5E35C5.1050204@rabbitmq.com>
References: <4E5E35C5.1050204@rabbitmq.com>
Message-ID: <CAMVw-Wp_rPmFY9=frP9Nsx37kG7hmoZjodtvme3P-HNQNLdUig@mail.gmail.com>

HI All,
I am investing light weight. stable messaging products and RabbitMQ looks
great to me. I have a couple of questions and I am hoping that someone could
help me get answers.

1. Does RabbitMQ support  an external persistence adapter for persist
message delivery to avoid message guaranty.
2. The idea is to use Cassandra replicated storage for managing the persist
messages.
3. If anyone has tried that, what is the ballpark throughput of a single
instance of Rabbit?

Thanks in advance,
MJay

On Wed, Aug 31, 2011 at 6:23 AM, Tim Fox <tim at rabbitmq.com> wrote:

> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.6.0.
>
> The highlight of this release is the introduction of active-active HA, with
> queues getting replicated across nodes in a cluster. There are many other
> improvements, particularly to the management and stomp plug-ins, as well as
> a number of bug fixes. See the attached release notes for more details.
>
> Binary and source distributions of the new release can be found in the
> usual place at http://www.rabbitmq.com/**download.html<http://www.rabbitmq.com/download.html>
>
> We recommend that all users of earlier versions of RabbitMQ upgrade to this
> latest release.
>
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and enhancements
> in future releases. Mail us via the RabbitMQ discussion list at
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>,
> or directly at info at rabbitmq.com.
>
> Regards,
>
> The RabbitMQ Team
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 

Regards
MJay
*
*
*"Today's decisions define tomorrow's choices"*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110901/20506248/attachment.htm>

From mradestock at vmware.com  Thu Sep  1 21:43:05 2011
From: mradestock at vmware.com (Matthias Radestock)
Date: Thu, 01 Sep 2011 21:43:05 +0100
Subject: [rabbitmq-discuss] Problems logging into mgmt console with
 rabbit 2.6
In-Reply-To: <4E5FD61B.8060509@rabbitmq.com>
References: <BDE140BF4C952041931EF8CAAC83341D026B6B8DDE@exch-mbx-111.vmware.com>
	<4E5FD61B.8060509@rabbitmq.com>
Message-ID: <4E5FEE59.4090109@vmware.com>

On 01/09/11 19:59, Matthias Radestock wrote:
> By default none of the users have access to management functionality.

Actually, the default guest/guest account has the 'administrator' tag set.

Matthias.

From Matthew.Whitfield at i2owater.com  Fri Sep  2 08:32:50 2011
From: Matthew.Whitfield at i2owater.com (Matthew Whitfield)
Date: Fri, 2 Sep 2011 08:32:50 +0100
Subject: [rabbitmq-discuss] A few questions about RabbitMQ and the .NET
 Client
In-Reply-To: <4E5FBB6A.3040600@rabbitmq.com>
References: <2E9FF226505B9647B7929A019E274D9F2B5E7EBA3A@ZIG.i20water.local>
	<4E5FBB6A.3040600@rabbitmq.com>
Message-ID: <2E9FF226505B9647B7929A019E274D9F2B5E7EBA8D@ZIG.i20water.local>

Emile

Thanks for your help...

With the headers exchanges - I had seen both sources of information you mentioned, but still didn't find it hugely useful - for example, if I want to specify a particular header can match any value when the x-match is set to 'all' - that's the sort of information I'd like to see. Maybe I am missing something? The intermediate exchange point looks good, I will look into that.

With the transactions - are they really best avoided? Or are they OK to be used as long as we understand the consequences? For example, in our environment we are happy that we will be using RabbitMQ rather than any other type of AMQP broker - and so we would be happy with Rabbit's version of transactions and their behaviour. Is there any other reason to be wary of using transactions?

Thanks again

Matt




Matthew Whitfield
Software Architect

i2O Water Ltd
4 Benham Road
Southampton Science Park
Southampton SO16 7QJ, UK

t:  +44 2380 111577
m: +44 7766 951222
http://www.i2owater.com/
Registered in the UK
5617487

-----Original Message-----

From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: 01 September 2011 18:06
To: Matthew Whitfield
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] A few questions about RabbitMQ and the .NET Client

Hi Matthew,

On 01/09/11 16:11, Matthew Whitfield wrote:
> I have a few questions - and I'd be very grateful if someone could
> point me in the right direction as to where to read more about the answers.
>
>  1)      Headers exchanges
>
> a.       I can see headers exchanges mentioned on
> http://www.rabbitmq.com/tutorials/amqp-concepts.html but I can't find
> any reference to it in the .NET client (for instance, it's missing
> from the ExchangeType class) - even though the prototypes for
> ExchangeDeclare and QueueBind would seem to allow for a headers exchange to be handled.
> Is this just something that is 'on the list'?

You are right, ExchangeType omits the header exchange for some reason.
I'll make sure that gets added. The ExchangeType class could be misleading though. The AMQP extension mechanism means that it is not possible to tell ahead of time which exchange types exist on the broker.

You can supply the string "headers" to Model.ExchangeDeclare() instead of using ExchangeType. The header exchange type is fully implemented in the broker though.

> b.      I can't find any documentation on exactly how header matching
> works. I can see it mentioned in section 3.1.3.4 of the AMQP 0.9.1
> spec, but I can't see any examples. For instance, if I wanted to match
> on messages where the 'type' header was 'action', the 'sub-type'
> header contained any value and the 'source' header was 'distribution'
> - would that be possible?

The specification is a good source of information. Also see http://www.rabbitmq.com/tutorials/amqp-concepts.html#exchange-headers

There's no explicit support for booleans, but you can emulate this with exchange bindings. If you bind an intermediate exchange and a queue in series then both bindings have to match before messages will end up in the queue.

> 2)      TxSelect, TxCommit and TxRollback
>
> a.       I can't really find any good examples of the usage or
> implications of transactions. My use case is that I want to receive a
> message, then generate 100 messages which either all get routed to
> their queue or not (basically an atomic publish) before acking the
> message that I receive. This is, in part, to allow for message
> durability to be handled in the broker (as per the 'Not on message
> persistence' that is about two-thirds of the way down

A better way to guarantee that messages have safely been written to disk is to use publish confirms:
http://www.rabbitmq.com/extensions.html#confirms

> b.      While researching this, I found a recent commit which has the
> comment 'don't use tx in examples. The less it's mentioned the better.'.
> Why is that?

Take a look at http://www.rabbitmq.com/specification.html#tx for information on the changing support for transactions.

> c.       In that commit, a message was changed to mention BasicQos
> instead of TxCommit - is that really the intention? Is there anywhere
> I can read more about that as the API documentation doesn't give much
> away.

I assume you are referring to
http://hg.rabbitmq.com/rabbitmq-dotnet-client/rev/270f6d6a4b1c

That relates to section 4.4 in the .net user guide:
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.6.0/rabbitmq-dotnet-client-2.6.0-user-guide.pdf

In that case the point being made is about race conditions, which holds regardless of which API method is used. You should not assume that the code is equivalent.


Regards

Emile


From matthias at rabbitmq.com  Fri Sep  2 08:59:07 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 02 Sep 2011 08:59:07 +0100
Subject: [rabbitmq-discuss] A few questions about RabbitMQ and the .NET
 Client
In-Reply-To: <2E9FF226505B9647B7929A019E274D9F2B5E7EBA8D@ZIG.i20water.local>
References: <2E9FF226505B9647B7929A019E274D9F2B5E7EBA3A@ZIG.i20water.local>	<4E5FBB6A.3040600@rabbitmq.com>
	<2E9FF226505B9647B7929A019E274D9F2B5E7EBA8D@ZIG.i20water.local>
Message-ID: <4E608CCB.3050001@rabbitmq.com>

Matt,
On 02/09/11 08:32, Matthew Whitfield wrote:
> With the headers exchanges - I had seen both sources of information
> you mentioned, but still didn't find it hugely useful - for example,
> if I want to specify a particular header can match any value when the
> x-match is set to 'all' - that's the sort of information I'd like to
> see. Maybe I am missing something?

Take a look at 
http://hg.rabbitmq.com/rabbitmq-java-client/file/rabbitmq_v2_6_0/test/src/com/rabbitmq/client/test/functional/Routing.java#l156 
for an example. It's in Java, but should be easy to translate into .net.

> The intermediate exchange point looks good, I will look into that.

With 'all' and 'any' you get the choice of conjunction or disjunction, 
i.e. you can express "Match all these headers" or "Match any of these 
headers"

By introducing intermediate exchanges you can express conjunctions of 
disjunctions, i.e. "Match any of these headers AND match any of these 
headers AND ...".

> With the transactions - are they really best avoided? Or are they OK
> to be used as long as we understand the consequences?

Both. If there is a reasonably straightforward way to write your app w/o 
relying on AMQP transactions, e.g. by using 'confirms', etc, then I'd 
encourage you to do so. If, OTOH, transactions really are by far the 
most convenient approach, and you understand their behaviour in AMQP and 
Rabbit, then by all means use them.

Regards,

Matthias.

From Matthew.Whitfield at i2owater.com  Fri Sep  2 08:59:53 2011
From: Matthew.Whitfield at i2owater.com (Matthew Whitfield)
Date: Fri, 2 Sep 2011 08:59:53 +0100
Subject: [rabbitmq-discuss] A few questions about RabbitMQ and the .NET
 Client
In-Reply-To: <4E608CCB.3050001@rabbitmq.com>
References: <2E9FF226505B9647B7929A019E274D9F2B5E7EBA3A@ZIG.i20water.local><4E5FBB6A.3040600@rabbitmq.com>
	<2E9FF226505B9647B7929A019E274D9F2B5E7EBA8D@ZIG.i20water.local>
	<4E608CCB.3050001@rabbitmq.com>
Message-ID: <2E9FF226505B9647B7929A019E274D9F2B5E7EBA97@ZIG.i20water.local>

Matthias

Thanks, that's answered all my questions perfectly!

Cheers

Matt




Matthew Whitfield
Software Architect

i2O Water Ltd
4 Benham Road
Southampton Science Park
Southampton SO16 7QJ, UK

t:  +44 2380 111577
m: +44 7766 951222
http://www.i2owater.com/
Registered in the UK
5617487

-----Original Message-----

From: Matthias Radestock [mailto:matthias at rabbitmq.com]
Sent: 02 September 2011 08:59
To: Matthew Whitfield
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] A few questions about RabbitMQ and the .NET Client

Matt,
On 02/09/11 08:32, Matthew Whitfield wrote:
> With the headers exchanges - I had seen both sources of information
> you mentioned, but still didn't find it hugely useful - for example,
> if I want to specify a particular header can match any value when the
> x-match is set to 'all' - that's the sort of information I'd like to
> see. Maybe I am missing something?

Take a look at
http://hg.rabbitmq.com/rabbitmq-java-client/file/rabbitmq_v2_6_0/test/src/com/rabbitmq/client/test/functional/Routing.java#l156
for an example. It's in Java, but should be easy to translate into .net.

> The intermediate exchange point looks good, I will look into that.

With 'all' and 'any' you get the choice of conjunction or disjunction, i.e. you can express "Match all these headers" or "Match any of these headers"

By introducing intermediate exchanges you can express conjunctions of disjunctions, i.e. "Match any of these headers AND match any of these headers AND ...".

> With the transactions - are they really best avoided? Or are they OK
> to be used as long as we understand the consequences?

Both. If there is a reasonably straightforward way to write your app w/o relying on AMQP transactions, e.g. by using 'confirms', etc, then I'd encourage you to do so. If, OTOH, transactions really are by far the most convenient approach, and you understand their behaviour in AMQP and Rabbit, then by all means use them.

Regards,

Matthias.


From matthew at rabbitmq.com  Fri Sep  2 09:12:26 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 2 Sep 2011 09:12:26 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 failing to start (Debian
 Package)
In-Reply-To: <CAEUMe+TWvGBEUO7b6=eMLc3rPS=nP1PkyJKwhw3E7Efsj841Lg@mail.gmail.com>
References: <CAEUMe+TWvGBEUO7b6=eMLc3rPS=nP1PkyJKwhw3E7Efsj841Lg@mail.gmail.com>
Message-ID: <20110902081226.GA23535@wellquite.org>

Hi Philip,

On Thu, Sep 01, 2011 at 11:38:09AM -0500, Philip K. Warren wrote:
> mkdir: cannot create directory `/var/run/rabbitmq': Permission denied
> /usr/lib/rabbitmq/bin/rabbitmq-server: 71: cannot create
> /var/run/rabbitmq/pid: Directory nonexistent
> 
> I think the rabbitmq-server init script needs to create the
> /var/run/rabbitmq directory if it doesn't exist, as the rabbitmq user
> doesn't have permission to create the directory.

Thanks for reporting this. There's always something that manages to get
through... sigh. Given the severity of this, I would imagine there'll be
a patch release coming out fairly soon.

Matthew

From max at haventon.se  Fri Sep  2 09:45:01 2011
From: max at haventon.se (max at haventon.se)
Date: Fri, 2 Sep 2011 08:45:01 +0000
Subject: [rabbitmq-discuss] Unable to manage Service after log off
Message-ID: <DF08B645FD232746AA7806A1B7F3CC0F03B46242@CH1PRD0102MB133.prod.exchangelabs.com>

Hi,

I'm experiencing a rather strange issue with the RabbitMQ Windows Service.

>>rabbitmq-service start
Erlsrc: Service RabbitMQ started.

>>rabbitmqctl status
Status of node rabbit at HOST ...
[{pid,5260},
{running_applications,
     [{rabbitmq_shovel,"Data Shovel for RabbitMQ","2.5.1"},
...

If I now log off from the machine, and then log in again I get:

>>rabbitmqctl status
Status of node rabbit at HOST ...
Error: unable to connect to node rabbit at HOST: nodedown

However, the Service is still running and working as normal. It's possible to recreate this from a remote machine as well:

OTHERHOST>>rabbitmqctl status -n rabbit at HOST
Status of node rabbit at HOST ...
[{pid,5260},
{running_applications,
     [{rabbitmq_shovel,"Data Shovel for RabbitMQ","2.5.1"},
...

Log off from HOST

OTHERHOST>>rabbitmqctl status -n rabbit at HOST
Status of node rabbit at HOST ...
Error: unable to connect to node rabbit at HOST: nodedown

I've synchronized the .erlang.cookie according to http://groups.google.com/group/rabbitmq-discuss/msg/5bbad24be82583d5 (OTHERHOST and HOST as well as the different directories (c:\Windows for Service, c:\Users\user\ for rabbitmqctl).

The logs at HOST are not showing anything when the connection attempt is made.

Once re-logged in, restarting the Service in Admin Tools/Services lets me use rabbitmqctl status again.

Best Regards
Max
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110902/15715339/attachment.htm>

From majek04 at gmail.com  Fri Sep  2 10:20:29 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 2 Sep 2011 10:20:29 +0100
Subject: [rabbitmq-discuss] couple of questions (was: Re: RabbitMQ 2.6.0 is
	released)
Message-ID: <CABzX+qyOeXjXhyq60mLRjApy6YB4fBhhJvAGGpWFq9g+Z0O6TA@mail.gmail.com>

Murthy,

On Fri, Sep 2, 2011 at 00:54, Murthy Jayanthi <mjayanthi at gmail.com> wrote:
> I am investing light weight. stable messaging products and RabbitMQ looks
> great to me. I have a couple of questions and I am hoping that someone could
> help me get answers.
>
> 1. Does RabbitMQ support? an external persistence adapter for persist
> message delivery to avoid message guaranty.
> 2. The idea is to use Cassandra replicated storage for managing the persist
> messages.

Currently, RabbitMQ uses its own, well tuned, persistence layer.
It's possible to replace current implementation with a different
one, few attempts were made to support alternative  data stores,
but nothing reached GA.

RabbitMQ is generic message broker which supports many
messaging patterns, it would be unlikely that a simple k-v message
store (like cassandra) would behave performant with load patterns
that RabbitMQ creates.

> 3. If anyone has tried that, what is the ballpark throughput of a single
> instance of Rabbit?

This is an open-ended question.
 - Do you care about reliability (persistence)?
 - Do you need transactions?
 - In general, are your consumers going to be faster
  than producers? (ie: are you going to queue messages at all?)
 - What size of the messages can you expect?
 - What routing topology?
 - What number of queues is going to be used, and what
   will be their load?

If you want a single number - our tool - multicastmain,
documented for example at the bottom of this page:
  http://www.rabbitmq.com/ec2.html
Shows up to 30k msgs/sec in a simple scenario
(but in practice this is a meaningless number).

What we usually suggest, is to write a prototype of
your application and do end-to-end tests.
I would be surprised if RabbitMQ appeared to be
the bottleneck in your app.

Cheers,
  Marek

From majek04 at gmail.com  Fri Sep  2 10:24:18 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 2 Sep 2011 10:24:18 +0100
Subject: [rabbitmq-discuss] Notify when "Worker" die
In-Reply-To: <CAK9RAoo4OPPCJkDz_2D+YTnkH2svEQNXUbh5ABuF_d8DzyKByQ@mail.gmail.com>
References: <CAK9RAoo4OPPCJkDz_2D+YTnkH2svEQNXUbh5ABuF_d8DzyKByQ@mail.gmail.com>
Message-ID: <CABzX+qyKBjq_BcDHPgynrMQOiv1ianhZanZxie43h6eDm8BuHw@mail.gmail.com>

On Thu, Sep 1, 2011 at 19:31, Roman Khomenko <spirt40 at gmail.com> wrote:
> I developed Work Queues like in tutorial. But I don't need to rerun task.
>
> Now my worker:
> - get TASK and TASK_ID
> - if TASK_ID in MemCache:
> ? ? write to DB: TASK FAIL
> ? ? basic_ack
> - else:
> ? ?write MemCache TASK_ID
> ? ?DO_TASK
> ? ?basic_ack
>
> I think it's now beautiful method. Can I get "TRY COUNT" from message?

I'm not sure what you mean.

> Or can RabbitMQ send this task to another queue if first Task run died?

No, but you can look at message properties and check 'redelivery' field.
If it's set to True, it means that a message is being redelivered.
In such case you may send a copy of this message to a different queue.

Cheers,
  Marek

From majek04 at gmail.com  Fri Sep  2 10:34:24 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 2 Sep 2011 10:34:24 +0100
Subject: [rabbitmq-discuss] Recycling messages that have been consumed
 but not acked
In-Reply-To: <CANH2pzv9Fejbt31BDVrTnpfnP-HVGeHniK5r7LBpJqD8NmLiiw@mail.gmail.com>
References: <CANH2pzsqDfSQQSiHxFCKqTkQ16voQSgUawmr7i51xxZi2WKKCg@mail.gmail.com>
	<CANH2pzv9Fejbt31BDVrTnpfnP-HVGeHniK5r7LBpJqD8NmLiiw@mail.gmail.com>
Message-ID: <CABzX+qy0XRypLgSnonZ3Kw3CofOba-Lq3Po5eDJL8XPhcDJOVw@mail.gmail.com>

On Thu, Sep 1, 2011 at 06:30, Dmitry Demeshchuk <demeshchuk at gmail.com> wrote:
> Looks like basic.recover is what I want, right?

Yes, looks like it:
http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.recover


> On Thu, Sep 1, 2011 at 9:24 AM, Dmitry Demeshchuk <demeshchuk at gmail.com> wrote:
>> Hello,
>>
>> We have an Erlang application that uses multiple nodes each with
>> several rabbitmq consumers connected to different queues. When a node
>> goes down, its consumers are rebalanced among the rest running nodes.
>>
>> However, there's a problem. It may take minutes between message
>> consumption and acking, so most likely when a node goes down, there
>> are some messages that have been consumed but haven't been acked. And
>> seems like in that case the newly spawned consumers that are
>> rebalanced to the other nodes don't get those unacked messages, since
>> they are already considered to be consumed.
>>
>> So, my question is, is there a way to make all unacked messages in a
>> queue become ready for consumption again?
>>
>> Thank you.
>>
>> --
>> Best regards,
>> Dmitry Demeshchuk
>>
>
>
>
> --
> Best regards,
> Dmitry Demeshchuk
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From majek04 at gmail.com  Fri Sep  2 10:36:09 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 2 Sep 2011 10:36:09 +0100
Subject: [rabbitmq-discuss] Measuring RabbitMQ performance
In-Reply-To: <0C13F4DB-F3C7-462E-8663-9AE783ACF3F3@gmail.com>
References: <0C13F4DB-F3C7-462E-8663-9AE783ACF3F3@gmail.com>
Message-ID: <CABzX+qy697mp1w=fwrTZ95f_1wL_5Xu7hCTtcyzPMNeELu8Egg@mail.gmail.com>

On Mon, Aug 29, 2011 at 00:08, Alvaro Videla <videlalvaro at gmail.com> wrote:
> I've been reading blog posts like the following one from the RabbitMQ website:
>
> http://www.rabbitmq.com/blog/2010/09/14/very-fast-and-scalable-topic-routing-part-1/
>
> Which was the program/library used to measure the performance there?

I'm sure Vlad created some custom scripts that
measured few specific cases.

> What did you use to create those graphs?

Looks like google docs for me.

Marek

From matthias at rabbitmq.com  Fri Sep  2 10:41:13 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 02 Sep 2011 10:41:13 +0100
Subject: [rabbitmq-discuss] Recycling messages that have been consumed
 but not acked
In-Reply-To: <CABzX+qy0XRypLgSnonZ3Kw3CofOba-Lq3Po5eDJL8XPhcDJOVw@mail.gmail.com>
References: <CANH2pzsqDfSQQSiHxFCKqTkQ16voQSgUawmr7i51xxZi2WKKCg@mail.gmail.com>	<CANH2pzv9Fejbt31BDVrTnpfnP-HVGeHniK5r7LBpJqD8NmLiiw@mail.gmail.com>
	<CABzX+qy0XRypLgSnonZ3Kw3CofOba-Lq3Po5eDJL8XPhcDJOVw@mail.gmail.com>
Message-ID: <4E60A4B9.4030103@rabbitmq.com>

On 02/09/11 10:34, Marek Majkowski wrote:
> On Thu, Sep 1, 2011 at 06:30, Dmitry Demeshchuk<demeshchuk at gmail.com>  wrote:
>> Looks like basic.recover is what I want, right?
>
> Yes, looks like it:
> http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.recover

Note however ...

>>> So, my question is, is there a way to make all unacked messages in a
>>> queue become ready for consumption again?

basic.recover acts on the *channel*, not the queue, i.e. it will cause 
all messages delivered on the specific channel to be redelivered/requeued.

Also, the client owning the channel must not subsequently ack any of the 
messages that were recovered, or the broker will complain. That's why 
there is a synchronous version of 'basic.recover' since otherwise the 
client has no idea which messages were recovered, namely all messages 
received before the basic.recover-ok.


Matthias.

From emile at rabbitmq.com  Fri Sep  2 10:59:39 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 02 Sep 2011 10:59:39 +0100
Subject: [rabbitmq-discuss] Unable to manage Service after log off
In-Reply-To: <DF08B645FD232746AA7806A1B7F3CC0F03B46242@CH1PRD0102MB133.prod.exchangelabs.com>
References: <DF08B645FD232746AA7806A1B7F3CC0F03B46242@CH1PRD0102MB133.prod.exchangelabs.com>
Message-ID: <4E60A90B.8090003@rabbitmq.com>

Hi Max,

On 02/09/11 09:45, max at haventon.se wrote:
> Hi,
> 
>  
> 
> I?m experiencing a rather strange issue with the RabbitMQ Windows Service.

I'm not able to reproduce this. Can you confirm that you are logged in
as the same user both times? You chopped off the cookie hash from the
output of the failed status command - can you check that this matches
the hash reported by the broker in the startup banner? You may need to
set the console log variable to get this:

http://www.rabbitmq.com/configure.html#define-environment-variables


-Emile

From michael.s.klishin at gmail.com  Fri Sep  2 11:03:13 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 2 Sep 2011 14:03:13 +0400
Subject: [rabbitmq-discuss] Notify when "Worker" die
In-Reply-To: <CABzX+qyKBjq_BcDHPgynrMQOiv1ianhZanZxie43h6eDm8BuHw@mail.gmail.com>
References: <CAK9RAoo4OPPCJkDz_2D+YTnkH2svEQNXUbh5ABuF_d8DzyKByQ@mail.gmail.com>
	<CABzX+qyKBjq_BcDHPgynrMQOiv1ianhZanZxie43h6eDm8BuHw@mail.gmail.com>
Message-ID: <CAE3HoVQZd6Tjrdz3Vaota9Nnvb4gt+EaXqbJvWg0hbGBB9iCpg@mail.gmail.com>

2011/9/2 Marek Majkowski <majek04 at gmail.com>

> > I think it's now beautiful method. Can I get "TRY COUNT" from message?
>
> I'm not sure what you mean.
>

I think "TRY COUNT" here refers to the number of redelivery attempts. The
answer is no.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110902/28207a47/attachment.htm>

From oleksandr.petrov at gmail.com  Fri Sep  2 11:35:08 2011
From: oleksandr.petrov at gmail.com (Alex P)
Date: Fri, 2 Sep 2011 03:35:08 -0700 (PDT)
Subject: [rabbitmq-discuss] Librabbitmq-c API
Message-ID: <4e1d3ad5-70fa-4f93-80aa-1ee4f214a9c8@fd21g2000vbb.googlegroups.com>

Hi,

We've started using librabbitmq-c on ARM device with 200MHZ and 64mb
of RAM, works very well, it's so nice to know that it's available for
embedding & stable enough to use in industrial projects. Actually,
librabbitmq together with v8 opens up a whole new world of
opportunities and eases embedded development a lot, thanks for the
hard work done on the lib!

So far we went with a toolset that's defined in ./examples and ./
tools, but, for instance in example for listenqueue framing is done
manually. Is there a high-level API for receiving a whole message in
case it's there and getting AMQP_BASIC_GET_EMPTY_METHOD or anything
else if body is empty / nothing received?

amqp_basic_get(conn, 1, queue, 1); seemed to be a good candidate for
that, but still in codegen.py it's marked as one of those methods that
should not be exposed as an API.

So, my question would be - what is the best way to receive messages?
Should we handle framing manually, as it's done in examples? If not,
what are the api methods that we should stick to?

Thanks

From max at haventon.se  Fri Sep  2 11:50:19 2011
From: max at haventon.se (max at haventon.se)
Date: Fri, 2 Sep 2011 10:50:19 +0000
Subject: [rabbitmq-discuss] Unable to manage Service after log off
Message-ID: <DF08B645FD232746AA7806A1B7F3CC0F03B47F13@CH1PRD0102MB133.prod.exchangelabs.com>

Hi,

I've set the environment variables:

>>SET
....
RABBITMQ_BASE=C:\RabbitHome
RABBITMQ_CONSOLE_LOG=new
...
SESSIONNAME=RDP-TCP#9

But no file is created in C:\RabbitHome when I start the service.

Note: I'm connected over RDP, could that matter?

Max

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: den 2 september 2011 12:00
To: max at haventon.se
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Unable to manage Service after log off

Hi Max,

On 02/09/11 09:45, max at haventon.se wrote:
> Hi,
> 
>  
> 
> I'm experiencing a rather strange issue with the RabbitMQ Windows Service.

I'm not able to reproduce this. Can you confirm that you are logged in as the same user both times? You chopped off the cookie hash from the output of the failed status command - can you check that this matches the hash reported by the broker in the startup banner? You may need to set the console log variable to get this:

http://www.rabbitmq.com/configure.html#define-environment-variables


-Emile


From emile at rabbitmq.com  Fri Sep  2 12:08:00 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 02 Sep 2011 12:08:00 +0100
Subject: [rabbitmq-discuss] Unable to manage Service after log off
In-Reply-To: <DF08B645FD232746AA7806A1B7F3CC0F03B47F13@CH1PRD0102MB133.prod.exchangelabs.com>
References: <DF08B645FD232746AA7806A1B7F3CC0F03B47F13@CH1PRD0102MB133.prod.exchangelabs.com>
Message-ID: <4E60B910.4080302@rabbitmq.com>

Hi Max,

On 02/09/11 11:50, max at haventon.se wrote:
> Hi,
> 
> I've set the environment variables:
> 
>>> SET
> ....
> RABBITMQ_BASE=C:\RabbitHome
> RABBITMQ_CONSOLE_LOG=new
> ...
> SESSIONNAME=RDP-TCP#9
> 
> But no file is created in C:\RabbitHome when I start the service.

Please see http://www.rabbitmq.com/install.html#running-windows-service
After setting environment variables, you may need to install the service
again. Please let me know if that still doesn't work.

Emile

From majek04 at gmail.com  Fri Sep  2 12:15:27 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 2 Sep 2011 12:15:27 +0100
Subject: [rabbitmq-discuss] Unable to install RabbitMQ 2.6.0 using
	MacPorts
In-Reply-To: <CABzX+qyyDvWMrp8s6Ly_A1K=npdfx+yG-hJhz7UBea95t3LAwg@mail.gmail.com>
References: <03154477-FE38-49D0-8546-DE18C51FA09E@gilt.com>
	<4E5E679B.8040001@rabbitmq.com>
	<85FCAD13-6B51-4C80-9894-C8E6A15931F3@gilt.com>
	<CABzX+qzhwBuqCXz5jjMjSsnwMLY4Y9Q1d3_0jBLr_-cvChn5GQ@mail.gmail.com>
	<50BBC9A8-323C-40CD-825B-E2CCC995DD77@gilt.com>
	<CABzX+qyyDvWMrp8s6Ly_A1K=npdfx+yG-hJhz7UBea95t3LAwg@mail.gmail.com>
Message-ID: <CABzX+qz9XZix-5V6xda5dReompjwAfMCdGOGu_hTqtMZqqyBcQ@mail.gmail.com>

Ray,

This is a Macports problem introduced in macports 2.0.1.
Here's relevant ticket:
   https://trac.macports.org/ticket/31033

Let's hope it will be resolved in 2.0.2.

Cheers,
   Marek

On Thu, Sep 1, 2011 at 16:20, Marek Majkowski <majek04 at gmail.com> wrote:
> Ray,
>
> Indeed, I'm able to reproduce the issue.
> It looks like macports 2.x introduced incompatible changes
> and our Portfile stopped working.
>
> I'll try to fix the issue.
>
> Cheers,
> ?Marek
>
>
> On Wed, Aug 31, 2011 at 18:50, Raymond Murthi <rmurthi at gilt.com> wrote:
>> Hi Marek,
>>
>> Unfortunately not. Cleaning my caches does not help either. I also did the selfupdate and upgrade earlier but to no avail.
>>
>> I'll dig further if this is a known issue and will let you know if there's a solution / work around.
>>
>>
>> Thanks,
>> -Ray
>>
>> On Aug 31, 2011, at 1:29 PM, Marek Majkowski wrote:
>>
>>> Raymond,
>>>
>>> Do try running:
>>> port selfupdate
>>> port upgrade outdated
>>> port install rabbitmq-server
>>>
>>> if that doesn't help, you may need to clear caches (if, for example
>>> download was broken):
>>> port clean --all rabbitmq-server
>>>
>>> Hope that helps
>>> Marek
>>>
>>> On Wed, Aug 31, 2011 at 17:59, Raymond Murthi <rmurthi at gilt.com> wrote:
>>>> Hi Matthias,
>>>>
>>>> Sure. This is the debug messages:
>>>>
>>>> tar: Error exit delayed from previous errors.
>>>> ? ?while executing
>>>> "exec /usr/bin/tar -zqxOf {rabbitmq-server.tgz} +CONTENTS"
>>>> ? ?("eval" body line 1)
>>>> ? ?invoked from within
>>>> "eval exec $cmdline"
>>>> ? ?(procedure "macports::fetch_port" line 24)
>>>> ? ?invoked from within
>>>> "macports::fetch_port $url 0"
>>>> ? ?(procedure "macports::getportdir" line 24)
>>>> ? ?invoked from within
>>>> "macports::getportdir $porturl $portdir"
>>>> ? ?(procedure "mportopen" line 27)
>>>> ? ?invoked from within
>>>> "mportopen $porturl [array get options] [array get requested_variations]"
>>>>
>>>>
>>>>
>>>> Thanks,
>>>> -Ray
>>>>
>>>> On Aug 31, 2011, at 12:55 PM, Matthias Radestock wrote:
>>>>
>>>>> Ray,
>>>>>
>>>>> On 31/08/11 17:41, Raymond Murthi wrote:
>>>>>> I got this error when trying to install the latest RabbitMQ version
>>>>>> through MacPorts. I have added RabbitMQ repo in my sources.conf and did
>>>>>> a port sync before running port install.
>>>>>>
>>>>>> Error: Unable to open port: tar: +CONTENTS: Not found in archive
>>>>>> tar: Error exit delayed from previous errors.
>>>>>
>>>>> Is there anything noteworthy in the output when running the port
>>>>> commands with debug (-d) turned on?
>>>>>
>>>>> Regards,
>>>>>
>>>>> Matthias.
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>

From david at rabbitmq.com  Fri Sep  2 12:31:22 2011
From: david at rabbitmq.com (David Wragg)
Date: Fri, 02 Sep 2011 12:31:22 +0100
Subject: [rabbitmq-discuss] Librabbitmq-c API
In-Reply-To: <4e1d3ad5-70fa-4f93-80aa-1ee4f214a9c8@fd21g2000vbb.googlegroups.com>
	(Alex P.'s message of "Fri, 2 Sep 2011 03:35:08 -0700 (PDT)")
References: <4e1d3ad5-70fa-4f93-80aa-1ee4f214a9c8@fd21g2000vbb.googlegroups.com>
Message-ID: <yrv4ck49rnpth.fsf@dwragg.eng.vmware.com>

Alex P <oleksandr.petrov at gmail.com> writes:
> So far we went with a toolset that's defined in ./examples and ./
> tools, but, for instance in example for listenqueue framing is done
> manually. Is there a high-level API for receiving a whole message in
> case it's there and getting AMQP_BASIC_GET_EMPTY_METHOD or anything
> else if body is empty / nothing received?

You're right, the support for consuming messages is quite low-level.

There's no particularly good reason for that, although designing an
efficient general purpose high-level API is non-trivial.  You can write
easily write one that meets the needs of your application though, and I
would recommend you do so.

For example, the code in tools/ is able to directly output message
contents from the memory buffers managed by librabbitmq.  The copy_body
function in tools/common.c encapsulates this.

But other applications might want to malloc a single block of memory for
each incoming message body, and copy the body data from the frames into
that.  Etc.

> amqp_basic_get(conn, 1, queue, 1); seemed to be a good candidate for
> that, but still in codegen.py it's marked as one of those methods that
> should not be exposed as an API.

amqp_basic_get is exposed as an API.  It's defined in amq_api.c, and is
definitely intended for use by applications.

It is marked for special handling in codegen.py simply because the
autogenerated definition would not be correct (the comment there is
misleading; the real issue is that basic.get has two possible responses:
AMQP_BASIC_GET_OK_METHOD and AMQP_BASIC_GET_EMPTY_METHOD).

> So, my question would be - what is the best way to receive messages?
> Should we handle framing manually, as it's done in examples? If not,
> what are the api methods that we should stick to?

Do it manually, but by writing your own code to encapsulate the
low-level frame handling.  librabbitmq might get a higher-level API one
day, and by encapsulating the code that uses the current API, you'll
find it easier to transition.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From majek04 at gmail.com  Fri Sep  2 12:35:31 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 2 Sep 2011 12:35:31 +0100
Subject: [rabbitmq-discuss] Unable to install RabbitMQ 2.6.0 using
	MacPorts
In-Reply-To: <CABzX+qz9XZix-5V6xda5dReompjwAfMCdGOGu_hTqtMZqqyBcQ@mail.gmail.com>
References: <03154477-FE38-49D0-8546-DE18C51FA09E@gilt.com>
	<4E5E679B.8040001@rabbitmq.com>
	<85FCAD13-6B51-4C80-9894-C8E6A15931F3@gilt.com>
	<CABzX+qzhwBuqCXz5jjMjSsnwMLY4Y9Q1d3_0jBLr_-cvChn5GQ@mail.gmail.com>
	<50BBC9A8-323C-40CD-825B-E2CCC995DD77@gilt.com>
	<CABzX+qyyDvWMrp8s6Ly_A1K=npdfx+yG-hJhz7UBea95t3LAwg@mail.gmail.com>
	<CABzX+qz9XZix-5V6xda5dReompjwAfMCdGOGu_hTqtMZqqyBcQ@mail.gmail.com>
Message-ID: <CABzX+qxozqUh9JEmpPJyOaWd=u80FsSh9rog6vFyc1qz8FAFOg@mail.gmail.com>

A,ha!

Apparently macports 2.0.2 is already released
  http://lists.macosforge.org/pipermail/macports-announce/2011-September/000018.html

It seems to be working fine, I'm able to install rabbit 2.6.0

Cheers,
 Marek

On Fri, Sep 2, 2011 at 12:15, Marek Majkowski <majek04 at gmail.com> wrote:
> Ray,
>
> This is a Macports problem introduced in macports 2.0.1.
> Here's relevant ticket:
> ? https://trac.macports.org/ticket/31033
>
> Let's hope it will be resolved in 2.0.2.
>
> Cheers,
> ? Marek
>
> On Thu, Sep 1, 2011 at 16:20, Marek Majkowski <majek04 at gmail.com> wrote:
>> Ray,
>>
>> Indeed, I'm able to reproduce the issue.
>> It looks like macports 2.x introduced incompatible changes
>> and our Portfile stopped working.
>>
>> I'll try to fix the issue.
>>
>> Cheers,
>> ?Marek
>>
>>
>> On Wed, Aug 31, 2011 at 18:50, Raymond Murthi <rmurthi at gilt.com> wrote:
>>> Hi Marek,
>>>
>>> Unfortunately not. Cleaning my caches does not help either. I also did the selfupdate and upgrade earlier but to no avail.
>>>
>>> I'll dig further if this is a known issue and will let you know if there's a solution / work around.
>>>
>>>
>>> Thanks,
>>> -Ray
>>>
>>> On Aug 31, 2011, at 1:29 PM, Marek Majkowski wrote:
>>>
>>>> Raymond,
>>>>
>>>> Do try running:
>>>> port selfupdate
>>>> port upgrade outdated
>>>> port install rabbitmq-server
>>>>
>>>> if that doesn't help, you may need to clear caches (if, for example
>>>> download was broken):
>>>> port clean --all rabbitmq-server
>>>>
>>>> Hope that helps
>>>> Marek
>>>>
>>>> On Wed, Aug 31, 2011 at 17:59, Raymond Murthi <rmurthi at gilt.com> wrote:
>>>>> Hi Matthias,
>>>>>
>>>>> Sure. This is the debug messages:
>>>>>
>>>>> tar: Error exit delayed from previous errors.
>>>>> ? ?while executing
>>>>> "exec /usr/bin/tar -zqxOf {rabbitmq-server.tgz} +CONTENTS"
>>>>> ? ?("eval" body line 1)
>>>>> ? ?invoked from within
>>>>> "eval exec $cmdline"
>>>>> ? ?(procedure "macports::fetch_port" line 24)
>>>>> ? ?invoked from within
>>>>> "macports::fetch_port $url 0"
>>>>> ? ?(procedure "macports::getportdir" line 24)
>>>>> ? ?invoked from within
>>>>> "macports::getportdir $porturl $portdir"
>>>>> ? ?(procedure "mportopen" line 27)
>>>>> ? ?invoked from within
>>>>> "mportopen $porturl [array get options] [array get requested_variations]"
>>>>>
>>>>>
>>>>>
>>>>> Thanks,
>>>>> -Ray
>>>>>
>>>>> On Aug 31, 2011, at 12:55 PM, Matthias Radestock wrote:
>>>>>
>>>>>> Ray,
>>>>>>
>>>>>> On 31/08/11 17:41, Raymond Murthi wrote:
>>>>>>> I got this error when trying to install the latest RabbitMQ version
>>>>>>> through MacPorts. I have added RabbitMQ repo in my sources.conf and did
>>>>>>> a port sync before running port install.
>>>>>>>
>>>>>>> Error: Unable to open port: tar: +CONTENTS: Not found in archive
>>>>>>> tar: Error exit delayed from previous errors.
>>>>>>
>>>>>> Is there anything noteworthy in the output when running the port
>>>>>> commands with debug (-d) turned on?
>>>>>>
>>>>>> Regards,
>>>>>>
>>>>>> Matthias.
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>

From max at haventon.se  Fri Sep  2 12:46:10 2011
From: max at haventon.se (max at haventon.se)
Date: Fri, 2 Sep 2011 11:46:10 +0000
Subject: [rabbitmq-discuss] Unable to manage Service after log off
In-Reply-To: <4E60B910.4080302@rabbitmq.com>
References: <DF08B645FD232746AA7806A1B7F3CC0F03B47F13@CH1PRD0102MB133.prod.exchangelabs.com>
	<4E60B910.4080302@rabbitmq.com>
Message-ID: <DF08B645FD232746AA7806A1B7F3CC0F03B47FE0@CH1PRD0102MB133.prod.exchangelabs.com>

Reinstalling the service helped.

I get the following output when the service is started:

node           : rabbit at HOST
app descriptor : c:/Program Files/RabbitMQ Server/rabbitmq_server-2.5.1/sbin/../ebin/rabbit.app
home dir       : C:\WINDOWS
config file(s) : c:/RabbitHome/rabbitmq.config
cookie hash    : zTZa14A3pDxcfHm3E+Hbqw==
log            : c:/RabbitHome/log/rabbit at HOST.log
sasl log       : c:/RabbitHome/log/rabbit at HOST -sasl.log
database dir   : c:/RabbitHome/db/rabbit at HOST -mnesia
erlang version : 5.8.4

The cookie hash is the same as when I run the failed rabbitmqctl status:

>>rabbitmqctl status
Status of node rabbit at HOST...
Error: unable to connect to node rabbit at HOST: nodedown
diagnostics:
- nodes and their ports on HOST: [{rabbitmqctl26790,1262}]
- current node: rabbitmqctl26790 at HOST
- current node home dir: C:\Documents and Settings\username
- current node cookie hash: zTZa14A3pDxcfHm3E+Hbqw==

The Service's log doesn't show anything at all when the failed connection attempt is made. Also note that the Service's node is not listed in the list of nodes.

Note that I'm using Remote Desktop to connect to HOST.

BR
Max

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: den 2 september 2011 13:08
To: max at haventon.se
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Unable to manage Service after log off

Hi Max,

On 02/09/11 11:50, max at haventon.se wrote:
> Hi,
> 
> I've set the environment variables:
> 
>>> SET
> ....
> RABBITMQ_BASE=C:\RabbitHome
> RABBITMQ_CONSOLE_LOG=new
> ...
> SESSIONNAME=RDP-TCP#9
> 
> But no file is created in C:\RabbitHome when I start the service.

Please see http://www.rabbitmq.com/install.html#running-windows-service
After setting environment variables, you may need to install the service again. Please let me know if that still doesn't work.

Emile


From emile at rabbitmq.com  Fri Sep  2 14:11:51 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 02 Sep 2011 14:11:51 +0100
Subject: [rabbitmq-discuss] Unable to manage Service after log off
In-Reply-To: <DF08B645FD232746AA7806A1B7F3CC0F03B47FE0@CH1PRD0102MB133.prod.exchangelabs.com>
References: <DF08B645FD232746AA7806A1B7F3CC0F03B47F13@CH1PRD0102MB133.prod.exchangelabs.com>
	<4E60B910.4080302@rabbitmq.com>
	<DF08B645FD232746AA7806A1B7F3CC0F03B47FE0@CH1PRD0102MB133.prod.exchangelabs.com>
Message-ID: <4E60D617.3020308@rabbitmq.com>

Hi Max,

On 02/09/11 12:46, max at haventon.se wrote:

> cookie hash    : zTZa14A3pDxcfHm3E+Hbqw==
> - current node cookie hash: zTZa14A3pDxcfHm3E+Hbqw==

I see these are the same, so that is not the problem.


From max at haventon.se  Fri Sep  2 15:21:43 2011
From: max at haventon.se (max at haventon.se)
Date: Fri, 2 Sep 2011 14:21:43 +0000
Subject: [rabbitmq-discuss] Unable to manage Service after log off
In-Reply-To: <4E60D617.3020308@rabbitmq.com>
References: <DF08B645FD232746AA7806A1B7F3CC0F03B47F13@CH1PRD0102MB133.prod.exchangelabs.com>
	<4E60B910.4080302@rabbitmq.com>
	<DF08B645FD232746AA7806A1B7F3CC0F03B47FE0@CH1PRD0102MB133.prod.exchangelabs.com>
	<4E60D617.3020308@rabbitmq.com>
Message-ID: <DF08B645FD232746AA7806A1B7F3CC0F03B4A1F9@SN2PRD0102MB141.prod.exchangelabs.com>

Hi,

That's what's so strange. The Service *is* running. It's receiving messages constantly after I log out. Everything works except "Erlang based management access" (rabbitmqctl / werl -remsh rabbit at HOST). I have several Shovels connected to the node, and they keep shoveling.

I've reproduced this on one Windows Server 2008 R2 SP1 and one Windows Server 2003.

The Service log file doesn't change at all when logging out.

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: den 2 september 2011 15:12
To: max at haventon.se
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Unable to manage Service after log off

Hi Max,

On 02/09/11 12:46, max at haventon.se wrote:

> cookie hash    : zTZa14A3pDxcfHm3E+Hbqw==
> - current node cookie hash: zTZa14A3pDxcfHm3E+Hbqw==

I see these are the same, so that is not the problem.


From max at haventon.se  Fri Sep  2 16:11:30 2011
From: max at haventon.se (max at haventon.se)
Date: Fri, 2 Sep 2011 15:11:30 +0000
Subject: [rabbitmq-discuss] Unable to manage Service after log off
In-Reply-To: <4E60D617.3020308@rabbitmq.com>
References: <DF08B645FD232746AA7806A1B7F3CC0F03B47F13@CH1PRD0102MB133.prod.exchangelabs.com>
	<4E60B910.4080302@rabbitmq.com>
	<DF08B645FD232746AA7806A1B7F3CC0F03B47FE0@CH1PRD0102MB133.prod.exchangelabs.com>
	<4E60D617.3020308@rabbitmq.com>
Message-ID: <DF08B645FD232746AA7806A1B7F3CC0F03B4BA2E@SN2PRD0102MB141.prod.exchangelabs.com>

A full reinstallation seems to have solved this.

Still not sure what was going on, but the service console output was good to learn.

Thanks Emile


From iain.hull at workday.com  Fri Sep  2 16:14:17 2011
From: iain.hull at workday.com (Iain Hull)
Date: Fri, 2 Sep 2011 10:14:17 -0500
Subject: [rabbitmq-discuss] When are persistent messages flushed to disk?
Message-ID: <925DDDE9D69E7143B3252E2D4680A36703A75BD5@34093-C5-EVS1.exchange.rackspace.com>

Hi,

I know that this is a very difficult question to answer, but under my
current testing scenario I am losing most of my messages.

I have a simple test that pushes 1,000,000 messages to the broker as
fast as possible.  Once this is finished I kill the broker.  

* When the messages are small < 100 bytes only 250,000 of the message
survive.  I can see in the Web console the number of messages in the
queue raises very slowly compared to the rate the client sends new
messages.
* When the message is larger = 1Kb all or most of the messages are
persisted.  I can see in the Web console the number of messages in the
queue closely matches the number of messages the client has sent.

I know that my test is a little unrealistic but we are planning to use
RabbitMQ to smooth out bursts of activity on our ESB caused by batch
updates, I expect most messages to arrive in large bursts and be less
than 1 kb.  I am trying to understand the nature of the window where
persistent messages could be lost.  

* Is it time based? flushed to disk every n milliseconds.
* Is it memory based? Flushed after a buffer of a certain size is
filled.  (Our messages will be small < 1k)
* Does the rate that messages arrive change the window?
* Is most of the buffering at the socket level or in side RabbitMQ?

This part of our system is best effort delivery, so we can accept some
message lose, if we can quantify the lose if/when it happens and
understand its nature like when messages could be lost and how many
could be affected.  Also are there any parameters to tune this behavior?

Sorry if this question has been answered already, I have looked through
the mailing list for the past few years and didn't see all the details I
am looking for.

Regards,
Iain.

From billg at nffs.com  Fri Sep  2 16:14:17 2011
From: billg at nffs.com (Bill Gerrard)
Date: Fri, 02 Sep 2011 09:14:17 -0600
Subject: [rabbitmq-discuss] Issue: user is able to publish to queue that he
 does not have write permission to
Message-ID: <4E60F2C9.3030800@nffs.com>

Testing permissions and discovered user is able to publish to queue that 
he does not have write permission to.

Can anyone else duplicate?  If so, is this fixed on 2.6.0?

Running RabbitMQ 2.5.1 on debian

Permissions on /:
user    configure    write                read
nf    .*    ^nf_to_da.*|amq\\.default|test_.*    ^da_to_nf.*|test_.*

testing as user nf:
1) publish to nf_to_da queue -> publish successful (correct)
2) read from da_to_nf queue -> read successful (correct)
3) publish to da_to_nf queue -> publish successful! (should be denied) <====
4) read from nf_to_da queue -> read denied (correct)


Client is written in perl using Net::RabbitMQ (same results when using 
python examples from tutorial)
Logged in as user 'nf'
publish to nf_to_da
...success
publish to da_to_nf (should fail)
...success
consume from da_to_nf
...success
consume from nf_to_da (should fail)
Get failure for queue 'nf_to_da': Consume queue: server channel error 
403, message: ACCESS_REFUSED - access to queue 'nf_to_da' in vhost '/' 
refused for user 'nf'



Log from RabbitMQ message broker:

=INFO REPORT==== 2-Sep-2011::09:01:58 ===
accepted TCP connection on [::]:5672 from 10.1.0.27:43796

=INFO REPORT==== 2-Sep-2011::09:01:58 ===
starting TCP connection <0.11704.25> from 10.1.0.27:43796

=INFO REPORT==== 2-Sep-2011::09:01:58 ===
closing TCP connection <0.11704.25> from 10.1.0.27:43796


=INFO REPORT==== 2-Sep-2011::09:01:58 ===
accepted TCP connection on [::]:5672 from 10.1.0.27:43797

=INFO REPORT==== 2-Sep-2011::09:01:58 ===
starting TCP connection <0.11711.25> from 10.1.0.27:43797

=INFO REPORT==== 2-Sep-2011::09:01:58 ===
closing TCP connection <0.11711.25> from 10.1.0.27:43797


=INFO REPORT==== 2-Sep-2011::09:01:58 ===
accepted TCP connection on [::]:5672 from 10.1.0.27:43798

=INFO REPORT==== 2-Sep-2011::09:01:58 ===
starting TCP connection <0.11719.25> from 10.1.0.27:43798

=INFO REPORT==== 2-Sep-2011::09:01:58 ===
closing TCP connection <0.11719.25> from 10.1.0.27:43798


=INFO REPORT==== 2-Sep-2011::09:01:58 ===
accepted TCP connection on [::]:5672 from 10.1.0.27:43799

=INFO REPORT==== 2-Sep-2011::09:01:58 ===
starting TCP connection <0.11733.25> from 10.1.0.27:43799

=ERROR REPORT==== 2-Sep-2011::09:01:58 ===
connection <0.11733.25>, channel 1 - error:
{amqp_error,access_refused,
             "access to queue 'nf_to_da' in vhost '/' refused for user 
'nf'",
             'basic.consume'}

=INFO REPORT==== 2-Sep-2011::09:01:58 ===
closing TCP connection <0.11733.25> from 10.1.0.27:43799


From emile at rabbitmq.com  Fri Sep  2 16:22:32 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 02 Sep 2011 16:22:32 +0100
Subject: [rabbitmq-discuss] Unable to manage Service after log off
In-Reply-To: <DF08B645FD232746AA7806A1B7F3CC0F03B4A1F9@SN2PRD0102MB141.prod.exchangelabs.com>
References: <DF08B645FD232746AA7806A1B7F3CC0F03B47F13@CH1PRD0102MB133.prod.exchangelabs.com>
	<4E60B910.4080302@rabbitmq.com>
	<DF08B645FD232746AA7806A1B7F3CC0F03B47FE0@CH1PRD0102MB133.prod.exchangelabs.com>
	<4E60D617.3020308@rabbitmq.com>
	<DF08B645FD232746AA7806A1B7F3CC0F03B4A1F9@SN2PRD0102MB141.prod.exchangelabs.com>
Message-ID: <4E60F4B8.8030408@rabbitmq.com>

On 02/09/11 15:21, max at haventon.se wrote:
> Hi,
> 
> That's what's so strange. The Service *is* running. It's receiving
> messages constantly after I log out. Everything works except "Erlang
> based management access" (rabbitmqctl / werl -remsh rabbit at HOST). I
> have several Shovels connected to the node, and they keep shoveling.

Something else to check is whether the epmd.exe process runs before and
after logging out. What does "epmd -names" return?

> I've reproduced this on one Windows Server 2008 R2 SP1 and one
> Windows Server 2003.
> 
> The Service log file doesn't change at all when logging out.

Do the rabbit logs contain any entries either at the time you log out or
at the time you unsuccessfully attempt to query the broker status?


-Emile

From matthew at rabbitmq.com  Fri Sep  2 16:25:39 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 2 Sep 2011 16:25:39 +0100
Subject: [rabbitmq-discuss] When are persistent messages flushed to disk?
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A36703A75BD5@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A36703A75BD5@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <20110902152537.GB9658@rabbitmq.com>

Hi Iain,

On Fri, Sep 02, 2011 at 10:14:17AM -0500, Iain Hull wrote:
> I have a simple test that pushes 1,000,000 messages to the broker as
> fast as possible.  Once this is finished I kill the broker.  
> 
> * When the messages are small < 100 bytes only 250,000 of the message
> survive.  I can see in the Web console the number of messages in the
> queue raises very slowly compared to the rate the client sends new
> messages.
> * When the message is larger = 1Kb all or most of the messages are
> persisted.  I can see in the Web console the number of messages in the
> queue closely matches the number of messages the client has sent.
> 
> I know that my test is a little unrealistic but we are planning to use
> RabbitMQ to smooth out bursts of activity on our ESB caused by batch
> updates, I expect most messages to arrive in large bursts and be less
> than 1 kb.  I am trying to understand the nature of the window where
> persistent messages could be lost.  

If you are not using publisher confirms, then you have no way of telling
whether the packets have even reached the broker, yet alone the broker
having done anything about those messages. Many of those messages might
even still be in the TCP stack on the client's OS.

> * Is it time based? flushed to disk every n milliseconds.
> * Is it memory based? Flushed after a buffer of a certain size is
> filled.  (Our messages will be small < 1k)
> * Does the rate that messages arrive change the window?
> * Is most of the buffering at the socket level or in side RabbitMQ?

The answer to nearly all of those is "yes".

Rabbit will request some TCP buffers. From time to time when it runs out
of memory and is waiting disks to catch up, it'll stop draining those
buffers in order to halt producers.

In order to avoid doing lots of tiny little writes, we do a lot of
buffering internally so as to be able to drive hard disks as fast as
possible.

We also have timers to make sure that once a message has reached a
queue, it'll be written and fsync'd to disk promptly. That said, a queue
can only go so fast, and so messages can back up as they're passed
between processes within Rabbit.

All of which is essentially why we introduced publisher confirms (well,
that, plus the fact that transactions are almost never what you actually
want - think of publisher confirms as being there to solve the fact you
can't pipeline transactions). Thus I'd recommend you read
http://www.rabbitmq.com/extensions.html#confirms and use them, and
architect your clients such that they understand that until they receive
confirmation from the broker that the broker has taken responsibility
for the message (which in the case of a persistent msg sent to durable
queues (normally) means the msg has been fsync'd to disk), the
publishing client is still responsible for the message and should be
prepared to republish the message should its connection to the broker
fail before it receives the confirm.

Now of course, the confirm could be lost in mid-flight, and you'll then
get duplicates, but there are almost always ways of getting duplicates -
you normally have to choose between "at least once" and "at most once"
delivery - "exactly once" is normally unobtainable except in very
restricted circumstances. So that means you may have to make sure your
clients are doing idempotent operations or at least can detect
duplicates etc etc, but that's all standard stuff.

Hope that's of help,

Matthew

From oleksandr.petrov at gmail.com  Fri Sep  2 16:50:21 2011
From: oleksandr.petrov at gmail.com (Alex P)
Date: Fri, 2 Sep 2011 08:50:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Librabbitmq-c API
In-Reply-To: <yrv4ck49rnpth.fsf@dwragg.eng.vmware.com>
References: <4e1d3ad5-70fa-4f93-80aa-1ee4f214a9c8@fd21g2000vbb.googlegroups.com>
	<yrv4ck49rnpth.fsf@dwragg.eng.vmware.com>
Message-ID: <15649415.532.1314978621491.JavaMail.geo-discussion-forums@yqmv39>

Thank you David.

Actually, that was exactly what we ended up doing, 

As far as I understood, that even though Librabbitmq is event-driven, it 
doesn't mean it's non-blocking, right?
For instance, wait_frame_inner is blocking until we recv() is responding 
with something useful. 

Are there ways to work it around? We actually need some non-blocking 
approach, since we want to be able to send heartbeats and do many other 
things in same thread, while we have no data available. 

Actually, just changing that function would change many things. As far as I 
can tell, Send() calls are currently blocking as well, even though they're 
unlikely to block cycle for long time.

Should we just use several threads and create a connection per thread, or 
there are better approaches that were built into the lib? 

Thanks for the help, again.
It seems that something is causing basic_get to eat out memory when ran in 
cycle. If i manage to reproduce it without app itself and have more info, 
i'll file a bug-report. For now it may very well be my mistake(  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110902/2e6298f4/attachment.htm>

From oleksandr.petrov at gmail.com  Fri Sep  2 17:43:00 2011
From: oleksandr.petrov at gmail.com (Alex P)
Date: Fri, 2 Sep 2011 09:43:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Librabbitmq-c API
In-Reply-To: <15649415.532.1314978621491.JavaMail.geo-discussion-forums@yqmv39>
References: <4e1d3ad5-70fa-4f93-80aa-1ee4f214a9c8@fd21g2000vbb.googlegroups.com>
	<yrv4ck49rnpth.fsf@dwragg.eng.vmware.com>
	<15649415.532.1314978621491.JavaMail.geo-discussion-forums@yqmv39>
Message-ID: <10486128.807.1314981781171.JavaMail.geo-discussion-forums@yqic37>

Actually, seems that there are ways to do so..

I tried using non-blocking recv and then setting buffer limits, but that may 
have side effects because of framing and other things, that'd be very bad.

Another thing, it's still possible to use select(2) on socket in order to 
receive it's status, and allow or disallow starting 
amqp_simple_wait_frame(conn, &frame). 

Do you think that may have potential downsides?

Thank you! 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110902/367d507d/attachment.htm>

From oleksandr.petrov at gmail.com  Fri Sep  2 17:59:16 2011
From: oleksandr.petrov at gmail.com (Alex P)
Date: Fri, 2 Sep 2011 09:59:16 -0700 (PDT)
Subject: [rabbitmq-discuss] Librabbitmq-c API
In-Reply-To: <10486128.807.1314981781171.JavaMail.geo-discussion-forums@yqic37>
References: <4e1d3ad5-70fa-4f93-80aa-1ee4f214a9c8@fd21g2000vbb.googlegroups.com>
	<yrv4ck49rnpth.fsf@dwragg.eng.vmware.com>
	<15649415.532.1314978621491.JavaMail.geo-discussion-forums@yqmv39>
	<10486128.807.1314981781171.JavaMail.geo-discussion-forums@yqic37>
Message-ID: <31632177.222.1314982756123.JavaMail.geo-discussion-forums@yqgc10>

Sorry for spamming, 

Just another thought, it'd be possible and very easy to create a 
method amqp_data_available that would tell us whether there's something on 
the socket before entering blocking call. This way it'll be possible to wait 
not inside of recv but inside of main loop, but i'm not sure how it would 
fit into the overall idea.

I sketched it, maybe you would find anything useful there.  
https://gist.github.com/1189157

Thanks again!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110902/5093f1e1/attachment.htm>

From bknowles at ihiji.com  Fri Sep  2 18:41:50 2011
From: bknowles at ihiji.com (Brad Knowles)
Date: Fri, 2 Sep 2011 12:41:50 -0500
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
Message-ID: <153C58A9-D471-4D2D-A3A2-36F6505D2B6E@ihiji.com>

Folks,

I ran across the thread about a month ago, including the message at <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-July/014246.html>, and I had some questions about where this has issue has gone since.  I've read the documentation on mirrored queues (<http://www.rabbitmq.com/ha.html>) and on the active/passive failover solution (<http://www.rabbitmq.com/pacemaker.html>), and I was hoping that there might be a third option available?

If you want to talk about mirroring queues across sets of servers, then it would seem to me that for scalability purposes, you should be able to easily stripe across those mirrors.  In Rabbit parlance, that would seem to be a simple round-robin exchange that distributes incoming queues to be created among one or more mirroring exchanges.

Mirroring and then striping the mirrors seems to be an obvious solution to this problem.  So, what am I missing?  Is there other documentation that I have not yet read?  Any pointers or discussion that you can provide would be greatly appreciated.

Thanks!

-- 
Brad Knowles <bknowles at ihiji.com>


From alexis at rabbitmq.com  Fri Sep  2 19:11:49 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 2 Sep 2011 11:11:49 -0700
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <153C58A9-D471-4D2D-A3A2-36F6505D2B6E@ihiji.com>
References: <153C58A9-D471-4D2D-A3A2-36F6505D2B6E@ihiji.com>
Message-ID: <CACOPnvfU4F4D8edaUxCH37jTG8ANW=nLZ4VW_USvEz9Ye4du9w@mail.gmail.com>

Brad

The idea of a round robin exchange has come up several times.  There
are use cases for it and it would not (I am told..) be much work to
write a basic one.  But - do you need it for your case?  Why can't you
stripe by routing key?  And then use mirrored queues off the back of
that to make the partitions HA.

alexis


On Fri, Sep 2, 2011 at 10:41 AM, Brad Knowles <bknowles at ihiji.com> wrote:
> Folks,
>
> I ran across the thread about a month ago, including the message at <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-July/014246.html>, and I had some questions about where this has issue has gone since. ?I've read the documentation on mirrored queues (<http://www.rabbitmq.com/ha.html>) and on the active/passive failover solution (<http://www.rabbitmq.com/pacemaker.html>), and I was hoping that there might be a third option available?
>
> If you want to talk about mirroring queues across sets of servers, then it would seem to me that for scalability purposes, you should be able to easily stripe across those mirrors. ?In Rabbit parlance, that would seem to be a simple round-robin exchange that distributes incoming queues to be created among one or more mirroring exchanges.
>
> Mirroring and then striping the mirrors seems to be an obvious solution to this problem. ?So, what am I missing? ?Is there other documentation that I have not yet read? ?Any pointers or discussion that you can provide would be greatly appreciated.
>
> Thanks!
>
> --
> Brad Knowles <bknowles at ihiji.com>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From bknowles at ihiji.com  Fri Sep  2 19:15:21 2011
From: bknowles at ihiji.com (Brad Knowles)
Date: Fri, 2 Sep 2011 13:15:21 -0500
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <CACOPnvfU4F4D8edaUxCH37jTG8ANW=nLZ4VW_USvEz9Ye4du9w@mail.gmail.com>
References: <153C58A9-D471-4D2D-A3A2-36F6505D2B6E@ihiji.com>
	<CACOPnvfU4F4D8edaUxCH37jTG8ANW=nLZ4VW_USvEz9Ye4du9w@mail.gmail.com>
Message-ID: <F9495D34-6362-4FCA-9A51-E71689F6AA19@ihiji.com>

On Sep 2, 2011, at 1:11 PM, Alexis Richardson wrote:

> The idea of a round robin exchange has come up several times.  There
> are use cases for it and it would not (I am told..) be much work to
> write a basic one.  But - do you need it for your case?  Why can't you
> stripe by routing key?  And then use mirrored queues off the back of
> that to make the partitions HA.

The thing I don't like about what I've read so far about mirrored queues is that they have to be known by the software at creation time, which means that we need to embed into our code knowledge of our system infrastructure.  But as we scale up, that system infrastructure is going to change.  I don't want to have to go back and keep changing the code to match whatever the latest system infrastructure is.

If I could just create a new mirrored fan-out exchange and then link that into an existing round-robin exchange (or something comparable), then as I bring up more machines I can make those infrastructure changes without our developers having to know any of the operational details of what our current configuration looks like at any point in time.

-- 
Brad Knowles <bknowles at ihiji.com>


From alexis at rabbitmq.com  Fri Sep  2 19:23:18 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 2 Sep 2011 11:23:18 -0700
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <F9495D34-6362-4FCA-9A51-E71689F6AA19@ihiji.com>
References: <153C58A9-D471-4D2D-A3A2-36F6505D2B6E@ihiji.com>
	<CACOPnvfU4F4D8edaUxCH37jTG8ANW=nLZ4VW_USvEz9Ye4du9w@mail.gmail.com>
	<F9495D34-6362-4FCA-9A51-E71689F6AA19@ihiji.com>
Message-ID: <CACOPnvcPcM-PW=Wrj_Rn+V2YMbmELpsF8ORyLW99sCn_ZEaOAw@mail.gmail.com>

Brad

Are you saying that mirror-queue management should be exposed
differently?  If so it might be worth commenting on the thread this
week where Jason and Matthew and Michael talk about that.

That aside, I would urge you to write a round robin exchange ;-)

alexis

On Fri, Sep 2, 2011 at 11:15 AM, Brad Knowles <bknowles at ihiji.com> wrote:
> On Sep 2, 2011, at 1:11 PM, Alexis Richardson wrote:
>
>> The idea of a round robin exchange has come up several times. ?There
>> are use cases for it and it would not (I am told..) be much work to
>> write a basic one. ?But - do you need it for your case? ?Why can't you
>> stripe by routing key? ?And then use mirrored queues off the back of
>> that to make the partitions HA.
>
> The thing I don't like about what I've read so far about mirrored queues is that they have to be known by the software at creation time, which means that we need to embed into our code knowledge of our system infrastructure. ?But as we scale up, that system infrastructure is going to change. ?I don't want to have to go back and keep changing the code to match whatever the latest system infrastructure is.
>
> If I could just create a new mirrored fan-out exchange and then link that into an existing round-robin exchange (or something comparable), then as I bring up more machines I can make those infrastructure changes without our developers having to know any of the operational details of what our current configuration looks like at any point in time.
>
> --
> Brad Knowles <bknowles at ihiji.com>
>
>

From bknowles at ihiji.com  Fri Sep  2 19:29:15 2011
From: bknowles at ihiji.com (Brad Knowles)
Date: Fri, 2 Sep 2011 13:29:15 -0500
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <CACOPnvcPcM-PW=Wrj_Rn+V2YMbmELpsF8ORyLW99sCn_ZEaOAw@mail.gmail.com>
References: <153C58A9-D471-4D2D-A3A2-36F6505D2B6E@ihiji.com>
	<CACOPnvfU4F4D8edaUxCH37jTG8ANW=nLZ4VW_USvEz9Ye4du9w@mail.gmail.com>
	<F9495D34-6362-4FCA-9A51-E71689F6AA19@ihiji.com>
	<CACOPnvcPcM-PW=Wrj_Rn+V2YMbmELpsF8ORyLW99sCn_ZEaOAw@mail.gmail.com>
Message-ID: <7E6BFF53-9AA9-4B02-9283-6FB4663478EB@ihiji.com>

On Sep 2, 2011, at 1:23 PM, Alexis Richardson wrote:

> Are you saying that mirror-queue management should be exposed
> differently?  If so it might be worth commenting on the thread this
> week where Jason and Matthew and Michael talk about that.

Well, according to the documentation at <http://www.rabbitmq.com/ha.html>, mirrored queues have to be created explicitly within the code:

> Creating a mirrored-queue
> 
> A mirrored-queue must be created as a mirrored-queue. It is not possible to convert a non-mirrored-queue to a mirrored-queue at some later point. It is perfectly acceptable to create a mirrored-queue with no slaves initially, though be aware of the behaviour of adding nodes to a cluster.
> 
> To create a mirrored-queue, you provide an x-ha-policy entry in the argument table presented to queue.declare. The value of this entry is a long string which gives the name of the policy you wish to use for this queue. There are currently two policies available:        
> 
> 	? all: This policy ensures that a mirror of the queue will exist on every node in the cluster. When a new node joins the cluster, a mirror of the queue will be created on the new node. The queue's initial master will be on the node to which the client issuing the queue declare is connected.
> 	? nodes: This policy allows you to specify the exact nodes on which you wish mirrors to exist. To do this, you provide an additional entry in the arguments table, with a key of x-ha-policy-params, and a value which is an array of long strings, each of which is a node name. The queue's initial master will be the first node in the list (and thus this node must exist and be reachable, even if it is not the node to which the client is connected), and slaves are created on the remaining nodes in the list. With this policy, you may declare a mirrored-queue with mirrors on a subset of the nodes in a cluster. You may also declare a mirrored-queue with slaves on nodes which are not currently members of the cluster: when such nodes join the cluster, a slave will automatically be created of the queue on that node. Note however that the mirror on the newly joined node will behave as a new slave. Also note that it is the node-names that must be provided, not host-name or IP address. It is an error to supply an empty array as the value of the x-ha-policy-params entry: the array must contain at least one element.

Personally, I don't want my programmers to have to know anything about the underlying implementation of how HA is provided, all they need to know is that I'm making sure that it's there.  The pacemaker solution is a bit of a kludgey way to do that, IMO.  And I definitely want our failover to be active/active and not active/passive.

If you can point me at the appropriate thread, I will definitely try to make some suitable comments over there.  Thanks!

> That aside, I would urge you to write a round robin exchange ;-)

In the DevOps field, I'm much more of an Ops type than a Dev type.  I can hope to understand some of the underlying infrastructure concepts and how things are logically put together, but I don't hold out much hope that I'll be able to write actual code to do that.

-- 
Brad Knowles <bknowles at ihiji.com>


From alexis at rabbitmq.com  Fri Sep  2 19:35:26 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 2 Sep 2011 11:35:26 -0700
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <7E6BFF53-9AA9-4B02-9283-6FB4663478EB@ihiji.com>
References: <153C58A9-D471-4D2D-A3A2-36F6505D2B6E@ihiji.com>
	<CACOPnvfU4F4D8edaUxCH37jTG8ANW=nLZ4VW_USvEz9Ye4du9w@mail.gmail.com>
	<F9495D34-6362-4FCA-9A51-E71689F6AA19@ihiji.com>
	<CACOPnvcPcM-PW=Wrj_Rn+V2YMbmELpsF8ORyLW99sCn_ZEaOAw@mail.gmail.com>
	<7E6BFF53-9AA9-4B02-9283-6FB4663478EB@ihiji.com>
Message-ID: <CACOPnvf4COMjvKRbDKQ8jWe-zCrAryG1SnvostLu1TRu2Bdgtw@mail.gmail.com>

Brad

On Fri, Sep 2, 2011 at 11:29 AM, Brad Knowles <bknowles at ihiji.com> wrote:
> Personally, I don't want my programmers to have to know anything about the underlying implementation of how HA is provided, all they need to know is that I'm making sure that it's there. ?The pacemaker solution is a bit of a kludgey way to do that, IMO. ?And I definitely want our failover to be active/active and not active/passive.

Right.

> If you can point me at the appropriate thread, I will definitely try to make some suitable comments over there. ?Thanks!

The nub starts here:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/014808.html


>> That aside, I would urge you to write a round robin exchange ;-)
>
> In the DevOps field, I'm much more of an Ops type than a Dev type. ?I can hope to understand some of the underlying infrastructure concepts and how things are logically put together, but I don't hold out much hope that I'll be able to write actual code to do that.

Understood.  If the above thread is not suggestive of a better line of
attack, please do articulate your requirements here ;-)

a

From bknowles at ihiji.com  Fri Sep  2 19:45:12 2011
From: bknowles at ihiji.com (Brad Knowles)
Date: Fri, 2 Sep 2011 13:45:12 -0500
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <CACOPnvf4COMjvKRbDKQ8jWe-zCrAryG1SnvostLu1TRu2Bdgtw@mail.gmail.com>
References: <153C58A9-D471-4D2D-A3A2-36F6505D2B6E@ihiji.com>
	<CACOPnvfU4F4D8edaUxCH37jTG8ANW=nLZ4VW_USvEz9Ye4du9w@mail.gmail.com>
	<F9495D34-6362-4FCA-9A51-E71689F6AA19@ihiji.com>
	<CACOPnvcPcM-PW=Wrj_Rn+V2YMbmELpsF8ORyLW99sCn_ZEaOAw@mail.gmail.com>
	<7E6BFF53-9AA9-4B02-9283-6FB4663478EB@ihiji.com>
	<CACOPnvf4COMjvKRbDKQ8jWe-zCrAryG1SnvostLu1TRu2Bdgtw@mail.gmail.com>
Message-ID: <9ADA6926-B649-47BF-8EF3-DEAC5E68B2C0@ihiji.com>

On Sep 2, 2011, at 1:35 PM, Alexis Richardson wrote:

>> If you can point me at the appropriate thread, I will definitely try to make some suitable comments over there.  Thanks!
> 
> The nub starts here:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/014808.html

On further reading, I'm not sure I can add anything to what has already been said by Jason J. W. Williams at <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/014830.html>.  Would a "+1" really make a difference there?

> Understood.  If the above thread is not suggestive of a better line of
> attack, please do articulate your requirements here ;-)

Having read Jason's comments, I'm not sure I can add anything more to this discussion that would be useful.

-- 
Brad Knowles <bknowles at ihiji.com>


From alexis at rabbitmq.com  Fri Sep  2 19:53:33 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 2 Sep 2011 11:53:33 -0700
Subject: [rabbitmq-discuss] rabbitmq-ha-test setup
In-Reply-To: <9ADA6926-B649-47BF-8EF3-DEAC5E68B2C0@ihiji.com>
References: <153C58A9-D471-4D2D-A3A2-36F6505D2B6E@ihiji.com>
	<CACOPnvfU4F4D8edaUxCH37jTG8ANW=nLZ4VW_USvEz9Ye4du9w@mail.gmail.com>
	<F9495D34-6362-4FCA-9A51-E71689F6AA19@ihiji.com>
	<CACOPnvcPcM-PW=Wrj_Rn+V2YMbmELpsF8ORyLW99sCn_ZEaOAw@mail.gmail.com>
	<7E6BFF53-9AA9-4B02-9283-6FB4663478EB@ihiji.com>
	<CACOPnvf4COMjvKRbDKQ8jWe-zCrAryG1SnvostLu1TRu2Bdgtw@mail.gmail.com>
	<9ADA6926-B649-47BF-8EF3-DEAC5E68B2C0@ihiji.com>
Message-ID: <CACOPnvctrDmmQ8kVkgxouc6oqYWTc_eGK5jKnrYUPOVmn0s5Kg@mail.gmail.com>

On Fri, Sep 2, 2011 at 11:45 AM, Brad Knowles <bknowles at ihiji.com> wrote:
>?Would a "+1" really make a difference there?

Yes, it's noted.

From david at rabbitmq.com  Fri Sep  2 22:37:41 2011
From: david at rabbitmq.com (David Wragg)
Date: Fri, 02 Sep 2011 22:37:41 +0100
Subject: [rabbitmq-discuss] Librabbitmq-c API
In-Reply-To: <15649415.532.1314978621491.JavaMail.geo-discussion-forums@yqmv39>
	(Alex P.'s message of "Fri, 2 Sep 2011 08:50:21 -0700 (PDT)")
References: <4e1d3ad5-70fa-4f93-80aa-1ee4f214a9c8@fd21g2000vbb.googlegroups.com>
	<yrv4ck49rnpth.fsf@dwragg.eng.vmware.com>
	<15649415.532.1314978621491.JavaMail.geo-discussion-forums@yqmv39>
Message-ID: <yrv4c8vq67hi2.fsf@dwragg.eng.vmware.com>

Alex P <oleksandr.petrov at gmail.com> writes:
> As far as I understood, that even though Librabbitmq is event-driven, it
> doesn't mean it's non-blocking, right?

Correct.  librabbitmq does not really support non-blocking use.

> For instance, wait_frame_inner is blocking until we recv() is responding
> with something useful.
>
> Are there ways to work it around? We actually need some non-blocking
> approach, since we want to be able to send heartbeats and do many other
> things in same thread, while we have no data available.
>
> Actually, just changing that function would change many things. As far as I
> can tell, Send() calls are currently blocking as well, even though they're
> unlikely to block cycle for long time.
>
> Should we just use several threads and create a connection per thread, or
> there are better approaches that were built into the lib?

It's better to use threads that to try to persuade librabbitmq to do
non-blocking operation.

> Thanks for the help, again.
> It seems that something is causing basic_get to eat out memory when ran in
> cycle. If i manage to reproduce it without app itself and have more info,
> i'll file a bug-report. For now it may very well be my mistake(

Make sure you call amqp_maybe_release_buffers when you are finished with
each message, as shown at
<https://github.com/rabbitmq/rabbitmq-c/blob/master/tools/consume.c#L149>.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From matthias at rabbitmq.com  Sat Sep  3 05:07:55 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 03 Sep 2011 05:07:55 +0100
Subject: [rabbitmq-discuss] Cluster Disk Node vs Ram Node explanation
In-Reply-To: <CA8274F8.EBE9%rparra@homeaway.com>
References: <CA8274F8.EBE9%rparra@homeaway.com>
Message-ID: <4E61A81B.7020100@rabbitmq.com>

Rene,

On 30/08/11 17:07, Rene Parra wrote:
> GIVEN:
>     * A load balanced cluster consisting of disk node A, ram node B, and
>       ram node C
>
> WHEN:
>     * A client is routed to ram node B via the load balancer,
>     * AND the client declares a *durable* *queue *on its connection to
>       ram node B,
>     * AND the client declares bindings to a topic exchange being
>       serviced by a producer connected on ram node C;
>
> WHERE are the messages stored?

The messages are stored on the node on which the queue resides / was 
declared. i.e. B.

> WHAT happens to the producer on ram node C when ram node B fails? (Does
> it block? Do messages continue to be delivered? Are messages to the
> client lost?)

The broker will behave as if the queues on B (and their bindings) didn't 
exist (*). So in your example, assuming there are no bindings to queues 
on surviving nodes, any new messages published will be lost. Setting the 
'mandatory' flag on publish will (asynchronously) inform the publisher 
when that happens.

Messages that made it into the queues and were persisted to disk on B 
before the failure are retained and become available again when B recovers.

(*) except it will prevent redeclaration of any durable queue with the 
same name, since that would prevent subsequent recovery of the original 
queue.

> However, I just finished a soak test where my durable queue on ram node
> B lost messages over the weekend due to a network hiccup that crashed
> ram node B. When it came back up again messages were lost. As such, we
> are recommending our production configuration to be unclustered, disk
> node only until we better understand the benefits and use cases
> associated with clustering with RabbitMQ 2.5.1

Until the introduction of HA in the recent 2.6.0 release, clustering was 
predominantly a scalability feature.

> A simple tutorial or explanation of ?To Disk Node or To Ram Node... that
> is the question? would be great and useful for those of us implementing,
> learning and teaching rabbit to our organizations.

 From http://www.rabbitmq.com/clustering.html#clustering
<quote>
A node can be a RAM node or a disk node. RAM nodes keep their state only 
in memory (with the exception of the persistent contents of durable 
queues which are still stored safely on disc). Disk nodes keep state in 
memory and on disk. As RAM nodes don't have to write to disk as much as 
disk nodes, they can perform better. Because state is replicated across 
all nodes in the cluster, it is sufficient to have just one disk node 
within a cluster, to store the state of the cluster safely. Beware, 
however, that RabbitMQ will not stop you from creating a cluster with 
only RAM nodes. Should you do this, and suffer a power failure to the 
entire cluster, the entire state of the cluster, including all messages, 
will be lost.
</quote>


Matthias.

From matthias at rabbitmq.com  Sat Sep  3 05:25:09 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 03 Sep 2011 05:25:09 +0100
Subject: [rabbitmq-discuss] HA policies [was: RabbitMQ 2.6.0 is released]
In-Reply-To: <CAHZAEpfai2AXv-dogR52CgOfSh4NYVPxgZ9+y6w=pCVsZ8EA5Q@mail.gmail.com>
References: <4E5E35C5.1050204@rabbitmq.com>	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>	<4E5EA5C9.3020708@rabbitmq.com>	<CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>	<20110831214824.GA30087@wellquite.org>	<CAHZAEpeNWAXruHuKykOq2gh5HYn=r-ruGXm1dAtXcoAUY3QP5A@mail.gmail.com>	<4E5EC932.6060402@rabbitmq.com>	<20110901080608.GB18474@wellquite.org>
	<CAHZAEpfai2AXv-dogR52CgOfSh4NYVPxgZ9+y6w=pCVsZ8EA5Q@mail.gmail.com>
Message-ID: <4E61AC25.50103@rabbitmq.com>

Jason,

On 01/09/11 19:19, Jason J. W. Williams wrote:
> It should be possible to change the particulars of
> HA/clustering/replication without having to change the clients.
> [...]

and

> To me, the rule of thumb for deciding where to control an
> HA/replication argument should be "will the arguments have to change
> if have a topology change? (e.g. remove, rename, or re-locate a
> node)"

and

> The "all nodes" setting really isn't a solution to that.

Why is that?

I would have thought that 'all' is a sensible option for the majority of
users that want HA. And it does not require argument changes when the 
topology evolves.

That's not to say more fine grained controls aren't desirable.


Matthias.

From matthias at rabbitmq.com  Sat Sep  3 06:00:52 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 03 Sep 2011 06:00:52 +0100
Subject: [rabbitmq-discuss] Issue: user is able to publish to queue that
 he does not have write permission to
In-Reply-To: <4E60F2C9.3030800@nffs.com>
References: <4E60F2C9.3030800@nffs.com>
Message-ID: <4E61B484.6020905@rabbitmq.com>

Bill,

On 02/09/11 16:14, Bill Gerrard wrote:
> Testing permissions and discovered user is able to publish to queue that
> he does not have write permission to.

Technically there is no such thing as publishing to a queue; one always 
publishes to an exchange. Though the default exchange helps create the 
illusion that one can publish to a queue.

As per http://www.rabbitmq.com/admin-guide.html#access-control, 
publishing only requires write permissions on the exchange.

Depending on what exactly you want to do, one option might be to

1) create one fanout exchange per queue, named after the queue, binding 
the queue to that exchange, and

2) prohibit write access to the default exchange, and

3) get publishers to publish to the per-queue fanout exchanges, and

4) restrict write access to the fanout exchanges in order to control who 
can "publish" to what queue


Regards,

Matthias.

From bknowles at ihiji.com  Sat Sep  3 06:05:16 2011
From: bknowles at ihiji.com (Brad Knowles)
Date: Sat, 3 Sep 2011 00:05:16 -0500
Subject: [rabbitmq-discuss] HA policies [was: RabbitMQ 2.6.0 is released]
In-Reply-To: <4E61AC25.50103@rabbitmq.com>
References: <4E5E35C5.1050204@rabbitmq.com>	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>	<4E5EA5C9.3020708@rabbitmq.com>	<CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>	<20110831214824.GA30087@wellquite.org>	<CAHZAEpeNWAXruHuKykOq2gh5HYn=r-ruGXm1dAtXcoAUY3QP5A@mail.gmail.com>	<4E5EC932.6060402@rabbitmq.com>	<20110901080608.GB18474@wellquite.org>
	<CAHZAEpfai2AXv-dogR52CgOfSh4NYVPxgZ9+y6w=pCVsZ8EA5Q@mail.gmail.com>
	<4E61AC25.50103@rabbitmq.com>
Message-ID: <E1E90FBF-78E2-4153-A1E8-AB0AE993BBA3@ihiji.com>

On Sep 2, 2011, at 11:25 PM, Matthias Radestock wrote:

>> The "all nodes" setting really isn't a solution to that.
> 
> Why is that?
> 
> I would have thought that 'all' is a sensible option for the majority of
> users that want HA. And it does not require argument changes when the topology evolves.

Mirroring the queue across all nodes means that you don't have any scalability for that queue -- you can't load-balance or round-robin or distribute the work by the routing key or anything, because all nodes will see all traffic for that queue.

Putting yourself in a roomful of mirrors with no exit doesn't actually give you hundreds or millions of more copies of yourself to do more work, just more images that all look more or less the same.

-- 
Brad Knowles <bknowles at ihiji.com>


From matthias at rabbitmq.com  Sat Sep  3 06:30:42 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 03 Sep 2011 06:30:42 +0100
Subject: [rabbitmq-discuss] HA policies
In-Reply-To: <E1E90FBF-78E2-4153-A1E8-AB0AE993BBA3@ihiji.com>
References: <4E5E35C5.1050204@rabbitmq.com>	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>	<4E5EA5C9.3020708@rabbitmq.com>	<CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>	<20110831214824.GA30087@wellquite.org>	<CAHZAEpeNWAXruHuKykOq2gh5HYn=r-ruGXm1dAtXcoAUY3QP5A@mail.gmail.com>	<4E5EC932.6060402@rabbitmq.com>	<20110901080608.GB18474@wellquite.org>
	<CAHZAEpfai2AXv-dogR52CgOfSh4NYVPxgZ9+y6w=pCVsZ8EA5Q@mail.gmail.com>
	<4E61AC25.50103@rabbitmq.com>
	<E1E90FBF-78E2-4153-A1E8-AB0AE993BBA3@ihiji.com>
Message-ID: <4E61BB82.1030504@rabbitmq.com>

Brad,

On 03/09/11 06:05, Brad Knowles wrote:
> On Sep 2, 2011, at 11:25 PM, Matthias Radestock wrote:
>>> The "all nodes" setting really isn't a solution to that.
>>
>> Why is that?
>>
>> I would have thought that 'all' is a sensible option for the
>> majority of users that want HA. And it does not require argument
>> changes when the topology evolves.
>
> Mirroring the queue across all nodes means that you don't have any
> scalability [...], because all nodes will see all traffic

Indeed, and that is one reason why more controls are desirable in some 
use cases, as I acknowledged in my previous email.

However, I suspect most users will come to HA from single instance 
setups and move to small 2-3 node clusters for the sole purpose of 
attaining HA, and not, simultaneously, for reasons of scalability.

For them the 'all' policy is (close to) ideal. And it *does* insulate 
the app from topology changes.


Matthias.

From jasonjwwilliams at gmail.com  Sat Sep  3 07:41:13 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Sat, 3 Sep 2011 00:41:13 -0600
Subject: [rabbitmq-discuss] HA policies [was: RabbitMQ 2.6.0 is released]
In-Reply-To: <4E61AC25.50103@rabbitmq.com>
References: <4E5E35C5.1050204@rabbitmq.com>
	<CAHZAEpd+4d1zzJSi2v+POq9m1EVKRmFgiZh7+zyzoXbmA6BY5A@mail.gmail.com>
	<4E5EA5C9.3020708@rabbitmq.com>
	<CAHZAEpenfBp19M_-sGMPiR5XhH5fSJvDDtuNUnNpO2ounx9JAQ@mail.gmail.com>
	<20110831214824.GA30087@wellquite.org>
	<CAHZAEpeNWAXruHuKykOq2gh5HYn=r-ruGXm1dAtXcoAUY3QP5A@mail.gmail.com>
	<4E5EC932.6060402@rabbitmq.com>
	<20110901080608.GB18474@wellquite.org>
	<CAHZAEpfai2AXv-dogR52CgOfSh4NYVPxgZ9+y6w=pCVsZ8EA5Q@mail.gmail.com>
	<4E61AC25.50103@rabbitmq.com>
Message-ID: <7232B6AE-C3A2-456F-9C9A-F3936800CAE5@gmail.com>


> Why is that?

Because it nullifies the performance gain of adding a node for any cluster count over 2 nodes. With "all" everytime I add a node, my queue gets another copy. Typically I want a maximum of 3 copies for conflict resolution in the cluster, and I want a 15 node cluster to only have 3 copies of any particular queue evenly distributed amongst the nodes. That way adding nodes gives performance in addition to HA. 

-J

From michael.s.klishin at gmail.com  Sat Sep  3 17:28:55 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 3 Sep 2011 20:28:55 +0400
Subject: [rabbitmq-discuss] Java client 2.6.0 availability from
	repo1.maven.org
Message-ID: <CAE3HoVTKBoVwArZoPSoeKtC4vyaKGNhRC7YV9Mc8xek_swE2CA@mail.gmail.com>

Hi,

It has been a few days since 2.6.0 release and looks like Java client
artifacts are still not available:
http://mvnrepository.com/artifact/com.rabbitmq/amqp-client

Is there a maven repository at rabbitmq.com that I am not aware of? Is it a
good idea to be using 2.5.1 client with 2.6.0 broker?

Thanks.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110903/1248e307/attachment.htm>

From matthias at rabbitmq.com  Sat Sep  3 18:04:52 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 03 Sep 2011 18:04:52 +0100
Subject: [rabbitmq-discuss] Java client 2.6.0 availability
	from	repo1.maven.org
In-Reply-To: <CAE3HoVTKBoVwArZoPSoeKtC4vyaKGNhRC7YV9Mc8xek_swE2CA@mail.gmail.com>
References: <CAE3HoVTKBoVwArZoPSoeKtC4vyaKGNhRC7YV9Mc8xek_swE2CA@mail.gmail.com>
Message-ID: <4E625E34.30508@rabbitmq.com>

Michael,

On 03/09/11 17:28, Michael Klishin wrote:
> It has been a few days since 2.6.0 release and looks like Java client
> artifacts are still not available:
> http://mvnrepository.com/artifact/com.rabbitmq/amqp-client
>
> Is there a maven repository at rabbitmq.com <http://rabbitmq.com> that I
> am not aware of?

See the "Maven Artifact" section at http://www.rabbitmq.com/java-client.html

> Is it a good idea to be using 2.5.1 client with 2.6.0 broker?

That is perfectly fine.


Matthias.

From michael.s.klishin at gmail.com  Sun Sep  4 14:47:05 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 4 Sep 2011 17:47:05 +0400
Subject: [rabbitmq-discuss] [announcement] amqp gem 0.8.0 final is released
Message-ID: <CAE3HoVSWbwZupBVpk4g84fKmS1t3fOC6ewwqOSBhqMgjMvrieA@mail.gmail.com>

The day has come: amqp gem 0.8.0 is released to rubygems.org after about 10
months in the making and 15 pre-release
versions: https://rubygems.org/gems/amqp/versions/0.8.0

This release is packed with features, bug fixes, documentation guides, API
usability improvements,
RabbitMQ extensions support, has solid test suite written from scratch and a
lower memory footprint & better
performance.


== Highlights

Starting with version 0.8.0, amqp gem implements AMQP 0.9.1 with most of
RabbitMQ extensions. In addition, we resolved some long standing limitations
of the library:

* Ability to register more than one consumer per queue on the same channel.
Historically AMQP:::Queue#subscribe only allowed to register one consumer.
  This is still being the case for backwards compatibility but you now can
easily instantiate AMQP::Consumers directly.
* Empty messages are now framed properly.
* amqp gem now can use logger objects instead of printing to stdout.

In addition, we have many new features like

* RabbitMQ extensions support.
* Channel- and connection-level exceptions now can be handled by defining
callbacks on individual objects and not via catch-all AMQP.error.

* Automatic recovery mode that makes it very easy to re-declare all
entities, bindings & consumers when AMQP connection recovers from
  a network outage or broker failure: it is opt-in (not opt-out) and will
make recovery significantly simpler for "the 80%" of apps.

* Channel ids are now allocated using bit set-based allocator and when
channels are closed, allocated ids are released. Applications
  that open and close channels aggressively will no longer hit connection
max channel limit.

* Broker capabilities introspection API. See
http://www.rabbitmq.com/extensions.html#capabilities.
* Support for serialization of arrays in attribute tables (for example,
message headers).

Full list of changes and improvements can be found at
http://bit.ly/amqp-gem-changelog


== Documentation improvements

Now on to my favorite feature. Starting with this release, amqp gem has
documentation guides (http://bit.ly/amqp-gem-docs) that are edited by
Chris Duncan, author of the bunny gem. The guides cover a lot of ground:
from introduction to AMQP Model and concepts to in-depth explanation of
various features related to exchanges, queues and bindings, to routing &
handling of returned messages, error handling & recovery, TLS support and
even patterns and use cases.

Not all guides are considered complete at this point but now that 0.8.0 is
out, we will have more time to work on them. Feedback on the documentation
is
very welcome.


== Backwards compatibility with 0.7.x

0.8.0 is almost completely backwards compatible with 0.7.x, although certain
parts of the library were deprecated
and the behavior of some others has changed to be more intuitive. Learn more
at http://bit.ly/amqp-gem-080-migration

One important step aside compatibility-wise is that Ruby 1.8.7-p249 (this
particular release, not including other patch levels) is no
longer supported because of a nasty bug in that release:
http://bit.ly/iONBmH.

Also, since 0.8.0 implements AMQP 0.9.1 protocol, it now requires RabbitMQ
2.0 or later. See http://bit.ly/amqp-gem-and-rabbitmq-versions to
learn more.


Get 0.8.0 today with `gem install amqp` or update version requirement in
your Gemfile to be "~> 0.8.0".

I hope your upgrade process will be painless. Have a good day.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110904/8ded4467/attachment.htm>

From iain.hull at workday.com  Mon Sep  5 08:19:22 2011
From: iain.hull at workday.com (Iain Hull)
Date: Mon, 5 Sep 2011 02:19:22 -0500
Subject: [rabbitmq-discuss] When are persistent messages flushed to disk?
In-Reply-To: <20110902152537.GB9658@rabbitmq.com>
References: <925DDDE9D69E7143B3252E2D4680A36703A75BD5@34093-C5-EVS1.exchange.rackspace.com>
	<20110902152537.GB9658@rabbitmq.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A36703A7641E@34093-C5-EVS1.exchange.rackspace.com>

Hi Matthew,

Thanks for your detailed reply.  

On 02 September 2011 16:26, Matthew Sackman wrote:
> All of which is essentially why we introduced publisher confirms
(well,
> that, plus the fact that transactions are almost never what you
actually
> want - think of publisher confirms as being there to solve the fact
you
> can't pipeline transactions). Thus I'd recommend you read
> http://www.rabbitmq.com/extensions.html#confirms and use them, and
> architect your clients such that they understand that until they
receive
> confirmation from the broker that the broker has taken responsibility
> for the message (which in the case of a persistent msg sent to durable
> queues (normally) means the msg has been fsync'd to disk), the
> publishing client is still responsible for the message and should be
> prepared to republish the message should its connection to the broker
> fail before it receives the confirm.
I did look at publisher confirms but my initial use case requires at
most once delivery, where a cluster of ESBs are reading the queue
(making only-once from at-least-once hard).  I expect future use cases
require these features as we move more message types through RabbitMQ in
the future.

I experimented with publisher confirms and noticed that messages seemed
more likely to be persisted, but seemed to trickle into the server.
That is 5 minutes after my test finished messages were still arriving to
my queue.  I have since experimented with message size, my original
messages were very small and think that I need to modify this test to
understand these affects properly.

I hope to experiment more with this and ha once our first implementation
is released.

Thanks,
Iain.


From matthew at rabbitmq.com  Mon Sep  5 11:28:30 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 5 Sep 2011 11:28:30 +0100
Subject: [rabbitmq-discuss] When are persistent messages flushed to disk?
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A36703A7641E@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A36703A75BD5@34093-C5-EVS1.exchange.rackspace.com>
	<20110902152537.GB9658@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703A7641E@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <20110905102829.GA13144@rabbitmq.com>

On Mon, Sep 05, 2011 at 02:19:22AM -0500, Iain Hull wrote:
> I experimented with publisher confirms and noticed that messages seemed
> more likely to be persisted, but seemed to trickle into the server.
> That is 5 minutes after my test finished messages were still arriving to
> my queue.  I have since experimented with message size, my original
> messages were very small and think that I need to modify this test to
> understand these affects properly.

There were some timing bugs in 2.5.1 due to some changes accidentally
being undone owing to some erroneous merges, which may have caused the
lower than expected confirm rate.

Currently, even on non-SSD, I can get over 6000 confirms per second.

Matthew

From fullergalway at gmail.com  Mon Sep  5 14:49:27 2011
From: fullergalway at gmail.com (Rob Fuller)
Date: Mon, 5 Sep 2011 14:49:27 +0100
Subject: [rabbitmq-discuss] Any rabbitmq consultants in Paris
Message-ID: <CAHi5mS+hMm8h7gdANeyd9aBLtAyM+GvnznzocBuaEFC+kXZHXw@mail.gmail.com>

Hi,

Just wondering if there are any RabbitMQ consultants in Paris.
Couldn't find any indication on the vmware site...

Looking for a company or expert there who could be contacted by large
French company for some advice/guidance re: ha configuration.

Thanks,
Rob.

From alexis at rabbitmq.com  Mon Sep  5 14:59:38 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 5 Sep 2011 14:59:38 +0100
Subject: [rabbitmq-discuss] Any rabbitmq consultants in Paris
In-Reply-To: <CAHi5mS+hMm8h7gdANeyd9aBLtAyM+GvnznzocBuaEFC+kXZHXw@mail.gmail.com>
References: <CAHi5mS+hMm8h7gdANeyd9aBLtAyM+GvnznzocBuaEFC+kXZHXw@mail.gmail.com>
Message-ID: <CACOPnvfSV94cJVu=5OmGTDF3TweQa=6yk_UekbLT_USFHBr==w@mail.gmail.com>

Rob

I have replied off list with a VMware contact.

alexis


On Mon, Sep 5, 2011 at 2:49 PM, Rob Fuller <fullergalway at gmail.com> wrote:
> Hi,
>
> Just wondering if there are any RabbitMQ consultants in Paris.
> Couldn't find any indication on the vmware site...
>
> Looking for a company or expert there who could be contacted by large
> French company for some advice/guidance re: ha configuration.
>
> Thanks,
> Rob.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthew at rabbitmq.com  Mon Sep  5 15:08:34 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 5 Sep 2011 15:08:34 +0100
Subject: [rabbitmq-discuss] A few questions about RabbitMQ and the .NET
 Client
In-Reply-To: <4E608CCB.3050001@rabbitmq.com>
References: <2E9FF226505B9647B7929A019E274D9F2B5E7EBA3A@ZIG.i20water.local>
	<4E5FBB6A.3040600@rabbitmq.com>
	<2E9FF226505B9647B7929A019E274D9F2B5E7EBA8D@ZIG.i20water.local>
	<4E608CCB.3050001@rabbitmq.com>
Message-ID: <20110905140833.GD13144@rabbitmq.com>

On Fri, Sep 02, 2011 at 08:59:07AM +0100, Matthias Radestock wrote:
> With 'all' and 'any' you get the choice of conjunction or
> disjunction, i.e. you can express "Match all these headers" or
> "Match any of these headers"
> 
> By introducing intermediate exchanges you can express conjunctions
> of disjunctions, i.e. "Match any of these headers AND match any of
> these headers AND ...".

So that looks like  --> e1 --> e2 --> e3 --> q
where each of e1 e2 and e3 are header exchanges with 'any'. But you can
also do a disjunction of conjunctions by putting them in parallel:

       /---> e1 ---\
      /             \
 --> e ----> e2 ---> e ---> q
      \             /
       \---> e3 ---/

Where both 'e's are just fanout exchanges. Then e1, e2 and e3 are header
exchanges with 'all'. And yes, Rabbit does duplication checks - even if
several of e1 e2 and e3 pass the message through, only 1 copy of each
message can arrive at q.

Exchange-to-exchange bindings really increase the power of routing logic
substantially, and help make up for some oversights of exchange types.

Matthew

From andrea.rosa at hp.com  Mon Sep  5 15:41:22 2011
From: andrea.rosa at hp.com (Andrea Rosa)
Date: Mon, 05 Sep 2011 15:41:22 +0100
Subject: [rabbitmq-discuss] running rabbitmqctl command by rabbitmq user
Message-ID: <1315233682.30139.41.camel@vicbristol6.hpl.hp.com>

Hi

I'd like to create an automatic script to run rabbitmqctl command and I
need to run that script by rabbitmq user.
I tried to test some simple commands but it doesn't work for me. For
example if I run that command I have not got any output:

su - rabbitmq /usr/lib/rabbitmq/bin/rabbitmqctl list_users

and if I run the same command with "-p" option I have got an error:

su - rabbitmq /usr/lib/rabbitmq/bin/rabbitmqctl -p vhostname list_queues

-su: /root/.bash_profile: Permission denied
{error_logger,{{2011,9,5},{15,27,13}},{error,"Error when
reading /root/.erlang.cookie: eacces"},[]}
{error_logger,{{2011,9,5},{15,27,13}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.20.0>},{registered_name,[]},{error_info,{exit,{{error,"Error when reading /root/.erlang.cookie: eacces"},[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},
{messages,[]},{links,[<0.18.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,322}],[]]}
{error_logger,{{2011,9,5},{15,27,13}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{{error,"Error when reading /root/.erlang.cookie: eacces"},[{auth,init_cookie,0},{auth,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{offender,[{pid,undefined},{name,auth},{mfa,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2011,9,5},{15,27,13}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2011,9,5},{15,27,13}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})


Is there some mistakes about sudo command?
--
Andrea


From matthew at rabbitmq.com  Mon Sep  5 15:46:26 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 5 Sep 2011 15:46:26 +0100
Subject: [rabbitmq-discuss] running rabbitmqctl command by rabbitmq user
In-Reply-To: <1315233682.30139.41.camel@vicbristol6.hpl.hp.com>
References: <1315233682.30139.41.camel@vicbristol6.hpl.hp.com>
Message-ID: <20110905144626.GE13144@rabbitmq.com>

Hi Andrea,

On Mon, Sep 05, 2011 at 03:41:22PM +0100, Andrea Rosa wrote:
> I'd like to create an automatic script to run rabbitmqctl command and I
> need to run that script by rabbitmq user.

As you can see from looking at /usr/sbin/rabbitmqctl, under linux, we
use somithng like

su rabbitmq -s /bin/sh -c "/usr/lib/rabbitmq/bin/${SCRIPT} ${CMDLINE}"

For what it's worth, we've been round the houses several times with sudo
and su, and the fact that on some platforms one will retain the
environment whilst the other doesn't etc etc. It's all a bit
platform-specific unfortunately.

I hope that helps,

Matthew


From pdezwart at rubiconproject.com  Tue Sep  6 06:05:54 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Tue, 6 Sep 2011 00:05:54 -0500
Subject: [rabbitmq-discuss] Getting auto created queue name after call to
	amqp_queue_declare
Message-ID: <CA8AF842.202F6%pdezwart@rubiconproject.com>

Hey guys,

I am trying to get the auto-generated queue name after a call to amqp_queue_declare (rabbitmq-c library) without an empty "queue" parameter.

Where can I get that info?

Thanks,
Me
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110906/74120b3d/attachment.htm>

From agrawal.shilpi95 at gmail.com  Tue Sep  6 07:13:52 2011
From: agrawal.shilpi95 at gmail.com (shilpi agrawal)
Date: Tue, 6 Sep 2011 11:43:52 +0530
Subject: [rabbitmq-discuss] Admin tool
Message-ID: <CABgWWWEfY7RhmH_Mn=Q5ZE9DoXPH=VkHahZrGLoZ9PYaj0-bXQ@mail.gmail.com>

Hi,

I want to develop an admin tool so I can see the status of any queue which i
have registered to rabbitMQ server.How can I develop this in JAVA.
I have searched a lot but I could not found any API which i can use.

Please help in this case, what other possible way I can implement.

Thanks
Shilpi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110906/dc8843f7/attachment.htm>

From matthias at rabbitmq.com  Tue Sep  6 07:19:14 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 06 Sep 2011 07:19:14 +0100
Subject: [rabbitmq-discuss] Admin tool
In-Reply-To: <CABgWWWEfY7RhmH_Mn=Q5ZE9DoXPH=VkHahZrGLoZ9PYaj0-bXQ@mail.gmail.com>
References: <CABgWWWEfY7RhmH_Mn=Q5ZE9DoXPH=VkHahZrGLoZ9PYaj0-bXQ@mail.gmail.com>
Message-ID: <4E65BB62.7010504@rabbitmq.com>

Shilpi,

On 06/09/11 07:13, shilpi agrawal wrote:
> I want to develop an admin tool so I can see the status of any queue
> which i have registered to rabbitMQ server.How can I develop this in JAVA.
> I have searched a lot but I could not found any API which i can use.
>
> Please help in this case, what other possible way I can implement.

The management plug-in (http://www.rabbitmq.com/management.html) 
provides an HTTP API with JSON payloads. See 
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_6_0/priv/www/api/index.html

Regards,

Matthias.

From jasonjwwilliams at gmail.com  Tue Sep  6 07:19:17 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Tue, 6 Sep 2011 00:19:17 -0600
Subject: [rabbitmq-discuss] Admin tool
In-Reply-To: <CABgWWWEfY7RhmH_Mn=Q5ZE9DoXPH=VkHahZrGLoZ9PYaj0-bXQ@mail.gmail.com>
References: <CABgWWWEfY7RhmH_Mn=Q5ZE9DoXPH=VkHahZrGLoZ9PYaj0-bXQ@mail.gmail.com>
Message-ID: <914F0A28-F7AA-4896-9D96-057D9F2294D5@gmail.com>

Hi Shilpi,

The REST API that comes with management plugin should give you that info. 

-J

Sent via iPhone

Is your email Premiere?

On Sep 6, 2011, at 0:13, shilpi agrawal <agrawal.shilpi95 at gmail.com> wrote:

> Hi,
> 
> I want to develop an admin tool so I can see the status of any queue which i have registered to rabbitMQ server.How can I develop this in JAVA.
> I have searched a lot but I could not found any API which i can use.
> 
> Please help in this case, what other possible way I can implement.
> 
> Thanks
> Shilpi
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From nicola.ferrante at gmail.com  Tue Sep  6 10:23:58 2011
From: nicola.ferrante at gmail.com (nikdenik)
Date: Tue, 6 Sep 2011 09:23:58 +0000 (UTC)
Subject: [rabbitmq-discuss] rabbitmq-messagepatterns
References: <BANLkTimEtE+KSQDgGpj8iy9==n-w42Z+AA@mail.gmail.com>
	<20110622102528.GC2780@rabbitmq.com>
Message-ID: <loom.20110906T112229-699@post.gmane.org>

Matthew Sackman <matthew at ...> writes:

> 
> On Mon, Jun 20, 2011 at 04:31:39PM -0500, James Carr wrote:
> > Is there a maven repository that 
I can find the rabbitmq-messagepatterns jar in?
> 
> We've not done one. I doubt anyone else has.
> 
> Matthew
> 


Oh I found it at 
https://github.com/rabbitmq/rabbitmq-java-messagepatterns

bye  bye






From david at rabbitmq.com  Tue Sep  6 11:23:33 2011
From: david at rabbitmq.com (David Wragg)
Date: Tue, 06 Sep 2011 11:23:33 +0100
Subject: [rabbitmq-discuss] Getting auto created queue name after call
	to amqp_queue_declare
In-Reply-To: <CA8AF842.202F6%pdezwart@rubiconproject.com> (Pieter de Zwart's
	message of "Tue, 6 Sep 2011 00:05:54 -0500")
References: <CA8AF842.202F6%pdezwart@rubiconproject.com>
Message-ID: <yrv4cvct6m0ka.fsf@dwragg.eng.vmware.com>

Hi Pieter,

Pieter de Zwart <pdezwart at rubiconproject.com> writes:
> I am trying to get the auto-generated queue name after a call to
> amqp_queue_declare (rabbitmq-c library) without an empty "queue"
> parameter.

See
<https://github.com/rabbitmq/rabbitmq-c/blob/c39509ffdf2f01fdac4ef95606c105e73af208cc/tools/consume.c#L96?
for an example of how to obtain the server-provided queue name.

David

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From juliette.delmedico at gmail.com  Tue Sep  6 13:21:59 2011
From: juliette.delmedico at gmail.com (Juliette)
Date: Tue, 6 Sep 2011 05:21:59 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ binding to Active Directory
Message-ID: <21054697.3454.1315311719437.JavaMail.geo-discussion-forums@yqja21>

Hi,

I want to bind RabbitMQ to Active Directory. How can I do this ?

Thanks for your help,
Juliette.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110906/d6f51070/attachment.htm>

From juliette.delmedico at gmail.com  Tue Sep  6 13:25:09 2011
From: juliette.delmedico at gmail.com (Juliette)
Date: Tue, 6 Sep 2011 05:25:09 -0700 (PDT)
Subject: [rabbitmq-discuss]  Binding RabbitMQ to Active Directory
Message-ID: <29278015.1818.1315311909807.JavaMail.geo-discussion-forums@yqgn17>

Hi,

I want to bind RabbitMQ to Active Directory. How can I do this ?

Thanks for your help,
Juliette.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110906/490788bc/attachment.htm>

From pierre-marie.padiou at morpho.com  Tue Sep  6 13:42:15 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Tue, 6 Sep 2011 14:42:15 +0200
Subject: [rabbitmq-discuss] Best practices about expiration of messages
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C50912747C449E@Y000IMRV01.rd1.rf1>

Hello,

Here is the thing :
- I've got a producer P and a consumer C.
- Pattern is request-response.

P constantly submit requests to consumers and wait for an answer for a given amount of time. Should C take longer to answer, P will consider there was a time-out and it just sends message N+1, discarding any answer related to N.

Thing is, if nothing is done, C will still process all messages it receives (and send response that will be discarded). This makes C accumulate messages in case they take an unusually long time to process.

I suppose this is a common problem. I was wondering if anyone had a best practice for this. Here are the ideas I got :
- P creates a different response queue for each message, C checks whether the response queue exists before processing a message
- Assuming P and C are time synchronized, P sends an expiration date along with each message, that C will check before doing anything

Any better idea would be appreciated,

Thanks,

Pierre-Marie
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110906/279e5d57/attachment.htm>

From majek04 at gmail.com  Tue Sep  6 13:52:31 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 6 Sep 2011 13:52:31 +0100
Subject: [rabbitmq-discuss] Best practices about expiration of messages
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C50912747C449E@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C50912747C449E@Y000IMRV01.rd1.rf1>
Message-ID: <CABzX+qw-zVCV5zaYUNPjX1FBgoCcrrswhjUJ-NhHicgjH_zKLg@mail.gmail.com>

On Tue, Sep 6, 2011 at 13:42, PADIOU Pierre-Marie (MORPHO)
<pierre-marie.padiou at morpho.com> wrote:
> Here is the thing?:
>
> - I?ve got a producer P and a consumer C.
>
> - Pattern is request-response.
>
>
>
> P constantly submit requests to consumers and wait for an answer for a given
> amount of time. Should C take longer to answer, P will consider there was a
> time-out and it just sends message N+1, discarding any answer related to N.
>
> Thing is, if nothing is done, C will still process all messages it receives
> (and send response that will be discarded). This makes C accumulate messages
> in case they take an unusually long time to process.

Have you seen RabbitMQ extension - per queue message TTL?
    http://www.rabbitmq.com/extensions.html#queue-ttl
"... controls for how long a message published to a queue can live
before it is discarded."

> I suppose this is a common problem. I was wondering if anyone had a best
> practice for this. Here are the ideas I got :
>
> - P creates a different response queue for each message, C checks whether
> the response queue exists before processing a message

Slow.

> - Assuming P and C are time synchronized, P sends an expiration date along
> with each message, that C will check before doing anything

Sounds sanely. You should have clocks reasonably synchronized anyway.


Cheers,
  Marek

From CLefevre at Transparent.com  Tue Sep  6 14:33:40 2011
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Tue, 6 Sep 2011 13:33:40 +0000
Subject: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
Message-ID: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>

Hello,
I have a probably very simple problem that I can't seem to get working. I'm trying to get a SelectConnection to connect to RabbitMQ, publish a message on Queue1, and then monitor Queue2 on the same connection for the reply. The on_queue_declared function I'm using currently publishes the message to Queue1, then sets up a monitor on Queue2, but the message isn't getting picked up.

Though I also wanted it to be non-blocking so the website isn't stuck waiting for the reply, but rather can be updated as needed. Currently, I can get it to work if there is a pause, like when stepping through the program in a debugger, but when it runs without myself stepping through, it simply hangs when the queue is created and the message is never picked up.

Currently implementing this solution in Python.

Thank you for your time,
-Christopher Lefevre

The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110906/c153caae/attachment.htm>

From michael.s.klishin at gmail.com  Tue Sep  6 14:38:02 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 6 Sep 2011 17:38:02 +0400
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
Message-ID: <CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>

2011/9/6 Christopher Lefevre <CLefevre at transparent.com>

> Though I also wanted it to be non-blocking so the website isn?t stuck
> waiting for the reply, but rather can be updated as needed. Currently, I can
> get it to work if there is a pause, like when stepping through the program
> in a debugger, but when it runs without myself stepping through, it simply
> hangs when the queue is created and the message is never picked up.


Please post a code example that is at least similar to your actual code.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110906/e68b3800/attachment.htm>

From billg at nffs.com  Tue Sep  6 15:14:45 2011
From: billg at nffs.com (Bill Gerrard)
Date: Tue, 06 Sep 2011 08:14:45 -0600
Subject: [rabbitmq-discuss] Issue: user is able to publish to queue that
 he does not have write permission to
In-Reply-To: <4E61B484.6020905@rabbitmq.com>
References: <4E60F2C9.3030800@nffs.com> <4E61B484.6020905@rabbitmq.com>
Message-ID: <4E662AD5.7070609@nffs.com>

Matthias,

On 09/02/2011 11:00 PM, Matthias Radestock wrote:
> Bill,
>
> On 02/09/11 16:14, Bill Gerrard wrote:
>> Testing permissions and discovered user is able to publish to queue that
>> he does not have write permission to.
>
> Technically there is no such thing as publishing to a queue; one 
> always publishes to an exchange. Though the default exchange helps 
> create the illusion that one can publish to a queue.
>
> As per http://www.rabbitmq.com/admin-guide.html#access-control, 
> publishing only requires write permissions on the exchange.

Thank you for the clarification. I will look into using per-queue fanout 
exchanges.

From CLefevre at Transparent.com  Tue Sep  6 15:52:17 2011
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Tue, 6 Sep 2011 14:52:17 +0000
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
Message-ID: <5798631D5F355D4C99FDF23580295AF8043DA6D2@TLMAIL1.Transparent.local>

Here is the very basic publish, and then basic consume with a new queue.

def _on_queue_declared(self, frame):
        self.StrReturn_Message = None

        self.channel.basic_publish(exchange='',
                            routing_key=self.routing_key,
                            body=self.message,
                            properties = pika.BasicProperties(
                                content_type=self.content_type,
                                delivery_mode=self.delivery_mode,
                                reply_to = self.reply_to,
                                correlation_id = self.correlationID
                            )
        )
        self.channel.basic_consume(self._return_stack, queue=self.reply_to)


-Christopher Lefevre

From: Michael Klishin [mailto:michael.s.klishin at gmail.com]
Sent: Tuesday, September 06, 2011 9:38 AM
To: Christopher Lefevre
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?

2011/9/6 Christopher Lefevre <CLefevre at transparent.com<mailto:CLefevre at transparent.com>>
Though I also wanted it to be non-blocking so the website isn?t stuck waiting for the reply, but rather can be updated as needed. Currently, I can get it to work if there is a pause, like when stepping through the program in a debugger, but when it runs without myself stepping through, it simply hangs when the queue is created and the message is never picked up.

Please post a code example that is at least similar to your actual code.

--
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110906/47908329/attachment.htm>

From francois at teksol.info  Tue Sep  6 16:35:22 2011
From: francois at teksol.info (=?utf-8?b?RnJhbsOnb2lz?= Beausoleil)
Date: Tue, 6 Sep 2011 15:35:22 +0000 (UTC)
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 failing to start (Debian
	Package)
References: <CAEUMe+TWvGBEUO7b6=eMLc3rPS=nP1PkyJKwhw3E7Efsj841Lg@mail.gmail.com>
	<20110902081226.GA23535@wellquite.org>
Message-ID: <loom.20110906T173115-801@post.gmane.org>


Matthew Sackman <matthew at ...> writes:
> 
> On Thu, Sep 01, 2011 at 11:38:09AM -0500, Philip K. Warren wrote:
> > I think the rabbitmq-server init script needs to create the
> > /var/run/rabbitmq directory if it doesn't exist, as the rabbitmq user
> > doesn't have permission to create the directory.
> 
> Thanks for reporting this. There's always something that manages to get
> through... sigh. Given the severity of this, I would imagine there'll be
> a patch release coming out fairly soon.

Hi!

I have applied Matthew's patch, and my VM fails to boot. I'm on Ubuntu 11.04,
and while booting the console writes "Starting rabbitmq-server: " - and
then nothing. The boot process is hung. I have to kill 
my VM and start in a new one, which still fails to boot anyway.

Any pointers would be *greatly* appreciated.

Thanks!
Fran?ois



From CLefevre at Transparent.com  Tue Sep  6 17:19:56 2011
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Tue, 6 Sep 2011 16:19:56 +0000
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
Message-ID: <5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>

To note, if this is an easier description, I?m trying to implement the RPC example on the RabbitMQ tutorial with a synchronous connection. Which I?ve copied below so you guys don?t need to go find it. However, the main impetus to me moving forward is lines 13/14:

        result = self.channel.queue_declare(exclusive=True)
        self.callback_queue = result.method.queue



Line 13 declares the result variable as the product of the channel getting an exclusive queue created, which I get. However the part that I get caught up in is where the callback is set to result.method.queue in line 14. What exactly is the method.queue of the result object? I am hoping to simply modify my Monitor/Publish classes to be able to have a synchronous publish/monitor without creating 2 connections. My current attempt at simply using one connection with 2 channels does not seem to be operating how I expected.

#!/usr/bin/env python
import pika
import uuid

class FibonacciRpcClient(object):
    def __init__(self):
        self.connection = pika.BlockingConnection(pika.ConnectionParameters(
                host='localhost'))

        self.channel = self.connection.channel()

        result = self.channel.queue_declare(exclusive=True)
        self.callback_queue = result.method.queue

        self.channel.basic_consume(self.on_response, no_ack=True,
                                   queue=self.callback_queue)

    def on_response(self, ch, method, props, body):
        if self.corr_id == props.correlation_id:
            self.response = body

    def call(self, n):
        self.response = None
        self.corr_id = str(uuid.uuid4())
        self.channel.basic_publish(exchange='',
                                   routing_key='rpc_queue',
                                   properties=pika.BasicProperties(
                                         reply_to = self.callback_queue,
                                         correlation_id = self.corr_id,
                                         ),
                                   body=str(n))
        while self.response is None:
            self.connection.process_data_events()
        return int(self.response)

fibonacci_rpc = FibonacciRpcClient()

print " [x] Requesting fib(30)"
response = fibonacci_rpc.call(30)
print " [.] Got %r" % (response,)



-Christopher Lefevre

From: Michael Klishin [mailto:michael.s.klishin at gmail.com]
Sent: Tuesday, September 06, 2011 9:38 AM
To: Christopher Lefevre
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?

2011/9/6 Christopher Lefevre <CLefevre at transparent.com<mailto:CLefevre at transparent.com>>
Though I also wanted it to be non-blocking so the website isn?t stuck waiting for the reply, but rather can be updated as needed. Currently, I can get it to work if there is a pause, like when stepping through the program in a debugger, but when it runs without myself stepping through, it simply hangs when the queue is created and the message is never picked up.

Please post a code example that is at least similar to your actual code.

--
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110906/82f314be/attachment.htm>

From majek04 at gmail.com  Tue Sep  6 17:43:03 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 6 Sep 2011 17:43:03 +0100
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>
Message-ID: <CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>

On Tue, Sep 6, 2011 at 17:19, Christopher Lefevre
<CLefevre at transparent.com> wrote:
> To note, if this is an easier description, I?m trying to implement the RPC
> example on the RabbitMQ tutorial with a synchronous connection. Which I?ve
> copied below so you guys don?t need to go find it. However, the main impetus
> to me moving forward is lines 13/14:
>
> ??????? result = self.channel.queue_declare(exclusive=True)
>
> ??????? self.callback_queue = result.method.queue

Synchronous methods in AMQP return data. This data is captured
under 'result.method'.
result.method.queue contains a fresh, unique, exclusive queue name
that was just created.

> Line 13 declares the result variable as the product of the channel getting
> an exclusive queue created, which I get. However the part that I get caught
> up in is where the callback is set to result.method.queue in line 14. What
> exactly is the method.queue of the result object?

If you're interested in other fields under 'result.method' please take a look
at amqp spec, for example results of queue-declare are under queue-declare-ok
method: http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok

> I am hoping to simply
> modify my Monitor/Publish classes to be able to have a synchronous
> publish/monitor without creating 2 connections. My current attempt at simply
> using one connection with 2 channels does not seem to be operating how I
> expected.

The problem is that RPC client does only listen for messages when
there is an RPC call running. So, you won't be able to get 'realtime'
data from other things that are hanging on the same connection.
You may hear the results only during the rpc call.

Cheers,
  Marek

From fearsome.lucidity at gmail.com  Tue Sep  6 17:59:26 2011
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Tue, 6 Sep 2011 09:59:26 -0700
Subject: [rabbitmq-discuss] Mirror queue recovery questions
Message-ID: <CAFDmHdOoWQSDxkZAzieBS5rRZ0Ap+ZV53c_wXKwXohMqaawQsQ@mail.gmail.com>

Hello,

I did not get a response to my questions, so let me try again.

What happens to persisted messages in mirrored queue slaves if they are
restarted and they don't find a queue master?

When using mirrored queued,must we ensure that the last node shutdown that
was participating in a mirrored queue, and thus the one that became master
last, is the one that is restarted first, so that the last master is online
when slaves join the cluster?

Thanks for your time.


---------- Forwarded message ----------
From: Elias Levy <fearsome.lucidity at gmail.com>
Date: Thu, Sep 1, 2011 at 12:16 PM
Subject: Re: [rabbitmq-discuss] RabbitMQ 2.6.0 is released
To: rabbitmq-discuss at lists.rabbitmq.com


Congratulations on releasing 2.6.0.  We've been looking forward to mirrored
queues, and the federation plugin will be put to use once we deploy to more
than one Amazon region.

I've gone through he mirrored queue documentation and its largely clear.
 The only question I was left with is what happens to the persisted messages
in a durable mirrored queue of a slave that is restarting and does not find
a master.  The docs say that if the master exists the slave will clear is
queue before joining, as its queue may be stale compared to that of the
master, but its silent on what happens if the master does not exists.

This also begs the question as to whether we must now be careful about the
order that nodes must be restarted after a full cluster shutdown.  Must we
ensure that the last node shutdown that was participating in a mirrored
queue, and thus the one that became master last, is the one that is
restarted first, so that the last master is online when slaves join the
cluster?

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110906/242f7876/attachment.htm>

From matthew at rabbitmq.com  Tue Sep  6 18:07:32 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 6 Sep 2011 18:07:32 +0100
Subject: [rabbitmq-discuss] Mirror queue recovery questions
In-Reply-To: <CAFDmHdOoWQSDxkZAzieBS5rRZ0Ap+ZV53c_wXKwXohMqaawQsQ@mail.gmail.com>
References: <CAFDmHdOoWQSDxkZAzieBS5rRZ0Ap+ZV53c_wXKwXohMqaawQsQ@mail.gmail.com>
Message-ID: <20110906170731.GB336@rabbitmq.com>

Hi Elias,

On Tue, Sep 06, 2011 at 09:59:26AM -0700, Elias Levy wrote:
> I did not get a response to my questions, so let me try again.

Sorry about that - it managed to slip down a crack...

> What happens to persisted messages in mirrored queue slaves if they are
> restarted and they don't find a queue master?

Assuming that at least one node that is meant to have a copy of the
queue on it survives, there'll always be a master. Thus other nodes
coming up will throw away their own contents, and start receiving new
content from the master. Note there is currently no eager
resynchronisation, as the documentation (hopefully) makes clear.

In the event that the entire cluster is stopped, due to mnesia, it's
normally required that the last node down comes up first - indeed the
other nodes in the cluster may very well refuse to start up (they'll
just block in the "starting database" step) until the nodes that were
alive when it died reappear.

Thus, again, as the documentation says, as nodes fall off, the master
will continue to migrate until the mirrored queue has just one node left
which is its master. Due to mnesia, it's very likely that this node will
_have_ to come up before any of the nodes that died earlier can start
up.

However, in catastrophic cases, such as instantaneous powerloss to the
whole cluster subsequent startup may well not be as orderly. In this
case, it's possible that the first node to recover that contained a
mirror of the queue, regardless of whether it was a master or slave,
takes the role of master. All other mirrors will then become slaves.

> When using mirrored queued,must we ensure that the last node shutdown that
> was participating in a mirrored queue, and thus the one that became master
> last, is the one that is restarted first, so that the last master is online
> when slaves join the cluster?

Yes, but as I say, the effect of mnesia (the distributed database that
Rabbit uses) is likely to enforce the correct startup ordering itself
(at least, it's quite good at that on recent versions of Erlang).

I hope that helps.

Matthew

From billg at nffs.com  Tue Sep  6 18:17:11 2011
From: billg at nffs.com (Bill Gerrard)
Date: Tue, 06 Sep 2011 11:17:11 -0600
Subject: [rabbitmq-discuss] /api/aliveness-test broken on 2.6.0?
In-Reply-To: <20110906170731.GB336@rabbitmq.com>
References: <CAFDmHdOoWQSDxkZAzieBS5rRZ0Ap+ZV53c_wXKwXohMqaawQsQ@mail.gmail.com>
	<20110906170731.GB336@rabbitmq.com>
Message-ID: <4E665597.6010701@nffs.com>

Our ops team just upgraded rabbitmq to 2.6.0 (on debian) and I installed 
the new management plugins.  After which, our monitoring using the 
aliveness-test api call no longer works.  All other api calls still 
appear to work though.

$ curl -i -u guest:guest http://message-broker:55672/api/aliveness-test/
HTTP/1.1 404 Object Not Found
Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
Date: Tue, 06 Sep 2011 16:56:51 GMT
Content-Type: text/html
Content-Length: 193

<HTML><HEAD><TITLE>404 Not Found</TITLE></HEAD><BODY><H1>Not 
Found</H1>The requested document was not found on this 
server.<P><HR><ADDRESS>mochiweb+webmachine web 
server</ADDRESS></BODY></HTML>

(just for info, here is vhosts showing it's working)

$ curl -i -u guest:guest http://message-broker:55672/api/vhosts
HTTP/1.1 200 OK
Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
Date: Tue, 06 Sep 2011 17:15:33 GMT
Content-Type: application/json
Content-Length: 30
Cache-Control: no-cache

[{"name":"/","tracing":false}]

From CLefevre at Transparent.com  Tue Sep  6 18:46:02 2011
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Tue, 6 Sep 2011 17:46:02 +0000
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>
	<CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
Message-ID: <5798631D5F355D4C99FDF23580295AF8043DA72C@TLMAIL1.Transparent.local>

We?re simply putting together a monitor that waits for a reply to be posted from a published item, so I would think that this should work out fine in that respect.

So the idea is to Publish => Wait for reply on the reply_to queue, close the connection.

Also thank you for the method explanation, reading up on the docs for that now.




-Christopher Lefevre

-----Original Message-----
From: Marek Majkowski [mailto:majek04 at gmail.com]
Sent: Tuesday, September 06, 2011 12:43 PM
To: Christopher Lefevre
Cc: Michael Klishin; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?

On Tue, Sep 6, 2011 at 17:19, Christopher Lefevre
<CLefevre at transparent.com> wrote:
> To note, if this is an easier description, I?m trying to implement the RPC
> example on the RabbitMQ tutorial with a synchronous connection. Which I?ve
> copied below so you guys don?t need to go find it. However, the main impetus
> to me moving forward is lines 13/14:
>
>         result = self.channel.queue_declare(exclusive=True)
>
>         self.callback_queue = result.method.queue

Synchronous methods in AMQP return data. This data is captured
under 'result.method'.
result.method.queue contains a fresh, unique, exclusive queue name
that was just created.

> Line 13 declares the result variable as the product of the channel getting
> an exclusive queue created, which I get. However the part that I get caught
> up in is where the callback is set to result.method.queue in line 14. What
> exactly is the method.queue of the result object?

If you're interested in other fields under 'result.method' please take a look
at amqp spec, for example results of queue-declare are under queue-declare-ok
method: http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok

> I am hoping to simply
> modify my Monitor/Publish classes to be able to have a synchronous
> publish/monitor without creating 2 connections. My current attempt at simply
> using one connection with 2 channels does not seem to be operating how I
> expected.

The problem is that RPC client does only listen for messages when
there is an RPC call running. So, you won't be able to get 'realtime'
data from other things that are hanging on the same connection.
You may hear the results only during the rpc call.

Cheers,
  Marek
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.

From michael.justin at gmx.net  Tue Sep  6 19:28:35 2011
From: michael.justin at gmx.net (Michael Justin)
Date: Tue, 06 Sep 2011 20:28:35 +0200
Subject: [rabbitmq-discuss] Stomp: after deleting a durable subscription,
	message is still available
Message-ID: <j45oon$2fn$1@dough.gmane.org>

In a test case, the Stomp client is able to receive messages from a 
topic after sending the "delete durable subscription" command as shown 
in http://www.rabbitmq.com/stomp.html

Is this a misunderstanding? I have used a unit test based on the similar 
feature in ActiveMQ which tries to read a message from a topic after the 
durable subscription has been removed. If a message can be read, the 
test fails. With RabbitMQ, this is the case, a message is still in the 
topic.

Many thanks in advance


Stomp log:

---- Create a durable subscription ------------------------------------
send:
CONNECT
login:guest
passcode:guest
client-id:durable-client-id



received:
CONNECTED
session:session-myExSC/0WqaZM9E+SF9hjQ==
heart-beat:0,0
version:1.0


send:
SUBSCRIBE
destination:/topic/TOOL.DEFAULT
receipt:yes
ack:auto
id:durable-subscription-name
persistent:true



received:
RECEIPT
receipt-id:yes


send:
DISCONNECT
client-id:durable-client-id



---- Send a Message that should be added to the durable sub -----------
send:
CONNECT
login:guest
passcode:guest
client-id:non-durable



received:
CONNECTED
session:session-IavksOGOZGIQFBvcAw5Sag==
heart-beat:0,0
version:1.0


send:
SEND
destination:/topic/TOOL.DEFAULT
content-length:9
persistent:true
content-type:text/plain

Message 1

send:
DISCONNECT
client-id:non-durable



---- Delete the subscription ------------------------------------------
send:
CONNECT
login:guest
passcode:guest
client-id:durable-client-id



received:
CONNECTED
session:session-P0Fetnb8moyqkmkRpYWCRA==
heart-beat:0,0
version:1.0


send:
UNSUBSCRIBE
id:durable-subscription-name
persistent:true



send:
DISCONNECT
client-id:durable-client-id



----- Activate the durable sub now and try to receive the message. -----
send:
CONNECT
login:guest
passcode:guest
client-id:durable-client-id



received:
CONNECTED
session:session-gRlqZ17pFswb2y3DJI/vsA==
heart-beat:0,0
version:1.0


send:
SUBSCRIBE
destination:/topic/TOOL.DEFAULT
receipt:yes
ack:auto
id:durable-subscription-name
persistent:true



received:
RECEIPT
receipt-id:yes


received:
MESSAGE
persistent:true
content-type:text/plain
subscription:durable-subscription-name
destination:/topic/TOOL.DEFAULT
message-id:T_durable-subscription-name@@session-gRlqZ17pFswb2y3DJI/vsA==@@1
content-length:9


send:
DISCONNECT
client-id:durable-client-id





From CLefevre at Transparent.com  Tue Sep  6 20:05:38 2011
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Tue, 6 Sep 2011 19:05:38 +0000
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>
	<CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
Message-ID: <5798631D5F355D4C99FDF23580295AF8043DA742@TLMAIL1.Transparent.local>

Further research and testing yields that I would require using a blocking connection for that code to work. There isn't a .process_requests() in a synchronous SelectConnection.

Are there any examples for a non-blocking solution to having a simple app that sends a request, and then immediately monitors the reply_to queue for the response?

One other question that is more architecture based that I don't seem to have gotten the concept of, if you want to keep the number of connections to the server down per application instance, do you use multiple channels per connection for multiple queues? I attempted a solution wherein I would simply add a second channel to the connection, but that seemed to foul up the publish.


-Christopher Lefevre


-----Original Message-----
From: Marek Majkowski [mailto:majek04 at gmail.com]
Sent: Tuesday, September 06, 2011 12:43 PM
To: Christopher Lefevre
Cc: Michael Klishin; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?

On Tue, Sep 6, 2011 at 17:19, Christopher Lefevre
<CLefevre at transparent.com> wrote:
> To note, if this is an easier description, I?m trying to implement the RPC
> example on the RabbitMQ tutorial with a synchronous connection. Which I?ve
> copied below so you guys don?t need to go find it. However, the main impetus
> to me moving forward is lines 13/14:
>
>         result = self.channel.queue_declare(exclusive=True)
>
>         self.callback_queue = result.method.queue

Synchronous methods in AMQP return data. This data is captured
under 'result.method'.
result.method.queue contains a fresh, unique, exclusive queue name
that was just created.

> Line 13 declares the result variable as the product of the channel getting
> an exclusive queue created, which I get. However the part that I get caught
> up in is where the callback is set to result.method.queue in line 14. What
> exactly is the method.queue of the result object?

If you're interested in other fields under 'result.method' please take a look
at amqp spec, for example results of queue-declare are under queue-declare-ok
method: http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok

> I am hoping to simply
> modify my Monitor/Publish classes to be able to have a synchronous
> publish/monitor without creating 2 connections. My current attempt at simply
> using one connection with 2 channels does not seem to be operating how I
> expected.

The problem is that RPC client does only listen for messages when
there is an RPC call running. So, you won't be able to get 'realtime'
data from other things that are hanging on the same connection.
You may hear the results only during the rpc call.

Cheers,
  Marek
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.

From billg at nffs.com  Tue Sep  6 20:17:04 2011
From: billg at nffs.com (Bill Gerrard)
Date: Tue, 06 Sep 2011 13:17:04 -0600
Subject: [rabbitmq-discuss] /api/aliveness-test broken on 2.6.0?
In-Reply-To: <4E665597.6010701@nffs.com>
References: <CAFDmHdOoWQSDxkZAzieBS5rRZ0Ap+ZV53c_wXKwXohMqaawQsQ@mail.gmail.com>	<20110906170731.GB336@rabbitmq.com>
	<4E665597.6010701@nffs.com>
Message-ID: <4E6671B0.8020207@nffs.com>

Ah, I found the real problem.  The authentication realm name of the web 
UI/API has changed from "Management: Web UI" to "RabbitMQ Management" in 
2.6.0.

I just had to change the realm name in the nagios-plugins-rabbitmq by 
James Casey and everything is working correctly again.

And, yes this does work:
curl -i -u guest:guest http://message-broker:55672/api/aliveness-test/%2F

On 09/06/2011 11:17 AM, Bill Gerrard wrote:
> Our ops team just upgraded rabbitmq to 2.6.0 (on debian) and I 
> installed the new management plugins.  After which, our monitoring 
> using the aliveness-test api call no longer works.  All other api 
> calls still appear to work though.


From bmurphy1976 at gmail.com  Tue Sep  6 21:26:54 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Tue, 6 Sep 2011 15:26:54 -0500
Subject: [rabbitmq-discuss] active/active HA cluster appears to be deadlocked
Message-ID: <CAP+1M2cDwGipfMp_HA=h_q1kU3cqiua7M03Lp7eZf_QjGyA=gw@mail.gmail.com>

I created a 3 server RabbitMQ v2.6.0 cluster with all queues
configured for "x-ha-policy": "all".  Everything seemed to be working
fine, and then I killed one of the servers (halt).  This is in a
virtualized environment (ec2) so that server is gone.  I wanted to
simulate scenarios where one of the servers failed catastrophically.

The problem is, now my cluster seems to be stuck in some sort of
deadlocked state.  One of my processes *thinks* it posted a message to
the cluster, but I am unable to list_queues to verify this and the
consumer has yet to receive this message.

"rabbitmqctl list_queues" blocks forever and never returns.

"/etc/init.d/rabbitmq-server stop" blocks forever and never actually
shuts down the server.

"rabbitmqctl cluster_status" returns immediately showing me the three
registered nodes with only two listed as running:

Cluster status of node 'rabbit at domU-12-31-39-00-E1-D7' ...
[{nodes,[{disc,['rabbit at ip-10-212-138-134','rabbit at ip-10-90-195-244',
                'rabbit at domU-12-31-39-00-E1-D7']}]},
 {running_nodes,['rabbit at ip-10-212-138-134','rabbit at domU-12-31-39-00-E1-D7']}]
...done.

as you can see, all three nodes were configured as "disk" nodes and
rabbit at ip-10-90-195-244 is no longer running.

So, somehow the cluster seems to be deadlocked.  Since this server
cannot possibly be restored, how do I get out of this state?  Is there
a way I can forcefully tell the rest of the cluster to forget about
the missing server?  I can't find an example of how to do this in the
documentation.

Thanks,
Bryan

From bmurphy1976 at gmail.com  Tue Sep  6 21:34:17 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Tue, 6 Sep 2011 15:34:17 -0500
Subject: [rabbitmq-discuss] active/active HA cluster appears to be
	deadlocked
In-Reply-To: <CAP+1M2cDwGipfMp_HA=h_q1kU3cqiua7M03Lp7eZf_QjGyA=gw@mail.gmail.com>
References: <CAP+1M2cDwGipfMp_HA=h_q1kU3cqiua7M03Lp7eZf_QjGyA=gw@mail.gmail.com>
Message-ID: <CAP+1M2fsfj8inoj1_HWg9ZqsQSn4Nrwcb6vdjb77pHvz-kKNOw@mail.gmail.com>

Additional info,

I killed the rabbitmq process on of the servers in the cluster.  I was
then able to run a "rabbitmqctl list_queues" on the remaining server
and verify that there are messages in the queue that have not been
picked up.

I restarted the process, and "/etc/init.d/rabbitmq-server start" never
exited.  I had to ^C to get out, however, the server does appear to
have restarted and rejoined the cluster.

I can now run "rabbitmqclt list_queues" on both nodes in the cluster,
but the messages are still not flowing and the node I restarted shows
the following error when I run "rabbitmqclt list_queues":

=ERROR REPORT==== 6-Sep-2011::20:31:35 ===
Discarding message
{'$gen_call',{<0.256.0>,#Ref<0.0.0.646>},{info,[name,messages]}} from
<0.256.0> to <0.1382.0> in an old incarnation (2) of this node (3)


On Tue, Sep 6, 2011 at 3:26 PM, Bryan Murphy <bmurphy1976 at gmail.com> wrote:
> I created a 3 server RabbitMQ v2.6.0 cluster with all queues
> configured for "x-ha-policy": "all". ?Everything seemed to be working
> fine, and then I killed one of the servers (halt). ?This is in a
> virtualized environment (ec2) so that server is gone. ?I wanted to
> simulate scenarios where one of the servers failed catastrophically.
>
> The problem is, now my cluster seems to be stuck in some sort of
> deadlocked state. ?One of my processes *thinks* it posted a message to
> the cluster, but I am unable to list_queues to verify this and the
> consumer has yet to receive this message.
>
> "rabbitmqctl list_queues" blocks forever and never returns.
>
> "/etc/init.d/rabbitmq-server stop" blocks forever and never actually
> shuts down the server.
>
> "rabbitmqctl cluster_status" returns immediately showing me the three
> registered nodes with only two listed as running:
>
> Cluster status of node 'rabbit at domU-12-31-39-00-E1-D7' ...
> [{nodes,[{disc,['rabbit at ip-10-212-138-134','rabbit at ip-10-90-195-244',
> ? ? ? ? ? ? ? ?'rabbit at domU-12-31-39-00-E1-D7']}]},
> ?{running_nodes,['rabbit at ip-10-212-138-134','rabbit at domU-12-31-39-00-E1-D7']}]
> ...done.
>
> as you can see, all three nodes were configured as "disk" nodes and
> rabbit at ip-10-90-195-244 is no longer running.
>
> So, somehow the cluster seems to be deadlocked. ?Since this server
> cannot possibly be restored, how do I get out of this state? ?Is there
> a way I can forcefully tell the rest of the cluster to forget about
> the missing server? ?I can't find an example of how to do this in the
> documentation.
>
> Thanks,
> Bryan
>

From bmurphy1976 at gmail.com  Wed Sep  7 02:37:45 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Tue, 6 Sep 2011 20:37:45 -0500
Subject: [rabbitmq-discuss] active/active HA cluster appears to be
	deadlocked
In-Reply-To: <CAP+1M2fsfj8inoj1_HWg9ZqsQSn4Nrwcb6vdjb77pHvz-kKNOw@mail.gmail.com>
References: <CAP+1M2cDwGipfMp_HA=h_q1kU3cqiua7M03Lp7eZf_QjGyA=gw@mail.gmail.com>
	<CAP+1M2fsfj8inoj1_HWg9ZqsQSn4Nrwcb6vdjb77pHvz-kKNOw@mail.gmail.com>
Message-ID: <CAP+1M2eJC0NjtQA4i3==+kODMjyvJmU3Fw31xQeHQ5J6G13VQg@mail.gmail.com>

I've tried to duplicate this and the second time around the cluster is
behaving like I would have expected.  Unfortunately, I stupidly
overwrote the old cluster so I can't go back to it for any deeper
inspection.

After trawling the archives a bit, it seems that the only way to bring
a dead node out of the cluster is to create a new node that
masquerades as the old node.  That seems pretty messy to me.  Am I
correct about this?  Are there plans to address this in a future
release?

Thanks!
Bryan

On Tue, Sep 6, 2011 at 3:34 PM, Bryan Murphy <bmurphy1976 at gmail.com> wrote:
> Additional info,
>
> I killed the rabbitmq process on of the servers in the cluster. ?I was
> then able to run a "rabbitmqctl list_queues" on the remaining server
> and verify that there are messages in the queue that have not been
> picked up.
>
> I restarted the process, and "/etc/init.d/rabbitmq-server start" never
> exited. ?I had to ^C to get out, however, the server does appear to
> have restarted and rejoined the cluster.
>
> I can now run "rabbitmqclt list_queues" on both nodes in the cluster,
> but the messages are still not flowing and the node I restarted shows
> the following error when I run "rabbitmqclt list_queues":
>
> =ERROR REPORT==== 6-Sep-2011::20:31:35 ===
> Discarding message
> {'$gen_call',{<0.256.0>,#Ref<0.0.0.646>},{info,[name,messages]}} from
> <0.256.0> to <0.1382.0> in an old incarnation (2) of this node (3)
>
>
> On Tue, Sep 6, 2011 at 3:26 PM, Bryan Murphy <bmurphy1976 at gmail.com> wrote:
>> I created a 3 server RabbitMQ v2.6.0 cluster with all queues
>> configured for "x-ha-policy": "all". ?Everything seemed to be working
>> fine, and then I killed one of the servers (halt). ?This is in a
>> virtualized environment (ec2) so that server is gone. ?I wanted to
>> simulate scenarios where one of the servers failed catastrophically.
>>
>> The problem is, now my cluster seems to be stuck in some sort of
>> deadlocked state. ?One of my processes *thinks* it posted a message to
>> the cluster, but I am unable to list_queues to verify this and the
>> consumer has yet to receive this message.
>>
>> "rabbitmqctl list_queues" blocks forever and never returns.
>>
>> "/etc/init.d/rabbitmq-server stop" blocks forever and never actually
>> shuts down the server.
>>
>> "rabbitmqctl cluster_status" returns immediately showing me the three
>> registered nodes with only two listed as running:
>>
>> Cluster status of node 'rabbit at domU-12-31-39-00-E1-D7' ...
>> [{nodes,[{disc,['rabbit at ip-10-212-138-134','rabbit at ip-10-90-195-244',
>> ? ? ? ? ? ? ? ?'rabbit at domU-12-31-39-00-E1-D7']}]},
>> ?{running_nodes,['rabbit at ip-10-212-138-134','rabbit at domU-12-31-39-00-E1-D7']}]
>> ...done.
>>
>> as you can see, all three nodes were configured as "disk" nodes and
>> rabbit at ip-10-90-195-244 is no longer running.
>>
>> So, somehow the cluster seems to be deadlocked. ?Since this server
>> cannot possibly be restored, how do I get out of this state? ?Is there
>> a way I can forcefully tell the rest of the cluster to forget about
>> the missing server? ?I can't find an example of how to do this in the
>> documentation.
>>
>> Thanks,
>> Bryan
>>
>

From sergey.almazoff at gmail.com  Wed Sep  7 06:39:59 2011
From: sergey.almazoff at gmail.com (Sergey Almazov)
Date: Wed, 7 Sep 2011 09:39:59 +0400
Subject: [rabbitmq-discuss] pika error - need a help
Message-ID: <CAMsQa1rVz4OaQ2bjG2QVTeqgMkyFSWqMHQZDZ_F0rarjyub5jw@mail.gmail.com>

#!/usr/bin/env python
import pika
import sys
import psutil
import json
import time

serverName = "salmazov"
connection =
pika.AsyncoreConnection(pika.ConnectionParameters(host='192.168.0.25'))
channel = connection.channel()

channel.exchange_declare(exchange='cmd', type='topic')

cmd_data_queue = channel.queue_declare(exclusive=True).queue

channel.queue_bind(exchange='cmd', queue=cmd_data_queue,
routing_key='cmd.*')

def callback(ch, method, properties, body):
    print " [x] %r:%r" % (method.routing_key, body,)
    procCmd = decodeddict["ProcCmd"]
    proc = psutil.Popen(procCmd)

channel.basic_consume(callback, queue=cmd_data_queue, no_ack=True)
pika.asyncore_loop()
--------------------------------------------

When I start this code -> have an error: *error: uncaptured python
exception, closing channel <pika.asyncore_adapter.RabbitDispatcher connected
at 0x12ad6c0>*
*
*
I need to run processes that arrived via RmQ
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110907/4750ee1e/attachment.htm>

From conorglynn at gmail.com  Wed Sep  7 10:41:25 2011
From: conorglynn at gmail.com (ronocgly)
Date: Wed, 7 Sep 2011 02:41:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable to get management plugins working with
 Nagios after upgrade: "Access Refused"
Message-ID: <58596f73-39c4-451a-a1b4-29a82601177a@o15g2000vbe.googlegroups.com>

Hi,
I have upgraded my rabbitmq-server and rabbitmq management plugins to
2.6.0 (old version 2.2.0) , since the upgrade rabbitmq is working fine
but nagios reports "Access Refused" when polling the plugins.

The version of nagios-rabbitmq-scripts is: nagios-plugins-
rabbitmq-1.0.1-1

When I browse to the rabbitmq-server:55672, I can logon as guest:guest
and get an overview and see things as normal.
But I can see when I do a wget from the nagios server to the rabbitmq-
server, first of all a "401 Unauthorized" appears then the wget works,
its like as if there isdouble authentication happening and it fails on
the first attempt (which does not happen on the old version of
rabbitmq-server & plugins)

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+
[root at nagios SOURCES]#  wget --user=guest --password=guest
http://rabbitmq-server:55672
--2011-09-07 10:35:48--  http://rabbitmq-server:55672/
Resolving rabbitmq-server... 10.13.31.59
Connecting tomsg1003-rmq-str-papi.oy.gb.sportingindex.com |
10.13.31.59|:55672... connected.
HTTP request sent, awaiting response... 401 Unauthorized
Connecting to rabbitmq-server|10.13.31.59|:55672... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2260 (2.2K) [text/html]
Saving to: `index.html'
100%[======================================>] 2,260       --.-K/s   in
0s
2011-09-07 10:35:48 (5.75 MB/s) - `index.html' saved [2260/2260]
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+


From simon at rabbitmq.com  Wed Sep  7 10:55:43 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 Sep 2011 10:55:43 +0100
Subject: [rabbitmq-discuss] Unable to get management plugins working
 with Nagios after upgrade: "Access Refused"
In-Reply-To: <58596f73-39c4-451a-a1b4-29a82601177a@o15g2000vbe.googlegroups.com>
References: <58596f73-39c4-451a-a1b4-29a82601177a@o15g2000vbe.googlegroups.com>
Message-ID: <4E673F9F.5030504@rabbitmq.com>

On 07/09/11 10:41, ronocgly wrote:
> Hi,
> I have upgraded my rabbitmq-server and rabbitmq management plugins to
> 2.6.0 (old version 2.2.0) , since the upgrade rabbitmq is working fine
> but nagios reports "Access Refused" when polling the plugins.

I think you're seeing the same issue reported here:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/014917.html

Sorry about this, I didn't think changing the realm name would break 
things. I won't change it again :)

> But I can see when I do a wget from the nagios server to the rabbitmq-
> server, first of all a "401 Unauthorized" appears then the wget works,
> its like as if there isdouble authentication happening and it fails on
> the first attempt (which does not happen on the old version of
> rabbitmq-server&  plugins)

Umm, isn't that how HTTP authentication works?

>  From what I have been reading and a colleague mention he had a problem
> with the Authentication Realm before, could it be related to that?

Yes, sounds like it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Sep  7 10:59:53 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 07 Sep 2011 10:59:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ binding to Active Directory
In-Reply-To: <21054697.3454.1315311719437.JavaMail.geo-discussion-forums@yqja21>
References: <21054697.3454.1315311719437.JavaMail.geo-discussion-forums@yqja21>
Message-ID: <4E674099.6090506@rabbitmq.com>

On 06/09/11 13:21, Juliette wrote:
> I want to bind RabbitMQ to Active Directory. How can I do this ?

Do you want to use AD to provide authentication / authorisation for 
RabbitMQ? In that case you should look at the LDAP plugin:

http://www.rabbitmq.com/plugins.html#rabbitmq_auth_backend_ldap

http://hg.rabbitmq.com/rabbitmq-auth-backend-ldap/file/rabbitmq_v2_6_0/README

...although you should also be warned that it's a bit rough round the edges.

If you end up using it, let me know how you get on - I've received 
basically no feedback from anyone!

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthew at rabbitmq.com  Wed Sep  7 12:05:23 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 7 Sep 2011 12:05:23 +0100
Subject: [rabbitmq-discuss] active/active HA cluster appears to be
 deadlocked
In-Reply-To: <CAP+1M2eJC0NjtQA4i3==+kODMjyvJmU3Fw31xQeHQ5J6G13VQg@mail.gmail.com>
References: <CAP+1M2cDwGipfMp_HA=h_q1kU3cqiua7M03Lp7eZf_QjGyA=gw@mail.gmail.com>
	<CAP+1M2fsfj8inoj1_HWg9ZqsQSn4Nrwcb6vdjb77pHvz-kKNOw@mail.gmail.com>
	<CAP+1M2eJC0NjtQA4i3==+kODMjyvJmU3Fw31xQeHQ5J6G13VQg@mail.gmail.com>
Message-ID: <20110907110523.GC8651@rabbitmq.com>

Hi Bryan,

Thanks for reporting all of this.

> > On Tue, Sep 6, 2011 at 3:26 PM, Bryan Murphy <bmurphy1976 at gmail.com> wrote:
> >> I created a 3 server RabbitMQ v2.6.0 cluster with all queues
> >> configured for "x-ha-policy": "all". ?Everything seemed to be working
> >> fine, and then I killed one of the servers (halt). ?This is in a
> >> virtualized environment (ec2) so that server is gone. ?I wanted to
> >> simulate scenarios where one of the servers failed catastrophically.
> >>
> >> The problem is, now my cluster seems to be stuck in some sort of
> >> deadlocked state. ?One of my processes *thinks* it posted a message to
> >> the cluster, but I am unable to list_queues to verify this and the
> >> consumer has yet to receive this message.
> >>
> >> "rabbitmqctl list_queues" blocks forever and never returns.

list_queues actively calls into each queue process. Thus it requires the
queue process to respond. To me, what it sounds like, is that the node
that went away contained the master of the mirrored queue, and none of
the slaves have noticed yet, thus there has been no promotion of a
slave, and thus list_queues will still try to call the old and dead
master. This raises two interesting and related questions:

1. Why have the slaves not noticed the loss of the master?
2. Why did the list_queues call not fail - if list_queues tries to call
a queue that doesn't exist, it will error.

What this seems to suggest is that Erlang itself has got very confused
about what's going on - it seems to think that the dead node may be
alive. There are some timers in Erlang (the kernel net tick time) that
Erlang uses to try and detect whether a node is dead or alive. How long
did the cluster remain in this state? Presumably some time.

If you can get this to happen again, the log entries of all the nodes
would be very very useful.

> >> "/etc/init.d/rabbitmq-server stop" blocks forever and never actually
> >> shuts down the server.

Yeah, if list_queues can get blocked, then there'll likely be some other
process within Rabbit that's calling to the dead node and has similarly
got blocked and is then blocking the shutdown sequence.

> >> "rabbitmqctl cluster_status" returns immediately showing me the three
> >> registered nodes with only two listed as running:
> >>
> >> Cluster status of node 'rabbit at domU-12-31-39-00-E1-D7' ...
> >> [{nodes,[{disc,['rabbit at ip-10-212-138-134','rabbit at ip-10-90-195-244',
> >> ? ? ? ? ? ? ? ?'rabbit at domU-12-31-39-00-E1-D7']}]},
> >> ?{running_nodes,['rabbit at ip-10-212-138-134','rabbit at domU-12-31-39-00-E1-D7']}]
> >> ...done.

That's interesting. That shows that mnesia has realised
rabbit at ip-10-90-195-244 has died, even if the rest of Erlang hasn't.
Most curious.

> > I can now run "rabbitmqclt list_queues" on both nodes in the cluster,
> > but the messages are still not flowing and the node I restarted shows
> > the following error when I run "rabbitmqclt list_queues":
> >
> > =ERROR REPORT==== 6-Sep-2011::20:31:35 ===
> > Discarding message
> > {'$gen_call',{<0.256.0>,#Ref<0.0.0.646>},{info,[name,messages]}} from
> > <0.256.0> to <0.1382.0> in an old incarnation (2) of this node (3)

That is an amazing error. Erlang not only gives every node a name, but
also gives every node a version. But what is being suggested is that a
msg has been received from the local node and to the local node where
the message appears to come from a prior version of this node.

This error seems to come from C code in the source of Erlang and is
invoked on sending a message. I can't get close to explaining exactly
what's going on here - all those pids in that error message are local
pids. There's no remote node involved at all there...

> I've tried to duplicate this and the second time around the cluster is
> behaving like I would have expected.  Unfortunately, I stupidly
> overwrote the old cluster so I can't go back to it for any deeper
> inspection.

Ahh that's a shame. Log entries would have been very very useful. If you
can reproduce this again, please let us know.

> After trawling the archives a bit, it seems that the only way to bring
> a dead node out of the cluster is to create a new node that
> masquerades as the old node.  That seems pretty messy to me.  Am I
> correct about this?  Are there plans to address this in a future
> release?

Yes, you're right about that, and it is messy. Having looked at the code
in this area, there seems to me no reason why we couldn't add that
functionality. I'll raise a bug.

Matthew

From awitbrock at vmware.com  Wed Sep  7 12:21:16 2011
From: awitbrock at vmware.com (Ann Witbrock (c))
Date: Wed, 7 Sep 2011 04:21:16 -0700 (PDT)
Subject: [rabbitmq-discuss] pika error - need a help
In-Reply-To: <CAMsQa1rVz4OaQ2bjG2QVTeqgMkyFSWqMHQZDZ_F0rarjyub5jw@mail.gmail.com>
Message-ID: <1734456435.144856.1315394475963.JavaMail.root@zimbra-prod-mbox-4.vmware.com>


Hi Sergey, 
I'm not the most experienced about the pika, but I would recommend using normal E xception handling around the connection and queue set up , and also around your processing code, so that it doesn't interfere with the normal running of the processing. If you record the exception messages somewhere, you will be able to get more inf ormation about the failure. 

Your exact needs may differ, but our java tutorial at https://github.com/rabbitmq/rabbitmq-tutorials/blob/master/java/RPCServer.java ?has some Exception context (the "try" blocks) which may be helpful. Unfortunately, we don't have such an example for the pika. 

I hope to ? add some guidance on exceptions to our documentation at some point soon. 
Ann 
----- Original Message -----

From: "Sergey Almazov" <sergey.almazoff at gmail.com> 
To: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Wednesday, 7 September, 2011 6:39:59 AM 
Subject: [rabbitmq-discuss] pika error - need a help 


#!/usr/bin/env python 
import pika 
import sys 
import psutil 
import json 
import time 


serverName = "salmazov" 
connection = pika.AsyncoreConnection(pika.ConnectionParameters(host='192.168.0.25')) 
channel = connection.channel() 


channel.exchange_declare(exchange='cmd', type='topic') 


cmd_data_queue = channel.queue_declare(exclusive=True).queue 


channel.queue_bind(exchange='cmd', queue=cmd_data_queue, routing_key='cmd.*') 


def callback(ch, method, properties, body): 
? ? print " [x] %r:%r" % (method.routing_key, body,) 
? ? procCmd = decodeddict["ProcCmd"] 
? ? proc = psutil.Popen(procCmd) 
? ?? 
channel.basic_consume(callback, queue=cmd_data_queue, no_ack=True) 
pika.asyncore_loop() 
-------------------------------------------- 


When I start this code -> have an error:? error: uncaptured python exception, closing channel <pika.asyncore_adapter.RabbitDispatcher connected at 0x12ad6c0> 


I need to run processes that arrived via RmQ 
_______________________________________________ 
rabbitmq-discuss mailing list 
rabbitmq-discuss at lists.rabbitmq.com 
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110907/c66bcda8/attachment.htm>

From awitbrock at vmware.com  Wed Sep  7 12:37:38 2011
From: awitbrock at vmware.com (Ann Witbrock (c))
Date: Wed, 7 Sep 2011 04:37:38 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq-messagepatterns
In-Reply-To: <loom.20110906T112229-699@post.gmane.org>
Message-ID: <1678672071.145057.1315395458930.JavaMail.root@zimbra-prod-mbox-4.vmware.com>

It's a bit dated. It may not be fully compatible with recent client libraries (?)

----- Original Message -----
From: "nikdenik" <nicola.ferrante at gmail.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, 6 September, 2011 10:23:58 AM
Subject: Re: [rabbitmq-discuss] rabbitmq-messagepatterns

Matthew Sackman <matthew at ...> writes:

> 
> On Mon, Jun 20, 2011 at 04:31:39PM -0500, James Carr wrote:
> > Is there a maven repository that 
I can find the rabbitmq-messagepatterns jar in?
> 
> We've not done one. I doubt anyone else has.
> 
> Matthew
> 


Oh I found it at 
https://github.com/rabbitmq/rabbitmq-java-messagepatterns

bye  bye





_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gmr at myyearbook.com  Wed Sep  7 14:04:07 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 7 Sep 2011 09:04:07 -0400
Subject: [rabbitmq-discuss] pika error - need a help
In-Reply-To: <1734456435.144856.1315394475963.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
References: <1734456435.144856.1315394475963.JavaMail.root@zimbra-prod-mbox-4.vmware.com>
Message-ID: <37B9BF2C7CE941F28290900029438FD6@myyearbook.com>



On Wednesday, September 7, 2011 at 7:21 AM, Ann Witbrock (c) wrote:

> 
> 
> From: "Sergey Almazov" <sergey.almazoff at gmail.com (mailto:sergey.almazoff at gmail.com)>
> To: rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> Sent: Wednesday, 7 September, 2011 6:39:59 AM
> Subject: [rabbitmq-discuss] pika error - need a help
> 
> 
> When I start this code -> have an error: error: uncaptured python exception, closing channel <pika.asyncore_adapter.RabbitDispatcher connected at 0x12ad6c0>
So one of the difficulties with async programming in python is catching exceptions, add in some interesting aspects of AMQP and knowing what has happened where can be difficult. If you could provide a traceback beyond the exception it would be helpful.

You may be getting a remote close from RabbitMQ. You can check your rabbitmq logs to see and you can handle it in your code.

I would suggest adding an on channel close callback (this is rough untested code):

from pika import spec

def my_callback_function(frame):
 print frame.method.reply_code
 print frame.method.reply_text

callback_manager = connection.callbacks.add(channel.channel_number, spec.Channel.Close, my_callback_function)





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110907/5666c47e/attachment.htm>

From CLefevre at Transparent.com  Wed Sep  7 14:21:21 2011
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Wed, 7 Sep 2011 13:21:21 +0000
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>
	<CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
Message-ID: <5798631D5F355D4C99FDF23580295AF8043DA7FD@TLMAIL1.Transparent.local>

Coming back to this after a day I realize throughout I was a bit off in describing my situation. I am actually attempting to get an asynchronous setup to work on one connection to the RabbitMQ server.

Connect, create a channel(s), publish to a queue, then monitor on the reply queue, in an asynchronous state, returning the reply to a web page when completed.


-Christopher Lefevre

-----Original Message-----
From: Marek Majkowski [mailto:majek04 at gmail.com]
Sent: Tuesday, September 06, 2011 12:43 PM
To: Christopher Lefevre
Cc: Michael Klishin; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?

On Tue, Sep 6, 2011 at 17:19, Christopher Lefevre
<CLefevre at transparent.com> wrote:
> To note, if this is an easier description, I?m trying to implement the RPC
> example on the RabbitMQ tutorial with a synchronous connection. Which I?ve
> copied below so you guys don?t need to go find it. However, the main impetus
> to me moving forward is lines 13/14:
>
>         result = self.channel.queue_declare(exclusive=True)
>
>         self.callback_queue = result.method.queue

Synchronous methods in AMQP return data. This data is captured
under 'result.method'.
result.method.queue contains a fresh, unique, exclusive queue name
that was just created.

> Line 13 declares the result variable as the product of the channel getting
> an exclusive queue created, which I get. However the part that I get caught
> up in is where the callback is set to result.method.queue in line 14. What
> exactly is the method.queue of the result object?

If you're interested in other fields under 'result.method' please take a look
at amqp spec, for example results of queue-declare are under queue-declare-ok
method: http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok

> I am hoping to simply
> modify my Monitor/Publish classes to be able to have a synchronous
> publish/monitor without creating 2 connections. My current attempt at simply
> using one connection with 2 channels does not seem to be operating how I
> expected.

The problem is that RPC client does only listen for messages when
there is an RPC call running. So, you won't be able to get 'realtime'
data from other things that are hanging on the same connection.
You may hear the results only during the rpc call.

Cheers,
  Marek
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.

From billg at nffs.com  Wed Sep  7 14:43:53 2011
From: billg at nffs.com (Bill Gerrard)
Date: Wed, 07 Sep 2011 07:43:53 -0600
Subject: [rabbitmq-discuss] Unable to get management plugins working
 with Nagios after upgrade: "Access Refused"
In-Reply-To: <4E673F9F.5030504@rabbitmq.com>
References: <58596f73-39c4-451a-a1b4-29a82601177a@o15g2000vbe.googlegroups.com>
	<4E673F9F.5030504@rabbitmq.com>
Message-ID: <4E677519.2070900@nffs.com>

On 09/07/2011 03:55 AM, Simon MacMullen wrote:
> On 07/09/11 10:41, ronocgly wrote:
>> Hi,
>> I have upgraded my rabbitmq-server and rabbitmq management plugins to
>> 2.6.0 (old version 2.2.0) , since the upgrade rabbitmq is working fine
>> but nagios reports "Access Refused" when polling the plugins.
>
> I think you're seeing the same issue reported here:
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/014917.html 
>

In each of the check_rabbitmq_* nagios plugins, find the credentials 
logic and change it as follows:

  $ua->credentials("$hostname:$port",
-    "Management: Web UI", $p->opts->user, $p->opts->password);
+    "RabbitMQ Management", $p->opts->user, $p->opts->password);


I have already notified the author of nagios-plugins-rabbitmq about the 
change.

> Sorry about this, I didn't think changing the realm name would break 
> things. I won't change it again :)

Thank you!


From majek04 at gmail.com  Wed Sep  7 16:45:13 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 7 Sep 2011 16:45:13 +0100
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <5798631D5F355D4C99FDF23580295AF8043DA7FD@TLMAIL1.Transparent.local>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>
	<CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA7FD@TLMAIL1.Transparent.local>
Message-ID: <CABzX+qy2o5Zn_iA=a8gGwH2kGTiqLX06AQ7XPBtu7exn7VwBOQ@mail.gmail.com>

On Wed, Sep 7, 2011 at 14:21, Christopher Lefevre
<CLefevre at transparent.com> wrote:
> Coming back to this after a day I realize throughout I was a bit off in describing my situation. I am actually attempting to get an asynchronous setup to work on one connection to the RabbitMQ server.
>
> Connect, create a channel(s), publish to a queue, then monitor on the reply queue, in an asynchronous state, returning the reply to a web page when completed.
>

Well, if you want to use asynchronous style, than you need to have
an event loop and program using callbacks.

Cheers,
  Marek

From stuart at state.it  Wed Sep  7 16:49:52 2011
From: stuart at state.it (Stuart Munro)
Date: Wed, 7 Sep 2011 11:49:52 -0400
Subject: [rabbitmq-discuss] Clustering and scaling
Message-ID: <CA8D5130.32BB%stuart@state.it>

Hi,

I was wondering someone could give me a few pointers about using RabbitMQ in cluster mode.

So far we have 2 RabbitMQ's in cluster mode (rb-1 and rb-2), rb-2 is in RAM mode.

How do other people setup redundancy in terms of queue consumers hitting the cluster?

So, for example could I have a load balancer sitting in front of the 2 rb's and in a round-robin approach on the load balancer distribute load between them ? this raises the question ? how quick is the replication between the nodes?

Alternatively, do I setup a failover implementation using something like HAProxy? But this raises the question how to I scale horizontally?

Thank you very much for your time, much appreciated.

Stuart

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110907/04f71382/attachment.htm>

From CLefevre at Transparent.com  Wed Sep  7 19:02:32 2011
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Wed, 7 Sep 2011 18:02:32 +0000
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <CABzX+qy2o5Zn_iA=a8gGwH2kGTiqLX06AQ7XPBtu7exn7VwBOQ@mail.gmail.com>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>
	<CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA7FD@TLMAIL1.Transparent.local>
	<CABzX+qy2o5Zn_iA=a8gGwH2kGTiqLX06AQ7XPBtu7exn7VwBOQ@mail.gmail.com>
Message-ID: <5798631D5F355D4C99FDF23580295AF8043DB0A6@TLMAIL1.Transparent.local>

EXACTLY!

That's the bit that I'm getting stuck on.

I have a publish method that sets up a connection, then calls another function to open a channel, then publishes to the queue as shown previously.

Within that function is a connection.ioloop.start() which I guess I don't really understand. For the individual publish/monitor functions they work as expected, the monitor will monitor and consume, while the publish only publishes once and breaks the ioloop, as expected.

To get an asynchronous Publish, then Monitor the reply_to queue, I can instantiate the classes for the monitor/publisher I have, and it will work with 2 connections to the server. However trying to get this done with one connection is where I'm balking.

-Christopher Lefevre


-----Original Message-----
From: Marek Majkowski [mailto:majek04 at gmail.com]
Sent: Wednesday, September 07, 2011 11:45 AM
To: Christopher Lefevre
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?

On Wed, Sep 7, 2011 at 14:21, Christopher Lefevre
<CLefevre at transparent.com> wrote:
> Coming back to this after a day I realize throughout I was a bit off in describing my situation. I am actually attempting to get an asynchronous setup to work on one connection to the RabbitMQ server.
>
> Connect, create a channel(s), publish to a queue, then monitor on the reply queue, in an asynchronous state, returning the reply to a web page when completed.
>

Well, if you want to use asynchronous style, than you need to have
an event loop and program using callbacks.

Cheers,
  Marek
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.

From ekirpichov at gmail.com  Wed Sep  7 19:04:59 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 7 Sep 2011 22:04:59 +0400
Subject: [rabbitmq-discuss] Clustering and scaling
In-Reply-To: <CA8D5130.32BB%stuart@state.it>
References: <CA8D5130.32BB%stuart@state.it>
Message-ID: <CANVKUrWhQ5gFbFQ1H5oQ_0wr_dygAsTSy6crCb-Qtkcv2+Z2Yg@mail.gmail.com>

Hi Stuart,

I haven't fully understood whether you want scaling for redundancy or
scaling for load balancing.
In the first case I don't see why you're interested in the number of consumers.
In the second case I don't see why you're interested in replication.

On Wed, Sep 7, 2011 at 7:49 PM, Stuart Munro <stuart at state.it> wrote:
> Hi,
> I was wondering someone could give me a few pointers about using RabbitMQ in
> cluster mode.
> So far we have 2 RabbitMQ's in cluster mode (rb-1 and rb-2), rb-2 is in RAM
> mode.
> How do other people setup redundancy in terms of queue consumers hitting the
> cluster?
> So, for example could I have a load balancer sitting in front of the 2 rb's
> and in a round-robin approach on the load balancer distribute load between
> them ? this raises the question ? how quick is the replication between the
> nodes?
> Alternatively, do I setup a failover implementation using something like
> HAProxy? But this raises the question how to I scale horizontally?
> Thank you very much for your time, much appreciated.
> Stuart
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From john at graavy.com  Wed Sep  7 19:23:04 2011
From: john at graavy.com (John Lemp)
Date: Wed, 7 Sep 2011 11:23:04 -0700 (PDT)
Subject: [rabbitmq-discuss] active/active HA and publishers/consumers
Message-ID: <eed7ba3b-d868-4833-90e6-7a0741434c6f@v18g2000yqj.googlegroups.com>

What is the recommended way for consumers/publishers to use mirrored
queues for high availability? Should they be aware of all the nodes
that a queue is mirrored to and handle reconnecting to another node in
a failure scenario?

My thought was that I could setup a 2 rabbit node cluster using
mirrored queues on all and use a layer 4 load balancer with only the
master active to make the failure of a node transparent to publishers/
consumers. Is this a valid use case for mirrored queues and if so what
is the best indicator of which node is the master that can be used by
the load balancer? ie. a simple port check to determine rabbit is
running or a specific HTTP API call?

Thanks,
John

From fearsome.lucidity at gmail.com  Wed Sep  7 19:33:28 2011
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Wed, 7 Sep 2011 11:33:28 -0700
Subject: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 52, Issue 7
In-Reply-To: <mailman.1.1315393201.24824.rabbitmq-discuss@lists.rabbitmq.com>
References: <mailman.1.1315393201.24824.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <CAFDmHdP2OG_EyaRWCpbMEZLnOv8H2VoQLynMgaYCsaZvUzYQkw@mail.gmail.com>

On Wed, Sep 7, 2011 at 4:00 AM,
<rabbitmq-discuss-request at lists.rabbitmq.com> wrote:
>
> Date: Tue, 6 Sep 2011 18:07:32 +0100
> From: Matthew Sackman <matthew at rabbitmq.com>
>
> Sorry about that - it managed to slip down a crack...

No problem. ?Thank you for the reply.

>
> > What happens to persisted messages in mirrored queue slaves if they are
> > restarted and they don't find a queue master?
>
> In the event that the entire cluster is stopped, due to mnesia, it's
> normally required that the last node down comes up first - indeed the
> other nodes in the cluster may very well refuse to start up (they'll
> just block in the "starting database" step) until the nodes that were
> alive when it died reappear.

Is there some timeout on this? ?What if the old master is fully fried
and won't be joining the cluster again? ?Is there some sort of
election within the remaining nodes to select a new master? ?If so,
how is the election resolved? ?Slaves most closely synchronized to the
old master wins?

>
> However, in catastrophic cases, such as instantaneous powerloss to the
> whole cluster subsequent startup may well not be as orderly. In this
> case, it's possible that the first node to recover that contained a
> mirror of the queue, regardless of whether it was a master or slave,
> takes the role of master. All other mirrors will then become slaves.

Presumably it ways for a while and then timeouts and becomes master, yes?

Elias Levy

From gmr at myyearbook.com  Wed Sep  7 19:38:00 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 7 Sep 2011 14:38:00 -0400
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <5798631D5F355D4C99FDF23580295AF8043DB0A6@TLMAIL1.Transparent.local>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>
	<CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA7FD@TLMAIL1.Transparent.local>
	<CABzX+qy2o5Zn_iA=a8gGwH2kGTiqLX06AQ7XPBtu7exn7VwBOQ@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DB0A6@TLMAIL1.Transparent.local>
Message-ID: <FD646AE76677475FA00B043DE694A1A7@myyearbook.com>

 You can have multiple connections with one IO loop, assuming you're using PIka. In that case, the IOloop is a single instance across all connections, so you should setup both your connections before starting it, or use a timer to call a method after starting it that sets up your connections.

Gavin 


On Wednesday, September 7, 2011 at 2:02 PM, Christopher Lefevre wrote:

> EXACTLY!
> 
> That's the bit that I'm getting stuck on.
> 
> I have a publish method that sets up a connection, then calls another function to open a channel, then publishes to the queue as shown previously.
> 
> Within that function is a connection.ioloop.start() which I guess I don't really understand. For the individual publish/monitor functions they work as expected, the monitor will monitor and consume, while the publish only publishes once and breaks the ioloop, as expected.
> 
> To get an asynchronous Publish, then Monitor the reply_to queue, I can instantiate the classes for the monitor/publisher I have, and it will work with 2 connections to the server. However trying to get this done with one connection is where I'm balking.
> 
> -Christopher Lefevre
> 
> 
> -----Original Message-----
> From: Marek Majkowski [mailto:majek04 at gmail.com]
> Sent: Wednesday, September 07, 2011 11:45 AM
> To: Christopher Lefevre
> Cc: rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?
> 
> On Wed, Sep 7, 2011 at 14:21, Christopher Lefevre
> <CLefevre at transparent.com (mailto:CLefevre at transparent.com)> wrote:
> > Coming back to this after a day I realize throughout I was a bit off in describing my situation. I am actually attempting to get an asynchronous setup to work on one connection to the RabbitMQ server.
> > 
> > Connect, create a channel(s), publish to a queue, then monitor on the reply queue, in an asynchronous state, returning the reply to a web page when completed.
> 
> Well, if you want to use asynchronous style, than you need to have
> an event loop and program using callbacks.
> 
> Cheers,
>  Marek
> The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110907/195ec288/attachment.htm>

From CLefevre at Transparent.com  Wed Sep  7 19:45:09 2011
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Wed, 7 Sep 2011 18:45:09 +0000
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <FD646AE76677475FA00B043DE694A1A7@myyearbook.com>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>
	<CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA7FD@TLMAIL1.Transparent.local>
	<CABzX+qy2o5Zn_iA=a8gGwH2kGTiqLX06AQ7XPBtu7exn7VwBOQ@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DB0A6@TLMAIL1.Transparent.local>
	<FD646AE76677475FA00B043DE694A1A7@myyearbook.com>
Message-ID: <5798631D5F355D4C99FDF23580295AF8043DB0EF@TLMAIL1.Transparent.local>

Only using one connection is the point of this modification.

I already have a setup that does an asynchronous call that instantiates a Pika Publisher to publish a message to the queue, and a Pika Monitor to consume messages. However those each create their own connection and ioloops.

Am I chasing my tail trying to get multiple channels created for a single connection? Then creating a queue on each channel, one to monitor, one to publish to?

Or is there some other more elegant solution to this? Looking to keep the number of connections to RabbitMQ down on a per application basis.


-Christopher Lefevre

From: Gavin M. Roy [mailto:gmr at myyearbook.com]
Sent: Wednesday, September 07, 2011 2:38 PM
To: Christopher Lefevre
Cc: Marek Majkowski; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?

You can have multiple connections with one IO loop, assuming you're using PIka. In that case, the IOloop is a single instance across all connections, so you should setup both your connections before starting it, or use a timer to call a method after starting it that sets up your connections.

Gavin

On Wednesday, September 7, 2011 at 2:02 PM, Christopher Lefevre wrote:
EXACTLY!

That's the bit that I'm getting stuck on.

I have a publish method that sets up a connection, then calls another function to open a channel, then publishes to the queue as shown previously.

Within that function is a connection.ioloop.start() which I guess I don't really understand. For the individual publish/monitor functions they work as expected, the monitor will monitor and consume, while the publish only publishes once and breaks the ioloop, as expected.

To get an asynchronous Publish, then Monitor the reply_to queue, I can instantiate the classes for the monitor/publisher I have, and it will work with 2 connections to the server. However trying to get this done with one connection is where I'm balking.

-Christopher Lefevre


-----Original Message-----
From: Marek Majkowski [mailto:majek04 at gmail.com]
Sent: Wednesday, September 07, 2011 11:45 AM
To: Christopher Lefevre
Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?

On Wed, Sep 7, 2011 at 14:21, Christopher Lefevre
<CLefevre at transparent.com<mailto:CLefevre at transparent.com>> wrote:

Coming back to this after a day I realize throughout I was a bit off in describing my situation. I am actually attempting to get an asynchronous setup to work on one connection to the RabbitMQ server.

Connect, create a channel(s), publish to a queue, then monitor on the reply queue, in an asynchronous state, returning the reply to a web page when completed.

Well, if you want to use asynchronous style, than you need to have
an event loop and program using callbacks.

Cheers,
Marek
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110907/c41f2f88/attachment.htm>

From gmr at myyearbook.com  Wed Sep  7 20:46:18 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 7 Sep 2011 15:46:18 -0400
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <5798631D5F355D4C99FDF23580295AF8043DB0EF@TLMAIL1.Transparent.local>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>
	<CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA7FD@TLMAIL1.Transparent.local>
	<CABzX+qy2o5Zn_iA=a8gGwH2kGTiqLX06AQ7XPBtu7exn7VwBOQ@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DB0A6@TLMAIL1.Transparent.local>
	<FD646AE76677475FA00B043DE694A1A7@myyearbook.com>
	<5798631D5F355D4C99FDF23580295AF8043DB0EF@TLMAIL1.Transparent.local>
Message-ID: <FF0461BB0536450B886540B85189EA28@myyearbook.com>



On Wednesday, September 7, 2011 at 2:45 PM, Christopher Lefevre wrote:

> Only using one connection is the point of this modification.
> 
> 
> 

Oh that's easy then. 
> I already have a setup that does an asynchronous call that instantiates a Pika Publisher to publish a message to the queue, and a Pika Monitor to consume messages. However those each create their own connection and ioloops.
> 
> 
> 

No need for that. 
> Am I chasing my tail trying to get multiple channels created for a single connection? Then creating a queue on each channel, one to monitor, one to publish to?
You don't need a channel per queue really, but it should be easy to create -- this is more pseudocode, but should get the spirit across:

conn = FooConnection(on_connection_open)
conn.ioloop.start()


def on_connection_open(conn):
 conn.channel(on_channel_one_open)
 conn.channel(on_channel_two_open)

def on_channel_one_open(channel):
 global channel_one
 channel_one = channel
 channel_one.create_queue(on_monitor_queue_created)


def on_monitor_queue_created(frame)
 channel_one.basic_consume('routing_key', monitor_consumer_function)

def on_channel_two_open(channel):
 global channel_two
 channel_two = channel

 for x in xrange(0, 10000):
 publish_consumer_function(x)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110907/4e010739/attachment.htm>

From CLefevre at Transparent.com  Wed Sep  7 21:17:30 2011
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Wed, 7 Sep 2011 20:17:30 +0000
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <FF0461BB0536450B886540B85189EA28@myyearbook.com>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>
	<CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA7FD@TLMAIL1.Transparent.local>
	<CABzX+qy2o5Zn_iA=a8gGwH2kGTiqLX06AQ7XPBtu7exn7VwBOQ@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DB0A6@TLMAIL1.Transparent.local>
	<FD646AE76677475FA00B043DE694A1A7@myyearbook.com>
	<5798631D5F355D4C99FDF23580295AF8043DB0EF@TLMAIL1.Transparent.local>
	<FF0461BB0536450B886540B85189EA28@myyearbook.com>
Message-ID: <5798631D5F355D4C99FDF23580295AF8043DB129@TLMAIL1.Transparent.local>

Thanks Gavin, that actually seems to be exactly what I had tried previously, but didn?t work correctly.

Going to re-investigate that solution that I tried and see if I just missed something in there.

One thing that I notice actually, is  you?ve declared 2 globals, which I have implemented differently, the on_open function I have is defined as: def _on_channel_open(self, channel_, callback_=None):

Which then assigned channel_ to self.channel

When I implemented the change, I had self.channel, and self.monitor_channel. However everything else looks the same. Going to have to put all of that back in at this point to double check my work. I had reverted at this point to look into alternative solutions.


-Christopher Lefevre

From: Gavin M. Roy [mailto:gmr at myyearbook.com]
Sent: Wednesday, September 07, 2011 3:46 PM
To: Christopher Lefevre
Cc: Marek Majkowski; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?



On Wednesday, September 7, 2011 at 2:45 PM, Christopher Lefevre wrote:

Only using one connection is the point of this modification.
Oh that's easy then.

I already have a setup that does an asynchronous call that instantiates a Pika Publisher to publish a message to the queue, and a Pika Monitor to consume messages. However those each create their own connection and ioloops.
No need for that.
Am I chasing my tail trying to get multiple channels created for a single connection? Then creating a queue on each channel, one to monitor, one to publish to?
You don't need a channel per queue really, but it should be easy to create -- this is more pseudocode, but should get the spirit across:

conn = FooConnection(on_connection_open)
conn.ioloop.start()

def on_connection_open(conn):
  conn.channel(on_channel_one_open)
  conn.channel(on_channel_two_open)

def on_channel_one_open(channel):
  global channel_one
  channel_one = channel
  channel_one.create_queue(on_monitor_queue_created)

def on_monitor_queue_created(frame)
  channel_one.basic_consume('routing_key', monitor_consumer_function)

def on_channel_two_open(channel):
  global channel_two
  channel_two = channel
  for x in xrange(0, 10000):
    publish_consumer_function(x)

The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110907/0b060948/attachment.htm>

From jerryk at vmware.com  Wed Sep  7 21:31:04 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Wed, 7 Sep 2011 13:31:04 -0700 (PDT)
Subject: [rabbitmq-discuss] couple of questions (was: Re: RabbitMQ 2.6.0
	is	released)
In-Reply-To: <CABzX+qyOeXjXhyq60mLRjApy6YB4fBhhJvAGGpWFq9g+Z0O6TA@mail.gmail.com>
Message-ID: <59615477-8a3a-4519-b951-57929e70eeac@CoachZ.local>

> On Fri, Sep 2, 2011 at 00:54, Murthy Jayanthi <mjayanthi at gmail.com> wrote:
> >
> > 1. Does RabbitMQ support  an external persistence adapter for persist
> > message delivery to avoid message guaranty.
> > 2. The idea is to use Cassandra replicated storage for managing the persist
> > messages.
>
> RabbitMQ is generic message broker which supports many
> messaging patterns, it would be unlikely that a simple k-v message
> store (like cassandra) would behave performant with load patterns
> that RabbitMQ creates.

To extend Marek's point, using an RDBMS as a peristence layer is also
unlikely to agree well with the sorts of load profiles that RabbitMQ
sees in many cases.  A nice discussion of some of the related
considerations can be found here:

http://www.rabbitmq.com/blog/2011/01/20/rabbitmq-backing-stores-databases-and-disks/

Best regards,
Jerry

From CLefevre at Transparent.com  Wed Sep  7 21:49:15 2011
From: CLefevre at Transparent.com (Christopher Lefevre)
Date: Wed, 7 Sep 2011 20:49:15 +0000
Subject: [rabbitmq-discuss] Publish on a queue,
 then Monitor on a reply queue,
 with only 1 connection to the RabbitMQ server? Non-blocking?
In-Reply-To: <FF0461BB0536450B886540B85189EA28@myyearbook.com>
References: <5798631D5F355D4C99FDF23580295AF8043DA6A2@TLMAIL1.Transparent.local>
	<CAE3HoVQFxY4JOP+vmYtXcCf7DX=2RmsBCOOsbfu_T7qG650eSw@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA700@TLMAIL1.Transparent.local>
	<CABzX+qwysHXuTVA3NquX-mZ8VscKubGE6ghFAc3D+KmGg8toKg@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DA7FD@TLMAIL1.Transparent.local>
	<CABzX+qy2o5Zn_iA=a8gGwH2kGTiqLX06AQ7XPBtu7exn7VwBOQ@mail.gmail.com>
	<5798631D5F355D4C99FDF23580295AF8043DB0A6@TLMAIL1.Transparent.local>
	<FD646AE76677475FA00B043DE694A1A7@myyearbook.com>
	<5798631D5F355D4C99FDF23580295AF8043DB0EF@TLMAIL1.Transparent.local>
	<FF0461BB0536450B886540B85189EA28@myyearbook.com>
Message-ID: <5798631D5F355D4C99FDF23580295AF8043DB13D@TLMAIL1.Transparent.local>

Well, it all works now, thanks!

It apprears my previous implementation simply had some mix-up in the channels or something. I believe what it may have been is when I did the line for: channel.basic_qos(prefetch_count=1)

I may have not actually used the proper channel name there and simply applied it to the same channel twice.


-Christopher Lefevre

From: Gavin M. Roy [mailto:gmr at myyearbook.com]
Sent: Wednesday, September 07, 2011 3:46 PM
To: Christopher Lefevre
Cc: Marek Majkowski; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?



On Wednesday, September 7, 2011 at 2:45 PM, Christopher Lefevre wrote:

Only using one connection is the point of this modification.
Oh that's easy then.

I already have a setup that does an asynchronous call that instantiates a Pika Publisher to publish a message to the queue, and a Pika Monitor to consume messages. However those each create their own connection and ioloops.
No need for that.
Am I chasing my tail trying to get multiple channels created for a single connection? Then creating a queue on each channel, one to monitor, one to publish to?
You don't need a channel per queue really, but it should be easy to create -- this is more pseudocode, but should get the spirit across:

conn = FooConnection(on_connection_open)
conn.ioloop.start()

def on_connection_open(conn):
  conn.channel(on_channel_one_open)
  conn.channel(on_channel_two_open)

def on_channel_one_open(channel):
  global channel_one
  channel_one = channel
  channel_one.create_queue(on_monitor_queue_created)

def on_monitor_queue_created(frame)
  channel_one.basic_consume('routing_key', monitor_consumer_function)

def on_channel_two_open(channel):
  global channel_two
  channel_two = channel
  for x in xrange(0, 10000):
    publish_consumer_function(x)

The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110907/2baa89c9/attachment.htm>

From justin.adam.miller at gmail.com  Wed Sep  7 22:57:53 2011
From: justin.adam.miller at gmail.com (justin.adam.miller at gmail.com)
Date: Wed, 7 Sep 2011 14:57:53 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ using a ton of memory
Message-ID: <a61760a3-b8d5-4d12-9088-b54b01e4e944@m10g2000yqo.googlegroups.com>

I have a fast producer and about 30 consumers handling the incoming
messages. My queue length stays near zero as do the number of
unacknowledged messages as reported by rabbitmqctl. In other words, my
consumers are able to handle the rate and are definitely acking
messages.

I'm running rabbit on a machine with 96GB of RAM and I've set the high
watermark to 0.7.

I can run like this for several hours, all the while watching memory
usage vacillate as erlang garbage collects. These are never monumental
GC's though. It never drops from, say, 30 GB of memory down to 5GB.
It's usually within a few GB. Problem is though, the memory usage
creeps up over that time until we hit the high watermark and then, as
expected, everything stops.

I understand the memory flow control issues and why my producers stop
when that high watermark is hit, but I don't understand why, if I'm
keeping all my queues pretty empty, my memory usage keeps creeping up?

Any thoughts?

Thanks,
Justin

From matthew at rabbitmq.com  Wed Sep  7 23:07:29 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 7 Sep 2011 23:07:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ using a ton of memory
In-Reply-To: <a61760a3-b8d5-4d12-9088-b54b01e4e944@m10g2000yqo.googlegroups.com>
References: <a61760a3-b8d5-4d12-9088-b54b01e4e944@m10g2000yqo.googlegroups.com>
Message-ID: <20110907220729.GA4069@wellquite.org>

Hi Justin,

I'm sure you are, but could you just confirm that your clients are
acking msgs that they're sent - it's not some issue with messages not
being acknowledged and thus building up on the server?

Matthew

On Wed, Sep 07, 2011 at 02:57:53PM -0700, justin.adam.miller at gmail.com wrote:
> I have a fast producer and about 30 consumers handling the incoming
> messages. My queue length stays near zero as do the number of
> unacknowledged messages as reported by rabbitmqctl. In other words, my
> consumers are able to handle the rate and are definitely acking
> messages.
> 
> I'm running rabbit on a machine with 96GB of RAM and I've set the high
> watermark to 0.7.
> 
> I can run like this for several hours, all the while watching memory
> usage vacillate as erlang garbage collects. These are never monumental
> GC's though. It never drops from, say, 30 GB of memory down to 5GB.
> It's usually within a few GB. Problem is though, the memory usage
> creeps up over that time until we hit the high watermark and then, as
> expected, everything stops.
> 
> I understand the memory flow control issues and why my producers stop
> when that high watermark is hit, but I don't understand why, if I'm
> keeping all my queues pretty empty, my memory usage keeps creeping up?
> 
> Any thoughts?
> 
> Thanks,
> Justin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jamesc.000 at gmail.com  Thu Sep  8 09:46:03 2011
From: jamesc.000 at gmail.com (James Casey)
Date: Thu, 8 Sep 2011 10:46:03 +0200
Subject: [rabbitmq-discuss] Unable to get management plugins working
 with Nagios after upgrade: "Access Refused"
In-Reply-To: <4E677519.2070900@nffs.com>
References: <58596f73-39c4-451a-a1b4-29a82601177a@o15g2000vbe.googlegroups.com>
	<4E673F9F.5030504@rabbitmq.com> <4E677519.2070900@nffs.com>
Message-ID: <CAApq3Gg4uFdM_pQi+wbn-EHVTCWayQrvj4CzNs5+jwMrqEog0g@mail.gmail.com>

Thanks to Bill for catching and solving this.

I've now updated the plugins to work with both old and new versions of the
management plugin.

cheers,

James.
--

On 7 September 2011 15:43, Bill Gerrard <billg at nffs.com> wrote:

> On 09/07/2011 03:55 AM, Simon MacMullen wrote:
>
>> On 07/09/11 10:41, ronocgly wrote:
>>
>>> Hi,
>>> I have upgraded my rabbitmq-server and rabbitmq management plugins to
>>> 2.6.0 (old version 2.2.0) , since the upgrade rabbitmq is working fine
>>> but nagios reports "Access Refused" when polling the plugins.
>>>
>>
>> I think you're seeing the same issue reported here:
>>
>> http://lists.rabbitmq.com/**pipermail/rabbitmq-discuss/**
>> 2011-September/014917.html<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/014917.html>
>>
>
> In each of the check_rabbitmq_* nagios plugins, find the credentials logic
> and change it as follows:
>
>  $ua->credentials("$hostname:$**port",
> -    "Management: Web UI", $p->opts->user, $p->opts->password);
> +    "RabbitMQ Management", $p->opts->user, $p->opts->password);
>
>
> I have already notified the author of nagios-plugins-rabbitmq about the
> change.
>
>
>  Sorry about this, I didn't think changing the realm name would break
>> things. I won't change it again :)
>>
>
> Thank you!
>
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110908/d2d0a614/attachment.htm>

From sjaymin at gmail.com  Thu Sep  8 12:06:29 2011
From: sjaymin at gmail.com (Jaymin Shah)
Date: Thu, 8 Sep 2011 16:36:29 +0530
Subject: [rabbitmq-discuss] How to handle failover without losing messages
 if one of RabbitMQ node crashes in cluster
Message-ID: <CAO=2P+KpnsOaxjxknTXpoj+wu0LcOxwgipmzbGwxYo2w6RWALQ@mail.gmail.com>

Hi,


I have RabbitMQ cluster (2 instances of v2.6) on EC2. With this setup I am
able to process around 51K/s messages.


I have one exchange and 3 queues bound to each instance totaling to 6
consumers and 3 producer each sending messages to each instance totaling to
6 producers. Note that queue is not durable.


I am expected to validate if one of instance in cluster goes down then would
I be losing messages? If yes then what could be done to avoid that. We tried
durable queues but it does not give desired performance due to very high IO
and that too on virtual environment like EC2.


regards,

Jaymin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110908/14cfa05e/attachment.htm>

From matthew at rabbitmq.com  Thu Sep  8 12:40:57 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Sep 2011 12:40:57 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 failing to start (Debian
 Package)
In-Reply-To: <loom.20110906T173115-801@post.gmane.org>
References: <CAEUMe+TWvGBEUO7b6=eMLc3rPS=nP1PkyJKwhw3E7Efsj841Lg@mail.gmail.com>
	<20110902081226.GA23535@wellquite.org>
	<loom.20110906T173115-801@post.gmane.org>
Message-ID: <20110908114057.GB2369@rabbitmq.com>

Hi Fran?ois,

On Tue, Sep 06, 2011 at 03:35:22PM +0000, Fran?ois Beausoleil wrote:
> I have applied Matthew's patch,

Err, I didn't write that patch.

> and my VM fails to boot. I'm on Ubuntu 11.04,
> and while booting the console writes "Starting rabbitmq-server: " - and
> then nothing. The boot process is hung. I have to kill 
> my VM and start in a new one, which still fails to boot anyway.

Could you see what cat /var/log/rabbitmq/startup* gives you? Is
/var/run/rabbitmq being created? Is there a pid file in there?

Matthew

From stuart at state.it  Thu Sep  8 12:42:52 2011
From: stuart at state.it (Stuart Munro)
Date: Thu, 8 Sep 2011 07:42:52 -0400
Subject: [rabbitmq-discuss] Clustering and scaling
In-Reply-To: <CANVKUrWhQ5gFbFQ1H5oQ_0wr_dygAsTSy6crCb-Qtkcv2+Z2Yg@mail.gmail.com>
Message-ID: <CA8E53ED.3343%stuart@state.it>

Sorry Eugene, my understanding may be wrong, I'll try again.

1. Ideally I would like a few queue consumers servers running with the
ability to add more if/when needed on-the-fly (this doesn't affect
RabbitMQ, but I'll get to that in a second)

2. I would like multiple RabbitMQ servers that are redundant, if one of
the RabbitMQ servers dies the cluster should continue working as normal, I
also want the ability to add additional RabbitMQ servers on-the-fly
without having to tell the queue consumers that a new RabbitMQ server now
exists. This is the bit I don't quite understand how to implement.


In order for section 2 to work (from my understanding) I would need to put
a load balancer in front of the RabbitMQ servers, therefore the queue
consumers don't care about what server they pick-up the job from - it also
allows me to add RabbitMQ servers on-the-fly without reconfiguring as the
queue consumer would simply hit the load balancer.

How do people currently implement multiple RabbitMQ servers?

Thanks


-- 
Stuart Munro

e: stuart at state.it
w: www.state.it
m: +44 (0) 7738 755574




On 07/09/2011 19:04, "Eugene Kirpichov" <ekirpichov at gmail.com> wrote:

>Hi Stuart,
>
>I haven't fully understood whether you want scaling for redundancy or
>scaling for load balancing.
>In the first case I don't see why you're interested in the number of
>consumers.
>In the second case I don't see why you're interested in replication.
>
>On Wed, Sep 7, 2011 at 7:49 PM, Stuart Munro <stuart at state.it> wrote:
>> Hi,
>> I was wondering someone could give me a few pointers about using
>>RabbitMQ in
>> cluster mode.
>> So far we have 2 RabbitMQ's in cluster mode (rb-1 and rb-2), rb-2 is in
>>RAM
>> mode.
>> How do other people setup redundancy in terms of queue consumers
>>hitting the
>> cluster?
>> So, for example could I have a load balancer sitting in front of the 2
>>rb's
>> and in a round-robin approach on the load balancer distribute load
>>between
>> them ? this raises the question ? how quick is the replication between
>>the
>> nodes?
>> Alternatively, do I setup a failover implementation using something like
>> HAProxy? But this raises the question how to I scale horizontally?
>> Thank you very much for your time, much appreciated.
>> Stuart
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
>
>-- 
>Eugene Kirpichov
>Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>Editor, http://fprog.ru/


From justin.adam.miller at gmail.com  Thu Sep  8 12:47:27 2011
From: justin.adam.miller at gmail.com (justin.adam.miller at gmail.com)
Date: Thu, 8 Sep 2011 04:47:27 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ using a ton of memory
In-Reply-To: <20110907220729.GA4069@wellquite.org>
References: <a61760a3-b8d5-4d12-9088-b54b01e4e944@m10g2000yqo.googlegroups.com>
	<20110907220729.GA4069@wellquite.org>
Message-ID: <d3b14d32-0b66-4c3b-99c0-fcf6379da612@m18g2000vbe.googlegroups.com>

Not that this is exactly your purview, but I'm using Spring AMQP RC2,
with acknowledgeMode set to AUTO which, in Spring AMQP terms, means
the container will ack every message.

Also, is there any other way to check that messages are being acked,
besides checking 'rabbitmqctl messages_unacknowledged"? That number
definitely returns 0 (or close to it) at all times.

On Sep 7, 6:07?pm, Matthew Sackman <matt... at rabbitmq.com> wrote:
> Hi Justin,
>
> I'm sure you are, but could you just confirm that your clients are
> acking msgs that they're sent - it's not some issue with messages not
> being acknowledged and thus building up on the server?
>
> Matthew
>
>
>
>
>
>
>
>
>
> On Wed, Sep 07, 2011 at 02:57:53PM -0700, justin.adam.mil... at gmail.com wrote:
> > I have a fast producer and about 30 consumers handling the incoming
> > messages. My queue length stays near zero as do the number of
> > unacknowledged messages as reported by rabbitmqctl. In other words, my
> > consumers are able to handle the rate and are definitely acking
> > messages.
>
> > I'm running rabbit on a machine with 96GB of RAM and I've set the high
> > watermark to 0.7.
>
> > I can run like this for several hours, all the while watching memory
> > usage vacillate as erlang garbage collects. These are never monumental
> > GC's though. It never drops from, say, 30 GB of memory down to 5GB.
> > It's usually within a few GB. Problem is though, the memory usage
> > creeps up over that time until we hit the high watermark and then, as
> > expected, everything stops.
>
> > I understand the memory flow control issues and why my producers stop
> > when that high watermark is hit, but I don't understand why, if I'm
> > keeping all my queues pretty empty, my memory usage keeps creeping up?
>
> > Any thoughts?
>
> > Thanks,
> > Justin
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Thu Sep  8 13:07:12 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Sep 2011 13:07:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ using a ton of memory
In-Reply-To: <d3b14d32-0b66-4c3b-99c0-fcf6379da612@m18g2000vbe.googlegroups.com>
References: <a61760a3-b8d5-4d12-9088-b54b01e4e944@m10g2000yqo.googlegroups.com>
	<20110907220729.GA4069@wellquite.org>
	<d3b14d32-0b66-4c3b-99c0-fcf6379da612@m18g2000vbe.googlegroups.com>
Message-ID: <20110908120712.GC2369@rabbitmq.com>

On Thu, Sep 08, 2011 at 04:47:27AM -0700, justin.adam.miller at gmail.com wrote:
> Not that this is exactly your purview, but I'm using Spring AMQP RC2,
> with acknowledgeMode set to AUTO which, in Spring AMQP terms, means
> the container will ack every message.
> 
> Also, is there any other way to check that messages are being acked,
> besides checking 'rabbitmqctl messages_unacknowledged"? That number
> definitely returns 0 (or close to it) at all times.

Ok, that certainly sounds like you're doing the right thing.

Rabbit shouldn't continue to chew up more and more memory so I suspect
some sort of resource is being created and not destroyed. Could you
check things like the number of queues, the number of connections and
channels etc and that those numbers are not growing constantly?

96GB is an awful lot of memory!

> > > I can run like this for several hours, all the while watching memory
> > > usage vacillate as erlang garbage collects. These are never monumental
> > > GC's though. It never drops from, say, 30 GB of memory down to 5GB.
> > > It's usually within a few GB. Problem is though, the memory usage
> > > creeps up over that time until we hit the high watermark and then, as
> > > expected, everything stops.
> >
> > > I understand the memory flow control issues and why my producers stop
> > > when that high watermark is hit, but I don't understand why, if I'm
> > > keeping all my queues pretty empty, my memory usage keeps creeping up?

Agreed. If you can provoke this to happen again, then when you reach
that point could you run "rabbitmqctl report" and send us the output
(maybe off list if you see anything sensitive in there and/or it's
huge).

Matthew

From ekirpichov at gmail.com  Thu Sep  8 13:08:16 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 8 Sep 2011 16:08:16 +0400
Subject: [rabbitmq-discuss] Clustering and scaling
In-Reply-To: <CA8E53ED.3343%stuart@state.it>
References: <CANVKUrWhQ5gFbFQ1H5oQ_0wr_dygAsTSy6crCb-Qtkcv2+Z2Yg@mail.gmail.com>
	<CA8E53ED.3343%stuart@state.it>
Message-ID: <CANVKUrVpqi_uyCRk1uUVRzLL-k_xt+btC1tBS8Vh0Xp2+fvZ5A@mail.gmail.com>

Hi,

On Thu, Sep 8, 2011 at 3:42 PM, Stuart Munro <stuart at state.it> wrote:
> Sorry Eugene, my understanding may be wrong, I'll try again.
>
> 1. Ideally I would like a few queue consumers servers running with the
> ability to add more if/when needed on-the-fly (this doesn't affect
> RabbitMQ, but I'll get to that in a second)
>
> 2. I would like multiple RabbitMQ servers that are redundant, if one of
> the RabbitMQ servers dies the cluster should continue working as normal,
Tell more about the durability guarantees that you expect.
You can use active/active HA, but I think it imposes a performance penalty.
Do you expect the dead server to come back online sometime (after a
restart), or are the failures permanent?

> I
> also want the ability to add additional RabbitMQ servers on-the-fly
> without having to tell the queue consumers that a new RabbitMQ server now
> exists. This is the bit I don't quite understand how to implement.

There's no out-of-the-box provisioning for this at all. You'll have to
add your own infrastructure to support this.

>
>
> In order for section 2 to work (from my understanding) I would need to put
> a load balancer in front of the RabbitMQ servers, therefore the queue
> consumers don't care about what server they pick-up the job from - it also
> allows me to add RabbitMQ servers on-the-fly without reconfiguring as the
> queue consumer would simply hit the load balancer.
You can just make all consumers listen on all the servers at once, or
partition them between the consumers (e.g. each consumer listens to a
random server).

>
> How do people currently implement multiple RabbitMQ servers?
>
> Thanks
>
>
> --
> Stuart Munro
>
> e: stuart at state.it
> w: www.state.it
> m: +44 (0) 7738 755574
>
>
>
>
> On 07/09/2011 19:04, "Eugene Kirpichov" <ekirpichov at gmail.com> wrote:
>
>>Hi Stuart,
>>
>>I haven't fully understood whether you want scaling for redundancy or
>>scaling for load balancing.
>>In the first case I don't see why you're interested in the number of
>>consumers.
>>In the second case I don't see why you're interested in replication.
>>
>>On Wed, Sep 7, 2011 at 7:49 PM, Stuart Munro <stuart at state.it> wrote:
>>> Hi,
>>> I was wondering someone could give me a few pointers about using
>>>RabbitMQ in
>>> cluster mode.
>>> So far we have 2 RabbitMQ's in cluster mode (rb-1 and rb-2), rb-2 is in
>>>RAM
>>> mode.
>>> How do other people setup redundancy in terms of queue consumers
>>>hitting the
>>> cluster?
>>> So, for example could I have a load balancer sitting in front of the 2
>>>rb's
>>> and in a round-robin approach on the load balancer distribute load
>>>between
>>> them ? this raises the question ? how quick is the replication between
>>>the
>>> nodes?
>>> Alternatively, do I setup a failover implementation using something like
>>> HAProxy? But this raises the question how to I scale horizontally?
>>> Thank you very much for your time, much appreciated.
>>> Stuart
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>>
>>
>>--
>>Eugene Kirpichov
>>Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>>Editor, http://fprog.ru/
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From matthew at rabbitmq.com  Thu Sep  8 13:17:48 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Sep 2011 13:17:48 +0100
Subject: [rabbitmq-discuss] queue gets removed from a node
In-Reply-To: <4E5CFC5B.2010801@thebestisp.co.uk>
References: <4E563B8B.6000704@thebestisp.co.uk>
	<20110830115031.GB14864@rabbitmq.com>
	<4E5CFC5B.2010801@thebestisp.co.uk>
Message-ID: <20110908121747.GD2369@rabbitmq.com>

Hi Cezary,

On Tue, Aug 30, 2011 at 04:06:03PM +0100, Cezary Siwek wrote:
> >>The consumer script on Node1 creates a durable queue and waits for
> >>messages.

> I have reproduced the issue by breaking up the link between two
> nodes. The queue on node2 gets deleted when the node1 becomes
> unavailable.

No, I think you're confused. A queue only exists on one node, and that
node will be the node to which the client was connected. So if your
consumer created the queue on Node1 then Node2 is forwarding msgs
destined for that queue to Node1. Thus it's not a question of the queue
being deleted, more a question of the queue becoming un-findable once
Node2 loses contact with Node1.

> I know that rabbitmq cluster is not designed to work on unreliable
> links but is it a correct behavior when a queue gets deleted from
> the node? At least the node should allow producer to re-create the
> queue and keep all the messages until connection between nodes is
> back up.

We used to allow this, but it's wrong: your queue still exists on Node1,
it's just that Node2 can't see Node1 any more. If the producer was
allowed to recreate the queue on Node2 then when the cluster reforms,
you'll then have two queues with the same name, which then leads to all
sorts of crazy problems. Thus we forbid it.

> Is there any way to re-establish connection between two nodes when
> the link goes up?

If it is just a network issue and both Node1 and Node2 are really still
up, then I'm not sure if Erlang itself attempts reconnections, and this
may well be the problem (and hence why the stop_app/start_app helps). We
might need to add something to help them re-see each other. Essentially
I think we want to try running a "net_kernel:connect_node(Node)"
somewhere, but quite when, or where, or even whether it's really the
solution, isn't yet clear.

Matthew

From matthias at rabbitmq.com  Thu Sep  8 13:23:01 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 08 Sep 2011 13:23:01 +0100
Subject: [rabbitmq-discuss] queue gets removed from a node
In-Reply-To: <20110908121747.GD2369@rabbitmq.com>
References: <4E563B8B.6000704@thebestisp.co.uk>	<20110830115031.GB14864@rabbitmq.com>	<4E5CFC5B.2010801@thebestisp.co.uk>
	<20110908121747.GD2369@rabbitmq.com>
Message-ID: <4E68B3A5.1070601@rabbitmq.com>

On 08/09/11 13:17, Matthew Sackman wrote:
> On Tue, Aug 30, 2011 at 04:06:03PM +0100, Cezary Siwek wrote:
>> links but is it a correct behavior when a queue gets deleted from
>> the node? At least the node should allow producer to re-create the
>> queue and keep all the messages until connection between nodes is
>> back up.
>
> We used to allow this, but it's wrong: your queue still exists on Node1,
> it's just that Node2 can't see Node1 any more. If the producer was
> allowed to recreate the queue on Node2 then when the cluster reforms,
> you'll then have two queues with the same name, which then leads to all
> sorts of crazy problems. Thus we forbid it.

...for durable queues (only), i.e. when the node containing a 
non-durable queue vanishes, that queue truly disappears and can be 
re-created on other nodes.

Matthias.

From stuart at state.it  Thu Sep  8 13:26:06 2011
From: stuart at state.it (Stuart Munro)
Date: Thu, 8 Sep 2011 08:26:06 -0400
Subject: [rabbitmq-discuss] Clustering and scaling
In-Reply-To: <CANVKUrVpqi_uyCRk1uUVRzLL-k_xt+btC1tBS8Vh0Xp2+fvZ5A@mail.gmail.com>
Message-ID: <CA8E712D.33FD%stuart@state.it>


Hi Eugene,

-- Tell more about the durability guarantees that you expect.
-- You can use active/active HA, but I think it imposes a performance
penalty.
-- Do you expect the dead server to come back online sometime (after a
-- restart), or are the failures permanent?

If the server dies, we will rebuild a new one and add it back in.
If I use active/active what happens if two queue consumers hit the
RabbitMQ cluster at the same time and one goes to server A and the other
goes to server B? Will they not get the same job? How do I guarantee the
queue is consistent between multiple RabbitMQ's

-- You can just make all consumers listen on all the servers at once, or
-- partition them between the consumers (e.g. each consumer listens to a
-- random server).


But if I put a load balancer between the queue consumer servers and the
RabbitMQ servers, the queue consumer servers would only need to know the
load balancer address - therefore enabling movement of the RabbitMQ
servers.


Thanks again,

Stuart







On 08/09/2011 13:08, "Eugene Kirpichov" <ekirpichov at gmail.com> wrote:

>Hi,
>
>On Thu, Sep 8, 2011 at 3:42 PM, Stuart Munro <stuart at state.it> wrote:
>> Sorry Eugene, my understanding may be wrong, I'll try again.
>>
>> 1. Ideally I would like a few queue consumers servers running with the
>> ability to add more if/when needed on-the-fly (this doesn't affect
>> RabbitMQ, but I'll get to that in a second)
>>
>> 2. I would like multiple RabbitMQ servers that are redundant, if one of
>> the RabbitMQ servers dies the cluster should continue working as normal,
>Tell more about the durability guarantees that you expect.
>You can use active/active HA, but I think it imposes a performance
>penalty.
>Do you expect the dead server to come back online sometime (after a
>restart), or are the failures permanent?
>
>> I
>> also want the ability to add additional RabbitMQ servers on-the-fly
>> without having to tell the queue consumers that a new RabbitMQ server
>>now
>> exists. This is the bit I don't quite understand how to implement.
>
>There's no out-of-the-box provisioning for this at all. You'll have to
>add your own infrastructure to support this.
>
>>
>>
>> In order for section 2 to work (from my understanding) I would need to
>>put
>> a load balancer in front of the RabbitMQ servers, therefore the queue
>> consumers don't care about what server they pick-up the job from - it
>>also
>> allows me to add RabbitMQ servers on-the-fly without reconfiguring as
>>the
>> queue consumer would simply hit the load balancer.
>You can just make all consumers listen on all the servers at once, or
>partition them between the consumers (e.g. each consumer listens to a
>random server).
>
>>
>> How do people currently implement multiple RabbitMQ servers?
>>
>> Thanks
>>
>>
>> --
>> Stuart Munro
>>
>> e: stuart at state.it
>> w: www.state.it
>> m: +44 (0) 7738 755574
>>
>>
>>
>>
>> On 07/09/2011 19:04, "Eugene Kirpichov" <ekirpichov at gmail.com> wrote:
>>
>>>Hi Stuart,
>>>
>>>I haven't fully understood whether you want scaling for redundancy or
>>>scaling for load balancing.
>>>In the first case I don't see why you're interested in the number of
>>>consumers.
>>>In the second case I don't see why you're interested in replication.
>>>
>>>On Wed, Sep 7, 2011 at 7:49 PM, Stuart Munro <stuart at state.it> wrote:
>>>> Hi,
>>>> I was wondering someone could give me a few pointers about using
>>>>RabbitMQ in
>>>> cluster mode.
>>>> So far we have 2 RabbitMQ's in cluster mode (rb-1 and rb-2), rb-2 is
>>>>in
>>>>RAM
>>>> mode.
>>>> How do other people setup redundancy in terms of queue consumers
>>>>hitting the
>>>> cluster?
>>>> So, for example could I have a load balancer sitting in front of the 2
>>>>rb's
>>>> and in a round-robin approach on the load balancer distribute load
>>>>between
>>>> them ? this raises the question ? how quick is the replication between
>>>>the
>>>> nodes?
>>>> Alternatively, do I setup a failover implementation using something
>>>>like
>>>> HAProxy? But this raises the question how to I scale horizontally?
>>>> Thank you very much for your time, much appreciated.
>>>> Stuart
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>>
>>>
>>>--
>>>Eugene Kirpichov
>>>Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>>>Editor, http://fprog.ru/
>>
>>
>
>
>
>-- 
>Eugene Kirpichov
>Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>Editor, http://fprog.ru/


From matthew at rabbitmq.com  Thu Sep  8 13:27:21 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Sep 2011 13:27:21 +0100
Subject: [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 52, Issue 7
In-Reply-To: <CAFDmHdP2OG_EyaRWCpbMEZLnOv8H2VoQLynMgaYCsaZvUzYQkw@mail.gmail.com>
References: <mailman.1.1315393201.24824.rabbitmq-discuss@lists.rabbitmq.com>
	<CAFDmHdP2OG_EyaRWCpbMEZLnOv8H2VoQLynMgaYCsaZvUzYQkw@mail.gmail.com>
Message-ID: <20110908122720.GE2369@rabbitmq.com>

On Wed, Sep 07, 2011 at 11:33:28AM -0700, Elias Levy wrote:
> > In the event that the entire cluster is stopped, due to mnesia, it's
> > normally required that the last node down comes up first - indeed the
> > other nodes in the cluster may very well refuse to start up (they'll
> > just block in the "starting database" step) until the nodes that were
> > alive when it died reappear.
> 
> Is there some timeout on this? ?What if the old master is fully fried
> and won't be joining the cluster again? ?Is there some sort of
> election within the remaining nodes to select a new master? ?If so,
> how is the election resolved? ?Slaves most closely synchronized to the
> old master wins?

Yeah, this is a bit of a problem. Essentially, yes, there is a timeout,
after which Rabbit will just give up trying to start. There are
definitely ways in which we could embue rabbitmqctl with the means to
tell rabbit to abandon all hope of some remote node ever rejoining (and
indeed, even ways to do this without the local rabbit coming up, which
is essential in this case), but we've not yet written this. There is a
bug open for this.

After that, the various local mnesia databases will try to merge
themselves back together, but if two nodes disagree about various
details and they can't delegate to a common node that was alive at the
point they failed, then mnesia will give up with an "unable to merge
schema" error, and there'll really be no hope at getting them both to
merge back together without resetting one of those nodes.

> > However, in catastrophic cases, such as instantaneous powerloss to the
> > whole cluster subsequent startup may well not be as orderly. In this
> > case, it's possible that the first node to recover that contained a
> > mirror of the queue, regardless of whether it was a master or slave,
> > takes the role of master. All other mirrors will then become slaves.
> 
> Presumably it waits for a while and then timeouts and becomes master, yes?

Erm possibly. Much of this ordering stuff comes from mnesia rather than
Rabbit. If the node's mnesia is happy to start up then Rabbit will then
restore queues without further delay. That may include the promotion of
slaves to master.

Matthew

From ekirpichov at gmail.com  Thu Sep  8 13:35:15 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 8 Sep 2011 16:35:15 +0400
Subject: [rabbitmq-discuss] Clustering and scaling
In-Reply-To: <CA8E712D.33FD%stuart@state.it>
References: <CANVKUrVpqi_uyCRk1uUVRzLL-k_xt+btC1tBS8Vh0Xp2+fvZ5A@mail.gmail.com>
	<CA8E712D.33FD%stuart@state.it>
Message-ID: <CANVKUrWxQ7q1L0ApkYZ3bj-7u_td-8dgzLN12NE1X9A4BysqJQ@mail.gmail.com>

Hi,

2011/9/8 Stuart Munro <stuart at state.it>:
>
> Hi Eugene,
>
> -- Tell more about the durability guarantees that you expect.
> -- You can use active/active HA, but I think it imposes a performance
> penalty.
> -- Do you expect the dead server to come back online sometime (after a
> -- restart), or are the failures permanent?
>
> If the server dies, we will rebuild a new one and add it back in.
> If I use active/active what happens if two queue consumers hit the
> RabbitMQ cluster at the same time and one goes to server A and the other
> goes to server B? Will they not get the same job? How do I guarantee the
> queue is consistent between multiple RabbitMQ's
I don't know. I hope someone else on the list can tell more about
active/active HA.

>
> -- You can just make all consumers listen on all the servers at once, or
> -- partition them between the consumers (e.g. each consumer listens to a
> -- random server).
>
>
> But if I put a load balancer between the queue consumer servers and the
> RabbitMQ servers, the queue consumer servers would only need to know the
> load balancer address - therefore enabling movement of the RabbitMQ
> servers.
Yes, this could be an option, though of course the load balancer
itself would have to be able to sustain the required load.
I am not aware of an existing load balancing solution for RabbitMQ,
though there might be one.

>
>
> Thanks again,
>
> Stuart
>
>
>
>
>
>
>
> On 08/09/2011 13:08, "Eugene Kirpichov" <ekirpichov at gmail.com> wrote:
>
>>Hi,
>>
>>On Thu, Sep 8, 2011 at 3:42 PM, Stuart Munro <stuart at state.it> wrote:
>>> Sorry Eugene, my understanding may be wrong, I'll try again.
>>>
>>> 1. Ideally I would like a few queue consumers servers running with the
>>> ability to add more if/when needed on-the-fly (this doesn't affect
>>> RabbitMQ, but I'll get to that in a second)
>>>
>>> 2. I would like multiple RabbitMQ servers that are redundant, if one of
>>> the RabbitMQ servers dies the cluster should continue working as normal,
>>Tell more about the durability guarantees that you expect.
>>You can use active/active HA, but I think it imposes a performance
>>penalty.
>>Do you expect the dead server to come back online sometime (after a
>>restart), or are the failures permanent?
>>
>>> I
>>> also want the ability to add additional RabbitMQ servers on-the-fly
>>> without having to tell the queue consumers that a new RabbitMQ server
>>>now
>>> exists. This is the bit I don't quite understand how to implement.
>>
>>There's no out-of-the-box provisioning for this at all. You'll have to
>>add your own infrastructure to support this.
>>
>>>
>>>
>>> In order for section 2 to work (from my understanding) I would need to
>>>put
>>> a load balancer in front of the RabbitMQ servers, therefore the queue
>>> consumers don't care about what server they pick-up the job from - it
>>>also
>>> allows me to add RabbitMQ servers on-the-fly without reconfiguring as
>>>the
>>> queue consumer would simply hit the load balancer.
>>You can just make all consumers listen on all the servers at once, or
>>partition them between the consumers (e.g. each consumer listens to a
>>random server).
>>
>>>
>>> How do people currently implement multiple RabbitMQ servers?
>>>
>>> Thanks
>>>
>>>
>>> --
>>> Stuart Munro
>>>
>>> e: stuart at state.it
>>> w: www.state.it
>>> m: +44 (0) 7738 755574
>>>
>>>
>>>
>>>
>>> On 07/09/2011 19:04, "Eugene Kirpichov" <ekirpichov at gmail.com> wrote:
>>>
>>>>Hi Stuart,
>>>>
>>>>I haven't fully understood whether you want scaling for redundancy or
>>>>scaling for load balancing.
>>>>In the first case I don't see why you're interested in the number of
>>>>consumers.
>>>>In the second case I don't see why you're interested in replication.
>>>>
>>>>On Wed, Sep 7, 2011 at 7:49 PM, Stuart Munro <stuart at state.it> wrote:
>>>>> Hi,
>>>>> I was wondering someone could give me a few pointers about using
>>>>>RabbitMQ in
>>>>> cluster mode.
>>>>> So far we have 2 RabbitMQ's in cluster mode (rb-1 and rb-2), rb-2 is
>>>>>in
>>>>>RAM
>>>>> mode.
>>>>> How do other people setup redundancy in terms of queue consumers
>>>>>hitting the
>>>>> cluster?
>>>>> So, for example could I have a load balancer sitting in front of the 2
>>>>>rb's
>>>>> and in a round-robin approach on the load balancer distribute load
>>>>>between
>>>>> them ? this raises the question ? how quick is the replication between
>>>>>the
>>>>> nodes?
>>>>> Alternatively, do I setup a failover implementation using something
>>>>>like
>>>>> HAProxy? But this raises the question how to I scale horizontally?
>>>>> Thank you very much for your time, much appreciated.
>>>>> Stuart
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>>
>>>>
>>>>
>>>>
>>>>--
>>>>Eugene Kirpichov
>>>>Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>>>>Editor, http://fprog.ru/
>>>
>>>
>>
>>
>>
>>--
>>Eugene Kirpichov
>>Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>>Editor, http://fprog.ru/
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From mbrancaleoni at voismart.it  Thu Sep  8 13:36:23 2011
From: mbrancaleoni at voismart.it (Matteo)
Date: Thu, 08 Sep 2011 14:36:23 +0200 (CEST)
Subject: [rabbitmq-discuss] Italian RabbitMQ meeting proposal
In-Reply-To: <CAOn7oW9M7CegKCjadjwFUiN=NABbYeDWtr+0bAn65p8UzpKRFw@mail.gmail.com>
Message-ID: <0d969893-3c02-47a1-80b4-d634d43a3546@mx.voismart.com>

Hi,

any idea on the location?
if not too far from me I can vote yes :)

Regards,
Matteo.

From matthias at rabbitmq.com  Thu Sep  8 13:40:10 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 08 Sep 2011 13:40:10 +0100
Subject: [rabbitmq-discuss] Clustering and scaling
In-Reply-To: <CANVKUrWxQ7q1L0ApkYZ3bj-7u_td-8dgzLN12NE1X9A4BysqJQ@mail.gmail.com>
References: <CANVKUrVpqi_uyCRk1uUVRzLL-k_xt+btC1tBS8Vh0Xp2+fvZ5A@mail.gmail.com>	<CA8E712D.33FD%stuart@state.it>
	<CANVKUrWxQ7q1L0ApkYZ3bj-7u_td-8dgzLN12NE1X9A4BysqJQ@mail.gmail.com>
Message-ID: <4E68B7AA.4090806@rabbitmq.com>

On 08/09/11 13:35, Eugene Kirpichov wrote:
> 2011/9/8 Stuart Munro<stuart at state.it>:
>> If I use active/active what happens if two queue consumers hit the
>> RabbitMQ cluster at the same time and one goes to server A and the other
>> goes to server B? Will they not get the same job? How do I guarantee the
>> queue is consistent between multiple RabbitMQ's
> I don't know. I hope someone else on the list can tell more about
> active/active HA.

Well, http://www.rabbitmq.com/ha.html should tell you everything you 
need to know :)

Briefly, no matter what node consumers connect to, they will all end up 
consuming from the 'master' queue.

Regards,

Matthias.

From ste.bossi at gmail.com  Thu Sep  8 13:40:18 2011
From: ste.bossi at gmail.com (steeeveb)
Date: Thu, 8 Sep 2011 05:40:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Italian RabbitMQ meeting proposal
In-Reply-To: <0d969893-3c02-47a1-80b4-d634d43a3546@mx.voismart.com>
References: <0d969893-3c02-47a1-80b4-d634d43a3546@mx.voismart.com>
Message-ID: <4e0be965-55b8-429e-992a-e954bf1a01e8@h14g2000yqi.googlegroups.com>

I vote for Milano!

On Sep 8, 2:36?pm, Matteo <mbrancale... at voismart.it> wrote:
> Hi,
>
> any idea on the location?
> if not too far from me I can vote yes :)
>
> Regards,
> Matteo.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From jakub at rabbitmq.com  Thu Sep  8 13:52:47 2011
From: jakub at rabbitmq.com (Jakub Stastny)
Date: Thu, 8 Sep 2011 13:52:47 +0100
Subject: [rabbitmq-discuss] Italian RabbitMQ meeting proposal
In-Reply-To: <CAOn7oW9M7CegKCjadjwFUiN=NABbYeDWtr+0bAn65p8UzpKRFw@mail.gmail.com>
References: <CAOn7oW9M7CegKCjadjwFUiN=NABbYeDWtr+0bAn65p8UzpKRFw@mail.gmail.com>
Message-ID: <D59CE1BF5E5A4CD486BE2C94753697A5@rabbitmq.com>

 I'd be happy to talk about AMQP libraries for Ruby if it's what the aim group would be interested in.  

Cheers,  

--  
Jakub Stastny
http://twitter.com/botanicus

El Wednesday, 17 August 2011 a las 19:12, Simone Busoli escribi?:

> Hi, we would like to organize a one-day meeting in Italy about RabbitMQ. There is no agenda yet, although it would ideally entail real-life experiences and usage patterns, as well as anything speakers would like to talk about.
> Everyone is welcome to attend or speak, and in order to get a sense of how many people would be attending we've setup a brief survey that I invite you to take a few seconds to fill at this url: http://svy.mk/rabbitmq_italian_meeting_survey
>  
> Thanks  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110908/6e909956/attachment.htm>

From videlalvaro at gmail.com  Thu Sep  8 14:05:19 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 8 Sep 2011 15:05:19 +0200
Subject: [rabbitmq-discuss] Italian RabbitMQ meeting proposal
In-Reply-To: <D59CE1BF5E5A4CD486BE2C94753697A5@rabbitmq.com>
References: <CAOn7oW9M7CegKCjadjwFUiN=NABbYeDWtr+0bAn65p8UzpKRFw@mail.gmail.com>
	<D59CE1BF5E5A4CD486BE2C94753697A5@rabbitmq.com>
Message-ID: <CAMcAHLXNXWaj9A9kVPjZJc0cRz225gh=04H+xM=wW7-+pUdxtg@mail.gmail.com>

I vote for Milano too.

I'd like to give a talk about Messaging Patterns with RabbitMQ if people is
interested in it.

Cheers,

Alvaro

On Thu, Sep 8, 2011 at 2:52 PM, Jakub Stastny <jakub at rabbitmq.com> wrote:

>  I'd be happy to talk about AMQP libraries for Ruby if it's what the aim
> group would be interested in.
>
> Cheers,
>
> --
> Jakub Stastny
> http://twitter.com/botanicus
>
> El Wednesday, 17 August 2011 a las 19:12, Simone Busoli escribi?:
>
> Hi, we would like to organize a one-day meeting in Italy about RabbitMQ. There
> is no agenda yet, although it would ideally entail real-life experiences and
> usage patterns, as well as anything speakers would like to talk about.
> Everyone is welcome to attend or speak, and in order to get a sense of how
> many people would be attending we've setup a brief survey that I invite you
> to take a few seconds to fill at this url:
> http://svy.mk/rabbitmq_italian_meeting_survey
>
> Thanks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110908/d2a67759/attachment.htm>

From john at graavy.com  Thu Sep  8 14:28:59 2011
From: john at graavy.com (John Lemp)
Date: Thu, 8 Sep 2011 06:28:59 -0700 (PDT)
Subject: [rabbitmq-discuss] active/active HA and publishers/consumers
In-Reply-To: <eed7ba3b-d868-4833-90e6-7a0741434c6f@v18g2000yqj.googlegroups.com>
References: <eed7ba3b-d868-4833-90e6-7a0741434c6f@v18g2000yqj.googlegroups.com>
Message-ID: <6237a3ed-c275-40d6-88c2-56f36ba57146@g31g2000yqh.googlegroups.com>


I have read http://www.rabbitmq.com/ha.html several times but the only
specifics I see regarding client behavior is to use Consumer
Cancellation Notifications to re-consume from the queue, but can't
find any recommendations/example/best practices on how the client
should locate the new master?

Is there more documentation that I may be missing or examples
possibly?

From matthew at rabbitmq.com  Thu Sep  8 14:33:57 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Sep 2011 14:33:57 +0100
Subject: [rabbitmq-discuss] active/active HA and publishers/consumers
In-Reply-To: <6237a3ed-c275-40d6-88c2-56f36ba57146@g31g2000yqh.googlegroups.com>
References: <eed7ba3b-d868-4833-90e6-7a0741434c6f@v18g2000yqj.googlegroups.com>
	<6237a3ed-c275-40d6-88c2-56f36ba57146@g31g2000yqh.googlegroups.com>
Message-ID: <20110908133357.GF2369@rabbitmq.com>

On Thu, Sep 08, 2011 at 06:28:59AM -0700, John Lemp wrote:
> 
> I have read http://www.rabbitmq.com/ha.html several times but the only
> specifics I see regarding client behavior is to use Consumer
> Cancellation Notifications to re-consume from the queue, but can't
> find any recommendations/example/best practices on how the client
> should locate the new master?

The client shouldn't care. The point of a cluster is to have one logical
broker spread over several machines. All resources are available from
all machines. Unless you're hitting performance issues, you shouldn't
care which node to connect to: the nodes in the cluster will correctly
forward traffic around.

Matthew

From matthew at rabbitmq.com  Thu Sep  8 14:45:01 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Sep 2011 14:45:01 +0100
Subject: [rabbitmq-discuss] active/active HA and publishers/consumers
In-Reply-To: <20110908133357.GF2369@rabbitmq.com>
References: <eed7ba3b-d868-4833-90e6-7a0741434c6f@v18g2000yqj.googlegroups.com>
	<6237a3ed-c275-40d6-88c2-56f36ba57146@g31g2000yqh.googlegroups.com>
	<20110908133357.GF2369@rabbitmq.com>
Message-ID: <20110908134500.GG2369@rabbitmq.com>

On Thu, Sep 08, 2011 at 02:33:57PM +0100, Matthew Sackman wrote:
> On Thu, Sep 08, 2011 at 06:28:59AM -0700, John Lemp wrote:
> > I have read http://www.rabbitmq.com/ha.html several times but the only
> > specifics I see regarding client behavior is to use Consumer
> > Cancellation Notifications to re-consume from the queue, but can't
> > find any recommendations/example/best practices on how the client
> > should locate the new master?
> 
> The client shouldn't care. The point of a cluster is to have one logical
> broker spread over several machines. All resources are available from
> all machines. Unless you're hitting performance issues, you shouldn't
> care which node to connect to: the nodes in the cluster will correctly
> forward traffic around.

Thus, if you want to put transparent TCP proxies in front in order to
load-balance connections, or to do round-robin across the different
nodes in order to insulate clients from having to know how many nodes
there are and what they're called, etc, then that will be fine.

Hopefully, only in high-performance and/or low-latency use cases should
you be concerned about the number of hops messages are taking within the
cluster.

Matthew

From ste.martin at gmail.com  Thu Sep  8 14:40:19 2011
From: ste.martin at gmail.com (Steve Martin)
Date: Thu, 8 Sep 2011 06:40:19 -0700 (PDT)
Subject: [rabbitmq-discuss] active/active HA and publishers/consumers
In-Reply-To: <6237a3ed-c275-40d6-88c2-56f36ba57146@g31g2000yqh.googlegroups.com>
References: <eed7ba3b-d868-4833-90e6-7a0741434c6f@v18g2000yqj.googlegroups.com>
	<6237a3ed-c275-40d6-88c2-56f36ba57146@g31g2000yqh.googlegroups.com>
Message-ID: <bf52cf50-5a9a-4682-8d8f-1bbdd8d89b88@l28g2000yqh.googlegroups.com>

I, too, would like to echo John's initial query.
I have an active/active HA cluster and would like to seek some
guidance on how best to configure my system with regards to how to
know where to publish to/consume from.
If the master fails and a slave is promoted, how do I know what the
new master is or can I publish to the slave (my thoughts are no but I
have to ask)?

The Rabbit documentation describes rabbitmq configuration admirably
but (in my case at least) I feel it would be beneficial to include
some real-world use-cases.
I'll caveat my naivete by saying that I have been working with
RabbitMQ for the grand total of almost three days now.
Any advice gratefully received.

On Sep 8, 2:28?pm, John Lemp <j... at graavy.com> wrote:
> I have readhttp://www.rabbitmq.com/ha.htmlseveral times but the only
> specifics I see regarding client behavior is to use Consumer
> Cancellation Notifications to re-consume from the queue, but can't
> find any recommendations/example/best practices on how the client
> should locate the new master?
>
> Is there more documentation that I may be missing or examples
> possibly?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Thu Sep  8 15:03:13 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Sep 2011 15:03:13 +0100
Subject: [rabbitmq-discuss] active/active HA and publishers/consumers
In-Reply-To: <bf52cf50-5a9a-4682-8d8f-1bbdd8d89b88@l28g2000yqh.googlegroups.com>
References: <eed7ba3b-d868-4833-90e6-7a0741434c6f@v18g2000yqj.googlegroups.com>
	<6237a3ed-c275-40d6-88c2-56f36ba57146@g31g2000yqh.googlegroups.com>
	<bf52cf50-5a9a-4682-8d8f-1bbdd8d89b88@l28g2000yqh.googlegroups.com>
Message-ID: <20110908140313.GH2369@rabbitmq.com>

On Thu, Sep 08, 2011 at 06:40:19AM -0700, Steve Martin wrote:
> I, too, would like to echo John's initial query.
> I have an active/active HA cluster and would like to seek some
> guidance on how best to configure my system with regards to how to
> know where to publish to/consume from.
> If the master fails and a slave is promoted, how do I know what the
> new master is or can I publish to the slave (my thoughts are no but I
> have to ask)?

You can publish from _any_ node in the cluster. It doesn't matter. The
nodes in the cluster know where the master is and will forward
publications internally.

Matthew

From matthew at rabbitmq.com  Thu Sep  8 15:06:03 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Sep 2011 15:06:03 +0100
Subject: [rabbitmq-discuss] active/active HA and publishers/consumers
In-Reply-To: <20110908140313.GH2369@rabbitmq.com>
References: <eed7ba3b-d868-4833-90e6-7a0741434c6f@v18g2000yqj.googlegroups.com>
	<6237a3ed-c275-40d6-88c2-56f36ba57146@g31g2000yqh.googlegroups.com>
	<bf52cf50-5a9a-4682-8d8f-1bbdd8d89b88@l28g2000yqh.googlegroups.com>
	<20110908140313.GH2369@rabbitmq.com>
Message-ID: <20110908140603.GI2369@rabbitmq.com>

On Thu, Sep 08, 2011 at 03:03:13PM +0100, Matthew Sackman wrote:
> On Thu, Sep 08, 2011 at 06:40:19AM -0700, Steve Martin wrote:
> > I, too, would like to echo John's initial query.
> > I have an active/active HA cluster and would like to seek some
> > guidance on how best to configure my system with regards to how to
> > know where to publish to/consume from.
> > If the master fails and a slave is promoted, how do I know what the
> > new master is or can I publish to the slave (my thoughts are no but I
> > have to ask)?
> 
> You can publish from _any_ node in the cluster. It doesn't matter. The
> nodes in the cluster know where the master is and will forward
> publications internally.

Don't forget that you publish to _exchanges_ not queues (though the
nameless exchange exists to provide a mechanism which does allow
addressing of queues). Consequently the queues to which the message is
destined could be on any number of different nodes within the cluster.
In such a scenario, there is no "right" node to publish to.

Matthew

From uday.subbarayan at yahoo.com  Thu Sep  8 15:18:51 2011
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Thu, 8 Sep 2011 07:18:51 -0700 (PDT)
Subject: [rabbitmq-discuss] Load Balancing Consumers
Message-ID: <1315491531.43102.YahooMailNeo@web44904.mail.sp1.yahoo.com>

Hello All,
???????? I have a need to load balance consumers on a queue. I saw a similar thread last month-
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014533.html

My requirements are little different. Publisher ----> sends messages ---> Queue <------ 1 or more consumers listens on this queue.

All my consumers are the same application. I need to load balance(simple round robin) the consumers so that my load gets distributed. For example if i have 2 consumers and publishers sends 2 messages to the queue, message 1 should go to consumer 1 and message 2 should to consumer 2 and this logic repeats.

Any idea/thoughts how i can achieve this in Rabbit MQ?

Thanks,
-Uday.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110908/087ae227/attachment.htm>

From ekirpichov at gmail.com  Thu Sep  8 15:20:39 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 8 Sep 2011 18:20:39 +0400
Subject: [rabbitmq-discuss] Load Balancing Consumers
In-Reply-To: <1315491531.43102.YahooMailNeo@web44904.mail.sp1.yahoo.com>
References: <1315491531.43102.YahooMailNeo@web44904.mail.sp1.yahoo.com>
Message-ID: <CANVKUrX1OKyZgT7EBjONgadq9W56C4JAphF5OkEMYxctXmGCgg@mail.gmail.com>

You will achieve this with RabbitMQ out of the box. It already does
loadbalancing between consumers, giving exactly what you want if you
set a low or zero value for prefetch (BasicQos).

On Thu, Sep 8, 2011 at 6:18 PM, Uday Subbarayan
<uday.subbarayan at yahoo.com> wrote:
> Hello All,
> ???????? I have a need to load balance consumers on a queue. I saw a similar
> thread last month-
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014533.html
>
> My requirements are little different. Publisher ----> sends messages --->
> Queue <------ 1 or more consumers listens on this queue.
>
> All my consumers are the same application. I need to load balance(simple
> round robin) the consumers so that my load gets distributed. For example if
> i have 2 consumers and publishers sends 2 messages to the queue, message 1
> should go to consumer 1 and message 2 should to consumer 2 and this logic
> repeats.
>
> Any idea/thoughts how i can achieve this in Rabbit MQ?
>
> Thanks,
> -Uday.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From ekirpichov at gmail.com  Thu Sep  8 15:20:49 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 8 Sep 2011 18:20:49 +0400
Subject: [rabbitmq-discuss] Load Balancing Consumers
In-Reply-To: <CANVKUrX1OKyZgT7EBjONgadq9W56C4JAphF5OkEMYxctXmGCgg@mail.gmail.com>
References: <1315491531.43102.YahooMailNeo@web44904.mail.sp1.yahoo.com>
	<CANVKUrX1OKyZgT7EBjONgadq9W56C4JAphF5OkEMYxctXmGCgg@mail.gmail.com>
Message-ID: <CANVKUrWc8VadvfdHhNcmC1ugTLm4qkrEp+29vmdwo-uqs=p1Vw@mail.gmail.com>

Oops, not zero, but 1.

On Thu, Sep 8, 2011 at 6:20 PM, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
> You will achieve this with RabbitMQ out of the box. It already does
> loadbalancing between consumers, giving exactly what you want if you
> set a low or zero value for prefetch (BasicQos).
>
> On Thu, Sep 8, 2011 at 6:18 PM, Uday Subbarayan
> <uday.subbarayan at yahoo.com> wrote:
>> Hello All,
>> ???????? I have a need to load balance consumers on a queue. I saw a similar
>> thread last month-
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014533.html
>>
>> My requirements are little different. Publisher ----> sends messages --->
>> Queue <------ 1 or more consumers listens on this queue.
>>
>> All my consumers are the same application. I need to load balance(simple
>> round robin) the consumers so that my load gets distributed. For example if
>> i have 2 consumers and publishers sends 2 messages to the queue, message 1
>> should go to consumer 1 and message 2 should to consumer 2 and this logic
>> repeats.
>>
>> Any idea/thoughts how i can achieve this in Rabbit MQ?
>>
>> Thanks,
>> -Uday.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From matthew at rabbitmq.com  Thu Sep  8 15:22:39 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Sep 2011 15:22:39 +0100
Subject: [rabbitmq-discuss] Load Balancing Consumers
In-Reply-To: <1315491531.43102.YahooMailNeo@web44904.mail.sp1.yahoo.com>
References: <1315491531.43102.YahooMailNeo@web44904.mail.sp1.yahoo.com>
Message-ID: <20110908142238.GJ2369@rabbitmq.com>

Hi Uday,

On Thu, Sep 08, 2011 at 07:18:51AM -0700, Uday Subbarayan wrote:
> ???????? I have a need to load balance consumers on a queue. I saw a similar thread last month-
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014533.html
> 
> My requirements are little different. Publisher ----> sends messages ---> Queue <------ 1 or more consumers listens on this queue.
> 
> All my consumers are the same application. I need to load balance(simple round robin) the consumers so that my load gets distributed. For example if i have 2 consumers and publishers sends 2 messages to the queue, message 1 should go to consumer 1 and message 2 should to consumer 2 and this logic repeats.
> 
> Any idea/thoughts how i can achieve this in Rabbit MQ?

In your application, in both consumers, before issuing the
basic.consume, issue a basic.qos with prefect_count = 1. Make sure you
are not using no_ack = true (i.e. you are explicitly acking messages you
receive).

Matthew

From mikeb at rabbitmq.com  Thu Sep  8 15:22:42 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Thu, 08 Sep 2011 15:22:42 +0100
Subject: [rabbitmq-discuss] Load Balancing Consumers
In-Reply-To: <1315491531.43102.YahooMailNeo@web44904.mail.sp1.yahoo.com>
References: <1315491531.43102.YahooMailNeo@web44904.mail.sp1.yahoo.com>
Message-ID: <4E68CFB2.6080405@rabbitmq.com>

> I have a need to load balance consumers on a queue. I saw a similar
> thread last month-
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014533.html
>
> My requirements are little different. Publisher ----> sends messages
> ---> Queue <------ 1 or more consumers listens on this queue.
>
> All my consumers are the same application. I need to load balance(simple
> round robin) the consumers so that my load gets distributed. For example
> if i have 2 consumers and publishers sends 2 messages to the queue,
> message 1 should go to consumer 1 and message 2 should to consumer 2 and
> this logic repeats.
>
> Any idea/thoughts how i can achieve this in Rabbit MQ?

This is exactly what RabbitMQ will do if you connect multiple consumers 
to a queue.  You may have to be careful with setting basic.qos.  See 
http://www.rabbitmq.com/tutorials/tutorial-two-python.html


-Michael

From uday.subbarayan at yahoo.com  Thu Sep  8 15:32:00 2011
From: uday.subbarayan at yahoo.com (Uday Subbarayan)
Date: Thu, 8 Sep 2011 07:32:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Load Balancing Consumers
In-Reply-To: <4E68CFB2.6080405@rabbitmq.com>
References: <1315491531.43102.YahooMailNeo@web44904.mail.sp1.yahoo.com>
	<4E68CFB2.6080405@rabbitmq.com>
Message-ID: <1315492320.82821.YahooMailNeo@web44916.mail.sp1.yahoo.com>

Thank you Michael & Matthew. I will read this documentation.

Best,
-Uday.

?
-------------------------
I do not blog but e-write:
http://uds-web.blogspot.com


________________________________
From: Michael Bridgen <mikeb at rabbitmq.com>
To: rabbitmq-discuss at lists.rabbitmq.com
Sent: Thursday, September 8, 2011 7:22 AM
Subject: Re: [rabbitmq-discuss] Load Balancing Consumers

> I have a need to load balance consumers on a queue. I saw a similar
> thread last month-
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014533.html
>
> My requirements are little different. Publisher ----> sends messages
> ---> Queue <------ 1 or more consumers listens on this queue.
>
> All my consumers are the same application. I need to load balance(simple
> round robin) the consumers so that my load gets distributed. For example
> if i have 2 consumers and publishers sends 2 messages to the queue,
> message 1 should go to consumer 1 and message 2 should to consumer 2 and
> this logic repeats.
>
> Any idea/thoughts how i can achieve this in Rabbit MQ?

This is exactly what RabbitMQ will do if you connect multiple consumers 
to a queue.? You may have to be careful with setting basic.qos.? See 
http://www.rabbitmq.com/tutorials/tutorial-two-python.html


-Michael
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110908/cb9507db/attachment.htm>

From francois at teksol.info  Thu Sep  8 15:33:30 2011
From: francois at teksol.info (=?utf-8?Q?Fran=C3=A7ois_Beausoleil?=)
Date: Thu, 8 Sep 2011 10:33:30 -0400
Subject: [rabbitmq-discuss] RabbitMQ 2.6.0 failing to start (Debian
 Package)
In-Reply-To: <20110908114057.GB2369@rabbitmq.com>
References: <CAEUMe+TWvGBEUO7b6=eMLc3rPS=nP1PkyJKwhw3E7Efsj841Lg@mail.gmail.com>
	<20110902081226.GA23535@wellquite.org>
	<loom.20110906T173115-801@post.gmane.org>
	<20110908114057.GB2369@rabbitmq.com>
Message-ID: <545DAF98C4BD414BB7C578EE426E6325@ftml.net>



Le jeudi 8 septembre 2011 ? 07:40, Matthew Sackman a ?crit :

> On Tue, Sep 06, 2011 at 03:35:22PM +0000, Fran?ois Beausoleil wrote:
> > I have applied Matthew's patch,
> Err, I didn't write that patch.
Sorry, my mistake. I meant Philip's patch.

> > and my VM fails to boot. I'm on Ubuntu 11.04,
> > and while booting the console writes "Starting rabbitmq-server: " - and
> > then nothing. The boot process is hung. I have to kill  
> > my VM and start in a new one, which still fails to boot anyway.
>  
> Could you see what cat /var/log/rabbitmq/startup* gives you? Is
> /var/run/rabbitmq being created? Is there a pid file in there?
>  
I found my problem: I had failed to put the mochiweb plugin in plugins/. I found my problem after removing all plugins and noticing that RabbitMQ started just fine.

Thanks for replying!
Fran?ois


From pierre-marie.padiou at morpho.com  Thu Sep  8 15:34:52 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Thu, 8 Sep 2011 16:34:52 +0200
Subject: [rabbitmq-discuss] Compatibility AMQP 0.9.1/1.0.0
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C5091274820259@Y000IMRV01.rd1.rf1>

Hello,

I heard version 1.0.0 of amqp was about to be defined (if not already). Do you guys plan to make rabbitmq compatible with this new version? If so, will you maintain backward compatibility? If so, for how long?

Thanks!

Pierre-Marie
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110908/32e254cd/attachment.htm>

From simon at rabbitmq.com  Thu Sep  8 15:50:30 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 08 Sep 2011 15:50:30 +0100
Subject: [rabbitmq-discuss] Compatibility AMQP 0.9.1/1.0.0
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C5091274820259@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C5091274820259@Y000IMRV01.rd1.rf1>
Message-ID: <4E68D636.4060805@rabbitmq.com>

On 08/09/11 15:34, PADIOU Pierre-Marie (MORPHO) wrote:
> I heard version 1.0.0 of amqp was about to be defined (if not already).

Yes, it'll be finalised fairly soon.

> Do you guys plan to make rabbitmq compatible with this new version?

I don't personally view it as a new version, despite the name. It's 
really a very different thing, and is much more focussed on 
interoperability than 0-9-1 (i.e. 0-9-1 defines a broker model and gives 
you quite a few guarantees; 1.0 only really tells you how to get 
messages from point A to point B so it's easier to bolt on the side of 
an existing broker). In some ways it's more like a super-STOMP than 
prior versions of AMQP.

We have done some work on 1.0 support but I don't expect it'll be ready 
for prime time for quite a while.

> If so, will you maintain backward compatibility? If so, for how long?

Matthias hates it when I make forward-looking statements. But I find it 
very hard to imagine us removing support for 0-9-1 any time soon - loads 
of people use it, it gives you things 1.0 doesn't, and migrating is 
non-trivial.

For perspective, we also don't have any plans to remove 0-8 support. 
Lots of people still use *that* even though it's very similar to 0-9-1.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at lemansholdings.co.uk  Thu Sep  8 16:25:20 2011
From: steve at lemansholdings.co.uk (Steve Martin)
Date: Thu, 8 Sep 2011 16:25:20 +0100
Subject: [rabbitmq-discuss] active/active HA and publishers/consumers
In-Reply-To: <20110908140313.GH2369@rabbitmq.com>
References: <eed7ba3b-d868-4833-90e6-7a0741434c6f@v18g2000yqj.googlegroups.com>
	<6237a3ed-c275-40d6-88c2-56f36ba57146@g31g2000yqh.googlegroups.com>
	<bf52cf50-5a9a-4682-8d8f-1bbdd8d89b88@l28g2000yqh.googlegroups.com>
	<20110908140313.GH2369@rabbitmq.com>
Message-ID: <CA+cAUktF04aGQpOcLUcXaaFX5P8mHYPnmnTodA=nSbzO0sRiJg@mail.gmail.com>

It suddenly clicked, thank you.
I had in my mind the model of database log-shipping, which was incorrect.

On a tangential albeit related note, can anyone suggest an approach for
rigging up a load balancer in a development environment in order that I may
test out my application and HA cluster?
I currently have a number of VMs running RMQ in the cluster (several
instances of VMWare player running Ubunto 10.10 as I preferred modelling the
ultimate production scenario rather than setting up a single machine
cluster)
Is there a simple load balancing virtual appliance that can be used in the
same manner, and will this open up a networking can of worms? (I'm
predominately a software tech rather than a networker)

Steve

On 8 September 2011 15:03, Matthew Sackman <matthew at rabbitmq.com> wrote:

> On Thu, Sep 08, 2011 at 06:40:19AM -0700, Steve Martin wrote:
> > I, too, would like to echo John's initial query.
> > I have an active/active HA cluster and would like to seek some
> > guidance on how best to configure my system with regards to how to
> > know where to publish to/consume from.
> > If the master fails and a slave is promoted, how do I know what the
> > new master is or can I publish to the slave (my thoughts are no but I
> > have to ask)?
>
> You can publish from _any_ node in the cluster. It doesn't matter. The
> nodes in the cluster know where the master is and will forward
> publications internally.
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110908/9575b03a/attachment.htm>

From john at graavy.com  Thu Sep  8 16:38:47 2011
From: john at graavy.com (John Lemp)
Date: Thu, 8 Sep 2011 08:38:47 -0700 (PDT)
Subject: [rabbitmq-discuss] active/active HA and publishers/consumers
In-Reply-To: <CA+cAUktF04aGQpOcLUcXaaFX5P8mHYPnmnTodA=nSbzO0sRiJg@mail.gmail.com>
References: <eed7ba3b-d868-4833-90e6-7a0741434c6f@v18g2000yqj.googlegroups.com>
	<6237a3ed-c275-40d6-88c2-56f36ba57146@g31g2000yqh.googlegroups.com>
	<bf52cf50-5a9a-4682-8d8f-1bbdd8d89b88@l28g2000yqh.googlegroups.com>
	<20110908140313.GH2369@rabbitmq.com>
	<CA+cAUktF04aGQpOcLUcXaaFX5P8mHYPnmnTodA=nSbzO0sRiJg@mail.gmail.com>
Message-ID: <bcf3421c-cc27-40ae-b51a-94e9f78a2c55@e8g2000vbc.googlegroups.com>

I have used HAProxy locally for dev/testing. The Manning book that is
currently in early access has some good walkthough examples
http://www.manning.com/videla/

-John

On Sep 8, 11:25?am, Steve Martin <st... at lemansholdings.co.uk> wrote:
> It suddenly clicked, thank you.
> I had in my mind the model of database log-shipping, which was incorrect.
>
> On a tangential albeit related note, can anyone suggest an approach for
> rigging up a load balancer in a development environment in order that I may
> test out my application and HA cluster?
> I currently have a number of VMs running RMQ in the cluster (several
> instances of VMWare player running Ubunto 10.10 as I preferred modelling the
> ultimate production scenario rather than setting up a single machine
> cluster)
> Is there a simple load balancing virtual appliance that can be used in the
> same manner, and will this open up a networking can of worms? (I'm
> predominately a software tech rather than a networker)
>
> Steve
>
> On 8 September 2011 15:03, Matthew Sackman <matt... at rabbitmq.com> wrote:
>
>
>
>
>
>
>
> > On Thu, Sep 08, 2011 at 06:40:19AM -0700, Steve Martin wrote:
> > > I, too, would like to echo John's initial query.
> > > I have an active/active HA cluster and would like to seek some
> > > guidance on how best to configure my system with regards to how to
> > > know where to publish to/consume from.
> > > If the master fails and a slave is promoted, how do I know what the
> > > new master is or can I publish to the slave (my thoughts are no but I
> > > have to ask)?
>
> > You can publish from _any_ node in the cluster. It doesn't matter. The
> > nodes in the cluster know where the master is and will forward
> > publications internally.
>
> > Matthew
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From justin.adam.miller at gmail.com  Thu Sep  8 16:48:40 2011
From: justin.adam.miller at gmail.com (justin.adam.miller at gmail.com)
Date: Thu, 8 Sep 2011 08:48:40 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ using a ton of memory
In-Reply-To: <20110908120712.GC2369@rabbitmq.com>
References: <a61760a3-b8d5-4d12-9088-b54b01e4e944@m10g2000yqo.googlegroups.com>
	<20110907220729.GA4069@wellquite.org>
	<d3b14d32-0b66-4c3b-99c0-fcf6379da612@m18g2000vbe.googlegroups.com>
	<20110908120712.GC2369@rabbitmq.com>
Message-ID: <7984593.1338.1315496920134.JavaMail.geo-discussion-forums@yqap15>



On Thursday, September 8, 2011 8:07:12 AM UTC-4, Matthew Sackman wrote:
>
> Rabbit shouldn't continue to chew up more and more memory so I suspect
> some sort of resource is being created and not destroyed. Could you
> check things like the number of queues, the number of connections and
> channels etc and that those numbers are not growing constantly?
>
Connections remain constant at 50. I only create about a dozen or so queues. 
Channels do increase over time. They start at 386 and grow to 445 by the 
time I hit the high memory mark. Despite the fact that that number does 
grow, it doesn't SEEM unreasonable. 

> 96GB is an awful lot of memory!
>
:-D 

> Agreed. If you can provoke this to happen again, then when you reach
>
> that point could you run "rabbitmqctl report" and send us the output
> (maybe off list if you see anything sensitive in there and/or it's
> huge).
>
Unfortunately, I'm unable to send the output of that. But I did generate it. 
Is there anything in particular I should be looking for? I looked through it 
and I don't see anything that looks out of the ordinary, at least as far as 
I'm concerned :)

It reports that rabbit is using about 70G of memory (which is where the high 
watermark is set), I think around 20G are used by 'processes' and another 
40G+ are used by 'binary' I think?

I never mentioned what versions I'm using:

RabbitMQ: 2.5.1
Erlang: R14B03
Spring AMQP: 1.0.0.RC2

I was previously using R13B03 (or 04) and that displayed the problem much 
faster and additionally would crash RabbitMQ when I started hitting that 
watermark -- probably because I had it set so high (0.75). Using R14B03, I 
can survive much much longer and rabbit no longer crashes. It just sits 
there blocking producers, waiting for consumers to consume, yet there's 
nothing to consume!

Justin

>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110908/d3dd1557/attachment.htm>

From jeanphilippe1.caruana at orange-ftgroup.com  Thu Sep  8 16:36:33 2011
From: jeanphilippe1.caruana at orange-ftgroup.com (jeanphilippe1.caruana at orange-ftgroup.com)
Date: Thu, 8 Sep 2011 17:36:33 +0200
Subject: [rabbitmq-discuss] Thread locked
Message-ID: <4541_1315496193_4E68E101_4541_78283_2_4E68E101.9060307@orange-ftgroup.com>

Hi,

We use RabbitMQ 2.2.0 broker with the 1.8.0 java client.
Producers (direct exhange) are inside webapps (tomcat 6) that go to out 
of memory error and we can't explain why. When we do a thread dump, we 
can see we have a locked thread here :

"TP-Processor5744" daemon prio=1 tid=0x1b974760 nid=0x7687 runnable 
[0x1430b000..0x1430be40]
at java.net.SocketOutputStream.socketWrite0(Native Method)
at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)
at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
- locked <0x2eb153f8> (a java.io.BufferedOutputStream)
at java.io.DataOutputStream.flush(DataOutputStream.java:106)
at 
com.rabbitmq.client.impl.SocketFrameHandler.writeFrame(SocketFrameHandler.java:146)
- locked <0x2eb152d0> (a java.io.DataOutputStream)
at com.rabbitmq.client.impl.AMQConnection.writeFrame(AMQConnection.java:425)
at com.rabbitmq.client.impl.AMQCommand.transmit(AMQCommand.java:182)
at 
com.rabbitmq.client.impl.AMQChannel.quiescingTransmit(AMQChannel.java:315)
- locked <0x2eb1dc10> (a java.lang.Object)
at com.rabbitmq.client.impl.AMQChannel.transmit(AMQChannel.java:291)
- locked <0x2eb1dc10> (a java.lang.Object)
at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:403)
at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:390)


What is going wrong ?
How can java.net.SocketOutputStream.socketWrite be locking everything else ?
How much asynchronous is publishing ?

thanks

-- 
Jean-Philippe Caruana
























********************************************************************************
IMPORTANT.Les informations contenues dans ce message electronique y compris les fichiers attaches sont strictement confidentielles
et peuvent etre protegees par la loi.
Ce message electronique est destine exclusivement au(x) destinataire(s) mentionne(s) ci-dessus.
Si vous avez recu ce message par erreur ou s il ne vous est pas destine, veuillez immediatement le signaler  a l expediteur et effacer ce message 
et tous les fichiers eventuellement attaches.
Toute lecture, exploitation ou transmission des informations contenues dans ce message est interdite.
Tout message electronique est susceptible d alteration.
A ce titre, le Groupe France Telecom decline toute responsabilite notamment s il a ete altere, deforme ou falsifie.
De meme, il appartient au destinataire de s assurer de l absence de tout virus.

IMPORTANT.This e-mail message and any attachments are strictly confidential and may be protected by law. This message is
intended only for the named recipient(s) above.
If you have received this message in error, or are not the named recipient(s), please immediately notify the sender and delete this e-mail message.
Any unauthorized view, usage or disclosure ofthis message is prohibited.
Since e-mail messages may not be reliable, France Telecom Group shall not be liable for any message if modified, changed or falsified.
Additionally the recipient should ensure they are actually virus free.
********************************************************************************


From matthew at rabbitmq.com  Thu Sep  8 16:56:56 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Sep 2011 16:56:56 +0100
Subject: [rabbitmq-discuss] RabbitMQ using a ton of memory
In-Reply-To: <7984593.1338.1315496920134.JavaMail.geo-discussion-forums@yqap15>
References: <a61760a3-b8d5-4d12-9088-b54b01e4e944@m10g2000yqo.googlegroups.com>
	<20110907220729.GA4069@wellquite.org>
	<d3b14d32-0b66-4c3b-99c0-fcf6379da612@m18g2000vbe.googlegroups.com>
	<20110908120712.GC2369@rabbitmq.com>
	<7984593.1338.1315496920134.JavaMail.geo-discussion-forums@yqap15>
Message-ID: <20110908155655.GL2369@rabbitmq.com>

Hi Justin,

On Thu, Sep 08, 2011 at 08:48:40AM -0700, justin.adam.miller at gmail.com wrote:
> Connections remain constant at 50. I only create about a dozen or so queues. 
> Channels do increase over time. They start at 386 and grow to 445 by the 
> time I hit the high memory mark. Despite the fact that that number does 
> grow, it doesn't SEEM unreasonable. 

Those are perfectly normal numbers - nothing unreasonable there.

> > Agreed. If you can provoke this to happen again, then when you reach
> > that point could you run "rabbitmqctl report" and send us the output
> > (maybe off list if you see anything sensitive in there and/or it's
> > huge).
> >
> Unfortunately, I'm unable to send the output of that. But I did generate it. 
> Is there anything in particular I should be looking for? I looked through it 
> and I don't see anything that looks out of the ordinary, at least as far as 
> I'm concerned :)

Ok. How many queues are there? They're mainly empty yes?

> It reports that rabbit is using about 70G of memory (which is where the high 
> watermark is set), I think around 20G are used by 'processes' and another 
> 40G+ are used by 'binary' I think?

Are you, by any chance, sending massive messages through Rabbit -
messages that are many 100s of MB or bigger? - I firstly can't
understand how a small/normal number of processes can be eating up 20GB,
and secondly how you can get > 40GB of binaries, unless your messages
are massive.

Matthew

From justin.adam.miller at gmail.com  Thu Sep  8 17:11:18 2011
From: justin.adam.miller at gmail.com (justin.adam.miller at gmail.com)
Date: Thu, 8 Sep 2011 09:11:18 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ using a ton of memory
In-Reply-To: <20110908155655.GL2369@rabbitmq.com>
References: <a61760a3-b8d5-4d12-9088-b54b01e4e944@m10g2000yqo.googlegroups.com>
	<20110907220729.GA4069@wellquite.org>
	<d3b14d32-0b66-4c3b-99c0-fcf6379da612@m18g2000vbe.googlegroups.com>
	<20110908120712.GC2369@rabbitmq.com>
	<7984593.1338.1315496920134.JavaMail.geo-discussion-forums@yqap15>
	<20110908155655.GL2369@rabbitmq.com>
Message-ID: <14960485.1444.1315498278517.JavaMail.geo-discussion-forums@yqgn17>



On Thursday, September 8, 2011 11:56:56 AM UTC-4, Matthew Sackman wrote:
>
> Ok. How many queues are there? They're mainly empty yes?
>
We have 12-18 queues (don't have an exact number). Most are simply bound to 
the default exchange. A few others are bound to a fanout exchange. And yes, 
they're almost always empty. Or at least vacillate a little, but almost 
almost < 2000. And in the tests that I'm running, that's really only for 2 
queues. The rest are mostly unused. 

> Are you, by any chance, sending massive messages through Rabbit -
> messages that are many 100s of MB or bigger? - I firstly can't
> understand how a small/normal number of processes can be eating up 20GB,
> and secondly how you can get > 40GB of binaries, unless your messages
> are massive.
>
Nope. Messages are small. In the kilobyte range. 

Justin

>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110908/5eec760b/attachment.htm>

From michael.s.klishin at gmail.com  Thu Sep  8 17:14:52 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 8 Sep 2011 20:14:52 +0400
Subject: [rabbitmq-discuss] Thread locked
In-Reply-To: <4541_1315496193_4E68E101_4541_78283_2_4E68E101.9060307@orange-ftgroup.com>
References: <4541_1315496193_4E68E101_4541_78283_2_4E68E101.9060307@orange-ftgroup.com>
Message-ID: <9CCF4BE5-C30C-47C0-8AA7-A487195B4CA0@gmail.com>


> How can java.net.SocketOutputStream.socketWrite be locking everything else ?
> How much asynchronous is publishing ?

SocketFrameHandler.writeFrame does synchronization on the output stream it uses. It is difficult to tell what's going on
from just this stack trace, but

locked <0x2eb153f8> (a java.io.BufferedOutputStream)

makes me believe this *may* be a BufferedOutputStream issue. Deadlocks and running out of memory are usually not related to each other, though. Can you explain how you came to the conclusion about out of memory issues?

Thank you.

MK

From matthew at rabbitmq.com  Thu Sep  8 17:17:24 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Thu, 8 Sep 2011 17:17:24 +0100
Subject: [rabbitmq-discuss] Thread locked
In-Reply-To: <4541_1315496193_4E68E101_4541_78283_2_4E68E101.9060307@orange-ftgroup.com>
References: <4541_1315496193_4E68E101_4541_78283_2_4E68E101.9060307@orange-ftgroup.com>
Message-ID: <20110908161724.GN2369@rabbitmq.com>

On Thu, Sep 08, 2011 at 05:36:33PM +0200, jeanphilippe1.caruana at orange-ftgroup.com wrote:
> We use RabbitMQ 2.2.0 broker with the 1.8.0 java client.

Is there any reason why you're using such an old client? There are many
bugs, including concurrency bugs, that have been fixed since 1.8.0. I
would strongly recommend you upgrade if that's at all possible.

Matthew

From tim.yen at gmail.com  Fri Sep  9 00:53:51 2011
From: tim.yen at gmail.com (Tim Yen)
Date: Fri, 9 Sep 2011 09:53:51 +1000
Subject: [rabbitmq-discuss] Can a Publish be acknowledged.
Message-ID: <CAL_6-TPc=kmd--uM9L6RJP7+eBk9ZnGG=Q8oOtiFoPiRmsqCCA@mail.gmail.com>

Hi,

I'm using Rabbit MQ in .net

What I need to do is get some acknowledgement that a publish has been
successful to an exchange bound to a persistent queue.

I know the queue name and the exchange name.

I'd effectively like an acknowledgment to say "this message was put on to at
least one queue".

is this possible?

Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110909/92afb7c4/attachment.htm>

From alexandru at rabbitmq.com  Fri Sep  9 01:34:01 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 9 Sep 2011 01:34:01 +0100
Subject: [rabbitmq-discuss] Can a Publish be acknowledged.
In-Reply-To: <CAL_6-TPc=kmd--uM9L6RJP7+eBk9ZnGG=Q8oOtiFoPiRmsqCCA@mail.gmail.com>
References: <CAL_6-TPc=kmd--uM9L6RJP7+eBk9ZnGG=Q8oOtiFoPiRmsqCCA@mail.gmail.com>
Message-ID: <20110909003401.GD3410@southbank.Home>

> I'd effectively like an acknowledgment to say "this message was put on to at
> least one queue".
> 
> is this possible?

Yes.

Strictly speaking, you're asking about messages published with the
mandatory flag enabled.  Such a message *must* reach a queue; if it
doesn't, you get a basic.return back.  That said, it's probably not
exactly what you want.  You'll know messages published like this have
reached a queue, but that alone gives you no guarantee that the message
will survive a broker restart.

You probably want publisher acknowledgements for that, aka confirm mode.
After a channel is put into a confirm mode, the broker acknowledges every
publish.  An acknowledgement in this case means "the message has been
handled somehow; don't worry about it"; this usually means that either
the message has reached some queues and was written to disk (and so will
survive a broker death) or that it was delivered to consumers which have
also acknowledged it.

To get the acknowledgement you want, you need to publish both with
mandatory set and to a confirm channel.  If you get a basic.return and
an acknowledgement, that means the message was not delivered to any
queues; if you get just an acknowledgement, that means the broker has
handled the message somehow; if you get a nack, that means the message
was probably lost in some way, so you need to resend it or something.
The broker guarantees that it will eventually acknowledge or nack all
messages published to confirm channels.

See the documentation for IModel:
http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.6.0/rabbitmq-dotnet-client-2.6.0-client-htmldoc/html/type-RabbitMQ.Client.IModel.html

You're looking for ConfirmSelect, to enable confirm mode, BasicPublish,
with mandatory set, and BasicAckEventHandler, BasicNackEventHandler,
BasicReturnEventHandler for the interesting events.

Alternatively, if you're feeling lazy, you can use the new (introduced
in 2.6.0) IModel.WaitForConfirms.  The function waits for all messages
published on the channel so far to be acknowledged or nack'd and returns
true if all of them were acknowledged (or false if some were nack'd).
So, to use it, you'd enable confirm mode with ConfirmSelect, publish
some messages, and call WaitForConfirms.  Note that this does not
handle the case were messages were not routed to any queues (i.e.
basic.returns) and calling it after every message is going to hurt
performance quite a bit.

Hope this helps.

Cheers,
Alex

On Fri, Sep 09, 2011 at 09:53:51AM +1000, Tim Yen wrote:
> Hi,
> 
> I'm using Rabbit MQ in .net
> 
> What I need to do is get some acknowledgement that a publish has been
> successful to an exchange bound to a persistent queue.
> 
> I know the queue name and the exchange name.
> 
> I'd effectively like an acknowledgment to say "this message was put on to at
> least one queue".
> 
> is this possible?
> 
> Tim

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From lefthandmagic at gmail.com  Fri Sep  9 03:38:14 2011
From: lefthandmagic at gmail.com (Praveen M)
Date: Thu, 8 Sep 2011 19:38:14 -0700
Subject: [rabbitmq-discuss] latency in starting/stopping a rabbitmq node
Message-ID: <CAEqX17Oj7JmUDu_KzTG7tsuOfaKEvUQG8tFPHAicTrRJKiDyBw@mail.gmail.com>

Hi,

I'm a rabbitmq newbie and am trying to run some experiments to figure out if
rabbitmq would serve my use case.

I would like to create queues in the order of 100,000s. (one for each of my
customers).

I ran various tests,

I'm using the latest 2.6.0 server and 2.6.0 client, and the following tests
in durable queues mode and in non-durable queues mode.

Tests,
1) to create 1000 queues , produce, consume
2) to create 10000 queues , produce, consume
3) to create 50000 queues, produce and consume.

It works like a charm and the memory usage even with 50,000 queues seem very
reasonable. (the order of 1-1.7G)

However I realized when i wanted to shutdown the broker before starting a
new test, the stop command (rabbitmqctl stop) took a long time
to complete.

I made a small chart of how long the stop command on the broker takes to
execute after the test creates 'N' queues listed below.
Also, in the case of durable queues, i found some weird numbers for the time
taken to restart the queues after a clean/unclean(aborting broker) stop

*NON_DURABLE_QUEUES TEST*
*No of Queues Stop Time*
1000 10.7 seconds
10000 2 minutes
50000 11 minutes

*
*
*DURABLE_QUEUES TEST*
*No of Queues Start Time Stop Time*
1000 2 seconds 10 seconds
10000 24 seconds 2 minutes
10000 after crash it recovers in 20 seconds (on improper shutdown).
50000 even at 6 minutes the queues doesn't start on a improper shutdown


Query 1)
I am curious as to what causes the latency to stop the broker when issued a
rabbitmqctl stop command. It seems to be something to do with the number of
queues created as the stop time increase proportionally as the number of
queues increases.

Query 2)
In the case of durable queues, I measured the time taken to restart the
broker after stopping it (a clean and unclean stop).
I found that even after a clean/unclean stop the time to restart the broker
was just about 20 seconds on an average.
However, in the case where i created 50000 durable queues and did an unclean
stop(just aborted the broker) and tried to restart the broker it didn't
start for over to 6 minutes (when I gave up)...
It was hung in the step of "starting exchange,queue and binding recovery.."
It will be great if someone could explain why this could be caused.

It will be great if someone could answer the above queries or provide me
with some pointers about the same.

Thank you for your help,
-- 
-Praveen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110908/a8b8d9af/attachment.htm>

From jeanphilippe1.caruana at orange-ftgroup.com  Fri Sep  9 09:47:37 2011
From: jeanphilippe1.caruana at orange-ftgroup.com (jeanphilippe1.caruana at orange-ftgroup.com)
Date: Fri, 9 Sep 2011 10:47:37 +0200
Subject: [rabbitmq-discuss] Thread locked
In-Reply-To: <20110908161724.GN2369@rabbitmq.com>
References: <4541_1315496193_4E68E101_4541_78283_2_4E68E101.9060307@orange-ftgroup.com>
	<20110908161724.GN2369@rabbitmq.com>
Message-ID: <4541_1315558057_4E69D2A9_4541_81590_1_4E69D2A9.1030800@orange-ftgroup.com>

On 08/09/2011 18:17, Matthew Sackman wrote:
>> We use RabbitMQ 2.2.0 broker with the 1.8.0 java client.
>
> Is there any reason why you're using such an old client? There are many
> bugs, including concurrency bugs, that have been fixed since 1.8.0. I
> would strongly recommend you upgrade if that's at all possible.

There is no particular reason for that, we just forgot to do it...
It is scheduled to upgrade as soon as possible.

> Matthew

-- 
Jean-Philippe Caruana



































********************************************************************************
IMPORTANT.Les informations contenues dans ce message electronique y compris les fichiers attaches sont strictement confidentielles
et peuvent etre protegees par la loi.
Ce message electronique est destine exclusivement au(x) destinataire(s) mentionne(s) ci-dessus.
Si vous avez recu ce message par erreur ou s il ne vous est pas destine, veuillez immediatement le signaler  a l expediteur et effacer ce message 
et tous les fichiers eventuellement attaches.
Toute lecture, exploitation ou transmission des informations contenues dans ce message est interdite.
Tout message electronique est susceptible d alteration.
A ce titre, le Groupe France Telecom decline toute responsabilite notamment s il a ete altere, deforme ou falsifie.
De meme, il appartient au destinataire de s assurer de l absence de tout virus.

IMPORTANT.This e-mail message and any attachments are strictly confidential and may be protected by law. This message is
intended only for the named recipient(s) above.
If you have received this message in error, or are not the named recipient(s), please immediately notify the sender and delete this e-mail message.
Any unauthorized view, usage or disclosure ofthis message is prohibited.
Since e-mail messages may not be reliable, France Telecom Group shall not be liable for any message if modified, changed or falsified.
Additionally the recipient should ensure they are actually virus free.
********************************************************************************


From andrea.rosa at hp.com  Fri Sep  9 09:53:25 2011
From: andrea.rosa at hp.com (Andrea Rosa)
Date: Fri, 09 Sep 2011 09:53:25 +0100
Subject: [rabbitmq-discuss] questions about log messages and problems with
	connections
Message-ID: <1315558405.13950.10.camel@vicbristol6.hpl.hp.com>

Hi 

I am facing with a big problem with rabbitmq, in a pub sub scenario.
In our scenario when a consumer starts it creates a queue, with
rabbitmqctl command I can see the queue with a single consumer but
sometimes we can find queues without a consumer. In the consumer log
there are no errors or warnings about  broken connections with the
server and with netstat command I can see connection ESTABLISHED with
rabbitmq server but in the rabbitmq file I found this error:
=ERROR REPORT==== 8-Sep-2011::14:13:39 ===
exception on TCP connection <0.27709.5838> from ipaddr:port
{inet_error,etimedout}

When this error occurs?
Unfortunately this problem affects 70% of our nodes!

Analysing the rabbitmq log file I found other strange messages:
=WARNING REPORT==== 8-Sep-2011::14:49:08 ===
exception on TCP connection <0.11485.6171> from ipaddr:port
connection_closed_abruptly

This message is repeated a lot of times in the log file, but It seems
that didn't affect the behaviour of our application. 
It's normal to have so much WARNING messages?

And finally these messages:
=INFO REPORT==== 8-Sep-2011::13:13:13 ===
    alarm_handler: {clear,file_descriptor_limit}

=INFO REPORT==== 8-Sep-2011::13:13:13 ===
    alarm_handler: {set,{file_descriptor_limit,[]}}

These are related with socket problems?

All these messages can be related to the same problem, maybe something
with managing connections?

--
Andrea 


From jeanphilippe1.caruana at orange-ftgroup.com  Fri Sep  9 09:57:08 2011
From: jeanphilippe1.caruana at orange-ftgroup.com (jeanphilippe1.caruana at orange-ftgroup.com)
Date: Fri, 9 Sep 2011 10:57:08 +0200
Subject: [rabbitmq-discuss] Thread locked
In-Reply-To: <9CCF4BE5-C30C-47C0-8AA7-A487195B4CA0@gmail.com>
References: <4541_1315496193_4E68E101_4541_78283_2_4E68E101.9060307@orange-ftgroup.com>
	<9CCF4BE5-C30C-47C0-8AA7-A487195B4CA0@gmail.com>
Message-ID: <16365_1315558628_4E69D4E4_16365_28912_1_4E69D4E4.3060504@orange-ftgroup.com>

Hi,

On 08/09/2011 18:14, Michael Klishin wrote:
>> How can java.net.SocketOutputStream.socketWrite be locking everything else ?
>> How much asynchronous is publishing ?
>
> SocketFrameHandler.writeFrame does synchronization on the output stream it uses. It is difficult to tell what's going on
> from just this stack trace, but
>
> locked<0x2eb153f8>  (a java.io.BufferedOutputStream)
>
> makes me believe this *may* be a BufferedOutputStream issue. Deadlocks and running out of memory are usually not related to each other, though. Can you explain how you came to the conclusion about out of memory issues?

I didn't come to any conclusion : we had several OutOfMemoryError and we 
did a thread dump. According to this dump, the thread lock occured at 
the OutOfMemoryError time when the jvm crashed, that's all I can say for 
now.

You say "this may be a BufferedOutputStream" : what do you mean ? Where 
should I be looking ? What kind of information is needed ?

Thanks for your input.

-- 
Jean-Philippe Caruana

























********************************************************************************
IMPORTANT.Les informations contenues dans ce message electronique y compris les fichiers attaches sont strictement confidentielles
et peuvent etre protegees par la loi.
Ce message electronique est destine exclusivement au(x) destinataire(s) mentionne(s) ci-dessus.
Si vous avez recu ce message par erreur ou s il ne vous est pas destine, veuillez immediatement le signaler  a l expediteur et effacer ce message 
et tous les fichiers eventuellement attaches.
Toute lecture, exploitation ou transmission des informations contenues dans ce message est interdite.
Tout message electronique est susceptible d alteration.
A ce titre, le Groupe France Telecom decline toute responsabilite notamment s il a ete altere, deforme ou falsifie.
De meme, il appartient au destinataire de s assurer de l absence de tout virus.

IMPORTANT.This e-mail message and any attachments are strictly confidential and may be protected by law. This message is
intended only for the named recipient(s) above.
If you have received this message in error, or are not the named recipient(s), please immediately notify the sender and delete this e-mail message.
Any unauthorized view, usage or disclosure ofthis message is prohibited.
Since e-mail messages may not be reliable, France Telecom Group shall not be liable for any message if modified, changed or falsified.
Additionally the recipient should ensure they are actually virus free.
********************************************************************************


From simon at rabbitmq.com  Fri Sep  9 10:44:43 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 Sep 2011 10:44:43 +0100
Subject: [rabbitmq-discuss] questions about log messages and problems
 with	connections
In-Reply-To: <1315558405.13950.10.camel@vicbristol6.hpl.hp.com>
References: <1315558405.13950.10.camel@vicbristol6.hpl.hp.com>
Message-ID: <4E69E00B.5030100@rabbitmq.com>

On 09/09/11 09:53, Andrea Rosa wrote:
> in the rabbitmq file I found this error:
> =ERROR REPORT==== 8-Sep-2011::14:13:39 ===
> exception on TCP connection<0.27709.5838>  from ipaddr:port
> {inet_error,etimedout}
>
> When this error occurs?
> Unfortunately this problem affects 70% of our nodes!

We've only seen this error before when there's a TCP load balancer or 
firewall in between Rabbit and its clients that is somehow futzing with 
TCP connections - could this be happening to you?

> Analysing the rabbitmq log file I found other strange messages:
> =WARNING REPORT==== 8-Sep-2011::14:49:08 ===
> exception on TCP connection<0.11485.6171>  from ipaddr:port
> connection_closed_abruptly
>
> This message is repeated a lot of times in the log file, but It seems
> that didn't affect the behaviour of our application.
> It's normal to have so much WARNING messages?

That just means that a connection was closed at the TCP level without 
going through the AMQP close handshaking. If you're seeing this all the 
time and it's not associated with clients getting disconnected when you 
don't expect it, it could be a badly-written client? Which client are 
you using?

> And finally these messages:
> =INFO REPORT==== 8-Sep-2011::13:13:13 ===
>      alarm_handler: {clear,file_descriptor_limit}
>
> =INFO REPORT==== 8-Sep-2011::13:13:13 ===
>      alarm_handler: {set,{file_descriptor_limit,[]}}
>
> These are related with socket problems?

Ah, that's interesting. On Unix every TCP connection requires a file 
descriptor and often operating systems are configured with a fairly low 
limit (1024 is fairly typical). And Rabbit needs to keep some file 
descriptors back for... files. If you want Rabbit to support large 
numbers of connections, look into raising the limit with limits.conf.

However, even if you're running into the limit then this shouldn't kill 
existing connections, just make Rabbit unable to accept new ones, so I 
think you still have multiple issues to fix I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexandru at rabbitmq.com  Fri Sep  9 11:12:52 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 9 Sep 2011 11:12:52 +0100
Subject: [rabbitmq-discuss] latency in starting/stopping a rabbitmq node
In-Reply-To: <CAEqX17Oj7JmUDu_KzTG7tsuOfaKEvUQG8tFPHAicTrRJKiDyBw@mail.gmail.com>
References: <CAEqX17Oj7JmUDu_KzTG7tsuOfaKEvUQG8tFPHAicTrRJKiDyBw@mail.gmail.com>
Message-ID: <20110909101252.GA10002@southbank.eng.vmware.com>

Hi Praveen,

> However I realized when i wanted to shutdown the broker before starting a
> new test, the stop command (rabbitmqctl stop) took a long time
> to complete.

We are aware of this problem.  The fix is currently going through QA and
will probably be in the next release, which should be around fairly
soon.

> Query 1)
> I am curious as to what causes the latency to stop the broker when issued a
> rabbitmqctl stop command. It seems to be something to do with the number of
> queues created as the stop time increase proportionally as the number of
> queues increases.

Internally, when we terminate a queue, we do a few file operations.  This
is usually not a problem, but when you close a connection with 100 000s
of queues, the same order of file operations get scheduled.  Erlang's
IO system then does some expensive operations of this long queue and
it ends up processing the operations in quadratic time.  The fix going
through QA brings this down to linear time; for instance, I can delete
40k queues in 20s (compared to 211s on the latest release).

> Query 2)
> In the case of durable queues, I measured the time taken to restart the
> broker after stopping it (a clean and unclean stop).
> I found that even after a clean/unclean stop the time to restart the broker
> was just about 20 seconds on an average.
> However, in the case where i created 50000 durable queues and did an unclean
> stop(just aborted the broker) and tried to restart the broker it didn't
> start for over to 6 minutes (when I gave up)...
> It was hung in the step of "starting exchange,queue and binding recovery.."
> It will be great if someone could explain why this could be caused.

I can't reproduce this.  Declaring 100 000 durable queues, killing the broker
and re-starting it seems to work fine.  It takes about 1 min on my
machine.

Is it really hung?  Is it using the CPU or disk at all at this time?  Is
there anything in the logs (both the rabbit and SASL logs)?

> It will be great if someone could answer the above queries or provide me
> with some pointers about the same.

There's not much you can do at the moment except avoiding terminating a
large number of queues at the same time.

Hope this clears things up.

Cheers,
Alex

On Thu, Sep 08, 2011 at 07:38:14PM -0700, Praveen M wrote:
> Hi,
> 
> I'm a rabbitmq newbie and am trying to run some experiments to figure out if
> rabbitmq would serve my use case.
> 
> I would like to create queues in the order of 100,000s. (one for each of my
> customers).
> 
> I ran various tests,
> 
> I'm using the latest 2.6.0 server and 2.6.0 client, and the following tests
> in durable queues mode and in non-durable queues mode.
> 
> Tests,
> 1) to create 1000 queues , produce, consume
> 2) to create 10000 queues , produce, consume
> 3) to create 50000 queues, produce and consume.
> 
> It works like a charm and the memory usage even with 50,000 queues seem very
> reasonable. (the order of 1-1.7G)
> 
> However I realized when i wanted to shutdown the broker before starting a
> new test, the stop command (rabbitmqctl stop) took a long time
> to complete.
> 
> I made a small chart of how long the stop command on the broker takes to
> execute after the test creates 'N' queues listed below.
> Also, in the case of durable queues, i found some weird numbers for the time
> taken to restart the queues after a clean/unclean(aborting broker) stop
> 
> *NON_DURABLE_QUEUES TEST*
> *No of Queues Stop Time*
> 1000 10.7 seconds
> 10000 2 minutes
> 50000 11 minutes
> 
> *
> *
> *DURABLE_QUEUES TEST
> *No of Queues Start Time Stop Time*
> 1000 2 seconds 10 seconds
> 10000 24 seconds 2 minutes
> 10000 after crash it recovers in 20 seconds (on improper shutdown).
> 50000 even at 6 minutes the queues doesn't start on a improper shutdown
> 
> 
> Query 1)
> I am curious as to what causes the latency to stop the broker when issued a
> rabbitmqctl stop command. It seems to be something to do with the number of
> queues created as the stop time increase proportionally as the number of
> queues increases.
> 
> Query 2)
> In the case of durable queues, I measured the time taken to restart the
> broker after stopping it (a clean and unclean stop).
> I found that even after a clean/unclean stop the time to restart the broker
> was just about 20 seconds on an average.
> However, in the case where i created 50000 durable queues and did an unclean
> stop(just aborted the broker) and tried to restart the broker it didn't
> start for over to 6 minutes (when I gave up)...
> It was hung in the step of "starting exchange,queue and binding recovery.."
> It will be great if someone could explain why this could be caused.
> 
> It will be great if someone could answer the above queries or provide me
> with some pointers about the same.
> 
> Thank you for your help,
> -- 
> -Praveen

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Fri Sep  9 11:49:48 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 09 Sep 2011 11:49:48 +0100
Subject: [rabbitmq-discuss] rabbitmq-tracing - a UI for the firehose
Message-ID: <4E69EF4C.80005@rabbitmq.com>

Another day, another plugin. Let me know what you think.

http://www.rabbitmq.com/blog/2011/09/09/rabbitmq-tracing-a-ui-for-the-firehose/

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From steve at rabbitmq.com  Fri Sep  9 12:28:28 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 9 Sep 2011 12:28:28 +0100
Subject: [rabbitmq-discuss] Stomp: after deleting a durable subscription,
	message is still available
In-Reply-To: <j45oon$2fn$1@dough.gmane.org>
References: <j45oon$2fn$1@dough.gmane.org>
Message-ID: <7C1B7121-6668-42B0-8A37-4AC5C54777A5@rabbitmq.com>

Michael,
Thank you for pointing this out.  In reproducing your results I noticed that I get an error when UNSUBSCRIBE is issued. So that explains why you were still seeing the messages after issuing the UNSUBSCRIBE.

Before a session can cancel a subscription it needs to know about it -- that is what the id is for.

The STOMP 1.1 specification says this about subscription ids:
SUBSCRIBE id Header

An id header MUST be included in the frame to uniquely identify the subscription within the STOMP connection session. Since a single connection can have multiple open subscriptions with a server, the id header allows the client and server to relate subsequent ACK, NACK or UNSUBSCRIBEframes to the original subscription.

and the phrase "uniquely identify the subscription within the STOMP connection session" is the problem.  That implies that the id is *limited in scope* to the session.

In the case of durable subscriptions, as soon as you disconnect your subscription id is no longer in scope.  Reconnecting and using the same id ought to give you a distinct session and therefore a distinct subscription.  But then, what good is a durable subscription if you can never refer to it again??

The solution as adopted in the RabbitMQ STOMP adapter is to make the id on the subscription non-local.  That is, we make it global to the RabbitMQ server.  (Actually, as implied in the RabbitMQ/stomp documentation, we make the *combination of subscription id and (topic) destination* global to the server.)  This means that SUBSCRIBE is the way to reconnect to the same subscription-id x topic, and then you can UNSUBSCRIBE from it (and delete it) successfully.

[Notice what this means: the messages that were sitting "in the topic" for that subscription id are never discarded completely: in order to remove them you must SUBSCRIBE first -- and they are then delivered to you of course.  This is quite a nice 'feature', IMO.]

I think you might have been aware of this, since you used the header "client-id" on your CONNECT frames.  This is not a STOMP header, but might be an ActiveMQ one.  It is not clear to me what the full effect of this header is, but it appears to identify a session context for subscription ids (at least). I notice that when the "durable client" reconnected, the subscriptions were not re-instated (no messages arrived) -- is that what you would expect ActiveMQ to do?

I will raise a bug (we will probably try to behave compatibly with ActiveMQ), and take this up with the STOMP spec group.

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 6 Sep 2011, at 19:28, Michael Justin wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/014915.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110909/3fb7d51b/attachment.htm>

From umut.sahin at vigasis.com  Fri Sep  9 12:45:58 2011
From: umut.sahin at vigasis.com (umut.sahin at vigasis.com)
Date: Fri, 9 Sep 2011 13:45:58 +0200 (CEST)
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
Message-ID: <dudh93g.eb46c499d717f6cce311b9e5e06ebe37@webmail.vigasis.com>

Hi,
We are developing a project that uses rabbitmq with ssl. But we are facing
a problem with .Net Client of our project which cannot connect to our
server. But with Java, with the same configurations we have succeeded. 
We are getting an error which says "none of the specified end points were
reachable".
Our firewall is off on both server and client so its not a firewall issue.

We are using Windows 7 x64 and .Net Framework 4.0 on our problematic
client.
As i said before our Java publisher and consumer works flawlessly but our
publisher must be on .Net Framework for the sake of our projects.
We were suspecting a certificate problem and tried openssl s_client and
openssl s_server but no problems.
We have already tried cert.pem, cert.cer, cert.p12 files on our windows
client but no success.
Waiting for your help.
Detailed exception outputs are below.
Thanks and regards...

Error : None of the specified endpoints were reachable
Endpoints attempted:
------------------------------------------------
endpoint=amqp-0-9://10.35.110.167:5671, attempts=1
System.IO.IOException: Uzak taraf tama akn kapattndan
kimlik dorulamas
 baarsz oldu.
   konum: System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32
readB
ytes, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer,
AsyncProt
ocolRequest asyncRequest)
   konum:
System.Net.Security.SslState.CheckCompletionBeforeNextReceive(Protocol
Token message, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartSendBlob(Byte[] incoming,
Int32 coun
t, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer,
Int32
count, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32
readB
ytes, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer,
AsyncProt
ocolRequest asyncRequest)
   konum:
System.Net.Security.SslState.CheckCompletionBeforeNextReceive(Protocol
Token message, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartSendBlob(Byte[] incoming,
Int32 coun
t, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer,
Int32
count, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32
readB
ytes, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer,
AsyncProt
ocolRequest asyncRequest)
   konum:
System.Net.Security.SslState.CheckCompletionBeforeNextReceive(Protocol
Token message, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartSendBlob(Byte[] incoming,
Int32 coun
t, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer,
Int32
count, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32
readB
ytes, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer,
AsyncProt
ocolRequest asyncRequest)
   konum:
System.Net.Security.SslState.CheckCompletionBeforeNextReceive(Protocol
Token message, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartSendBlob(Byte[] incoming,
Int32 coun
t, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer,
Int32
count, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32
readB
ytes, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer,
AsyncProt
ocolRequest asyncRequest)
   konum:
System.Net.Security.SslState.CheckCompletionBeforeNextReceive(Protocol
Token message, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.StartSendBlob(Byte[] incoming,
Int32 coun
t, AsyncProtocolRequest asyncRequest)
   konum: System.Net.Security.SslState.ForceAuthentication(Boolean
receiveFirst,
 Byte[] buffer, AsyncProtocolRequest asyncRequest)
   konum:
System.Net.Security.SslState.ProcessAuthentication(LazyAsyncResult laz
yResult)
   konum: System.Net.Security.SslStream.AuthenticateAsClient(String
targetHost,
X509CertificateCollection clientCertificates, SslProtocols
enabledSslProtocols,
Boolean checkCertificateRevocation)
   konum: RabbitMQ.Client.SslHelper.TcpUpgrade(Stream tcpStream, SslOption
sslOp
tion)
   konum:
RabbitMQ.Client.Impl.SocketFrameHandler_0_9..ctor(AmqpTcpEndpoint endp
oint)
   konum:
RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateFrameHandler(Am
qpTcpEndpoint endpoint)
   konum: RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32
maxRedirec
ts, IDictionary connectionAttempts, IDictionary connectionErrors,
AmqpTcpEndpoin
t[]& mostRecentKnownHosts, AmqpTcpEndpoint endpoint)
================================================
Stack trace:
   konum: RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32
maxRedirects)

   konum: RabbitMQ.Client.ConnectionFactory.CreateConnection()
   konum: RConsole.SendString.CreateStructure()
C:Usershasanfidandocumentsvi
sual studio 2010ProjectsRConsoleRConsoleSendPacket.cs i?inde: satr 64

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110909/bbaf3628/attachment.htm>

From alexandru at rabbitmq.com  Fri Sep  9 13:33:55 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 9 Sep 2011 13:33:55 +0100
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
In-Reply-To: <dudh93g.eb46c499d717f6cce311b9e5e06ebe37@webmail.vigasis.com>
References: <dudh93g.eb46c499d717f6cce311b9e5e06ebe37@webmail.vigasis.com>
Message-ID: <20110909123355.GB10002@southbank.eng.vmware.com>

Hi,

We haven't had any reported issues with that configuration, so it
should probably work.  Is there anything in the broker logs about this?

> endpoint=amqp-0-9://10.35.110.167:5671, attempts=1
> System.IO.IOException: Uzak taraf tama akn kapattndan
> kimlik dorulamas

I don't suppose you could get an English version of the error, could
you?  The Google Translation doesn't sound familiar.

Also, 1) is the CA's certificate in the Trusted Root Certificate
Authorities store? 2) does the server's hostname match the common name
on the certificate?

> We have already tried cert.pem, cert.cer, cert.p12 files on our windows
> client but no success.

Unless you somehow modified the .NET client, the p12 is the only one
that's usable.

Cheers,
Alex

On Fri, Sep 09, 2011 at 01:45:58PM +0200, umut.sahin at vigasis.com wrote:
> Hi,
> We are developing a project that uses rabbitmq with ssl. But we are facing
> a problem with .Net Client of our project which cannot connect to our
> server. But with Java, with the same configurations we have succeeded.
> We are getting an error which says "none of the specified end points were
> reachable".
> Our firewall is off on both server and client so its not a firewall issue.
> 
> We are using Windows 7 x64 and .Net Framework 4.0 on our problematic
> client.
> As i said before our Java publisher and consumer works flawlessly but our
> publisher must be on .Net Framework for the sake of our projects.
> We were suspecting a certificate problem and tried openssl s_client and
> openssl s_server but no problems.
> We have already tried cert.pem, cert.cer, cert.p12 files on our windows
> client but no success.
> Waiting for your help.
> Detailed exception outputs are below.
> Thanks and regards...
> 
> Error : None of the specified endpoints were reachable
> Endpoints attempted:
> ------------------------------------------------
> endpoint=amqp-0-9://10.35.110.167:5671, attempts=1
> System.IO.IOException: Uzak taraf tama akn kapattndan
> kimlik dorulamas
>  baarsz oldu.
>    konum: System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32
> readB
> ytes, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer,
> AsyncProt
> ocolRequest asyncRequest)
>    konum:
> System.Net.Security.SslState.CheckCompletionBeforeNextReceive(Protocol
> Token message, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartSendBlob(Byte[] incoming,
> Int32 coun
> t, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer,
> Int32
> count, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32
> readB
> ytes, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer,
> AsyncProt
> ocolRequest asyncRequest)
>    konum:
> System.Net.Security.SslState.CheckCompletionBeforeNextReceive(Protocol
> Token message, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartSendBlob(Byte[] incoming,
> Int32 coun
> t, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer,
> Int32
> count, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32
> readB
> ytes, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer,
> AsyncProt
> ocolRequest asyncRequest)
>    konum:
> System.Net.Security.SslState.CheckCompletionBeforeNextReceive(Protocol
> Token message, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartSendBlob(Byte[] incoming,
> Int32 coun
> t, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer,
> Int32
> count, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32
> readB
> ytes, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer,
> AsyncProt
> ocolRequest asyncRequest)
>    konum:
> System.Net.Security.SslState.CheckCompletionBeforeNextReceive(Protocol
> Token message, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartSendBlob(Byte[] incoming,
> Int32 coun
> t, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.ProcessReceivedBlob(Byte[] buffer,
> Int32
> count, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32
> readB
> ytes, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartReceiveBlob(Byte[] buffer,
> AsyncProt
> ocolRequest asyncRequest)
>    konum:
> System.Net.Security.SslState.CheckCompletionBeforeNextReceive(Protocol
> Token message, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.StartSendBlob(Byte[] incoming,
> Int32 coun
> t, AsyncProtocolRequest asyncRequest)
>    konum: System.Net.Security.SslState.ForceAuthentication(Boolean
> receiveFirst,
>  Byte[] buffer, AsyncProtocolRequest asyncRequest)
>    konum:
> System.Net.Security.SslState.ProcessAuthentication(LazyAsyncResult laz
> yResult)
>    konum: System.Net.Security.SslStream.AuthenticateAsClient(String
> targetHost,
> X509CertificateCollection clientCertificates, SslProtocols
> enabledSslProtocols,
> Boolean checkCertificateRevocation)
>    konum: RabbitMQ.Client.SslHelper.TcpUpgrade(Stream tcpStream, SslOption
> sslOp
> tion)
>    konum:
> RabbitMQ.Client.Impl.SocketFrameHandler_0_9..ctor(AmqpTcpEndpoint endp
> oint)
>    konum:
> RabbitMQ.Client.Framing.Impl.v0_9_1.ProtocolBase.CreateFrameHandler(Am
> qpTcpEndpoint endpoint)
>    konum: RabbitMQ.Client.ConnectionFactory.FollowRedirectChain(Int32
> maxRedirec
> ts, IDictionary connectionAttempts, IDictionary connectionErrors,
> AmqpTcpEndpoin
> t[]& mostRecentKnownHosts, AmqpTcpEndpoint endpoint)
> ================================================
> Stack trace:
>    konum: RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32
> maxRedirects)
> 
>    konum: RabbitMQ.Client.ConnectionFactory.CreateConnection()
>    konum: RConsole.SendString.CreateStructure()
> C:Usershasanfidandocumentsvi
> sual studio 2010ProjectsRConsoleRConsoleSendPacket.cs i?inde: satr 64
> 

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From pierre-marie.padiou at morpho.com  Fri Sep  9 14:01:07 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Fri, 9 Sep 2011 15:01:07 +0200
Subject: [rabbitmq-discuss] make a consumer consume no more
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C509127486845F@Y000IMRV01.rd1.rf1>

Hello,

Is there a way for a consumer to < un-consume > from a queue ?

Thanks,

Pierre-Marie
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110909/1100622b/attachment.htm>

From pierre-marie.padiou at morpho.com  Fri Sep  9 14:02:55 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Fri, 9 Sep 2011 15:02:55 +0200
Subject: [rabbitmq-discuss] make a consumer consume no more
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C5091274868463@Y000IMRV01.rd1.rf1>

I realize my message was unclear.

I do not want to put back a message to a queue. I just would like to tell a consumer not to consume anymore from a particular queue.

Pierre-Marie

From: PADIOU Pierre-Marie (MORPHO)
Sent: Friday, September 09, 2011 3:01 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: make a consumer consume no more

Hello,

Is there a way for a consumer to < un-consume > from a queue ?

Thanks,

Pierre-Marie
#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110909/d47dd08f/attachment.htm>

From videlalvaro at gmail.com  Fri Sep  9 14:09:45 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 9 Sep 2011 15:09:45 +0200
Subject: [rabbitmq-discuss] make a consumer consume no more
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C5091274868463@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C5091274868463@Y000IMRV01.rd1.rf1>
Message-ID: <CAMcAHLUiwFt1Au-DQ5z3qXP7dhBCGSOT_9n+ZYR4KPh0rwdisg@mail.gmail.com>

Take a look at this AMQP method:
http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.cancel

On Fri, Sep 9, 2011 at 3:02 PM, PADIOU Pierre-Marie (MORPHO) <
pierre-marie.padiou at morpho.com> wrote:

>  I realize my message was unclear.****
>
> ** **
>
> I do not want to put back a message to a queue. I just would like to tell a
> consumer not to consume anymore from a particular queue.****
>
> ** **
>
> Pierre-Marie****
>
> ** **
>
> *From:* PADIOU Pierre-Marie (MORPHO)
> *Sent:* Friday, September 09, 2011 3:01 PM
> *To:* rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* make a consumer consume no more****
>
> ** **
>
> Hello,****
>
> ** **
>
> Is there a way for a consumer to ? un-consume ? from a queue ?****
>
> ** **
>
> Thanks,****
>
> ** **
>
> Pierre-Marie****
>
> #
> " Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
> ******
> " This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
> #
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110909/44852e08/attachment.htm>

From umut.sahin at vigasis.com  Fri Sep  9 14:31:59 2011
From: umut.sahin at vigasis.com (umut.sahin at vigasis.com)
Date: Fri, 9 Sep 2011 15:31:59 +0200 (CEST)
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
Message-ID: <dudh93g.620850907b1ff48cbe47430b81fe6da1@webmail.vigasis.com>

>We haven't had any reported issues with that configuration, so it
 >should probably work.  Is there anything in the broker logs about this?
 =INFO REPORT==== 9-Sep-2011::16:12:44 ===
 accepted TCP connection on [::]:5671 from 10.35.110.131:4712
 =INFO REPORT==== 9-Sep-2011::16:12:44 ===
 starting TCP connection  from 10.35.110.131:4712
 =ERROR REPORT==== 9-Sep-2011::16:12:49 ===
 error on TCP connection :{ssl_upgrade_error,timeout}
 =INFO REPORT==== 9-Sep-2011::16:12:49 ===
 closing TCP connection 
 Broker logs are above...
 >
 >> endpoint=amqp-0-9://10.35.110.167:5671, attempts=1
 >> System.IO.IOException: Uzak taraf tama akn kapattndan
 >> kimlik dorulamas
 >
 >I don't suppose you could get an English version of the error, could
 >you?  The Google Translation doesn't sound familiar.
 "Authentication failed as remote party has closed the transport stream"
is the translation
 >
 >Also, 1) is the CA's certificate in the Trusted Root Certificate
 >Authorities store? 2) does the server's hostname match the common name
 >on the certificate?
 >
 1) Yes, it is
 2) Yes it does match CN=hostname O=server (like
http://www.rabbitmq.com/ssl.html (http://www.rabbitmq.com/ssl.html)
examples..)
 Thnx in advance,
 Umut
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110909/1d8601ee/attachment.htm>

From majek04 at gmail.com  Fri Sep  9 17:26:48 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 9 Sep 2011 17:26:48 +0100
Subject: [rabbitmq-discuss] pika error - need a help
In-Reply-To: <CAMsQa1rVz4OaQ2bjG2QVTeqgMkyFSWqMHQZDZ_F0rarjyub5jw@mail.gmail.com>
References: <CAMsQa1rVz4OaQ2bjG2QVTeqgMkyFSWqMHQZDZ_F0rarjyub5jw@mail.gmail.com>
Message-ID: <CABzX+qzSPT9a7Mz2yd1T_BVoftS9pfUGRUJg0N7FM8CnxJrXgg@mail.gmail.com>

On Wed, Sep 7, 2011 at 06:39, Sergey Almazov <sergey.almazoff at gmail.com> wrote:
> #!/usr/bin/env python
> import pika
> import sys

This code doesn't look correct. Which pika version are you using?

Here is similar code (but working) using blocking connection. Maybe it
will print you more meaningful error message. You also may be able to
see something useful in  rabbitmq logs.

Cheers,
   Marek


#!/usr/bin/env python
import pika
import sys
import time

connection = pika.BlockingConnection(pika.ConnectionParameters(host='localhost'))
channel = connection.channel()

channel.exchange_declare(exchange='cmd', type='topic')

cmd_data_queue = channel.queue_declare(exclusive=True).method.queue

channel.queue_bind(exchange='cmd', queue=cmd_data_queue, routing_key='cmd.*')

def callback(ch, method, properties, body):
    print " [x] %r:%r" % (method.routing_key, body,)


channel.basic_consume(callback, queue=cmd_data_queue, no_ack=True)
channel.start_consuming()

From fearsome.lucidity at gmail.com  Fri Sep  9 18:03:45 2011
From: fearsome.lucidity at gmail.com (Elias Levy)
Date: Fri, 9 Sep 2011 10:03:45 -0700
Subject: [rabbitmq-discuss] Mirror queue recovery questions
Message-ID: <CAFDmHdO6fTo-NmhidtBU_zoUsOUiBQ5=fZOD8PN=DYJOtL98BA@mail.gmail.com>

>
> From: Matthew Sackman <matthew at rabbitmq.com>
>
> Yeah, this is a bit of a problem. Essentially, yes, there is a timeout,
> after which Rabbit will just give up trying to start. There are
> definitely ways in which we could embue rabbitmqctl with the means to
> tell rabbit to abandon all hope of some remote node ever rejoining (and
> indeed, even ways to do this without the local rabbit coming up, which
> is essential in this case), but we've not yet written this. There is a
> bug open for this.
>
> After that, the various local mnesia databases will try to merge
> themselves back together, but if two nodes disagree about various
> details and they can't delegate to a common node that was alive at the
> point they failed, then mnesia will give up with an "unable to merge
> schema" error, and there'll really be no hope at getting them both to
> merge back together without resetting one of those nodes.
>
> Erm possibly. Much of this ordering stuff comes from mnesia rather than
> Rabbit. If the node's mnesia is happy to start up then Rabbit will then
> restore queues without further delay. That may include the promotion of
> slaves to master.
>

Matthew,

Thanks for your help understanding the failure modes.

To summarize, if I understand correctly, in the event of a cluster failure,
if the master of a mirrored queue fails to recover, after some timeout the
remaining slaves may or may not choose a new master and recover.  Whether
they do so will depend on whether the underlaying Mnesia tables converge or
not.  And if they do not converge, you may well have to reset one or more
nodes, thus discarding any persisted messages in them.  In that case, you
better choose wisely, and reset the nodes most out of sync with the lost
master.

There is also currently no way to tell the cluster a node will not be
rejoining, and thus avoiding waiting for the timeout, but there is an open
ticket for this.

BTW, how long is this timeout?  Is it configurable?

So would it be fair to say that mirrored queues are fault tolerant to node
loss, but not necessarily to cluster loss?

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110909/312764a2/attachment.htm>

From ctg at magrathea.com  Fri Sep  9 18:13:11 2011
From: ctg at magrathea.com (Cheyenne T. Greatorex)
Date: Fri, 9 Sep 2011 13:13:11 -0400
Subject: [rabbitmq-discuss] Colocation Ignored,
	Cluster Resources Moved and Failing
Message-ID: <CACExCv2xF=EO2madsC1KxcHVzhW2ND1Ut=Fza_8JML-TxnK8HA@mail.gmail.com>

I am trying to setup a cluster of machines to provide an HA RabbitMQ solution.

I have been following the instructions on this page...

http://www.rabbitmq.com/pacemaker.html

...to no avail.

As of this writing, I have narrowed down the problems I'm having.
Either my cluster is not configured correctly, or it is ignoring the
colocation directives.  There may be other problems, such as I don't
understand how to setup colocation and the cluster in general.

Symptoms...

I have corosync/pacemaker cluster running on one node.  When I start
the second node in the cluster, the cluster attempts to start the
resource 'bunny1' on the second node.  This, despite the colocation
directives.  When the startup on the second node is attempted, it
fails miserably because of missing dependent resources ('bunny1_fs'
and 'bunny1_ip').  As such, not only is the colocation directive being
ignored, so is the order directive which should tell the cluster the
order in which to start things.  When this failure occurs, the only
recourse I've found for getting the cluster back into working order is
to hard kill -9 corosync on the second node.

I'm unclear what information will be useful in fixing this, but I
assume the cluster config is required...

node rabbitmq3.colo.bluestatedigital.com
node rabbitmq4.colo.bluestatedigital.com
primitive bunny1 ocf:rabbitmq:rabbitmq-server \
       params mnesia_base="/mnt/bunny1/mnesia" ip="10.0.210.35"
nodename="rabbit at riak1" \
       meta target-role="Started"
primitive bunny1_drbd ocf:linbit:drbd \
       params drbd_resource="r0" \
       op monitor interval="10s" role="Master" \
       op monitor interval="30s" role="Slave" \
       op start interval="0" timeout="240s" \
       op stop interval="0" timeout="100s"
primitive bunny1_fs ocf:heartbeat:Filesystem \
       params device="/dev/drbd0" directory="/mnt/bunny1" fstype="ext3" \
       op start interval="0" timeout="60s" \
       op stop interval="0" timeout="60s" \
       meta target-role="Started"
primitive bunny1_ip ocf:heartbeat:IPaddr2 \
       params ip="10.0.210.35" cidr_netmask="16"
ms bunny1_drbd_ms bunny1_drbd \
       meta master-max="1" master-node-max="1" clone-max="2"
clone-node-max="1" notify="true" target-role="Master"
colocation bunny1_colo1 inf: bunny1 bunny1_ip
colocation bunny1_colo2 inf: bunny1 bunny1_fs
colocation bunny1_fs_colo inf: bunny1_fs bunny1_drbd_ms:Master
order bunny1_fs_order inf: bunny1_drbd_ms:promote bunny1_fs:start
order bunny1_order inf: bunny1_fs bunny1_ip bunny1
property $id="cib-bootstrap-options" \
       dc-version="1.0.11-1554a83db0d3c3e546cfd3aaff6af1184f79ee87" \
       cluster-infrastructure="openais" \
       expected-quorum-votes="2" \
       stonith-enabled="false" \
       no-quorum-policy="ignore"
rsc_defaults $id="rsc-options" \
       resource-stickiness="0"

I have tried several variations of the colocation commands, none have
worked.  I have tried to find the answer via Google and in the many
docs, wiki pages, and forums, again, all to no avail.  I've tried
looking through the log files for the cluster, but they contain so
much info that I'm not sure if I can't find a relevant tidbit or
whether it just doesn't exist.

Any help will be very much appreciated.

From matthew at rabbitmq.com  Fri Sep  9 18:25:06 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 9 Sep 2011 18:25:06 +0100
Subject: [rabbitmq-discuss] Mirror queue recovery questions
In-Reply-To: <CAFDmHdO6fTo-NmhidtBU_zoUsOUiBQ5=fZOD8PN=DYJOtL98BA@mail.gmail.com>
References: <CAFDmHdO6fTo-NmhidtBU_zoUsOUiBQ5=fZOD8PN=DYJOtL98BA@mail.gmail.com>
Message-ID: <20110909172506.GC20977@rabbitmq.com>

On Fri, Sep 09, 2011 at 10:03:45AM -0700, Elias Levy wrote:
> To summarize, if I understand correctly, in the event of a cluster failure,
> if the master of a mirrored queue fails to recover, after some timeout the
> remaining slaves may or may not choose a new master and recover.  Whether
> they do so will depend on whether the underlaying Mnesia tables converge or
> not.  And if they do not converge, you may well have to reset one or more
> nodes, thus discarding any persisted messages in them.  In that case, you
> better choose wisely, and reset the nodes most out of sync with the lost
> master.

I think that summary is consistent with my understanding of mnesia and
the HA code.

> There is also currently no way to tell the cluster a node will not be
> rejoining, and thus avoiding waiting for the timeout, but there is an open
> ticket for this.

Correct.

> BTW, how long is this timeout?  Is it configurable?

30 seconds, and no. Well, not without recompiling the broker.

> So would it be fair to say that mirrored queues are fault tolerant to node
> loss, but not necessarily to cluster loss?

That's fair. Also, I've recently been reminded that we don't really
claim to support network partitions - this is mainly due to the fact
that mnesia itself doesn't support network partitions really - hence the
issues with the tables needing to converge and resetting a node if it's
not. This is consistent with choosing C and A from the CAP triangle.

Matthew

From matthew at rabbitmq.com  Fri Sep  9 18:33:37 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 9 Sep 2011 18:33:37 +0100
Subject: [rabbitmq-discuss] Colocation Ignored,
 Cluster Resources Moved and Failing
In-Reply-To: <CACExCv2xF=EO2madsC1KxcHVzhW2ND1Ut=Fza_8JML-TxnK8HA@mail.gmail.com>
References: <CACExCv2xF=EO2madsC1KxcHVzhW2ND1Ut=Fza_8JML-TxnK8HA@mail.gmail.com>
Message-ID: <20110909173337.GD20977@rabbitmq.com>

Hi,

On Fri, Sep 09, 2011 at 01:13:11PM -0400, Cheyenne T. Greatorex wrote:
> colocation bunny1_colo1 inf: bunny1 bunny1_ip
> colocation bunny1_colo2 inf: bunny1 bunny1_fs
> colocation bunny1_fs_colo inf: bunny1_fs bunny1_drbd_ms:Master
> order bunny1_fs_order inf: bunny1_drbd_ms:promote bunny1_fs:start
> order bunny1_order inf: bunny1_fs bunny1_ip bunny1
> property $id="cib-bootstrap-options" \
>        dc-version="1.0.11-1554a83db0d3c3e546cfd3aaff6af1184f79ee87" \
>        cluster-infrastructure="openais" \
>        expected-quorum-votes="2" \
>        stonith-enabled="false" \
>        no-quorum-policy="ignore"
> rsc_defaults $id="rsc-options" \
>        resource-stickiness="0"

I doubt this will solve it, but I'd definitely encourage a non-0
stickiness otherwise resources tend to move all over the place too
easily. I've just brought my cluster up and the configuration I have is:

virt-debian-3:~# crm configure show
node virt-debian-3
node virt-debian-4
primitive bunny ocf:rabbitmq:rabbitmq-server \
        params mnesia_base="/media/drbd1" ip="192.168.122.100" log_base="/media/drbd1/rabbitmq_logs" config_file="/etc/rabbitmq/rabbitmq" \
        meta target-role="Started" is-managed="true"
primitive drbd ocf:linbit:drbd \
        params drbd_resource="r0" \
        op monitor interval="60s"
primitive drbd_fs ocf:heartbeat:Filesystem \
        params device="/dev/drbd1" directory="/media/drbd1" fstype="ext3"
primitive ip ocf:heartbeat:IPaddr2 \
        params ip="192.168.122.100" cidr_netmask="24"
ms drbd_ms drbd \
        meta master-max="1" master-node-max="1" clone-max="2" clone-node-max="1" notify="true" target-role="Started"
colocation bunny_on_fs inf: bunny drbd_fs
colocation bunny_on_ip inf: bunny ip
colocation fs_on_drbd inf: drbd_fs drbd_ms:Master
order bunny_after_fs inf: drbd_fs bunny
order bunny_after_ip inf: ip bunny
order fs_after_drbd inf: drbd_ms:promote drbd_fs:start
property $id="cib-bootstrap-options" \
        dc-version="1.0.9-74392a28b7f31d7ddc86689598bd23114f58978b" \
        cluster-infrastructure="openais" \
        expected-quorum-votes="2" \
        stonith-enabled="false" \
        no-quorum-policy="ignore" \
        resource-stickiness="100" \
        last-lrm-refresh="1315229678"
rsc_defaults $id="rsc-options" \
        resource-stickiness="100"

You're not having some issue with not commiting your configuration or
something are you?

Matthew

From ctg at magrathea.com  Fri Sep  9 18:53:34 2011
From: ctg at magrathea.com (Cheyenne T. Greatorex)
Date: Fri, 9 Sep 2011 13:53:34 -0400
Subject: [rabbitmq-discuss] Colocation Ignored,
 Cluster Resources Moved and Failing
In-Reply-To: <20110909173337.GD20977@rabbitmq.com>
References: <CACExCv2xF=EO2madsC1KxcHVzhW2ND1Ut=Fza_8JML-TxnK8HA@mail.gmail.com>
	<20110909173337.GD20977@rabbitmq.com>
Message-ID: <CACExCv0zesDVjekpeTC3Udxqb1MAqHcdROnYt6UpiacdmY=4Cw@mail.gmail.com>

On Fri, Sep 9, 2011 at 13:33, Matthew Sackman <matthew at rabbitmq.com> wrote:

> You're not having some issue with not commiting your configuration or
> something are you?

Not that I'm aware of.  I haven't gotten any errors when creating or
updating my configuration.

Since my post to this list, I have also tried adding location
directives to the cluster configuration, in an attempt to give one
node priority over the other. That hasn't helped.

Speaking of the resource stickiness, I tried setting that to 100, that
also didn't help.

-- 
-chey

From lefthandmagic at gmail.com  Fri Sep  9 19:57:09 2011
From: lefthandmagic at gmail.com (Praveen M)
Date: Fri, 9 Sep 2011 11:57:09 -0700
Subject: [rabbitmq-discuss] latency in starting/stopping a rabbitmq node
In-Reply-To: <20110909101252.GA10002@southbank.eng.vmware.com>
References: <CAEqX17Oj7JmUDu_KzTG7tsuOfaKEvUQG8tFPHAicTrRJKiDyBw@mail.gmail.com>
	<20110909101252.GA10002@southbank.eng.vmware.com>
Message-ID: <CAEqX17PKR3U5BaKc+J3VZ8LDtyCH8gTqXNP=ZBdnKmM7seZ2Hg@mail.gmail.com>

Hi Alex, thanks for your email. That helped a lot.

To answer your question about the hang in the "starting exchange, queue and
binding recovery.." step on creating 100,000 durable queues and restarting
the broker,

*Is it really hung?  Is it using the CPU or disk at all at this time?  Is
there anything in the logs (both the rabbit and SASL logs)?*
*
*
The SASL log doesn't have anything. But the rabbit log has something.

I have attached the .log file for your reference.

It says that it is rebuilding the index from scratch..and that mnesia is
overloaded with  write_threshold and then time_threshold.
I'm not very sure I understand what they really mean. :(

My /etc/rabbitmq/rabbitmq.config file entry is as follows:

[ {mnesia, [{dump_log_write_threshold, 50000}, {dc_dump_limit, 40}]},
{rabbit, [{vm_memory_high_watermark, 0.34}]}].

Can you please tell me if these configs are ok, or am I missing something?

Also, I checked the IO and CPU...when I just start the broker after the
100,000 queues creation
both IO and CPU shoots up for the first minute, but then when everything
required is fetched to
memory there is no activity in IO. But CPU consistently stays up.


From lefthandmagic at gmail.com  Sat Sep 10 00:35:40 2011
From: lefthandmagic at gmail.com (Praveen M)
Date: Fri, 9 Sep 2011 16:35:40 -0700
Subject: [rabbitmq-discuss] Using the same channel for producer and consumer.
Message-ID: <CAEqX17N-SQsLMwnQUWSunALjfXwcU9O+qZ+6bZ-ownDnybawUg@mail.gmail.com>

Hi,

I saw a weird behavior when trying to use the same channel for my consumer
and producer in a test.

*Test*

1) The test creates a queue
2) It registers a consumer using basicConsume
3) It enqueues about 500 messages
4) Waits untill all the messages are consumed.

When i run the above test ~ the consumer doesn't get all the 500
messages..It stops somewhere halfway...
I tried repeating the test, it always stopped at some point before
consumption of all messages...somewhere over the halfway mark.

I was wondering if it was something to do with me using the same channel to
produce and consume, and tried switching the producer to use a different
channel,
and boy it started working right - all 500 messages got consumed.

I was wondering if someone could explain this behavior. I'm using the java
client and the latest 2.6.0 build of the server.

*Why was i trying to use the same channel for producer and consumer?*

It wasn't intentional...i just bumped into this issue by a happy mistake.


Thanks for your help.
-- 
-Praveen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110909/181f326e/attachment.htm>

From michael.s.klishin at gmail.com  Sat Sep 10 05:00:03 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 10 Sep 2011 08:00:03 +0400
Subject: [rabbitmq-discuss] Using the same channel for producer and
	consumer.
In-Reply-To: <CAEqX17N-SQsLMwnQUWSunALjfXwcU9O+qZ+6bZ-ownDnybawUg@mail.gmail.com>
References: <CAEqX17N-SQsLMwnQUWSunALjfXwcU9O+qZ+6bZ-ownDnybawUg@mail.gmail.com>
Message-ID: <CAE3HoVTXoz8_-cpRfqLiUDdMQBzfhUaoPx=4GK_19ncDhP-FKw@mail.gmail.com>

2011/9/10 Praveen M <lefthandmagic at gmail.com>

> I was wondering if someone could explain this behavior. I'm using the java
> client and the latest 2.6.0 build of the server.


It is perfectly fine to use the same channel for consuming and publishing
messages. I cannot tell without seeing your code but what you are observing
is likely to be the blocking behavior of QueueingConsumer.

There is one downside to sharing channels this way: handling channel-level
exceptions may get trickier/require you to keep more state around.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110910/b55305c5/attachment.htm>

From smantziaris at gmail.com  Fri Sep  9 19:41:31 2011
From: smantziaris at gmail.com (Sotirios Mantziaris)
Date: Fri, 9 Sep 2011 11:41:31 -0700 (PDT)
Subject: [rabbitmq-discuss] WCF Client question
Message-ID: <3895206.2800.1315593691077.JavaMail.geo-discussion-forums@yqmv39>

Hi,

i am using wcf with net.tcp duplex binding. For the lifetime of the client 
the channel is open. When something happens the channel get faulted and the 
client must be rebuild.
is this the same case for a rabbitmq wcf client (since it is a messaging 
platform)?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110909/336c2eb3/attachment.htm>

From knitheshshetty at yahoo.com  Mon Sep 12 06:35:19 2011
From: knitheshshetty at yahoo.com (Nithesh Shetty)
Date: Sun, 11 Sep 2011 22:35:19 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq query
Message-ID: <1315805719.23077.YahooMailNeo@web114310.mail.gq1.yahoo.com>

Hi,
?
I have read blog saying the order of the message in rabbitmq is not maintenained i.e it the order of the message sent can alter when receive.
?
Is it true. 
?
Please reply. Because this is the basic requirement i expect in a messaging queue.
?
I have tried qpid0.10 and IBM websphere MQ. Both have their pros and cons.
?
Need to test rabbitmq but if FIFO is supported.
?
Regards,
?
Nithesh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110911/f5a8bdf0/attachment.htm>

From emile at rabbitmq.com  Mon Sep 12 09:05:53 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 12 Sep 2011 09:05:53 +0100
Subject: [rabbitmq-discuss] rabbitmq query
In-Reply-To: <1315805719.23077.YahooMailNeo@web114310.mail.gq1.yahoo.com>
References: <1315805719.23077.YahooMailNeo@web114310.mail.gq1.yahoo.com>
Message-ID: <4E6DBD61.5020107@rabbitmq.com>

Hi Nithesh,

Op 12/09/11 06:35, het Nithesh Shetty geskryf:
> Hi,
>  
> I have read blog saying the order of the message in rabbitmq is not
> maintenained i.e it the order of the message sent can alter when receive.

RabbitMQ maintains the order of messages as required by the
specification. See section 4.7 for the AMQP 0-9-1 spec:

---
contents flowing through a single path within the server will remain
ordered. For contents of a given priority flowing through a single path,
we define a content processing path as consisting of one incoming
channel, one exchange, one queue, and one outgoing channel.
---

Examples where the condition of a single path does not hold is when a
consumer reconnects or requeues messages. In these cases you cannot rely
on messages being received in publication order.

However we are currently implementing an enhancement that will allow
ordering to be maintained in the case where a single consumer consumes
from a queue. This has not been released yet.



-Emile

From umut.sahin at vigasis.com  Mon Sep 12 09:34:39 2011
From: umut.sahin at vigasis.com (Umut Sahin)
Date: Mon, 12 Sep 2011 10:34:39 +0200 (CEST)
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
Message-ID: <d4idtcm.63d3e08decb281d35974eba3df10a7f1@webmail.vigasis.com>

We still need your help.
Regards,
Umut

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/3431403f/attachment.htm>

From knitheshshetty at yahoo.com  Mon Sep 12 09:45:41 2011
From: knitheshshetty at yahoo.com (Nithesh Shetty)
Date: Mon, 12 Sep 2011 01:45:41 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq query
In-Reply-To: <4E6DBD61.5020107@rabbitmq.com>
References: <1315805719.23077.YahooMailNeo@web114310.mail.gq1.yahoo.com>
	<4E6DBD61.5020107@rabbitmq.com>
Message-ID: <1315817141.69722.YahooMailNeo@web114311.mail.gq1.yahoo.com>

>Examples where the condition of a single path does not hold is when a
>consumer reconnects or requeues messages. In these cases you cannot rely
>on messages being received in publication order.
?
When u say reconnects or requeues. I assume that the application using queue to receive message crashes and then it connects
again to receive the message at that moment u cannot gaurantee the order right
?
Please confirm.
?
Regards,
?
Nithesh


From: Emile Joubert <emile at rabbitmq.com>
To: Nithesh Shetty <knitheshshetty at yahoo.com>
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Monday, September 12, 2011 1:35 PM
Subject: Re: [rabbitmq-discuss] rabbitmq query

Hi Nithesh,

Op 12/09/11 06:35, het Nithesh Shetty geskryf:
> Hi,
>? 
> I have read blog saying the order of the message in rabbitmq is not
> maintenained i.e it the order of the message sent can alter when receive.

RabbitMQ maintains the order of messages as required by the
specification. See section 4.7 for the AMQP 0-9-1 spec:

---
contents flowing through a single path within the server will remain
ordered. For contents of a given priority flowing through a single path,
we define a content processing path as consisting of one incoming
channel, one exchange, one queue, and one outgoing channel.
---

Examples where the condition of a single path does not hold is when a
consumer reconnects or requeues messages. In these cases you cannot rely
on messages being received in publication order.

However we are currently implementing an enhancement that will allow
ordering to be maintained in the case where a single consumer consumes
from a queue. This has not been released yet.



-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/dfb20e57/attachment.htm>

From emile at rabbitmq.com  Mon Sep 12 10:02:10 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 12 Sep 2011 10:02:10 +0100
Subject: [rabbitmq-discuss] rabbitmq query
In-Reply-To: <1315817141.69722.YahooMailNeo@web114311.mail.gq1.yahoo.com>
References: <1315805719.23077.YahooMailNeo@web114310.mail.gq1.yahoo.com>
	<4E6DBD61.5020107@rabbitmq.com>
	<1315817141.69722.YahooMailNeo@web114311.mail.gq1.yahoo.com>
Message-ID: <4E6DCA92.3080502@rabbitmq.com>

Hi Nitesh,

Op 12/09/11 09:45, het Nithesh Shetty geskryf:
>>Examples where the condition of a single path does not hold is when a
>>consumer reconnects or requeues messages. In these cases you cannot rely
>>on messages being received in publication order.
>  
> When u say reconnects or requeues. I assume that the application using
> queue to receive message crashes and then it connects
> again to receive the message at that moment u cannot gaurantee the order
> right

If a consumer holds unacknowledged messages when it disconnects then the
broker needs to return those messages to the queue. The current version
of rabbit places those messages at the back of the queue, so you cannot
rely on the order of messages once a reconnect occurs.

The same goes for AMQP methods that accept a "requeue" argument like
basic.reject, basic.recover and basic.nack.

-Emile

From knitheshshetty at yahoo.com  Mon Sep 12 10:09:12 2011
From: knitheshshetty at yahoo.com (Nithesh Shetty)
Date: Mon, 12 Sep 2011 02:09:12 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq query
In-Reply-To: <4E6DCA92.3080502@rabbitmq.com>
References: <1315805719.23077.YahooMailNeo@web114310.mail.gq1.yahoo.com>
	<4E6DBD61.5020107@rabbitmq.com>
	<1315817141.69722.YahooMailNeo@web114311.mail.gq1.yahoo.com>
	<4E6DCA92.3080502@rabbitmq.com>
Message-ID: <1315818552.90031.YahooMailNeo@web114312.mail.gq1.yahoo.com>

In that case it won't help us since. our system is a online trading system
?
and the order of the messages has to be maintained in any case.
?
Thanks for u r help emile.
?
Nithesh


From: Emile Joubert <emile at rabbitmq.com>
To: Nithesh Shetty <knitheshshetty at yahoo.com>
Cc: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Monday, September 12, 2011 2:32 PM
Subject: Re: [rabbitmq-discuss] rabbitmq query

Hi Nitesh,

Op 12/09/11 09:45, het Nithesh Shetty geskryf:
>>Examples where the condition of a single path does not hold is when a
>>consumer reconnects or requeues messages. In these cases you cannot rely
>>on messages being received in publication order.
>? 
> When u say reconnects or requeues. I assume that the application using
> queue to receive message crashes and then it connects
> again to receive the message at that moment u cannot gaurantee the order
> right

If a consumer holds unacknowledged messages when it disconnects then the
broker needs to return those messages to the queue. The current version
of rabbit places those messages at the back of the queue, so you cannot
rely on the order of messages once a reconnect occurs.

The same goes for AMQP methods that accept a "requeue" argument like
basic.reject, basic.recover and basic.nack.

-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/7da3f81e/attachment.htm>

From pierre-marie.padiou at morpho.com  Mon Sep 12 10:07:08 2011
From: pierre-marie.padiou at morpho.com (PADIOU Pierre-Marie (MORPHO))
Date: Mon, 12 Sep 2011 11:07:08 +0200
Subject: [rabbitmq-discuss] make a consumer consume no more
In-Reply-To: <CAMcAHLUiwFt1Au-DQ5z3qXP7dhBCGSOT_9n+ZYR4KPh0rwdisg@mail.gmail.com>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C5091274868463@Y000IMRV01.rd1.rf1>
	<CAMcAHLUiwFt1Au-DQ5z3qXP7dhBCGSOT_9n+ZYR4KPh0rwdisg@mail.gmail.com>
Message-ID: <E9FBE39960CDBF4A8CD9DE7E9D14C5091274868A3C@Y000IMRV01.rd1.rf1>

Thanks for the answer.

What if the consumer was consuming from a set of queues, and I'd like it to stop consuming from only one of them?

Pierre-Marie

From: Alvaro Videla [mailto:videlalvaro at gmail.com]
Sent: Friday, September 09, 2011 3:10 PM
To: PADIOU Pierre-Marie (MORPHO)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] make a consumer consume no more

Take a look at this AMQP method: http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.cancel
On Fri, Sep 9, 2011 at 3:02 PM, PADIOU Pierre-Marie (MORPHO) <pierre-marie.padiou at morpho.com<mailto:pierre-marie.padiou at morpho.com>> wrote:
I realize my message was unclear.

I do not want to put back a message to a queue. I just would like to tell a consumer not to consume anymore from a particular queue.

Pierre-Marie

From: PADIOU Pierre-Marie (MORPHO)
Sent: Friday, September 09, 2011 3:01 PM
To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: make a consumer consume no more

Hello,

Is there a way for a consumer to ? un-consume ? from a queue ?

Thanks,

Pierre-Marie

#

" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."

******

" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."

#

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

#
" Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
******
" This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
#
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/cbee491f/attachment.htm>

From videlalvaro at gmail.com  Mon Sep 12 10:21:55 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 12 Sep 2011 11:21:55 +0200
Subject: [rabbitmq-discuss] make a consumer consume no more
In-Reply-To: <E9FBE39960CDBF4A8CD9DE7E9D14C5091274868A3C@Y000IMRV01.rd1.rf1>
References: <E9FBE39960CDBF4A8CD9DE7E9D14C5091274868463@Y000IMRV01.rd1.rf1>
	<CAMcAHLUiwFt1Au-DQ5z3qXP7dhBCGSOT_9n+ZYR4KPh0rwdisg@mail.gmail.com>
	<E9FBE39960CDBF4A8CD9DE7E9D14C5091274868A3C@Y000IMRV01.rd1.rf1>
Message-ID: <97F9CFAD-81BE-4535-8ACD-42FAB93F901F@gmail.com>

As you can see here: http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.cancel

basic.cancel expects the consumer-tag as argument. When you subscribe to a queue you will get the "consumer-tag" for that queue. Or you could set the tag yourself. Then when you call basic.cancel with that consumer tag then the consumer will stop consuming from that queue only.

Regards,

Alvaro

On Sep 12, 2011, at 11:07 AM, PADIOU Pierre-Marie (MORPHO) wrote:

> Thanks for the answer.
>  
> What if the consumer was consuming from a set of queues, and I?d like it to stop consuming from only one of them?
>  
> Pierre-Marie
>  
> From: Alvaro Videla [mailto:videlalvaro at gmail.com] 
> Sent: Friday, September 09, 2011 3:10 PM
> To: PADIOU Pierre-Marie (MORPHO)
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] make a consumer consume no more
>  
> Take a look at this AMQP method: http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.cancel
> 
> On Fri, Sep 9, 2011 at 3:02 PM, PADIOU Pierre-Marie (MORPHO) <pierre-marie.padiou at morpho.com> wrote:
> I realize my message was unclear.
>  
> I do not want to put back a message to a queue. I just would like to tell a consumer not to consume anymore from a particular queue.
>  
> Pierre-Marie
>  
> From: PADIOU Pierre-Marie (MORPHO) 
> Sent: Friday, September 09, 2011 3:01 PM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: make a consumer consume no more
>  
> Hello,
>  
> Is there a way for a consumer to ? un-consume ? from a queue ?
>  
> Thanks,
>  
> Pierre-Marie
> #
> 
> " Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
> 
> ******
> 
> " This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
> 
> #
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
>  
> #
> " Ce courriel et les documents qui lui sont joints peuvent contenir des informations confidentielles ou ayant un caract?re priv?. S'ils ne vous sont pas destin?s, nous vous signalons qu'il est strictement interdit de les divulguer, de les reproduire ou d'en utiliser de quelque mani?re que ce soit le contenu. Si ce message vous a ?t? transmis par erreur, merci d'en informer l'exp?diteur et de supprimer imm?diatement de votre syst?me informatique ce courriel ainsi que tous les documents qui y sont attach?s."
> ******
> " This e-mail and any attached documents may contain confidential or proprietary information. If you are not the intended recipient, you are notified that any dissemination, copying of this e-mail and any attachments thereto or use of their contents by any means whatsoever is strictly prohibited. If you have received this e-mail in error, please advise the sender immediately and delete this e-mail and all attached documents from your computer system."
> #

Sent form my Nokia 1100



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/ac72dd2b/attachment.htm>

From ekirpichov at gmail.com  Mon Sep 12 10:22:57 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 12 Sep 2011 13:22:57 +0400
Subject: [rabbitmq-discuss] rabbitmq query
In-Reply-To: <1315818552.90031.YahooMailNeo@web114312.mail.gq1.yahoo.com>
References: <1315805719.23077.YahooMailNeo@web114310.mail.gq1.yahoo.com>
	<4E6DBD61.5020107@rabbitmq.com>
	<1315817141.69722.YahooMailNeo@web114311.mail.gq1.yahoo.com>
	<4E6DCA92.3080502@rabbitmq.com>
	<1315818552.90031.YahooMailNeo@web114312.mail.gq1.yahoo.com>
Message-ID: <CANVKUrW9_P8TwvFb9GqeN_Bbiev2MCTAD7-LcfDYdvSEi=HqaA@mail.gmail.com>

Hi Nithesh,

Would it be ok for you if RabbitMQ placed unack'd messages after a
reconnect to the front of the queue?

Because this strategy does not always behave intuitively with respect
to message ordering either (unless you have exactly 1 consumer).

Assume you have 2 consumers A,B; they get a message each - MA,MB, and
then A crashes (requeueing MA) and then B crashes (requeueing MB). The
mutual ordering of MA and MB in the queue is now still not equal to
the order in which they were in the queue initially. Would this
situation be ok from your application's point of view?

On Mon, Sep 12, 2011 at 1:09 PM, Nithesh Shetty
<knitheshshetty at yahoo.com> wrote:
> In that case it won't help us since. our system is a online trading system
>
> and the order of the messages has to be maintained in any case.
>
> Thanks for u r help emile.
>
> Nithesh
>
> From: Emile Joubert <emile at rabbitmq.com>
> To: Nithesh Shetty <knitheshshetty at yahoo.com>
> Cc: "rabbitmq-discuss at lists.rabbitmq.com"
> <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Monday, September 12, 2011 2:32 PM
> Subject: Re: [rabbitmq-discuss] rabbitmq query
>
> Hi Nitesh,
>
> Op 12/09/11 09:45, het Nithesh Shetty geskryf:
>>>Examples where the condition of a single path does not hold is when a
>>>consumer reconnects or requeues messages. In these cases you cannot rely
>>>on messages being received in publication order.
>>
>> When u say reconnects or requeues. I assume that the application using
>> queue to receive message crashes and then it connects
>> again to receive the message at that moment u cannot gaurantee the order
>> right
>
> If a consumer holds unacknowledged messages when it disconnects then the
> broker needs to return those messages to the queue. The current version
> of rabbit places those messages at the back of the queue, so you cannot
> rely on the order of messages once a reconnect occurs.
>
> The same goes for AMQP methods that accept a "requeue" argument like
> basic.reject, basic.recover and basic.nack.
>
> -Emile
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From knitheshshetty at yahoo.com  Mon Sep 12 10:42:54 2011
From: knitheshshetty at yahoo.com (Nithesh Shetty)
Date: Mon, 12 Sep 2011 02:42:54 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmq query
In-Reply-To: <CANVKUrW9_P8TwvFb9GqeN_Bbiev2MCTAD7-LcfDYdvSEi=HqaA@mail.gmail.com>
References: <1315805719.23077.YahooMailNeo@web114310.mail.gq1.yahoo.com>
	<4E6DBD61.5020107@rabbitmq.com>
	<1315817141.69722.YahooMailNeo@web114311.mail.gq1.yahoo.com>
	<4E6DCA92.3080502@rabbitmq.com>
	<1315818552.90031.YahooMailNeo@web114312.mail.gq1.yahoo.com>
	<CANVKUrW9_P8TwvFb9GqeN_Bbiev2MCTAD7-LcfDYdvSEi=HqaA@mail.gmail.com>
Message-ID: <1315820574.49991.YahooMailNeo@web114315.mail.gq1.yahoo.com>

>Assume you have 2 consumers A,B; they get a message each - MA,MB, and
>then A crashes (requeueing MA) and then B crashes (requeueing MB). The
>mutual ordering of MA and MB in the queue is now still not equal to
>the order in which they were in the queue initially. Would this
>situation be ok from your application's point of view?
?
when u requeue MA/MB then those message will be placed at the back of the queue changing the order.
?
If this is what happens then it won't help me.
?
Please confirm.
?
Nithesh


From: Eugene Kirpichov <ekirpichov at gmail.com>
To: Nithesh Shetty <knitheshshetty at yahoo.com>
Cc: Emile Joubert <emile at rabbitmq.com>; "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
Sent: Monday, September 12, 2011 2:52 PM
Subject: Re: [rabbitmq-discuss] rabbitmq query

Hi Nithesh,

Would it be ok for you if RabbitMQ placed unack'd messages after a
reconnect to the front of the queue?

Because this strategy does not always behave intuitively with respect
to message ordering either (unless you have exactly 1 consumer).

Assume you have 2 consumers A,B; they get a message each - MA,MB, and
then A crashes (requeueing MA) and then B crashes (requeueing MB). The
mutual ordering of MA and MB in the queue is now still not equal to
the order in which they were in the queue initially. Would this
situation be ok from your application's point of view?

On Mon, Sep 12, 2011 at 1:09 PM, Nithesh Shetty
<knitheshshetty at yahoo.com> wrote:
> In that case it won't help us since. our system is a online trading system
>
> and the order of the messages has to be maintained in any case.
>
> Thanks for u r help emile.
>
> Nithesh
>
> From: Emile Joubert <emile at rabbitmq.com>
> To: Nithesh Shetty <knitheshshetty at yahoo.com>
> Cc: "rabbitmq-discuss at lists.rabbitmq.com"
> <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Monday, September 12, 2011 2:32 PM
> Subject: Re: [rabbitmq-discuss] rabbitmq query
>
> Hi Nitesh,
>
> Op 12/09/11 09:45, het Nithesh Shetty geskryf:
>>>Examples where the condition of a single path does not hold is when a
>>>consumer reconnects or requeues messages. In these cases you cannot rely
>>>on messages being received in publication order.
>>
>> When u say reconnects or requeues. I assume that the application using
>> queue to receive message crashes and then it connects
>> again to receive the message at that moment u cannot gaurantee the order
>> right
>
> If a consumer holds unacknowledged messages when it disconnects then the
> broker needs to return those messages to the queue. The current version
> of rabbit places those messages at the back of the queue, so you cannot
> rely on the order of messages once a reconnect occurs.
>
> The same goes for AMQP methods that accept a "requeue" argument like
> basic.reject, basic.recover and basic.nack.
>
> -Emile
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/b2052cc8/attachment.htm>

From alexandru at rabbitmq.com  Mon Sep 12 11:18:53 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 12 Sep 2011 11:18:53 +0100
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
In-Reply-To: <dudh93g.36a42ccaf9242de9d8cd10a2d7db96c1@webmail.vigasis.com>
References: <dudh93g.36a42ccaf9242de9d8cd10a2d7db96c1@webmail.vigasis.com>
Message-ID: <20110912101853.GD3803@southbank.eng.vmware.com>

> =ERROR REPORT==== 9-Sep-2011::16:12:49 ===
> error on TCP connection <0.605.0>:{ssl_upgrade_error,timeout}

I've looked into this and, as far as I can tell, the only way to get
that error is if the client connects successfully, but takes too long to
complete the SSL handshake.

Just to confirm, you've tried to connect the .NET client to an s_server
running on the same machine as the broker and it worked?

Cheers,
Alex

On Fri, Sep 09, 2011 at 03:22:43PM +0200, umut.sahin at vigasis.com wrote:
> >We haven't had any reported issues with that configuration, so it
> >should probably work.  Is there anything in the broker logs about this?
> 
> =INFO REPORT==== 9-Sep-2011::16:12:44 ===
> accepted TCP connection on [::]:5671 from 10.35.110.131:4712
> 
> =INFO REPORT==== 9-Sep-2011::16:12:44 ===
> starting TCP connection <0.605.0> from 10.35.110.131:4712
> 
> =ERROR REPORT==== 9-Sep-2011::16:12:49 ===
> error on TCP connection <0.605.0>:{ssl_upgrade_error,timeout}
> 
> =INFO REPORT==== 9-Sep-2011::16:12:49 ===
> closing TCP connection <0.605.0>
> 
> Broker logs are above...
> 
> 
> >
> >> endpoint=amqp-0-9://10.35.110.167:5671, attempts=1
> >> System.IO.IOException: Uzak taraf tama akn kapattndan
> >> kimlik dorulamas
> >
> >I don't suppose you could get an English version of the error, could
> >you?  The Google Translation doesn't sound familiar.
> 
> "Authentication failed as remote party has closed the transport stream" is the translation
> 
> >
> >Also, 1) is the CA's certificate in the Trusted Root Certificate
> >Authorities store? 2) does the server's hostname match the common name
> >on the certificate?
> >
> 
> 1) Yes, it is
> 2) Yes it does match CN=hostname O=server (like http://www.rabbitmq.com/ssl.html examples..)
> 
> Thnx in advance,
> Umut
> 

From umut.sahin at vigasis.com  Mon Sep 12 12:12:33 2011
From: umut.sahin at vigasis.com (Umut Sahin)
Date: Mon, 12 Sep 2011 13:12:33 +0200 (CEST)
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
Message-ID: <d1okl3p.7c36442efd4e3f1550c7f0aae25d968f@webmail.vigasis.com>

The broker was not running while we were trying.
We tried openssl s_client and s_server just to check the certificates on
the same machine and no problems.
And also we tried Java client on windows machine and Rabbitmq Server on
debian and no problems.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/bacfc70b/attachment.htm>

From ekirpichov at gmail.com  Mon Sep 12 12:15:43 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 12 Sep 2011 15:15:43 +0400
Subject: [rabbitmq-discuss] rabbitmq query
In-Reply-To: <1315820574.49991.YahooMailNeo@web114315.mail.gq1.yahoo.com>
References: <1315805719.23077.YahooMailNeo@web114310.mail.gq1.yahoo.com>
	<4E6DBD61.5020107@rabbitmq.com>
	<1315817141.69722.YahooMailNeo@web114311.mail.gq1.yahoo.com>
	<4E6DCA92.3080502@rabbitmq.com>
	<1315818552.90031.YahooMailNeo@web114312.mail.gq1.yahoo.com>
	<CANVKUrW9_P8TwvFb9GqeN_Bbiev2MCTAD7-LcfDYdvSEi=HqaA@mail.gmail.com>
	<1315820574.49991.YahooMailNeo@web114315.mail.gq1.yahoo.com>
Message-ID: <CANVKUrV3+xWm-+qpJmxbRWRA1XLiuGz0SETsgio3iYoxSZjqqQ@mail.gmail.com>

Nithesh,

I understand that the current semantics of RabbitMQ is far from being
satisfactory for you.

I was asking whether *another* semantics (push message to front of
queue) would be - I'm trying to persuade you that probably your
problem is ill-formulated and there doesn't exist a solution to it at
all, so perhaps you may have to rethink the problem :)

On Mon, Sep 12, 2011 at 1:42 PM, Nithesh Shetty
<knitheshshetty at yahoo.com> wrote:
>>Assume you have 2 consumers A,B; they get a message each - MA,MB, and
>>then A crashes (requeueing MA) and then B crashes (requeueing MB). The
>>mutual ordering of MA and MB in the queue is now still not equal to
>>the order in which they were in the queue initially. Would this
>>situation be ok from your application's point of view?
>
> when u requeue MA/MB then those message will be placed at the back of the
> queue changing the order.
>
> If this is what happens then it won't help me.
>
> Please confirm.
>
> Nithesh
>
> From: Eugene Kirpichov <ekirpichov at gmail.com>
> To: Nithesh Shetty <knitheshshetty at yahoo.com>
> Cc: Emile Joubert <emile at rabbitmq.com>;
> "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
> Sent: Monday, September 12, 2011 2:52 PM
> Subject: Re: [rabbitmq-discuss] rabbitmq query
>
> Hi Nithesh,
>
> Would it be ok for you if RabbitMQ placed unack'd messages after a
> reconnect to the front of the queue?
>
> Because this strategy does not always behave intuitively with respect
> to message ordering either (unless you have exactly 1 consumer).
>
> Assume you have 2 consumers A,B; they get a message each - MA,MB, and
> then A crashes (requeueing MA) and then B crashes (requeueing MB). The
> mutual ordering of MA and MB in the queue is now still not equal to
> the order in which they were in the queue initially. Would this
> situation be ok from your application's point of view?
>
> On Mon, Sep 12, 2011 at 1:09 PM, Nithesh Shetty
> <knitheshshetty at yahoo.com> wrote:
>> In that case it won't help us since. our system is a online trading system
>>
>> and the order of the messages has to be maintained in any case.
>>
>> Thanks for u r help emile.
>>
>> Nithesh
>>
>> From: Emile Joubert <emile at rabbitmq.com>
>> To: Nithesh Shetty <knitheshshetty at yahoo.com>
>> Cc: "rabbitmq-discuss at lists.rabbitmq.com"
>> <rabbitmq-discuss at lists.rabbitmq.com>
>> Sent: Monday, September 12, 2011 2:32 PM
>> Subject: Re: [rabbitmq-discuss] rabbitmq query
>>
>> Hi Nitesh,
>>
>> Op 12/09/11 09:45, het Nithesh Shetty geskryf:
>>>>Examples where the condition of a single path does not hold is when a
>>>>consumer reconnects or requeues messages. In these cases you cannot rely
>>>>on messages being received in publication order.
>>>
>>> When u say reconnects or requeues. I assume that the application using
>>> queue to receive message crashes and then it connects
>>> again to receive the message at that moment u cannot gaurantee the order
>>> right
>>
>> If a consumer holds unacknowledged messages when it disconnects then the
>> broker needs to return those messages to the queue. The current version
>> of rabbit places those messages at the back of the queue, so you cannot
>> rely on the order of messages once a reconnect occurs.
>>
>> The same goes for AMQP methods that accept a "requeue" argument like
>> basic.reject, basic.recover and basic.nack.
>>
>> -Emile
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From alexandru at rabbitmq.com  Mon Sep 12 12:36:42 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 12 Sep 2011 12:36:42 +0100
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
In-Reply-To: <d1okl3p.7c36442efd4e3f1550c7f0aae25d968f@webmail.vigasis.com>
References: <d1okl3p.7c36442efd4e3f1550c7f0aae25d968f@webmail.vigasis.com>
Message-ID: <20110912113642.GG3803@southbank.eng.vmware.com>

> We tried openssl s_client and s_server just to check the certificates on
> the same machine and no problems.

Ok, the certificates are fine.  But the problem sounds like the .NET
client is not completing the SSL handshake, so could you try the .NET
client with s_server on the broker machine (if everything is fine, it
should fail with an AMQP error and not a connection error)?

So, 1) start s_server on the broker machine with the server certificate
listening on 5671 and 2) connect to it with the .NET client.

The point of this is to ensure that the .NET client is doing its part of
the SSL handshake.

Alex

On Mon, Sep 12, 2011 at 01:12:33PM +0200, Umut Sahin wrote:
> The broker was not running while we were trying.
> We tried openssl s_client and s_server just to check the certificates on
> the same machine and no problems.
> And also we tried Java client on windows machine and Rabbitmq Server on
> debian and no problems.
> 
> 

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From andrea.rosa at hp.com  Mon Sep 12 13:28:54 2011
From: andrea.rosa at hp.com (Rosa, Andrea)
Date: Mon, 12 Sep 2011 12:28:54 +0000
Subject: [rabbitmq-discuss] questions about log messages and problems
 with connections
In-Reply-To: <4E69E00B.5030100@rabbitmq.com>
References: <1315558405.13950.10.camel@vicbristol6.hpl.hp.com>
	<4E69E00B.5030100@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD044738@G9W0721.americas.hpqcorp.net>

Hi Simon,

> -----Original Message-----
> 
> On 09/09/11 09:53, Andrea Rosa wrote:
> > in the rabbitmq file I found this error:
> > =ERROR REPORT==== 8-Sep-2011::14:13:39 ===
> > exception on TCP connection<0.27709.5838>  from ipaddr:port
> > {inet_error,etimedout}
> >
> > When this error occurs?
> > Unfortunately this problem affects 70% of our nodes!
> 
> We've only seen this error before when there's a TCP load balancer or
> firewall in between Rabbit and its clients that is somehow futzing with
> TCP connections - could this be happening to you?

Unfortunately this is not our case. We don't have a TCP load balancer installed yet.
How rabbitmq count consumers registered on a queue? It counts


> > Analysing the rabbitmq log file I found other strange messages:
> > =WARNING REPORT==== 8-Sep-2011::14:49:08 ===
> > exception on TCP connection<0.11485.6171>  from ipaddr:port
> > connection_closed_abruptly
> >
> > This message is repeated a lot of times in the log file, but It seems
> > that didn't affect the behaviour of our application.
> > It's normal to have so much WARNING messages?
> 
> That just means that a connection was closed at the TCP level without
> going through the AMQP close handshaking. If you're seeing this all the
> time and it's not associated with clients getting disconnected when you
> don't expect it, it could be a badly-written client? Which client are
> you using?
 
We are using python carrot library. We verified that the connection is refused just for one of our nodes.
We needed to restart rabbitmq server in order to fix that problem.

> > And finally these messages:
> > =INFO REPORT==== 8-Sep-2011::13:13:13 ===
> >      alarm_handler: {clear,file_descriptor_limit}
> >
> > =INFO REPORT==== 8-Sep-2011::13:13:13 ===
> >      alarm_handler: {set,{file_descriptor_limit,[]}}
> >
> > These are related with socket problems?
> 
> Ah, that's interesting. On Unix every TCP connection requires a file
> descriptor and often operating systems are configured with a fairly low
> limit (1024 is fairly typical). And Rabbit needs to keep some file
> descriptors back for... files. If you want Rabbit to support large
> numbers of connections, look into raising the limit with limits.conf.
> 

Ok thank you, we are going to raise this limit.

> However, even if you're running into the limit then this shouldn't kill
> existing connections, just make Rabbit unable to accept new ones, so I
> think you still have multiple issues to fix I'm afraid.
> 
> Cheers, Simon
> 
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From umut.sahin at vigasis.com  Mon Sep 12 14:32:33 2011
From: umut.sahin at vigasis.com (Umut Sahin)
Date: Mon, 12 Sep 2011 15:32:33 +0200 (CEST)
Subject: [rabbitmq-discuss] Issues with RabbitMQ, 	SSL and .NET
Message-ID: <d1okl3p.3f55850aaa20300708cccfbd8b6b880e@webmail.vigasis.com>




From umut.sahin at vigasis.com  Mon Sep 12 14:36:54 2011
From: umut.sahin at vigasis.com (Umut Sahin)
Date: Mon, 12 Sep 2011 15:36:54 +0200 (CEST)
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
Message-ID: <d1okl3p.703ee1e95e2502ceb1cb6ce2020a9b10@webmail.vigasis.com>




From umut.sahin at vigasis.com  Mon Sep 12 14:42:10 2011
From: umut.sahin at vigasis.com (Umut Sahin)
Date: Mon, 12 Sep 2011 15:42:10 +0200 (CEST)
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
Message-ID: <d1okl3p.4df1db4e0c855fb023c9c68899026d10@webmail.vigasis.com>

When we tried s_server with .net client we get the following output after 30-45 secs

Using default temp DH parameters
Using default temp ECDH parameters
ACCEPT
bad gethostbyaddr
SSL_accept:before/accept initialization
SSL_accept:SSLv3 read client hello A
SSL_accept:SSLv3 write server hello A
SSL_accept:SSLv3 write certificate A
SSL_accept:SSLv3 write server done A
SSL_accept:SSLv3 flush data
SSL_accept:SSLv3 read client key exchange A
SSL_accept:SSLv3 read finished A
SSL_accept:SSLv3 write change cipher spec A
SSL_accept:SSLv3 write finished A
SSL_accept:SSLv3 flush data
-----BEGIN SSL SESSION PARAMETERS-----
MHUCAQECAgMABAIABQQgltrToe1RJu++iBFcCse8XKjq8yXWNlEsenPThIArR2EE
MPzUavjQnj3OQWCDfwCaHG6ljCyE8Z8SxCHrl5CIZkKwDdIYwJugeVjPVA2d8AzN
TKEGAgRObfaoogQCAgEspAYEBAEAAAA=
-----END SSL SESSION PARAMETERS-----
Shared ciphers:RC4-SHA:DES-CBC3-SHA:EDH-DSS-DES-CBC3-SHA:RC4-MD5
CIPHER is RC4-SHA
Secure Renegotiation IS supported
AMQP	ERROR
shutting down SSL
CONNECTION CLOSED
ACCEPT

But when we tried it with java client we get this,

Using default temp DH parameters
Using default temp ECDH parameters
ACCEPT
SSL_accept:before/accept initialization
SSL_accept:SSLv3 read client hello A
SSL_accept:SSLv3 write server hello A
SSL_accept:SSLv3 write certificate A
SSL_accept:SSLv3 write server done A
SSL_accept:SSLv3 flush data
SSL_accept:SSLv3 read client key exchange A
SSL_accept:SSLv3 read finished A
SSL_accept:SSLv3 write change cipher spec A
SSL_accept:SSLv3 write finished A
SSL_accept:SSLv3 flush data
-----BEGIN SSL SESSION PARAMETERS-----
MHUCAQECAgMBBAIABAQgkb4gmKK2OH5YE1CtMEY/eXKu7g1LvuVslOLiZ96HRJ4E
MKhdg8gX4qe7TAMI3TJVz807gzk+X8LMyYeI45vqI0zaH/cvoSDL+Zx1VnDvkKdR
EqEGAgRObfZcogQCAgEspAYEBAEAAAA=
-----END SSL SESSION PARAMETERS-----
Shared ciphers:RC4-MD5:RC4-SHA:AES128-SHA:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA:DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:EDH-DSS-DES-CBC3-SHA:DES-CBC-SHA:EDH-RSA-DES-CBC-SHA:EDH-DSS-DES-CBC-SHA:EXP-RC4-MD5:EXP-DES-CBC-SHA:EXP-EDH-RSA-DES-CBC-SHA:EXP-EDH-DSS-DES-CBC-SHA
CIPHER is RC4-MD5
Secure Renegotiation IS supported
AMQP

Regards,
Umut



From danbarua at gmail.com  Mon Sep 12 15:04:30 2011
From: danbarua at gmail.com (Dan B)
Date: Mon, 12 Sep 2011 07:04:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
In-Reply-To: <dudh93g.eb46c499d717f6cce311b9e5e06ebe37@webmail.vigasis.com>
References: <dudh93g.eb46c499d717f6cce311b9e5e06ebe37@webmail.vigasis.com>
Message-ID: <19128884.2366.1315836271040.JavaMail.geo-discussion-forums@yqah42>

>endpoint=amqp-0-9://10.35.110.167:5671, attempts=1

Try using the FQDN that matches the SSL cert.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/1d724214/attachment.htm>

From alexandru at rabbitmq.com  Mon Sep 12 15:25:51 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 12 Sep 2011 15:25:51 +0100
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
In-Reply-To: <19128884.2366.1315836271040.JavaMail.geo-discussion-forums@yqah42>
References: <dudh93g.eb46c499d717f6cce311b9e5e06ebe37@webmail.vigasis.com>
	<19128884.2366.1315836271040.JavaMail.geo-discussion-forums@yqah42>
Message-ID: <20110912142551.GH3803@southbank.eng.vmware.com>

Dan's right.  The problem is this:

> When we tried s_server with .net client we get the following output
> after 30-45 secs

> Using default temp DH parameters
> Using default temp ECDH parameters
> ACCEPT
> bad gethostbyaddr

and this

> >endpoint=amqp-0-9://10.35.110.167:5671, attempts=1

So, if the certificate is issued for "host1", you need to connect to the
machine with something like:

  ConnectionFactory factory = new ConnectionFactory();
  factory.HostName = "host1";
  ...

I suppose our documentation could be clearer on that point.

Alex

On Mon, Sep 12, 2011 at 07:04:30AM -0700, Dan B wrote:
> >endpoint=amqp-0-9://10.35.110.167:5671, attempts=1
> 
> Try using the FQDN that matches the SSL cert.

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Mon Sep 12 15:34:35 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Mon, 12 Sep 2011 15:34:35 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is released
Message-ID: <4E6E187B.4090000@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 2.6.1.

This release fixes a bug in the 2.6.0 version that causes the broker to fail to restart on reboot on some operating systems.

The release also contains a small number of other bug fixes and enhancements, and the first official outing of the routing topology visualiser. See the attached release notes for more details.

Binary and source distributions of the new release can be found in the usual place athttp://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to this latest release.

As always, we welcome any questions, bug reports, and other feedback on this release, as well as general suggestions for features and enhancements in future releases. Mail us via the RabbitMQ discussion list atrabbitmq-discuss at lists.rabbitmq.com, or directlyat info at rabbitmq.com.

Regards,

The RabbitMQ Team

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-2.6.1.txt
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/35da167c/attachment.txt>

From alexandru at rabbitmq.com  Mon Sep 12 15:51:25 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 12 Sep 2011 15:51:25 +0100
Subject: [rabbitmq-discuss] latency in starting/stopping a rabbitmq node
In-Reply-To: <CAEqX17PKR3U5BaKc+J3VZ8LDtyCH8gTqXNP=ZBdnKmM7seZ2Hg@mail.gmail.com>
References: <CAEqX17Oj7JmUDu_KzTG7tsuOfaKEvUQG8tFPHAicTrRJKiDyBw@mail.gmail.com>
	<20110909101252.GA10002@southbank.eng.vmware.com>
	<CAEqX17PKR3U5BaKc+J3VZ8LDtyCH8gTqXNP=ZBdnKmM7seZ2Hg@mail.gmail.com>
Message-ID: <20110912145125.GI3803@southbank.eng.vmware.com>

Hi Praveen,

Thanks a lot for the info.

I can now replicate the slow start-up.  The good news is that the
broker eventually does start-up (I left it overnight, so I'm not sure
how long it actually took), but it's not immediately obvious how to
speed that up.  We'll look into it further.

The fix to speed up the shutdown didn't make it into 2.6.1 :,(  It'll
probably be in the release after that.

> It says that it is rebuilding the index from scratch..and that mnesia is
> overloaded with  write_threshold and then time_threshold.
> I'm not very sure I understand what they really mean. :(

That's not really a problem; that just indicates that the database is
being used a lot.

> Can you please tell me if these configs are ok, or am I missing something?

They look fine.

There's not much you can do about the slow shutdown and slow recovery
right now.  Sorry.

Cheers,
Alex

On Fri, Sep 09, 2011 at 11:57:09AM -0700, Praveen M wrote:
> Hi Alex, thanks for your email. That helped a lot.
> 
> To answer your question about the hang in the "starting exchange, queue and
> binding recovery.." step on creating 100,000 durable queues and restarting
> the broker,
> 
> *Is it really hung?  Is it using the CPU or disk at all at this time?  Is
> there anything in the logs (both the rabbit and SASL logs)?*
> *
> *
> The SASL log doesn't have anything. But the rabbit log has something.
> 
> I have attached the .log file for your reference.
> 
> It says that it is rebuilding the index from scratch..and that mnesia is
> overloaded with  write_threshold and then time_threshold.
> I'm not very sure I understand what they really mean. :(
> 
> My /etc/rabbitmq/rabbitmq.config file entry is as follows:
> 
> [ {mnesia, [{dump_log_write_threshold, 50000}, {dc_dump_limit, 40}]},
> {rabbit, [{vm_memory_high_watermark, 0.34}]}].
> 
> Can you please tell me if these configs are ok, or am I missing something?
> 
> Also, I checked the IO and CPU...when I just start the broker after the
> 100,000 queues creation
> both IO and CPU shoots up for the first minute, but then when everything
> required is fetched to
> memory there is no activity in IO. But CPU consistently stays up.
> 
> From top  the values are like below ~ and the CPU almost always stays up and
> it never goes down.
> 
> PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
> 13997 root      20   0 3184m 2.5g   2324 S  210      21.2       8:17.97
>  beam.smp
> 
> Feel free to let me know if you need more info. I can provide you with
> memory dumps and stack traces if required.
> 
> Thanks a lot for your help.
> Praveen
> 
> 
> 
> On Fri, Sep 9, 2011 at 3:12 AM, Alexandru Scvor?ov
> <alexandru at rabbitmq.com>wrote:
> 
> > Hi Praveen,
> >
> > > However I realized when i wanted to shutdown the broker before starting a
> > > new test, the stop command (rabbitmqctl stop) took a long time
> > > to complete.
> >
> > We are aware of this problem.  The fix is currently going through QA and
> > will probably be in the next release, which should be around fairly
> > soon.
> >
> > > Query 1)
> > > I am curious as to what causes the latency to stop the broker when issued
> > a
> > > rabbitmqctl stop command. It seems to be something to do with the number
> > of
> > > queues created as the stop time increase proportionally as the number of
> > > queues increases.
> >
> > Internally, when we terminate a queue, we do a few file operations.  This
> > is usually not a problem, but when you close a connection with 100 000s
> > of queues, the same order of file operations get scheduled.  Erlang's
> > IO system then does some expensive operations of this long queue and
> > it ends up processing the operations in quadratic time.  The fix going
> > through QA brings this down to linear time; for instance, I can delete
> > 40k queues in 20s (compared to 211s on the latest release).
> >
> > > Query 2)
> > > In the case of durable queues, I measured the time taken to restart the
> > > broker after stopping it (a clean and unclean stop).
> > > I found that even after a clean/unclean stop the time to restart the
> > broker
> > > was just about 20 seconds on an average.
> > > However, in the case where i created 50000 durable queues and did an
> > unclean
> > > stop(just aborted the broker) and tried to restart the broker it didn't
> > > start for over to 6 minutes (when I gave up)...
> > > It was hung in the step of "starting exchange,queue and binding
> > recovery.."
> > > It will be great if someone could explain why this could be caused.
> >
> > I can't reproduce this.  Declaring 100 000 durable queues, killing the
> > broker
> > and re-starting it seems to work fine.  It takes about 1 min on my
> > machine.
> >
> > Is it really hung?  Is it using the CPU or disk at all at this time?  Is
> > there anything in the logs (both the rabbit and SASL logs)?
> >
> > > It will be great if someone could answer the above queries or provide me
> > > with some pointers about the same.
> >
> > There's not much you can do at the moment except avoiding terminating a
> > large number of queues at the same time.
> >
> > Hope this clears things up.
> >
> > Cheers,
> > Alex
> >
> > On Thu, Sep 08, 2011 at 07:38:14PM -0700, Praveen M wrote:
> > > Hi,
> > >
> > > I'm a rabbitmq newbie and am trying to run some experiments to figure out
> > if
> > > rabbitmq would serve my use case.
> > >
> > > I would like to create queues in the order of 100,000s. (one for each of
> > my
> > > customers).
> > >
> > > I ran various tests,
> > >
> > > I'm using the latest 2.6.0 server and 2.6.0 client, and the following
> > tests
> > > in durable queues mode and in non-durable queues mode.
> > >
> > > Tests,
> > > 1) to create 1000 queues , produce, consume
> > > 2) to create 10000 queues , produce, consume
> > > 3) to create 50000 queues, produce and consume.
> > >
> > > It works like a charm and the memory usage even with 50,000 queues seem
> > very
> > > reasonable. (the order of 1-1.7G)
> > >
> > > However I realized when i wanted to shutdown the broker before starting a
> > > new test, the stop command (rabbitmqctl stop) took a long time
> > > to complete.
> > >
> > > I made a small chart of how long the stop command on the broker takes to
> > > execute after the test creates 'N' queues listed below.
> > > Also, in the case of durable queues, i found some weird numbers for the
> > time
> > > taken to restart the queues after a clean/unclean(aborting broker) stop
> > >
> > > *NON_DURABLE_QUEUES TEST*
> > > *No of Queues Stop Time*
> > > 1000 10.7 seconds
> > > 10000 2 minutes
> > > 50000 11 minutes
> > >
> > > *
> > > *
> > > *DURABLE_QUEUES TEST
> > > *No of Queues Start Time Stop Time*
> > > 1000 2 seconds 10 seconds
> > > 10000 24 seconds 2 minutes
> > > 10000 after crash it recovers in 20 seconds (on improper shutdown).
> > > 50000 even at 6 minutes the queues doesn't start on a improper shutdown
> > >
> > >
> > > Query 1)
> > > I am curious as to what causes the latency to stop the broker when issued
> > a
> > > rabbitmqctl stop command. It seems to be something to do with the number
> > of
> > > queues created as the stop time increase proportionally as the number of
> > > queues increases.
> > >
> > > Query 2)
> > > In the case of durable queues, I measured the time taken to restart the
> > > broker after stopping it (a clean and unclean stop).
> > > I found that even after a clean/unclean stop the time to restart the
> > broker
> > > was just about 20 seconds on an average.
> > > However, in the case where i created 50000 durable queues and did an
> > unclean
> > > stop(just aborted the broker) and tried to restart the broker it didn't
> > > start for over to 6 minutes (when I gave up)...
> > > It was hung in the step of "starting exchange,queue and binding
> > recovery.."
> > > It will be great if someone could explain why this could be caused.
> > >
> > > It will be great if someone could answer the above queries or provide me
> > > with some pointers about the same.
> > >
> > > Thank you for your help,
> > > --
> > > -Praveen
> >
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> 
> 
> -- 
> -Praveen

> [ {mnesia, [{dump_log_write_threshold, 50000}, {dc_dump_limit, 40}]},
> {rabbit, [{vm_memory_high_watermark, 0.34}]}].



From umut.sahin at vigasis.com  Mon Sep 12 16:02:44 2011
From: umut.sahin at vigasis.com (Umut Sahin)
Date: Mon, 12 Sep 2011 17:02:44 +0200 (CEST)
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
Message-ID: <d1okl3p.4cfddddd6f8ad2fc89c45a0c24a0af77@webmail.vigasis.com>

>>endpoint=amqp-0-9://10.35.110.167:5671, attempts=1

>Try using the FQDN that matches the SSL cert. 

We tried CN=server-PC and CN=10.35.110.167 for our certs 
and added "server-PC 10.35.110.167" to hosts file on our windows machine

We must install a DNS server or something to use FQDN ?

Regards,
Umut



From alexandru at rabbitmq.com  Mon Sep 12 16:09:55 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 12 Sep 2011 16:09:55 +0100
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
In-Reply-To: <d1okl3p.4cfddddd6f8ad2fc89c45a0c24a0af77@webmail.vigasis.com>
References: <d1okl3p.4cfddddd6f8ad2fc89c45a0c24a0af77@webmail.vigasis.com>
Message-ID: <20110912150954.GJ3803@southbank.eng.vmware.com>

If the certificate is issued for "host1" and that machine has address
10.35.110.167, it should be enough to add "host1 10.35.110.167" to the
hosts on the Windows machine and to tell the .NET client to connect to
"host1" (and not to the IP address).

Does anything change if you try this?

Also, when you reply, could you please reply to this email and not start
a new thread?

Cheers,
Alex

On Mon, Sep 12, 2011 at 05:02:44PM +0200, Umut Sahin wrote:
> >>endpoint=amqp-0-9://10.35.110.167:5671, attempts=1
> 
> >Try using the FQDN that matches the SSL cert. 
> 
> We tried CN=server-PC and CN=10.35.110.167 for our certs 
> and added "server-PC 10.35.110.167" to hosts file on our windows machine
> 
> We must install a DNS server or something to use FQDN ?
> 
> Regards,
> Umut
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From umut.sahin at vigasis.com  Mon Sep 12 16:25:47 2011
From: umut.sahin at vigasis.com (Umut Sahin)
Date: Mon, 12 Sep 2011 17:25:47 +0200 (CEST)
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
Message-ID: <d1okl3p.6383de33f76389b01bbc750b959906cb@webmail.vigasis.com>

As I said before we tried CN=server-PC for our certs
and added "server-PC 10.35.110.167" to hosts file on our windows machine.

And when we check we still get "bad gethostbyaddr" from openssl s_server
also .net client crashes,
and problem continues...

Regards,
Umut



From steve at rabbitmq.com  Mon Sep 12 16:37:25 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Mon, 12 Sep 2011 16:37:25 +0100
Subject: [rabbitmq-discuss] Stomp: after deleting a durable subscription,
	message is still available
In-Reply-To: <7C1B7121-6668-42B0-8A37-4AC5C54777A5@rabbitmq.com>
References: <j45oon$2fn$1@dough.gmane.org>
	<7C1B7121-6668-42B0-8A37-4AC5C54777A5@rabbitmq.com>
Message-ID: <7503ABCF-9E90-4BD0-A0A8-4489A1B34391@rabbitmq.com>

Michael,
This behaviour becomes clearer to me now.  Apollo (ActiveMQ) explains their interaction between the id header and the persistent:true header on SUBSCRIBE and UNSUBSCRIBE in this section[1] of the Apollo spec.  Although not all of the behaviour is determined from this (what happens when we issue a SUBSCRIBE with the same id but different destinations, for example), we can see where we differ.

I have raised bug24420[2] to address this in RabbitMQ.

I notice that the client-id header on CONNECT is not mentioned in their spec, and has no bearing on subscription persistence.

Thank you for bringing this to our attention.

Steve Powell  (a happy bunny)
----------some definitions from the SPD----------
Rigatoni n. A prime-ministerial grin.
Nigella n. The next wine-bottle-size up from a Nebuchadnezzar.
Homily adv. Rather like a frenchman.
-------------------------------------------
[1] http://activemq.apache.org/apollo/documentation/user-manual.html#Topic_Durable_Subscriptions
[2] http://bugzilla.rabbitmq.com/show_bug.cgi?id=24420

On 9 Sep 2011, at 12:28, Steve Powell wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/014995.html
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/1fee0da1/attachment.htm>

From alexandru at rabbitmq.com  Mon Sep 12 17:22:33 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 12 Sep 2011 17:22:33 +0100
Subject: [rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
In-Reply-To: <d1okl3p.6383de33f76389b01bbc750b959906cb@webmail.vigasis.com>
References: <d1okl3p.6383de33f76389b01bbc750b959906cb@webmail.vigasis.com>
Message-ID: <20110912162233.GK3803@southbank.eng.vmware.com>

> As I said before we tried CN=server-PC for our certs
> and added "server-PC 10.35.110.167" to hosts file on our windows machine.

Ok.

> And when we check we still get "bad gethostbyaddr" from openssl s_server
> also .net client crashes,
> and problem continues...

Turns out that's because the client's IP isn't in the server's hosts
file.  Should be harmless and works fine without that.

The output from s_client is perfectly fine and shows that the .NET can
connect to the server machine via SSL.

Is there any chance you could try running your .NET program from a different
machine?  In particular, could you run under Mono on the same machine as
the broker?

Please reply to this message and don't start a new thread.

Cheers,
Alex

On Mon, Sep 12, 2011 at 05:25:47PM +0200, Umut Sahin wrote:
> As I said before we tried CN=server-PC for our certs
> and added "server-PC 10.35.110.167" to hosts file on our windows machine.
> 
> And when we check we still get "bad gethostbyaddr" from openssl s_server
> also .net client crashes,
> and problem continues...
> 
> Regards,
> Umut
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simone.busoli at gmail.com  Mon Sep 12 19:47:46 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Mon, 12 Sep 2011 20:47:46 +0200
Subject: [rabbitmq-discuss] Italian RabbitMQ meeting proposal
In-Reply-To: <CAMcAHLXNXWaj9A9kVPjZJc0cRz225gh=04H+xM=wW7-+pUdxtg@mail.gmail.com>
References: <CAOn7oW9M7CegKCjadjwFUiN=NABbYeDWtr+0bAn65p8UzpKRFw@mail.gmail.com>
	<D59CE1BF5E5A4CD486BE2C94753697A5@rabbitmq.com>
	<CAMcAHLXNXWaj9A9kVPjZJc0cRz225gh=04H+xM=wW7-+pUdxtg@mail.gmail.com>
Message-ID: <CAOn7oW-6gTW-ux9pfT965ppbNp_Hon58348jw-APhp06R0U=1g@mail.gmail.com>

Hi and sorry for the late reply, I've had limited access to email during the
last week.
The location would have to be decided according to participation, which
honestly has been quite limited thus far, but Milan is a good bet.
Any contribution would be very welcome, but we'll need attendants, too!

Let's set the location for *Milan *and see if bumping this thread gives any
other responses. If you know any other groups where people might be
interested feel free to spread the voice.

On Thu, Sep 8, 2011 at 15:05, Alvaro Videla <videlalvaro at gmail.com> wrote:

> I vote for Milano too.
>
> I'd like to give a talk about Messaging Patterns with RabbitMQ if people is
> interested in it.
>
> Cheers,
>
> Alvaro
>
> On Thu, Sep 8, 2011 at 2:52 PM, Jakub Stastny <jakub at rabbitmq.com> wrote:
>
>>  I'd be happy to talk about AMQP libraries for Ruby if it's what the aim
>> group would be interested in.
>>
>> Cheers,
>>
>> --
>> Jakub Stastny
>> http://twitter.com/botanicus
>>
>> El Wednesday, 17 August 2011 a las 19:12, Simone Busoli escribi?:
>>
>> Hi, we would like to organize a one-day meeting in Italy about RabbitMQ. There
>> is no agenda yet, although it would ideally entail real-life experiences and
>> usage patterns, as well as anything speakers would like to talk about.
>> Everyone is welcome to attend or speak, and in order to get a sense of how
>> many people would be attending we've setup a brief survey that I invite you
>> to take a few seconds to fill at this url:
>> http://svy.mk/rabbitmq_italian_meeting_survey
>>
>> Thanks
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/3c511299/attachment.htm>

From clarsen at euphoriaaudio.com  Mon Sep 12 23:21:46 2011
From: clarsen at euphoriaaudio.com (Chris Larsen)
Date: Mon, 12 Sep 2011 18:21:46 -0400
Subject: [rabbitmq-discuss] Node reaches RAM High Watermark quickly
Message-ID: <00bc01cc719a$5c0fe6b0$142fb410$@euphoriaaudio.com>

Hello, we're running a bunch of nodes of RabbitMQ 2.3.1 on Erlang R13B03
under Debian and one of the nodes has a problem where it reaches the high
watermark, stops accepting producers and requires a reboot to recover. The
consumers eat all of the messages so that the queues are empty but the used
Ram never drops. I checked for queue leakage and we only have 9 queues
defined with about 100 unacked messages in one queue when the ram fills up.
We only have about 30 connections and less than 20 channels shown in the GUI
when it fails. The system isn't running in swap and messages are sometimes a
couple of MB in size but no larger. Any ideas what it might be? Thank you!

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/e1ef2cc7/attachment.htm>

From lefthandmagic at gmail.com  Tue Sep 13 00:38:41 2011
From: lefthandmagic at gmail.com (Praveen M)
Date: Mon, 12 Sep 2011 16:38:41 -0700
Subject: [rabbitmq-discuss] Using the same channel for producer and
	consumer.
In-Reply-To: <CAE3HoVTXoz8_-cpRfqLiUDdMQBzfhUaoPx=4GK_19ncDhP-FKw@mail.gmail.com>
References: <CAEqX17N-SQsLMwnQUWSunALjfXwcU9O+qZ+6bZ-ownDnybawUg@mail.gmail.com>
	<CAE3HoVTXoz8_-cpRfqLiUDdMQBzfhUaoPx=4GK_19ncDhP-FKw@mail.gmail.com>
Message-ID: <CAEqX17OgDeqzrzGwWUrMxf9i77czPZUeWNrm5eaZVq-GwD7Y5g@mail.gmail.com>

Thank you michael. I found what the issue was...I was setting the fields
mandatory and immediate as true when i publish messages. This was causing me
to lose messages when the consumer wasn't subscribed to the queue.


On Fri, Sep 9, 2011 at 9:00 PM, Michael Klishin <michael.s.klishin at gmail.com
> wrote:

> 2011/9/10 Praveen M <lefthandmagic at gmail.com>
>
>> I was wondering if someone could explain this behavior. I'm using the java
>> client and the latest 2.6.0 build of the server.
>
>
> It is perfectly fine to use the same channel for consuming and publishing
> messages. I cannot tell without seeing your code but what you are observing
> is likely to be the blocking behavior of QueueingConsumer.
>
> There is one downside to sharing channels this way: handling channel-level
> exceptions may get trickier/require you to keep more state around.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>


-- 
-Praveen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110912/6bf4ddbf/attachment.htm>

From tim.yen at gmail.com  Tue Sep 13 00:56:25 2011
From: tim.yen at gmail.com (Tim Yen)
Date: Tue, 13 Sep 2011 09:56:25 +1000
Subject: [rabbitmq-discuss] Connection getting closed
Message-ID: <CAL_6-TOqpzLECs=HS0oR9cEy6iRNZPkwNksLsGCZqHtg6-2oFQ@mail.gmail.com>

Hi,

Has anyone else run into this exception?

The AMQP operation was interrupted: AMQP close-reason, initiated by Library,
code=541, text="Unexpected Exception", classId=0, methodId=0,
cause=System.IO.IOException: Unable to read data from the transport
connection: An established connection was aborted by the software in your
host machine. ---> System.Net.Sockets.SocketException: An established
connection was aborted by the software in your host machine
   at System.Net.Sockets.Socket.Receive(Byte[] buffer, Int32 offset, Int32
size, SocketFlags socketFlags)
   at System.Net.Sockets.NetworkStream.Read(Byte[] buffer, Int32 offset,
Int32 size)
   --- End of inner exception stack trace ---
   at RabbitMQ.Client.Impl.Frame.ReadFrom(NetworkBinaryReader reader)
   at RabbitMQ.Client.Impl.SocketFrameHandler_0_9.ReadFrame()
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration()
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoop()


I declare my exchange and queue as such, I'm using the .net client.

ConnectionFactory factory = new ConnectionFactory();
factory.UserName = settings.UserName;
factory.Password = settings.Password;
factory.HostName = settings.HostIp;
factory.VirtualHost = "data_loading";
factory.Port = AmqpTcpEndpoint.UseDefaultPort;
factory.Protocol = Protocols.AMQP_0_9_1;this.connection =
factory.CreateConnection();this.model =
this.connection.CreateModel();this.model.ExchangeDeclare(MonitoringExchange,
ExchangeType.Topic, true, false,
null);this.model.QueueDeclare(EventMessagesQueueName, true, false,
false, null);this.model.QueueBind(EventMessagesQueueName,
MonitoringExchange, this.messageRoutingKey, null);

and the publish that raises the exception is

this.model.BasicPublish(MonitoringExchange, this.messageRoutingKey,
null, bytes);
The connection is kept open from the start of the program until the exit,
which will probably be days, but it seems to happen after a few minutes.
I haven't timed it yet.

Do I have to recycle connections every so often?

Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110913/068e8f4e/attachment.htm>

From bmurphy1976 at gmail.com  Tue Sep 13 03:02:24 2011
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Mon, 12 Sep 2011 21:02:24 -0500
Subject: [rabbitmq-discuss] v2.6.1: TypeError: can't convert undefined to
	object
Message-ID: <CAP+1M2fEEtvRCqJJwNhmT=FsvxjvLH+3XiAvMFsLpFNPNtUMTg@mail.gmail.com>

I created another cluster with active/active queues and am getting
some odd behavior in the management interface.  When I view the queues
in the web interface, I see "TypeError: can't convert undefined to
object" all over the place and the UI is pretty much broken.

I can provide screenshots and additional diagnostics if necessary.

3 node cluster, management tools installed only on node 1.

Thanks,
Bryan

From toby.corkindale at strategicdata.com.au  Tue Sep 13 07:51:46 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Tue, 13 Sep 2011 16:51:46 +1000
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is released
In-Reply-To: <4E6E187B.4090000@rabbitmq.com>
References: <4E6E187B.4090000@rabbitmq.com>
Message-ID: <4E6EFD82.7030901@strategicdata.com.au>

On 13/09/11 00:34, Tim Fox wrote:
> The RabbitMQ team is pleased to announce the release of RabbitMQ 2.6.1.

It would be great if someone could regularly build Debian packages of 
RabbitMQ for squeeze-backports.

As it stands, the current version in Debian stable is 1.8.1, and even in 
the testing and unstable branches, it's only 2.5.0.

Cheers,
Toby

From simon at rabbitmq.com  Tue Sep 13 10:02:11 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 13 Sep 2011 10:02:11 +0100
Subject: [rabbitmq-discuss] v2.6.1: TypeError: can't convert undefined
 to	object
In-Reply-To: <CAP+1M2fEEtvRCqJJwNhmT=FsvxjvLH+3XiAvMFsLpFNPNtUMTg@mail.gmail.com>
References: <CAP+1M2fEEtvRCqJJwNhmT=FsvxjvLH+3XiAvMFsLpFNPNtUMTg@mail.gmail.com>
Message-ID: <4E6F1C13.90706@rabbitmq.com>

On 13/09/11 03:02, Bryan Murphy wrote:
> I created another cluster with active/active queues and am getting
> some odd behavior in the management interface.  When I view the queues
> in the web interface, I see "TypeError: can't convert undefined to
> object" all over the place and the UI is pretty much broken.

I wish Javascript gave better error messages.

> I can provide screenshots and additional diagnostics if necessary.

So you're only seeing this on the queues page? In which case, can you 
capture the output of /api/queues with

curl -u guest:guest http://servername:55672/api/queues

or

rabbitmqadmin -f raw_json list queues

and send it to me?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From acheremukhin.digitalguard at gmail.com  Tue Sep 13 11:09:28 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Tue, 13 Sep 2011 03:09:28 -0700 (PDT)
Subject: [rabbitmq-discuss] channel, error
Message-ID: <106111.108.1315908568797.JavaMail.geo-discussion-forums@yqnh42>

Hello.
Could i use channel after that any error was happened in the channel (for 
example not-found, 404)?
I'm using rabbitmq-c and after that was happened error in channel, 
rabbitmq-server don't response to me. It's normal?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110913/b92a6ab1/attachment.htm>

From majek04 at gmail.com  Tue Sep 13 11:59:16 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 13 Sep 2011 11:59:16 +0100
Subject: [rabbitmq-discuss]  channel, error
In-Reply-To: <CABzX+qxmyw53OeoFVmYibeHbHhz-o63HVND09NgnTemH2s7SyA@mail.gmail.com>
References: <106111.108.1315908568797.JavaMail.geo-discussion-forums@yqnh42>
	<CABzX+qxmyw53OeoFVmYibeHbHhz-o63HVND09NgnTemH2s7SyA@mail.gmail.com>
Message-ID: <CABzX+qxS6LvguH9FpezFcZ0G1mREMQFRegdtpgRX792+pdRAKQ@mail.gmail.com>

On Tue, Sep 13, 2011 at 11:09, Cheremukhin Andrey
<acheremukhin.digitalguard at gmail.com> wrote:
> Could i use channel after that any error was happened in the channel (for
> example not-found, 404)?
> I'm using rabbitmq-c and after that was happened error in channel,
> rabbitmq-server don't response to me. It's normal?

No. When there is an error on a channel - it's automatically getting closed.
You need to open a new channel to do anything.

If you don't know why there was a channel error, sometimes you can
find interesting details in rabbitmq logs.

Cheers,
?Marek

From umut.sahin at vigasis.com  Tue Sep 13 12:37:06 2011
From: umut.sahin at vigasis.com (Umut Sahin)
Date: Tue, 13 Sep 2011 13:37:06 +0200 (CEST)
Subject: [rabbitmq-discuss] Issues with RabbitMQ, 	SSL and .NET
Message-ID: <f7m0u7n.269442d04a17189dfd81cdd08904d4a4@webmail.vigasis.com>

>Is there any chance you could try running your .NET program from a different
>machine?  In particular, could you run under Mono on the same machine as
>the broker?

Alex, we finally made it but i think we find a bug,
on our machine with specs .Net v4.0 with RabbitMQ-Client 2.6.0 on Windows7 x64,

Our .Net code was
------------------------------------------------------------------
cf.Ssl.ServerName = "server-PC";
cf.Ssl.CertPath = "./clientkeycert.p12";
cf.Ssl.CertPassphrase = "testing";
cf.Ssl.Enabled = true;
cf.Ssl.Version = System.Security.Authentication.SslProtocols.Ssl3;
cf.Address ="10.35.110.167";
cf.HostName = "server-PC";
cf.UserName ="guest";
cf.Password = "guest";
cf.Port = 5671;
------------------------------------------------------------------
this code crashes all the time...

but when we take the #cf.Address ="10.35.110.167";# line to the bottom it works like a dream...
so the working code is below:
------------------------------------------------------------------
cf.Ssl.ServerName = "server-PC";
cf.Ssl.CertPath = "./clientkeycert.p12";
cf.Ssl.CertPassphrase = "testing";
cf.Ssl.Enabled = true;
cf.Ssl.Version = System.Security.Authentication.SslProtocols.Ssl3;
cf.HostName = "server-PC";
cf.UserName ="guest";
cf.Password = "guest";
cf.Port = 5671;
cf.Address ="10.35.110.167";
------------------------------------------------------------------
Thanks for your endless helps and Regards,
Umut



From acheremukhin.digitalguard at gmail.com  Tue Sep 13 12:38:17 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Tue, 13 Sep 2011 04:38:17 -0700 (PDT)
Subject: [rabbitmq-discuss] channel, error
In-Reply-To: <CABzX+qxS6LvguH9FpezFcZ0G1mREMQFRegdtpgRX792+pdRAKQ@mail.gmail.com>
References: <106111.108.1315908568797.JavaMail.geo-discussion-forums@yqnh42>
	<CABzX+qxmyw53OeoFVmYibeHbHhz-o63HVND09NgnTemH2s7SyA@mail.gmail.com>
	<CABzX+qxS6LvguH9FpezFcZ0G1mREMQFRegdtpgRX792+pdRAKQ@mail.gmail.com>
Message-ID: <20255012.365.1315913897571.JavaMail.geo-discussion-forums@yqjc18>

Thanks you.
I didn't know really that channel automatically getting closed after any 
errors.
Could you show it in documentation, please?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110913/28b04934/attachment.htm>

From acheremukhin.digitalguard at gmail.com  Tue Sep 13 13:35:43 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Tue, 13 Sep 2011 05:35:43 -0700 (PDT)
Subject: [rabbitmq-discuss] channel, error
In-Reply-To: <20255012.365.1315913897571.JavaMail.geo-discussion-forums@yqjc18>
References: <106111.108.1315908568797.JavaMail.geo-discussion-forums@yqnh42>
	<CABzX+qxmyw53OeoFVmYibeHbHhz-o63HVND09NgnTemH2s7SyA@mail.gmail.com>
	<CABzX+qxS6LvguH9FpezFcZ0G1mREMQFRegdtpgRX792+pdRAKQ@mail.gmail.com>
	<20255012.365.1315913897571.JavaMail.geo-discussion-forums@yqjc18>
Message-ID: <10864392.263.1315917343142.JavaMail.geo-discussion-forums@yqih9>

in documentation and/or in code.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110913/3e0eb3c1/attachment.htm>

From matthew at rabbitmq.com  Tue Sep 13 13:50:10 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 13 Sep 2011 13:50:10 +0100
Subject: [rabbitmq-discuss] channel, error
In-Reply-To: <10864392.263.1315917343142.JavaMail.geo-discussion-forums@yqih9>
References: <106111.108.1315908568797.JavaMail.geo-discussion-forums@yqnh42>
	<CABzX+qxmyw53OeoFVmYibeHbHhz-o63HVND09NgnTemH2s7SyA@mail.gmail.com>
	<CABzX+qxS6LvguH9FpezFcZ0G1mREMQFRegdtpgRX792+pdRAKQ@mail.gmail.com>
	<20255012.365.1315913897571.JavaMail.geo-discussion-forums@yqjc18>
	<10864392.263.1315917343142.JavaMail.geo-discussion-forums@yqih9>
Message-ID: <20110913125009.GA30647@rabbitmq.com>

On Tue, Sep 13, 2011 at 05:35:43AM -0700, Cheremukhin Andrey wrote:
> in documentation and/or in code.

http://www.rabbitmq.com/amqp-0-9-1-reference.html

Search for error.

It says that both channel.error and connection.error can be raised in
the event of an error, and methods in there that can result in errors
are indicated - search for "Error code:".

Matthew

From matthew at rabbitmq.com  Tue Sep 13 14:09:15 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 13 Sep 2011 14:09:15 +0100
Subject: [rabbitmq-discuss] channel, error
In-Reply-To: <20110913125009.GA30647@rabbitmq.com>
References: <106111.108.1315908568797.JavaMail.geo-discussion-forums@yqnh42>
	<CABzX+qxmyw53OeoFVmYibeHbHhz-o63HVND09NgnTemH2s7SyA@mail.gmail.com>
	<CABzX+qxS6LvguH9FpezFcZ0G1mREMQFRegdtpgRX792+pdRAKQ@mail.gmail.com>
	<20255012.365.1315913897571.JavaMail.geo-discussion-forums@yqjc18>
	<10864392.263.1315917343142.JavaMail.geo-discussion-forums@yqih9>
	<20110913125009.GA30647@rabbitmq.com>
Message-ID: <20110913130915.GB30647@rabbitmq.com>

On Tue, Sep 13, 2011 at 01:50:10PM +0100, Matthew Sackman wrote:
> On Tue, Sep 13, 2011 at 05:35:43AM -0700, Cheremukhin Andrey wrote:
> > in documentation and/or in code.
> 
> http://www.rabbitmq.com/amqp-0-9-1-reference.html
> 
> Search for error.
> 
> It says that both channel.error and connection.error can be raised in

...gah. I meant channel.close and connection.close. Sorry for
unnecessary further confusion!

Matthew

From acheremukhin.digitalguard at gmail.com  Tue Sep 13 14:26:45 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Tue, 13 Sep 2011 06:26:45 -0700 (PDT)
Subject: [rabbitmq-discuss] channel, error
In-Reply-To: <20110913130915.GB30647@rabbitmq.com>
References: <106111.108.1315908568797.JavaMail.geo-discussion-forums@yqnh42>
	<CABzX+qxmyw53OeoFVmYibeHbHhz-o63HVND09NgnTemH2s7SyA@mail.gmail.com>
	<CABzX+qxS6LvguH9FpezFcZ0G1mREMQFRegdtpgRX792+pdRAKQ@mail.gmail.com>
	<20255012.365.1315913897571.JavaMail.geo-discussion-forums@yqjc18>
	<10864392.263.1315917343142.JavaMail.geo-discussion-forums@yqih9>
	<20110913125009.GA30647@rabbitmq.com>
	<20110913130915.GB30647@rabbitmq.com>
Message-ID: <2137048.1526.1315920405512.JavaMail.geo-discussion-forums@yqcd38>

Thanks you.
I'm seeing only "*Channel Errors:* These are associated with failures that 
affect the current channel but no other channels created from the same 
connection. "

It's meen that the channel will close?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110913/d192b750/attachment.htm>

From majek04 at gmail.com  Tue Sep 13 14:31:10 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 13 Sep 2011 14:31:10 +0100
Subject: [rabbitmq-discuss] channel, error
In-Reply-To: <2137048.1526.1315920405512.JavaMail.geo-discussion-forums@yqcd38>
References: <106111.108.1315908568797.JavaMail.geo-discussion-forums@yqnh42>
	<CABzX+qxmyw53OeoFVmYibeHbHhz-o63HVND09NgnTemH2s7SyA@mail.gmail.com>
	<CABzX+qxS6LvguH9FpezFcZ0G1mREMQFRegdtpgRX792+pdRAKQ@mail.gmail.com>
	<20255012.365.1315913897571.JavaMail.geo-discussion-forums@yqjc18>
	<10864392.263.1315917343142.JavaMail.geo-discussion-forums@yqih9>
	<20110913125009.GA30647@rabbitmq.com>
	<20110913130915.GB30647@rabbitmq.com>
	<2137048.1526.1315920405512.JavaMail.geo-discussion-forums@yqcd38>
Message-ID: <CABzX+qwDN=_4PjGJW7tojcm2cXrJxASWNFEWQuhc0O5LD_PURw@mail.gmail.com>

On the error, server send 'channel.close' method:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#channel.close

"This method indicates that the sender wants to close the channel.
This may be due to internal conditions (e.g. a forced shut-down) or
due to an error handling a specific method, i.e. an exception. When a
close is due to an exception, the sender provides the class and method
id of the method which caused the exception."

So, an error is essentially a channel-close method issued by the
server. Is that any clearer now?

Cheers,
   Marek

On Tue, Sep 13, 2011 at 14:26, Cheremukhin Andrey
<acheremukhin.digitalguard at gmail.com> wrote:
> Thanks you.
> I'm seeing only "Channel Errors: These are associated with failures that
> affect the current channel but no other channels created from the same
> connection. "
>
> It's meen that the channel will close?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From acheremukhin.digitalguard at gmail.com  Tue Sep 13 14:31:35 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Tue, 13 Sep 2011 06:31:35 -0700 (PDT)
Subject: [rabbitmq-discuss] channel, error
In-Reply-To: <20110913130915.GB30647@rabbitmq.com>
References: <106111.108.1315908568797.JavaMail.geo-discussion-forums@yqnh42>
	<CABzX+qxmyw53OeoFVmYibeHbHhz-o63HVND09NgnTemH2s7SyA@mail.gmail.com>
	<CABzX+qxS6LvguH9FpezFcZ0G1mREMQFRegdtpgRX792+pdRAKQ@mail.gmail.com>
	<20255012.365.1315913897571.JavaMail.geo-discussion-forums@yqjc18>
	<10864392.263.1315917343142.JavaMail.geo-discussion-forums@yqih9>
	<20110913125009.GA30647@rabbitmq.com>
	<20110913130915.GB30647@rabbitmq.com>
Message-ID: <20896930.3548.1315920695590.JavaMail.geo-discussion-forums@yqgn17>

Thanks you too.
I'm seeing only "*Channel Errors:* These are associated with failures that 
affect the current channel but no other channels created from the same 
connection. "

Does it meen that channel will close in case this errors?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110913/d4021341/attachment.htm>

From acheremukhin.digitalguard at gmail.com  Tue Sep 13 14:38:29 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Tue, 13 Sep 2011 06:38:29 -0700 (PDT)
Subject: [rabbitmq-discuss] channel, error
In-Reply-To: <CABzX+qwDN=_4PjGJW7tojcm2cXrJxASWNFEWQuhc0O5LD_PURw@mail.gmail.com>
References: <106111.108.1315908568797.JavaMail.geo-discussion-forums@yqnh42>
	<CABzX+qxmyw53OeoFVmYibeHbHhz-o63HVND09NgnTemH2s7SyA@mail.gmail.com>
	<CABzX+qxS6LvguH9FpezFcZ0G1mREMQFRegdtpgRX792+pdRAKQ@mail.gmail.com>
	<20255012.365.1315913897571.JavaMail.geo-discussion-forums@yqjc18>
	<10864392.263.1315917343142.JavaMail.geo-discussion-forums@yqih9>
	<20110913125009.GA30647@rabbitmq.com>
	<20110913130915.GB30647@rabbitmq.com>
	<2137048.1526.1315920405512.JavaMail.geo-discussion-forums@yqcd38>
	<CABzX+qwDN=_4PjGJW7tojcm2cXrJxASWNFEWQuhc0O5LD_PURw@mail.gmail.com>
Message-ID: <21661281.3588.1315921109476.JavaMail.geo-discussion-forums@yqef5>

Yes, i've undestood.
Thanks you :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110913/dc0694e3/attachment.htm>

From iain.hull at workday.com  Tue Sep 13 16:43:41 2011
From: iain.hull at workday.com (Iain Hull)
Date: Tue, 13 Sep 2011 10:43:41 -0500
Subject: [rabbitmq-discuss] Channels closed unexpectedly in Java client
Message-ID: <925DDDE9D69E7143B3252E2D4680A36703C174CE@34093-C5-EVS1.exchange.rackspace.com>

Hi,

I am currently running a stress test on one of our RabbitMQ production
servers.  The goal of the test is to discover how many queues RabbitMQ
can support this will tell us how many tenants we can scale to on a
single box.  The test creates a large number of queues, then for each
queue adds three tasks to a thread pool (with 20 threads).  One task
writes 100 messages, the next reads 100 messages and the third task
reads and writes 100 messages.  The messages are read with basicGet.  We
are currently using RabbitMQ 2.5.1 server and Java client on CentOS
64bit with 8 cores and 96Gb of Ram (the high water mark is set to 0.8).

As we ramp up the number of queues above 32,000 some of the tasks start
to fail in basicGet with an IOException, there is also an error in the
server log file.   As the queues increase these errors become more
frequent.

Queues: 32000 task success: 95997 errors: 3
Queues: 64000 task success: 159997 errors: 32003
Queues: 128000 task success: 287997 errors: 96003

The errors occur in batches and then clear up, however the numbers for
the errors are very suspicious as they are (n - 32000 + 3).  During the
whole test only 6-8Gb of ram is used and rabbit server uses at most 350%
cpu (of 800%).  I am wondering if this is a sign that I am hitting the
limit in the number of queues, I have miss configured RabbitMQ or my
test is not valid.  Any help to figure this out would be appreciated.

Regards,
Iain.


=ERROR REPORT==== 13-Sep-2011::09:09:41 ===
connection <0.9484.159>, channel 1 - error:
{amqp_error,not_found,"no queue 'TestExchange_31997' in vhost '/'",
            'basic.get'}

=ERROR REPORT==== 13-Sep-2011::09:09:41 ===
** Generic server <0.9652.183> terminating
** Last message in was {deliver,
                        {delivery,true,false,none,<0.9651.183>,
                         {basic_message,
 
{resource,<<"/">>,exchange,<<"TestExchange_31998">>},
                          [<<>>],
                          {content,60,
 
{'P_basic',<<"text/plain">>,undefined,undefined,2,
                            0,undefined,undefined,undefined,undefined,
 
undefined,undefined,undefined,undefined,undefined},
 
<<152,0,10,116,101,120,116,47,112,108,97,105,110,2,0>>,
                           rabbit_framing_amqp_0_9_1,
                           [<<"Hello World!0 from q=hello">>]},
 
<<18,156,101,170,65,11,23,81,252,168,116,117,202,153,
                            120,220>>,
                          true},
                         undefined}}
** When Server state == {q,
                         {amqqueue,
 
{resource,<<"/">>,queue,<<"TestExchange_31998">>},
                          true,false,none,[],<0.9652.183>},
                         none,false,rabbit_variable_queue,
                         {vqstate,
                          {[],[]},
                          {0,{[],[]}},
                          {delta,undefined,0,undefined},
                          {0,{[],[]}},
                          {[],[]},
                          0,
                          {dict,0,16,16,8,80,48,
 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          undefined,
                          {0,nil},
                          {qistate,
 
"/var/lib/rabbitmq/mnesia/rabbit at dev182/queues/3N66B3H9OM1Y8OASL0S3XK8TT
",
                           {{dict,0,16,16,8,80,48,
 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            []},
                           undefined,0,262144,
                           #Fun<rabbit_variable_queue.2.111108431>,[]},
                          {{client_msstate,msg_store_persistent,
 
<<81,127,46,195,11,139,99,60,19,29,15,68,36,202,
                              246,12>>,
                            {dict,0,16,16,8,80,48,
 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,245835,
 
"/var/lib/rabbitmq/mnesia/rabbit at dev182/msg_store_persistent"},
                            rabbit_msg_store_ets_index,
 
"/var/lib/rabbitmq/mnesia/rabbit at dev182/msg_store_persistent",
                            <0.240.0>,249932,241738,254029},
                           {client_msstate,msg_store_transient,
 
<<201,227,238,162,120,244,196,219,223,246,129,3,
                              224,211,0,204>>,
                            {dict,0,16,16,8,80,48,
 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []}}},
                            {state,229447,
 
"/var/lib/rabbitmq/mnesia/rabbit at dev182/msg_store_transient"},
                            rabbit_msg_store_ets_index,
 
"/var/lib/rabbitmq/mnesia/rabbit at dev182/msg_store_transient",
                            <0.232.0>,233544,225350,237641}},
                          {sync,[],[],[],[]},
 
true,0,#Fun<rabbit_amqqueue_process.4.73542412>,
                          #Fun<rabbit_amqqueue_process.5.110277333>,0,0,
                          infinity,0,0,0,0,0,0,
                          {rates,
                           {{1315,904981,880372},0},
                           {{1315,904981,880372},0},
                           0.0,0.0,
                           {1315,904981,880372}},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          {0,nil},
                          0,0,
                          {rates,
                           {{1315,904981,880372},0},
                           {{1315,904981,880372},0},
                           0.0,0.0,
                           {1315,904981,880372}}},
                         {[],[]},
                         {[],[]},
                         undefined,undefined,
                         {1315904986880394,#Ref<0.0.298.230323>},
                         undefined,
 
{state,fine,{1315904986880410,#Ref<0.0.298.230325>}},
                         {dict,0,16,16,8,80,48,
 
{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
 
{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         undefined,undefined}
** Reason for termination == 
** {{badmatch,{error,emlink}},
    [{rabbit_queue_index,get_journal_handle,1},
     {rabbit_queue_index,publish,5},
     {rabbit_variable_queue,maybe_write_index_to_disk,3},
     {rabbit_variable_queue,maybe_write_to_disk,4},
     {rabbit_variable_queue,publish,5},
     {rabbit_variable_queue,publish,4},
     {rabbit_amqqueue_process,deliver_or_enqueue,2},
     {rabbit_amqqueue_process,handle_call,3}]}





Tue Sep 13 09:09:41 UTC 2011: java.io.IOException
        at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:110)
        at
com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:134)
        at com.rabbitmq.client.impl.ChannelN.basicGet(ChannelN.java:806)
        at
com.workday.messaging.test.BreakRabbitBreakTest.receiveMessages(BreakRab
bitBreakTest.java:200)
        at
com.workday.messaging.test.BreakRabbitBreakTest.access$2(BreakRabbitBrea
kTest.java:198)
        at
com.workday.messaging.test.BreakRabbitBreakTest$SendAndReceive.perform(B
reakRabbitBreakTest.java:262)
        at
com.workday.messaging.test.BreakRabbitBreakTest$AbstractMessageRunner.ca
ll(BreakRabbitBreakTest.java:234)
        at
com.workday.messaging.test.BreakRabbitBreakTest$AbstractMessageRunner.ca
ll(BreakRabbitBreakTest.java:1)
        at
java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)
        at
java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
        at
java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)
        at
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecuto
r.java:886)
        at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.ja
va:908)
        at java.lang.Thread.run(Thread.java:662)
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error;
reason: {#method<channel.close>(reply-code=404, reply-text=NOT_FOUND -
no queue 'TestExchange_31997' in vhost '/', class-id=60,
method-id=70),null,""}
        at
com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
        at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(Bl
ockingValueOrException.java:33)
        at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQ
Channel.java:337)
        at
com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:210)
        at
com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:128)
        ... 14 more
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error;
reason: {#method<channel.close>(reply-code=404, reply-text=NOT_FOUND -
no queue 'TestExchange_31997' in vhost '/', class-id=60,
method-id=70),null,""}
        at
com.rabbitmq.client.impl.ChannelN.asyncShutdown(ChannelN.java:422)
        at
com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:262)
        at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChan
nel.java:154)
        at
com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:99)
        at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:4
43)
Tue Sep 13 09:09:41 UTC 2011: java.io.IOException
        at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:110)
        at
com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:134)
        at com.rabbitmq.client.impl.ChannelN.basicGet(ChannelN.java:806)
        at
com.workday.messaging.test.BreakRabbitBreakTest.receiveMessages(BreakRab
bitBreakTest.java:200)
        at
com.workday.messaging.test.BreakRabbitBreakTest.access$2(BreakRabbitBrea
kTest.java:198)
        at
com.workday.messaging.test.BreakRabbitBreakTest$SendAndReceive.perform(B
reakRabbitBreakTest.java:262)
        at
com.workday.messaging.test.BreakRabbitBreakTest$AbstractMessageRunner.ca
ll(BreakRabbitBreakTest.java:234)
        at
com.workday.messaging.test.BreakRabbitBreakTest$AbstractMessageRunner.ca
ll(BreakRabbitBreakTest.java:1)
        at
java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)
        at
java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)
        at
java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
        at java.util.concurrent.FutureTask.run(FutureTask.java:138)
        at
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecuto
r.java:886)
        at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.ja
va:908)
        at java.lang.Thread.run(Thread.java:662)
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error;
reason: {#method<channel.close>(reply-code=404, reply-text=NOT_FOUND -
no queue 'TestExchange_31998' in vhost '/', class-id=60,
method-id=70),null,""}
        at
com.rabbitmq.utility.ValueOrException.getValue(ValueOrException.java:67)
        at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(Bl
ockingValueOrException.java:33)
        at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQ
Channel.java:337)
        at
com.rabbitmq.client.impl.AMQChannel.privateRpc(AMQChannel.java:210)
        at
com.rabbitmq.client.impl.AMQChannel.exnWrappingRpc(AMQChannel.java:128)
        ... 14 more
Caused by: com.rabbitmq.client.ShutdownSignalException: channel error;
reason: {#method<channel.close>(reply-code=404, reply-text=NOT_FOUND -
no queue 'TestExchange_31998' in vhost '/', class-id=60,
method-id=70),null,""}
        at
com.rabbitmq.client.impl.ChannelN.asyncShutdown(ChannelN.java:422)
        at
com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:262)
        at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChan
nel.java:154)
        at
com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:99)
        at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:4
43)

From matthew at rabbitmq.com  Tue Sep 13 16:47:56 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Tue, 13 Sep 2011 16:47:56 +0100
Subject: [rabbitmq-discuss] Channels closed unexpectedly in Java client
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A36703C174CE@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A36703C174CE@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <20110913154755.GD30647@rabbitmq.com>

Hi,

> ** Reason for termination == 
> ** {{badmatch,{error,emlink}},

EMLINK: Too many links (POSIX.1)

Rabbit doesn't create links though, so this is a rather odd error to
occur, but for some reason, your kernel/filesystem is reporting this
error. Do you have lots of links on your disks?

Matthew

From aaron at agoragames.com  Tue Sep 13 21:17:31 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 13 Sep 2011 16:17:31 -0400
Subject: [rabbitmq-discuss] behavior when client socket close
Message-ID: <CAHiEoM4bqBwzO9A3ivfaAPB=g7=BOOQJEm58eG5KUuwvtm5MMg@mail.gmail.com>

We're trying to determine Rabbits expected behavior when a client host
shuts off. Server is hardware 2.5.1, client is a VM that was shut down
cleanly (i.e. power off). We have no heartbeats, and the client turns
on keepalives. We found that linux reported these sockets as
ESTABLISHED after the clients were turned off, and we're trying to
determine if this is a problem with our vendor's network or expected
behavior. Host OS is Linux 2.6.35.

-Aaron



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From lefthandmagic at gmail.com  Wed Sep 14 01:59:48 2011
From: lefthandmagic at gmail.com (Praveen M)
Date: Tue, 13 Sep 2011 17:59:48 -0700
Subject: [rabbitmq-discuss] are these features planned/do they already exist?
Message-ID: <CAEqX17NEqTKefMdLZ2mFyVFw+SStkhnOtvtnqa+7Nk8HPZqEZQ@mail.gmail.com>

Hi,

I am just curious if a couple of features that i'm looking for exist in the
rabbitmq impl. I did some googling around these questions and wasn't able to
find anything that answered my question directly. My apology if these are
duplicates.

1) Ability to consume messages in bulk. I see that basic consume does a call
back for each message..Is there an api to do the callback with a user
defined bulk of messages?

2) Is there a way to publish a message with a delay? I mean, is there a way
to publish a message with a delay and have the message consumed only after
the delay expires? ~ I know i can do this by creating a queue on my own and
have a job move messages when the delay expires...wondering if something
like this is already there in rabbit/planned.

3) Are dead-letter queues there yet? and messages with TTL?

Thanks,
-- 
-Praveen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110913/33a68b11/attachment.htm>

From toby.corkindale at strategicdata.com.au  Wed Sep 14 02:25:39 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 14 Sep 2011 11:25:39 +1000
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is released
In-Reply-To: <44465273-4DC1-4509-A210-BA3F98BCF124@gmail.com>
References: <4E6E187B.4090000@rabbitmq.com>
	<4E6EFD82.7030901@strategicdata.com.au>
	<44465273-4DC1-4509-A210-BA3F98BCF124@gmail.com>
Message-ID: <4E700293.7070906@strategicdata.com.au>

On 13/09/11 22:00, Michael Klishin wrote:
> Toby Corkindale:
>
>> As it stands, the current version in Debian stable is 1.8.1, and even in the testing and unstable branches, it's only 2.5.0.
>
> Toby,
>
> There is an apt repo available at rabbitmq.com:
>
> http://www.rabbitmq.com/debian.html#apt

Is there any intention to package up things like rabbitmq-stomp, 
rabbitmq-common, rabbitmq-erlang-client, etc too?
(They're available on Ubuntu)

Cheers,
Toby

From michael.s.klishin at gmail.com  Wed Sep 14 04:39:28 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 14 Sep 2011 07:39:28 +0400
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is released
In-Reply-To: <4E700293.7070906@strategicdata.com.au>
References: <4E6E187B.4090000@rabbitmq.com>
	<4E6EFD82.7030901@strategicdata.com.au>
	<44465273-4DC1-4509-A210-BA3F98BCF124@gmail.com>
	<4E700293.7070906@strategicdata.com.au>
Message-ID: <CAE3HoVS7aQCyZkjK7D57ZHnYfaZ2m8S4NjXHwE0zJhf8Z1oaKQ@mail.gmail.com>

2011/9/14 Toby Corkindale <toby.corkindale at strategicdata.com.au>

> Is there any intention to package up things like rabbitmq-stomp,
> rabbitmq-common, rabbitmq-erlang-client, etc too?
> (They're available on Ubuntu)
>

This is a question for RabbitMQ team membersbut I definitely would like to
see plugins distributed as .deb packages.
Current way of installing them is just painful to automate around and
requires manual maintenance even on point releases.
There has to be a better way in late 2011.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110914/ec8ffa1f/attachment.htm>

From michael.s.klishin at gmail.com  Wed Sep 14 04:52:52 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 14 Sep 2011 07:52:52 +0400
Subject: [rabbitmq-discuss] SockJS protocol documentation?
Message-ID: <CAE3HoVSyQoBOy3jF5eEnuCY1MVtO_LbAV0kVaaEjCajiPR6G5w@mail.gmail.com>

Hi! I hope SocksJS questions appropriate for this mailing list.

I am looking at SocksJS and like many things about it. Is there any
documentation on the protocol itself or should I
just read the source and ask questions? Will the canonical implementation
always be Node.js-based? What's RabbitMQ team's
take on people going ahead and implementing SocksJS server on the JVM, in
Ruby and so on?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110914/44169830/attachment.htm>

From toby.corkindale at strategicdata.com.au  Wed Sep 14 05:04:33 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Wed, 14 Sep 2011 14:04:33 +1000
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is released
In-Reply-To: <CAE3HoVS7aQCyZkjK7D57ZHnYfaZ2m8S4NjXHwE0zJhf8Z1oaKQ@mail.gmail.com>
References: <4E6E187B.4090000@rabbitmq.com>
	<4E6EFD82.7030901@strategicdata.com.au>
	<44465273-4DC1-4509-A210-BA3F98BCF124@gmail.com>
	<4E700293.7070906@strategicdata.com.au>
	<CAE3HoVS7aQCyZkjK7D57ZHnYfaZ2m8S4NjXHwE0zJhf8Z1oaKQ@mail.gmail.com>
Message-ID: <4E7027D1.3090007@strategicdata.com.au>

On 14/09/11 13:39, Michael Klishin wrote:
> 2011/9/14 Toby Corkindale <toby.corkindale at strategicdata.com.au
> <mailto:toby.corkindale at strategicdata.com.au>>
>
>     Is there any intention to package up things like rabbitmq-stomp,
>     rabbitmq-common, rabbitmq-erlang-client, etc too?
>     (They're available on Ubuntu)
>
>
> This is a question for RabbitMQ team membersbut I definitely would like
> to see plugins distributed as .deb packages.
> Current way of installing them is just painful to automate around and
> requires manual maintenance even on point releases.
> There has to be a better way in late 2011.

Yeah, it's a bigger problem than people realise, perhaps, due to the 
requirement to match versions between plugins and the main package.

Eg. If we put the RabbitMQ apt repo into our sources.list, then 
sysadmins will update the package automatically.. but if the plugins are 
manually installed (or installed via puppet from a fixed set) then 
that'll break.

Toby

From iain.hull at workday.com  Wed Sep 14 08:47:33 2011
From: iain.hull at workday.com (Iain Hull)
Date: Wed, 14 Sep 2011 02:47:33 -0500
Subject: [rabbitmq-discuss] Channels closed unexpectedly in Java client
In-Reply-To: <20110913154755.GD30647@rabbitmq.com>
References: <925DDDE9D69E7143B3252E2D4680A36703C174CE@34093-C5-EVS1.exchange.rackspace.com>
	<20110913154755.GD30647@rabbitmq.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A36703C618BD@34093-C5-EVS1.exchange.rackspace.com>

Hi Matthew,

Thank you very much I think I have tracked the problem down to our use
of the ext3 file system for /var/lib/rabbitmq.  


From alexis at rabbitmq.com  Wed Sep 14 08:50:01 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 14 Sep 2011 08:50:01 +0100
Subject: [rabbitmq-discuss] SockJS protocol documentation?
In-Reply-To: <CAE3HoVSyQoBOy3jF5eEnuCY1MVtO_LbAV0kVaaEjCajiPR6G5w@mail.gmail.com>
References: <CAE3HoVSyQoBOy3jF5eEnuCY1MVtO_LbAV0kVaaEjCajiPR6G5w@mail.gmail.com>
Message-ID: <CACOPnveuuu0aRBC+9m16q5KpSuczZ-pmUc-zqQrt_tLkj=tFGw@mail.gmail.com>

On Wed, Sep 14, 2011 at 4:52 AM, Michael Klishin
<michael.s.klishin at gmail.com> wrote:
> Hi! I hope SocksJS questions appropriate for this mailing list.

Yes :-)


> I am looking at SocksJS and like many things about it. Is there any
> documentation on the protocol itself or should I
> just read the source and ask questions?

I think Marek is the best guy to respond but let me have a try...

Have you checked the two pages on GH?

https://github.com/majek/sockjs-node
https://github.com/majek/sockjs-client



> Will the canonical implementation
> always be Node.js-based?

Given that SockJS arose from use of Socket.io, it made sense to
present it in a way that the Node.js folks could use.

Another obvious implementation opportunity is a RabbitMQ plugin.  That
would be in erlang.  Simon is looking in this..


> What's RabbitMQ team's
> take on people going ahead and implementing SocksJS server on the JVM, in
> Ruby and so on?

I think that would be great.

Have you looked at node.x?  That might be a good place to do some hacking....

https://github.com/purplefox/node.x

Or (eg) https://github.com/purplefox/node.x/blob/master/src/examples/java/org/nodex/java/examples/websockets/WebsocketsExample.java

alexis



> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From ludy at wawame.cn  Wed Sep 14 09:57:29 2011
From: ludy at wawame.cn (ludy)
Date: Wed, 14 Sep 2011 16:57:29 +0800
Subject: [rabbitmq-discuss] dead connection ?
Message-ID: <1315990649.13571.12.camel@ludy-desktop>

i want to use rabbitmq for android push.i use device id to name a
queue.when mobile switches network,mobile will reconnect to the
queue,and then the queue do not send message to the new consumer
immediately.the old consumer is still exist but connection is not
alive,how can i set a queue only receive one alive consumer???


From lascoltodelvenerdi at gmail.com  Wed Sep 14 10:24:15 2011
From: lascoltodelvenerdi at gmail.com (LAscolto)
Date: Wed, 14 Sep 2011 02:24:15 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ, PHP and RPC
Message-ID: <8f0b836f-d514-4dba-aab9-08f365bbadf4@d2g2000vbk.googlegroups.com>

Hi there!

Can someone help me?

I'm looking to implement a RPC with PHP, but I can not find any
example.

So first of all, is possible do it in PHP?

Second, can someone point me to a tutorial or example?

I'm using this version of the php AMQP library: tnc-php-amqplib-
b6e0bb2.

Many thanks.

Antonio

From majek04 at gmail.com  Wed Sep 14 10:42:51 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 14 Sep 2011 10:42:51 +0100
Subject: [rabbitmq-discuss] SockJS protocol documentation?
In-Reply-To: <CAE3HoVSyQoBOy3jF5eEnuCY1MVtO_LbAV0kVaaEjCajiPR6G5w@mail.gmail.com>
References: <CAE3HoVSyQoBOy3jF5eEnuCY1MVtO_LbAV0kVaaEjCajiPR6G5w@mail.gmail.com>
Message-ID: <CABzX+qzkyp_ZBp-s5GcVUq6bR=H2-Lvdz-e3yHpXrwG-Bj1bmA@mail.gmail.com>

On Wed, Sep 14, 2011 at 04:52, Michael Klishin
<michael.s.klishin at gmail.com> wrote:
> Hi! I hope SocksJS questions appropriate for this mailing list.

Yes and no. Sockjs mailing list (in CC)  may have more targeted audience:
   http://groups.google.com/group/sockjs

> I am looking at SocksJS and like many things about it. Is there any
> documentation on the protocol itself or should I
> just read the source and ask questions?

For a time being the source code is the only resource. I'm thinking about
writing some kind of test suite to verify implementations and make
sure that they properly implement all the quirks, but that's still
in planning stage.

> Will the canonical implementation
> always be Node.js-based? What's RabbitMQ team's
> take on people going ahead and implementing SocksJS server on the JVM, in
> Ruby and so on?

I will continue trying new things in sockjs-node - it's just easier
to prototype in node. Hopefully, the server side shouldn't evolve much,
so there shouldn't be a painful to keep servers in sync with the client.

I would love to see ruby/python/jvm implementations...

Cheers,
   Marek

From matthew at rabbitmq.com  Wed Sep 14 11:02:49 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 14 Sep 2011 11:02:49 +0100
Subject: [rabbitmq-discuss] Channels closed unexpectedly in Java client
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A36703C618BD@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A36703C174CE@34093-C5-EVS1.exchange.rackspace.com>
	<20110913154755.GD30647@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703C618BD@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <20110914100248.GA5367@rabbitmq.com>

Hi Iain,

On Wed, Sep 14, 2011 at 02:47:33AM -0500, Iain Hull wrote:
> From http://wlug.org.nz/EMLINK 
> > So yes, this does mean that you are limited to 32000 subdirectories 
> > in one directory in ext3
> 
> As a result the mnesia database is not able to support more than 32000
> queues on an ext3 filesystem.  I will discuss the options with our ops
> guys and consider upgrading the file system to ext4 or similar and rerun
> my tests.

Wow - I'd not considered that file systems these days would still have
such limits... In my own testing a little while ago, I found that JFS
had the best performance for my hardware when running Rabbit, but I
didn't do any huge scaling tests so I wouldn't be surprised if that has
even lower limits for such things.

Certainly my testing of ext4 is not favourable. It seems to have very
inconsistent performance. That said, if it works for you...

Matthew

From simon at rabbitmq.com  Wed Sep 14 11:05:27 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Sep 2011 11:05:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is released
In-Reply-To: <CAE3HoVS7aQCyZkjK7D57ZHnYfaZ2m8S4NjXHwE0zJhf8Z1oaKQ@mail.gmail.com>
References: <4E6E187B.4090000@rabbitmq.com>	<4E6EFD82.7030901@strategicdata.com.au>	<44465273-4DC1-4509-A210-BA3F98BCF124@gmail.com>	<4E700293.7070906@strategicdata.com.au>
	<CAE3HoVS7aQCyZkjK7D57ZHnYfaZ2m8S4NjXHwE0zJhf8Z1oaKQ@mail.gmail.com>
Message-ID: <4E707C67.9000701@rabbitmq.com>

On 14/09/11 04:39, Michael Klishin wrote:
> This is a question for RabbitMQ team membersbut I definitely would like
> to see plugins distributed as .deb packages.
> Current way of installing them is just painful to automate around and
> requires manual maintenance even on point releases.
> There has to be a better way in late 2011.

We're very aware of this, but have been struggling to get to the right 
answer. Individual debs per plugin are a nice idea, but then we have to 
do the same thing for RPMs, Windows, Mac users and so on, plus we either 
package each plugin by hand or try to automate the whole thing. And the 
plugins aren't really designed to be built without the server build 
being there, and so on. It gets messy quickly.

So the new plan is to rearrange things so that all the official plugins 
end up bundled along with the server in a standard way for all 
packaging, and we ship a tool that lets you turn them on or off. 
However, I don't have a date for when this will happen, but it is being 
worked on.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Wed Sep 14 12:10:26 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 14 Sep 2011 13:10:26 +0200
Subject: [rabbitmq-discuss] RabbitMQ, PHP and RPC
In-Reply-To: <8f0b836f-d514-4dba-aab9-08f365bbadf4@d2g2000vbk.googlegroups.com>
References: <8f0b836f-d514-4dba-aab9-08f365bbadf4@d2g2000vbk.googlegroups.com>
Message-ID: <CAMcAHLXhaZymMp5jbeucFcJEA8p+0wWbKQ49MLEGz3i-ZNVhGQ@mail.gmail.com>

Hi

Yes, you can do RPC with that library. Take a look here:
https://github.com/videlalvaro/Thumper/tree/master/examples/rpc

The Thumper library is just a wrapper around tnc/php-amqplib

Regards,

Alvaro

On Wed, Sep 14, 2011 at 11:24 AM, LAscolto <lascoltodelvenerdi at gmail.com>wrote:

> Hi there!
>
> Can someone help me?
>
> I'm looking to implement a RPC with PHP, but I can not find any
> example.
>
> So first of all, is possible do it in PHP?
>
> Second, can someone point me to a tutorial or example?
>
> I'm using this version of the php AMQP library: tnc-php-amqplib-
> b6e0bb2.
>
> Many thanks.
>
> Antonio
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110914/b9fdc0a9/attachment.htm>

From michael.s.klishin at gmail.com  Wed Sep 14 12:30:00 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 14 Sep 2011 15:30:00 +0400
Subject: [rabbitmq-discuss] SockJS protocol documentation?
In-Reply-To: <CABzX+qzkyp_ZBp-s5GcVUq6bR=H2-Lvdz-e3yHpXrwG-Bj1bmA@mail.gmail.com>
References: <CAE3HoVSyQoBOy3jF5eEnuCY1MVtO_LbAV0kVaaEjCajiPR6G5w@mail.gmail.com>
	<CABzX+qzkyp_ZBp-s5GcVUq6bR=H2-Lvdz-e3yHpXrwG-Bj1bmA@mail.gmail.com>
Message-ID: <CAE3HoVSmKmf7c4Tq46YLXqDf3=GiExQOW3J=bgtQXrGXSAbU-w@mail.gmail.com>

2011/9/14 Marek Majkowski <majek04 at gmail.com>

> I will continue trying new things in sockjs-node - it's just easier
> to prototype in node. Hopefully, the server side shouldn't evolve much,
> so there shouldn't be a painful to keep servers in sync with the client.
>
> I would love to see ruby/python/jvm implementations...
>

I see. Given that it is a pretty small codebase, maintaining Node.js and
Erlang versions probably won't be too painful. I will go ahead and just read
the source and ask questions as they arise.

Thank you.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110914/cef1cba5/attachment.htm>

From mikeb at rabbitmq.com  Wed Sep 14 12:31:38 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 14 Sep 2011 12:31:38 +0100
Subject: [rabbitmq-discuss] SockJS protocol documentation?
In-Reply-To: <CACOPnveuuu0aRBC+9m16q5KpSuczZ-pmUc-zqQrt_tLkj=tFGw@mail.gmail.com>
References: <CAE3HoVSyQoBOy3jF5eEnuCY1MVtO_LbAV0kVaaEjCajiPR6G5w@mail.gmail.com>
	<CACOPnveuuu0aRBC+9m16q5KpSuczZ-pmUc-zqQrt_tLkj=tFGw@mail.gmail.com>
Message-ID: <4E70909A.8010900@rabbitmq.com>

>> Will the canonical implementation
>> always be Node.js-based?
>
> Given that SockJS arose from use of Socket.io, it made sense to
> present it in a way that the Node.js folks could use.
>
> Another obvious implementation opportunity is a RabbitMQ plugin.  That
> would be in erlang.  Simon is looking in this..

I rather hope he's not. Implementing it as a rabbit plugin would make it 
useless for anyone else, while gaining absolutely nothing.

>> What's RabbitMQ team's
>> take on people going ahead and implementing SocksJS server on the JVM, in
>> Ruby and so on?
>
> I think that would be great.

Yes, it would be. Maybe (in the Ruby case) on Goliath? (TBH I don't know 
much about Goliath so that may be a daft suggestion ..)

> Have you looked at node.x?  That might be a good place to do some hacking....
>
> https://github.com/purplefox/node.x
>
> Or (eg) https://github.com/purplefox/node.x/blob/master/src/examples/java/org/nodex/java/examples/websockets/WebsocketsExample.java

Well it'd be an interesting experiment. I don't think it's ready for a 
"serious" implementation just yet. But trying would certainly be helpful 
for moving node.x along.


-Michael

From michael.s.klishin at gmail.com  Wed Sep 14 12:35:08 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 14 Sep 2011 15:35:08 +0400
Subject: [rabbitmq-discuss] SockJS protocol documentation?
In-Reply-To: <CACOPnveuuu0aRBC+9m16q5KpSuczZ-pmUc-zqQrt_tLkj=tFGw@mail.gmail.com>
References: <CAE3HoVSyQoBOy3jF5eEnuCY1MVtO_LbAV0kVaaEjCajiPR6G5w@mail.gmail.com>
	<CACOPnveuuu0aRBC+9m16q5KpSuczZ-pmUc-zqQrt_tLkj=tFGw@mail.gmail.com>
Message-ID: <CAE3HoVRceJK9se_L4okJxNqqR8_fYc_LSSoKrgiiF8xpgvNAkQ@mail.gmail.com>

2011/9/14 Alexis Richardson <alexis at rabbitmq.com>

> I think that would be great
>

> Have you looked at node.x?  That might be a good place to do some
> hacking....
>
> https://github.com/purplefox/node.x
>
> Or (eg)
> https://github.com/purplefox/node.x/blob/master/src/examples/java/org/nodex/java/examples/websockets/WebsocketsExample.java
>

Alexis,

I am aware of Node.x. My plan right now is to use Netty directly but thanks
for the suggestion. I don't have enough understanding of the existing
implementation to really judge if Node.x or libraries like Aleph and Finagle
will really help me over plain Netty, we will see.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110914/c2f8e620/attachment.htm>

From iain.hull at workday.com  Wed Sep 14 12:47:10 2011
From: iain.hull at workday.com (Iain Hull)
Date: Wed, 14 Sep 2011 06:47:10 -0500
Subject: [rabbitmq-discuss] Channels closed unexpectedly in Java client
In-Reply-To: <20110914100248.GA5367@rabbitmq.com>
References: <925DDDE9D69E7143B3252E2D4680A36703C174CE@34093-C5-EVS1.exchange.rackspace.com><20110913154755.GD30647@rabbitmq.com><925DDDE9D69E7143B3252E2D4680A36703C618BD@34093-C5-EVS1.exchange.rackspace.com>
	<20110914100248.GA5367@rabbitmq.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A36703C619C1@34093-C5-EVS1.exchange.rackspace.com>

Hi Matthew,

On Thur, Sep 14, 2011 at 11:03, Matthew Sackman wrote:
> Wow - I'd not considered that file systems these days would still have
> such limits... In my own testing a little while ago, I found that JFS
> had the best performance for my hardware when running Rabbit, but I
> didn't do any huge scaling tests so I wouldn't be surprised if that
has
> even lower limits for such things.

> Certainly my testing of ext4 is not favourable. It seems to have very
> inconsistent performance. That said, if it works for you...
Ok thanks I will add xfs and jfs to my mix for testing.  Do you still 
have those results? And are they in a consumable format?  Our ops team
would be really interested in looking over them as the basis for our own
testing.

Regards,
Iain.

From lascoltodelvenerdi at gmail.com  Wed Sep 14 12:48:56 2011
From: lascoltodelvenerdi at gmail.com (LAscolto)
Date: Wed, 14 Sep 2011 04:48:56 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ, PHP and RPC
In-Reply-To: <CAMcAHLXhaZymMp5jbeucFcJEA8p+0wWbKQ49MLEGz3i-ZNVhGQ@mail.gmail.com>
References: <8f0b836f-d514-4dba-aab9-08f365bbadf4@d2g2000vbk.googlegroups.com>
	<CAMcAHLXhaZymMp5jbeucFcJEA8p+0wWbKQ49MLEGz3i-ZNVhGQ@mail.gmail.com>
Message-ID: <4cc4bc7a-465c-4f11-897b-f329d6a50cfc@r21g2000yqr.googlegroups.com>

Thanks!

This help me a lot! ^_^

On Sep 14, 1:10?pm, Alvaro Videla <videlalv... at gmail.com> wrote:
> Hi
>
> Yes, you can do RPC with that library. Take a look here:https://github.com/videlalvaro/Thumper/tree/master/examples/rpc
>
> The Thumper library is just a wrapper around tnc/php-amqplib
>
> Regards,
>
> Alvaro
>
> On Wed, Sep 14, 2011 at 11:24 AM, LAscolto <lascoltodelvene... at gmail.com>wrote:
>
>
>
>
>
>
>
> > Hi there!
>
> > Can someone help me?
>
> > I'm looking to implement a RPC with PHP, but I can not find any
> > example.
>
> > So first of all, is possible do it in PHP?
>
> > Second, can someone point me to a tutorial or example?
>
> > I'm using this version of the php AMQP library: tnc-php-amqplib-
> > b6e0bb2.
>
> > Many thanks.
>
> > Antonio
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Wed Sep 14 13:12:25 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 14 Sep 2011 13:12:25 +0100
Subject: [rabbitmq-discuss] Channels closed unexpectedly in Java client
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A36703C619C1@34093-C5-EVS1.exchange.rackspace.com>
References: <925DDDE9D69E7143B3252E2D4680A36703C174CE@34093-C5-EVS1.exchange.rackspace.com>
	<20110913154755.GD30647@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703C618BD@34093-C5-EVS1.exchange.rackspace.com>
	<20110914100248.GA5367@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703C619C1@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <20110914121225.GB5367@rabbitmq.com>

Hi Iain,

On Wed, Sep 14, 2011 at 06:47:10AM -0500, Iain Hull wrote:
> > Certainly my testing of ext4 is not favourable. It seems to have very
> > inconsistent performance. That said, if it works for you...
> Ok thanks I will add xfs and jfs to my mix for testing.  Do you still 
> have those results? And are they in a consumable format?  Our ops team
> would be really interested in looking over them as the basis for our own
> testing.

I don't still have them, but I'm sure they'd have been simple enough -
probably just measuring overall performance with something like
MulticastMain (Java client) with various flags or I may have written
some custom tests with the Erlang client - certainly you could just use
MulticastMain with -f persistent -r X and tune X for each file system
until you find the highest point at which the latency doesn't grow,
although you'll need to leave it running for a few mins before you can
be sure it's stable.

That'll just measure the cost of writing msgs to disk, though only some
bits of that writing are actually in the path of the msg - other bits
may be done asynchronously at leisure, though ultimately, all bits are
competing for disk bandwidth, so measuring the rate at which data is
written to disk may be indicative of performance.

You could also try creating a durable queue, filling it with a few
million persistent msgs, cleanly shutting down and restarting rabbit,
and then timing how long it takes to drain the queue from a client.

Ideally, you should write your own tests which are as close a match to
the access patterns you expect to see in your applications as possible.
Only performance under those conditions is actually of any use to you.
Especially when you start using features such as publisher confirms.

Matthew

From emile at rabbitmq.com  Wed Sep 14 13:26:01 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Sep 2011 13:26:01 +0100
Subject: [rabbitmq-discuss] WCF Client question
In-Reply-To: <3895206.2800.1315593691077.JavaMail.geo-discussion-forums@yqmv39>
References: <3895206.2800.1315593691077.JavaMail.geo-discussion-forums@yqmv39>
Message-ID: <4E709D59.3010708@rabbitmq.com>

Hi Sotirios,

Op 09/09/11 19:41, het Sotirios Mantziaris geskryf:
> > Hi,
> >
> > i am using wcf with net.tcp duplex binding. For the lifetime of the
> > client the channel is open. When something happens the channel get
> > faulted and the client must be rebuild. is this the same case for a
> > rabbitmq wcf client (since it is a messaging platform)?

It depends what kind of fault you mean. If the fault is an instance of
System.ServiceModel.CommunicationException then clients can trap this
and take appropriate action. See the
RabbitMQ.ServiceModel.Test.FaultTest class for an example.

If the link between the client and the broker breaks then clients will
need to re-establish the binding. While not an WCF implementation, the
Message Patterns library shows how reconnecting is possible:
http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/


-Emile

From simon at rabbitmq.com  Wed Sep 14 13:32:22 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 14 Sep 2011 13:32:22 +0100
Subject: [rabbitmq-discuss] SockJS protocol documentation?
In-Reply-To: <4E70909A.8010900@rabbitmq.com>
References: <CAE3HoVSyQoBOy3jF5eEnuCY1MVtO_LbAV0kVaaEjCajiPR6G5w@mail.gmail.com>	<CACOPnveuuu0aRBC+9m16q5KpSuczZ-pmUc-zqQrt_tLkj=tFGw@mail.gmail.com>
	<4E70909A.8010900@rabbitmq.com>
Message-ID: <4E709ED6.7070604@rabbitmq.com>

On 14/09/11 12:31, Michael Bridgen wrote:
>>> Will the canonical implementation
>>> always be Node.js-based?
>>
>> Given that SockJS arose from use of Socket.io, it made sense to
>> present it in a way that the Node.js folks could use.
>>
>> Another obvious implementation opportunity is a RabbitMQ plugin. That
>> would be in erlang. Simon is looking in this..
>
> I rather hope he's not. Implementing it as a rabbit plugin would make it
> useless for anyone else, while gaining absolutely nothing.

Just to be clear, I want a non-rabbit-specific Erlang implementation 
which future Rabbit plugins can then use, much as we use mochiweb and 
webmachine now.

Currently I don't have anything to show though, although that will 
hopefully change.

If anyone is interested in helping, now would be a good time to shout!

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From majek04 at gmail.com  Wed Sep 14 13:52:27 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 14 Sep 2011 13:52:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ, PHP and RPC
In-Reply-To: <8f0b836f-d514-4dba-aab9-08f365bbadf4@d2g2000vbk.googlegroups.com>
References: <8f0b836f-d514-4dba-aab9-08f365bbadf4@d2g2000vbk.googlegroups.com>
Message-ID: <CABzX+qwUr1i56jBqiy=pNqNUNJiY_QMDZLLbAaNSMKi9JoyxOw@mail.gmail.com>

Hi,

On Wed, Sep 14, 2011 at 10:24, LAscolto <lascoltodelvenerdi at gmail.com> wrote:
> I'm looking to implement a RPC with PHP, but I can not find any
> example.
>
> So first of all, is possible do it in PHP?
>
> Second, can someone point me to a tutorial or example?
>
> I'm using this version of the php AMQP library: tnc-php-amqplib-
> b6e0bb2.

I've prepared php code for sixth rabbitmq tutorial:
https://github.com/rabbitmq/rabbitmq-tutorials/commit/c8b9e1e88189a6d927d5d1c6059abcbcf43ec410

The tutorial itself:
http://www.rabbitmq.com/tutorials/tutorial-six-python.html

My php is rather clumsy, but it seems to be working. I hope
some php gurus (I'm looking at you, Alvaro!) will be able to spot
any issues.

This code is a low-level approach. You may of course
use high-level abstractions, as Alvaro mentioned.

Cheers,
  Marek

From lascoltodelvenerdi at gmail.com  Wed Sep 14 14:14:54 2011
From: lascoltodelvenerdi at gmail.com (LAscolto)
Date: Wed, 14 Sep 2011 06:14:54 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ, PHP and RPC
In-Reply-To: <CABzX+qwUr1i56jBqiy=pNqNUNJiY_QMDZLLbAaNSMKi9JoyxOw@mail.gmail.com>
References: <8f0b836f-d514-4dba-aab9-08f365bbadf4@d2g2000vbk.googlegroups.com>
	<CABzX+qwUr1i56jBqiy=pNqNUNJiY_QMDZLLbAaNSMKi9JoyxOw@mail.gmail.com>
Message-ID: <de4c87e5-b451-42f5-8b9a-0f1aa3a97936@l7g2000vbz.googlegroups.com>

Thanks to you also!

I'll study your examples.

Many thanks! ^_^

On Sep 14, 2:52?pm, Marek Majkowski <maje... at gmail.com> wrote:
> Hi,
>
> On Wed, Sep 14, 2011 at 10:24, LAscolto <lascoltodelvene... at gmail.com> wrote:
> > I'm looking to implement a RPC with PHP, but I can not find any
> > example.
>
> > So first of all, is possible do it in PHP?
>
> > Second, can someone point me to a tutorial or example?
>
> > I'm using this version of the php AMQP library: tnc-php-amqplib-
> > b6e0bb2.
>
> I've prepared php code for sixth rabbitmq tutorial:https://github.com/rabbitmq/rabbitmq-tutorials/commit/c8b9e1e88189a6d...
>
> The tutorial itself:http://www.rabbitmq.com/tutorials/tutorial-six-python.html
>
> My php is rather clumsy, but it seems to be working. I hope
> some php gurus (I'm looking at you, Alvaro!) will be able to spot
> any issues.
>
> This code is a low-level approach. You may of course
> use high-level abstractions, as Alvaro mentioned.
>
> Cheers,
> ? Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Wed Sep 14 14:22:29 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Sep 2011 14:22:29 +0100
Subject: [rabbitmq-discuss] Connection getting closed
In-Reply-To: <CAL_6-TOqpzLECs=HS0oR9cEy6iRNZPkwNksLsGCZqHtg6-2oFQ@mail.gmail.com>
References: <CAL_6-TOqpzLECs=HS0oR9cEy6iRNZPkwNksLsGCZqHtg6-2oFQ@mail.gmail.com>
Message-ID: <4E70AA95.7040300@rabbitmq.com>

Hi Tim,

Op 13/09/11 00:56, het Tim Yen geskryf:
> Hi,
> 
> Has anyone else run into this exception?

I'm unable to get the supplied code to produce the same exception. What
versions of the client library and the broker are you using? Are there
any relevant entries in the broker logfile at the time of the error?

It should not be necessary to recycle connections. If the network
infrastructure is causing timeouts then you should consider using AMQP
heartbeats to prevent that.

Another diagnostic test you could perform is to compare the output of
"rabbitmqctl list_connections" on the broker with "netstat" on the client.


-Emile

From billg at nffs.com  Wed Sep 14 14:22:34 2011
From: billg at nffs.com (Bill Gerrard)
Date: Wed, 14 Sep 2011 07:22:34 -0600
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is released
In-Reply-To: <CAE3HoVS7aQCyZkjK7D57ZHnYfaZ2m8S4NjXHwE0zJhf8Z1oaKQ@mail.gmail.com>
References: <4E6E187B.4090000@rabbitmq.com>	<4E6EFD82.7030901@strategicdata.com.au>	<44465273-4DC1-4509-A210-BA3F98BCF124@gmail.com>	<4E700293.7070906@strategicdata.com.au>
	<CAE3HoVS7aQCyZkjK7D57ZHnYfaZ2m8S4NjXHwE0zJhf8Z1oaKQ@mail.gmail.com>
Message-ID: <4E70AA9A.9040905@nffs.com>

I'll second that.

Every release (2.6.0 and 2.6.1) upgrade since installing rabbitmq breaks 
the management UI and API which in turn breaks our nagios monitoring 
which in turn pages our sysadmin team the the message server is down.

Please package at least the management plugin so the api continues 
working seamlessly through an upgrade.

On 09/13/2011 09:39 PM, Michael Klishin wrote:
>
> This is a question for RabbitMQ team members but I definitely would 
> like to see plugins distributed as .deb packages.
> Current way of installing them is just painful to automate around and 
> requires manual maintenance even on point releases.
> There has to be a better way in late 2011.
>


From videlalvaro at gmail.com  Wed Sep 14 14:23:27 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 14 Sep 2011 15:23:27 +0200
Subject: [rabbitmq-discuss] RabbitMQ, PHP and RPC
In-Reply-To: <de4c87e5-b451-42f5-8b9a-0f1aa3a97936@l7g2000vbz.googlegroups.com>
References: <8f0b836f-d514-4dba-aab9-08f365bbadf4@d2g2000vbk.googlegroups.com>
	<CABzX+qwUr1i56jBqiy=pNqNUNJiY_QMDZLLbAaNSMKi9JoyxOw@mail.gmail.com>
	<de4c87e5-b451-42f5-8b9a-0f1aa3a97936@l7g2000vbz.googlegroups.com>
Message-ID: <CAMcAHLWUVES_yczT__aafKgTej43XJ6g2z7uP2w4wpyD3Mx8rA@mail.gmail.com>

Marek,

I promise to take a look at it tonight.

Cheers,

Alvaro

On Wed, Sep 14, 2011 at 3:14 PM, LAscolto <lascoltodelvenerdi at gmail.com>wrote:

> Thanks to you also!
>
> I'll study your examples.
>
> Many thanks! ^_^
>
> On Sep 14, 2:52 pm, Marek Majkowski <maje... at gmail.com> wrote:
> > Hi,
> >
> > On Wed, Sep 14, 2011 at 10:24, LAscolto <lascoltodelvene... at gmail.com>
> wrote:
> > > I'm looking to implement a RPC with PHP, but I can not find any
> > > example.
> >
> > > So first of all, is possible do it in PHP?
> >
> > > Second, can someone point me to a tutorial or example?
> >
> > > I'm using this version of the php AMQP library: tnc-php-amqplib-
> > > b6e0bb2.
> >
> > I've prepared php code for sixth rabbitmq tutorial:
> https://github.com/rabbitmq/rabbitmq-tutorials/commit/c8b9e1e88189a6d...
> >
> > The tutorial itself:
> http://www.rabbitmq.com/tutorials/tutorial-six-python.html
> >
> > My php is rather clumsy, but it seems to be working. I hope
> > some php gurus (I'm looking at you, Alvaro!) will be able to spot
> > any issues.
> >
> > This code is a low-level approach. You may of course
> > use high-level abstractions, as Alvaro mentioned.
> >
> > Cheers,
> >   Marek
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://
> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110914/fe8a45a6/attachment.htm>

From matthew at rabbitmq.com  Wed Sep 14 14:39:05 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 14 Sep 2011 14:39:05 +0100
Subject: [rabbitmq-discuss] Channels closed unexpectedly in Java client
In-Reply-To: <20110914100248.GA5367@rabbitmq.com>
References: <925DDDE9D69E7143B3252E2D4680A36703C174CE@34093-C5-EVS1.exchange.rackspace.com>
	<20110913154755.GD30647@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703C618BD@34093-C5-EVS1.exchange.rackspace.com>
	<20110914100248.GA5367@rabbitmq.com>
Message-ID: <20110914133904.GE5367@rabbitmq.com>

On Wed, Sep 14, 2011 at 11:02:49AM +0100, Matthew Sackman wrote:
> Wow - I'd not considered that file systems these days would still have
> such limits... In my own testing a little while ago, I found that JFS
> had the best performance for my hardware when running Rabbit, but I
> didn't do any huge scaling tests so I wouldn't be surprised if that has
> even lower limits for such things.

...except it doesn't. I've just written a test to, erm, test this:

-module(test).
-compile([export_all]).

-include_lib("amqp_client/include/amqp_client.hrl").

loadsa_queues() ->
    {ok, Conn} = amqp_connection:start(#amqp_params_network{}),
    {ok, Chan} = amqp_connection:open_channel(Conn),
    Method = #'basic.publish'{},
    Content = #amqp_msg { props = #'P_basic'{ delivery_mode = 2 },
                          payload = <<0:8>> },
    [begin
         #'queue.declare_ok'{ queue = Q } =
             amqp_channel:call(Chan, #'queue.declare'{durable = true, exclusive = true}),
         amqp_channel:cast(Chan, Method#'basic.publish'{ routing_key = Q }, Content)
     end || _ <- lists:seq(1,100000)],
    amqp_connection:close(Conn).

The reason for doing the publish is that the queue creates its directory
lazily, so if you don't do the publish, the directory will never be
created, so you won't stress the filesystem.

So I ran that, at the same time as some
rabbitmqctl list_queues | wc -l
and
watch "ls /home/matthew/ssd/rabbitmq-rabbit-mnesia/queues/|wc -l"
and sure enough, it happily got up to the 100,000 queues I'd asked for.


Matthew

From matthew at rabbitmq.com  Wed Sep 14 14:42:02 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Wed, 14 Sep 2011 14:42:02 +0100
Subject: [rabbitmq-discuss] Channels closed unexpectedly in Java client
In-Reply-To: <20110914133904.GE5367@rabbitmq.com>
References: <925DDDE9D69E7143B3252E2D4680A36703C174CE@34093-C5-EVS1.exchange.rackspace.com>
	<20110913154755.GD30647@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703C618BD@34093-C5-EVS1.exchange.rackspace.com>
	<20110914100248.GA5367@rabbitmq.com>
	<20110914133904.GE5367@rabbitmq.com>
Message-ID: <20110914134202.GF5367@rabbitmq.com>

On Wed, Sep 14, 2011 at 02:39:05PM +0100, Matthew Sackman wrote:
> -module(test).
> -compile([export_all]).
> 
> -include_lib("amqp_client/include/amqp_client.hrl").
> 
> loadsa_queues() ->
>     {ok, Conn} = amqp_connection:start(#amqp_params_network{}),
>     {ok, Chan} = amqp_connection:open_channel(Conn),
>     Method = #'basic.publish'{},
>     Content = #amqp_msg { props = #'P_basic'{ delivery_mode = 2 },
>                           payload = <<0:8>> },
>     [begin
>          #'queue.declare_ok'{ queue = Q } =
>              amqp_channel:call(Chan, #'queue.declare'{durable = true, exclusive = true}),
>          amqp_channel:cast(Chan, Method#'basic.publish'{ routing_key = Q }, Content)
>      end || _ <- lists:seq(1,100000)],
>     amqp_connection:close(Conn).

Oh yes, seeing as I've just run into this myself, there's currently a
performance issue with deleting an awful lot of queues at the same time
- reported at
  http://old.nabble.com/Problem-auto-deleting-large-number-of-queues--td32346666.html
- we are working on a fix for this right now, but it wasn't ready in
time for 2.6.1. The bug is actually in Erlang/OTP itself. So if you find
you tests taking a huge amount of time deleting a lot of queues, it's
that bug, and erm, thus "nothing to worry about" ;)

Matthew

From david at rabbitmq.com  Wed Sep 14 14:43:22 2011
From: david at rabbitmq.com (David Wragg)
Date: Wed, 14 Sep 2011 14:43:22 +0100
Subject: [rabbitmq-discuss] Channels closed unexpectedly in Java client
In-Reply-To: <925DDDE9D69E7143B3252E2D4680A36703C619C1@34093-C5-EVS1.exchange.rackspace.com>
	(Iain Hull's message of "Wed, 14 Sep 2011 06:47:10 -0500")
References: <925DDDE9D69E7143B3252E2D4680A36703C174CE@34093-C5-EVS1.exchange.rackspace.com>
	<20110913154755.GD30647@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703C618BD@34093-C5-EVS1.exchange.rackspace.com>
	<20110914100248.GA5367@rabbitmq.com>
	<925DDDE9D69E7143B3252E2D4680A36703C619C1@34093-C5-EVS1.exchange.rackspace.com>
Message-ID: <yrv4c62kv8cjp.fsf@dwragg.eng.vmware.com>

"Iain Hull" <iain.hull at workday.com> writes:
> Ok thanks I will add xfs and jfs to my mix for testing.  Do you still 
> have those results? And are they in a consumable format?  Our ops team
> would be really interested in looking over them as the basis for our own
> testing.

If you benchmark different Linux filesystems, be very careful to make
sure that you are doing apples-to-apples comparisons.  Different
filesystems have different data integrity guarantees.  In particular,
ext3 and ext4 get different numbers mainly because they have different
defaults for the 'barrier' option.  So you need to explicitly set this
option in order to perform a fair comparison.  Last time I did this,
their performance seemed roughly equivalent.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From jbochi at gmail.com  Wed Sep 14 15:17:06 2011
From: jbochi at gmail.com (Juarez Bochi)
Date: Wed, 14 Sep 2011 11:17:06 -0300
Subject: [rabbitmq-discuss] Fwd: RabbitMQ crashing on Windows
In-Reply-To: <CAN=y6RKFO6RixdBG+bamp++pdjxsR9KAR1n99eKEzzuZqCNPiw@mail.gmail.com>
References: <CAN=y6RKFO6RixdBG+bamp++pdjxsR9KAR1n99eKEzzuZqCNPiw@mail.gmail.com>
Message-ID: <CAN=y6RKBTFRBbOsprYj9f=_PnznvR_BcShiHp=bORWeSHDZECA@mail.gmail.com>

Hi all,

This is my very first post on the list. Please pardon me if I am doing
something stupid, but I have already googled and searched the list archives
but I could not find the solution to my problem.

I am running RabbitMQ on a Windows machine (Windows Server 2003 R2) and
everything worked just perfect for a couple of months.

After that, Rabbit (or Erlang, I don't know) started to crash every week.
And now its crashing almost every day. I have already upgraded it and also
Erlang, but the problem continues.

The erl_crash.dump always starts with something like this:

=erl_crash_dump:0.1
Tue Sep 13 21:17:21 2011
Slogan: Kernel pid terminated (application_controller)
({application_terminated,kernel,shutdown})
System version: Erlang R14B03 (erts-5.8.4) [smp:4:4] [rq:4]
[async-threads:30]
Compiled: Tue May 24 12:17:38 2011

The latest one is attached.

Is there anything I can do to understand what is causing the shutdown? I am
completely lost. Any help would be greatly appreciated.

Many thanks
Juarez Bochi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110914/4cf18287/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.zip
Type: application/zip
Size: 137011 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110914/4cf18287/attachment.zip>

From majek04 at gmail.com  Wed Sep 14 15:46:12 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 14 Sep 2011 15:46:12 +0100
Subject: [rabbitmq-discuss] Fwd: RabbitMQ crashing on Windows
In-Reply-To: <CAN=y6RKBTFRBbOsprYj9f=_PnznvR_BcShiHp=bORWeSHDZECA@mail.gmail.com>
References: <CAN=y6RKFO6RixdBG+bamp++pdjxsR9KAR1n99eKEzzuZqCNPiw@mail.gmail.com>
	<CAN=y6RKBTFRBbOsprYj9f=_PnznvR_BcShiHp=bORWeSHDZECA@mail.gmail.com>
Message-ID: <CABzX+qxZ1aAQVcRPZtxp9Qm0NFLmCxQJ4-hXfMb6gp8W0vwuFQ@mail.gmail.com>

Hi,

I'm not sure if that helps, but google says:
http://www.ejabberd.im/node/872

> In my case, the problema was that I had only a short hostname
> in /etc/hostname, I changed it from "myhost" to
> "myhost.mydomain.tld", restarted hostname service and then
> everything works great.

Erlang is quite fragile when it comes to hostnames. The hostname must
be properly resolvable.

Cheers,
  Marek

On Wed, Sep 14, 2011 at 15:17, Juarez Bochi <jbochi at gmail.com> wrote:
> Hi all,
> This is my very first post on the list. Please pardon me if I am doing
> something stupid, but I have already googled and searched the list archives
> but I could not find the solution to my problem.
> I am running RabbitMQ on a Windows machine (Windows Server 2003 R2) and
> everything worked just perfect for a couple of months.
> After that, Rabbit (or Erlang, I don't know) started to crash every week.
> And now its crashing almost every day. I have already upgraded it and also
> Erlang, but the problem continues.
> The erl_crash.dump always starts with something like this:
> =erl_crash_dump:0.1
> Tue Sep 13 21:17:21 2011
> Slogan: Kernel pid terminated (application_controller)
> ({application_terminated,kernel,shutdown})
> System version: Erlang R14B03 (erts-5.8.4) [smp:4:4] [rq:4]
> [async-threads:30]
> Compiled: Tue May 24 12:17:38 2011
> The latest one is attached.
> Is there anything I can do to understand what is causing the shutdown??I am
> completely lost. Any help would be greatly appreciated.
> Many thanks
> Juarez Bochi
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From iain.hull at workday.com  Wed Sep 14 16:22:54 2011
From: iain.hull at workday.com (Iain Hull)
Date: Wed, 14 Sep 2011 10:22:54 -0500
Subject: [rabbitmq-discuss] Channels closed unexpectedly in Java client
In-Reply-To: <yrv4c62kv8cjp.fsf@dwragg.eng.vmware.com>
References: <925DDDE9D69E7143B3252E2D4680A36703C174CE@34093-C5-EVS1.exchange.rackspace.com><20110913154755.GD30647@rabbitmq.com><925DDDE9D69E7143B3252E2D4680A36703C618BD@34093-C5-EVS1.exchange.rackspace.com><20110914100248.GA5367@rabbitmq.com><925DDDE9D69E7143B3252E2D4680A36703C619C1@34093-C5-EVS1.exchange.rackspace.com>
	<yrv4c62kv8cjp.fsf@dwragg.eng.vmware.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A36703C61CD2@34093-C5-EVS1.exchange.rackspace.com>

Thanks Matthew,

I will ensure that we do this (ops/devops are in the US so haven't had a
chance to talk to them yet).  My primary concern is how they handle
large numbers of subdirectories, as opposed to raw performance.

Regards,
Iain.

-----Original Message-----
From: David Wragg [mailto:david at rabbitmq.com] 
Sent: 14 September 2011 14:43
To: Iain Hull
Cc: Matthew Sackman; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Channels closed unexpectedly in Java
client

"Iain Hull" <iain.hull at workday.com> writes:
> Ok thanks I will add xfs and jfs to my mix for testing.  Do you still 
> have those results? And are they in a consumable format?  Our ops team
> would be really interested in looking over them as the basis for our
own
> testing.

If you benchmark different Linux filesystems, be very careful to make
sure that you are doing apples-to-apples comparisons.  Different
filesystems have different data integrity guarantees.  In particular,
ext3 and ext4 get different numbers mainly because they have different
defaults for the 'barrier' option.  So you need to explicitly set this
option in order to perform a fair comparison.  Last time I did this,
their performance seemed roughly equivalent.

-- 
David Wragg
Staff Engineer, RabbitMQ
VMware, Inc.

From jbochi at gmail.com  Wed Sep 14 16:23:53 2011
From: jbochi at gmail.com (Juarez Bochi)
Date: Wed, 14 Sep 2011 12:23:53 -0300
Subject: [rabbitmq-discuss] Fwd: RabbitMQ crashing on Windows
In-Reply-To: <CABzX+qxZ1aAQVcRPZtxp9Qm0NFLmCxQJ4-hXfMb6gp8W0vwuFQ@mail.gmail.com>
References: <CAN=y6RKFO6RixdBG+bamp++pdjxsR9KAR1n99eKEzzuZqCNPiw@mail.gmail.com>
	<CAN=y6RKBTFRBbOsprYj9f=_PnznvR_BcShiHp=bORWeSHDZECA@mail.gmail.com>
	<CABzX+qxZ1aAQVcRPZtxp9Qm0NFLmCxQJ4-hXfMb6gp8W0vwuFQ@mail.gmail.com>
Message-ID: <CAN=y6R+HxYd-4fBzyDT2nLF+Q8omy0=RU21afU3FY3oOcmRF4g@mail.gmail.com>

Hi,

Thanks for the tip, but I don't believe that would help... I'm using
Windows, not Linux.

I don't if the following info is relevant, but this is what I got from the
Event Viewer:

Event Type: Warning
Event Source: ErlSrv
Event Category: None
Event ID: 16
Date: 9/13/2011
Time: 9:17:22 PM
User: N/A
Computer: CHVMP002
Description:
RabbitMQ: Erlang machine voluntarily stopped. The service is not restarted
as OnFail is set to ignore.

Thanks
Juarez

On Wed, Sep 14, 2011 at 11:46 AM, Marek Majkowski <majek04 at gmail.com> wrote:

> Hi,
>
> I'm not sure if that helps, but google says:
> http://www.ejabberd.im/node/872
>
> > In my case, the problema was that I had only a short hostname
> > in /etc/hostname, I changed it from "myhost" to
> > "myhost.mydomain.tld", restarted hostname service and then
> > everything works great.
>
> Erlang is quite fragile when it comes to hostnames. The hostname must
> be properly resolvable.
>
> Cheers,
>  Marek
>
> On Wed, Sep 14, 2011 at 15:17, Juarez Bochi <jbochi at gmail.com> wrote:
> > Hi all,
> > This is my very first post on the list. Please pardon me if I am doing
> > something stupid, but I have already googled and searched the list
> archives
> > but I could not find the solution to my problem.
> > I am running RabbitMQ on a Windows machine (Windows Server 2003 R2) and
> > everything worked just perfect for a couple of months.
> > After that, Rabbit (or Erlang, I don't know) started to crash every week.
> > And now its crashing almost every day. I have already upgraded it and
> also
> > Erlang, but the problem continues.
> > The erl_crash.dump always starts with something like this:
> > =erl_crash_dump:0.1
> > Tue Sep 13 21:17:21 2011
> > Slogan: Kernel pid terminated (application_controller)
> > ({application_terminated,kernel,shutdown})
> > System version: Erlang R14B03 (erts-5.8.4) [smp:4:4] [rq:4]
> > [async-threads:30]
> > Compiled: Tue May 24 12:17:38 2011
> > The latest one is attached.
> > Is there anything I can do to understand what is causing the shutdown? I
> am
> > completely lost. Any help would be greatly appreciated.
> > Many thanks
> > Juarez Bochi
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>



-- 

Juarez
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110914/4030119d/attachment.htm>

From iain.hull at workday.com  Wed Sep 14 16:28:13 2011
From: iain.hull at workday.com (Iain Hull)
Date: Wed, 14 Sep 2011 10:28:13 -0500
Subject: [rabbitmq-discuss] Channels closed unexpectedly in Java client
In-Reply-To: <20110914134202.GF5367@rabbitmq.com>
References: <925DDDE9D69E7143B3252E2D4680A36703C174CE@34093-C5-EVS1.exchange.rackspace.com><20110913154755.GD30647@rabbitmq.com><925DDDE9D69E7143B3252E2D4680A36703C618BD@34093-C5-EVS1.exchange.rackspace.com><20110914100248.GA5367@rabbitmq.com><20110914133904.GE5367@rabbitmq.com>
	<20110914134202.GF5367@rabbitmq.com>
Message-ID: <925DDDE9D69E7143B3252E2D4680A36703C61CE5@34093-C5-EVS1.exchange.rackspace.com>

Reply thanks for the heads up on the auto delete, I will test that once
I get the queue size up.  Currently my queues expire after 24 hours
instead of auto deleting after a connection is dropped.

Regards,
Iain.

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
Matthew Sackman
Sent: 14 September 2011 14:42
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Channels closed unexpectedly in Java
client

On Wed, Sep 14, 2011 at 02:39:05PM +0100, Matthew Sackman wrote:
> -module(test).
> -compile([export_all]).
> 
> -include_lib("amqp_client/include/amqp_client.hrl").
> 
> loadsa_queues() ->
>     {ok, Conn} = amqp_connection:start(#amqp_params_network{}),
>     {ok, Chan} = amqp_connection:open_channel(Conn),
>     Method = #'basic.publish'{},
>     Content = #amqp_msg { props = #'P_basic'{ delivery_mode = 2 },
>                           payload = <<0:8>> },
>     [begin
>          #'queue.declare_ok'{ queue = Q } =
>              amqp_channel:call(Chan, #'queue.declare'{durable = true,
exclusive = true}),
>          amqp_channel:cast(Chan, Method#'basic.publish'{ routing_key =
Q }, Content)
>      end || _ <- lists:seq(1,100000)],
>     amqp_connection:close(Conn).

Oh yes, seeing as I've just run into this myself, there's currently a
performance issue with deleting an awful lot of queues at the same time
- reported at
 
http://old.nabble.com/Problem-auto-deleting-large-number-of-queues--td32
346666.html
- we are working on a fix for this right now, but it wasn't ready in
time for 2.6.1. The bug is actually in Erlang/OTP itself. So if you find
you tests taking a huge amount of time deleting a lot of queues, it's
that bug, and erm, thus "nothing to worry about" ;)

Matthew
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From majek04 at gmail.com  Wed Sep 14 16:30:45 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 14 Sep 2011 16:30:45 +0100
Subject: [rabbitmq-discuss] dead connection ?
In-Reply-To: <1315990649.13571.12.camel@ludy-desktop>
References: <1315990649.13571.12.camel@ludy-desktop>
Message-ID: <CABzX+qwsULDuiT5MVYPZsghh4f4b15ewSeKuNxPE5Hn+VPZOvQ@mail.gmail.com>

On Wed, Sep 14, 2011 at 09:57, ludy <ludy at wawame.cn> wrote:
> i want to use rabbitmq for android push.i use device id to name a
> queue.when mobile switches network,mobile will reconnect to the
> queue,and then the queue do not send message to the new consumer
> immediately.the old consumer is still exist but connection is not
> alive,how can i set a queue only receive one alive consumer???

Ludy,

There are few things you can do.

First, if you used 'basic.qos' with 'prefetch-count=1', that would
mean only one message will be delivered to the inactive connection
(and thus, potentially lost). But remember this may slow down
message delivery to your clients.

Next, the connection is probably just stalled and it will properly
closed when TCP detects that. It can take a while. You can speed
up this process by using keepalives (either on AMQP layer or
on tcp layer). Messages that were delivered to 'dead' connection
will get redelivered, and you will lose no data. (messages
could be delivered not in order).

At last, you could change your architecture so that every connection
creates a new, temporary (exclusive) queue. This kind of setup
would mean that for all messages in a queue will be delivered
to only one connection - thus reducing complexity of dead connections.
But that would probably require support from your application -
you would probably need to do some kind of replay when client
connects.

Cheers,
  Marek

From emile at rabbitmq.com  Wed Sep 14 17:09:16 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 14 Sep 2011 17:09:16 +0100
Subject: [rabbitmq-discuss] Fwd: RabbitMQ crashing on Windows
In-Reply-To: <CAN=y6R+HxYd-4fBzyDT2nLF+Q8omy0=RU21afU3FY3oOcmRF4g@mail.gmail.com>
References: <CAN=y6RKFO6RixdBG+bamp++pdjxsR9KAR1n99eKEzzuZqCNPiw@mail.gmail.com>	<CAN=y6RKBTFRBbOsprYj9f=_PnznvR_BcShiHp=bORWeSHDZECA@mail.gmail.com>	<CABzX+qxZ1aAQVcRPZtxp9Qm0NFLmCxQJ4-hXfMb6gp8W0vwuFQ@mail.gmail.com>
	<CAN=y6R+HxYd-4fBzyDT2nLF+Q8omy0=RU21afU3FY3oOcmRF4g@mail.gmail.com>
Message-ID: <4E70D1AC.2000408@rabbitmq.com>

Hi Juarez,

Op 14/09/11 16:23, het Juarez Bochi geskryf:
> Hi,
> 
> Thanks for the tip, but I don't believe that would help... I'm using
> Windows, not Linux.

It is possible that short vs long hostnames are not relevant to your
situation. The suggestion was based on a guess, because there is not
enough information to answer your question.

You can normally edit C:\WINDOWS\system32\drivers\etc\hosts and get
similar results to editing /etc/hosts on Unix if you want to see whether
that helps.

> I don't if the following info is relevant, but this is what I got from
> the Event Viewer:

The information in the rabbit broker logfile would be more useful,
because rabbit does not log to the system event log. You will find the
logfiles in the %RABBITMQ_LOG_BASE% folder (normally under
%APPDATA%\RabbitMQ).

> The erl_crash.dump always starts with something like this:
> =erl_crash_dump:0.1
> Tue Sep 13 21:17:21 2011
> Slogan: Kernel pid terminated (application_controller)
> ({application_terminated,kernel,shutdown})

Unfortunately these dump files are rarely of any use. The most useful
information is lost by the time they get generated. Please let use know
if you find any relevant information from the time of the crash in the
rabbit logfile instead. If you can determine whether any event triggers
the crash that will also help.



-Emile

From jbochi at gmail.com  Wed Sep 14 17:26:47 2011
From: jbochi at gmail.com (Juarez Bochi)
Date: Wed, 14 Sep 2011 13:26:47 -0300
Subject: [rabbitmq-discuss] Fwd: RabbitMQ crashing on Windows
In-Reply-To: <4E70D1AC.2000408@rabbitmq.com>
References: <CAN=y6RKFO6RixdBG+bamp++pdjxsR9KAR1n99eKEzzuZqCNPiw@mail.gmail.com>
	<CAN=y6RKBTFRBbOsprYj9f=_PnznvR_BcShiHp=bORWeSHDZECA@mail.gmail.com>
	<CABzX+qxZ1aAQVcRPZtxp9Qm0NFLmCxQJ4-hXfMb6gp8W0vwuFQ@mail.gmail.com>
	<CAN=y6R+HxYd-4fBzyDT2nLF+Q8omy0=RU21afU3FY3oOcmRF4g@mail.gmail.com>
	<4E70D1AC.2000408@rabbitmq.com>
Message-ID: <CAN=y6RJbx-TkHv55oeS9-S7RtjXHzw3hzio2iQzDP0ZB+RkxEw@mail.gmail.com>

Hi Emile,

> You can normally edit C:\WINDOWS\system32\drivers\etc\hosts and get
> similar results to editing /etc/hosts on Unix if you want to see whether
> that helps.

Thank you. I will give it a try.

> The information in the rabbit broker logfile would be more useful,
> because rabbit does not log to the system event log.

Unfortunately I believe the log was overwritten when I restarted
rabbit today. The next time it crashes I will make a copy.

Thanks again

Cheers
Juarez


On Wed, Sep 14, 2011 at 1:09 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>
> Hi Juarez,
>
> Op 14/09/11 16:23, het Juarez Bochi geskryf:
> > Hi,
> >
> > Thanks for the tip, but I don't believe that would help... I'm using
> > Windows, not Linux.
>
> It is possible that short vs long hostnames are not relevant to your
> situation. The suggestion was based on a guess, because there is not
> enough information to answer your question.
>
> You can normally edit C:\WINDOWS\system32\drivers\etc\hosts and get
> similar results to editing /etc/hosts on Unix if you want to see whether
> that helps.
>
> > I don't if the following info is relevant, but this is what I got from
> > the Event Viewer:
>
> The information in the rabbit broker logfile would be more useful,
> because rabbit does not log to the system event log. You will find the
> logfiles in the %RABBITMQ_LOG_BASE% folder (normally under
> %APPDATA%\RabbitMQ).
>
> > The erl_crash.dump always starts with something like this:
> > =erl_crash_dump:0.1
> > Tue Sep 13 21:17:21 2011
> > Slogan: Kernel pid terminated (application_controller)
> > ({application_terminated,kernel,shutdown})
>
> Unfortunately these dump files are rarely of any use. The most useful
> information is lost by the time they get generated. Please let use know
> if you find any relevant information from the time of the crash in the
> rabbit logfile instead. If you can determine whether any event triggers
> the crash that will also help.
>
>
>
> -Emile



--

Juarez

From tim.yen at gmail.com  Thu Sep 15 00:56:51 2011
From: tim.yen at gmail.com (Tim Yen)
Date: Thu, 15 Sep 2011 09:56:51 +1000
Subject: [rabbitmq-discuss] Connection getting closed
In-Reply-To: <4E70AA95.7040300@rabbitmq.com>
References: <CAL_6-TOqpzLECs=HS0oR9cEy6iRNZPkwNksLsGCZqHtg6-2oFQ@mail.gmail.com>
	<4E70AA95.7040300@rabbitmq.com>
Message-ID: <CAL_6-TPr0Rn-QjZ9QaM17BEEjGB3OFcB+vDE6Zn0kYMruyyLog@mail.gmail.com>

Emile,

Thanks of the suggestions, one of the other people here noticed that their
disconnects also occured at the same time as MS Outlook disconnects, so it
seems to be a network issue.

Ill look up heartbeats.

thanks,

Tim

On Wed, Sep 14, 2011 at 11:22 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi Tim,
>
> Op 13/09/11 00:56, het Tim Yen geskryf:
> > Hi,
> >
> > Has anyone else run into this exception?
>
> I'm unable to get the supplied code to produce the same exception. What
> versions of the client library and the broker are you using? Are there
> any relevant entries in the broker logfile at the time of the error?
>
> It should not be necessary to recycle connections. If the network
> infrastructure is causing timeouts then you should consider using AMQP
> heartbeats to prevent that.
>
> Another diagnostic test you could perform is to compare the output of
> "rabbitmqctl list_connections" on the broker with "netstat" on the client.
>
>
> -Emile
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110915/9181c906/attachment.htm>

From toby.corkindale at strategicdata.com.au  Thu Sep 15 03:04:02 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Thu, 15 Sep 2011 12:04:02 +1000
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 is released
In-Reply-To: <4E707C67.9000701@rabbitmq.com>
References: <4E6E187B.4090000@rabbitmq.com>	<4E6EFD82.7030901@strategicdata.com.au>	<44465273-4DC1-4509-A210-BA3F98BCF124@gmail.com>	<4E700293.7070906@strategicdata.com.au>	<CAE3HoVS7aQCyZkjK7D57ZHnYfaZ2m8S4NjXHwE0zJhf8Z1oaKQ@mail.gmail.com>
	<4E707C67.9000701@rabbitmq.com>
Message-ID: <4E715D12.7070001@strategicdata.com.au>

On 14/09/11 20:05, Simon MacMullen wrote:
> On 14/09/11 04:39, Michael Klishin wrote:
>> This is a question for RabbitMQ team membersbut I definitely would like
>> to see plugins distributed as .deb packages.
>> Current way of installing them is just painful to automate around and
>> requires manual maintenance even on point releases.
>> There has to be a better way in late 2011.
>
> We're very aware of this, but have been struggling to get to the right
> answer. Individual debs per plugin are a nice idea, but then we have to
> do the same thing for RPMs, Windows, Mac users and so on, plus we either
> package each plugin by hand or try to automate the whole thing. And the
> plugins aren't really designed to be built without the server build
> being there, and so on. It gets messy quickly.

For 2.5.1 I tried to create some more .deb packages for the other 
plugins, following the Ubuntu model used in rabbitmq-stomp, but oh my, 
it was indeed tricky to achieve and I gave up and basically pinned the 
server package at a given point so it didn't upgrade automatically and 
break everything.

But this is a worry, since it's inevitable that someone else will, 
sooner or later, notice that the version is behind and upgrade it 
without realising the implications. :(

> So the new plan is to rearrange things so that all the official plugins
> end up bundled along with the server in a standard way for all
> packaging, and we ship a tool that lets you turn them on or off.
> However, I don't have a date for when this will happen, but it is being
> worked on.

Glad to hear it is being looked at.


thanks,
Toby

From mihirm at omc-international.com.au  Thu Sep 15 04:58:19 2011
From: mihirm at omc-international.com.au (Mihir Mone)
Date: Thu, 15 Sep 2011 13:58:19 +1000
Subject: [rabbitmq-discuss] RabbitMQ Shovel Connections
Message-ID: <004201cc735b$b4aa9c80$1dffd580$@omc-international.com.au>

Hi,

 

I was wondering whether there is a way in which the connections setup by the
shovel plugin can be recycled after a certain amount of time. At the moment
they seem to be persistent connections and the only way to really recycle
them is to restart the Rabbit server (on either end) itself which is rather
counterintuitive.

 

Regards,

Mihir

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110915/ddba3dd0/attachment.htm>

From videlalvaro at gmail.com  Thu Sep 15 15:03:19 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 15 Sep 2011 16:03:19 +0200
Subject: [rabbitmq-discuss] RabbitMQ What /are/ you doing?!
Message-ID: <CAMcAHLUvKG49031GoUe26+xsKE79u3X1gHDpVL7kALpBe=Agog@mail.gmail.com>

 <https://twitter.com/hylomorphism/status/114000680875851776><https://twitter.com/hylomorphism/status/114000680875851776><https://twitter.com/hylomorphism/status/114000680875851776><https://twitter.com/hylomorphism/status/114000680875851776><https://twitter.com/hylomorphism/status/114000680875851776>
Hi,

I saw Matthew tweeting "Oh RabbitMQ, why are you taking over an hour to
recover 100k queues? What /are/ you doing?!"
https://twitter.com/hylomorphism/status/114000680875851776

I've been doing some stuff at work with DTrace and I think is pretty cool
when it comes to find out what a process is actually doing.

At the same time there's an experimental OTP fork on Github that adds Dtrace
probes to Erlang: https://github.com/dustin/otp/wiki/DTrace

See here for the available probes:
https://github.com/dustin/otp/blob/dtrace/erts/emulator/beam/erlang_dtrace.d

So for example running RabbitMQ based on that Erlang branch you could do
things like in this gist: https://gist.github.com/1219266

erlang$target:::function-entry
/copyinstr(arg1) == "rabbit_exchange_type_direct:route/2"/
{
    printf("%s %s", probemod, probefunc);
    self->traceIt = 1;
}


There I enable the flag traceIt only when route/2 is called on the direct
exchange.


From megrimes at socket.net  Thu Sep 15 16:31:10 2011
From: megrimes at socket.net (Michael Grimes)
Date: Thu, 15 Sep 2011 10:31:10 -0500
Subject: [rabbitmq-discuss] Why are all the sets in AMQP.BasicProperties
	deprecated?
Message-ID: <20110915153113.BB5E5B7813@mf5.socket.net>

I would like to use the BasicProperties in BasicPublish.  But I see the
sets are deprecated.  What is the proper way to use this.



From jasonjwwilliams at gmail.com  Thu Sep 15 17:00:13 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 15 Sep 2011 10:00:13 -0600
Subject: [rabbitmq-discuss] RabbitMQ What /are/ you doing?!
In-Reply-To: <CAMcAHLUvKG49031GoUe26+xsKE79u3X1gHDpVL7kALpBe=Agog@mail.gmail.com>
References: <CAMcAHLUvKG49031GoUe26+xsKE79u3X1gHDpVL7kALpBe=Agog@mail.gmail.com>
Message-ID: <DB75B2EA-F751-4A63-BE73-89DA16247283@gmail.com>

OpenIndiana and  (open Solaris) are great Rabbit platforms. FreeBSD has DTrace too. DTrace for Linux isn't up to snuff with the other platforms yet, but it's still worlds ahead of SystemTap. 

-J

Sent via iPhone

Is your email Premiere?

On Sep 15, 2011, at 8:03, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi,
> 
> I saw Matthew tweeting "Oh RabbitMQ, why are you taking over an hour to recover 100k queues? What /are/ you doing?!" https://twitter.com/hylomorphism/status/114000680875851776
> 
> I've been doing some stuff at work with DTrace and I think is pretty cool when it comes to find out what a process is actually doing.
> 
> At the same time there's an experimental OTP fork on Github that adds Dtrace probes to Erlang: https://github.com/dustin/otp/wiki/DTrace
> 
> See here for the available probes: https://github.com/dustin/otp/blob/dtrace/erts/emulator/beam/erlang_dtrace.d
> 
> So for example running RabbitMQ based on that Erlang branch you could do things like in this gist: https://gist.github.com/1219266
> 
> erlang$target:::function-entry
> 
> /copyinstr(arg1) == "rabbit_exchange_type_direct:route/2"/
> 
> {
> 
>     printf("%s %s", probemod, probefunc);
> 
>     self->traceIt = 1;
> 
> }
> 
> 
> There I enable the flag traceIt only when route/2 is called on the direct exchange.
> 
> From there is just a matter of adding probes to different syscalls or io access etc based using patterns on that flag like:
> 
> 
> erlang$target:::function-entry
> /self->traceIt/
> {
>  //do something here
> }
> 
> and so on. 
> 
> You can run the gist like: sudo dtrace -s route.d -p `pgrep beam.smp`
> 
> The examples are really basic but I think they illustrate the point. With that Erlang branch you could enable more granular probes than with the usual pid provider or dtruss.
> 
> BTW, this works on Mac and Solaris. AFAIK on Linux some Kernel modules are required.
> 
> Cheers,
> 
> Alvaro
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110915/5ef6903a/attachment.htm>

From videlalvaro at gmail.com  Thu Sep 15 17:11:50 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 15 Sep 2011 18:11:50 +0200
Subject: [rabbitmq-discuss] RabbitMQ What /are/ you doing?!
In-Reply-To: <DB75B2EA-F751-4A63-BE73-89DA16247283@gmail.com>
References: <CAMcAHLUvKG49031GoUe26+xsKE79u3X1gHDpVL7kALpBe=Agog@mail.gmail.com>
	<DB75B2EA-F751-4A63-BE73-89DA16247283@gmail.com>
Message-ID: <CAMcAHLXuiXftCcnNzFsJyBqz+99B8s_3C3CW6BKX2YwVK717cA@mail.gmail.com>

I hope this DTrace branch gets merged with the default Erlang. I think is
quite useful

On Thu, Sep 15, 2011 at 6:00 PM, Jason J. W. Williams <
jasonjwwilliams at gmail.com> wrote:

> OpenIndiana and  (open Solaris) are great Rabbit platforms. FreeBSD has
> DTrace too. DTrace for Linux isn't up to snuff with the other platforms yet,
> but it's still worlds ahead of SystemTap.
>
> -J
>
> Sent via iPhone
>
> Is your email Premiere?
>
> On Sep 15, 2011, at 8:03, Alvaro Videla <videlalvaro at gmail.com> wrote:
>
> <https://twitter.com/hylomorphism/status/114000680875851776><https://twitter.com/hylomorphism/status/114000680875851776><https://twitter.com/hylomorphism/status/114000680875851776><https://twitter.com/hylomorphism/status/114000680875851776><https://twitter.com/hylomorphism/status/114000680875851776>
> Hi,
>
> I saw Matthew tweeting "Oh RabbitMQ, why are you taking over an hour to
> recover 100k queues? What /are/ you doing?!" <https://twitter.com/hylomorphism/status/114000680875851776>
> https://twitter.com/hylomorphism/status/114000680875851776
>
> I've been doing some stuff at work with DTrace and I think is pretty cool
> when it comes to find out what a process is actually doing.
>
> At the same time there's an experimental OTP fork on Github that adds
> Dtrace probes to Erlang:  <https://github.com/dustin/otp/wiki/DTrace>
> https://github.com/dustin/otp/wiki/DTrace
>
> See here for the available probes: <https://github.com/dustin/otp/blob/dtrace/erts/emulator/beam/erlang_dtrace.d>
> https://github.com/dustin/otp/blob/dtrace/erts/emulator/beam/erlang_dtrace.d
>
> So for example running RabbitMQ based on that Erlang branch you could do
> things like in this gist:  <https://gist.github.com/1219266>
> https://gist.github.com/1219266
>
> erlang$target:::function-entry
> /copyinstr(arg1) == "rabbit_exchange_type_direct:route/2"/
> {
>     printf("%s %s", probemod, probefunc);
>     self->traceIt = 1;
> }
>
>
> There I enable the flag traceIt only when route/2 is called on the direct
> exchange.
>
> From there is just a matter of adding probes to different syscalls or io
> access etc based using patterns on that flag like:
>
> erlang$target:::function-entry
> /self->traceIt/
> {
>  //do something here
> }
>
> and so on.
>
> You can run the gist like: sudo dtrace -s route.d -p `pgrep beam.smp`
>
> The examples are really basic but I think they illustrate the point. With
> that Erlang branch you could enable more granular probes than with the usual
> pid provider or dtruss.
>
> BTW, this works on Mac and Solaris. AFAIK on Linux some Kernel modules are
> required.
>
> Cheers,
>
> Alvaro
>
> _______________________________________________
>
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110915/78ed13e6/attachment.htm>

From jasonjwwilliams at gmail.com  Thu Sep 15 17:21:45 2011
From: jasonjwwilliams at gmail.com (Jason J. W. Williams)
Date: Thu, 15 Sep 2011 10:21:45 -0600
Subject: [rabbitmq-discuss] RabbitMQ What /are/ you doing?!
In-Reply-To: <CAMcAHLXuiXftCcnNzFsJyBqz+99B8s_3C3CW6BKX2YwVK717cA@mail.gmail.com>
References: <CAMcAHLUvKG49031GoUe26+xsKE79u3X1gHDpVL7kALpBe=Agog@mail.gmail.com>
	<DB75B2EA-F751-4A63-BE73-89DA16247283@gmail.com>
	<CAMcAHLXuiXftCcnNzFsJyBqz+99B8s_3C3CW6BKX2YwVK717cA@mail.gmail.com>
Message-ID: <AAA96443-06E2-442A-966C-0D273A5FC2B1@gmail.com>

DTrace is pretty amazing. We've been using it for troubleshooting MySQL since 2006 (OpenSolaris/OpenIndiana). Once you've used it, it's hard to live without. Strace doesn't even hold a candle. 

-J

Sent via iPhone

Is your email Premiere?

On Sep 15, 2011, at 10:11, Alvaro Videla <videlalvaro at gmail.com> wrote:

> I hope this DTrace branch gets merged with the default Erlang. I think is quite useful
> 
> On Thu, Sep 15, 2011 at 6:00 PM, Jason J. W. Williams <jasonjwwilliams at gmail.com> wrote:
> OpenIndiana and  (open Solaris) are great Rabbit platforms. FreeBSD has DTrace too. DTrace for Linux isn't up to snuff with the other platforms yet, but it's still worlds ahead of SystemTap. 
> 
> -J
> 
> Sent via iPhone
> 
> Is your email Premiere?
> 
> On Sep 15, 2011, at 8:03, Alvaro Videla <videlalvaro at gmail.com> wrote:
> 
>> Hi,
>> 
>> I saw Matthew tweeting "Oh RabbitMQ, why are you taking over an hour to recover 100k queues? What /are/ you doing?!" https://twitter.com/hylomorphism/status/114000680875851776
>> 
>> I've been doing some stuff at work with DTrace and I think is pretty cool when it comes to find out what a process is actually doing.
>> 
>> At the same time there's an experimental OTP fork on Github that adds Dtrace probes to Erlang: https://github.com/dustin/otp/wiki/DTrace
>> 
>> See here for the available probes: https://github.com/dustin/otp/blob/dtrace/erts/emulator/beam/erlang_dtrace.d
>> 
>> So for example running RabbitMQ based on that Erlang branch you could do things like in this gist: https://gist.github.com/1219266
>> 
>> erlang$target:::function-entry
>> 
>> 
>> /copyinstr(arg1) == "rabbit_exchange_type_direct:route/2"/
>> 
>> 
>> {
>> 
>> 
>>     printf("%s %s", probemod, probefunc);
>> 
>> 
>>     self->traceIt = 1;
>> 
>> 
>> }
>> 
>> 
>> 
>> There I enable the flag traceIt only when route/2 is called on the direct exchange.
>> 
>> From there is just a matter of adding probes to different syscalls or io access etc based using patterns on that flag like:
>> 
>> 
>> 
>> erlang$target:::function-entry
>> /self->traceIt/
>> {
>>  //do something here
>> }
>> 
>> and so on. 
>> 
>> You can run the gist like: sudo dtrace -s route.d -p `pgrep beam.smp`
>> 
>> The examples are really basic but I think they illustrate the point. With that Erlang branch you could enable more granular probes than with the usual pid provider or dtruss.
>> 
>> BTW, this works on Mac and Solaris. AFAIK on Linux some Kernel modules are required.
>> 
>> Cheers,
>> 
>> Alvaro
>> _______________________________________________
>> 
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110915/2c07d6d9/attachment.htm>

From voidfiles at gmail.com  Thu Sep 15 17:21:23 2011
From: voidfiles at gmail.com (Alex Kessinger)
Date: Thu, 15 Sep 2011 09:21:23 -0700 (PDT)
Subject: [rabbitmq-discuss] I think I am getting bunch of garbage que's Is
	this right?
Message-ID: <b0a6938c-2762-47aa-9084-8414a4b76810@o16g2000yqj.googlegroups.com>

Hi,
   I tried googling for this before I bothered anyone, but I am having
a problem with my rabbitmq instance. I am not even sure if its a
problem. I am using rabbitmq as the backing of a celeryd instance.
When everything first starts up I see that my queues look like this

> rabbitmqctl list_queues -p main
celery	0
li256-9.celeryd.pidbox	0

then after some activity the queues begin to look like this

> rabbitmqctl list_queues -p main

Listing queues ...
96b58ad614384ebcb997e0bbc5b919aa	1
celery	0
ff3258f5a93f4fe58b3f852d0adf16c9	1
4303c12f425c479d9c34918cf69bb67a	1
c92c70b928c94af1a24baa003d78a610	1
be1f402df88f4618be33630cb74ec7a5	1
li256-9.celeryd.pidbox	0
6a673a7d943e44afb75d787d1608b459	1
4b7ed183a35548279feaa7446037dac4	1
776227075ac441dcad1cddd3a627a9fb	1
1a794124450f4d3dafa62426fa216880	1
e9be9129adc24509bfc52700fdd512c0	1
...done.

Then it just keeps growing untill I think ampq runs out of memory, and
crashes. Has anyone seen behavior like this? Does anyone know how I
might be able to fix it.

From michael.s.klishin at gmail.com  Fri Sep 16 05:53:06 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 16 Sep 2011 08:53:06 +0400
Subject: [rabbitmq-discuss] Why are all the sets in AMQP.BasicProperties
	deprecated?
In-Reply-To: <20110915153113.BB5E5B7813@mf5.socket.net>
References: <20110915153113.BB5E5B7813@mf5.socket.net>
Message-ID: <CAE3HoVTBrt4MfTqCsm9mknC_i-M+grZ+osSpAz9BzPq=MumgEw@mail.gmail.com>

2011/9/15 Michael Grimes <megrimes at socket.net>

> I would like to use the BasicProperties in BasicPublish.  But I see the
> sets are deprecated.  What is the proper way to use this.
>


Michael,

There is a builder class with the same purpose, AMQP.BasicProperties.Builder

-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110916/69850144/attachment.htm>

From toby.corkindale at strategicdata.com.au  Fri Sep 16 08:20:46 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Fri, 16 Sep 2011 17:20:46 +1000
Subject: [rabbitmq-discuss] Unicode handling changed between 2.5.1 and 2.6.1?
Message-ID: <4E72F8CE.10103@strategicdata.com.au>

Hi,
I upgraded from RabbitMQ + STOMP plugin, from version 2.5.1 to 2.6.1.

Now I am seeing a bunch of double-encoding of unicode characters.

I wondered if there have been any changes to RabbitMQ or the STOMP 
plugin between those versions that could have caused this?

(It's possible it's coming from somewhere else, but I didn't change much 
else here..)

thanks,
Toby

From toby.corkindale at strategicdata.com.au  Fri Sep 16 08:31:51 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Fri, 16 Sep 2011 17:31:51 +1000
Subject: [rabbitmq-discuss] Unicode handling changed between 2.5.1 and
 2.6.1?
In-Reply-To: <4E72F8CE.10103@strategicdata.com.au>
References: <4E72F8CE.10103@strategicdata.com.au>
Message-ID: <4E72FB67.1050604@strategicdata.com.au>

On 16/09/11 17:20, Toby Corkindale wrote:
> Hi,
> I upgraded from RabbitMQ + STOMP plugin, from version 2.5.1 to 2.6.1.
>
> Now I am seeing a bunch of double-encoding of unicode characters.
>
> I wondered if there have been any changes to RabbitMQ or the STOMP
> plugin between those versions that could have caused this?
>
> (It's possible it's coming from somewhere else, but I didn't change much
> else here..)

I found a place in my code where I was doing UTF8 conversion, and after 
removing that, I'm not getting double-encoded UTF8 any more. However the 
code definitely used to require it.

I guess something relating to unicode was fixed in the stomp or rabbit 
layer?

Toby

From majek04 at gmail.com  Fri Sep 16 10:28:43 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 16 Sep 2011 10:28:43 +0100
Subject: [rabbitmq-discuss] Unicode handling changed between 2.5.1 and
	2.6.1?
In-Reply-To: <4E72FB67.1050604@strategicdata.com.au>
References: <4E72F8CE.10103@strategicdata.com.au>
	<4E72FB67.1050604@strategicdata.com.au>
Message-ID: <CABzX+qy_N0vGZNmOBRPbqdjzpt0B1EyMAiRHr8k3UkP59FJp9g@mail.gmail.com>

On Fri, Sep 16, 2011 at 08:31, Toby Corkindale
<toby.corkindale at strategicdata.com.au> wrote:
> On 16/09/11 17:20, Toby Corkindale wrote:
>>
>> Hi,
>> I upgraded from RabbitMQ + STOMP plugin, from version 2.5.1 to 2.6.1.
>>
>> Now I am seeing a bunch of double-encoding of unicode characters.
>>
>> I wondered if there have been any changes to RabbitMQ or the STOMP
>> plugin between those versions that could have caused this?
>>
>> (It's possible it's coming from somewhere else, but I didn't change much
>> else here..)
>
> I found a place in my code where I was doing UTF8 conversion, and after
> removing that, I'm not getting double-encoded UTF8 any more. However the
> code definitely used to require it.
>
> I guess something relating to unicode was fixed in the stomp or rabbit
> layer?

See this discussion:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014412.html

AFAIR nothing substantial was changed, only the fact that we don't
add content-type by default.

Is it possible that this is what you see?

Cheers,
  Marek

From bob_claerhout at hotmail.com  Fri Sep 16 10:31:17 2011
From: bob_claerhout at hotmail.com (Bob Claerhout)
Date: Fri, 16 Sep 2011 11:31:17 +0200
Subject: [rabbitmq-discuss] rabbitmq cluster using IP
Message-ID: <SNT103-DS135D0182FAABEAD9A04D7180060@phx.gbl>

Hi all,

 

I want to use the cluster using IP instead of a hostname.

I found a solution to do this but at the end of the discussion it says that
this will be included in the next stable release.

Since this stable release is already there, it should work.

However, this does not work here.

Any suggestions?

 

Kind regards

Bob Claerhout

 

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110916/d1035518/attachment.htm>

From simon at rabbitmq.com  Fri Sep 16 10:37:45 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Sep 2011 10:37:45 +0100
Subject: [rabbitmq-discuss] v2.6.1: TypeError: can't convert undefined
 to	object
In-Reply-To: <CAP+1M2fEEtvRCqJJwNhmT=FsvxjvLH+3XiAvMFsLpFNPNtUMTg@mail.gmail.com>
References: <CAP+1M2fEEtvRCqJJwNhmT=FsvxjvLH+3XiAvMFsLpFNPNtUMTg@mail.gmail.com>
Message-ID: <4E7318E9.7000904@rabbitmq.com>

On 13/09/11 03:02, Bryan Murphy wrote:
> I created another cluster with active/active queues and am getting
> some odd behavior in the management interface.  When I view the queues
> in the web interface, I see "TypeError: can't convert undefined to
> object" all over the place and the UI is pretty much broken.

With Bryan's help I've now got to the bottom of this.

The problem is actually a bug in jQuery 1.4.2 (as shipped with mgmt) 
triggered by using active/active mirroring and browsing the web 
interface with Firefox 6 or latest Chrome.

If anyone else is seeing this, you can download a version of the 
management plugin with an updated copy of jQuery from:

http://www.rabbitmq.com/releases/plugins/v2.6.1/rabbitmq_management-2.6.1.jquery-fix.ez

This replaces rabbitmq_management-2.6.1.ez.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexandru at rabbitmq.com  Fri Sep 16 10:49:04 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 16 Sep 2011 10:49:04 +0100
Subject: [rabbitmq-discuss] rabbitmq cluster using IP
In-Reply-To: <SNT103-DS135D0182FAABEAD9A04D7180060@phx.gbl>
References: <SNT103-DS135D0182FAABEAD9A04D7180060@phx.gbl>
Message-ID: <20110916094904.GA3289@southbank.eng.vmware.com>

Hi,

> I found a solution to do this but at the end of the discussion it says that
> this will be included in the next stable release.

Link?

> Since this stable release is already there, it should work.
> However, this does not work here.

The normal way of doing this is to add the IPs to your hosts file (or to
make the hostnames resolve to the IPs somehow: there are a bunch of
easy-to-configure lightweight DNS servers available).

Cheers,
Alex


On Fri, Sep 16, 2011 at 11:31:17AM +0200, Bob Claerhout wrote:
> Hi all,
> 
>  
> 
> I want to use the cluster using IP instead of a hostname.
> 
> I found a solution to do this but at the end of the discussion it says that
> this will be included in the next stable release.
> 
> Since this stable release is already there, it should work.
> 
> However, this does not work here.
> 
> Any suggestions?
> 
>  
> 
> Kind regards
> 
> Bob Claerhout
> 
>  
> 
>  
> 
>  
> 

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From bob_claerhout at hotmail.com  Fri Sep 16 10:25:24 2011
From: bob_claerhout at hotmail.com (Bob Claerhout)
Date: Fri, 16 Sep 2011 11:25:24 +0200
Subject: [rabbitmq-discuss] rabbitmq cluster using IP
Message-ID: <SNT103-DS57131F55264A6EEDE434780060@phx.gbl>

Hi all,

 

I want to use the cluster using IP instead of a hostname.

I found a solution to do this but at the end of the discussion it says that
this will be included in the next stable release.

Since this stable release is already there, it should work.

However, this does not work here.

Any suggestions?

 

Kind regards

Bob Claerhout

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110916/e805b12d/attachment.htm>

From bob_claerhout at hotmail.com  Fri Sep 16 11:51:50 2011
From: bob_claerhout at hotmail.com (Bob Claerhout)
Date: Fri, 16 Sep 2011 12:51:50 +0200
Subject: [rabbitmq-discuss] rabbitmq cluster using IP
In-Reply-To: <20110916094904.GA3289@southbank.eng.vmware.com>
References: <SNT103-DS135D0182FAABEAD9A04D7180060@phx.gbl>
	<20110916094904.GA3289@southbank.eng.vmware.com>
Message-ID: <SNT103-DS151E5D80C1999D854BB52280060@phx.gbl>

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-December/005644.ht
ml

Your solution is not sufficient enough. I prefer not to use any hostnames
because this is less reliable. In fact, I don't want to use DNS.
IP is faster and several other functionalities (within my system, e.g.
creating and booting new VMs automatically) already use IP for
communication.

Kind regards,

Bob

-----Original Message-----
From: Alexandru Scvor?ov [mailto:scvalex at gmail.com] On Behalf Of Alexandru
Scvortov
Sent: vrijdag 16 september 2011 11:49
To: Bob Claerhout
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] rabbitmq cluster using IP

Hi,

> I found a solution to do this but at the end of the discussion it says 
> that this will be included in the next stable release.

Link?

> Since this stable release is already there, it should work.
> However, this does not work here.

The normal way of doing this is to add the IPs to your hosts file (or to
make the hostnames resolve to the IPs somehow: there are a bunch of
easy-to-configure lightweight DNS servers available).

Cheers,
Alex


On Fri, Sep 16, 2011 at 11:31:17AM +0200, Bob Claerhout wrote:
> Hi all,
> 
>  
> 
> I want to use the cluster using IP instead of a hostname.
> 
> I found a solution to do this but at the end of the discussion it says 
> that this will be included in the next stable release.
> 
> Since this stable release is already there, it should work.
> 
> However, this does not work here.
> 
> Any suggestions?
> 
>  
> 
> Kind regards
> 
> Bob Claerhout
> 
>  
> 
>  
> 
>  
> 

> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From majek04 at gmail.com  Fri Sep 16 11:55:23 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 16 Sep 2011 11:55:23 +0100
Subject: [rabbitmq-discuss] I think I am getting bunch of garbage que's
 Is this right?
In-Reply-To: <b0a6938c-2762-47aa-9084-8414a4b76810@o16g2000yqj.googlegroups.com>
References: <b0a6938c-2762-47aa-9084-8414a4b76810@o16g2000yqj.googlegroups.com>
Message-ID: <CABzX+qzawzVpjqYW+ZxuCB6OcBX5bVJ7LSAaQmv+_i4b5198Xg@mail.gmail.com>

My rough guess would be that you're not picking up responses.

http://celery.readthedocs.org/en/latest/configuration.html#std:setting-CELERY_IGNORE_RESULT

Cheers,
   Marek

On Thu, Sep 15, 2011 at 17:21, Alex Kessinger <voidfiles at gmail.com> wrote:
> Hi,
> ? I tried googling for this before I bothered anyone, but I am having
> a problem with my rabbitmq instance. I am not even sure if its a
> problem. I am using rabbitmq as the backing of a celeryd instance.
> When everything first starts up I see that my queues look like this
>
>> rabbitmqctl list_queues -p main
> celery ?0
> li256-9.celeryd.pidbox ?0
>
> then after some activity the queues begin to look like this
>
>> rabbitmqctl list_queues -p main
>
> Listing queues ...
> 96b58ad614384ebcb997e0bbc5b919aa ? ? ? ?1
> celery ?0
> ff3258f5a93f4fe58b3f852d0adf16c9 ? ? ? ?1
> 4303c12f425c479d9c34918cf69bb67a ? ? ? ?1
> c92c70b928c94af1a24baa003d78a610 ? ? ? ?1
> be1f402df88f4618be33630cb74ec7a5 ? ? ? ?1
> li256-9.celeryd.pidbox ?0
> 6a673a7d943e44afb75d787d1608b459 ? ? ? ?1
> 4b7ed183a35548279feaa7446037dac4 ? ? ? ?1
> 776227075ac441dcad1cddd3a627a9fb ? ? ? ?1
> 1a794124450f4d3dafa62426fa216880 ? ? ? ?1
> e9be9129adc24509bfc52700fdd512c0 ? ? ? ?1
> ...done.
>
> Then it just keeps growing untill I think ampq runs out of memory, and
> crashes. Has anyone seen behavior like this? Does anyone know how I
> might be able to fix it.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From steve at rabbitmq.com  Fri Sep 16 13:05:14 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Fri, 16 Sep 2011 13:05:14 +0100
Subject: [rabbitmq-discuss] Thread locked
In-Reply-To: <16365_1315558628_4E69D4E4_16365_28912_1_4E69D4E4.3060504@orange-ftgroup.com>
References: <4541_1315496193_4E68E101_4541_78283_2_4E68E101.9060307@orange-ftgroup.com>
	<9CCF4BE5-C30C-47C0-8AA7-A487195B4CA0@gmail.com>
	<16365_1315558628_4E69D4E4_16365_28912_1_4E69D4E4.3060504@orange-ftgroup.com>
Message-ID: <B6014189-E508-40AF-B8A5-A6551E601773@rabbitmq.com>

Jean-Phillipe,

Looking at the small section of the jstack output you gave us, it appears
that this thread is still runnable, and is holding three locks.
   It is doing blocking write IO to a socket, which may very well not be
doing very much (if you have run out of memory more than just in the
JVM).  Just because it is there in the threads, doesn't mean it is related
to the out-of-memory problems you are seeing, though.

In general when out-of-memory exceptions are thrown in Java it is more
interesting to catch them (can we see these exceptions with stack?) and
then to try to track down what  might have happened after the exception
is caught (or not), for often there is no sensible action taken, and tasks
and processes that simply abort can leave system resources (like
sockets?) in an invalid state.  This, in turn, can leave (native) functions
hanging.  This is pure speculation, however.

Since you are using the RabbitMQ Java client, it is worth pointing out
that one source of unintended memory consumption is
QueuingConsumer, which keeps all the messages it might receive
until you take them.  If you don't ever take them out they stay there. 
It is entirely possible to leave a reference around to the consumer
object which might mean that, even if you no longer use a particular
QueueingConsumer, it is not garbage collected later, so it retains
all the messages sent to it.

However, without further information, the out-of-memory conditions
cannot be further diagnosed.
   Perhaps after your upgrade to the latest release you could report
back here to tell us if you are still having problems.  A full jstack
attachment might be more revealing (and an exception stack for
the out-of-memory condition, might help, too).
   Thanks.
Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]

On 9 Sep 2011, at 09:57, <jeanphilippe1.caruana at orange-ftgroup.com> wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/014991.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110916/a8b7d052/attachment.htm>

From matthias at rabbitmq.com  Fri Sep 16 13:11:05 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 16 Sep 2011 13:11:05 +0100
Subject: [rabbitmq-discuss] are these features planned/do they already
 exist?
In-Reply-To: <CAEqX17NEqTKefMdLZ2mFyVFw+SStkhnOtvtnqa+7Nk8HPZqEZQ@mail.gmail.com>
References: <CAEqX17NEqTKefMdLZ2mFyVFw+SStkhnOtvtnqa+7Nk8HPZqEZQ@mail.gmail.com>
Message-ID: <4E733CD9.9040406@rabbitmq.com>

Praveen,

On 14/09/11 01:59, Praveen M wrote:
> 1) Ability to consume messages in bulk. I see that basic consume does a
> call back for each message..Is there an api to do the callback with a
> user defined bulk of messages?

There isn't. What is the use case?

> 2) Is there a way to publish a message with a delay? I mean, is there a
> way to publish a message with a delay and have the message consumed only
> after the delay expires?

No. Do you require the delay to be specified per message or would it 
suffice if the same delay was applied to all messages in a queue? The 
latter is something we have contemplated adding, though it's not on our 
near/medium term todo list.

> 3) Are dead-letter queues there yet?

No, but we are working on it. No ETA yet.

> and messages with TTL?

We introduced a per-queue message ttl setting a while ago. See 
http://www.rabbitmq.com/extensions.html#queue-ttl.


Regards,

Matthias.

From majek04 at gmail.com  Fri Sep 16 13:16:09 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 16 Sep 2011 13:16:09 +0100
Subject: [rabbitmq-discuss] behavior when client socket close
In-Reply-To: <CAHiEoM4bqBwzO9A3ivfaAPB=g7=BOOQJEm58eG5KUuwvtm5MMg@mail.gmail.com>
References: <CAHiEoM4bqBwzO9A3ivfaAPB=g7=BOOQJEm58eG5KUuwvtm5MMg@mail.gmail.com>
Message-ID: <CABzX+qzGXto3YRCRFkApZs3XWNKvFbWLjx694Ui66ML+B8Zfcw@mail.gmail.com>

On Tue, Sep 13, 2011 at 21:17, Aaron Westendorf <aaron at agoragames.com> wrote:
> We're trying to determine Rabbits expected behavior when a client host
> shuts off. Server is hardware 2.5.1, client is a VM that was shut down
> cleanly (i.e. power off). We have no heartbeats, and the client turns
> on keepalives. We found that linux reported these sockets as
> ESTABLISHED after the clients were turned off, and we're trying to
> determine if this is a problem with our vendor's network or expected
> behavior. Host OS is Linux 2.6.35.

What should happen when you type 'shutdown':
 1) linux starts shutting down process
 2) as one of the shutdown steps rabbitmq is cleanly closed
   (equivalent to /etc/init.d/rabbitmq-server stop)
 3) during shutdown all network connections get properly closed

The behaviour you're explaining may happen, for example
when the server is closed uncleanly - 'power cord' shutdown kind
of thing. TCP/IP is not able to distinguish transient network
failure from remote host being completely down.

But, it is quite possible that 2) took more time than expected,
which could be what you're seeing. Rabbitmq sometimes
needs quite some time to dump messages to the disk
and shutdown cleanly. In such case operating system won't
wait too long and will shutdown with rabbitmq and its connections
still up.

As a workaround:
 - stop rabbitmq manually before shutting down the system
  (and make sure it has enough time to write messages)
 - use keepalives/heartbeats so that clients can detect
   this kind of issues earlier.

Cheers,
  Marek

From emile at rabbitmq.com  Fri Sep 16 14:02:12 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 16 Sep 2011 14:02:12 +0100
Subject: [rabbitmq-discuss] Issues with RabbitMQ, 	SSL and .NET
In-Reply-To: <f7m0u7n.269442d04a17189dfd81cdd08904d4a4@webmail.vigasis.com>
References: <f7m0u7n.269442d04a17189dfd81cdd08904d4a4@webmail.vigasis.com>
Message-ID: <4E7348D4.9060403@rabbitmq.com>

Hi Umut,

Op 13/09/11 12:37, het Umut Sahin geskryf:

> cf.Address ="10.35.110.167";
> cf.HostName = "server-PC";

> this code crashes all the time...
> 
> but when we take the #cf.Address ="10.35.110.167";# line to the bottom it works like a dream...
> so the working code is below:

> cf.HostName = "server-PC";
> cf.Address ="10.35.110.167";

ConnectionFactory.Address is a convenience for setting multiple other
properties simultaneously, including hostname. In your case you already
set those properties, therefore also setting Address is superfluous.

If using an IP address is the only option that works then your name
resolution is not working. Check your hosts file (typically
C:\WINDOWS\system32\drivers\etc\hosts) or your DNS.

(If you do choose to reply to this message please don't start a new thread.)


Regards

Emile

From aaron at agoragames.com  Fri Sep 16 14:17:50 2011
From: aaron at agoragames.com (Aaron Westendorf)
Date: Fri, 16 Sep 2011 09:17:50 -0400
Subject: [rabbitmq-discuss] behavior when client socket close
In-Reply-To: <CABzX+qzGXto3YRCRFkApZs3XWNKvFbWLjx694Ui66ML+B8Zfcw@mail.gmail.com>
References: <CAHiEoM4bqBwzO9A3ivfaAPB=g7=BOOQJEm58eG5KUuwvtm5MMg@mail.gmail.com>
	<CABzX+qzGXto3YRCRFkApZs3XWNKvFbWLjx694Ui66ML+B8Zfcw@mail.gmail.com>
Message-ID: <CAHiEoM5CDSb2xKehKaPYQzOibh92HQH+429eiWwbyaL5mH21Rw@mail.gmail.com>

Opposite direction; the clients where turned off, rabbit continued
serving our infrastructure.

This is an important problem for us because our monitoring tools freak
out when the running clients do not match the number of connections
reported by rabbit.

If the problem is not in our networking setup, then it likely lies
somewhere between linux and rabbit. When I've written epoll network
apps, I've found that I always am notified of a read event when the
socket closes, and then if no data is read, the socket is closed. I'm
wondering if rabbit is making that assumption as well, because if it
is, then the problem lies elsewhere.

-Aaron



On Fri, Sep 16, 2011 at 8:16 AM, Marek Majkowski <majek04 at gmail.com> wrote:
> On Tue, Sep 13, 2011 at 21:17, Aaron Westendorf <aaron at agoragames.com> wrote:
>> We're trying to determine Rabbits expected behavior when a client host
>> shuts off. Server is hardware 2.5.1, client is a VM that was shut down
>> cleanly (i.e. power off). We have no heartbeats, and the client turns
>> on keepalives. We found that linux reported these sockets as
>> ESTABLISHED after the clients were turned off, and we're trying to
>> determine if this is a problem with our vendor's network or expected
>> behavior. Host OS is Linux 2.6.35.
>
> What should happen when you type 'shutdown':
> ?1) linux starts shutting down process
> ?2) as one of the shutdown steps rabbitmq is cleanly closed
> ? (equivalent to /etc/init.d/rabbitmq-server stop)
> ?3) during shutdown all network connections get properly closed
>
> The behaviour you're explaining may happen, for example
> when the server is closed uncleanly - 'power cord' shutdown kind
> of thing. TCP/IP is not able to distinguish transient network
> failure from remote host being completely down.
>
> But, it is quite possible that 2) took more time than expected,
> which could be what you're seeing. Rabbitmq sometimes
> needs quite some time to dump messages to the disk
> and shutdown cleanly. In such case operating system won't
> wait too long and will shutdown with rabbitmq and its connections
> still up.
>
> As a workaround:
> ?- stop rabbitmq manually before shutting down the system
> ?(and make sure it has enough time to write messages)
> ?- use keepalives/heartbeats so that clients can detect
> ? this kind of issues earlier.
>
> Cheers,
> ?Marek
>



-- 
Aaron Westendorf
Senior Software Engineer
Agora Games
359 Broadway
Troy, NY 12180
Phone: 518.268.1000
aaron at agoragames.com
www.agoragames.com

From majek04 at gmail.com  Fri Sep 16 14:57:50 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 16 Sep 2011 14:57:50 +0100
Subject: [rabbitmq-discuss] behavior when client socket close
In-Reply-To: <CAHiEoM5CDSb2xKehKaPYQzOibh92HQH+429eiWwbyaL5mH21Rw@mail.gmail.com>
References: <CAHiEoM4bqBwzO9A3ivfaAPB=g7=BOOQJEm58eG5KUuwvtm5MMg@mail.gmail.com>
	<CABzX+qzGXto3YRCRFkApZs3XWNKvFbWLjx694Ui66ML+B8Zfcw@mail.gmail.com>
	<CAHiEoM5CDSb2xKehKaPYQzOibh92HQH+429eiWwbyaL5mH21Rw@mail.gmail.com>
Message-ID: <CABzX+qztSdw3d-_zceD3+2keHzvx00D1OABQFgpAOGqvb6_+vg@mail.gmail.com>

On Fri, Sep 16, 2011 at 14:17, Aaron Westendorf <aaron at agoragames.com> wrote:
> Opposite direction; the clients where turned off, rabbit continued
> serving our infrastructure.
>
> This is an important problem for us because our monitoring tools freak
> out when the running clients do not match the number of connections
> reported by rabbit.

Understood. If you kill the client process, operating system should
close tcp/ip connections and will notify the rabbitmq server about
it.

If the whole client machine dies... that's a different story. RabbitMQ
will fall back to usual tcp/ip mechanisms to detect failure. And it can
take a while for tcp/ip to detect a broken connection.

> If the problem is not in our networking setup, then it likely lies
> somewhere between linux and rabbit. When I've written epoll network
> apps, I've found that I always am notified of a read event when the
> socket closes, and then if no data is read, the socket is closed. I'm
> wondering if rabbit is making that assumption as well, because if it
> is, then the problem lies elsewhere.

Possible workarounds:
 - use tcp/ip keepalives
 - use amqp heartbeats

Marek

From matthew at rabbitmq.com  Fri Sep 16 16:25:27 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 16 Sep 2011 16:25:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ Shovel Connections
In-Reply-To: <004201cc735b$b4aa9c80$1dffd580$@omc-international.com.au>
References: <004201cc735b$b4aa9c80$1dffd580$@omc-international.com.au>
Message-ID: <20110916152527.GC4517@wellquite.org>

Hi Mihir,

On Thu, Sep 15, 2011 at 01:58:19PM +1000, Mihir Mone wrote:
> I was wondering whether there is a way in which the connections setup by the
> shovel plugin can be recycled after a certain amount of time. At the moment
> they seem to be persistent connections and the only way to really recycle
> them is to restart the Rabbit server (on either end) itself which is rather
> counterintuitive.

Hmm. I'm a bit confused by this. Whilst the each shovel is running, it
maintains the connections to the source and to the destination brokers.
Are you requesting that if the source queue is empty, the connection to
the destination be dropped? Or, to put it another way, only create the
connection to the destination once there are msgs to relay, and to drop
it after a period of inactivity?

If so, no, there is currently no way to do that. It's an interesting
feature request though. What's the motivation for such a feature?

Matthew

From simon at rabbitmq.com  Fri Sep 16 17:02:58 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 16 Sep 2011 17:02:58 +0100
Subject: [rabbitmq-discuss] Node reaches RAM High Watermark quickly
In-Reply-To: <00bc01cc719a$5c0fe6b0$142fb410$@euphoriaaudio.com>
References: <00bc01cc719a$5c0fe6b0$142fb410$@euphoriaaudio.com>
Message-ID: <4E737332.2040506@rabbitmq.com>

On 12/09/11 23:21, Chris Larsen wrote:
> Hello, we?re running a bunch of nodes of RabbitMQ 2.3.1 on Erlang R13B03
> under Debian and one of the nodes has a problem where it reaches the
> high watermark, stops accepting producers and requires a reboot to
> recover. The consumers eat all of the messages so that the queues are
> empty but the used Ram never drops. I checked for queue leakage and we
> only have 9 queues defined with about 100 unacked messages in one queue
> when the ram fills up. We only have about 30 connections and less than
> 20 channels shown in the GUI when it fails. The system isn?t running in
> swap and messages are sometimes a couple of MB in size but no larger.
> Any ideas what it might be? Thank you!

There was a memory leak bug in 2.3.1 when using confirms with the 
immediate flag - but "immediate" is pretty rarely used and it was 
probably a slow leak. Still, if you are using that combination, that's 
suspicious.

What does mgmt say about the memory use for each queue? Unfortunately 
there's also a bug in 2.3.1 which makes mgmt report inflated memory use 
for idle queues but it should be accurate enough to see any gross problems.

Also, you can get slightly more detailed global memory statistics than 
are shown in the GUI with:

rabbitmqadmin -f long list nodes

or something like:

curl -u guest:guest http://localhost:55672/api/nodes

- it might be instructive to see those.

Other than that, the standard advice is to upgrade to 2.6.1 and see if 
the problem goes away.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From lefthandmagic at gmail.com  Fri Sep 16 18:15:41 2011
From: lefthandmagic at gmail.com (Praveen M)
Date: Fri, 16 Sep 2011 10:15:41 -0700
Subject: [rabbitmq-discuss] are these features planned/do they already
	exist?
In-Reply-To: <4E733CD9.9040406@rabbitmq.com>
References: <CAEqX17NEqTKefMdLZ2mFyVFw+SStkhnOtvtnqa+7Nk8HPZqEZQ@mail.gmail.com>
	<4E733CD9.9040406@rabbitmq.com>
Message-ID: <CAEqX17N74f6SDWyaaj0ED_1FZEPCz1atjHJEU5htRXcpryEhsA@mail.gmail.com>

Hi Matthias,

Thanks for your reply. See answers inline.

On Fri, Sep 16, 2011 at 5:11 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Praveen,
>
>
> On 14/09/11 01:59, Praveen M wrote:
>
>> 1) Ability to consume messages in bulk. I see that basic consume does a
>> call back for each message..Is there an api to do the callback with a
>> user defined bulk of messages?
>>
>
> There isn't. What is the use case?


*We currently use oracle AQ for our messaging layer and it is one of it's
features. Was just curious if rabbit has it too. It's not a necessity. We
can workaround with what we have for our use. *

>
>
>  2) Is there a way to publish a message with a delay? I mean, is there a
>> way to publish a message with a delay and have the message consumed only
>> after the delay expires?
>>
>
> No. Do you require the delay to be specified per message or would it
> suffice if the same delay was applied to all messages in a queue? The latter
> is something we have contemplated adding, though it's not on our near/medium
> term todo list.
>
>  *Yes. Our use case requires per message delay to be specified. The use
case here is when messages are scheduled one -off by user actions.*

>
>  3) Are dead-letter queues there yet?
>>
>
> No, but we are working on it. No ETA yet.
>
>  and messages with TTL?
>>
>
> We introduced a per-queue message ttl setting a while ago. See
> http://www.rabbitmq.com/**extensions.html#queue-ttl<http://www.rabbitmq.com/extensions.html#queue-ttl>


*ah..i missed that..thanks.*

>
>
> Regards,
>
> Matthias.
>



-- 
-Praveen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110916/555075c4/attachment.htm>

From dbecker at cpicorp.com  Fri Sep 16 19:01:58 2011
From: dbecker at cpicorp.com (Derek Chen-Becker)
Date: Fri, 16 Sep 2011 13:01:58 -0500
Subject: [rabbitmq-discuss] Why are all the sets in AMQP.BasicProperties
 deprecated?
In-Reply-To: <20110915153113.BB5E5B7813@mf5.socket.net>
References: <20110915153113.BB5E5B7813@mf5.socket.net>
Message-ID: <4E738F16.50101@cpicorp.com>

On 09/15/2011 10:31 AM, Michael Grimes wrote:
> I would like to use the BasicProperties in BasicPublish.  But I see the
> sets are deprecated.  What is the proper way to use this.

I would love to know this, too. I noticed it when I upgraded one of our
apps to 2.6.1 but I can't find anything in the mailing list archives
explaining the reason for deprecation.

Derek


-- 
----------------------------------------------------------------------
Derek Chen-Becker
Senior Network Engineer, Security Architect
CPI Corp, Inc.
1706 Washington Ave
St. Louis, MO 63103
Phone: 314-231-7711 x6455
Fax:   314-613-6724
dbecker at cpicorp.com
PGP Key available from public key servers
Fingerprint: E4C4 26C0 8588 E80A C29F  636D 1FBE 0FE3 2871 4AE8
----------------------------------------------------------------------

From dreyemi at gmail.com  Fri Sep 16 19:36:16 2011
From: dreyemi at gmail.com (Kayode Odeyemi)
Date: Fri, 16 Sep 2011 19:36:16 +0100
Subject: [rabbitmq-discuss] Error: unable to connect to node
	'rabbit@localhost': nodedown.
Message-ID: <CAPbrmCuEybAvsLkG6sz8+y5GQkxZN2tJZLAdiH5X9wvdEvpN9g@mail.gmail.com>

Hello,

This is my first post here. I'm working with celery which has RabbitMQ as a
dependency. After walking through the installation steps, I'm getting the
following errors:

Error: unable to connect to node 'rabbit at localhost': nodedown.

Some platform information:
OS: windows server 2003
Python 2.7

I'm getting the above errors when I enter rabbitmqctl status. I already
started RabbitMQ with the command rabbitmq-service start. Daemon started
successfully.

Please I need help.

Thanks

-- 
Odeyemi 'Kayode O.
http://www.sinati.com. t: @charyorde
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110916/6e8e75d3/attachment.htm>

From michael.s.klishin at gmail.com  Fri Sep 16 20:00:44 2011
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 16 Sep 2011 23:00:44 +0400
Subject: [rabbitmq-discuss] Why are all the sets in AMQP.BasicProperties
	deprecated?
In-Reply-To: <4E738F16.50101@cpicorp.com>
References: <20110915153113.BB5E5B7813@mf5.socket.net>
	<4E738F16.50101@cpicorp.com>
Message-ID: <E33D831A-2FF4-43B2-9AE0-3B556ECB2D36@gmail.com>

Derek Chen-Becker:

> I would love to know this, too. I noticed it when I upgraded one of our
> apps to 2.6.1 but I can't find anything in the mailing list archives
> explaining the reason for deprecation.

Maybe my previous reply didn't make it to the list. There is a builder class, AMQP.BasicProperties.Builder, which is supposed to be used instead.

MK


From stwarog at gmail.com  Fri Sep 16 23:20:01 2011
From: stwarog at gmail.com (serek)
Date: Fri, 16 Sep 2011 15:20:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Is possible to schedule message delivery
Message-ID: <35a1eb3e-9aaa-400d-8b00-ba0f4cc1459f@k29g2000yqf.googlegroups.com>

Hi everyone,

Does anyone know if is possible to schedule time/delay of delivery
message in rabbitmq queue?

I have some producers which generate some tasks and put them into
queue. Task should be executed as soon as possible, but sometimes task
can not be finished (external reasons) - in that case I would like to
put task again into queue, any in any special way mark that this task
should be delivered not earlier then next hour. Is this possible?

From simone.busoli at gmail.com  Fri Sep 16 23:48:44 2011
From: simone.busoli at gmail.com (Simone Busoli)
Date: Sat, 17 Sep 2011 00:48:44 +0200
Subject: [rabbitmq-discuss] Is possible to schedule message delivery
In-Reply-To: <35a1eb3e-9aaa-400d-8b00-ba0f4cc1459f@k29g2000yqf.googlegroups.com>
References: <35a1eb3e-9aaa-400d-8b00-ba0f4cc1459f@k29g2000yqf.googlegroups.com>
Message-ID: <CAOn7oW8TSEN8D1iC_V+-Fyds3Kyict+nzT-0bpQ6T0FgGeYjOg@mail.gmail.com>

This has been answered today in another thread, it is not possible.
On Sep 17, 2011 12:38 AM, "serek" <stwarog at gmail.com> wrote:
> Hi everyone,
>
> Does anyone know if is possible to schedule time/delay of delivery
> message in rabbitmq queue?
>
> I have some producers which generate some tasks and put them into
> queue. Task should be executed as soon as possible, but sometimes task
> can not be finished (external reasons) - in that case I would like to
> put task again into queue, any in any special way mark that this task
> should be delivered not earlier then next hour. Is this possible?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110917/51f41150/attachment.htm>

From matthew at rabbitmq.com  Fri Sep 16 23:49:19 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Fri, 16 Sep 2011 23:49:19 +0100
Subject: [rabbitmq-discuss] Is possible to schedule message delivery
In-Reply-To: <35a1eb3e-9aaa-400d-8b00-ba0f4cc1459f@k29g2000yqf.googlegroups.com>
References: <35a1eb3e-9aaa-400d-8b00-ba0f4cc1459f@k29g2000yqf.googlegroups.com>
Message-ID: <20110916224918.GE4517@wellquite.org>

On Fri, Sep 16, 2011 at 03:20:01PM -0700, serek wrote:
> Does anyone know if is possible to schedule time/delay of delivery
> message in rabbitmq queue?

It is not.

> I have some producers which generate some tasks and put them into
> queue. Task should be executed as soon as possible, but sometimes task
> can not be finished (external reasons) - in that case I would like to
> put task again into queue, any in any special way mark that this task
> should be delivered not earlier then next hour. Is this possible?

No sorry, nothing like that at all.

Matthew

From acheremukhin.digitalguard at gmail.com  Sat Sep 17 08:38:41 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Sat, 17 Sep 2011 00:38:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Error: unable to connect to node
 'rabbit@localhost': nodedown.
In-Reply-To: <CAPbrmCuEybAvsLkG6sz8+y5GQkxZN2tJZLAdiH5X9wvdEvpN9g@mail.gmail.com>
References: <CAPbrmCuEybAvsLkG6sz8+y5GQkxZN2tJZLAdiH5X9wvdEvpN9g@mail.gmail.com>
Message-ID: <26997308.2724.1316245121984.JavaMail.geo-discussion-forums@yqaa12>

 Could you show as your rabbitmq.log?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110917/a275163e/attachment.htm>

From ask at rabbitmq.com  Sat Sep 17 10:31:09 2011
From: ask at rabbitmq.com (Ask Solem)
Date: Sat, 17 Sep 2011 10:31:09 +0100
Subject: [rabbitmq-discuss] I think I am getting bunch of garbage que's
	Is this right?
In-Reply-To: <b0a6938c-2762-47aa-9084-8414a4b76810@o16g2000yqj.googlegroups.com>
References: <b0a6938c-2762-47aa-9084-8414a4b76810@o16g2000yqj.googlegroups.com>
Message-ID: <D078D5D8-8BE3-4408-B477-1357AB642967@rabbitmq.com>


On 15 Sep 2011, at 17:21, Alex Kessinger wrote:

> Hi,
> Then it just keeps growing untill I think ampq runs out of memory, and
> crashes. Has anyone seen behavior like this? Does anyone know how I
> might be able to fix it.


Are you running the latest Celery version?

See the 2.3 change log:
http://docs.celeryproject.org/en/latest/changelog.html#important-notes


From dreyemi at gmail.com  Sat Sep 17 14:47:23 2011
From: dreyemi at gmail.com (Kayode Odeyemi)
Date: Sat, 17 Sep 2011 14:47:23 +0100
Subject: [rabbitmq-discuss] Error: unable to connect to node
 'rabbit@localhost': nodedown.
In-Reply-To: <26997308.2724.1316245121984.JavaMail.geo-discussion-forums@yqaa12>
References: <CAPbrmCuEybAvsLkG6sz8+y5GQkxZN2tJZLAdiH5X9wvdEvpN9g@mail.gmail.com>
	<26997308.2724.1316245121984.JavaMail.geo-discussion-forums@yqaa12>
Message-ID: <CAPbrmCutqPq-oJq8FqmEJi08v8w3cZzv8JpUXP0q5F+Vxf1OYA@mail.gmail.com>

On Sat, Sep 17, 2011 at 8:38 AM, Cheremukhin Andrey <
acheremukhin.digitalguard at gmail.com> wrote:

>  Could you show as your rabbitmq.log?
>

Below is the error stack:


=INFO REPORT==== 14-Sep-2011::18:42:41 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 14-Sep-2011::18:42:41 ===
Memory limit set to 815MB.

=INFO REPORT==== 14-Sep-2011::18:42:42 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 14-Sep-2011::18:42:42 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 14-Sep-2011::18:42:42 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 14-Sep-2011::18:42:42 ===
started TCP Listener on 0.0.0.0:5672

=ERROR REPORT==== 14-Sep-2011::19:35:19 ===
** Connection attempt from disallowed node 'rabbitmqctl28817 at coasthost-pc'
**

=WARNING REPORT==== 15-Sep-2011::09:10:19 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:21 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:21 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 15-Sep-2011::09:10:22 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:37 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:38 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:38 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:38 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:39 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:40 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:40 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:40 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:40 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:40 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:40 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:40 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:40 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:46 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:11:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:04 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:04 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::09:12:05 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:02 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:07 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:07 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:07 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:07 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:07 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:07 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:07 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:07 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:07 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:07 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 16-Sep-2011::17:51:08 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:51 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::10:34:55 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::11:24:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::11:24:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::11:24:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::11:24:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::11:24:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::11:24:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::11:24:52 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:46 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:47 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:47 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:47 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:47 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:47 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:47 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:47 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:47 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:47 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:47 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:47 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=WARNING REPORT==== 17-Sep-2011::14:13:47 ===
Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
{dump_log,

time_threshold}

=INFO REPORT==== 17-Sep-2011::14:31:06 ===
stopped TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 17-Sep-2011::14:31:11 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 17-Sep-2011::14:31:11 ===
    application: os_mon
    exited: stopped
    type: permanent

=INFO REPORT==== 17-Sep-2011::14:31:12 ===
    application: mnesia
    exited: stopped
    type: permanent




-- 
Odeyemi 'Kayode O.
http://www.sinati.com. t: @charyorde
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110917/0438b163/attachment.htm>

From matthias at rabbitmq.com  Sat Sep 17 15:10:39 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 17 Sep 2011 15:10:39 +0100
Subject: [rabbitmq-discuss] Error: unable to connect to node
 'rabbit@localhost': nodedown.
In-Reply-To: <CAPbrmCutqPq-oJq8FqmEJi08v8w3cZzv8JpUXP0q5F+Vxf1OYA@mail.gmail.com>
References: <CAPbrmCuEybAvsLkG6sz8+y5GQkxZN2tJZLAdiH5X9wvdEvpN9g@mail.gmail.com>	<26997308.2724.1316245121984.JavaMail.geo-discussion-forums@yqaa12>
	<CAPbrmCutqPq-oJq8FqmEJi08v8w3cZzv8JpUXP0q5F+Vxf1OYA@mail.gmail.com>
Message-ID: <4E74AA5F.5050403@rabbitmq.com>

On 17/09/11 14:47, Kayode Odeyemi wrote:
> =ERROR REPORT==== 14-Sep-2011::19:35:19 ===
> ** Connection attempt from disallowed node
> 'rabbitmqctl28817 at coasthost-pc' **

That looks like an Erlang cookie mismatch problem.

Did you follow the instructions at 
http://www.rabbitmq.com/man/rabbitmq-service.man.html
<quote>
By default the service will run in the authentication context of the 
local system account. It is therefore necessary to synchronise Erlang 
cookies between the local system account (typically 
C:\WINDOWS\.erlang.cookie and the account that will be used to run 
rabbitmqctl.
</quote>
?

rabbitmqctl outputs some debug information when it fails to connect to 
the server. It is usually instructive to inspect that and compare it 
against the information logged by the broker on startup to its console 
log (see the aforementioned man page for locating that).

As for...

> =WARNING REPORT==== 15-Sep-2011::09:10:19 ===
> Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
> {dump_log, time_threshold}

These warnings are generally harmless though they might suggest that 
your application is perhaps doing something weird, like creating and 
destroying a queue for every message.


Regards,

Matthias.

From dreyemi at gmail.com  Sat Sep 17 15:33:38 2011
From: dreyemi at gmail.com (Kayode Odeyemi)
Date: Sat, 17 Sep 2011 15:33:38 +0100
Subject: [rabbitmq-discuss] Error: unable to connect to node
 'rabbit@localhost': nodedown.
In-Reply-To: <4E74AA5F.5050403@rabbitmq.com>
References: <CAPbrmCuEybAvsLkG6sz8+y5GQkxZN2tJZLAdiH5X9wvdEvpN9g@mail.gmail.com>
	<26997308.2724.1316245121984.JavaMail.geo-discussion-forums@yqaa12>
	<CAPbrmCutqPq-oJq8FqmEJi08v8w3cZzv8JpUXP0q5F+Vxf1OYA@mail.gmail.com>
	<4E74AA5F.5050403@rabbitmq.com>
Message-ID: <CAPbrmCtpJpMFPAyhtY3y_ZhbV-b+gT721Kzs-kuw35AX5uyb-g@mail.gmail.com>

On Sat, Sep 17, 2011 at 3:10 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 17/09/11 14:47, Kayode Odeyemi wrote:
>
>> =ERROR REPORT==== 14-Sep-2011::19:35:19 ===
>> ** Connection attempt from disallowed node
>> 'rabbitmqctl28817 at coasthost-pc**' **
>>
>
> That looks like an Erlang cookie mismatch problem.
>
> Did you follow the instructions at http://www.rabbitmq.com/man/**
> rabbitmq-service.man.html<http://www.rabbitmq.com/man/rabbitmq-service.man.html>
> <quote>
> By default the service will run in the authentication context of the local
> system account. It is therefore necessary to synchronise Erlang cookies
> between the local system account (typically C:\WINDOWS\.erlang.cookie and
> the account that will be used to run rabbitmqctl.
> </quote>
> ?
>

How do I synchronize the accounts? I am using the same account I used to
install Erlang to setup rabbitmq. Does this statement mean changing
rabbit at localhost to [local-system-account]@localhost when starting rabbitmq
with rabbitmqctl -n [account]@localhost start_app?

I checked Erlang cookie at C:\WINDOWS\.erlang.cookie and the one generated
by broker on startup. They are different. How do I synchronize them? There's
another .erlang.cookie at C:\Documents and Settings\<username>. What should
I do? Which one is the broker using when I start rabbitmq from services.msc?

>
> rabbitmqctl outputs some debug information when it fails to connect to the
> server. It is usually instructive to inspect that and compare it against the
> information logged by the broker on startup to its console log (see the
> aforementioned man page for locating that).
>

I did compare both information, and I try to start the broker with command:


rabbitmqctl -n rabbitmqctl15051 at coasthost-pc start_app

This doesn't seem to work either.

>
> As for...
>
>
>  =WARNING REPORT==== 15-Sep-2011::09:10:19 ===
>> Mnesia('rabbit at COASTHOST-PC'): ** WARNING ** Mnesia is overloaded:
>> {dump_log, time_threshold}
>>
>
> These warnings are generally harmless though they might suggest that your
> application is perhaps doing something weird, like creating and destroying a
> queue for every message.
>
>
> Regards,
>
> Matthias.
>



-- 
Odeyemi 'Kayode O.
http://www.sinati.com. t: @charyorde
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110917/4531ef54/attachment.htm>

From matthias at rabbitmq.com  Sat Sep 17 15:39:37 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 17 Sep 2011 15:39:37 +0100
Subject: [rabbitmq-discuss] Error: unable to connect to node
 'rabbit@localhost': nodedown.
In-Reply-To: <CAPbrmCtpJpMFPAyhtY3y_ZhbV-b+gT721Kzs-kuw35AX5uyb-g@mail.gmail.com>
References: <CAPbrmCuEybAvsLkG6sz8+y5GQkxZN2tJZLAdiH5X9wvdEvpN9g@mail.gmail.com>
	<26997308.2724.1316245121984.JavaMail.geo-discussion-forums@yqaa12>
	<CAPbrmCutqPq-oJq8FqmEJi08v8w3cZzv8JpUXP0q5F+Vxf1OYA@mail.gmail.com>
	<4E74AA5F.5050403@rabbitmq.com>
	<CAPbrmCtpJpMFPAyhtY3y_ZhbV-b+gT721Kzs-kuw35AX5uyb-g@mail.gmail.com>
Message-ID: <4E74B129.9020009@rabbitmq.com>

On 17/09/11 15:33, Kayode Odeyemi wrote:
> I checked Erlang cookie at C:\WINDOWS\.erlang.cookie and the one
> generated by broker on startup. They are different. How do I synchronize
> them? There's another .erlang.cookie at C:\Documents and
> Settings\<username>. What should I do?

Pick one of the cookie files and copy it over all the others. Then 
re-install and restart the service.

> I did compare both information, and I try to start the broker with command:
>
> rabbitmqctl -n rabbitmqctl15051 at coasthost-pc start_app
>
> This doesn't seem to work either.

The broker is started by the service, or manually with 
rabbitmq-server.bat; rabbitmqctl cannot start the broker.


Regards,

Matthias.

From dreyemi at gmail.com  Sat Sep 17 15:55:47 2011
From: dreyemi at gmail.com (Kayode Odeyemi)
Date: Sat, 17 Sep 2011 15:55:47 +0100
Subject: [rabbitmq-discuss] Error: unable to connect to node
 'rabbit@localhost': nodedown.
In-Reply-To: <4E74B129.9020009@rabbitmq.com>
References: <CAPbrmCuEybAvsLkG6sz8+y5GQkxZN2tJZLAdiH5X9wvdEvpN9g@mail.gmail.com>
	<26997308.2724.1316245121984.JavaMail.geo-discussion-forums@yqaa12>
	<CAPbrmCutqPq-oJq8FqmEJi08v8w3cZzv8JpUXP0q5F+Vxf1OYA@mail.gmail.com>
	<4E74AA5F.5050403@rabbitmq.com>
	<CAPbrmCtpJpMFPAyhtY3y_ZhbV-b+gT721Kzs-kuw35AX5uyb-g@mail.gmail.com>
	<4E74B129.9020009@rabbitmq.com>
Message-ID: <CAPbrmCvALpjgKmA=DouyhExR3NB=XSLj5LbU7fq+89Zx26aWMw@mail.gmail.com>

On Sat, Sep 17, 2011 at 3:39 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 17/09/11 15:33, Kayode Odeyemi wrote:
>
>> I checked Erlang cookie at C:\WINDOWS\.erlang.cookie and the one
>> generated by broker on startup. They are different. How do I synchronize
>> them? There's another .erlang.cookie at C:\Documents and
>> Settings\<username>. What should I do?
>>
>
> Pick one of the cookie files and copy it over all the others. Then
> re-install and restart the service.


Thank you very much. The node starts successfully.

>
>
>  I did compare both information, and I try to start the broker with
>> command:
>>
>> rabbitmqctl -n rabbitmqctl15051 at coasthost-pc start_app
>>
>> This doesn't seem to work either.
>>
>
> The broker is started by the service, or manually with rabbitmq-server.bat;
> rabbitmqctl cannot start the broker.
>
>
> Regards,
>
> Matthias.
>



-- 
Odeyemi 'Kayode O.
http://www.sinati.com. t: @charyorde
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110917/37bd55ce/attachment.htm>

From voidfiles at gmail.com  Sat Sep 17 19:30:55 2011
From: voidfiles at gmail.com (alex kessinger)
Date: Sat, 17 Sep 2011 11:30:55 -0700
Subject: [rabbitmq-discuss] I think I am getting bunch of garbage que's
 Is this right?
In-Reply-To: <D078D5D8-8BE3-4408-B477-1357AB642967@rabbitmq.com>
References: <b0a6938c-2762-47aa-9084-8414a4b76810@o16g2000yqj.googlegroups.com>
	<D078D5D8-8BE3-4408-B477-1357AB642967@rabbitmq.com>
Message-ID: <CAJ2eaf9x67t_9LHhTE2+_y7OKapOo0=z0OZL-my24nGCSebObg@mail.gmail.com>

I just wanted to let the list know what I found out.

Michael pointed out to me that celery stores it's results in rabbitmq
by default. Something I did not know. I first tried to change the
result store, but really what I think I want to use is
CELERY_IGNORE_RESULT. I am keeping track of my job results in my own
way.

Then Ask pointed out that this all has changed in the latest, which I
am not running, but will promptly upgrade.

Thank You.


On Sat, Sep 17, 2011 at 2:31 AM, Ask Solem <ask at rabbitmq.com> wrote:
>
> On 15 Sep 2011, at 17:21, Alex Kessinger wrote:
>
>> Hi,
>> Then it just keeps growing untill I think ampq runs out of memory, and
>> crashes. Has anyone seen behavior like this? Does anyone know how I
>> might be able to fix it.
>
>
> Are you running the latest Celery version?
>
> See the 2.3 change log:
> http://docs.celeryproject.org/en/latest/changelog.html#important-notes
>
>

From gmr at myyearbook.com  Sun Sep 18 02:41:19 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sat, 17 Sep 2011 21:41:19 -0400
Subject: [rabbitmq-discuss] Mochiweb MAX_RECV_BODY and JSON_RPC plugin
In-Reply-To: <4E521B6E.8060103@rabbitmq.com>
References: <3ACD8673BEFF41AFB95B660FFA683968@myyearbook.com>
	<4E521B6E.8060103@rabbitmq.com>
Message-ID: <655DF0084CC341709AD2765CCA29DC3B@myyearbook.com>

Thanks for the instructions. Please find the patch to mochiweb-wrapper patching the MAX_RECV_BODY to 100MB from 1MB.

Regards,

Gavin 


On Monday, August 22, 2011 at 5:03 AM, Simon MacMullen wrote:

> On 19/08/11 21:20, Gavin M. Roy wrote:
> > Ran into an unintended snag with JSON Channel RPC with regard to a
> > mochiweb limitation.
> > 
> > Mochiweb has a hardcoded constant for the maximum body size for a
> > request at 1MB:
> > 
> > https://github.com/mochi/mochiweb/blob/master/src/mochiweb_request.erl#L47
> > 
> > This is a problem when you're trying to POST messages that are larger
> > than 1MB.
> > 
> > The fix is relatively easy, but I wanted to find out if there was any
> > patching of mochiweb prior to making the mochiweb.ez (http://web.ez) file or is the file
> > just provided for convenience and providing a tagged supported version.
> > That is, if I recompile it with the # I want, can I just go from the
> > vanilla mochiweb repo?
> 
> We patch mochiweb a bit, to make it build on older versions of Erlang, 
> and to remove its dependency on the "crypto" application. I guess you 
> could live without these, but more importantly we also use a specific 
> version (basically what was the latest version at the point I started 
> writing rabbitmq-management) and haven't tested with newer versions.
> 
> If I were you I would add your patch to our set and build with our 
> wrapper. To do this, check out rabbitmq-public-umbrella, then check out 
> the mochiweb-wrapper repository within it:
> 
> http://hg.rabbitmq.com/mochiweb-wrapper/
> 
> (or run "make checkout" which will check out everything including 
> mochiweb-wrapper)
> 
> Then within mochiweb-wrapper add your patch, and add it to 
> WRAPPER_PATCHES in package.mk, then "make dist".
> 
> Alternatively you could build it yourself but I would try to use the 
> same version as we do - 9a53dbd7b2c52eb5b9d4 in the mochiweb git repo.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110917/19c25aba/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mochiweb-wrapper.patch
Type: application/octet-stream
Size: 985 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110917/19c25aba/attachment.obj>

From steve at rabbitmq.com  Sun Sep 18 13:56:52 2011
From: steve at rabbitmq.com (Steve Powell)
Date: Sun, 18 Sep 2011 13:56:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ and Stomp topic behavior
In-Reply-To: <0696B38D-D170-4D4A-B878-CB6C809E8782@rabbitmq.com>
References: <CAMOXM28j7MMaPtrCyFLsdS1p4-RbbBgp8zH27dvcvmSEXV1RKA@mail.gmail.com>
	<CAMOXM2-vt7fVArCVN_p_1Lmn8e+ubR+d3S2KFu9M=9Jy8FZRxA@mail.gmail.com>
	<4E3FFB77.5060903@rabbitmq.com>
	<CAMOXM28hGfczSAUH5ELmhYzaZ0QfQe3T_1D-Ju5Hmaf-Zmef3w@mail.gmail.com>
	<4E3FFF5B.5060105@rabbitmq.com> <4E400405.8000001@rabbitmq.com>
	<CAMOXM29=Svs6JM+m+t45cKoQUimy=2KL75=heW9zJFt_0RXPHw@mail.gmail.com>
	<4E40EAFF.1010804@rabbitmq.com>
	<CAMOXM2_2XbwMr5ajyVHvhwkoEuK1hWWHE9jLz+Wf7VhOuF17ZQ@mail.gmail.com>
	<4E40F2C5.2000603@rabbitmq.com>
	<CAMOXM296Yq5gKQsbNbkRmF_=1oprjwDzHqMUYLD5fFhr+b-P_Q@mail.gmail.com>
	<F33050DA-8EFB-42D4-BD6A-6C3DAF28A2D8@rabbitmq.com>
	<CAMOXM2_zpCceQReE86an94S55ai9Bi5mSus6XSmwsEK56gN2rQ@mail.gmail.com>
	<E3F75AFD-887F-488A-BC14-73F30AC2E018@rabbitmq.com>
	<35FF4D48-7F7A-42CE-8C08-BE814058ACA9@rabbitmq.com>
	<0696B38D-D170-4D4A-B878-CB6C809E8782@rabbitmq.com>
Message-ID: <0EDF155E-7730-4C81-880C-1C1FBB6EBAD3@rabbitmq.com>

Massimo,
After quite a  time of trials and tribulations I have found a bug 
in the RabbitMQ STOMP adapter which appears to cause 
crashes under high message load.
    The bug is related to the (rather primitive) throttling which 
kicks in when reaching the memory limit.

After fixing this, I have successfully run your testcase, and 
RabbitMQ STOMP does manage to survive during the throwing 
away of large numbers of unsubscribed topic SENDs. I had to 
make one alteration to the configuration in order to get the test 
to stay up. I set the vm_high_watermark to 0.2 (instead of the 
default of 0.4).

This setting determines the proportion of available memory 
above which the 'memory-alarm' is triggered. The reader 
process in RabbitMQ-STOMP will then block processing 
further bytes from clients, until the memory alarm is switched 
off.  Because message processing is proceeding at a very 
high rate (that is why memory is being used up), the 
input-queues for Erlang processes are likely to be large, 
and so even blocking input will not result in a lowering of 
memory consumption -- memory requirements increase in 
the pipeline flow -- and so the actual memory consumed is 
likely to reach 0.6/0.7 of available memory (found by observation).  
This is why setting it to 0.4 (the default) doesn't work.  Memory 
for Erlang can then be completely exhausted, resulting in 
crashes (which normally result in long pauses and large 
amounts of dump-data written to disk). Any recovery after 
that is likely not to succeed for very long, since the pause 
allows time for more requests to be put in. (The benchmark 
test runs with non-blocking io; I'm not sure what that means, 
but if it means that requests will be put in even if the socket 
blocks then this is going to increase the load during the 
pauses.)

As I say, setting it to 0.2 worked, and I suspect that 0.3 would 
still work.

However,...

The test doesn't really tell us much.  This is a poor benchmark, 
because it consists of a single producer sending a 20-byte 
message to a topic to which no-one is currently subscribed.  
This is therefore a measure of how fast a broker can throw 
away messages.  RabbitMQ does reasonably well here, but 
cannot determine that there are no subscribers until it reaches 
the actual rabbit exchange, so it goes through AMQP 
processing.  In general, especially in the presence of potential 
durable topic subscriptions, it is hard to see how to fix this -- 
though if it were a common scenario perhaps some sort of 
status of the broker subscription space could be cached near 
to the client, allowing us to throw away messages close to 
the client: but then we need to update the cache when 
(remote) subscribers come on line, or risk throwing away 
messages in error.  This is very complex, and only for a gain 
in a low probability use-case.

I notice that the benchmark test runs for a very long time 
(hours on my little 2Gb 2Core Linux VM) and produces a noisy 
graph as result (there are lots of zeros in it because RabbitMQ 
blocks reads quite often). The graph doesn't help us to guess 
at an average rate.  I attach the benchmark json output, so 
you can view it with generic_report, or something.

The bug fix is rabbit bugzilla 24426, which after QA will 
probably go into the next release.

Thanks for spotting this,

Steve Powell
steve at rabbitmq.com
[wrk: +44-2380-111-528] [mob: +44-7815-838-558]


Previously:
>>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014555.html
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110918/b99c1f02/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq-2.6.1-hwm-0.2.json
Type: application/octet-stream
Size: 567890 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110918/b99c1f02/attachment.obj>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110918/b99c1f02/attachment-0001.htm>

From toby.corkindale at strategicdata.com.au  Mon Sep 19 02:33:27 2011
From: toby.corkindale at strategicdata.com.au (Toby Corkindale)
Date: Mon, 19 Sep 2011 11:33:27 +1000
Subject: [rabbitmq-discuss] Unicode handling changed between 2.5.1 and
 2.6.1?
In-Reply-To: <CABzX+qy_N0vGZNmOBRPbqdjzpt0B1EyMAiRHr8k3UkP59FJp9g@mail.gmail.com>
References: <4E72F8CE.10103@strategicdata.com.au>	<4E72FB67.1050604@strategicdata.com.au>
	<CABzX+qy_N0vGZNmOBRPbqdjzpt0B1EyMAiRHr8k3UkP59FJp9g@mail.gmail.com>
Message-ID: <4E769BE7.5090801@strategicdata.com.au>

On 16/09/11 19:28, Marek Majkowski wrote:
> On Fri, Sep 16, 2011 at 08:31, Toby Corkindale
> <toby.corkindale at strategicdata.com.au>  wrote:
>> On 16/09/11 17:20, Toby Corkindale wrote:
>>>
>>> Hi,
>>> I upgraded from RabbitMQ + STOMP plugin, from version 2.5.1 to 2.6.1.
>>>
>>> Now I am seeing a bunch of double-encoding of unicode characters.
>>>
>>> I wondered if there have been any changes to RabbitMQ or the STOMP
>>> plugin between those versions that could have caused this?
>>>
>>> (It's possible it's coming from somewhere else, but I didn't change much
>>> else here..)
>>
>> I found a place in my code where I was doing UTF8 conversion, and after
>> removing that, I'm not getting double-encoded UTF8 any more. However the
>> code definitely used to require it.
>>
>> I guess something relating to unicode was fixed in the stomp or rabbit
>> layer?
>
> See this discussion:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-August/014412.html
>
> AFAIR nothing substantial was changed, only the fact that we don't
> add content-type by default.
>
> Is it possible that this is what you see?

Hmm.. I am using Lionel's Net::STOMP::Client module. The version of it 
hasn't changed, but I wonder if it uses the STOMP header to determine 
how to decode the message to/from utf8 automatically? If so, maybe it 
used to be en/decoding it, but is now treating it as binary.. although 
the actual behaviour seems to be opposite to that.

The module's documentation doesn't mention anything about Unicode. I'll 
cc: the author and ask him.

Lionel, hope you don't mind answering - what's the best-practice way to 
send UTF8 characters in the body of FRAMEs via your module - convert the 
unicode strings to byte streams and send it as a binary frame, or leave 
it as a perl unicode string, and set a content-type header to match?

Cheers,
Toby

From lionel.cons at cern.ch  Mon Sep 19 06:42:31 2011
From: lionel.cons at cern.ch (Lionel Cons)
Date: Mon, 19 Sep 2011 07:42:31 +0200
Subject: [rabbitmq-discuss] Unicode handling changed between 2.5.1 and
	2.6.1?
In-Reply-To: <4E769BE7.5090801@strategicdata.com.au>
References: <4E72F8CE.10103@strategicdata.com.au>
	<4E72FB67.1050604@strategicdata.com.au>
	<CABzX+qy_N0vGZNmOBRPbqdjzpt0B1EyMAiRHr8k3UkP59FJp9g@mail.gmail.com>
	<4E769BE7.5090801@strategicdata.com.au>
Message-ID: <20086.54855.412940.652451@mail.cern.ch>

Toby Corkindale writes:
 > Hmm.. I am using Lionel's Net::STOMP::Client module. The version of it 
 > hasn't changed, but I wonder if it uses the STOMP header to determine 
 > how to decode the message to/from utf8 automatically?

Net::STOMP::Client fully implements the STOMP 1.1 spec and does use
the content-type header to find out if the message body needs decoding
or not. See http://search.cpan.org/dist/Net-STOMP-Client/lib/Net/STOMP/Client/Frame.pm#ENCODING

 > Lionel, hope you don't mind answering - what's the best-practice way to 
 > send UTF8 characters in the body of FRAMEs via your module - convert the 
 > unicode strings to byte streams and send it as a binary frame, or leave 
 > it as a perl unicode string, and set a content-type header to match?

Provided that you interact with a STOMP 1.1 server (RabbitMQ is one
AFAIK) and that the receiving client speaks STOMP 1.1 too, both
methods should work equally well. I would recommend to use the
content-type header because it's less work for you and the receiver
will get information about how to use the message.

Cheers,

Lionel

From phenisha at gmail.com  Mon Sep 19 07:10:38 2011
From: phenisha at gmail.com (Nathan)
Date: Mon, 19 Sep 2011 16:10:38 +1000
Subject: [rabbitmq-discuss] ldap authentication
Message-ID: <4E76DCDE.2060704@gmail.com>


Hello,

I am experimenting with rabbitmq and ldap authentication plugin.

Below is my current /etc/rabbitmq/rabbitmq.config:

What I am trying to achieve is that users in ldap group zozee can 
publish and subscribe
to queues.

[
  {rabbitmq_stomp, [{tcp_listeners, [6163]} ]},
  {rabbit, [{auth_backends, [rabbit_auth_backend_ldap]}]  },
  {rabbit_auth_backend_ldap,
   [ {servers,               ["ldap.zozee.com"]},
     {user_dn_pattern,       "uid=${username},ou=people,dc=zozee,dc=com"},
     {vhost_access_query,    
{exists,"ou=${vhost},ou=people,dc=zozee,dc=com"}},
     {resource_access_query,
       {for, [{resource, exchange,{for, [{permission, configure,
                                          { in_group, 
"cn=zozee,ou=groups,dc=zozee,dc=com" }
                                         },
                                         {permission, write, {constant, 
true}},
                                         {permission, read,  {constant, 
true}}
                                        ]}},
              {resource, queue, {constant, true}} ]}},
       {tag_queries,           [{administrator, {constant, false}}]},
       {use_ssl,               true},
       {port,                  636},
       {log,                   false} ] }
].



when I try to publish work with a queue i get the following
errors

=ERROR REPORT==== 19-Sep-2011::15:54:21 ===
exception on TCP connection <0.362.0> from 172.16.0.51:37261
{channel0_error,starting,
                 {amqp_error,access_refused,
                             "PLAIN login refused: 
cn=guest,ou=People,dc=example,dc=com",
                             'connection.start_ok'}}

so it looks like rabbitmq is not reading my config file correctly as is 
looking at example.com in ldap??

any help will be appreciated

Thanks
Nathan

also below is my rabbitmqctl command
copernicium:~# rabbitmqctl  report
Reporting server status on {{2011,9,19},{6,7,46}}

Status of node rabbit at copernicium ...
[{pid,2316},
  {running_applications,
      [{amqp_client,"RabbitMQ AMQP Client","2.6.1"},
       {rabbitmq_stomp,"Embedded Rabbit Stomp Adapter","2.6.1"},
       {rabbit,"RabbitMQ","2.6.1"},
       {mnesia,"MNESIA  CXC 138 12","4.4.19"},
       {os_mon,"CPO  CXC 138 46","2.2.6"},
       {sasl,"SASL  CXC 138 11","2.1.9.4"},
       {rabbitmq_auth_backend_ldap,"RabbitMQ LDAP Authentication Backend",
           "2.6.1"},
       {eldap,"LDAP Client Library","2.6.1-gite309de4"},
       {stdlib,"ERTS  CXC 138 10","1.17.4"},
       {kernel,"ERTS  CXC 138 10","2.14.4"}]},
  {os,{unix,linux}},
  {erlang_version,
      "Erlang R14B03 (erts-5.8.4) [source] [64-bit] [smp:16:16] [rq:16] 
[async-threads:30] [kernel-poll:true]\n"},
  {memory,
      [{total,26838928},
       {processes,10152320},
       {processes_used,10139488},
       {system,16686608},
       {atom,1200153},
       {atom_used,1177465},
       {binary,74616},
       {code,11876398},
       {ets,821120}]}]

Cluster status of node rabbit at copernicium ...
[{nodes,[{disc,[rabbit at copernicium]}]},{running_nodes,[rabbit at copernicium]}]

Application environment of node rabbit at copernicium ...
[{auth_backends,[rabbit_auth_backend_ldap]},
  {auth_mechanisms,['PLAIN','AMQPLAIN']},
  {backing_queue_module,rabbit_variable_queue},
  {cluster_nodes,[]},
  {collect_statistics,none},
  {collect_statistics_interval,5000},
  {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
  {default_user,<<"guest">>},
  {default_user_tags,[administrator]},
  {default_vhost,<<"/">>},
  {delegate_count,16},
  {frame_max,131072},
  {included_applications,[]},
  {msg_store_file_size_limit,16777216},
  {msg_store_index_module,rabbit_msg_store_ets_index},
  {queue_index_max_journal_entries,262144},
  {server_properties,[]},
  {ssl_listeners,[]},
  {ssl_options,[]},
  {tcp_listen_options,[binary,
                       {packet,raw},
                       {reuseaddr,true},
                       {backlog,128},
                       {nodelay,true},
                       {exit_on_close,false}]},
  {tcp_listeners,[5672]},
  {trace_vhosts,[]},
  {vm_memory_high_watermark,0.4}]

Connections:

Channels:

Queues on /:

Exchanges on /:
name    type    durable    auto_delete    internal    arguments
amq.direct    direct    true    false    false    []
amq.topic    topic    true    false    false    []
amq.rabbitmq.trace    topic    true    false    false    []
amq.rabbitmq.log    topic    true    false    false    []
amq.fanout    fanout    true    false    false    []
amq.headers    headers    true    false    false    []
     direct    true    false    false    []
amq.match    headers    true    false    false    []

Bindings on /:

Consumers on /:

Permissions on /:
user    configure    write    read
mcollective    ^amq.gen-.*    .*    .*
testguy    .*    .*    .*

End of server status report
...done.
copernicium:~#


From matthias at rabbitmq.com  Mon Sep 19 08:49:04 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 19 Sep 2011 08:49:04 +0100
Subject: [rabbitmq-discuss] ldap authentication
In-Reply-To: <4E76DCDE.2060704@gmail.com>
References: <4E76DCDE.2060704@gmail.com>
Message-ID: <4E76F3F0.9070800@rabbitmq.com>

Nathan,

On 19/09/11 07:10, Nathan wrote:

> [
> {rabbitmq_stomp, [{tcp_listeners, [6163]} ]},
> {rabbit, [{auth_backends, [rabbit_auth_backend_ldap]}] },
> {rabbit_auth_backend_ldap,
> [ {servers, ["ldap.zozee.com"]}, ...

The docs are wrong. The second 'rabbit_auth_backend_ldap' should be 
'rabbitmq_auth_backend_ldap' instead.

Matthias.

From alexandru at rabbitmq.com  Mon Sep 19 10:10:15 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 19 Sep 2011 10:10:15 +0100
Subject: [rabbitmq-discuss] rabbitmq cluster using IP
In-Reply-To: <SNT103-DS151E5D80C1999D854BB52280060@phx.gbl>
References: <SNT103-DS135D0182FAABEAD9A04D7180060@phx.gbl>
	<20110916094904.GA3289@southbank.eng.vmware.com>
	<SNT103-DS151E5D80C1999D854BB52280060@phx.gbl>
Message-ID: <20110919091015.GA4987@southbank.eng.vmware.com>

Hi Bob,

Trying the solution mentioned later in that thread still seems to work.
So, to use IP addresses instead of just hostnames, replace the following
line in rabbitmq-server (it's almost at the bottom of the file)
      -sname ${RABBITMQ_NODENAME} \
with
      -name ${RABBITMQ_NODENAME} \

Then, do the same thing (replace "sname" with "name") in rabbitmqctl.
That's assuming you use Linux.  If you use Windows, you'll need to make
the changes in rabbitmq-server.bat, rabbitmq-service.bat and
rabbitmqctl.bat.

Hope this helps.

Cheers,
Alex


On Fri, Sep 16, 2011 at 12:51:50PM +0200, Bob Claerhout wrote:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-December/005644.ht
> ml
> 
> Your solution is not sufficient enough. I prefer not to use any hostnames
> because this is less reliable. In fact, I don't want to use DNS.
> IP is faster and several other functionalities (within my system, e.g.
> creating and booting new VMs automatically) already use IP for
> communication.
> 
> Kind regards,
> 
> Bob
> 
> -----Original Message-----
> From: Alexandru Scvor?ov [mailto:scvalex at gmail.com] On Behalf Of Alexandru
> Scvortov
> Sent: vrijdag 16 september 2011 11:49
> To: Bob Claerhout
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] rabbitmq cluster using IP
> 
> Hi,
> 
> > I found a solution to do this but at the end of the discussion it says 
> > that this will be included in the next stable release.
> 
> Link?
> 
> > Since this stable release is already there, it should work.
> > However, this does not work here.
> 
> The normal way of doing this is to add the IPs to your hosts file (or to
> make the hostnames resolve to the IPs somehow: there are a bunch of
> easy-to-configure lightweight DNS servers available).
> 
> Cheers,
> Alex
> 
> 
> On Fri, Sep 16, 2011 at 11:31:17AM +0200, Bob Claerhout wrote:
> > Hi all,
> > 
> >  
> > 
> > I want to use the cluster using IP instead of a hostname.
> > 
> > I found a solution to do this but at the end of the discussion it says 
> > that this will be included in the next stable release.
> > 
> > Since this stable release is already there, it should work.
> > 
> > However, this does not work here.
> > 
> > Any suggestions?
> > 
> >  
> > 
> > Kind regards
> > 
> > Bob Claerhout
> > 
> >  
> > 
> >  
> > 
> >  
> > 
> 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From sameek at arosys.com  Mon Sep 19 10:13:59 2011
From: sameek at arosys.com (sam_mis)
Date: Mon, 19 Sep 2011 02:13:59 -0700 (PDT)
Subject: [rabbitmq-discuss] how to set the message properties in rabbitmq
 2.6.1?
Message-ID: <32493503.post@talk.nabble.com>


Hi

I am using Rabbitmq server 2.6.1.i want to know,how to set message
properties in 2.6.1 using java client lib.

Thanks
-- 
View this message in context: http://old.nabble.com/how-to-set-the-message-properties-in-rabbitmq-2.6.1--tp32493503p32493503.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Mon Sep 19 10:36:44 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 19 Sep 2011 10:36:44 +0100
Subject: [rabbitmq-discuss] how to set the message properties in
 rabbitmq 2.6.1?
In-Reply-To: <32493503.post@talk.nabble.com>
References: <32493503.post@talk.nabble.com>
Message-ID: <4E770D2C.2040505@rabbitmq.com>

Hi,

On 19/09/11 10:13, sam_mis wrote:
> Hi
> 
> I am using Rabbitmq server 2.6.1.i want to know,how to set message
> properties in 2.6.1 using java client lib.

There are a number of convenient pre-configured properties in
com.rabbitmq.client.MessageProperties:

 MINIMAL_BASIC
 MINIMAL_PERSISTENT_BASIC
 BASIC
 PERSISTENT_BASIC
 TEXT_PLAIN
 PERSISTENT_TEXT_PLAIN

Use any of these, or create your own from
com.rabbitmq.client.BasicProperties() and pass it as a parameter to
basicPublish().


-Emile

From agrawal.shilpi95 at gmail.com  Mon Sep 19 11:01:38 2011
From: agrawal.shilpi95 at gmail.com (shilpi agrawal)
Date: Mon, 19 Sep 2011 15:31:38 +0530
Subject: [rabbitmq-discuss] Unsubscribe this mailing List <EOM>
Message-ID: <CABgWWWHkiZpCSciKwhgGKT2AWhtDdmSK8XfEUYH1CSmd4SxtPg@mail.gmail.com>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110919/5fac4187/attachment.htm>

From alexandru at rabbitmq.com  Mon Sep 19 11:07:56 2011
From: alexandru at rabbitmq.com (Alexandru Scvortov)
Date: Mon, 19 Sep 2011 11:07:56 +0100
Subject: [rabbitmq-discuss] rabbitmq cluster using IP
In-Reply-To: <20110919091015.GA4987@southbank.eng.vmware.com>
References: <SNT103-DS135D0182FAABEAD9A04D7180060@phx.gbl>
	<20110916094904.GA3289@southbank.eng.vmware.com>
	<SNT103-DS151E5D80C1999D854BB52280060@phx.gbl>
	<20110919091015.GA4987@southbank.eng.vmware.com>
Message-ID: <20110919100755.GA5158@southbank.eng.vmware.com>

Problems with doing that:
  - you have to use an IP address; using a hostname with those changes
    doesn't seem to work anymore;
  - you have to figure out the IPs of the nodes;
  - you can't easily *change* the IP of any of the nodes (because the
    database is bound to a particular nodename, so if you start rabbit
    as rabbit at 192.168.0.1 and then as rabbit at 192.168.0.2 on the same
    machine, the second time, rabbit will start from scratch with a
    new database).

So, that's not a good solution at all.  Right now, you can't really use
IPs to refer to nodes.  We've got a bug open for that, but nobody's
working on it, so it's unlikely to get fixed soon.

Sorry.

Cheers,
Alex

On Mon, Sep 19, 2011 at 10:10:15AM +0100, Alexandru Scvor?ov wrote:
> Hi Bob,
> 
> Trying the solution mentioned later in that thread still seems to work.
> So, to use IP addresses instead of just hostnames, replace the following
> line in rabbitmq-server (it's almost at the bottom of the file)
>       -sname ${RABBITMQ_NODENAME} \
> with
>       -name ${RABBITMQ_NODENAME} \
> 
> Then, do the same thing (replace "sname" with "name") in rabbitmqctl.
> That's assuming you use Linux.  If you use Windows, you'll need to make
> the changes in rabbitmq-server.bat, rabbitmq-service.bat and
> rabbitmqctl.bat.
> 
> Hope this helps.
> 
> Cheers,
> Alex
> 
> 
> On Fri, Sep 16, 2011 at 12:51:50PM +0200, Bob Claerhout wrote:
> > http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-December/005644.ht
> > ml
> > 
> > Your solution is not sufficient enough. I prefer not to use any hostnames
> > because this is less reliable. In fact, I don't want to use DNS.
> > IP is faster and several other functionalities (within my system, e.g.
> > creating and booting new VMs automatically) already use IP for
> > communication.
> > 
> > Kind regards,
> > 
> > Bob
> > 
> > -----Original Message-----
> > From: Alexandru Scvor?ov [mailto:scvalex at gmail.com] On Behalf Of Alexandru
> > Scvortov
> > Sent: vrijdag 16 september 2011 11:49
> > To: Bob Claerhout
> > Cc: rabbitmq-discuss at lists.rabbitmq.com
> > Subject: Re: [rabbitmq-discuss] rabbitmq cluster using IP
> > 
> > Hi,
> > 
> > > I found a solution to do this but at the end of the discussion it says 
> > > that this will be included in the next stable release.
> > 
> > Link?
> > 
> > > Since this stable release is already there, it should work.
> > > However, this does not work here.
> > 
> > The normal way of doing this is to add the IPs to your hosts file (or to
> > make the hostnames resolve to the IPs somehow: there are a bunch of
> > easy-to-configure lightweight DNS servers available).
> > 
> > Cheers,
> > Alex
> > 
> > 
> > On Fri, Sep 16, 2011 at 11:31:17AM +0200, Bob Claerhout wrote:
> > > Hi all,
> > > 
> > >  
> > > 
> > > I want to use the cluster using IP instead of a hostname.
> > > 
> > > I found a solution to do this but at the end of the discussion it says 
> > > that this will be included in the next stable release.
> > > 
> > > Since this stable release is already there, it should work.
> > > 
> > > However, this does not work here.
> > > 
> > > Any suggestions?
> > > 
> > >  
> > > 
> > > Kind regards
> > > 
> > > Bob Claerhout
> > > 
> > >  
> > > 
> > >  
> > > 
> > >  
> > > 
> > 
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-discuss at lists.rabbitmq.com
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > 
> > 
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Mon Sep 19 11:15:49 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 19 Sep 2011 11:15:49 +0100
Subject: [rabbitmq-discuss] how to set the message properties in
 rabbitmq 2.6.1?
In-Reply-To: <4E770D2C.2040505@rabbitmq.com>
References: <32493503.post@talk.nabble.com> <4E770D2C.2040505@rabbitmq.com>
Message-ID: <4E771655.1090200@rabbitmq.com>

On 19/09/11 10:36, Emile Joubert wrote:
> Use any of these, or create your own from
> com.rabbitmq.client.BasicProperties() 

That should have been com.rabbitmq.client.AMQP.BasicProperties() -
com.rabbitmq.client.BasicProperties() is an interface.

Apologies for any confusion caused.

From sameek at arosys.com  Mon Sep 19 12:36:10 2011
From: sameek at arosys.com (sam_mis)
Date: Mon, 19 Sep 2011 04:36:10 -0700 (PDT)
Subject: [rabbitmq-discuss] how to set the message properties in
 rabbitmq 2.6.1?
In-Reply-To: <4E770D2C.2040505@rabbitmq.com>
References: <32493503.post@talk.nabble.com> <4E770D2C.2040505@rabbitmq.com>
Message-ID: <32494219.post@talk.nabble.com>



Emile Joubert-2 wrote:
> 
> Hi,
> 
> On 19/09/11 10:13, sam_mis wrote:
>> Hi
>> 
>> I am using Rabbitmq server 2.6.1.i want to know,how to set message
>> properties in 2.6.1 using java client lib.
> 
> There are a number of convenient pre-configured properties in
> com.rabbitmq.client.MessageProperties:
> 
>  MINIMAL_BASIC
>  MINIMAL_PERSISTENT_BASIC
>  BASIC
>  PERSISTENT_BASIC
>  TEXT_PLAIN
>  PERSISTENT_TEXT_PLAIN
> 
> Use any of these, or create your own from
> com.rabbitmq.client.BasicProperties() and pass it as a parameter to
> basicPublish().
> 
> 
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


Thanks for reply. previously I used Rabbitmq server 2.3 that support
following way to set the message properties:

AMQP.BasicProperties msg=new AMQP.BasicProperties();
msg.setxxxxx

method called and setXXX or getXXX  for the properties.can i do same for
same here or used AMQP.BasicProperties.Builder class to build properties.

Thanks
-- 
View this message in context: http://old.nabble.com/how-to-set-the-message-properties-in-rabbitmq-2.6.1--tp32493503p32494219.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sameek at arosys.com  Mon Sep 19 12:37:52 2011
From: sameek at arosys.com (sam_mis)
Date: Mon, 19 Sep 2011 04:37:52 -0700 (PDT)
Subject: [rabbitmq-discuss] how to set the message properties in
 rabbitmq 2.6.1?
In-Reply-To: <4E770D2C.2040505@rabbitmq.com>
References: <32493503.post@talk.nabble.com> <4E770D2C.2040505@rabbitmq.com>
Message-ID: <32494237.post@talk.nabble.com>



Emile Joubert-2 wrote:
> 
> Hi,
> 
> On 19/09/11 10:13, sam_mis wrote:
>> Hi
>> 
>> I am using Rabbitmq server 2.6.1.i want to know,how to set message
>> properties in 2.6.1 using java client lib.
> 
> There are a number of convenient pre-configured properties in
> com.rabbitmq.client.MessageProperties:
> 
>  MINIMAL_BASIC
>  MINIMAL_PERSISTENT_BASIC
>  BASIC
>  PERSISTENT_BASIC
>  TEXT_PLAIN
>  PERSISTENT_TEXT_PLAIN
> 
> Use any of these, or create your own from
> com.rabbitmq.client.BasicProperties() and pass it as a parameter to
> basicPublish().
> 
> 
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


Thanks for reply. previously I used Rabbitmq server 2.3 that support
following way to set the message properties:

AMQP.BasicProperties msg=new AMQP.BasicProperties();
msg.setxxxxx

method and setXXX or getXXX  for the properties.can i do same for here or
used AMQP.BasicProperties.Builder class to build properties.

Thanks
-- 
View this message in context: http://old.nabble.com/how-to-set-the-message-properties-in-rabbitmq-2.6.1--tp32493503p32494237.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Mon Sep 19 13:08:06 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 19 Sep 2011 13:08:06 +0100
Subject: [rabbitmq-discuss] how to set the message properties in
 rabbitmq 2.6.1?
In-Reply-To: <32494219.post@talk.nabble.com>
References: <32493503.post@talk.nabble.com> <4E770D2C.2040505@rabbitmq.com>
	<32494219.post@talk.nabble.com>
Message-ID: <4E7730A6.2060107@rabbitmq.com>

Hi,

On 19/09/11 12:36, sam_mis wrote:
> Thanks for reply. previously I used Rabbitmq server 2.3 that support
> following way to set the message properties:
> 
> AMQP.BasicProperties msg=new AMQP.BasicProperties();
> msg.setxxxxx
> 
> method called and setXXX or getXXX  for the properties.can i do same for
> same here or used AMQP.BasicProperties.Builder class to build properties.

As you correctly point out, setters and getters have been replaced by
the builder pattern. This is a recent change, so not much documentation
exists at this point, but we intend to remedy that. In the meantime you
can refer to the javadoc:

http://www.rabbitmq.com/releases/rabbitmq-java-client/current-javadoc/com/rabbitmq/client/AMQP.BasicProperties.Builder.html

And most general information about the builder pattern should be
applicable, e.g. this article by Joshua Bloch:

http://drdobbs.com/java/208403883?pgno=2

Another source of information is the use of the builder pattern
throughout the examples and tests in the rabbit java client library, e.g.

com.rabbitmq.examples.PerQueueTTLPublisher



-Emile



From sameek at arosys.com  Mon Sep 19 13:40:18 2011
From: sameek at arosys.com (sam_mis)
Date: Mon, 19 Sep 2011 05:40:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable remotely connect to an Rabbitmq server?
Message-ID: <32494635.post@talk.nabble.com>


Hi

I have install Rabbitmq server on Debian machine. I want to connect this
machine and publish message on it.other machine will connect with the Debian
and consume those messages.i am using following code:

      factory = new ConnectionFactory();
      logger.info("successfully opening a Connection to an AMQP broker..");
      factory.setUsername("guest");
      logger.info("Set the user name...");
      factory.setPassword("guest");
      logger.info("Set the password...");
      factory.setVirtualHost("/");
      logger.info("Set the virtual host...");
      factory.setHost("192.168.1.2");  //my Debian server IP Address
      logger.info("The default host to use for connections..");
      factory.setPort(5672);
      logger.info("Set the target port..");
      connection = factory.newConnection();

when i tried i got the following error:

java.net.ConnectException: Connection timed out: connect
	at java.net.PlainSocketImpl.socketConnect(Native Method)
	at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)
	at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
	at java.net.Socket.connect(Socket.java:529)
	at java.net.Socket.connect(Socket.java:478)
	at
com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:342)
	at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:380)
	at
com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:403)
	at RabbitMQProducer12.producer(RabbitMQProducer12.java:43)
	at RabbitMQProducer12.main(RabbitMQProducer12.java:78)

I want to know where the problem.Is this procedure is correct to connect
remotely to the other system.if it is wrong then what will be the correct
way to do this? 
-- 
View this message in context: http://old.nabble.com/Unable--remotely-connect-to-an-Rabbitmq-server--tp32494635p32494635.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From acheremukhin.digitalguard at gmail.com  Mon Sep 19 14:22:58 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Mon, 19 Sep 2011 06:22:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable remotely connect to an Rabbitmq
 server?
In-Reply-To: <32494635.post@talk.nabble.com>
References: <32494635.post@talk.nabble.com>
Message-ID: <19226338.2909.1316438578982.JavaMail.geo-discussion-forums@yqnk41>

Might, using of hostname instead ip-address to fix problem.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110919/537736e7/attachment.htm>

From acheremukhin.digitalguard at gmail.com  Mon Sep 19 14:31:19 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Mon, 19 Sep 2011 06:31:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable remotely connect to an Rabbitmq
 server?
In-Reply-To: <32494635.post@talk.nabble.com>
References: <32494635.post@talk.nabble.com>
Message-ID: <1164186.196.1316439079329.JavaMail.geo-discussion-forums@yqih9>

Is rabbitmq's instance working on 192.168.1.2 well? Did you check it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110919/9d4eeaeb/attachment.htm>

From acheremukhin.digitalguard at gmail.com  Mon Sep 19 14:36:00 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Mon, 19 Sep 2011 06:36:00 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable remotely connect to an Rabbitmq
 server?
In-Reply-To: <32494635.post@talk.nabble.com>
References: <32494635.post@talk.nabble.com>
Message-ID: <19928872.208.1316439360875.JavaMail.geo-discussion-forums@yqih9>

I think it's good idea to see logs of rabbitmq at the moment connecting of 
producer.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110919/381aedaa/attachment.htm>

From steve at lemansholdings.co.uk  Mon Sep 19 15:45:36 2011
From: steve at lemansholdings.co.uk (Steve Martin)
Date: Mon, 19 Sep 2011 15:45:36 +0100
Subject: [rabbitmq-discuss] Consuming a queue via Splunk
Message-ID: <CA+cAUkuOznypGE4XY2SSbPJNpiDdzM_eKYnLyj=4aSr+WAac3Q@mail.gmail.com>

I was wondering whether any plug-ins exist for Splunk for consuming data
from a queue?
We're logging information as JSON and archiving in a DB but it would fir in
more neatly with our architecture to be able to have Splunk consume from a
queue rather than directly from the database.

TIA
Steve
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110919/ead41483/attachment.htm>

From alexis at rabbitmq.com  Mon Sep 19 15:55:59 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 19 Sep 2011 15:55:59 +0100
Subject: [rabbitmq-discuss] Consuming a queue via Splunk
In-Reply-To: <CA+cAUkuOznypGE4XY2SSbPJNpiDdzM_eKYnLyj=4aSr+WAac3Q@mail.gmail.com>
References: <CA+cAUkuOznypGE4XY2SSbPJNpiDdzM_eKYnLyj=4aSr+WAac3Q@mail.gmail.com>
Message-ID: <CACOPnvfuau4ox880Bq-nUZOTn2ZCbhBPZf9vLV+8mJjUvP6oNQ@mail.gmail.com>

Steve

This is one of those things we have heard of other folks doing, but
where we can't point you at a convenient "how I did it" blog post...

I would have thought it was pretty simple to consume from a Rabbit
queue instead of polling a DB.

alexis

On Mon, Sep 19, 2011 at 3:45 PM, Steve Martin
<steve at lemansholdings.co.uk> wrote:
> I was wondering whether any plug-ins exist for Splunk for consuming data
> from a queue?
> We're logging information as JSON and archiving in a DB but it would fir in
> more neatly with our architecture to be able to have Splunk consume from a
> queue rather than directly from the database.
> TIA
> Steve
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From nmarino at m5net.com  Mon Sep 19 17:15:49 2011
From: nmarino at m5net.com (Nick Marino)
Date: Mon, 19 Sep 2011 12:15:49 -0400
Subject: [rabbitmq-discuss] JSON-RPC channel plugin crash on
	tuple_to_list(Props)
Message-ID: <CALeXXgm_z39wf5m4hQh-dT6DU1zideeGw5VgPpcwpoj7B1-PiA@mail.gmail.com>

Hello,

I've recently been seeing some intermittent process crashes in the JSON-RPC
channel plugin. Here is an example:

=ERROR REPORT==== 9-Sep-2011::16:35:52 ===
** Generic server <0.13801.1107> terminating
** Last message in was {'EXIT',<0.13799.1107>,
                           {badarg,
                               [{erlang,tuple_to_list,[none]},
                                {rabbit_jsonrpc_channel,do_send_async,3},
                                {rabbit_jsonrpc_channel,handle_info,2},
                                {gen_server,handle_msg,5},
                                {proc_lib,init_p_do_apply,3}]}}
** When Server state == {ch,running,rabbit_jsonrpc_channel,<0.13799.1107>,
                         <0.13799.1107>,undefined,
                         #Fun<rabbit_jsonrpc_channel.0.50269389>,none,
                         {set,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         4,
                         {[],[]},
                         {[],[]},
                         <<"guest">>,<<"/580627">>,
                         <<"amq.gen-gHphjRfHaC0YWeflaEIezg==">>,
                         {dict,1,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],
                            [[<<"amq.ctag-5QgH+lAhBr93FnOG8Y4T6A==">>|
                              {resource,<<"/580627">>,queue,
                               <<"amq.gen-sV5mnds/lpCC6eza+CbMRQ==">>}]],
                            [],[]}}},
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         <0.13800.1107>,
                         {state,none,undefined}}
** Reason for termination ==
** {badarg,[{erlang,tuple_to_list,[none]},
            {rabbit_jsonrpc_channel,do_send_async,3},
            {rabbit_jsonrpc_channel,handle_info,2},
            {gen_server,handle_msg,5},
            {proc_lib,init_p_do_apply,3}]}

I looked through the RabbitMQ code, and I believe this is getting triggered
when the system in question starts getting enough load that messages are
queued up instead of published immediately as they come in. The decoded
properties get cleared out in rabbit_variable_queue to avoid persisting
extra data, and then later when the message is passed to the json plugin, it
tries to call tuple_to_list on the properties which are now set to the atom
'none'.

(Incidentally, I'm seeing this problem in RabbitMQ 2.1.0, but I checked out
the latest code from hg and the plugin still calls tuple_to_list without
calling ensure_content_decoded first.)

The twist here is that I'm not sure if this is an error anyone would
normally see, but we have written a custom exchange type plugin that creates
messages, calls ensure_content_encoded on them, and then passes them to
rabbit_amqqueue:deliver. The json plugin crash only seems to happen on these
messages that are generated in this way (but like I said, only
intermittently, and most of the time it doesn't seem to cause any issues).
We also have other components of our system that connect to RabbitMQ
directly (not through the json plugin), and there never seem to be any
crashes associated with those connections, despite the fact that they're
dealing with the same kind of messages that do occasionally cause crashes in
the json plugin.

Based on my limited knowledge of the Rabbit code though, it doesn't seem
like we're doing anything wrong in our exchange type plugin, and it seems
like it would make sense for the json plugin to call ensure_content_decoded
before it assumes the content is actually decoded. Could this be considered
a bug in the json plugin? If so, I would be happy to write up a patch and
submit it to whatever the appropriate place might be.

Thanks for your help!
Nick Marino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110919/3c72f186/attachment.htm>

From jerryk at vmware.com  Mon Sep 19 18:14:09 2011
From: jerryk at vmware.com (Jerry Kuch)
Date: Mon, 19 Sep 2011 10:14:09 -0700 (PDT)
Subject: [rabbitmq-discuss] Unable remotely connect to an Rabbitmq
	server?
In-Reply-To: <32494635.post@talk.nabble.com>
References: <32494635.post@talk.nabble.com>
Message-ID: <1535C2E9-F92F-424D-A458-68C1090F7B77@vmware.com>

If you try to telnet to port 5672 on the Rabbit server do you connect to anything?  If you bang out some junk on the keyboard and hit RETURN do you get an AMQP error message on your terminal?  If not, it's possible you have a firewall blocking the AMQP port on the broker, or the remote server isn't running (or isn't running there)...

Best regards,
Jerry

Sent from my iPad.

On Sep 19, 2011, at 5:40 AM, sam_mis <sameek at arosys.com> wrote:

> 
> Hi
> 
> I have install Rabbitmq server on Debian machine. I want to connect this
> machine and publish message on it.other machine will connect with the Debian
> and consume those messages.i am using following code:
> 
>      factory = new ConnectionFactory();
>      logger.info("successfully opening a Connection to an AMQP broker..");
>      factory.setUsername("guest");
>      logger.info("Set the user name...");
>      factory.setPassword("guest");
>      logger.info("Set the password...");
>      factory.setVirtualHost("/");
>      logger.info("Set the virtual host...");
>      factory.setHost("192.168.1.2");  //my Debian server IP Address
>      logger.info("The default host to use for connections..");
>      factory.setPort(5672);
>      logger.info("Set the target port..");
>      connection = factory.newConnection();
> 
> when i tried i got the following error:
> 
> java.net.ConnectException: Connection timed out: connect
>    at java.net.PlainSocketImpl.socketConnect(Native Method)
>    at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)
>    at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)
>    at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)
>    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
>    at java.net.Socket.connect(Socket.java:529)
>    at java.net.Socket.connect(Socket.java:478)
>    at
> com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:342)
>    at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:380)
>    at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:403)
>    at RabbitMQProducer12.producer(RabbitMQProducer12.java:43)
>    at RabbitMQProducer12.main(RabbitMQProducer12.java:78)
> 
> I want to know where the problem.Is this procedure is correct to connect
> remotely to the other system.if it is wrong then what will be the correct
> way to do this? 
> -- 
> View this message in context: http://old.nabble.com/Unable--remotely-connect-to-an-Rabbitmq-server--tp32494635p32494635.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ekirpichov at gmail.com  Mon Sep 19 18:44:10 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 19 Sep 2011 21:44:10 +0400
Subject: [rabbitmq-discuss] .NET Client - IModel.Close completes but the
 model is never actually shut down.
Message-ID: <CANVKUrWyc10+8EXNPQ5Z8D__uhW5GZenWjGWgf7+x88jxmF4zA@mail.gmail.com>

I have a piece of code that consumes a queue.

Then the following happens:
* A message arrives to the consumer (HandleBasicDeliver)
* At the same time (up to fractions of a millisecond) I'm doing
IModel.Close() on this model, which completes ok.
* I open another channel on this connection, which works fine.
* That one consumer never gets a HandleModelShutdown() or OnCancel()
event, and in fact the consumer remains visible in the management
interface for many hours after these events, holding the
unacknowledged message.

I'm using RabbitMQ 2.6.1 and the .NET client 2.6.0.0.

What can I do to diagnose this?
Can this be a bug in the .NET client, or am I misusing it?
I have a RabbitMQ log, I have a memory dump of my .NET client process.

-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From jeremyalan at gmail.com  Mon Sep 19 18:50:30 2011
From: jeremyalan at gmail.com (Jeremy Mason)
Date: Mon, 19 Sep 2011 12:50:30 -0500
Subject: [rabbitmq-discuss] RabbitMQ, SSL, .NET Client
Message-ID: <CAM2MZuf6evN_Aeecoif-2cJPEVsrGNB3KN05YPvRAT_-XjP07Q@mail.gmail.com>

Hi,

I have a RabbitMQ service running localhost in Windows 7, and I am
attempting to get a .NET client to communicate with SSL.  I have a
certificate that our company purchased, so I shouldn't need to generate a
self-signed certificate, as laid out in the example page.

The error I am receiving is:
RabbitMQ.Client.Exceptions.ProtocolVersionMismatchException: AMQP server
protocol negotiation failure: server version unknown-unknown, client version
0-9

While the service is running, I can still send messages via the non-SSL
port, just unable to connect to the SSL port.  Keeping this short for
simplicity, please let me know what other information I can provide
(client/server configuration, etc.)

Any ideas?

TIA,
Jeremy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110919/0d110e36/attachment.htm>

From emile at rabbitmq.com  Mon Sep 19 20:59:33 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 19 Sep 2011 20:59:33 +0100
Subject: [rabbitmq-discuss] RabbitMQ, SSL, .NET Client
In-Reply-To: <CAM2MZuf6evN_Aeecoif-2cJPEVsrGNB3KN05YPvRAT_-XjP07Q@mail.gmail.com>
References: <CAM2MZuf6evN_Aeecoif-2cJPEVsrGNB3KN05YPvRAT_-XjP07Q@mail.gmail.com>
Message-ID: <4E779F25.2050106@rabbitmq.com>

Hi Jeremy,

Op 19/09/11 18:50, het Jeremy Mason geskryf:
> Hi,
> 
> I have a RabbitMQ service running localhost in Windows 7, and I am

I assume this means the server and client are on the same machine.
Otherwise you should check whether there are any firewalls that redirect
SSL traffic.

> attempting to get a .NET client to communicate with SSL.  I have a
> certificate that our company purchased, so I shouldn't need to generate
> a self-signed certificate, as laid out in the example page.

You will still need to provide the broker with a CA certificate.

> The error I am receiving is:
> RabbitMQ.Client.Exceptions.ProtocolVersionMismatchException: AMQP server
> protocol negotiation failure: server version unknown-unknown, client
> version 0-9

That is very strange.

> While the service is running, I can still send messages via the non-SSL
> port, just unable to connect to the SSL port.  Keeping this short for
> simplicity, please let me know what other information I can provide
> (client/server configuration, etc.)

Can you confirm whether this behaviour is limited to the Windows service
only, or can you replicate when running rabbit as an application?

Is the client definitely talking to the same rabbit server on SSL and
non-SSL ports? Does the broker logfile show successful non-SSL
connections as well as unsuccessful SSL connections? Can you quote the
relevant log entries?


-Emile

From ekirpichov at gmail.com  Mon Sep 19 21:26:39 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Tue, 20 Sep 2011 00:26:39 +0400
Subject: [rabbitmq-discuss] .NET Client - IModel.Close completes but the
 model is never actually shut down.
In-Reply-To: <CANVKUrWyc10+8EXNPQ5Z8D__uhW5GZenWjGWgf7+x88jxmF4zA@mail.gmail.com>
References: <CANVKUrWyc10+8EXNPQ5Z8D__uhW5GZenWjGWgf7+x88jxmF4zA@mail.gmail.com>
Message-ID: <CANVKUrWRBqc2XxTnLUmCOrbWurJtSB+=5HfUMv=kzmkzUHO7sQ@mail.gmail.com>

Some more information from the memory dump:
Some of the fields of the "runaway" consumer (the one that belongs to
the model that wasn't closed) are as follows:

m_model = null (though other consumers have it null too)
m_running = 1
m_shutdownReason = null
waiter = null
shutdownHandler = null
queueSize = 1

Hope this helps the diagnosis. I'll try to take a closer look at the
Client's code tomorrow.

On Mon, Sep 19, 2011 at 9:44 PM, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
> I have a piece of code that consumes a queue.
>
> Then the following happens:
> * A message arrives to the consumer (HandleBasicDeliver)
> * At the same time (up to fractions of a millisecond) I'm doing
> IModel.Close() on this model, which completes ok.
> * I open another channel on this connection, which works fine.
> * That one consumer never gets a HandleModelShutdown() or OnCancel()
> event, and in fact the consumer remains visible in the management
> interface for many hours after these events, holding the
> unacknowledged message.
>
> I'm using RabbitMQ 2.6.1 and the .NET client 2.6.0.0.
>
> What can I do to diagnose this?
> Can this be a bug in the .NET client, or am I misusing it?
> I have a RabbitMQ log, I have a memory dump of my .NET client process.
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From videlalvaro at gmail.com  Mon Sep 19 21:51:53 2011
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 19 Sep 2011 22:51:53 +0200
Subject: [rabbitmq-discuss] Work on plugins
Message-ID: <9EC1BE94-E472-4BC7-9846-C4E13B2076F6@gmail.com>

Hi,

I'm seeing on the mercurial repository that there are many changes to the plugin system so I want to do a feature request.

Something I noticed while playing with custom exchanges for RabbitMQ is that if you create them and later you remove the plugin without deleting the exchange then RabbitMQ won't start at all because the recovery process will fail since it can't find the custom exchange module.

Wouldn't it be nice to have an "uninstall plugin" kind of command? Perhaps also in the same way you do -rabbit_boot_step(). declarations on your modules, you could add something like a -rabbit_uninstall_plugin(). declaration that could be executed to remove the plugin. Then it's up to the plugin developer to take care at this point of removing Mnesia entries and other stuff related to his plugin.

What do you think?

Alvaro

From gmr at myyearbook.com  Mon Sep 19 21:56:47 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Mon, 19 Sep 2011 13:56:47 -0700
Subject: [rabbitmq-discuss] Consuming a queue via Splunk
In-Reply-To: <CA+cAUkuOznypGE4XY2SSbPJNpiDdzM_eKYnLyj=4aSr+WAac3Q@mail.gmail.com>
References: <CA+cAUkuOznypGE4XY2SSbPJNpiDdzM_eKYnLyj=4aSr+WAac3Q@mail.gmail.com>
Message-ID: <AA2712E7-EC3B-4CA8-803C-541CB9D9FE21@myyearbook.com>

We have an RabbitMQ -> Syslog -> Splunk gateway consumer app. I'll try and get it shaped up for release and get Brian to blog about it.

Gavin



On Sep 19, 2011, at 7:45 AM, Steve Martin <steve at lemansholdings.co.uk> wrote:

> I was wondering whether any plug-ins exist for Splunk for consuming data from a queue?
> We're logging information as JSON and archiving in a DB but it would fir in more neatly with our architecture to be able to have Splunk consume from a queue rather than directly from the database.
> 
> TIA
> Steve
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexis at rabbitmq.com  Mon Sep 19 22:03:30 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 19 Sep 2011 22:03:30 +0100
Subject: [rabbitmq-discuss] Consuming a queue via Splunk
In-Reply-To: <AA2712E7-EC3B-4CA8-803C-541CB9D9FE21@myyearbook.com>
References: <CA+cAUkuOznypGE4XY2SSbPJNpiDdzM_eKYnLyj=4aSr+WAac3Q@mail.gmail.com>
	<AA2712E7-EC3B-4CA8-803C-541CB9D9FE21@myyearbook.com>
Message-ID: <CACOPnvduegR+=VAZmvB0kWgvhAzkhO3dnJ8U-0auPLZt1y4NPA@mail.gmail.com>

Thanks!

On Mon, Sep 19, 2011 at 9:56 PM, Gavin M. Roy <gmr at myyearbook.com> wrote:
> We have an RabbitMQ -> Syslog -> Splunk gateway consumer app. I'll try and get it shaped up for release and get Brian to blog about it.
>
> Gavin
>
>
>
> On Sep 19, 2011, at 7:45 AM, Steve Martin <steve at lemansholdings.co.uk> wrote:
>
>> I was wondering whether any plug-ins exist for Splunk for consuming data from a queue?
>> We're logging information as JSON and archiving in a DB but it would fir in more neatly with our architecture to be able to have Splunk consume from a queue rather than directly from the database.
>>
>> TIA
>> Steve
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From jeremyalan at gmail.com  Mon Sep 19 22:59:31 2011
From: jeremyalan at gmail.com (jeremyalan)
Date: Mon, 19 Sep 2011 14:59:31 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ, SSL, .NET Client
In-Reply-To: <4E779F25.2050106@rabbitmq.com>
References: <CAM2MZuf6evN_Aeecoif-2cJPEVsrGNB3KN05YPvRAT_-XjP07Q@mail.gmail.com>
	<4E779F25.2050106@rabbitmq.com>
Message-ID: <32498849.post@talk.nabble.com>


> I assume this means the server and client are on the same machine.
> Otherwise you should check whether there are any firewalls that redirect
> SSL traffic.

Yes, the client and server/service are running on the same machine.  The
firewall on the machine is disabled.

> Can you confirm whether this behaviour is limited to the Windows service
> only, or can you replicate when running rabbit as an application?

The behavior is the same whether it's running as an application or a 
service.  This was confirmed by running rabbitmq-service.bat and 
rabbitmq-server.bat.  Not sure if that is correct or not.

> Is the client definitely talking to the same rabbit server on SSL and
> non-SSL ports? Does the broker logfile show successful non-SSL
> connections as well as unsuccessful SSL connections? Can you quote the
> relevant log entries?


From matthew at rabbitmq.com  Mon Sep 19 23:01:06 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 19 Sep 2011 23:01:06 +0100
Subject: [rabbitmq-discuss] Work on plugins
In-Reply-To: <9EC1BE94-E472-4BC7-9846-C4E13B2076F6@gmail.com>
References: <9EC1BE94-E472-4BC7-9846-C4E13B2076F6@gmail.com>
Message-ID: <20110919220105.GA10957@wellquite.org>

Hi Alvaro,

On Mon, Sep 19, 2011 at 10:51:53PM +0200, Alvaro Videla wrote:
> Something I noticed while playing with custom exchanges for RabbitMQ
> is that if you create them and later you remove the plugin without
> deleting the exchange then RabbitMQ won't start at all because the
> recovery process will fail since it can't find the custom exchange
> module.

Yeah, I can certainly believe that'll seriously upset things.

> Wouldn't it be nice to have an "uninstall plugin" kind of command?
> Perhaps also in the same way you do -rabbit_boot_step(). declarations
> on your modules, you could add something like a
> -rabbit_uninstall_plugin(). declaration that could be executed to
> remove the plugin. Then it's up to the plugin developer to take care
> at this point of removing Mnesia entries and other stuff related to
> his plugin.

Well I've often thought about having a -rabbit_shutdown_step()
complement to -rabbit_boot_step() but so far there haven't really been
any problems that we can't solve just by careful use of supervisor
shutdown sequences. That's not to say that we won't need it eventually.

But that's a different issue from what you're after. Currently, all
plugin installation and removal is done with Rabbit shutdown. The boot
steps are run every time rabbit is booted, not just when a new plugin is
discovered. There is currently no uninstallation step, as you know, and
there is no uninstallation tool. However, that's changing soon, though
again, it'll at least in its first guise again work with Rabbit shutdown
and it won't support any uninstall hooks. But I think it's a reasonable
thing to want - there's definitely utility for it, so I'll raise a bug
for it. I can't really promise that it'll get looked at promptly though.

Matthew

From jeremyalan at gmail.com  Mon Sep 19 23:15:58 2011
From: jeremyalan at gmail.com (jeremyalan)
Date: Mon, 19 Sep 2011 15:15:58 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ, SSL, .NET Client
In-Reply-To: <32498849.post@talk.nabble.com>
References: <CAM2MZuf6evN_Aeecoif-2cJPEVsrGNB3KN05YPvRAT_-XjP07Q@mail.gmail.com>
	<4E779F25.2050106@rabbitmq.com> <32498849.post@talk.nabble.com>
Message-ID: <32498944.post@talk.nabble.com>


The log appears to be pointing to the key file, which doesn't surprise me
because I was only given two files, the Cert and the CA.  I tried running
RabbitMQ server without specifying a keyfile, which seems to cause problems.

I also followed the instructions at the website below, to attempt to create
my own .pem file: 
http://www.digicert.com/ssl-support/pem-ssl-creation.htm

This still seems to throw errors related to the key file.  So I guess my
questions are:

1. Is the key file required?
2. If I wasn't given one, how do I create one from the Cert/CA files? (is it
even possible??)
3. Any other options?

TIA,
-Jeremy
-- 
View this message in context: http://old.nabble.com/RabbitMQ%2C-SSL%2C-.NET-Client-tp32497061p32498944.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From phenisha at gmail.com  Tue Sep 20 01:21:49 2011
From: phenisha at gmail.com (Nathan)
Date: Tue, 20 Sep 2011 10:21:49 +1000
Subject: [rabbitmq-discuss] ldap authentication
In-Reply-To: <4E76F3F0.9070800@rabbitmq.com>
References: <4E76DCDE.2060704@gmail.com> <4E76F3F0.9070800@rabbitmq.com>
Message-ID: <4E77DC9D.1060606@gmail.com>


>> [
>> {rabbitmq_stomp, [{tcp_listeners, [6163]} ]},
>> {rabbit, [{auth_backends, [rabbit_auth_backend_ldap]}] },
>> {rabbit_auth_backend_ldap,
>> [ {servers, ["ldap.zozee.com"]}, ...
>
> The docs are wrong. The second 'rabbit_auth_backend_ldap' should be 
> 'rabbitmq_auth_backend_ldap' instead.
>

Matthias, Thank you.

However now when i change it back to rabbitmq_auth_backend_internal
none of my local users can authenticate?


bellow is the log excerpt:


=INFO REPORT==== 20-Sep-2011::10:21:01 ===
starting TCP connection <0.1913.0> from 172.16.0.51:59105




=ERROR REPORT==== 20-Sep-2011::10:21:04 ===
exception on TCP connection <0.1913.0> from 172.16.0.51:59105
{channel0_error,starting,
     {error,undef,'connection.start_ok',
         [{rabbitmq_auth_backend_internal,check_user_login,
              [<<"testguy">>,[{password,<<"testpw">>}]]},
          {rabbit_access_control,'-check_user_login/2-fun-0-',4},
          {lists,foldl,3},
          {rabbit_reader,auth_phase,2},
          {rabbit_reader,handle_method0,3},
          {rabbit_reader,handle_input,3},
          {rabbit_reader,recvloop,2},
          {rabbit_reader,start_connection,7}]}}

=INFO REPORT==== 20-Sep-2011::10:21:04 ===
closing TCP connection <0.1913.0> from 172.16.0.51:59105


Thank you
Nathan

From matthias at rabbitmq.com  Tue Sep 20 01:33:44 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 20 Sep 2011 01:33:44 +0100
Subject: [rabbitmq-discuss] ldap authentication
In-Reply-To: <4E77DC9D.1060606@gmail.com>
References: <4E76DCDE.2060704@gmail.com> <4E76F3F0.9070800@rabbitmq.com>
	<4E77DC9D.1060606@gmail.com>
Message-ID: <4E77DF68.2000707@rabbitmq.com>

On 20/09/11 01:21, Nathan wrote:
> when i change it back to rabbitmq_auth_backend_internal
> none of my local users can authenticate?

That needs to be rabbit_auth_backend_internal, no "mq". That rule 
generally applies to the contents of auth_backends, since it refers to 
Erlang modules, which we usually name rabbit_*, whereas our Erlang 
applications (and hence config settings) are usually named rabbitmq_*. 
Except for the rabbit application, which is just called 'rabbit'. 
Confused yet?

Matthias.

From emile at rabbitmq.com  Tue Sep 20 09:54:37 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 20 Sep 2011 09:54:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ, SSL, .NET Client
In-Reply-To: <32498944.post@talk.nabble.com>
References: <CAM2MZuf6evN_Aeecoif-2cJPEVsrGNB3KN05YPvRAT_-XjP07Q@mail.gmail.com>	<4E779F25.2050106@rabbitmq.com>
	<32498849.post@talk.nabble.com> <32498944.post@talk.nabble.com>
Message-ID: <4E7854CD.1090508@rabbitmq.com>

Hi Jeremy,

On 19/09/11 23:15, jeremyalan wrote:
> 1. Is the key file required?

Yes.

> 2. If I wasn't given one, how do I create one from the Cert/CA files? (is it
> even possible??)

A keypair would have been generated as part of your certificate signing
request. You will need to supply this to the broker in PEM format.

> 3. Any other options?

You could try to set up SSL with a self-signed certificate in the way
documented here:

http://www.rabbitmq.com/ssl.html

Once you have that working you will have a point of reference to make
comparisons of all the files necessary to establish SSL connections.



-Emile






From simon at rabbitmq.com  Tue Sep 20 10:52:38 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Sep 2011 10:52:38 +0100
Subject: [rabbitmq-discuss] Work on plugins
In-Reply-To: <9EC1BE94-E472-4BC7-9846-C4E13B2076F6@gmail.com>
References: <9EC1BE94-E472-4BC7-9846-C4E13B2076F6@gmail.com>
Message-ID: <4E786266.6070301@rabbitmq.com>

On 19/09/11 21:51, Alvaro Videla wrote:
> Something I noticed while playing with custom exchanges for RabbitMQ
> is that if you create them and later you remove the plugin without
> deleting the exchange then RabbitMQ won't start at all because the
> recovery process will fail since it can't find the custom exchange
> module.

Yeah, that's certainly a problem. As you might guess I bumped into this 
several times developing the federation plugin.

> Wouldn't it be nice to have an "uninstall plugin" kind of command?
> Perhaps also in the same way you do -rabbit_boot_step(). declarations
> on your modules, you could add something like a
> -rabbit_uninstall_plugin(). declaration that could be executed to
> remove the plugin. Then it's up to the plugin developer to take care
> at this point of removing Mnesia entries and other stuff related to
> his plugin.

But I'm not sure that this is the solution. What if a plugin gets 
uninstalled temporarily by mistake? That's far too easy to do at the 
moment during an upgrade, and while the changes to the plugin system 
should mitigate that *a lot* the idea that:

# rabbitmq-plugin uninstall rabbitmq_federation
# rabbitmq-plugin install rabbitmq_federation

could delete exchanges and bindings seems pretty alarming to me.

It seems that this is primarily an issue around exchange type plugins. I 
wonder if we could just not recover exchanges that have an unrecognised 
type? The trouble is, then you have a "hidden" exchange that will pop 
back as soon as you reinstall the plugin, but without the plugin you 
can't get rid of it, and attempts to redeclare it with a different type 
will always fail. Hmm.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Sep 20 10:57:07 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Sep 2011 10:57:07 +0100
Subject: [rabbitmq-discuss] ldap authentication
In-Reply-To: <4E76F3F0.9070800@rabbitmq.com>
References: <4E76DCDE.2060704@gmail.com> <4E76F3F0.9070800@rabbitmq.com>
Message-ID: <4E786373.1080102@rabbitmq.com>

On 19/09/11 08:49, Matthias Radestock wrote:
> The docs are wrong.

Fixed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Sep 20 11:06:03 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Sep 2011 11:06:03 +0100
Subject: [rabbitmq-discuss] JSON-RPC channel plugin crash
	on	tuple_to_list(Props)
In-Reply-To: <CALeXXgm_z39wf5m4hQh-dT6DU1zideeGw5VgPpcwpoj7B1-PiA@mail.gmail.com>
References: <CALeXXgm_z39wf5m4hQh-dT6DU1zideeGw5VgPpcwpoj7B1-PiA@mail.gmail.com>
Message-ID: <4E78658B.6020705@rabbitmq.com>

On 19/09/11 17:15, Nick Marino wrote:
> Based on my limited knowledge of the Rabbit code though, it doesn't seem
> like we're doing anything wrong in our exchange type plugin, and it
> seems like it would make sense for the json plugin to call
> ensure_content_decoded before it assumes the content is actually
> decoded. Could this be considered a bug in the json plugin?

It probably is, however in 2.1.0 the JSON-RPC plugin talked directly to 
internal rabbit objects like queues, and was thus susceptible to this 
bug. At some point (I don't remember exactly when) it was rewritten to 
talk to rabbit via the direct Erlang client (effectively 
AMQP-over-Erlang) and thus things should be rather more sanitised by the 
time JSON-RPC sees them. These days it should not need to call 
ensure_content_decoded() any more than a Java app would.

So I think the bug you're seeing is fixed by coincidence now. I 
recommend you upgrade.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tonygarnockjones+rabbitmq at gmail.com  Tue Sep 20 11:09:28 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 20 Sep 2011 06:09:28 -0400
Subject: [rabbitmq-discuss] Fwd:  Work on plugins
In-Reply-To: <CAM8fPiRus2YWZ=6n==d5tCxcxice5MWzY=7A+qj-wfTAbMuRDg@mail.gmail.com>
References: <9EC1BE94-E472-4BC7-9846-C4E13B2076F6@gmail.com>
	<4E786266.6070301@rabbitmq.com>
	<CAM8fPiRus2YWZ=6n==d5tCxcxice5MWzY=7A+qj-wfTAbMuRDg@mail.gmail.com>
Message-ID: <CAM8fPiQ7BMUB-q0XhEAtqtfQ3vxUAOAeTvPx+h=Ep5O6WxgcbA@mail.gmail.com>

Damn it, fooled by gmail's UI again and forgot to CC the list.

---------- Forwarded message ----------
From: Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com>
Date: 20 September 2011 06:08
Subject: Re: [rabbitmq-discuss] Work on plugins
To: Simon MacMullen <simon at rabbitmq.com>


On 20 September 2011 05:52, Simon MacMullen <simon at rabbitmq.com> wrote:

> could delete exchanges and bindings seems pretty alarming to me.
>

Agreed.


> It seems that this is primarily an issue around exchange type plugins. I
> wonder if we could just not recover exchanges that have an unrecognised
> type? The trouble is, then you have a "hidden" exchange that will pop back
> as soon as you reinstall the plugin, but without the plugin you can't get
> rid of it, and attempts to redeclare it with a different type will always
> fail. Hmm.
>

What about not deleting them, but if during recovery an exchange is found
with an unknown type, warning about it in the log and starting it with an
"inert exchange type" driver that simply drops all messages routed through
it? (It might also log each time it does.)

Then if later Rabbit is restarted with the appropriate exchange type added
again, everything is back to normal, but people are warned about
possibly-unexpected behaviour and no information is lost without explicit
action. Also, exchange.delete would work to get rid of any unwanted
exchanges after plugin removal.

Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110920/69585d18/attachment.htm>

From simon at rabbitmq.com  Tue Sep 20 11:11:14 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Sep 2011 11:11:14 +0100
Subject: [rabbitmq-discuss] Fwd:  Work on plugins
In-Reply-To: <CAM8fPiQ7BMUB-q0XhEAtqtfQ3vxUAOAeTvPx+h=Ep5O6WxgcbA@mail.gmail.com>
References: <9EC1BE94-E472-4BC7-9846-C4E13B2076F6@gmail.com>	<4E786266.6070301@rabbitmq.com>	<CAM8fPiRus2YWZ=6n==d5tCxcxice5MWzY=7A+qj-wfTAbMuRDg@mail.gmail.com>
	<CAM8fPiQ7BMUB-q0XhEAtqtfQ3vxUAOAeTvPx+h=Ep5O6WxgcbA@mail.gmail.com>
Message-ID: <4E7866C2.9060805@rabbitmq.com>

On 20/09/11 11:09, Tony Garnock-Jones wrote:
> What about not deleting them, but if during recovery an exchange is
> found with an unknown type, warning about it in the log and starting it
> with an "inert exchange type" driver that simply drops all messages
> routed through it? (It might also log each time it does.)

Ah, good idea. I'll file a bug.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Tue Sep 20 11:14:49 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 20 Sep 2011 11:14:49 +0100
Subject: [rabbitmq-discuss] .NET Client - IModel.Close completes but the
 model is never actually shut down.
In-Reply-To: <CANVKUrWyc10+8EXNPQ5Z8D__uhW5GZenWjGWgf7+x88jxmF4zA@mail.gmail.com>
References: <CANVKUrWyc10+8EXNPQ5Z8D__uhW5GZenWjGWgf7+x88jxmF4zA@mail.gmail.com>
Message-ID: <4E786799.7010301@rabbitmq.com>

Hi Eugene,

On 19/09/11 18:44, Eugene Kirpichov wrote:
> I have a piece of code that consumes a queue.
> 
> Then the following happens:
> * A message arrives to the consumer (HandleBasicDeliver)
> * At the same time (up to fractions of a millisecond) I'm doing
> IModel.Close() on this model, which completes ok.

Are you closing the model from inside HandleBasicDeliver() ?
Can you provide a minimal piece of code that triggers the problem?
Can you reproduce this problem reliably, or does it fail only a fraction
of the time?

> * I open another channel on this connection, which works fine.
> * That one consumer never gets a HandleModelShutdown() or OnCancel()
> event, and in fact the consumer remains visible in the management
> interface for many hours after these events, holding the
> unacknowledged message.
> 
> I'm using RabbitMQ 2.6.1 and the .NET client 2.6.0.0.
> 
> What can I do to diagnose this?

Establishing the connection through the Tracer
(http://www.rabbitmq.com/examples.html#tracer) or using a network
analyser like Wireshark can help to diagnose protocol problems, but as a
library user you shouldn't need to do this.

> Can this be a bug in the .NET client, or am I misusing it?
> I have a RabbitMQ log, I have a memory dump of my .NET client process.

I don't expect the logfiles to be much help, because they don't record
consumers subscribing to queues. If there are any entries around the
relevant time then please send them.



-Emile



From alfonso.pantoja at gmail.com  Tue Sep 20 11:49:01 2011
From: alfonso.pantoja at gmail.com (Alfonso Pantoja)
Date: Tue, 20 Sep 2011 03:49:01 -0700 (PDT)
Subject: [rabbitmq-discuss] .NET Client - IModel.Close completes but the
 model is never actually shut down.
In-Reply-To: <CANVKUrWyc10+8EXNPQ5Z8D__uhW5GZenWjGWgf7+x88jxmF4zA@mail.gmail.com>
References: <CANVKUrWyc10+8EXNPQ5Z8D__uhW5GZenWjGWgf7+x88jxmF4zA@mail.gmail.com>
Message-ID: <fa06d369-c4ce-4b89-bd37-8e52f139a979@i2g2000yqm.googlegroups.com>

Hi Eugene,


On 19 sep, 19:44, Eugene Kirpichov <ekirpic... at gmail.com> wrote:

> in fact the consumer remains visible in the management
> interface for many hours after these events, holding the
> unacknowledged message.

Are you using heartbeat property for the connection?
In my opinion using that parameter should avoid that persistent
connection on the server.



Regards,


From ekirpichov at gmail.com  Tue Sep 20 12:29:01 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Tue, 20 Sep 2011 15:29:01 +0400
Subject: [rabbitmq-discuss] .NET Client - IModel.Close completes but the
 model is never actually shut down.
In-Reply-To: <fa06d369-c4ce-4b89-bd37-8e52f139a979@i2g2000yqm.googlegroups.com>
References: <CANVKUrWyc10+8EXNPQ5Z8D__uhW5GZenWjGWgf7+x88jxmF4zA@mail.gmail.com>
	<fa06d369-c4ce-4b89-bd37-8e52f139a979@i2g2000yqm.googlegroups.com>
Message-ID: <CANVKUrXNuSEXFMMoE3Xp=R2UhN1vFBp-R8RsogM62WE20GqY4g@mail.gmail.com>

To not provoke false worrying, I'm notifying the community that I'm
already not that sure that this is a bug in the client - might be
somewhere in my code.

I think so because examining the memory dump has shown that not even
the first line of the Close() method has been executed - the one that
subscribes to SessionShutdown.

I'll keep you tuned when I know more.

On Tue, Sep 20, 2011 at 2:49 PM, Alfonso Pantoja
<alfonso.pantoja at gmail.com> wrote:
> Hi Eugene,
>
>
> On 19 sep, 19:44, Eugene Kirpichov <ekirpic... at gmail.com> wrote:
>
>> in fact the consumer remains visible in the management
>> interface for many hours after these events, holding the
>> unacknowledged message.
>
> Are you using heartbeat property for the connection?
> In my opinion using that parameter should avoid that persistent
> connection on the server.
>
>
>
> Regards,
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From bob_claerhout at hotmail.com  Tue Sep 20 14:26:44 2011
From: bob_claerhout at hotmail.com (Bob Claerhout)
Date: Tue, 20 Sep 2011 15:26:44 +0200
Subject: [rabbitmq-discuss] erlang closes after startup
Message-ID: <SNT103-DS14E7F5CD222A258DB695E5800A0@phx.gbl>

Hi all,

 

Everything is going well with rabbitmq so far. I was testing under windows
but now I want to migrate to linux, more specific: centos 5

Executing rabbitmq on this centos goes well until I want to use the
management plugin.

As given in  <http://pastebin.com/71ADq78Q> http://pastebin.com/71ADq78Q you
can see that the plugins are loaded but at the end, erlang closes.

The result is that I can not access the management plugin from a browser or
from command line.

I have following logs:

 

rabbit at server.log                           <http://pastebin.com/Y19KbmK8>
http://pastebin.com/Y19KbmK8

rabbit at server-sasl.log                 <http://pastebin.com/ef7BFh58>
http://pastebin.com/ef7BFh58

 

any suggestions?

Thx in advance!

Bob Claerhout

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110920/51908a49/attachment.htm>

From simon at rabbitmq.com  Tue Sep 20 14:30:19 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 20 Sep 2011 14:30:19 +0100
Subject: [rabbitmq-discuss] erlang closes after startup
In-Reply-To: <SNT103-DS14E7F5CD222A258DB695E5800A0@phx.gbl>
References: <SNT103-DS14E7F5CD222A258DB695E5800A0@phx.gbl>
Message-ID: <4E78956B.5050109@rabbitmq.com>

On 20/09/11 14:26, Bob Claerhout wrote:
> Everything is going well with rabbitmq so far. I was testing under
> windows but now I want to migrate to linux, more specific: centos 5
>
> Executing rabbitmq on this centos goes well until I want to use the
> management plugin.

Your version of Erlang (R12B3) is too old. You need at least R13B01:

http://www.rabbitmq.com/management.html#erlang

But the newer the better.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From jeremyalan at gmail.com  Tue Sep 20 15:27:15 2011
From: jeremyalan at gmail.com (jeremyalan)
Date: Tue, 20 Sep 2011 07:27:15 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ, SSL, .NET Client
In-Reply-To: <CAM2MZuf6evN_Aeecoif-2cJPEVsrGNB3KN05YPvRAT_-XjP07Q@mail.gmail.com>
References: <CAM2MZuf6evN_Aeecoif-2cJPEVsrGNB3KN05YPvRAT_-XjP07Q@mail.gmail.com>
Message-ID: <32501073.post@talk.nabble.com>


Rather than using our provided certificates, I've tried plugging in the
example certificates shipped with the Erlang SSL package, found here:

C:\Program Files (x86)\erl5.8.4\lib\ssl-4.1.5\examples\certs\etc\server

Now I get the following error message in the log:

=INFO REPORT==== 20-Sep-2011::09:23:25 ===
starting TCP connection <0.431.0> from [::1]:49773

=ERROR REPORT==== 20-Sep-2011::09:23:25 ===
SSL: hello: ./ssl_record.erl:364:Fatal error: record overflow

=ERROR REPORT==== 20-Sep-2011::09:23:25 ===
error on TCP connection <0.431.0>:{ssl_upgrade_error,"record overflow"}

=INFO REPORT==== 20-Sep-2011::09:23:25 ===
closing TCP connection <0.431.0>


Any ideas?

TIA,
-Jeremy

-- 
View this message in context: http://old.nabble.com/RabbitMQ%2C-SSL%2C-.NET-Client-tp32497061p32501073.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Tue Sep 20 16:01:15 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 20 Sep 2011 16:01:15 +0100
Subject: [rabbitmq-discuss] RabbitMQ, SSL, .NET Client
In-Reply-To: <32501073.post@talk.nabble.com>
References: <CAM2MZuf6evN_Aeecoif-2cJPEVsrGNB3KN05YPvRAT_-XjP07Q@mail.gmail.com>
	<32501073.post@talk.nabble.com>
Message-ID: <4E78AABB.20806@rabbitmq.com>

Hi Jeremy,

On 20/09/11 15:27, jeremyalan wrote:
> 
> Rather than using our provided certificates, I've tried plugging in the
> example certificates shipped with the Erlang SSL package, found here:
> 
> C:\Program Files (x86)\erl5.8.4\lib\ssl-4.1.5\examples\certs\etc\server

For a test I would instead suggest creating certificates in the way
described here:
http://www.rabbitmq.com/ssl.html

The common name (CN) field is expected to contain the hostname.

> =ERROR REPORT==== 20-Sep-2011::09:23:25 ===
> SSL: hello: ./ssl_record.erl:364:Fatal error: record overflow

It is possible that you are attempting to connect to the SSL port with a
client that is not configured to use SSL. Could that be the case?
Confirm the port numbers that are set up in your configuration file.


-Emile

From jeremyalan at gmail.com  Tue Sep 20 18:14:02 2011
From: jeremyalan at gmail.com (jeremyalan)
Date: Tue, 20 Sep 2011 10:14:02 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ, SSL, .NET Client
In-Reply-To: <32501073.post@talk.nabble.com>
References: <CAM2MZuf6evN_Aeecoif-2cJPEVsrGNB3KN05YPvRAT_-XjP07Q@mail.gmail.com>
	<32501073.post@talk.nabble.com>
Message-ID: <32501087.post@talk.nabble.com>


> For a test I would instead suggest creating certificates in the way
> described here:
> http://www.rabbitmq.com/ssl.html

I've attempted to regenerate self-signed certificates, and have not had any
luck getting the .NET client to connect.  I tried loading the certs in .pem
format, but that didn't work, apparently because .NET does not work well
with PEM files, so I converted them to .cer format, using the following
command:

openssl x509 -in <filename>.pem -out <filename>.cer -outform DER

I also converted the key .pem to a .p12 file, using the following command:

openssl pkcs12 -export -out keycert.p12 -in cert.pem -inkey key.pem -passout
pass:MySecretPassword

> The common name (CN) field is expected to contain the hostname.

I'm not sure what the proper hostname should be, since everything is running
on localhost.  As mentioned in the tutorial, I am using the following .NET
client configuration to avoid any errors.

AcceptablePolicyErrors = SslPolicyErrors.RemoteCertificateNameMismatch

> It is possible that you are attempting to connect to the SSL port with a
> client that is not configured to use SSL. Could that be the case?
> Confirm the port numbers that are set up in your configuration file.

The port numbers are configured properly.  I can't say for sure, but it
appears that the record overflow is thrown when I attempt to serve a
certificate format that is not supported by the .NET client (e.g., PEM).

Thanks for your continued efforts.  Is there anything else I can try that
might provide more information, or hopefully come to a resolution?
-- 
View this message in context: http://old.nabble.com/RabbitMQ%2C-SSL%2C-.NET-Client-tp32497061p32501087.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From emile at rabbitmq.com  Tue Sep 20 21:02:12 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 20 Sep 2011 21:02:12 +0100
Subject: [rabbitmq-discuss] RabbitMQ, SSL, .NET Client
In-Reply-To: <32501087.post@talk.nabble.com>
References: <CAM2MZuf6evN_Aeecoif-2cJPEVsrGNB3KN05YPvRAT_-XjP07Q@mail.gmail.com>	<32501073.post@talk.nabble.com>
	<32501087.post@talk.nabble.com>
Message-ID: <4E78F144.8000307@rabbitmq.com>

Hi Jeremy,

Op 20/09/11 18:14, het jeremyalan geskryf:
> 
>> For a test I would instead suggest creating certificates in the way
>> described here:
>> http://www.rabbitmq.com/ssl.html
> 
> I've attempted to regenerate self-signed certificates, and have not had any
> luck getting the .NET client to connect.  I tried loading the certs in .pem
> format, but that didn't work, apparently because .NET does not work well
> with PEM files, so I converted them to .cer format, using the following
> command:

The need for DER format and the required openssl commands are documented
here:
https://www.rabbitmq.com/ssl.html#keys-and-certs

>> The common name (CN) field is expected to contain the hostname.
> 
> I'm not sure what the proper hostname should be, since everything is running
> on localhost.  

On Windows you can substitute %COMPUTERNAME%.

>> It is possible that you are attempting to connect to the SSL port with a
>> client that is not configured to use SSL. Could that be the case?
>> Confirm the port numbers that are set up in your configuration file.
> 
> The port numbers are configured properly.  I can't say for sure

The default (unencrypted) AMQP port is specified as 5672 in the protocol
and the default SSL port is defined as 5671 in the AmqpTcpEndpoint class.

The following diagnostic test can help to distinguish between the two
kinds of ports.

non-SSL test:
If you connect to the port using telnet or netcat, and send the string
"AMQP^A^A^I^A" then you will either get a reply from the server or the
connection will close. If you get a reply containing "PLAIN AMQPLAIN"
then you have connected to a non-SSL port. If the connection drops while
generating "record overflow" broker logfile entries then try the SSL test.

SSL test:
If you connect with "openssl s_client -connect <host>:<port>" and an SSL
session gets established then you have connected to an SSL port.
(Sending "AMQP^A^A^I^A" and carriage return at this point should also
yield output containing "PLAIN AMQPLAIN".) If you get an "unknown
protocol" SSL error then you are probably not connecting to an SSL port
- try the non-SSL test.

The error message you report is consistent with attempting to establish
a non-SSL connection to a port on the server which expects SSL
connections. Carefully check the broker configuration file ensuring that
the results from the  diagnostic tests are consistent with it. Then
check that the default example works correctly before elaborating on it:
https://www.rabbitmq.com/ssl.html#code-snippet



-Emile

From matthewbaldwin at comcast.net  Tue Sep 20 22:48:36 2011
From: matthewbaldwin at comcast.net (matthewbaldwin at comcast.net)
Date: Tue, 20 Sep 2011 21:48:36 +0000 (UTC)
Subject: [rabbitmq-discuss] Installing rabbit.js on Ubuntu 11.04 - Natty
Message-ID: <1628993962.1056251.1316555316147.JavaMail.root@sz0073a.westchester.pa.mail.comcast.net>

Just wanted to post a quick notice on the steps I took to get node.js, rabbit.js installed on Ubuntu 11.04 running RabbitMQ 2.6.1 with the RabbitMQ plugins. 

While the formatting is not all that great. It shows how to get this working with the provided example. I hope it helps someone else out in their journey. 

http://vbatik.blogspot.com/2011/09/installing-rabbitjs-on-ubuntu-1104.html 

/mdb 

matthewbaldwin BIGDOT comcast BIGDOT com 
mbaldwin BIGDOT vmware BIGDOT com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110920/400b901c/attachment.htm>

From phenisha at gmail.com  Wed Sep 21 01:56:35 2011
From: phenisha at gmail.com (Nathan)
Date: Wed, 21 Sep 2011 10:56:35 +1000
Subject: [rabbitmq-discuss] ldap authentication
In-Reply-To: <4E77DF68.2000707@rabbitmq.com>
References: <4E76DCDE.2060704@gmail.com> <4E76F3F0.9070800@rabbitmq.com>
	<4E77DC9D.1060606@gmail.com> <4E77DF68.2000707@rabbitmq.com>
Message-ID: <4E793643.703@gmail.com>

On 09/20/2011 10:33 AM, Matthias Radestock wrote:
> On 20/09/11 01:21, Nathan wrote:
>> when i change it back to rabbitmq_auth_backend_internal
>> none of my local users can authenticate?
>
> That needs to be rabbit_auth_backend_internal, no "mq". That rule 
> generally applies to the contents of auth_backends, since it refers to 
> Erlang modules, which we usually name rabbit_*, whereas our Erlang 
> applications (and hence config settings) are usually named rabbitmq_*. 
> Except for the rabbit application, which is just called 'rabbit'. 
> Confused yet?
>
> Matthias.

Ok now I have local auth back, thanks (and for the record I am confused)!

My current config looks like the following

[
  {rabbitmq_stomp, [{tcp_listeners, [6163]} ]},
  {rabbit, [{auth_backends, [rabbit_auth_backend_internal,  
rabbitmq_auth_backend_ldap]}]  },
  {rabbitmq_auth_backend_ldap,
   [ {servers,               ["ldap.zozee.com"]},
     {user_dn_pattern,       "uid=${username},ou=people,dc=zozee,dc=com"},
     {vhost_access_query,    
{exists,"ou=${vhost},ou=people,dc=zozee,dc=com"}},
     {resource_access_query,
       {for, [{resource, exchange,{for, [{permission, configure,
                                          { in_group, 
"cn=zozee,ou=groups,dc=zozee,dc=com" }
                                         },
                                         {permission, write, {constant, 
true}},
                                         {permission, read,  {constant, 
true}}
                                        ]}},
              {resource, queue, {constant, true}} ]}},
       {tag_queries,           [{administrator, {constant, false}}]},
       {use_ssl,               false},
       {port,                  389},
       {log,                   true} ] }
].


How ever I am still seeing errors in the log, as follows


=INFO REPORT==== 21-Sep-2011::10:54:01 ===
accepted TCP connection on [::]:5672 from 172.16.0.51:40465

=INFO REPORT==== 21-Sep-2011::10:54:01 ===
starting TCP connection <0.1343.0> from 172.16.0.51:40465

=ERROR REPORT==== 21-Sep-2011::10:54:04 ===
exception on TCP connection <0.1343.0> from 172.16.0.51:40465
{channel0_error,starting,
     {error,undef,'connection.start_ok',
         [{rabbitmq_auth_backend_ldap,check_user_login,
              [<<"testguy">>,[{password,<<"testldappw">>}]]},
          {rabbit_access_control,'-check_user_login/2-fun-0-',4},
          {lists,foldl,3},
          {rabbit_reader,auth_phase,2},
          {rabbit_reader,handle_method0,3},
          {rabbit_reader,handle_input,3},
          {rabbit_reader,recvloop,2},
          {rabbit_reader,start_connection,7}]}}

=INFO REPORT==== 21-Sep-2011::10:54:04 ===
closing TCP connection <0.1343.0> from 172.16.0.51:40465


Now, it looks like that it is trying to use the ldap module however i 
can not see any
connections on my ldap server from the rabbitmq server.

From matthias at rabbitmq.com  Wed Sep 21 02:05:50 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 21 Sep 2011 02:05:50 +0100
Subject: [rabbitmq-discuss] ldap authentication
In-Reply-To: <4E793643.703@gmail.com>
References: <4E76DCDE.2060704@gmail.com>
	<4E76F3F0.9070800@rabbitmq.com>	<4E77DC9D.1060606@gmail.com>
	<4E77DF68.2000707@rabbitmq.com> <4E793643.703@gmail.com>
Message-ID: <4E79386E.1040706@rabbitmq.com>

On 21/09/11 01:56, Nathan wrote:
> On 09/20/2011 10:33 AM, Matthias Radestock wrote:
>> That needs to be rabbit_auth_backend_internal, no "mq". That rule
>> generally applies to the contents of auth_backends, since it refers to
>> Erlang modules, which we usually name rabbit_*, whereas our Erlang
>> applications (and hence config settings) are usually named rabbitmq_*.
>> Except for the rabbit application, which is just called 'rabbit'.
>> Confused yet?
>>
>> Matthias.
>
> Ok now I have local auth back, thanks (and for the record I am confused)!
>
> My current config looks like the following
>
> [
> {rabbitmq_stomp, [{tcp_listeners, [6163]} ]},
> {rabbit, [{auth_backends, [rabbit_auth_backend_internal,
> rabbitmq_auth_backend_ldap]}] },

That should be rabbit_auth_backend_ldap. No "mq". As per the 
aforementioned rule.


Matthias.

From phenisha at gmail.com  Wed Sep 21 02:30:32 2011
From: phenisha at gmail.com (Nathan)
Date: Wed, 21 Sep 2011 11:30:32 +1000
Subject: [rabbitmq-discuss] ldap authentication
In-Reply-To: <4E79386E.1040706@rabbitmq.com>
References: <4E76DCDE.2060704@gmail.com>
	<4E76F3F0.9070800@rabbitmq.com>	<4E77DC9D.1060606@gmail.com>
	<4E77DF68.2000707@rabbitmq.com> <4E793643.703@gmail.com>
	<4E79386E.1040706@rabbitmq.com>
Message-ID: <4E793E38.7030506@gmail.com>


> That should be rabbit_auth_backend_ldap. No "mq". As per the 
> aforementioned rule.
>
>
> Matthias.
Doh,

Got it working Thanks for the tips!

Nathan

From sameek at arosys.com  Wed Sep 21 06:27:17 2011
From: sameek at arosys.com (sam_mis)
Date: Tue, 20 Sep 2011 22:27:17 -0700 (PDT)
Subject: [rabbitmq-discuss]  Streaming Lightweight Publisher Confirms ?
Message-ID: <32503713.post@talk.nabble.com>


Hi

I want to make sure using channel confirmation.i have following question
using Streaming Lightweight Publisher Confirms:

1.if publish send message from queue and consumer doesn't return any
acknowledgement in this case broker what to do? 

2. if broker is restart or crash in this period,it can store the
unacknowledged message and resend to consumer. 

Thanks
-- 
View this message in context: http://old.nabble.com/Streaming-Lightweight-Publisher-Confirms---tp32503713p32503713.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sameek at arosys.com  Wed Sep 21 07:03:02 2011
From: sameek at arosys.com (sameekmishra)
Date: Tue, 20 Sep 2011 23:03:02 -0700 (PDT)
Subject: [rabbitmq-discuss]  can two or  consumer will work on same queue?
Message-ID: <32503714.post@talk.nabble.com>


Hi 

I have situation where i want to know that two or more consumer will work
together in same queue.
if yes then i have doubt:

1. if one consumer takes message from queue another can't take same
message,it need to be configured or any deadlock condition is raise.

Thanks
-- 
View this message in context: http://old.nabble.com/can-two-or--consumer-will-work-on-same-queue--tp32503714p32503714.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From ekirpichov at gmail.com  Wed Sep 21 07:07:10 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 21 Sep 2011 10:07:10 +0400
Subject: [rabbitmq-discuss] Streaming Lightweight Publisher Confirms ?
In-Reply-To: <32503713.post@talk.nabble.com>
References: <32503713.post@talk.nabble.com>
Message-ID: <CANVKUrXjkjKLjH_f4CE2AFBgYWk8ng_xp=EFOoj6PO1MHkX6cg@mail.gmail.com>

Hi,
A confirm means "Server has reliably stored your message and you can
stop worrying about whether or not it will survive a server crash". It
has absolutely nothing to do with consumer acks.
I hope this answers both of your questions.

On Wed, Sep 21, 2011 at 9:27 AM, sam_mis <sameek at arosys.com> wrote:
>
> Hi
>
> I want to make sure using channel confirmation.i have following question
> using Streaming Lightweight Publisher Confirms:
>
> 1.if publish send message from queue and consumer doesn't return any
> acknowledgement in this case broker what to do?
>
> 2. if broker is restart or crash in this period,it can store the
> unacknowledged message and resend to consumer.
>
> Thanks
> --
> View this message in context: http://old.nabble.com/Streaming-Lightweight-Publisher-Confirms---tp32503713p32503713.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From ekirpichov at gmail.com  Wed Sep 21 07:08:36 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 21 Sep 2011 10:08:36 +0400
Subject: [rabbitmq-discuss] can two or consumer will work on same queue?
In-Reply-To: <32503714.post@talk.nabble.com>
References: <32503714.post@talk.nabble.com>
Message-ID: <CANVKUrXFtB5qtdyHOOgANHLHpXhUtRDQNtEmUYic9hTOVSkuJA@mail.gmail.com>

Hi,
RabbitMQ will not send the same message to multiple consumers at once.
It will roundrobin, and will only resend the message to someone else
in case connection with the consumer is lost before receiving the
consumer's ack for the message (usually due to a consumer crash).

On Wed, Sep 21, 2011 at 10:03 AM, sameekmishra <sameek at arosys.com> wrote:
>
> Hi
>
> I have situation where i want to know that two or more consumer will work
> together in same queue.
> if yes then i have doubt:
>
> 1. if one consumer takes message from queue another can't take same
> message,it need to be configured or any deadlock condition is raise.
>
> Thanks
> --
> View this message in context: http://old.nabble.com/can-two-or--consumer-will-work-on-same-queue--tp32503714p32503714.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From bob_claerhout at hotmail.com  Wed Sep 21 08:34:57 2011
From: bob_claerhout at hotmail.com (Bob Claerhout)
Date: Wed, 21 Sep 2011 09:34:57 +0200
Subject: [rabbitmq-discuss] erlang closes after startup
In-Reply-To: <4E78956B.5050109@rabbitmq.com>
References: <SNT103-DS14E7F5CD222A258DB695E5800A0@phx.gbl>
	<4E78956B.5050109@rabbitmq.com>
Message-ID: <SNT103-DS111475F79F02DF083AAA69800D0@phx.gbl>

Stupid me, this worked for me!
Thanks!

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Simon
MacMullen
Sent: dinsdag 20 september 2011 15:30
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] erlang closes after startup

On 20/09/11 14:26, Bob Claerhout wrote:
> Everything is going well with rabbitmq so far. I was testing under 
> windows but now I want to migrate to linux, more specific: centos 5
>
> Executing rabbitmq on this centos goes well until I want to use the 
> management plugin.

Your version of Erlang (R12B3) is too old. You need at least R13B01:

http://www.rabbitmq.com/management.html#erlang

But the newer the better.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexandru at rabbitmq.com  Wed Sep 21 09:56:24 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Wed, 21 Sep 2011 09:56:24 +0100
Subject: [rabbitmq-discuss] Streaming Lightweight Publisher Confirms ?
In-Reply-To: <CANVKUrXjkjKLjH_f4CE2AFBgYWk8ng_xp=EFOoj6PO1MHkX6cg@mail.gmail.com>
References: <32503713.post@talk.nabble.com>
	<CANVKUrXjkjKLjH_f4CE2AFBgYWk8ng_xp=EFOoj6PO1MHkX6cg@mail.gmail.com>
Message-ID: <20110921085624.GB3154@southbank.eng.vmware.com>

> A confirm means "Server has reliably stored your message and you can
> stop worrying about whether or not it will survive a server crash". It
> has absolutely nothing to do with consumer acks.

Well, the broker will confirm a message when it has been persisted to
disk *or* when is has been delivered to a consumer for each queue it was
on and those consumers ack'd the message.

> "Server has reliably stored your message and you can
> stop worrying about whether or not it will survive a server crash". 

That's the correct rule of thumb.

Alex

On Wed, Sep 21, 2011 at 10:07:10AM +0400, Eugene Kirpichov wrote:
> Hi,
> A confirm means "Server has reliably stored your message and you can
> stop worrying about whether or not it will survive a server crash". It
> has absolutely nothing to do with consumer acks.
> I hope this answers both of your questions.
> 
> On Wed, Sep 21, 2011 at 9:27 AM, sam_mis <sameek at arosys.com> wrote:
> >
> > Hi
> >
> > I want to make sure using channel confirmation.i have following question
> > using Streaming Lightweight Publisher Confirms:
> >
> > 1.if publish send message from queue and consumer doesn't return any
> > acknowledgement in this case broker what to do?
> >
> > 2. if broker is restart or crash in this period,it can store the
> > unacknowledged message and resend to consumer.
> >
> > Thanks
> > --
> > View this message in context: http://old.nabble.com/Streaming-Lightweight-Publisher-Confirms---tp32503713p32503713.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com.
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> 
> 
> 
> -- 
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From raphael.degiusti at guardis.com  Wed Sep 21 10:43:14 2011
From: raphael.degiusti at guardis.com (=?ISO-8859-1?Q?Rapha=EBl_De_GIUSTI?=)
Date: Wed, 21 Sep 2011 11:43:14 +0200
Subject: [rabbitmq-discuss] Pika from master branch - All messages arrive in
	1 shot
Message-ID: <CAFw-dimMUyHW0x8nrj1UTK5gAz-S_1W5+Rd=_vUNtf_ZfAziug@mail.gmail.com>

Hi everyone,

When I'm running the demo_receive / demo_send example with pika from the
master branch (pre0.9.6 i think), I'm getting a strange behaviour.

It seems that demo_send sends its 10 messages before demo_receive actually
receive everything in one shot. It results in a tcp backpressure problem.

In pika 0.9.5 example, demo_receive consumes a message 1 by 1, as it
arrives, and acks it, this is what I expect.

Here's the output from both scripts (I added a 0.5sec sleep after sending a
message to see what's happening) :

demo_receive:
> demo_receive: Connected to RabbitMQ
> demo_receive: Received our Channel
> demo_receive: Queue Declared
> Basic.Deliver text/plain delivery-tag 1: Hello World #0:
> 1316597081.62437701
> Basic.Deliver text/plain delivery-tag 2: Hello World #1:
> 1316597082.62570310
> Basic.Deliver text/plain delivery-tag 3: Hello World #2:
> 1316597083.62713790
> Basic.Deliver text/plain delivery-tag 4: Hello World #3:
> 1316597084.62860394
> Basic.Deliver text/plain delivery-tag 5: Hello World #4:
> 1316597085.63100100
> Basic.Deliver text/plain delivery-tag 6: Hello World #5:
> 1316597086.63265109
> Basic.Deliver text/plain delivery-tag 7: Hello World #6:
> 1316597087.63385701
> Basic.Deliver text/plain delivery-tag 8: Hello World #7:
> 1316597088.63560796
> Basic.Deliver text/plain delivery-tag 9: Hello World #8:
> 1316597089.63728094
> Basic.Deliver text/plain delivery-tag 10: Hello World #9:
> 1316597090.63895893




>

demo_send:
> INFO:pika:Connecting to 127.0.0.1:5672
> demo_send: Connected to RabbitMQ
> demo_send: Received our Channel
> demo_send: Queue Declared
> demo_send: Sent Hello World #0: 1316597081.62437701
> demo_send: Sent Hello World #1: 1316597082.62570310
> demo_send: Sent Hello World #2: 1316597083.62713790
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 500 bytes and an estimated 10 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> demo_send: Sent Hello World #3: 1316597084.62860394
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 521 bytes and an estimated 11 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 582 bytes and an estimated 12 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 625 bytes and an estimated 13 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> demo_send: Sent Hello World #4: 1316597085.63100100
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 646 bytes and an estimated 14 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 707 bytes and an estimated 15 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 750 bytes and an estimated 16 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> demo_send: Sent Hello World #5: 1316597086.63265109
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 771 bytes and an estimated 17 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 832 bytes and an estimated 18 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 875 bytes and an estimated 19 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> demo_send: Sent Hello World #6: 1316597087.63385701
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 896 bytes and an estimated 20 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 957 bytes and an estimated 21 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 1000 bytes and an estimated 22 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> demo_send: Sent Hello World #7: 1316597088.63560796
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 1021 bytes and an estimated 23 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 1082 bytes and an estimated 24 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 1125 bytes and an estimated 25 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> demo_send: Sent Hello World #8: 1316597089.63728094
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 1146 bytes and an estimated 26 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 1207 bytes and an estimated 27 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 1250 bytes and an estimated 28 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> demo_send: Sent Hello World #9: 1316597090.63895893
> demo_send: Closing
> INFO:pika:Closing connection: 200 - Normal shutdown
> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
> threshold at 1284 bytes and an estimated 29 frames behind
>   warn(message % (self.outbound_buffer.size, est_frames_behind))
> INFO:pika:Disconnected from RabbitMQ at 127.0.0.1:5672


My question is :  why all 10 messages arrive in one shot ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110921/de78e1af/attachment.htm>

From simon at rabbitmq.com  Wed Sep 21 10:46:35 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 21 Sep 2011 10:46:35 +0100
Subject: [rabbitmq-discuss] ldap authentication
In-Reply-To: <4E793E38.7030506@gmail.com>
References: <4E76DCDE.2060704@gmail.com>	<4E76F3F0.9070800@rabbitmq.com>	<4E77DC9D.1060606@gmail.com>	<4E77DF68.2000707@rabbitmq.com>
	<4E793643.703@gmail.com>	<4E79386E.1040706@rabbitmq.com>
	<4E793E38.7030506@gmail.com>
Message-ID: <4E79B27B.80607@rabbitmq.com>

On 21/09/11 02:30, Nathan wrote:
> Got it working Thanks for the tips!

Cool, and sorry for the confusion.

Incidentally I'd be interested in any feedback you have on the LDAP 
plugin - I haven't really heard back from any users since I wrote it...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mikeb at rabbitmq.com  Wed Sep 21 10:51:10 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 21 Sep 2011 10:51:10 +0100
Subject: [rabbitmq-discuss] Installing rabbit.js on Ubuntu 11.04 - Natty
In-Reply-To: <1628993962.1056251.1316555316147.JavaMail.root@sz0073a.westchester.pa.mail.comcast.net>
References: <1628993962.1056251.1316555316147.JavaMail.root@sz0073a.westchester.pa.mail.comcast.net>
Message-ID: <4E79B38E.4080507@rabbitmq.com>

Hi Matthew,

> http://vbatik.blogspot.com/2011/09/installing-rabbitjs-on-ubuntu-1104.html

Nice one, thanks -- have fun with rabbit.js!

-Michael

From majek04 at gmail.com  Wed Sep 21 12:14:58 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 21 Sep 2011 12:14:58 +0100
Subject: [rabbitmq-discuss] Pika from master branch - All messages
 arrive in 1 shot
In-Reply-To: <CAFw-dimMUyHW0x8nrj1UTK5gAz-S_1W5+Rd=_vUNtf_ZfAziug@mail.gmail.com>
References: <CAFw-dimMUyHW0x8nrj1UTK5gAz-S_1W5+Rd=_vUNtf_ZfAziug@mail.gmail.com>
Message-ID: <CABzX+qw9Zf22d+41tXEeE8iy5jOLesOvXqyFuDvxPuLH_YRzXA@mail.gmail.com>

2011/9/21 Rapha?l De GIUSTI <raphael.degiusti at guardis.com>:
> When I'm running the demo_receive / demo_send example with pika from the
> master branch (pre0.9.6 i think), I'm getting a strange behaviour.
> It seems that demo_send sends its 10 messages before demo_receive actually
> receive everything in one shot. It results in a tcp backpressure problem.
> In pika 0.9.5 example, demo_receive consumes a message 1 by 1, as it
> arrives, and acks it, this is what I expect.
> Here's the output from both scripts (I added a 0.5sec sleep after sending a
> message to see what's happening) :
>
> My question is : ?why all 10 messages arrive in one shot ?

That's an expected behaviour for AMQP. Take look at 'basic_qos' command.
Also, you can find our tutorials insteresting. Prose:
    http://www.rabbitmq.com/getstarted.html
code:
    https://github.com/rabbitmq/rabbitmq-tutorials/tree/master/python

Especially tutorial 2 which speaks about basic_qos:
    http://www.rabbitmq.com/tutorials/tutorial-two-python.html

Cheers,
   Marek

From sameek at arosys.com  Wed Sep 21 12:16:22 2011
From: sameek at arosys.com (sameekmishra)
Date: Wed, 21 Sep 2011 04:16:22 -0700 (PDT)
Subject: [rabbitmq-discuss] Streaming Lightweight Publisher Confirms ?
In-Reply-To: <32503713.post@talk.nabble.com>
References: <32503713.post@talk.nabble.com>
Message-ID: <32503737.post@talk.nabble.com>




sameekmishra wrote:
> 
> Hi
> 
> I want to make sure using channel confirmation.i have following question
> using Streaming Lightweight Publisher Confirms:
> 
> 1.if publish send message from queue and consumer doesn't return any
> acknowledgement in this case broker what to do? 
> 
> 2. if broker is restart or crash in this period,it can store the
> unacknowledged message and resend to consumer. 
> 
> 3. Is there is method to check all Publisher Confirmation.
> 
> Thanks
> 

-- 
View this message in context: http://old.nabble.com/Streaming-Lightweight-Publisher-Confirms---tp32503713p32503737.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From sameek at arosys.com  Wed Sep 21 12:19:14 2011
From: sameek at arosys.com (sameekmishra)
Date: Wed, 21 Sep 2011 04:19:14 -0700 (PDT)
Subject: [rabbitmq-discuss]  Streaming Lightweight Publisher Confirms ?
Message-ID: <32503738.post@talk.nabble.com>


Hi
 
 I want to make sure using channel confirmation.i have following 
 question using Streaming Lightweight Publisher Confirms:
 
 1.if publish send message from queue and consumer doesn't return any 
 acknowledgement in this case broker what to do?
 
 2. if broker is restart or crash in this period,it can store the 
 unacknowledged message and resend to consumer.

 3. Is there is method to check all Publisher Confirmation.

 Thanks

-- 
View this message in context: http://old.nabble.com/Streaming-Lightweight-Publisher-Confirms---tp32503738p32503738.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From gmr at myyearbook.com  Wed Sep 21 14:53:33 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 21 Sep 2011 09:53:33 -0400
Subject: [rabbitmq-discuss] Pika from master branch - All messages
 arrive in 1 shot
In-Reply-To: <CAFw-dimMUyHW0x8nrj1UTK5gAz-S_1W5+Rd=_vUNtf_ZfAziug@mail.gmail.com>
References: <CAFw-dimMUyHW0x8nrj1UTK5gAz-S_1W5+Rd=_vUNtf_ZfAziug@mail.gmail.com>
Message-ID: <746D19F9C5384D1C876777EC6875CC83@myyearbook.com>

 It's worth noting that I do not consider the github master branch stable. If you're looking for the stable branch, make sure you're using 0.9.5.  

Gavin  


On Wednesday, September 21, 2011 at 5:43 AM, Rapha?l De GIUSTI wrote:

> Hi everyone,
>  
> When I'm running the demo_receive / demo_send example with pika from the master branch (pre0.9.6 i think), I'm getting a strange behaviour.
>  
> It seems that demo_send sends its 10 messages before demo_receive actually receive everything in one shot. It results in a tcp backpressure problem.  
>  
> In pika 0.9.5 example, demo_receive consumes a message 1 by 1, as it arrives, and acks it, this is what I expect.
>  
> Here's the output from both scripts (I added a 0.5sec sleep after sending a message to see what's happening) :  
>  
> > >  demo_receive:
> > > demo_receive: Connected to RabbitMQ
> > > demo_receive: Received our Channel
> > > demo_receive: Queue Declared
> > > Basic.Deliver text/plain delivery-tag 1: Hello World #0: 1316597081.62437701
> > > Basic.Deliver text/plain delivery-tag 2: Hello World #1: 1316597082.62570310
> > >  Basic.Deliver text/plain delivery-tag 3: Hello World #2: 1316597083.62713790
> > > Basic.Deliver text/plain delivery-tag 4: Hello World #3: 1316597084.62860394
> > > Basic.Deliver text/plain delivery-tag 5: Hello World #4: 1316597085.63100100
> > >  Basic.Deliver text/plain delivery-tag 6: Hello World #5: 1316597086.63265109
> > > Basic.Deliver text/plain delivery-tag 7: Hello World #6: 1316597087.63385701
> > > Basic.Deliver text/plain delivery-tag 8: Hello World #7: 1316597088.63560796
> > >  Basic.Deliver text/plain delivery-tag 9: Hello World #8: 1316597089.63728094
> > > Basic.Deliver text/plain delivery-tag 10: Hello World #9: 1316597090.63895893
> >  
> > >  demo_send:
> > > INFO:pika:Connecting to 127.0.0.1:5672 (http://127.0.0.1:5672)
> > > demo_send: Connected to RabbitMQ
> > > demo_send: Received our Channel
> > > demo_send: Queue Declared
> > > demo_send: Sent Hello World #0: 1316597081.62437701
> > >  demo_send: Sent Hello World #1: 1316597082.62570310
> > > demo_send: Sent Hello World #2: 1316597083.62713790
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 500 bytes and an estimated 10 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > demo_send: Sent Hello World #3: 1316597084.62860394
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 521 bytes and an estimated 11 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 582 bytes and an estimated 12 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > >  ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 625 bytes and an estimated 13 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > demo_send: Sent Hello World #4: 1316597085.63100100
> > >  ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 646 bytes and an estimated 14 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 707 bytes and an estimated 15 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 750 bytes and an estimated 16 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > >  demo_send: Sent Hello World #5: 1316597086.63265109
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 771 bytes and an estimated 17 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > >  ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 832 bytes and an estimated 18 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 875 bytes and an estimated 19 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > demo_send: Sent Hello World #6: 1316597087.63385701
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 896 bytes and an estimated 20 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 957 bytes and an estimated 21 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > >  ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1000 bytes and an estimated 22 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > demo_send: Sent Hello World #7: 1316597088.63560796
> > >  ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1021 bytes and an estimated 23 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1082 bytes and an estimated 24 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1125 bytes and an estimated 25 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > >  demo_send: Sent Hello World #8: 1316597089.63728094
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1146 bytes and an estimated 26 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > >  ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1207 bytes and an estimated 27 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1250 bytes and an estimated 28 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > demo_send: Sent Hello World #9: 1316597090.63895893
> > > demo_send: Closing
> > > INFO:pika:Closing connection: 200 - Normal shutdown
> > > ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1284 bytes and an estimated 29 frames behind
> > >  warn(message % (self.outbound_buffer.size, est_frames_behind))
> > > INFO:pika:Disconnected from RabbitMQ at 127.0.0.1:5672 (http://127.0.0.1:5672)
>  
> My question is : why all 10 messages arrive in one shot ?  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110921/e1b1b785/attachment.htm>

From mkovachmcse at aol.com  Wed Sep 21 15:30:56 2011
From: mkovachmcse at aol.com (Mark K)
Date: Wed, 21 Sep 2011 14:30:56 +0000 (UTC)
Subject: [rabbitmq-discuss] check if queue is empty?
References: <215fb2b7-6276-49d6-bcb1-4cb1dd876641@35g2000prp.googlegroups.com>
	<A3CDF983836444E3915A3C0EE62E42D8@myyearbook.com>
Message-ID: <loom.20110921T162916-893@post.gmane.org>

Gavin M. Roy <gmr at ...> writes:

> 
> You can do a queue.declare('queue_name', passive=True) and get the results of 
that which will have the
> queue depth.
> 
> On Tuesday, July 5, 2011 at 9:05 PM, Vinod Sharma wrote:
> 
> > Hi,
> > I am new to rabbitMQ. I am using python pika module to communicate
> > with rabbitMQ server.
> > is there a function in pika to tell if the message queue is empty or
> > not??
> > 
> > Thanks,
> > Vinod
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at ... (mailto:rabbitmq-discuss at ...)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


THank you for the example. I noticed one thing.... the 
status.method.message_count doesn't always match the number in the queue. For 
example I have a situation now where there is one message in the queue, and I 
can get an accurate count using the Rabbitmq api/queues but the status.method 
reports no messages in the same queue.


From matthias at rabbitmq.com  Wed Sep 21 15:44:04 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 21 Sep 2011 15:44:04 +0100
Subject: [rabbitmq-discuss] check if queue is empty?
In-Reply-To: <loom.20110921T162916-893@post.gmane.org>
References: <215fb2b7-6276-49d6-bcb1-4cb1dd876641@35g2000prp.googlegroups.com>	<A3CDF983836444E3915A3C0EE62E42D8@myyearbook.com>
	<loom.20110921T162916-893@post.gmane.org>
Message-ID: <4E79F834.8070106@rabbitmq.com>

Mark,

On 21/09/11 15:30, Mark K wrote:
> I noticed one thing.... the
> status.method.message_count doesn't always match the number in the queue. For
> example I have a situation now where there is one message in the queue, and I
> can get an accurate count using the Rabbitmq api/queues but the status.method
> reports no messages in the same queue.

That's because queue.declare et al return
<quote>
[The] number of messages present in the queue [...] that are not 
awaiting acknowledgement.
</quote>
(from the AMQP 0-9-1 spec xml)

whereas the 'messages' figure in rabbitmqctl and management includes 
messages awaiting acknowledgement. You can get a breakdown with, e.g.,
   rabbitmqctl list_queues name messages_ready messages_unacknowledged
The messages_ready count should correspond to the count returned by the 
AMQP commands.

Matthias.

From mkovachmcse at aol.com  Wed Sep 21 16:13:54 2011
From: mkovachmcse at aol.com (Mark K)
Date: Wed, 21 Sep 2011 15:13:54 +0000 (UTC)
Subject: [rabbitmq-discuss] check if queue is empty?
References: <215fb2b7-6276-49d6-bcb1-4cb1dd876641@35g2000prp.googlegroups.com>	<A3CDF983836444E3915A3C0EE62E42D8@myyearbook.com>
	<loom.20110921T162916-893@post.gmane.org>
	<4E79F834.8070106@rabbitmq.com>
Message-ID: <loom.20110921T171227-804@post.gmane.org>

Thanks. That makes sense. 
Mark




From mkovachmcse at aol.com  Wed Sep 21 18:35:43 2011
From: mkovachmcse at aol.com (Mark K)
Date: Wed, 21 Sep 2011 17:35:43 +0000 (UTC)
Subject: [rabbitmq-discuss] check if queue is empty?
References: <215fb2b7-6276-49d6-bcb1-4cb1dd876641@35g2000prp.googlegroups.com>	<A3CDF983836444E3915A3C0EE62E42D8@myyearbook.com>
	<loom.20110921T162916-893@post.gmane.org>
	<4E79F834.8070106@rabbitmq.com>
	<loom.20110921T171227-804@post.gmane.org>
Message-ID: <loom.20110921T193209-248@post.gmane.org>

Mark K <mkovachmcse at ...> writes:

> 
> Thanks. That makes sense. 
> Mark
> 
>
An additional question: I want to be able to spin up and down consumers as 
needed, depening on the number messages in the queue. My thought is to do this 
in the code that is the consumer, if no more messages then do a clean close and 
release the thread it runs in. I have it working to a point, but not great. Are 
there any examples of having the consumer close when "sees" there are no more 
messages in a queue without just killing a thread the ugly way? Or is my logic 
wrong on how to do something like this? I'm using this with Python 2.7. 

Thanks
Mark




From redmumba at gmail.com  Wed Sep 21 20:02:10 2011
From: redmumba at gmail.com (Andrew)
Date: Wed, 21 Sep 2011 12:02:10 -0700 (PDT)
Subject: [rabbitmq-discuss] LDAP authentication works, but can't login?
Message-ID: <532302d3-ba31-4177-80ed-38defa382b5f@en1g2000vbb.googlegroups.com>

This is a strange situation.  I had LDAP working on 2.5.1 on my local
machine, but when I installed 2.6.1 on another machine, the same LDAP
settings don't seem to work.  The config file in its entirety is:

    [
      {rabbit, [{auth_backends, [rabbit_auth_backend_ldap]}]},
      {rabbitmq_auth_backend_ldap,
       [ {servers,               ["ldap.somedomain.net"]},
         {user_dn_pattern,       "uid=$
{username},dc=somedomain,dc=net"} ] }
    ].

If I turn on logging, it shows that my authentication is, indeed,
going through, and even that the bind reply is successful:

    =INFO REPORT==== 21-Sep-2011::12:26:03 ===
    LDAP backend: connecting to ["ldap.somedomain.net"]

    =INFO REPORT==== 21-Sep-2011::12:26:03 ===
    LDAP backend: bind request = {'BindRequest',3,
                                    "uid=andrew,dc=somedomain,dc=net",
                                    {simple,<<"PASSWORD REMOVED">>}}

    =INFO REPORT==== 21-Sep-2011::12:26:03 ===
    LDAP backend: bind reply = {ok,
                               {'LDAPMessage',1,
                                {bindResponse,
                                 {'BindResponse',success,[],
[],asn1_NOVALUE,
                                  asn1_NOVALUE}},
                                asn1_NOVALUE}}

But I keep getting denied access.  This is true from both the
management console and the command line scripts for the Management
plug-in.  I have this running on CentOS w/ Erlang R14B and RabbitMQ
1.6.1, plus freshly updated versions of both the LDAP and Management
plug-ins.

Has anyone run into this issue?

Thanks in advance,

Andrew

From vertolet666 at yandex.ru  Wed Sep 21 21:52:54 2011
From: vertolet666 at yandex.ru (DOBRO)
Date: Wed, 21 Sep 2011 13:52:54 -0700 (PDT)
Subject: [rabbitmq-discuss]  RabbitMQ 2.6.1 and memory consumption
Message-ID: <32503774.post@talk.nabble.com>


Hi,

I'm running RabbitMQ 2.6.1 on Erlang R14B03 under Linux.
I noticed that Rabbit node grows in memory very quickly (about 300 Mb per
day).

All the clients publish non-persistent messages and all the consumers are
bound to non-durable queues.
I didn't change anything, I just upgraded Erlang and RabbitMQ.

The previous versions were R14B01 (Erlang) and 2.4.0 (RabbitMQ). Total
amoumt of memory consumed by rabbit was about 700 Mb and its uptime was
about 5 months.

RabbitMQ 2.6.1 has been running for a week and it consumed 2,2 Gb.

The total amount of memory installed is 12Gb.

At startup in the log file:
=INFO REPORT==== 13-Sep-2011::16:15:23 === Memory  limit  set  to 4817MB.

So, I have 8 days (approx.) until it runs out of memory :)

Any ideas?

Thanks.

-- 
View this message in context: http://old.nabble.com/RabbitMQ-2.6.1-and-memory-consumption-tp32503774p32503774.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


From burtprior at comcast.net  Wed Sep 21 22:01:17 2011
From: burtprior at comcast.net (Burt Prior)
Date: Wed, 21 Sep 2011 14:01:17 -0700
Subject: [rabbitmq-discuss] RabbitMQ, Gretty, and Channel question
Message-ID: <514AA77F91B54501AE6EBA421AC81833@BurtPriorPC>

Hi there,

I came across an interesting issue that I was hoping someone could help me with.
I think its related to Channel thread-safety.  Here's the issue.

I want to create an lightweight web service endpoint using Gretty that sends (json) messages to rabbitmq.
It works, but when i benchmark it with 'ab -n 1000 -c 100 http://x.x.x.x/' there are 1003 messages in the queue!

Gretty relies on Netty (http://www.jboss.org/netty) which is an asynchronous event-driven framework that uses NIO.

I've included the (working, no error) Gretty code below.  Could I ask for your insight as to why there are more messages in the queue than the producer (ab) sent?

Thanks for your time,
Burt Prior

server.groovy:

import org.mbte.gretty.httpserver.*

//
// server.groovy
// web service endpoint for activity requests
// 9/15/11: bprior
//
// $ groovy server.groovy
//
// then try benchmark:
// $ ab -n 1000 -c 100 http://192.168.1.129:8080/
//

import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.Channel;

@GrabResolver(name='gretty', root='http://groovypp.artifactoryonline.com/groovypp/libs-releases-local')
@Grab('org.mbte.groovypp:gretty:0.4.279')

@Grab(group='com.rabbitmq', module='amqp-client', version='2.6.1')

ConnectionFactory factory = new ConnectionFactory();
factory.setHost("dallas");
Connection connection = factory.newConnection();
Channel channel = connection.createChannel();

channel.queueDeclare("hello", false, false, false, null);

GrettyServer server = []
server.groovy = [
 localAddress: new InetSocketAddress("dallas", 8080),
   defaultHandler: {
  response.redirect "/"
 },
   "/:name": {
   get {
   String message = "{msg: {actorId:\"bprior\",actorType:\"PERSON\"}}";
   
   channel.basicPublish("", "hello", null, message.getBytes());
   //response.text = "Hello ${request.parameters['name']}"
  }
 }
]
server.start()
println "factory:"+factory
println "server started..."





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110921/1a303f30/attachment.htm>

From matthias at rabbitmq.com  Wed Sep 21 22:38:38 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 21 Sep 2011 22:38:38 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 and memory consumption
In-Reply-To: <32503774.post@talk.nabble.com>
References: <32503774.post@talk.nabble.com>
Message-ID: <4E7A595E.9010709@rabbitmq.com>

On 21/09/11 21:52, DOBRO wrote:
> RabbitMQ 2.6.1 has been running for a week and it consumed 2,2 Gb.
> [...]
> Any ideas?

Please send us the output of 'rabbitmqctl report'. Hopefully that will 
provide some clues.

Matthias.

From aaron at contextlogic.com  Wed Sep 21 22:26:59 2011
From: aaron at contextlogic.com (Aaron Voelker)
Date: Wed, 21 Sep 2011 14:26:59 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika problem,
 channel starts consuming before I call start_consuming(),
 then raises Queue.DeclareOk KeyError
Message-ID: <bb90fe31-c3e3-4bca-a6f2-6912a9ac517f@br5g2000vbb.googlegroups.com>

Environment: Python 2.6.6, Ubuntu 10.10, Pika 0.95. I have reproduced
this problem on several machines with the same specs.

Description of Test: Publish to test1, then consume from test1 and
test2.

What Happens: The queue with the message begins consuming before I
have even told it to start_consuming. Pika seems to get into a weird
state, and then throws a Queue.DeclareOk KeyError.

"""
In Callback Hello World
Traceback (most recent call last):
  File "./rabbittests.py", line 31, in <module>
    channel.queue_declare(queue=queue_name)
  File "/usr/local/lib/python2.6/dist-packages/pika/spec.py", line
2437, in queue_declare
    [Queue.DeclareOk])
  File "/usr/local/lib/python2.6/dist-packages/pika/adapters/
blocking_connection.py", line 221, in rpc
    frame = self._frames[reply]
KeyError: 'Queue.DeclareOk'
"""

The Code:

#!/usr/bin/python

import pika

######### Producer Code

connection =
pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

for queue_name in ('test1', 'test2'):
    channel.queue_declare(queue=queue_name)

channel.basic_publish(exchange='', routing_key='test1', body='Hello
World')
connection.close()

######### Consumer Code

connection =
pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

def callback(ch, method, properties, body):
    print "In Callback", body
    ch.basic_ack(delivery_tag = method.delivery_tag)

for queue_name in ('test1', 'test2'):
    channel.queue_declare(queue=queue_name)
    channel.basic_consume(callback, queue=queue_name)

assert False # NOTE: this doesn't execute!
channel.start_consuming()

From mihirm at omc-international.com.au  Thu Sep 22 00:25:26 2011
From: mihirm at omc-international.com.au (Mihir Mone)
Date: Thu, 22 Sep 2011 09:25:26 +1000
Subject: [rabbitmq-discuss] RabbitMQ Shovel Connections
In-Reply-To: <4E7929EC.1070906@omc-international.com.au>
References: <4E7929EC.1070906@omc-international.com.au>
Message-ID: <4E7A7266.5050800@omc-international.com.au>


Hi Matthew,

Well, your interpretation would be a good solution as well.

I have currently setup the shovelling of messages from one of our client
servers to our end via SSL. Everything works beautifully when you first
start the servers. However, over time (2-3 days) messages just seem to
get lost in transit. I have setup shovel to do transactional forwards so
as to ascertain that the messages are indeed getting delivered. When I
look at the client side server it does not show any piled up messages
(making me believe that the messages are indeed getting forwarded
properly). However, at our end there are no messages getting delivered
and the queues are empty. When I look at the connections list (using the
management plugin) I can see that the connection is still active. The
only solution I have found so far is to restart both the servers so that
the shovel connections get recycled.

Restarting the servers can be a hassle sometimes since we have multiple
client servers connecting to the same servers at our end. It is only
recently that I have started using the shovel plugin. Earlier we had
just written a shovelling application ourselves which used to perform
the consume-publish operation but wasn't as flexible or featureful as
the shovel plugin.

So, what I was thinking was to put may be an option in the shovel
configuration (something like "recycle_connection") so that we can force
a connection recycle every few days (ideally I would like to do it every
24-36 hrs). The whole point of restarting the servers is so that the
connections get recycled. So if there was a way in the plugin itself to
do this, the whole server won't need a restart.

Regards,
Mihir

On 17/09/2011 1:25 AM, Matthew Sackman wrote:
>  Hi Mihir,
>
>  On Thu, Sep 15, 2011 at 01:58:19PM +1000, Mihir Mone wrote:
>>  I was wondering whether there is a way in which the connections setup by the
>>  shovel plugin can be recycled after a certain amount of time. At the moment
>>  they seem to be persistent connections and the only way to really recycle
>>  them is to restart the Rabbit server (on either end) itself which is rather
>>  counterintuitive.
>  Hmm. I'm a bit confused by this. Whilst the each shovel is running, it
>  maintains the connections to the source and to the destination brokers.
>  Are you requesting that if the source queue is empty, the connection to
>  the destination be dropped? Or, to put it another way, only create the
>  connection to the destination once there are msgs to relay, and to drop
>  it after a period of inactivity?
>
>  If so, no, there is currently no way to do that. It's an interesting
>  feature request though. What's the motivation for such a feature?
>
>  Matthew
>  _______________________________________________
>  rabbitmq-discuss mailing list
>  rabbitmq-discuss at lists.rabbitmq.com
>  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Mihir Mone | Software Engineer

OMC-International
6 Paterson St,
Abbotsford,
VIC 3067 Melbourne | Australia

Phone +61 (3) 9412 6525
Fax +61 (3) 9415 9105
http://www.omc-international.com.au/

Smarter Ports | Safer Shipping.

CONFIDENTIAL COMMUNICATIONS. The information contained in this e-mail is confidential
and may be subject to legal professional privilege. It is intended solely for the
addressee. If you received this correspondence by mistake, please promptly inform us
by reply e-mail or by telephoning +61 3 9412 6500 and then delete the e-mail and destroy
any printed copy. You must not disclose, copy or rely on any part of this correspondence
if you are not the intended recipient.



From aaron at contextlogic.com  Thu Sep 22 00:31:55 2011
From: aaron at contextlogic.com (Aaron Voelker)
Date: Wed, 21 Sep 2011 16:31:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika problem,
 channel starts consuming before I call start_consuming(),
 then raises Queue.DeclareOk KeyError
In-Reply-To: <bb90fe31-c3e3-4bca-a6f2-6912a9ac517f@br5g2000vbb.googlegroups.com>
References: <bb90fe31-c3e3-4bca-a6f2-6912a9ac517f@br5g2000vbb.googlegroups.com>
Message-ID: <1ce1b961-7162-4b70-8aff-9ce6a31716fb@s16g2000yqc.googlegroups.com>

Update: I have opened an issue with Pika on Github: https://github.com/pika/pika/issues/86

Wasn't able to find where to post issues before (wasn't listed on
http://tonyg.github.com/pika/). Sorry for the cross-post.

Aaron

On Sep 21, 2:26?pm, Aaron Voelker <aa... at contextlogic.com> wrote:
> Environment: Python 2.6.6, Ubuntu 10.10, Pika 0.95. I have reproduced
> this problem on several machines with the same specs.
>
> Description of Test: Publish to test1, then consume from test1 and
> test2.
>
> What Happens: The queue with the message begins consuming before I
> have even told it to start_consuming. Pika seems to get into a weird
> state, and then throws a Queue.DeclareOk KeyError.
>
> """
> In Callback Hello World
> Traceback (most recent call last):
> ? File "./rabbittests.py", line 31, in <module>
> ? ? channel.queue_declare(queue=queue_name)
> ? File "/usr/local/lib/python2.6/dist-packages/pika/spec.py", line
> 2437, in queue_declare
> ? ? [Queue.DeclareOk])
> ? File "/usr/local/lib/python2.6/dist-packages/pika/adapters/
> blocking_connection.py", line 221, in rpc
> ? ? frame = self._frames[reply]
> KeyError: 'Queue.DeclareOk'
> """
>
> The Code:
>
> #!/usr/bin/python
>
> import pika
>
> ######### Producer Code
>
> connection =
> pika.BlockingConnection(pika.ConnectionParameters('localhost'))
> channel = connection.channel()
>
> for queue_name in ('test1', 'test2'):
> ? ? channel.queue_declare(queue=queue_name)
>
> channel.basic_publish(exchange='', routing_key='test1', body='Hello
> World')
> connection.close()
>
> ######### Consumer Code
>
> connection =
> pika.BlockingConnection(pika.ConnectionParameters('localhost'))
> channel = connection.channel()
>
> def callback(ch, method, properties, body):
> ? ? print "In Callback", body
> ? ? ch.basic_ack(delivery_tag = method.delivery_tag)
>
> for queue_name in ('test1', 'test2'):
> ? ? channel.queue_declare(queue=queue_name)
> ? ? channel.basic_consume(callback, queue=queue_name)
>
> assert False # NOTE: this doesn't execute!
> channel.start_consuming()
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tonygarnockjones+rabbitmq at gmail.com  Thu Sep 22 00:38:42 2011
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Wed, 21 Sep 2011 19:38:42 -0400
Subject: [rabbitmq-discuss] Pika problem,
 channel starts consuming before I call start_consuming(),
 then raises Queue.DeclareOk KeyError
In-Reply-To: <1ce1b961-7162-4b70-8aff-9ce6a31716fb@s16g2000yqc.googlegroups.com>
References: <bb90fe31-c3e3-4bca-a6f2-6912a9ac517f@br5g2000vbb.googlegroups.com>
	<1ce1b961-7162-4b70-8aff-9ce6a31716fb@s16g2000yqc.googlegroups.com>
Message-ID: <CAM8fPiQR_uBOi0C_O9T8nj1By_AL-OS4o=Kaej3Bb=__OZv3Lg@mail.gmail.com>

On 21 September 2011 19:31, Aaron Voelker <aaron at contextlogic.com> wrote:

> Wasn't able to find where to post issues before (wasn't listed on
> http://tonyg.github.com/pika/). Sorry for the cross-post.
>

Hmm! Those pages shouldn't be there anymore. http://pika.github.com/ is the
new URL. Your point still stands about there not being any pointers to the
GH issue tracker, of course :-)

Regards,
  Tony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110921/2642ba83/attachment.htm>

From matthias at rabbitmq.com  Thu Sep 22 08:02:32 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 22 Sep 2011 08:02:32 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.6.1 and memory consumption
In-Reply-To: <273721316670030@web7.yandex.ru>
References: <32503774.post@talk.nabble.com> <4E7A595E.9010709@rabbitmq.com>
	<273721316670030@web7.yandex.ru>
Message-ID: <4E7ADD88.2090309@rabbitmq.com>

On 22/09/11 06:40, DOBRO Sergei wrote:
> No problem, file is attached

Cheers. Putting the list back on cc...

The report shows that you have over 9 million messages, spread across 
~50 queues. Most of these are paged to disk, but rabbit still needs to 
maintain in memory index data for them. How much memory is required for 
that depends on the fanout degree, i.e. 1 million messages shared across 
an average of 9 queues will take up 9 times less memory than 9 million 
messages shared across an average of one queue.

Moreover, rabbit will happily use as much memory as you allow it to if 
it thinks that doing so will speed up the processing & delivery of messages.

So, I am not seeing anything unusual here.


Matthias.

From peter at cacoethes.co.uk  Thu Sep 22 09:34:10 2011
From: peter at cacoethes.co.uk (Peter Ledbrook)
Date: Thu, 22 Sep 2011 09:34:10 +0100
Subject: [rabbitmq-discuss] RabbitMQ, Gretty, and Channel question
In-Reply-To: <514AA77F91B54501AE6EBA421AC81833@BurtPriorPC>
References: <514AA77F91B54501AE6EBA421AC81833@BurtPriorPC>
Message-ID: <CANBeYQTRHkZTOo4uWAk9iQ+Vy_zA3DAX0eyZ025nPWMjSjg+vA@mail.gmail.com>

> I've included the (working, no error) Gretty code below.? Could I ask for
> your insight as to why there are more messages in the queue than the
> producer (ab) sent?

Have you tried counting the number of requests that Gretty is
handling? Assuming that there are zero messages on the queue
initially, I can only imagine that 1003 messages are being published.
If you can confirm that's not the case, then we'll have to look
elsewhere.

Peter

-- 
Peter Ledbrook
Grails Advocate
SpringSource - A Division of VMware

From gneeri at gmail.com  Thu Sep 22 20:22:50 2011
From: gneeri at gmail.com (gneeri)
Date: Thu, 22 Sep 2011 12:22:50 -0700 (PDT)
Subject: [rabbitmq-discuss] acks from temporary queues
Message-ID: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>

I apologize if this is an ill-informed question: In a nutshell, the
thing I am trying to accomplish is blocking a producer until it has
received acks (or even nacks) from all consumers on temporary queues
bound to a given (fanout) exchange for a single message. From the
docs, my sense is that using confirms and waitForConfirms would be
preferable to full on transactions, but as each instance of the
producer will be on its own thread, I am open to using transactions.
The main point of confusion for me here is whether I can get multiple
acks (from all consumers) for one message without having any prior
information about the number of queues attached to the exchange. That
is, I don't just want to know that one queue has received the message,
but that all queues bound to the exchange have done so. It seems clear
that if I send one message per attached queue, I could create a set of
seqNos and check against that to verify acks for all of the messages,
but without a list of bound queues (which I cannot see how to get),
that does not seem like an option. In any case, it seems likely that
there is something that I am missing here. That said, I would
appreciate any thoughts (or even clarifying questions) on this.

Thanks,
Jonathan

From aaron at contextlogic.com  Thu Sep 22 21:26:31 2011
From: aaron at contextlogic.com (Aaron Voelker)
Date: Thu, 22 Sep 2011 13:26:31 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika - how to properly publish from a periodic
	background thread?
Message-ID: <a05c76b9-4a8c-413f-afee-ee37b0dfa261@x32g2000prf.googlegroups.com>

I'm using Python 2.6.6, Ubuntu 10.10, and Pika 0.9.5.

I have a situation where I want to publish to a queue from a
background thread at a periodic interval. The main thread is consuming
on some different callback.

I assumed (incorrectly) that wrapping my callback and publish in a
mutex would solve this problem. I ran into some weird behaviour before
I realized that maybe this isn't the correct approach.

What happens is that the worker I publish to from the background
thread will send work back to the callback for the main thread.
Normally, this is fine, but in weird situations (race condition?),
after a few hours of running my application, it will get Pika into an
unrecoverable state. Some sample code which duplicates this problem,
along with the resulting error messages, is included in this message
in case someone happens to Google for this error message (which got me
next to nowhere).

What is the correct way to do this? Note that both the callback and
the scheduler have to have shared access to the same variables (hence
the mutex), and performance does NOT matter (the scheduler runs once
per minute, and doesn't do too much.

The worker->producer looks something like this (run this first and
keep it running):

#!/usr/bin/python

import pika
import time

######### Consumer->Producer Code

connection =
pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

channel.queue_declare(queue='test1')
channel.queue_declare(queue='test2')

def callback(ch, method, properties, body):
    print "In Callback", method.routing_key, body
    channel.basic_publish(exchange='',
routing_key=properties.reply_to, body=body)
    ch.basic_ack(delivery_tag = method.delivery_tag)

channel.basic_qos(prefetch_count=5)
channel.basic_consume(callback, 'test1')
channel.basic_consume(callback, 'test2')
channel.start_consuming()

-----------------------------------------------------

And the periodic producer looks something like this:

#!/usr/bin/python

import pika
import time
import threading

######### Producer->Consumer Code

mutex = threading.Lock()

connection =
pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

channel.queue_declare(queue='test1')
channel.queue_declare(queue='test2')
channel.queue_declare(queue='return_test1')
channel.queue_declare(queue='return_test2')

def send_msg(life):
    if life <= 0: return
    print "Publishing"
    channel.basic_publish(exchange='', routing_key='test1',
properties=pika.BasicProperties(reply_to='return_test1'),
body=str(life))

def callback(ch, method, properties, body):
    mutex.acquire()

    print "In Callback", method.routing_key, body
    send_msg(int(body)-1)
    ch.basic_ack(delivery_tag = method.delivery_tag)

    mutex.release()

def background_periodic_scheduler():
    for i in range(2): # only need two iterations for this test
        time.sleep(2)

        mutex.acquire()
        for j in range(50):
            send_msg(3)
        mutex.release()

threading.Thread(target=background_periodic_scheduler).start()

channel.basic_qos(prefetch_count=5)
channel.basic_consume(callback, 'return_test1')
channel.basic_consume(callback, 'return_test2')
channel.start_consuming()

-----------------------------------------------------

Then upon running this (may take a couple tries!) I get the following
error message(s):

/usr/local/lib/python2.6/dist-packages/pika/callback.py:69:
UserWarning: CallbackManager.add: Duplicate callback found for
"1:Basic.CancelOk"
  (self.__class__.__name__, prefix, key))
Traceback (most recent call last):
  File "./rabbittests2a.py", line 47, in <module>
    channel.start_consuming()
  File "/usr/local/lib/python2.6/dist-packages/pika/adapters/
blocking_connection.py", line 293, in start_consuming
    self.transport.connection.process_data_events()
  File "/usr/local/lib/python2.6/dist-packages/pika/adapters/
blocking_connection.py", line 94, in process_data_events
    self._handle_read()
  File "/usr/local/lib/python2.6/dist-packages/pika/adapters/
base_connection.py", line 162, in _handle_read
    self._on_data_available(data)
  File "/usr/local/lib/python2.6/dist-packages/pika/connection.py",
line 589, in _on_data_available
    frame)                 # Args
  File "/usr/local/lib/python2.6/dist-packages/pika/callback.py", line
124, in process
    callback(*args, **keywords)
  File "/usr/local/lib/python2.6/dist-packages/pika/connection.py",
line 427, in _on_remote_close
    self.close(frame.method.reply_code, frame.method.reply_text)
  File "/usr/local/lib/python2.6/dist-packages/pika/adapters/
blocking_connection.py", line 48, in close
    BaseConnection.close(self, code, text)
  File "/usr/local/lib/python2.6/dist-packages/pika/connection.py",
line 383, in close
    self._channels[channel_number].close(code, text)
  File "/usr/local/lib/python2.6/dist-packages/pika/channel.py", line
275, in close
    self.basic_cancel(consumer_tag)
  File "/usr/local/lib/python2.6/dist-packages/pika/channel.py", line
336, in basic_cancel
    self._on_cancel_ok, [spec.Basic.CancelOk])
  File "/usr/local/lib/python2.6/dist-packages/pika/adapters/
blocking_connection.py", line 205, in rpc
    self._on_rpc_complete)
TypeError: 'NoneType' object is not iterable
ERROR:pika:BlockingConnection: Socket Error on 7: 32
ERROR:pika:BlockingConnection: Socket is closed
ERROR:pika:BlockingConnection: Socket is closed
ERROR:pika:BlockingConnection: Socket is closed
ERROR:pika:BlockingConnection: Socket is closed
ERROR:pika:BlockingConnection: Socket is closed
ERROR:pika:BlockingConnection: Socket is closed
ERROR:pika:BlockingConnection: Socket is closed
/usr/local/lib/python2.6/dist-packages/pika/connection.py:642:
UserWarning: Pika: Write buffer exceeded warning threshold at 1599
bytes and an estimated 10 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
ERROR:pika:BlockingConnection: Socket is closed
/usr/local/lib/python2.6/dist-packages/pika/connection.py:642:
UserWarning: Pika: Write buffer exceeded warning threshold at 1634
bytes and an estimated 10 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
ERROR:pika:BlockingConnection: Socket is closed
/usr/local/lib/python2.6/dist-packages/pika/connection.py:642:
UserWarning: Pika: Write buffer exceeded warning threshold at 1673
bytes and an estimated 10 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
ERROR:pika:BlockingConnection: Socket is closed

...

ERROR:pika:BlockingConnection: Socket is closed
/usr/local/lib/python2.6/dist-packages/pika/connection.py:642:
UserWarning: Pika: Write buffer exceeded warning threshold at 10033
bytes and an estimated 65 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
ERROR:pika:BlockingConnection: Socket is closed
/usr/local/lib/python2.6/dist-packages/pika/connection.py:642:
UserWarning: Pika: Write buffer exceeded warning threshold at 10072
bytes and an estimated 65 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))
ERROR:pika:BlockingConnection: Socket is closed
/usr/local/lib/python2.6/dist-packages/pika/connection.py:642:
UserWarning: Pika: Write buffer exceeded warning threshold at 10541
bytes and an estimated 68 frames behind
  warn(message % (self.outbound_buffer.size, est_frames_behind))

...

From clarsen at euphoriaaudio.com  Thu Sep 22 23:05:11 2011
From: clarsen at euphoriaaudio.com (Chris Larsen)
Date: Thu, 22 Sep 2011 18:05:11 -0400
Subject: [rabbitmq-discuss] Node reaches RAM High Watermark quickly
In-Reply-To: <4E737332.2040506@rabbitmq.com>
References: <00bc01cc719a$5c0fe6b0$142fb410$@euphoriaaudio.com>
	<4E737332.2040506@rabbitmq.com>
Message-ID: <00e301cc7973$b33e5b70$19bb1250$@euphoriaaudio.com>

Thanks Simon!

> There was a memory leak bug in 2.3.1 when using confirms with the
immediate flag - but "immediate" is pretty rarely used and it was probably a
slow leak. 
> Still, if you are using that combination, that's suspicious.

We weren't using immediate but we were using mandatory.

> What does mgmt say about the memory use for each queue? Unfortunately
there's also a bug in 2.3.1 which makes mgmt report inflated memory use for 
> idle queues but it should be accurate enough to see any gross problems.

Looking at each queue showed around 100K  to 2MB or so of memory usage. 

> Other than that, the standard advice is to upgrade to 2.6.1 and see if the
problem goes away.

We likely will later on, just want to give it some time for other folks to
catch issues :0)

I may have found the issue with some further debugging. I looked up stream
to see the size of the incoming messages and while most were below 1MB,
there were a few at 20MB all the way up to 60MB. Using the C library, I had
added code that set the "frame_max" value to 10MB whenever my producers
connected to a broker. But I wasn't checking on the producer side to see if
my message was larger than that frame_max. I left the max at 10MB and added
code to prevent sending messages over that size and the memory leaking
stopped. 

So should messages always be smaller than the declared frame size or could
there still be an issue if I bump the frame size up to 60MB? Thanks!


From stephen.t.young at gmail.com  Thu Sep 22 23:49:02 2011
From: stephen.t.young at gmail.com (Stephen Young)
Date: Thu, 22 Sep 2011 15:49:02 -0700 (PDT)
Subject: [rabbitmq-discuss] pika basic_ack not always working
Message-ID: <9f2fe003-b7b3-4e7e-b7b4-3f91733e359a@v7g2000yqk.googlegroups.com>

Hi there,

I'm running a setup with a single exchange routing to four queues. My
client servers connect to the exchange and follow all four queues and
spawn handler processes that manage the data from the queues.

I've found that using basic_ack only seems to work if the queues are
empty when my client server joins, otherwise it doesn't send - anyone
have any idea why this would be?

here's the code my process uses:

def _onComplete():
    return channel.basic_ack(delivery_tag=method.delivery_tag)
kwargs = {
     'data': message['data'],
    'oncomplete': _onComplete
}
p = Process(target=self._registry(message['key']),
args=[],kwargs=kwargs)
p.start()

From stephen.t.young at gmail.com  Fri Sep 23 00:38:17 2011
From: stephen.t.young at gmail.com (Stephen Young)
Date: Thu, 22 Sep 2011 16:38:17 -0700 (PDT)
Subject: [rabbitmq-discuss] pika basic_ack dying
Message-ID: <518c6f8e-2ec9-42b1-9164-16afc0e42e57@c22g2000yqa.googlegroups.com>

I tried posting this before and hit an error (i think) so sorry if it
is a repost...

I'm using rabbitmq with a single exchange and multiple queues, and
many servers each monitoring all queues.

When i start the servers monitoring clean (empty) queues, basic_ack
works fine and they process anything new that comes in. Any queues
with pre-existing data won't accept a basic_ack (or the channel
doesn't send it, I'm not sure how to debug this..?) and hangs after
processing the first item. I'm using a qos of 1 for testing purposes.

I'm handling the queues with multiprocessing, so I pass the
_onComplete callback to resolve the queue...

========================================================
def _onComplete():
    self.channel.basic_ack(delivery_tag=method.delivery_tag)
    print "Sent delivery tag %s via %s" %
(method.delivery_tag,channel)

kwargs = {
    'data': message['data'],
    'oncomplete': _onComplete,
}

p = Process(target=self._registry(message['key']),
args=[],kwargs=kwargs)
p.start()
========================================================

Not sure if the problem is clear, hopefully someone can shed some
light on why it happens though

From stephen.t.young at gmail.com  Fri Sep 23 01:39:13 2011
From: stephen.t.young at gmail.com (Stephen Young)
Date: Thu, 22 Sep 2011 17:39:13 -0700 (PDT)
Subject: [rabbitmq-discuss] pika basic_ack dying
In-Reply-To: <518c6f8e-2ec9-42b1-9164-16afc0e42e57@c22g2000yqa.googlegroups.com>
References: <518c6f8e-2ec9-42b1-9164-16afc0e42e57@c22g2000yqa.googlegroups.com>
Message-ID: <5313618.684.1316738353174.JavaMail.geo-discussion-forums@vbbdd1>

Just discovered pika debugging, the message I get is:
[DEBUG] ChannelTransport: Basic.Consume is blocking this channel



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110922/6c765f0b/attachment.htm>

From jonathan.hursey at adrevolution.com  Fri Sep 23 02:13:34 2011
From: jonathan.hursey at adrevolution.com (Jonathan Hursey)
Date: Thu, 22 Sep 2011 20:13:34 -0500
Subject: [rabbitmq-discuss] SNMP or Rabbitmq status checks?
Message-ID: <CAEw+mRfiqspz_XA2WvfJQw11xki0JuUZYQvkNPv=0bSG-kdS5w@mail.gmail.com>

Hey Everyone,
  I'm looking for a way to check the health and status of my Rabbit instance
using a simple check from a remote host. Optimally it would be nice to get a
queue count returned from a check and the name of any consumers connected to
the RabbitMQ broker. Do any of you have insight, experience or
recommendations on how I can accomplish this? Thanks !

- Jon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110922/40f26e14/attachment.htm>

From gmr at myyearbook.com  Fri Sep 23 02:28:27 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 22 Sep 2011 21:28:27 -0400
Subject: [rabbitmq-discuss] pika basic_ack dying
In-Reply-To: <518c6f8e-2ec9-42b1-9164-16afc0e42e57@c22g2000yqa.googlegroups.com>
References: <518c6f8e-2ec9-42b1-9164-16afc0e42e57@c22g2000yqa.googlegroups.com>
Message-ID: <3DCA562EEC69412ABA25997252FDE140@myyearbook.com>

You're handling things with multiprocessing, does each process have its own connection?

How are you handling communication across the processes (or are you?) 

On Thursday, September 22, 2011 at 7:38 PM, Stephen Young wrote:

> I tried posting this before and hit an error (i think) so sorry if it
> is a repost...
> 
> I'm using rabbitmq with a single exchange and multiple queues, and
> many servers each monitoring all queues.
> 
> When i start the servers monitoring clean (empty) queues, basic_ack
> works fine and they process anything new that comes in. Any queues
> with pre-existing data won't accept a basic_ack (or the channel
> doesn't send it, I'm not sure how to debug this..?) and hangs after
> processing the first item. I'm using a qos of 1 for testing purposes.
> 
> I'm handling the queues with multiprocessing, so I pass the
> _onComplete callback to resolve the queue...
> 
> ========================================================
> def _onComplete():
>  self.channel.basic_ack(delivery_tag=method.delivery_tag)
>  print "Sent delivery tag %s via %s" %
> (method.delivery_tag,channel)
> 
> kwargs = {
>  'data': message['data'],
>  'oncomplete': _onComplete,
> }
> 
> p = Process(target=self._registry(message['key']),
> args=[],kwargs=kwargs)
> p.start()
> ========================================================
> 
> Not sure if the problem is clear, hopefully someone can shed some
> light on why it happens though
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110922/19b527b9/attachment.htm>

From stephen.t.young at gmail.com  Fri Sep 23 02:41:26 2011
From: stephen.t.young at gmail.com (Stephen Young)
Date: Thu, 22 Sep 2011 18:41:26 -0700 (PDT)
Subject: [rabbitmq-discuss] pika basic_ack dying
In-Reply-To: <3DCA562EEC69412ABA25997252FDE140@myyearbook.com>
References: <518c6f8e-2ec9-42b1-9164-16afc0e42e57@c22g2000yqa.googlegroups.com>
	<3DCA562EEC69412ABA25997252FDE140@myyearbook.com>
Message-ID: <17524347.2677.1316742086463.JavaMail.geo-discussion-forums@yqbr29>

The main process runs the queue and spawns subprocesses to handle messages 
from the queue based on their routing key - I pass a reference to the 
connection object to the subprocess to call upon completion.

as far as i can tell, it's something to do with managing pre-existing data 
in the queues
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110922/95b7fb78/attachment.htm>

From gmr at myyearbook.com  Fri Sep 23 03:38:57 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 22 Sep 2011 22:38:57 -0400
Subject: [rabbitmq-discuss] pika basic_ack dying
In-Reply-To: <17524347.2677.1316742086463.JavaMail.geo-discussion-forums@yqbr29>
References: <518c6f8e-2ec9-42b1-9164-16afc0e42e57@c22g2000yqa.googlegroups.com>
	<3DCA562EEC69412ABA25997252FDE140@myyearbook.com>
	<17524347.2677.1316742086463.JavaMail.geo-discussion-forums@yqbr29>
Message-ID: <FD71869C1D7F463783429B80756F6A83@myyearbook.com>

 Pika is not designed to work across multiple processes as there is state to the things you are working with. If you want to maintain the multiple process model, I'd use the multiprocessing event manager and the multiprocessing constructs to pass data and events back and forth. I'd not pass the connection around and suspect this is your problem. 


On Thursday, September 22, 2011 at 9:41 PM, Stephen Young wrote:

> The main process runs the queue and spawns subprocesses to handle messages from the queue based on their routing key - I pass a reference to the connection object to the subprocess to call upon completion.
> 
> as far as i can tell, it's something to do with managing pre-existing data in the queues
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110922/63b3d4b5/attachment.htm>

From stephen.t.young at gmail.com  Fri Sep 23 04:28:07 2011
From: stephen.t.young at gmail.com (Stephen Young)
Date: Thu, 22 Sep 2011 20:28:07 -0700 (PDT)
Subject: [rabbitmq-discuss] pika basic_ack dying
In-Reply-To: <FD71869C1D7F463783429B80756F6A83@myyearbook.com>
References: <518c6f8e-2ec9-42b1-9164-16afc0e42e57@c22g2000yqa.googlegroups.com>
	<3DCA562EEC69412ABA25997252FDE140@myyearbook.com>
	<17524347.2677.1316742086463.JavaMail.geo-discussion-forums@yqbr29>
	<FD71869C1D7F463783429B80756F6A83@myyearbook.com>
Message-ID: <17582768.2795.1316748488048.JavaMail.geo-discussion-forums@yqbr29>

Thanks for this - turned out to be the right solution. I got too caught up 
in trying to make pika work in my system, forgot I could make my system work 
for Pika. Ended up just using an event to signal when the process is 
complete and testing the signal periodically to free up new queue entries. 

Cheers,
Stephen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110922/4d513318/attachment.htm>

From acheremukhin.digitalguard at gmail.com  Fri Sep 23 08:20:13 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Fri, 23 Sep 2011 00:20:13 -0700 (PDT)
Subject: [rabbitmq-discuss] SNMP or Rabbitmq status checks?
In-Reply-To: <24051062.347.1316762385542.JavaMail.geo-discussion-forums@yqjw35>
References: <CAEw+mRfiqspz_XA2WvfJQw11xki0JuUZYQvkNPv=0bSG-kdS5w@mail.gmail.com>
	<24051062.347.1316762385542.JavaMail.geo-discussion-forums@yqjw35>
Message-ID: <8837645.3030.1316762413372.JavaMail.geo-discussion-forums@yqbr29>

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_6_1/priv/www/api/index.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110923/5be73b00/attachment.htm>

From acheremukhin.digitalguard at gmail.com  Fri Sep 23 08:19:45 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Fri, 23 Sep 2011 00:19:45 -0700 (PDT)
Subject: [rabbitmq-discuss] SNMP or Rabbitmq status checks?
In-Reply-To: <CAEw+mRfiqspz_XA2WvfJQw11xki0JuUZYQvkNPv=0bSG-kdS5w@mail.gmail.com>
References: <CAEw+mRfiqspz_XA2WvfJQw11xki0JuUZYQvkNPv=0bSG-kdS5w@mail.gmail.com>
Message-ID: <24051062.347.1316762385542.JavaMail.geo-discussion-forums@yqjw35>

You can get this information from plugin managment http.
For example, your snmp-agent on remote server can do rest api request and 
update snmp-counters.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110923/174a6edb/attachment.htm>

From alexandru at rabbitmq.com  Fri Sep 23 10:58:58 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 23 Sep 2011 10:58:58 +0100
Subject: [rabbitmq-discuss] acks from temporary queues
In-Reply-To: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>
References: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>
Message-ID: <20110923095858.GA10396@southbank.eng.vmware.com>

Hi Jonathan,

> I apologize if this is an ill-informed question: In a nutshell, the
> thing I am trying to accomplish is blocking a producer until it has
> received acks (or even nacks) from all consumers on temporary queues
> bound to a given (fanout) exchange for a single message. From the
> docs, my sense is that using confirms and waitForConfirms would be
> preferable to full on transactions,

Confirms are usually the way to go.

With confirms enabled, calling waitForConfirms would block the producer
until all published messages on that channel are acknowledged *by the
broker*.  The broker, in turn, will only acknowledge the message if 1)
it has been persisted to disk; *or* if 2) it has been delivered to a
consumer on each of the queues it had reached.

You can't really specify that you only want the acknowledgement if the
messages are delivered and not if they're persisted.

Also, you said "temporary queues".  Confirms will only work as described
above if the message is persistent and if the queues it lands on are
durable.  A message that lands on a non-durable queue is considered
acknowledged on that queue immediately (of course, the broker will still
wait for it to be persisted or acknowledged on all the other queues it
reached, before acknowledging it to the producer).

> but as each instance of the
> producer will be on its own thread,

That's fine.  Just make sure to use a separate channel for each
producer (calling waitForConfirms on the same channel from multiple
threads will almost certainly not do what you want it to).

> The main point of confusion for me here is whether I can get multiple
> acks (from all consumers) for one message without having any prior
> information about the number of queues attached to the exchange. That
> is, I don't just want to know that one queue has received the message,
> but that all queues bound to the exchange have done so. It seems clear

Not quite sure what you mean.  A published message, even if it gets sent
to multiple queues, is still *one* message with a certain sequence
number.  A published message will be acknowledged by the broker only
once, when it has been written to disk or when it has been successfully
sent to a consumer from each queue.

Consumer acks and publisher acks are completely different things.  A
consumer acks a message to tell *the broker* (not the publisher) that it
has taken responsibility for the message (by using it up, by forwarding
it, by doing something with it).  The broker acks a message to tell *the
publisher* that it has taken responsibility for the message (by saving
it to disk, or by handing it over to consumers).

When a message reaches a queue, and is then delivered to a consumer, the
broker will consider the message delivered only when the consumer
acknowledges it.  So, if it weren't for the "writing the message to
disk" part, it would work exactly the way you're expecting it to.

What sort of system are you designing?

Hope this helps.

Cheers,
Alex


On Thu, Sep 22, 2011 at 12:22:50PM -0700, gneeri wrote:
> I apologize if this is an ill-informed question: In a nutshell, the
> thing I am trying to accomplish is blocking a producer until it has
> received acks (or even nacks) from all consumers on temporary queues
> bound to a given (fanout) exchange for a single message. From the
> docs, my sense is that using confirms and waitForConfirms would be
> preferable to full on transactions, but as each instance of the
> producer will be on its own thread, I am open to using transactions.
> The main point of confusion for me here is whether I can get multiple
> acks (from all consumers) for one message without having any prior
> information about the number of queues attached to the exchange. That
> is, I don't just want to know that one queue has received the message,
> but that all queues bound to the exchange have done so. It seems clear
> that if I send one message per attached queue, I could create a set of
> seqNos and check against that to verify acks for all of the messages,
> but without a list of bound queues (which I cannot see how to get),
> that does not seem like an option. In any case, it seems likely that
> there is something that I am missing here. That said, I would
> appreciate any thoughts (or even clarifying questions) on this.
> 
> Thanks,
> Jonathan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Fri Sep 23 11:18:16 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Fri, 23 Sep 2011 11:18:16 +0100
Subject: [rabbitmq-discuss] Streaming Lightweight Publisher Confirms ?
In-Reply-To: <32503738.post@talk.nabble.com>
References: <32503738.post@talk.nabble.com>
Message-ID: <20110923101816.GB10396@southbank.eng.vmware.com>

Hi,

>  1.if publish send message from queue and consumer doesn't return any 
>  acknowledgement in this case broker what to do?

On the broker: if the consumer doesn't acknowledge a message, the
message is kept until the consumer disconnects; at that point the
message is re-inserted on the queue.  The message is not considered
delivered until the consumer acknowledges it, so it will not cause a
publisher confirm to be issued.  Of course, while the broker is waiting
for the consumer to acknowledge the message, it may write it to disk, in
which case, the publisher confirm is issued immediately.

>  2. if broker is restart or crash in this period,it can store the 
>  unacknowledged message and resend to consumer.

Maybe.  If the publisher confirm was issued, and the broker crashes,
when it comes back up, it will attempt to re-deliver the message.  If
the publisher confirm was *not* issued, the message was probably
lost and the publisher will need to re-publish the message.

>  3. Is there is method to check all Publisher Confirmation.

What the publisher should probably do is this:
  1. confirmSelect the channel;
  2. publish some messages;
  3. call waitForConfirmsOrDie;
    3.1 if an exception was raised, the messages were probably lost and
    they need to be re-published;
    3.2 if no exception was raised, the broker has either written the
    messages to disk (and they will survive a broker restart) or it has
    delivered the messages to all consumers (and they have ack'd), so
    everything is fine and you can start publishing other messages.

Hope this clears things up.

Cheers,
Alex

On Wed, Sep 21, 2011 at 04:19:14AM -0700, sameekmishra wrote:
> 
> Hi
>  
>  I want to make sure using channel confirmation.i have following 
>  question using Streaming Lightweight Publisher Confirms:
>  
>  1.if publish send message from queue and consumer doesn't return any 
>  acknowledgement in this case broker what to do?
>  
>  2. if broker is restart or crash in this period,it can store the 
>  unacknowledged message and resend to consumer.
> 
>  3. Is there is method to check all Publisher Confirmation.
> 
>  Thanks
> 
> -- 
> View this message in context: http://old.nabble.com/Streaming-Lightweight-Publisher-Confirms---tp32503738p32503738.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From thomas.kant at gmail.com  Fri Sep 23 12:21:28 2011
From: thomas.kant at gmail.com (scorpiovn)
Date: Fri, 23 Sep 2011 04:21:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Spring-amqp for Spring 2.5.6
Message-ID: <e64b937c-eee9-4d28-a146-7de311cbbdfd@l7g2000vbz.googlegroups.com>

Hi All,

Please help me use spring-amqp for Spring 2.5.6.

Thanks,
Thomas

From jim at rabbitmq.com  Fri Sep 23 12:30:10 2011
From: jim at rabbitmq.com (Jim Apperly)
Date: Fri, 23 Sep 2011 12:30:10 +0100
Subject: [rabbitmq-discuss] Spring-amqp for Spring 2.5.6
In-Reply-To: <e64b937c-eee9-4d28-a146-7de311cbbdfd@l7g2000vbz.googlegroups.com>
References: <e64b937c-eee9-4d28-a146-7de311cbbdfd@l7g2000vbz.googlegroups.com>
Message-ID: <CAMdQUi-ONyifQWQtgSYYZ=2ri9_f4CYugkd55Xn6hjmT0YxQwg@mail.gmail.com>

Thomas,

On 23 September 2011 12:21, scorpiovn <thomas.kant at gmail.com> wrote:

> Please help me use spring-amqp for Spring 2.5.6.
>

The official documentation for spring-amqp is here:
http://www.springsource.org/spring-amqp

This blog post discusses building a PoC with RabbitMQ and spring-amqp, which
might help:
http://www.digitalsanctum.com/2010/08/31/using-rabbitmq,-spring-amqp-and-spring-integration/


Jim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110923/5ff77c43/attachment.htm>

From simon at rabbitmq.com  Fri Sep 23 12:30:36 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 Sep 2011 12:30:36 +0100
Subject: [rabbitmq-discuss] Node reaches RAM High Watermark quickly
In-Reply-To: <00e301cc7973$b33e5b70$19bb1250$@euphoriaaudio.com>
References: <00bc01cc719a$5c0fe6b0$142fb410$@euphoriaaudio.com>	<4E737332.2040506@rabbitmq.com>
	<00e301cc7973$b33e5b70$19bb1250$@euphoriaaudio.com>
Message-ID: <4E7C6DDC.8000200@rabbitmq.com>

On 22/09/11 23:05, Chris Larsen wrote:
> I may have found the issue with some further debugging. I looked up stream
> to see the size of the incoming messages and while most were below 1MB,
> there were a few at 20MB all the way up to 60MB. Using the C library, I had
> added code that set the "frame_max" value to 10MB whenever my producers
> connected to a broker. But I wasn't checking on the producer side to see if
> my message was larger than that frame_max. I left the max at 10MB and added
> code to prevent sending messages over that size and the memory leaking
> stopped.
>
> So should messages always be smaller than the declared frame size or could
> there still be an issue if I bump the frame size up to 60MB? Thanks!

Hmm. You certainly should not need to do that; messages larger than 
frame_max should just get split up (and having a very large frame_max 
can be dodgy if you want to share many channels on one connection; 
frames are what get interleaved on the connection).

I will bang on this a bit and see if I can reproduce.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Sep 23 12:44:06 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 Sep 2011 12:44:06 +0100
Subject: [rabbitmq-discuss] Mochiweb MAX_RECV_BODY and JSON_RPC plugin
In-Reply-To: <655DF0084CC341709AD2765CCA29DC3B@myyearbook.com>
References: <3ACD8673BEFF41AFB95B660FFA683968@myyearbook.com>
	<4E521B6E.8060103@rabbitmq.com>
	<655DF0084CC341709AD2765CCA29DC3B@myyearbook.com>
Message-ID: <4E7C7106.3080107@rabbitmq.com>

On 18/09/11 02:41, Gavin M. Roy wrote:
> Thanks for the instructions. Please find the patch to mochiweb-wrapper
> patching the MAX_RECV_BODY to 100MB from 1MB.

Thanks, applied.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Sep 23 12:51:40 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 23 Sep 2011 12:51:40 +0100
Subject: [rabbitmq-discuss] LDAP authentication works, but can't login?
In-Reply-To: <532302d3-ba31-4177-80ed-38defa382b5f@en1g2000vbb.googlegroups.com>
References: <532302d3-ba31-4177-80ed-38defa382b5f@en1g2000vbb.googlegroups.com>
Message-ID: <4E7C72CC.8050804@rabbitmq.com>

On 21/09/11 20:02, Andrew wrote:
> But I keep getting denied access.  This is true from both the
> management console and the command line scripts for the Management
> plug-in.

...but I guess logins over AMQP work?

In 2.6.1 the situation for logins to mgmt changed. We introduced user 
tags, and users without any tags can't use mgmt *at all*:

http://www.rabbitmq.com/management.html#permissions

So you probably need to make sure the LDAP plugin gives your users a 
"management", "monitoring" or "administrator" tag (depending on what you 
want them to do). Use the tag_queries parameter:

http://hg.rabbitmq.com/rabbitmq-auth-backend-ldap/file/default/README-authorisation#l61

i.e. something like:

{tag_queries, [{management, {constant, true}}]}

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From gneeri at gmail.com  Fri Sep 23 17:19:14 2011
From: gneeri at gmail.com (gneeri)
Date: Fri, 23 Sep 2011 09:19:14 -0700 (PDT)
Subject: [rabbitmq-discuss] acks from temporary queues
In-Reply-To: <20110923095858.GA10396@southbank.eng.vmware.com>
References: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>
	<20110923095858.GA10396@southbank.eng.vmware.com>
Message-ID: <216cd00e-d8d1-46b5-a426-4831c614d405@p4g2000vbp.googlegroups.com>

Hi Alex,

Thank you very much for your detailed reply. It is quite helpful and I
do have one specific question with respect to your notes, but think it
might be most useful if I briefly respond to your question about the
intended system before inquiring further:

The system is composed of a dynamic array of servers, each of which
support user logins. In order to prevent data corruption (i.e.,
concurrency problems), my intent is that, upon login to any of the
servers, the server logged into broadcasts a message out to the other
servers, telling them to revoke control over the logging in user's
data. Then, and only once all of the other servers (subscribed to the
login exchange at startup) have ack'd the request to relinquish
control, do I want the login server to proceed and take control of the
user's data.


From raphael at rightscale.com  Fri Sep 23 19:11:58 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Fri, 23 Sep 2011 11:11:58 -0700
Subject: [rabbitmq-discuss] Number of connections and memory usage
Message-ID: <CAD7X3-nscg5ZB_A2V_PYNs271FC+hQVQQxTynsMj8BhibOZvXA@mail.gmail.com>

Hello all,

We are using RabbitMQ 2.4 in our production environment and are running into
issues with memory usage. We are seeing a direct relation between the number
of connections and the memory usage (the graphs are identical). The ratio is
200 KB / connection which seems hefty especially with about 50,000
connections open on each broker this ends up consuming all the ram. What is
surprising is how constant that number is and I'm wondering if there is a
setting somewhere that can be tweaked to change that ratio. Note that we
have very few or no messages in memory (only around 500 MB of memory is used
by messages according to rabbitmqctl).

Thank you!

--
Raphael.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110923/d7f3e710/attachment.htm>

From burtprior at comcast.net  Fri Sep 23 20:02:39 2011
From: burtprior at comcast.net (Burt Prior)
Date: Fri, 23 Sep 2011 12:02:39 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ, Gretty, and Channel question
In-Reply-To: <CANBeYQTRHkZTOo4uWAk9iQ+Vy_zA3DAX0eyZ025nPWMjSjg+vA@mail.gmail.com>
References: <514AA77F91B54501AE6EBA421AC81833@BurtPriorPC>
	<CANBeYQTRHkZTOo4uWAk9iQ+Vy_zA3DAX0eyZ025nPWMjSjg+vA@mail.gmail.com>
Message-ID: <2921fabf-09cf-4955-b63e-8bdcbd2095b5@t11g2000yqk.googlegroups.com>

Hi Peter!

Thanks for your reply.  I'm extremely excited about the possibilities
of RabbitMQ and Gretty for the architecture (EDA) and app i'm
building.

Here's what I did last night:  I created a bare-bones Grails app
(1.3.7/tomcat), installed the rabbit plugin, and coded simple a web
service interface in UrlMappings and a (rest) controller that sends a
text message every time the web service is invoked.  (later I'll pass
JSON as the message transport)

class ActivityRestController {

   def sendMessage = {
        rabbitSend 'hello', 'someMessage'
    }
}

GET /web-service-app/activity

As i mentioned, I want a simple web service endpoint that put (JSON)
messages on the queue.

Testing the above web service with:  'ab -n 10000 -c 100
http://localhost:8080/web-service/activity
This works great.  this puts 10,000 messages on the queue perfectly (a
bit slowly) every time.
I think works perfectly because a new thread is created by tomcat for
every request.
That's why I don't have to worry about channel thread safety.

This is NOT the case with Gretty, for reasons I don't understand.

Could I get your thoughts on this?

Thanks very much,
Burt Prior



On Sep 22, 1:34?am, Peter Ledbrook <pe... at cacoethes.co.uk> wrote:
> > I've included the (working, no error) Gretty code below.? Could I ask for
> > your insight as to why there are more messages in the queue than the
> > producer (ab) sent?
>
> Have you tried counting the number of requests that Gretty is
> handling? Assuming that there are zero messages on the queue
> initially, I can only imagine that 1003 messages are being published.
> If you can confirm that's not the case, then we'll have to look
> elsewhere.
>
> Peter
>
> --
> Peter Ledbrook
> Grails Advocate
> SpringSource - A Division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthias at rabbitmq.com  Fri Sep 23 20:18:05 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 23 Sep 2011 20:18:05 +0100
Subject: [rabbitmq-discuss] Number of connections and memory usage
In-Reply-To: <CAD7X3-nscg5ZB_A2V_PYNs271FC+hQVQQxTynsMj8BhibOZvXA@mail.gmail.com>
References: <CAD7X3-nscg5ZB_A2V_PYNs271FC+hQVQQxTynsMj8BhibOZvXA@mail.gmail.com>
Message-ID: <4E7CDB6D.1080902@rabbitmq.com>

Raphael,

On 23/09/11 19:11, Raphael Simon wrote:
> We are using RabbitMQ 2.4 in our production environment and are running
> into issues with memory usage. We are seeing a direct relation between
> the number of connections and the memory usage (the graphs are
> identical). The ratio is 200 KB / connection which seems hefty
> especially with about 50,000 connections open on each broker this ends
> up consuming all the ram.
> [...]
> I'm wondering if there is a setting somewhere that can be tweaked

Reduce the socket send and receive buffer sizes by sticking the 
following in your rabbitmq.config:

[{rabbit, [{tcp_listen_options, [binary,
                                  {packet,        raw},
                                  {reuseaddr,     true},
                                  {backlog,       128},
                                  {nodelay,       true},
                                  {sndbuf,        1024},
                                  {recbuf,        1024},
                                  {exit_on_close, false}]}]}].

(All but the sndbuf and recbuf settings are identical to the defaults)


Regards,

Matthias.

From gneeri at gmail.com  Fri Sep 23 21:26:45 2011
From: gneeri at gmail.com (gneeri)
Date: Fri, 23 Sep 2011 13:26:45 -0700 (PDT)
Subject: [rabbitmq-discuss] acks from temporary queues
In-Reply-To: <216cd00e-d8d1-46b5-a426-4831c614d405@p4g2000vbp.googlegroups.com>
References: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>
	<20110923095858.GA10396@southbank.eng.vmware.com>
	<216cd00e-d8d1-46b5-a426-4831c614d405@p4g2000vbp.googlegroups.com>
Message-ID: <748f48cc-75d0-43d9-a794-bd521fee39de@k1g2000vbz.googlegroups.com>

Hi Alex,

So to follow up, I have run some tests with durable queues and
waitForConfirms, which are not giving me the results I would expect.

The test is set up as follows:

1. I have a producer publishing with confirmSelect and waitForConfirms
to a fanout exchange

2. I have 2 consumers, attached to durable queues bound to the fanout
exchange

3. both consumers have autoAck set to false and use manual basicAck
after processing

4. I have put a delay (via Thread.sleep()) into one of the consumers

My expectation, then, is that producer would publish its message and
then be blocked until the delayed consumer returns an ack to queue
which would in turn send an ack to the fanout exchange, followed by an
ack to the producer. This, however, does not appear to be the case and
the producer appears to be executing code below the waitForConfirms()
call, well before the delayed consumer sends back its ack. For good
measure, I have also tried placing the sleep() call before the
consumer calls nextDelivery() in case the simple acceptance of the
payload from the queue would be enough to pass acks back up the chain
to the producer. This too, did not appear to work.

Ultimately, then, my sense is that I have misconstrued your earlier
remarks. Earlier (below), I passed along the intended functionality.
My hope is that I will not have to aggregate a list of servers and
pass along a single message to each server, but perhaps that is what
will be required. In any case, if you could let me know what I am
missing in this test (i.e., if there is a correctable way of making
this work) or if I need to attempt an implementation based on one
message per server, I would very much appreciate it.

Thanks in advance,
Jonathan

On Sep 23, 12:19?pm, gneeri <gne... at gmail.com> wrote:
> Hi Alex,
>
> Thank you very much for your detailed reply. It is quite helpful and I
> do have one specific question with respect to your notes, but think it
> might be most useful if I briefly respond to your question about the
> intended system before inquiring further:
>
> The system is composed of a dynamic array of servers, each of which
> support user logins. In order to prevent data corruption (i.e.,
> concurrency problems), my intent is that, upon login to any of the
> servers, the server logged into broadcasts a message out to the other
> servers, telling them to revoke control over the logging in user's
> data. Then, and only once all of the other servers (subscribed to the
> login exchange at startup) have ack'd the request to relinquish
> control, do I want the login server to proceed and take control of the
> user's data.
>
> From there, I expect the blocking requirement is pretty clear. Also,
> insofar as the array of servers is dynamic, I'm hoping my desire to
> use a single message over a "fanout" exchange will make some sense (as
> opposed to having to send a single message to each server via a named
> queue (or perhaps routing key) that would require me to have a list of
> all of the servers in advance of publishing).
>
> Which brings me to my question(s): when you say: "The broker, in turn,
> will only acknowledge the message if . . . 2) it has been delivered to
> a consumer on each of the queues it had reached"--does this mean that
> the broker (in this case, fanout exchange) will only send an ack to
> the publisher after a consumer on each of the attached queues has been
> reached? After some very rough testing with multiple consumers
> attached to the same fanout exchange, it has appeared to me that the
> publisher may get an ack prior to one of the consumers sending its ack
> back to the broker. This may just be the result of bad test code (on
> my part) *or* it may relate the fact that I am using temporary queues
> (e.g., channel.queueDeclare().getQueue()) rather than durable queues,
> as you suggest below. If that latter is the case, are you suggesting
> that using durable queues would make the broker wait on all consumers
> for all of the queues before returning an ack to the publisher? If so,
> that sounds like it would do the trick.
>
> Sorry again, for being so verbose and thanks very much for your help.
>
> Cheers,
> Jonathan
>
> On Sep 23, 5:58?am, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
>
>
>
>
>
>
>
> > Hi Jonathan,
>
> > > I apologize if this is an ill-informed question: In a nutshell, the
> > > thing I am trying to accomplish is blocking a producer until it has
> > > received acks (or even nacks) from all consumers on temporary queues
> > > bound to a given (fanout) exchange for a single message. From the
> > > docs, my sense is that using confirms and waitForConfirms would be
> > > preferable to full on transactions,
>
> > Confirms are usually the way to go.
>
> > With confirms enabled, calling waitForConfirms would block the producer
> > until all published messages on that channel are acknowledged *by the
> > broker*. ?The broker, in turn, will only acknowledge the message if 1)
> > it has been persisted to disk; *or* if 2) it has been delivered to a
> > consumer on each of the queues it had reached.
>
> > You can't really specify that you only want the acknowledgement if the
> > messages are delivered and not if they're persisted.
>
> > Also, you said "temporary queues". ?Confirms will only work as described
> > above if the message is persistent and if the queues it lands on are
> > durable. ?A message that lands on a non-durable queue is considered
> > acknowledged on that queue immediately (of course, the broker will still
> > wait for it to be persisted or acknowledged on all the other queues it
> > reached, before acknowledging it to the producer).
>
> > > but as each instance of the
> > > producer will be on its own thread,
>
> > That's fine. ?Just make sure to use a separate channel for each
> > producer (calling waitForConfirms on the same channel from multiple
> > threads will almost certainly not do what you want it to).
>
> > > The main point of confusion for me here is whether I can get multiple
> > > acks (from all consumers) for one message without having any prior
> > > information about the number of queues attached to the exchange. That
> > > is, I don't just want to know that one queue has received the message,
> > > but that all queues bound to the exchange have done so. It seems clear
>
> > Not quite sure what you mean. ?A published message, even if it gets sent
> > to multiple queues, is still *one* message with a certain sequence
> > number. ?A published message will be acknowledged by the broker only
> > once, when it has been written to disk or when it has been successfully
> > sent to a consumer from each queue.
>
> > Consumer acks and publisher acks are completely different things. ?A
> > consumer acks a message to tell *the broker* (not the publisher) that it
> > has taken responsibility for the message (by using it up, by forwarding
> > it, by doing something with it). ?The broker acks a message to tell *the
> > publisher* that it has taken responsibility for the message (by saving
> > it to disk, or by handing it over to consumers).
>
> > When a message reaches a queue, and is then delivered to a consumer, the
> > broker will consider the message delivered only when the consumer
> > acknowledges it. ?So, if it weren't for the "writing the message to
> > disk" part, it would work exactly the way you're expecting it to.
>
> > What sort of system are you designing?
>
> > Hope this helps.
>
> > Cheers,
> > Alex
>
> > On Thu, Sep 22, 2011 at 12:22:50PM -0700, gneeri wrote:
> > > I apologize if this is an ill-informed question: In a nutshell, the
> > > thing I am trying to accomplish is blocking a producer until it has
> > > received acks (or even nacks) from all consumers on temporary queues
> > > bound to a given (fanout) exchange for a single message. From the
> > > docs, my sense is that using confirms and waitForConfirms would be
> > > preferable to full on transactions, but as each instance of the
> > > producer will be on its own thread, I am open to using transactions.
> > > The main point of confusion for me here is whether I can get multiple
> > > acks (from all consumers) for one message without having any prior
> > > information about the number of queues attached to the exchange. That
> > > is, I don't just want to know that one queue has received the message,
> > > but that all queues bound to the exchange have done so. It seems clear
> > > that if I send one message per attached queue, I could create a set of
> > > seqNos and check against that to verify acks for all of the messages,
> > > but without a list of bound queues (which I cannot see how to get),
> > > that does not seem like an option. In any case, it seems likely that
> > > there is something that I am missing here. That said, I would
> > > appreciate any thoughts (or even clarifying questions) on this.
>
> > > Thanks,
> > > Jonathan
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rev.chip at gmail.com  Fri Sep 23 22:35:42 2011
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Fri, 23 Sep 2011 14:35:42 -0700 (PDT)
Subject: [rabbitmq-discuss] "rabbitmqctl list_queues" does not show HA queue
Message-ID: <797897aa-b122-4f4b-921f-6d5a3f652ce2@fe21g2000vbb.googlegroups.com>

I have created an HA queue and it shows up fine in the management
interface, but rabbitmqctl list_queues simply doesn't show it.  Is
this a known bug, and is there a more capable administrative command
line tool?  I would like to be able to delete things as well as just
look at them.

From rev.chip at gmail.com  Fri Sep 23 23:41:30 2011
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Fri, 23 Sep 2011 15:41:30 -0700 (PDT)
Subject: [rabbitmq-discuss] "rabbitmqctl list_queues" does not show HA
	queue
In-Reply-To: <797897aa-b122-4f4b-921f-6d5a3f652ce2@fe21g2000vbb.googlegroups.com>
References: <797897aa-b122-4f4b-921f-6d5a3f652ce2@fe21g2000vbb.googlegroups.com>
Message-ID: <4a83e223-f4f3-4172-bf44-5ac540b12c8b@n12g2000yqh.googlegroups.com>

On Sep 23, 2:35?pm, Chip Salzenberg <rev.c... at gmail.com> wrote:
> I have created an HA queue and it shows up fine in the management
> interface, but rabbitmqctl list_queues simply doesn't show it.

The management plugin does show it, but apparently it's not getting
fully created.  That's for another message.

From matthias at rabbitmq.com  Fri Sep 23 23:55:18 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 23 Sep 2011 23:55:18 +0100
Subject: [rabbitmq-discuss] acks from temporary queues
In-Reply-To: <748f48cc-75d0-43d9-a794-bd521fee39de@k1g2000vbz.googlegroups.com>
References: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>	<20110923095858.GA10396@southbank.eng.vmware.com>	<216cd00e-d8d1-46b5-a426-4831c614d405@p4g2000vbp.googlegroups.com>
	<748f48cc-75d0-43d9-a794-bd521fee39de@k1g2000vbz.googlegroups.com>
Message-ID: <4E7D0E56.9090906@rabbitmq.com>

On 23/09/11 21:26, gneeri wrote:
> My expectation, then, is that producer would publish its message and
> then be blocked until the delayed consumer returns an ack

Confirms mean one thing and one thing only: that the broker has accepted 
responsibility for the message.

They concern the interaction between producers and the broker, and  have 
nothing to do with consumer acks.

Yes, there are some conditions in which a consumer ack can trigger a 
confirm in RabbitMQ, but that is an implementation detail and not 
something you'd want to design an application around.

> My hope is that I will not have to aggregate a list of servers and
> pass along a single message to each server, but perhaps that is what
> will be required.

You can still send a single message via a fanout exchange. But the 
consumers then in turn need to send a message back to the sender. Your 
sender will need to know how many consumers there are so it knows when 
it has gotten all responses..


Regards,

Matthias.

From rev.chip at gmail.com  Fri Sep 23 23:55:35 2011
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Fri, 23 Sep 2011 15:55:35 -0700 (PDT)
Subject: [rabbitmq-discuss] HA queue seems never to get fully created
Message-ID: <1bd216ff-02b7-47ed-bbdd-1b157941382e@i9g2000yqe.googlegroups.com>

I'm having some difficulty with creating a mirrored queue so that I
can test it.  The management plugin only thinks the queue is half-
present, rabbitmqctl doesn't think it's there at all, and the AMQP API
seems to be blocking when it shouldn't.

1. I created a two-node cluster.  This much seems fine.
cluster_status gives the right report on both machines:
Cluster status of node rabbit at ps7 ...
[{nodes,[{disc,[rabbit at ps8,rabbit at ps7]}]},
 {running_nodes,[rabbit at ps8,rabbit at ps7]}]

2. I used the Perl API to create an HA queue.  This reported success
via the AMQP, and the management plugin sees the queue and its
parameters correctly.  When I hover over HA I see "x-ha-policy:
nodes", and when I hover over Args I see "x-ha-policy-params:
[rabbit at ps7,rabbit at ps8]".

3. When I issue a consume to the queue, my client hangs, rather than
continuing as it did in my non-HA test.

4. The output of "rabbitmqctl list_queues" is empty.  This queue
doesn't even show up.

5. The management plugin seems conflicted as to whether the queue
exists or not.  The queue is present and visible, but when I go to the
queue's page the big items for Ready, Unacknowledged, and Total all
show "?" instead of a number.

How can I diagnose this situation and/or make this work right?  Help,
please.

From rev.chip at gmail.com  Sat Sep 24 00:09:56 2011
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Fri, 23 Sep 2011 16:09:56 -0700
Subject: [rabbitmq-discuss] HQ queue seems never to get fully created,
	is never usable
Message-ID: <CANSL5VGwYxqpCS8tJHqRD5wy-yFAkZeTQdkXm08wv7WBSSj2-A@mail.gmail.com>

I'm having some difficulty with creating a mirrored queue so that I
can test it. The management plugin only thinks the queue is half-
present, rabbitmqctl doesn't think it's there at all, and the AMQP API
seems to be blocking when it shouldn't.


1. I created a two-node cluster.  This much seems fine.
cluster_status gives the right report on both machines:
Cluster status of node rabbit at ps7 ...

[{nodes,[{disc,[rabbit at ps8,rabbit at ps7]}]},
 {running_nodes,[rabbit at ps8,rabbit at ps7]}]

2. I used the Perl API to create an HA queue.  This reported success
via the AMQP, and the management plugin sees the queue and its
parameters correctly.  When I hover over HA I see "x-ha-policy:
nodes", and when I hover over Args I see "x-ha-policy-params:
[rabbit at ps7,rabbit at ps8]".  A get to the HTTP API shows the same
data, in JSON of course.

3. When I issue a consume to the queue, my client hangs, rather than
continuing as it did in my non-HA test.  This may be a quirk of the
client, but it is a change from the non-HA working behavior.

4. The output of "rabbitmqctl list_queues" is completely empty.

5. The management plugin seems conflicted as to whether the queue
exists or not.  The queue is present and visible in the queue list,
but when I go to the queue's page the big items for Ready, Unacknowledged,
and Total all show "?" instead of a number, and a GET to the queue's
specific URL returns a 404 error.

How can I diagnose this situation and/or make this work right?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110923/dda87898/attachment.htm>

From gneeri at gmail.com  Sat Sep 24 00:44:14 2011
From: gneeri at gmail.com (gneeri)
Date: Fri, 23 Sep 2011 16:44:14 -0700 (PDT)
Subject: [rabbitmq-discuss] acks from temporary queues
In-Reply-To: <4E7D0E56.9090906@rabbitmq.com>
References: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>
	<20110923095858.GA10396@southbank.eng.vmware.com>
	<216cd00e-d8d1-46b5-a426-4831c614d405@p4g2000vbp.googlegroups.com>
	<748f48cc-75d0-43d9-a794-bd521fee39de@k1g2000vbz.googlegroups.com>
	<4E7D0E56.9090906@rabbitmq.com>
Message-ID: <59ccf59b-ccf4-43c3-a6f0-60eb1bf4750c@bs9g2000vbb.googlegroups.com>

Hi Matthias,

Thanks for clarifying that. From the explication of the rules for
confirms, it had appeared to me that the relationships to queues and
consumers had more weight in the confirmation process. That not being
the case, I have 2 brief follow up questions:

1. Do consumer acks have more significance in transactions, such that
I could use those to effect the functionality I'm looking for?

2. If not, is there any way (apart from the admin HTTP API) for
determining the number of consumers (e.g., bound queues) for a given
exchange? This way I could test the number of reply messages as you
suggest; otherwise, with needing to register and account for a dynamic
array of servers, I would lose a good deal of what I had hoped would
be the benefit of a fanout broadcast.

Thanks in advance,
Jonathan

On Sep 23, 6:55?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> On 23/09/11 21:26, gneeri wrote:
>
> > My expectation, then, is that producer would publish its message and
> > then be blocked until the delayed consumer returns an ack
>
> Confirms mean one thing and one thing only: that the broker has accepted
> responsibility for the message.
>
> They concern the interaction between producers and the broker, and ?have
> nothing to do with consumer acks.
>
> Yes, there are some conditions in which a consumer ack can trigger a
> confirm in RabbitMQ, but that is an implementation detail and not
> something you'd want to design an application around.
>
> > My hope is that I will not have to aggregate a list of servers and
> > pass along a single message to each server, but perhaps that is what
> > will be required.
>
> You can still send a single message via a fanout exchange. But the
> consumers then in turn need to send a message back to the sender. Your
> sender will need to know how many consumers there are so it knows when
> it has gotten all responses..
>
> Regards,
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From rev.chip at gmail.com  Sat Sep 24 00:47:36 2011
From: rev.chip at gmail.com (Chip Salzenberg)
Date: Fri, 23 Sep 2011 16:47:36 -0700
Subject: [rabbitmq-discuss] HA queue seems never to get fully created,
	is never usable
Message-ID: <CANSL5VF81qTgd-_0UgGHcBcaSTzNUb5i6gxfhdn9PRaO1XzJOg@mail.gmail.com>

More information on this: The client is declaring the queue and the binding,
and is getting success indicators; but when it tries to consume, it gets a
NOT_FOUND error.  It seems the queue is in a netherworld of existing and not
existing.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110923/0ec68523/attachment.htm>

From matthew at rabbitmq.com  Sat Sep 24 01:09:21 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 24 Sep 2011 01:09:21 +0100
Subject: [rabbitmq-discuss] HQ queue seems never to get fully created,
 is never usable
In-Reply-To: <CANSL5VGwYxqpCS8tJHqRD5wy-yFAkZeTQdkXm08wv7WBSSj2-A@mail.gmail.com>
References: <CANSL5VGwYxqpCS8tJHqRD5wy-yFAkZeTQdkXm08wv7WBSSj2-A@mail.gmail.com>
Message-ID: <20110924000921.GC3441@wellquite.org>

On Fri, Sep 23, 2011 at 04:09:56PM -0700, Chip Salzenberg wrote:
> How can I diagnose this situation and/or make this work right?

Hmm. Curious. First things first, could you let us know the results of
"rabbitmqctl report" both before and after the creation (or not!) of
said queue. Maybe email us off-list if the output's large. Also, I don't
think any of us on the team have any experience at all with the Perl
clients so if you could let us know the exact code you're using (even if
it's rather noddy) that might just help. Also, could you check the
rabbitmq logs on both nodes to see if there's anything at all around the
times you try to create the queue?

Matthew

From nkvoll at gmail.com  Sat Sep 24 13:18:11 2011
From: nkvoll at gmail.com (Njal Karevoll)
Date: Sat, 24 Sep 2011 05:18:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Not receiving notifications about queue
	deletions from the server.
Message-ID: <19327880.2778.1316866691162.JavaMail.geo-discussion-forums@yqjw35>

Hi,

I don't seem to receive any notifications from the server when a queue I am 
consuming is deleted. Both the server and the client is stating they support 
consumer_cancel_notify. 

Here is a dump of all the frames received and sent by the client:

2011-09-24 14:15:25+0200 SENDING <ProtocolHeader(['frame_type=-1', 
'major=0', 'minor=9', 'revision=1'])>
2011-09-24 14:15:25+0200 RECEIVED: <Method(['frame_type=1', 
'channel_number=0', 
'method=<Connection.Start(["server_properties={\'information\': \'Licensed 
under the MPL.  See http://www.rabbitmq.com/\', \'product\': \'RabbitMQ\', 
\'copyright\': \'Copyright (C) 2007-2011 VMware, Inc.\', \'capabilities\': 
{\'exchange_exchange_bindings\': True, \'consumer_cancel_notify\': True, 
\'publisher_confirms\': True, \'basic.nack\': True}, \'platform\': 
\'Erlang/OTP\', \'version\': \'2.6.1\'}", \'version_minor=9\', 
\'mechanisms=PLAIN AMQPLAIN\', \'locales=en_US\', \'version_major=0\'])>'])>
2011-09-24 14:15:25+0200 SENDING <Method(['frame_type=1', 
'channel_number=0', 'method=<Connection.StartOk([\'locale=en_US\', 
\'mechanism=PLAIN\', "client_properties={\'client-properties\': 
{\'consumer_cancel_notify\': True, \'publisher_confirms\': True, 
\'basic.nack\': True}, \'platform\': \'Python 2.7.1\', \'product\': \'Pika 
Python Client Library\', \'version\': \'0.9.6-pre0\', \'information\': \'See 
http://pika.github.com\'}", \'response=\\x00guest\\x00guest\'])>'])>
2011-09-24 14:15:25+0200 RECEIVED: <Method(['frame_type=1', 
'channel_number=0', "method=<Connection.Tune(['frame_max=131072', 
'channel_max=0', 'heartbeat=0'])>"])>
2011-09-24 14:15:25+0200 SENDING <Method(['frame_type=1', 
'channel_number=0', "method=<Connection.TuneOk(['frame_max=131072', 
'channel_max=0', 'heartbeat=True'])>"])>
2011-09-24 14:15:25+0200 SENDING <Method(['frame_type=1', 
'channel_number=0', "method=<Connection.Open(['insist=True', 
'capabilities=', 'virtual_host=/'])>"])>
2011-09-24 14:15:25+0200 RECEIVED: <Method(['frame_type=1', 
'channel_number=0', "method=<Connection.OpenOk(['known_hosts='])>"])>
2011-09-24 14:15:25+0200 SENDING <Method(['frame_type=1', 
'channel_number=1', "method=<Channel.Open(['out_of_band='])>"])>
2011-09-24 14:15:25+0200 finished keeping connect working
2011-09-24 14:15:25+0200 RECEIVED: <Method(['frame_type=1', 
'channel_number=1', "method=<Channel.OpenOk(['channel_id='])>"])>
2011-09-24 14:15:25+0200 SENDING <Method(['frame_type=1', 
'channel_number=1', "method=<Basic.Qos(['prefetch_count=2', 
'prefetch_size=0', 'global_=False'])>"])>
2011-09-24 14:15:25+0200 RECEIVED: <Method(['frame_type=1', 
'channel_number=1', 'method=<Basic.QosOk([])>'])>
2011-09-24 14:15:25+0200 SENDING <Method(['frame_type=1', 
'channel_number=1', "method=<Basic.Consume(['exclusive=False', 
'nowait=False', 'no_local=False', 'consumer_tag=ctag1.0', 
'queue=operations', 'arguments={}', 'ticket=0', 'no_ack=False'])>"])>
2011-09-24 14:15:25+0200 RECEIVED: <Method(['frame_type=1', 
'channel_number=1', "method=<Basic.ConsumeOk(['consumer_tag=ctag1.0'])>"])>
2011-09-24 14:15:26+0200 RECEIVED: <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:27+0200 SENDING <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:27+0200 RECEIVED: <Heartbeat(['frame_type=8', 
'channel_number=0'])>
# << deleted the queue using rabbitmq-management here >>
2011-09-24 14:15:28+0200 SENDING <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:28+0200 RECEIVED: <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:29+0200 SENDING <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:29+0200 RECEIVED: <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:30+0200 SENDING <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:30+0200 RECEIVED: <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:31+0200 SENDING <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:31+0200 RECEIVED: <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:32+0200 SENDING <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:32+0200 RECEIVED: <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:33+0200 SENDING <Heartbeat(['frame_type=8', 
'channel_number=0'])>
2011-09-24 14:15:33+0200 RECEIVED: <Heartbeat(['frame_type=8', 
'channel_number=0'])>

rabbitmq-management says the following about the connection:

client-propertiesconsumer_cancel_notify:truepublisher_confirms:true
basic.nack:trueplatformPython 2.7.1productPika Python Client Libraryversion
0.9.6-pre0informationSee http://pika.github.com
Im using RabbitMQ 2.6.1 (on OSX), Erlang 5.8.4.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110924/07c15755/attachment.htm>

From matthew at rabbitmq.com  Sat Sep 24 16:17:20 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 24 Sep 2011 16:17:20 +0100
Subject: [rabbitmq-discuss] Not receiving notifications about queue
 deletions from the server.
In-Reply-To: <19327880.2778.1316866691162.JavaMail.geo-discussion-forums@yqjw35>
References: <19327880.2778.1316866691162.JavaMail.geo-discussion-forums@yqjw35>
Message-ID: <20110924151720.GB24946@wellquite.org>

Hi Njal,

On Sat, Sep 24, 2011 at 05:18:11AM -0700, Njal Karevoll wrote:
> I don't seem to receive any notifications from the server when a queue I am 
> consuming is deleted. Both the server and the client is stating they support 
> consumer_cancel_notify. 
> 
> 2011-09-24 14:15:25+0200 SENDING <ProtocolHeader(['frame_type=-1', 
> 'major=0', 'minor=9', 'revision=1'])>
> 2011-09-24 14:15:25+0200 RECEIVED: <Method(['frame_type=1', 
> 'channel_number=0', 
> 'method=<Connection.Start(["server_properties={\'information\': \'Licensed 
> under the MPL.  See http://www.rabbitmq.com/\', \'product\': \'RabbitMQ\', 
> \'copyright\': \'Copyright (C) 2007-2011 VMware, Inc.\', \'capabilities\': 
> {\'exchange_exchange_bindings\': True, \'consumer_cancel_notify\': True, 
> \'publisher_confirms\': True, \'basic.nack\': True}, \'platform\': 
> \'Erlang/OTP\', \'version\': \'2.6.1\'}", \'version_minor=9\', 
> \'mechanisms=PLAIN AMQPLAIN\', \'locales=en_US\', \'version_major=0\'])>'])>

> 2011-09-24 14:15:25+0200 SENDING <Method(['frame_type=1', 
> 'channel_number=0', 'method=<Connection.StartOk([\'locale=en_US\', 
> \'mechanism=PLAIN\', "client_properties={\'client-properties\': 
> {\'consumer_cancel_notify\': True, \'publisher_confirms\': True, 
> \'basic.nack\': True}, \'platform\': \'Python 2.7.1\', \'product\': \'Pika 
> Python Client Library\', \'version\': \'0.9.6-pre0\', \'information\': \'See 
> http://pika.github.com\'}", \'response=\\x00guest\\x00guest\'])>'])>

This is wrong. Connection.Start-OK's client_properties needs to contain
the key "capabilities" which is then the table as described in
http://www.rabbitmq.com/extensions.html#capabilities, whereas what's
being sent here is a key of "client-properties".

Matthew

From gmr at myyearbook.com  Sat Sep 24 16:19:17 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Sat, 24 Sep 2011 11:19:17 -0400
Subject: [rabbitmq-discuss] Not receiving notifications about queue
 deletions from the server.
In-Reply-To: <20110924151720.GB24946@wellquite.org>
References: <19327880.2778.1316866691162.JavaMail.geo-discussion-forums@yqjw35>
	<20110924151720.GB24946@wellquite.org>
Message-ID: <98186205C9604C20851216C967436ECE@myyearbook.com>

 0.9.6pre0 (GitHub master is a work in progress and I'd not consider it production worthy) 


On Saturday, September 24, 2011 at 11:17 AM, Matthew Sackman wrote:

> Hi Njal,
> 
> On Sat, Sep 24, 2011 at 05:18:11AM -0700, Njal Karevoll wrote:
> > I don't seem to receive any notifications from the server when a queue I am 
> > consuming is deleted. Both the server and the client is stating they support 
> > consumer_cancel_notify. 
> > 
> > 2011-09-24 14:15:25+0200 SENDING <ProtocolHeader(['frame_type=-1', 
> > 'major=0', 'minor=9', 'revision=1'])>
> > 2011-09-24 14:15:25+0200 RECEIVED: <Method(['frame_type=1', 
> > 'channel_number=0', 
> > 'method=<Connection.Start(["server_properties={\'information\': \'Licensed 
> > under the MPL. See http://www.rabbitmq.com/\', \'product\': \'RabbitMQ\', 
> > \'copyright\': \'Copyright (C) 2007-2011 VMware, Inc.\', \'capabilities\': 
> > {\'exchange_exchange_bindings\': True, \'consumer_cancel_notify\': True, 
> > \'publisher_confirms\': True, \'basic.nack\': True}, \'platform\': 
> > \'Erlang/OTP\', \'version\': \'2.6.1\'}", \'version_minor=9\', 
> > \'mechanisms=PLAIN AMQPLAIN\', \'locales=en_US\', \'version_major=0\'])>'])>
> 
> > 2011-09-24 14:15:25+0200 SENDING <Method(['frame_type=1', 
> > 'channel_number=0', 'method=<Connection.StartOk([\'locale=en_US\', 
> > \'mechanism=PLAIN\', "client_properties={\'client-properties\': 
> > {\'consumer_cancel_notify\': True, \'publisher_confirms\': True, 
> > \'basic.nack\': True}, \'platform\': \'Python 2.7.1\', \'product\': \'Pika 
> > Python Client Library\', \'version\': \'0.9.6-pre0\', \'information\': \'See 
> > http://pika.github.com\'}", \'response=\\x00guest\\x00guest\'])>'])>
> 
> This is wrong. Connection.Start-OK's client_properties needs to contain
> the key "capabilities" which is then the table as described in
> http://www.rabbitmq.com/extensions.html#capabilities, whereas what's
> being sent here is a key of "client-properties".
Hmm, thanks for the heads up there.


From nkvoll at gmail.com  Sat Sep 24 16:37:11 2011
From: nkvoll at gmail.com (Njal Karevoll)
Date: Sat, 24 Sep 2011 08:37:11 -0700 (PDT)
Subject: [rabbitmq-discuss] Not receiving notifications about queue
 deletions from the server.
In-Reply-To: <98186205C9604C20851216C967436ECE@myyearbook.com>
References: <19327880.2778.1316866691162.JavaMail.geo-discussion-forums@yqjw35>
	<20110924151720.GB24946@wellquite.org>
	<98186205C9604C20851216C967436ECE@myyearbook.com>
Message-ID: <26640038.519.1316878631025.JavaMail.geo-discussion-forums@yqgn17>

Thanks for the quick responses. Renaming the field that pika sends to the 
server works, and I've sent a pull request to pika covering this issue. 
(https://github.com/pika/pika/pull/90)

Regarding 0.9.6pre0 not being production worthy, I'm still in development 
myself, and will be so for some time. I also require the twisted support 
that was only recently merged to the master branch.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110924/a5e13e7f/attachment.htm>

From matthew at rabbitmq.com  Sat Sep 24 20:03:02 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Sat, 24 Sep 2011 20:03:02 +0100
Subject: [rabbitmq-discuss] Consistent Hash Exchange Type
Message-ID: <20110924190302.GC24946@wellquite.org>

Hi,

I've just written a consistent-hash exchange type plugin. See
http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/file/default/README.md
for the full README.

Currently, I've not done a .ez release so you'll need to compile
yourselves, but I'll get around to the .ez early next week, I hope.

Essentially, this plugin allows you to use an exchange to load-balance
messages between queues in such a way that the loss or addition of
queues does not cause substantial changes to the bucket selected by a
hash.

Normally we strongly suggest that you should have multiple consumers
hanging off a single queue and rely on the queue to do round-robin
between the consumers. However, in some cases, the performance of a
single queue is not sufficient and, as a queue is single threaded,
routing messages to multiple queues, especially on different machines
within the same cluster, can achieve much higher overall performance.
Without something like a consistent-hash exchange type, engineering such
a distribution of messages is difficult. There are other applications
too for such an exchange type.

As ever, feedback welcome. Note that this has received not a great deal
of testing so far - it's rather hot off the press - and whilst it works
for me, that's not to say there aren't bugs in it!

http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange


Matthew

From ekirpichov at gmail.com  Sun Sep 25 07:35:15 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Sun, 25 Sep 2011 10:35:15 +0400
Subject: [rabbitmq-discuss] Consistent Hash Exchange Type
In-Reply-To: <20110924190302.GC24946@wellquite.org>
References: <20110924190302.GC24946@wellquite.org>
Message-ID: <CANVKUrW0OUd2PP2K6h+1kghbwGu-TwZmwUk2HawPyaPMpS4q1g@mail.gmail.com>

Hi Matthew,

Sounds great, thanks for doing this! I hope I get a chance to try it out.

On Sat, Sep 24, 2011 at 11:03 PM, Matthew Sackman <matthew at rabbitmq.com> wrote:
> Hi,
>
> I've just written a consistent-hash exchange type plugin. See
> http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/file/default/README.md
> for the full README.
>
> Currently, I've not done a .ez release so you'll need to compile
> yourselves, but I'll get around to the .ez early next week, I hope.
>
> Essentially, this plugin allows you to use an exchange to load-balance
> messages between queues in such a way that the loss or addition of
> queues does not cause substantial changes to the bucket selected by a
> hash.
>
> Normally we strongly suggest that you should have multiple consumers
> hanging off a single queue and rely on the queue to do round-robin
> between the consumers. However, in some cases, the performance of a
> single queue is not sufficient and, as a queue is single threaded,
> routing messages to multiple queues, especially on different machines
> within the same cluster, can achieve much higher overall performance.
> Without something like a consistent-hash exchange type, engineering such
> a distribution of messages is difficult. There are other applications
> too for such an exchange type.
>
> As ever, feedback welcome. Note that this has received not a great deal
> of testing so far - it's rather hot off the press - and whilst it works
> for me, that's not to say there aren't bugs in it!
>
> http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange
>
>
> Matthew
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From alexandru at rabbitmq.com  Mon Sep 26 10:54:12 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 26 Sep 2011 10:54:12 +0100
Subject: [rabbitmq-discuss] acks from temporary queues
In-Reply-To: <59ccf59b-ccf4-43c3-a6f0-60eb1bf4750c@bs9g2000vbb.googlegroups.com>
References: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>
	<20110923095858.GA10396@southbank.eng.vmware.com>
	<216cd00e-d8d1-46b5-a426-4831c614d405@p4g2000vbp.googlegroups.com>
	<748f48cc-75d0-43d9-a794-bd521fee39de@k1g2000vbz.googlegroups.com>
	<4E7D0E56.9090906@rabbitmq.com>
	<59ccf59b-ccf4-43c3-a6f0-60eb1bf4750c@bs9g2000vbb.googlegroups.com>
Message-ID: <20110926095412.GA9030@southbank.eng.vmware.com>

Hi Jonathan,

> 1. Do consumer acks have more significance in transactions, such that
> I could use those to effect the functionality I'm looking for?

Not really, no.  I don't think there's anyway to get what you want
automatically.

> 2. If not, is there any way (apart from the admin HTTP API) for
> determining the number of consumers (e.g., bound queues) for a given
> exchange? This way I could test the number of reply messages as you
> suggest; otherwise, with needing to register and account for a dynamic
> array of servers, I would lose a good deal of what I had hoped would
> be the benefit of a fanout broadcast.

There's no AMQP way of finding how many queues are bound to an exchange.
As you say, there's the management API, but using that is likely to lead
to races (what happens if you query the number of queues, then one of
the machines dies before it sends its acknowledgement?).

You could kind of get what you want with AMQP.  Use a fanout exchange
like you want for broadcast messages, but use a direct exchange for
direct communication between machines.  You could use the fanout
exchange to make sure that all the machines know about each other (in
particular, that each knows the queues the others bound to the direct
exchange, so that they can communicate directly).  And you could use the
direct exchange to publish persistent, confirm, mandatory, immediate messages
directly to other machines.  With these messages, the sender will be
notified if the other machine received the message (only a confirm is
received for the publish), or if the other machine went offline in the past
(a basic.return and a confirm is received).  This way, the sending
machine would know which other machines received its message and, so,
will know to wait for the correct number of responses.  The queue bound
to the direct exchange would have to be durable, auto-delete for this to
work (durable for confirms to work and auto-delete so that once the sole
consumer dies, the queue is deleted and publishing to it will result in
a basic.return).  In addition, when processing "please log out this
user" messages, a machine should *not* acknowledge that it has
received the message until after it publishes its response (this way, if
the machine dies while processing, the sender will get a basic.return for
it). 

Hope this helps.

Cheers,
Alex

On Fri, Sep 23, 2011 at 04:44:14PM -0700, gneeri wrote:
> Hi Matthias,
> 
> Thanks for clarifying that. From the explication of the rules for
> confirms, it had appeared to me that the relationships to queues and
> consumers had more weight in the confirmation process. That not being
> the case, I have 2 brief follow up questions:
> 
> 1. Do consumer acks have more significance in transactions, such that
> I could use those to effect the functionality I'm looking for?
> 
> 2. If not, is there any way (apart from the admin HTTP API) for
> determining the number of consumers (e.g., bound queues) for a given
> exchange? This way I could test the number of reply messages as you
> suggest; otherwise, with needing to register and account for a dynamic
> array of servers, I would lose a good deal of what I had hoped would
> be the benefit of a fanout broadcast.
> 
> Thanks in advance,
> Jonathan
> 
> On Sep 23, 6:55?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> > On 23/09/11 21:26, gneeri wrote:
> >
> > > My expectation, then, is that producer would publish its message and
> > > then be blocked until the delayed consumer returns an ack
> >
> > Confirms mean one thing and one thing only: that the broker has accepted
> > responsibility for the message.
> >
> > They concern the interaction between producers and the broker, and ?have
> > nothing to do with consumer acks.
> >
> > Yes, there are some conditions in which a consumer ack can trigger a
> > confirm in RabbitMQ, but that is an implementation detail and not
> > something you'd want to design an application around.
> >
> > > My hope is that I will not have to aggregate a list of servers and
> > > pass along a single message to each server, but perhaps that is what
> > > will be required.
> >
> > You can still send a single message via a fanout exchange. But the
> > consumers then in turn need to send a message back to the sender. Your
> > sender will need to know how many consumers there are so it knows when
> > it has gotten all responses..
> >
> > Regards,
> >
> > Matthias.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From matthew at rabbitmq.com  Mon Sep 26 12:54:21 2011
From: matthew at rabbitmq.com (Matthew Sackman)
Date: Mon, 26 Sep 2011 12:54:21 +0100
Subject: [rabbitmq-discuss] RabbitMQ Shovel Connections
In-Reply-To: <4E7A7266.5050800@omc-international.com.au>
References: <4E7929EC.1070906@omc-international.com.au>
	<4E7A7266.5050800@omc-international.com.au>
Message-ID: <20110926115420.GC31944@rabbitmq.com>

Hi Mihir,

On Thu, Sep 22, 2011 at 09:25:26AM +1000, Mihir Mone wrote:
> I have currently setup the shovelling of messages from one of our client
> servers to our end via SSL. Everything works beautifully when you first
> start the servers. However, over time (2-3 days) messages just seem to
> get lost in transit. I have setup shovel to do transactional forwards so
> as to ascertain that the messages are indeed getting delivered. When I
> look at the client side server it does not show any piled up messages
> (making me believe that the messages are indeed getting forwarded
> properly). However, at our end there are no messages getting delivered
> and the queues are empty. When I look at the connections list (using the
> management plugin) I can see that the connection is still active. The
> only solution I have found so far is to restart both the servers so that
> the shovel connections get recycled.

That's mighty odd. I'd suggest you check the routing topology and such -
there's no other process deleting bindings or such that the shovel is
rely on is there? I.e. check that by the time you reach this problematic
state, that the shovel publishing messages on the downstream side isn't
just throwing those messages into the ether - sufficient
bindings/exchanges/queues exist such that those msgs really will reach
the intended queue.

> Restarting the servers can be a hassle sometimes since we have multiple
> client servers connecting to the same servers at our end. It is only
> recently that I have started using the shovel plugin. Earlier we had
> just written a shovelling application ourselves which used to perform
> the consume-publish operation but wasn't as flexible or featureful as
> the shovel plugin.

Ok. Restarting should definitely not be necessary - something is going
wrong here. As well as checking that everything is remaining set up to
correctly route messages on the down-stream side, please also have a
look through the logs on the downstream to see whether any errors are
occurring. If the shovel itself is actually running as a plugin on the
upstream side then check those logs too as the shovel will report
problems to its local node.

> So, what I was thinking was to put may be an option in the shovel
> configuration (something like "recycle_connection") so that we can force
> a connection recycle every few days (ideally I would like to do it every
> 24-36 hrs). The whole point of restarting the servers is so that the
> connections get recycled. So if there was a way in the plugin itself to
> do this, the whole server won't need a restart.

There isn't such an option, but this shouldn't be necessary either.
Something else is going wrong which should be found and fixed.

Matthew

From taylste at gmail.com  Mon Sep 26 13:41:45 2011
From: taylste at gmail.com (Steven Taylor)
Date: Mon, 26 Sep 2011 13:41:45 +0100
Subject: [rabbitmq-discuss] is sending thread safe?
Message-ID: <CA+zYriQyEXvPTsZcyQLGm0asN+_5RZ+6pdEXPzswr1NVew6OQA@mail.gmail.com>

Hi,

just checking if sending in RabbitMQ is thread safe?

Is it best to just open up a new channel if the instance needs to also
consume?

thanks,
-Steven
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110926/18c5810c/attachment.htm>

From ekirpichov at gmail.com  Mon Sep 26 13:43:47 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 26 Sep 2011 16:43:47 +0400
Subject: [rabbitmq-discuss] is sending thread safe?
In-Reply-To: <CA+zYriQyEXvPTsZcyQLGm0asN+_5RZ+6pdEXPzswr1NVew6OQA@mail.gmail.com>
References: <CA+zYriQyEXvPTsZcyQLGm0asN+_5RZ+6pdEXPzswr1NVew6OQA@mail.gmail.com>
Message-ID: <CANVKUrWJdq-P1m9H5QMYfRCs5LqESkBoxB9CLs8R8GaxbXwosQ@mail.gmail.com>

Which language's client are you talking about?
.NET client is not thread safe, for example.

On Mon, Sep 26, 2011 at 4:41 PM, Steven Taylor <taylste at gmail.com> wrote:
> Hi,
>
> just checking if sending in RabbitMQ is thread safe?
>
> Is it best to just open up a new channel if the instance needs to also
> consume?
>
> thanks,
> -Steven
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From taylste at gmail.com  Mon Sep 26 13:53:52 2011
From: taylste at gmail.com (Steven Taylor)
Date: Mon, 26 Sep 2011 13:53:52 +0100
Subject: [rabbitmq-discuss] is sending thread safe?
In-Reply-To: <CANVKUrWJdq-P1m9H5QMYfRCs5LqESkBoxB9CLs8R8GaxbXwosQ@mail.gmail.com>
References: <CA+zYriQyEXvPTsZcyQLGm0asN+_5RZ+6pdEXPzswr1NVew6OQA@mail.gmail.com>
	<CANVKUrWJdq-P1m9H5QMYfRCs5LqESkBoxB9CLs8R8GaxbXwosQ@mail.gmail.com>
Message-ID: <CA+zYriQkfGcA-oZSv+uU7r0mTbbwJNtScn6ipUFkOjxnYfPRLw@mail.gmail.com>

Its a .net client.  I have an asynchronous sending requirement (I will queue
these up via .Net), and a synchronous receive/subscribe.  Technically that's
two threads.  So I wondered if a single Rabbit channel would crash if it
tried to send and receive simultaneously.  Should I take the cautious
approach?

-Steven

On 26 September 2011 13:43, Eugene Kirpichov <ekirpichov at gmail.com> wrote:

> Which language's client are you talking about?
> .NET client is not thread safe, for example.
>
> On Mon, Sep 26, 2011 at 4:41 PM, Steven Taylor <taylste at gmail.com> wrote:
> > Hi,
> >
> > just checking if sending in RabbitMQ is thread safe?
> >
> > Is it best to just open up a new channel if the instance needs to also
> > consume?
> >
> > thanks,
> > -Steven
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
>
>
> --
> Eugene Kirpichov
> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
> Editor, http://fprog.ru/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110926/b8318c2e/attachment.htm>

From ekirpichov at gmail.com  Mon Sep 26 13:55:30 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Mon, 26 Sep 2011 16:55:30 +0400
Subject: [rabbitmq-discuss] is sending thread safe?
In-Reply-To: <CA+zYriQkfGcA-oZSv+uU7r0mTbbwJNtScn6ipUFkOjxnYfPRLw@mail.gmail.com>
References: <CA+zYriQyEXvPTsZcyQLGm0asN+_5RZ+6pdEXPzswr1NVew6OQA@mail.gmail.com>
	<CANVKUrWJdq-P1m9H5QMYfRCs5LqESkBoxB9CLs8R8GaxbXwosQ@mail.gmail.com>
	<CA+zYriQkfGcA-oZSv+uU7r0mTbbwJNtScn6ipUFkOjxnYfPRLw@mail.gmail.com>
Message-ID: <CANVKUrWbag1G0KjKVAFV9RpSw40oTt4Ni4f_to9WXM5DqAzLyQ@mail.gmail.com>

Yes, you should. The documentation explicitly states that IModel is
not thread-safe.

On Mon, Sep 26, 2011 at 4:53 PM, Steven Taylor <taylste at gmail.com> wrote:
> Its a .net client.? I have an asynchronous sending requirement (I will queue
> these up via .Net), and a synchronous receive/subscribe.? Technically that's
> two threads.? So I wondered if a single Rabbit channel would crash if it
> tried to send and receive simultaneously.? Should I take the cautious
> approach?
>
> -Steven
>
> On 26 September 2011 13:43, Eugene Kirpichov <ekirpichov at gmail.com> wrote:
>>
>> Which language's client are you talking about?
>> .NET client is not thread safe, for example.
>>
>> On Mon, Sep 26, 2011 at 4:41 PM, Steven Taylor <taylste at gmail.com> wrote:
>> > Hi,
>> >
>> > just checking if sending in RabbitMQ is thread safe?
>> >
>> > Is it best to just open up a new channel if the instance needs to also
>> > consume?
>> >
>> > thanks,
>> > -Steven
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>>
>>
>> --
>> Eugene Kirpichov
>> Principal Engineer, Mirantis Inc. http://www.mirantis.com/
>> Editor, http://fprog.ru/
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From kyleo at 0b10.mx  Mon Sep 26 14:28:58 2011
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Mon, 26 Sep 2011 09:28:58 -0400 (EDT)
Subject: [rabbitmq-discuss] defining role type in a cluster
In-Reply-To: <39184168-cb6c-4f52-aea2-eeca350835b1@mx1.0b10.mx>
Message-ID: <a7f2cb2e-6f23-4e3d-a801-3531d32c0213@mx1.0b10.mx>

Hi,

Does anyone know if it's possible to define whether a node in a cluster is a disc or ram node via the rabbitmq.config file?  I am trying to ensure that if a node leaves the cluster for some reason it comes back as the appropriate node type.

Thanks,
Kyle

From gneeri at gmail.com  Mon Sep 26 16:04:28 2011
From: gneeri at gmail.com (gneeri)
Date: Mon, 26 Sep 2011 08:04:28 -0700 (PDT)
Subject: [rabbitmq-discuss] acks from temporary queues
In-Reply-To: <20110926095412.GA9030@southbank.eng.vmware.com>
References: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>
	<20110923095858.GA10396@southbank.eng.vmware.com>
	<216cd00e-d8d1-46b5-a426-4831c614d405@p4g2000vbp.googlegroups.com>
	<748f48cc-75d0-43d9-a794-bd521fee39de@k1g2000vbz.googlegroups.com>
	<4E7D0E56.9090906@rabbitmq.com>
	<59ccf59b-ccf4-43c3-a6f0-60eb1bf4750c@bs9g2000vbb.googlegroups.com>
	<20110926095412.GA9030@southbank.eng.vmware.com>
Message-ID: <74822248-fb33-40ac-b78b-8c7e3147d8cf@z20g2000vbl.googlegroups.com>

Hi Alex,

Thanks so much for the detailed reply. I had begun thinking along
these lines, but really appreciate the level of detail regarding the
specific types of publish requests, queues and exchanges. This is
really helpful and will likely save me many hours of trial and error.
I do have just one quick question though regarding the following:

"In addition, when processing "please log out this user" messages, a
machine should *not* acknowledge that it has received the message
until after it publishes its response (this way, if the machine dies
while processing, the sender will get a basic.return for it)."

Am I correct in understanding from this that, in the direct exchange
context, I can control when the consumer machine sends back its ack,
by calling something like basicAck at some point in the consumption/
delivery code? If so, I would expect that I could skip the return
publishing (i.e., the response) from the consumer to the producer and
simply check confirms and confirms + basic.returns for each message
sent directly to each machine. Moreover, if, prior to publishing, I
associate the machine (or direct queue corresponding to it) to the
message to be sent, I should be able to find out which machines
present which form of response (i.e., confirm or confirm +
basic.return). Does this make sense or am I still reading too much
into the consumer ack (such that, for example, the confirmation
received by the publisher just represents the handoff of the message
to the queue and not its uptake by the consumer)?

Thanks again, really, I very much appreciate your help.

Cheers,
Jonathan


On Sep 26, 5:54?am, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> Hi Jonathan,
>
> > 1. Do consumer acks have more significance in transactions, such that
> > I could use those to effect the functionality I'm looking for?
>
> Not really, no. ?I don't think there's anyway to get what you want
> automatically.
>
> > 2. If not, is there any way (apart from the admin HTTP API) for
> > determining the number of consumers (e.g., bound queues) for a given
> > exchange? This way I could test the number of reply messages as you
> > suggest; otherwise, with needing to register and account for a dynamic
> > array of servers, I would lose a good deal of what I had hoped would
> > be the benefit of a fanout broadcast.
>
> There's no AMQP way of finding how many queues are bound to an exchange.
> As you say, there's the management API, but using that is likely to lead
> to races (what happens if you query the number of queues, then one of
> the machines dies before it sends its acknowledgement?).
>
> You could kind of get what you want with AMQP. ?Use a fanout exchange
> like you want for broadcast messages, but use a direct exchange for
> direct communication between machines. ?You could use the fanout
> exchange to make sure that all the machines know about each other (in
> particular, that each knows the queues the others bound to the direct
> exchange, so that they can communicate directly). ?And you could use the
> direct exchange to publish persistent, confirm, mandatory, immediate messages
> directly to other machines. ?With these messages, the sender will be
> notified if the other machine received the message (only a confirm is
> received for the publish), or if the other machine went offline in the past
> (a basic.return and a confirm is received). ?This way, the sending
> machine would know which other machines received its message and, so,
> will know to wait for the correct number of responses. ?The queue bound
> to the direct exchange would have to be durable, auto-delete for this to
> work (durable for confirms to work and auto-delete so that once the sole
> consumer dies, the queue is deleted and publishing to it will result in
> a basic.return). ?In addition, when processing "please log out this
> user" messages, a machine should *not* acknowledge that it has
> received the message until after it publishes its response (this way, if
> the machine dies while processing, the sender will get a basic.return for
> it).
>
> Hope this helps.
>
> Cheers,
> Alex
>
>
>
>
>
>
>
>
>
> On Fri, Sep 23, 2011 at 04:44:14PM -0700, gneeri wrote:
> > Hi Matthias,
>
> > Thanks for clarifying that. From the explication of the rules for
> > confirms, it had appeared to me that the relationships to queues and
> > consumers had more weight in the confirmation process. That not being
> > the case, I have 2 brief follow up questions:
>
> > 1. Do consumer acks have more significance in transactions, such that
> > I could use those to effect the functionality I'm looking for?
>
> > 2. If not, is there any way (apart from the admin HTTP API) for
> > determining the number of consumers (e.g., bound queues) for a given
> > exchange? This way I could test the number of reply messages as you
> > suggest; otherwise, with needing to register and account for a dynamic
> > array of servers, I would lose a good deal of what I had hoped would
> > be the benefit of a fanout broadcast.
>
> > Thanks in advance,
> > Jonathan
>
> > On Sep 23, 6:55?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> > > On 23/09/11 21:26, gneeri wrote:
>
> > > > My expectation, then, is that producer would publish its message and
> > > > then be blocked until the delayed consumer returns an ack
>
> > > Confirms mean one thing and one thing only: that the broker has accepted
> > > responsibility for the message.
>
> > > They concern the interaction between producers and the broker, and ?have
> > > nothing to do with consumer acks.
>
> > > Yes, there are some conditions in which a consumer ack can trigger a
> > > confirm in RabbitMQ, but that is an implementation detail and not
> > > something you'd want to design an application around.
>
> > > > My hope is that I will not have to aggregate a list of servers and
> > > > pass along a single message to each server, but perhaps that is what
> > > > will be required.
>
> > > You can still send a single message via a fanout exchange. But the
> > > consumers then in turn need to send a message back to the sender. Your
> > > sender will need to know how many consumers there are so it knows when
> > > it has gotten all responses..
>
> > > Regards,
>
> > > Matthias.
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Mon Sep 26 16:34:33 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 26 Sep 2011 16:34:33 +0100
Subject: [rabbitmq-discuss] acks from temporary queues
In-Reply-To: <74822248-fb33-40ac-b78b-8c7e3147d8cf@z20g2000vbl.googlegroups.com>
References: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>
	<20110923095858.GA10396@southbank.eng.vmware.com>
	<216cd00e-d8d1-46b5-a426-4831c614d405@p4g2000vbp.googlegroups.com>
	<748f48cc-75d0-43d9-a794-bd521fee39de@k1g2000vbz.googlegroups.com>
	<4E7D0E56.9090906@rabbitmq.com>
	<59ccf59b-ccf4-43c3-a6f0-60eb1bf4750c@bs9g2000vbb.googlegroups.com>
	<20110926095412.GA9030@southbank.eng.vmware.com>
	<74822248-fb33-40ac-b78b-8c7e3147d8cf@z20g2000vbl.googlegroups.com>
Message-ID: <20110926153432.GB9030@southbank.eng.vmware.com>

Hi Jonathan,

> "In addition, when processing "please log out this user" messages, a
> machine should *not* acknowledge that it has received the message
> until after it publishes its response (this way, if the machine dies
> while processing, the sender will get a basic.return for it)."
> 
> Am I correct in understanding from this that, in the direct exchange
> context, I can control when the consumer machine sends back its ack,
> by calling something like basicAck at some point in the consumption/
> delivery code?

The exchange type has nothing to do with it.  When you consume from a
queue, you specify the autoAck parameter.  If this is set to true
(which it is, by default), then the server will not wait for the
consumer to acknowledge receipt of the message (so, it's effectively
auto-ack'ing all messages).  If it's set to false, the broker will not
consider the message delivered to the consumer until it explicitly ack's
the message.  See the API guide for an example (I assume you're using
the Java client, but the other clients have very similar APIs):
  http://www.rabbitmq.com/api-guide.html#consuming

> If so, I would expect that I could skip the return
> publishing (i.e., the response) from the consumer to the producer and
> simply check confirms and confirms + basic.returns for each message
> sent directly to each machine. Moreover, if, prior to publishing, I
> associate the machine (or direct queue corresponding to it) to the
> message to be sent, I should be able to find out which machines
> present which form of response (i.e., confirm or confirm +
> basic.return). Does this make sense or am I still reading too much
> into the consumer ack (such that, for example, the confirmation
> received by the publisher just represents the handoff of the message
> to the queue and not its uptake by the consumer)?

Oh.  I missed that.  Yes, I think that would work.

Cheers,
Alex

On Mon, Sep 26, 2011 at 08:04:28AM -0700, gneeri wrote:
> Hi Alex,
> 
> Thanks so much for the detailed reply. I had begun thinking along
> these lines, but really appreciate the level of detail regarding the
> specific types of publish requests, queues and exchanges. This is
> really helpful and will likely save me many hours of trial and error.
> I do have just one quick question though regarding the following:
> 
> "In addition, when processing "please log out this user" messages, a
> machine should *not* acknowledge that it has received the message
> until after it publishes its response (this way, if the machine dies
> while processing, the sender will get a basic.return for it)."
> 
> Am I correct in understanding from this that, in the direct exchange
> context, I can control when the consumer machine sends back its ack,
> by calling something like basicAck at some point in the consumption/
> delivery code? If so, I would expect that I could skip the return
> publishing (i.e., the response) from the consumer to the producer and
> simply check confirms and confirms + basic.returns for each message
> sent directly to each machine. Moreover, if, prior to publishing, I
> associate the machine (or direct queue corresponding to it) to the
> message to be sent, I should be able to find out which machines
> present which form of response (i.e., confirm or confirm +
> basic.return). Does this make sense or am I still reading too much
> into the consumer ack (such that, for example, the confirmation
> received by the publisher just represents the handoff of the message
> to the queue and not its uptake by the consumer)?
> 
> Thanks again, really, I very much appreciate your help.
> 
> Cheers,
> Jonathan
> 
> 
> On Sep 26, 5:54?am, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> > Hi Jonathan,
> >
> > > 1. Do consumer acks have more significance in transactions, such that
> > > I could use those to effect the functionality I'm looking for?
> >
> > Not really, no. ?I don't think there's anyway to get what you want
> > automatically.
> >
> > > 2. If not, is there any way (apart from the admin HTTP API) for
> > > determining the number of consumers (e.g., bound queues) for a given
> > > exchange? This way I could test the number of reply messages as you
> > > suggest; otherwise, with needing to register and account for a dynamic
> > > array of servers, I would lose a good deal of what I had hoped would
> > > be the benefit of a fanout broadcast.
> >
> > There's no AMQP way of finding how many queues are bound to an exchange.
> > As you say, there's the management API, but using that is likely to lead
> > to races (what happens if you query the number of queues, then one of
> > the machines dies before it sends its acknowledgement?).
> >
> > You could kind of get what you want with AMQP. ?Use a fanout exchange
> > like you want for broadcast messages, but use a direct exchange for
> > direct communication between machines. ?You could use the fanout
> > exchange to make sure that all the machines know about each other (in
> > particular, that each knows the queues the others bound to the direct
> > exchange, so that they can communicate directly). ?And you could use the
> > direct exchange to publish persistent, confirm, mandatory, immediate messages
> > directly to other machines. ?With these messages, the sender will be
> > notified if the other machine received the message (only a confirm is
> > received for the publish), or if the other machine went offline in the past
> > (a basic.return and a confirm is received). ?This way, the sending
> > machine would know which other machines received its message and, so,
> > will know to wait for the correct number of responses. ?The queue bound
> > to the direct exchange would have to be durable, auto-delete for this to
> > work (durable for confirms to work and auto-delete so that once the sole
> > consumer dies, the queue is deleted and publishing to it will result in
> > a basic.return). ?In addition, when processing "please log out this
> > user" messages, a machine should *not* acknowledge that it has
> > received the message until after it publishes its response (this way, if
> > the machine dies while processing, the sender will get a basic.return for
> > it).
> >
> > Hope this helps.
> >
> > Cheers,
> > Alex
> >
> >
> >
> >
> >
> >
> >
> >
> >
> > On Fri, Sep 23, 2011 at 04:44:14PM -0700, gneeri wrote:
> > > Hi Matthias,
> >
> > > Thanks for clarifying that. From the explication of the rules for
> > > confirms, it had appeared to me that the relationships to queues and
> > > consumers had more weight in the confirmation process. That not being
> > > the case, I have 2 brief follow up questions:
> >
> > > 1. Do consumer acks have more significance in transactions, such that
> > > I could use those to effect the functionality I'm looking for?
> >
> > > 2. If not, is there any way (apart from the admin HTTP API) for
> > > determining the number of consumers (e.g., bound queues) for a given
> > > exchange? This way I could test the number of reply messages as you
> > > suggest; otherwise, with needing to register and account for a dynamic
> > > array of servers, I would lose a good deal of what I had hoped would
> > > be the benefit of a fanout broadcast.
> >
> > > Thanks in advance,
> > > Jonathan
> >
> > > On Sep 23, 6:55?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> > > > On 23/09/11 21:26, gneeri wrote:
> >
> > > > > My expectation, then, is that producer would publish its message and
> > > > > then be blocked until the delayed consumer returns an ack
> >
> > > > Confirms mean one thing and one thing only: that the broker has accepted
> > > > responsibility for the message.
> >
> > > > They concern the interaction between producers and the broker, and ?have
> > > > nothing to do with consumer acks.
> >
> > > > Yes, there are some conditions in which a consumer ack can trigger a
> > > > confirm in RabbitMQ, but that is an implementation detail and not
> > > > something you'd want to design an application around.
> >
> > > > > My hope is that I will not have to aggregate a list of servers and
> > > > > pass along a single message to each server, but perhaps that is what
> > > > > will be required.
> >
> > > > You can still send a single message via a fanout exchange. But the
> > > > consumers then in turn need to send a message back to the sender. Your
> > > > sender will need to know how many consumers there are so it knows when
> > > > it has gotten all responses..
> >
> > > > Regards,
> >
> > > > Matthias.
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gneeri at gmail.com  Mon Sep 26 17:04:06 2011
From: gneeri at gmail.com (gneeri)
Date: Mon, 26 Sep 2011 09:04:06 -0700 (PDT)
Subject: [rabbitmq-discuss] acks from temporary queues
In-Reply-To: <20110926153432.GB9030@southbank.eng.vmware.com>
References: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>
	<20110923095858.GA10396@southbank.eng.vmware.com>
	<216cd00e-d8d1-46b5-a426-4831c614d405@p4g2000vbp.googlegroups.com>
	<748f48cc-75d0-43d9-a794-bd521fee39de@k1g2000vbz.googlegroups.com>
	<4E7D0E56.9090906@rabbitmq.com>
	<59ccf59b-ccf4-43c3-a6f0-60eb1bf4750c@bs9g2000vbb.googlegroups.com>
	<20110926095412.GA9030@southbank.eng.vmware.com>
	<74822248-fb33-40ac-b78b-8c7e3147d8cf@z20g2000vbl.googlegroups.com>
	<20110926153432.GB9030@southbank.eng.vmware.com>
Message-ID: <1dabc218-36de-4bcb-8e28-04741d32d211@t16g2000yqm.googlegroups.com>

Hi Alex,

This is a point of confusion for me then. In a previous note where I
mentioned setting autoAck to false and manually using basicAck,
Matthias replied as follows:

"Confirms mean one thing and one thing only: that the broker has
accepted
responsibility for the message.

"They concern the interaction between producers and the broker, and
have
nothing to do with consumer acks."

If in the fanout context I could have used consumer acks to hold off
broker acks to the publisher, I would have expected that I could
effectively block confirms until after I sent basicAcks from the
consumer to the broker and then on up to the publisher. From
Matthias's note (and my tests), however, it appears that the broker
sends an ack back to the publisher as soon as it takes control of the
message and so issues a confirm without waiting on anything from the
consumer. In the direct exchange context, however, I took your notes
to be indicating that the broker there will wait for an ack from the
consumer, such that if the consumer died while in process, but before
sending the ack, the broker would return a basic.return along with the
confirm. If this is not the case, then, my sense is that I will have
to have the consumers publish a response directly back to original
publisher as Matthias notes--while using the fanout broadcast to keep
track of the number of expected responses (as you indicate).

Does that make sense? Basically, it still orbits around a question of
how and/or if consumer acks can be made to effect a producer. I am
guessing that my implementation will have to require the return
publications (responses), but any clarification you could add to the
consumer ack, confirm chain would be greatly appreciated.

Thanks,
Jonathan


On Sep 26, 11:34?am, Alexandru Scvor?ov <alexan... at rabbitmq.com>
wrote:
> Hi Jonathan,
>
> > "In addition, when processing "please log out this user" messages, a
> > machine should *not* acknowledge that it has received the message
> > until after it publishes its response (this way, if the machine dies
> > while processing, the sender will get a basic.return for it)."
>
> > Am I correct in understanding from this that, in the direct exchange
> > context, I can control when the consumer machine sends back its ack,
> > by calling something like basicAck at some point in the consumption/
> > delivery code?
>
> The exchange type has nothing to do with it. ?When you consume from a
> queue, you specify the autoAck parameter. ?If this is set to true
> (which it is, by default), then the server will not wait for the
> consumer to acknowledge receipt of the message (so, it's effectively
> auto-ack'ing all messages). ?If it's set to false, the broker will not
> consider the message delivered to the consumer until it explicitly ack's
> the message. ?See the API guide for an example (I assume you're using
> the Java client, but the other clients have very similar APIs):
> ?http://www.rabbitmq.com/api-guide.html#consuming
>
> > If so, I would expect that I could skip the return
> > publishing (i.e., the response) from the consumer to the producer and
> > simply check confirms and confirms + basic.returns for each message
> > sent directly to each machine. Moreover, if, prior to publishing, I
> > associate the machine (or direct queue corresponding to it) to the
> > message to be sent, I should be able to find out which machines
> > present which form of response (i.e., confirm or confirm +
> > basic.return). Does this make sense or am I still reading too much
> > into the consumer ack (such that, for example, the confirmation
> > received by the publisher just represents the handoff of the message
> > to the queue and not its uptake by the consumer)?
>
> Oh. ?I missed that. ?Yes, I think that would work.
>
> Cheers,
> Alex
>
>
>
>
>
>
>
>
>
> On Mon, Sep 26, 2011 at 08:04:28AM -0700, gneeri wrote:
> > Hi Alex,
>
> > Thanks so much for the detailed reply. I had begun thinking along
> > these lines, but really appreciate the level of detail regarding the
> > specific types of publish requests, queues and exchanges. This is
> > really helpful and will likely save me many hours of trial and error.
> > I do have just one quick question though regarding the following:
>
> > "In addition, when processing "please log out this user" messages, a
> > machine should *not* acknowledge that it has received the message
> > until after it publishes its response (this way, if the machine dies
> > while processing, the sender will get a basic.return for it)."
>
> > Am I correct in understanding from this that, in the direct exchange
> > context, I can control when the consumer machine sends back its ack,
> > by calling something like basicAck at some point in the consumption/
> > delivery code? If so, I would expect that I could skip the return
> > publishing (i.e., the response) from the consumer to the producer and
> > simply check confirms and confirms + basic.returns for each message
> > sent directly to each machine. Moreover, if, prior to publishing, I
> > associate the machine (or direct queue corresponding to it) to the
> > message to be sent, I should be able to find out which machines
> > present which form of response (i.e., confirm or confirm +
> > basic.return). Does this make sense or am I still reading too much
> > into the consumer ack (such that, for example, the confirmation
> > received by the publisher just represents the handoff of the message
> > to the queue and not its uptake by the consumer)?
>
> > Thanks again, really, I very much appreciate your help.
>
> > Cheers,
> > Jonathan
>
> > On Sep 26, 5:54?am, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> > > Hi Jonathan,
>
> > > > 1. Do consumer acks have more significance in transactions, such that
> > > > I could use those to effect the functionality I'm looking for?
>
> > > Not really, no. ?I don't think there's anyway to get what you want
> > > automatically.
>
> > > > 2. If not, is there any way (apart from the admin HTTP API) for
> > > > determining the number of consumers (e.g., bound queues) for a given
> > > > exchange? This way I could test the number of reply messages as you
> > > > suggest; otherwise, with needing to register and account for a dynamic
> > > > array of servers, I would lose a good deal of what I had hoped would
> > > > be the benefit of a fanout broadcast.
>
> > > There's no AMQP way of finding how many queues are bound to an exchange.
> > > As you say, there's the management API, but using that is likely to lead
> > > to races (what happens if you query the number of queues, then one of
> > > the machines dies before it sends its acknowledgement?).
>
> > > You could kind of get what you want with AMQP. ?Use a fanout exchange
> > > like you want for broadcast messages, but use a direct exchange for
> > > direct communication between machines. ?You could use the fanout
> > > exchange to make sure that all the machines know about each other (in
> > > particular, that each knows the queues the others bound to the direct
> > > exchange, so that they can communicate directly). ?And you could use the
> > > direct exchange to publish persistent, confirm, mandatory, immediate messages
> > > directly to other machines. ?With these messages, the sender will be
> > > notified if the other machine received the message (only a confirm is
> > > received for the publish), or if the other machine went offline in the past
> > > (a basic.return and a confirm is received). ?This way, the sending
> > > machine would know which other machines received its message and, so,
> > > will know to wait for the correct number of responses. ?The queue bound
> > > to the direct exchange would have to be durable, auto-delete for this to
> > > work (durable for confirms to work and auto-delete so that once the sole
> > > consumer dies, the queue is deleted and publishing to it will result in
> > > a basic.return). ?In addition, when processing "please log out this
> > > user" messages, a machine should *not* acknowledge that it has
> > > received the message until after it publishes its response (this way, if
> > > the machine dies while processing, the sender will get a basic.return for
> > > it).
>
> > > Hope this helps.
>
> > > Cheers,
> > > Alex
>
> > > On Fri, Sep 23, 2011 at 04:44:14PM -0700, gneeri wrote:
> > > > Hi Matthias,
>
> > > > Thanks for clarifying that. From the explication of the rules for
> > > > confirms, it had appeared to me that the relationships to queues and
> > > > consumers had more weight in the confirmation process. That not being
> > > > the case, I have 2 brief follow up questions:
>
> > > > 1. Do consumer acks have more significance in transactions, such that
> > > > I could use those to effect the functionality I'm looking for?
>
> > > > 2. If not, is there any way (apart from the admin HTTP API) for
> > > > determining the number of consumers (e.g., bound queues) for a given
> > > > exchange? This way I could test the number of reply messages as you
> > > > suggest; otherwise, with needing to register and account for a dynamic
> > > > array of servers, I would lose a good deal of what I had hoped would
> > > > be the benefit of a fanout broadcast.
>
> > > > Thanks in advance,
> > > > Jonathan
>
> > > > On Sep 23, 6:55?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> > > > > On 23/09/11 21:26, gneeri wrote:
>
> > > > > > My expectation, then, is that producer would publish its message and
> > > > > > then be blocked until the delayed consumer returns an ack
>
> > > > > Confirms mean one thing and one thing only: that the broker has accepted
> > > > > responsibility for the message.
>
> > > > > They concern the interaction between producers and the broker, and ?have
> > > > > nothing to do with consumer acks.
>
> > > > > Yes, there are some conditions in which a consumer ack can trigger a
> > > > > confirm in RabbitMQ, but that is an implementation detail and not
> > > > > something you'd want to design an application around.
>
> > > > > > My hope is that I will not have to aggregate a list of servers and
> > > > > > pass along a single message to each server, but perhaps that is what
> > > > > > will be required.
>
> > > > > You can still send a single message via a fanout exchange. But the
> > > > > consumers then in turn need to send a message back to the sender. Your
> > > > > sender will need to know how many consumers there are so it knows when
> > > > > it has gotten all responses..
>
> > > > > Regards,
>
> > > > > Matthias.
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.com
> > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Mon Sep 26 17:28:24 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Mon, 26 Sep 2011 17:28:24 +0100
Subject: [rabbitmq-discuss] acks from temporary queues
In-Reply-To: <1dabc218-36de-4bcb-8e28-04741d32d211@t16g2000yqm.googlegroups.com>
References: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>
	<20110923095858.GA10396@southbank.eng.vmware.com>
	<216cd00e-d8d1-46b5-a426-4831c614d405@p4g2000vbp.googlegroups.com>
	<748f48cc-75d0-43d9-a794-bd521fee39de@k1g2000vbz.googlegroups.com>
	<4E7D0E56.9090906@rabbitmq.com>
	<59ccf59b-ccf4-43c3-a6f0-60eb1bf4750c@bs9g2000vbb.googlegroups.com>
	<20110926095412.GA9030@southbank.eng.vmware.com>
	<74822248-fb33-40ac-b78b-8c7e3147d8cf@z20g2000vbl.googlegroups.com>
	<20110926153432.GB9030@southbank.eng.vmware.com>
	<1dabc218-36de-4bcb-8e28-04741d32d211@t16g2000yqm.googlegroups.com>
Message-ID: <20110926162824.GC9030@southbank.eng.vmware.com>

Hi Jonathan,

> This is a point of confusion for me then. In a previous note where I
> mentioned setting autoAck to false and manually using basicAck,
> Matthias replied as follows:

Uf, I forgot about the persister in the last message.  Sorry.

> If in the fanout context I could have used consumer acks to hold off
> broker acks to the publisher, I would have expected that I could
> effectively block confirms until after I sent basicAcks from the
> consumer to the broker and then on up to the publisher. From
> Matthias's note (and my tests), however, it appears that the broker
> sends an ack back to the publisher as soon as it takes control of the
> message and so issues a confirm without waiting on anything from the
> consumer. 

He's right.  I was hoping the immediate flag will hold off the confirm,
but, of course, it won't.

> In the direct exchange context, however, I took your notes
> to be indicating that the broker there will wait for an ack from the
> consumer, such that if the consumer died while in process, but before
> sending the ack, the broker would return a basic.return along with the
> confirm. If this is not the case, then, my sense is that I will have
> to have the consumers publish a response directly back to original
> publisher as Matthias notes--while using the fanout broadcast to keep
> track of the number of expected responses (as you indicate).

You will have to have consumers send something to the original
publisher and a fanout to keep track of responses.  You'll only need a
timeout of some sort, so that if any of the consumers takes to long to
respond, you react somehow (that probably means the consumer died
processing the message).

You'll still need the mandatory, immediate flags to at least see that
the consumer was alive and was consuming from the queue at the time the
message was sent.

> Does that make sense? Basically, it still orbits around a question of
> how and/or if consumer acks can be made to effect a producer. I am
> guessing that my implementation will have to require the return
> publications (responses), but any clarification you could add to the
> consumer ack, confirm chain would be greatly appreciated.

You'll need to publish back.  The only things confirms will give you in
this case is the guarantee that basic.returns happen before confirms.
So, once you receive the confirm, you know the message has reached the
consumer.

There's also no need to delay acknowledgement on the consumer side.

Sorry for the confusion.

Alex


On Mon, Sep 26, 2011 at 09:04:06AM -0700, gneeri wrote:
> Hi Alex,
> 
> This is a point of confusion for me then. In a previous note where I
> mentioned setting autoAck to false and manually using basicAck,
> Matthias replied as follows:
> 
> "Confirms mean one thing and one thing only: that the broker has
> accepted
> responsibility for the message.
> 
> "They concern the interaction between producers and the broker, and
> have
> nothing to do with consumer acks."
> 
> If in the fanout context I could have used consumer acks to hold off
> broker acks to the publisher, I would have expected that I could
> effectively block confirms until after I sent basicAcks from the
> consumer to the broker and then on up to the publisher. From
> Matthias's note (and my tests), however, it appears that the broker
> sends an ack back to the publisher as soon as it takes control of the
> message and so issues a confirm without waiting on anything from the
> consumer. In the direct exchange context, however, I took your notes
> to be indicating that the broker there will wait for an ack from the
> consumer, such that if the consumer died while in process, but before
> sending the ack, the broker would return a basic.return along with the
> confirm. If this is not the case, then, my sense is that I will have
> to have the consumers publish a response directly back to original
> publisher as Matthias notes--while using the fanout broadcast to keep
> track of the number of expected responses (as you indicate).
> 
> Does that make sense? Basically, it still orbits around a question of
> how and/or if consumer acks can be made to effect a producer. I am
> guessing that my implementation will have to require the return
> publications (responses), but any clarification you could add to the
> consumer ack, confirm chain would be greatly appreciated.
> 
> Thanks,
> Jonathan
> 
> 
> On Sep 26, 11:34?am, Alexandru Scvor?ov <alexan... at rabbitmq.com>
> wrote:
> > Hi Jonathan,
> >
> > > "In addition, when processing "please log out this user" messages, a
> > > machine should *not* acknowledge that it has received the message
> > > until after it publishes its response (this way, if the machine dies
> > > while processing, the sender will get a basic.return for it)."
> >
> > > Am I correct in understanding from this that, in the direct exchange
> > > context, I can control when the consumer machine sends back its ack,
> > > by calling something like basicAck at some point in the consumption/
> > > delivery code?
> >
> > The exchange type has nothing to do with it. ?When you consume from a
> > queue, you specify the autoAck parameter. ?If this is set to true
> > (which it is, by default), then the server will not wait for the
> > consumer to acknowledge receipt of the message (so, it's effectively
> > auto-ack'ing all messages). ?If it's set to false, the broker will not
> > consider the message delivered to the consumer until it explicitly ack's
> > the message. ?See the API guide for an example (I assume you're using
> > the Java client, but the other clients have very similar APIs):
> > ?http://www.rabbitmq.com/api-guide.html#consuming
> >
> > > If so, I would expect that I could skip the return
> > > publishing (i.e., the response) from the consumer to the producer and
> > > simply check confirms and confirms + basic.returns for each message
> > > sent directly to each machine. Moreover, if, prior to publishing, I
> > > associate the machine (or direct queue corresponding to it) to the
> > > message to be sent, I should be able to find out which machines
> > > present which form of response (i.e., confirm or confirm +
> > > basic.return). Does this make sense or am I still reading too much
> > > into the consumer ack (such that, for example, the confirmation
> > > received by the publisher just represents the handoff of the message
> > > to the queue and not its uptake by the consumer)?
> >
> > Oh. ?I missed that. ?Yes, I think that would work.
> >
> > Cheers,
> > Alex
> >
> >
> >
> >
> >
> >
> >
> >
> >
> > On Mon, Sep 26, 2011 at 08:04:28AM -0700, gneeri wrote:
> > > Hi Alex,
> >
> > > Thanks so much for the detailed reply. I had begun thinking along
> > > these lines, but really appreciate the level of detail regarding the
> > > specific types of publish requests, queues and exchanges. This is
> > > really helpful and will likely save me many hours of trial and error.
> > > I do have just one quick question though regarding the following:
> >
> > > "In addition, when processing "please log out this user" messages, a
> > > machine should *not* acknowledge that it has received the message
> > > until after it publishes its response (this way, if the machine dies
> > > while processing, the sender will get a basic.return for it)."
> >
> > > Am I correct in understanding from this that, in the direct exchange
> > > context, I can control when the consumer machine sends back its ack,
> > > by calling something like basicAck at some point in the consumption/
> > > delivery code? If so, I would expect that I could skip the return
> > > publishing (i.e., the response) from the consumer to the producer and
> > > simply check confirms and confirms + basic.returns for each message
> > > sent directly to each machine. Moreover, if, prior to publishing, I
> > > associate the machine (or direct queue corresponding to it) to the
> > > message to be sent, I should be able to find out which machines
> > > present which form of response (i.e., confirm or confirm +
> > > basic.return). Does this make sense or am I still reading too much
> > > into the consumer ack (such that, for example, the confirmation
> > > received by the publisher just represents the handoff of the message
> > > to the queue and not its uptake by the consumer)?
> >
> > > Thanks again, really, I very much appreciate your help.
> >
> > > Cheers,
> > > Jonathan
> >
> > > On Sep 26, 5:54?am, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> > > > Hi Jonathan,
> >
> > > > > 1. Do consumer acks have more significance in transactions, such that
> > > > > I could use those to effect the functionality I'm looking for?
> >
> > > > Not really, no. ?I don't think there's anyway to get what you want
> > > > automatically.
> >
> > > > > 2. If not, is there any way (apart from the admin HTTP API) for
> > > > > determining the number of consumers (e.g., bound queues) for a given
> > > > > exchange? This way I could test the number of reply messages as you
> > > > > suggest; otherwise, with needing to register and account for a dynamic
> > > > > array of servers, I would lose a good deal of what I had hoped would
> > > > > be the benefit of a fanout broadcast.
> >
> > > > There's no AMQP way of finding how many queues are bound to an exchange.
> > > > As you say, there's the management API, but using that is likely to lead
> > > > to races (what happens if you query the number of queues, then one of
> > > > the machines dies before it sends its acknowledgement?).
> >
> > > > You could kind of get what you want with AMQP. ?Use a fanout exchange
> > > > like you want for broadcast messages, but use a direct exchange for
> > > > direct communication between machines. ?You could use the fanout
> > > > exchange to make sure that all the machines know about each other (in
> > > > particular, that each knows the queues the others bound to the direct
> > > > exchange, so that they can communicate directly). ?And you could use the
> > > > direct exchange to publish persistent, confirm, mandatory, immediate messages
> > > > directly to other machines. ?With these messages, the sender will be
> > > > notified if the other machine received the message (only a confirm is
> > > > received for the publish), or if the other machine went offline in the past
> > > > (a basic.return and a confirm is received). ?This way, the sending
> > > > machine would know which other machines received its message and, so,
> > > > will know to wait for the correct number of responses. ?The queue bound
> > > > to the direct exchange would have to be durable, auto-delete for this to
> > > > work (durable for confirms to work and auto-delete so that once the sole
> > > > consumer dies, the queue is deleted and publishing to it will result in
> > > > a basic.return). ?In addition, when processing "please log out this
> > > > user" messages, a machine should *not* acknowledge that it has
> > > > received the message until after it publishes its response (this way, if
> > > > the machine dies while processing, the sender will get a basic.return for
> > > > it).
> >
> > > > Hope this helps.
> >
> > > > Cheers,
> > > > Alex
> >
> > > > On Fri, Sep 23, 2011 at 04:44:14PM -0700, gneeri wrote:
> > > > > Hi Matthias,
> >
> > > > > Thanks for clarifying that. From the explication of the rules for
> > > > > confirms, it had appeared to me that the relationships to queues and
> > > > > consumers had more weight in the confirmation process. That not being
> > > > > the case, I have 2 brief follow up questions:
> >
> > > > > 1. Do consumer acks have more significance in transactions, such that
> > > > > I could use those to effect the functionality I'm looking for?
> >
> > > > > 2. If not, is there any way (apart from the admin HTTP API) for
> > > > > determining the number of consumers (e.g., bound queues) for a given
> > > > > exchange? This way I could test the number of reply messages as you
> > > > > suggest; otherwise, with needing to register and account for a dynamic
> > > > > array of servers, I would lose a good deal of what I had hoped would
> > > > > be the benefit of a fanout broadcast.
> >
> > > > > Thanks in advance,
> > > > > Jonathan
> >
> > > > > On Sep 23, 6:55?pm, Matthias Radestock <matth... at rabbitmq.com> wrote:
> > > > > > On 23/09/11 21:26, gneeri wrote:
> >
> > > > > > > My expectation, then, is that producer would publish its message and
> > > > > > > then be blocked until the delayed consumer returns an ack
> >
> > > > > > Confirms mean one thing and one thing only: that the broker has accepted
> > > > > > responsibility for the message.
> >
> > > > > > They concern the interaction between producers and the broker, and ?have
> > > > > > nothing to do with consumer acks.
> >
> > > > > > Yes, there are some conditions in which a consumer ack can trigger a
> > > > > > confirm in RabbitMQ, but that is an implementation detail and not
> > > > > > something you'd want to design an application around.
> >
> > > > > > > My hope is that I will not have to aggregate a list of servers and
> > > > > > > pass along a single message to each server, but perhaps that is what
> > > > > > > will be required.
> >
> > > > > > You can still send a single message via a fanout exchange. But the
> > > > > > consumers then in turn need to send a message back to the sender. Your
> > > > > > sender will need to know how many consumers there are so it knows when
> > > > > > it has gotten all responses..
> >
> > > > > > Regards,
> >
> > > > > > Matthias.
> > > > > > _______________________________________________
> > > > > > rabbitmq-discuss mailing list
> > > > > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > > > _______________________________________________
> > > > > rabbitmq-discuss mailing list
> > > > > rabbitmq-disc... at lists.rabbitmq.com
> > > > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > > > _______________________________________________
> > > > rabbitmq-discuss mailing list
> > > > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > rabbitmq-disc... at lists.rabbitmq.com
> > >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From gneeri at gmail.com  Mon Sep 26 17:42:02 2011
From: gneeri at gmail.com (gneeri)
Date: Mon, 26 Sep 2011 09:42:02 -0700 (PDT)
Subject: [rabbitmq-discuss] acks from temporary queues
In-Reply-To: <20110926162824.GC9030@southbank.eng.vmware.com>
References: <35794e39-704b-42c7-bf91-7e80b6a0da19@i5g2000vbw.googlegroups.com>
	<20110923095858.GA10396@southbank.eng.vmware.com>
	<216cd00e-d8d1-46b5-a426-4831c614d405@p4g2000vbp.googlegroups.com>
	<748f48cc-75d0-43d9-a794-bd521fee39de@k1g2000vbz.googlegroups.com>
	<4E7D0E56.9090906@rabbitmq.com>
	<59ccf59b-ccf4-43c3-a6f0-60eb1bf4750c@bs9g2000vbb.googlegroups.com>
	<20110926095412.GA9030@southbank.eng.vmware.com>
	<74822248-fb33-40ac-b78b-8c7e3147d8cf@z20g2000vbl.googlegroups.com>
	<20110926153432.GB9030@southbank.eng.vmware.com>
	<1dabc218-36de-4bcb-8e28-04741d32d211@t16g2000yqm.googlegroups.com>
	<20110926162824.GC9030@southbank.eng.vmware.com>
Message-ID: <b79de5c5-02df-4199-9b51-76643c25ee20@k34g2000yqm.googlegroups.com>

Hi Alex,

No problem at all, and again, thanks for the clarification. I really
do appreciate the help. That said, I think I now have a decent sense
of how to proceed. I'll let you know if I run into any perplexities,
but will try not to take much more of your time.

Thanks again,
Jonathan

On Sep 26, 12:28?pm, Alexandru Scvor?ov <alexan... at rabbitmq.com>
wrote:
> Hi Jonathan,
>
> > This is a point of confusion for me then. In a previous note where I
> > mentioned setting autoAck to false and manually using basicAck,
> > Matthias replied as follows:
>
> Uf, I forgot about the persister in the last message. ?Sorry.
>
> > If in the fanout context I could have used consumer acks to hold off
> > broker acks to the publisher, I would have expected that I could
> > effectively block confirms until after I sent basicAcks from the
> > consumer to the broker and then on up to the publisher. From
> > Matthias's note (and my tests), however, it appears that the broker
> > sends an ack back to the publisher as soon as it takes control of the
> > message and so issues a confirm without waiting on anything from the
> > consumer.
>
> He's right. ?I was hoping the immediate flag will hold off the confirm,
> but, of course, it won't.
>
> > In the direct exchange context, however, I took your notes
> > to be indicating that the broker there will wait for an ack from the
> > consumer, such that if the consumer died while in process, but before
> > sending the ack, the broker would return a basic.return along with the
> > confirm. If this is not the case, then, my sense is that I will have
> > to have the consumers publish a response directly back to original
> > publisher as Matthias notes--while using the fanout broadcast to keep
> > track of the number of expected responses (as you indicate).
>
> You will have to have consumers send something to the original
> publisher and a fanout to keep track of responses. ?You'll only need a
> timeout of some sort, so that if any of the consumers takes to long to
> respond, you react somehow (that probably means the consumer died
> processing the message).
>
> You'll still need the mandatory, immediate flags to at least see that
> the consumer was alive and was consuming from the queue at the time the
> message was sent.
>
> > Does that make sense? Basically, it still orbits around a question of
> > how and/or if consumer acks can be made to effect a producer. I am
> > guessing that my implementation will have to require the return
> > publications (responses), but any clarification you could add to the
> > consumer ack, confirm chain would be greatly appreciated.
>
> You'll need to publish back. ?The only things confirms will give you in
> this case is the guarantee that basic.returns happen before confirms.
> So, once you receive the confirm, you know the message has reached the
> consumer.
>
> There's also no need to delay acknowledgement on the consumer side.
>
> Sorry for the confusion.
>
> Alex
>
>
>
>
>
>
>
> On Mon, Sep 26, 2011 at 09:04:06AM -0700, gneeri wrote:
> > Hi Alex,
>
> > This is a point of confusion for me then. In a previous note where I
> > mentioned setting autoAck to false and manually using basicAck,
> > Matthias replied as follows:
>
> > "Confirms mean one thing and one thing only: that the broker has
> > accepted
> > responsibility for the message.
>
> > "They concern the interaction between producers and the broker, and
> > have
> > nothing to do with consumer acks."
>
> > If in the fanout context I could have used consumer acks to hold off
> > broker acks to the publisher, I would have expected that I could
> > effectively block confirms until after I sent basicAcks from the
> > consumer to the broker and then on up to the publisher. From
> > Matthias's note (and my tests), however, it appears that the broker
> > sends an ack back to the publisher as soon as it takes control of the
> > message and so issues a confirm without waiting on anything from the
> > consumer. In the direct exchange context, however, I took your notes
> > to be indicating that the broker there will wait for an ack from the
> > consumer, such that if the consumer died while in process, but before
> > sending the ack, the broker would return a basic.return along with the
> > confirm. If this is not the case, then, my sense is that I will have
> > to have the consumers publish a response directly back to original
> > publisher as Matthias notes--while using the fanout broadcast to keep
> > track of the number of expected responses (as you indicate).
>
> > Does that make sense? Basically, it still orbits around a question of
> > how and/or if consumer acks can be made to effect a producer. I am
> > guessing that my implementation will have to require the return
> > publications (responses), but any clarification you could add to the
> > consumer ack, confirm chain would be greatly appreciated.
>
> > Thanks,
> > Jonathan
>
> > On Sep 26, 11:34?am, Alexandru Scvor?ov <alexan... at rabbitmq.com>
> > wrote:
> > > Hi Jonathan,
>
> > > > "In addition, when processing "please log out this user" messages, a
> > > > machine should *not* acknowledge that it has received the message
> > > > until after it publishes its response (this way, if the machine dies
> > > > while processing, the sender will get a basic.return for it)."
>
> > > > Am I correct in understanding from this that, in the direct exchange
> > > > context, I can control when the consumer machine sends back its ack,
> > > > by calling something like basicAck at some point in the consumption/
> > > > delivery code?
>
> > > The exchange type has nothing to do with it. ?When you consume from a
> > > queue, you specify the autoAck parameter. ?If this is set to true
> > > (which it is, by default), then the server will not wait for the
> > > consumer to acknowledge receipt of the message (so, it's effectively
> > > auto-ack'ing all messages). ?If it's set to false, the broker will not
> > > consider the message delivered to the consumer until it explicitly ack's
> > > the message. ?See the API guide for an example (I assume you're using
> > > the Java client, but the other clients have very similar APIs):
> > > ?http://www.rabbitmq.com/api-guide.html#consuming
>
> > > > If so, I would expect that I could skip the return
> > > > publishing (i.e., the response) from the consumer to the producer and
> > > > simply check confirms and confirms + basic.returns for each message
> > > > sent directly to each machine. Moreover, if, prior to publishing, I
> > > > associate the machine (or direct queue corresponding to it) to the
> > > > message to be sent, I should be able to find out which machines
> > > > present which form of response (i.e., confirm or confirm +
> > > > basic.return). Does this make sense or am I still reading too much
> > > > into the consumer ack (such that, for example, the confirmation
> > > > received by the publisher just represents the handoff of the message
> > > > to the queue and not its uptake by the consumer)?
>
> > > Oh. ?I missed that. ?Yes, I think that would work.
>
> > > Cheers,
> > > Alex
>
> > > On Mon, Sep 26, 2011 at 08:04:28AM -0700, gneeri wrote:
> > > > Hi Alex,
>
> > > > Thanks so much for the detailed reply. I had begun thinking along
> > > > these lines, but really appreciate the level of detail regarding the
> > > > specific types of publish requests, queues and exchanges. This is
> > > > really helpful and will likely save me many hours of trial and error.
> > > > I do have just one quick question though regarding the following:
>
> > > > "In addition, when processing "please log out this user" messages, a
> > > > machine should *not* acknowledge that it has received the message
> > > > until after it publishes its response (this way, if the machine dies
> > > > while processing, the sender will get a basic.return for it)."
>
> > > > Am I correct in understanding from this that, in the direct exchange
> > > > context, I can control when the consumer machine sends back its ack,
> > > > by calling something like basicAck at some point in the consumption/
> > > > delivery code? If so, I would expect that I could skip the return
> > > > publishing (i.e., the response) from the consumer to the producer and
> > > > simply check confirms and confirms + basic.returns for each message
> > > > sent directly to each machine. Moreover, if, prior to publishing, I
> > > > associate the machine (or direct queue corresponding to it) to the
> > > > message to be sent, I should be able to find out which machines
> > > > present which form of response (i.e., confirm or confirm +
> > > > basic.return). Does this make sense or am I still reading too much
> > > > into the consumer ack (such that, for example, the confirmation
> > > > received by the publisher just represents the handoff of the message
> > > > to the queue and not its uptake by the consumer)?
>
> > > > Thanks again, really, I very much appreciate your help.
>
> > > > Cheers,
> > > > Jonathan
>
> > > > On Sep 26, 5:54?am, Alexandru Scvor?ov <alexan... at rabbitmq.com> wrote:
> > > > > Hi Jonathan,
>
> > > > > > 1. Do consumer acks have more significance in transactions, such that
> > > > > > I could use those to effect the functionality I'm looking for?
>
> > > > > Not really, no. ?I don't think there's anyway to get what you want
> > > > > automatically.
>
> > > > > > 2. If not, is there any way (apart from the admin HTTP API) for
> > > > > > determining the number of consumers (e.g., bound queues) for a given
> > > > > > exchange? This way I could test the number of reply messages as you
> > > > > > suggest; otherwise, with needing to register and account for a dynamic
> > > > > > array of servers, I would lose a good deal of what I had hoped would
> > > > > > be the benefit of a fanout broadcast.
>
> > > > > There's no AMQP way of finding how many queues are bound to an exchange.
> > > > > As you say, there's the management API, but using that is likely to lead
> > > > > to races (what happens if you query the number of queues, then one of
> > > > > the machines dies before it sends its acknowledgement?).
>
> > > > > You could kind of get what you want with AMQP. ?Use a fanout exchange
> > > > > like you want for broadcast messages, but use a direct exchange for
> > > > > direct communication between machines. ?You could use the fanout
> > > > > exchange to make sure that all the machines know about each other (in
> > > > > particular, that each knows the queues the others bound to the direct
> > > > > exchange, so that they can communicate directly). ?And you could
>
> ...
>
> read more ?

From rauan at maemirov.com  Mon Sep 26 17:56:45 2011
From: rauan at maemirov.com (Rauan Maemirov)
Date: Mon, 26 Sep 2011 22:56:45 +0600
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-0.2.0 (beta) Released.
In-Reply-To: <AANLkTim3XB6tXKX2AHJeyhOLYm7AFFXe0TVcaRYpiQ6x@mail.gmail.com>
References: <744D59E6-14C0-4844-B41D-20670607DC9E@brodrigu.net>
	<BC3066E2-CDB7-4AFC-B1BD-2747BD555EA1@brodrigu.net>
	<AANLkTim3XB6tXKX2AHJeyhOLYm7AFFXe0TVcaRYpiQ6x@mail.gmail.com>
Message-ID: <CAFw_bqNtiakxE6mzT+4CgQ4RAKS2Z_GUudEJvMbu9jp=DfXizg@mail.gmail.com>

Is there any progress on modified consume, based on callback function?

2010/12/19 Mark Steele <msteele at beringmedia.com>

> Hi,
>
> Out of curiosity, is it possible to use SSL connections? (via php stream
> contexts perhaps?)
>
> Cheers,
>
>
> Mark Steele
> Bering Media Inc.
> +1 (416) 888-1009
>
>
>
> On Sat, Dec 18, 2010 at 11:57 AM, Brad Rodriguez <brad at brodrigu.net>wrote:
>
>> The updated documentation that corresponds to this release is finally live
>> on php.net
>>
>> http://docs.php.net/manual/en/book.amqp.php
>>
>> <http://docs.php.net/manual/en/book.amqp.php>-Brad
>>
>> On Dec 10, 2010, at 12:30 PM, Brad Rodriguez wrote:
>>
>>
>> The new PECL package amqp-0.2.0 (beta) has been released at
>> http://pecl.php.net/.
>>
>> Release notes
>> -------------
>> Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
>> Modified AMQPConnection object:
>>    * Requires call to 'connect' method to connect (no longer connects on
>> instantiation)
>>    * Added support for disconnect and reconnect
>>    * Added helper setters for port, host, vhost, login and password
>> Improved consume method to block for MIN messages, and try to get MAX
>> messages if available
>> Fixed zval descoping bugs
>> Fixed bugs:
>>    * 17809: Couldn't compile pecl extension under PHP 5.3
>>    * 17831: Segmentation fault when the exchange doesn't exists
>>    * 19707: AMQPQueue::get() doesn't return the message
>>    * 19840: Connection Exception
>>
>> Package Info
>> -------------
>> This extension can communicate with any AMQP spec 0-9-1 compatible server,
>> such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to create and
>> delete exchanges and queues, as well as publish to any exchange and
>> consume
>> from any queue.
>>
>> Related Links
>> -------------
>> Package home: http://pecl.php.net/package/amqp
>>   Changelog: http://pecl.php.net/package-changelog.php?package=amqp
>>    Download: http://pecl.php.net/get/amqp-0.2.0.tgz
>>
>> Authors
>> -------------
>> Pieter de Zwart (lead)
>>
>>
>> --
>> PECL development discussion Mailing List (http://pecl.php.net/)
>> To unsubscribe, visit: http://www.php.net/unsub.php
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110926/771ac267/attachment.htm>

From majek04 at gmail.com  Mon Sep 26 18:00:06 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Mon, 26 Sep 2011 18:00:06 +0100
Subject: [rabbitmq-discuss] Pika - how to properly publish from a
 periodic background thread?
In-Reply-To: <a05c76b9-4a8c-413f-afee-ee37b0dfa261@x32g2000prf.googlegroups.com>
References: <a05c76b9-4a8c-413f-afee-ee37b0dfa261@x32g2000prf.googlegroups.com>
Message-ID: <CABzX+qx4ubaAUPvA_NZdAiUykidxRy_LpLFjGMB4ShJUET1h1A@mail.gmail.com>

On Thu, Sep 22, 2011 at 21:26, Aaron Voelker <aaron at contextlogic.com> wrote:
> I'm using Python 2.6.6, Ubuntu 10.10, and Pika 0.9.5.
>
> I have a situation where I want to publish to a queue from a
> background thread at a periodic interval. The main thread is consuming
> on some different callback.
>
> I assumed (incorrectly) that wrapping my callback and publish in a
> mutex would solve this problem. I ran into some weird behaviour before
> I realized that maybe this isn't the correct approach.
>
> What happens is that the worker I publish to from the background
> thread will send work back to the callback for the main thread.
> Normally, this is fine, but in weird situations (race condition?),
> after a few hours of running my application, it will get Pika into an
> unrecoverable state. Some sample code which duplicates this problem,
> along with the resulting error messages, is included in this message
> in case someone happens to Google for this error message (which got me
> next to nowhere).
>
> What is the correct way to do this? Note that both the callback and
> the scheduler have to have shared access to the same variables (hence
> the mutex), and performance does NOT matter (the scheduler runs once
> per minute, and doesn't do too much.

What about just opening two separate connections, one in each thread?

I'm not sure how "reactors" work in Pika, but I guess there should be a
way to have two separate event loops.

Cheers,
  Marek

From pdezwart at rubiconproject.com  Mon Sep 26 18:47:02 2011
From: pdezwart at rubiconproject.com (Pieter de Zwart)
Date: Mon, 26 Sep 2011 12:47:02 -0500
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-0.2.0 (beta) Released.
In-Reply-To: <CAFw_bqNtiakxE6mzT+4CgQ4RAKS2Z_GUudEJvMbu9jp=DfXizg@mail.gmail.com>
Message-ID: <CAA60805.223B9%pdezwart@rubiconproject.com>

Hey Mark,

Unfortunately, there is still no SSL support. The php-amqp library is a binding for the lower level rabbitmq-c client library, so we are heavily dependent on its features. To my knowledge, the library still does not support SSL, and therefore neither do we. If that has changed, we would love to add the support.

Fyi, we are now at v0.3.1. There have been a bunch of bug fixes, and there are more on the way!

me

From: Rauan Maemirov <rauan at maemirov.com<mailto:rauan at maemirov.com>>
Date: Mon, 26 Sep 2011 11:56:45 -0500
To: Mark Steele <msteele at beringmedia.com<mailto:msteele at beringmedia.com>>
Cc: Brad Rodriguez <brad at brodrigu.net<mailto:brad at brodrigu.net>>, rabbitmq-discuss <rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>>
Subject: Re: [rabbitmq-discuss] [ANNOUNCEMENT] amqp-0.2.0 (beta) Released.

Is there any progress on modified consume, based on callback function?

2010/12/19 Mark Steele <msteele at beringmedia.com<mailto:msteele at beringmedia.com>>
Hi,

Out of curiosity, is it possible to use SSL connections? (via php stream contexts perhaps?)

Cheers,


Mark Steele
Bering Media Inc.
+1 (416) 888-1009<tel:%2B1%20%28416%29%20888-1009>



On Sat, Dec 18, 2010 at 11:57 AM, Brad Rodriguez <brad at brodrigu.net<mailto:brad at brodrigu.net>> wrote:
The updated documentation that corresponds to this release is finally live on php.net<http://php.net>

http://docs.php.net/manual/en/book.amqp.php

<http://docs.php.net/manual/en/book.amqp.php>-Brad

On Dec 10, 2010, at 12:30 PM, Brad Rodriguez wrote:


The new PECL package amqp-0.2.0 (beta) has been released at
http://pecl.php.net/.

Release notes
-------------
Works with AMQP 0-8 and 0-9-1 (used by RabbitMQ 2.*)
Modified AMQPConnection object:
   * Requires call to 'connect' method to connect (no longer connects on
instantiation)
   * Added support for disconnect and reconnect
   * Added helper setters for port, host, vhost, login and password
Improved consume method to block for MIN messages, and try to get MAX
messages if available
Fixed zval descoping bugs
Fixed bugs:
   * 17809: Couldn't compile pecl extension under PHP 5.3
   * 17831: Segmentation fault when the exchange doesn't exists
   * 19707: AMQPQueue::get() doesn't return the message
   * 19840: Connection Exception

Package Info
-------------
This extension can communicate with any AMQP spec 0-9-1 compatible server,
such as RabbitMQ, OpenAMQP and Qpid, giving you the ability to create and
delete exchanges and queues, as well as publish to any exchange and consume
from any queue.

Related Links
-------------
Package home: http://pecl.php.net/package/amqp
  Changelog: http://pecl.php.net/package-changelog.php?package=amqp
   Download: http://pecl.php.net/get/amqp-0.2.0.tgz

Authors
-------------
Pieter de Zwart (lead)


--
PECL development discussion Mailing List (http://pecl.php.net/)
To unsubscribe, visit: http://www.php.net/unsub.php


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110926/aeee7d19/attachment.htm>

From justin.adam.miller at gmail.com  Mon Sep 26 21:05:32 2011
From: justin.adam.miller at gmail.com (justin.adam.miller at gmail.com)
Date: Mon, 26 Sep 2011 13:05:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Clustering and data partitioning - how best to
	implement
Message-ID: <bda81ef9-38fc-4226-931f-9ed248691dbb@q25g2000vbx.googlegroups.com>

I'm trying to implement some of the ideas from this article:

http://blog.springsource.com/2011/04/01/routing-topologies-for-performance-and-scalability-with-rabbitmq/

Our situation is that we have two rabbit instances, not clustered, so
that we can spread out load. In our current setup, it's still possible
for us to hit one broker harder than the other, so ideally we'd like
to setup these nodes in a cluster. That way, we can have consumers
evenly distributed across brokers.

We could create one queue that all consumers consume from, but I'm not
sure that would solve our problems since that queue (and the broker it
was created on) would become a hotspot. Right?

So from that article, I like the idea of each node creating a queue,
e.g. myQueue.1, myQueue.2, etc. and having the producer round robin
them. What I don't know, is how the producer knows how many queues/
nodes there are. The producers could send to an exchange and just set
the routingKey, but still, I think the problem is the same.

I guess I could use the management plugin, but I'm trying to figure
out how to do that without issuing a request for every message I
produce.

I could imagine some kind of handshake when a producer comes online,
he sends a "who's-alive" message to a topic exchange and waits for
responses from consumers. Also, when a consumer comes online, he
immediately sends out a "I'm-alive" message. In a direct exchange
(either the default or one that I create), is a routingKey assumed to
be a queue name? If I made the queues auto_delete, what would happen
when the producer tries to send a message to a queue that no longer
exists? Would I get an exception such that I can catch it and send the
message to the next guy in the list?

Thanks,
Justin

From alexis at rabbitmq.com  Mon Sep 26 21:10:46 2011
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 26 Sep 2011 21:10:46 +0100
Subject: [rabbitmq-discuss] Clustering and data partitioning - how best
	to implement
In-Reply-To: <bda81ef9-38fc-4226-931f-9ed248691dbb@q25g2000vbx.googlegroups.com>
References: <bda81ef9-38fc-4226-931f-9ed248691dbb@q25g2000vbx.googlegroups.com>
Message-ID: <CACOPnvcRWoSCyHyG9Uh7usv8_vuXHj=61XqU_A3Zw=uLhJPcaQ@mail.gmail.com>

Does this help?

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/015263.html




On Mon, Sep 26, 2011 at 9:05 PM, justin.adam.miller at gmail.com
<justin.adam.miller at gmail.com> wrote:
> I'm trying to implement some of the ideas from this article:
>
> http://blog.springsource.com/2011/04/01/routing-topologies-for-performance-and-scalability-with-rabbitmq/
>
> Our situation is that we have two rabbit instances, not clustered, so
> that we can spread out load. In our current setup, it's still possible
> for us to hit one broker harder than the other, so ideally we'd like
> to setup these nodes in a cluster. That way, we can have consumers
> evenly distributed across brokers.
>
> We could create one queue that all consumers consume from, but I'm not
> sure that would solve our problems since that queue (and the broker it
> was created on) would become a hotspot. Right?
>
> So from that article, I like the idea of each node creating a queue,
> e.g. myQueue.1, myQueue.2, etc. and having the producer round robin
> them. What I don't know, is how the producer knows how many queues/
> nodes there are. The producers could send to an exchange and just set
> the routingKey, but still, I think the problem is the same.
>
> I guess I could use the management plugin, but I'm trying to figure
> out how to do that without issuing a request for every message I
> produce.
>
> I could imagine some kind of handshake when a producer comes online,
> he sends a "who's-alive" message to a topic exchange and waits for
> responses from consumers. Also, when a consumer comes online, he
> immediately sends out a "I'm-alive" message. In a direct exchange
> (either the default or one that I create), is a routingKey assumed to
> be a queue name? If I made the queues auto_delete, what would happen
> when the producer tries to send a message to a queue that no longer
> exists? Would I get an exception such that I can catch it and send the
> message to the next guy in the list?
>
> Thanks,
> Justin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From swduffy at unmc.edu  Mon Sep 26 21:24:51 2011
From: swduffy at unmc.edu (Sean W Duffy)
Date: Mon, 26 Sep 2011 15:24:51 -0500
Subject: [rabbitmq-discuss] new user problem
Message-ID: <OF34BFB8DF.38B2C974-ON86257917.00702367-86257917.0070236F@unmc.edu>

An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110926/dc4ae691/attachment.htm>

From francois at teksol.info  Tue Sep 27 00:19:40 2011
From: francois at teksol.info (=?utf-8?Q?Fran=C3=A7ois_Beausoleil?=)
Date: Mon, 26 Sep 2011 19:19:40 -0400
Subject: [rabbitmq-discuss] What to do when high watermark reached?
Message-ID: <D9FA4A5BA98C4AC8978AC5B1EF7F6D29@ftml.net>

Hi!

According to the management console's overview tab, I've reached my memory high watermark. I have two queues with a combined total of 2.5M messages. My workers are up and running, but in both cases, the queue consumers read messages and may publish messages to another exchange.

I can restart my workers, in which case the messages are unack'd and put back in the queue, to be processed again.

Is there a way around this? What can I do to process those messages? Can I tweak something in the server while it's up? I don't want to reboot it because I've lost messages before, even though my messages are published using :persistent => true (Bunny).

Rereading http://www.rabbitmq.com/admin-guide.html#memsup, I notice that it says I should use multiple connections: one for producing, one for consuming. I'll have to change my apps to do that, but in the meantime?

Thanks for any pointers!
Fran?ois



From marv_lush at yahoo.com  Tue Sep 27 00:47:32 2011
From: marv_lush at yahoo.com (cOre dUmPeR)
Date: Mon, 26 Sep 2011 16:47:32 -0700 (PDT)
Subject: [rabbitmq-discuss] Consumer Performance Issues?
Message-ID: <1317080852.10785.YahooMailClassic@web65707.mail.ac4.yahoo.com>

Hello all. I've been attempting to benchmark RabbitMQ to see what kind of max messages rates I might expect in a production deployment.
One thing I've been seeing that has me a little puzzled is that (for my test setup) message rates on the input side are an order of magnitude higher that on the output side. Meaning I can push 25K msgs/sec from my producer. However, my consumer, only seems to get about 2.5K msgs/sec...although both consumer and producer are setup similarly.
Do I have something misconfigured? Or is this expected? I would expect *some* difference between producer(s)/consumer(s)...but not an order of magnitude.
Some basics about my test setup:
HW------(3) EC2 m1.xlarge boxes - 4 cores, 15GB mem? ? ?1 producer, 1 consumer, 1 broker
Broker----------Basic RabbitMQ broker install. Didnt really play with any options, except installing the Management plugins and using a different port than default.
Producer-------------Java Client. 4 Producer threads, each with its own connection and channel. Direct exchange, NO persist, NO autodelete. Connect and Send methods look like:
	public void openConnection() throws IOException {		ConnectionFactory cfconn = new ConnectionFactory();		cfconn.setHost(host);		cfconn.setPort(port);		LOGGER.debug("opening connection to: " + host + ":" + port);		connection = cfconn.newConnection();		channel = connection.createChannel();
		LOGGER.debug("queue info: routing_key: " + routingKey + ", exchange: " + exchange);		channel.queueDeclare(ROUTING_KEY, false, false, false, null);	}
	public void send(byte[] message) throws IOException {		channel.basicPublish(exchange, routingKey, null, message);	}
Consumer---------------Java client, 4 consumer threads, each with its own connection and channel. AutoAck YES. Connect and Receive methods look like:

	public void openConnection() throws IOException {		ConnectionFactory cfconn = new ConnectionFactory();		cfconn.setHost(host);		cfconn.setPort(port);		LOGGER.debug("opening connection to: " + host + ":" + port);		connection = cfconn.newConnection();		channel = connection.createChannel();
		LOGGER.debug("queue info: queue_name: " + queueName);		channel.queueDeclare(QUEUE_NAME, false, false, false, null);
		consumer = new QueueingConsumer(channel);		channel.basicConsume(QUEUE_NAME, true, consumer);	}
	public String receive() throws IOException, ShutdownSignalException, ConsumerCancelledException,			InterruptedException {		Delivery delivery = consumer.nextDelivery(10);		String retval = null;
		if (delivery != null) {			retval = new String(delivery.getBody());		}
		return retval;	}
Messages-----------------JSON bytes, about 150bytes each message.
Other Details--------------------The only thing the consumer is doing after a message is received, is converting bytes-->JSONString-->Object...then moving on. My consumer CPU load is almost nothing, SO I dont think its the Consumer holding things up. ?On the broker side....there is only 1 CPU out of 4 that is doing any real work. Is this normal? With 4 consumer threads...I would expect more to be happening on the Broker. I know when the Producer is pushing with 4 threads...the broker is generally very busy. But when I stop the producer, and leave the consumer running (again, with 4 threads)...again, I see only 1 CPU on the broker working.
Any ideas? Or things I should change?
Thanks,/Marv
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110926/0ac0944c/attachment.htm>

From hedelson at vmware.com  Tue Sep 27 01:06:14 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Mon, 26 Sep 2011 17:06:14 -0700
Subject: [rabbitmq-discuss] Clustering and data partitioning - how best
 to implement
In-Reply-To: <CACOPnvcRWoSCyHyG9Uh7usv8_vuXHj=61XqU_A3Zw=uLhJPcaQ@mail.gmail.com>
References: <bda81ef9-38fc-4226-931f-9ed248691dbb@q25g2000vbx.googlegroups.com>,
	<CACOPnvcRWoSCyHyG9Uh7usv8_vuXHj=61XqU_A3Zw=uLhJPcaQ@mail.gmail.com>
Message-ID: <BDE140BF4C952041931EF8CAAC83341D026B6B8E31@exch-mbx-111.vmware.com>

Hi Justin,

Luckily, things are much simpler than what your questions lead to :-)

I think you're looking for is the round robin/competing consumers. I had a typo on that blog post which is now fixed that may have caused confusion.
Queue -> multiple consumers  http://www.rabbitmq.com/tutorials/tutorial-two-python.html
Your producer simply publishes to exchanges. The RabbitMQ server knows where to route the messages (via bindings between queues and exchanges), the Producer is decoupled completely from any endpoint awareness. This decoupling is key.
 
Do look at http://www.rabbitmq.com/ha.html also talks about queues in a cluster. It will answer a lot of your questions. 

You definitely want more than one queue...particularly if you are in any kind of scalable heavy load situation. Generally you have many queues, often partitioned logically. Do take note the performance issues to watch for in the post.

I hope that helps a bit, 
Helena  
________________________________________
From: alexis.richardson at gmail.com [alexis.richardson at gmail.com] On Behalf Of Alexis Richardson [alexis at rabbitmq.com]
Sent: Monday, September 26, 2011 2:10 PM
To: justin.adam.miller at gmail.com
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Clustering and data partitioning - how best to implement

Does this help?

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/015263.html




On Mon, Sep 26, 2011 at 9:05 PM, justin.adam.miller at gmail.com
<justin.adam.miller at gmail.com> wrote:
> I'm trying to implement some of the ideas from this article:
>
> http://blog.springsource.com/2011/04/01/routing-topologies-for-performance-and-scalability-with-rabbitmq/
>
> Our situation is that we have two rabbit instances, not clustered, so
> that we can spread out load. In our current setup, it's still possible
> for us to hit one broker harder than the other, so ideally we'd like
> to setup these nodes in a cluster. That way, we can have consumers
> evenly distributed across brokers.
>
> We could create one queue that all consumers consume from, but I'm not
> sure that would solve our problems since that queue (and the broker it
> was created on) would become a hotspot. Right?
>
> So from that article, I like the idea of each node creating a queue,
> e.g. myQueue.1, myQueue.2, etc. and having the producer round robin
> them. What I don't know, is how the producer knows how many queues/
> nodes there are. The producers could send to an exchange and just set
> the routingKey, but still, I think the problem is the same.
>
> I guess I could use the management plugin, but I'm trying to figure
> out how to do that without issuing a request for every message I
> produce.
>
> I could imagine some kind of handshake when a producer comes online,
> he sends a "who's-alive" message to a topic exchange and waits for
> responses from consumers. Also, when a consumer comes online, he
> immediately sends out a "I'm-alive" message. In a direct exchange
> (either the default or one that I create), is a routingKey assumed to
> be a queue name? If I made the queues auto_delete, what would happen
> when the producer tries to send a message to a queue that no longer
> exists? Would I get an exception such that I can catch it and send the
> message to the next guy in the list?
>
> Thanks,
> Justin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From bkw at codingforce.com  Tue Sep 27 01:29:12 2011
From: bkw at codingforce.com (Bernhard Weisshuhn)
Date: Tue, 27 Sep 2011 02:29:12 +0200
Subject: [rabbitmq-discuss] Anything special on dev.rabbitmq.com wrt.
	x-expire?
Message-ID: <20110927002911.GA63487@codingforce.com>

Hi *,

while adding support for queue arguments to a node.js amqp library, we
noticed a puzzling behaviour on dev.rabbitmq.com: Redeclaring an existing
queue with differing x-expire values is accepted, even over the same
connection. Discusson here: https://github.com/postwait/node-amqp/pull/25

Both my 2.6.1 build from the rabbitmq macports repository as well as a
current hg build done by another developer throw a PRECONDITION_FAILED
error in that case. Curiously, using different values for x-ha-policy
(instead of x-expires) works as expected: it raises the error on
dev.rabbitmq.com as well.

There seems to be something different on that host wrt. x-expire.
We'd rather use x-expire for the test since x-ha-policy only exists from
2.6.x. onward.

Can anybody shed any light on this?

thanks in advance,
  bkw

From justin.adam.miller at gmail.com  Tue Sep 27 01:46:56 2011
From: justin.adam.miller at gmail.com (Justin Miller)
Date: Mon, 26 Sep 2011 20:46:56 -0400
Subject: [rabbitmq-discuss] Clustering and data partitioning - how best
	to implement
In-Reply-To: <BDE140BF4C952041931EF8CAAC83341D026B6B8E31@exch-mbx-111.vmware.com>
References: <bda81ef9-38fc-4226-931f-9ed248691dbb@q25g2000vbx.googlegroups.com>
	<CACOPnvcRWoSCyHyG9Uh7usv8_vuXHj=61XqU_A3Zw=uLhJPcaQ@mail.gmail.com>
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E31@exch-mbx-111.vmware.com>
Message-ID: <6859984426335469297@unknownmsgid>

Helena, all,

Thanks for the responses. Actually the hashing exchange is exactly
what I'm looking for.

I already rely on the round robin behavior of queues, but our problem
is that we can't logically partition our data any further and we have
one queue that gets more requests than the others.

Right now, we manually break up the queue into those subqueues, but
that's not the most maintainable solution nor does it address the
problem in a cluster.

Given our limitations, the hashing exchange seems like the best solution, no?

Thanks
Justin

On Sep 26, 2011, at 8:06 PM, Helena Edelson <hedelson at vmware.com> wrote:

> Hi Justin,
>
> Luckily, things are much simpler than what your questions lead to :-)
>
> I think you're looking for is the round robin/competing consumers. I had a typo on that blog post which is now fixed that may have caused confusion.
> Queue -> multiple consumers  http://www.rabbitmq.com/tutorials/tutorial-two-python.html
> Your producer simply publishes to exchanges. The RabbitMQ server knows where to route the messages (via bindings between queues and exchanges), the Producer is decoupled completely from any endpoint awareness. This decoupling is key.
>
> Do look at http://www.rabbitmq.com/ha.html also talks about queues in a cluster. It will answer a lot of your questions.
>
> You definitely want more than one queue...particularly if you are in any kind of scalable heavy load situation. Generally you have many queues, often partitioned logically. Do take note the performance issues to watch for in the post.
>
> I hope that helps a bit,
> Helena
> ________________________________________
> From: alexis.richardson at gmail.com [alexis.richardson at gmail.com] On Behalf Of Alexis Richardson [alexis at rabbitmq.com]
> Sent: Monday, September 26, 2011 2:10 PM
> To: justin.adam.miller at gmail.com
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Clustering and data partitioning - how best to implement
>
> Does this help?
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/015263.html
>
>
>
>
> On Mon, Sep 26, 2011 at 9:05 PM, justin.adam.miller at gmail.com
> <justin.adam.miller at gmail.com> wrote:
>> I'm trying to implement some of the ideas from this article:
>>
>> http://blog.springsource.com/2011/04/01/routing-topologies-for-performance-and-scalability-with-rabbitmq/
>>
>> Our situation is that we have two rabbit instances, not clustered, so
>> that we can spread out load. In our current setup, it's still possible
>> for us to hit one broker harder than the other, so ideally we'd like
>> to setup these nodes in a cluster. That way, we can have consumers
>> evenly distributed across brokers.
>>
>> We could create one queue that all consumers consume from, but I'm not
>> sure that would solve our problems since that queue (and the broker it
>> was created on) would become a hotspot. Right?
>>
>> So from that article, I like the idea of each node creating a queue,
>> e.g. myQueue.1, myQueue.2, etc. and having the producer round robin
>> them. What I don't know, is how the producer knows how many queues/
>> nodes there are. The producers could send to an exchange and just set
>> the routingKey, but still, I think the problem is the same.
>>
>> I guess I could use the management plugin, but I'm trying to figure
>> out how to do that without issuing a request for every message I
>> produce.
>>
>> I could imagine some kind of handshake when a producer comes online,
>> he sends a "who's-alive" message to a topic exchange and waits for
>> responses from consumers. Also, when a consumer comes online, he
>> immediately sends out a "I'm-alive" message. In a direct exchange
>> (either the default or one that I create), is a routingKey assumed to
>> be a queue name? If I made the queues auto_delete, what would happen
>> when the producer tries to send a message to a queue that no longer
>> exists? Would I get an exception such that I can catch it and send the
>> message to the next guy in the list?
>>
>> Thanks,
>> Justin
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>

From hedelson at vmware.com  Tue Sep 27 02:43:32 2011
From: hedelson at vmware.com (Helena Edelson)
Date: Mon, 26 Sep 2011 18:43:32 -0700
Subject: [rabbitmq-discuss] Clustering and data partitioning - how best
 to implement
In-Reply-To: <6859984426335469297@unknownmsgid>
References: <bda81ef9-38fc-4226-931f-9ed248691dbb@q25g2000vbx.googlegroups.com>
	<CACOPnvcRWoSCyHyG9Uh7usv8_vuXHj=61XqU_A3Zw=uLhJPcaQ@mail.gmail.com>
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E31@exch-mbx-111.vmware.com>,
	<6859984426335469297@unknownmsgid>
Message-ID: <BDE140BF4C952041931EF8CAAC83341D026B6B8E32@exch-mbx-111.vmware.com>

Jason, you mean a topic exchange? If so, yes topic exchanges are great to distribute your traffic from the one queue with high load to n-queues, each queue bound with a pattern matching a 'sub topic' if you will. That and set up wiretaps, etc.
 
Helena
________________________________________
From: Justin Miller [justin.adam.miller at gmail.com]
Sent: Monday, September 26, 2011 6:46 PM
To: Helena Edelson
Cc: rabbitmq-discuss at lists.rabbitmq.com; Alexis Richardson
Subject: Re: [rabbitmq-discuss] Clustering and data partitioning - how best to implement

Helena, all,

Thanks for the responses. Actually the hashing exchange is exactly
what I'm looking for.

I already rely on the round robin behavior of queues, but our problem
is that we can't logically partition our data any further and we have
one queue that gets more requests than the others.

Right now, we manually break up the queue into those subqueues, but
that's not the most maintainable solution nor does it address the
problem in a cluster.

Given our limitations, the hashing exchange seems like the best solution, no?

Thanks
Justin

On Sep 26, 2011, at 8:06 PM, Helena Edelson <hedelson at vmware.com> wrote:

> Hi Justin,
>
> Luckily, things are much simpler than what your questions lead to :-)
>
> I think you're looking for is the round robin/competing consumers. I had a typo on that blog post which is now fixed that may have caused confusion.
> Queue -> multiple consumers  http://www.rabbitmq.com/tutorials/tutorial-two-python.html
> Your producer simply publishes to exchanges. The RabbitMQ server knows where to route the messages (via bindings between queues and exchanges), the Producer is decoupled completely from any endpoint awareness. This decoupling is key.
>
> Do look at http://www.rabbitmq.com/ha.html also talks about queues in a cluster. It will answer a lot of your questions.
>
> You definitely want more than one queue...particularly if you are in any kind of scalable heavy load situation. Generally you have many queues, often partitioned logically. Do take note the performance issues to watch for in the post.
>
> I hope that helps a bit,
> Helena
> ________________________________________
> From: alexis.richardson at gmail.com [alexis.richardson at gmail.com] On Behalf Of Alexis Richardson [alexis at rabbitmq.com]
> Sent: Monday, September 26, 2011 2:10 PM
> To: justin.adam.miller at gmail.com
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Clustering and data partitioning - how best to implement
>
> Does this help?
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/015263.html
>
>
>
>
> On Mon, Sep 26, 2011 at 9:05 PM, justin.adam.miller at gmail.com
> <justin.adam.miller at gmail.com> wrote:
>> I'm trying to implement some of the ideas from this article:
>>
>> http://blog.springsource.com/2011/04/01/routing-topologies-for-performance-and-scalability-with-rabbitmq/
>>
>> Our situation is that we have two rabbit instances, not clustered, so
>> that we can spread out load. In our current setup, it's still possible
>> for us to hit one broker harder than the other, so ideally we'd like
>> to setup these nodes in a cluster. That way, we can have consumers
>> evenly distributed across brokers.
>>
>> We could create one queue that all consumers consume from, but I'm not
>> sure that would solve our problems since that queue (and the broker it
>> was created on) would become a hotspot. Right?
>>
>> So from that article, I like the idea of each node creating a queue,
>> e.g. myQueue.1, myQueue.2, etc. and having the producer round robin
>> them. What I don't know, is how the producer knows how many queues/
>> nodes there are. The producers could send to an exchange and just set
>> the routingKey, but still, I think the problem is the same.
>>
>> I guess I could use the management plugin, but I'm trying to figure
>> out how to do that without issuing a request for every message I
>> produce.
>>
>> I could imagine some kind of handshake when a producer comes online,
>> he sends a "who's-alive" message to a topic exchange and waits for
>> responses from consumers. Also, when a consumer comes online, he
>> immediately sends out a "I'm-alive" message. In a direct exchange
>> (either the default or one that I create), is a routingKey assumed to
>> be a queue name? If I made the queues auto_delete, what would happen
>> when the producer tries to send a message to a queue that no longer
>> exists? Would I get an exception such that I can catch it and send the
>> message to the next guy in the list?
>>
>> Thanks,
>> Justin
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>

From aaron at contextlogic.com  Tue Sep 27 03:14:34 2011
From: aaron at contextlogic.com (Aaron Voelker)
Date: Mon, 26 Sep 2011 19:14:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika - how to properly publish from a
	periodic background thread?
In-Reply-To: <CABzX+qx4ubaAUPvA_NZdAiUykidxRy_LpLFjGMB4ShJUET1h1A@mail.gmail.com>
References: <a05c76b9-4a8c-413f-afee-ee37b0dfa261@x32g2000prf.googlegroups.com>
	<CABzX+qx4ubaAUPvA_NZdAiUykidxRy_LpLFjGMB4ShJUET1h1A@mail.gmail.com>
Message-ID: <eea35368-3176-4d64-a795-fcb8543b2fb9@m5g2000vbe.googlegroups.com>

Thanks for the reply Marek.

I think you're right that having two separate connections in separate
threads would work.

But I think I found a more elegant solution that avoids threading
altogether, by using an IOLoop. Basically, I used the Tornado adapter
for Pika: http://pika.github.com/connecting.html#adapters-tornado-connection-tornadoconnection

Then I was able to leverage Tornado's PeriodicCallback and add that to
the same IOLoop to do background publishing.
https://github.com/facebook/tornado/blob/master/tornado/ioloop.py

Everything is now singly threaded, and it worked like a charm. Hoping
someone will find this info helpful.

Aaron

On Sep 26, 10:00?am, Marek Majkowski <maje... at gmail.com> wrote:
> On Thu, Sep 22, 2011 at 21:26, Aaron Voelker <aa... at contextlogic.com> wrote:
> > I'm using Python 2.6.6, Ubuntu 10.10, and Pika 0.9.5.
>
> > I have a situation where I want to publish to a queue from a
> > background thread at a periodic interval. The main thread is consuming
> > on some different callback.
>
> > I assumed (incorrectly) that wrapping my callback and publish in a
> > mutex would solve this problem. I ran into some weird behaviour before
> > I realized that maybe this isn't the correct approach.
>
> > What happens is that the worker I publish to from the background
> > thread will send work back to the callback for the main thread.
> > Normally, this is fine, but in weird situations (race condition?),
> > after a few hours of running my application, it will get Pika into an
> > unrecoverable state. Some sample code which duplicates this problem,
> > along with the resulting error messages, is included in this message
> > in case someone happens to Google for this error message (which got me
> > next to nowhere).
>
> > What is the correct way to do this? Note that both the callback and
> > the scheduler have to have shared access to the same variables (hence
> > the mutex), and performance does NOT matter (the scheduler runs once
> > per minute, and doesn't do too much.
>
> What about just opening two separate connections, one in each thread?
>
> I'm not sure how "reactors" work in Pika, but I guess there should be a
> way to have two separate event loops.
>
> Cheers,
> ? Marek
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From justin.adam.miller at gmail.com  Tue Sep 27 04:02:20 2011
From: justin.adam.miller at gmail.com (Justin Miller)
Date: Mon, 26 Sep 2011 23:02:20 -0400
Subject: [rabbitmq-discuss] Clustering and data partitioning - how best
	to implement
In-Reply-To: <BDE140BF4C952041931EF8CAAC83341D026B6B8E32@exch-mbx-111.vmware.com>
References: <bda81ef9-38fc-4226-931f-9ed248691dbb@q25g2000vbx.googlegroups.com>
	<CACOPnvcRWoSCyHyG9Uh7usv8_vuXHj=61XqU_A3Zw=uLhJPcaQ@mail.gmail.com>
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E31@exch-mbx-111.vmware.com>
	<6859984426335469297@unknownmsgid>
	<BDE140BF4C952041931EF8CAAC83341D026B6B8E32@exch-mbx-111.vmware.com>
Message-ID: <-4249020707751990879@unknownmsgid>

I was referring to the hashing exchange that Alexis posted.

Topic exchanges wouldn't really work for us because we don't have a
good way to partition our queues/data.

When I said subtopics, I was referring to your article about breaking
up a high traffic queue into like queue.{1,2,3,4} etc. I think that
would be a viable option, but would require knowledge of how many
queues there are. As you mentioned, I could get this by using the
management plugin, or my idea of a sort of handshake between producers
and consumers that I mentioned in my first post. But that all seems
moot with the hashing exchange that Matthew wrote.

-j

On Sep 26, 2011, at 9:47 PM, Helena Edelson <hedelson at vmware.com> wrote:

> Jason, you mean a topic exchange? If so, yes topic exchanges are great to distribute your traffic from the one queue with high load to n-queues, each queue bound with a pattern matching a 'sub topic' if you will. That and set up wiretaps, etc.
>
> Helena
> ________________________________________
> From: Justin Miller [justin.adam.miller at gmail.com]
> Sent: Monday, September 26, 2011 6:46 PM
> To: Helena Edelson
> Cc: rabbitmq-discuss at lists.rabbitmq.com; Alexis Richardson
> Subject: Re: [rabbitmq-discuss] Clustering and data partitioning - how best to implement
>
> Helena, all,
>
> Thanks for the responses. Actually the hashing exchange is exactly
> what I'm looking for.
>
> I already rely on the round robin behavior of queues, but our problem
> is that we can't logically partition our data any further and we have
> one queue that gets more requests than the others.
>
> Right now, we manually break up the queue into those subqueues, but
> that's not the most maintainable solution nor does it address the
> problem in a cluster.
>
> Given our limitations, the hashing exchange seems like the best solution, no?
>
> Thanks
> Justin
>
> On Sep 26, 2011, at 8:06 PM, Helena Edelson <hedelson at vmware.com> wrote:
>
>> Hi Justin,
>>
>> Luckily, things are much simpler than what your questions lead to :-)
>>
>> I think you're looking for is the round robin/competing consumers. I had a typo on that blog post which is now fixed that may have caused confusion.
>> Queue -> multiple consumers  http://www.rabbitmq.com/tutorials/tutorial-two-python.html
>> Your producer simply publishes to exchanges. The RabbitMQ server knows where to route the messages (via bindings between queues and exchanges), the Producer is decoupled completely from any endpoint awareness. This decoupling is key.
>>
>> Do look at http://www.rabbitmq.com/ha.html also talks about queues in a cluster. It will answer a lot of your questions.
>>
>> You definitely want more than one queue...particularly if you are in any kind of scalable heavy load situation. Generally you have many queues, often partitioned logically. Do take note the performance issues to watch for in the post.
>>
>> I hope that helps a bit,
>> Helena
>> ________________________________________
>> From: alexis.richardson at gmail.com [alexis.richardson at gmail.com] On Behalf Of Alexis Richardson [alexis at rabbitmq.com]
>> Sent: Monday, September 26, 2011 2:10 PM
>> To: justin.adam.miller at gmail.com
>> Cc: rabbitmq-discuss at lists.rabbitmq.com
>> Subject: Re: [rabbitmq-discuss] Clustering and data partitioning - how best to implement
>>
>> Does this help?
>>
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-September/015263.html
>>
>>
>>
>>
>> On Mon, Sep 26, 2011 at 9:05 PM, justin.adam.miller at gmail.com
>> <justin.adam.miller at gmail.com> wrote:
>>> I'm trying to implement some of the ideas from this article:
>>>
>>> http://blog.springsource.com/2011/04/01/routing-topologies-for-performance-and-scalability-with-rabbitmq/
>>>
>>> Our situation is that we have two rabbit instances, not clustered, so
>>> that we can spread out load. In our current setup, it's still possible
>>> for us to hit one broker harder than the other, so ideally we'd like
>>> to setup these nodes in a cluster. That way, we can have consumers
>>> evenly distributed across brokers.
>>>
>>> We could create one queue that all consumers consume from, but I'm not
>>> sure that would solve our problems since that queue (and the broker it
>>> was created on) would become a hotspot. Right?
>>>
>>> So from that article, I like the idea of each node creating a queue,
>>> e.g. myQueue.1, myQueue.2, etc. and having the producer round robin
>>> them. What I don't know, is how the producer knows how many queues/
>>> nodes there are. The producers could send to an exchange and just set
>>> the routingKey, but still, I think the problem is the same.
>>>
>>> I guess I could use the management plugin, but I'm trying to figure
>>> out how to do that without issuing a request for every message I
>>> produce.
>>>
>>> I could imagine some kind of handshake when a producer comes online,
>>> he sends a "who's-alive" message to a topic exchange and waits for
>>> responses from consumers. Also, when a consumer comes online, he
>>> immediately sends out a "I'm-alive" message. In a direct exchange
>>> (either the default or one that I create), is a routingKey assumed to
>>> be a queue name? If I made the queues auto_delete, what would happen
>>> when the producer tries to send a message to a queue that no longer
>>> exists? Would I get an exception such that I can catch it and send the
>>> message to the next guy in the list?
>>>
>>> Thanks,
>>> Justin
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>

From matthias at rabbitmq.com  Tue Sep 27 07:09:14 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 27 Sep 2011 07:09:14 +0100
Subject: [rabbitmq-discuss] Anything special on dev.rabbitmq.com wrt.
 x-expire?
In-Reply-To: <20110927002911.GA63487@codingforce.com>
References: <20110927002911.GA63487@codingforce.com>
Message-ID: <4E81688A.1090602@rabbitmq.com>

Bernhard,

On 27/09/11 01:29, Bernhard Weisshuhn wrote:
> while adding support for queue arguments to a node.js amqp library, we
> noticed a puzzling behaviour on dev.rabbitmq.com: Redeclaring an existing
> queue with differing x-expire values is accepted, even over the same
> connection. Discusson here: https://github.com/postwait/node-amqp/pull/25

I suspect the queue is expiring before the second queue.declare. The 
expiry value in the test is just 300 milliseconds. Depending on network 
conditions and load on dev.rabbitmq.com, that could easily get exceeded.

So a) choose a higher value, and b) consider using 'nowait=true' in the 
queue.declare and pipeline the two requests (I have no idea whether 
node.amqp can do that, but it should ;) in order to minimise the effects 
of network latency.

Regards,

Matthias.

From acheremukhin.digitalguard at gmail.com  Tue Sep 27 08:27:17 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Tue, 27 Sep 2011 00:27:17 -0700 (PDT)
Subject: [rabbitmq-discuss]  Sometimes error {inet_error,
 etimedout} is happened
Message-ID: <11315864.331.1317108437452.JavaMail.geo-discussion-forums@yqgn17>

Hi to all.

Sometimes, i see errors in rabbitmq.log "{inet_error, etimedout}" and after 
this rabbitmq-server close this connection. 
But in code of rabbitmq-server, i've not found that option of socket *
send_timeout* is reset. It's means that gen_tcp:send have to try to send 
data infinity.
Why is the error "{inet_error, etimedout}" happened?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110927/4fa1354d/attachment.htm>

From majek04 at gmail.com  Tue Sep 27 09:27:41 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 27 Sep 2011 09:27:41 +0100
Subject: [rabbitmq-discuss] Pika - how to properly publish from a
 periodic background thread?
In-Reply-To: <eea35368-3176-4d64-a795-fcb8543b2fb9@m5g2000vbe.googlegroups.com>
References: <a05c76b9-4a8c-413f-afee-ee37b0dfa261@x32g2000prf.googlegroups.com>
	<CABzX+qx4ubaAUPvA_NZdAiUykidxRy_LpLFjGMB4ShJUET1h1A@mail.gmail.com>
	<eea35368-3176-4d64-a795-fcb8543b2fb9@m5g2000vbe.googlegroups.com>
Message-ID: <CABzX+qwzz33sWDqczk-jA5YpWZdky7wPkY9Ts3qvx7iyhEKkRA@mail.gmail.com>

On Tue, Sep 27, 2011 at 03:14, Aaron Voelker <aaron at contextlogic.com> wrote:
> Thanks for the reply Marek.
>
> I think you're right that having two separate connections in separate
> threads would work.
>
> But I think I found a more elegant solution that avoids threading
> altogether, by using an IOLoop. Basically, I used the Tornado adapter
> for Pika: http://pika.github.com/connecting.html#adapters-tornado-connection-tornadoconnection
>
> Then I was able to leverage Tornado's PeriodicCallback and add that to
> the same IOLoop to do background publishing.
> https://github.com/facebook/tornado/blob/master/tornado/ioloop.py
>
> Everything is now singly threaded, and it worked like a charm. Hoping
> someone will find this info helpful.

I'm glad you got that working. Avoiding threads is almost always a
better solution.

Marek

> On Sep 26, 10:00?am, Marek Majkowski <maje... at gmail.com> wrote:
>> On Thu, Sep 22, 2011 at 21:26, Aaron Voelker <aa... at contextlogic.com> wrote:
>> > I'm using Python 2.6.6, Ubuntu 10.10, and Pika 0.9.5.
>>
>> > I have a situation where I want to publish to a queue from a
>> > background thread at a periodic interval. The main thread is consuming
>> > on some different callback.
>>
>> > I assumed (incorrectly) that wrapping my callback and publish in a
>> > mutex would solve this problem. I ran into some weird behaviour before
>> > I realized that maybe this isn't the correct approach.
>>
>> > What happens is that the worker I publish to from the background
>> > thread will send work back to the callback for the main thread.
>> > Normally, this is fine, but in weird situations (race condition?),
>> > after a few hours of running my application, it will get Pika into an
>> > unrecoverable state. Some sample code which duplicates this problem,
>> > along with the resulting error messages, is included in this message
>> > in case someone happens to Google for this error message (which got me
>> > next to nowhere).
>>
>> > What is the correct way to do this? Note that both the callback and
>> > the scheduler have to have shared access to the same variables (hence
>> > the mutex), and performance does NOT matter (the scheduler runs once
>> > per minute, and doesn't do too much.
>>
>> What about just opening two separate connections, one in each thread?
>>
>> I'm not sure how "reactors" work in Pika, but I guess there should be a
>> way to have two separate event loops.
>>
>> Cheers,
>> ? Marek
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From majek04 at gmail.com  Tue Sep 27 09:53:58 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 27 Sep 2011 09:53:58 +0100
Subject: [rabbitmq-discuss] new user problem
In-Reply-To: <OF34BFB8DF.38B2C974-ON86257917.00702367-86257917.0070236F@unmc.edu>
References: <OF34BFB8DF.38B2C974-ON86257917.00702367-86257917.0070236F@unmc.edu>
Message-ID: <CABzX+qxCNMjtPRA5b0GG-tbMhKq4NO2t7j=-P4xRx90BAo8BVg@mail.gmail.com>

Sean,

Is 'guest1' a valid username and password?

What those commands say:
 rabbitmqctl list_users
 rabbitmqctl list_user_permissions guest1

On Mon, Sep 26, 2011 at 21:24, Sean W Duffy <swduffy at unmc.edu> wrote:
> Using 2.6.1 and python's amqplib-1.0.0.
>
> I can run examples with guest/guest, but no other users/passwords I've
> created seem to work:
>
> ??? conn = amqp.Connection(host="localhost:5672", userid="guest1",
> password="guest1", virtual_host="/", insist=True)
> ? File "build/bdist.linux-i686/egg/amqplib/client_0_8/connection.py", line
> 147, in __init__
> ? File "build/bdist.linux-i686/egg/amqplib/client_0_8/connection.py", line
> 489, in _x_open
> ? File "build/bdist.linux-i686/egg/amqplib/client_0_8/abstract_channel.py",
> line 94, in wait
> ? File "build/bdist.linux-i686/egg/amqplib/client_0_8/connection.py", line
> 201, in _wait_method
> ? File "build/bdist.linux-i686/egg/amqplib/client_0_8/method_framing.py",
> line 221, in read_method
> IOError: Socket closed
>
> I'm using rabbitmqctl, and the users show in the list, but are invalid!
>
> Any ideas?
>
> Sean
>
> "Every good work of software starts by scratching a developer's personal
> itch" -- Eric Raymond
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

From ranmizrachi at gmail.com  Tue Sep 27 12:53:53 2011
From: ranmizrachi at gmail.com (ran mizrachi)
Date: Tue, 27 Sep 2011 14:53:53 +0300
Subject: [rabbitmq-discuss] Queues creation in cluster
Message-ID: <CAOQFjYNTz_eCVDbDr_rwoJYn1dd6g3RqvfJ9wcxuvApg45Wsmg@mail.gmail.com>

I am setting a cluster of two nodes, accessing the cluster through load
balancer, creating queues on demand, since queue relay in only one node, how
can I make sure queues are created equally on both nodes.

Does RabbitMQ has any knowledge about workload on each node, or he just
randomly pick one of the nodes to create the queue in ?

If I need to load balance queues creation equally between the two nodes
myself, does anyone know of any plugging to do that ?


Thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110927/cf6c6eb9/attachment.htm>

From ekirpichov at gmail.com  Tue Sep 27 12:57:28 2011
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Tue, 27 Sep 2011 15:57:28 +0400
Subject: [rabbitmq-discuss] Queues creation in cluster
In-Reply-To: <CAOQFjYNTz_eCVDbDr_rwoJYn1dd6g3RqvfJ9wcxuvApg45Wsmg@mail.gmail.com>
References: <CAOQFjYNTz_eCVDbDr_rwoJYn1dd6g3RqvfJ9wcxuvApg45Wsmg@mail.gmail.com>
Message-ID: <CANVKUrVdFZNJu0Y4r-9y1UrEuNEu9YXRjT54+7SWqTwmnZZW1Q@mail.gmail.com>

Rabbit creates the queue on the node to which you're connecting,
unless it already exists on another node.

On Tue, Sep 27, 2011 at 3:53 PM, ran mizrachi <ranmizrachi at gmail.com> wrote:
> I am setting a cluster of two nodes, accessing the cluster through load
> balancer, creating queues on demand, since queue relay in only one node, how
> can I make sure queues are created?equally on both nodes.
> Does RabbitMQ has any knowledge?about workload on each node, or he just
> randomly pick one of the nodes to create the queue in ?
> If I need to load balance queues creation equally between the two nodes
> myself, does anyone know of any plugging to do that ?
>
> Thanks,
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



-- 
Eugene Kirpichov
Principal Engineer, Mirantis Inc. http://www.mirantis.com/
Editor, http://fprog.ru/

From alexandru at rabbitmq.com  Tue Sep 27 13:07:43 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 27 Sep 2011 13:07:43 +0100
Subject: [rabbitmq-discuss] defining role type in a cluster
In-Reply-To: <a7f2cb2e-6f23-4e3d-a801-3531d32c0213@mx1.0b10.mx>
References: <39184168-cb6c-4f52-aea2-eeca350835b1@mx1.0b10.mx>
	<a7f2cb2e-6f23-4e3d-a801-3531d32c0213@mx1.0b10.mx>
Message-ID: <20110927120743.GD3913@southbank.eng.vmware.com>

Hi Kyle,

> Does anyone know if it's possible to define whether a node in a cluster is a disc or ram node via the rabbitmq.config file?  I am trying to ensure that if a node leaves the cluster for some reason it comes back as the appropriate node type.

You can auto-configure the cluster by setting cluster_nodes in
rabbitmq.config:
  http://www.rabbitmq.com/clustering.html#auto-config

As with manual plugin configuration, the node type is implicit: if the
current node is in the cluster node list, it will be disc; otherwise,
it will be ram.

So, if the 'rabbit at rabbit1' clusters with ['rabbit at rabbit2',
'rabbit at rabbit3'], it will be a ram node.  If it clusters with
['rabbit at rabbit1', 'rabbit at rabbit2', 'rabbit at rabbit3'], it will be a
disc node.  In other respects, both clusters are identical.

Note that any manual configuration (via "rabbitmqctl cluster ...") will
take precedence over the config file.  You can remove the manual
configuration by resetting the node (at which point, rabbit will use the
settings in the config file).

Hope this helps.

Cheers,
Alex

On Mon, Sep 26, 2011 at 09:28:58AM -0400, Kyle O'Donnell wrote:
> Hi,
> 
> Does anyone know if it's possible to define whether a node in a cluster is a disc or ram node via the rabbitmq.config file?  I am trying to ensure that if a node leaves the cluster for some reason it comes back as the appropriate node type.
> 
> Thanks,
> Kyle
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Tue Sep 27 13:38:39 2011
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 27 Sep 2011 13:38:39 +0100
Subject: [rabbitmq-discuss] Sometimes error {inet_error,
 etimedout} is happened
In-Reply-To: <11315864.331.1317108437452.JavaMail.geo-discussion-forums@yqgn17>
References: <11315864.331.1317108437452.JavaMail.geo-discussion-forums@yqgn17>
Message-ID: <4E81C3CF.6080403@rabbitmq.com>

Hi Cheremukhin,

On 27/09/11 08:27, Cheremukhin Andrey wrote:
> Hi to all.
> 
> Sometimes, i see errors in rabbitmq.log "{inet_error, etimedout}" and
> after this rabbitmq-server close this connection.

We've seen this error in the presence of firewalls and load balancers.
There may be a device on your network that interferes with the network
traffic.

> But in code of rabbitmq-server, i've not found that option of socket
> *send_timeout* is reset. It's means that gen_tcp:send have to try to
> send data infinity.

The possibility of setting a timeout does exist, e.g.
rabbit_net:async_recv/3

> Why is the error "{inet_error, etimedout}" happened?

For more information about socket timeouts see the error section of the
"tcp" man page or http://www.sockets.com/err_lst1.htm#WSAETIMEDOUT


-Emile

From bkw at codingforce.com  Tue Sep 27 13:43:41 2011
From: bkw at codingforce.com (Bernhard Weisshuhn)
Date: Tue, 27 Sep 2011 14:43:41 +0200
Subject: [rabbitmq-discuss] Anything special on dev.rabbitmq.com wrt.
 x-expire?
In-Reply-To: <4E81688A.1090602@rabbitmq.com>
References: <20110927002911.GA63487@codingforce.com>
	<4E81688A.1090602@rabbitmq.com>
Message-ID: <20110927124340.GA82216@codingforce.com>

On Tue, Sep 27, 2011 at 07:09:14AM +0100, Matthias Radestock <matthias at rabbitmq.com> wrote:

> I suspect the queue is expiring before the second queue.declare. The
> expiry value in the test is just 300 milliseconds. Depending on
> network conditions and load on dev.rabbitmq.com, that could easily
> get exceeded.

That explains it all - I was under the impression there where mere
seconds instead of milleseconds. Thanks for clearing up the confusion,
it all makes sense now.

kind regards,
  bkw


From majek04 at gmail.com  Tue Sep 27 16:08:49 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 27 Sep 2011 16:08:49 +0100
Subject: [rabbitmq-discuss] What to do when high watermark reached?
In-Reply-To: <D9FA4A5BA98C4AC8978AC5B1EF7F6D29@ftml.net>
References: <D9FA4A5BA98C4AC8978AC5B1EF7F6D29@ftml.net>
Message-ID: <CABzX+qwVXwTfqi2fyfkem0NnJX3KjFKn=G1C6xFi5j_3XeeANQ@mail.gmail.com>

Fran?ois,

2011/9/27 Fran?ois Beausoleil <francois at teksol.info>:
> According to the management console's overview tab, I've reached my memory high watermark. I have two queues with a combined total of 2.5M messages. My workers are up and running, but in both cases, the queue consumers read messages and may publish messages to another exchange.
>
> I can restart my workers, in which case the messages are unack'd and put back in the queue, to be processed again.
>
> Is there a way around this? What can I do to process those messages? Can I tweak something in the server while it's up? I don't want to reboot it because I've lost messages before, even though my messages are published using :persistent => true (Bunny).
>
> Rereading http://www.rabbitmq.com/admin-guide.html#memsup, I notice that it says I should use multiple connections: one for producing, one for consuming. I'll have to change my apps to do that, but in the meantime?

The easiest thing to do is to beef up your machine and give Rabbit
more RAM (adding a SSD drive may additionally help :P).

When Rabbit hits the memory limit, there's really not much that can be
done. In theory the *consumers* should still be able to consume
messages, and thus free some memory over time.

But in practice, due to AMQP constraints RabbitMQ can't really
distinguish producers and consumers on per-channel basis. Instead,
Rabbit looks at the connection. If there are messages produced on a
connection - it will be blocked to avoid the need to cope with even
more messages.

Erlang VM is likely to crash if there isn't enough free memory to do a
full garbage collection cycle.

If you don't care about messages, you can try to purge messages or
remove unused queues. But I guess, you should be using different
connections for producing and consuming. Sorry.

Hope that helps,
 Marek

From francois at teksol.info  Tue Sep 27 16:11:35 2011
From: francois at teksol.info (=?utf-8?Q?Fran=C3=A7ois_Beausoleil?=)
Date: Tue, 27 Sep 2011 11:11:35 -0400
Subject: [rabbitmq-discuss] What to do when high watermark reached?
In-Reply-To: <CABzX+qwVXwTfqi2fyfkem0NnJX3KjFKn=G1C6xFi5j_3XeeANQ@mail.gmail.com>
References: <D9FA4A5BA98C4AC8978AC5B1EF7F6D29@ftml.net>
	<CABzX+qwVXwTfqi2fyfkem0NnJX3KjFKn=G1C6xFi5j_3XeeANQ@mail.gmail.com>
Message-ID: <FC774B457CAA4684B25A75A3626521B9@ftml.net>

Le mardi 27 septembre 2011 ? 11:08, Marek Majkowski a ?crit :
> The easiest thing to do is to beef up your machine and give Rabbit
> more RAM (adding a SSD drive may additionally help :P).
Oops, I can give it more RAM, being on Rackspace, but SSDs are another matter.

I ended up purging my queue, which enabled me to proceed. I'll use more connections in the future.

If I dedicate a machine to RabbitMQ, can/should I change the HWM setting from 40%?

Thanks!
Fran?ois


From acheremukhin.digitalguard at gmail.com  Tue Sep 27 18:35:04 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Tue, 27 Sep 2011 10:35:04 -0700 (PDT)
Subject: [rabbitmq-discuss] Sometimes error {inet_error,
 etimedout} is happened
In-Reply-To: <4E81C3CF.6080403@rabbitmq.com>
References: <11315864.331.1317108437452.JavaMail.geo-discussion-forums@yqgn17>
	<4E81C3CF.6080403@rabbitmq.com>
Message-ID: <33444162.780.1317144904152.JavaMail.geo-discussion-forums@yqlb4>

 

> We'e seen this error in the presence of firewalls and load balancers.

> There may be a device on your network that interferes with the network

> traffic.


Probably, it's may case. Thank you. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110927/2ad9abe2/attachment.htm>

From majek04 at gmail.com  Tue Sep 27 21:01:28 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Tue, 27 Sep 2011 21:01:28 +0100
Subject: [rabbitmq-discuss] What to do when high watermark reached?
In-Reply-To: <FC774B457CAA4684B25A75A3626521B9@ftml.net>
References: <D9FA4A5BA98C4AC8978AC5B1EF7F6D29@ftml.net>
	<CABzX+qwVXwTfqi2fyfkem0NnJX3KjFKn=G1C6xFi5j_3XeeANQ@mail.gmail.com>
	<FC774B457CAA4684B25A75A3626521B9@ftml.net>
Message-ID: <CABzX+qzkBSAYLr6WibkRtaEUddcgM244ZSm3NJP5wmitMhSEbA@mail.gmail.com>

2011/9/27 Fran?ois Beausoleil <francois at teksol.info>:
> Le mardi 27 septembre 2011 ? 11:08, Marek Majkowski a ?crit :
>> The easiest thing to do is to beef up your machine and give Rabbit
>> more RAM (adding a SSD drive may additionally help :P).
> Oops, I can give it more RAM, being on Rackspace, but SSDs are another matter.
>
> I ended up purging my queue, which enabled me to proceed. I'll use more connections in the future.
>
> If I dedicate a machine to RabbitMQ, can/should I change the HWM setting from 40%?

It all depends on your setup!

If you're using one fat queue - most of the memory Rabbit is using
will be consumed,
probably by this queue. Thus, the Erlang VM garbage collector will
need to collect
a lot of data at once.

For such setup, you need to have at least 50% free memory to allow GC to run
without hitting the swap.

That's the pessimistic case, and that's why the default is 40% (one
queue + twice
as much memory to allow the gc to run smoothly + 20% buffer).

On the other hand, if you're using multiple queues (and they have similar
usage pattern), you can probably increase the memory watermark -
Erlang VM is unlikely to reclaim all the memory that rabbit is using at once.
But it gets more risky :)

If the GC will hit the swap, Rabbit will slow down significantly. If the GC
will want to allocate more memory than is available in swap, it may
crash Erlang VM.

Marek

From kyleo at 0b10.mx  Tue Sep 27 21:17:01 2011
From: kyleo at 0b10.mx (Kyle O'Donnell)
Date: Tue, 27 Sep 2011 16:17:01 -0400 (EDT)
Subject: [rabbitmq-discuss] defining role type in a cluster
In-Reply-To: <20110927120743.GD3913@southbank.eng.vmware.com>
Message-ID: <650e70c6-aa3a-4c2f-bc15-7cd5fe3b2e20@mx1.0b10.mx>

Hi Alex,

It does help, thanks.  It looks like each rabbit node 'remembers' whether it was set to be a disc or ram node.

Leads to another question though...  Is it possible setup a primary and secondary disc node, where the secondary is a ram node unless the primary leaves the cluster?

Thanks,
Kyle

----- Original Message -----
From: "Alexandru Scvor?ov" <alexandru at rabbitmq.com>
To: "Kyle O'Donnell" <kyleo at 0b10.mx>
Cc: rabbitmq-discuss at lists.rabbitmq.com
Sent: Tuesday, September 27, 2011 8:07:43 AM
Subject: Re: [rabbitmq-discuss] defining role type in a cluster

Hi Kyle,

> Does anyone know if it's possible to define whether a node in a cluster is a disc or ram node via the rabbitmq.config file?  I am trying to ensure that if a node leaves the cluster for some reason it comes back as the appropriate node type.

You can auto-configure the cluster by setting cluster_nodes in
rabbitmq.config:
  http://www.rabbitmq.com/clustering.html#auto-config

As with manual plugin configuration, the node type is implicit: if the
current node is in the cluster node list, it will be disc; otherwise,
it will be ram.

So, if the 'rabbit at rabbit1' clusters with ['rabbit at rabbit2',
'rabbit at rabbit3'], it will be a ram node.  If it clusters with
['rabbit at rabbit1', 'rabbit at rabbit2', 'rabbit at rabbit3'], it will be a
disc node.  In other respects, both clusters are identical.

Note that any manual configuration (via "rabbitmqctl cluster ...") will
take precedence over the config file.  You can remove the manual
configuration by resetting the node (at which point, rabbit will use the
settings in the config file).

Hope this helps.

Cheers,
Alex

On Mon, Sep 26, 2011 at 09:28:58AM -0400, Kyle O'Donnell wrote:
> Hi,
> 
> Does anyone know if it's possible to define whether a node in a cluster is a disc or ram node via the rabbitmq.config file?  I am trying to ensure that if a node leaves the cluster for some reason it comes back as the appropriate node type.
> 
> Thanks,
> Kyle
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alexandru at rabbitmq.com  Tue Sep 27 21:31:52 2011
From: alexandru at rabbitmq.com (Alexandru =?utf-8?B?U2N2b3LFo292?=)
Date: Tue, 27 Sep 2011 21:31:52 +0100
Subject: [rabbitmq-discuss] defining role type in a cluster
In-Reply-To: <650e70c6-aa3a-4c2f-bc15-7cd5fe3b2e20@mx1.0b10.mx>
References: <20110927120743.GD3913@southbank.eng.vmware.com>
	<650e70c6-aa3a-4c2f-bc15-7cd5fe3b2e20@mx1.0b10.mx>
Message-ID: <20110927203152.GB3094@southbank.Home>

Hi Kyle,

> It does help, thanks.  It looks like each rabbit node 'remembers' whether it was set to be a disc or ram node.

They "remember" until they're reset.

> Leads to another question though...  Is it possible setup a primary and secondary disc node, where the secondary is a ram node unless the primary leaves the cluster?

There's no automatic way to do this in RabbitMQ.  Also, there's no way
to convert a standalone ram node into a disc node without losing the
information on it (because rabbit has to be stopped to do the
conversion, so the database contents will be lost).

Clustering in RabbitMQ is designed to improve scalability (more nodes =
higher capacity).  What you're looking for is High Availability.  There
are a few ways to achieve that with Rabbit; see our two guides (you sort
of described an active/passive scenario):
  Active/Passive HA: http://www.rabbitmq.com/pacemaker.html
  Active/Active HA: http://www.rabbitmq.com/ha.html

Cheers,
Alex

On Tue, Sep 27, 2011 at 04:17:01PM -0400, Kyle O'Donnell wrote:
> Hi Alex,
> 
> It does help, thanks.  It looks like each rabbit node 'remembers' whether it was set to be a disc or ram node.
> 
> Leads to another question though...  Is it possible setup a primary and secondary disc node, where the secondary is a ram node unless the primary leaves the cluster?
> 
> Thanks,
> Kyle
> 
> ----- Original Message -----
> From: "Alexandru Scvor?ov" <alexandru at rabbitmq.com>
> To: "Kyle O'Donnell" <kyleo at 0b10.mx>
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Sent: Tuesday, September 27, 2011 8:07:43 AM
> Subject: Re: [rabbitmq-discuss] defining role type in a cluster
> 
> Hi Kyle,
> 
> > Does anyone know if it's possible to define whether a node in a cluster is a disc or ram node via the rabbitmq.config file?  I am trying to ensure that if a node leaves the cluster for some reason it comes back as the appropriate node type.
> 
> You can auto-configure the cluster by setting cluster_nodes in
> rabbitmq.config:
>   http://www.rabbitmq.com/clustering.html#auto-config
> 
> As with manual plugin configuration, the node type is implicit: if the
> current node is in the cluster node list, it will be disc; otherwise,
> it will be ram.
> 
> So, if the 'rabbit at rabbit1' clusters with ['rabbit at rabbit2',
> 'rabbit at rabbit3'], it will be a ram node.  If it clusters with
> ['rabbit at rabbit1', 'rabbit at rabbit2', 'rabbit at rabbit3'], it will be a
> disc node.  In other respects, both clusters are identical.
> 
> Note that any manual configuration (via "rabbitmqctl cluster ...") will
> take precedence over the config file.  You can remove the manual
> configuration by resetting the node (at which point, rabbit will use the
> settings in the config file).
> 
> Hope this helps.
> 
> Cheers,
> Alex
> 
> On Mon, Sep 26, 2011 at 09:28:58AM -0400, Kyle O'Donnell wrote:
> > Hi,
> >
> > Does anyone know if it's possible to define whether a node in a cluster is a disc or ram node via the rabbitmq.config file?  I am trying to ensure that if a node leaves the cluster for some reason it comes back as the appropriate node type.
> >
> > Thanks,
> > Kyle
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From torinsandall at gmail.com  Wed Sep 28 00:20:41 2011
From: torinsandall at gmail.com (Torin Sandall)
Date: Tue, 27 Sep 2011 16:20:41 -0700
Subject: [rabbitmq-discuss] Publisher acks/confirm select with amqp0.8 spec
Message-ID: <CABKNZ0UdgCuBkR8SkHpXkhbxqOCWpm63jG3K+DPJJFtLY2nvuA@mail.gmail.com>

Has anyone had success adding publisher acks/confirm select to the amqp0-8
spec file?

When I add the confirm class to the spec file I get this exception on the
server:

 =CRASH REPORT==== 27-Sep-2011::15:40:21 ===
  crasher:
    initial call: rabbit_reader:init/4
    pid: <0.227.0>
    registered_name: []
    exception exit: {unknown_method_id,{85,10}}
      in function  rabbit_framing_amqp_0_8:lookup_method_name/1
      in call from rabbit_command_assembler:analyze_frame/3
      in call from rabbit_reader:handle_frame/4
      in call from rabbit_reader:handle_input/3
      in call from rabbit_reader:recvloop/2
      in call from rabbit_reader:start_connection/7
    ancestors: [<0.224.0>,rabbit_tcp_client_sup,rabbit_sup,<0.108.0>]
    messages: []
    links: [<0.224.0>,#Port<0.2158>]
    dictionary: [{{channel,1},{<0.231.0>,{method,rabbit_framing_amqp_0_8}}},
                  {{ch_pid,<0.231.0>},{1,#Ref<0.0.0.697>}}]
    trap_exit: true
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 1908
  neighbours:

I'm running with the following versions:

spec file = amqp0-8.stripped.xml (slightly modified/ships with txAMQP-0.4)
client library = txAMQP-0.4
rabbitmq-server = 2.6.1-1

-Torin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110927/e7642162/attachment.htm>

From matthias at rabbitmq.com  Wed Sep 28 09:41:48 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 28 Sep 2011 09:41:48 +0100
Subject: [rabbitmq-discuss] How to handle failover without losing
 messages if one of RabbitMQ node crashes in cluster
In-Reply-To: <CAO=2P+KpnsOaxjxknTXpoj+wu0LcOxwgipmzbGwxYo2w6RWALQ@mail.gmail.com>
References: <CAO=2P+KpnsOaxjxknTXpoj+wu0LcOxwgipmzbGwxYo2w6RWALQ@mail.gmail.com>
Message-ID: <4E82DDCC.3090401@rabbitmq.com>

Jaymin,

apologies for the late reply...

On 08/09/11 12:06, Jaymin Shah wrote:
> I have RabbitMQ cluster (2 instances of v2.6) on EC2. With this setup I
> am able to process around 51K/s messages.
>
> I have one exchange and 3 queues bound to each instance totaling to 6
> consumers and 3 producer each sending messages to each
> instance totaling to 6 producers. Note that queue is not durable.
>
> I am expected to validate if one of instance in cluster goes down then
> would I be losing messages? If yes then what could be done to avoid
> that. We tried durable queues but it does not give desired performance
> due to very high IO and that too on virtual environment like EC2.

In order to avoid message loss, some redundancy is required. That cannot 
come for free, so there is necessarily some impact on performance. I 
suggest you give the new active-active HA a try: 
http://www.rabbitmq.com/ha.html. This is reasonably well tuned and 
scales well, e.g. you can set up a cluster of N nodes, with each queue 
being mirrored to just two of the nodes.


Regards,

Matthias.

From matthias at rabbitmq.com  Wed Sep 28 10:18:21 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 28 Sep 2011 10:18:21 +0100
Subject: [rabbitmq-discuss] Consumer Performance Issues?
In-Reply-To: <1317080852.10785.YahooMailClassic@web65707.mail.ac4.yahoo.com>
References: <1317080852.10785.YahooMailClassic@web65707.mail.ac4.yahoo.com>
Message-ID: <4E82E65D.7020205@rabbitmq.com>

Marv,

On 27/09/11 00:47, cOre dUmPeR wrote:
> One thing I've been seeing that has me a little puzzled is that (for my
> test setup) message rates on the input side are an order of magnitude
> higher that on the output side. Meaning I can push 25K msgs/sec from my
> producer. However, my consumer, only seems to get about 2.5K
> msgs/sec...although both consumer and producer are setup similarly.
>
> Do I have something misconfigured? Or is this expected? I would expect
> *some* difference between producer(s)/consumer(s)...but not an order of
> magnitude.

When the broker is heavily loaded the internal scheduling could well 
result in messages getting accepted at a much higher rate than they are 
delivered to consumers. That said, a 10:1 ratio is quite unusual.

> HW
> ------
> (3) EC2 m1.xlarge boxes - 4 cores, 15GB mem
> 1 producer, 1 consumer, 1 broker
>
> Broker
> ----------
> Basic RabbitMQ broker install. Didnt really play with any options,
> except installing the Management plugins and using a different port than
> default.
>
> Producer
> -------------
> Java Client. 4 Producer threads, each with its own connection and
> channel. Direct exchange, NO persist, NO autodelete.
>
> Consumer
> ---------------
> Java client, 4 consumer threads, each with its own connection and
> channel. AutoAck YES.
 >
> Messages
> -----------------
> JSON bytes, about 150bytes each message.

So you have four producers publishing to the same queue, and four 
consumers consuming off that queue, correct?

If so, the above setup can be approximated quite well with the 
MulticastMain test program that ships with the java client. Run it with 
the options "-x 4 -y 4 -u q -a -s 150"

With RabbitMQ 2.6.1 (if you are running anything older then please try 
this one) running on my desktop machine and limited to 4 cores I see a 
balanced inbound and outbound rate of about 36kHz (NB: MulticastMain 
reports the sending rate independently for each producer; I'm seeing 
~9kHz x 4). It can easily get out of balance though - I've seen producer 
rates as high as 45kHz and consumer rates as low as 12kHz.

> Other Details
> --------------------
> My consumer CPU
> load is almost nothing, SO I dont think its the Consumer holding things
> up. *On the broker side....there is only 1 CPU out of 4 that is doing
> any real work. Is this normal?* With 4 consumer threads...I would expect
> more to be happening on the Broker.  I know when the Producer is pushing
> with 4 threads...the broker is generally very busy. But when I stop the
> producer, and leave the consumer running (again, with 4
> threads)...again, I see only 1 CPU on the broker working.

A queue is effectively a single-threaded resource. Marshalling and 
sending are done in separate threads though, so I would expect to see 
additional cores used for that. In my experiments draining a queue with 
four consumers causes the broker to utilise 2.7 cores.


Regards,

Matthias.

From majek04 at gmail.com  Wed Sep 28 10:56:24 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Wed, 28 Sep 2011 10:56:24 +0100
Subject: [rabbitmq-discuss] check if queue is empty?
In-Reply-To: <loom.20110921T193209-248@post.gmane.org>
References: <215fb2b7-6276-49d6-bcb1-4cb1dd876641@35g2000prp.googlegroups.com>
	<A3CDF983836444E3915A3C0EE62E42D8@myyearbook.com>
	<loom.20110921T162916-893@post.gmane.org>
	<4E79F834.8070106@rabbitmq.com>
	<loom.20110921T171227-804@post.gmane.org>
	<loom.20110921T193209-248@post.gmane.org>
Message-ID: <CABzX+qwC8LiJjqeE+aAp1pXc25n=bbEvnKP71Sg+Gn2rK6US-g@mail.gmail.com>

On Wed, Sep 21, 2011 at 18:35, Mark K <mkovachmcse at aol.com> wrote:
> An additional question: I want to be able to spin up and down consumers as
> needed, depening on the number messages in the queue. My thought is to do this
> in the code that is the consumer, if no more messages then do a clean close and
> release the thread it runs in. I have it working to a point, but not great. Are
> there any examples of having the consumer close when "sees" there are no more
> messages in a queue without just killing a thread the ugly way? Or is my logic
> wrong on how to do something like this? I'm using this with Python 2.7.

What do you mean by "killing a thread the ugly way" ?

Marek.

From mikeb at rabbitmq.com  Wed Sep 28 11:10:31 2011
From: mikeb at rabbitmq.com (Michael Bridgen)
Date: Wed, 28 Sep 2011 11:10:31 +0100
Subject: [rabbitmq-discuss] Publisher acks/confirm select with amqp0.8
 spec
In-Reply-To: <CABKNZ0UdgCuBkR8SkHpXkhbxqOCWpm63jG3K+DPJJFtLY2nvuA@mail.gmail.com>
References: <CABKNZ0UdgCuBkR8SkHpXkhbxqOCWpm63jG3K+DPJJFtLY2nvuA@mail.gmail.com>
Message-ID: <4E82F297.60808@rabbitmq.com>

On 09/28/2011 12:20 AM, Torin Sandall wrote:
> Has anyone had success adding publisher acks/confirm select to the
> amqp0-8 spec file?

You would also have to recompile the server with the new framing as 
well, and possibly update some other bits of code in the server.

-Michael

From peter at cacoethes.co.uk  Wed Sep 28 14:57:28 2011
From: peter at cacoethes.co.uk (Peter Ledbrook)
Date: Wed, 28 Sep 2011 14:57:28 +0100
Subject: [rabbitmq-discuss] RabbitMQ, Gretty, and Channel question
In-Reply-To: <2921fabf-09cf-4955-b63e-8bdcbd2095b5@t11g2000yqk.googlegroups.com>
References: <514AA77F91B54501AE6EBA421AC81833@BurtPriorPC>
	<CANBeYQTRHkZTOo4uWAk9iQ+Vy_zA3DAX0eyZ025nPWMjSjg+vA@mail.gmail.com>
	<2921fabf-09cf-4955-b63e-8bdcbd2095b5@t11g2000yqk.googlegroups.com>
Message-ID: <CANBeYQRHfr=otG1KVNX929R4uu1PFY5u_+R1MkuEyt5MW-Qgkw@mail.gmail.com>

> Testing the above web service with: ?'ab -n 10000 -c 100
> http://localhost:8080/web-service/activity
> This works great. ?this puts 10,000 messages on the queue perfectly (a
> bit slowly) every time.
> I think works perfectly because a new thread is created by tomcat for
> every request.
> That's why I don't have to worry about channel thread safety.
>
> This is NOT the case with Gretty, for reasons I don't understand.

Apparently the channel is not thread-safe, but that is very unlikely
to result in extra messages.

Are you looking on the queue directly through the RabbitMQ management
interface or the rabbit command line tools? Or are you consuming?
Also, are you able to check how many times basicPublish() is called?
Perhaps it's called 1003 times for some reason. Finally, are you
checking the number of messages on the queue before running ab? I
assume you are, but I have to ask :)

Cheers,

Peter

-- 
Peter Ledbrook
Grails Advocate
SpringSource - A Division of VMware

From mikael.beauvois at non.schneider-electric.com  Wed Sep 28 14:59:46 2011
From: mikael.beauvois at non.schneider-electric.com (mikael.beauvois at non.schneider-electric.com)
Date: Wed, 28 Sep 2011 15:59:46 +0200
Subject: [rabbitmq-discuss] No IOException from basicPublish when connection
	is lost
Message-ID: <OF66564312.1A0944EC-ONC1257919.0045C0F7-C1257919.004CE23A@Schneider-Electric.com>



Hi,

I have a problem when I call the basicPublish method defined in the Channel
interface.

In my client, I create a Connection using the ConnectionFactory (
com.rabbitmq.client.ConnectionFactory) to the broker running on a remote
host (connected in the local network). Then I create a Channel from this
Connection.
I call the basicPublish method in a loop (waiting 10s between each
publish). During the test, I unplug the network cable from the client
running on the local host.
The basicPublish method doesn't throw any exception (I expected at least
IOException because the network connection is lost). All calls to
basicPublish method in the loop never raise the IOException exception (or
any other exception). Obviously, the broker never received the messages
sent after loosing the network connection.

A ShutdownListener has been implemented but the shutdownCompleted method
is called by the RabbitMQ java client stack around 15 minutes after
unplugging the network cable.

I also tested the disconnection using the command line in a terminal. The
results are the same.

I am running RabbitMQ broker 2.6.1 with the RabbitMQ java client , Linux
Ubuntu 11.04 with kernel 2.6.38-11 (x86) and I tested my code with 2 JVM
(OpenJDK and Java HotSpot 1.6.0 (build 1.6.0_27-b07)).

Please, could you help me?

Best regards

Mikael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110928/77a365e6/attachment.htm>

From burtprior at comcast.net  Wed Sep 28 18:21:23 2011
From: burtprior at comcast.net (Burt Prior)
Date: Wed, 28 Sep 2011 10:21:23 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ, Gretty, and Channel question
In-Reply-To: <CANBeYQRHfr=otG1KVNX929R4uu1PFY5u_+R1MkuEyt5MW-Qgkw@mail.gmail.com>
References: <514AA77F91B54501AE6EBA421AC81833@BurtPriorPC>
	<CANBeYQTRHkZTOo4uWAk9iQ+Vy_zA3DAX0eyZ025nPWMjSjg+vA@mail.gmail.com>
	<2921fabf-09cf-4955-b63e-8bdcbd2095b5@t11g2000yqk.googlegroups.com>
	<CANBeYQRHfr=otG1KVNX929R4uu1PFY5u_+R1MkuEyt5MW-Qgkw@mail.gmail.com>
Message-ID: <c0ffc439-8304-4a99-bccd-a6cbf6fbda4c@8g2000yqm.googlegroups.com>

Hi Peter!  Thanks for following up on this. I appreciate it.

> Are you looking on the queue directly through the RabbitMQ management
> interface or the rabbit command line tools?

I installed the RabbitMQ management web interface, and this is where I
see '10003' instead of '10000'.
After stopping my consumer, I run 'ab' a number of times against the
Gretty code, and for lower numbers like 100 or 1000 it seems to work
perfectly.  (i.e. i see 100 or 1000 in the web interface queues).

When I run 'ab' using 10000 or 100000 is where i start seeing the
duplicates.  I've been pounding the equivalent Grails app I built with
'ab' and I NEVER see duplicates on the queue.

This issue is actually easily reproducible with the included Gretty
code and setting up a 'direct' queue as in the first RabbitMQ
tutorial, and viewing the results in the web interface (don't consume
yet) and with  'ab -n 10000 -c 100 http://localhost:8080/gretty/whatever'

> Also, are you able to check how many times basicPublish() is called? Perhaps it's called 1003 times for some reason.
Well, i'm not sure how to do that in Gretty. Would I just set up a
counter in that handler?  Not sure how that works with an event-driven
async framework.
I'm also wondering how 'ab' would ever send more than 10 or 100 or
10000?  (more than you specified)

> Finally, are you checking the number of messages on the queue before running ab?
Yes, there are no messages on the queue at all, so it's easy to see,
since I stopped my consumer.


Thanks again for your great reply.  I was quite surprised when I saw
this, and I realized I needed to reach out and understand what is
happening before I propose Gretty + RabbitMQ for production use.

Burt Prior


On Sep 28, 6:57?am, Peter Ledbrook <pe... at cacoethes.co.uk> wrote:
> > Testing the above web service with: ?'ab -n 10000 -c 100
> >http://localhost:8080/web-service/activity
> > This works great. ?this puts 10,000 messages on the queue perfectly (a
> > bit slowly) every time.
> > I think works perfectly because a new thread is created by tomcat for
> > every request.
> > That's why I don't have to worry about channel thread safety.
>
> > This is NOT the case with Gretty, for reasons I don't understand.
>
> Apparently the channel is not thread-safe, but that is very unlikely
> to result in extra messages.
>
> Are you looking on the queue directly through the RabbitMQ management
> interface or the rabbit command line tools? Or are you consuming?
> Also, are you able to check how many times basicPublish() is called?
> Perhaps it's called 1003 times for some reason. Finally, are you
> checking the number of messages on the queue before running ab? I
> assume you are, but I have to ask :)
>
> Cheers,
>
> Peter
>
> --
> Peter Ledbrook
> Grails Advocate
> SpringSource - A Division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From peter at cacoethes.co.uk  Thu Sep 29 09:34:58 2011
From: peter at cacoethes.co.uk (Peter Ledbrook)
Date: Thu, 29 Sep 2011 09:34:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ, Gretty, and Channel question
In-Reply-To: <c0ffc439-8304-4a99-bccd-a6cbf6fbda4c@8g2000yqm.googlegroups.com>
References: <514AA77F91B54501AE6EBA421AC81833@BurtPriorPC>
	<CANBeYQTRHkZTOo4uWAk9iQ+Vy_zA3DAX0eyZ025nPWMjSjg+vA@mail.gmail.com>
	<2921fabf-09cf-4955-b63e-8bdcbd2095b5@t11g2000yqk.googlegroups.com>
	<CANBeYQRHfr=otG1KVNX929R4uu1PFY5u_+R1MkuEyt5MW-Qgkw@mail.gmail.com>
	<c0ffc439-8304-4a99-bccd-a6cbf6fbda4c@8g2000yqm.googlegroups.com>
Message-ID: <CANBeYQQyU1o0PiuomY-4zd-iHccFjm4EgX3_o2RsPEm=g+_2jA@mail.gmail.com>

> Thanks again for your great reply. ?I was quite surprised when I saw
> this, and I realized I needed to reach out and understand what is
> happening before I propose Gretty + RabbitMQ for production use.

I can't get ab working against the Gretty server because it keeps
throwing exceptions. Anyway, from a single browser hit I can see two
messages being added to the queue. And if I add a println before the
publish, I see the message printed out twice. That suggests Gretty is
doing something odd.

Peter

-- 
Peter Ledbrook
Grails Advocate
SpringSource - A Division of VMware

From burtprior at comcast.net  Thu Sep 29 17:38:35 2011
From: burtprior at comcast.net (Burt Prior)
Date: Thu, 29 Sep 2011 09:38:35 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ, Gretty, and Channel question
In-Reply-To: <CANBeYQQyU1o0PiuomY-4zd-iHccFjm4EgX3_o2RsPEm=g+_2jA@mail.gmail.com>
References: <514AA77F91B54501AE6EBA421AC81833@BurtPriorPC>
	<CANBeYQTRHkZTOo4uWAk9iQ+Vy_zA3DAX0eyZ025nPWMjSjg+vA@mail.gmail.com>
	<2921fabf-09cf-4955-b63e-8bdcbd2095b5@t11g2000yqk.googlegroups.com>
	<CANBeYQRHfr=otG1KVNX929R4uu1PFY5u_+R1MkuEyt5MW-Qgkw@mail.gmail.com>
	<c0ffc439-8304-4a99-bccd-a6cbf6fbda4c@8g2000yqm.googlegroups.com>
	<CANBeYQQyU1o0PiuomY-4zd-iHccFjm4EgX3_o2RsPEm=g+_2jA@mail.gmail.com>
Message-ID: <b661c48e-e858-4b5a-9b03-12fd63d757a5@db5g2000vbb.googlegroups.com>

Hi Peter!

Outstanding!  You can see the issue!  This is absolutely great!

I was actually thinking that using Gretty as a lightweight web service
endpoint with RabbitMQ was a perfect use case for Gretty, and as a
viable alternative to Node.js  (I can write Groovy and not
Javascript!)

I think Gretty is awesome if we can get this use case with RabbitMQ
working correctly.
Would you have any thoughts on what next steps to resolve this issue
with Gretty would be?
Would you know of anyone else we could ask?  I learned about Gretty
from Andrew Glover's article here:
http://www.ibm.com/developerworks/java/library/j-javadev2-20/index.html

Thanks again for your help,
Burt Prior


On Sep 29, 1:34?am, Peter Ledbrook <pe... at cacoethes.co.uk> wrote:
> > Thanks again for your great reply. ?I was quite surprised when I saw
> > this, and I realized I needed to reach out and understand what is
> > happening before I propose Gretty + RabbitMQ for production use.
>
> I can't get ab working against the Gretty server because it keeps
> throwing exceptions. Anyway, from a single browser hit I can see two
> messages being added to the queue. And if I add a println before the
> publish, I see the message printed out twice. That suggests Gretty is
> doing something odd.
>
> Peter
>
> --
> Peter Ledbrook
> Grails Advocate
> SpringSource - A Division of VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tim at rabbitmq.com  Thu Sep 29 19:00:39 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Thu, 29 Sep 2011 19:00:39 +0100
Subject: [rabbitmq-discuss] RabbitMQ, Gretty, and Channel question
In-Reply-To: <b661c48e-e858-4b5a-9b03-12fd63d757a5@db5g2000vbb.googlegroups.com>
References: <514AA77F91B54501AE6EBA421AC81833@BurtPriorPC>	<CANBeYQTRHkZTOo4uWAk9iQ+Vy_zA3DAX0eyZ025nPWMjSjg+vA@mail.gmail.com>	<2921fabf-09cf-4955-b63e-8bdcbd2095b5@t11g2000yqk.googlegroups.com>	<CANBeYQRHfr=otG1KVNX929R4uu1PFY5u_+R1MkuEyt5MW-Qgkw@mail.gmail.com>	<c0ffc439-8304-4a99-bccd-a6cbf6fbda4c@8g2000yqm.googlegroups.com>	<CANBeYQQyU1o0PiuomY-4zd-iHccFjm4EgX3_o2RsPEm=g+_2jA@mail.gmail.com>
	<b661c48e-e858-4b5a-9b03-12fd63d757a5@db5g2000vbb.googlegroups.com>
Message-ID: <4E84B247.6050200@rabbitmq.com>

Burt - have you looked at node.x : https://github.com/purplefox/node.x ?

This is a new Rabbit/VMW project which you can think of as "node.js for 
JVM languages". It currently supports Java and Ruby and we are in the 
process of writing a Groovy API.

As well as supporting protocols such as TCP, HTTP, websockets etc, out 
of the box, it will have plugins for AMQP, Redis and many others.


On 29/09/11 17:38, Burt Prior wrote:
> Hi Peter!
>
> Outstanding!  You can see the issue!  This is absolutely great!
>
> I was actually thinking that using Gretty as a lightweight web service
> endpoint with RabbitMQ was a perfect use case for Gretty, and as a
> viable alternative to Node.js  (I can write Groovy and not
> Javascript!)
>
> I think Gretty is awesome if we can get this use case with RabbitMQ
> working correctly.
> Would you have any thoughts on what next steps to resolve this issue
> with Gretty would be?
> Would you know of anyone else we could ask?  I learned about Gretty
> from Andrew Glover's article here:
> http://www.ibm.com/developerworks/java/library/j-javadev2-20/index.html
>
> Thanks again for your help,
> Burt Prior
>
>
> On Sep 29, 1:34 am, Peter Ledbrook<pe... at cacoethes.co.uk>  wrote:
>>> Thanks again for your great reply.  I was quite surprised when I saw
>>> this, and I realized I needed to reach out and understand what is
>>> happening before I propose Gretty + RabbitMQ for production use.
>> I can't get ab working against the Gretty server because it keeps
>> throwing exceptions. Anyway, from a single browser hit I can see two
>> messages being added to the queue. And if I add a println before the
>> publish, I see the message printed out twice. That suggests Gretty is
>> doing something odd.
>>
>> Peter
>>
>> --
>> Peter Ledbrook
>> Grails Advocate
>> SpringSource - A Division of VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From aaron at contextlogic.com  Thu Sep 29 20:05:04 2011
From: aaron at contextlogic.com (Aaron Voelker)
Date: Thu, 29 Sep 2011 12:05:04 -0700 (PDT)
Subject: [rabbitmq-discuss] unack'd messages are starving my consumers/tasks
Message-ID: <11d710d2-14cc-4d9e-af52-a81ea0744223@b6g2000vbz.googlegroups.com>

I am using rabbitmq server 2.6.1, pika 0.9.5, python 2.6.6 and ubuntu
10.10.

I have multiple queues for multiple consumer (many to many), each with
a prefetch count of 5.

I've encountered a rare issue whereby a consumer that is currently
processing some messages (and has yet to ack them) suddenly
terminates. Obviously, this part is my problem (it's often the OS
killing the process due to consuming too much memory).

However, the effects are less than ideal. The messages remain unack'd
in the queue (verified by the Management Plugin), even though the
connection is no longer there (unless for some reason the OS is
deciding to keep the socket open?). This leads to that work never
being re-delegated.

Moreover, a few times when I've restarted the consumer, it's still
unable to consume those messages and starves itself because it thinks
they're still being worked on (and because of the prefetch count of 5
only allowing 5 unack'd messages), even though they are not being
worked on. This usually doesn't happen, but if it does I restart it
again and it finally works.

Any ideas as to what's happening and if there are any workarounds?

Thanks,
Aaron

From gmr at myyearbook.com  Thu Sep 29 20:17:43 2011
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Thu, 29 Sep 2011 15:17:43 -0400
Subject: [rabbitmq-discuss] unack'd messages are starving my
	consumers/tasks
In-Reply-To: <11d710d2-14cc-4d9e-af52-a81ea0744223@b6g2000vbz.googlegroups.com>
References: <11d710d2-14cc-4d9e-af52-a81ea0744223@b6g2000vbz.googlegroups.com>
Message-ID: <CAL_e=0pb2n=W5iL_6So3ZLhOT3khpUZ1BmfseW1MxqQh9UQWxA@mail.gmail.com>

Are you issuing a basic.recover?

http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.recover

On Thu, Sep 29, 2011 at 3:05 PM, Aaron Voelker <aaron at contextlogic.com>wrote:

> I am using rabbitmq server 2.6.1, pika 0.9.5, python 2.6.6 and ubuntu
> 10.10.
>
> I have multiple queues for multiple consumer (many to many), each with
> a prefetch count of 5.
>
> I've encountered a rare issue whereby a consumer that is currently
> processing some messages (and has yet to ack them) suddenly
> terminates. Obviously, this part is my problem (it's often the OS
> killing the process due to consuming too much memory).
>
> However, the effects are less than ideal. The messages remain unack'd
> in the queue (verified by the Management Plugin), even though the
> connection is no longer there (unless for some reason the OS is
> deciding to keep the socket open?). This leads to that work never
> being re-delegated.
>
> Moreover, a few times when I've restarted the consumer, it's still
> unable to consume those messages and starves itself because it thinks
> they're still being worked on (and because of the prefetch count of 5
> only allowing 5 unack'd messages), even though they are not being
> worked on. This usually doesn't happen, but if it does I restart it
> again and it finally works.
>
> Any ideas as to what's happening and if there are any workarounds?
>
> Thanks,
> Aaron
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110929/12c344be/attachment.htm>

From aaron at contextlogic.com  Thu Sep 29 20:23:30 2011
From: aaron at contextlogic.com (Aaron Voelker)
Date: Thu, 29 Sep 2011 12:23:30 -0700 (PDT)
Subject: [rabbitmq-discuss] Pika problem,
 channel starts consuming before I call start_consuming(),
 then raises Queue.DeclareOk KeyError
In-Reply-To: <CAM8fPiQR_uBOi0C_O9T8nj1By_AL-OS4o=Kaej3Bb=__OZv3Lg@mail.gmail.com>
References: <bb90fe31-c3e3-4bca-a6f2-6912a9ac517f@br5g2000vbb.googlegroups.com>
	<1ce1b961-7162-4b70-8aff-9ce6a31716fb@s16g2000yqc.googlegroups.com>
	<CAM8fPiQR_uBOi0C_O9T8nj1By_AL-OS4o=Kaej3Bb=__OZv3Lg@mail.gmail.com>
Message-ID: <7a2b3479-c4e4-48b4-89aa-ce4fde2d557e@d17g2000yqa.googlegroups.com>

For those interested, replacing my BlockingConnection with a
TornadoConnection solved this problem. I have been using this as a
workaround for a couple days and haven't had any more issues.

On Sep 21, 4:38?pm, Tony Garnock-Jones <tonygarnockjones
+rabbi... at gmail.com> wrote:
> On 21 September 2011 19:31, Aaron Voelker <aa... at contextlogic.com> wrote:
>
> > Wasn't able to find where to post issues before (wasn't listed on
> >http://tonyg.github.com/pika/). Sorry for the cross-post.
>
> Hmm! Those pages shouldn't be there anymore.http://pika.github.com/is the
> new URL. Your point still stands about there not being any pointers to the
> GH issue tracker, of course :-)
>
> Regards,
> ? Tony
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From allen.kim at epicadvertising.com  Thu Sep 29 21:47:11 2011
From: allen.kim at epicadvertising.com (Allen Kim)
Date: Thu, 29 Sep 2011 15:47:11 -0500
Subject: [rabbitmq-discuss] Is there a channel publish throughput limit to a
	queue?
Message-ID: <CAAA518F.CD1D%allen.kim@epicadvertising.com>

I have published 2000 messages per second for 30 minutes to rabbitmq.

All message have been published successfully.

After 30 minutes of my test,  I look at the Web UI and found out that a lot of messages are still being consumed.

I increased the number of consumers, but it did not help.

I checked the channel, and found out that the channel was still publishing to a queue.

The speed of publishing was around 700/s to 800/s, which is definitely not 2000/s.

I was wondering if there is limit that affects publishing speed.

Is there any? Or any other way to make this faster.

Allen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110929/b4cc6c0b/attachment.htm>

From tim at rabbitmq.com  Thu Sep 29 22:58:25 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Thu, 29 Sep 2011 22:58:25 +0100
Subject: [rabbitmq-discuss] SockJS protocol documentation?
In-Reply-To: <CAE3HoVRceJK9se_L4okJxNqqR8_fYc_LSSoKrgiiF8xpgvNAkQ@mail.gmail.com>
References: <CAE3HoVSyQoBOy3jF5eEnuCY1MVtO_LbAV0kVaaEjCajiPR6G5w@mail.gmail.com>
	<CACOPnveuuu0aRBC+9m16q5KpSuczZ-pmUc-zqQrt_tLkj=tFGw@mail.gmail.com>
	<CAE3HoVRceJK9se_L4okJxNqqR8_fYc_LSSoKrgiiF8xpgvNAkQ@mail.gmail.com>
Message-ID: <4E84EA01.3030801@rabbitmq.com>

On 14/09/2011 12:35, Michael Klishin wrote:
>
>
> 2011/9/14 Alexis Richardson <alexis at rabbitmq.com 
> <mailto:alexis at rabbitmq.com>>
>
>     I think that would be great
>
>
>     Have you looked at node.x?  That might be a good place to do some
>     hacking....
>
>     https://github.com/purplefox/node.x
>
>     Or (eg)
>     https://github.com/purplefox/node.x/blob/master/src/examples/java/org/nodex/java/examples/websockets/WebsocketsExample.java
>
>
> Alexis,
>
> I am aware of Node.x. My plan right now is to use Netty directly but 
> thanks for the suggestion. I don't have enough understanding of the 
> existing implementation to really judge if Node.x or libraries like 
> Aleph and Finagle will really help me over plain Netty, we will see.

We plan to implement sock-js in node.x anyway.

>
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110929/5ba3d20a/attachment.htm>

From raphael at rightscale.com  Fri Sep 30 01:29:13 2011
From: raphael at rightscale.com (Raphael Simon)
Date: Thu, 29 Sep 2011 17:29:13 -0700
Subject: [rabbitmq-discuss] Number of connections and memory usage
In-Reply-To: <4E7CDB6D.1080902@rabbitmq.com>
References: <CAD7X3-nscg5ZB_A2V_PYNs271FC+hQVQQxTynsMj8BhibOZvXA@mail.gmail.com>
	<4E7CDB6D.1080902@rabbitmq.com>
Message-ID: <CAD7X3-kXKHCqPVBW0PkUXZRunMGE3B_put+9zAY3S7qmx5vrwg@mail.gmail.com>

Thank you Matthias. We deployed that config to production but haven't seen
any real change... How can we tell if RabbitMQ is indeed using these
settings?

Thanks!

--
Raphael.

On Fri, Sep 23, 2011 at 12:18 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Raphael,
>
>
> On 23/09/11 19:11, Raphael Simon wrote:
>
>> We are using RabbitMQ 2.4 in our production environment and are running
>> into issues with memory usage. We are seeing a direct relation between
>> the number of connections and the memory usage (the graphs are
>> identical). The ratio is 200 KB / connection which seems hefty
>> especially with about 50,000 connections open on each broker this ends
>> up consuming all the ram.
>> [...]
>>
>> I'm wondering if there is a setting somewhere that can be tweaked
>>
>
> Reduce the socket send and receive buffer sizes by sticking the following
> in your rabbitmq.config:
>
> [{rabbit, [{tcp_listen_options, [binary,
>                                 {packet,        raw},
>                                 {reuseaddr,     true},
>                                 {backlog,       128},
>                                 {nodelay,       true},
>                                 {sndbuf,        1024},
>                                 {recbuf,        1024},
>                                 {exit_on_close, false}]}]}].
>
> (All but the sndbuf and recbuf settings are identical to the defaults)
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110929/27ac145a/attachment.htm>

From burtprior at comcast.net  Fri Sep 30 06:00:31 2011
From: burtprior at comcast.net (Burt Prior)
Date: Thu, 29 Sep 2011 22:00:31 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ, Gretty, and Channel question
In-Reply-To: <4E84B247.6050200@rabbitmq.com>
References: <514AA77F91B54501AE6EBA421AC81833@BurtPriorPC>
	<CANBeYQTRHkZTOo4uWAk9iQ+Vy_zA3DAX0eyZ025nPWMjSjg+vA@mail.gmail.com>
	<2921fabf-09cf-4955-b63e-8bdcbd2095b5@t11g2000yqk.googlegroups.com>
	<CANBeYQRHfr=otG1KVNX929R4uu1PFY5u_+R1MkuEyt5MW-Qgkw@mail.gmail.com>
	<c0ffc439-8304-4a99-bccd-a6cbf6fbda4c@8g2000yqm.googlegroups.com>
	<CANBeYQQyU1o0PiuomY-4zd-iHccFjm4EgX3_o2RsPEm=g+_2jA@mail.gmail.com>
	<b661c48e-e858-4b5a-9b03-12fd63d757a5@db5g2000vbb.googlegroups.com>
	<4E84B247.6050200@rabbitmq.com>
Message-ID: <a2c6c279-adf5-4ed1-ab21-44cc5951e183@k34g2000yqm.googlegroups.com>

Hi Tim,

WOW!  This project is awesome!  This is exactly what we developers
need.
If I could vote, please prioritize a RabbitMQ plugin, and a Groovy
DSL.

Can't wait to try this and future versions out!

Thanks for the great work,
Burt


On Sep 29, 11:00?am, Tim Fox <t... at rabbitmq.com> wrote:
> Burt - have you looked at node.x :https://github.com/purplefox/node.x?
>
> This is a new Rabbit/VMW project which you can think of as "node.js for
> JVM languages". It currently supports Java and Ruby and we are in the
> process of writing a Groovy API.
>
> As well as supporting protocols such as TCP, HTTP, websockets etc, out
> of the box, it will have plugins for AMQP, Redis and many others.
>
> On 29/09/11 17:38, Burt Prior wrote:
>
>
>
>
>
>
>
>
>
> > Hi Peter!
>
> > Outstanding! ?You can see the issue! ?This is absolutely great!
>
> > I was actually thinking that using Gretty as a lightweight web service
> > endpoint with RabbitMQ was a perfect use case for Gretty, and as a
> > viable alternative to Node.js ?(I can write Groovy and not
> > Javascript!)
>
> > I think Gretty is awesome if we can get this use case with RabbitMQ
> > working correctly.
> > Would you have any thoughts on what next steps to resolve this issue
> > with Gretty would be?
> > Would you know of anyone else we could ask? ?I learned about Gretty
> > from Andrew Glover's article here:
> >http://www.ibm.com/developerworks/java/library/j-javadev2-20/index.html
>
> > Thanks again for your help,
> > Burt Prior
>
> > On Sep 29, 1:34 am, Peter Ledbrook<pe... at cacoethes.co.uk> ?wrote:
> >>> Thanks again for your great reply. ?I was quite surprised when I saw
> >>> this, and I realized I needed to reach out and understand what is
> >>> happening before I propose Gretty + RabbitMQ for production use.
> >> I can't get ab working against the Gretty server because it keeps
> >> throwing exceptions. Anyway, from a single browser hit I can see two
> >> messages being added to the queue. And if I add a println before the
> >> publish, I see the message printed out twice. That suggests Gretty is
> >> doing something odd.
>
> >> Peter
>
> >> --
> >> Peter Ledbrook
> >> Grails Advocate
> >> SpringSource - A Division of VMware
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.com
> >https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From tim at rabbitmq.com  Fri Sep 30 07:20:23 2011
From: tim at rabbitmq.com (Tim Fox)
Date: Fri, 30 Sep 2011 07:20:23 +0100
Subject: [rabbitmq-discuss] RabbitMQ, Gretty, and Channel question
In-Reply-To: <a2c6c279-adf5-4ed1-ab21-44cc5951e183@k34g2000yqm.googlegroups.com>
References: <514AA77F91B54501AE6EBA421AC81833@BurtPriorPC>	<CANBeYQTRHkZTOo4uWAk9iQ+Vy_zA3DAX0eyZ025nPWMjSjg+vA@mail.gmail.com>	<2921fabf-09cf-4955-b63e-8bdcbd2095b5@t11g2000yqk.googlegroups.com>	<CANBeYQRHfr=otG1KVNX929R4uu1PFY5u_+R1MkuEyt5MW-Qgkw@mail.gmail.com>	<c0ffc439-8304-4a99-bccd-a6cbf6fbda4c@8g2000yqm.googlegroups.com>	<CANBeYQQyU1o0PiuomY-4zd-iHccFjm4EgX3_o2RsPEm=g+_2jA@mail.gmail.com>	<b661c48e-e858-4b5a-9b03-12fd63d757a5@db5g2000vbb.googlegroups.com>	<4E84B247.6050200@rabbitmq.com>
	<a2c6c279-adf5-4ed1-ab21-44cc5951e183@k34g2000yqm.googlegroups.com>
Message-ID: <4E855FA7.9040107@rabbitmq.com>

Thanks Burt,

We agree there is a huge appetite for a project like this too :)

The Groovy API is already being worked on, if you'd like to join in the 
discussion, you can here http://groups.google.com/group/nodex-dev

A Rabbit/AMQP client is very high on the priority list too.

On 30/09/11 06:00, Burt Prior wrote:
> Hi Tim,
>
> WOW!  This project is awesome!  This is exactly what we developers
> need.
> If I could vote, please prioritize a RabbitMQ plugin, and a Groovy
> DSL.
>
> Can't wait to try this and future versions out!
>
> Thanks for the great work,
> Burt
>
>
> On Sep 29, 11:00 am, Tim Fox<t... at rabbitmq.com>  wrote:
>> Burt - have you looked at node.x :https://github.com/purplefox/node.x?
>>
>> This is a new Rabbit/VMW project which you can think of as "node.js for
>> JVM languages". It currently supports Java and Ruby and we are in the
>> process of writing a Groovy API.
>>
>> As well as supporting protocols such as TCP, HTTP, websockets etc, out
>> of the box, it will have plugins for AMQP, Redis and many others.
>>
>> On 29/09/11 17:38, Burt Prior wrote:
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>> Hi Peter!
>>> Outstanding!  You can see the issue!  This is absolutely great!
>>> I was actually thinking that using Gretty as a lightweight web service
>>> endpoint with RabbitMQ was a perfect use case for Gretty, and as a
>>> viable alternative to Node.js  (I can write Groovy and not
>>> Javascript!)
>>> I think Gretty is awesome if we can get this use case with RabbitMQ
>>> working correctly.
>>> Would you have any thoughts on what next steps to resolve this issue
>>> with Gretty would be?
>>> Would you know of anyone else we could ask?  I learned about Gretty
>>> from Andrew Glover's article here:
>>> http://www.ibm.com/developerworks/java/library/j-javadev2-20/index.html
>>> Thanks again for your help,
>>> Burt Prior
>>> On Sep 29, 1:34 am, Peter Ledbrook<pe... at cacoethes.co.uk>    wrote:
>>>>> Thanks again for your great reply.  I was quite surprised when I saw
>>>>> this, and I realized I needed to reach out and understand what is
>>>>> happening before I propose Gretty + RabbitMQ for production use.
>>>> I can't get ab working against the Gretty server because it keeps
>>>> throwing exceptions. Anyway, from a single browser hit I can see two
>>>> messages being added to the queue. And if I add a println before the
>>>> publish, I see the message printed out twice. That suggests Gretty is
>>>> doing something odd.
>>>> Peter
>>>> --
>>>> Peter Ledbrook
>>>> Grails Advocate
>>>> SpringSource - A Division of VMware
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Fri Sep 30 07:32:53 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 30 Sep 2011 07:32:53 +0100
Subject: [rabbitmq-discuss] Number of connections and memory usage
In-Reply-To: <CAD7X3-kXKHCqPVBW0PkUXZRunMGE3B_put+9zAY3S7qmx5vrwg@mail.gmail.com>
References: <CAD7X3-nscg5ZB_A2V_PYNs271FC+hQVQQxTynsMj8BhibOZvXA@mail.gmail.com>	<4E7CDB6D.1080902@rabbitmq.com>
	<CAD7X3-kXKHCqPVBW0PkUXZRunMGE3B_put+9zAY3S7qmx5vrwg@mail.gmail.com>
Message-ID: <4E856295.4040908@rabbitmq.com>

Raphael,

On 30/09/11 01:29, Raphael Simon wrote:
> Thank you Matthias. We deployed that config to production but haven't
> seen any real change... How can we tell if RabbitMQ is indeed using
> these settings?

See http://www.rabbitmq.com/configure.html#verify-configuration

When rabbit starts up it tells you what config file it is using, e.g.

+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
| v%%VSN%%  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at i
app descriptor : 
/home/matthias/projects/rabbitmq-umbrella/rabbitmq-server/scripts/../ebin/rabbit.app
home dir       : /home/matthias
config file(s) : (none)
cookie hash    : FtUD/+++wj4PBf6gRlNEsA==
log            : /tmp/rabbit at i.log
sasl log       : /tmp/rabbit at i-sasl.log
database dir   : /tmp/rabbitmq-rabbit-mnesia
erlang version : 5.8.4


Note the "config files" line above - in your case that should contain 
the filename of the config file.


Matthias.

From nick at faceture.com  Fri Sep 30 00:29:29 2011
From: nick at faceture.com (Nick Martin)
Date: Thu, 29 Sep 2011 16:29:29 -0700 (PDT)
Subject: [rabbitmq-discuss] Install RabbitMQ 2.6.1 with management plugin on
	Amazon Linux 32-bit?
Message-ID: <4e091abd-45c9-4823-b13d-0385a19587eb@u6g2000vbo.googlegroups.com>

I am trying to get the latest version of RabbitMQ (v 2.6.1) to install
and run on Amazon Linux 32-bit (which is based on CentOS, see
http://ec2-downloads.s3.amazonaws.com/AmazonLinuxAMIUserGuide.pdf). So
far I have been unsuccessful and would like some help figuring it out.

RabbitMQ 2.6.1 requires Erlang version of at least R12B-3.
The management plugin requires a newer version of Erlang, R13B01 (see
http://www.rabbitmq.com/management.html#erlang).

Amazon Linux is not properly configured to install Erlang using the
yum package manager. When I run "yum install erlang" it resulted in
this output:

Loaded plugins: fastestmirror, priorities, security
Loading mirror speeds from cached hostfile
amzn-main | 2.1 kB 00:00
amzn-updates | 2.1 kB 00:00
Setting up Install Process
No package erlang available.
Error: Nothing to do

Since the package manager route didn't work, I tried downloading the
source for Erlang and build and install it myself. I followed the
instructions from this web page http://erlangexamples.com/2010/04/30/building-erlang-b13r04-in-centos-5-4/.
The instructions:
sudo yum -y install make gcc gcc-c++ kernel-devel m4 ncurses-devel
openssl-devel
wget http://www.erlang.org/download/otp_src_R13B04.tar.gz
tar xfvz otp_src_R13B04.tar.gz
cd otp_src_R13B04/
./configure --with-ssl
sudo make install

Following those instructions, I built and installed Erlang
successfully.

I tried to "yum install rabbitmq" as well, but that too was not found.
Instead I downloaded the RabbitMQ RPM and attempted to install it like
so:
wget http://www.rabbitmq.com/releases/rabbitmq-server/v2.6.1/rabbitmq-server-2.6.1-1.noarch.rpm
rpm -Uvh rabbitmq-server-2.6.1-1.noarch.rpm

the rpm command results in this output:
error: Failed dependencies:
erlang >= R12B-3 is needed by rabbitmq-server-2.6.1-1.noarch

For some reason, even though I built and installed Erlang R13B04, the
RabbitMQ package can't see it. Any suggestions on why it doesn't know
Erlang is installed?

Is this even the best way to go about getting RabbitMQ 2.6.1 plus the
management plugin installed? Is there another approach I should
consider?

Thanks,
Nick

From simon at rabbitmq.com  Fri Sep 30 11:23:11 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 30 Sep 2011 11:23:11 +0100
Subject: [rabbitmq-discuss] Install RabbitMQ 2.6.1 with management
 plugin on	Amazon Linux 32-bit?
In-Reply-To: <4e091abd-45c9-4823-b13d-0385a19587eb@u6g2000vbo.googlegroups.com>
References: <4e091abd-45c9-4823-b13d-0385a19587eb@u6g2000vbo.googlegroups.com>
Message-ID: <4E85988F.1020503@rabbitmq.com>

On 30/09/11 00:29, Nick Martin wrote:
> For some reason, even though I built and installed Erlang R13B04, the
> RabbitMQ package can't see it. Any suggestions on why it doesn't know
> Erlang is installed?

rpm only recognises things being installed if they were installed via 
rpm - otherwise they're just a bunch of files on the disk as far as it's 
concerned.

Ideally you would install Erlang from rpms too; see the instructions 
under "RPM-based Linux" at http://www.rabbitmq.com/server.html. But 
having seen your post on the AWS forums I don't think that works due to 
the standard Amazon Linux not having various UI libraries and the Erlang 
package being compiled to depend on them.

So I think you have a few options:

* Install RabbitMQ from the generic Unix tarball rather than RPM.

Downsides: you'll need to fiddle around to get it running as a service; 
nothing will be done for you.

* Keep tracking down rpms until all dependencies are satisfied.

Downsides: sounds like a pain.

* Tell rpm to install RabbitMQ anyway (with I think --nodeps or similar)

Downsides: you're telling rpm to ignore the dependency information it 
has. Inelegant, to say the least.

* Start again with an AMI of CentOS or (better still IMNSHO) Debian / 
Ubuntu.

Downsides: you have to start again.

If it were me I'd do the last one.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From lemenkov at gmail.com  Fri Sep 30 11:34:43 2011
From: lemenkov at gmail.com (Peter Lemenkov)
Date: Fri, 30 Sep 2011 14:34:43 +0400
Subject: [rabbitmq-discuss] Install RabbitMQ 2.6.1 with management
 plugin on Amazon Linux 32-bit?
In-Reply-To: <4e091abd-45c9-4823-b13d-0385a19587eb@u6g2000vbo.googlegroups.com>
References: <4e091abd-45c9-4823-b13d-0385a19587eb@u6g2000vbo.googlegroups.com>
Message-ID: <CANDpMDtHEBUBJvGnAQL5DFBdLQf-fabh06kTyBwoUxzzR3LxFQ@mail.gmail.com>

Hello!

2011/9/30 Nick Martin <nick at faceture.com>:

> RabbitMQ 2.6.1 requires Erlang version of at least R12B-3.
> The management plugin requires a newer version of Erlang, R13B01 (see
> http://www.rabbitmq.com/management.html#erlang).
>
> Amazon Linux is not properly configured to install Erlang using the
> yum package manager. When I run "yum install erlang" it resulted in
> this output:
>
> Loaded plugins: fastestmirror, priorities, security
> Loading mirror speeds from cached hostfile
> amzn-main | 2.1 kB 00:00
> amzn-updates | 2.1 kB 00:00
> Setting up Install Process
> No package erlang available.
> Error: Nothing to do

Erlang is available through the external repository (EPEL).
Unfortunately due to the some shortcomings in the default Amazon's
repositories this won't work either (unless you enable generic RHEL
/CentOS /SL repositories manually).

> For some reason, even though I built and installed Erlang R13B04, the
> RabbitMQ package can't see it. Any suggestions on why it doesn't know
> Erlang is installed?

Either

a) Enable RHEL / CentOS / SL repositories and EPEL and repeat again
b) Rebuild RabbitMQ from sources as well as Erlang/OTP.

-- 
With best regards, Peter Lemenkov.

From majek04 at gmail.com  Fri Sep 30 12:43:54 2011
From: majek04 at gmail.com (Marek Majkowski)
Date: Fri, 30 Sep 2011 12:43:54 +0100
Subject: [rabbitmq-discuss] No IOException from basicPublish when
 connection is lost
In-Reply-To: <OF66564312.1A0944EC-ONC1257919.0045C0F7-C1257919.004CE23A@Schneider-Electric.com>
References: <OF66564312.1A0944EC-ONC1257919.0045C0F7-C1257919.004CE23A@Schneider-Electric.com>
Message-ID: <CABzX+qxSFy0v2YsnFR2FE1z6-n9ETYj_OhQxx0_diu0yt1FSKA@mail.gmail.com>

On Wed, Sep 28, 2011 at 14:59,
<mikael.beauvois at non.schneider-electric.com> wrote:
> I have a problem when I call the basicPublish method defined in the Channel
> interface.
>
> In my client, I create a Connection using the ConnectionFactory
> (com.rabbitmq.client.ConnectionFactory) to the broker running on a remote
> host (connected in the local network). Then I create a Channel from this
> Connection.
> I call the basicPublish method in a loop (waiting 10s between each publish).
> During the test, I unplug the network cable from the client running on the
> local host.

RabbitMQ uses AMQP. AMQP uses TCP.

Tcp is a protocol that tries to do best to detect failures, but it's done
using timeouts.

For example, from an idle tcp connection point of view, it's
completely valid that you will
unplug the network cable, wait for a day, and plug it back again.

If you unplug a network cable when tcp connection is transmitting data,
tcp will retry sending over a period of time and will eventually fail.
But this is going to take some time.

> The basicPublish method doesn't throw any exception (I expected at least
> IOException because the network connection is lost).

If you unplug the network cable - the link is lost. The TCP connection
is not lost until tcp gives up retransmitting.

> All calls to
> basicPublish method in the loop never raise the IOException exception (or
> any other exception). Obviously, the broker never received the messages sent
> after loosing the network connection.
>
> A ShutdownListener has been implemented but the shutdownCompleted method is
> called by the RabbitMQ java client stack around 15 minutes after unplugging
> the network cable.
>
> I also tested the disconnection using the command line in a terminal. The
> results are the same.

What do you mean?

> I am running RabbitMQ broker 2.6.1 with the RabbitMQ java client , Linux
> Ubuntu 11.04 with kernel 2.6.38-11 (x86) and I tested my code with 2 JVM
> (OpenJDK and Java HotSpot 1.6.0 (build 1.6.0_27-b07)).
>
> Please, could you help me?

If you want to force tcp connection to be closed quicker, take a look
at tcp heatbeats and/or AMQP keepalive feature.

Cheers,
    Marek

From acheremukhin.digitalguard at gmail.com  Fri Sep 30 13:18:52 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Fri, 30 Sep 2011 05:18:52 -0700 (PDT)
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <9571588.1030.1317385132969.JavaMail.geo-discussion-forums@yqbu18>

Hello all.
I've rabbitmq instance and queue. I'm seeing current statistics

$curl -i -u guest:guest 
http://ksn-fft-fe-1.kaspersky-labs.com:55672/api/queues
[{"owner_pid_details":{"name":"91.103.66.206:48137","peer_address":"91.103.66.206","peer_port":48137},"exclusive_consumer_tag":"",
*"messages_ready":2187622*,"messages_unacknowledged":0,*
"messages":2187622,"consumers":1*
,"memory":2586763120,"slave_nodes":[],"backing_queue_status":{"q1":0,"q2":0,"delta":["delta","undefined",0,"undefined"],"q3":1417116,"q4":770506,"len":2187622,"pending_acks":0,"target_ram_count":596243,"ram_msg_count":770506,"ram_ack_count":0,"ram_index_count":549212,"next_seq_id":2356260,"persistent_count":0,"avg_ingress_rate":11.330325297614847,"avg_egress_rate":184.56503576904186,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},"message_stats":{"deliver_get":169016,"deliver_get_details":{"rate":246.99210729543273,"interval":5433372,"last_event":1317384971819},"deliver_no_ack":169016,"deliver_no_ack_details":{"rate":246.99210729543273,"interval":5433372,"last_event":1317384971819},"publish":2617514,"publish_details":{"rate":2040.089640787078,"interval":5001741,"last_event":1317384970467}},"name":"rabbitmq.queue.statistics.0.0.0.0.48931.0x80136a0e0","vhost":"/","durable":false,"auto_delete":false,"arguments":{},"node":"rabbit at ksn-fft-fe-1"}]

Does bold text mean that my 1 consumer have not time to get all message?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110930/51730575/attachment.htm>

From acheremukhin.digitalguard at gmail.com  Fri Sep 30 13:20:57 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Fri, 30 Sep 2011 05:20:57 -0700 (PDT)
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <32420913.455.1317385257776.JavaMail.geo-discussion-forums@yqnv12>

Hello all.
I've rabbitmq instance and queue. I'm seeing current statistics

$curl -i -u guest:guest <...>:55672/api/queues<http://ksn-fft-fe-1.kaspersky-labs.com:55672/api/queues>
[{"owner_pid_details":{"name":
"91.103.66.206:48137
","peer_address":"91.103.66.206","peer_port":48137},"exclusive_consumer_tag":"",
*"messages_ready":2187622*,"messages_unacknowledged":0,*
"messages":2187622,"consumers":1*
,"memory":2586763120,"slave_nodes":[],"backing_queue_status":{"q1":0,"q2":0,"delta":["delta","undefined",0,"undefined"],"q3":1417116,"q4":770506,"len":2187622,"pending_acks":0,"target_ram_count":596243,"ram_msg_count":770506,"ram_ack_count":0,"ram_index_count":549212,"next_seq_id":2356260,"persistent_count":0,"avg_ingress_rate":11.330325297614847,"avg_egress_rate":184.56503576904186,"avg_ack_ingress_rate":0.0,"avg_ack_egress_rate":0.0},"message_stats":{"deliver_get":169016,"deliver_get_details":{"rate":246.99210729543273,"interval":5433372,"last_event":1317384971819},"deliver_no_ack":169016,"deliver_no_ack_details":{"rate":246.99210729543273,"interval":5433372,"last_event":1317384971819},"publish":2617514,"publish_details":{"rate":2040.089640787078,"interval":5001741,"last_event":1317384970467}},"name":"rabbitmq.queue.statistics.0.0.0.0.48931.0x80136a0e0","vhost":"/","durable":false,"auto_delete":false,"arguments":{},"node":"rabbit at ksn-fft-fe-1"}]

Does bold text mean that my 1 consumer have not time to get all message?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110930/05358ff3/attachment.htm>

From simon at rabbitmq.com  Fri Sep 30 13:22:24 2011
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 30 Sep 2011 13:22:24 +0100
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <9571588.1030.1317385132969.JavaMail.geo-discussion-forums@yqbu18>
References: <9571588.1030.1317385132969.JavaMail.geo-discussion-forums@yqbu18>
Message-ID: <4E85B480.5060109@rabbitmq.com>

On 30/09/11 13:18, Cheremukhin Andrey wrote:
> Does bold text mean that my 1 consumer have not time to get all message?

Presumably, yes. If your queue is backing up then your consumer must not 
be consuming fast enough.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From acheremukhin.digitalguard at gmail.com  Fri Sep 30 13:31:49 2011
From: acheremukhin.digitalguard at gmail.com (Cheremukhin Andrey)
Date: Fri, 30 Sep 2011 05:31:49 -0700 (PDT)
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <32420913.455.1317385257776.JavaMail.geo-discussion-forums@yqnv12>
References: <32420913.455.1317385257776.JavaMail.geo-discussion-forums@yqnv12>
Message-ID: <1829082.840.1317385909498.JavaMail.geo-discussion-forums@yqgn17>

I'm asking because really my consumer gets ALL messages, but rabbitmq has 
other statistics.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110930/45291d11/attachment.htm>

From maxjwarnock at gmail.com  Fri Sep 30 13:57:40 2011
From: maxjwarnock at gmail.com (Max Warnock)
Date: Fri, 30 Sep 2011 08:57:40 -0400
Subject: [rabbitmq-discuss] Frequently getting {badmatch, {error,
 einval} from one of my rabbimq nodes
In-Reply-To: <CAApCF467P8bPu41NPzmNpxnvNFc8bgNiaRZbXVdD1=19PvW4HA@mail.gmail.com>
References: <bb1ddfc2-0886-485e-8a02-09434ce92c53@t8g2000prm.googlegroups.com>
	<20110720211414.GB12886@dakota>
	<73926954-e458-4bc2-90e6-a490c69ce8f3@v11g2000prn.googlegroups.com>
	<67be1e43-db8e-4069-9354-502a1c04d294@p29g2000pre.googlegroups.com>
	<20110727163850.GC3188@dakota.eng.vmware.com>
	<CAApCF467P8bPu41NPzmNpxnvNFc8bgNiaRZbXVdD1=19PvW4HA@mail.gmail.com>
Message-ID: <CAApCF472FzOurxA2G1wRJakmSoxi_JfrLamNd_jLgOE74Bp9zg@mail.gmail.com>

Has anyone had any more thoughts on this? I'm still getting this error and
it's making my software queue up about 10 for every 100,000 messages in the
unacked queue. If I restart my server it will process those messages just
fine.
-Max

On Thu, Aug 18, 2011 at 4:26 PM, Max Warnock <maxjwarnock at gmail.com> wrote:

> I have been getting the same error, you're not crazy Chak.  The exact
> message for me is:
>
> =ERROR REPORT==== 18-Aug-2011::16:17:35 ===
> ** Generic server <0.28256.0> terminating
> ** Last message in was {inet_async,#Port<0.29961>,47384,
>                                    {ok,<<0,10,0,51,206>>}}
> ** When Server state == {state,#Port<0.29961>,<0.28252.0>,<0.28253.0>,
>                                {method,rabbit_framing_amqp_0_9_1},
>                                {1,0,4}}
> ** Reason for termination ==
> ** {{badmatch,{error,einval}},
>     [{amqp_main_reader,handle_inet_async,2},
>      {gen_server,handle_msg,5},
>      {proc_lib,init_p_do_apply,3}]}
>
> I get this when I have a large number of messages going over a single
> connection and channel (topic exchange, subscription based pulling).  I'm
> running
> Erlang R13B04 (erts-5.7.5).
>
> Regards,
> -Max
>
>
> On Wed, Jul 27, 2011 at 12:38 PM, Alexandru Scvor?ov <
> alexandru at rabbitmq.com> wrote:
>
>> Hi Chak,
>>
>> I've been trying for a while, but I can't reproduce this.
>>
>> That error is coming from deep inside Erlang's inet driver.  As far as I
>> can tell, the only way to get that error would be to call
>> prim_inet:async_recv/3 on a socket with a {packet, Packet} setting
>> different from 'raw'.  But this can't happen on any version of rabbit.
>>
>> Could you give us a more detailed description of the program?  Is it a
>> plugin?  Is it doing anything special with the connection? (like setting
>> socket options after the connection is established) Is there any chance
>> we could see the code?
>>
>> You mentioned it starts at the very beginning.  Does this mean the
>> problem goes away after some time?
>>
>> Cheers,
>> Alex
>>
>>
>> On Thu, Jul 21, 2011 at 07:48:29PM -0700, Chak Hedik wrote:
>> > Hi Alex,
>> >
>> > Seems like this error is still there and it seems like either it
>> > occurred when worker entering the loop and send another message to the
>> > same queue within the loop or occurred when function retry, means
>> > function call itself for a retry (pretty much like loop also).
>> >
>> > Thanks,
>> > Chak
>> >
>> > On Jul 21, 6:40 am, Chak Hedik <chakhe... at gmail.com> wrote:
>> > > Hi Alex,
>> > >
>> > > *Ubuntu Server 11.04 64-Bit
>> > > *RabbitMQ 2.3.1 (Default ubuntu package)
>> > > *Erlang Client 2.3.1 (Default ubuntu package)
>> > > *Erlang R13B03 (Default ubuntu package)
>> > >
>> > > Is there something in the server logs that corresponds to this error?
>> > > - That's the only thing appeared in the logs.
>> > >
>> > > You say your other nodes don't have similar issues.  Is there
>> > > something
>> > > special about this node?
>> > > - Nothing special, pretty much the same but handle more messages than
>> > > others. 1 worker handling 1 queue.
>> > >
>> > > It is strange behaviour and it happen at the very beginning where the
>> > > worker up for the first time (no message in queue yet). I've created
>> > > another node and put this worker there and will wait and see if
>> > > similar error appear again or not today.
>> > >
>> > > Thanks for your reply.
>> > >
>> > > Chak
>> > >
>> > > On Jul 21, 5:14 am, Alexandru Scvor?ov <alexan... at rabbitmq.com>
>> wrote:
>> > >
>> > >
>> > >
>> > >
>> > >
>> > >
>> > >
>> > > > Hi Chak,
>> > >
>> > > > Could you please answer the following questions:
>> > > > * What OS are you using?
>> > > > * What version of RabbitMQ?
>> > > > * What version of the Erlang client?
>> > > > * What version of Erlang?
>> > >
>> > > > > ** Reason for termination ==
>> > > > > ** {{badmatch,{error,einval}},
>> > > > >     [{amqp_main_reader,handle_inet_async,2},
>> > > > >      {gen_server,handle_msg,5},
>> > > > >      {proc_lib,init_p_do_apply,3}]}
>> > >
>> > > > Looks like something strange is taking down the socket, which in
>> turn is
>> > > > taking down the entire connection.  If you have more than one
>> > > > connection, the others should be fine.
>> > >
>> > > > Is there something in the server logs that corresponds to this
>> error?
>> > >
>> > > > You say your other nodes don't have similar issues.  Is there
>> something
>> > > > special about this node?
>> > >
>> > > > Cheers,
>> > > > Alex
>> > >
>> > > > On Wed, Jul 20, 2011 at 12:12:32AM -0700, Chak Hedik wrote:
>> > > > > Hi,
>> > >
>> > > > > I frequently getting this terminating error from one of my nodes :
>> > >
>> > > > > ** Generic server <0.28067.2> terminating
>> > > > > ** Last message in was {inet_async,#Port<0.15349>,9049,
>> > > > > {ok,<<0,10,0,51,206>>}}
>> > > > > ** When Server state ==
>> {state,#Port<0.15349>,<0.28063.2>,<0.28064.2>,
>> > > > >                                {method,rabbit_framing_amqp_0_9_1},
>> > > > >                                {1,0,4}}
>> > > > > ** Reason for termination ==
>> > > > > ** {{badmatch,{error,einval}},
>> > > > >     [{amqp_main_reader,handle_inet_async,2},
>> > > > >      {gen_server,handle_msg,5},
>> > > > >      {proc_lib,init_p_do_apply,3}]}
>> > >
>> > > > > While several other nodes with the same setup didn't have the same
>> > > > > issue. May I know what it means and willl it affect my queues?How
>> do I
>> > > > > fix this?
>> > >
>> > > > > Thank,
>> > > > > Chak
>> > > > > _______________________________________________
>> > > > > rabbitmq-discuss mailing list
>> > > > > rabbitmq-disc... at lists.rabbitmq.com
>> > > > >
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> > >
>> > > > _______________________________________________
>> > > > rabbitmq-discuss mailing list
>> > > > rabbitmq-disc... at lists.rabbitmq.comhttps://
>> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> > >
>> > > _______________________________________________
>> > > rabbitmq-discuss mailing list
>> > > rabbitmq-disc... at lists.rabbitmq.comhttps://
>> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110930/68f1a36b/attachment.htm>

From steve.rehrauer at gmail.com  Fri Sep 30 18:31:23 2011
From: steve.rehrauer at gmail.com (Steve Rehrauer)
Date: Fri, 30 Sep 2011 13:31:23 -0400
Subject: [rabbitmq-discuss] =?windows-1252?q?=93Unknown_delivery_tag=94_fr?=
	=?windows-1252?q?om_RabbitMQ_when_ack=27ing_a_message_in_a_cluster?=
	=?windows-1252?q?_with_replicated_queues?=
Message-ID: <CADUq8CzvicMWNLfWwunuyxbF1X5BqYBTFjgGpE0uLxKqsscGkQ@mail.gmail.com>

We've been using Rabbit successfully for about a year. Recently have
upgraded to v2.6.1, because we want to use clusters with replicated
message queues.

My testing has hit a puzzling behavior that smells like a Rabbit bug
to me. The test that uncovers this is working with a two-node cluster.
Both nodes are running v2.6.1. Both nodes have disk. Both nodes are
running on Mac OS, though I doubt this is pertinent.

I'm also running Alice on the node that runs the test. The test uses
it to programmatically do a stop_app on one of the nodes, because the
test is trying to validate that if the cluster master fails, and a
slave is elevated to take its place, that we don't lose messages.

So, the test has a small thread pool, which is given tasks that
periodically 1) publish messages, and 2) toggle the state of the
Rabbit master node (stopped if running; started if stopped). Other
threads are consuming messages from queues.

I'm using publisher confirms, and I'm also acknowledging the messages
in the consumers (using autoAck=false for channel.basicConsume()).

When the master node is stopped, I see both the producers and
consumers catching ShutdownSignalException. They handle this by
attempting to reconnect to the cluster. This works fine. When
reconnected, they continue with their business.

Sometimes, what I see is that a consumer has successfully fetched a
message from the broker, and is calling channel.basicAck() when it
gets that ShutdownSignalException.

Later, when the consumer has reconnected, it again pulls down the same
message. (The message bodies are tagged with a UUID, so I know it is
the same one.) This time, when the consumer attempts to basicAck() the
message, it again gets ShutdownSignalException, but this one has the
following text in it: "reply-text=PRECONDITION_FAILED - unknown
delivery tag 7".

In fact, that is the same delivery tag that was offered to the
consumer by the broker before the master went down and the consumer
reconnected.

Googling suggests that this event means that the consumer is
attempting to ack the same message more than once.

But, how can this be so? If the first ack succeeded, then the message
should have been removed from the broker's queues, and the consumer
shouldn't see the same message again.

Yet, if the first ack did not succeed, then the consumer shouldn't be
dinged for attempting to re-ack the message.

Anyone seen this before? It smells like a bug in Rabbit's replicated
queues to me, but I'm still new to Rabbit, and so am willing to
believe there's a subtlety here in consuming from a clustered broker
that I haven't yet grokked!

Thanks, --Steve

From matthias at rabbitmq.com  Fri Sep 30 18:59:12 2011
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 30 Sep 2011 18:59:12 +0100
Subject: [rabbitmq-discuss]
 =?windows-1252?q?=93Unknown_delivery_tag=94_fr?=
 =?windows-1252?q?om_RabbitMQ_when_ack=27ing_a_message_in_a_cluster_with_r?=
 =?windows-1252?q?eplicated_queues?=
In-Reply-To: <CADUq8CzvicMWNLfWwunuyxbF1X5BqYBTFjgGpE0uLxKqsscGkQ@mail.gmail.com>
References: <CADUq8CzvicMWNLfWwunuyxbF1X5BqYBTFjgGpE0uLxKqsscGkQ@mail.gmail.com>
Message-ID: <4E860370.1050903@rabbitmq.com>

Steve,

On 30/09/11 18:31, Steve Rehrauer wrote:
> Later, when the consumer has reconnected, it again pulls down the same
> message. (The message bodies are tagged with a UUID, so I know it is
> the same one.) This time, when the consumer attempts to basicAck() the
> message, it again gets ShutdownSignalException, but this one has the
> following text in it: "reply-text=PRECONDITION_FAILED - unknown
> delivery tag 7".

Delivery tags are allocated by server-side channel processes; nothing to 
do with queues and hence certainly nothing to do with replication.

> In fact, that is the same delivery tag that was offered to the
> consumer by the broker before the master went down and the consumer
> reconnected.

The symptoms you are describing are most likely cause by some misrouting 
in the app or, less likely, the rabbitmq client library.

Are you 100% sure that you are issuing the channel.basicAck on the 
channel on which the message was received, particularly when there is 
some reconnect going on?

Connecting via the tracer (http://www.rabbitmq.com/examples.html#tracer) 
might shed some light on what's going on.


Regards,

Matthias.

From steve.rehrauer at gmail.com  Fri Sep 30 19:15:09 2011
From: steve.rehrauer at gmail.com (Steve Rehrauer)
Date: Fri, 30 Sep 2011 14:15:09 -0400
Subject: [rabbitmq-discuss]
	=?windows-1252?q?=93Unknown_delivery_tag=94_fr?=
	=?windows-1252?q?om_RabbitMQ_when_ack=27ing_a_message_in_a_cluster?=
	=?windows-1252?q?_with_replicated_queues?=
In-Reply-To: <4E860370.1050903@rabbitmq.com>
References: <CADUq8CzvicMWNLfWwunuyxbF1X5BqYBTFjgGpE0uLxKqsscGkQ@mail.gmail.com>
	<4E860370.1050903@rabbitmq.com>
Message-ID: <CADUq8Cx4yxXqr5O6vON+ESFDAxXaF-m-jPjX2WiM=jHkZRzmGQ@mail.gmail.com>

On Fri, Sep 30, 2011 at 1:59 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:

> Delivery tags are allocated by server-side channel processes; nothing to do
> with queues and hence certainly nothing to do with replication.

Thanks for the clarification!

> The symptoms you are describing are most likely cause by some misrouting in
> the app or, less likely, the rabbitmq client library.
>
> Are you 100% sure that you are issuing the channel.basicAck on the channel
> on which the message was received, particularly when there is some reconnect
> going on?

Positive about the same channel being used, with the caveat that my
consumer client is reconnecting, so of course I get a new channel on
the second basicAck.

> Connecting via the tracer (http://www.rabbitmq.com/examples.html#tracer)
> might shed some light on what's going on.

Thanks, I'll try that!

--Steve

>
>
> Regards,
>
> Matthias.
>

