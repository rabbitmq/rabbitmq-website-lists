<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Cluster Disk Node vs Ram Node explanation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20Disk%20Node%20vs%20Ram%20Node%20explanation&In-Reply-To=%3C4E61A81B.7020100%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014876.html">
   <LINK REL="Next"  HREF="014884.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Cluster Disk Node vs Ram Node explanation</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Cluster%20Disk%20Node%20vs%20Ram%20Node%20explanation&In-Reply-To=%3C4E61A81B.7020100%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Cluster Disk Node vs Ram Node explanation">matthias at rabbitmq.com
       </A><BR>
    <I>Sat Sep  3 05:07:55 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014876.html">[rabbitmq-discuss] rabbitmq-ha-test setup
</A></li>
        <LI>Next message: <A HREF="014884.html">[rabbitmq-discuss] Java client 2.6.0 availability from	repo1.maven.org
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14878">[ date ]</a>
              <a href="thread.html#14878">[ thread ]</a>
              <a href="subject.html#14878">[ subject ]</a>
              <a href="author.html#14878">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Rene,

On 30/08/11 17:07, Rene Parra wrote:
&gt;<i> GIVEN:
</I>&gt;<i>     * A load balanced cluster consisting of disk node A, ram node B, and
</I>&gt;<i>       ram node C
</I>&gt;<i>
</I>&gt;<i> WHEN:
</I>&gt;<i>     * A client is routed to ram node B via the load balancer,
</I>&gt;<i>     * AND the client declares a *durable* *queue *on its connection to
</I>&gt;<i>       ram node B,
</I>&gt;<i>     * AND the client declares bindings to a topic exchange being
</I>&gt;<i>       serviced by a producer connected on ram node C;
</I>&gt;<i>
</I>&gt;<i> WHERE are the messages stored?
</I>
The messages are stored on the node on which the queue resides / was 
declared. i.e. B.

&gt;<i> WHAT happens to the producer on ram node C when ram node B fails? (Does
</I>&gt;<i> it block? Do messages continue to be delivered? Are messages to the
</I>&gt;<i> client lost?)
</I>
The broker will behave as if the queues on B (and their bindings) didn't 
exist (*). So in your example, assuming there are no bindings to queues 
on surviving nodes, any new messages published will be lost. Setting the 
'mandatory' flag on publish will (asynchronously) inform the publisher 
when that happens.

Messages that made it into the queues and were persisted to disk on B 
before the failure are retained and become available again when B recovers.

(*) except it will prevent redeclaration of any durable queue with the 
same name, since that would prevent subsequent recovery of the original 
queue.

&gt;<i> However, I just finished a soak test where my durable queue on ram node
</I>&gt;<i> B lost messages over the weekend due to a network hiccup that crashed
</I>&gt;<i> ram node B. When it came back up again messages were lost. As such, we
</I>&gt;<i> are recommending our production configuration to be unclustered, disk
</I>&gt;<i> node only until we better understand the benefits and use cases
</I>&gt;<i> associated with clustering with RabbitMQ 2.5.1
</I>
Until the introduction of HA in the recent 2.6.0 release, clustering was 
predominantly a scalability feature.

&gt;<i> A simple tutorial or explanation of &#8220;To Disk Node or To Ram Node... that
</I>&gt;<i> is the question&#8221; would be great and useful for those of us implementing,
</I>&gt;<i> learning and teaching rabbit to our organizations.
</I>
 From <A HREF="http://www.rabbitmq.com/clustering.html#clustering">http://www.rabbitmq.com/clustering.html#clustering</A>
&lt;quote&gt;
A node can be a RAM node or a disk node. RAM nodes keep their state only 
in memory (with the exception of the persistent contents of durable 
queues which are still stored safely on disc). Disk nodes keep state in 
memory and on disk. As RAM nodes don't have to write to disk as much as 
disk nodes, they can perform better. Because state is replicated across 
all nodes in the cluster, it is sufficient to have just one disk node 
within a cluster, to store the state of the cluster safely. Beware, 
however, that RabbitMQ will not stop you from creating a cluster with 
only RAM nodes. Should you do this, and suffer a power failure to the 
entire cluster, the entire state of the cluster, including all messages, 
will be lost.
&lt;/quote&gt;


Matthias.
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014876.html">[rabbitmq-discuss] rabbitmq-ha-test setup
</A></li>
	<LI>Next message: <A HREF="014884.html">[rabbitmq-discuss] Java client 2.6.0 availability from	repo1.maven.org
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14878">[ date ]</a>
              <a href="thread.html#14878">[ thread ]</a>
              <a href="subject.html#14878">[ subject ]</a>
              <a href="author.html#14878">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
