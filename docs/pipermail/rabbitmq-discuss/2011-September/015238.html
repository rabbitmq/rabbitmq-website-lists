<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] acks from temporary queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20acks%20from%20temporary%20queues&In-Reply-To=%3C20110923095858.GA10396%40southbank.eng.vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015225.html">
   <LINK REL="Next"  HREF="015245.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] acks from temporary queues</H1>
    <B>Alexandru Scvor&#355;ov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20acks%20from%20temporary%20queues&In-Reply-To=%3C20110923095858.GA10396%40southbank.eng.vmware.com%3E"
       TITLE="[rabbitmq-discuss] acks from temporary queues">alexandru at rabbitmq.com
       </A><BR>
    <I>Fri Sep 23 10:58:58 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015225.html">[rabbitmq-discuss] acks from temporary queues
</A></li>
        <LI>Next message: <A HREF="015245.html">[rabbitmq-discuss] acks from temporary queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15238">[ date ]</a>
              <a href="thread.html#15238">[ thread ]</a>
              <a href="subject.html#15238">[ subject ]</a>
              <a href="author.html#15238">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Jonathan,

&gt;<i> I apologize if this is an ill-informed question: In a nutshell, the
</I>&gt;<i> thing I am trying to accomplish is blocking a producer until it has
</I>&gt;<i> received acks (or even nacks) from all consumers on temporary queues
</I>&gt;<i> bound to a given (fanout) exchange for a single message. From the
</I>&gt;<i> docs, my sense is that using confirms and waitForConfirms would be
</I>&gt;<i> preferable to full on transactions,
</I>
Confirms are usually the way to go.

With confirms enabled, calling waitForConfirms would block the producer
until all published messages on that channel are acknowledged *by the
broker*.  The broker, in turn, will only acknowledge the message if 1)
it has been persisted to disk; *or* if 2) it has been delivered to a
consumer on each of the queues it had reached.

You can't really specify that you only want the acknowledgement if the
messages are delivered and not if they're persisted.

Also, you said &quot;temporary queues&quot;.  Confirms will only work as described
above if the message is persistent and if the queues it lands on are
durable.  A message that lands on a non-durable queue is considered
acknowledged on that queue immediately (of course, the broker will still
wait for it to be persisted or acknowledged on all the other queues it
reached, before acknowledging it to the producer).

&gt;<i> but as each instance of the
</I>&gt;<i> producer will be on its own thread,
</I>
That's fine.  Just make sure to use a separate channel for each
producer (calling waitForConfirms on the same channel from multiple
threads will almost certainly not do what you want it to).

&gt;<i> The main point of confusion for me here is whether I can get multiple
</I>&gt;<i> acks (from all consumers) for one message without having any prior
</I>&gt;<i> information about the number of queues attached to the exchange. That
</I>&gt;<i> is, I don't just want to know that one queue has received the message,
</I>&gt;<i> but that all queues bound to the exchange have done so. It seems clear
</I>
Not quite sure what you mean.  A published message, even if it gets sent
to multiple queues, is still *one* message with a certain sequence
number.  A published message will be acknowledged by the broker only
once, when it has been written to disk or when it has been successfully
sent to a consumer from each queue.

Consumer acks and publisher acks are completely different things.  A
consumer acks a message to tell *the broker* (not the publisher) that it
has taken responsibility for the message (by using it up, by forwarding
it, by doing something with it).  The broker acks a message to tell *the
publisher* that it has taken responsibility for the message (by saving
it to disk, or by handing it over to consumers).

When a message reaches a queue, and is then delivered to a consumer, the
broker will consider the message delivered only when the consumer
acknowledges it.  So, if it weren't for the &quot;writing the message to
disk&quot; part, it would work exactly the way you're expecting it to.

What sort of system are you designing?

Hope this helps.

Cheers,
Alex


On Thu, Sep 22, 2011 at 12:22:50PM -0700, gneeri wrote:
&gt;<i> I apologize if this is an ill-informed question: In a nutshell, the
</I>&gt;<i> thing I am trying to accomplish is blocking a producer until it has
</I>&gt;<i> received acks (or even nacks) from all consumers on temporary queues
</I>&gt;<i> bound to a given (fanout) exchange for a single message. From the
</I>&gt;<i> docs, my sense is that using confirms and waitForConfirms would be
</I>&gt;<i> preferable to full on transactions, but as each instance of the
</I>&gt;<i> producer will be on its own thread, I am open to using transactions.
</I>&gt;<i> The main point of confusion for me here is whether I can get multiple
</I>&gt;<i> acks (from all consumers) for one message without having any prior
</I>&gt;<i> information about the number of queues attached to the exchange. That
</I>&gt;<i> is, I don't just want to know that one queue has received the message,
</I>&gt;<i> but that all queues bound to the exchange have done so. It seems clear
</I>&gt;<i> that if I send one message per attached queue, I could create a set of
</I>&gt;<i> seqNos and check against that to verify acks for all of the messages,
</I>&gt;<i> but without a list of bound queues (which I cannot see how to get),
</I>&gt;<i> that does not seem like an option. In any case, it seems likely that
</I>&gt;<i> there is something that I am missing here. That said, I would
</I>&gt;<i> appreciate any thoughts (or even clarifying questions) on this.
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> Jonathan
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015225.html">[rabbitmq-discuss] acks from temporary queues
</A></li>
	<LI>Next message: <A HREF="015245.html">[rabbitmq-discuss] acks from temporary queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15238">[ date ]</a>
              <a href="thread.html#15238">[ thread ]</a>
              <a href="subject.html#15238">[ subject ]</a>
              <a href="author.html#15238">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
