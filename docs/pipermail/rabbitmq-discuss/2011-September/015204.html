<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Pika from master branch - All messages arrive in	1 shot
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Pika%20from%20master%20branch%20-%20All%20messages%20arrive%20in%0A%091%20shot&In-Reply-To=%3CCAFw-dimMUyHW0x8nrj1UTK5gAz-S_1W5%2BRd%3D_vUNtf_ZfAziug%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015201.html">
   <LINK REL="Next"  HREF="015207.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Pika from master branch - All messages arrive in	1 shot</H1>
    <B>Rapha&#235;l De GIUSTI</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Pika%20from%20master%20branch%20-%20All%20messages%20arrive%20in%0A%091%20shot&In-Reply-To=%3CCAFw-dimMUyHW0x8nrj1UTK5gAz-S_1W5%2BRd%3D_vUNtf_ZfAziug%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Pika from master branch - All messages arrive in	1 shot">raphael.degiusti at guardis.com
       </A><BR>
    <I>Wed Sep 21 10:43:14 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015201.html">[rabbitmq-discuss] can two or consumer will work on same queue?
</A></li>
        <LI>Next message: <A HREF="015207.html">[rabbitmq-discuss] Pika from master branch - All messages arrive in 1 shot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15204">[ date ]</a>
              <a href="thread.html#15204">[ thread ]</a>
              <a href="subject.html#15204">[ subject ]</a>
              <a href="author.html#15204">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi everyone,

When I'm running the demo_receive / demo_send example with pika from the
master branch (pre0.9.6 i think), I'm getting a strange behaviour.

It seems that demo_send sends its 10 messages before demo_receive actually
receive everything in one shot. It results in a tcp backpressure problem.

In pika 0.9.5 example, demo_receive consumes a message 1 by 1, as it
arrives, and acks it, this is what I expect.

Here's the output from both scripts (I added a 0.5sec sleep after sending a
message to see what's happening) :

demo_receive:
&gt;<i> demo_receive: Connected to RabbitMQ
</I>&gt;<i> demo_receive: Received our Channel
</I>&gt;<i> demo_receive: Queue Declared
</I>&gt;<i> Basic.Deliver text/plain delivery-tag 1: Hello World #0:
</I>&gt;<i> 1316597081.62437701
</I>&gt;<i> Basic.Deliver text/plain delivery-tag 2: Hello World #1:
</I>&gt;<i> 1316597082.62570310
</I>&gt;<i> Basic.Deliver text/plain delivery-tag 3: Hello World #2:
</I>&gt;<i> 1316597083.62713790
</I>&gt;<i> Basic.Deliver text/plain delivery-tag 4: Hello World #3:
</I>&gt;<i> 1316597084.62860394
</I>&gt;<i> Basic.Deliver text/plain delivery-tag 5: Hello World #4:
</I>&gt;<i> 1316597085.63100100
</I>&gt;<i> Basic.Deliver text/plain delivery-tag 6: Hello World #5:
</I>&gt;<i> 1316597086.63265109
</I>&gt;<i> Basic.Deliver text/plain delivery-tag 7: Hello World #6:
</I>&gt;<i> 1316597087.63385701
</I>&gt;<i> Basic.Deliver text/plain delivery-tag 8: Hello World #7:
</I>&gt;<i> 1316597088.63560796
</I>&gt;<i> Basic.Deliver text/plain delivery-tag 9: Hello World #8:
</I>&gt;<i> 1316597089.63728094
</I>&gt;<i> Basic.Deliver text/plain delivery-tag 10: Hello World #9:
</I>&gt;<i> 1316597090.63895893
</I>



&gt;<i>
</I>
demo_send:
&gt;<i> INFO:pika:Connecting to 127.0.0.1:5672
</I>&gt;<i> demo_send: Connected to RabbitMQ
</I>&gt;<i> demo_send: Received our Channel
</I>&gt;<i> demo_send: Queue Declared
</I>&gt;<i> demo_send: Sent Hello World #0: 1316597081.62437701
</I>&gt;<i> demo_send: Sent Hello World #1: 1316597082.62570310
</I>&gt;<i> demo_send: Sent Hello World #2: 1316597083.62713790
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 500 bytes and an estimated 10 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> demo_send: Sent Hello World #3: 1316597084.62860394
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 521 bytes and an estimated 11 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 582 bytes and an estimated 12 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 625 bytes and an estimated 13 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> demo_send: Sent Hello World #4: 1316597085.63100100
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 646 bytes and an estimated 14 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 707 bytes and an estimated 15 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 750 bytes and an estimated 16 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> demo_send: Sent Hello World #5: 1316597086.63265109
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 771 bytes and an estimated 17 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 832 bytes and an estimated 18 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 875 bytes and an estimated 19 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> demo_send: Sent Hello World #6: 1316597087.63385701
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 896 bytes and an estimated 20 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 957 bytes and an estimated 21 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 1000 bytes and an estimated 22 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> demo_send: Sent Hello World #7: 1316597088.63560796
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 1021 bytes and an estimated 23 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 1082 bytes and an estimated 24 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 1125 bytes and an estimated 25 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> demo_send: Sent Hello World #8: 1316597089.63728094
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 1146 bytes and an estimated 26 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 1207 bytes and an estimated 27 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 1250 bytes and an estimated 28 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> demo_send: Sent Hello World #9: 1316597090.63895893
</I>&gt;<i> demo_send: Closing
</I>&gt;<i> INFO:pika:Closing connection: 200 - Normal shutdown
</I>&gt;<i> ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning
</I>&gt;<i> threshold at 1284 bytes and an estimated 29 frames behind
</I>&gt;<i>   warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> INFO:pika:Disconnected from RabbitMQ at 127.0.0.1:5672
</I>

My question is :  why all 10 messages arrive in one shot ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110921/de78e1af/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110921/de78e1af/attachment.htm</A>&gt;
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015201.html">[rabbitmq-discuss] can two or consumer will work on same queue?
</A></li>
	<LI>Next message: <A HREF="015207.html">[rabbitmq-discuss] Pika from master branch - All messages arrive in 1 shot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15204">[ date ]</a>
              <a href="thread.html#15204">[ thread ]</a>
              <a href="subject.html#15204">[ subject ]</a>
              <a href="author.html#15204">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
