<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] HA - queues do not move?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20-%20queues%20do%20not%20move%3F&In-Reply-To=%3C94aa0396-5b75-4690-abdb-b2be8b034e98%40er4g2000vbb.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014975.html">
   <LINK REL="Next"  HREF="014831.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] HA - queues do not move?</H1>
    <B>John Jeffers</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20HA%20-%20queues%20do%20not%20move%3F&In-Reply-To=%3C94aa0396-5b75-4690-abdb-b2be8b034e98%40er4g2000vbb.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] HA - queues do not move?">john.jeffers at gmail.com
       </A><BR>
    <I>Thu Sep  1 19:11:34 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014975.html">[rabbitmq-discuss] RabbitMQ 2.6.0 failing to start (Debian Package)
</A></li>
        <LI>Next message: <A HREF="014831.html">[rabbitmq-discuss] Notify when &quot;Worker&quot; die
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14829">[ date ]</a>
              <a href="thread.html#14829">[ thread ]</a>
              <a href="subject.html#14829">[ subject ]</a>
              <a href="author.html#14829">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you Marek! This is exactly what I needed to know.  I changed the
code I was using to create queues and publish messages, and now the
persistent messages are failing over.  For anyone who might need this
in the future, here is the code that is working for me (using the .NET
API, RabbitMQ version 2.5.1).

// Create the Exchange and Queue with Durable flags set to True.
using (IConnection connection =
connectionFactory.CreateConnection())  // Assumes that you have a
ConnectionFactory object instantiated.
{
    using (IModel model = connection.CreateModel())
    {
        model.ExchangeDeclare(&quot;exchangeName&quot;, ExchangeType.Direct,
true);
        model.QueueDeclare(&quot;queueName&quot;, true, false, false, null);

        model.QueueBind(&quot;queueName&quot;, &quot;exchangeName&quot;, &quot;routingKey&quot;,
null);

        IBasicProperties basicProperties =
model.CreateBasicProperties();
        basicProperties.DeliveryMode = 2; // Message persistence --
required for failover.
        model.BasicPublish(&quot;exchangeName&quot;, &quot;routingKey&quot;,
basicProperties, Encoding.UTF8.GetBytes(&quot;message&quot;));
    }
}


On Aug 31, 8:36&#160;am, Marek Majkowski &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">maje... at gmail.com</A>&gt; wrote:
&gt;<i> On Mon, Aug 29, 2011 at 21:31, John Jeffers &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">john.jeff... at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; (I'm new to Rabbit, so please forgive me if this is a dumb question)
</I>&gt;<i>
</I>&gt;<i> &gt; I followed the instructions <A HREF="athttp://www.rabbitmq.com/pacemaker.html">athttp://www.rabbitmq.com/pacemaker.html</A>
</I>&gt;<i> &gt; to build a two-node HA environment. &#160;My nodes are RabbitMQ 2.5.1 on
</I>&gt;<i> &gt; CentOS 6 64-bit, and I'm using a network share for shared storage
</I>&gt;<i> &gt; instead of DRBD.
</I>&gt;<i>
</I>&gt;<i> &gt; The nodes failover just fine, and most things seem to be working as
</I>&gt;<i> &gt; expected, however, I've noticed that when I take Node 1 down and it
</I>&gt;<i> &gt; fails over to Node 2, the queues and messages on Node 1 do not move to
</I>&gt;<i> &gt; Node 2. &#160;Is this expected behavior? &#160;I expected that the point of the
</I>&gt;<i> &gt; shared storage would be so that messages would not be lost in the
</I>&gt;<i> &gt; event of a failover, but maybe my expectations are incorrect?
</I>&gt;<i>
</I>&gt;<i> Have you set 'persistenece' flag on the queues and 'durability' flag
</I>&gt;<i> on messages?
</I>&gt;<i>
</I>&gt;<i> Chees,
</I>&gt;<i> &#160; Marek
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I></PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014975.html">[rabbitmq-discuss] RabbitMQ 2.6.0 failing to start (Debian Package)
</A></li>
	<LI>Next message: <A HREF="014831.html">[rabbitmq-discuss] Notify when &quot;Worker&quot; die
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14829">[ date ]</a>
              <a href="thread.html#14829">[ thread ]</a>
              <a href="subject.html#14829">[ subject ]</a>
              <a href="author.html#14829">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
