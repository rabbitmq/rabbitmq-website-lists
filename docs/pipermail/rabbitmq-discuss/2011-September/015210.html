<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Pika from master branch - All messages arrive in 1 shot
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Pika%20from%20master%20branch%20-%20All%20messages%0A%20arrive%20in%201%20shot&In-Reply-To=%3C746D19F9C5384D1C876777EC6875CC83%40myyearbook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015207.html">
   <LINK REL="Next"  HREF="015209.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Pika from master branch - All messages arrive in 1 shot</H1>
    <B>Gavin M. Roy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Pika%20from%20master%20branch%20-%20All%20messages%0A%20arrive%20in%201%20shot&In-Reply-To=%3C746D19F9C5384D1C876777EC6875CC83%40myyearbook.com%3E"
       TITLE="[rabbitmq-discuss] Pika from master branch - All messages arrive in 1 shot">gmr at myyearbook.com
       </A><BR>
    <I>Wed Sep 21 14:53:33 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015207.html">[rabbitmq-discuss] Pika from master branch - All messages arrive in 1 shot
</A></li>
        <LI>Next message: <A HREF="015209.html">[rabbitmq-discuss]  Streaming Lightweight Publisher Confirms ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15210">[ date ]</a>
              <a href="thread.html#15210">[ thread ]</a>
              <a href="subject.html#15210">[ subject ]</a>
              <a href="author.html#15210">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE> It's worth noting that I do not consider the github master branch stable. If you're looking for the stable branch, make sure you're using 0.9.5.  

Gavin  


On Wednesday, September 21, 2011 at 5:43 AM, Rapha&#235;l De GIUSTI wrote:

&gt;<i> Hi everyone,
</I>&gt;<i>  
</I>&gt;<i> When I'm running the demo_receive / demo_send example with pika from the master branch (pre0.9.6 i think), I'm getting a strange behaviour.
</I>&gt;<i>  
</I>&gt;<i> It seems that demo_send sends its 10 messages before demo_receive actually receive everything in one shot. It results in a tcp backpressure problem.  
</I>&gt;<i>  
</I>&gt;<i> In pika 0.9.5 example, demo_receive consumes a message 1 by 1, as it arrives, and acks it, this is what I expect.
</I>&gt;<i>  
</I>&gt;<i> Here's the output from both scripts (I added a 0.5sec sleep after sending a message to see what's happening) :  
</I>&gt;<i>  
</I>&gt;<i> &gt; &gt;  demo_receive:
</I>&gt;<i> &gt; &gt; demo_receive: Connected to RabbitMQ
</I>&gt;<i> &gt; &gt; demo_receive: Received our Channel
</I>&gt;<i> &gt; &gt; demo_receive: Queue Declared
</I>&gt;<i> &gt; &gt; Basic.Deliver text/plain delivery-tag 1: Hello World #0: 1316597081.62437701
</I>&gt;<i> &gt; &gt; Basic.Deliver text/plain delivery-tag 2: Hello World #1: 1316597082.62570310
</I>&gt;<i> &gt; &gt;  Basic.Deliver text/plain delivery-tag 3: Hello World #2: 1316597083.62713790
</I>&gt;<i> &gt; &gt; Basic.Deliver text/plain delivery-tag 4: Hello World #3: 1316597084.62860394
</I>&gt;<i> &gt; &gt; Basic.Deliver text/plain delivery-tag 5: Hello World #4: 1316597085.63100100
</I>&gt;<i> &gt; &gt;  Basic.Deliver text/plain delivery-tag 6: Hello World #5: 1316597086.63265109
</I>&gt;<i> &gt; &gt; Basic.Deliver text/plain delivery-tag 7: Hello World #6: 1316597087.63385701
</I>&gt;<i> &gt; &gt; Basic.Deliver text/plain delivery-tag 8: Hello World #7: 1316597088.63560796
</I>&gt;<i> &gt; &gt;  Basic.Deliver text/plain delivery-tag 9: Hello World #8: 1316597089.63728094
</I>&gt;<i> &gt; &gt; Basic.Deliver text/plain delivery-tag 10: Hello World #9: 1316597090.63895893
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt; &gt;  demo_send:
</I>&gt;<i> &gt; &gt; INFO:pika:Connecting to 127.0.0.1:5672 (<A HREF="http://127.0.0.1:5672">http://127.0.0.1:5672</A>)
</I>&gt;<i> &gt; &gt; demo_send: Connected to RabbitMQ
</I>&gt;<i> &gt; &gt; demo_send: Received our Channel
</I>&gt;<i> &gt; &gt; demo_send: Queue Declared
</I>&gt;<i> &gt; &gt; demo_send: Sent Hello World #0: 1316597081.62437701
</I>&gt;<i> &gt; &gt;  demo_send: Sent Hello World #1: 1316597082.62570310
</I>&gt;<i> &gt; &gt; demo_send: Sent Hello World #2: 1316597083.62713790
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 500 bytes and an estimated 10 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; demo_send: Sent Hello World #3: 1316597084.62860394
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 521 bytes and an estimated 11 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 582 bytes and an estimated 12 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt;  ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 625 bytes and an estimated 13 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; demo_send: Sent Hello World #4: 1316597085.63100100
</I>&gt;<i> &gt; &gt;  ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 646 bytes and an estimated 14 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 707 bytes and an estimated 15 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 750 bytes and an estimated 16 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt;  demo_send: Sent Hello World #5: 1316597086.63265109
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 771 bytes and an estimated 17 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt;  ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 832 bytes and an estimated 18 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 875 bytes and an estimated 19 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; demo_send: Sent Hello World #6: 1316597087.63385701
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 896 bytes and an estimated 20 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 957 bytes and an estimated 21 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt;  ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1000 bytes and an estimated 22 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; demo_send: Sent Hello World #7: 1316597088.63560796
</I>&gt;<i> &gt; &gt;  ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1021 bytes and an estimated 23 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1082 bytes and an estimated 24 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1125 bytes and an estimated 25 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt;  demo_send: Sent Hello World #8: 1316597089.63728094
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1146 bytes and an estimated 26 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt;  ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1207 bytes and an estimated 27 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1250 bytes and an estimated 28 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; demo_send: Sent Hello World #9: 1316597090.63895893
</I>&gt;<i> &gt; &gt; demo_send: Closing
</I>&gt;<i> &gt; &gt; INFO:pika:Closing connection: 200 - Normal shutdown
</I>&gt;<i> &gt; &gt; ../pika/connection.py:756: UserWarning: Pika: Write buffer exceeded warning threshold at 1284 bytes and an estimated 29 frames behind
</I>&gt;<i> &gt; &gt;  warn(message % (self.outbound_buffer.size, est_frames_behind))
</I>&gt;<i> &gt; &gt; INFO:pika:Disconnected from RabbitMQ at 127.0.0.1:5672 (<A HREF="http://127.0.0.1:5672">http://127.0.0.1:5672</A>)
</I>&gt;<i>  
</I>&gt;<i> My question is : why all 10 messages arrive in one shot ?  
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A> (mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>)
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110921/e1b1b785/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110921/e1b1b785/attachment.htm</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015207.html">[rabbitmq-discuss] Pika from master branch - All messages arrive in 1 shot
</A></li>
	<LI>Next message: <A HREF="015209.html">[rabbitmq-discuss]  Streaming Lightweight Publisher Confirms ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15210">[ date ]</a>
              <a href="thread.html#15210">[ thread ]</a>
              <a href="subject.html#15210">[ subject ]</a>
              <a href="author.html#15210">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
