<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Shovel Connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Shovel%20Connections&In-Reply-To=%3C20110926115420.GC31944%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015220.html">
   <LINK REL="Next"  HREF="015223.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Shovel Connections</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Shovel%20Connections&In-Reply-To=%3C20110926115420.GC31944%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ Shovel Connections">matthew at rabbitmq.com
       </A><BR>
    <I>Mon Sep 26 12:54:21 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015220.html">[rabbitmq-discuss] RabbitMQ Shovel Connections
</A></li>
        <LI>Next message: <A HREF="015223.html">[rabbitmq-discuss] RabbitMQ 2.6.1 and memory consumption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15266">[ date ]</a>
              <a href="thread.html#15266">[ thread ]</a>
              <a href="subject.html#15266">[ subject ]</a>
              <a href="author.html#15266">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Mihir,

On Thu, Sep 22, 2011 at 09:25:26AM +1000, Mihir Mone wrote:
&gt;<i> I have currently setup the shovelling of messages from one of our client
</I>&gt;<i> servers to our end via SSL. Everything works beautifully when you first
</I>&gt;<i> start the servers. However, over time (2-3 days) messages just seem to
</I>&gt;<i> get lost in transit. I have setup shovel to do transactional forwards so
</I>&gt;<i> as to ascertain that the messages are indeed getting delivered. When I
</I>&gt;<i> look at the client side server it does not show any piled up messages
</I>&gt;<i> (making me believe that the messages are indeed getting forwarded
</I>&gt;<i> properly). However, at our end there are no messages getting delivered
</I>&gt;<i> and the queues are empty. When I look at the connections list (using the
</I>&gt;<i> management plugin) I can see that the connection is still active. The
</I>&gt;<i> only solution I have found so far is to restart both the servers so that
</I>&gt;<i> the shovel connections get recycled.
</I>
That's mighty odd. I'd suggest you check the routing topology and such -
there's no other process deleting bindings or such that the shovel is
rely on is there? I.e. check that by the time you reach this problematic
state, that the shovel publishing messages on the downstream side isn't
just throwing those messages into the ether - sufficient
bindings/exchanges/queues exist such that those msgs really will reach
the intended queue.

&gt;<i> Restarting the servers can be a hassle sometimes since we have multiple
</I>&gt;<i> client servers connecting to the same servers at our end. It is only
</I>&gt;<i> recently that I have started using the shovel plugin. Earlier we had
</I>&gt;<i> just written a shovelling application ourselves which used to perform
</I>&gt;<i> the consume-publish operation but wasn't as flexible or featureful as
</I>&gt;<i> the shovel plugin.
</I>
Ok. Restarting should definitely not be necessary - something is going
wrong here. As well as checking that everything is remaining set up to
correctly route messages on the down-stream side, please also have a
look through the logs on the downstream to see whether any errors are
occurring. If the shovel itself is actually running as a plugin on the
upstream side then check those logs too as the shovel will report
problems to its local node.

&gt;<i> So, what I was thinking was to put may be an option in the shovel
</I>&gt;<i> configuration (something like &quot;recycle_connection&quot;) so that we can force
</I>&gt;<i> a connection recycle every few days (ideally I would like to do it every
</I>&gt;<i> 24-36 hrs). The whole point of restarting the servers is so that the
</I>&gt;<i> connections get recycled. So if there was a way in the plugin itself to
</I>&gt;<i> do this, the whole server won't need a restart.
</I>
There isn't such an option, but this shouldn't be necessary either.
Something else is going wrong which should be found and fixed.

Matthew
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015220.html">[rabbitmq-discuss] RabbitMQ Shovel Connections
</A></li>
	<LI>Next message: <A HREF="015223.html">[rabbitmq-discuss] RabbitMQ 2.6.1 and memory consumption
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15266">[ date ]</a>
              <a href="thread.html#15266">[ thread ]</a>
              <a href="subject.html#15266">[ subject ]</a>
              <a href="author.html#15266">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
