<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] rabbitmq-discuss Digest, Vol 52, Issue 7
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-discuss%20Digest%2C%20Vol%2052%2C%20Issue%207&In-Reply-To=%3C20110908122720.GE2369%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014937.html">
   <LINK REL="Next"  HREF="014944.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 52, Issue 7</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20rabbitmq-discuss%20Digest%2C%20Vol%2052%2C%20Issue%207&In-Reply-To=%3C20110908122720.GE2369%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 52, Issue 7">matthew at rabbitmq.com
       </A><BR>
    <I>Thu Sep  8 13:27:21 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014937.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 52, Issue 7
</A></li>
        <LI>Next message: <A HREF="014944.html">[rabbitmq-discuss] RabbitMQ using a ton of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14956">[ date ]</a>
              <a href="thread.html#14956">[ thread ]</a>
              <a href="subject.html#14956">[ subject ]</a>
              <a href="author.html#14956">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Sep 07, 2011 at 11:33:28AM -0700, Elias Levy wrote:
&gt;<i> &gt; In the event that the entire cluster is stopped, due to mnesia, it's
</I>&gt;<i> &gt; normally required that the last node down comes up first - indeed the
</I>&gt;<i> &gt; other nodes in the cluster may very well refuse to start up (they'll
</I>&gt;<i> &gt; just block in the &quot;starting database&quot; step) until the nodes that were
</I>&gt;<i> &gt; alive when it died reappear.
</I>&gt;<i> 
</I>&gt;<i> Is there some timeout on this? &#160;What if the old master is fully fried
</I>&gt;<i> and won't be joining the cluster again? &#160;Is there some sort of
</I>&gt;<i> election within the remaining nodes to select a new master? &#160;If so,
</I>&gt;<i> how is the election resolved? &#160;Slaves most closely synchronized to the
</I>&gt;<i> old master wins?
</I>
Yeah, this is a bit of a problem. Essentially, yes, there is a timeout,
after which Rabbit will just give up trying to start. There are
definitely ways in which we could embue rabbitmqctl with the means to
tell rabbit to abandon all hope of some remote node ever rejoining (and
indeed, even ways to do this without the local rabbit coming up, which
is essential in this case), but we've not yet written this. There is a
bug open for this.

After that, the various local mnesia databases will try to merge
themselves back together, but if two nodes disagree about various
details and they can't delegate to a common node that was alive at the
point they failed, then mnesia will give up with an &quot;unable to merge
schema&quot; error, and there'll really be no hope at getting them both to
merge back together without resetting one of those nodes.

&gt;<i> &gt; However, in catastrophic cases, such as instantaneous powerloss to the
</I>&gt;<i> &gt; whole cluster subsequent startup may well not be as orderly. In this
</I>&gt;<i> &gt; case, it's possible that the first node to recover that contained a
</I>&gt;<i> &gt; mirror of the queue, regardless of whether it was a master or slave,
</I>&gt;<i> &gt; takes the role of master. All other mirrors will then become slaves.
</I>&gt;<i> 
</I>&gt;<i> Presumably it waits for a while and then timeouts and becomes master, yes?
</I>
Erm possibly. Much of this ordering stuff comes from mnesia rather than
Rabbit. If the node's mnesia is happy to start up then Rabbit will then
restore queues without further delay. That may include the promotion of
slaves to master.

Matthew
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014937.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 52, Issue 7
</A></li>
	<LI>Next message: <A HREF="014944.html">[rabbitmq-discuss] RabbitMQ using a ton of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14956">[ date ]</a>
              <a href="thread.html#14956">[ thread ]</a>
              <a href="subject.html#14956">[ subject ]</a>
              <a href="author.html#14956">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
