<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] unack'd messages are starving my consumers/tasks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20unack%27d%20messages%20are%20starving%20my%20consumers/tasks&In-Reply-To=%3C11d710d2-14cc-4d9e-af52-a81ea0744223%40b6g2000vbz.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015329.html">
   <LINK REL="Next"  HREF="015318.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] unack'd messages are starving my consumers/tasks</H1>
    <B>Aaron Voelker</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20unack%27d%20messages%20are%20starving%20my%20consumers/tasks&In-Reply-To=%3C11d710d2-14cc-4d9e-af52-a81ea0744223%40b6g2000vbz.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] unack'd messages are starving my consumers/tasks">aaron at contextlogic.com
       </A><BR>
    <I>Thu Sep 29 20:05:04 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015329.html">[rabbitmq-discuss] No IOException from basicPublish when connection is lost
</A></li>
        <LI>Next message: <A HREF="015318.html">[rabbitmq-discuss] unack'd messages are starving my	consumers/tasks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15317">[ date ]</a>
              <a href="thread.html#15317">[ thread ]</a>
              <a href="subject.html#15317">[ subject ]</a>
              <a href="author.html#15317">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am using rabbitmq server 2.6.1, pika 0.9.5, python 2.6.6 and ubuntu
10.10.

I have multiple queues for multiple consumer (many to many), each with
a prefetch count of 5.

I've encountered a rare issue whereby a consumer that is currently
processing some messages (and has yet to ack them) suddenly
terminates. Obviously, this part is my problem (it's often the OS
killing the process due to consuming too much memory).

However, the effects are less than ideal. The messages remain unack'd
in the queue (verified by the Management Plugin), even though the
connection is no longer there (unless for some reason the OS is
deciding to keep the socket open?). This leads to that work never
being re-delegated.

Moreover, a few times when I've restarted the consumer, it's still
unable to consume those messages and starves itself because it thinks
they're still being worked on (and because of the prefetch count of 5
only allowing 5 unack'd messages), even though they are not being
worked on. This usually doesn't happen, but if it does I restart it
again and it finally works.

Any ideas as to what's happening and if there are any workarounds?

Thanks,
Aaron
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015329.html">[rabbitmq-discuss] No IOException from basicPublish when connection is lost
</A></li>
	<LI>Next message: <A HREF="015318.html">[rabbitmq-discuss] unack'd messages are starving my	consumers/tasks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15317">[ date ]</a>
              <a href="thread.html#15317">[ thread ]</a>
              <a href="subject.html#15317">[ subject ]</a>
              <a href="author.html#15317">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
