<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Channels closed unexpectedly in Java client
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Channels%20closed%20unexpectedly%20in%20Java%20client&In-Reply-To=%3C20110914133904.GE5367%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015093.html">
   <LINK REL="Next"  HREF="015089.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Channels closed unexpectedly in Java client</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Channels%20closed%20unexpectedly%20in%20Java%20client&In-Reply-To=%3C20110914133904.GE5367%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Channels closed unexpectedly in Java client">matthew at rabbitmq.com
       </A><BR>
    <I>Wed Sep 14 14:39:05 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015093.html">[rabbitmq-discuss] Channels closed unexpectedly in Java client
</A></li>
        <LI>Next message: <A HREF="015089.html">[rabbitmq-discuss] Channels closed unexpectedly in Java client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15088">[ date ]</a>
              <a href="thread.html#15088">[ thread ]</a>
              <a href="subject.html#15088">[ subject ]</a>
              <a href="author.html#15088">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Sep 14, 2011 at 11:02:49AM +0100, Matthew Sackman wrote:
&gt;<i> Wow - I'd not considered that file systems these days would still have
</I>&gt;<i> such limits... In my own testing a little while ago, I found that JFS
</I>&gt;<i> had the best performance for my hardware when running Rabbit, but I
</I>&gt;<i> didn't do any huge scaling tests so I wouldn't be surprised if that has
</I>&gt;<i> even lower limits for such things.
</I>
...except it doesn't. I've just written a test to, erm, test this:

-module(test).
-compile([export_all]).

-include_lib(&quot;amqp_client/include/amqp_client.hrl&quot;).

loadsa_queues() -&gt;
    {ok, Conn} = amqp_connection:start(#amqp_params_network{}),
    {ok, Chan} = amqp_connection:open_channel(Conn),
    Method = #'basic.publish'{},
    Content = #amqp_msg { props = #'P_basic'{ delivery_mode = 2 },
                          payload = &lt;&lt;0:8&gt;&gt; },
    [begin
         #'queue.declare_ok'{ queue = Q } =
             amqp_channel:call(Chan, #'queue.declare'{durable = true, exclusive = true}),
         amqp_channel:cast(Chan, Method#'basic.publish'{ routing_key = Q }, Content)
     end || _ &lt;- lists:seq(1,100000)],
    amqp_connection:close(Conn).

The reason for doing the publish is that the queue creates its directory
lazily, so if you don't do the publish, the directory will never be
created, so you won't stress the filesystem.

So I ran that, at the same time as some
rabbitmqctl list_queues | wc -l
and
watch &quot;ls /home/matthew/ssd/rabbitmq-rabbit-mnesia/queues/|wc -l&quot;
and sure enough, it happily got up to the 100,000 queues I'd asked for.


Matthew
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015093.html">[rabbitmq-discuss] Channels closed unexpectedly in Java client
</A></li>
	<LI>Next message: <A HREF="015089.html">[rabbitmq-discuss] Channels closed unexpectedly in Java client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15088">[ date ]</a>
              <a href="thread.html#15088">[ thread ]</a>
              <a href="subject.html#15088">[ subject ]</a>
              <a href="author.html#15088">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
