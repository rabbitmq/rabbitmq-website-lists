<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ using a ton of memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20using%20a%20ton%20of%20memory&In-Reply-To=%3Ca61760a3-b8d5-4d12-9088-b54b01e4e944%40m10g2000yqo.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014956.html">
   <LINK REL="Next"  HREF="014945.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ using a ton of memory</H1>
    <B>justin.adam.miller at gmail.com</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20using%20a%20ton%20of%20memory&In-Reply-To=%3Ca61760a3-b8d5-4d12-9088-b54b01e4e944%40m10g2000yqo.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ using a ton of memory">justin.adam.miller at gmail.com
       </A><BR>
    <I>Wed Sep  7 22:57:53 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014956.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 52, Issue 7
</A></li>
        <LI>Next message: <A HREF="014945.html">[rabbitmq-discuss] RabbitMQ using a ton of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14944">[ date ]</a>
              <a href="thread.html#14944">[ thread ]</a>
              <a href="subject.html#14944">[ subject ]</a>
              <a href="author.html#14944">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a fast producer and about 30 consumers handling the incoming
messages. My queue length stays near zero as do the number of
unacknowledged messages as reported by rabbitmqctl. In other words, my
consumers are able to handle the rate and are definitely acking
messages.

I'm running rabbit on a machine with 96GB of RAM and I've set the high
watermark to 0.7.

I can run like this for several hours, all the while watching memory
usage vacillate as erlang garbage collects. These are never monumental
GC's though. It never drops from, say, 30 GB of memory down to 5GB.
It's usually within a few GB. Problem is though, the memory usage
creeps up over that time until we hit the high watermark and then, as
expected, everything stops.

I understand the memory flow control issues and why my producers stop
when that high watermark is hit, but I don't understand why, if I'm
keeping all my queues pretty empty, my memory usage keeps creeping up?

Any thoughts?

Thanks,
Justin
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014956.html">[rabbitmq-discuss] rabbitmq-discuss Digest, Vol 52, Issue 7
</A></li>
	<LI>Next message: <A HREF="014945.html">[rabbitmq-discuss] RabbitMQ using a ton of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14944">[ date ]</a>
              <a href="thread.html#14944">[ thread ]</a>
              <a href="subject.html#14944">[ subject ]</a>
              <a href="author.html#14944">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
