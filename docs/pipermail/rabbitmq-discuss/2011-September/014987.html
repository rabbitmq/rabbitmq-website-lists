<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Can a Publish be acknowledged.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Can%20a%20Publish%20be%20acknowledged.&In-Reply-To=%3C20110909003401.GD3410%40southbank.Home%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014986.html">
   <LINK REL="Next"  HREF="014988.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Can a Publish be acknowledged.</H1>
    <B>Alexandru Scvor&#355;ov</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Can%20a%20Publish%20be%20acknowledged.&In-Reply-To=%3C20110909003401.GD3410%40southbank.Home%3E"
       TITLE="[rabbitmq-discuss] Can a Publish be acknowledged.">alexandru at rabbitmq.com
       </A><BR>
    <I>Fri Sep  9 01:34:01 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014986.html">[rabbitmq-discuss] Can a Publish be acknowledged.
</A></li>
        <LI>Next message: <A HREF="014988.html">[rabbitmq-discuss] latency in starting/stopping a rabbitmq node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14987">[ date ]</a>
              <a href="thread.html#14987">[ thread ]</a>
              <a href="subject.html#14987">[ subject ]</a>
              <a href="author.html#14987">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> I'd effectively like an acknowledgment to say &quot;this message was put on to at
</I>&gt;<i> least one queue&quot;.
</I>&gt;<i> 
</I>&gt;<i> is this possible?
</I>
Yes.

Strictly speaking, you're asking about messages published with the
mandatory flag enabled.  Such a message *must* reach a queue; if it
doesn't, you get a basic.return back.  That said, it's probably not
exactly what you want.  You'll know messages published like this have
reached a queue, but that alone gives you no guarantee that the message
will survive a broker restart.

You probably want publisher acknowledgements for that, aka confirm mode.
After a channel is put into a confirm mode, the broker acknowledges every
publish.  An acknowledgement in this case means &quot;the message has been
handled somehow; don't worry about it&quot;; this usually means that either
the message has reached some queues and was written to disk (and so will
survive a broker death) or that it was delivered to consumers which have
also acknowledged it.

To get the acknowledgement you want, you need to publish both with
mandatory set and to a confirm channel.  If you get a basic.return and
an acknowledgement, that means the message was not delivered to any
queues; if you get just an acknowledgement, that means the broker has
handled the message somehow; if you get a nack, that means the message
was probably lost in some way, so you need to resend it or something.
The broker guarantees that it will eventually acknowledge or nack all
messages published to confirm channels.

See the documentation for IModel:
<A HREF="http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.6.0/rabbitmq-dotnet-client-2.6.0-client-htmldoc/html/type-RabbitMQ.Client.IModel.html">http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.6.0/rabbitmq-dotnet-client-2.6.0-client-htmldoc/html/type-RabbitMQ.Client.IModel.html</A>

You're looking for ConfirmSelect, to enable confirm mode, BasicPublish,
with mandatory set, and BasicAckEventHandler, BasicNackEventHandler,
BasicReturnEventHandler for the interesting events.

Alternatively, if you're feeling lazy, you can use the new (introduced
in 2.6.0) IModel.WaitForConfirms.  The function waits for all messages
published on the channel so far to be acknowledged or nack'd and returns
true if all of them were acknowledged (or false if some were nack'd).
So, to use it, you'd enable confirm mode with ConfirmSelect, publish
some messages, and call WaitForConfirms.  Note that this does not
handle the case were messages were not routed to any queues (i.e.
basic.returns) and calling it after every message is going to hurt
performance quite a bit.

Hope this helps.

Cheers,
Alex

On Fri, Sep 09, 2011 at 09:53:51AM +1000, Tim Yen wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I'm using Rabbit MQ in .net
</I>&gt;<i> 
</I>&gt;<i> What I need to do is get some acknowledgement that a publish has been
</I>&gt;<i> successful to an exchange bound to a persistent queue.
</I>&gt;<i> 
</I>&gt;<i> I know the queue name and the exchange name.
</I>&gt;<i> 
</I>&gt;<i> I'd effectively like an acknowledgment to say &quot;this message was put on to at
</I>&gt;<i> least one queue&quot;.
</I>&gt;<i> 
</I>&gt;<i> is this possible?
</I>&gt;<i> 
</I>&gt;<i> Tim
</I>
&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014986.html">[rabbitmq-discuss] Can a Publish be acknowledged.
</A></li>
	<LI>Next message: <A HREF="014988.html">[rabbitmq-discuss] latency in starting/stopping a rabbitmq node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14987">[ date ]</a>
              <a href="thread.html#14987">[ thread ]</a>
              <a href="subject.html#14987">[ subject ]</a>
              <a href="author.html#14987">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
