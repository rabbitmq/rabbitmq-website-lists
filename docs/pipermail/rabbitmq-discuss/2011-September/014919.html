<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] active/active HA cluster appears to be	deadlocked
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20active/active%20HA%20cluster%20appears%20to%20be%0A%09deadlocked&In-Reply-To=%3CCAP%2B1M2fsfj8inoj1_HWg9ZqsQSn4Nrwcb6vdjb77pHvz-kKNOw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014918.html">
   <LINK REL="Next"  HREF="014920.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] active/active HA cluster appears to be	deadlocked</H1>
    <B>Bryan Murphy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20active/active%20HA%20cluster%20appears%20to%20be%0A%09deadlocked&In-Reply-To=%3CCAP%2B1M2fsfj8inoj1_HWg9ZqsQSn4Nrwcb6vdjb77pHvz-kKNOw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] active/active HA cluster appears to be	deadlocked">bmurphy1976 at gmail.com
       </A><BR>
    <I>Tue Sep  6 21:34:17 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014918.html">[rabbitmq-discuss] active/active HA cluster appears to be deadlocked
</A></li>
        <LI>Next message: <A HREF="014920.html">[rabbitmq-discuss] active/active HA cluster appears to be	deadlocked
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14919">[ date ]</a>
              <a href="thread.html#14919">[ thread ]</a>
              <a href="subject.html#14919">[ subject ]</a>
              <a href="author.html#14919">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Additional info,

I killed the rabbitmq process on of the servers in the cluster.  I was
then able to run a &quot;rabbitmqctl list_queues&quot; on the remaining server
and verify that there are messages in the queue that have not been
picked up.

I restarted the process, and &quot;/etc/init.d/rabbitmq-server start&quot; never
exited.  I had to ^C to get out, however, the server does appear to
have restarted and rejoined the cluster.

I can now run &quot;rabbitmqclt list_queues&quot; on both nodes in the cluster,
but the messages are still not flowing and the node I restarted shows
the following error when I run &quot;rabbitmqclt list_queues&quot;:

=ERROR REPORT==== 6-Sep-2011::20:31:35 ===
Discarding message
{'$gen_call',{&lt;0.256.0&gt;,#Ref&lt;0.0.0.646&gt;},{info,[name,messages]}} from
&lt;0.256.0&gt; to &lt;0.1382.0&gt; in an old incarnation (2) of this node (3)


On Tue, Sep 6, 2011 at 3:26 PM, Bryan Murphy &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">bmurphy1976 at gmail.com</A>&gt; wrote:
&gt;<i> I created a 3 server RabbitMQ v2.6.0 cluster with all queues
</I>&gt;<i> configured for &quot;x-ha-policy&quot;: &quot;all&quot;. &#160;Everything seemed to be working
</I>&gt;<i> fine, and then I killed one of the servers (halt). &#160;This is in a
</I>&gt;<i> virtualized environment (ec2) so that server is gone. &#160;I wanted to
</I>&gt;<i> simulate scenarios where one of the servers failed catastrophically.
</I>&gt;<i>
</I>&gt;<i> The problem is, now my cluster seems to be stuck in some sort of
</I>&gt;<i> deadlocked state. &#160;One of my processes *thinks* it posted a message to
</I>&gt;<i> the cluster, but I am unable to list_queues to verify this and the
</I>&gt;<i> consumer has yet to receive this message.
</I>&gt;<i>
</I>&gt;<i> &quot;rabbitmqctl list_queues&quot; blocks forever and never returns.
</I>&gt;<i>
</I>&gt;<i> &quot;/etc/init.d/rabbitmq-server stop&quot; blocks forever and never actually
</I>&gt;<i> shuts down the server.
</I>&gt;<i>
</I>&gt;<i> &quot;rabbitmqctl cluster_status&quot; returns immediately showing me the three
</I>&gt;<i> registered nodes with only two listed as running:
</I>&gt;<i>
</I>&gt;<i> Cluster status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at domU-12-31-39-00-E1-D7</A>' ...
</I>&gt;<i> [{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-212-138-134</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-90-195-244</A>',
</I>&gt;<i> &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;'<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at domU-12-31-39-00-E1-D7</A>']}]},
</I>&gt;<i> &#160;{running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-212-138-134</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at domU-12-31-39-00-E1-D7</A>']}]
</I>&gt;<i> ...done.
</I>&gt;<i>
</I>&gt;<i> as you can see, all three nodes were configured as &quot;disk&quot; nodes and
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-90-195-244</A> is no longer running.
</I>&gt;<i>
</I>&gt;<i> So, somehow the cluster seems to be deadlocked. &#160;Since this server
</I>&gt;<i> cannot possibly be restored, how do I get out of this state? &#160;Is there
</I>&gt;<i> a way I can forcefully tell the rest of the cluster to forget about
</I>&gt;<i> the missing server? &#160;I can't find an example of how to do this in the
</I>&gt;<i> documentation.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Bryan
</I>&gt;<i>
</I></PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014918.html">[rabbitmq-discuss] active/active HA cluster appears to be deadlocked
</A></li>
	<LI>Next message: <A HREF="014920.html">[rabbitmq-discuss] active/active HA cluster appears to be	deadlocked
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14919">[ date ]</a>
              <a href="thread.html#14919">[ thread ]</a>
              <a href="subject.html#14919">[ subject ]</a>
              <a href="author.html#14919">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
