<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] dead connection ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20dead%20connection%20%3F&In-Reply-To=%3CCABzX%2BqwsULDuiT5MVYPZsghh4f4b15ewSeKuNxPE5Hn%2BVPZOvQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015069.html">
   <LINK REL="Next"  HREF="015070.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] dead connection ?</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20dead%20connection%20%3F&In-Reply-To=%3CCABzX%2BqwsULDuiT5MVYPZsghh4f4b15ewSeKuNxPE5Hn%2BVPZOvQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] dead connection ?">majek04 at gmail.com
       </A><BR>
    <I>Wed Sep 14 16:30:45 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015069.html">[rabbitmq-discuss] dead connection ?
</A></li>
        <LI>Next message: <A HREF="015070.html">[rabbitmq-discuss] RabbitMQ, PHP and RPC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15096">[ date ]</a>
              <a href="thread.html#15096">[ thread ]</a>
              <a href="subject.html#15096">[ subject ]</a>
              <a href="author.html#15096">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Sep 14, 2011 at 09:57, ludy &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ludy at wawame.cn</A>&gt; wrote:
&gt;<i> i want to use rabbitmq for android push.i use device id to name a
</I>&gt;<i> queue.when mobile switches network,mobile will reconnect to the
</I>&gt;<i> queue,and then the queue do not send message to the new consumer
</I>&gt;<i> immediately.the old consumer is still exist but connection is not
</I>&gt;<i> alive,how can i set a queue only receive one alive consumer???
</I>
Ludy,

There are few things you can do.

First, if you used 'basic.qos' with 'prefetch-count=1', that would
mean only one message will be delivered to the inactive connection
(and thus, potentially lost). But remember this may slow down
message delivery to your clients.

Next, the connection is probably just stalled and it will properly
closed when TCP detects that. It can take a while. You can speed
up this process by using keepalives (either on AMQP layer or
on tcp layer). Messages that were delivered to 'dead' connection
will get redelivered, and you will lose no data. (messages
could be delivered not in order).

At last, you could change your architecture so that every connection
creates a new, temporary (exclusive) queue. This kind of setup
would mean that for all messages in a queue will be delivered
to only one connection - thus reducing complexity of dead connections.
But that would probably require support from your application -
you would probably need to do some kind of replay when client
connects.

Cheers,
  Marek
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015069.html">[rabbitmq-discuss] dead connection ?
</A></li>
	<LI>Next message: <A HREF="015070.html">[rabbitmq-discuss] RabbitMQ, PHP and RPC
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15096">[ date ]</a>
              <a href="thread.html#15096">[ thread ]</a>
              <a href="subject.html#15096">[ subject ]</a>
              <a href="author.html#15096">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
