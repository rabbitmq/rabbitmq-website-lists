<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ using a ton of memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20using%20a%20ton%20of%20memory&In-Reply-To=%3C20110908120712.GC2369%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014950.html">
   <LINK REL="Next"  HREF="014980.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ using a ton of memory</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20using%20a%20ton%20of%20memory&In-Reply-To=%3C20110908120712.GC2369%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ using a ton of memory">matthew at rabbitmq.com
       </A><BR>
    <I>Thu Sep  8 13:07:12 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014950.html">[rabbitmq-discuss] RabbitMQ using a ton of memory
</A></li>
        <LI>Next message: <A HREF="014980.html">[rabbitmq-discuss] RabbitMQ using a ton of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14951">[ date ]</a>
              <a href="thread.html#14951">[ thread ]</a>
              <a href="subject.html#14951">[ subject ]</a>
              <a href="author.html#14951">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Sep 08, 2011 at 04:47:27AM -0700, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">justin.adam.miller at gmail.com</A> wrote:
&gt;<i> Not that this is exactly your purview, but I'm using Spring AMQP RC2,
</I>&gt;<i> with acknowledgeMode set to AUTO which, in Spring AMQP terms, means
</I>&gt;<i> the container will ack every message.
</I>&gt;<i> 
</I>&gt;<i> Also, is there any other way to check that messages are being acked,
</I>&gt;<i> besides checking 'rabbitmqctl messages_unacknowledged&quot;? That number
</I>&gt;<i> definitely returns 0 (or close to it) at all times.
</I>
Ok, that certainly sounds like you're doing the right thing.

Rabbit shouldn't continue to chew up more and more memory so I suspect
some sort of resource is being created and not destroyed. Could you
check things like the number of queues, the number of connections and
channels etc and that those numbers are not growing constantly?

96GB is an awful lot of memory!

&gt;<i> &gt; &gt; I can run like this for several hours, all the while watching memory
</I>&gt;<i> &gt; &gt; usage vacillate as erlang garbage collects. These are never monumental
</I>&gt;<i> &gt; &gt; GC's though. It never drops from, say, 30 GB of memory down to 5GB.
</I>&gt;<i> &gt; &gt; It's usually within a few GB. Problem is though, the memory usage
</I>&gt;<i> &gt; &gt; creeps up over that time until we hit the high watermark and then, as
</I>&gt;<i> &gt; &gt; expected, everything stops.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; I understand the memory flow control issues and why my producers stop
</I>&gt;<i> &gt; &gt; when that high watermark is hit, but I don't understand why, if I'm
</I>&gt;<i> &gt; &gt; keeping all my queues pretty empty, my memory usage keeps creeping up?
</I>
Agreed. If you can provoke this to happen again, then when you reach
that point could you run &quot;rabbitmqctl report&quot; and send us the output
(maybe off list if you see anything sensitive in there and/or it's
huge).

Matthew
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014950.html">[rabbitmq-discuss] RabbitMQ using a ton of memory
</A></li>
	<LI>Next message: <A HREF="014980.html">[rabbitmq-discuss] RabbitMQ using a ton of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14951">[ date ]</a>
              <a href="thread.html#14951">[ thread ]</a>
              <a href="subject.html#14951">[ subject ]</a>
              <a href="author.html#14951">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
