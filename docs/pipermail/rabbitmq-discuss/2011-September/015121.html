<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] behavior when client socket close
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20behavior%20when%20client%20socket%20close&In-Reply-To=%3CCABzX%2BqzGXto3YRCRFkApZs3XWNKvFbWLjx694Ui66ML%2BB8Zfcw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015060.html">
   <LINK REL="Next"  HREF="015123.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] behavior when client socket close</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20behavior%20when%20client%20socket%20close&In-Reply-To=%3CCABzX%2BqzGXto3YRCRFkApZs3XWNKvFbWLjx694Ui66ML%2BB8Zfcw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] behavior when client socket close">majek04 at gmail.com
       </A><BR>
    <I>Fri Sep 16 13:16:09 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015060.html">[rabbitmq-discuss] behavior when client socket close
</A></li>
        <LI>Next message: <A HREF="015123.html">[rabbitmq-discuss] behavior when client socket close
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15121">[ date ]</a>
              <a href="thread.html#15121">[ thread ]</a>
              <a href="subject.html#15121">[ subject ]</a>
              <a href="author.html#15121">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Sep 13, 2011 at 21:17, Aaron Westendorf &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">aaron at agoragames.com</A>&gt; wrote:
&gt;<i> We're trying to determine Rabbits expected behavior when a client host
</I>&gt;<i> shuts off. Server is hardware 2.5.1, client is a VM that was shut down
</I>&gt;<i> cleanly (i.e. power off). We have no heartbeats, and the client turns
</I>&gt;<i> on keepalives. We found that linux reported these sockets as
</I>&gt;<i> ESTABLISHED after the clients were turned off, and we're trying to
</I>&gt;<i> determine if this is a problem with our vendor's network or expected
</I>&gt;<i> behavior. Host OS is Linux 2.6.35.
</I>
What should happen when you type 'shutdown':
 1) linux starts shutting down process
 2) as one of the shutdown steps rabbitmq is cleanly closed
   (equivalent to /etc/init.d/rabbitmq-server stop)
 3) during shutdown all network connections get properly closed

The behaviour you're explaining may happen, for example
when the server is closed uncleanly - 'power cord' shutdown kind
of thing. TCP/IP is not able to distinguish transient network
failure from remote host being completely down.

But, it is quite possible that 2) took more time than expected,
which could be what you're seeing. Rabbitmq sometimes
needs quite some time to dump messages to the disk
and shutdown cleanly. In such case operating system won't
wait too long and will shutdown with rabbitmq and its connections
still up.

As a workaround:
 - stop rabbitmq manually before shutting down the system
  (and make sure it has enough time to write messages)
 - use keepalives/heartbeats so that clients can detect
   this kind of issues earlier.

Cheers,
  Marek
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015060.html">[rabbitmq-discuss] behavior when client socket close
</A></li>
	<LI>Next message: <A HREF="015123.html">[rabbitmq-discuss] behavior when client socket close
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15121">[ date ]</a>
              <a href="thread.html#15121">[ thread ]</a>
              <a href="subject.html#15121">[ subject ]</a>
              <a href="author.html#15121">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
