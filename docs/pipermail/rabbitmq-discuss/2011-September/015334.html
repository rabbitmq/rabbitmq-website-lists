<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Frequently getting {badmatch, {error, einval} from one of my rabbimq nodes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Frequently%20getting%20%7Bbadmatch%2C%20%7Berror%2C%0A%20einval%7D%20from%20one%20of%20my%20rabbimq%20nodes&In-Reply-To=%3CCAApCF472FzOurxA2G1wRJakmSoxi_JfrLamNd_jLgOE74Bp9zg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015333.html">
   <LINK REL="Next"  HREF="015335.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Frequently getting {badmatch, {error, einval} from one of my rabbimq nodes</H1>
    <B>Max Warnock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Frequently%20getting%20%7Bbadmatch%2C%20%7Berror%2C%0A%20einval%7D%20from%20one%20of%20my%20rabbimq%20nodes&In-Reply-To=%3CCAApCF472FzOurxA2G1wRJakmSoxi_JfrLamNd_jLgOE74Bp9zg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Frequently getting {badmatch, {error, einval} from one of my rabbimq nodes">maxjwarnock at gmail.com
       </A><BR>
    <I>Fri Sep 30 13:57:40 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015333.html">[rabbitmq-discuss] (no subject)
</A></li>
        <LI>Next message: <A HREF="015335.html">[rabbitmq-discuss] &#8220;Unknown delivery tag&#8221; from RabbitMQ when ack'ing a message in a cluster with replicated queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15334">[ date ]</a>
              <a href="thread.html#15334">[ thread ]</a>
              <a href="subject.html#15334">[ subject ]</a>
              <a href="author.html#15334">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Has anyone had any more thoughts on this? I'm still getting this error and
it's making my software queue up about 10 for every 100,000 messages in the
unacked queue. If I restart my server it will process those messages just
fine.
-Max

On Thu, Aug 18, 2011 at 4:26 PM, Max Warnock &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">maxjwarnock at gmail.com</A>&gt; wrote:

&gt;<i> I have been getting the same error, you're not crazy Chak.  The exact
</I>&gt;<i> message for me is:
</I>&gt;<i>
</I>&gt;<i> =ERROR REPORT==== 18-Aug-2011::16:17:35 ===
</I>&gt;<i> ** Generic server &lt;0.28256.0&gt; terminating
</I>&gt;<i> ** Last message in was {inet_async,#Port&lt;0.29961&gt;,47384,
</I>&gt;<i>                                    {ok,&lt;&lt;0,10,0,51,206&gt;&gt;}}
</I>&gt;<i> ** When Server state == {state,#Port&lt;0.29961&gt;,&lt;0.28252.0&gt;,&lt;0.28253.0&gt;,
</I>&gt;<i>                                {method,rabbit_framing_amqp_0_9_1},
</I>&gt;<i>                                {1,0,4}}
</I>&gt;<i> ** Reason for termination ==
</I>&gt;<i> ** {{badmatch,{error,einval}},
</I>&gt;<i>     [{amqp_main_reader,handle_inet_async,2},
</I>&gt;<i>      {gen_server,handle_msg,5},
</I>&gt;<i>      {proc_lib,init_p_do_apply,3}]}
</I>&gt;<i>
</I>&gt;<i> I get this when I have a large number of messages going over a single
</I>&gt;<i> connection and channel (topic exchange, subscription based pulling).  I'm
</I>&gt;<i> running
</I>&gt;<i> Erlang R13B04 (erts-5.7.5).
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> -Max
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Wed, Jul 27, 2011 at 12:38 PM, Alexandru Scvor&#355;ov &lt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexandru at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi Chak,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've been trying for a while, but I can't reproduce this.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That error is coming from deep inside Erlang's inet driver.  As far as I
</I>&gt;&gt;<i> can tell, the only way to get that error would be to call
</I>&gt;&gt;<i> prim_inet:async_recv/3 on a socket with a {packet, Packet} setting
</I>&gt;&gt;<i> different from 'raw'.  But this can't happen on any version of rabbit.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Could you give us a more detailed description of the program?  Is it a
</I>&gt;&gt;<i> plugin?  Is it doing anything special with the connection? (like setting
</I>&gt;&gt;<i> socket options after the connection is established) Is there any chance
</I>&gt;&gt;<i> we could see the code?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You mentioned it starts at the very beginning.  Does this mean the
</I>&gt;&gt;<i> problem goes away after some time?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers,
</I>&gt;&gt;<i> Alex
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, Jul 21, 2011 at 07:48:29PM -0700, Chak Hedik wrote:
</I>&gt;&gt;<i> &gt; Hi Alex,
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Seems like this error is still there and it seems like either it
</I>&gt;&gt;<i> &gt; occurred when worker entering the loop and send another message to the
</I>&gt;&gt;<i> &gt; same queue within the loop or occurred when function retry, means
</I>&gt;&gt;<i> &gt; function call itself for a retry (pretty much like loop also).
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Thanks,
</I>&gt;&gt;<i> &gt; Chak
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; On Jul 21, 6:40 am, Chak Hedik &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">chakhe... at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt; &gt; Hi Alex,
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; *Ubuntu Server 11.04 64-Bit
</I>&gt;&gt;<i> &gt; &gt; *RabbitMQ 2.3.1 (Default ubuntu package)
</I>&gt;&gt;<i> &gt; &gt; *Erlang Client 2.3.1 (Default ubuntu package)
</I>&gt;&gt;<i> &gt; &gt; *Erlang R13B03 (Default ubuntu package)
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; Is there something in the server logs that corresponds to this error?
</I>&gt;&gt;<i> &gt; &gt; - That's the only thing appeared in the logs.
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; You say your other nodes don't have similar issues.  Is there
</I>&gt;&gt;<i> &gt; &gt; something
</I>&gt;&gt;<i> &gt; &gt; special about this node?
</I>&gt;&gt;<i> &gt; &gt; - Nothing special, pretty much the same but handle more messages than
</I>&gt;&gt;<i> &gt; &gt; others. 1 worker handling 1 queue.
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; It is strange behaviour and it happen at the very beginning where the
</I>&gt;&gt;<i> &gt; &gt; worker up for the first time (no message in queue yet). I've created
</I>&gt;&gt;<i> &gt; &gt; another node and put this worker there and will wait and see if
</I>&gt;&gt;<i> &gt; &gt; similar error appear again or not today.
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; Thanks for your reply.
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; Chak
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; On Jul 21, 5:14 am, Alexandru Scvor&#355;ov &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexan... at rabbitmq.com</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; Hi Chak,
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; Could you please answer the following questions:
</I>&gt;&gt;<i> &gt; &gt; &gt; * What OS are you using?
</I>&gt;&gt;<i> &gt; &gt; &gt; * What version of RabbitMQ?
</I>&gt;&gt;<i> &gt; &gt; &gt; * What version of the Erlang client?
</I>&gt;&gt;<i> &gt; &gt; &gt; * What version of Erlang?
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; ** Reason for termination ==
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; ** {{badmatch,{error,einval}},
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;     [{amqp_main_reader,handle_inet_async,2},
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;      {gen_server,handle_msg,5},
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;      {proc_lib,init_p_do_apply,3}]}
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; Looks like something strange is taking down the socket, which in
</I>&gt;&gt;<i> turn is
</I>&gt;&gt;<i> &gt; &gt; &gt; taking down the entire connection.  If you have more than one
</I>&gt;&gt;<i> &gt; &gt; &gt; connection, the others should be fine.
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; Is there something in the server logs that corresponds to this
</I>&gt;&gt;<i> error?
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; You say your other nodes don't have similar issues.  Is there
</I>&gt;&gt;<i> something
</I>&gt;&gt;<i> &gt; &gt; &gt; special about this node?
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; Cheers,
</I>&gt;&gt;<i> &gt; &gt; &gt; Alex
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; On Wed, Jul 20, 2011 at 12:12:32AM -0700, Chak Hedik wrote:
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; Hi,
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; I frequently getting this terminating error from one of my nodes :
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; ** Generic server &lt;0.28067.2&gt; terminating
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; ** Last message in was {inet_async,#Port&lt;0.15349&gt;,9049,
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; {ok,&lt;&lt;0,10,0,51,206&gt;&gt;}}
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; ** When Server state ==
</I>&gt;&gt;<i> {state,#Port&lt;0.15349&gt;,&lt;0.28063.2&gt;,&lt;0.28064.2&gt;,
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;                                {method,rabbit_framing_amqp_0_9_1},
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;                                {1,0,4}}
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; ** Reason for termination ==
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; ** {{badmatch,{error,einval}},
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;     [{amqp_main_reader,handle_inet_async,2},
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;      {gen_server,handle_msg,5},
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;      {proc_lib,init_p_do_apply,3}]}
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; While several other nodes with the same setup didn't have the same
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; issue. May I know what it means and willl it affect my queues?How
</I>&gt;&gt;<i> do I
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; fix this?
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; Thank,
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; Chak
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; rabbitmq-discuss mailing list
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; &gt; &gt; rabbitmq-discuss mailing list
</I>&gt;&gt;<i> &gt; &gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://
</I>&gt;&gt;<i> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I>&gt;&gt;<i> &gt; &gt;
</I>&gt;&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; &gt; rabbitmq-discuss mailing list
</I>&gt;&gt;<i> &gt; &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://
</I>&gt;&gt;<i> lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I>&gt;&gt;<i> &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110930/68f1a36b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110930/68f1a36b/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015333.html">[rabbitmq-discuss] (no subject)
</A></li>
	<LI>Next message: <A HREF="015335.html">[rabbitmq-discuss] &#8220;Unknown delivery tag&#8221; from RabbitMQ when ack'ing a message in a cluster with replicated queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15334">[ date ]</a>
              <a href="thread.html#15334">[ thread ]</a>
              <a href="subject.html#15334">[ subject ]</a>
              <a href="author.html#15334">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
