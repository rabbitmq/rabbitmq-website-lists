<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ using a ton of memory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20using%20a%20ton%20of%20memory&In-Reply-To=%3Cd3b14d32-0b66-4c3b-99c0-fcf6379da612%40m18g2000vbe.googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014945.html">
   <LINK REL="Next"  HREF="014951.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ using a ton of memory</H1>
    <B>justin.adam.miller at gmail.com</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20using%20a%20ton%20of%20memory&In-Reply-To=%3Cd3b14d32-0b66-4c3b-99c0-fcf6379da612%40m18g2000vbe.googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ using a ton of memory">justin.adam.miller at gmail.com
       </A><BR>
    <I>Thu Sep  8 12:47:27 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014945.html">[rabbitmq-discuss] RabbitMQ using a ton of memory
</A></li>
        <LI>Next message: <A HREF="014951.html">[rabbitmq-discuss] RabbitMQ using a ton of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14950">[ date ]</a>
              <a href="thread.html#14950">[ thread ]</a>
              <a href="subject.html#14950">[ subject ]</a>
              <a href="author.html#14950">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Not that this is exactly your purview, but I'm using Spring AMQP RC2,
with acknowledgeMode set to AUTO which, in Spring AMQP terms, means
the container will ack every message.

Also, is there any other way to check that messages are being acked,
besides checking 'rabbitmqctl messages_unacknowledged&quot;? That number
definitely returns 0 (or close to it) at all times.

On Sep 7, 6:07&#160;pm, Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matt... at rabbitmq.com</A>&gt; wrote:
&gt;<i> Hi Justin,
</I>&gt;<i>
</I>&gt;<i> I'm sure you are, but could you just confirm that your clients are
</I>&gt;<i> acking msgs that they're sent - it's not some issue with messages not
</I>&gt;<i> being acknowledged and thus building up on the server?
</I>&gt;<i>
</I>&gt;<i> Matthew
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Wed, Sep 07, 2011 at 02:57:53PM -0700, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">justin.adam.mil... at gmail.com</A> wrote:
</I>&gt;<i> &gt; I have a fast producer and about 30 consumers handling the incoming
</I>&gt;<i> &gt; messages. My queue length stays near zero as do the number of
</I>&gt;<i> &gt; unacknowledged messages as reported by rabbitmqctl. In other words, my
</I>&gt;<i> &gt; consumers are able to handle the rate and are definitely acking
</I>&gt;<i> &gt; messages.
</I>&gt;<i>
</I>&gt;<i> &gt; I'm running rabbit on a machine with 96GB of RAM and I've set the high
</I>&gt;<i> &gt; watermark to 0.7.
</I>&gt;<i>
</I>&gt;<i> &gt; I can run like this for several hours, all the while watching memory
</I>&gt;<i> &gt; usage vacillate as erlang garbage collects. These are never monumental
</I>&gt;<i> &gt; GC's though. It never drops from, say, 30 GB of memory down to 5GB.
</I>&gt;<i> &gt; It's usually within a few GB. Problem is though, the memory usage
</I>&gt;<i> &gt; creeps up over that time until we hit the high watermark and then, as
</I>&gt;<i> &gt; expected, everything stops.
</I>&gt;<i>
</I>&gt;<i> &gt; I understand the memory flow control issues and why my producers stop
</I>&gt;<i> &gt; when that high watermark is hit, but I don't understand why, if I'm
</I>&gt;<i> &gt; keeping all my queues pretty empty, my memory usage keeps creeping up?
</I>&gt;<i>
</I>&gt;<i> &gt; Any thoughts?
</I>&gt;<i>
</I>&gt;<i> &gt; Thanks,
</I>&gt;<i> &gt; Justin
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I></PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014945.html">[rabbitmq-discuss] RabbitMQ using a ton of memory
</A></li>
	<LI>Next message: <A HREF="014951.html">[rabbitmq-discuss] RabbitMQ using a ton of memory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14950">[ date ]</a>
              <a href="thread.html#14950">[ thread ]</a>
              <a href="subject.html#14950">[ subject ]</a>
              <a href="author.html#14950">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
