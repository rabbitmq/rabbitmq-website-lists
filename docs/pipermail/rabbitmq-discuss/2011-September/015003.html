<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Mirror queue recovery questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirror%20queue%20recovery%20questions&In-Reply-To=%3CCAFDmHdO6fTo-NmhidtBU_zoUsOUiBQ5%3DfZOD8PN%3DDYJOtL98BA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015001.html">
   <LINK REL="Next"  HREF="015005.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Mirror queue recovery questions</H1>
    <B>Elias Levy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirror%20queue%20recovery%20questions&In-Reply-To=%3CCAFDmHdO6fTo-NmhidtBU_zoUsOUiBQ5%3DfZOD8PN%3DDYJOtL98BA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Mirror queue recovery questions">fearsome.lucidity at gmail.com
       </A><BR>
    <I>Fri Sep  9 18:03:45 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015001.html">[rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
</A></li>
        <LI>Next message: <A HREF="015005.html">[rabbitmq-discuss] Mirror queue recovery questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15003">[ date ]</a>
              <a href="thread.html#15003">[ thread ]</a>
              <a href="subject.html#15003">[ subject ]</a>
              <a href="author.html#15003">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>
</I>&gt;<i> From: Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i> Yeah, this is a bit of a problem. Essentially, yes, there is a timeout,
</I>&gt;<i> after which Rabbit will just give up trying to start. There are
</I>&gt;<i> definitely ways in which we could embue rabbitmqctl with the means to
</I>&gt;<i> tell rabbit to abandon all hope of some remote node ever rejoining (and
</I>&gt;<i> indeed, even ways to do this without the local rabbit coming up, which
</I>&gt;<i> is essential in this case), but we've not yet written this. There is a
</I>&gt;<i> bug open for this.
</I>&gt;<i>
</I>&gt;<i> After that, the various local mnesia databases will try to merge
</I>&gt;<i> themselves back together, but if two nodes disagree about various
</I>&gt;<i> details and they can't delegate to a common node that was alive at the
</I>&gt;<i> point they failed, then mnesia will give up with an &quot;unable to merge
</I>&gt;<i> schema&quot; error, and there'll really be no hope at getting them both to
</I>&gt;<i> merge back together without resetting one of those nodes.
</I>&gt;<i>
</I>&gt;<i> Erm possibly. Much of this ordering stuff comes from mnesia rather than
</I>&gt;<i> Rabbit. If the node's mnesia is happy to start up then Rabbit will then
</I>&gt;<i> restore queues without further delay. That may include the promotion of
</I>&gt;<i> slaves to master.
</I>&gt;<i>
</I>
Matthew,

Thanks for your help understanding the failure modes.

To summarize, if I understand correctly, in the event of a cluster failure,
if the master of a mirrored queue fails to recover, after some timeout the
remaining slaves may or may not choose a new master and recover.  Whether
they do so will depend on whether the underlaying Mnesia tables converge or
not.  And if they do not converge, you may well have to reset one or more
nodes, thus discarding any persisted messages in them.  In that case, you
better choose wisely, and reset the nodes most out of sync with the lost
master.

There is also currently no way to tell the cluster a node will not be
rejoining, and thus avoiding waiting for the timeout, but there is an open
ticket for this.

BTW, how long is this timeout?  Is it configurable?

So would it be fair to say that mirrored queues are fault tolerant to node
loss, but not necessarily to cluster loss?

Elias Levy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110909/312764a2/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110909/312764a2/attachment.htm</A>&gt;
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015001.html">[rabbitmq-discuss] Issues with RabbitMQ, SSL and .NET
</A></li>
	<LI>Next message: <A HREF="015005.html">[rabbitmq-discuss] Mirror queue recovery questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15003">[ date ]</a>
              <a href="thread.html#15003">[ thread ]</a>
              <a href="subject.html#15003">[ subject ]</a>
              <a href="author.html#15003">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
