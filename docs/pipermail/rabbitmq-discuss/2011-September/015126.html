<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Node reaches RAM High Watermark quickly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Node%20reaches%20RAM%20High%20Watermark%20quickly&In-Reply-To=%3C4E737332.2040506%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015041.html">
   <LINK REL="Next"  HREF="015227.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Node reaches RAM High Watermark quickly</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Node%20reaches%20RAM%20High%20Watermark%20quickly&In-Reply-To=%3C4E737332.2040506%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Node reaches RAM High Watermark quickly">simon at rabbitmq.com
       </A><BR>
    <I>Fri Sep 16 17:02:58 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015041.html">[rabbitmq-discuss] Node reaches RAM High Watermark quickly
</A></li>
        <LI>Next message: <A HREF="015227.html">[rabbitmq-discuss] Node reaches RAM High Watermark quickly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15126">[ date ]</a>
              <a href="thread.html#15126">[ thread ]</a>
              <a href="subject.html#15126">[ subject ]</a>
              <a href="author.html#15126">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 12/09/11 23:21, Chris Larsen wrote:
&gt;<i> Hello, we&#8217;re running a bunch of nodes of RabbitMQ 2.3.1 on Erlang R13B03
</I>&gt;<i> under Debian and one of the nodes has a problem where it reaches the
</I>&gt;<i> high watermark, stops accepting producers and requires a reboot to
</I>&gt;<i> recover. The consumers eat all of the messages so that the queues are
</I>&gt;<i> empty but the used Ram never drops. I checked for queue leakage and we
</I>&gt;<i> only have 9 queues defined with about 100 unacked messages in one queue
</I>&gt;<i> when the ram fills up. We only have about 30 connections and less than
</I>&gt;<i> 20 channels shown in the GUI when it fails. The system isn&#8217;t running in
</I>&gt;<i> swap and messages are sometimes a couple of MB in size but no larger.
</I>&gt;<i> Any ideas what it might be? Thank you!
</I>
There was a memory leak bug in 2.3.1 when using confirms with the 
immediate flag - but &quot;immediate&quot; is pretty rarely used and it was 
probably a slow leak. Still, if you are using that combination, that's 
suspicious.

What does mgmt say about the memory use for each queue? Unfortunately 
there's also a bug in 2.3.1 which makes mgmt report inflated memory use 
for idle queues but it should be accurate enough to see any gross problems.

Also, you can get slightly more detailed global memory statistics than 
are shown in the GUI with:

rabbitmqadmin -f long list nodes

or something like:

curl -u guest:guest <A HREF="http://localhost:55672/api/nodes">http://localhost:55672/api/nodes</A>

- it might be instructive to see those.

Other than that, the standard advice is to upgrade to 2.6.1 and see if 
the problem goes away.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015041.html">[rabbitmq-discuss] Node reaches RAM High Watermark quickly
</A></li>
	<LI>Next message: <A HREF="015227.html">[rabbitmq-discuss] Node reaches RAM High Watermark quickly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15126">[ date ]</a>
              <a href="thread.html#15126">[ thread ]</a>
              <a href="subject.html#15126">[ subject ]</a>
              <a href="author.html#15126">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
