<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] What to do when high watermark reached?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20What%20to%20do%20when%20high%20watermark%20reached%3F&In-Reply-To=%3CCABzX%2BqzkBSAYLr6WibkRtaEUddcgM244ZSm3NJP5wmitMhSEbA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015301.html">
   <LINK REL="Next"  HREF="015284.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] What to do when high watermark reached?</H1>
    <B>Marek Majkowski</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20What%20to%20do%20when%20high%20watermark%20reached%3F&In-Reply-To=%3CCABzX%2BqzkBSAYLr6WibkRtaEUddcgM244ZSm3NJP5wmitMhSEbA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] What to do when high watermark reached?">majek04 at gmail.com
       </A><BR>
    <I>Tue Sep 27 21:01:28 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015301.html">[rabbitmq-discuss] What to do when high watermark reached?
</A></li>
        <LI>Next message: <A HREF="015284.html">[rabbitmq-discuss] Consumer Performance Issues?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15303">[ date ]</a>
              <a href="thread.html#15303">[ thread ]</a>
              <a href="subject.html#15303">[ subject ]</a>
              <a href="author.html#15303">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2011/9/27 Fran&#231;ois Beausoleil &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">francois at teksol.info</A>&gt;:
&gt;<i> Le mardi 27 septembre 2011 &#224; 11:08, Marek Majkowski a &#233;crit :
</I>&gt;&gt;<i> The easiest thing to do is to beef up your machine and give Rabbit
</I>&gt;&gt;<i> more RAM (adding a SSD drive may additionally help :P).
</I>&gt;<i> Oops, I can give it more RAM, being on Rackspace, but SSDs are another matter.
</I>&gt;<i>
</I>&gt;<i> I ended up purging my queue, which enabled me to proceed. I'll use more connections in the future.
</I>&gt;<i>
</I>&gt;<i> If I dedicate a machine to RabbitMQ, can/should I change the HWM setting from 40%?
</I>
It all depends on your setup!

If you're using one fat queue - most of the memory Rabbit is using
will be consumed,
probably by this queue. Thus, the Erlang VM garbage collector will
need to collect
a lot of data at once.

For such setup, you need to have at least 50% free memory to allow GC to run
without hitting the swap.

That's the pessimistic case, and that's why the default is 40% (one
queue + twice
as much memory to allow the gc to run smoothly + 20% buffer).

On the other hand, if you're using multiple queues (and they have similar
usage pattern), you can probably increase the memory watermark -
Erlang VM is unlikely to reclaim all the memory that rabbit is using at once.
But it gets more risky :)

If the GC will hit the swap, Rabbit will slow down significantly. If the GC
will want to allocate more memory than is available in swap, it may
crash Erlang VM.

Marek
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015301.html">[rabbitmq-discuss] What to do when high watermark reached?
</A></li>
	<LI>Next message: <A HREF="015284.html">[rabbitmq-discuss] Consumer Performance Issues?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15303">[ date ]</a>
              <a href="thread.html#15303">[ thread ]</a>
              <a href="subject.html#15303">[ subject ]</a>
              <a href="author.html#15303">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
