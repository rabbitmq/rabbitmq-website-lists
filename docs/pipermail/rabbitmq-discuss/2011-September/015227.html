<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Node reaches RAM High Watermark quickly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Node%20reaches%20RAM%20High%20Watermark%20quickly&In-Reply-To=%3C00e301cc7973%24b33e5b70%2419bb1250%24%40euphoriaaudio.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015126.html">
   <LINK REL="Next"  HREF="015242.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Node reaches RAM High Watermark quickly</H1>
    <B>Chris Larsen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Node%20reaches%20RAM%20High%20Watermark%20quickly&In-Reply-To=%3C00e301cc7973%24b33e5b70%2419bb1250%24%40euphoriaaudio.com%3E"
       TITLE="[rabbitmq-discuss] Node reaches RAM High Watermark quickly">clarsen at euphoriaaudio.com
       </A><BR>
    <I>Thu Sep 22 23:05:11 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015126.html">[rabbitmq-discuss] Node reaches RAM High Watermark quickly
</A></li>
        <LI>Next message: <A HREF="015242.html">[rabbitmq-discuss] Node reaches RAM High Watermark quickly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15227">[ date ]</a>
              <a href="thread.html#15227">[ thread ]</a>
              <a href="subject.html#15227">[ subject ]</a>
              <a href="author.html#15227">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Simon!

&gt;<i> There was a memory leak bug in 2.3.1 when using confirms with the
</I>immediate flag - but &quot;immediate&quot; is pretty rarely used and it was probably a
slow leak. 
&gt;<i> Still, if you are using that combination, that's suspicious.
</I>
We weren't using immediate but we were using mandatory.

&gt;<i> What does mgmt say about the memory use for each queue? Unfortunately
</I>there's also a bug in 2.3.1 which makes mgmt report inflated memory use for 
&gt;<i> idle queues but it should be accurate enough to see any gross problems.
</I>
Looking at each queue showed around 100K  to 2MB or so of memory usage. 

&gt;<i> Other than that, the standard advice is to upgrade to 2.6.1 and see if the
</I>problem goes away.

We likely will later on, just want to give it some time for other folks to
catch issues :0)

I may have found the issue with some further debugging. I looked up stream
to see the size of the incoming messages and while most were below 1MB,
there were a few at 20MB all the way up to 60MB. Using the C library, I had
added code that set the &quot;frame_max&quot; value to 10MB whenever my producers
connected to a broker. But I wasn't checking on the producer side to see if
my message was larger than that frame_max. I left the max at 10MB and added
code to prevent sending messages over that size and the memory leaking
stopped. 

So should messages always be smaller than the declared frame size or could
there still be an issue if I bump the frame size up to 60MB? Thanks!

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015126.html">[rabbitmq-discuss] Node reaches RAM High Watermark quickly
</A></li>
	<LI>Next message: <A HREF="015242.html">[rabbitmq-discuss] Node reaches RAM High Watermark quickly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15227">[ date ]</a>
              <a href="thread.html#15227">[ thread ]</a>
              <a href="subject.html#15227">[ subject ]</a>
              <a href="author.html#15227">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
