<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ What /are/ you doing?!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20What%20/are/%20you%20doing%3F%21&In-Reply-To=%3CAAA96443-06E2-442A-966C-0D273A5FC2B1%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015106.html">
   <LINK REL="Next"  HREF="015104.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ What /are/ you doing?!</H1>
    <B>Jason J. W. Williams</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20What%20/are/%20you%20doing%3F%21&In-Reply-To=%3CAAA96443-06E2-442A-966C-0D273A5FC2B1%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ What /are/ you doing?!">jasonjwwilliams at gmail.com
       </A><BR>
    <I>Thu Sep 15 17:21:45 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015106.html">[rabbitmq-discuss] RabbitMQ What /are/ you doing?!
</A></li>
        <LI>Next message: <A HREF="015104.html">[rabbitmq-discuss] Why are all the sets in AMQP.BasicProperties	deprecated?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15107">[ date ]</a>
              <a href="thread.html#15107">[ thread ]</a>
              <a href="subject.html#15107">[ subject ]</a>
              <a href="author.html#15107">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>DTrace is pretty amazing. We've been using it for troubleshooting MySQL since 2006 (OpenSolaris/OpenIndiana). Once you've used it, it's hard to live without. Strace doesn't even hold a candle. 

-J

Sent via iPhone

Is your email Premiere?

On Sep 15, 2011, at 10:11, Alvaro Videla &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">videlalvaro at gmail.com</A>&gt; wrote:

&gt;<i> I hope this DTrace branch gets merged with the default Erlang. I think is quite useful
</I>&gt;<i> 
</I>&gt;<i> On Thu, Sep 15, 2011 at 6:00 PM, Jason J. W. Williams &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jasonjwwilliams at gmail.com</A>&gt; wrote:
</I>&gt;<i> OpenIndiana and  (open Solaris) are great Rabbit platforms. FreeBSD has DTrace too. DTrace for Linux isn't up to snuff with the other platforms yet, but it's still worlds ahead of SystemTap. 
</I>&gt;<i> 
</I>&gt;<i> -J
</I>&gt;<i> 
</I>&gt;<i> Sent via iPhone
</I>&gt;<i> 
</I>&gt;<i> Is your email Premiere?
</I>&gt;<i> 
</I>&gt;<i> On Sep 15, 2011, at 8:03, Alvaro Videla &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">videlalvaro at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I saw Matthew tweeting &quot;Oh RabbitMQ, why are you taking over an hour to recover 100k queues? What /are/ you doing?!&quot; <A HREF="https://twitter.com/hylomorphism/status/114000680875851776">https://twitter.com/hylomorphism/status/114000680875851776</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I've been doing some stuff at work with DTrace and I think is pretty cool when it comes to find out what a process is actually doing.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> At the same time there's an experimental OTP fork on Github that adds Dtrace probes to Erlang: <A HREF="https://github.com/dustin/otp/wiki/DTrace">https://github.com/dustin/otp/wiki/DTrace</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> See here for the available probes: <A HREF="https://github.com/dustin/otp/blob/dtrace/erts/emulator/beam/erlang_dtrace.d">https://github.com/dustin/otp/blob/dtrace/erts/emulator/beam/erlang_dtrace.d</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> So for example running RabbitMQ based on that Erlang branch you could do things like in this gist: <A HREF="https://gist.github.com/1219266">https://gist.github.com/1219266</A>
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> erlang$target:::function-entry
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> /copyinstr(arg1) == &quot;rabbit_exchange_type_direct:route/2&quot;/
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>     printf(&quot;%s %s&quot;, probemod, probefunc);
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>     self-&gt;traceIt = 1;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> There I enable the flag traceIt only when route/2 is called on the direct exchange.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> From there is just a matter of adding probes to different syscalls or io access etc based using patterns on that flag like:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> erlang$target:::function-entry
</I>&gt;&gt;<i> /self-&gt;traceIt/
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i>  //do something here
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> and so on. 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> You can run the gist like: sudo dtrace -s route.d -p `pgrep beam.smp`
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The examples are really basic but I think they illustrate the point. With that Erlang branch you could enable more granular probes than with the usual pid provider or dtruss.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> BTW, this works on Mac and Solaris. AFAIK on Linux some Kernel modules are required.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Cheers,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Alvaro
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> 
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110915/2c07d6d9/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110915/2c07d6d9/attachment.htm</A>&gt;
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015106.html">[rabbitmq-discuss] RabbitMQ What /are/ you doing?!
</A></li>
	<LI>Next message: <A HREF="015104.html">[rabbitmq-discuss] Why are all the sets in AMQP.BasicProperties	deprecated?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15107">[ date ]</a>
              <a href="thread.html#15107">[ thread ]</a>
              <a href="subject.html#15107">[ subject ]</a>
              <a href="author.html#15107">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
