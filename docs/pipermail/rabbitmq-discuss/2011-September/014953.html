<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] queue gets removed from a node
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20queue%20gets%20removed%20from%20a%20node&In-Reply-To=%3C20110908121747.GD2369%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015307.html">
   <LINK REL="Next"  HREF="014954.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] queue gets removed from a node</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20queue%20gets%20removed%20from%20a%20node&In-Reply-To=%3C20110908121747.GD2369%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] queue gets removed from a node">matthew at rabbitmq.com
       </A><BR>
    <I>Thu Sep  8 13:17:48 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015307.html">[rabbitmq-discuss] How to handle failover without losing messages if one of RabbitMQ node crashes in cluster
</A></li>
        <LI>Next message: <A HREF="014954.html">[rabbitmq-discuss] queue gets removed from a node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14953">[ date ]</a>
              <a href="thread.html#14953">[ thread ]</a>
              <a href="subject.html#14953">[ subject ]</a>
              <a href="author.html#14953">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Cezary,

On Tue, Aug 30, 2011 at 04:06:03PM +0100, Cezary Siwek wrote:
&gt;<i> &gt;&gt;The consumer script on Node1 creates a durable queue and waits for
</I>&gt;<i> &gt;&gt;messages.
</I>
&gt;<i> I have reproduced the issue by breaking up the link between two
</I>&gt;<i> nodes. The queue on node2 gets deleted when the node1 becomes
</I>&gt;<i> unavailable.
</I>
No, I think you're confused. A queue only exists on one node, and that
node will be the node to which the client was connected. So if your
consumer created the queue on Node1 then Node2 is forwarding msgs
destined for that queue to Node1. Thus it's not a question of the queue
being deleted, more a question of the queue becoming un-findable once
Node2 loses contact with Node1.

&gt;<i> I know that rabbitmq cluster is not designed to work on unreliable
</I>&gt;<i> links but is it a correct behavior when a queue gets deleted from
</I>&gt;<i> the node? At least the node should allow producer to re-create the
</I>&gt;<i> queue and keep all the messages until connection between nodes is
</I>&gt;<i> back up.
</I>
We used to allow this, but it's wrong: your queue still exists on Node1,
it's just that Node2 can't see Node1 any more. If the producer was
allowed to recreate the queue on Node2 then when the cluster reforms,
you'll then have two queues with the same name, which then leads to all
sorts of crazy problems. Thus we forbid it.

&gt;<i> Is there any way to re-establish connection between two nodes when
</I>&gt;<i> the link goes up?
</I>
If it is just a network issue and both Node1 and Node2 are really still
up, then I'm not sure if Erlang itself attempts reconnections, and this
may well be the problem (and hence why the stop_app/start_app helps). We
might need to add something to help them re-see each other. Essentially
I think we want to try running a &quot;net_kernel:connect_node(Node)&quot;
somewhere, but quite when, or where, or even whether it's really the
solution, isn't yet clear.

Matthew
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015307.html">[rabbitmq-discuss] How to handle failover without losing messages if one of RabbitMQ node crashes in cluster
</A></li>
	<LI>Next message: <A HREF="014954.html">[rabbitmq-discuss] queue gets removed from a node
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14953">[ date ]</a>
              <a href="thread.html#14953">[ thread ]</a>
              <a href="subject.html#14953">[ subject ]</a>
              <a href="author.html#14953">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
