<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Mirror queue recovery questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirror%20queue%20recovery%20questions&In-Reply-To=%3C20110906170731.GB336%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014911.html">
   <LINK REL="Next"  HREF="014913.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Mirror queue recovery questions</H1>
    <B>Matthew Sackman</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mirror%20queue%20recovery%20questions&In-Reply-To=%3C20110906170731.GB336%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Mirror queue recovery questions">matthew at rabbitmq.com
       </A><BR>
    <I>Tue Sep  6 18:07:32 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014911.html">[rabbitmq-discuss] Mirror queue recovery questions
</A></li>
        <LI>Next message: <A HREF="014913.html">[rabbitmq-discuss] /api/aliveness-test broken on 2.6.0?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14912">[ date ]</a>
              <a href="thread.html#14912">[ thread ]</a>
              <a href="subject.html#14912">[ subject ]</a>
              <a href="author.html#14912">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Elias,

On Tue, Sep 06, 2011 at 09:59:26AM -0700, Elias Levy wrote:
&gt;<i> I did not get a response to my questions, so let me try again.
</I>
Sorry about that - it managed to slip down a crack...

&gt;<i> What happens to persisted messages in mirrored queue slaves if they are
</I>&gt;<i> restarted and they don't find a queue master?
</I>
Assuming that at least one node that is meant to have a copy of the
queue on it survives, there'll always be a master. Thus other nodes
coming up will throw away their own contents, and start receiving new
content from the master. Note there is currently no eager
resynchronisation, as the documentation (hopefully) makes clear.

In the event that the entire cluster is stopped, due to mnesia, it's
normally required that the last node down comes up first - indeed the
other nodes in the cluster may very well refuse to start up (they'll
just block in the &quot;starting database&quot; step) until the nodes that were
alive when it died reappear.

Thus, again, as the documentation says, as nodes fall off, the master
will continue to migrate until the mirrored queue has just one node left
which is its master. Due to mnesia, it's very likely that this node will
_have_ to come up before any of the nodes that died earlier can start
up.

However, in catastrophic cases, such as instantaneous powerloss to the
whole cluster subsequent startup may well not be as orderly. In this
case, it's possible that the first node to recover that contained a
mirror of the queue, regardless of whether it was a master or slave,
takes the role of master. All other mirrors will then become slaves.

&gt;<i> When using mirrored queued,must we ensure that the last node shutdown that
</I>&gt;<i> was participating in a mirrored queue, and thus the one that became master
</I>&gt;<i> last, is the one that is restarted first, so that the last master is online
</I>&gt;<i> when slaves join the cluster?
</I>
Yes, but as I say, the effect of mnesia (the distributed database that
Rabbit uses) is likely to enforce the correct startup ordering itself
(at least, it's quite good at that on recent versions of Erlang).

I hope that helps.

Matthew
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014911.html">[rabbitmq-discuss] Mirror queue recovery questions
</A></li>
	<LI>Next message: <A HREF="014913.html">[rabbitmq-discuss] /api/aliveness-test broken on 2.6.0?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14912">[ date ]</a>
              <a href="thread.html#14912">[ thread ]</a>
              <a href="subject.html#14912">[ subject ]</a>
              <a href="author.html#14912">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
