<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] When are persistent messages flushed to disk?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20When%20are%20persistent%20messages%20flushed%20to%20disk%3F&In-Reply-To=%3C925DDDE9D69E7143B3252E2D4680A36703A75BD5%4034093-C5-EVS1.exchange.rackspace.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014906.html">
   <LINK REL="Next"  HREF="014865.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] When are persistent messages flushed to disk?</H1>
    <B>Iain Hull</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20When%20are%20persistent%20messages%20flushed%20to%20disk%3F&In-Reply-To=%3C925DDDE9D69E7143B3252E2D4680A36703A75BD5%4034093-C5-EVS1.exchange.rackspace.com%3E"
       TITLE="[rabbitmq-discuss] When are persistent messages flushed to disk?">iain.hull at workday.com
       </A><BR>
    <I>Fri Sep  2 16:14:17 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014906.html">[rabbitmq-discuss] Issue: user is able to publish to queue that he does not have write permission to
</A></li>
        <LI>Next message: <A HREF="014865.html">[rabbitmq-discuss] When are persistent messages flushed to disk?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14862">[ date ]</a>
              <a href="thread.html#14862">[ thread ]</a>
              <a href="subject.html#14862">[ subject ]</a>
              <a href="author.html#14862">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I know that this is a very difficult question to answer, but under my
current testing scenario I am losing most of my messages.

I have a simple test that pushes 1,000,000 messages to the broker as
fast as possible.  Once this is finished I kill the broker.  

* When the messages are small &lt; 100 bytes only 250,000 of the message
survive.  I can see in the Web console the number of messages in the
queue raises very slowly compared to the rate the client sends new
messages.
* When the message is larger = 1Kb all or most of the messages are
persisted.  I can see in the Web console the number of messages in the
queue closely matches the number of messages the client has sent.

I know that my test is a little unrealistic but we are planning to use
RabbitMQ to smooth out bursts of activity on our ESB caused by batch
updates, I expect most messages to arrive in large bursts and be less
than 1 kb.  I am trying to understand the nature of the window where
persistent messages could be lost.  

* Is it time based? flushed to disk every n milliseconds.
* Is it memory based? Flushed after a buffer of a certain size is
filled.  (Our messages will be small &lt; 1k)
* Does the rate that messages arrive change the window?
* Is most of the buffering at the socket level or in side RabbitMQ?

This part of our system is best effort delivery, so we can accept some
message lose, if we can quantify the lose if/when it happens and
understand its nature like when messages could be lost and how many
could be affected.  Also are there any parameters to tune this behavior?

Sorry if this question has been answered already, I have looked through
the mailing list for the past few years and didn't see all the details I
am looking for.

Regards,
Iain.
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014906.html">[rabbitmq-discuss] Issue: user is able to publish to queue that he does not have write permission to
</A></li>
	<LI>Next message: <A HREF="014865.html">[rabbitmq-discuss] When are persistent messages flushed to disk?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14862">[ date ]</a>
              <a href="thread.html#14862">[ thread ]</a>
              <a href="subject.html#14862">[ subject ]</a>
              <a href="author.html#14862">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
