<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publish%20on%20a%20queue%2C%0A%20then%20Monitor%20on%20a%20reply%20queue%2C%0A%20with%20only%201%20connection%20to%20the%20RabbitMQ%20server%3F%20Non-blocking%3F&In-Reply-To=%3C5798631D5F355D4C99FDF23580295AF8043DB0EF%40TLMAIL1.Transparent.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014938.html">
   <LINK REL="Next"  HREF="014940.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?</H1>
    <B>Christopher Lefevre</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Publish%20on%20a%20queue%2C%0A%20then%20Monitor%20on%20a%20reply%20queue%2C%0A%20with%20only%201%20connection%20to%20the%20RabbitMQ%20server%3F%20Non-blocking%3F&In-Reply-To=%3C5798631D5F355D4C99FDF23580295AF8043DB0EF%40TLMAIL1.Transparent.local%3E"
       TITLE="[rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?">CLefevre at Transparent.com
       </A><BR>
    <I>Wed Sep  7 19:45:09 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="014938.html">[rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?
</A></li>
        <LI>Next message: <A HREF="014940.html">[rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14939">[ date ]</a>
              <a href="thread.html#14939">[ thread ]</a>
              <a href="subject.html#14939">[ subject ]</a>
              <a href="author.html#14939">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Only using one connection is the point of this modification.

I already have a setup that does an asynchronous call that instantiates a Pika Publisher to publish a message to the queue, and a Pika Monitor to consume messages. However those each create their own connection and ioloops.

Am I chasing my tail trying to get multiple channels created for a single connection? Then creating a queue on each channel, one to monitor, one to publish to?

Or is there some other more elegant solution to this? Looking to keep the number of connections to RabbitMQ down on a per application basis.


-Christopher Lefevre

From: Gavin M. Roy [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">gmr at myyearbook.com</A>]
Sent: Wednesday, September 07, 2011 2:38 PM
To: Christopher Lefevre
Cc: Marek Majkowski; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?

You can have multiple connections with one IO loop, assuming you're using PIka. In that case, the IOloop is a single instance across all connections, so you should setup both your connections before starting it, or use a timer to call a method after starting it that sets up your connections.

Gavin

On Wednesday, September 7, 2011 at 2:02 PM, Christopher Lefevre wrote:
EXACTLY!

That's the bit that I'm getting stuck on.

I have a publish method that sets up a connection, then calls another function to open a channel, then publishes to the queue as shown previously.

Within that function is a connection.ioloop.start() which I guess I don't really understand. For the individual publish/monitor functions they work as expected, the monitor will monitor and consume, while the publish only publishes once and breaks the ioloop, as expected.

To get an asynchronous Publish, then Monitor the reply_to queue, I can instantiate the classes for the monitor/publisher I have, and it will work with 2 connections to the server. However trying to get this done with one connection is where I'm balking.

-Christopher Lefevre


-----Original Message-----
From: Marek Majkowski [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">majek04 at gmail.com</A>]
Sent: Wednesday, September 07, 2011 11:45 AM
To: Christopher Lefevre
Cc: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
Subject: Re: [rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?

On Wed, Sep 7, 2011 at 14:21, Christopher Lefevre
&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">CLefevre at transparent.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">CLefevre at transparent.com</A>&gt;&gt; wrote:

Coming back to this after a day I realize throughout I was a bit off in describing my situation. I am actually attempting to get an asynchronous setup to work on one connection to the RabbitMQ server.

Connect, create a channel(s), publish to a queue, then monitor on the reply queue, in an asynchronous state, returning the reply to a web page when completed.

Well, if you want to use asynchronous style, than you need to have
an event loop and program using callbacks.

Cheers,
Marek
The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>

The information contained in this electronic message and any attached document(s) is intended only for the personal and confidential use of the designated recipients named above. This message may be confidential. If the reader of this message is not the intended recipient, you are hereby notified that you have received this document in error, and that any review, dissemination, distribution, or copying of this message is strictly prohibited. If you have received this communication in error, please notify sender immediately by telephone (603) 262-6300 or by electronic mail immediately. Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110907/c41f2f88/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110907/c41f2f88/attachment.htm</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014938.html">[rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?
</A></li>
	<LI>Next message: <A HREF="014940.html">[rabbitmq-discuss] Publish on a queue, then Monitor on a reply queue, with only 1 connection to the RabbitMQ server? Non-blocking?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14939">[ date ]</a>
              <a href="thread.html#14939">[ thread ]</a>
              <a href="subject.html#14939">[ subject ]</a>
              <a href="author.html#14939">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
