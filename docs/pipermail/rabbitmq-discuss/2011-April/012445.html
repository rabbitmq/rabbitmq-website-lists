<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Management UI plugin issue on 2 node cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Management%20UI%20plugin%20issue%20on%202%20node%20cluster&In-Reply-To=%3C33948D16-8AF4-4E98-A48E-4E724873D5A4%40dwim.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012332.html">
   <LINK REL="Next"  HREF="012446.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Management UI plugin issue on 2 node cluster</H1>
    <B>Jos I. Boumans</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Management%20UI%20plugin%20issue%20on%202%20node%20cluster&In-Reply-To=%3C33948D16-8AF4-4E98-A48E-4E724873D5A4%40dwim.org%3E"
       TITLE="[rabbitmq-discuss] Management UI plugin issue on 2 node cluster">jos at dwim.org
       </A><BR>
    <I>Tue Apr 19 00:34:14 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012332.html">[rabbitmq-discuss] Management UI plugin issue on 2 node cluster
</A></li>
        <LI>Next message: <A HREF="012446.html">[rabbitmq-discuss] Management UI plugin issue on 2 node cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12445">[ date ]</a>
              <a href="thread.html#12445">[ thread ]</a>
              <a href="subject.html#12445">[ subject ]</a>
              <a href="author.html#12445">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I've just upgraded my 2 node cluster from 2.4.0 to 2.4.1 on Ubuntu
10.04.2 on ec2. Both nodes have the plugins installed for the
management UI (+agent) and the stomp adapter.

The second node in the cluster won't start with the management UI
installed. If i remove the UI and leave the agent + stomp adapter,
it starts and joins the cluster as expected. This configuration
worked fine on 2.4.0.

I have a huge erlang crash dump file, but nothing that seems to
indicate anything about the management plugin. The error log shows:

  Kernel pid terminated (application_controller)  
({application_terminated,rabbit,shutdown})

and not much more than that.

The full output of a console session is below the sig showing how
it works without the UI plugin, and fails when enabling it.

The full erlang crash dump is available here:

  <A HREF="http://krux-temp.s3.amazonaws.com/erl_crash.dump">http://krux-temp.s3.amazonaws.com/erl_crash.dump</A>

Can someone help me diagnose and address the problem?

I'm also found on Freenode/#rabbitmq as 'jiboumans'.

Thank you,

--

	Jos Boumans

	&quot;Whenever you find you are on the side of the majority,
	it is time to pause and reflect.&quot; - Mark Twain



<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ubuntu at rabbit-a002</A>:/usr/lib/rabbitmq/lib/rabbitmq_server-2.4.1/plugins 
$ ls
amqp_client-2.4.1.ez  rabbitmq-management-agent-2.4.1.ez   
rabbit_stomp-2.4.1.ez
mochiweb-2.4.1.ez     rabbitmq-mochiweb-2.4.1.ez           
webmachine-2.4.1.ez

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ubuntu at rabbit-a002</A>:/usr/lib/rabbitmq/lib/rabbitmq_server-2.4.1/plugins 
$ sudo rabbitmqctl status
Status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a002</A>' ...
[{pid,30804},
{running_applications,
     [{webmachine,&quot;webmachine&quot;,&quot;1.7.0&quot;},
      {rabbit_management_agent,&quot;RabbitMQ Management Agent&quot;,&quot;2.4.1&quot;},
      {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;2.4.1&quot;},
      {rabbit_mochiweb,&quot;RabbitMQ Mochiweb Embedding&quot;,&quot;2.4.1&quot;},
      {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;1.3&quot;},
      {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.2&quot;},
      {rabbit_stomp,&quot;Embedded Rabbit Stomp Adapter&quot;,&quot;2.4.1&quot;},
      {rabbit,&quot;RabbitMQ&quot;,&quot;2.4.1&quot;},
      {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.4.12&quot;},
      {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.4&quot;},
      {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.8&quot;},
      {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.16.4&quot;},
      {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.13.4&quot;}]},
{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a002</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a001</A>']}]},
{running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a001</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a002</A>']}]
...done.

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ubuntu at rabbit-a002</A>:/usr/lib/rabbitmq/lib/rabbitmq_server-2.4.1/plugins 
$ sudo mv /tmp/rabbitmq-management-2.4.1.ez .

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ubuntu at rabbit-a002</A>:/usr/lib/rabbitmq/lib/rabbitmq_server-2.4.1/plugins 
$ sudo /etc/init.d/rabbitmq-server restart
Restarting rabbitmq-server: FAILED - check /var/log/rabbitmq/ 
startup_{log, _err}
rabbitmq-server.

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ubuntu at rabbit-a002</A>:/usr/lib/rabbitmq/lib/rabbitmq_server-2.4.1/plugins 
$ cat  /var/log/rabbitmq/startup_{log,err}
Activating RabbitMQ plugins ...
*WARNING* Undefined function fdsrv:bind_socket/2
*WARNING* Undefined function fdsrv:start/0
*WARNING* Undefined function fdsrv:stop/0
*WARNING* Undefined function webmachine_resource:start_link/2
7 plugins activated:
* amqp_client-2.4.1
* mochiweb-1.3
* rabbit_stomp-2.4.1
* rabbit_management-2.4.1
* rabbit_management_agent-2.4.1
* rabbit_mochiweb-2.4.1
* webmachine-1.7.0


+---+   +---+
|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   |   |   |
</I>|<i>   +---+   +-------+
</I>|<i>                   |
</I>|<i> RabbitMQ  +---+   |
</I>|<i>           |   |   |
</I>|<i>   v2.4.1  +---+   |
</I>|<i>                   |
</I>+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2011 VMware, Inc.
Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>

node           : <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a002</A>
app descriptor : /usr/lib/rabbitmq/lib/rabbitmq_server-2.4.1/sbin/../ 
ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : soP1A0eax4HhjRzyXNgpFA==
log            : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a002.log</A>
sasl log       : /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a002-sasl.log</A>
database dir   : /var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a002</A>
erlang version : 5.7.4

starting file handle cache  
server                                     ...done
starting worker  
pool                                                  ...done
starting  
database                                                     ...done
starting codec correctness  
check                                      ...done
-- external infrastructure ready
starting plugin  
registry                                              ...done
starting auth mechanism cr- 
demo                                       ...done
starting auth mechanism  
amqplain                                      ...done
starting auth mechanism  
plain                                         ...done
starting statistics event  
manager                                     ...done
starting logging  
server                                               ...done
starting exchange type  
direct                                         ...done
starting exchange type  
fanout                                         ...done
starting exchange type  
headers                                        ...done
starting exchange type  
topic                                          ...done
-- kernel ready
starting alarm  
handler                                                ...done
starting node  
monitor                                                 ...done
starting cluster  
delegate                                             ...done
starting guid  
generator                                               ...done
starting memory  
monitor                                               ...done
-- core initialized
starting empty DB  
check                                               ...done
starting exchange  
recovery                                            ...done
starting management  
agent                                             ...done
starting management statistics  
database                               ...done
starting queue supervisor and queue  
recovery                          ...done
-- message delivery logic ready
starting error log  
relay                                              ...done
starting  
networking                                                   ...done
starting  
direct_client                                                ...done
starting notify cluster  
nodes                                         ...done

broker running
starting STOMP Adapter (binding to [61613])  ...done
** Found 0 name clashes in code paths
{&quot;Kernel pid  
terminated 
&quot;,application_controller,&quot;{application_terminated,rabbit,shutdown}&quot;}
Erlang has closed

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)  
({application_terminated,rabbit,shutdown})

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ubuntu at rabbit-a002</A>:/usr/lib/rabbitmq/lib/rabbitmq_server-2.4.1/plugins 
$ sudo rabbitmqctl status
Status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a002</A>' ...
Error: unable to connect to node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a002</A>': nodedown
diagnostics:
- nodes and their ports on rabbit-a002: [{rabbitmqctl31379,54031}]
- current node: '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmqctl31379 at rabbit-a002</A>'
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: soP1A0eax4HhjRzyXNgpFA==

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ubuntu at rabbit-a002</A>:/usr/lib/rabbitmq/lib/rabbitmq_server-2.4.1/plugins 
$ sudo mv rabbitmq-management-2.4.1.ez /tmp

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ubuntu at rabbit-a002</A>:/usr/lib/rabbitmq/lib/rabbitmq_server-2.4.1/plugins 
$ sudo /etc/init.d/rabbitmq-server restart
Restarting rabbitmq-server: RabbitMQ is not running
SUCCESS
rabbitmq-server.

<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ubuntu at rabbit-a002</A>:/usr/lib/rabbitmq/lib/rabbitmq_server-2.4.1/plugins 
$ sudo rabbitmqctl status
Status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a002</A>' ...
[{pid,31513},
{running_applications,
     [{webmachine,&quot;webmachine&quot;,&quot;1.7.0&quot;},
      {rabbit_management_agent,&quot;RabbitMQ Management Agent&quot;,&quot;2.4.1&quot;},
      {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;2.4.1&quot;},
      {rabbit_mochiweb,&quot;RabbitMQ Mochiweb Embedding&quot;,&quot;2.4.1&quot;},
      {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;1.3&quot;},
      {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.2&quot;},
      {rabbit_stomp,&quot;Embedded Rabbit Stomp Adapter&quot;,&quot;2.4.1&quot;},
      {rabbit,&quot;RabbitMQ&quot;,&quot;2.4.1&quot;},
      {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.4.12&quot;},
      {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.4&quot;},
      {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.8&quot;},
      {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.16.4&quot;},
      {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.13.4&quot;}]},
{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a002</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a001</A>']}]},
{running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a001</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-a002</A>']}]
...done.



</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012332.html">[rabbitmq-discuss] Management UI plugin issue on 2 node cluster
</A></li>
	<LI>Next message: <A HREF="012446.html">[rabbitmq-discuss] Management UI plugin issue on 2 node cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12445">[ date ]</a>
              <a href="thread.html#12445">[ thread ]</a>
              <a href="subject.html#12445">[ subject ]</a>
              <a href="author.html#12445">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
