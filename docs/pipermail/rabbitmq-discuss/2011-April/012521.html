<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] pika behavior when server die
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20pika%20behavior%20when%20server%20die&In-Reply-To=%3CD1D69CE1B2F34698BD25EE366117A3C8%40myyearbook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012518.html">
   <LINK REL="Next"  HREF="012523.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] pika behavior when server die</H1>
    <B>Gavin M. Roy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20pika%20behavior%20when%20server%20die&In-Reply-To=%3CD1D69CE1B2F34698BD25EE366117A3C8%40myyearbook.com%3E"
       TITLE="[rabbitmq-discuss] pika behavior when server die">gmr at myyearbook.com
       </A><BR>
    <I>Sat Apr 23 15:47:00 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012518.html">[rabbitmq-discuss] pika behavior when server die
</A></li>
        <LI>Next message: <A HREF="012523.html">[rabbitmq-discuss] Introducing bunny_farm: an erlang client for	RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12521">[ date ]</a>
              <a href="thread.html#12521">[ thread ]</a>
              <a href="subject.html#12521">[ subject ]</a>
              <a href="author.html#12521">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Saturday, April 23, 2011 at 6:16 AM, can xiang wrote: 
&gt;<i> 5. no_ack = True
</I>&gt;<i> 6. SimpleReconnectionStrategy for reconnection
</I>&gt;<i> 
</I>&gt;<i> When I'm testing the server die scenario. I found three issues:
</I>&gt;<i> 
</I>&gt;<i> ISSUE 1:
</I>&gt;<i> =======
</I>&gt;<i> Stop rabbitmq server, tornado application raises the following exception and become not responsive:
</I>&gt;<i> 
</I>&gt;<i> error: [Errno 111] Connection refused
</I>Hmm interesting point in that. I don't think I've used the SRS+Tornado combination. The exception is expected. Please open an issue at <A HREF="http://github.com/pika/pika">http://github.com/pika/pika</A> and I'll see if I can get a fix so SRS can work. 
&gt;<i> ISSUE2:
</I>&gt;<i> =======
</I>&gt;<i> I tested 800 messages, with slow consumer. while it runs, stop rabbitmq-server with Ctrl+C, consumer is able to continuing consuming message and finish all 800 messages, then it EXIT.
</I>&gt;<i> 
</I>&gt;<i> It's very weird indeed, because the server already gone. Is there any incoming message buffer in pika?
</I>There is an inbound buffer.
&gt;<i> How many messages can be buffered? 
</I>&gt;<i> 
</I>
Never tested for an upward limit on this.
&gt;<i> Are those message stored in memory?
</I>&gt;<i> 
</I>
Yes
Is it possible to configure the memory usage?

No.

I would switch to using Basic.Ack and control when you get a message instead of have the server throw them at you.
&gt;<i> 
</I>&gt;<i> ISSUE3:
</I>&gt;<i> =======
</I>&gt;<i> In my use case, it's very important the tornado application wouldn't die for any reason. If there is anything bad happened to the rabbitmq-server or connection, messaging system can be down-graded as a not functioning part, which can go back automatically when server issues resolved. The long running consuming process shouldn't die or exit when server died or connection broken. Is this requirement sensible enough? 
</I>&gt;<i> 
</I>&gt;<i> I hope SimpleReconnectionStrategy works for my case, which is not. Is there anything wrong in my application code? Or I just roll my own one, any suggestion on how to do it?
</I>It should, I think I'm missing catching the exception here. Please open the issue and I'll see if we can get a fix into 0.9.6 which is ready to be released pending documentation updates.

Thanks,

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110423/e786395e/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110423/e786395e/attachment.htm</A>&gt;
</PRE>













































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012518.html">[rabbitmq-discuss] pika behavior when server die
</A></li>
	<LI>Next message: <A HREF="012523.html">[rabbitmq-discuss] Introducing bunny_farm: an erlang client for	RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12521">[ date ]</a>
              <a href="thread.html#12521">[ thread ]</a>
              <a href="subject.html#12521">[ subject ]</a>
              <a href="author.html#12521">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
