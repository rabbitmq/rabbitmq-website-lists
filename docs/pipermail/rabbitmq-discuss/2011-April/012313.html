<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] server crashes with very fast consumers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20server%20crashes%20with%20very%20fast%20consumers&In-Reply-To=%3C50270.31573.qm%40web31811.mail.mud.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012311.html">
   <LINK REL="Next"  HREF="012381.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] server crashes with very fast consumers</H1>
    <B>alex chen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20server%20crashes%20with%20very%20fast%20consumers&In-Reply-To=%3C50270.31573.qm%40web31811.mail.mud.yahoo.com%3E"
       TITLE="[rabbitmq-discuss] server crashes with very fast consumers">chen650 at yahoo.com
       </A><BR>
    <I>Sat Apr  9 05:12:28 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012311.html">[rabbitmq-discuss] server crashes with very fast consumers
</A></li>
        <LI>Next message: <A HREF="012381.html">[rabbitmq-discuss] server crashes with very fast consumers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12313">[ date ]</a>
              <a href="thread.html#12313">[ thread ]</a>
              <a href="subject.html#12313">[ subject ]</a>
              <a href="author.html#12313">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>John,



&gt;<i> When I run your test, many of the publishers and consumers die because they 
</I>&gt;<i>can't contact the RabbitMQ broker, or can't connect to it in time. This is not 
</I>&gt;<i>surprising, since a small VM with over 1,000 active processes will run very 
</I>&gt;<i>slowly. The failing processes die with messages like &quot;Cannot connect to 
</I>&gt;<i>localhost:5672&quot; and &quot;Opening socket: Connection timed out&quot; and so on.
</I>
Did you use the latest amqp_consumer.c that i sent in my previous email?  it 
re-connects instead of exits in case of connection failure.
<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-March/012099.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2011-March/012099.html</A>
However, you still need run it on a more powerful machine.  the broker crash 
happens when 1000 consumers start consuming messages simultaneously.  To to 
that, you need to have all publishers running at the same time also.  Otherwise, 
if messages in 1000 queues are published sequentially, some consumers will 
finish consuming 3000 messages before others start.  the machine i used for 
testing has 16 GB memory and 8 cpu.  i did not see any publisher got timeout.

&gt;<i> Although these processes were temporarily unable to connect to the RabbitMQ 
</I>&gt;<i>broker, the broker itself seems to behave properly; it processes messages from 
</I>&gt;<i>and to the subset of publishers and consumers that were able to get through the 
</I>&gt;<i>initial connection storm. It had nothing unusual in its log.
</I>
as mentioned above, this is because you did not get all consumers to start 
simultaneously.  


&gt;<i> Could you confirm that this is NOT the failure mode you saw? And how did you 
</I>&gt;<i>know that the RabbitMQ broker had crashed? Did the process go away? Or was it 
</I>&gt;<i>impossible to contact it later on? And how did you try to contact it?
</I>
When it crashed, &quot;ps auxww | grep beam&quot; did not show the broker process 
running.  &quot;rabbmitmqctl list_queues&quot; failed to connect.
&quot;telnet localhost 5672&quot; failed.  

-alex
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110408/2bb6ea2b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110408/2bb6ea2b/attachment.htm</A>&gt;
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012311.html">[rabbitmq-discuss] server crashes with very fast consumers
</A></li>
	<LI>Next message: <A HREF="012381.html">[rabbitmq-discuss] server crashes with very fast consumers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12313">[ date ]</a>
              <a href="thread.html#12313">[ thread ]</a>
              <a href="subject.html#12313">[ subject ]</a>
              <a href="author.html#12313">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
