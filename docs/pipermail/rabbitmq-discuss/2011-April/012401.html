<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [2.4.0] random message loss with Stomp and topics?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5B2.4.0%5D%20random%20message%20loss%20with%20Stomp%20and%0A%20topics%3F&In-Reply-To=%3C4DA859B9.8050102%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012384.html">
   <LINK REL="Next"  HREF="012470.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [2.4.0] random message loss with Stomp and topics?</H1>
    <B>Rob Harrop</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5B2.4.0%5D%20random%20message%20loss%20with%20Stomp%20and%0A%20topics%3F&In-Reply-To=%3C4DA859B9.8050102%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] [2.4.0] random message loss with Stomp and topics?">rob at rabbitmq.com
       </A><BR>
    <I>Fri Apr 15 15:44:09 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012384.html">[rabbitmq-discuss] [2.4.0] random message loss with Stomp and	topics?
</A></li>
        <LI>Next message: <A HREF="012470.html">[rabbitmq-discuss] [2.4.0] random message loss with Stomp and	topics? - solved
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12401">[ date ]</a>
              <a href="thread.html#12401">[ thread ]</a>
              <a href="subject.html#12401">[ subject ]</a>
              <a href="author.html#12401">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Michael,

Are you referring to the tests distributed with Rabbit or do you have 
your own test code that you are running?

I can take a quick guess at why this is failing. The SUBSCRIBE frames 
are processed asynchronously. So, if you issue a few SUBSCRIBEs followed 
by a few SENDs then you might not see MESSAGE frames for the SUBSCRIBEs 
that are yet to finish processing.

The best way to guarantee that a SUBSCRIBE has finished is to provide a 
receipt: header and then wait for the receipt. You'll see this pattern 
quite a lot in the RabbitMQ STOMP tests.

Regards,

Rob

On 14/04/11 08:13, Michael Justin wrote:
&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> Below is a Stomp log for a successful test case which uses a Topic
</I>&gt;<i> destination and two subscribers:
</I>&gt;<i>
</I>&gt;<i> * two different Stomp client connections subscribe to a topic (Stomp
</I>&gt;<i> header frame: &quot;destination:/topic/TestTopic&quot;)
</I>&gt;<i> * the third Stomp client connection sends two messages to this topic
</I>&gt;<i> * the two subscribed clients await the messages
</I>&gt;<i>
</I>&gt;<i> However, the tests show many cases where the broker does not deliver all
</I>&gt;<i> messages to both clients. After the first message, one / two /three
</I>&gt;<i> remaining message are received or not.
</I>&gt;<i>
</I>&gt;<i> Maybe there is an error in the Stomp headers of my client for the send
</I>&gt;<i> or subscribe frames?
</I>&gt;<i>
</I>&gt;<i> All other unit tests - with Queue destinations - pass with 100% success.
</I>&gt;<i>
</I>&gt;<i> I will also try to debug it server-side using the management plugin.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> send:
</I>&gt;<i> CONNECT
</I>&gt;<i> login:guest
</I>&gt;<i> passcode:guest
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> received:
</I>&gt;<i> CONNECTED
</I>&gt;<i> session:session-YVVx2qdlhn5kZwGPvyuE1Q==
</I>&gt;<i> heartbeat:0,0
</I>&gt;<i> version:1.0
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> send:
</I>&gt;<i> SUBSCRIBE
</I>&gt;<i> destination:/topic/TestTopic
</I>&gt;<i> ack:auto
</I>&gt;<i> id:{8D37586E-5D3C-4CCA-9584-9826B53B2B91}
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> send:
</I>&gt;<i> CONNECT
</I>&gt;<i> login:guest
</I>&gt;<i> passcode:guest
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> received:
</I>&gt;<i> CONNECTED
</I>&gt;<i> session:session-i9FpncmwinfGuLXyq1OZIQ==
</I>&gt;<i> heartbeat:0,0
</I>&gt;<i> version:1.0
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> send:
</I>&gt;<i> SUBSCRIBE
</I>&gt;<i> destination:/topic/TestTopic
</I>&gt;<i> ack:auto
</I>&gt;<i> id:{5638253D-3371-4418-8193-CFC38D2C39BD}
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> send:
</I>&gt;<i> CONNECT
</I>&gt;<i> login:guest
</I>&gt;<i> passcode:guest
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> received:
</I>&gt;<i> CONNECTED
</I>&gt;<i> session:session-GIjthMML0HAing/aF+Wtxw==
</I>&gt;<i> heartbeat:0,0
</I>&gt;<i> version:1.0
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> send:
</I>&gt;<i> SUBSCRIBE
</I>&gt;<i> destination:/topic/TestTopic
</I>&gt;<i> ack:auto
</I>&gt;<i> id:{CD4ED764-2A88-4D7A-80CC-F9FA37901D74}
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> send:
</I>&gt;<i> SEND
</I>&gt;<i> destination:/topic/TestTopic
</I>&gt;<i> content-length:5
</I>&gt;<i> delivery-mode:2
</I>&gt;<i> content-type:text/plain
</I>&gt;<i>
</I>&gt;<i> msg 1
</I>&gt;<i>
</I>&gt;<i> send:
</I>&gt;<i> SEND
</I>&gt;<i> destination:/topic/TestTopic
</I>&gt;<i> content-length:5
</I>&gt;<i> delivery-mode:2
</I>&gt;<i> content-type:text/plain
</I>&gt;<i>
</I>&gt;<i> msg 2
</I>&gt;<i>
</I>&gt;<i> received:
</I>&gt;<i> MESSAGE
</I>&gt;<i> delivery-mode:2
</I>&gt;<i> content-type:text/plain
</I>&gt;<i> subscription:{5638253D-3371-4418-8193-CFC38D2C39BD}
</I>&gt;<i> destination:/topic/TestTopic
</I>&gt;<i> message-id:T_{5638253D-3371-4418-8193-CFC38D2C39BD}@@session-i9FpncmwinfGuLXyq1O
</I>&gt;<i>
</I>&gt;<i> ZIQ==@@1
</I>&gt;<i> content-length:5
</I>&gt;<i>
</I>&gt;<i> msg 1
</I>&gt;<i> received:
</I>&gt;<i> MESSAGE
</I>&gt;<i> delivery-mode:2
</I>&gt;<i> content-type:text/plain
</I>&gt;<i> subscription:{CD4ED764-2A88-4D7A-80CC-F9FA37901D74}
</I>&gt;<i> destination:/topic/TestTopic
</I>&gt;<i> message-id:T_{CD4ED764-2A88-4D7A-80CC-F9FA37901D74}@@session-GIjthMML0HAing/aF+W
</I>&gt;<i>
</I>&gt;<i> txw==@@1
</I>&gt;<i> content-length:5
</I>&gt;<i>
</I>&gt;<i> msg 1
</I>&gt;<i> received:
</I>&gt;<i> MESSAGE
</I>&gt;<i> delivery-mode:2
</I>&gt;<i> content-type:text/plain
</I>&gt;<i> subscription:{5638253D-3371-4418-8193-CFC38D2C39BD}
</I>&gt;<i> destination:/topic/TestTopic
</I>&gt;<i> message-id:T_{5638253D-3371-4418-8193-CFC38D2C39BD}@@session-i9FpncmwinfGuLXyq1O
</I>&gt;<i>
</I>&gt;<i> ZIQ==@@2
</I>&gt;<i> content-length:5
</I>&gt;<i>
</I>&gt;<i> msg 2
</I>&gt;<i> received:
</I>&gt;<i> MESSAGE
</I>&gt;<i> delivery-mode:2
</I>&gt;<i> content-type:text/plain
</I>&gt;<i> subscription:{CD4ED764-2A88-4D7A-80CC-F9FA37901D74}
</I>&gt;<i> destination:/topic/TestTopic
</I>&gt;<i> message-id:T_{CD4ED764-2A88-4D7A-80CC-F9FA37901D74}@@session-GIjthMML0HAing/aF+W
</I>&gt;<i>
</I>&gt;<i> txw==@@2
</I>&gt;<i> content-length:5
</I>&gt;<i>
</I>&gt;<i> msg 2
</I>&gt;<i> send:
</I>&gt;<i> DISCONNECT
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> send:
</I>&gt;<i> DISCONNECT
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> send:
</I>&gt;<i> DISCONNECT
</I>&gt;<i>
</I>&gt;<i> Regards
</I></PRE>




























































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012384.html">[rabbitmq-discuss] [2.4.0] random message loss with Stomp and	topics?
</A></li>
	<LI>Next message: <A HREF="012470.html">[rabbitmq-discuss] [2.4.0] random message loss with Stomp and	topics? - solved
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12401">[ date ]</a>
              <a href="thread.html#12401">[ thread ]</a>
              <a href="subject.html#12401">[ subject ]</a>
              <a href="author.html#12401">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
