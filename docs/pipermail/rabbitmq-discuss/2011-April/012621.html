<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] For speed, use Shovel or not?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20For%20speed%2C%20use%20Shovel%20or%20not%3F&In-Reply-To=%3CF586C4A5-2165-4C6A-915A-28F32B68C0E2%40jbrisbin.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012620.html">
   <LINK REL="Next"  HREF="012622.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] For speed, use Shovel or not?</H1>
    <B>Jon Brisbin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20For%20speed%2C%20use%20Shovel%20or%20not%3F&In-Reply-To=%3CF586C4A5-2165-4C6A-915A-28F32B68C0E2%40jbrisbin.com%3E"
       TITLE="[rabbitmq-discuss] For speed, use Shovel or not?">jon at jbrisbin.com
       </A><BR>
    <I>Thu Apr 28 19:18:19 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012620.html">[rabbitmq-discuss] For speed, use Shovel or not?
</A></li>
        <LI>Next message: <A HREF="012622.html">[rabbitmq-discuss] For speed, use Shovel or not?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12621">[ date ]</a>
              <a href="thread.html#12621">[ thread ]</a>
              <a href="subject.html#12621">[ subject ]</a>
              <a href="author.html#12621">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It's been languishing in a corner for several months since I've been rather busy, but I wrote a &quot;job scheduler&quot; utility for RabbitMQ at a previous employer. It has a bunch of different things in it but one of them is a BatchMessageHandler. It listens for zip files coming in, unzips them, dumps them into a broker, collects the results, zips them up, then responds to the sender with a zip file of results.

This was to take the place of a somewhat similar system they have where requests from remote WAN nodes are batched, zipped and sent to the datacenter to be executed by a proxy (because of slow WAN pipes).

I'd like to revisit some of this code at some point because there's some pretty neat functionality here, I think, and it could use some love to update it to the latest spring-amqp version and whatnot.

It's not an &quot;unzip it and run it&quot; thing, but it might be a jumping-off point for something like what you describe.


Thanks!

Jon Brisbin

<A HREF="http://jbrisbin.com">http://jbrisbin.com</A>
Twitter: @j_brisbin


On Apr 28, 2011, at 1:01 PM, Gene Campbell wrote:

&gt;<i> Thank you for the response.    Great one for a FAQ.  The confirmation of batching and compression not being in Shovel is something we until now we couldn't confirm.  (Therefore it's usefulness to us just dropped a bit.)
</I>&gt;<i> 
</I>&gt;<i> The value of being able to ACK back fast, and let a client continue on, while giving some comfort going forward that the message will actually be consumed somewhere after some length of time.  For example, if you can stand 1 minute of latency from publish to consume, but you're client needs an ACK, it will need to store potentially large amounts of data (if your link goes down) until it gets the ACK (link comes back up and message consumed.)  With shovel, it can get a quicker ACK.
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> Gene
</I>&gt;<i> 
</I>&gt;<i> On Thu, Apr 28, 2011 at 5:22 AM, Matthew Sackman &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthew at rabbitmq.com</A>&gt; wrote:
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> On Sun, Apr 24, 2011 at 02:13:13PM -0700, ristretto.rb wrote:
</I>&gt;<i> &gt; Suppose there are two servers connected across a WAN (read internet),
</I>&gt;<i> &gt; sending transient messages, with all else held constant what is the
</I>&gt;<i> &gt; faster method in terms of messages / sec:  Two brokers and a Shovel,
</I>&gt;<i> &gt; one broker with a remote publisher, or one broker with a remote
</I>&gt;<i> &gt; consumer.  (The last two cases might be really just one case.)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; msg -&gt; X -&gt; Q -&gt; Shovel -&gt; X -&gt; Q -&gt; Consume
</I>&gt;<i> &gt; vs
</I>&gt;<i> &gt; msg ---------------------------&gt; X -&gt; Q -&gt; Consume
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; What if durability is required?  Does this change the decision?
</I>&gt;<i> 
</I>&gt;<i> Regardless of whether you're using the shovel or not, over the WAN link
</I>&gt;<i> will flow AMQP msgs over TCP/IP. There is no compression or any batching
</I>&gt;<i> used by shovel, so your throughput and latency won't be different in any
</I>&gt;<i> of the combinations you suggest.
</I>&gt;<i> 
</I>&gt;<i> However, you might wish for, eg the publisher to very quickly be able to
</I>&gt;<i> publish a msg and get a confirmation back that the msg has been
</I>&gt;<i> published and accepted by the broker. If the latency of this operation
</I>&gt;<i> is important then it makes sense to have the broker near the publisher.
</I>&gt;<i> 
</I>&gt;<i> The next thing to consider is whether it's actually going to make any
</I>&gt;<i> difference to the consumer whether or not it's got a broker very near
</I>&gt;<i> it. For example, is it going to be doing any synchronous operations
</I>&gt;<i> regularly. If not (i.e. it's just receiving msgs and acking them), then
</I>&gt;<i> there probably isn't much difference whether it's connected to a local
</I>&gt;<i> broker or a remote one.
</I>&gt;<i> 
</I>&gt;<i> Matthew
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110428/b18c7003/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110428/b18c7003/attachment.htm</A>&gt;
</PRE>






























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012620.html">[rabbitmq-discuss] For speed, use Shovel or not?
</A></li>
	<LI>Next message: <A HREF="012622.html">[rabbitmq-discuss] For speed, use Shovel or not?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12621">[ date ]</a>
              <a href="thread.html#12621">[ thread ]</a>
              <a href="subject.html#12621">[ subject ]</a>
              <a href="author.html#12621">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
