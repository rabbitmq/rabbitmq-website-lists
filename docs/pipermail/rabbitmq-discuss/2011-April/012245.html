<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ crashes when messages are being pumped into a queue under win32 envir
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20crashes%20when%20messages%20are%20being%0A%20pumped%20into%20a%20queue%20under%20win32%20envir&In-Reply-To=%3CF78BCF638F95D74A99D036114107EDB5028DD5DDAB%40EXCH-MBX-3.vmware.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012491.html">
   <LINK REL="Next"  HREF="012246.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ crashes when messages are being pumped into a queue under win32 envir</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20crashes%20when%20messages%20are%20being%0A%20pumped%20into%20a%20queue%20under%20win32%20envir&In-Reply-To=%3CF78BCF638F95D74A99D036114107EDB5028DD5DDAB%40EXCH-MBX-3.vmware.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ crashes when messages are being pumped into a queue under win32 envir">jerryk at vmware.com
       </A><BR>
    <I>Mon Apr  4 01:26:35 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012491.html">[rabbitmq-discuss] Cluster size limit
</A></li>
        <LI>Next message: <A HREF="012246.html">[rabbitmq-discuss] RabbitMQ crashes when messages are being pumped into a queue under win32 envir
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12245">[ date ]</a>
              <a href="thread.html#12245">[ thread ]</a>
              <a href="subject.html#12245">[ subject ]</a>
              <a href="author.html#12245">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> 1.  using RabbitMQ2.4.0(windows bundle).winxp, creates an exchange and
</I>&gt;<i> a queue.
</I>&gt;<i>
</I>&gt;<i> 2.  use multiple sender to send messages into the created queue, only
</I>&gt;<i> a single receiver receiving message from the same queue.
</I>&gt;<i>
</I>&gt;<i> 3.  while running, what i discovered is that the ERL's RAM usage
</I>&gt;<i> continue to increase and then crash when it reaches a certain
</I>&gt;<i> percentage
</I>&gt;<i>
</I>&gt;<i> Is there a way to prevent it from crashing?
</I>
Hi, Ming...

We actually have a bug reported, with a fix checked in, but not yet
released, that could account for some of the trouble you've had.

In the past, when a message was delivered to a client, but an ACK was
still pending, the broker would keep the entire message in a pending
ACK table so that if another queue wanted to read the message, it
would get the same Erlang binary data, rather than have a duplicate
created, which would use more memory.

Currently, the broker holds on to the full message in this pending ACK
table, only if the message hasn't already been written to disk;
otherwise, the binary gets thrown away, and the de-duplication
mechanism serves no purpose.  Since the deduplication scheme was a bit
buggy, it was possible for the deduplication cache to end up filled
with the entire contents of a queue under certain conditions.  This
could eat a lot of memory and cause the broker's Erlang VM trouble.
Worse still, because this could happen when only consumption was
occurring, there was nothing that the TCP back pressure and
memory-based flow control mechanism (which can pause an overly
vigorous publisher) could do about it.

The fix will appear in an upcoming release.  You may want to keep an
eye out for mention of it in the release notes, and see if your
symptoms relent after you've upgraded to that version.

Best regards,
Jerry
</PRE>
















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012491.html">[rabbitmq-discuss] Cluster size limit
</A></li>
	<LI>Next message: <A HREF="012246.html">[rabbitmq-discuss] RabbitMQ crashes when messages are being pumped into a queue under win32 envir
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12245">[ date ]</a>
              <a href="thread.html#12245">[ thread ]</a>
              <a href="subject.html#12245">[ subject ]</a>
              <a href="author.html#12245">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
