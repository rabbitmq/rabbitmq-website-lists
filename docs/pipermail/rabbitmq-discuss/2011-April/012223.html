<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Pika 0.9.5 UserWarning: Write buffer exceeded warning threshold
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Pika%200.9.5%20UserWarning%3A%20Write%20buffer%0A%20exceeded%20warning%20threshold&In-Reply-To=%3C9893425D704542C681C0B860BB358236%40myyearbook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="012221.html">
   <LINK REL="Next"  HREF="012222.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Pika 0.9.5 UserWarning: Write buffer exceeded warning threshold</H1>
    <B>Gavin M. Roy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Pika%200.9.5%20UserWarning%3A%20Write%20buffer%0A%20exceeded%20warning%20threshold&In-Reply-To=%3C9893425D704542C681C0B860BB358236%40myyearbook.com%3E"
       TITLE="[rabbitmq-discuss] Pika 0.9.5 UserWarning: Write buffer exceeded warning threshold">gmr at myyearbook.com
       </A><BR>
    <I>Fri Apr  1 04:14:20 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="012221.html">[rabbitmq-discuss] Pika 0.9.5 UserWarning: Write buffer exceeded	warning threshold
</A></li>
        <LI>Next message: <A HREF="012222.html">[rabbitmq-discuss] Fault-tolerant subscriptions using the .NET	client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12223">[ date ]</a>
              <a href="thread.html#12223">[ thread ]</a>
              <a href="subject.html#12223">[ subject ]</a>
              <a href="author.html#12223">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thursday, March 31, 2011 at 11:00 PM, can xiang wrote:
&gt;<i> I'm evaluating a messaging system for my web project. I give rabbitmq 2.4.0 and pika 0.9.5 a try, today. It works unbelievably fine. 
</I>&gt;<i> 
</I>

Glad to hear it :)

&gt;<i> Below is what I'm doing:
</I>&gt;<i> 
</I>&gt;<i> 1. Use pika with tornado 1.0,  which uses TornadoConnection adapter
</I>&gt;<i>  2. only produce message in tornado handler, no consumer in tornado
</I>&gt;<i> 3. use 3 standalone round-robin worker as consumer
</I>&gt;<i> 
</I>&gt;<i> I did a 1million &quot;hello word&quot; test with &quot;ab -n 1000000 -c 10 <A HREF="http://localhost/helloword&quot;.">http://localhost/helloword&quot;.</A> Message flows at 2000+message/s and 100% message receive, all good except I get the following warning in tornado process:
</I>&gt;<i> 
</I>&gt;<i> /usr/local/lib/python2.6/dist-packages/pika-0.9.5-py2.6.egg/pika/connection.py:642: UserWarning: Pika: Write buffer exceeded warning threshold at 1271 bytes and an estimated 21 frames behind
</I>Pika attempts to detect TCP Back-pressure by watching your average frame size over a rolling window and then detecting when the output buffer exceeds the average frame size multiplied by a configurable multiplier which is 10 by default.

<A HREF="http://pika.github.com/connecting.html#tcp-backpressure">http://pika.github.com/connecting.html#tcp-backpressure</A>

What is happening is you're publishing faster than you're consuming (since you're not consuming) and RabbitMQ is throttling you. Pika is raising warnings so you can respond accordingly in your code. If you want to ignore these warnings you can do the following:

from warnings import simplefilter
simplefilter(&quot;ignore&quot;, &quot;user&quot;)

Alternatively you can increase the multiplier to delay when you'll be notified via warning:

connection.set_backpressure_multiplier(100) 

Where 100 is the value you want the multiplier to be.

However. if you do this and put too many messages into RabbitMQ without consuming, you will run into problems with RabbitMQ and your messages will not be sent.

What I would do is warnings.catch_warnings to respond in your application appropriately:

<A HREF="http://docs.python.org/library/warnings.html#warnings.catch_warnings">http://docs.python.org/library/warnings.html#warnings.catch_warnings</A>

I hope this helps!

Gavin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/e4a11973/attachment-0001.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20110331/e4a11973/attachment-0001.htm</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="012221.html">[rabbitmq-discuss] Pika 0.9.5 UserWarning: Write buffer exceeded	warning threshold
</A></li>
	<LI>Next message: <A HREF="012222.html">[rabbitmq-discuss] Fault-tolerant subscriptions using the .NET	client
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#12223">[ date ]</a>
              <a href="thread.html#12223">[ thread ]</a>
              <a href="subject.html#12223">[ subject ]</a>
              <a href="author.html#12223">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
