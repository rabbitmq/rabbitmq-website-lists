<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> No subject
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20No%20subject&In-Reply-To=%3Cmailman.22.1316794772.2895.rabbitmq-discuss%40lists.rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015174.html">
   <LINK REL="Next"  HREF="015342.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>No subject</H1>
    <B></B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20No%20subject&In-Reply-To=%3Cmailman.22.1316794772.2895.rabbitmq-discuss%40lists.rabbitmq.com%3E"
       TITLE="No subject">
       </A><BR>
    <I>Tue Apr 12 10:32:41 BST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="015174.html">No subject
</A></li>
        <LI>Next message: <A HREF="015342.html">No subject
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15246">[ date ]</a>
              <a href="thread.html#15246">[ thread ]</a>
              <a href="subject.html#15246">[ subject ]</a>
              <a href="author.html#15246">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>insofar as the array of servers is dynamic, I'm hoping my desire to
use a single message over a &quot;fanout&quot; exchange will make some sense (as
opposed to having to send a single message to each server via a named
queue (or perhaps routing key) that would require me to have a list of
all of the servers in advance of publishing).

Which brings me to my question(s): when you say: &quot;The broker, in turn,
will only acknowledge the message if . . . 2) it has been delivered to
a consumer on each of the queues it had reached&quot;--does this mean that
the broker (in this case, fanout exchange) will only send an ack to
the publisher after a consumer on each of the attached queues has been
reached? After some very rough testing with multiple consumers
attached to the same fanout exchange, it has appeared to me that the
publisher may get an ack prior to one of the consumers sending its ack
back to the broker. This may just be the result of bad test code (on
my part) *or* it may relate the fact that I am using temporary queues
(e.g., channel.queueDeclare().getQueue()) rather than durable queues,
as you suggest below. If that latter is the case, are you suggesting
that using durable queues would make the broker wait on all consumers
for all of the queues before returning an ack to the publisher? If so,
that sounds like it would do the trick.

Sorry again, for being so verbose and thanks very much for your help.

Cheers,
Jonathan

On Sep 23, 5:58=C2=A0am, Alexandru Scvor=C5=A3ov &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexan... at rabbitmq.com</A>&gt; w=
rote:
&gt;<i> Hi Jonathan,
</I>&gt;<i>
</I>&gt;<i> &gt; I apologize if this is an ill-informed question: In a nutshell, the
</I>&gt;<i> &gt; thing I am trying to accomplish is blocking a producer until it has
</I>&gt;<i> &gt; received acks (or even nacks) from all consumers on temporary queues
</I>&gt;<i> &gt; bound to a given (fanout) exchange for a single message. From the
</I>&gt;<i> &gt; docs, my sense is that using confirms and waitForConfirms would be
</I>&gt;<i> &gt; preferable to full on transactions,
</I>&gt;<i>
</I>&gt;<i> Confirms are usually the way to go.
</I>&gt;<i>
</I>&gt;<i> With confirms enabled, calling waitForConfirms would block the producer
</I>&gt;<i> until all published messages on that channel are acknowledged *by the
</I>&gt;<i> broker*. =C2=A0The broker, in turn, will only acknowledge the message if =
</I>1)
&gt;<i> it has been persisted to disk; *or* if 2) it has been delivered to a
</I>&gt;<i> consumer on each of the queues it had reached.
</I>&gt;<i>
</I>&gt;<i> You can't really specify that you only want the acknowledgement if the
</I>&gt;<i> messages are delivered and not if they're persisted.
</I>&gt;<i>
</I>&gt;<i> Also, you said &quot;temporary queues&quot;. =C2=A0Confirms will only work as descr=
</I>ibed
&gt;<i> above if the message is persistent and if the queues it lands on are
</I>&gt;<i> durable. =C2=A0A message that lands on a non-durable queue is considered
</I>&gt;<i> acknowledged on that queue immediately (of course, the broker will still
</I>&gt;<i> wait for it to be persisted or acknowledged on all the other queues it
</I>&gt;<i> reached, before acknowledging it to the producer).
</I>&gt;<i>
</I>&gt;<i> &gt; but as each instance of the
</I>&gt;<i> &gt; producer will be on its own thread,
</I>&gt;<i>
</I>&gt;<i> That's fine. =C2=A0Just make sure to use a separate channel for each
</I>&gt;<i> producer (calling waitForConfirms on the same channel from multiple
</I>&gt;<i> threads will almost certainly not do what you want it to).
</I>&gt;<i>
</I>&gt;<i> &gt; The main point of confusion for me here is whether I can get multiple
</I>&gt;<i> &gt; acks (from all consumers) for one message without having any prior
</I>&gt;<i> &gt; information about the number of queues attached to the exchange. That
</I>&gt;<i> &gt; is, I don't just want to know that one queue has received the message,
</I>&gt;<i> &gt; but that all queues bound to the exchange have done so. It seems clear
</I>&gt;<i>
</I>&gt;<i> Not quite sure what you mean. =C2=A0A published message, even if it gets =
</I>sent
&gt;<i> to multiple queues, is still *one* message with a certain sequence
</I>&gt;<i> number. =C2=A0A published message will be acknowledged by the broker only
</I>&gt;<i> once, when it has been written to disk or when it has been successfully
</I>&gt;<i> sent to a consumer from each queue.
</I>&gt;<i>
</I>&gt;<i> Consumer acks and publisher acks are completely different things. =C2=A0A
</I>&gt;<i> consumer acks a message to tell *the broker* (not the publisher) that it
</I>&gt;<i> has taken responsibility for the message (by using it up, by forwarding
</I>&gt;<i> it, by doing something with it). =C2=A0The broker acks a message to tell =
</I>*the
&gt;<i> publisher* that it has taken responsibility for the message (by saving
</I>&gt;<i> it to disk, or by handing it over to consumers).
</I>&gt;<i>
</I>&gt;<i> When a message reaches a queue, and is then delivered to a consumer, the
</I>&gt;<i> broker will consider the message delivered only when the consumer
</I>&gt;<i> acknowledges it. =C2=A0So, if it weren't for the &quot;writing the message to
</I>&gt;<i> disk&quot; part, it would work exactly the way you're expecting it to.
</I>&gt;<i>
</I>&gt;<i> What sort of system are you designing?
</I>&gt;<i>
</I>&gt;<i> Hope this helps.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Alex
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Sep 22, 2011 at 12:22:50PM -0700, gneeri wrote:
</I>&gt;<i> &gt; I apologize if this is an ill-informed question: In a nutshell, the
</I>&gt;<i> &gt; thing I am trying to accomplish is blocking a producer until it has
</I>&gt;<i> &gt; received acks (or even nacks) from all consumers on temporary queues
</I>&gt;<i> &gt; bound to a given (fanout) exchange for a single message. From the
</I>&gt;<i> &gt; docs, my sense is that using confirms and waitForConfirms would be
</I>&gt;<i> &gt; preferable to full on transactions, but as each instance of the
</I>&gt;<i> &gt; producer will be on its own thread, I am open to using transactions.
</I>&gt;<i> &gt; The main point of confusion for me here is whether I can get multiple
</I>&gt;<i> &gt; acks (from all consumers) for one message without having any prior
</I>&gt;<i> &gt; information about the number of queues attached to the exchange. That
</I>&gt;<i> &gt; is, I don't just want to know that one queue has received the message,
</I>&gt;<i> &gt; but that all queues bound to the exchange have done so. It seems clear
</I>&gt;<i> &gt; that if I send one message per attached queue, I could create a set of
</I>&gt;<i> &gt; seqNos and check against that to verify acks for all of the messages,
</I>&gt;<i> &gt; but without a list of bound queues (which I cannot see how to get),
</I>&gt;<i> &gt; that does not seem like an option. In any case, it seems likely that
</I>&gt;<i> &gt; there is something that I am missing here. That said, I would
</I>&gt;<i> &gt; appreciate any thoughts (or even clarifying questions) on this.
</I>&gt;<i>
</I>&gt;<i> &gt; Thanks,
</I>&gt;<i> &gt; Jonathan
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.com</A>
</I>&gt;<i> &gt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-disc... at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mai=
</I>lman/listinfo/rabbitmq-discuss
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015174.html">No subject
</A></li>
	<LI>Next message: <A HREF="015342.html">No subject
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15246">[ date ]</a>
              <a href="thread.html#15246">[ thread ]</a>
              <a href="subject.html#15246">[ subject ]</a>
              <a href="author.html#15246">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
