<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Strange reaction to publishing message with	invalid expiration.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Strange%20reaction%20to%20publishing%20message%20with%0A%09invalid%20expiration.&In-Reply-To=%3C513F407B.2040403%40noaa.gov%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025921.html">
   <LINK REL="Next"  HREF="025880.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Strange reaction to publishing message with	invalid expiration.</H1>
    <B>James Gardner</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Strange%20reaction%20to%20publishing%20message%20with%0A%09invalid%20expiration.&In-Reply-To=%3C513F407B.2040403%40noaa.gov%3E"
       TITLE="[rabbitmq-discuss] Strange reaction to publishing message with	invalid expiration.">james.gardner at noaa.gov
       </A><BR>
    <I>Tue Mar 12 14:49:31 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025921.html">[rabbitmq-discuss] Invitacion: Cursos Redes Sociales,	Email Marketing, Posicionamiento web...
</A></li>
        <LI>Next message: <A HREF="025880.html">[rabbitmq-discuss] Strange reaction to publishing message with invalid expiration.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25878">[ date ]</a>
              <a href="thread.html#25878">[ thread ]</a>
              <a href="subject.html#25878">[ subject ]</a>
              <a href="author.html#25878">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,
I found a behavior which, to me at least, acts more like a bug than a 
feature...
It seems that when you publish a message with an invalid expiration 
string (eg. &quot;blah&quot;), it renders that channel inoperable for consume 
operations afterwards. I would think it should just discard the message.
In the official Java client, something closes the channel, although I 
don't get any exception until I try to use it for the ensuing consume 
operation.
In the PHP AMQP client (this one: 
<A HREF="http://www.php.net/manual/en/book.amqp.php">http://www.php.net/manual/en/book.amqp.php</A>), the channel stays open but 
when you execute $queue-&gt;consume(...) and look in the management 
interface you can see it has not registered as a consumer on the queue 
of interest.
Given the commonalities, I assume these are different client 
interpretations of the same broker behavior. I am not using transactions 
or publisher confirms or anything fancy. I am less familiar with the 
Java client so perhaps I am missing some sort of error handling?

RabbitMQ version: RabbitMQ 3.0.3, Erlang R14B04 on RHEL 6.4
PHP AMQP version is 1.0.1 (admittedly a little outdated)
Java client is version: 3.0.3

I can provide code for either client if you would like but I imagine you 
can replicate it easily just by establishing a connection, then a single 
channel, then publishing the 'bad' msg to a topic exchange, then trying 
to consume off a queue bound to that exchange with '#'.
When you change expiration to a valid string integer, everything works 
as you would wish.

Of course one answer, as the doctor joke goes, is to not 'move your arm 
like that'. Which is fine so long as there's a choice, but if I were 
creating messages and taking the expiration from a source outside my 
program (eg. database), this error might occur at some point if the data 
were bad. I could/should(?) sanitize/verify first of course, the point 
is more that I thought the typical broker reaction to illegal data was 
to deal with it 'silently' (as it does with an illegal user_id, for 
example) rather than effectively make the channel unusable.
Is there a different way I (or the client code) should be handling this 
or is this an unexpected broker behavior?
Thanks,

James Gardner
NWS - Internet Dissemination System


</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025921.html">[rabbitmq-discuss] Invitacion: Cursos Redes Sociales,	Email Marketing, Posicionamiento web...
</A></li>
	<LI>Next message: <A HREF="025880.html">[rabbitmq-discuss] Strange reaction to publishing message with invalid expiration.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25878">[ date ]</a>
              <a href="thread.html#25878">[ thread ]</a>
              <a href="subject.html#25878">[ subject ]</a>
              <a href="author.html#25878">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
