<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Recovery after heartbeat error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Recovery%20after%20heartbeat%20error&In-Reply-To=%3C8F88806A-D3FC-4677-ABD6-90795AAED9CA%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025785.html">
   <LINK REL="Next"  HREF="025787.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Recovery after heartbeat error</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Recovery%20after%20heartbeat%20error&In-Reply-To=%3C8F88806A-D3FC-4677-ABD6-90795AAED9CA%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Recovery after heartbeat error">tim at rabbitmq.com
       </A><BR>
    <I>Thu Mar  7 13:59:32 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025785.html">[rabbitmq-discuss] Recovery after heartbeat error
</A></li>
        <LI>Next message: <A HREF="025787.html">[rabbitmq-discuss] Recovery after heartbeat error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25786">[ date ]</a>
              <a href="thread.html#25786">[ thread ]</a>
              <a href="subject.html#25786">[ subject ]</a>
              <a href="author.html#25786">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>And .... looking at the title of the post (I got lost in the details and forgot) ....

If a heartbeat error/timeout has occurred, then definitely just throw away all the channels for the connection - they're done and attempting to close them is the wrong thing to do in that situation.

Cheers,
Tim 

On 7 Mar 2013, at 13:58, Tim Watson wrote:

&gt;<i> On 7 Mar 2013, at 13:28, Ioannis Foukarakis wrote:
</I>&gt;&gt;<i> [snip]
</I>&gt;&gt;<i> However, if I disconnect from the network, channel.close() blocks.
</I>&gt;<i> 
</I>&gt;<i> Yes, this is *normal* behaviour for a networked application... When you pull the network cable (or take whatever equivalent action disconnects from the network) then the AMQP channel.close protocol has a slight problem. The client sends 'close' and waits for the server to respond with 'close-ok' - but if the server is gone, what then!? Usually the client then blocks until the operating system 'notices' that the peer socket is gone (because transmission retry limits have been exhausted, tcp keep-alives are enabled, etc). There are various conditions that determine this 'delay' and it can take up to 30 mins with some operating systems' default TCP configuration, before the application is notified with ETIMEDOUT. This exception occurs on the connection object, i.e., when the network failure is finally noticed it forces the connection to close. The channels will also be closed by the client (when it notices that the connection has been terminated).
</I>&gt;<i> 
</I>&gt;&gt;<i> Should I avoid trying to close channels? Is there a better solution for handling network errors?
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Yes, if you knew for certain there has been a network failure, then you should skip closing channels. The shutdown signal means that the 'other end' has closed so calling a synchronous AMQP method like channel.close after than is always going to block.
</I>&gt;<i> 
</I>&gt;<i> If you have a very unreliable network then just rely on the heartbeats to terminate the connection (and therefore the channels) in a timely fashion. If you *need* to close channels more often than that, then you might need to put some kind of timeout around the channel.close() call.
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> Tim
</I>
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025785.html">[rabbitmq-discuss] Recovery after heartbeat error
</A></li>
	<LI>Next message: <A HREF="025787.html">[rabbitmq-discuss] Recovery after heartbeat error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25786">[ date ]</a>
              <a href="thread.html#25786">[ thread ]</a>
              <a href="subject.html#25786">[ subject ]</a>
              <a href="author.html#25786">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
