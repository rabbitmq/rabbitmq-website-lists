<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Diagnosing RabbitMQ Network Partition Problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Diagnosing%20RabbitMQ%20Network%20Partition%20Problem&In-Reply-To=%3C87ECD7D4440F46428FED954BB43A39BF05D58B0C%40EXCHANGE.hq.overdrive.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025994.html">
   <LINK REL="Next"  HREF="026013.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Diagnosing RabbitMQ Network Partition Problem</H1>
    <B>Nick Slowes</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Diagnosing%20RabbitMQ%20Network%20Partition%20Problem&In-Reply-To=%3C87ECD7D4440F46428FED954BB43A39BF05D58B0C%40EXCHANGE.hq.overdrive.com%3E"
       TITLE="[rabbitmq-discuss] Diagnosing RabbitMQ Network Partition Problem">nslowes at overdrive.com
       </A><BR>
    <I>Mon Mar 18 18:02:43 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025994.html">[rabbitmq-discuss] Getting error when starting database
</A></li>
        <LI>Next message: <A HREF="026013.html">[rabbitmq-discuss] Diagnosing RabbitMQ Network Partition Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25995">[ date ]</a>
              <a href="thread.html#25995">[ thread ]</a>
              <a href="subject.html#25995">[ subject ]</a>
              <a href="author.html#25995">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

 

I am running a RabbitMQ cluster with two nodes and they continue to
periodically experience a network partition.  They are physically
located in the same data center and their network should be reliable.
When I check their logs, both servers report the
&quot;running_partitioned_network&quot; error at about the same time and both
nodes continue running, so I don't think it is a hardware failure or one
of the nodes terminating unexpectedly.  I modified the net_ticktime to
120 seconds to try to mitigate the problem, and it stopped occurring for
almost a month, but it recently started occurring again once every few
days.  Now I am not sure if the net_ticktime helped or if it was just
coincidence.

 

In order to troubleshoot further, I started a rolling network trace
using Wireshark and used a scheduled task to halt the trace when the
nodes became partitioned again.  My goal is to determine whether the
partition is caused by unreliable network, or if the application failed
to respond.  Nothing in the packet trace jumps out as showing a network
failure, there are only a handful of TCP retransmissions and plenty of
other packets are sent successfully between them.  

 

At this point I am not sure what else to look at in the packet trace to
either prove or disprove that the network caused the failure.  Wireshark
can identify and decode the Erlang Distribution Protocol, but I don't
know how to interpret the messages to know what would cause nodes to
detect a partition.  Also, the net_ticktime is set to 120 seconds, and I
do not see a 120 second gap in the servers receiving messages from each
other.  The longest gap in which no Erlang messages are received from
the other server is 22 seconds (much less if you count the TCP
acknowledgements).  My only other thought is that if a particular &quot;ping&quot;
type message needs to be sent between the nodes and that particular
messages was interrupted, but I don't know what that would look like in
the trace.

 

Any ideas on how to diagnose the cause of a network partition would be
appreciated.

 

Thanks,

-Nick Slowes

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/d41dddfb/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130318/d41dddfb/attachment.htm</A>&gt;
</PRE>
































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025994.html">[rabbitmq-discuss] Getting error when starting database
</A></li>
	<LI>Next message: <A HREF="026013.html">[rabbitmq-discuss] Diagnosing RabbitMQ Network Partition Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25995">[ date ]</a>
              <a href="thread.html#25995">[ thread ]</a>
              <a href="subject.html#25995">[ subject ]</a>
              <a href="author.html#25995">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
