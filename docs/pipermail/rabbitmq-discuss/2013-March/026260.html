<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ server connections close issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20server%20connections%20close%20issue&In-Reply-To=%3CCAHWt7w2Mfi3pQ8%3D7ZDuBZJVoX2PJqkCOty6YKLL%2B7gd_2SWoGQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026258.html">
   <LINK REL="Next"  HREF="026261.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ server connections close issue</H1>
    <B>Dmitry Saprykin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20server%20connections%20close%20issue&In-Reply-To=%3CCAHWt7w2Mfi3pQ8%3D7ZDuBZJVoX2PJqkCOty6YKLL%2B7gd_2SWoGQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ server connections close issue">saprykin.dmitry at gmail.com
       </A><BR>
    <I>Fri Mar 29 08:45:53 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026258.html">[rabbitmq-discuss] Same consumer getting the rejected message again
</A></li>
        <LI>Next message: <A HREF="026261.html">[rabbitmq-discuss] Blocking connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26260">[ date ]</a>
              <a href="thread.html#26260">[ thread ]</a>
              <a href="subject.html#26260">[ subject ]</a>
              <a href="author.html#26260">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

We experience a problem with rabbitMQ connection closed by client by
timeout. I cannot find any solution so I would very appreciate any help.

Our setup is following:

R14B04 erlang with hipe
rabbitmq is hipe compiled
2 RabbitMQ 3.0.4 (3.0.0 earlier with the same problem) clustered nodes
durable queue is mirrored between nodes
from 400 to 600 messages per seconds
rabbitmq-c clients with 200 ms timeout
clients use non persistent connections ( sender opens connection, publish
message, closes connection. consumer opens connection, gets N messages,
closes connection, restarts )
tcp_listener keepalive is enabled

Initially everything goes fine. But some connection are closed by client by
timeout.
It seems to me that these connection are not closed inside of RabbitMQ so
connection time steadily grows and after approx 1 day cluster average
connect time become above 200 ms.

rabbitmqctl stop_app &amp;&amp; rabbitmqctl start_app resolves problem for one more
day.

tcpdump shows that client connection timeout occures before server sends
capabilities package.
after 10 seconds in rabbit error log appears handshake_timeout exception.

Initially (netstat -nt | wc -l) and (rabbitmqctl list_connections | wc -l)
shows very close counts
When everything goes bad  (rabbitmqctl list_connections | wc -l) twice as
much connections than (netstat -nt | wc -l)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130329/709f97e2/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130329/709f97e2/attachment.htm</A>&gt;
</PRE>
















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026258.html">[rabbitmq-discuss] Same consumer getting the rejected message again
</A></li>
	<LI>Next message: <A HREF="026261.html">[rabbitmq-discuss] Blocking connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26260">[ date ]</a>
              <a href="thread.html#26260">[ thread ]</a>
              <a href="subject.html#26260">[ subject ]</a>
              <a href="author.html#26260">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
