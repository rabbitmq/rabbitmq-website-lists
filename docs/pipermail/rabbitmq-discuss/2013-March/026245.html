<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbit%20MQ%3A%20Improve%20queue%20flushing%20speed&In-Reply-To=%3CAE36E3CC-8E9F-44E8-AFF7-4D7327ADA2D4%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026244.html">
   <LINK REL="Next"  HREF="026247.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbit%20MQ%3A%20Improve%20queue%20flushing%20speed&In-Reply-To=%3CAE36E3CC-8E9F-44E8-AFF7-4D7327ADA2D4%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed">tim at rabbitmq.com
       </A><BR>
    <I>Thu Mar 28 15:32:23 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026244.html">[rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed
</A></li>
        <LI>Next message: <A HREF="026247.html">[rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26245">[ date ]</a>
              <a href="thread.html#26245">[ thread ]</a>
              <a href="subject.html#26245">[ subject ]</a>
              <a href="author.html#26245">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>BTW - if you're using the java client, there is a perf test tool you can run to check out your configuration - called MulticastMain and you can run it via the 'scripts' directory of the binary distribution. Check out runperftest.sh for examples of how its used, and runjava.sh to execute it.

Please give this a try to see what kind of throughput the client can get in your environment.

Cheers,
Tim 

On 28 Mar 2013, at 15:26, Tim Watson wrote:

&gt;<i> Priyank,
</I>&gt;<i> 
</I>&gt;<i> On 28 Mar 2013, at 12:33, Priyank Patil wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> The client is unable to fetch those messages at that rate. As a result the queue on the server keeps growing.
</I>&gt;&gt;<i> 
</I>&gt;<i> [snip]
</I>&gt;&gt;<i> Each message is less than 1 KB and I have a healthy 2 Mbps line between the server and my machine. Using a network monitoring utility, I found that it is hardly using any of that bandwidth.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> The client is doing nothing with the messages as of now, just printing them to console so processing time on client is almost 0.
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> So why is the client 'unable to fetch those messages at that rate' then? Printing data to the console is not 0 processing time, although I agree it shouldn't be pushing your consumers down to 10 mps. Even with explicit ACKs I'd expect a consumer to manage in the order of KHz when consuming.
</I>&gt;<i> 
</I>&gt;&gt;<i> Some other details: I am using a java client. I have set the client to prefetch 10000 messages. (also tried with default values) The round trip time is about 290 - 350 ms. Messages are individually acknowledged.
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> What do you mean 'round trip time' exactly? You are publishing and consuming from different channels right? You might find reducing the prefetch count a bit actually helps - 10k is quite a high setting. You might also like to confirm in batches (using the 'multiple' flag to indicate that all messages up to the current delivery-tag are being acknowledged.
</I>&gt;<i> 
</I>&gt;&gt;<i> The available resources are being underutilized and 10 messages per second is hardly any load in my opinion. How do I speed up things so that messages held up in queue are transferred faster to the client. Possibly using some sort of batching.
</I>&gt;&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Batching ACKs might help, as might reducing the prefetch count to something a bit more sensible (like 100s or 1000s for example). I suspect there's something else, more fundamental that's wrong with your setup, as these figures are abysmally slow and Rabbit is perfectly capable of handling much higher throughput for both producers and consumers, even with all the guarantees and safety measures like persistence, confirms and explicit ACKs turned on.
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> Tim
</I>
</PRE>























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026244.html">[rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed
</A></li>
	<LI>Next message: <A HREF="026247.html">[rabbitmq-discuss] Rabbit MQ: Improve queue flushing speed
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26245">[ date ]</a>
              <a href="thread.html#26245">[ thread ]</a>
              <a href="subject.html#26245">[ subject ]</a>
              <a href="author.html#26245">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
