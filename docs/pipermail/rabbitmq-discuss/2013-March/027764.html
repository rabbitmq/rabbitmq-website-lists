<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> No subject
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20No%20subject&In-Reply-To=%3Cmailman.12.1370616800.3387.rabbitmq-discuss%40lists.rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027743.html">
   <LINK REL="Next"  HREF="027829.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>No subject</H1>
    <B></B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20No%20subject&In-Reply-To=%3Cmailman.12.1370616800.3387.rabbitmq-discuss%40lists.rabbitmq.com%3E"
       TITLE="No subject">
       </A><BR>
    <I>Thu Mar 14 15:04:54 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027743.html">No subject
</A></li>
        <LI>Next message: <A HREF="027829.html">No subject
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27764">[ date ]</a>
              <a href="thread.html#27764">[ thread ]</a>
              <a href="subject.html#27764">[ subject ]</a>
              <a href="author.html#27764">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>messages and physically save them to disk for each of the consumers to read 
(1 queue/consumer, 1msg copy/queue). The reason I expected that is because 
if messages are ack'ed by consumers 1 and 2, I expected their queue to be 
free of their messages while consumer 3 would still need them to be 
persisted until it has read them. That was possible a false assumption I 
should have verified with you guys. It would indeed be more optimal to 
store a single copy of the messages and only keep the metadata. *Is this 
correct?*

Also, during a test where I continuously sent (a lot) of messages while my 
big consumer 3 was offline. The observation I made then is that *obviously:*
- data was accumulating on disk
- memory usage on all nodes went up. to the point where it eventually 
choked the brokers

I assumed then that the increasing memory usage was because the queue and 
msg metadata was increasing in Mnesia. This was a decisive factor to me 
because I didn't want to be in a situation where my realtime consumers 
would be affected by a slow moving elephant. Is there way I could have 
avoided that situation I didn't see?

Thanks!




------=_Part_176_25682693.1370614353885
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: quoted-printable

Hi guys,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;following a discussion on the kafka user mailin=
g list in which Alexis Richardson replied, I realized I might have been wro=
ng about what I assumed for the messages storage in RabbitMQ. It won't chan=
ge the decision I made to use Kafka but I'd like to set my own mind right i=
n my conception of how RabbitMQ stores messages. I want to use Rabbit in ot=
her projects as well so I want to have the right picture in my mind.&lt;/div&gt;&lt;=
div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The setup I used was based on what is described in&amp;nbsp;=
&lt;a href=3D&quot;<A HREF="http://www.rabbitmq.com/tutorials/tutorial-four-python.html&quot;">http://www.rabbitmq.com/tutorials/tutorial-four-python.html&quot;</A>&gt;htt=
<A HREF="p://www.rabbitmq.com/tutorials/tutorial-four-python.html&lt;/a">p://www.rabbitmq.com/tutorials/tutorial-four-python.html&lt;/a</A>&gt;.&amp;nbsp;&lt;/div&gt;&lt;d=
iv&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;RabbitMQ&lt;/div&gt;&lt;div&gt;- RabbitMQ 3.0.x (not exactly sure wha=
t x was)&lt;/div&gt;&lt;div&gt;- 5 brokers (behind HA proxy)&lt;/div&gt;&lt;div&gt;- Messages poste=
d to multiple topics (called it A, B, C) where the topic is used as the rou=
ting key by the exchange&lt;br&gt;&lt;/div&gt;&lt;div&gt;- Queues and messages are persistent=
 (+ replicated)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Consumers&lt;/div&gt;&lt;div&gt;- Consumer 1 s=
ubscribes to Topic A (near real-time) - Queue 1&lt;/div&gt;&lt;div&gt;- Consumer 2 subs=
cribes to Topic B&amp;nbsp;(near real-time)&amp;nbsp;&amp;nbsp;- Queue 2&lt;/div&gt;&lt;div&gt;- Co=
nsumer 3 subscribes to A, B and C (offline, BI)&amp;nbsp;- Queue 3&lt;/div&gt;&lt;div&gt;&lt;b=
r&gt;&lt;/div&gt;&lt;div&gt;Published 10M messages (size varying between 500b to 2k)&lt;br&gt;&lt;/=
div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;From what I (believe I) saw and read, I really expe=
cted Rabbit to route messages and physically save them to disk for each of =
the consumers to read (1 queue/consumer, 1msg copy/queue). The reason I exp=
ected that is because if messages are ack'ed by consumers 1 and 2, I expect=
ed their queue to be free of their messages while consumer 3 would still ne=
ed them to be persisted until it has read them. That was possible a false a=
ssumption I should have verified with you guys. It would indeed be more opt=
imal to store a single copy of the messages and only keep the metadata. &lt;b&gt;=
Is this correct?&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also, during a test where I c=
ontinuously sent (a lot) of messages while my big consumer 3 was offline. T=
he observation I made then is that &lt;u&gt;obviously:&lt;/u&gt;&lt;/div&gt;&lt;div&gt;- data was a=
ccumulating on disk&lt;/div&gt;&lt;div&gt;- memory usage on all nodes went up. to the p=
oint where it eventually choked the brokers&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I assu=
med then that the increasing memory usage was because the queue and msg met=
adata was increasing in Mnesia. This was a decisive factor to me because I =
didn't want to be in a situation where my realtime consumers would be affec=
ted by a slow moving elephant. Is there way I could have avoided that situa=
tion I didn't see?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;di=
v&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;
------=_Part_176_25682693.1370614353885--

------=_Part_175_26893787.1370614353885--
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027743.html">No subject
</A></li>
	<LI>Next message: <A HREF="027829.html">No subject
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27764">[ date ]</a>
              <a href="thread.html#27764">[ thread ]</a>
              <a href="subject.html#27764">[ subject ]</a>
              <a href="author.html#27764">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
