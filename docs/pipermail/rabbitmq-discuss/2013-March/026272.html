<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem with multiple consumers on multiple	servers !
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20multiple%20consumers%20on%20multiple%0A%09servers%20%21&In-Reply-To=%3C3CBCB0F9-112C-4CC3-BB5B-5D1B4C753AFD%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026263.html">
   <LINK REL="Next"  HREF="026273.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20multiple%20consumers%20on%20multiple%0A%09servers%20%21&In-Reply-To=%3C3CBCB0F9-112C-4CC3-BB5B-5D1B4C753AFD%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !">watson.timothy at gmail.com
       </A><BR>
    <I>Sat Mar 30 12:14:06 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026263.html">[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !
</A></li>
        <LI>Next message: <A HREF="026273.html">[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26272">[ date ]</a>
              <a href="thread.html#26272">[ thread ]</a>
              <a href="subject.html#26272">[ subject ]</a>
              <a href="author.html#26272">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The broker wont send a consumer another message until it avks the last one. Your consumers can opt to receive more than one un-acknowledged message by setting a prefetch count using basic.qos.

Perhaps that's the issue?

Cheers
Tim

On 29 Mar 2013, at 18:57, tluck &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tilak.chauhan at ymail.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I've recently started to develop a cron job kind of mechanism by using
</I>&gt;<i> rabbitmq. In this system a producer reads all the jobs (messages) from a
</I>&gt;<i> database table and creates queues, depending upon the category of the job
</I>&gt;<i> and puts jobs into their respective queues. In other words, each job belongs
</I>&gt;<i> to a particular category and for each category we've a queue.
</I>&gt;<i> 
</I>&gt;<i> Now I've setup multiple consumers and each consumer is listening to a single
</I>&gt;<i> queue. Below is the sample code (in PHP) for each consumer :
</I>&gt;<i> 
</I>&gt;<i> $connection = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
</I>&gt;<i> $channel = $connection-&gt;channel();
</I>&gt;<i> $channel-&gt;queue_declare('queue_category_1', false, true, false, false);
</I>&gt;<i> $channel-&gt;exchange_declare('router', 'direct', true, true, false);
</I>&gt;<i> $channel-&gt;queue_bind('queue_category_1', 'router', 'queue_category_1');
</I>&gt;<i> 
</I>&gt;<i> $callback = function($msg)  {  /***** code here to consume message/job
</I>&gt;<i> ******/  };
</I>&gt;<i> 
</I>&gt;<i> $channel-&gt;basic_qos(null, 1, null);
</I>&gt;<i> 
</I>&gt;<i> $channel-&gt;basic_consume('queue_category_1', 'unique_consumer_tag', false,
</I>&gt;<i> false, false, false, $callback);
</I>&gt;<i> 
</I>&gt;<i> while (count($channel-&gt;callbacks)) {
</I>&gt;<i>    $channel-&gt;wait();
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> When I try to call all the consumers simultaneously, I can see they all are
</I>&gt;<i> consuming/processing messages/jobs parallely. Now I've added one more server
</I>&gt;<i> (server-2) which consumes messages from previous sever (server-1). In this
</I>&gt;<i> way, now the number of consumers are doubled (server-1 is working as both
</I>&gt;<i> producer and consumer sever &amp; server-2 is consumer server). In both the
</I>&gt;<i> servers, consumer processes are running parallely, but, they are not
</I>&gt;<i> consuming messages as they are supposed to do. The problem which I've
</I>&gt;<i> noticed is that only one message/job from each queue is being consumed at a
</I>&gt;<i> time. As I added one more server so now two jobs from each queue should be
</I>&gt;<i> consumed at time instead of only one job. Soon I'll have to add more severs
</I>&gt;<i> to make this system more distributed. Can anyone please help me to find out,
</I>&gt;<i> why only one job is being consumed at a time ? and what can be the solution
</I>&gt;<i> ?
</I>&gt;<i> 
</I>&gt;<i> Thanks in advance.
</I>&gt;<i> 
</I>&gt;<i> T.luck
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Problem-with-multiple-consumers-on-multiple-servers-tp25790.html">http://rabbitmq.1065348.n5.nabble.com/Problem-with-multiple-consumers-on-multiple-servers-tp25790.html</A>
</I>&gt;<i> Sent from the RabbitMQ mailing list archive at Nabble.com.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026263.html">[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !
</A></li>
	<LI>Next message: <A HREF="026273.html">[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26272">[ date ]</a>
              <a href="thread.html#26272">[ thread ]</a>
              <a href="subject.html#26272">[ subject ]</a>
              <a href="author.html#26272">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
