<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] java-client: Reproducable &quot;COMMAND_INVALID -	second 'channel.open' seen&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20java-client%3A%20Reproducable%20%22COMMAND_INVALID%20-%0A%09second%20%27channel.open%27%20seen%22&In-Reply-To=%3CCAJ9O1RrG1CCZbh5eoWgQswaZur9yGj3FOdSSXHqasBjucVSZsA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026211.html">
   <LINK REL="Next"  HREF="026212.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] java-client: Reproducable &quot;COMMAND_INVALID -	second 'channel.open' seen&quot;</H1>
    <B>Victor Boivie</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20java-client%3A%20Reproducable%20%22COMMAND_INVALID%20-%0A%09second%20%27channel.open%27%20seen%22&In-Reply-To=%3CCAJ9O1RrG1CCZbh5eoWgQswaZur9yGj3FOdSSXHqasBjucVSZsA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] java-client: Reproducable &quot;COMMAND_INVALID -	second 'channel.open' seen&quot;">victor at boivie.com
       </A><BR>
    <I>Wed Mar 27 06:26:43 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026211.html">[PATCH] Fix race-condition of asynchronously closed channels
</A></li>
        <LI>Next message: <A HREF="026212.html">[rabbitmq-discuss] java-client: Reproducable &quot;COMMAND_INVALID - second 'channel.open' seen&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26210">[ date ]</a>
              <a href="thread.html#26210">[ thread ]</a>
              <a href="subject.html#26210">[ subject ]</a>
              <a href="author.html#26210">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have been having some problems with the java-rabbitmq-client when stress
testing it. I frequently get &quot;COMMAND_INVALID - second 'channel.open'
seen&quot;, which eventually closes the connection (not just the channel).

It seems that there is a race condition when channels are closed
asynchronously (due to errors), and created in other threads. The channel
that is closed (by the server) doesn't seem to be fully closed before
another thread can try to open a channel with the same number.

The code to reproduce it is at <A HREF="https://github.com/boivie/rmq-stress-test">https://github.com/boivie/rmq-stress-test</A>

A possible fix is below.

Thanks,
Victor

</PRE>










































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026211.html">[PATCH] Fix race-condition of asynchronously closed channels
</A></li>
	<LI>Next message: <A HREF="026212.html">[rabbitmq-discuss] java-client: Reproducable &quot;COMMAND_INVALID - second 'channel.open' seen&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26210">[ date ]</a>
              <a href="thread.html#26210">[ thread ]</a>
              <a href="subject.html#26210">[ subject ]</a>
              <a href="author.html#26210">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
