<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Low impact statistics gathering for queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Low%20impact%20statistics%20gathering%20for%20queues&In-Reply-To=%3C513DB552.9030704%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025832.html">
   <LINK REL="Next"  HREF="025841.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Low impact statistics gathering for queues</H1>
    <B>Emile Joubert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Low%20impact%20statistics%20gathering%20for%20queues&In-Reply-To=%3C513DB552.9030704%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Low impact statistics gathering for queues">emile at rabbitmq.com
       </A><BR>
    <I>Mon Mar 11 10:43:30 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025832.html">[rabbitmq-discuss] Low impact statistics gathering for queues
</A></li>
        <LI>Next message: <A HREF="025841.html">[rabbitmq-discuss] Low impact statistics gathering for queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25840">[ date ]</a>
              <a href="thread.html#25840">[ thread ]</a>
              <a href="subject.html#25840">[ subject ]</a>
              <a href="author.html#25840">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi,

On 09/03/13 14:46, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">sapelzin at icontrol.com</A> wrote:
&gt;<i> Our application can utilize a lot of queues, as many as 100k.  We would
</I>&gt;<i> like to regularly query a queue count, and message counts for specific
</I>&gt;<i> queues.  The overhead for calling rabbitmqctl -list_queues with a large
</I>&gt;<i> number of queues is too high.  Is there an alternative for just querying
</I>&gt;<i> the stats we need?
</I>
You can get a quick queue count with this command:

rabbitmqctl eval 'mnesia:table_info(rabbit_queue, size).'

rabbitmqctl is not the best way of getting the message count for just a
few queues if there are many queues, because it will query all queues.
If the queue permissions and parameters allow it then it may be possible
to get this information by using an AMQP library and the passive queue
declare method, which reports message count:

<A HREF="http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok">http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare-ok</A>

The management plugin can also be used to obtain this information using
the HTTP API. For details see <A HREF="http://www.rabbitmq.com/management.html">http://www.rabbitmq.com/management.html</A>
and the HTTP API documentation linked from there.


It is possible to use a complicated rabbitmqctl eval parameter to return
the number of messages in a particular queue (queue_name in this
example), but this is a fragile option that is may stop working when you
upgrade:

rabbitmqctl eval '{ok, [{messages, Count}]} =
rabbit_amqqueue:with(rabbit_misc:r(&lt;&lt;&quot;/&quot;&gt;&gt;, queue, &lt;&lt;&quot;queue_name&quot;&gt;&gt;),
fun(Q) -&gt;  gen_server2:call(element(7, Q), {info, [messages]}) end), Count.'





-Emile





</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025832.html">[rabbitmq-discuss] Low impact statistics gathering for queues
</A></li>
	<LI>Next message: <A HREF="025841.html">[rabbitmq-discuss] Low impact statistics gathering for queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25840">[ date ]</a>
              <a href="thread.html#25840">[ thread ]</a>
              <a href="subject.html#25840">[ subject ]</a>
              <a href="author.html#25840">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
