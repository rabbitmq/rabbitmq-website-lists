<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] one thread is consistently slower than another
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20one%20thread%20is%20consistently%20slower%20than%20another&In-Reply-To=%3C07cd953d-5873-4c70-bd9d-049c753269ba%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026144.html">
   <LINK REL="Next"  HREF="026146.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] one thread is consistently slower than another</H1>
    <B>jonathan.newbrough at gyregroup.com</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20one%20thread%20is%20consistently%20slower%20than%20another&In-Reply-To=%3C07cd953d-5873-4c70-bd9d-049c753269ba%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] one thread is consistently slower than another">jonathan.newbrough at gyregroup.com
       </A><BR>
    <I>Fri Mar 22 18:39:31 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026144.html">[rabbitmq-discuss] How can I get a count of messages in a queue with a certain correlation_id
</A></li>
        <LI>Next message: <A HREF="026146.html">[rabbitmq-discuss] one thread is consistently slower than	another
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26145">[ date ]</a>
              <a href="thread.html#26145">[ thread ]</a>
              <a href="subject.html#26145">[ subject ]</a>
              <a href="author.html#26145">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm seeing really odd application performance and hoping for good ideas.

My application starts lots of threads that each subscribe to a queue.  When 
they receive a message, they persist to an NFS store, then publish a new 
message back to rabbit.  As the application runs, new &quot;pathways&quot; of data 
are created -- additional sources of data, additional queues, additional 
threads to persist the data.  Each thread reports the time taken to process 
each message (averaged over 100 messages).

I expected a distribution of time to handle each message, with the average 
gradually increasing with increasing load.  When I look at a graph of all 
these data points (average time to process message versus clock time) it 
looks a lot as I would expect.  You can see an example here&lt;<A HREF="https://confluence.oceanobservatories.org/display/CIDev/Scale+Test+Results+Mar21">https://confluence.oceanobservatories.org/display/CIDev/Scale+Test+Results+Mar21</A>&gt;(second graph on page), but this has been reproduced each time I start to 
put load on the system.

But then when I single out individual threads, they follow very distinct 
paths on this graph.  For example, if I compare two threads A and B, I see 
that one thread may always take 0.5sec longer to process messages.  The 
performance of both threads rise and fall in parallel lines, but one thread 
is consistently slower than another!  It seems that the earlier the thread 
is started within the VM, the faster it can publish.  But as the 
cloud-based system grows and starts new VMs running the same application, 
new threads on the new VM perform as fast as the first threads on an 
earlier VM (so the performance drops off as the VM has been running longer 
-- not as the system or broker load grows).

The broker VM shows very low utilization (&lt;10% CPU used on 4-core system, 
only 25% of 2GB RAM used).  The application VM grows until it reaches about 
65% CPU, memory shows 35% of 4GB used.  Message rates are relatively low -- 
growing from 0 to ~150msgs/sec with avg size ~500bytes.

I wish I could give you a nice easy code snippet to reproduce, but it will 
take some effort to extract a faithful reproduction from our complex 
publisher/subscriber/data process OO wrappings.  I'm hoping from the 
description, someone can point me at some possible explanations.

Many thanks for any suggestions or ideas!
Jonathan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130322/a5ab9c39/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130322/a5ab9c39/attachment.htm</A>&gt;
</PRE>















































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026144.html">[rabbitmq-discuss] How can I get a count of messages in a queue with a certain correlation_id
</A></li>
	<LI>Next message: <A HREF="026146.html">[rabbitmq-discuss] one thread is consistently slower than	another
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26145">[ date ]</a>
              <a href="thread.html#26145">[ thread ]</a>
              <a href="subject.html#26145">[ subject ]</a>
              <a href="author.html#26145">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
