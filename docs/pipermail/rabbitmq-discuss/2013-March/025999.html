<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] basic.qos prefetch across multiple queues -	useful?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20basic.qos%20prefetch%20across%20multiple%20queues%20-%0A%09useful%3F&In-Reply-To=%3CCA84ED3F-5E2F-4A06-ABAD-24A7EA6BC395%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025992.html">
   <LINK REL="Next"  HREF="025998.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] basic.qos prefetch across multiple queues -	useful?</H1>
    <B>Ask Solem</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20basic.qos%20prefetch%20across%20multiple%20queues%20-%0A%09useful%3F&In-Reply-To=%3CCA84ED3F-5E2F-4A06-ABAD-24A7EA6BC395%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] basic.qos prefetch across multiple queues -	useful?">ask at rabbitmq.com
       </A><BR>
    <I>Mon Mar 18 20:39:29 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="025992.html">[rabbitmq-discuss] basic.qos prefetch across multiple queues -	useful?
</A></li>
        <LI>Next message: <A HREF="025998.html">[rabbitmq-discuss] Memory usage and total allowed connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25999">[ date ]</a>
              <a href="thread.html#25999">[ thread ]</a>
              <a href="subject.html#25999">[ subject ]</a>
              <a href="author.html#25999">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Mar 18, 2013, at 6:30 PM, Matthias Radestock &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt; wrote:

&gt;<i> Is anybody setting a basic.qos prefetch limit on channels with consumers on multiple queues?
</I>&gt;<i> 
</I>&gt;<i> If so, are you relying on the fact that the prefetch limit applies *across* queues rather than *per* queue?
</I>

Celery is relying on it, but only because that's how QoS is defined in the spec.
It does sound like we'd end up with a lot more messages in memory if it was per queue.  Some users like to configure workers so that they will only consume
as many messages as there are available workers in the execution pool, and so I
guess for this to still work we would need another semaphore/barrier if the prefetch count behavior changes.  It can probably be solved either way.


&gt;<i> 
</I>&gt;<i> That feature entails considerable implementation complexity and has a substantial performance impact on consuming from basic.qos-limited channels in general. And I've just found a bug in that area of the code, fixing of which will make the implementation even more complex and hurt performance even more.
</I>
Strange, I would've guessed implementing it on a per-queue basis would be more complex



&gt;<i> 
</I>&gt;<i> Hence I am trying to gauge people's opinion on whether we could make the prefetch limit apply per-queue instead.
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> 
</I>&gt;<i> Matthias.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
</PRE>































































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025992.html">[rabbitmq-discuss] basic.qos prefetch across multiple queues -	useful?
</A></li>
	<LI>Next message: <A HREF="025998.html">[rabbitmq-discuss] Memory usage and total allowed connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25999">[ date ]</a>
              <a href="thread.html#25999">[ thread ]</a>
              <a href="subject.html#25999">[ subject ]</a>
              <a href="author.html#25999">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
