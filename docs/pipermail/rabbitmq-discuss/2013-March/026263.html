<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem with multiple consumers on multiple	servers !
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20multiple%20consumers%20on%20multiple%0A%09servers%20%21&In-Reply-To=%3C1364583437418-25790.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026262.html">
   <LINK REL="Next"  HREF="026272.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !</H1>
    <B>tluck</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20with%20multiple%20consumers%20on%20multiple%0A%09servers%20%21&In-Reply-To=%3C1364583437418-25790.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !">tilak.chauhan at ymail.com
       </A><BR>
    <I>Fri Mar 29 18:57:17 GMT 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026262.html">[rabbitmq-discuss] rabbitmq-java-messagepatterns
</A></li>
        <LI>Next message: <A HREF="026272.html">[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26263">[ date ]</a>
              <a href="thread.html#26263">[ thread ]</a>
              <a href="subject.html#26263">[ subject ]</a>
              <a href="author.html#26263">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I've recently started to develop a cron job kind of mechanism by using
rabbitmq. In this system a producer reads all the jobs (messages) from a
database table and creates queues, depending upon the category of the job
and puts jobs into their respective queues. In other words, each job belongs
to a particular category and for each category we've a queue.

Now I've setup multiple consumers and each consumer is listening to a single
queue. Below is the sample code (in PHP) for each consumer :

$connection = new AMQPConnection(HOST, PORT, USER, PASS, VHOST);
$channel = $connection-&gt;channel();
$channel-&gt;queue_declare('queue_category_1', false, true, false, false);
$channel-&gt;exchange_declare('router', 'direct', true, true, false);
$channel-&gt;queue_bind('queue_category_1', 'router', 'queue_category_1');

$callback = function($msg)  {  /***** code here to consume message/job
******/  };

$channel-&gt;basic_qos(null, 1, null);

$channel-&gt;basic_consume('queue_category_1', 'unique_consumer_tag', false,
false, false, false, $callback);

while (count($channel-&gt;callbacks)) {
    $channel-&gt;wait();
}

When I try to call all the consumers simultaneously, I can see they all are
consuming/processing messages/jobs parallely. Now I've added one more server
(server-2) which consumes messages from previous sever (server-1). In this
way, now the number of consumers are doubled (server-1 is working as both
producer and consumer sever &amp; server-2 is consumer server). In both the
servers, consumer processes are running parallely, but, they are not
consuming messages as they are supposed to do. The problem which I've
noticed is that only one message/job from each queue is being consumed at a
time. As I added one more server so now two jobs from each queue should be
consumed at time instead of only one job. Soon I'll have to add more severs
to make this system more distributed. Can anyone please help me to find out,
why only one job is being consumed at a time ? and what can be the solution
?

Thanks in advance.

T.luck















  





--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Problem-with-multiple-consumers-on-multiple-servers-tp25790.html">http://rabbitmq.1065348.n5.nabble.com/Problem-with-multiple-consumers-on-multiple-servers-tp25790.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>


















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026262.html">[rabbitmq-discuss] rabbitmq-java-messagepatterns
</A></li>
	<LI>Next message: <A HREF="026272.html">[rabbitmq-discuss] Problem with multiple consumers on multiple	servers !
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26263">[ date ]</a>
              <a href="thread.html#26263">[ thread ]</a>
              <a href="subject.html#26263">[ subject ]</a>
              <a href="author.html#26263">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
