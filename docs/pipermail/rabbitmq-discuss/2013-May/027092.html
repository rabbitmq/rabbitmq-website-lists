<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] persistent connections on rabbitmq-server	when android client losses internet connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20persistent%20connections%20on%20rabbitmq-server%0A%09when%20android%20client%20losses%20internet%20connection&In-Reply-To=%3CAFB8E615-7EA0-4098-8939-36F82E21354A%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027077.html">
   <LINK REL="Next"  HREF="027083.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] persistent connections on rabbitmq-server	when android client losses internet connection</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20persistent%20connections%20on%20rabbitmq-server%0A%09when%20android%20client%20losses%20internet%20connection&In-Reply-To=%3CAFB8E615-7EA0-4098-8939-36F82E21354A%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] persistent connections on rabbitmq-server	when android client losses internet connection">tim at rabbitmq.com
       </A><BR>
    <I>Mon May 13 10:39:49 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027077.html">[rabbitmq-discuss] persistent connections on rabbitmq-server when android client losses internet connection
</A></li>
        <LI>Next message: <A HREF="027083.html">[rabbitmq-discuss] WCF bind error VS 2010
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27092">[ date ]</a>
              <a href="thread.html#27092">[ thread ]</a>
              <a href="subject.html#27092">[ subject ]</a>
              <a href="author.html#27092">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

On 11 May 2013, at 13:08, Jure Novi&#269; wrote:

&gt;<i> I have a question about about connections to server from java client. I'm developing a Android application using rabbitmq-java-client library. I followed the tutorials on the rabbitmq website, so I created a ConnectionFactory with my own ip address (without any timeout or heartbeat), then called newConnection(). Everything works fine, sending and receiving.
</I>&gt;<i> 
</I>&gt;<i> The problem arrises when I turn off network connection on an android device, the connection on rabbitmq-server is still there (for long time). If I want to achieve that the server clear my connection I have to use heartbeat. I also tried to create new ConnectionFactory class and override configureSocket and call socket.setKeepAlive(true). That neither helped. 
</I>
If I'm not mistaken, you'll need to enable TCP keep-alive at the OS level to take advantage of that. Check out `man tcp`, at which point you might want to consider 'tcp_retries1' and the RTO settings as well. Better still, get your network admin to look at these, since they'll have a much better idea of the impact any changes might have. 

&gt;<i> 
</I>&gt;<i> My colleague is developing an iOS application, and another one is developing an erlang client. They don't have this problem, if they kill the app or turn of network connection, the connections on rabbitmq-server are cleared immediately (2-4s). They are not using any timeouts or heartbeats.
</I>
Perhaps that's true at the application level, but it's entirely possible that at the OS level (on either client or server) they have configured the network stack to detect connection failures in a timely fashion. This could be the case either because they've explicitly tuned the kernel's TCP parameters themselves, or that their chosen OS provides different defaults to yours. If this is not the case, it's also possible that intermediate network kit (such as routers, load balancers, proxies and firewalls) could be responsible for the timely detection of a closed socket.

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/6e92671f/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130513/6e92671f/attachment.htm</A>&gt;
</PRE>



































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027077.html">[rabbitmq-discuss] persistent connections on rabbitmq-server when android client losses internet connection
</A></li>
	<LI>Next message: <A HREF="027083.html">[rabbitmq-discuss] WCF bind error VS 2010
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27092">[ date ]</a>
              <a href="thread.html#27092">[ thread ]</a>
              <a href="subject.html#27092">[ subject ]</a>
              <a href="author.html#27092">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
