<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] More throughput using cluster
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20More%20throughput%20using%20cluster&In-Reply-To=%3CCAMcAHLUmH2rrb6QuZX84Z-pvXwvVnixprKFGKevC3zXHso8AjA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027334.html">
   <LINK REL="Next"  HREF="027335.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] More throughput using cluster</H1>
    <B>Alvaro Videla</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20More%20throughput%20using%20cluster&In-Reply-To=%3CCAMcAHLUmH2rrb6QuZX84Z-pvXwvVnixprKFGKevC3zXHso8AjA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] More throughput using cluster">videlalvaro at gmail.com
       </A><BR>
    <I>Sun May 19 15:28:26 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027334.html">[rabbitmq-discuss] More throughput using cluster
</A></li>
        <LI>Next message: <A HREF="027335.html">[rabbitmq-discuss] More throughput using cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27332">[ date ]</a>
              <a href="thread.html#27332">[ thread ]</a>
              <a href="subject.html#27332">[ subject ]</a>
              <a href="author.html#27332">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

The php-amqplib from here <A HREF="https://github.com/videlalvaro/php-amqplib">https://github.com/videlalvaro/php-amqplib</A> can
easily publish 4000 msgs in 1.5 seconds and it can consume them in about
the same time, using just 1 producer and 1 consumer.

Is worth noting that the consumers in the benchmark code are doing a
basic_consume on the queue and not a basic_get. The benchmark code can be
easily run if you check out the library form Github and run *make benchmark*
.

I think the problem you have on the producing side is the way PHP work,
where sharing resources is not so easy due to the script state being
cleaned after every request, thus the need of opening one connection per
request.

Regarding persisting connections with PHP, while the socket connection to
RabbitMQ could be persisted across requests, what do we do about channels
and the whole connection state? With PHP this is not so easy to solve.

If you need to achieve max speed from your publishing side I would consider
using a REST endpoint as someone suggested already.

On the other hand if your concern regarding publishing speed is to not make
the users wait for the request to finish, then keep in mind that php-fpm
has a function called fastcgi_finish_request. You can call it at the end of
your script and then send the messages to RabbitMQ.

Regards,

Alvaro



On Sun, May 19, 2013 at 4:11 PM, Nikola Savic &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">niks at osic.rs</A>&gt; wrote:

&gt;<i>
</I>&gt;<i> Consumers are not restarting ... producers are. Every page request is new
</I>&gt;<i> execution of PHP script, which must open new connection when trying to send
</I>&gt;<i> first message, and close it when it finishes.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 05/19/2013 04:08 PM, Michael Klishin wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 2013/5/19 Nikola Savic &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">niks at osic.rs</A>&gt;
</I>&gt;<i>
</I>&gt;&gt;<i> Yes ... it's the same app which postpones execution of some actions using
</I>&gt;&gt;<i> MQ.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Then cluster won't solve your problem because the issue is not node
</I>&gt;<i> delivery rate.
</I>&gt;<i>
</I>&gt;<i> You need to avoid constant restarts and reconnections for your consumers
</I>&gt;<i> or simply
</I>&gt;<i> increase their number and/or throughput.
</I>&gt;<i> --
</I>&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://github.com/michaelklishin">http://github.com/michaelklishin</A>
</I>&gt;<i> <A HREF="http://twitter.com/michaelklishin">http://twitter.com/michaelklishin</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">listrabbitmq-discuss at lists.rabbitmq.comhttps</A>://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/a24e1f49/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130519/a24e1f49/attachment.htm</A>&gt;
</PRE>














































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027334.html">[rabbitmq-discuss] More throughput using cluster
</A></li>
	<LI>Next message: <A HREF="027335.html">[rabbitmq-discuss] More throughput using cluster
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27332">[ date ]</a>
              <a href="thread.html#27332">[ thread ]</a>
              <a href="subject.html#27332">[ subject ]</a>
              <a href="author.html#27332">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
