<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Federation &amp; SSL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Federation%20%26%20SSL&In-Reply-To=%3C51A67A7E.1050606%40cray.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027539.html">
   <LINK REL="Next"  HREF="027546.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Federation &amp; SSL</H1>
    <B>Eric Cozzi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Federation%20%26%20SSL&In-Reply-To=%3C51A67A7E.1050606%40cray.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ Federation &amp; SSL">n16483 at cray.com
       </A><BR>
    <I>Wed May 29 23:00:30 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027539.html">[rabbitmq-discuss] RabbitMQ Federation &amp; SSL
</A></li>
        <LI>Next message: <A HREF="027546.html">[rabbitmq-discuss] RabbitMQ Federation &amp; SSL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27544">[ date ]</a>
              <a href="thread.html#27544">[ thread ]</a>
              <a href="subject.html#27544">[ subject ]</a>
              <a href="author.html#27544">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What am I doing wrong?? I have set auth_mechanism=external in my 
federation URI, but according to the RabbitMQ log, it's trying to 
authenticate as guest.

ecozzi-01:~ # rabbitmqctl list_parameters
Listing runtime parameters ...
federation      local-username  &quot;guest&quot;
federation      local-nodename  &quot;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ecozzi-01.site</A>&quot;
federation-upstream     ecozzi-02       
{&quot;prefetch-count&quot;:1000,&quot;uri&quot;:&quot;<A HREF="amqps://ecozzi-02?cacertfile=/opt/cray/ssl/testca/cacert.pem&amp;certfile=/opt/cray/ssl/client-01/cert.pem&amp;keyfile=/opt/cray/ssl/client-01/key.pem&amp;verify=verify_peer&amp;fail_if_no_peer_cert=true&amp;auth_mechanism=external&quot;,&quot;trust-user-id&quot;:true,&quot;max-hops&quot;:1}">amqps://ecozzi-02?cacertfile=/opt/cray/ssl/testca/cacert.pem&amp;certfile=/opt/cray/ssl/client-01/cert.pem&amp;keyfile=/opt/cray/ssl/client-01/key.pem&amp;verify=verify_peer&amp;fail_if_no_peer_cert=true&amp;auth_mechanism=external&quot;,&quot;trust-user-id&quot;:true,&quot;max-hops&quot;:1}</A>

ecozzi-02:/etc/rabbitmq # rabbitmqctl list_parameters
Listing runtime parameters ...
federation      local-username  &quot;guest&quot;
federation      local-nodename  &quot;smw_cluster&quot;
federation-upstream     ecozzi-01       
{&quot;prefetch-count&quot;:1000,&quot;uri&quot;:&quot;<A HREF="amqps://ecozzi-01?cacertfile=/opt/cray/ssl/testca/cacert.pem&amp;certfile=/opt/cray/ssl/client-02/cert.pem&amp;keyfile=/opt/cray/ssl/client-02/key.pem&amp;verify=verify_peer&amp;fail_if_no_peer_cert=true&amp;auth_mechanism=external&quot;,&quot;trust-user-id&quot;:true,&quot;max-hops&quot;:1}">amqps://ecozzi-01?cacertfile=/opt/cray/ssl/testca/cacert.pem&amp;certfile=/opt/cray/ssl/client-02/cert.pem&amp;keyfile=/opt/cray/ssl/client-02/key.pem&amp;verify=verify_peer&amp;fail_if_no_peer_cert=true&amp;auth_mechanism=external&quot;,&quot;trust-user-id&quot;:true,&quot;max-hops&quot;:1}</A>

*Log File:*
ecozzi-01:~ # rabbitmqctl list_parameters
Listing runtime parameters ...
federation      local-username  &quot;guest&quot;
federation      local-nodename  &quot;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ecozzi-01.site</A>&quot;
federation-upstream     ecozzi-02       
{&quot;prefetch-count&quot;:1000,&quot;uri&quot;:&quot;<A HREF="amqps://ecozzi-02?cacertfile=/opt/cray/ssl/testca/cacert.pem&amp;certfile=/opt/cray/ssl/client-01/cert.pem&amp;keyfile=/opt/cray/ssl/client-01/key.pem&amp;verify=verify_peer&amp;fail_if_no_peer_cert=true&amp;auth_mechanism=external&quot;,&quot;trust-user-id&quot;:true,&quot;max-hops&quot;:1}">amqps://ecozzi-02?cacertfile=/opt/cray/ssl/testca/cacert.pem&amp;certfile=/opt/cray/ssl/client-01/cert.pem&amp;keyfile=/opt/cray/ssl/client-01/key.pem&amp;verify=verify_peer&amp;fail_if_no_peer_cert=true&amp;auth_mechanism=external&quot;,&quot;trust-user-id&quot;:true,&quot;max-hops&quot;:1}</A>

ecozzi-02:/etc/rabbitmq # rabbitmqctl list_parameters
Listing runtime parameters ...
federation      local-username  &quot;guest&quot;
federation      local-nodename  &quot;smw_cluster&quot;
federation-upstream     ecozzi-01       
{&quot;prefetch-count&quot;:1000,&quot;uri&quot;:&quot;<A HREF="amqps://ecozzi-01?cacertfile=/opt/cray/ssl/testca/cacert.pem&amp;certfile=/opt/cray/ssl/client-02/cert.pem&amp;keyfile=/opt/cray/ssl/client-02/key.pem&amp;verify=verify_peer&amp;fail_if_no_peer_cert=true&amp;auth_mechanism=external&quot;,&quot;trust-user-id&quot;:true,&quot;max-hops&quot;:1}">amqps://ecozzi-01?cacertfile=/opt/cray/ssl/testca/cacert.pem&amp;certfile=/opt/cray/ssl/client-02/cert.pem&amp;keyfile=/opt/cray/ssl/client-02/key.pem&amp;verify=verify_peer&amp;fail_if_no_peer_cert=true&amp;auth_mechanism=external&quot;,&quot;trust-user-id&quot;:true,&quot;max-hops&quot;:1}</A>



On 05/29/2013 09:53 AM, Eric Cozzi wrote:
&gt;<i> Matthias,
</I>&gt;<i>
</I>&gt;<i> Sorry for the delay in responding.
</I>&gt;<i>
</I>&gt;<i> I have the LDAP auth plugin logging at Network level. There are no 
</I>&gt;<i> additional log statements that are being output. I've also confirmed 
</I>&gt;<i> that the user exists in my LDAP. So, I'm not sure why it couldn't find 
</I>&gt;<i> the user, unless it's not looking for the correct username. It should 
</I>&gt;<i> be using the CN from the SSL certificate as the username, which in 
</I>&gt;<i> this case should be either ecozzi-02 or ecozzi-03.
</I>&gt;<i>
</I>&gt;<i> Erlang version is:
</I>&gt;<i> ecozzi-01:/home/ecozzi # cat /usr/lib64/erlang/releases/RELEASES
</I>&gt;<i> [{release,&quot;OTP  APN 181 01&quot;,&quot;R15B02&quot;,&quot;5.9.2&quot;,
</I>&gt;<i>           [{kernel,&quot;2.15.2&quot;,&quot;/usr/lib64/erlang/lib/kernel-2.15.2&quot;},
</I>&gt;<i>            {stdlib,&quot;1.18.2&quot;,&quot;/usr/lib64/erlang/lib/stdlib-1.18.2&quot;},
</I>&gt;<i>            {sasl,&quot;2.2.1&quot;,&quot;/usr/lib64/erlang/lib/sasl-2.2.1&quot;}],
</I>&gt;<i>           permanent}].
</I>&gt;<i>
</I>&gt;<i> Rabbit Version:
</I>&gt;<i> ecozzi-01:/home/ecozzi # rabbitmqctl status
</I>&gt;<i> Status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ecozzi-01</A>' ...
</I>&gt;<i> [{pid,3800},
</I>&gt;<i>  {running_applications,
</I>&gt;<i>      [{rabbitmq_federation_management,&quot;RabbitMQ Federation Management&quot;,
</I>&gt;<i>           &quot;3.0.1&quot;},
</I>&gt;<i>       {rabbitmq_management,&quot;RabbitMQ Management Console&quot;,&quot;3.0.1&quot;},
</I>&gt;<i>       {rabbitmq_federation,&quot;RabbitMQ Federation&quot;,&quot;3.0.1&quot;},
</I>&gt;<i>       {rabbitmq_auth_backend_ldap,&quot;RabbitMQ LDAP Authentication Backend&quot;,
</I>&gt;<i>           &quot;3.0.1&quot;},
</I>&gt;<i>       {rabbitmq_management_agent,&quot;RabbitMQ Management Agent&quot;,&quot;3.0.1&quot;},
</I>&gt;<i>       {rabbit,&quot;RabbitMQ&quot;,&quot;3.0.1&quot;},
</I>&gt;<i>       {ssl,&quot;Erlang/OTP SSL application&quot;,&quot;5.1&quot;},
</I>&gt;<i>       {public_key,&quot;Public key infrastructure&quot;,&quot;0.16&quot;},
</I>&gt;<i>       {crypto,&quot;CRYPTO version 2&quot;,&quot;2.2&quot;},
</I>&gt;<i>       {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.10&quot;},
</I>&gt;<i>       {rabbitmq_auth_mechanism_ssl,
</I>&gt;<i>           &quot;RabbitMQ SSL authentication (SASL EXTERNAL)&quot;,&quot;3.0.1&quot;},
</I>&gt;<i>       {rabbitmq_mochiweb,&quot;RabbitMQ Mochiweb Embedding&quot;,&quot;3.0.1&quot;},
</I>&gt;<i>       {webmachine,&quot;webmachine&quot;,&quot;1.9.1-rmq3.0.1-git52e62bc&quot;},
</I>&gt;<i>       {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;2.3.1-rmq3.0.1-gitd541e9a&quot;},
</I>&gt;<i>       {xmerl,&quot;XML parser&quot;,&quot;1.3.2&quot;},
</I>&gt;<i>       {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.9.1&quot;},
</I>&gt;<i>       {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.7.1&quot;},
</I>&gt;<i>       {eldap,&quot;Ldap api&quot;,&quot;1.0&quot;},
</I>&gt;<i>       {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;3.0.1&quot;},
</I>&gt;<i>       {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.2.1&quot;},
</I>&gt;<i>       {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.18.2&quot;},
</I>&gt;<i>       {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.15.2&quot;}]},
</I>&gt;<i>  {os,{unix,linux}},
</I>&gt;<i>  {erlang_version,
</I>&gt;<i>      &quot;Erlang R15B02 (erts-5.9.2) [source] [64-bit] [smp:2:2] 
</I>&gt;<i> [async-threads:30] [hipe] [kernel-poll:true]\n&quot;},
</I>&gt;<i>  {memory,
</I>&gt;<i>      [{total,37603792},
</I>&gt;<i>       {connection_procs,162600},
</I>&gt;<i>       {queue_procs,235552},
</I>&gt;<i>       {plugins,377592},
</I>&gt;<i>       {other_proc,10276868},
</I>&gt;<i>       {mnesia,94464},
</I>&gt;<i>       {mgmt_db,84936},
</I>&gt;<i>       {msg_index,32576},
</I>&gt;<i>       {other_ets,1236360},
</I>&gt;<i>       {binary,306624},
</I>&gt;<i>       {code,20204649},
</I>&gt;<i>       {atom,760729},
</I>&gt;<i>       {other_system,3830842}]},
</I>&gt;<i>  {vm_memory_high_watermark,0.4},
</I>&gt;<i>  {vm_memory_limit,205919027},
</I>&gt;<i>  {disk_free_limit,1000000000},
</I>&gt;<i>  {disk_free,0},
</I>&gt;<i>  {file_descriptors,
</I>&gt;<i>      
</I>&gt;<i> [{total_limit,924},{total_used,16},{sockets_limit,829},{sockets_used,4}]},
</I>&gt;<i>  {processes,[{limit,1048576},{used,249}]},
</I>&gt;<i>  {run_queue,0},
</I>&gt;<i>  {uptime,406985}]
</I>&gt;<i> ...done.
</I>&gt;<i>
</I>&gt;<i> On 05/25/2013 03:56 PM, Matthias Radestock wrote:
</I>&gt;&gt;<i> Eric,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 24/05/13 22:55, Eric Cozzi wrote:
</I>&gt;&gt;&gt;<i>                   {{badarg,{error,noSuchObject}},
</I>&gt;&gt;&gt;<i> [{rabbit_access_control,'-check_vhost_access/2-fun-0-',3,[]},
</I>&gt;&gt;&gt;<i>                     {rabbit_access_control,check_access,5,[]},
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That indicates that your LDAP auth backend returned a 'noSuchObject' 
</I>&gt;&gt;<i> error when performing the vhost access check for the user.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I suggest you enable logging in the LDAP auth plug-in to track down 
</I>&gt;&gt;<i> the cause.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However, the error really should be handled more gracefully by 
</I>&gt;&gt;<i> rabbit, and I am at a loss why it's producing such a stack trace. 
</I>&gt;&gt;<i> What versions of RabbitMQ and Erlang are you running and how did you 
</I>&gt;&gt;<i> install rabbit (e.g. from a package, compiled from source, etc)?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Matthias.
</I>&gt;&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130529/1c3c3702/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130529/1c3c3702/attachment.htm</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027539.html">[rabbitmq-discuss] RabbitMQ Federation &amp; SSL
</A></li>
	<LI>Next message: <A HREF="027546.html">[rabbitmq-discuss] RabbitMQ Federation &amp; SSL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27544">[ date ]</a>
              <a href="thread.html#27544">[ thread ]</a>
              <a href="subject.html#27544">[ subject ]</a>
              <a href="author.html#27544">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
