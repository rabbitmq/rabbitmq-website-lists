<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Error trying to configure	rabbit_auth_backend_ldap
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Error%20trying%20to%20configure%0A%09rabbit_auth_backend_ldap&In-Reply-To=%3C519CE5D3.4080508%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027423.html">
   <LINK REL="Next"  HREF="027426.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Error trying to configure	rabbit_auth_backend_ldap</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Error%20trying%20to%20configure%0A%09rabbit_auth_backend_ldap&In-Reply-To=%3C519CE5D3.4080508%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Error trying to configure	rabbit_auth_backend_ldap">simon at rabbitmq.com
       </A><BR>
    <I>Wed May 22 16:35:47 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027423.html">[rabbitmq-discuss] Error trying to configure	rabbit_auth_backend_ldap
</A></li>
        <LI>Next message: <A HREF="027426.html">[rabbitmq-discuss] effectively using -setcookie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27424">[ date ]</a>
              <a href="thread.html#27424">[ thread ]</a>
              <a href="subject.html#27424">[ subject ]</a>
              <a href="author.html#27424">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi.

The problem is the 'other_bind' configuration option defaults to 
'as_user', but this isn't compatible with passwordless login.

'other_bind' controls how RabbitMQ connects to the LDAP server to do 
anything other than check a {user, password} combination. 'as_user' 
means connect to LDAP with the username and password of the logged in 
user. You can see how this would fail to work.

So you need to set 'other_bind' to either 'anon' or {&quot;another-user&quot;, 
&quot;another-password&quot;} depending on how you want RabbitMQ connect to LDAP here.

This could really be better explained in the documentation, I'll work on 
that...

Cheers, Simon

On 22/05/13 16:22, Eric Cozzi wrote:
&gt;<i> I am trying to configure rabbit_auth_backend_ldap as a backing auth for
</I>&gt;<i> passwordless login using rabbitmq_auth_mechanism_ssl, but I am getting
</I>&gt;<i> the following error. I've also included my rabbitmq.config file for
</I>&gt;<i> reference.
</I>&gt;<i>
</I>&gt;<i> Any help would be appreciated.
</I>&gt;<i> Thanks,
</I>&gt;<i> Eric
</I>&gt;<i>
</I>&gt;<i> Logfile:
</I>&gt;<i>
</I>&gt;<i> =ERROR REPORT==== 22-May-2013::09:32:37 ===
</I>&gt;<i> ** Generic server rabbit_auth_backend_ldap terminating
</I>&gt;<i> ** Last message in was {login,&lt;&lt;&quot;O=client,CN=ecozzi-01&quot;&gt;&gt;}
</I>&gt;<i> ** When Server state == {state,
</I>&gt;<i>                           [&quot;192.168.252.5&quot;],
</I>&gt;<i> &quot;cn=${username},ou=msgbus,dc=cray,dc=com&quot;,none,none,
</I>&gt;<i>                           as_user,
</I>&gt;<i>                           {in_group,
</I>&gt;<i>                            &quot;ou=${vhost}-users,ou=vhosts,dc=cray,dc=com&quot;},
</I>&gt;<i>                           {for,
</I>&gt;<i>                            [{permission,configure,
</I>&gt;<i>                              {in_group,&quot;cn=admin,dc=cray,dc=com&quot;}},
</I>&gt;<i>                             {permission,write,
</I>&gt;<i>                              {for,
</I>&gt;<i>                               [{resource,queue,
</I>&gt;<i>                                 {in_group,&quot;cn=admin,dc=cray,dc=com&quot;}},
</I>&gt;<i>                                {resource,exchange,{constant,true}}]}},
</I>&gt;<i>                             {permission,read,
</I>&gt;<i>                              {for,
</I>&gt;<i>                               [{resource,exchange,
</I>&gt;<i>                                 {in_group,&quot;cn=admin,dc=cray,dc=com&quot;}},
</I>&gt;<i>                                {resource,queue,{constant,true}}]}}]},
</I>&gt;<i>                           [{administrator,{constant,false}},
</I>&gt;<i>                            {management,{constant,true}}],
</I>&gt;<i>                           false,network,389}
</I>&gt;<i> ** Reason for termination ==
</I>&gt;<i> ** as_user_no_password
</I>&gt;<i>
</I>&gt;<i> =INFO REPORT==== 22-May-2013::09:32:37 ===
</I>&gt;<i> LDAP CHECK: passwordless login for O=client,CN=ecozzi-01
</I>&gt;<i>
</I>&gt;<i> =ERROR REPORT==== 22-May-2013::09:32:40 ===
</I>&gt;<i> closing AMQP connection &lt;0.4824.0&gt; (192.168.252.1:41297 -&gt;
</I>&gt;<i> 192.168.252.1:5671):
</I>&gt;<i> {handshake_error,starting,0,
</I>&gt;<i>      {exit,
</I>&gt;<i>          {as_user_no_password,
</I>&gt;<i>              {gen_server,call,
</I>&gt;<i>                  [rabbit_auth_backend_ldap,
</I>&gt;<i>                   {login,&lt;&lt;&quot;O=client,CN=ecozzi-01&quot;&gt;&gt;},
</I>&gt;<i>                   infinity]}},
</I>&gt;<i>          'connection.start_ok',
</I>&gt;<i>          [{gen_server,call,3,[{file,&quot;gen_server.erl&quot;},{line,188}]},
</I>&gt;<i>           {rabbit_access_control,'-check_user_login/2-fun-0-',4,[]},
</I>&gt;<i>
</I>&gt;<i> {proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]}}
</I>&gt;<i>
</I>&gt;<i> rabbitmq.config:
</I>&gt;<i>
</I>&gt;<i> [
</I>&gt;<i>    {rabbit,
</I>&gt;<i>      [
</I>&gt;<i>        {hipe_compile, true},
</I>&gt;<i>        {tcp_listen_options,
</I>&gt;<i>          [binary,
</I>&gt;<i>            {packet,raw},
</I>&gt;<i>            {reuseaddr,true},
</I>&gt;<i>            {backlog,128},
</I>&gt;<i>            {nodelay,true},
</I>&gt;<i>            {exit_on_close,false}
</I>&gt;<i>          ]
</I>&gt;<i>        },
</I>&gt;<i>        {auth_mechanisms, ['EXTERNAL']},
</I>&gt;<i>        {ssl_listeners, [5671]},
</I>&gt;<i>        {ssl_options, [{cacertfile,&quot;/opt/cray/ssl/testca/cacert.pem&quot;},
</I>&gt;<i>                       {certfile,&quot;/opt/cray/ssl/server-01/cert.pem&quot;},
</I>&gt;<i>                       {keyfile,&quot;/opt/cray/ssl/server-01/key.pem&quot;},
</I>&gt;<i>                       {verify,verify_peer},
</I>&gt;<i>                       {fail_if_no_peer_cert,true}
</I>&gt;<i>                      ]
</I>&gt;<i>        },
</I>&gt;<i>        {auth_backends, [rabbit_auth_backend_ldap]}
</I>&gt;<i>      ]
</I>&gt;<i>    },
</I>&gt;<i>    {rabbitmq_auth_backend_ldap,
</I>&gt;<i>      [
</I>&gt;<i>        {servers,               [&quot;192.168.252.5&quot;]},
</I>&gt;<i>         {user_dn_pattern,       &quot;cn=${username},ou=msgbus,dc=cray,dc=com&quot;},
</I>&gt;<i>         {use_ssl,               false},
</I>&gt;<i>         {port,                  389},
</I>&gt;<i>         {log,                   network},
</I>&gt;<i>         {vhost_access_query,    {in_group,
</I>&gt;<i> &quot;ou=${vhost}-users,ou=vhosts,dc=cray,dc=com&quot;}},
</I>&gt;<i>         {resource_access_query,
</I>&gt;<i>           {for, [
</I>&gt;<i>                   {permission, configure, {in_group,
</I>&gt;<i> &quot;cn=admin,dc=cray,dc=com&quot;}},
</I>&gt;<i>                   {permission, write,
</I>&gt;<i>                     {for, [{resource, queue,    {in_group,
</I>&gt;<i> &quot;cn=admin,dc=cray,dc=com&quot;}},
</I>&gt;<i>                            {resource, exchange, {constant, true}}]}},
</I>&gt;<i>                   {permission, read,
</I>&gt;<i>                     {for, [{resource, exchange, {in_group,
</I>&gt;<i> &quot;cn=admin,dc=cray,dc=com&quot;}},
</I>&gt;<i>                            {resource, queue,    {constant, true}}]}}
</I>&gt;<i>                 ]
</I>&gt;<i>           }
</I>&gt;<i>         },
</I>&gt;<i>         {tag_queries, [
</I>&gt;<i>                         {administrator, {constant, false}},
</I>&gt;<i>                         {management,    {constant, true}}
</I>&gt;<i>                       ]
</I>&gt;<i>         }
</I>&gt;<i>     ]
</I>&gt;<i>    }
</I>&gt;<i> ].
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027423.html">[rabbitmq-discuss] Error trying to configure	rabbit_auth_backend_ldap
</A></li>
	<LI>Next message: <A HREF="027426.html">[rabbitmq-discuss] effectively using -setcookie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27424">[ date ]</a>
              <a href="thread.html#27424">[ thread ]</a>
              <a href="subject.html#27424">[ subject ]</a>
              <a href="author.html#27424">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
