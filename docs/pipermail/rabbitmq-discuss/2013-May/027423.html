<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Error trying to configure	rabbit_auth_backend_ldap
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Error%20trying%20to%20configure%0A%09rabbit_auth_backend_ldap&In-Reply-To=%3C519CE2C7.2020901%40cray.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027418.html">
   <LINK REL="Next"  HREF="027424.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Error trying to configure	rabbit_auth_backend_ldap</H1>
    <B>Eric Cozzi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Error%20trying%20to%20configure%0A%09rabbit_auth_backend_ldap&In-Reply-To=%3C519CE2C7.2020901%40cray.com%3E"
       TITLE="[rabbitmq-discuss] Error trying to configure	rabbit_auth_backend_ldap">n16483 at cray.com
       </A><BR>
    <I>Wed May 22 16:22:47 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027418.html">[rabbitmq-discuss] FW:  Rabbit Persistence Store Documentation
</A></li>
        <LI>Next message: <A HREF="027424.html">[rabbitmq-discuss] Error trying to configure	rabbit_auth_backend_ldap
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27423">[ date ]</a>
              <a href="thread.html#27423">[ thread ]</a>
              <a href="subject.html#27423">[ subject ]</a>
              <a href="author.html#27423">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am trying to configure rabbit_auth_backend_ldap as a backing auth for 
passwordless login using rabbitmq_auth_mechanism_ssl, but I am getting 
the following error. I've also included my rabbitmq.config file for 
reference.

Any help would be appreciated.
Thanks,
Eric

Logfile:

=ERROR REPORT==== 22-May-2013::09:32:37 ===
** Generic server rabbit_auth_backend_ldap terminating
** Last message in was {login,&lt;&lt;&quot;O=client,CN=ecozzi-01&quot;&gt;&gt;}
** When Server state == {state,
                          [&quot;192.168.252.5&quot;],
                          
&quot;cn=${username},ou=msgbus,dc=cray,dc=com&quot;,none,none,
                          as_user,
                          {in_group,
                           &quot;ou=${vhost}-users,ou=vhosts,dc=cray,dc=com&quot;},
                          {for,
                           [{permission,configure,
                             {in_group,&quot;cn=admin,dc=cray,dc=com&quot;}},
                            {permission,write,
                             {for,
                              [{resource,queue,
                                {in_group,&quot;cn=admin,dc=cray,dc=com&quot;}},
                               {resource,exchange,{constant,true}}]}},
                            {permission,read,
                             {for,
                              [{resource,exchange,
                                {in_group,&quot;cn=admin,dc=cray,dc=com&quot;}},
                               {resource,queue,{constant,true}}]}}]},
                          [{administrator,{constant,false}},
                           {management,{constant,true}}],
                          false,network,389}
** Reason for termination ==
** as_user_no_password

=INFO REPORT==== 22-May-2013::09:32:37 ===
LDAP CHECK: passwordless login for O=client,CN=ecozzi-01

=ERROR REPORT==== 22-May-2013::09:32:40 ===
closing AMQP connection &lt;0.4824.0&gt; (192.168.252.1:41297 -&gt; 
192.168.252.1:5671):
{handshake_error,starting,0,
     {exit,
         {as_user_no_password,
             {gen_server,call,
                 [rabbit_auth_backend_ldap,
                  {login,&lt;&lt;&quot;O=client,CN=ecozzi-01&quot;&gt;&gt;},
                  infinity]}},
         'connection.start_ok',
         [{gen_server,call,3,[{file,&quot;gen_server.erl&quot;},{line,188}]},
          {rabbit_access_control,'-check_user_login/2-fun-0-',4,[]},
          {proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]}}

rabbitmq.config:

[
   {rabbit,
     [
       {hipe_compile, true},
       {tcp_listen_options,
         [binary,
           {packet,raw},
           {reuseaddr,true},
           {backlog,128},
           {nodelay,true},
           {exit_on_close,false}
         ]
       },
       {auth_mechanisms, ['EXTERNAL']},
       {ssl_listeners, [5671]},
       {ssl_options, [{cacertfile,&quot;/opt/cray/ssl/testca/cacert.pem&quot;},
                      {certfile,&quot;/opt/cray/ssl/server-01/cert.pem&quot;},
                      {keyfile,&quot;/opt/cray/ssl/server-01/key.pem&quot;},
                      {verify,verify_peer},
                      {fail_if_no_peer_cert,true}
                     ]
       },
       {auth_backends, [rabbit_auth_backend_ldap]}
     ]
   },
   {rabbitmq_auth_backend_ldap,
     [
       {servers,               [&quot;192.168.252.5&quot;]},
        {user_dn_pattern,       &quot;cn=${username},ou=msgbus,dc=cray,dc=com&quot;},
        {use_ssl,               false},
        {port,                  389},
        {log,                   network},
        {vhost_access_query,    {in_group,
                                 
&quot;ou=${vhost}-users,ou=vhosts,dc=cray,dc=com&quot;}},
        {resource_access_query,
          {for, [
                  {permission, configure, {in_group, 
&quot;cn=admin,dc=cray,dc=com&quot;}},
                  {permission, write,
                    {for, [{resource, queue,    {in_group, 
&quot;cn=admin,dc=cray,dc=com&quot;}},
                           {resource, exchange, {constant, true}}]}},
                  {permission, read,
                    {for, [{resource, exchange, {in_group, 
&quot;cn=admin,dc=cray,dc=com&quot;}},
                           {resource, queue,    {constant, true}}]}}
                ]
          }
        },
        {tag_queries, [
                        {administrator, {constant, false}},
                        {management,    {constant, true}}
                      ]
        }
    ]
   }
].

</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027418.html">[rabbitmq-discuss] FW:  Rabbit Persistence Store Documentation
</A></li>
	<LI>Next message: <A HREF="027424.html">[rabbitmq-discuss] Error trying to configure	rabbit_auth_backend_ldap
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27423">[ date ]</a>
              <a href="thread.html#27423">[ thread ]</a>
              <a href="subject.html#27423">[ subject ]</a>
              <a href="author.html#27423">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
