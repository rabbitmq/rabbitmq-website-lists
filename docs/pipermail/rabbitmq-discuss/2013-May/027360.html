<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Strange subtract_acks crash in RabbitMQ 3.1.0-1 (case_clause empty) on EC2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%0A%09%3D%3Futf-8%3Fq%3FStrange_subtract%3D5Facks_crash_in_Rab%3F%3D%0A%09%3D%3Futf-8%3Fq%3FbitMQ_3%3D2E1%3D2E0-1_%3D28case%3D5Fclause_empty%3D29_on_EC2%3F%3D&In-Reply-To=%3Cloom.20130520T161048-299%40post.gmane.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027339.html">
   <LINK REL="Next"  HREF="027340.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Strange subtract_acks crash in RabbitMQ 3.1.0-1 (case_clause empty) on EC2</H1>
    <B>Karl Rieb</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%0A%09%3D%3Futf-8%3Fq%3FStrange_subtract%3D5Facks_crash_in_Rab%3F%3D%0A%09%3D%3Futf-8%3Fq%3FbitMQ_3%3D2E1%3D2E0-1_%3D28case%3D5Fclause_empty%3D29_on_EC2%3F%3D&In-Reply-To=%3Cloom.20130520T161048-299%40post.gmane.org%3E"
       TITLE="[rabbitmq-discuss] Strange subtract_acks crash in RabbitMQ 3.1.0-1 (case_clause empty) on EC2">karl.rieb at gmail.com
       </A><BR>
    <I>Mon May 20 15:12:28 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027339.html">[rabbitmq-discuss] Strange subtract_acks crash in RabbitMQ 3.1.0-1 (case_clause empty) on EC2
</A></li>
        <LI>Next message: <A HREF="027340.html">[rabbitmq-discuss] Strange subtract_acks crash in RabbitMQ 3.1.0-1 (case_clause empty) on EC2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27360">[ date ]</a>
              <a href="thread.html#27360">[ thread ]</a>
              <a href="subject.html#27360">[ subject ]</a>
              <a href="author.html#27360">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Brett Cameron &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">brett.r.cameron at ...</A>&gt; writes:

&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Karl,I am not aware of any known issues in this regard (queues strangely 
</I>disapearing). The fact that you get the problem with different versions of 
Erlang and dofferent versions of RabbitMQ would make me suspect that it is 
more likely to be something external to the broker environment. The &quot;INFO: 
task beam.smp:18971 blocked for more than 120 seconds.&quot; messages in syslog 
are interesting. What I think is happening here is as follows: By default 
Linux uses up to 40% of the available memory for file system caching and 
if/when this threshold is reached the file system flushes all outstanding 
cached data to disk, causing all following I/O's become synchronous (until 
the flush completes). There is a default time limit of 120 seconds for the 
flush to complete. If you're EC2 VM's have a lot of RAM and are processing 
heavy I/O-intensive workloads, it is possible that the EBS volumes might 
sometimes not be able to keep up (or possibly there's some spike in network 
activity and available bandwidth goes through the floor). You have mentioned 
that your messages are not persistent, but RabbitMQ's memory usage might be 
such that it is occasionally deciding to flush a whole pile of stuff to 
disk. I notice that you have&#160; {vm_memory_high_watermark,0.8}, and this could 
have something to do with the problem - maybe try reducing this, and/or 
maybe set vm.dirty_ratio to something less than 40% in /etc/sysctl.conf 
(this might increase the frequency of flushes, but you'll be flushing less 
data). I'd possibly start by reducing vm_memory_high_watermark. I can't 
really correlate this with your queue disappearing, but if I/O's are getting 
messed up then all manner of weird things could happen I guess. Hopefully 
others might have some more tangible ideas!
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Brett
</I>&gt;<i> 
</I>
Hi Brett,

Thanks for the reply!  I will go ahead and reduce the watermark limit and 
configure the kernel to flush earlier to disk.  Hopefully this issue will go 
away after the changes.

-Karl





</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027339.html">[rabbitmq-discuss] Strange subtract_acks crash in RabbitMQ 3.1.0-1 (case_clause empty) on EC2
</A></li>
	<LI>Next message: <A HREF="027340.html">[rabbitmq-discuss] Strange subtract_acks crash in RabbitMQ 3.1.0-1 (case_clause empty) on EC2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27360">[ date ]</a>
              <a href="thread.html#27360">[ thread ]</a>
              <a href="subject.html#27360">[ subject ]</a>
              <a href="author.html#27360">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
