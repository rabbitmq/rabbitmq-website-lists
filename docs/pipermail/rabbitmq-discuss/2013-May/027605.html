<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Shovel authentication question (possible bug)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20authentication%20question%20%28possible%20bug%29&In-Reply-To=%3C8607A672AFB05B4D804456463DD7DCCF224CEDEC%40008-AM1MPN1-043.mgdnok.nokia.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027622.html">
   <LINK REL="Next"  HREF="027607.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Shovel authentication question (possible bug)</H1>
    <B>john.hayden at nokia.com</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Shovel%20authentication%20question%20%28possible%20bug%29&In-Reply-To=%3C8607A672AFB05B4D804456463DD7DCCF224CEDEC%40008-AM1MPN1-043.mgdnok.nokia.com%3E"
       TITLE="[rabbitmq-discuss] Shovel authentication question (possible bug)">john.hayden at nokia.com
       </A><BR>
    <I>Fri May 31 16:29:38 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027622.html">[rabbitmq-discuss] tag rabbitmq_v3_0_4 missing from	rabbitmq-web-dispatch
</A></li>
        <LI>Next message: <A HREF="027607.html">[rabbitmq-discuss] Shovel authentication question (possible bug)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27605">[ date ]</a>
              <a href="thread.html#27605">[ thread ]</a>
              <a href="subject.html#27605">[ subject ]</a>
              <a href="author.html#27605">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am very new to rabbitmq and shovel but I may have found a bug:

My setup:

I am running Rabbit 3.1.1 and have shovel plugin enabled.
I have sense clients that communicate with this rabbit broker successfully to vhost /sensu with sensu and mypass as username and password.

The shovel plugin (loaded on the first Rabbit) with talk to a 2nd Rabbit which is also serving sense clients using the same vhost, username and password.

Here is my shovel config file:

[
    {rabbitmq_shovel,
      [{shovels, [ {test_shovel,
        [ {sources, [{broker, &quot;<A HREF="amqp://sensu:mypass@/sensu&quot;}]}">amqp://sensu:mypass@/sensu&quot;}]}</A>
        , {destinations, [{broker, &quot;<A HREF="amqp://sensu:mypass@ec2-54-245-126-50.us-west-2.compute.amazonaws.com/sensu&quot;}]}">amqp://sensu:mypass@ec2-54-245-126-50.us-west-2.compute.amazonaws.com/sensu&quot;}]}</A>
        , {queue, &lt;&lt;&quot;rabbitmq-us-west-2&quot;&gt;&gt;}
        ]
      }]}]
    }
].

As you can see, my source (which is Rabbit1) is being connected to by the shovel by the non network method and has the username, password and vhost
The destination is set up as a network connection

Here is the error is get after a restart of Rabbit1 server:

=INFO REPORT==== 31-May-2013::15:13:10 ===
accepting AMQP connection &lt;0.387.0&gt; (10.73.3.20:39733 -&gt; 10.40.215.251:5672)

=ERROR REPORT==== 31-May-2013::15:13:24 ===
** Generic server &lt;0.400.0&gt; terminating
** Last message in was {'$gen_cast',init}
** When Server state == {state,undefined,undefined,undefined,undefined,
                         test_shovel,
                         {shovel,
                          {endpoint,
                           [{amqp_params_direct,&lt;&lt;&quot;sensu&quot;&gt;&gt;,none,&lt;&lt;&quot;sensu&quot;&gt;&gt;,
                             '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-40-215-251</A>',none,[]}],
                           []},
                          {endpoint,
                           [{amqp_params_network,&lt;&lt;&quot;sensu&quot;&gt;&gt;,&lt;&lt;&quot;mypass&quot;&gt;&gt;,
                             &lt;&lt;&quot;sensu&quot;&gt;&gt;,
                             &quot;ec2-54-245-126-50.us-west-2.compute.amazonaws.com&quot;,
                             undefined,0,0,0,infinity,none,
                             [#Fun&lt;amqp_uri.7.123484526&gt;,
                              #Fun&lt;amqp_uri.7.123484526&gt;],
                             [],[]}],
                           []},
                          0,on_confirm,
                          #Fun&lt;rabbit_shovel_config.15.100604638&gt;,
                          #Fun&lt;rabbit_shovel_config.15.100604638&gt;,
                          &lt;&lt;&quot;rabbitmq-us-west-2&quot;&gt;&gt;,5},
                         undefined,undefined,undefined,undefined,undefined}
** Reason for termination ==
** {{badmatch,{error,access_refused}},
    [{rabbit_shovel_worker,make_conn_and_chan,1},
     {rabbit_shovel_worker,handle_cast,2},
     {gen_server2,handle_msg,2},
     {proc_lib,init_p_do_apply,3}]}


Notice this line:
[{amqp_params_direct,&lt;&lt;&quot;sensu&quot;&gt;&gt;,none,&lt;&lt;&quot;sensu&quot;&gt;&gt;,
                             '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ip-10-40-215-251</A>',none,[]}],

If I read this correctly, the password is not being passed and THUS authentication is being denied.

Is this a bug?

John Hayden
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/a2022eb3/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130531/a2022eb3/attachment.htm</A>&gt;
</PRE>














<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027622.html">[rabbitmq-discuss] tag rabbitmq_v3_0_4 missing from	rabbitmq-web-dispatch
</A></li>
	<LI>Next message: <A HREF="027607.html">[rabbitmq-discuss] Shovel authentication question (possible bug)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27605">[ date ]</a>
              <a href="thread.html#27605">[ thread ]</a>
              <a href="subject.html#27605">[ subject ]</a>
              <a href="author.html#27605">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
