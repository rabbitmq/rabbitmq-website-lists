<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] new queue causes extremely poor disk IO
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20new%20queue%20causes%20extremely%20poor%20disk%20IO&In-Reply-To=%3CCABZkbxja%3DAhfCUqcpttSU9zeRZr0SMzTQSrdYtffPGttVASQTA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027279.html">
   <LINK REL="Next"  HREF="027293.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] new queue causes extremely poor disk IO</H1>
    <B>Kevin Goess</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20new%20queue%20causes%20extremely%20poor%20disk%20IO&In-Reply-To=%3CCABZkbxja%3DAhfCUqcpttSU9zeRZr0SMzTQSrdYtffPGttVASQTA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] new queue causes extremely poor disk IO">kgoess at bepress.com
       </A><BR>
    <I>Fri May 17 16:38:01 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027279.html">[rabbitmq-discuss] Server hanging on start, randomly dying
</A></li>
        <LI>Next message: <A HREF="027293.html">[rabbitmq-discuss] new queue causes extremely poor disk IO
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27289">[ date ]</a>
              <a href="thread.html#27289">[ thread ]</a>
              <a href="subject.html#27289">[ subject ]</a>
              <a href="author.html#27289">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi, we were hoping to get some pointers in looking into this problem.
 We're running rabbitmq 2.7.1-1 in a xen VM on debian 6 squeeze.

We generally process about 20 messages/sec, with occasional transient
spikes to 500.

We recently added a new queue and saw the disk utilization jump to 60-80%
and the iowait  to 40-60%. Read sectors/sec is around 0, and write
sectors/sec is about 1k, which is unchanged from before adding this new
queue.

The input and output on this new queue is only 1-10 per second.  The
messages in it are only 60-70 bytes.  We currently have a backlog of about
100,000 messages in the queue, we maxed out at 250,000.

The individual consumers of this new queue don't fetch that many
messages--the work they're associated with takes 1-30 seconds to perform.
 We're using STOMP as a message transport.

The problem is that every consumer we add to the queue seems to increase
disk activity by about 10%, and by the time we have 8 consumers, the
rabbitmq server is overloaded enough that other queues start falling behind
in their deliveries.

If we shut off all the consumers on the new queue, disk activity
immediately falls to easily sustainable levels (near zero iowait).

Is there anything we can look at to get further information on the problem?
 Any pointers you have would be helpful.  Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/046619ae/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/046619ae/attachment.htm</A>&gt;
</PRE>


























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027279.html">[rabbitmq-discuss] Server hanging on start, randomly dying
</A></li>
	<LI>Next message: <A HREF="027293.html">[rabbitmq-discuss] new queue causes extremely poor disk IO
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27289">[ date ]</a>
              <a href="thread.html#27289">[ thread ]</a>
              <a href="subject.html#27289">[ subject ]</a>
              <a href="author.html#27289">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
