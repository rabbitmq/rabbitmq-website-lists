<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Telling clean shutdown from an error-related	one
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Telling%20clean%20shutdown%20from%20an%20error-related%0A%09one&In-Reply-To=%3C6BB0CA55-F137-4BE1-A575-B55B07D8F6CF%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027213.html">
   <LINK REL="Next"  HREF="027214.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Telling clean shutdown from an error-related	one</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Telling%20clean%20shutdown%20from%20an%20error-related%0A%09one&In-Reply-To=%3C6BB0CA55-F137-4BE1-A575-B55B07D8F6CF%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Telling clean shutdown from an error-related	one">tim at rabbitmq.com
       </A><BR>
    <I>Thu May 16 09:14:46 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027213.html">[rabbitmq-discuss] Telling clean shutdown from an error-related one
</A></li>
        <LI>Next message: <A HREF="027214.html">[rabbitmq-discuss] getting duplicated delivery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27224">[ date ]</a>
              <a href="thread.html#27224">[ thread ]</a>
              <a href="subject.html#27224">[ subject ]</a>
              <a href="author.html#27224">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Michael,

On 15 May 2013, at 21:51, Michael Klishin wrote:

&gt;<i> I'm investigating an issue report for Langohr:
</I>&gt;<i> <A HREF="https://github.com/michaelklishin/langohr/issues/16#issuecomment-17964559">https://github.com/michaelklishin/langohr/issues/16#issuecomment-17964559</A>
</I>&gt;<i> 
</I>&gt;<i> and not entirely sure when SignalShutdownException#isInitiatedByApplication
</I>&gt;<i> returns true and if it can really be used to tell a clean shutdown (e.g. when you
</I>&gt;<i> voluntarily close channels).
</I>&gt;<i> 
</I>
That property will evaluate to true whenever the source of the shutdown originated in the client application, whether by deliberate closure or application error. So I'm not sure that you can differentiate based on that properly alone. Certainly the property will always be set to true when a channel is deliberately closed by the application, via a call to #close() or #waitForConfirmsOrDie and so on. However the comment at <A HREF="https://github.com/michaelklishin/langohr/issues/16#issuecomment-17964103">https://github.com/michaelklishin/langohr/issues/16#issuecomment-17964103</A> is correct, in that an exception in the consumer code will still set #isInitiatedByApplication to true.

So IMO, even when #isInitiatedByApplication is true, we should probably make it easier to determine whether a channel close was a deliberate action or the result of an application error. I'll file a bug for that.

&gt;<i> What's the recommended way to detect network errors
</I>
For these, #isInitiatedByApplication will be false. You can also look at the exception tucked away in #getReason to determine this, at least to some extent.

&gt;<i> , channel AND consumer-level exceptions vs clean termination?
</I>
There is no clean way to do this atm afaict - I think Ian Eure's analysis is correct and the the only way to differentiate between the two right now would be to &quot;go spelunking through the object tree looking for the text 'Closed due to exception'&quot; in Exception#getMessage. As I said, we'll fix that.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/1be834b2/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/1be834b2/attachment.htm</A>&gt;
</PRE>



























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027213.html">[rabbitmq-discuss] Telling clean shutdown from an error-related one
</A></li>
	<LI>Next message: <A HREF="027214.html">[rabbitmq-discuss] getting duplicated delivery
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27224">[ date ]</a>
              <a href="thread.html#27224">[ thread ]</a>
              <a href="subject.html#27224">[ subject ]</a>
              <a href="author.html#27224">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
