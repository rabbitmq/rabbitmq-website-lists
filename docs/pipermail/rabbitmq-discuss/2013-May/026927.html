<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RECONDITION_FAILED%20-%20unknown%20delivery%20tag&In-Reply-To=%3C51877334.4060303%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026925.html">
   <LINK REL="Next"  HREF="026981.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RECONDITION_FAILED%20-%20unknown%20delivery%20tag&In-Reply-To=%3C51877334.4060303%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag">matthias at rabbitmq.com
       </A><BR>
    <I>Mon May  6 10:09:08 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026925.html">[rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag
</A></li>
        <LI>Next message: <A HREF="026981.html">[rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26927">[ date ]</a>
              <a href="thread.html#26927">[ thread ]</a>
              <a href="subject.html#26927">[ subject ]</a>
              <a href="author.html#26927">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05/05/13 23:48, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">macmillan.josh09 at gmail.com</A> wrote:
&gt;<i> My Node.js worker crashes (RECONDITION_FAILED - unknown delivery tag) if
</I>&gt;<i> the following 2 conditions are met:
</I>&gt;<i>
</I>&gt;<i> 1. I start it AFTER the queue have at least 2 messages.
</I>&gt;<i> 2. The q.shift() is in an async code.
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://pastebin.com/uMQJn0Fe">http://pastebin.com/uMQJn0Fe</A>
</I>
Looking at the amqp.js code, q.shift() acknowledges the last message 
that was received. So with your code...

&gt;<i>          q.subscribe({ack:true, prefetchCount: 0}, function (message,
</I>&gt;<i>     headers, deliveryInfo) {
</I>&gt;<i>            console.log(message);
</I>&gt;<i>            setTimeout(function() { q.shift(); }, 100);
</I>&gt;<i>     });
</I>&gt;<i>     });
</I>
due to the delayed execution, when two messages arrive in quick 
succession then the first to arrive won't be acknowledged at all and the 
second will be acknowledged twice. Rabbit is complaining about the latter.

I've never used node-amqp, so I don't know what the correct approach is 
for accomplishing what you want to do. You may want to ask the node-amqp 
developers.

Matthias

</PRE>




























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026925.html">[rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag
</A></li>
	<LI>Next message: <A HREF="026981.html">[rabbitmq-discuss] RECONDITION_FAILED - unknown delivery tag
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26927">[ date ]</a>
              <a href="thread.html#26927">[ thread ]</a>
              <a href="subject.html#26927">[ subject ]</a>
              <a href="author.html#26927">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
