<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] empty rabbit_serial file causes rabbitmq cluster to hang
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20empty%20rabbit_serial%20file%20causes%20rabbitmq%0A%20cluster%20to%20hang&In-Reply-To=%3C9BF1FFB72A0A1C46918CACA3891CB96A03D28995%40MLBXv02.nih.gov%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027519.html">
   <LINK REL="Next"  HREF="027540.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] empty rabbit_serial file causes rabbitmq cluster to hang</H1>
    <B>Denisenko, Mikhail (NIH/NLM/NCBI) [C]</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20empty%20rabbit_serial%20file%20causes%20rabbitmq%0A%20cluster%20to%20hang&In-Reply-To=%3C9BF1FFB72A0A1C46918CACA3891CB96A03D28995%40MLBXv02.nih.gov%3E"
       TITLE="[rabbitmq-discuss] empty rabbit_serial file causes rabbitmq cluster to hang">mikhail.denisenko at nih.gov
       </A><BR>
    <I>Wed May 29 15:43:06 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027519.html">[rabbitmq-discuss] empty rabbit_serial file causes rabbitmq cluster to hang
</A></li>
        <LI>Next message: <A HREF="027540.html">[rabbitmq-discuss] empty rabbit_serial file causes rabbitmq cluster to hang
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27538">[ date ]</a>
              <a href="thread.html#27538">[ thread ]</a>
              <a href="subject.html#27538">[ subject ]</a>
              <a href="author.html#27538">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the feature request. In our case this file become corrupted after restart of rabbitmq. Our restart procedure is to try graceful restart first and after some time try kill -9 if it didn't exit. I suspect that in this case it didn't die within timeout and was killed with -9 and maybe it didn't flush buffer for this file.
________________________________________
From: Matthias Radestock [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>]
Sent: Wednesday, May 29, 2013 3:49 AM
To: Discussions about RabbitMQ
Cc: Denisenko, Mikhail (NIH/NLM/NCBI) [C]
Subject: Re: [rabbitmq-discuss] empty rabbit_serial file causes rabbitmq cluster to hang

On 28/05/13 23:42, Denisenko, Mikhail (NIH/NLM/NCBI) [C] wrote:
&gt;<i> We had a problem today that was caused by wiped rabbit_serial file on
</I>&gt;<i> one of the nodes. Our rabbitmq cluster consisting of two nodes become
</I>&gt;<i> inaccessible.
</I>&gt;<i>
</I>&gt;<i> There is a ticket: <A HREF="https://github.com/rabbitmq/rabbitmq-server/issues/17">https://github.com/rabbitmq/rabbitmq-server/issues/17</A>
</I>&gt;<i>
</I>&gt;<i> I think that rabbitmq should be able to recover from this situation by
</I>&gt;<i> maybe removing invalid rabbit_serial file, what do you think?
</I>
As Emile mentioned in the ticket, rabbit cannot recover from arbitrary
filesystem corruption.

The specific issue of rabbit_serial being empty actually has come up
once before - see
<A HREF="http://rabbitmq.1065348.n5.nabble.com/Cannot-start-guid-generator-rabbitmq-td4415.html.">http://rabbitmq.1065348.n5.nabble.com/Cannot-start-guid-generator-rabbitmq-td4415.html.</A>
So I have filed a feature request to investigate whether we should
handle this particular case of corruption more gracefully.

I recommend you look into what may have caused the corruption. While
there is an easy workaround in this particular instance, the same isn't
true for other files, and corruptions there could easily lead to data
loss, possibly undetected.


Regards,

Matthias.
</PRE>

















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027519.html">[rabbitmq-discuss] empty rabbit_serial file causes rabbitmq cluster to hang
</A></li>
	<LI>Next message: <A HREF="027540.html">[rabbitmq-discuss] empty rabbit_serial file causes rabbitmq cluster to hang
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27538">[ date ]</a>
              <a href="thread.html#27538">[ thread ]</a>
              <a href="subject.html#27538">[ subject ]</a>
              <a href="author.html#27538">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
