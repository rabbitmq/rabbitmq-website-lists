<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RDQ files filling the disk.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RDQ%20files%20filling%20the%20disk.&In-Reply-To=%3C6ADE8373-F46E-435C-BA32-96D47D85BB7B%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027388.html">
   <LINK REL="Next"  HREF="027407.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RDQ files filling the disk.</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RDQ%20files%20filling%20the%20disk.&In-Reply-To=%3C6ADE8373-F46E-435C-BA32-96D47D85BB7B%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] RDQ files filling the disk.">watson.timothy at gmail.com
       </A><BR>
    <I>Wed May 22 09:38:19 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027388.html">[rabbitmq-discuss] RDQ files filling the disk.
</A></li>
        <LI>Next message: <A HREF="027407.html">[rabbitmq-discuss] RDQ files filling the disk.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27399">[ date ]</a>
              <a href="thread.html#27399">[ thread ]</a>
              <a href="subject.html#27399">[ subject ]</a>
              <a href="author.html#27399">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 21 May 2013, at 23:19, &quot;michi.oshima&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">moshima at advent.com</A>&gt; wrote:

&gt;<i> We recently had an issue where Rabbit1 started taking up a lot of disk
</I>&gt;<i> space.  A directory called 'msg_store_transient' got up to some 20 GB,
</I>&gt;<i> filled with files with *.rdq extension.  They are about 16MB each in size. 
</I>&gt;<i> It almost filled up the disk (it's a small disk) and caused our application
</I>&gt;<i> (client to Rabbit1) to fail.
</I>&gt;<i> 
</I>
Rabbit will start paging transient (non-persistent) messages to disk if memory starts to get tight (i.e., close to the high watermark) and they'll end up in that file.

&gt;<i> Meanwhile, Rabbit2 reportedly have been receiving the messages from Rabbit1. 
</I>&gt;<i> I also saw no shovel connection related errors in rabbit.log, etc.
</I>&gt;<i> 
</I>&gt;<i> Q1. Does this sound plausible?  If so, how could this happen?
</I>
Sounds like rabbit1 is paging due to memory pressure. Do you see a memory alarm in the logs? Even if you don't, it may be paging pre-emptively.

&gt;<i> Q2. I'm thinking the rdq files are meant to get deleted at some point.  What
</I>&gt;<i> would cause the files to *not* get deleted?
</I>
The paged out messages will need to be delivered and acked and, at the same time, memory use will need to drop back so that eventually the broker stops paging deliberately. There are probably more specific indicators (I'm not looking at the source right now), but  first of all let's take a look at memory use on that box whilst the file is growing.

Cheers,
Tim
</PRE>










































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027388.html">[rabbitmq-discuss] RDQ files filling the disk.
</A></li>
	<LI>Next message: <A HREF="027407.html">[rabbitmq-discuss] RDQ files filling the disk.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27399">[ date ]</a>
              <a href="thread.html#27399">[ thread ]</a>
              <a href="subject.html#27399">[ subject ]</a>
              <a href="author.html#27399">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
