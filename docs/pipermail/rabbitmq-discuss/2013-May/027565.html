<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] New lua-resty-rabbitmq library
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20New%20lua-resty-rabbitmq%20library&In-Reply-To=%3CCAMF%2B%2BH9BZAw6ooF2h8LSm0jUzHJjwX6Xd%3D3NxUfOn2zM9NohpA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027562.html">
   <LINK REL="Next"  HREF="027566.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] New lua-resty-rabbitmq library</H1>
    <B>Rohit Yadav</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20New%20lua-resty-rabbitmq%20library&In-Reply-To=%3CCAMF%2B%2BH9BZAw6ooF2h8LSm0jUzHJjwX6Xd%3D3NxUfOn2zM9NohpA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] New lua-resty-rabbitmq library">rohit.yadav at wingify.com
       </A><BR>
    <I>Thu May 30 14:45:42 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027562.html">[rabbitmq-discuss] AutoAck issue
</A></li>
        <LI>Next message: <A HREF="027566.html">[rabbitmq-discuss] [openresty] New lua-resty-rabbitmq library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27565">[ date ]</a>
              <a href="thread.html#27565">[ thread ]</a>
              <a href="subject.html#27565">[ subject ]</a>
              <a href="author.html#27565">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I started working on implementing a client library for RabbitMQ based on
STOMP 1.2 protocol, I'm sharing the initial buggy version [1] with the
community for feedback, suggestions and review.

For the initial version I've implemented only authentication and publishing
using receipts. I'll blog about this work with some history and background
soon [2].

To test this library I wrote a load testing tool in golang which would run
concurrent HTTP requests to an Openresty server. A handler runs Lua code
for that request and uses the resty-rabbitmq library to sanitize, serialize
and publish data to RabbitMQ's STOMP adapter.

With a noncurrent load test of total 1M requests, using the library a
producer (in /example/) was able to publish all the messages to the broker
without any errors. But in case of concurrent connections, I frequently got
timeout errors or writing to closed socket errors.

How may I make publishing fault tolerant and avoid deduplicating messages
in concurrent environment by correctly implementing states and reuse
sockets using cosocket api pool? I set keepalive timeout on the cosocket
tcp sock to 0 (no timeout as per wiki) and I saw exponential increase in
socket consumed via the RabbitMQ management web interface, for a load of
100k requests, I saw fluctuations between 200-1200 consumed sockets with a
lot of socket errors.

Ideas, flames? Thanks.

[1] <A HREF="https://github.com/wingify/lua-resty-rabbitmq">https://github.com/wingify/lua-resty-rabbitmq</A>
[2] <A HREF="http://engineering.wingify.com/">http://engineering.wingify.com/</A>

Regards,
Rohit Yadav
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/563ed5db/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/563ed5db/attachment.htm</A>&gt;
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027562.html">[rabbitmq-discuss] AutoAck issue
</A></li>
	<LI>Next message: <A HREF="027566.html">[rabbitmq-discuss] [openresty] New lua-resty-rabbitmq library
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27565">[ date ]</a>
              <a href="thread.html#27565">[ thread ]</a>
              <a href="subject.html#27565">[ subject ]</a>
              <a href="author.html#27565">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
