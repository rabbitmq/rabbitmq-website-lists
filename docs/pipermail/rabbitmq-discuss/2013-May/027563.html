<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Messages as mutex tokens - rewrite or nack
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Messages%20as%20mutex%20tokens%20-%20rewrite%20or%20nack&In-Reply-To=%3C51A74EC4.3040700%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027557.html">
   <LINK REL="Next"  HREF="027558.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Messages as mutex tokens - rewrite or nack</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Messages%20as%20mutex%20tokens%20-%20rewrite%20or%20nack&In-Reply-To=%3C51A74EC4.3040700%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Messages as mutex tokens - rewrite or nack">simon at rabbitmq.com
       </A><BR>
    <I>Thu May 30 14:06:12 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027557.html">[rabbitmq-discuss] Messages as mutex tokens - rewrite or nack
</A></li>
        <LI>Next message: <A HREF="027558.html">[rabbitmq-discuss] AutoAck issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27563">[ date ]</a>
              <a href="thread.html#27563">[ thread ]</a>
              <a href="subject.html#27563">[ subject ]</a>
              <a href="author.html#27563">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>basic.reject and basic.nack are really only different on the wire.

As you have seen, the AMQP standard states that a server MUST avoid 
redelivering the message to the came channel. In practice we don't do 
that, the message is just reinserted into the queue.

We don't guarantee that we won't change a future version of RabbitMQ to 
be closer to the spec in this regard, but it's certainly not high up our 
list of priorities now. But just in case, you might want to stick to 
your current approach.

Cheers, Simon

On 30/05/13 13:34, Laing, Michael P. wrote:
&gt;<i> Our clusters support apps that do work periodically, e.g. Every few
</I>&gt;<i> seconds or minutes, typically analyzing/reporting the state of other apps.
</I>&gt;<i>
</I>&gt;<i> We run an identical instance of each app connected to each node of the
</I>&gt;<i> cluster. The apps each subscribe to a 'token' mirrored queue which is
</I>&gt;<i> seeded with a single message.
</I>&gt;<i>
</I>&gt;<i> One app gets the message, does its work, waits for the appropriate
</I>&gt;<i> interval, and then republishes the token message to the queue. The next
</I>&gt;<i> app gets the message - they proceed in a round robin fashion.
</I>&gt;<i>
</I>&gt;<i> Today I am reviewing and refactoring this logic, and I wonder if it
</I>&gt;<i> would be better to keep a single token message and just nack it instead
</I>&gt;<i> of rewriting. Nacking is a little simpler.
</I>&gt;<i>
</I>&gt;<i> However, I see in the documentation for BasicReject that the broker may
</I>&gt;<i> not want to deliver the same message within the same channel context;
</I>&gt;<i> does this hold for BasicNack as well?
</I>&gt;<i>
</I>&gt;<i> In a cluster with one node, the above pattern using rewrite works fine.
</I>&gt;<i> Would it still work using nack or would the app have to close the
</I>&gt;<i> channel and resubscribe using a new one (probably too expensive/messy)?
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Michael
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027557.html">[rabbitmq-discuss] Messages as mutex tokens - rewrite or nack
</A></li>
	<LI>Next message: <A HREF="027558.html">[rabbitmq-discuss] AutoAck issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27563">[ date ]</a>
              <a href="thread.html#27563">[ thread ]</a>
              <a href="subject.html#27563">[ subject ]</a>
              <a href="author.html#27563">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
