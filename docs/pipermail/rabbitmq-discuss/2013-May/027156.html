<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Multiple local-usernames for federation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Multiple%20local-usernames%20for%20federation&In-Reply-To=%3C51924022.50005%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027155.html">
   <LINK REL="Next"  HREF="027165.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Multiple local-usernames for federation</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Multiple%20local-usernames%20for%20federation&In-Reply-To=%3C51924022.50005%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Multiple local-usernames for federation">simon at rabbitmq.com
       </A><BR>
    <I>Tue May 14 14:46:10 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027155.html">[rabbitmq-discuss] Multiple local-usernames for federation
</A></li>
        <LI>Next message: <A HREF="027165.html">[rabbitmq-discuss] Multiple local-usernames for federation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27156">[ date ]</a>
              <a href="thread.html#27156">[ thread ]</a>
              <a href="subject.html#27156">[ subject ]</a>
              <a href="author.html#27156">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 14/05/13 14:24, Roman Gaufman wrote:
&gt;<i> Yes but I want it biodirectional, I tried to simplify the example, but I
</I>&gt;<i> guess that wasn't helpful.
</I>
Ah, got it.

&lt;snip&gt;

&gt;<i> They each have a RabbitMQ instance, on each one I do:
</I>&gt;<i>
</I>&gt;<i>  1. Create vhost: oracle
</I>&gt;<i>  2. Create new users: moscow:password, london:password, cloud:password
</I>&gt;<i>  3. Set permissions for all users for the oracle vhost: .* .* .*
</I>&gt;<i>  4. Set local username and nodename
</I>&gt;<i>      1. Cloud: rabbitmqctl -p oracle set_parameter federation
</I>&gt;<i>         local-username '&quot;Cloud&quot;'
</I>&gt;<i>      2. London: rabbitmqctl -p oracle set_parameter federation
</I>&gt;<i>         local-nodename '&quot;London&quot;'
</I>&gt;<i>      3. Moscow: rabbitmqctl -p oracle set_parameter federation
</I>&gt;<i>         local-nodename '&quot;Moscow&quot;'
</I>
So here you are setting the local-username to &quot;Cloud&quot;, but 
local-nodename to &quot;London&quot; / &quot;Moscow&quot;. Is that another simplification? 
Is that happening on the same machine?

&lt;snip&gt; the rest of the configuration looks reasonable.

&gt;<i> Now the problem comes when I set a federation upstream on the &quot;Local&quot;
</I>&gt;<i> servers (London and Moscow), I want to have a different
</I>&gt;<i> username/password on each. But it seems the &quot;Cloud&quot; upstream must always
</I>&gt;<i> have the same username/password? - Unless I am misunderstanding something?
</I>
I'm afraid it's still not tremendously clear what you are asking here. 
If you want &quot;London&quot; to connect to &quot;Cloud&quot; using one username and 
&quot;Moscow&quot; to connect to &quot;Cloud&quot; with another, then you can do that - just 
set the usernames / passwords in the URLs differently.

&gt;<i> Yes, I did all that, but I want to federate in both directions. If I do
</I>&gt;<i> the above, all messages I write to the Local servers (London, Moscow) I
</I>&gt;<i> can consume on the Cloud server, however if I write from the Cloud
</I>&gt;<i> server, I cannot consume the messages on the Local servers.
</I>&gt;<i>
</I>&gt;<i> To do that, I need to add federation upstreams on the local servers:
</I>&gt;<i>
</I>&gt;<i> rabbitmqctl set_parameter federation-upstream Cloud
</I>&gt;<i> '{&quot;uri&quot;:&quot;<A HREF="amqp://london:password@10.9.0.1/oracle">amqp://london:password@10.9.0.1/oracle</A>
</I>&gt;<i> &lt;<A HREF="http://london:password@10.9.0.1/oracle">http://london:password@10.9.0.1/oracle</A>&gt;&quot;}'
</I>&gt;<i> rabbitmqctl set_parameter federation-upstream Cloud
</I>&gt;<i> '{&quot;uri&quot;:&quot;<A HREF="amqp://moscow:password@10.9.0.1/oracle">amqp://moscow:password@10.9.0.1/oracle</A>
</I>&gt;<i> &lt;<A HREF="http://moscow:password@10.9.0.1/oracle">http://moscow:password@10.9.0.1/oracle</A>&gt;&quot;}'
</I>&gt;<i>
</I>&gt;<i> But I cannot do that because RabbitMQ only accepts a single
</I>&gt;<i> local-username :( - Am I missing something?
</I>
Ah - I think I understand what you are missing. Do you think 
local-username must correspond to the username set in another server's 
upstream URL? That's not the case.

The remote username(s) (i.e. the ones in the upstream URLs) need to be 
valid users in the upstream host. I think you have that right.

The local-username just needs to exist locally and be able to publish 
messages; it's used to republish messages that have been received from a 
remote host. *It does not need to correspond to anything else*.

The fact that you are seeing {error,user_does_not_exist} on a certain 
host means that you have set the local-username to the name of a user 
that does not exist on that host. Or that you have not set it, it;s 
defaulting to &quot;guest&quot;, and &quot;guest&quot; does not exist.

Does this make sense?

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>























































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027155.html">[rabbitmq-discuss] Multiple local-usernames for federation
</A></li>
	<LI>Next message: <A HREF="027165.html">[rabbitmq-discuss] Multiple local-usernames for federation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27156">[ date ]</a>
              <a href="thread.html#27156">[ thread ]</a>
              <a href="subject.html#27156">[ subject ]</a>
              <a href="author.html#27156">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
