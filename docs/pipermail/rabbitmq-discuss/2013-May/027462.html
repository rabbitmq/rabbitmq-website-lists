<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] One node in a cluster never fully starts up
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20One%20node%20in%20a%20cluster%20never%20fully%20starts%20up&In-Reply-To=%3C87zjvlmfte.wl%25francesco%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027446.html">
   <LINK REL="Next"  HREF="027452.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] One node in a cluster never fully starts up</H1>
    <B>Francesco Mazzoli</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20One%20node%20in%20a%20cluster%20never%20fully%20starts%20up&In-Reply-To=%3C87zjvlmfte.wl%25francesco%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] One node in a cluster never fully starts up">francesco at rabbitmq.com
       </A><BR>
    <I>Fri May 24 00:34:05 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027446.html">[rabbitmq-discuss] One node in a cluster never fully starts up
</A></li>
        <LI>Next message: <A HREF="027452.html">[rabbitmq-discuss] Auto-delete queues not compatible with basic.get	(vs. basic.consume)?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27462">[ date ]</a>
              <a href="thread.html#27462">[ thread ]</a>
              <a href="subject.html#27462">[ subject ]</a>
              <a href="author.html#27462">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matt!

I haven&#8217;t looked at RabbitMQ for a while, so my answers might be outdated and/or
wrong, but since I gave the original answers I&#8217;m going to give it a shot :).

&gt;<i> I know that sequentially is the ideal situation, but in the case of an
</I>&gt;<i> uncontrolled shutdown, it doesn't reliably start, as the first node may
</I>&gt;<i> time out waiting for a later node.
</I>&gt;<i> 
</I>&gt;<i> When this happens, starting the nodes in parallel gets past the problem.
</I>&gt;<i> However, my understanding is that this has its own risks. (See my original
</I>&gt;<i> first message in this thread.)
</I>&gt;<i> 
</I>&gt;<i> At the end of the day, we just need a set of scripts that will idempotently
</I>&gt;<i> start/stop the cluster reliably. It's infeasible to expect an operator
</I>&gt;<i> (i.e. not me) to assess the current cluster state and then guess which
</I>&gt;<i> approach to take.
</I>&gt;<i> 
</I>&gt;<i> Has the guidance changed between 2.8.4 and 3.1.1? I know it's basically a
</I>&gt;<i> mnesia issue - I just don't know what improvements have been made since
</I>&gt;<i> 2.8.4.
</I>
The improvements consist in the fact that the operations are safer now.  It goes
more or less like this: when the node starts up it asks the other nodes (&#8216;other
nodes&#8217; in this case being the ones in the config file) for the cluster they are
in, and then joins it if the other nodes are consistent in terms of Erlang and
RabbitMQ versions.

This opens up a race condition if the clusters start together: in the startup
sequence they all ask each other out for the cluster, but since they&#8217;re still
not fully started that they might all (or some) get inconclusive replies.  Thus
the cluster might not form fully.  There surely are other negative outcomes that
I am misremembering, but since RabbitMQ 3 it should be fairly hard (or at least
harder) to get catastrophic results (e.g. mnesia panics).  This is because in
the past RabbitMQ blindly clustered with the other nodes without really
bothering to check if it made sense to do so.

The situation is a tricky one to solve with an interface similar to the one that
we have now, and within the constraints of mnesia.  One can probably devise
ad-hoc solution if your assumptions are stronger than the ones we make in the
code, e.g. you might check after a bit if the nodes are really clustered and
take action if they are not.

Hopefully the above was helpful, you might want to wait for others for more
precise answers :).

Francesco
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027446.html">[rabbitmq-discuss] One node in a cluster never fully starts up
</A></li>
	<LI>Next message: <A HREF="027452.html">[rabbitmq-discuss] Auto-delete queues not compatible with basic.get	(vs. basic.consume)?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27462">[ date ]</a>
              <a href="thread.html#27462">[ thread ]</a>
              <a href="subject.html#27462">[ subject ]</a>
              <a href="author.html#27462">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
