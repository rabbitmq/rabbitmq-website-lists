<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] channel.basicCancel hangs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20channel.basicCancel%20hangs&In-Reply-To=%3C1f44b643-c45d-4e49-9a5f-8c23c4dc8b87%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027431.html">
   <LINK REL="Next"  HREF="027395.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] channel.basicCancel hangs</H1>
    <B>Kristian Lind</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20channel.basicCancel%20hangs&In-Reply-To=%3C1f44b643-c45d-4e49-9a5f-8c23c4dc8b87%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] channel.basicCancel hangs">klindp at gmail.com
       </A><BR>
    <I>Wed May 22 00:02:59 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027431.html">[rabbitmq-discuss] RDQ files filling the disk.
</A></li>
        <LI>Next message: <A HREF="027395.html">[rabbitmq-discuss] channel.basicCancel hangs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27394">[ date ]</a>
              <a href="thread.html#27394">[ thread ]</a>
              <a href="subject.html#27394">[ subject ]</a>
              <a href="author.html#27394">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&lt;dependency&gt;
&lt;groupId&gt;com.rabbitmq&lt;/groupId&gt;
&lt;artifactId&gt;amqp-client&lt;/artifactId&gt;
&lt;version&gt;3.0.4&lt;/version&gt;
&lt;/dependency&gt;

RabbitMQ 3.0.2, Erlang R16A

I have a webpage that has a start button and a stop button. 
These to buttons should start and stop the consuming messages.

When the user presses start button the consuming starts... when the user 
presses the stop button the consuming stops
BUT.. the user cannot start the consuming again. 
While debugging the code, I see the method call channel.basicCancel 
hangs... and the debugger stops... 
When I stop the JBoss server where the application is deployd I see this 
exception coming in the catch when doing channel.basicCancel.
com.rabbitmq.client.ShutdownSignalException: clean channel shutdown; 
reason: #method&lt;channel.close&gt;(reply-code=200, reply-text=OK, class-id=0, 
method-id=0)

And in the method handleDelivery I see ShutdownSignalException...
com.rabbitmq.client.AlreadyClosedException: clean connection shutdown; 
reason: Attempt to use closed channel

The call to basicCancel only hangs when consuming is going on.. if I start 
the consuming, but no messages are on the queue, I can stop it.. and start 
it again. 

@Override
protected final synchronized void service(final HttpServletRequest req, 
final HttpServletResponse resp) throws ServletException, IOException {
String task = req.getParameter(&quot;task&quot;);
        ...
if (StringUtils.isNotBlank(task) &amp;&amp; task.equals(&quot;stop&quot;)) {
consuming = false;
try {
channel.basicCancel(&quot;MonitorConsumer&quot;);
} catch (Exception e) {
e.printStackTrace();
}
}
} else {
if (connection == null || channel == null) {
createRabbitConnection();
}
if (!consuming) {
channel.basicConsume(Configuration.QUEUE_JSI_TO_DASHBOARD, false, 
&quot;MonitorConsumer&quot;, this);
consuming = true;
}
}
}

public synchronized void handleDelivery(String consumerTag, Envelope 
envelope, BasicProperties properties, byte[] body) throws IOException {
...
        try {
channel.basicAck(deliveryTag, false);
} catch (ShutdownSignalException e) {
e.printStackTrace();
}
}






-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/a311f354/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130521/a311f354/attachment.htm</A>&gt;
</PRE>

















































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027431.html">[rabbitmq-discuss] RDQ files filling the disk.
</A></li>
	<LI>Next message: <A HREF="027395.html">[rabbitmq-discuss] channel.basicCancel hangs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27394">[ date ]</a>
              <a href="thread.html#27394">[ thread ]</a>
              <a href="subject.html#27394">[ subject ]</a>
              <a href="author.html#27394">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
