<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] clustering   -- detached
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20clustering%20%20%20--%20detached&In-Reply-To=%3CC46BDAE3-0A7A-452E-9782-90B23A19E879%40rbcon.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026825.html">
   <LINK REL="Next"  HREF="026830.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] clustering   -- detached</H1>
    <B>Jerry Kuch</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20clustering%20%20%20--%20detached&In-Reply-To=%3CC46BDAE3-0A7A-452E-9782-90B23A19E879%40rbcon.com%3E"
       TITLE="[rabbitmq-discuss] clustering   -- detached">jerryk at rbcon.com
       </A><BR>
    <I>Wed May  1 21:37:27 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026825.html">[rabbitmq-discuss] clustering   -- detached
</A></li>
        <LI>Next message: <A HREF="026830.html">[rabbitmq-discuss] clustering -- detached
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26828">[ date ]</a>
              <a href="thread.html#26828">[ thread ]</a>
              <a href="subject.html#26828">[ subject ]</a>
              <a href="author.html#26828">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>IIRC that tutorial isn't suggesting you need to start rabbit that way on your clustered nodes. If you have bona fide, separate machines running brokers, start them the recommended way for that platform. Make sure Erlang cookies are properly common to the user accounts the brokers run under and that the same cookie is used by the invoker of rabbitmqctl when you issue the clustering commands. 

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


On May 1, 2013, at 1:31 PM, &quot;srd&quot; &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srd at duneram.com</A>&gt; wrote:

&gt;<i> Now that I have my 2 servers setup with rabbitmq I am now attempting to cluster them.  When I got to the first step in the <A HREF="http://www.rabbitmq.com/clustering.html,">http://www.rabbitmq.com/clustering.html,</A> it told me to start rabbitmq in the normal way:
</I>&gt;<i> rabbitmq-server -detached
</I>&gt;<i> 
</I>&gt;<i> From what I can see, this isn't how its normally started if I am running in single node mode, as it behaves differently.
</I>&gt;<i> 
</I>&gt;<i> In order to get the service approach to work correctly, I modified rabbitmq-server in /etc/init.d as follows:
</I>&gt;<i> [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at cluster1</A> init.d]# diff rabbitmq-server.20130501 rabbitmq-server
</I>&gt;<i> 63c63
</I>&gt;<i> &lt;         RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON \
</I>&gt;<i> ---
</I>&gt;&gt;<i>        RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON -detached \
</I>&gt;<i> [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at cluster1</A> init.d]#
</I>&gt;<i> 
</I>&gt;<i> I changed it there because DAEMON appears to be the rabbitmq-server
</I>&gt;<i> 
</I>&gt;<i> [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at cluster1</A> init.d]# grep DAEMON rabbitmq-server
</I>&gt;<i> DAEMON=/usr/sbin/${NAME}
</I>&gt;<i> test -x $DAEMON || exit 0
</I>&gt;<i>        RABBITMQ_PID_FILE=$PID_FILE $START_PROG $DAEMON -detached \
</I>&gt;<i> [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at cluster1</A> init.d]#
</I>&gt;<i> 
</I>&gt;<i> When I performed service rabbitmq-server start
</I>&gt;<i> 
</I>&gt;<i> It just hung and never came back with a prompt.
</I>&gt;<i> 
</I>&gt;<i> However in another window I confirmed the rabbitmq-server was running
</I>&gt;<i> 
</I>&gt;<i> I then killed the service console window and looked at the startup_err file:
</I>&gt;<i> [<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">root at cluster1</A> init.d]# more /var/log/rabbitmq/startup_err
</I>&gt;<i> Warning: PID file not written; -detached was passed.
</I>&gt;<i> 
</I>&gt;<i> and then i had to separately kill the process(s) associated with rabbitmq.
</I>&gt;<i> 
</I>&gt;<i> so my questions are thus:
</I>&gt;<i>   1) the documentation states this is how to normally start the server.  Is that normally for all modes or just for a clustered node approach?
</I>&gt;<i>   2) What can I do to keep the command from hanging if started as a service?  
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> -------Original Message-------
</I>&gt;&gt;<i> From: Gerald Kuch &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jkuch at gopivotal.com</A>&gt;
</I>&gt;&gt;<i> To: srd &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srd at duneram.com</A>&gt;, Discussions about RabbitMQ &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;<i> Subject: Re: [rabbitmq-discuss] another question on cookies version 3.0.4
</I>&gt;&gt;<i> Sent: 01 May '13 19:52
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Ooops, my fingers auto-completed the &quot;/etc/init.d&quot; on the end of the
</I>&gt;&gt;<i> sentence.  Forget about that part.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On Wed, May 1, 2013 at 12:51 PM, Gerald Kuch &lt;[LINK:
</I>&gt;&gt;<i> mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jkuch at gopivotal.com</A>] <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">jkuch at gopivotal.com</A>&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Depends how you started it:  Either /sbin/service/rabbitmq-server stop or
</I>&gt;&gt;<i> /etc/init.d/.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Of course 'kill' will stop it, but the cleanliness of doing the
</I>&gt;&gt;<i> former is preferable in non-emergency circumstances.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On Wed, May 1, 2013 at 6:26 AM, srd &lt;[LINK: mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srd at duneram.com</A>]
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srd at duneram.com</A>&gt; wrote:
</I>&gt;&gt;<i> Thank you for your help.  I will give this a try.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I've been starting it wrong all this time.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> what is the best way to stop the server?  up until now I have found no
</I>&gt;&gt;<i> good way to stop it except
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ps -efwww | grep rabbit
</I>&gt;&gt;<i> and then with that kill off the 4-6 associated jobs.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Dave
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  -------Original Message-------
</I>&gt;&gt;&gt;<i>  From: Tim Watson &lt;[LINK: mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>] <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>&gt;
</I>&gt;&gt;&gt;<i>  To: srd &lt;[LINK: mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srd at duneram.com</A>] <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">srd at duneram.com</A>&gt;, Discussions
</I>&gt;&gt;<i> about RabbitMQ &lt;[LINK: mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>]
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;&gt;&gt;<i>  Subject: Re: [rabbitmq-discuss] another question on cookies version
</I>&gt;&gt;<i> 3.0.4
</I>&gt;&gt;&gt;<i>  Sent: 01 May '13 13:21
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  Hi,
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  On 1 May 2013, at 14:15, srd wrote:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  &gt; so my questions are:
</I>&gt;&gt;&gt;<i>  &gt; 1) How does one normally start the server?
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  Depending on the platform, either /sbin/service rabbitmq-server start
</I>&gt;&gt;<i> or via /etc/init.d/.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  &gt; 2) my reason for wanting to do cookies is I wanted to setup a multi
</I>&gt;&gt;<i> node cluster (different servers)
</I>&gt;&gt;&gt;<i>  &gt;    If I start a server (no parameters) on each server the cookie
</I>&gt;&gt;<i> hash is different.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  You need to ensure that all the cookies are the same. You can do this
</I>&gt;&gt;<i> by placing the .erlang.cookie file in the /home/rabbitmq directory on each
</I>&gt;&gt;<i> server.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  &gt; 3) I have looked at the clustering guide but haven't succeeded
</I>&gt;&gt;<i> in a setup using it.  How does one normally synchronize the cookies
</I>&gt;&gt;<i> across servers?
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  That's up to you - rabbit doesn't provide anything out of the
</I>&gt;&gt;<i> box to do this.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  &gt; 4) where is the cookie file stored?   I found one on the rabbitmq
</I>&gt;&gt;<i> user's root directory.   Is that where it is stored?
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  That's correct.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  &gt; 5) If I have to set a cookie value, is there a config file where it
</I>&gt;&gt;<i> can be set (or env variable?) and what is the syntax to set it?
</I>&gt;&gt;&gt;<i>  &gt;
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  I would recommend just using the cookie stored in the rabbitmq
</I>&gt;&gt;<i> user's home directory.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i>  Cheers,
</I>&gt;&gt;&gt;<i>  Tim
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;<i> [LINK: mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>]
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;<i> [LINK:
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss]">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss]</A>
</I>&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I></PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026825.html">[rabbitmq-discuss] clustering   -- detached
</A></li>
	<LI>Next message: <A HREF="026830.html">[rabbitmq-discuss] clustering -- detached
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26828">[ date ]</a>
              <a href="thread.html#26828">[ thread ]</a>
              <a href="subject.html#26828">[ subject ]</a>
              <a href="author.html#26828">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
