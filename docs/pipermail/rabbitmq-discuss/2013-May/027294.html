<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Amazon EC2 spurious cluster timeouts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Amazon%20EC2%20spurious%20cluster%20timeouts&In-Reply-To=%3C7F7BFE76D0F5234F9258D88C37C9EC6B151C3302%40VALVCSMBX001PH.val.vlss.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027618.html">
   <LINK REL="Next"  HREF="027299.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Amazon EC2 spurious cluster timeouts</H1>
    <B>Maslinski, Ray</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Amazon%20EC2%20spurious%20cluster%20timeouts&In-Reply-To=%3C7F7BFE76D0F5234F9258D88C37C9EC6B151C3302%40VALVCSMBX001PH.val.vlss.local%3E"
       TITLE="[rabbitmq-discuss] Amazon EC2 spurious cluster timeouts">MaslinskiR at valassis.com
       </A><BR>
    <I>Fri May 17 21:03:36 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027618.html">[rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures when recovering from cluster partition
</A></li>
        <LI>Next message: <A HREF="027299.html">[rabbitmq-discuss] Amazon EC2 spurious cluster timeouts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27294">[ date ]</a>
              <a href="thread.html#27294">[ thread ]</a>
              <a href="subject.html#27294">[ subject ]</a>
              <a href="author.html#27294">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I've been working with several two node clusters running various versions of 3.0.x, hosted on m1.small instances on Ubuntu 12.04.2 LTS in EC2.  The setup is essentially as described here <A HREF="http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-amazon-ec2/">http://karlgrz.com/rabbitmq-highly-available-queues-and-clustering-using-amazon-ec2/</A> with the main exception being that both of the RabbitMQ servers are in the same availability zone.  A while back I observed a half dozen or so occurrences over the course of a week where the clusters would become partitioned, accompanied by a messages on each server such as:

=ERROR REPORT==== 17-May-2013::01:56:45 ===
** Node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at oemsg-new-29b15241</A>' not responding **
** Removing (timedout) connection **

=INFO REPORT==== 17-May-2013::01:56:45 ===
rabbit on node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at oemsg-new-29b15241</A>' down

Looking over the logs and EC2 metrics, I wasn't able to identify any other anomalies that coincided with these failures.  In particular, the load balancers in front of the cluster nodes did not report any health check failures connecting to the amqp port (on a 30 second interval), suggesting that network connectivity was otherwise healthy, and there didn't appear to be any unexpected spikes in resource consumption (such as excessive cpu/disk/network activity).  The rabbit servers were fairly lightly loaded with messaging traffic at the time, and running some load tests against the same servers afterwards didn't induce any further failures over the course of several days.  I tried increasing the net_ticktime to something like 5 or 10 minutes, but still observed a failure with the new value.

I left several clusters running over an extended period, most with little or no load, with one cluster running under an extended load test.  Several of the clusters experienced no failures over the course of a couple of months, while others became partitioned after a while (though they seemed to survive for at least a few weeks before partition).

Anyone experience anything similar in EC2, or have any ideas what else might be done to diagnose what's going on?

Ray Maslinski
Senior Software Developer, Engineering
Valassis / Digital Media
Cell: 585.330.2426
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">maslinskir at valassis.com</A>
www.valassis.com&lt;<A HREF="http://www.valassis.com/">http://www.valassis.com/</A>&gt;

Creating the future of intelligent media delivery to drive your greatest success

_____________________________________________________________________________

This message may include proprietary or protected information. If you are not the intended
recipient, please notify me, delete this message and do not further communicate the information
contained herein without my express consent.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/5e89b817/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/5e89b817/attachment.htm</A>&gt;
</PRE>



































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027618.html">[rabbitmq-discuss] RabbitMQ 3.1.0 lost messages and autoheal failures when recovering from cluster partition
</A></li>
	<LI>Next message: <A HREF="027299.html">[rabbitmq-discuss] Amazon EC2 spurious cluster timeouts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27294">[ date ]</a>
              <a href="thread.html#27294">[ thread ]</a>
              <a href="subject.html#27294">[ subject ]</a>
              <a href="author.html#27294">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
