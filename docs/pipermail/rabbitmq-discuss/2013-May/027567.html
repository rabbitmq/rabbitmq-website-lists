<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [openresty-en] Re: [openresty] New	lua-resty-rabbitmq library
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5Bopenresty-en%5D%20Re%3A%20%5Bopenresty%5D%20New%0A%09lua-resty-rabbitmq%20library&In-Reply-To=%3CCAMF%2B%2BH8g42G7SyeEHESeOg8iRFJdZpgoGC6x%2BOQjVVkbD4AiJw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027566.html">
   <LINK REL="Next"  HREF="027568.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [openresty-en] Re: [openresty] New	lua-resty-rabbitmq library</H1>
    <B>Rohit Yadav</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5Bopenresty-en%5D%20Re%3A%20%5Bopenresty%5D%20New%0A%09lua-resty-rabbitmq%20library&In-Reply-To=%3CCAMF%2B%2BH8g42G7SyeEHESeOg8iRFJdZpgoGC6x%2BOQjVVkbD4AiJw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] [openresty-en] Re: [openresty] New	lua-resty-rabbitmq library">rohit.yadav at wingify.com
       </A><BR>
    <I>Thu May 30 15:26:37 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027566.html">[rabbitmq-discuss] [openresty] New lua-resty-rabbitmq library
</A></li>
        <LI>Next message: <A HREF="027568.html">[rabbitmq-discuss] reconfigure existing queue with dead letter	exchange.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27567">[ date ]</a>
              <a href="thread.html#27567">[ thread ]</a>
              <a href="subject.html#27567">[ subject ]</a>
              <a href="author.html#27567">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, May 30, 2013 at 7:28 PM, smallfish &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">smallfish.xy at gmail.com</A>&gt; wrote:

&gt;<i> Great! but miss some other protocol (ack/publish etc..)
</I>&gt;<i>
</I>:<i>-)
</I>&gt;<i>
</I>
STOMP was simplest to write in Lua so I went ahead with it after members
from the community suggested for lua-resty.
In this library we do have publisher confirms by using STOMP RECEIPT which
are acks from the RabbitMQ stomp adapter for a given receipt no. which we
put on a SEND frame.
I see on the management web interface of RabbitMQ that channels are in
confirm mode.

A typical use case for this library is to publish on localhost RMQ broker
from resty/lua handler, in that case latency and network issues won't be
much trouble.

Regards.


&gt;<i> --
</I>&gt;<i> smallfish <A HREF="http://chenxiaoyu.org">http://chenxiaoyu.org</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, May 30, 2013 at 9:45 PM, Rohit Yadav &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rohit.yadav at wingify.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I started working on implementing a client library for RabbitMQ based on
</I>&gt;&gt;<i> STOMP 1.2 protocol, I'm sharing the initial buggy version [1] with the
</I>&gt;&gt;<i> community for feedback, suggestions and review.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> For the initial version I've implemented only authentication and
</I>&gt;&gt;<i> publishing using receipts. I'll blog about this work with some history and
</I>&gt;&gt;<i> background soon [2].
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To test this library I wrote a load testing tool in golang which would
</I>&gt;&gt;<i> run concurrent HTTP requests to an Openresty server. A handler runs Lua
</I>&gt;&gt;<i> code for that request and uses the resty-rabbitmq library to sanitize,
</I>&gt;&gt;<i> serialize and publish data to RabbitMQ's STOMP adapter.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> With a noncurrent load test of total 1M requests, using the library a
</I>&gt;&gt;<i> producer (in /example/) was able to publish all the messages to the broker
</I>&gt;&gt;<i> without any errors. But in case of concurrent connections, I frequently got
</I>&gt;&gt;<i> timeout errors or writing to closed socket errors.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> How may I make publishing fault tolerant and avoid deduplicating messages
</I>&gt;&gt;<i> in concurrent environment by correctly implementing states and reuse
</I>&gt;&gt;<i> sockets using cosocket api pool? I set keepalive timeout on the cosocket
</I>&gt;&gt;<i> tcp sock to 0 (no timeout as per wiki) and I saw exponential increase in
</I>&gt;&gt;<i> socket consumed via the RabbitMQ management web interface, for a load of
</I>&gt;&gt;<i> 100k requests, I saw fluctuations between 200-1200 consumed sockets with a
</I>&gt;&gt;<i> lot of socket errors.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ideas, flames? Thanks.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [1] <A HREF="https://github.com/wingify/lua-resty-rabbitmq">https://github.com/wingify/lua-resty-rabbitmq</A>
</I>&gt;&gt;<i> [2] <A HREF="http://engineering.wingify.com/">http://engineering.wingify.com/</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Regards,
</I>&gt;&gt;<i> Rohit Yadav
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> &#37038;&#20214;&#26469;&#33258;&#21015;&#34920;&#8220;openresty&#8221;,&#19987;&#29992;&#20110;&#25216;&#26415;&#35752;&#35770;!
</I>&gt;&gt;<i> &#35746;&#38405;: &#35831;&#21457;&#31354;&#30333;&#37038;&#20214;&#21040; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">openresty+subscribe at googlegroups.com</A>
</I>&gt;&gt;<i> &#21457;&#35328;: &#35831;&#21457;&#37038;&#20214;&#21040; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">openresty at googlegroups.com</A>
</I>&gt;&gt;<i> &#36864;&#35746;: &#35831;&#21457;&#37038;&#20214;&#33267; <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">openresty+unsubscribe at googlegroups.com</A>
</I>&gt;&gt;<i> &#24402;&#26723;: <A HREF="http://groups.google.com/group/openresty">http://groups.google.com/group/openresty</A>
</I>&gt;&gt;<i> &#23448;&#32593;: <A HREF="http://openresty.org/">http://openresty.org/</A>
</I>&gt;&gt;<i> &#20179;&#24211;: <A HREF="https://github.com/agentzh/ngx_openresty">https://github.com/agentzh/ngx_openresty</A>
</I>&gt;&gt;<i> &#25945;&#31243;: <A HREF="http://openresty.org/download/agentzh-nginx-tutorials-zhcn.html">http://openresty.org/download/agentzh-nginx-tutorials-zhcn.html</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  --
</I>&gt;<i> You received this message because you are subscribed to the Google Groups
</I>&gt;<i> &quot;openresty-en&quot; group.
</I>&gt;<i> To unsubscribe from this group and stop receiving emails from it, send an
</I>&gt;<i> email to <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">openresty-en+unsubscribe at googlegroups.com.</A>
</I>&gt;<i> For more options, visit <A HREF="https://groups.google.com/groups/opt_out.">https://groups.google.com/groups/opt_out.</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/45572ed2/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130530/45572ed2/attachment.htm</A>&gt;
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027566.html">[rabbitmq-discuss] [openresty] New lua-resty-rabbitmq library
</A></li>
	<LI>Next message: <A HREF="027568.html">[rabbitmq-discuss] reconfigure existing queue with dead letter	exchange.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27567">[ date ]</a>
              <a href="thread.html#27567">[ thread ]</a>
              <a href="subject.html#27567">[ subject ]</a>
              <a href="author.html#27567">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
