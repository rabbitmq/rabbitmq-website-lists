<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] 700k msgs using 6.3 GiB?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20700k%20msgs%20using%206.3%20GiB%3F&In-Reply-To=%3C00FF009B-EF5E-40A0-9169-6C2CE14E4BC5%40teksol.info%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027217.html">
   <LINK REL="Next"  HREF="027223.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] 700k msgs using 6.3 GiB?</H1>
    <B>Fran&#231;ois Beausoleil</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20700k%20msgs%20using%206.3%20GiB%3F&In-Reply-To=%3C00FF009B-EF5E-40A0-9169-6C2CE14E4BC5%40teksol.info%3E"
       TITLE="[rabbitmq-discuss] 700k msgs using 6.3 GiB?">francois at teksol.info
       </A><BR>
    <I>Thu May 16 05:01:24 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027217.html">[rabbitmq-discuss] 700k msgs using 6.3 GiB?
</A></li>
        <LI>Next message: <A HREF="027223.html">[rabbitmq-discuss] 700k msgs using 6.3 GiB?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27218">[ date ]</a>
              <a href="thread.html#27218">[ thread ]</a>
              <a href="subject.html#27218">[ subject ]</a>
              <a href="author.html#27218">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias,

Le 2013-05-15 &#224; 22:44, Matthias Radestock a &#233;crit :

&gt;<i> Fran&#231;ois,
</I>&gt;<i> 
</I>&gt;<i> On 16/05/13 01:52, Fran&#231;ois Beausoleil wrote:
</I>&gt;&gt;<i> Attached are a report and screenshot showing my RabbitMQ instance
</I>&gt;&gt;<i> using 6.3 GiB of RAM for a mere 700,000 3 KiB messages.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> What did I do wrong?
</I>&gt;<i> 
</I>&gt;<i> There are a number of empty queues with fairly high memory usage. Judging from the sequence numbers - several hundred million - and uptime (~3 weeks) they are probably moving at a reasonable pace under normal conditions, though obviously not much is moving at the time of the report since the producers were blocked.
</I>
Yup, I move millions of messages per day, per queue. My normal rate is 5000 messages/s publish and acknowledge. The application is a processing pipeline: tweets on one end, analytics on the other.

&gt;<i> Such active queues take up substantially more memory than idle queues. Much of that will be garbage that hasn't been collected yet. That garbage in turn may reference message payloads. That's how megs of queue memory can turn into gigs of binary memory since non-tiny message payloads are not counted towards queue memory but binary memory.
</I>
Why would the garbage not have been collected yet? Any ideas? I don't want to schedule weekly server reboots to clean out garbage.

&gt;<i> So I don't think there is anything unusual going on here. Having said that, it would really help our future investigation if you
</I>&gt;<i> 
</I>&gt;<i> 1) ran the most recent rabbit version (3.1.0)
</I>&gt;<i> 2) ran the most recent Erlang version (R16B)
</I>&gt;<i> 3) disabled non-essential plug-ins
</I>
I'm waiting for the dust to settle on RabbitMQ 3.1.0 - 3.1.1 really (let other brave souls use the latest and greatest). I use the packaged versions of Erlang on Ubuntu 12.04. I only enable the plugins I need, namely the consistent hash exchange and management console.

Bye,
Fran&#231;ois

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4142 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/b8941e7a/attachment.bin">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130516/b8941e7a/attachment.bin</A>&gt;
</PRE>






































































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027217.html">[rabbitmq-discuss] 700k msgs using 6.3 GiB?
</A></li>
	<LI>Next message: <A HREF="027223.html">[rabbitmq-discuss] 700k msgs using 6.3 GiB?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27218">[ date ]</a>
              <a href="thread.html#27218">[ thread ]</a>
              <a href="subject.html#27218">[ subject ]</a>
              <a href="author.html#27218">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
