<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Someone else with a nodedown error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Someone%20else%20with%20a%20nodedown%20error&In-Reply-To=%3CCACeek7HJG_XxC%2BWB%3Dwm%3DBUK5oD050JBwxPgU9yyZLJuFwRM8Jg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027285.html">
   <LINK REL="Next"  HREF="027292.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Someone else with a nodedown error</H1>
    <B>Eric Berg</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Someone%20else%20with%20a%20nodedown%20error&In-Reply-To=%3CCACeek7HJG_XxC%2BWB%3Dwm%3DBUK5oD050JBwxPgU9yyZLJuFwRM8Jg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Someone else with a nodedown error">eric.berg at pardot.com
       </A><BR>
    <I>Fri May 17 16:05:27 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027285.html">[rabbitmq-discuss] Someone else with a nodedown error
</A></li>
        <LI>Next message: <A HREF="027292.html">[rabbitmq-discuss] Someone else with a nodedown error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27288">[ date ]</a>
              <a href="thread.html#27288">[ thread ]</a>
              <a href="subject.html#27288">[ subject ]</a>
              <a href="author.html#27288">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Tim, I will send you a link to the log files privately. We do have
mirrored queues, we setup an HA policy to mirror all queues to exactly 2
nodes of the 4, as of yet we have not made use of any synchronization
policy.

We start all rabbit nodes via:

sudo /etc/init.d/rabbit-server start

We do have chef managing this server and has since caused a restart on 2 of
our 4 nodes, it is now temporarily disabled. I will send you the log files
for all 4 nodes dating back several days. One thing I did notice in the log
file for 3 of the 4 nodes:

=ERROR REPORT==== 16-May-2013::23:27:20 ===
connection &lt;0.25853.253&gt;, channel 1 - soft error:
{amqp_error,not_found,
            &quot;home node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at rabbit-box</A>' of durable queue 'my.queue.name'
in vhost '/' is down or inaccessible&quot;,
            'queue.declare'}


When looking at the log files you will notice many entries like:

=INFO REPORT==== 17-May-2013::09:15:42 ===
accepting AMQP connection &lt;0.5117.0&gt; (IP:55913 -&gt; IP:5672)

=WARNING REPORT==== 17-May-2013::09:15:42 ===
closing AMQP connection &lt;0.5117.0&gt; (IP:55913 -&gt; IP:5672):
connection_closed_abruptly

Those are our load balancers checking the node health, sorry for the log
spam.







On Fri, May 17, 2013 at 9:32 AM, Tim Watson &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tim at rabbitmq.com</A>&gt; wrote:

&gt;<i> Hmn
</I>&gt;<i>
</I>&gt;<i> On 17 May 2013, at 13:45, Eric Berg wrote:
</I>&gt;<i>
</I>&gt;<i> Thanks for your response Tim. If you would like SSH access to these boxes
</I>&gt;<i> let me know, we can work something out privately. Thanks!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Ok, though first of all I'd like to know if you supply logs for the nodes
</I>&gt;<i> in question? A private drop box would be fine.
</I>&gt;<i>
</I>&gt;<i> Update from yesterday:
</I>&gt;<i> It looks like 2 of the 4 nodes in our cluster have finally shut down, all
</I>&gt;<i> channels are now gone. Another node in the cluster hangs on
</I>&gt;<i> &gt; sudo rabbitmqctl status
</I>&gt;<i>
</I>&gt;<i> and the final node in the cluster appears to be running just fine. It
</I>&gt;<i> however sees the unresponsive node in the cluster status as a running node,
</I>&gt;<i> as does the web UI.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Right, so we've still got an unresponsive node. Do you have any mirrored
</I>&gt;<i> queues, and if so, what synchronisation and/or recovery policies are you
</I>&gt;<i> using?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *When you upgraded your cluster, what RabbitMQ version did you upgrade
</I>&gt;<i> from and to, and did you upgrade Erlang as well and if so, which versions
</I>&gt;<i> were involved?
</I>&gt;<i> *
</I>&gt;<i> - we upgraded from 3.0.4 to 3.1.0, we did not upgrade Erlang it was/is at
</I>&gt;<i> version R15B03. We did however install it via RPM with the --nodeps flag
</I>&gt;<i> because it did not detect the Erlang dependency correctly. We had
</I>&gt;<i> previously installed Erlang:
</I>&gt;<i>
</I>&gt;<i> esl-erlang.x86_64    R15B03-2           @erlang-solutions
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hmn, I suppose it's possible that this re-install went wrong somehow and
</I>&gt;<i> is causing some of the things below.
</I>&gt;<i>
</I>&gt;<i> *
</I>&gt;<i> What happens if you start up Erlang by itself, using `erl -sname test` -
</I>&gt;<i> do you still see all those screwy warnings? *
</I>&gt;<i> All 4 of the nodes can run this without issue as my user, when I sudo su
</I>&gt;<i> to rabbitmq user I get errors on 2 of the 4 nodes as such:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Well the nodes should always be running as the rabbitmq user, so how're
</I>&gt;<i> you starting them as your user? That might be at the root of some of these
</I>&gt;<i> problems, viz the rabbitmq-server (service) should always run as the
</I>&gt;<i> rabbitmq user and when issuing rabbitmqctl commands and the like, you would
</I>&gt;<i> normally do `$ sudo rabbitmqctl status` and so on. Log files would
</I>&gt;<i> definitely help though.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/f28c8485/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130517/f28c8485/attachment.htm</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027285.html">[rabbitmq-discuss] Someone else with a nodedown error
</A></li>
	<LI>Next message: <A HREF="027292.html">[rabbitmq-discuss] Someone else with a nodedown error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27288">[ date ]</a>
              <a href="thread.html#27288">[ thread ]</a>
              <a href="subject.html#27288">[ subject ]</a>
              <a href="author.html#27288">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
