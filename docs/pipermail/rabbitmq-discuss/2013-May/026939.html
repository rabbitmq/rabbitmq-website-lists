<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Bug/Behavior Change in binds to header exchanges in rabbitmq 3.1.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Bug/Behavior%20Change%20in%20binds%20to%20header%0A%20exchanges%20in%20rabbitmq%203.1.0&In-Reply-To=%3C5187E66D.6030102%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026907.html">
   <LINK REL="Next"  HREF="026959.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Bug/Behavior Change in binds to header exchanges in rabbitmq 3.1.0</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Bug/Behavior%20Change%20in%20binds%20to%20header%0A%20exchanges%20in%20rabbitmq%203.1.0&In-Reply-To=%3C5187E66D.6030102%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Bug/Behavior Change in binds to header exchanges in rabbitmq 3.1.0">matthias at rabbitmq.com
       </A><BR>
    <I>Mon May  6 18:20:45 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026907.html">[rabbitmq-discuss] Bug/Behavior Change in binds to header exchanges	in rabbitmq 3.1.0
</A></li>
        <LI>Next message: <A HREF="026959.html">[rabbitmq-discuss] Bug/Behavior Change in binds to header exchanges in rabbitmq 3.1.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26939">[ date ]</a>
              <a href="thread.html#26939">[ thread ]</a>
              <a href="subject.html#26939">[ subject ]</a>
              <a href="author.html#26939">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matt,

On 03/05/13 16:19, Matt Campbell wrote:
&gt;<i> In rabbit 3.0.4 and 2.8.7, I was able to bind a queue to a headers
</I>&gt;<i> exchange without specifying any bind arguments, which resulted in that
</I>&gt;<i> queue receiving all the messages. In rabbit 3.1.0, when I make that same
</I>&gt;<i> bind I get an error message telling me I must include the &quot;x-match&quot;
</I>&gt;<i> header. While this is an irritation for clients that use AMQP or the
</I>&gt;<i> HTTP API to create the binds (because they require a code change), I
</I>&gt;<i> have some clients that bind queues to this exchange via STOMP and I am
</I>&gt;<i> unaware of how to get that header set through a STOMP subscribe to that
</I>&gt;<i> exchange.
</I>&gt;<i>
</I>&gt;<i> Is this an intended behavior change going forward, or is this a bug in
</I>&gt;<i> rabbitmq 3.1.0?
</I>
We introduced validation of the x-match header in 3.1 - a change that 
unfortunately didn't get mentioned in the release notes.

As part of that, bindings with no x-match header are now rejected 
whereas previously they would be treated as 'all' matches.

The spec is vague in this regard; it neither says that x-match must be 
present nor what should happen when it isn't.

I have filed a bug to explore whether we should revert to the original 
behaviour, though given the spec vagueness it is probably best not to 
depend on that in applications.

As an alternative to changing the bindings in your code, you could 
introduce an intermediate fanout exchange, either

a) in front of the headers exchange, with publishers publishing to that 
instead of the headers exchange, or

b) behind the headers exchange, bound to it with x-match=all, so that 
selected queues can bind to that w/o having to set a header

Regards,

Matthias.
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026907.html">[rabbitmq-discuss] Bug/Behavior Change in binds to header exchanges	in rabbitmq 3.1.0
</A></li>
	<LI>Next message: <A HREF="026959.html">[rabbitmq-discuss] Bug/Behavior Change in binds to header exchanges in rabbitmq 3.1.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26939">[ date ]</a>
              <a href="thread.html#26939">[ thread ]</a>
              <a href="subject.html#26939">[ subject ]</a>
              <a href="author.html#26939">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
