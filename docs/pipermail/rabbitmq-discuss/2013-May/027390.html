<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] F5 Load Balancer Pool Management
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20F5%20Load%20Balancer%20Pool%20Management&In-Reply-To=%3C20130522054737.GG292%40kaka.it.su.se%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027383.html">
   <LINK REL="Next"  HREF="027398.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] F5 Load Balancer Pool Management</H1>
    <B>Simon Lundstr&#246;m</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20F5%20Load%20Balancer%20Pool%20Management&In-Reply-To=%3C20130522054737.GG292%40kaka.it.su.se%3E"
       TITLE="[rabbitmq-discuss] F5 Load Balancer Pool Management">simlu at su.se
       </A><BR>
    <I>Wed May 22 06:47:37 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027383.html">[rabbitmq-discuss] F5 Load Balancer Pool Management
</A></li>
        <LI>Next message: <A HREF="027398.html">[rabbitmq-discuss] F5 Load Balancer Pool Management
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27390">[ date ]</a>
              <a href="thread.html#27390">[ thread ]</a>
              <a href="subject.html#27390">[ subject ]</a>
              <a href="author.html#27390">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Morning Ron!

We're just in the middle of implementing RabbitMQ cluster by using our
F5 BIG-IP loadbalancers.

The idea is to have two healthchecks:

1, One very simple which connects to the node and sees that the &quot;path is
clear&quot;, i.e. that no firewall etc is blocking the connection to the
node. This is being done by sending eight random bytes to the AMQP port
(we're using SSL) and the server should respond with AMQP0091 (see,
&lt;<A HREF="https://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf">https://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf</A>&gt; section 4.2.2 Protocol
Header).

The problem with this is that it creates alot of log noise and I'm not
sure how to filter this out or how to generate a smart enough request
that RabbitMQ won't generate log noise.

2, The other health check is more complex and we want to check that a
node is really up and that it accepts messages. As BIG-IP doesn't
support AMQP OOTB we only found two other solutions:
* Write and compile a static C-binary which does the check and speaks
the AMQP protocol
* Put a Nagios NRPE check on the host which does the check and use the
BIG-IP to do a NRPE request to the node.

While the first solution seems ideal we don't want to complicate our
BIG-IP setup (i.e. put files on it) so we chose the latter.

I created a Perl-script &lt;<A HREF="https://github.com/simmel/create_nrpe_request">https://github.com/simmel/create_nrpe_request</A>&gt;
that can create the binary request that NRPE uses so it can be used in
the BIG-IP.

Healthcheck #2 is done but I'm still trying to make #1 smarter and not
create log noise.
Any ideas here from you or others?

Br,
- Simon

____________________________________

Simon Lundstr&#246;m
Section for Infrastructure

IT Services
Stockholm University
SE-106 91 Stockholm, Sweden

www.su.se/it

____________________________________
</PRE>

































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027383.html">[rabbitmq-discuss] F5 Load Balancer Pool Management
</A></li>
	<LI>Next message: <A HREF="027398.html">[rabbitmq-discuss] F5 Load Balancer Pool Management
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27390">[ date ]</a>
              <a href="thread.html#27390">[ thread ]</a>
              <a href="subject.html#27390">[ subject ]</a>
              <a href="author.html#27390">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
