<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Federation &amp; SSL
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Federation%20%26%20SSL&In-Reply-To=%3C519FE1BB.9030005%40cray.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027472.html">
   <LINK REL="Next"  HREF="027481.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Federation &amp; SSL</H1>
    <B>Eric Cozzi</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20Federation%20%26%20SSL&In-Reply-To=%3C519FE1BB.9030005%40cray.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ Federation &amp; SSL">n16483 at cray.com
       </A><BR>
    <I>Fri May 24 22:55:07 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027472.html">[rabbitmq-discuss] RabbitMQ Federation &amp; SSL
</A></li>
        <LI>Next message: <A HREF="027481.html">[rabbitmq-discuss] RabbitMQ Federation &amp; SSL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27477">[ date ]</a>
              <a href="thread.html#27477">[ thread ]</a>
              <a href="subject.html#27477">[ subject ]</a>
              <a href="author.html#27477">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Simon,

Again, thank you for your continued help. I have made progress, but I'm 
hitting another problem.

I'm trying to establish federation between two brokers (one happens to 
be clustered, but the second cluster node is currently down) using 
passwordless-SSH using a LDAP authentication backend. If I disable 
external auth, I can get the federation clients to connect. Once I 
enable external auth, I get the following error. Any ideas?

=ERROR REPORT==== 24-May-2013::16:34:44 ===
** Generic server &lt;0.2696.0&gt; terminating
** Last message in was {'$gen_cast',maybe_go}
** When Server state == {not_started,
                          {{upstream,
                            {amqp_params_network,&lt;&lt;&quot;guest&quot;&gt;&gt;,&lt;&lt;&quot;guest&quot;&gt;&gt;,
&lt;&lt;&quot;/&quot;&gt;&gt;,&quot;ecozzi-02&quot;,undefined,0,0,0,infinity,
                             [{fail_if_no_peer_cert,true},
                              {verify,verify_peer},
                              {keyfile,&quot;/opt/cray/ssl/client-01/key.pem&quot;},
                              {certfile,&quot;/opt/cray/ssl/client-01/cert.pem&quot;},
                              
{cacertfile,&quot;/opt/cray/ssl/testca/cacert.pem&quot;}],
                             [#Fun&lt;amqp_uri.7.123484526&gt;,
                              #Fun&lt;amqp_uri.7.123484526&gt;],
                             [],[]},
&lt;&lt;&quot;<A HREF="amqps://ecozzi-02?cacertfile=/opt/cray/ssl/testca/cacert.pem&amp;certfile=/opt/cray/ssl/client-01/cert.pem&amp;keyfile=/opt/cray/ssl/client-01/key.pem&amp;verify=verify_peer&amp;fail_if_no_peer_cert=true&quot;">amqps://ecozzi-02?cacertfile=/opt/cray/ssl/testca/cacert.pem&amp;certfile=/opt/cray/ssl/client-01/cert.pem&amp;keyfile=/opt/cray/ssl/client-01/key.pem&amp;verify=verify_peer&amp;fail_if_no_peer_cert=true&quot;</A>&gt;&gt;,
                            {exchange,
                             {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;cray.topic&quot;&gt;&gt;},
                             topic,true,false,false,[],
                             [{federation,
                               
[{{&lt;&lt;&quot;ecozzi-02&quot;&gt;&gt;,&lt;&lt;&quot;cray.topic&quot;&gt;&gt;},&lt;&lt;&quot;A&quot;&gt;&gt;}]}],
                             [{vhost,&lt;&lt;&quot;/&quot;&gt;&gt;},
                              {name,&lt;&lt;&quot;federate-me&quot;&gt;&gt;},
                              {pattern,&lt;&lt;&quot;^cray.&quot;&gt;&gt;},
                              {definition,
                               [{&lt;&lt;&quot;federation-upstream-set&quot;&gt;&gt;,&lt;&lt;&quot;all&quot;&gt;&gt;}]},
                              {priority,0}]},
                            1000,1,1,none,none,true,none,&lt;&lt;&quot;ecozzi-02&quot;&gt;&gt;},
                           {resource,&lt;&lt;&quot;/&quot;&gt;&gt;,exchange,&lt;&lt;&quot;cray.topic&quot;&gt;&gt;}}}
** Reason for termination ==
** {{{case_clause,
          {badrpc,
              {'EXIT',
                  {{badarg,{error,noSuchObject}},
                   
[{rabbit_access_control,'-check_vhost_access/2-fun-0-',3,[]},
                    {rabbit_access_control,check_access,5,[]},
                    {rabbit_direct,connect,5,[]},
                    {rpc,local_call,3,[{file,&quot;rpc.erl&quot;},{line,327}]},
                    {amqp_direct_connection,connect,4,[]},
                    {amqp_gen_connection,handle_call,3,[]},
                    {gen_server,handle_msg,5,
                        [{file,&quot;gen_server.erl&quot;},{line,588}]},
                    {proc_lib,init_p_do_apply,3,
                        [{file,&quot;proc_lib.erl&quot;},{line,227}]}]}}}},
      [{amqp_direct_connection,connect,4,[]},
       {amqp_gen_connection,handle_call,3,[]},
       {gen_server,handle_msg,5,[{file,&quot;gen_server.erl&quot;},{line,588}]},
       {proc_lib,init_p_do_apply,3,[{file,&quot;proc_lib.erl&quot;},{line,227}]}]},
     {gen_server,call,[&lt;0.2699.0&gt;,connect,infinity]}}

Eric

On 05/24/2013 08:51 AM, Eric Cozzi wrote:
&gt;<i> A-ha! That's exactly what I was missing. Thanks!
</I>&gt;<i>
</I>&gt;<i> Eric
</I>&gt;<i>
</I>&gt;<i> On 05/24/2013 05:02 AM, Simon MacMullen wrote:
</I>&gt;&gt;<i> Hi. Are you setting the various SSL options in the URIs? See 
</I>&gt;&gt;<i> <A HREF="http://www.rabbitmq.com/shovel.html#uris">http://www.rabbitmq.com/shovel.html#uris</A> for the URI format. 
</I>&gt;&gt;<i> Federation uses the AMQP client, which doesn't get its SSL options 
</I>&gt;&gt;<i> from the configuration file.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cheers, Simon
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 23/05/13 21:28, Eric Cozzi wrote:
</I>&gt;&gt;&gt;<i> I am having an issue configuring Federation and passwordless-ssl login.
</I>&gt;&gt;&gt;<i> Federation is using https. Seems if I enable the ssl config option
</I>&gt;&gt;&gt;<i> {fail_if_no_peer_cert,true}, peer brokers get a SSL connection error
</I>&gt;&gt;&gt;<i> when trying to establish the Federation. Even though I'm setting my SSL
</I>&gt;&gt;&gt;<i> keys and certs in the rabbitmq config, I'm guessing that Federation
</I>&gt;&gt;&gt;<i> isn't using the configured certs? Is there a way to configure the 
</I>&gt;&gt;&gt;<i> client
</I>&gt;&gt;&gt;<i> and CA cert's to use with Federation?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Eric
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Below is my (simplified) configuration.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> [
</I>&gt;&gt;&gt;<i>    {rabbit,
</I>&gt;&gt;&gt;<i>      [
</I>&gt;&gt;&gt;<i>        {hipe_compile, true},
</I>&gt;&gt;&gt;<i>        {tcp_listen_options,
</I>&gt;&gt;&gt;<i>          [binary,
</I>&gt;&gt;&gt;<i>            {packet,raw},
</I>&gt;&gt;&gt;<i>            {reuseaddr,true},
</I>&gt;&gt;&gt;<i>            {backlog,128},
</I>&gt;&gt;&gt;<i>            {nodelay,true},
</I>&gt;&gt;&gt;<i>            {exit_on_close,false}
</I>&gt;&gt;&gt;<i>          ]
</I>&gt;&gt;&gt;<i>        },
</I>&gt;&gt;&gt;<i>        {ssl_listeners, [5671]},
</I>&gt;&gt;&gt;<i>        {ssl_options, [{cacertfile,&quot;/opt/cray/ssl/testca/cacert.pem&quot;},
</I>&gt;&gt;&gt;<i>                       {certfile,&quot;/opt/cray/ssl/server-01/cert.pem&quot;},
</I>&gt;&gt;&gt;<i>                       {keyfile,&quot;/opt/cray/ssl/server-01/key.pem&quot;},
</I>&gt;&gt;&gt;<i>                       {verify,verify_peer},
</I>&gt;&gt;&gt;<i>                       {fail_if_no_peer_cert,false}
</I>&gt;&gt;&gt;<i>                      ]
</I>&gt;&gt;&gt;<i>        }
</I>&gt;&gt;&gt;<i>      ]
</I>&gt;&gt;&gt;<i>    }
</I>&gt;&gt;&gt;<i> ].
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> rabbitmq-discuss mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I></PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027472.html">[rabbitmq-discuss] RabbitMQ Federation &amp; SSL
</A></li>
	<LI>Next message: <A HREF="027481.html">[rabbitmq-discuss] RabbitMQ Federation &amp; SSL
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27477">[ date ]</a>
              <a href="thread.html#27477">[ thread ]</a>
              <a href="subject.html#27477">[ subject ]</a>
              <a href="author.html#27477">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
