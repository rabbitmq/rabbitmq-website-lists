<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] F5 Load Balancer Pool Management
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20F5%20Load%20Balancer%20Pool%20Management&In-Reply-To=%3C0B8CD6850421B745BE39BC5C7601923271F6A883%40DDCEP50015.na.corp.mckesson.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027398.html">
   <LINK REL="Next"  HREF="027442.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] F5 Load Balancer Pool Management</H1>
    <B>Cordell, Ron L</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20F5%20Load%20Balancer%20Pool%20Management&In-Reply-To=%3C0B8CD6850421B745BE39BC5C7601923271F6A883%40DDCEP50015.na.corp.mckesson.com%3E"
       TITLE="[rabbitmq-discuss] F5 Load Balancer Pool Management">Ron.Cordell at RelayHealth.com
       </A><BR>
    <I>Wed May 22 19:25:59 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027398.html">[rabbitmq-discuss] F5 Load Balancer Pool Management
</A></li>
        <LI>Next message: <A HREF="027442.html">[rabbitmq-discuss] F5 Load Balancer Pool Management
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27425">[ date ]</a>
              <a href="thread.html#27425">[ thread ]</a>
              <a href="subject.html#27425">[ subject ]</a>
              <a href="author.html#27425">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks, Simon - that's very helpful.

-----Original Message-----
From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Simon Lundstr&#246;m
Sent: Tuesday, May 21, 2013 10:48 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] F5 Load Balancer Pool Management

Morning Ron!

We're just in the middle of implementing RabbitMQ cluster by using our
F5 BIG-IP loadbalancers.

The idea is to have two healthchecks:

1, One very simple which connects to the node and sees that the &quot;path is clear&quot;, i.e. that no firewall etc is blocking the connection to the node. This is being done by sending eight random bytes to the AMQP port (we're using SSL) and the server should respond with AMQP0091 (see, &lt;<A HREF="https://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf">https://www.rabbitmq.com/resources/specs/amqp0-9-1.pdf</A>&gt; section 4.2.2 Protocol Header).

The problem with this is that it creates alot of log noise and I'm not sure how to filter this out or how to generate a smart enough request that RabbitMQ won't generate log noise.

2, The other health check is more complex and we want to check that a node is really up and that it accepts messages. As BIG-IP doesn't support AMQP OOTB we only found two other solutions:
* Write and compile a static C-binary which does the check and speaks the AMQP protocol
* Put a Nagios NRPE check on the host which does the check and use the BIG-IP to do a NRPE request to the node.

While the first solution seems ideal we don't want to complicate our BIG-IP setup (i.e. put files on it) so we chose the latter.

I created a Perl-script &lt;<A HREF="https://github.com/simmel/create_nrpe_request">https://github.com/simmel/create_nrpe_request</A>&gt;
that can create the binary request that NRPE uses so it can be used in the BIG-IP.

Healthcheck #2 is done but I'm still trying to make #1 smarter and not create log noise.
Any ideas here from you or others?

Br,
- Simon

____________________________________

Simon Lundstr&#246;m
Section for Infrastructure

IT Services
Stockholm University
SE-106 91 Stockholm, Sweden

www.su.se/it

____________________________________
_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027398.html">[rabbitmq-discuss] F5 Load Balancer Pool Management
</A></li>
	<LI>Next message: <A HREF="027442.html">[rabbitmq-discuss] F5 Load Balancer Pool Management
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27425">[ date ]</a>
              <a href="thread.html#27425">[ thread ]</a>
              <a href="subject.html#27425">[ subject ]</a>
              <a href="author.html#27425">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
