<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] After server notifies of canceled consume,	it doesn't acknowledge a channel close
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20After%20server%20notifies%20of%20canceled%20consume%2C%0A%09it%20doesn%27t%20acknowledge%20a%20channel%20close&In-Reply-To=%3C2318FD7E-EEDC-44F4-8842-464B51038B7B%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026788.html">
   <LINK REL="Next"  HREF="026800.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] After server notifies of canceled consume,	it doesn't acknowledge a channel close</H1>
    <B>Steve Powell</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20After%20server%20notifies%20of%20canceled%20consume%2C%0A%09it%20doesn%27t%20acknowledge%20a%20channel%20close&In-Reply-To=%3C2318FD7E-EEDC-44F4-8842-464B51038B7B%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] After server notifies of canceled consume,	it doesn't acknowledge a channel close">steve at rabbitmq.com
       </A><BR>
    <I>Wed May  1 10:07:32 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="026788.html">[rabbitmq-discuss] After server notifies of canceled consume, it doesn't acknowledge a channel close
</A></li>
        <LI>Next message: <A HREF="026800.html">[rabbitmq-discuss] After server notifies of canceled consume, it doesn't acknowledge a channel close
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26792">[ date ]</a>
              <a href="thread.html#26792">[ thread ]</a>
              <a href="subject.html#26792">[ subject ]</a>
              <a href="author.html#26792">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Chip,
If you are using the Java client, then it is possible that you are issuing the channel.close() from within the Consumer (in the code for the handleCancel() method).

In this case, the Consumer callback is being executed on a worker thread, and although you can issue channel commands from here, close() is a bit special, because it may involve waiting for callbacks to finish. This would explain why you hang in the client. (The server is probably sending the close-ok, but you aren't seeing it -- the client has hung already.)

We should document this properly in the Java client specs, but in the meantime, you should issue the close in the main app, rather than in the Consumer.

Does this explain your observed behaviour?

BTW: This is all speculation, and if I am off the mark, I apologise.  In reporting problems a little more context is helpful: which client you are using, more about how you are using it, and some diagnostic information [in this case, the stack frames during the hang, and/or a trace of the frames to/from Rabbit would have been perfect] can speed a satisfactory response.

Steve Powell  [Cell: +44-7815-838-558]
Links: Pivotal, SpringSource, VMware, Virgo, RabbitMQ.
-----------------------------------------------------------------------
Good design:
   is innovative, useful, aesthetic;
   is understandable, unobtrusive, honest;
   is long-lasting, thorough, environmentally friendly;
   and is as little design as possible.
Copyright Dieter Rams, amended March 2003; October 2009; and August 2012

On 1 May 2013, at 05:16, Chip Salzenberg &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rev.chip at gmail.com</A>&gt; wrote:

&gt;<i> I've successfully used the optional server feature of sending a basic.cancel when a consumed queue is deleted.  Great.  But a reasonable thing to do at that point is to close the channel, right?  But when I send a channel.close in that circumstance, RMQ 3.0.4 does not send a close-ok.  It doesn't send anything.  This makes my app hang.  I have to cheat and ass_u_me that the channel is closed in order to keep working.
</I>&gt;<i> 
</I>&gt;<i> Am I doing something wrong?  Is this a server bug?  Both?  :)
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/0e045b39/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130501/0e045b39/attachment.htm</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026788.html">[rabbitmq-discuss] After server notifies of canceled consume, it doesn't acknowledge a channel close
</A></li>
	<LI>Next message: <A HREF="026800.html">[rabbitmq-discuss] After server notifies of canceled consume, it doesn't acknowledge a channel close
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26792">[ date ]</a>
              <a href="thread.html#26792">[ thread ]</a>
              <a href="subject.html#26792">[ subject ]</a>
              <a href="author.html#26792">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
