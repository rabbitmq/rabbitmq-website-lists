<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Memory grows very fast
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Memory%20grows%20very%20fast&In-Reply-To=%3C519E66EC.8020003%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="027441.html">
   <LINK REL="Next"  HREF="027136.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Memory grows very fast</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Memory%20grows%20very%20fast&In-Reply-To=%3C519E66EC.8020003%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Memory grows very fast">matthias at rabbitmq.com
       </A><BR>
    <I>Thu May 23 19:58:52 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="027441.html">[rabbitmq-discuss] Memory grows very fast
</A></li>
        <LI>Next message: <A HREF="027136.html">[rabbitmq-discuss] Memory grows very fast
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27451">[ date ]</a>
              <a href="thread.html#27451">[ thread ]</a>
              <a href="subject.html#27451">[ subject ]</a>
              <a href="author.html#27451">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Artur,

On 23/05/13 15:44, rabbit15 wrote:
&gt;<i> I see that on faster machine which has 32 CPU(Intel(R) Xeon(R) CPU E5-2670 0
</I>&gt;<i> @ 2.60GHz) and 64GB RAM there can be store more messages about 10 milions.
</I>&gt;<i> Previous machine was with 24 CPU (Intel(R) Xeon(R) CPU           X5675  @
</I>&gt;<i> 3.07GHz) and 92 GB RAM and there could 600k -2500k stored messages.
</I>
That's probably just due to the changes in timing.

You are clearly putting rabbit under extreme load. In the status report 
you just posted, the system had been running for just ~12 minutes, yet 
there were 800+ open connections, taking up 1.3GB of memory between 
them. Now, connections only hold data very briefly, so this is a clear 
indication that the rabbit is heavily loaded. Furthermore, in an earlier 
report you posted, the run_queue sat at 148 - that's 148 Erlang 
processes waiting for a CPU to become free to do some work.

With such a usage, memory consumption will always be high.

&gt;<i> Maybe there is some option for GC ?
</I>
There are plenty of Erlang gc options to tweak. Usually that makes 
matters worse, but if you really want to go down that route then, for 
starters, try setting the ERL_FULLSWEEP_AFTER environment variable to 0 
or some other low value (the default is 65535) in 
/etc/rabbitmq/rabbitmq-env.conf, i.e.

export ERL_FULLSWEEP_AFTER 0

and restart rabbit.

You can confirm the setting took effect by running

$ rabbitmqctl eval 'erlang:system_info(fullsweep_after).'
{fullsweep_after,0}
...done.
$

Regards,

Matthias.
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="027441.html">[rabbitmq-discuss] Memory grows very fast
</A></li>
	<LI>Next message: <A HREF="027136.html">[rabbitmq-discuss] Memory grows very fast
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27451">[ date ]</a>
              <a href="thread.html#27451">[ thread ]</a>
              <a href="subject.html#27451">[ subject ]</a>
              <a href="author.html#27451">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
