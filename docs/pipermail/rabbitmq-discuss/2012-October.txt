From Petr.Gotthard at Honeywell.com  Mon Oct  1 09:47:50 2012
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Mon, 1 Oct 2012 08:47:50 +0000
Subject: [rabbitmq-discuss] Channel Name displayed in the Visualiser
Message-ID: <F9E85480F62349458DF67CE8BA000D8D17F49347@FR44EX3005.global.ds.honeywell.com>

Hello,
The rabbitmq_management_visualiser shows a list of channels. Usually the text (Channel Name) displayed is something like "10.10.10.51:48482 -> 192.168.0.21:5672 (3)".
Is there a way how to e.g. display a (reverse DNS) hostname instead of IP address, or otherwise make the displayed Channel Name more user/audience friendly? On one machine and for some channels only we see a Node Name displayed instead.

Thanks,
Petr


From tim at rabbitmq.com  Mon Oct  1 11:04:47 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 01 Oct 2012 11:04:47 +0100
Subject: [rabbitmq-discuss] Errors starting RabbitMQ when cluster
 membership changes
In-Reply-To: <CACLE7iznHVn6b1Q9f=EGks64y2Hy4p17k8PMtT4JS6n_ORnc5A@mail.gmail.com>
References: <CACLE7iznHVn6b1Q9f=EGks64y2Hy4p17k8PMtT4JS6n_ORnc5A@mail.gmail.com>
Message-ID: <50696ABF.1030900@rabbitmq.com>

Hi Matt,

On 09/28/2012 08:23 PM, Matt Pietrek wrote:
> For example, at one point I had a three node cluster: play, play2, and 
> util. I then removed util from the cluster, although to be honest, 
> simply by changing the rabbitmq.config file, rather than explicitly 
> running rabbitmqctl stop_app while the cluster is still running.
>

I'm pretty sure you're not supposed to do that! :)

> My steps:
>
>   * Running as three node cluster, stop all brokers
>   * Create a new rabbitmq.config file with just two brokers
>   * Attempt to start the new cluster.
>

If you don't take util offline using the right procedure, I suspect 
mnesia will get out of sorts and this isn't something you want to 
happen. It's important to make cluster changes using the right 
procedure, as mnesia is rather a fussy beast.

BTW we've made some improvements that (hopefully) simplify working with 
clusters and these will be in the forthcoming feature release!

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121001/ec1958e5/attachment.htm>

From emile at rabbitmq.com  Mon Oct  1 12:43:16 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 01 Oct 2012 12:43:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ STOMP Adapter - How to get the RPC
 reply messages?
In-Reply-To: <CABsGVpaeSOq=DJOaB_Rmf_XJXbM_fbW3wA62gtbhPj-eqjrn_w@mail.gmail.com>
References: <cd91aecb-ce3c-4355-b02a-119fdf7c579f@googlegroups.com>
	<5062D42E.6030608@rabbitmq.com>
	<CABsGVpaeSOq=DJOaB_Rmf_XJXbM_fbW3wA62gtbhPj-eqjrn_w@mail.gmail.com>
Message-ID: <506981D4.60908@rabbitmq.com>

Hi,

On 27/09/12 11:55, Tiago Alves wrote:
> Thus, we're now removing the "/reply-queue/" part of the replyTo header,

>> a message to "/reply-queue/amq.gen-w2jykNGp4DNDBADm3C4Cdx".
> 
> Correct, assuming your server-side uses STOMP.


It turns out that the implementation of temp queue destinations made the
assumption that the message sender and recipient would both be STOMP
clients. If the message recipient is not a STOMP client then the
extraneous "/reply-queue/" prefix need to be removed.

I have filed a bug to remove the assumption that both ends need to be
STOMP clients and the need for non-STOMP clients to strip the prefix.
Thanks for bringing this to our attention.


-Emile


From simlu at su.se  Mon Oct  1 13:03:16 2012
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Mon, 1 Oct 2012 14:03:16 +0200
Subject: [rabbitmq-discuss] BUG: Failing nodes with HA-queue stops message
	flow
Message-ID: <20121001120316.GJ560@kaka.it.su.se>

Hello!

As per requested by Emile on IRC:

We get stale messages in the queue when the node that is "master" in a
HA-queue gets restarted, details below:

We are running two nodes, ram01 and disk01, on 2.8.7.
ram01 is a ram node and, surprise surprise, disk01 is a disc node.

We are using the amqp gem on Ruby for producer and consumer
(sourcecode available on demand).

The producer connects to ram01 and creates a fanout exchange which is
durable.  It then publishes X # of messages on the exchange.

The consumer connects to disk01 connects to disk01 and sets up an error
handler to reconnect if it gets an 320 error.
The consumer creates a durable queue which has x-ha-policy = all. It
when binds to the exchange.

The queue has disk01 as a node and ram01 as a mirror.

Reproduceable steps:
# Restart disk01 (via `rabbitmqctl stop` and start it up again).
# The consumer reconnects because it noticed the 320.
consumer log:
[connection.close] Reply code = 320, reply text = CONNECTION_FORCED - broker forced connection closure with reason 'shutdown'
[connection.close] Setting up a periodic reconnection timer...
# In the queue, ram01 is now node and disk01 is a mirror.
# Restart ram01 (via the same procedure as disk01)
# In the management web GUI under the queue (simlu.queue) the consumer is not listed as connected to the queue.
However, if I go to "Connections" I can see that the consumer is connected to disk01. According to the log the consumer is also connected.
# Publish message via the producer
# We now have 1 message "Ready" in the queue.
The consumer does not get any message.
# If we either:
* Restart disk01 or
* Restart consumer
the message gets delivered.
In this case, we restarted disk01.
# Message is delivered.
On ram01 we get this message in the log:
=ERROR REPORT==== 1-Oct-2012::13:55:35 ===
Discarding message {'$gen_call',{<0.173.0>,#Ref<0.0.0.967>},{notify_down,<6733.320.0>}} from <0.173.0> to <0.200.0> in an old incarnation (1) of this node (2)

Log output from disk01 and ram01 is attached.

Thanks!
- Simon

---

Simon Lundstr?m
IT Services
Stockholm University
-------------- next part --------------

=INFO REPORT==== 1-Oct-2012::13:50:10 ===
Mirrored-queue (queue 'simlu.queue' in vhost '/'): Slave <'rabbit at rabbitmq-test-ram01.it.su.se'.1.200.0> saw deaths of mirrors <'rabbit at rabbitmq-test-disk01.it.su.se'.2.250.0> 

=INFO REPORT==== 1-Oct-2012::13:50:10 ===
Mirrored-queue (queue 'simlu.queue' in vhost '/'): Promoting slave <'rabbit at rabbitmq-test-ram01.it.su.se'.1.200.0> to master

=INFO REPORT==== 1-Oct-2012::13:50:10 ===
rabbit on node 'rabbit at rabbitmq-test-disk01.it.su.se' down

=INFO REPORT==== 1-Oct-2012::13:50:10 ===
only running disc node went down

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
rabbit on node 'rabbit at rabbitmq-test-disk01.it.su.se' up

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
cluster contains disc nodes again

=INFO REPORT==== 1-Oct-2012::13:50:42 ===
Stopping Rabbit

=INFO REPORT==== 1-Oct-2012::13:50:42 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:50:42 ===
stopped SSL Listener on [::]:5671

=INFO REPORT==== 1-Oct-2012::13:50:42 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:50:42 ===
    application: os_mon
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:50:42 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:50:42 ===
Halting Erlang VM

=INFO REPORT==== 1-Oct-2012::13:50:44 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 1-Oct-2012::13:50:45 ===
Memory limit set to 805MB of 2013MB total.

=INFO REPORT==== 1-Oct-2012::13:50:45 ===
Disk free limit set to 1000MB

=INFO REPORT==== 1-Oct-2012::13:50:45 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 1-Oct-2012::13:50:45 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 1-Oct-2012::13:50:45 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 1-Oct-2012::13:50:45 ===
msg_store_persistent: recovery terms differ from present
rebuilding indices from scratch

=INFO REPORT==== 1-Oct-2012::13:50:45 ===
Adding mirror of queue 'simlu.queue' in vhost '/' on node 'rabbit at rabbitmq-test-ram01.it.su.se': <0.200.0>

=INFO REPORT==== 1-Oct-2012::13:50:45 ===
started SSL Listener on [::]:5671

=INFO REPORT==== 1-Oct-2012::13:50:45 ===
rabbit on node 'rabbit at rabbitmq-test-disk01.it.su.se' up

=INFO REPORT==== 1-Oct-2012::13:50:45 ===
cluster contains disc nodes again

=INFO REPORT==== 1-Oct-2012::13:50:45 ===
Management agent started.

=INFO REPORT==== 1-Oct-2012::13:53:35 ===
accepting AMQP connection <0.253.0> (130.237.95.133:55630 -> 77.238.35.70:5671)

=INFO REPORT==== 1-Oct-2012::13:53:36 ===
closing AMQP connection <0.253.0> (130.237.95.133:55630 -> 77.238.35.70:5671)

=ERROR REPORT==== 1-Oct-2012::13:55:35 ===
Discarding message {'$gen_call',{<0.173.0>,#Ref<0.0.0.967>},{notify_down,<6733.320.0>}} from <0.173.0> to <0.200.0> in an old incarnation (1) of this node (2)


=INFO REPORT==== 1-Oct-2012::13:55:35 ===
Mirrored-queue (queue 'simlu.queue' in vhost '/'): Slave <'rabbit at rabbitmq-test-ram01.it.su.se'.2.200.0> saw deaths of mirrors <'rabbit at rabbitmq-test-disk01.it.su.se'.3.250.0> 

=INFO REPORT==== 1-Oct-2012::13:55:35 ===
Mirrored-queue (queue 'simlu.queue' in vhost '/'): Promoting slave <'rabbit at rabbitmq-test-ram01.it.su.se'.2.200.0> to master

=INFO REPORT==== 1-Oct-2012::13:55:35 ===
rabbit on node 'rabbit at rabbitmq-test-disk01.it.su.se' down

=INFO REPORT==== 1-Oct-2012::13:55:35 ===
only running disc node went down

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
rabbit on node 'rabbit at rabbitmq-test-disk01.it.su.se' up

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
cluster contains disc nodes again

-------------- next part --------------

=INFO REPORT==== 1-Oct-2012::13:50:10 ===
Stopping Rabbit

=INFO REPORT==== 1-Oct-2012::13:50:10 ===
    application: rabbitmq_management
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:50:10 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:50:10 ===
stopped SSL Listener on [::]:5671

=INFO REPORT==== 1-Oct-2012::13:50:10 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:50:10 ===
    application: os_mon
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:50:10 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:50:10 ===
Halting Erlang VM

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
Memory limit set to 805MB of 2013MB total.

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
Disk free limit set to 1000MB

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 1-Oct-2012::13:50:14 ===
msg_store_persistent: recovery terms differ from present
rebuilding indices from scratch

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
Adding mirror of queue 'simlu.queue' in vhost '/' on node 'rabbit at rabbitmq-test-disk01.it.su.se': <0.250.0>

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
started SSL Listener on [::]:5671

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
rabbit on node 'rabbit at rabbitmq-test-ram01.it.su.se' up

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
Management agent started.

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
Management plugin started. Port: 443, path: /

=INFO REPORT==== 1-Oct-2012::13:50:14 ===
Statistics database started.

=INFO REPORT==== 1-Oct-2012::13:50:15 ===
accepting AMQP connection <0.315.0> (130.237.95.133:55602 -> 77.238.35.76:5671)

=INFO REPORT==== 1-Oct-2012::13:50:42 ===
Mirrored-queue (queue 'simlu.queue' in vhost '/'): Slave <'rabbit at rabbitmq-test-disk01.it.su.se'.3.250.0> saw deaths of mirrors <'rabbit at rabbitmq-test-ram01.it.su.se'.1.200.0> 

=INFO REPORT==== 1-Oct-2012::13:50:42 ===
Mirrored-queue (queue 'simlu.queue' in vhost '/'): Promoting slave <'rabbit at rabbitmq-test-disk01.it.su.se'.3.250.0> to master

=INFO REPORT==== 1-Oct-2012::13:50:42 ===
rabbit on node 'rabbit at rabbitmq-test-ram01.it.su.se' down

=INFO REPORT==== 1-Oct-2012::13:50:45 ===
rabbit on node 'rabbit at rabbitmq-test-ram01.it.su.se' up

=INFO REPORT==== 1-Oct-2012::13:55:35 ===
Stopping Rabbit

=INFO REPORT==== 1-Oct-2012::13:55:35 ===
    application: rabbitmq_management
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:55:35 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:55:35 ===
stopped SSL Listener on [::]:5671

=INFO REPORT==== 1-Oct-2012::13:55:35 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:55:35 ===
    application: os_mon
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:55:35 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 1-Oct-2012::13:55:35 ===
Halting Erlang VM

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
Memory limit set to 805MB of 2013MB total.

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
Disk free limit set to 1000MB

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
Management plugin upgraded statistics to fine.

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 1-Oct-2012::13:55:39 ===
msg_store_persistent: recovery terms differ from present
rebuilding indices from scratch

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
Adding mirror of queue 'simlu.queue' in vhost '/' on node 'rabbit at rabbitmq-test-disk01.it.su.se': <0.250.0>

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
started SSL Listener on [::]:5671

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
rabbit on node 'rabbit at rabbitmq-test-ram01.it.su.se' up

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
Management agent started.

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
Management plugin started. Port: 443, path: /

=INFO REPORT==== 1-Oct-2012::13:55:39 ===
Statistics database started.

=INFO REPORT==== 1-Oct-2012::13:55:40 ===
accepting AMQP connection <0.315.0> (130.237.95.133:55642 -> 77.238.35.76:5671)


From matthias at rabbitmq.com  Mon Oct  1 13:16:10 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 01 Oct 2012 13:16:10 +0100
Subject: [rabbitmq-discuss] BUG: Failing nodes with HA-queue stops
 message flow
In-Reply-To: <20121001120316.GJ560@kaka.it.su.se>
References: <20121001120316.GJ560@kaka.it.su.se>
Message-ID: <5069898A.5070004@rabbitmq.com>

Simon,

On 01/10/12 13:03, Simon Lundstr?m wrote:
> # In the management web GUI under the queue (simlu.queue) the
> consumer is not listed as connected to the queue. However, if I go to
> "Connections" I can see that the consumer is connected to disk01.
> According to the log the consumer is also connected.
> # Publish message via the producer # We now have 1 message "Ready" in
> the queue. The consumer does not get any message.

The most likely explanation consistent with the above observations is 
that the client failed to issue a 'basic.consume' after reconnecting.

Regards,

Matthias.

From rozacki at gmail.com  Mon Oct  1 11:11:22 2012
From: rozacki at gmail.com (ChrisR)
Date: Mon, 1 Oct 2012 10:11:22 +0000 (UTC)
Subject: [rabbitmq-discuss] RabbitMQ production ready in Windows
Message-ID: <loom.20121001T120959-664@post.gmane.org>

Hi, 

I'm trying to introduce RabbitMQ as our backbone messaging service.
My first basic question is whether RabbitMQ is used in production on Windows 
server from 2003 onwards ? 

Thank you 

Chris


From simlu at su.se  Mon Oct  1 13:48:34 2012
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Mon, 1 Oct 2012 14:48:34 +0200
Subject: [rabbitmq-discuss] BUG: Failing nodes with HA-queue stops
 message flow
In-Reply-To: <5069898A.5070004@rabbitmq.com>
References: <20121001120316.GJ560@kaka.it.su.se>
	<5069898A.5070004@rabbitmq.com>
Message-ID: <20121001124833.GA35664@kaka.it.su.se>

Hello Matthias!

On Mon, 2012-10-01 at 13:16:10 +0100, Matthias Radestock wrote:
> Simon,
> 
> On 01/10/12 13:03, Simon Lundstr?m wrote:
> ># In the management web GUI under the queue (simlu.queue) the
> >consumer is not listed as connected to the queue. However, if I go to
> >"Connections" I can see that the consumer is connected to disk01.
> >According to the log the consumer is also connected.
> ># Publish message via the producer # We now have 1 message "Ready" in
> >the queue. The consumer does not get any message.
> 
> The most likely explanation consistent with the above observations
> is that the client failed to issue a 'basic.consume' after
> reconnecting.

I left it out, but after disk01 restarts messages can pass fine.
It's when/after ram01 restarts that the consumer disappears from
"Consumers" in the queue and message passing stops.

Admittedly I'm new to AMQP and RabbitMQ, but I don't get why the
consumer which is connected to disk01 would start failing when ram01 is
being restarted.

Thanks,
- Simon

From emile at rabbitmq.com  Mon Oct  1 14:05:40 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 01 Oct 2012 14:05:40 +0100
Subject: [rabbitmq-discuss] RabbitMQ production ready in Windows
In-Reply-To: <loom.20121001T120959-664@post.gmane.org>
References: <loom.20121001T120959-664@post.gmane.org>
Message-ID: <50699524.1010307@rabbitmq.com>


Hi Chris,

On 01/10/12 11:11, ChrisR wrote:
> My first basic question is whether RabbitMQ is used in production on Windows 
> server from 2003 onwards ? 

The inception of the RabbitMQ product was in 2007:
http://www.rabbitmq.com/changelog.html
so the first production uses will not pre-date 2007.

If you need commercial support then you will need at least Windows 2008:
http://www.rabbitmq.com/platforms.html
Though Erlang (and hence RabbitMQ) will run on Windows 2003 and possibly
even older versions these are not commercially supported.

This list does still receive questions relating to Windows 2003, so it
is fair to assume that some customers use it in production.


-Emile


From matthias at rabbitmq.com  Mon Oct  1 13:59:23 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 01 Oct 2012 13:59:23 +0100
Subject: [rabbitmq-discuss] BUG: Failing nodes with HA-queue stops
 message flow
In-Reply-To: <20121001124833.GA35664@kaka.it.su.se>
References: <20121001120316.GJ560@kaka.it.su.se>
	<5069898A.5070004@rabbitmq.com>
	<20121001124833.GA35664@kaka.it.su.se>
Message-ID: <506993AB.8000107@rabbitmq.com>

Simon,

On 01/10/12 13:48, Simon Lundstr?m wrote:
> It's when/after ram01 restarts that the consumer disappears from
> "Consumers" in the queue and message passing stops.

Are you handling the consumer cancellation notification? From 
http://www.rabbitmq.com/ha.html
<quote>
Clients that were consuming from the mirrored-queue [and were connected 
to a node other than the one that died] will receive a notification that 
their subscription to the mirrored-queue has been abruptly cancelled. At 
this point they should re-consume from the queue, which will pick up the 
new master.
</quote>

> Admittedly I'm new to AMQP and RabbitMQ, but I don't get why the
> consumer which is connected to disk01 would start failing when ram01 is
> being restarted.

The docs explain that:
<quote>
The reason for sending this notification is that informing clients of 
the loss of the master is essential: otherwise the client may continue 
to issue acknowledgements for messages they were sent by the old, failed 
master [these acks will be discarded], and not expect that they might be 
about to see the same messages again, this time sent by the new master.
</quote>

Regards,

Matthias.

From simon at rabbitmq.com  Mon Oct  1 14:49:48 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 01 Oct 2012 14:49:48 +0100
Subject: [rabbitmq-discuss] rabbitmq fake-death && no breath. key word
 in log : mirrored_supervisor rabbit_mgmt_db
In-Reply-To: <CACS0wKXmRmRqyDDiLuCeSHOhmVu_ozbaxywxH8mBg9UEQRCV3A@mail.gmail.com>
References: <97f32760-fca4-4bd7-af53-b9029cde0c2e@googlegroups.com>
	<505B4BCD.5000804@rabbitmq.com>
	<CACS0wKXmRmRqyDDiLuCeSHOhmVu_ozbaxywxH8mBg9UEQRCV3A@mail.gmail.com>
Message-ID: <50699F7C.6080709@rabbitmq.com>

First of all: the fix for the bug referred to in previous emails was 
released in RabbitMQ 2.8.7. So you should consider an upgrade.

Secondly: it looks like your nodes are seeing a netsplit. Is that the 
case? You should be aware that RabbitMQ clusters don't handle netsplits 
well.

Cheers, Simon

On 27/09/12 14:54, Chao Liu wrote:
> hello,  Simon MacMullen.
> today, rabbitmq down again.
> the output of the sasl.log is the same with the last one. but there are
> something new in the .log.
> Could u help me to find out the problem ?  thanks
>
> *disc node's log*
> *
> *
> =INFO REPORT==== 27-Sep-2012::19:59:12 ===
> rabbit on node rabbit at zw_124_156 down
>
> =WARNING REPORT==== 27-Sep-2012::19:59:13 ===
> Mnesia(rabbit at zw_124_177): ** WARNING ** Mnesia is overloaded: {dump_log,
>
> time_threshold}
>
> =INFO REPORT==== 27-Sep-2012::19:59:13 ===
>      application: rabbitmq_management
>      exited: shutdown
>      type: temporary
>
> -------------------------------------------------------
> *ram node's log*
> *
> *
> =ERROR REPORT==== 27-Sep-2012::19:54:11 ===
> ** Node rabbit at zw_124_177 not responding **
> ** Removing (timedout) connection **
>
> =INFO REPORT==== 27-Sep-2012::19:54:11 ===
> rabbit on node rabbit at zw_124_177 down
>
> =INFO REPORT==== 27-Sep-2012::19:54:53 ===
> Statistics database started.
>
> =INFO REPORT==== 27-Sep-2012::19:59:13 ===
> global: Name conflict terminating {rabbit_mgmt_db,<7123.24214.2613>}
>
> =INFO REPORT==== 27-Sep-2012::19:59:13 ===
>      application: rabbitmq_management
>      exited: shutdown
>      type: temporary
>
>
> thanks.
>
>
>
>
>
> 2012/9/21 Simon MacMullen <simon at rabbitmq.com <mailto:simon at rabbitmq.com>>
>
>     Hi.
>
>     This looks like a race with management DB failover that we've
>     already fixed, but which has not yet made it into any release. This
>     will be fixed in the next bugfix release. Until then if you are
>     affected you can work around it by running the management plugin on
>     only one node in the cluster (and just have
>     rabbitmq_management_agent on the others).
>
>     Cheers, Simon
>
>     On 20/09/12 08:45, liubida wrote:
>
>         hi all,
>
>         dose anybody could point me just the direction for finding the
>         reason
>         for a fake-dead with the RabbitMQ.
>         it seem the rabbitmq could not receive messages in some point,
>         without
>         any warning.
>         i have constructed a cluster with 2 nodes, one disc and one ram.
>         if i type the command "rabbitmqctl stop_app && rabbitmqctl
>         start_app",
>         the troubleshoot disappered.
>
>
>         here is the disc node's sasl.log
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:13 ===
>         Supervisor: {<0.28802.1777>,mirrored___supervisor}
>         Context: child_terminated
>         Reason: killed
>         Offender: [{pid,<0.28804.1777>},
>         {name,rabbit_mgmt_db},
>         {mfa,{rabbit_mgmt_db,start___link,[]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {<0.28802.1777>,mirrored___supervisor}
>         Context: start_error
>         Reason: {already_started,<19704.13906.__2335>}
>         Offender: [{pid,<0.28804.1777>},
>         {name,rabbit_mgmt_db},
>         {mfa,{rabbit_mgmt_db,start___link,[]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {<0.28802.1777>,mirrored___supervisor}
>         Context: start_error
>         Reason: {already_started,<19704.13906.__2335>}
>         Offender: [{pid,<0.28804.1777>},
>         {name,rabbit_mgmt_db},
>         {mfa,{rabbit_mgmt_db,start___link,[]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {<0.28802.1777>,mirrored___supervisor}
>         Context: start_error
>         Reason: {already_started,<19704.13906.__2335>}
>         Offender: [{pid,<0.28804.1777>},
>         {name,rabbit_mgmt_db},
>         {mfa,{rabbit_mgmt_db,start___link,[]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {<0.28802.1777>,mirrored___supervisor}
>         Context: start_error
>         Reason: {already_started,<19704.13906.__2335>}
>         Offender: [{pid,<0.28804.1777>},
>         {name,rabbit_mgmt_db},
>         {mfa,{rabbit_mgmt_db,start___link,[]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {<0.28802.1777>,mirrored___supervisor}
>         Context: start_error
>         Reason: {already_started,<19704.13906.__2335>}
>         Offender: [{pid,<0.28804.1777>},
>         {name,rabbit_mgmt_db},
>         {mfa,{rabbit_mgmt_db,start___link,[]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {<0.28802.1777>,mirrored___supervisor}
>         Context: start_error
>         Reason: {already_started,<19704.13906.__2335>}
>         Offender: [{pid,<0.28804.1777>},
>         {name,rabbit_mgmt_db},
>         {mfa,{rabbit_mgmt_db,start___link,[]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {<0.28802.1777>,mirrored___supervisor}
>         Context: start_error
>         Reason: {already_started,<19704.13906.__2335>}
>         Offender: [{pid,<0.28804.1777>},
>         {name,rabbit_mgmt_db},
>         {mfa,{rabbit_mgmt_db,start___link,[]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {<0.28802.1777>,mirrored___supervisor}
>         Context: start_error
>         Reason: {already_started,<19704.13906.__2335>}
>         Offender: [{pid,<0.28804.1777>},
>         {name,rabbit_mgmt_db},
>         {mfa,{rabbit_mgmt_db,start___link,[]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {<0.28802.1777>,mirrored___supervisor}
>         Context: start_error
>         Reason: {already_started,<19704.13906.__2335>}
>         Offender: [{pid,<0.28804.1777>},
>         {name,rabbit_mgmt_db},
>         {mfa,{rabbit_mgmt_db,start___link,[]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {<0.28802.1777>,mirrored___supervisor}
>         Context: start_error
>         Reason: {already_started,<19704.13906.__2335>}
>         Offender: [{pid,<0.28804.1777>},
>         {name,rabbit_mgmt_db},
>         {mfa,{rabbit_mgmt_db,start___link,[]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {<0.28802.1777>,mirrored___supervisor}
>         Context: shutdown
>         Reason: reached_max_restart_intensity
>         Offender: [{pid,<0.28804.1777>},
>         {name,rabbit_mgmt_db},
>         {mfa,{rabbit_mgmt_db,start___link,[]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {local,rabbit_mgmt_sup}
>         Context: child_terminated
>         Reason: shutdown
>         Offender: [{pid,<0.28803.1777>},
>         {name,mirroring},
>         {mfa,
>         {mirrored_supervisor,start___internal,
>         [rabbit_mgmt_sup,
>         [{rabbit_mgmt_db,
>         {rabbit_mgmt_db,start_link,[]}__,
>         permanent,4294967295,worker,
>         [rabbit_mgmt_db]}]]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::14:53:14 ===
>         Supervisor: {local,rabbit_mgmt_sup}
>         Context: shutdown
>         Reason: reached_max_restart_intensity
>         Offender: [{pid,<0.28803.1777>},
>         {name,mirroring},
>         {mfa,
>         {mirrored_supervisor,start___internal,
>         [rabbit_mgmt_sup,
>         [{rabbit_mgmt_db,
>         {rabbit_mgmt_db,start_link,[]}__,
>         permanent,4294967295,worker,
>         [rabbit_mgmt_db]}]]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         the ram node's sasl.log
>         =SUPERVISOR REPORT==== 18-Sep-2012::17:24:50 ===
>         Supervisor: {local,rabbit_mgmt_sup}
>         Context: child_terminated
>         Reason: shutdown
>         Offender: [{pid,<0.14161.2335>},
>         {name,mirroring},
>         {mfa,
>         {mirrored_supervisor,start___internal,
>         [rabbit_mgmt_sup,
>         [{rabbit_mgmt_db,
>         {rabbit_mgmt_db,start_link,[]}__,
>         permanent,4294967295,worker,
>         [rabbit_mgmt_db]}]]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>
>         =SUPERVISOR REPORT==== 18-Sep-2012::17:24:50 ===
>         Supervisor: {local,rabbit_mgmt_sup}
>         Context: shutdown
>         Reason: reached_max_restart_intensity
>         Offender: [{pid,<0.14161.2335>},
>         {name,mirroring},
>         {mfa,
>         {mirrored_supervisor,start___internal,
>         [rabbit_mgmt_sup,
>         [{rabbit_mgmt_db,
>         {rabbit_mgmt_db,start_link,[]}__,
>         permanent,4294967295,worker,
>         [rabbit_mgmt_db]}]]}},
>         {restart_type,permanent},
>         {shutdown,4294967295},
>         {child_type,worker}]
>
>         Thanks for any help.
>
>         --bidaliu
>
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Oct  1 14:54:29 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 01 Oct 2012 14:54:29 +0100
Subject: [rabbitmq-discuss] Channel Name displayed in the Visualiser
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D17F49347@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D17F49347@FR44EX3005.global.ds.honeywell.com>
Message-ID: <5069A095.3000109@rabbitmq.com>

On 01/10/12 09:47, Gotthard, Petr wrote:
> Hello, The rabbitmq_management_visualiser shows a list of channels.
> Usually the text (Channel Name) displayed is something like
> "10.10.10.51:48482 ->  192.168.0.21:5672 (3)". Is there a way how to
> e.g. display a (reverse DNS) hostname instead of IP address, or
> otherwise make the displayed Channel Name more user/audience
> friendly?

Not at the moment - it's been on the wishlist for some time.

One complicating factor is that reverse DNS isn't always very reliable 
or fast. It might still happen at some point though.

> On one machine and for some channels only we see a Node
> Name displayed instead.

Those would presumably be direct connections from the Erlang client?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simlu at su.se  Mon Oct  1 15:07:34 2012
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Mon, 1 Oct 2012 16:07:34 +0200
Subject: [rabbitmq-discuss] BUG: Failing nodes with HA-queue stops
 message flow
In-Reply-To: <506993AB.8000107@rabbitmq.com>
References: <20121001120316.GJ560@kaka.it.su.se>
	<5069898A.5070004@rabbitmq.com>
	<20121001124833.GA35664@kaka.it.su.se>
	<506993AB.8000107@rabbitmq.com>
Message-ID: <20121001140733.GB35664@kaka.it.su.se>

On Mon, 2012-10-01 at 13:59:23 +0100, Matthias Radestock wrote:
> On 01/10/12 13:48, Simon Lundstr?m wrote:
> >It's when/after ram01 restarts that the consumer disappears from
> >"Consumers" in the queue and message passing stops.
> 
> Are you handling the consumer cancellation notification? From
> http://www.rabbitmq.com/ha.html
> <quote>
> Clients that were consuming from the mirrored-queue [and were
> connected to a node other than the one that died] will receive a
> notification that their subscription to the mirrored-queue has been
> abruptly cancelled. At this point they should re-consume from the
> queue, which will pick up the new master.
> </quote>

I have no idea how *I* should be handling consumer cancel notification
(can't find this in the documentation), but I'm pretty sure Ruby AMQP
handles it, see
<https://github.com/ruby-amqp/amq-client/commit/49951878a8ff4bdbcead3c13eb7737ade6e70669>
and <https://groups.google.com/forum/#!topic/ruby-amqp/KKxv4DFVJVk>.

How can I see the client properties (to check if my consumer reports
support for CCN) in the management GUI?

Under Connections => Consumer IP, Client properties I only get:
information http://github.com/ruby-amqp/amqp
platform  ruby 1.8.7 (2012-02-08 patchlevel 358) [universal-darwin11.0]
version 0.9.7
product AMQP gem

This,
<https://groups.google.com/forum/?fromgroups=#!topic/ruby-amqp/TA4n5Eq4IgU> is
the only thing related to CCN I can find on Ruby AMQP.
I'll ask on their mailinglist.

> >Admittedly I'm new to AMQP and RabbitMQ, but I don't get why the
> >consumer which is connected to disk01 would start failing when ram01 is
> >being restarted.
> 
> The docs explain that:
> <quote>
> The reason for sending this notification is that informing clients
> of the loss of the master is essential: otherwise the client may
> continue to issue acknowledgements for messages they were sent by
> the old, failed master [these acks will be discarded], and not
> expect that they might be about to see the same messages again, this
> time sent by the new master.
> </quote>

Aaah, and the reason for this not happening when disk01 is master and
then restarted is because the consumer is connected to disk01 and must
reconnect (because it just lost the connection)?

Oh, why mailed here in the first place was becuase Emile thought it was
strange that ram01 threw this message:
=ERROR REPORT==== 1-Oct-2012::13:55:35 ===
Discarding message {'$gen_call',{<0.173.0>,#Ref<0.0.0.967>},{notify_down,<6733.320.0>}} from <0.173.0> to <0.200.0> in an old incarnation (1) of this node (2)

But maybe that's when the consumer doesn't handle basic.cancel?

Thanks!
- Simon

From rc.china at gmail.com  Mon Oct  1 15:10:05 2012
From: rc.china at gmail.com (raocheng)
Date: Mon, 1 Oct 2012 22:10:05 +0800
Subject: [rabbitmq-discuss] Two questions about AMQP protocol's
	marshalling/unmarshalling
Message-ID: <CAKF3iDjWQ1yTkAzPdtWzKqu0ojJXZ-bRR7gLzkk2QcK0J6UAXw@mail.gmail.com>

While I am reading amqp0-9-1.pdf, I get two questions about  AMQP
protocol's marshalling/unmarshalling:

4.2.5.3 Strings:
Short strings, stored as an 8-bit unsigned integer length followed by zero
or more octets of data. Short strings can carry up to 255 octets of UTF-8
data, but may not contain binary zero octets.

=======
Question: What does "binary zero octets" mean ? Why can they not be
contained in shortstr ?
=======

4.2.5.5 field Tables
... The name-value pairs are encoded as short string defining the name, and
octet defining the values type and then the value itself.

=======
Question: By the definition, there should be an octet used for defining the
values type. So where can we know the detailed definition for each value
type (e.g, 1 --> octet, 2 -> short, 3-> long, 4 -> longlong, 5 -> shortstr,
6-> longstr, 7->table, ...) ? I can not find the corresponding definition
in AMQP's documents(amqp0-9-1.xml, amqp0-9-1.pdf)
=======

Thanks in advance!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121001/6c22fa07/attachment.htm>

From matthias at rabbitmq.com  Mon Oct  1 15:11:45 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 01 Oct 2012 15:11:45 +0100
Subject: [rabbitmq-discuss] Rabbitmq 2.5.1 Bad argument crash
In-Reply-To: <012a01cd9d91$becf5550$3c6dfff0$@euphoriaaudio.com>
References: <00e901cd9d87$5bab9650$1302c2f0$@euphoriaaudio.com>	<5065B938.8070609@rabbitmq.com>
	<011801cd9d8c$2e620350$8b2609f0$@euphoriaaudio.com>
	<012a01cd9d91$becf5550$3c6dfff0$@euphoriaaudio.com>
Message-ID: <5069A4A1.3030400@rabbitmq.com>

Chris,

On 28/09/12 16:55, Chris Larsen wrote:
  > Response from devs "We are using pika 0.9.5 client library on Python 
side
> and amqp-client 2.8.1 on Java side."

It is extremely unlikely that the above combination, in fact use of 
*any* AMQP client, produces the error you were seeing.

I suspect the stomp plug-in you say is enabled but "not in use" may in 
fact have been used at least once to send a message. Alternatively, and 
less likely, the management plug-in could also conceivably have been the 
source of the message.

I suggest you upgrade since both of these problems have been fixed.

Matthias.

From matthias at rabbitmq.com  Mon Oct  1 15:22:57 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 01 Oct 2012 15:22:57 +0100
Subject: [rabbitmq-discuss] BUG: Failing nodes with HA-queue stops
 message flow
In-Reply-To: <20121001140733.GB35664@kaka.it.su.se>
References: <20121001120316.GJ560@kaka.it.su.se>
	<5069898A.5070004@rabbitmq.com>
	<20121001124833.GA35664@kaka.it.su.se>
	<506993AB.8000107@rabbitmq.com>
	<20121001140733.GB35664@kaka.it.su.se>
Message-ID: <5069A741.6020005@rabbitmq.com>

Simon,

On 01/10/12 15:07, Simon Lundstr?m wrote:
> I have no idea how *I* should be handling consumer cancel notification
> (can't find this in the documentation), but I'm pretty sure Ruby AMQP
> handles it, see
> <https://github.com/ruby-amqp/amq-client/commit/49951878a8ff4bdbcead3c13eb7737ade6e70669>
> and <https://groups.google.com/forum/#!topic/ruby-amqp/KKxv4DFVJVk>.

It *supports* CCNs, but I am pretty sure you'll need to set up a call 
back to actually *handle* them (i.e. re-consume).

> How can I see the client properties (to check if my consumer reports
> support for CCN) in the management GUI?

They should be shown on the connection details page.

> Under Connections => Consumer IP, Client properties I only get:
> information http://github.com/ruby-amqp/amqp
> platform  ruby 1.8.7 (2012-02-08 patchlevel 358) [universal-darwin11.0]
> version 0.9.7
> product AMQP gem

I suspect your version of the gem is too old.

> I'll ask on their mailinglist.

Good idea.

> Aaah, and the reason for this not happening when disk01 is master and
> then restarted is because the consumer is connected to disk01 and must
> reconnect (because it just lost the connection)?

Correct.

> Oh, why mailed here in the first place was becuase Emile thought it was
> strange that ram01 threw this message:
> =ERROR REPORT==== 1-Oct-2012::13:55:35 ===
> Discarding message {'$gen_call',{<0.173.0>,#Ref<0.0.0.967>},{notify_down,<6733.320.0>}} from <0.173.0> to <0.200.0> in an old incarnation (1) of this node (2)

I don't think that indicates a problem.

> But maybe that's when the consumer doesn't handle basic.cancel?

Nah, definitely unrelated to that.


Regards,

Matthias.

From gsim at redhat.com  Mon Oct  1 17:35:46 2012
From: gsim at redhat.com (Gordon Sim)
Date: Mon, 01 Oct 2012 17:35:46 +0100
Subject: [rabbitmq-discuss] Two questions about AMQP protocol's
	marshalling/unmarshalling
In-Reply-To: <CAKF3iDjWQ1yTkAzPdtWzKqu0ojJXZ-bRR7gLzkk2QcK0J6UAXw@mail.gmail.com>
References: <CAKF3iDjWQ1yTkAzPdtWzKqu0ojJXZ-bRR7gLzkk2QcK0J6UAXw@mail.gmail.com>
Message-ID: <5069C662.2030501@redhat.com>

On 10/01/2012 03:10 PM, raocheng wrote:
> While I am reading amqp0-9-1.pdf, I get two questions about  AMQP
> protocol's marshalling/unmarshalling:
>
> 4.2.5.3 Strings:
> Short strings, stored as an 8-bit unsigned integer length followed by
> zero or more octets of data. Short strings can carry up to 255 octets of
> UTF-8 data, but may not contain binary zero octets.
>
> =======
> Question: What does "binary zero octets" mean ?

It means the octet with value 0x00.

> Why can they not be
> contained in shortstr ?

I think it is so the values can be treated as C-strings (where the 0x00 
or null character is the string terminator).

> =======
>
> 4.2.5.5 field Tables
> ... The name-value pairs are encoded as short string defining the name,
> and octet defining the values type and then the value itself.
>
> =======
> Question: By the definition, there should be an octet used for defining
> the values type. So where can we know the detailed definition for each
> value type (e.g, 1 --> octet, 2 -> short, 3-> long, 4 -> longlong, 5 ->
> shortstr, 6-> longstr, 7->table, ...) ? I can not find the corresponding
> definition in AMQP's documents(amqp0-9-1.xml, amqp0-9-1.pdf)

I agree it is not terribly obvious given the flow of the text, but look 
at the protocol grammar in 4.2.1 section. The type codes are given 
against the definition of 'field-value'.



From simon at rabbitmq.com  Mon Oct  1 17:36:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 01 Oct 2012 17:36:36 +0100
Subject: [rabbitmq-discuss] Two questions about AMQP
	protocol's	marshalling/unmarshalling
In-Reply-To: <5069C662.2030501@redhat.com>
References: <CAKF3iDjWQ1yTkAzPdtWzKqu0ojJXZ-bRR7gLzkk2QcK0J6UAXw@mail.gmail.com>
	<5069C662.2030501@redhat.com>
Message-ID: <5069C694.6050507@rabbitmq.com>

On 01/10/12 17:35, Gordon Sim wrote:
> On 10/01/2012 03:10 PM, raocheng wrote:
>> Question: What does "binary zero octets" mean ?
>
> It means the octet with value 0x00.

...and just for extra clarity, the only way to end up with a byte 0x00 
in your string is to encode the Unicode NULL character U+0000. Actually 
I don't think RabbitMQ will stop you doing this, but it's probably a 
good way to increase the amount of confusion in your life.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mpietrek at skytap.com  Mon Oct  1 18:07:11 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 1 Oct 2012 10:07:11 -0700
Subject: [rabbitmq-discuss] Errors starting RabbitMQ when cluster
 membership changes
In-Reply-To: <50696ABF.1030900@rabbitmq.com>
References: <CACLE7iznHVn6b1Q9f=EGks64y2Hy4p17k8PMtT4JS6n_ORnc5A@mail.gmail.com>
	<50696ABF.1030900@rabbitmq.com>
Message-ID: <CACLE7iyWe0g-i50yB+hT6c+SwpLyqDTEEupYN2=4XePp02A28A@mail.gmail.com>

Hey Tim,

I was expecting that basic response. Thanks!

However... I still think there may an issue here that hinders RabbitMQ's
deployment in production scenarios. Please correct me if I'm wrong or
missing something.

Hypothetically, what would happen if my 'util' node was zapped by lightning
and I had no way to bring it up in a timely manner. Would I be able to
start the existing cluster nodes (play, play2) "far enough" to run the
proper rabbitmqctl command to remove util from the cluster?

That is, once I've gotten into a bad situation, can I back out of it
gracefully and without message loss? Or is the only option to reset the
entire cluster?

Thanks,

Matt
On Mon, Oct 1, 2012 at 3:04 AM, Tim Watson <tim at rabbitmq.com> wrote:

>  Hi Matt,
>
>
> On 09/28/2012 08:23 PM, Matt Pietrek wrote:
>
> For example, at one point I had a three node cluster: play, play2, and
> util. I then removed util from the cluster, although to be honest, simply
> by changing the rabbitmq.config file, rather than explicitly running
> rabbitmqctl stop_app while the cluster is still running.
>
>
> I'm pretty sure you're not supposed to do that! :)
>
>
> My steps:
>
>    - Running as three node cluster, stop all brokers
>    - Create a new rabbitmq.config file with just two brokers
>    - Attempt to start the new cluster.
>
>
> If you don't take util offline using the right procedure, I suspect mnesia
> will get out of sorts and this isn't something you want to happen. It's
> important to make cluster changes using the right procedure, as mnesia is
> rather a fussy beast.
>
> BTW we've made some improvements that (hopefully) simplify working with
> clusters and these will be in the forthcoming feature release!
>
> Cheers,
> Tim
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121001/16657d8a/attachment.htm>

From watson.timothy at gmail.com  Mon Oct  1 18:43:08 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 1 Oct 2012 18:43:08 +0100
Subject: [rabbitmq-discuss] Errors starting RabbitMQ when cluster
	membership changes
In-Reply-To: <CACLE7iyWe0g-i50yB+hT6c+SwpLyqDTEEupYN2=4XePp02A28A@mail.gmail.com>
References: <CACLE7iznHVn6b1Q9f=EGks64y2Hy4p17k8PMtT4JS6n_ORnc5A@mail.gmail.com>
	<50696ABF.1030900@rabbitmq.com>
	<CACLE7iyWe0g-i50yB+hT6c+SwpLyqDTEEupYN2=4XePp02A28A@mail.gmail.com>
Message-ID: <08F26A76-177E-4FAF-8D81-2AADF54A01B8@rabbitmq.com>

Don't take this as gospel, yet, but my understanding is that you'll be able to make cluster changes like this successfully, but I'll make sure there's a test case to prove this scenario.

On 1 Oct 2012, at 18:07, Matt Pietrek <mpietrek at skytap.com> wrote:

> Hey Tim,
> 
> I was expecting that basic response. Thanks!
> 
> However... I still think there may an issue here that hinders RabbitMQ's deployment in production scenarios. Please correct me if I'm wrong or missing something.
> 
> Hypothetically, what would happen if my 'util' node was zapped by lightning and I had no way to bring it up in a timely manner. Would I be able to start the existing cluster nodes (play, play2) "far enough" to run the proper rabbitmqctl command to remove util from the cluster?
> 
> That is, once I've gotten into a bad situation, can I back out of it gracefully and without message loss? Or is the only option to reset the entire cluster?
> 
> Thanks,
> 
> Matt
> On Mon, Oct 1, 2012 at 3:04 AM, Tim Watson <tim at rabbitmq.com> wrote:
> Hi Matt,
> 
> 
> On 09/28/2012 08:23 PM, Matt Pietrek wrote:
>> For example, at one point I had a three node cluster: play, play2, and util. I then removed util from the cluster, although to be honest, simply by changing the rabbitmq.config file, rather than explicitly running rabbitmqctl stop_app while the cluster is still running.
>> 
> 
> I'm pretty sure you're not supposed to do that! :)
> 
> 
>> My steps:
>> Running as three node cluster, stop all brokers
>> Create a new rabbitmq.config file with just two brokers
>> Attempt to start the new cluster.
> 
> If you don't take util offline using the right procedure, I suspect mnesia will get out of sorts and this isn't something you want to happen. It's important to make cluster changes using the right procedure, as mnesia is rather a fussy beast.
> 
> BTW we've made some improvements that (hopefully) simplify working with clusters and these will be in the forthcoming feature release! 
> 
> Cheers,
> Tim
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121001/e4211740/attachment.htm>

From mpietrek at skytap.com  Mon Oct  1 20:56:36 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 1 Oct 2012 12:56:36 -0700
Subject: [rabbitmq-discuss] Errors starting RabbitMQ when cluster
 membership changes
In-Reply-To: <08F26A76-177E-4FAF-8D81-2AADF54A01B8@rabbitmq.com>
References: <CACLE7iznHVn6b1Q9f=EGks64y2Hy4p17k8PMtT4JS6n_ORnc5A@mail.gmail.com>
	<50696ABF.1030900@rabbitmq.com>
	<CACLE7iyWe0g-i50yB+hT6c+SwpLyqDTEEupYN2=4XePp02A28A@mail.gmail.com>
	<08F26A76-177E-4FAF-8D81-2AADF54A01B8@rabbitmq.com>
Message-ID: <CACLE7izt1sTeMEtb2L-Z_1aAHg0r4cugQxru+kPxuez-6uK+cQ@mail.gmail.com>

Just so I understand, do you mean that I should be able to take the right
steps in 2.8.7, or that in some future version I'll be able to? I assume
the latter but just want to be sure.

Thanks for the quick reply!

On Mon, Oct 1, 2012 at 10:43 AM, Tim Watson <watson.timothy at gmail.com>wrote:

> Don't take this as gospel, yet, but my understanding is that you'll be
> able to make cluster changes like this successfully, but I'll make sure
> there's a test case to prove this scenario.
>
> On 1 Oct 2012, at 18:07, Matt Pietrek <mpietrek at skytap.com> wrote:
>
> Hey Tim,
>
> I was expecting that basic response. Thanks!
>
> However... I still think there may an issue here that hinders RabbitMQ's
> deployment in production scenarios. Please correct me if I'm wrong or
> missing something.
>
> Hypothetically, what would happen if my 'util' node was zapped by
> lightning and I had no way to bring it up in a timely manner. Would I be
> able to start the existing cluster nodes (play, play2) "far enough" to run
> the proper rabbitmqctl command to remove util from the cluster?
>
> That is, once I've gotten into a bad situation, can I back out of it
> gracefully and without message loss? Or is the only option to reset the
> entire cluster?
>
> Thanks,
>
> Matt
> On Mon, Oct 1, 2012 at 3:04 AM, Tim Watson <tim at rabbitmq.com> wrote:
>
>>  Hi Matt,
>>
>>
>> On 09/28/2012 08:23 PM, Matt Pietrek wrote:
>>
>> For example, at one point I had a three node cluster: play, play2, and
>> util. I then removed util from the cluster, although to be honest, simply
>> by changing the rabbitmq.config file, rather than explicitly running
>> rabbitmqctl stop_app while the cluster is still running.
>>
>>
>> I'm pretty sure you're not supposed to do that! :)
>>
>>
>> My steps:
>>
>>    - Running as three node cluster, stop all brokers
>>    - Create a new rabbitmq.config file with just two brokers
>>    - Attempt to start the new cluster.
>>
>>
>> If you don't take util offline using the right procedure, I suspect
>> mnesia will get out of sorts and this isn't something you want to happen.
>> It's important to make cluster changes using the right procedure, as mnesia
>> is rather a fussy beast.
>>
>> BTW we've made some improvements that (hopefully) simplify working with
>> clusters and these will be in the forthcoming feature release!
>>
>> Cheers,
>> Tim
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121001/d601d109/attachment.htm>

From rozacki at gmail.com  Mon Oct  1 14:24:24 2012
From: rozacki at gmail.com (=?ISO-8859-2?Q?Krzysztof_R=F3=BFacki?=)
Date: Mon, 1 Oct 2012 14:24:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ production ready in Windows
In-Reply-To: <50699524.1010307@rabbitmq.com>
References: <loom.20121001T120959-664@post.gmane.org>
	<50699524.1010307@rabbitmq.com>
Message-ID: <CADTmS1Bh=fkYrpibchQs13yTcmPkoCE1JvZKa2isL=tcsOh2eQ@mail.gmail.com>

Emile,

Thank you for your replay and pointing out that I can get commercial
support for Windows 2008 onwards.

I'd like to find out about opinions of people who use RabbitMQ and Windows
in every day production. Whether they discourage from using RabbitMQ in
this way or it's fine to run it.


On 1 October 2012 14:05, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Chris,
>
> On 01/10/12 11:11, ChrisR wrote:
> > My first basic question is whether RabbitMQ is used in production on
> Windows
> > server from 2003 onwards ?
>
> The inception of the RabbitMQ product was in 2007:
> http://www.rabbitmq.com/changelog.html
> so the first production uses will not pre-date 2007.
>
> If you need commercial support then you will need at least Windows 2008:
> http://www.rabbitmq.com/platforms.html
> Though Erlang (and hence RabbitMQ) will run on Windows 2003 and possibly
> even older versions these are not commercially supported.
>
> This list does still receive questions relating to Windows 2003, so it
> is fair to assume that some customers use it in production.
>
>
> -Emile
>
>


-- 
Krzysztof Rozacki
Software Architect
www: k-rozacki.blogspot.com
tel: 07807231975
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121001/dc42e945/attachment.htm>

From watson.timothy at gmail.com  Tue Oct  2 08:36:53 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 2 Oct 2012 08:36:53 +0100
Subject: [rabbitmq-discuss] Errors starting RabbitMQ when cluster
	membership changes
In-Reply-To: <CACLE7izt1sTeMEtb2L-Z_1aAHg0r4cugQxru+kPxuez-6uK+cQ@mail.gmail.com>
References: <CACLE7iznHVn6b1Q9f=EGks64y2Hy4p17k8PMtT4JS6n_ORnc5A@mail.gmail.com>
	<50696ABF.1030900@rabbitmq.com>
	<CACLE7iyWe0g-i50yB+hT6c+SwpLyqDTEEupYN2=4XePp02A28A@mail.gmail.com>
	<08F26A76-177E-4FAF-8D81-2AADF54A01B8@rabbitmq.com>
	<CACLE7izt1sTeMEtb2L-Z_1aAHg0r4cugQxru+kPxuez-6uK+cQ@mail.gmail.com>
Message-ID: <B2EDD7EC-BD2C-4D54-BBE5-9F37917AF81D@rabbitmq.com>

Hi Matt

On 1 Oct 2012, at 20:56, Matt Pietrek <mpietrek at skytap.com> wrote:

> Just so I understand, do you mean that I should be able to take the right steps in 2.8.7, or that in some future version I'll be able to? I assume the latter but just want to be sure.
> 

Correct, we will release the improved cluster commands in the next main feature release.

From aembleton at gmail.com  Tue Oct  2 10:03:12 2012
From: aembleton at gmail.com (Arthur Embleton)
Date: Tue, 2 Oct 2012 02:03:12 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ QueueingConsumer possible memory leak
Message-ID: <b9190163-e255-4c75-aab4-fbb146a6e59a@googlegroups.com>

I have the following code to declare a queue:

Connection connection = RabbitConnection.getConnection();
Channel channel = connection.createChannel();
channel.queueDeclare(getQueueName(), false, false, false, null);
consumer = new QueueingConsumer(channel);
channel.basicConsume(getQueueName(), true,consumer);

and the following to get the next Delivery object and process it:

        Delivery delivery = null;
        T queue = null;
        
        //loop over, continuously retrieving messages
        while(true) {
            
            try {
                delivery = consumer.nextDelivery();
                queue = deserialise(delivery.getBody());
                
                process(queue);
                
            } catch (ShutdownSignalException e) {
                logger.warn("Shutodwon signal received.");
                break;
            } catch (ConsumerCancelledException e) {
                logger.warn("Consumer cancelled exception: 
{}",e.getMessage());
                break;
            } catch (InterruptedException e) {
                logger.warn("Interuption exception: {}", e);
                break;
            }
        }

If I run this with a queue containing a large number of objects, after 
approximatelly 2.7 million objects I get an out of memory exception.  I 
found this originally by running it over night with data going in from 
JMeter at a rate ~90/s which at first it is consuming without any trouble, 
but in the morning I noticed a large number in RabbitMQ and an out of 
memory exception on the consumer.  I ran it up again and used the Eclipse 
Memory Analyzer to determine where this memory was being used.  From this I 
can see that the java.util.concurrent.LinkedBlockingQueue that is 
referenced by com.rabbitmq.client.QueueingConsumer is growing and growing 
until it runs out of memory.

Do I need to do anything to tell Rabbit to release resources?

I could increase the heap size but I'm concerned that this is just a short 
term fix and there might be something in my code that could bite me with a 
memory leak a few months into production deployment.
I have also posted this to StackOverflow:  
http://stackoverflow.com/questions/12687368/rabbitmq-queueingconsumer-possible-memory-leak
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121002/788a75da/attachment.htm>

From simon at rabbitmq.com  Tue Oct  2 10:48:19 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 02 Oct 2012 10:48:19 +0100
Subject: [rabbitmq-discuss] Two questions about AMQP protocol's
	marshalling/unmarshalling
In-Reply-To: <CAKF3iDgBasngABe6k+33rtvCUfE1jjttras99Vces7nnoMbv8A@mail.gmail.com>
References: <CAKF3iDjWQ1yTkAzPdtWzKqu0ojJXZ-bRR7gLzkk2QcK0J6UAXw@mail.gmail.com>	<5069C662.2030501@redhat.com>	<5069C694.6050507@rabbitmq.com>
	<CAKF3iDgBasngABe6k+33rtvCUfE1jjttras99Vces7nnoMbv8A@mail.gmail.com>
Message-ID: <506AB863.5040907@rabbitmq.com>

On 02/10/12 10:44, raocheng wrote:
> How about my second question? Does anybody know where can we find the
> definition for each value type (e.g, 0-> bit,  1 --> octet, 2 -> short,
> 3-> long, 4 -> longlong, 5 -> shortstr, 6-> longstr, 7->table, ...)  ?

Gordon already answered it - see section 4.2.1 under "field-value".

However.

The 0-9-1 spec changed at the last minute in this regard for unclear 
reasons. So RabbitMQ does not actually implement what's in the spec - I 
suspect no-one does. See

http://www.rabbitmq.com/amqp-0-9-1-errata.html#section_3

for what we actually implement.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Oct  2 11:16:42 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 02 Oct 2012 11:16:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ QueueingConsumer possible memory
 leak
In-Reply-To: <b9190163-e255-4c75-aab4-fbb146a6e59a@googlegroups.com>
References: <b9190163-e255-4c75-aab4-fbb146a6e59a@googlegroups.com>
Message-ID: <506ABF0A.8010109@rabbitmq.com>

Bear in mind that the QueueingConsumer is there to buffer messages in 
the client before you call nextDelivery().

You haven't told the broker to limit the number of unacked messages to 
send you, so it hasn't. I suspect therefore the broker is sending you 
messages faster than you are calling nextDelivery() - and they're 
getting stored in your LinkedBlockingQueue.

A solution is to invoke Channel.basicQos(number), and use explicit acks.

Cheers, Simon

On 02/10/12 10:03, Arthur Embleton wrote:
> I have the following code to declare a queue:
>
> Connection connection = RabbitConnection.getConnection();
> Channel channel = connection.createChannel();
> channel.queueDeclare(getQueueName(), false, false, false, null);
> consumer = new QueueingConsumer(channel);
> channel.basicConsume(getQueueName(), true,consumer);
>
> and the following to get the next Delivery object and process it:
>
> Delivery delivery = null;
> T queue = null;
>
> //loop over, continuously retrieving messages
> while(true) {
>
> try {
> delivery = consumer.nextDelivery();
> queue = deserialise(delivery.getBody());
>
> process(queue);
>
> } catch (ShutdownSignalException e) {
> logger.warn("Shutodwon signal received.");
> break;
> } catch (ConsumerCancelledException e) {
> logger.warn("Consumer cancelled exception: {}",e.getMessage());
> break;
> } catch (InterruptedException e) {
> logger.warn("Interuption exception: {}", e);
> break;
> }
> }
>
> If I run this with a queue containing a large number of objects, after
> approximatelly 2.7 million objects I get an out of memory exception. I
> found this originally by running it over night with data going in from
> JMeter at a rate ~90/s which at first it is consuming without any
> trouble, but in the morning I noticed a large number in RabbitMQ and an
> out of memory exception on the consumer. I ran it up again and used the
> Eclipse Memory Analyzer to determine where this memory was being used.
>  From this I can see that the java.util.concurrent.LinkedBlockingQueue
> that is referenced by com.rabbitmq.client.QueueingConsumer is growing
> and growing until it runs out of memory.
>
> Do I need to do anything to tell Rabbit to release resources?
>
> I could increase the heap size but I'm concerned that this is just a
> short term fix and there might be something in my code that could bite
> me with a memory leak a few months into production deployment.
>
> I have also posted this to StackOverflow:
> http://stackoverflow.com/questions/12687368/rabbitmq-queueingconsumer-possible-memory-leak
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From michael.s.klishin at gmail.com  Tue Oct  2 11:25:19 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 2 Oct 2012 10:25:19 +0000
Subject: [rabbitmq-discuss] Problems getting reply_to to work
In-Reply-To: <50686B0A.70202@rabbitmq.com>
References: <81b68608-30bd-4bbb-959b-03255089fa44@e18g2000yqo.googlegroups.com>
	<CAE3HoVQD0pJeDEHBPkSMhcXV1Xdn1ekwtnwd3OLTp_DiTcsvcw@mail.gmail.com>
	<5067F228.1050202@rabbitmq.com>
	<CADf7wwXDeh-Eu7Uh+JyfW2RauLLY_0+cspfV-mQJ2+DeCX8Rdw@mail.gmail.com>
	<5068457D.2000603@rabbitmq.com>
	<CADf7wwWbzbTVtspGedDzghzhKp8z5kB6nPNr9Kr34zPA_q6BGQ@mail.gmail.com>
	<50686B0A.70202@rabbitmq.com>
Message-ID: <CAE3HoVSOwUAGEvD45PYgi8bfBevrMBH5f=My9mLqjSYxbodmgw@mail.gmail.com>

2012/9/30 Matthias Radestock <matthias at rabbitmq.com>

> Thanks. Michael, could you eradicate those, please?



Done. I also removed references to the immediate flag from rubyamqp.info.

In 2.9, will using the flag raise an exception or will it be silently
ignored?
-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121002/272c8190/attachment.htm>

From simon at rabbitmq.com  Tue Oct  2 11:32:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 02 Oct 2012 11:32:36 +0100
Subject: [rabbitmq-discuss] Problems getting reply_to to work
In-Reply-To: <CAE3HoVSOwUAGEvD45PYgi8bfBevrMBH5f=My9mLqjSYxbodmgw@mail.gmail.com>
References: <81b68608-30bd-4bbb-959b-03255089fa44@e18g2000yqo.googlegroups.com>	<CAE3HoVQD0pJeDEHBPkSMhcXV1Xdn1ekwtnwd3OLTp_DiTcsvcw@mail.gmail.com>	<5067F228.1050202@rabbitmq.com>	<CADf7wwXDeh-Eu7Uh+JyfW2RauLLY_0+cspfV-mQJ2+DeCX8Rdw@mail.gmail.com>	<5068457D.2000603@rabbitmq.com>	<CADf7wwWbzbTVtspGedDzghzhKp8z5kB6nPNr9Kr34zPA_q6BGQ@mail.gmail.com>	<50686B0A.70202@rabbitmq.com>
	<CAE3HoVSOwUAGEvD45PYgi8bfBevrMBH5f=My9mLqjSYxbodmgw@mail.gmail.com>
Message-ID: <506AC2C4.6060901@rabbitmq.com>

On 02/10/12 11:25, Michael Klishin wrote:
> In 2.9, will using the flag raise an exception or will it be silently
> ignored?

It will blow up - we don't want to mislead people into thinking that 
it's working.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Tue Oct  2 11:33:33 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 02 Oct 2012 11:33:33 +0100
Subject: [rabbitmq-discuss] Problems getting reply_to to work
In-Reply-To: <CAE3HoVSOwUAGEvD45PYgi8bfBevrMBH5f=My9mLqjSYxbodmgw@mail.gmail.com>
References: <81b68608-30bd-4bbb-959b-03255089fa44@e18g2000yqo.googlegroups.com>
	<CAE3HoVQD0pJeDEHBPkSMhcXV1Xdn1ekwtnwd3OLTp_DiTcsvcw@mail.gmail.com>
	<5067F228.1050202@rabbitmq.com>
	<CADf7wwXDeh-Eu7Uh+JyfW2RauLLY_0+cspfV-mQJ2+DeCX8Rdw@mail.gmail.com>
	<5068457D.2000603@rabbitmq.com>
	<CADf7wwWbzbTVtspGedDzghzhKp8z5kB6nPNr9Kr34zPA_q6BGQ@mail.gmail.com>
	<50686B0A.70202@rabbitmq.com>
	<CAE3HoVSOwUAGEvD45PYgi8bfBevrMBH5f=My9mLqjSYxbodmgw@mail.gmail.com>
Message-ID: <506AC2FD.7010005@rabbitmq.com>

Michael,

On 02/10/12 11:25, Michael Klishin wrote:
> 2012/9/30 Matthias Radestock <matthias at rabbitmq.com
> <mailto:matthias at rabbitmq.com>>
>
>     Thanks. Michael, could you eradicate those, please?
>
> Done. I also removed references to the immediate flag from rubyamqp.info

Cheers.

> In 2.9, will using the flag raise an exception or will it be silently
> ignored?

The server will issue a 540/not-implemented error with a suitable 
description.

Regards,

Matthias.


From simon at rabbitmq.com  Tue Oct  2 12:09:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 02 Oct 2012 12:09:51 +0100
Subject: [rabbitmq-discuss] Unnecessarily complex packaging (Fedora)
In-Reply-To: <CAD-DQxQ5=8YjbyscosWpssLLCaRRvUiUr0rWHyfXfvPvQgcNpw@mail.gmail.com>
References: <20120928141742.5a8c.abe10f7e5afbbb3a79ce619739541149@cern.ch>	<50659DF9.6030805@rabbitmq.com>
	<CAD-DQxQ5=8YjbyscosWpssLLCaRRvUiUr0rWHyfXfvPvQgcNpw@mail.gmail.com>
Message-ID: <506ACB7F.7010008@rabbitmq.com>

On 28/09/12 17:59, Jeffrey Ollie wrote:
> On Fri, Sep 28, 2012 at 7:54 AM, Simon MacMullen<simon at rabbitmq.com>  wrote:
>> On 28/09/12 13:30, Lionel Cons wrote:
>>>
>>> I've looked at the init script as part of
>>> rabbitmq-server-2.8.7-1.noarch.rpm
>>> and I find it unnecessarily complex.
>>
>> It *is* complex. I *think* all the complexity is necessary.
>
> The complexity is not necessary, at least on Fedora 16 and up.  By
> switching to a native systemd service file, the startup is much, much
> simpler:

Well, that is simpler in one dimension (much less complicated init 
script). But it doesn't actually address one issue that the OP was 
talking about - the fact that we change users in different ways / places.

> Of course, that doesn't help RHEL, at least not until RHEL switches to systemd.

Indeed. Hopefully we can convert to these various next-gen init 
replacements at some point, but we want to be fairly backward-compatible 
and conservative here.

Incidentally, can I just point out how pleased I am that there is such a 
rich variety of init replacements that every distro seems to be able to 
pick a different one...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alex at inferiorhumanorgans.com  Tue Oct  2 15:09:04 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Tue, 2 Oct 2012 07:09:04 -0700
Subject: [rabbitmq-discuss] Proper protocol for dealing with crash dumps?
In-Reply-To: <50680EE6.6050301@rabbitmq.com>
References: <20120929132049.GA88595@bloaty>
 <50680EE6.6050301@rabbitmq.com>
Message-ID: <20121002140903.GD65786@bloaty>

On Sun, Sep 30, 2012 at 10:20:38AM +0100, Matthias Radestock wrote:

> The first handful of lines of the erl_crash.dump are the most 
> interesting, so you could keep/transfer just that and discard the rest.

Okay.

Looks like the first three lines are most interesting:

=erl_crash_dump:0.1
Fri Sep 28 20:38:32 2012
Slogan: eheap_alloc: Cannot allocate 747325720 bytes of memory (of type "heap").
System version: Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [hipe] [kernel-poll:true]
Compiled: Fri Sep 24 19:15:42 2010

Nothing else should be using a lot of memory, but I guess this points to a non-rabbit/erlang problem unless there have been memory leaks fixed since R13B03 + 2.8.6?

I'm using the stock Ubuntu (11.04) packages for Erlang, and the debs from the Rabbit site.

- alex

From orionfillmore at gmail.com  Tue Oct  2 15:32:51 2012
From: orionfillmore at gmail.com (Orion Fillmore)
Date: Tue, 2 Oct 2012 07:32:51 -0700 (PDT)
Subject: [rabbitmq-discuss] .erlang.cookie wont change for clustering
Message-ID: <a18dae94-4121-46f8-9358-6bde16f8cd6d@googlegroups.com>

Hello,

I am trying to get clustering set up for some rabbit mq servers.  I changed 
the .erlang.cookie file on my slave to match the .erlang.cookie file on my 
master.   I restarted rabbitmq...even tried a total system reboot, but when 
i do this:

 rabbitmq-server -detached

I get this
Activating RabbitMQ plugins ...
0 plugins activated:

node with name "rabbit" already running on "ip-xx-xx-xxx-xxx"
diagnostics:
- nodes and their ports on ip-xx-xx-xxx-xxx: [{rabbit,52647},
                                              
{rabbitmqprelaunch13762,39547}]
- current node: 'rabbitmqprelaunch13762 at ip-xx-xx-xxx-xxx
- current node home dir: /var/lib/rabbitmq
- current node cookie hash: z+T5xm6diKG0nxAxdGqbVA==


But that is the old cookie hash, not the new one and I cannot get the 
clustering to work as a result.  Any ideas what I am doing wrong and/or 
need to do?

Thanks in advance everyone!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121002/1aff0728/attachment.htm>

From tim at rabbitmq.com  Tue Oct  2 16:17:22 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 2 Oct 2012 16:17:22 +0100
Subject: [rabbitmq-discuss] Heartbeat -> re-establish connection flow
	Question
In-Reply-To: <1348860873.98315930@apps.rackspace.com>
References: <1348860873.98315930@apps.rackspace.com>
Message-ID: <79D3A8B6-5FFC-46B1-8ED7-C3E6CEB536A5@rabbitmq.com>

Hi,

On 28 Sep 2012, at 20:34, m.luchak at smartasking.com wrote:

> Hi All,
>  
> We are running rabbitmq on Android and continue to have serious problems with maintaining a 3G tcp consumer connection.  We have implemented heartbeats but I am struggling to understand the flow to monitor and re-establish connections.  If I understand correctly:
>  
> Enabling heartbeats WITHOUT handling ShutdownSignalException would actually be counter productive as a number of missed heartbeats would close the connection.
>  
>  
> Is the "right way to do it" :
>  
> Enable heartbeats on the server
>  
> Setting (in Java) factory.setRequestedHeartbeat(HEARTBEAT_TIMEOUT);  will "auto-magically" enable      heartbeats on the client and no other call is neccessary to send heartbeats <- (big doubt here)
>  
> 

Yes, this is enough to set up heartbeats. The connection factory passes the heartbeat settings to the underlying connection, which in turn configures heartbeats. These are enabled on the client *and* the server, so that both ends can know about the other one going away unexpectedly. 

> Handle ShutdownSignalException cause and reconnect if it was a hard close..
>  
> 
> Does that sound about right?

Yep, that should do what you're after.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121002/5db7e6b6/attachment.htm>

From tim at rabbitmq.com  Tue Oct  2 16:19:09 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 2 Oct 2012 16:19:09 +0100
Subject: [rabbitmq-discuss] .erlang.cookie wont change for clustering
In-Reply-To: <a18dae94-4121-46f8-9358-6bde16f8cd6d@googlegroups.com>
References: <a18dae94-4121-46f8-9358-6bde16f8cd6d@googlegroups.com>
Message-ID: <F5777812-C533-4681-9143-9A66A5360CD5@rabbitmq.com>

Hi

Well, from the error message, I am going to guess.......

On 2 Oct 2012, at 15:32, Orion Fillmore wrote:

> Hello,
> 
> I am trying to get clustering set up for some rabbit mq servers.  I changed the .erlang.cookie file on my slave to match the .erlang.cookie file on my master.   I restarted rabbitmq...even tried a total system reboot, but when i do this:
> 
>  rabbitmq-server -detached
> 
> I get this
> Activating RabbitMQ plugins ...
> 0 plugins activated:
> 
> node with name "rabbit" already running on "ip-xx-xx-xxx-xxx"

This is saying that 'node ... "rabbit" [is] already running' - in other words your rabbit is *still* up and running with the old cookie. Shut it down properly with `rabbitmqctl stop` and then try again!

From orionfillmore at gmail.com  Tue Oct  2 17:06:44 2012
From: orionfillmore at gmail.com (Orion Fillmore)
Date: Tue, 2 Oct 2012 09:06:44 -0700 (PDT)
Subject: [rabbitmq-discuss] .erlang.cookie wont change for clustering
In-Reply-To: <a18dae94-4121-46f8-9358-6bde16f8cd6d@googlegroups.com>
References: <a18dae94-4121-46f8-9358-6bde16f8cd6d@googlegroups.com>
Message-ID: <d13f7f29-9a84-4e38-836a-acd9213049da@googlegroups.com>

Sorry I forgot to post my specs.

Box - Ubuntu 12.04
Rabbit - RabbitMQ 2.7.1
Admin - helpless:)

On Tuesday, October 2, 2012 9:32:51 AM UTC-5, Orion Fillmore wrote:
>
> Hello,
>
> I am trying to get clustering set up for some rabbit mq servers.  I 
> changed the .erlang.cookie file on my slave to match the .erlang.cookie 
> file on my master.   I restarted rabbitmq...even tried a total system 
> reboot, but when i do this:
>
>  rabbitmq-server -detached
>
> I get this
> Activating RabbitMQ plugins ...
> 0 plugins activated:
>
> node with name "rabbit" already running on "ip-xx-xx-xxx-xxx"
> diagnostics:
> - nodes and their ports on ip-xx-xx-xxx-xxx: [{rabbit,52647},
>                                               
> {rabbitmqprelaunch13762,39547}]
> - current node: 'rabbitmqprelaunch13762 at ip-xx-xx-xxx-xxx
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: z+T5xm6diKG0nxAxdGqbVA==
>
>
> But that is the old cookie hash, not the new one and I cannot get the 
> clustering to work as a result.  Any ideas what I am doing wrong and/or 
> need to do?
>
> Thanks in advance everyone!
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121002/3d6c828c/attachment.htm>

From tim at rabbitmq.com  Tue Oct  2 19:35:18 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 2 Oct 2012 19:35:18 +0100
Subject: [rabbitmq-discuss] .erlang.cookie wont change for clustering
In-Reply-To: <d13f7f29-9a84-4e38-836a-acd9213049da@googlegroups.com>
References: <a18dae94-4121-46f8-9358-6bde16f8cd6d@googlegroups.com>
	<d13f7f29-9a84-4e38-836a-acd9213049da@googlegroups.com>
Message-ID: <C032CF3C-FC3E-4CC5-97C1-B232B369BA7A@rabbitmq.com>

Perhaps my response didn't make sense, or you're only checking the google group, which is a bad idea as it's not an official one.

You *already have* a rabbit running - that's what the error message means. So you need to shut this down and restart it, at which point the new cookie will get picked up. `rabbitmqctl stop` first and then start rabbit using whatever mechanism you've used to start it in the past.

Cheers,
Tim  

On 2 Oct 2012, at 17:06, Orion Fillmore wrote:

> Sorry I forgot to post my specs.
> 
> Box - Ubuntu 12.04
> Rabbit - RabbitMQ 2.7.1
> Admin - helpless:)
> 
> On Tuesday, October 2, 2012 9:32:51 AM UTC-5, Orion Fillmore wrote:
> Hello,
> 
> I am trying to get clustering set up for some rabbit mq servers.  I changed the .erlang.cookie file on my slave to match the .erlang.cookie file on my master.   I restarted rabbitmq...even tried a total system reboot, but when i do this:
> 
>  rabbitmq-server -detached
> 
> I get this
> Activating RabbitMQ plugins ...
> 0 plugins activated:
> 
> node with name "rabbit" already running on "ip-xx-xx-xxx-xxx"
> diagnostics:
> - nodes and their ports on ip-xx-xx-xxx-xxx: [{rabbit,52647},
>                                               {rabbitmqprelaunch13762,39547}]
> - current node: 'rabbitmqprelaunch13762 at ip-xx-xx-xxx-xxx
> - current node home dir: /var/lib/rabbitmq
> - current node cookie hash: z+T5xm6diKG0nxAxdGqbVA==
> 
> 
> But that is the old cookie hash, not the new one and I cannot get the clustering to work as a result.  Any ideas what I am doing wrong and/or need to do?
> 
> Thanks in advance everyone!
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From gpothier at niclabs.cl  Tue Oct  2 19:58:23 2012
From: gpothier at niclabs.cl (Guillaume Pothier)
Date: Tue, 2 Oct 2012 14:58:23 -0400
Subject: [rabbitmq-discuss] Server memory leak with 2.8.6
In-Reply-To: <CA+T=oM31gDphx2UDVzfekBG+EzbhjwYXtc9onDAcUBJxvM0__A@mail.gmail.com>
References: <CA+T=oM0a1iCRkVuLa5zdZsMCE4cds=_n6cQQsAyqBeF8EK__XA@mail.gmail.com>
	<506320B4.1010000@rabbitmq.com>
	<CA+T=oM1xd1mG-mW6wtTvxT7CJast_=JfL+LMFOo9ENjCj2J0Yg@mail.gmail.com>
	<50641D7F.9080106@rabbitmq.com>
	<CA+T=oM31gDphx2UDVzfekBG+EzbhjwYXtc9onDAcUBJxvM0__A@mail.gmail.com>
Message-ID: <CA+T=oM0+WmcJgENm=Z9rjhC59htb+GDTa=vF2=5g1RhOPZypyA@mail.gmail.com>

Looks like it did the trick, memory usage has been steady since we did this
change. Thanks a lot for the help.
Regards,
g

On Thu, Sep 27, 2012 at 11:20 AM, Guillaume Pothier <gpothier at niclabs.cl>wrote:

> Thanks Emile, I will try with these stanzas and tell you how it goes.
> Regards,
> g
>
>
> On Thu, Sep 27, 2012 at 6:33 AM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>> Hi Guillaume,
>>
>> On 26/09/12 16:43, Guillaume Pothier wrote:
>> >     rabbitmqctl eval
>> >     'lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory),
>> >     Pid, process_info(Pid)} || Pid <- processes()])), 30).'
>>
>> From the output to this command that you sent me off-list it looks like
>> statistics are generated too fast for the management database to keep
>> up. Can I suggest that you turn off fine grained statistics (this will
>> disable display of message rates) by adding this stanza to the config
>> file:
>>
>>  {rabbitmq_management_agent, [{force_fine_statistics, false}]}
>>
>> and increase the statistics collection interval from 5000ms to higher
>> number and see if that helps:
>>
>>  {rabbit, [{collect_statistics_interval, 10000}]}
>>
>>
>>
>> -Emile
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121002/a956f14d/attachment.htm>

From aaron at agoragames.com  Tue Oct  2 22:09:23 2012
From: aaron at agoragames.com (Aaron Westendorf)
Date: Tue, 2 Oct 2012 17:09:23 -0400
Subject: [rabbitmq-discuss] pika 0.9.6 and Reconnection Strategies
In-Reply-To: <CAKwdTWcESvm1wdC0cMawFer3Kq_P6wCdf=Dz4oUjjgdiRiO0kg@mail.gmail.com>
References: <CAKwdTWcESvm1wdC0cMawFer3Kq_P6wCdf=Dz4oUjjgdiRiO0kg@mail.gmail.com>
Message-ID: <CALEq_A8-8OREpn+q8ta4Ko0M65+6gKJihuBA4zw4=ftC8QJ36Q@mail.gmail.com>

Gavin,

I came to the same conclusion in haigha and removed support for it. I
figured that a disconnect callback gave the user all they needed to
make the appropriate decision on what to do.  Moving this burden to
the user greatly simplified the code and tests.

-Aaron


On Fri, Sep 28, 2012 at 11:52 AM, Gavin M. Roy <gmr at meetme.com> wrote:
> Hi all,
>
> I'm trying to get 0.9.6 wrapped up and out the door (finally). If you're a
> Python developer and use Pika, I wanted to solicit your feedback.
>
> As I've been going through, adding tests and cleaning up the code, I've come
> to the opinion that Reconnection Strategies, at least in their current form
> are not very useful. There are a few reasons for this:
>
> 1) They do not restore state, meaning your application will still have to
> know when you are disconnected and it will have to reestablish all of the
> channels and if it's a consumer, re-issue any state based commands, such as
> Basic.Consume, Confirm.Select etc. If the ReconnectionStrategy classes could
> restore state, I'd see much more value in them.
>
> 2) As it is, the apps using the asynchronous adapters can listen for the
> connection close event and handle this on their own. Again if anyone was
> using the ReconnectionStrategy classes for re-establishing the connection,
> they would have to do the rest of the work this way, anyway.
>
> 3) BlockingConnection, which seems to be the most popular adapter, can not
> use them. Since it currently reimplements the connection closing to raise an
> exception when the connection is remotely closed or dropped, it could not
> expect the event to be fired. A design decision would have to be made to
> force users of BlockingConnection to use an callback for handling
> connections being closed in order to support reconnections strategies or
> keep it the way it is, which is a more pythonic approach.
>
> That being said, I am leaning towards dropping them as part of the core
> library. If I do this, I would include an example that re-implements the
> SimpleReconnectionStrategy class as a demo consumer that shows how to create
> a reconnectable consumer application.
>
> If you're a pika user, do you use the SRS or your own ReconnectionStrategy
> extended class? Are you in favor of removing it or keeping it?  If I end up
> going the route of removing it, it will mean I can get 0.9.6 out, possibly
> this weekend. Keeping it may mean another week or two.
>
> As a side note, 0.9.6pre1 is in the master branch on github and could use
> some testing outside of my environment. If you're interested and able, you
> can install it via pip install -e
> git+git://github.com/pika/pika.git#egg=pika-v0.9.6pre1
>
> Regards,
>
> Gavin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From gocanal at yahoo.com  Tue Oct  2 23:28:39 2012
From: gocanal at yahoo.com (go canal)
Date: Tue, 2 Oct 2012 15:28:39 -0700 (PDT)
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <1349216919.88554.YahooMailNeo@web45305.mail.sp1.yahoo.com>

http://allamericanrejects.org/wp-content/plugins/google.html?aoj=ge.mig&oemm=te.wrhg&yesol=akxs
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121002/c287c9a3/attachment.htm>

From wongkamhoong at gmail.com  Wed Oct  3 05:24:58 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Wed, 3 Oct 2012 12:24:58 +0800
Subject: [rabbitmq-discuss] Often failed to produce message due to
 TIMEOUT WAITING FOR ACK
In-Reply-To: <5062AC08.9060606@rabbitmq.com>
References: <CAHv8OSQS_QMK5e9binBCN1vsTepk7bpp2sBwG40umVOC00AdsA@mail.gmail.com>
	<50614FE4.3010105@rabbitmq.com>
	<CAHv8OSRtNX7Z+hPp072HRmv3QjV_+=-TX9hmgZ02+1zvBZJwaA@mail.gmail.com>
	<5062AC08.9060606@rabbitmq.com>
Message-ID: <CAHv8OSRSrbmBEK7nT9OXDV+29ftP0pVC-LSi7XsBFNGLnRYEDA@mail.gmail.com>

Hi Matthias,

Thanks for your advise, after I set the timeout to 1 minute the problem
gone, but 1 minute seems too long..

Regards,
Wong


On Wed, Sep 26, 2012 at 3:17 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Wong,
>
> On 26/09/12 07:18, Wong Kam Hoong wrote:
>
>> *_Master Node Usage_*
>>
>> Memory : 300M
>> CPU %  : Average 30%
>>
>> _*Slave Node Usage*_
>>
>> Memory : 130M
>> CPU %  : Average 30%
>>
>> there are only few messages during that time, e.g.
>> 2012-09-26 03:28:32 => 4 messages
>>
>
> If the CPU is averaging 30% when the load is so low then the machines must
> be doing something else too. I notice from...
>
>  =INFO REPORT==== 26-Sep-2012::03:29:37 ===
>> accepting AMQP connection <0.8897.18> (192.168.0.100:43836
>> <http://192.168.0.100:43836/> -> 192.168.0.100:5672
>> <http://192.168.0.100:5672/>)
>>
>
> ...that your clients are on the same machine as one of the nodes. Could it
> be that the machine was busy with other tasks, such as your application?
>
> Also, 3:29 in the morning is just the sort of time that I'd expect systems
> to run various housekeeping tasks which could hammer the CPU or disk. Those
> can result in significant delays, particularly when your messages
> persistent.
>
> I recommend increasing the timeout substantially, e.g. to 1 minute. That
> way if the problem really is just due to load it will go away.
>
>
>  Are you using mirrored/HA queues at all?
>> Yes, I'm using HA in all queues.
>>
>
> We are aware of two bugs in 2.8.x that can cause confirms to go missing.
> One of them involved setting an x-message-ttl=0 on queues and use of the
> 'immediate' flag on publish. So if you are doing that then, well, don't :).
> The 2nd issue involves (re)starting of nodes. So check whether any of the
> nodes in your cluster (re)started around the time of the problem.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121003/f86635c8/attachment.htm>

From thomas.spycher at tech.swisssign.com  Wed Oct  3 15:20:17 2012
From: thomas.spycher at tech.swisssign.com (Thomas Spycher)
Date: Wed, 3 Oct 2012 16:20:17 +0200
Subject: [rabbitmq-discuss] Messages bigger than 150kb
Message-ID: <88745725-61DC-4257-B354-CF6400B4B10B@tech.swisssign.com>

Hi

I'm new to RabbitMQ. I'm using RabbitMQ for an project which does some magic stuff with mails. An mail gets put into the queue on arrival and processed on other systems.
An Mail can be between some KB and several MB of size. later is not very often.
I've recognized, that the time to put the mail in the queue takes much longer if its passes the size of 150kb. Below it takes about 0.02 seconds and above more than 1.0 sec. I checked already the frame_size option with no effect. I'm pretty sure i'm doing something wrong. Any hint would be helpful.

Thanks

Tom

From Marek.Cermak at Honeywell.com  Wed Oct  3 15:38:10 2012
From: Marek.Cermak at Honeywell.com (Cermak, Marek)
Date: Wed, 3 Oct 2012 14:38:10 +0000
Subject: [rabbitmq-discuss] inconsistencies in amqp_client
Message-ID: <F1A539826FC33E4CA602BB52E5C450220F970FE7@FR44EX3004.global.ds.honeywell.com>

Hi,
we've found small inconsistency between amqp_client.hrl in public umbrella and in the distribution of amqp_client. One of the record is probably different:

-record(amqp_params_direct, {username = <<"guest">>, virtual_host = <<"/">>, node = node(), adapter_info = none, client_properties = []}).
vs
-record(amqp_params_direct, {username = <<"guest">>, password = none, virtual_host = <<"/">>, node = node(), adapter_info = none, client_properties = []}).

Is it possible? What is the correct version? Any chance it'll get corrected anyhow?

Thanks
Marek

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121003/58594c10/attachment.htm>

From tim at rabbitmq.com  Wed Oct  3 15:43:31 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 3 Oct 2012 15:43:31 +0100
Subject: [rabbitmq-discuss] inconsistencies in amqp_client
In-Reply-To: <F1A539826FC33E4CA602BB52E5C450220F970FE7@FR44EX3004.global.ds.honeywell.com>
References: <F1A539826FC33E4CA602BB52E5C450220F970FE7@FR44EX3004.global.ds.honeywell.com>
Message-ID: <45E8F16E-5BD6-4837-B9EE-963C892B6CAD@rabbitmq.com>

What revision of public-umbrella are you looking at? The default branch is not likely to stay the same as whatever revision a distributed version is based on for long.

On 3 Oct 2012, at 15:38, Cermak, Marek wrote:

> Hi,
> we've found small inconsistency between amqp_client.hrl in public umbrella and in the distribution of amqp_client. One of the record is probably different:
>  
> -record(amqp_params_direct, {username = <<"guest">>, virtual_host = <<"/">>, node = node(), adapter_info = none, client_properties = []}).
> vs
> -record(amqp_params_direct, {username = <<"guest">>, password = none, virtual_host = <<"/">>, node = node(), adapter_info = none, client_properties = []}).
>  
> Is it possible? What is the correct version? Any chance it'll get corrected anyhow?
>  
> Thanks
> Marek
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Wed Oct  3 15:50:50 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 03 Oct 2012 15:50:50 +0100
Subject: [rabbitmq-discuss] inconsistencies in amqp_client
In-Reply-To: <45E8F16E-5BD6-4837-B9EE-963C892B6CAD@rabbitmq.com>
References: <F1A539826FC33E4CA602BB52E5C450220F970FE7@FR44EX3004.global.ds.honeywell.com>
	<45E8F16E-5BD6-4837-B9EE-963C892B6CAD@rabbitmq.com>
Message-ID: <506C50CA.5060700@rabbitmq.com>

To be more specific, the first looks like 2.8.x, and the second like 
default. The correct version is whichever matches the release you're using.

If you want the hrl to go with the 2.8.7 release:

$ cd rabbitmq-erlang-client && hg update rabbitmq_v2_8_7

Cheers, Simon

On 03/10/12 15:43, Tim Watson wrote:
> What revision of public-umbrella are you looking at? The default
> branch is not likely to stay the same as whatever revision a
> distributed version is based on for long.
>
> On 3 Oct 2012, at 15:38, Cermak, Marek wrote:
>
>> Hi, we've found small inconsistency between amqp_client.hrl in
>> public umbrella and in the distribution of amqp_client. One of the
>> record is probably different:
>>
>> -record(amqp_params_direct, {username =<<"guest">>, virtual_host
>> =<<"/">>, node = node(), adapter_info = none, client_properties =
>> []}). vs -record(amqp_params_direct, {username =<<"guest">>,
>> password = none, virtual_host =<<"/">>, node = node(), adapter_info
>> = none, client_properties = []}).
>>
>> Is it possible? What is the correct version? Any chance it'll get
>> corrected anyhow?
>>
>> Thanks Marek
>>
>> _______________________________________________ rabbitmq-discuss
>> mailing list rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>>
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From ofillmore at sister.tv  Wed Oct  3 16:05:37 2012
From: ofillmore at sister.tv (Orion Fillmore)
Date: Wed, 3 Oct 2012 15:05:37 +0000
Subject: [rabbitmq-discuss] RabbitMQ won't install via apt on ubuntu 12.04
Message-ID: <7A7CB8ABC58AE1429A82854281DFDDAF0990E2D7@SiSTeRStream0.sisterprize0.sister.tv>

Hello,

First off, this is such an incredibly helpful list.  Thanks to everyone who has helped me along the way.

Ok, my current issue is that when I do a apt-get install per the rabbitmq.com install page, I get this error.   I check the s/var/log/rabbitmq/startup_log and /var/log/rabbitmq/startup_err and they give nothing more than timestamps with a success/fail message.  Nothing specific about whats going on.  So, I tried something else.  See after this code.

sudo apt-get install rabbitmq-server
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  rabbitmq-server
0 upgraded, 1 newly installed, 0 to remove and 4 not upgraded.
Need to get 2,903 kB of archives.
After this operation, 3,973 kB of additional disk space will be used.
Get:1 http://www.rabbitmq.com/debian/ testing/main rabbitmq-server all 2.8.7-1 [2,903 kB]
Fetched 2,903 kB in 2s (990 kB/s)
Selecting previously unselected package rabbitmq-server.
(Reading database ... 73370 files and directories currently installed.)
Unpacking rabbitmq-server (from .../rabbitmq-server_2.8.7-1_all.deb) ...
Processing triggers for ureadahead ...
Processing triggers for man-db ...
Setting up rabbitmq-server (2.8.7-1) ...
 * Starting message broker rabbitmq-server
 * FAILED - check /var/log/rabbitmq/startup_\{log, _err\}
   ...fail!
invoke-rc.d: initscript rabbitmq-server, action "start" failed.
dpkg: error processing rabbitmq-server (--configure):
 subprocess installed post-installation script returned error exit status 1
No apport report written because MaxReports is reached already
                                                              Errors were encountered while processing:
 rabbitmq-server
E: Sub-process /usr/bin/dpkg returned an error code (1)


Here is what I tried to get more info.
root at shinken:/var/lib# rabbitmqctl start_app
Starting node rabbit at shinken ...
Error: unable to connect to node rabbit at shinken: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at shinken]

hosts, their running nodes and ports:
- shinken: [{rabbit,50111},{rabbitmqctl5964,47436}]

current node details:
- node name: rabbitmqctl5964 at shinken
- home dir: /var/lib/rabbitmq
- cookie hash: JjTKXh2A74lrJZ3+meAaAA==

And I then ran this (same result)
root at shinken:/var/lib# rabbitmqctl status
Status of node rabbit at shinken ...
Error: unable to connect to node rabbit at shinken: nodedown

DIAGNOSTICS
===========

nodes in question: [rabbit at shinken]

hosts, their running nodes and ports:
- shinken: [{rabbit,50111},{rabbitmqctl6261,39404}]

current node details:
- node name: rabbitmqctl6261 at shinken
- home dir: /var/lib/rabbitmq
- cookie hash: JjTKXh2A74lrJZ3+meAaAA==


I have read through some threads and read some things about my hostname being resolved.  I checked my /etc/hosts and I have a line with 127.0.0.1 localhost and 127.0.0.1 shinken.
This config works on another box of mine.   Also, my /etc/hostnames file just says "rabbit".

What should I be looking to do?

Thanks in advance.



Orion Fillmore

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121003/40817548/attachment.htm>

From arun.horne at playfish.com  Wed Oct  3 16:22:33 2012
From: arun.horne at playfish.com (Arun Horne)
Date: Wed, 3 Oct 2012 16:22:33 +0100
Subject: [rabbitmq-discuss] Issue Creating Firehose Trace with rabbitmq_trace
Message-ID: <CACGTZZfyJfkJvup8HEj4nQqnKw_sJ+hfE_Z=XrgCX71DyJYxXA@mail.gmail.com>

Hello,

Rabbit Version: 2.8.2

I have created a new virtual host 'X', and a user with admin permissions
for it. I am logged into the admin too and go to 'Tracing' (as
rabbitmq_tracing plugin). I attempt to enable a new trace for virtual host
'X' and I see a message saying there has been an error and to check the
logs. The exact steps work for virtual host '/' but not my new virtual host
'X'. The logs show the following, can anyone point me in the right
direction please - I'm not sure why access is being refused.


>>>rabbit at localhost-sasl.log

=CRASH REPORT==== 3-Oct-2012::16:13:23 ===
  crasher:
    initial call: rabbit_tracing_consumer:init/1
    pid: <0.736.0>
    registered_name: []
    exception exit: {{badmatch,{error,access_refused}},
                     [{rabbit_tracing_consumer,init,1,[]},
                      {gen_server,init_it,6,
                                  [{file,"gen_server.erl"},{line,304}]},
                      {proc_lib,init_p_do_apply,3,
                                [{file,"proc_lib.erl"},{line,227}]}]}
      in function  gen_server:init_it/6 (gen_server.erl, line 328)
    ancestors: [<0.735.0>,rabbit_tracing_sup,<0.284.0>]
    messages: []
    links: [<0.735.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 377
    stack_size: 24
    reductions: 151
  neighbours:

=SUPERVISOR REPORT==== 3-Oct-2012::16:13:23 ===
     Supervisor: {<0.735.0>,
                                           rabbit_tracing_consumer_sup}
     Context:    start_error
     Reason:     {{badmatch,{error,access_refused}},
                  [{rabbit_tracing_consumer,init,1,[]},

 {gen_server,init_it,6,[{file,"gen_server.erl"},{line,304}]},
                   {proc_lib,init_p_do_apply,3,
                             [{file,"proc_lib.erl"},{line,227}]}]}
     Offender:   [{pid,undefined},
                  {name,consumer},
                  {mfa,
                      {rabbit_tracing_consumer,start_link,
                          [[{vhost,<<"fbcache">>},
                            {name,<<"Mytrac1">>},
                            {format,<<"text">>},
                            {pattern,<<"#">>}]]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]




Thanks in advance,
Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121003/2d89761c/attachment.htm>

From simon at rabbitmq.com  Wed Oct  3 16:50:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 03 Oct 2012 16:50:41 +0100
Subject: [rabbitmq-discuss] Issue Creating Firehose Trace with
	rabbitmq_trace
In-Reply-To: <CACGTZZfyJfkJvup8HEj4nQqnKw_sJ+hfE_Z=XrgCX71DyJYxXA@mail.gmail.com>
References: <CACGTZZfyJfkJvup8HEj4nQqnKw_sJ+hfE_Z=XrgCX71DyJYxXA@mail.gmail.com>
Message-ID: <506C5ED1.4000609@rabbitmq.com>

On 03/10/12 16:22, Arun Horne wrote:
> Hello,
>
> Rabbit Version: 2.8.2
>
> I have created a new virtual host 'X', and a user with admin permissions
> for it. I am logged into the admin too and go to 'Tracing' (as
> rabbitmq_tracing plugin). I attempt to enable a new trace for virtual
> host 'X' and I see a message saying there has been an error and to check
> the logs. The exact steps work for virtual host '/' but not my new
> virtual host 'X'. The logs show the following, can anyone point me in
> the right direction please - I'm not sure why access is being refused.

Hmm, this is maybe not very well documented. The rabbitmq_tracing plugin 
needs a user to use to publish the messages that it uses internally. If 
you haven't told it otherwise, it will use "guest". If "guest" won't 
work, you'll need to add something like:

{rabbitmq_tracing, [{username, <<"my-user">>}]},

to your config.

http://hg.rabbitmq.com/rabbitmq-tracing/file/859ae4fb4875/README

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From Prabodh.Upreti at vce.com  Wed Oct  3 16:06:41 2012
From: Prabodh.Upreti at vce.com (Upreti, Prabodh)
Date: Wed, 3 Oct 2012 11:06:41 -0400
Subject: [rabbitmq-discuss] share a pre-built queue
Message-ID: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>

Hello

I have 5 pre-built queues with specific routing keys.  I may have 20 consumers consuming these queues.  My problem is if I have 5 consumers bound to a queue they all get a message in a round robin fashion.  I would like to be able to provide the same message to those 5 consumers.  Is there a way to do this?  I do know that if I create 5 more queues with the same routing keys and assign it to each consumer, they will all receive that message.

I don't want to do that because then I have to maintain too many queues.  I have to make sure to bind the consumer with the right queue etc.

I would appreciate any input.  thank you.

regards
pu

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121003/09e00526/attachment.htm>

From emile at rabbitmq.com  Wed Oct  3 17:07:00 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 03 Oct 2012 17:07:00 +0100
Subject: [rabbitmq-discuss] RabbitMQ won't install via apt on ubuntu
	12.04
In-Reply-To: <7A7CB8ABC58AE1429A82854281DFDDAF0990E2D7@SiSTeRStream0.sisterprize0.sister.tv>
References: <7A7CB8ABC58AE1429A82854281DFDDAF0990E2D7@SiSTeRStream0.sisterprize0.sister.tv>
Message-ID: <506C62A4.900@rabbitmq.com>

Hi,

On 03/10/12 16:05, Orion Fillmore wrote:
>  * FAILED - check /var/log/rabbitmq/startup_\{log, _err\}

The reason for the failure should be in one of the startup logfiles, but
you should check the other broker logfiles in the same folder as well.

> - shinken: [{rabbit,50111},{rabbitmqctl5964,47436}]
> - shinken: [{rabbit,50111},{rabbitmqctl6261,39404}]

These indicate that you already have a broker running. You should shut
the old broker down first. If you want to run multiple brokers on the
same host then made sure at least the node names and the listening ports
are different.


-Emile



From arun.horne at playfish.com  Wed Oct  3 17:01:38 2012
From: arun.horne at playfish.com (Arun Horne)
Date: Wed, 3 Oct 2012 17:01:38 +0100
Subject: [rabbitmq-discuss] Issue Creating Firehose Trace with
	rabbitmq_trace
In-Reply-To: <506C5ED1.4000609@rabbitmq.com>
References: <CACGTZZfyJfkJvup8HEj4nQqnKw_sJ+hfE_Z=XrgCX71DyJYxXA@mail.gmail.com>
	<506C5ED1.4000609@rabbitmq.com>
Message-ID: <CACGTZZc=V5OwkKOcRPBdR5VkNgyr1J_8aBqu9uBkc+S_ep3aLQ@mail.gmail.com>

Hi Simon,

That worked perfectly - many thanks!

Arun

On 3 October 2012 16:50, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 03/10/12 16:22, Arun Horne wrote:
>
>> Hello,
>>
>> Rabbit Version: 2.8.2
>>
>> I have created a new virtual host 'X', and a user with admin permissions
>> for it. I am logged into the admin too and go to 'Tracing' (as
>> rabbitmq_tracing plugin). I attempt to enable a new trace for virtual
>> host 'X' and I see a message saying there has been an error and to check
>> the logs. The exact steps work for virtual host '/' but not my new
>> virtual host 'X'. The logs show the following, can anyone point me in
>> the right direction please - I'm not sure why access is being refused.
>>
>
> Hmm, this is maybe not very well documented. The rabbitmq_tracing plugin
> needs a user to use to publish the messages that it uses internally. If you
> haven't told it otherwise, it will use "guest". If "guest" won't work,
> you'll need to add something like:
>
> {rabbitmq_tracing, [{username, <<"my-user">>}]},
>
> to your config.
>
> http://hg.rabbitmq.com/**rabbitmq-tracing/file/**859ae4fb4875/README<http://hg.rabbitmq.com/rabbitmq-tracing/file/859ae4fb4875/README>
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121003/a9d39c4c/attachment.htm>

From m.luchak at smartasking.com  Wed Oct  3 17:34:14 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Wed, 3 Oct 2012 12:34:14 -0400 (EDT)
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
Message-ID: <1349282054.40457807@apps.rackspace.com>


Hi Pu,
 
If you want to be able to simply and efficiently modify and update the bindings and have all consumers receive all msgs then I would suggest you create an "exchange to exchange" bind with the binding keys that you require (only need to modify the keys in this one bind) and bind your consumers to this exchange with temporary queues...
 
Matthew
 
-----Original Message-----
From: "Upreti, Prabodh" <Prabodh.Upreti at vce.com>
Sent: Wednesday, October 3, 2012 11:06am
To: "rabbitmq-discuss at lists.rabbitmq.com" <rabbitmq-discuss at lists.rabbitmq.com>
Subject: [rabbitmq-discuss] share a pre-built queue




Hello 
 
I have 5 pre-built queues with specific routing keys.  I may have 20 consumers consuming these queues.  My problem is if I have 5 consumers bound to a queue they all get a message in a round robin fashion.  I would like to be able to provide the same message to those 5 consumers.  Is there a way to do this?  I do know that if I create 5 more queues with the same routing keys and assign it to each consumer, they will all receive that message. 
 
I don't want to do that because then I have to maintain too many queues.  I have to make sure to bind the consumer with the right queue etc.
 
I would appreciate any input.  thank you.
 
regards
pu
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121003/cc3ce17f/attachment.htm>

From watson.timothy at gmail.com  Wed Oct  3 17:35:50 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 3 Oct 2012 17:35:50 +0100
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
Message-ID: <1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>

Take a look at http://rabbitmq.com/tutorials/tutorial-three-python.html

On 3 Oct 2012, at 16:06, "Upreti, Prabodh" <Prabodh.Upreti at vce.com> wrote:

> Hello
>  
> I have 5 pre-built queues with specific routing keys.  I may have 20 consumers consuming these queues.  My problem is if I have 5 consumers bound to a queue they all get a message in a round robin fashion.  I would like to be able to provide the same message to those 5 consumers.  Is there a way to do this?  I do know that if I create 5 more queues with the same routing keys and assign it to each consumer, they will all receive that message.  
>  
> I don't want to do that because then I have to maintain too many queues.  I have to make sure to bind the consumer with the right queue etc.
>  
> I would appreciate any input.  thank you.
>  
> regards
> pu
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121003/14c78011/attachment.htm>

From watson.timothy at gmail.com  Wed Oct  3 17:47:24 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 3 Oct 2012 17:47:24 +0100
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
	<1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>
Message-ID: <5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>

Sorry I missed the bit about binding keys. Probably not what you want then .....

On 3 Oct 2012, at 17:35, Tim Watson <watson.timothy at gmail.com> wrote:

> Take a look at http://rabbitmq.com/tutorials/tutorial-three-python.html
> 
> On 3 Oct 2012, at 16:06, "Upreti, Prabodh" <Prabodh.Upreti at vce.com> wrote:
> 
>> Hello
>>  
>> I have 5 pre-built queues with specific routing keys.  I may have 20 consumers consuming these queues.  My problem is if I have 5 consumers bound to a queue they all get a message in a round robin fashion.  I would like to be able to provide the same message to those 5 consumers.  Is there a way to do this?  I do know that if I create 5 more queues with the same routing keys and assign it to each consumer, they will all receive that message.  
>>  
>> I don't want to do that because then I have to maintain too many queues.  I have to make sure to bind the consumer with the right queue etc.
>>  
>> I would appreciate any input.  thank you.
>>  
>> regards
>> pu
>>  
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121003/1cdf15d9/attachment.htm>

From watson.timothy at gmail.com  Wed Oct  3 17:57:51 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 3 Oct 2012 17:57:51 +0100
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
	<1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>
	<5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>
Message-ID: <E66D7093-DBAF-4A34-BF67-2C2923D0D744@rabbitmq.com>

Trigger happy send key on the iPhone, sorry. What I was thinking is that sounds like a problem for topics, which is actually tutorial 5.

On 3 Oct 2012, at 17:47, Tim Watson <watson.timothy at gmail.com> wrote:

> Sorry I missed the bit about binding keys. Probably not what you want then .....
> 
> On 3 Oct 2012, at 17:35, Tim Watson <watson.timothy at gmail.com> wrote:
> 
>> Take a look at http://rabbitmq.com/tutorials/tutorial-three-python.html
>> 
>> On 3 Oct 2012, at 16:06, "Upreti, Prabodh" <Prabodh.Upreti at vce.com> wrote:
>> 
>>> Hello
>>>  
>>> I have 5 pre-built queues with specific routing keys.  I may have 20 consumers consuming these queues.  My problem is if I have 5 consumers bound to a queue they all get a message in a round robin fashion.  I would like to be able to provide the same message to those 5 consumers.  Is there a way to do this?  I do know that if I create 5 more queues with the same routing keys and assign it to each consumer, they will all receive that message.  
>>>  
>>> I don't want to do that because then I have to maintain too many queues.  I have to make sure to bind the consumer with the right queue etc.
>>>  
>>> I would appreciate any input.  thank you.
>>>  
>>> regards
>>> pu
>>>  
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121003/0c4b7812/attachment.htm>

From matthias at rabbitmq.com  Wed Oct  3 18:07:52 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 03 Oct 2012 18:07:52 +0100
Subject: [rabbitmq-discuss] Messages bigger than 150kb
In-Reply-To: <88745725-61DC-4257-B354-CF6400B4B10B@tech.swisssign.com>
References: <88745725-61DC-4257-B354-CF6400B4B10B@tech.swisssign.com>
Message-ID: <506C70E8.6000501@rabbitmq.com>

Thomas,

On 03/10/12 15:20, Thomas Spycher wrote:
> I've recognized, that the time to put the mail in the queue takes
> much longer if its passes the size of 150kb. Below it takes about
> 0.02 seconds and above more than 1.0 sec. I checked already the
> frame_size option with no effect.

What client are you using?
What version of the RabbitMQ server are you using?
How did you measure the times above?

Regards,

Matthias.

From prabodh.upreti at vce.com  Wed Oct  3 21:37:00 2012
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Wed, 3 Oct 2012 13:37:00 -0700 (PDT)
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <E66D7093-DBAF-4A34-BF67-2C2923D0D744@rabbitmq.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
	<1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>
	<5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>
	<E66D7093-DBAF-4A34-BF67-2C2923D0D744@rabbitmq.com>
Message-ID: <1349296620851-22327.post@n5.nabble.com>

Tim,

Thanks for the response. Yes, I am using a topic exchange and routing keys
as describes in the manual.  Only thing I am doing different is pre-creating
the queues and letting the consumers bind to those queues.  I have looked at
a lot of threads and docs and can't find a way to solve this problem in a
simple way.  

thank you.





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/share-a-pre-built-queue-tp22319p22327.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Wed Oct  3 22:05:21 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 03 Oct 2012 22:05:21 +0100
Subject: [rabbitmq-discuss] Often failed to produce message due to
 TIMEOUT WAITING FOR ACK
In-Reply-To: <CAHv8OSRSrbmBEK7nT9OXDV+29ftP0pVC-LSi7XsBFNGLnRYEDA@mail.gmail.com>
References: <CAHv8OSQS_QMK5e9binBCN1vsTepk7bpp2sBwG40umVOC00AdsA@mail.gmail.com>
	<50614FE4.3010105@rabbitmq.com>
	<CAHv8OSRtNX7Z+hPp072HRmv3QjV_+=-TX9hmgZ02+1zvBZJwaA@mail.gmail.com>
	<5062AC08.9060606@rabbitmq.com>
	<CAHv8OSRSrbmBEK7nT9OXDV+29ftP0pVC-LSi7XsBFNGLnRYEDA@mail.gmail.com>
Message-ID: <506CA891.2070907@rabbitmq.com>

Wong,

On 03/10/12 05:24, Wong Kam Hoong wrote:
> Thanks for your advise, after I set the timeout to 1 minute the problem
> gone, but 1 minute seems too long..

Well yes, but the point of setting the timeout to 1 minute was to check 
that there isn't a more fundamental problem, like the confirms not being 
received at all.

Is a 1 minute timeout actually causing a problem for you, bearing in 
mind that, as seems to be the case, most of the time the confirm arrives 
a lot quicker?

If it really does bother you then I suggest you start recording some 
data on the basic resource usage of your system - CPU, memory, disk, 
etc, and see whether there is any correlation with confirm times.


Regards,

Matthias.

From brett.r.cameron at gmail.com  Wed Oct  3 22:07:05 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Thu, 4 Oct 2012 10:07:05 +1300
Subject: [rabbitmq-discuss] RabbitHub
Message-ID: <CALPqkiqCwFcXQm6VSsj=7rSmn-xCkVN56C3goRjA9fh6w0gPog@mail.gmail.com>

For anyone interested in publishing or consuming messages via HTTP, the
RabbitHub plugin has been updated to work with the latest versions of
RabbitMQ (tested with 2.8.4 and higher). Many thanks to Tony for patiently
merging (and fixing where necessary) my changes.



You can download the sources from https://github.com/tonyg/rabbithub, or
grab the binary ez file at
http://commondatastorage.googleapis.com/opensourceprojects/RabbitMQ/rabbithub.ez.
There are some brief notes about the plugin at
http://rabbitmqonopenvs.blogspot.com.au/, and a few details on installing
and using it can be found at
http://commondatastorage.googleapis.com/opensourceprojects/RabbitMQ/RabbitHub.pdf.



Regards,

Brett
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/df28446b/attachment.htm>

From matthias at rabbitmq.com  Wed Oct  3 22:24:50 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 03 Oct 2012 22:24:50 +0100
Subject: [rabbitmq-discuss] Proper protocol for dealing with crash dumps?
In-Reply-To: <20121002140903.GD65786@bloaty>
References: <20120929132049.GA88595@bloaty> <50680EE6.6050301@rabbitmq.com>
	<20121002140903.GD65786@bloaty>
Message-ID: <506CAD22.5030305@rabbitmq.com>

Alex,

On 02/10/12 15:09, Alex Zepeda wrote:
> =erl_crash_dump:0.1
> Fri Sep 28 20:38:32 2012
> Slogan: eheap_alloc: Cannot allocate 747325720 bytes of memory (of type "heap").
> System version: Erlang R13B03 (erts-5.7.4) [source] [64-bit] [smp:4:4] [rq:4] [async-threads:30] [hipe] [kernel-poll:true]
> Compiled: Fri Sep 24 19:15:42 2010
>
> Nothing else should be using a lot of memory,

"should" - you may want to check that ;)

Mind you, the above is trying to allocate 740MB - does that seem 
reasonable for your rabbit?

> unless there have been memory leaks fixed since R13B03 + 2.8.6?

R13B03 is ancient, and countless bugs have been fixed since then, 
including memory leaks. Though, tbh, it's not the first place I'd look. 
Rabbit 2.8.7 plugs some leaks, but they were confined to HA queues (see 
the release notes for more details), so unless you are using those then 
upgrading won't help.

Have you changed the memory watermark settings of rabbit at all? If not 
then rabbit really shouldn't run out of memory unless another program is 
stealing the memory, or your app is creating lots of exchanges, queues 
or bindings. Or lots of connections. Or you are using some exotic 
plug-ins with hitherto undiscovered bugs. In all those cases, grabbing 
the output of 'rabbitmqctl report' before rabbit dies should offer some 
clues.

Regards,

Matthias.

From wongkamhoong at gmail.com  Wed Oct  3 22:56:05 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Thu, 4 Oct 2012 05:56:05 +0800
Subject: [rabbitmq-discuss] Statistics database could not be contacted.
 Message rates and queue lengths will not be shown.
Message-ID: <CAHv8OSQ7UJ9L_s+rLJaJeMJ_v8LNcLvkWorotrhSCi1JX=nWYg@mail.gmail.com>

Hi RabbitMQ  team,

Recently I upgrade my rabbitmq nodes with the latest version 2.8.7, but i
saw weird message show on the web admin page:

"Statistics database could not be contacted. Message rates and queue
lengths will not be shown."

I not able to see any statistic such as current produce/consume rate, and
how many messages in each queue.

Please advise how can i enable back the statistic.

Regards,
Wong
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/2b8bd0ed/attachment.htm>

From watson.timothy at gmail.com  Thu Oct  4 06:56:08 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 4 Oct 2012 06:56:08 +0100
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <1349296620851-22327.post@n5.nabble.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
	<1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>
	<5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>
	<E66D7093-DBAF-4A34-BF67-2C2923D0D744@rabbitmq.com>
	<1349296620851-22327.post@n5.nabble.com>
Message-ID: <10C8AE39-4224-4026-806D-B93419923B55@rabbitmq.com>

Prabodh,

Please keep the list on cc.

On 3 Oct 2012, at 21:37, Prabodh Upreti <prabodh.upreti at vce.com> wrote:

> Tim,
> 
> Thanks for the response. Yes, I am using a topic exchange and routing keys
> as describes in the manual.  Only thing I am doing different is pre-creating
> the queues and letting the consumers bind to those queues.  I have looked at
> a lot of threads and docs and can't find a way to solve this problem in a
> simple way.  
> 

Is there a problem creating a new temporary queue for each client and binding this to the topic exchange using the routing keys that client cares about? I can't imagine you'd do anything dissimilar with another messaging stack (like jms) but perhaps I'm missing something.

What you get with this approach is zero queue maintainable overhead, as the client declares an anonymous, temporary queue that lasts only for the duration of that client's session. The only thing that needs to be pre-built is the exchange, but of course instead of the clients knowing the queue name(s) they know the routing/binding keys instead.

> thank you.
> 
> 
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/share-a-pre-built-queue-tp22319p22327.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From watson.timothy at gmail.com  Thu Oct  4 07:02:57 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 4 Oct 2012 07:02:57 +0100
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <10C8AE39-4224-4026-806D-B93419923B55@rabbitmq.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
	<1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>
	<5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>
	<E66D7093-DBAF-4A34-BF67-2C2923D0D744@rabbitmq.com>
	<1349296620851-22327.post@n5.nabble.com>
	<10C8AE39-4224-4026-806D-B93419923B55@rabbitmq.com>
Message-ID: <BF222C64-132D-4DC0-BACE-A0BABBB8A3D2@rabbitmq.com>

On 4 Oct 2012, at 06:56, Tim Watson <watson.timothy at gmail.com> wrote:

> Prabodh,
> 
> Please keep the list on cc.
> 

I meant the correct list - the google group is not ours and we don't post to it. Please try and stick to the official mailing list if possible, thanks.


From yhtonline at gmail.com  Thu Oct  4 04:10:05 2012
From: yhtonline at gmail.com (Hongtao)
Date: Wed, 3 Oct 2012 20:10:05 -0700 (PDT)
Subject: [rabbitmq-discuss] How can we stop rpcserver gracefully?
Message-ID: <9bff4849-4fcb-44e8-a78d-bacd8ce64705@googlegroups.com>




we are using rabbitmq rpc in java, and using jdk threadpool as following:

ExecutorService *es* = Executors.newFixedThreadPool(20);
Connection conn = factory.newConnection(*es*);
....

but, for shtutting down rpc server,  how can we make sure all messages have been dealt with, and no msg lost.
we want a graceful shutdown process, seems no document talking about that.
if we call:
execService.shutdown();

Consumer.handleDelivery will not be triggerred then?

Anyone can help will be very appreciated..

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121003/38f105da/attachment.htm>

From dev440 at gmail.com  Thu Oct  4 07:36:03 2012
From: dev440 at gmail.com (chetan dev)
Date: Thu, 4 Oct 2012 12:06:03 +0530
Subject: [rabbitmq-discuss] Acknowledged
Message-ID: <CAB0ZxM5ktX9iC17zKPZwOBrqdZOrO05t+rfUege6Cwrf06cw0A@mail.gmail.com>

Hi

I am new to rabbitmq so struggling with it initially
can any body tell me how to use acknowledgement functionality for publisher
confirmation and consumer confirmation



Thanks

-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/8cb4450c/attachment.htm>

From dev440 at gmail.com  Thu Oct  4 09:19:52 2012
From: dev440 at gmail.com (chetan dev)
Date: Thu, 4 Oct 2012 13:49:52 +0530
Subject: [rabbitmq-discuss] Acknowledged
In-Reply-To: <CAB0ZxM5ktX9iC17zKPZwOBrqdZOrO05t+rfUege6Cwrf06cw0A@mail.gmail.com>
References: <CAB0ZxM5ktX9iC17zKPZwOBrqdZOrO05t+rfUege6Cwrf06cw0A@mail.gmail.com>
Message-ID: <CAB0ZxM76QV_OR1L4CqYE0rwQqZu_nk=w5GJmtw3snY=Jz2RBGg@mail.gmail.com>

HI,

while handling basicack event , the event is getting fired more number of
times that number of message published to queue
can some one please tell me about this behaviour?

On Thu, Oct 4, 2012 at 12:06 PM, chetan dev <dev440 at gmail.com> wrote:

> Hi
>
> I am new to rabbitmq so struggling with it initially
> can any body tell me how to use acknowledgement functionality for
> publisher confirmation and consumer confirmation
>
>
>
> Thanks
>
> --
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
>
>


-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/5f7ed06b/attachment.htm>

From thomas.spycher at tech.swisssign.com  Thu Oct  4 09:22:47 2012
From: thomas.spycher at tech.swisssign.com (Thomas Spycher)
Date: Thu, 4 Oct 2012 10:22:47 +0200
Subject: [rabbitmq-discuss] Messages bigger than 150kb
In-Reply-To: <506C70E8.6000501@rabbitmq.com>
References: <88745725-61DC-4257-B354-CF6400B4B10B@tech.swisssign.com>
	<506C70E8.6000501@rabbitmq.com>
Message-ID: <C9EDA46C-DECC-4088-B8DD-CE3DE2CB0629@tech.swisssign.com>

Hi Matthias

Thanks for reply! 

On Oct 3, 2012, at 19:07 , Matthias Radestock <matthias at rabbitmq.com> wrote:

> Thomas,
> 
> On 03/10/12 15:20, Thomas Spycher wrote:
>> I've recognized, that the time to put the mail in the queue takes
>> much longer if its passes the size of 150kb. Below it takes about
>> 0.02 seconds and above more than 1.0 sec. I checked already the
>> frame_size option with no effect.
> 
> What client are you using?
Python with the latest pika Library

> What version of the RabbitMQ server are you using?
RabbitMQ 2.8.6 on Erlang R15B02 on OSX

> How did you measure the times above?
Something like that:

timeStart = time.time()

self.rpcchannel.basic_publish(exchange='', routing_key='secureObjects', properties=pika.BasicProperties(reply_to=self.rpcqueue , correlation_id=self._correlation_id,content_type="text/plain",delivery_mode=2), body=serializedObject)

print time.time() - timeStart

while self.response is None:
	
self.connection.process_data_events()
		
return self.response
> 
> Regards,
> 
> Matthias.



From JSwainston at SportingIndex.com  Thu Oct  4 09:32:24 2012
From: JSwainston at SportingIndex.com (Jim Swainston)
Date: Thu, 4 Oct 2012 09:32:24 +0100
Subject: [rabbitmq-discuss] Access Refused
Message-ID: <556325346CA26341B6F0530E07F90D96016C6812CB0C@GBGH-EXCH-CMS.sig.ads>

Hi

Could someone please help me. I have a user who keeps getting the following error message...
'Server channel error: 403, message: ACCESS_REFUSED - access to queue 'amq.gen-gx1n4EQIgnm7NVZlwZI2e5' in vhost '/blah' refused for user 'username''
What's weird is that if I use the same client code and same user credentials (from a different location) I connect fine. They have assured me that port 5672 is open.
Does anyone have any suggestions or explanation for this behaviour.

Thanks

Jim
**********************************************************************
This email and any attachments are confidential, protected by copyright and may be legally privileged.  If you are not the intended recipient, then the dissemination or copying of this email is prohibited. If you have received this in error, please notify the sender by replying by email and then delete the email completely from your system.  Neither Sporting Index nor the sender accepts responsibility for any virus, or any other defect which might affect any computer or IT system into which the email is received and/or opened.  It is the responsibility of the recipient to scan the email and no responsibility is accepted for any loss or damage arising in any way from receipt or use of this email.  Sporting Index Ltd is a company registered in England and Wales with company number 2636842, whose registered office is at Gateway House, Milverton Street, London, SE11 4AP.  Sporting Index Ltd is authorised and regulated by the UK Financial Services Authority (reg. no. 150404) and Gambling Commission (reg. no. 000-027343-R-308898-001).  Any financial promotion contained herein has been issued 
and approved by Sporting Index Ltd.

Outbound email has been scanned for viruses and SPAM
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/383374cb/attachment.htm>

From langalaxy at gmail.com  Thu Oct  4 09:34:04 2012
From: langalaxy at gmail.com (Christoph)
Date: Thu, 4 Oct 2012 01:34:04 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ production ready in Windows
In-Reply-To: <e8aa15e4-c760-4904-8e55-93bca3df4ef9@googlegroups.com>
References: <e8aa15e4-c760-4904-8e55-93bca3df4ef9@googlegroups.com>
Message-ID: <f32ceb09-f115-457a-b778-732958bb5e89@googlegroups.com>

Yes - without any problems (Windows 2008 R2)

On Monday, October 1, 2012 11:42:20 AM UTC+2, R??acki Krzysztof wrote:
>
> Hi,
>
> I'm trying to introduce RabbitMQ as our backbone messaging service. My 
> first basic question is whether RabbitMQ is used in production on Windows 
> server from 2003 onwards ?
>
> Thank you
>
> Chris
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/e875a73d/attachment.htm>

From michael.s.klishin at gmail.com  Thu Oct  4 09:50:00 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 4 Oct 2012 12:50:00 +0400
Subject: [rabbitmq-discuss] Messages bigger than 150kb
In-Reply-To: <C9EDA46C-DECC-4088-B8DD-CE3DE2CB0629@tech.swisssign.com>
References: <88745725-61DC-4257-B354-CF6400B4B10B@tech.swisssign.com>
	<506C70E8.6000501@rabbitmq.com>
	<C9EDA46C-DECC-4088-B8DD-CE3DE2CB0629@tech.swisssign.com>
Message-ID: <CAE3HoVT61FtUSLyjJFw_pmeq6v4JNFiOxsdU6azFwAs-UQG=gg@mail.gmail.com>

2012/10/4 Thomas Spycher <thomas.spycher at tech.swisssign.com>

> timeStart = time.time()
>
> self.rpcchannel.basic_publish(exchange='', routing_key='secureObjects',
> properties=pika.BasicProperties(reply_to=self.rpcqueue ,
> correlation_id=self._correlation_id,content_type="text/plain",delivery_mode=2),
> body=serializedObject)
>
> print time.time() - timeStart
>

This does not measure actual end-to-end throughput, only how fast Pika can
push things down the socket.
In that case, of course more data will take more time. In fact, Pika may
even delay sending the data
(I am not familiar with its internals but it is event loop-based AFAIR).

So what you are seeing is most likely Pika's internal buffer being
completely filled once you go above 150K,
in which case it has to do extra work, unlike with tiny messages. The same
can be true for buffers in layers below (OS does buffering for network I/O,
drivers may do that, etc).

When benchmarking a messaging system throughput, you need to do it
end-to-end, with [at least] 2 machines, a realistic
network link between them and understanding about how exactly your client
does publishing.

TCP settings like Nagle's algorithm [1] and phenomenons like TCP incast [2]
can make a noticeable difference in some cases.

1.
http://boundary.com/blog/2012/05/02/know-a-delay-nagles-algorithm-and-you/
2. http://www.snookles.com/slf-blog/2012/01/05/tcp-incast-what-is-it/
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/492ff75f/attachment.htm>

From emile at rabbitmq.com  Thu Oct  4 10:07:12 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 04 Oct 2012 10:07:12 +0100
Subject: [rabbitmq-discuss] Acknowledged
In-Reply-To: <CAB0ZxM76QV_OR1L4CqYE0rwQqZu_nk=w5GJmtw3snY=Jz2RBGg@mail.gmail.com>
References: <CAB0ZxM5ktX9iC17zKPZwOBrqdZOrO05t+rfUege6Cwrf06cw0A@mail.gmail.com>
	<CAB0ZxM76QV_OR1L4CqYE0rwQqZu_nk=w5GJmtw3snY=Jz2RBGg@mail.gmail.com>
Message-ID: <506D51C0.9040204@rabbitmq.com>

Hi,

On 04/10/12 09:19, chetan dev wrote:
> while handling basicack event , the event is getting fired more number
> of times that number of message published to queue
> can some one please tell me about this behaviour?

You should be able to match up the delivery-tag in each ack with a
published message. In what way exactly does this fail? Can you provide
some tracing output to support your claim that too many basic.ack
messages are sent by the broker?


-Emile

From emile at rabbitmq.com  Thu Oct  4 10:16:31 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 04 Oct 2012 10:16:31 +0100
Subject: [rabbitmq-discuss] Access Refused
In-Reply-To: <556325346CA26341B6F0530E07F90D96016C6812CB0C@GBGH-EXCH-CMS.sig.ads>
References: <556325346CA26341B6F0530E07F90D96016C6812CB0C@GBGH-EXCH-CMS.sig.ads>
Message-ID: <506D53EF.6000505@rabbitmq.com>

Hi Jim,

On 04/10/12 09:32, Jim Swainston wrote:
> *'Server channel error: 403, message: ACCESS_REFUSED - access to queue

Have you checked the permissions for the user by comparing the details
at http://www.rabbitmq.com/access-control.html with the output from
"rabbitmqctl list_permissions"? Which authentication provider are you using?

Permissions should not be affected by the location you connect from, so
check the network topology and make sure you are connecting to the
correct broker.


-Emile

From emile at rabbitmq.com  Thu Oct  4 10:30:10 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 04 Oct 2012 10:30:10 +0100
Subject: [rabbitmq-discuss] How can we stop rpcserver gracefully?
In-Reply-To: <9bff4849-4fcb-44e8-a78d-bacd8ce64705@googlegroups.com>
References: <9bff4849-4fcb-44e8-a78d-bacd8ce64705@googlegroups.com>
Message-ID: <506D5722.6070603@rabbitmq.com>

Hi,

On 04/10/12 04:10, Hongtao wrote:
> but, for shtutting down rpc server,  how can we make sure all
> messages have been dealt with, and no msg lost. we want a graceful
> shutdown process, seems no document talking about that.
> 
> if we call: execService.shutdown();
> 
> Consumer.handleDelivery will not be triggerred then?

If you make sure not to acknowledge RPC requests until after sending the
RPC reply then message will not be lost, even if you shut down the RPC
server. Your clients must be prepared to handle duplicates though, as
replies might be sent more than once.


-Emile


From simon at rabbitmq.com  Thu Oct  4 10:27:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Oct 2012 10:27:04 +0100
Subject: [rabbitmq-discuss] Statistics database could not be contacted.
 Message rates and queue lengths will not be shown.
In-Reply-To: <CAHv8OSQ7UJ9L_s+rLJaJeMJ_v8LNcLvkWorotrhSCi1JX=nWYg@mail.gmail.com>
References: <CAHv8OSQ7UJ9L_s+rLJaJeMJ_v8LNcLvkWorotrhSCi1JX=nWYg@mail.gmail.com>
Message-ID: <506D5668.7040205@rabbitmq.com>

Hi. There's no good set of circumstances to see that message - the stats 
db should be restarted if it fails. Is this clustered or standalone? Can 
you post logs?

Cheers, Simon

On 03/10/12 22:56, Wong Kam Hoong wrote:
> Hi RabbitMQ  team,
>
> Recently I upgrade my rabbitmq nodes with the latest version 2.8.7, but
> i saw weird message show on the web admin page:
>
> "Statistics database could not be contacted. Message rates and queue
> lengths will not be shown."
>
> I not able to see any statistic such as current produce/consume rate,
> and how many messages in each queue.
>
> Please advise how can i enable back the statistic.
>
> Regards,
> Wong
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
Simon MacMullen
RabbitMQ, VMware

From wongkamhoong at gmail.com  Thu Oct  4 10:36:37 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Thu, 4 Oct 2012 17:36:37 +0800
Subject: [rabbitmq-discuss] Statistics database could not be contacted.
 Message rates and queue lengths will not be shown.
In-Reply-To: <506D5668.7040205@rabbitmq.com>
References: <CAHv8OSQ7UJ9L_s+rLJaJeMJ_v8LNcLvkWorotrhSCi1JX=nWYg@mail.gmail.com>
	<506D5668.7040205@rabbitmq.com>
Message-ID: <CAHv8OSQs5eyyY11SVpQijqQro9C+Va_9_jXjubBxJFte-jt5mA@mail.gmail.com>

Hi Simon,

The RabbitMQ was clustered (3 RabbitMQs), attached are the full log. The
problem happened in between 3-Oct to 4-Oct, I upgraded RabbitMQ to v2.8.7
on 3-Oct.

Thanks & Regards,
Wong


On Thu, Oct 4, 2012 at 5:27 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi. There's no good set of circumstances to see that message - the stats
> db should be restarted if it fails. Is this clustered or standalone? Can
> you post logs?
>
> Cheers, Simon
>
>
> On 03/10/12 22:56, Wong Kam Hoong wrote:
>
>> Hi RabbitMQ  team,
>>
>> Recently I upgrade my rabbitmq nodes with the latest version 2.8.7, but
>> i saw weird message show on the web admin page:
>>
>> "Statistics database could not be contacted. Message rates and queue
>> lengths will not be shown."
>>
>> I not able to see any statistic such as current produce/consume rate,
>> and how many messages in each queue.
>>
>> Please advise how can i enable back the statistic.
>>
>> Regards,
>> Wong
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/909008b1/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit.zip
Type: application/zip
Size: 47036 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/909008b1/attachment.zip>

From JSwainston at SportingIndex.com  Thu Oct  4 11:05:23 2012
From: JSwainston at SportingIndex.com (Jim Swainston)
Date: Thu, 4 Oct 2012 11:05:23 +0100
Subject: [rabbitmq-discuss] Access Refused
In-Reply-To: <506D53EF.6000505@rabbitmq.com>
References: <556325346CA26341B6F0530E07F90D96016C6812CB0C@GBGH-EXCH-CMS.sig.ads>
	<506D53EF.6000505@rabbitmq.com>
Message-ID: <556325346CA26341B6F0530E07F90D96016C6812CB88@GBGH-EXCH-CMS.sig.ads>

Hi Emile,

Thanks for the response.  Having spoken further with the client it appears he mixed his error messages up. The 403, ACCESS_REFUSED is actually coming from a php pecl client. I assume that this is a port or proxy issue.
Could you please confirm a couple of things for me...

The only port that need to be open for access to RabbitMQ as a consumer is 5672

The message 'Server channel error: 403, message: ACCESS_REFUSED - access to queue 'amq.gen-gx1n4EQIgnm7NVZlwZI2e5' in vhost '/blah' refused for user 'username'' is coming from the RabbitMQ server, not the client.

Thanks again for your help

Jim

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com] 
Sent: 04 October 2012 10:17
To: Discussions about RabbitMQ
Cc: Jim Swainston
Subject: Re: [rabbitmq-discuss] Access Refused

Hi Jim,

On 04/10/12 09:32, Jim Swainston wrote:
> *'Server channel error: 403, message: ACCESS_REFUSED - access to queue

Have you checked the permissions for the user by comparing the details at http://www.rabbitmq.com/access-control.html with the output from "rabbitmqctl list_permissions"? Which authentication provider are you using?

Permissions should not be affected by the location you connect from, so check the network topology and make sure you are connecting to the correct broker.


-Emile

www.sportingindex.com
Inbound Email has been scanned for viruses and SPAM 
**********************************************************************
This email and any attachments are confidential, protected by copyright and may be legally privileged.  If you are not the intended recipient, then the dissemination or copying of this email is prohibited. If you have received this in error, please notify the sender by replying by email and then delete the email completely from your system.  Neither Sporting Index nor the sender accepts responsibility for any virus, or any other defect which might affect any computer or IT system into which the email is received and/or opened.  It is the responsibility of the recipient to scan the email and no responsibility is accepted for any loss or damage arising in any way from receipt or use of this email.  Sporting Index Ltd is a company registered in England and Wales with company number 2636842, whose registered office is at Gateway House, Milverton Street, London, SE11 4AP.  Sporting Index Ltd is authorised and regulated by the UK Financial Services Authority (reg. no. 150404) and Gambling Commission (reg. no. 000-027343-R-308898-001).  Any financial promotion contained herein has been issued 
and approved by Sporting Index Ltd.

Outbound email has been scanned for viruses and SPAM

From dev440 at gmail.com  Thu Oct  4 11:19:36 2012
From: dev440 at gmail.com (chetan dev)
Date: Thu, 4 Oct 2012 15:49:36 +0530
Subject: [rabbitmq-discuss] Acknowledged
In-Reply-To: <506D51C0.9040204@rabbitmq.com>
References: <CAB0ZxM5ktX9iC17zKPZwOBrqdZOrO05t+rfUege6Cwrf06cw0A@mail.gmail.com>
	<CAB0ZxM76QV_OR1L4CqYE0rwQqZu_nk=w5GJmtw3snY=Jz2RBGg@mail.gmail.com>
	<506D51C0.9040204@rabbitmq.com>
Message-ID: <CAB0ZxM7Mver_TOL4-aQKtS1GCZE2Y_4-uK9ywkDK1+Nj-t1-Qw@mail.gmail.com>

Hi,

thanks for your prompt response .
i am sending 5 messages by a for loop but the number of
basic acknowledgment that is getting fired 10 times or more
delivery tag is coming fine.  but the method for handling the event is
getting called more than required.
here is the peace of code that i have written.

Model.BasicAcks += Model_BasicAcks;
 void Model_BasicAcks(IModel model, BasicAckEventArgs args)
         {

             //args.Multiple = true;
             //Response.Write(args.DeliveryTag);

             Label1.Text = count.ToString();
             count++;


         }



On Thu, Oct 4, 2012 at 2:37 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 04/10/12 09:19, chetan dev wrote:
> > while handling basicack event , the event is getting fired more number
> > of times that number of message published to queue
> > can some one please tell me about this behaviour?
>
> You should be able to match up the delivery-tag in each ack with a
> published message. In what way exactly does this fail? Can you provide
> some tracing output to support your claim that too many basic.ack
> messages are sent by the broker?
>
>
> -Emile
>



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/5452be44/attachment.htm>

From emile at rabbitmq.com  Thu Oct  4 11:39:26 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 04 Oct 2012 11:39:26 +0100
Subject: [rabbitmq-discuss] Acknowledged
In-Reply-To: <CAB0ZxM7Mver_TOL4-aQKtS1GCZE2Y_4-uK9ywkDK1+Nj-t1-Qw@mail.gmail.com>
References: <CAB0ZxM5ktX9iC17zKPZwOBrqdZOrO05t+rfUege6Cwrf06cw0A@mail.gmail.com>
	<CAB0ZxM76QV_OR1L4CqYE0rwQqZu_nk=w5GJmtw3snY=Jz2RBGg@mail.gmail.com>
	<506D51C0.9040204@rabbitmq.com>
	<CAB0ZxM7Mver_TOL4-aQKtS1GCZE2Y_4-uK9ywkDK1+Nj-t1-Qw@mail.gmail.com>
Message-ID: <506D675E.9090908@rabbitmq.com>

Hi,

On 04/10/12 11:19, chetan dev wrote:
> i am sending 5 messages by a for loop but the number of
> basic acknowledgment that is getting fired 10 times or more
> delivery tag is coming fine.  but the method for handling the event is
> getting called more than required.

Are you sure you are counting the publishes and publisher acks
correctly? Can you provide some evidence of your claim, like a trace of
sequence numbers of messages published with the corresponding
delivery-tag to illustrate how they are not in step?

A very short, minimal, self-contained piece of code the produces the
trace may also be useful.



-Emile


From thomas.spycher at tech.swisssign.com  Thu Oct  4 11:34:10 2012
From: thomas.spycher at tech.swisssign.com (Thomas Spycher)
Date: Thu, 4 Oct 2012 12:34:10 +0200
Subject: [rabbitmq-discuss] Messages bigger than 150kb
In-Reply-To: <CAE3HoVT61FtUSLyjJFw_pmeq6v4JNFiOxsdU6azFwAs-UQG=gg@mail.gmail.com>
References: <88745725-61DC-4257-B354-CF6400B4B10B@tech.swisssign.com>
	<506C70E8.6000501@rabbitmq.com>
	<C9EDA46C-DECC-4088-B8DD-CE3DE2CB0629@tech.swisssign.com>
	<CAE3HoVT61FtUSLyjJFw_pmeq6v4JNFiOxsdU6azFwAs-UQG=gg@mail.gmail.com>
Message-ID: <EDF462E8-8B3E-4CEB-8AFA-FB0598D2EF41@tech.swisssign.com>

I understand! I see the Problem?

Thanks a lot for bringing a bit light into the dark!

Tom

On Oct 4, 2012, at 10:50 , Michael Klishin <michael.s.klishin at gmail.com> wrote:

> 
> 
> 2012/10/4 Thomas Spycher <thomas.spycher at tech.swisssign.com>
> timeStart = time.time()
> 
> self.rpcchannel.basic_publish(exchange='', routing_key='secureObjects', properties=pika.BasicProperties(reply_to=self.rpcqueue , correlation_id=self._correlation_id,content_type="text/plain",delivery_mode=2), body=serializedObject)
> 
> print time.time() - timeStart
> 
> This does not measure actual end-to-end throughput, only how fast Pika can push things down the socket.
> In that case, of course more data will take more time. In fact, Pika may even delay sending the data
> (I am not familiar with its internals but it is event loop-based AFAIR).
> 
> So what you are seeing is most likely Pika's internal buffer being completely filled once you go above 150K,
> in which case it has to do extra work, unlike with tiny messages. The same can be true for buffers in layers below (OS does buffering for network I/O, drivers may do that, etc).
> 
> When benchmarking a messaging system throughput, you need to do it end-to-end, with [at least] 2 machines, a realistic
> network link between them and understanding about how exactly your client does publishing.
> 
> TCP settings like Nagle's algorithm [1] and phenomenons like TCP incast [2] can make a noticeable difference in some cases.
> 
> 1. http://boundary.com/blog/2012/05/02/know-a-delay-nagles-algorithm-and-you/
> 2. http://www.snookles.com/slf-blog/2012/01/05/tcp-incast-what-is-it/
> -- 
> MK
> 
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
> 


From dev440 at gmail.com  Thu Oct  4 11:52:16 2012
From: dev440 at gmail.com (chetan dev)
Date: Thu, 4 Oct 2012 16:22:16 +0530
Subject: [rabbitmq-discuss] Acknowledged
In-Reply-To: <506D675E.9090908@rabbitmq.com>
References: <CAB0ZxM5ktX9iC17zKPZwOBrqdZOrO05t+rfUege6Cwrf06cw0A@mail.gmail.com>
	<CAB0ZxM76QV_OR1L4CqYE0rwQqZu_nk=w5GJmtw3snY=Jz2RBGg@mail.gmail.com>
	<506D51C0.9040204@rabbitmq.com>
	<CAB0ZxM7Mver_TOL4-aQKtS1GCZE2Y_4-uK9ywkDK1+Nj-t1-Qw@mail.gmail.com>
	<506D675E.9090908@rabbitmq.com>
Message-ID: <CAB0ZxM4VT48z2_wtg=dfDCipERaFmbUNCc-fwNOgr6T5hvgnYw@mail.gmail.com>

Hi,
attached is the pic that shows delivery tag  and sequence number of message
published .
as you can see there are multiple delivery tag with the same output that
means event is getting fired multiple time for a published message



On Thu, Oct 4, 2012 at 4:09 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 04/10/12 11:19, chetan dev wrote:
> > i am sending 5 messages by a for loop but the number of
> > basic acknowledgment that is getting fired 10 times or more
> > delivery tag is coming fine.  but the method for handling the event is
> > getting called more than required.
>
> Are you sure you are counting the publishes and publisher acks
> correctly? Can you provide some evidence of your claim, like a trace of
> sequence numbers of messages published with the corresponding
> delivery-tag to illustrate how they are not in step?
>
> A very short, minimal, self-contained piece of code the produces the
> trace may also be useful.
>
>
>
> -Emile
>
>


-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/218ae347/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq.png
Type: image/png
Size: 152670 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/218ae347/attachment.png>

From emile at rabbitmq.com  Thu Oct  4 12:15:23 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 04 Oct 2012 12:15:23 +0100
Subject: [rabbitmq-discuss] Acknowledged
In-Reply-To: <CAB0ZxM4VT48z2_wtg=dfDCipERaFmbUNCc-fwNOgr6T5hvgnYw@mail.gmail.com>
References: <CAB0ZxM5ktX9iC17zKPZwOBrqdZOrO05t+rfUege6Cwrf06cw0A@mail.gmail.com>
	<CAB0ZxM76QV_OR1L4CqYE0rwQqZu_nk=w5GJmtw3snY=Jz2RBGg@mail.gmail.com>
	<506D51C0.9040204@rabbitmq.com>
	<CAB0ZxM7Mver_TOL4-aQKtS1GCZE2Y_4-uK9ywkDK1+Nj-t1-Qw@mail.gmail.com>
	<506D675E.9090908@rabbitmq.com>
	<CAB0ZxM4VT48z2_wtg=dfDCipERaFmbUNCc-fwNOgr6T5hvgnYw@mail.gmail.com>
Message-ID: <506D6FCB.7050009@rabbitmq.com>

Hi,

On 04/10/12 11:52, chetan dev wrote:
> as you can see there are multiple delivery tag with the same output that
> means event is getting fired multiple time for a published message 

I see you get delivery-tag 2 twice, delivery-tag 3 three times,
delivery-tag 4 four times, and so on, but those delivery tags are only
sent by the broker once. My guess is that you are chaining another
callback handler each time an ack is received. Once you correct the
mistake you will see that basic.acks are received in step with publishes.


-Emile

From streetcat at gmail.com  Thu Oct  4 11:47:54 2012
From: streetcat at gmail.com (Raviv Pavel)
Date: Thu, 4 Oct 2012 03:47:54 -0700 (PDT)
Subject: [rabbitmq-discuss] memory flow control
In-Reply-To: <0f493c8c-38e1-4a17-95a9-de57d4fd3539@googlegroups.com>
References: <0f493c8c-38e1-4a17-95a9-de57d4fd3539@googlegroups.com>
Message-ID: <5e828191-e9fa-4a67-9b92-fefb0b4cdf70@googlegroups.com>

I think I've read somewhere that it's not currently possible.
I need the same thing :(

On Tuesday, September 25, 2012 11:47:18 PM UTC+2, Dmitriy Stolyarov wrote:
>
> Hi,
> Is there a way to have the producer throw an exception instead of just 
> being blocked when high memory water mark is reached on the server? (Using 
> java client)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/2bf0bf67/attachment.htm>

From streetcat at gmail.com  Thu Oct  4 11:50:50 2012
From: streetcat at gmail.com (Raviv Pavel)
Date: Thu, 4 Oct 2012 03:50:50 -0700 (PDT)
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
Message-ID: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>

It seems that when I hit the memory watermark, it doesn't go back to green 
(and still blocks publishers) even if I purge or delete the queue that 
caused it.
Any idea?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/efc10779/attachment.htm>

From tim at rabbitmq.com  Thu Oct  4 12:14:35 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 4 Oct 2012 12:14:35 +0100
Subject: [rabbitmq-discuss] memory flow control
In-Reply-To: <5e828191-e9fa-4a67-9b92-fefb0b4cdf70@googlegroups.com>
References: <0f493c8c-38e1-4a17-95a9-de57d4fd3539@googlegroups.com>
	<5e828191-e9fa-4a67-9b92-fefb0b4cdf70@googlegroups.com>
Message-ID: <757FC9E4-11AD-4E94-AE42-F42E9ABE1D40@rabbitmq.com>

EWOULDBLOCK can only be detected on an nio socket/channel, so this isn't possible with the java-client in its current incarnation.

On 4 Oct 2012, at 11:47, Raviv Pavel wrote:

> I think I've read somewhere that it's not currently possible.
> I need the same thing :(
> 
> On Tuesday, September 25, 2012 11:47:18 PM UTC+2, Dmitriy Stolyarov wrote:
> Hi,
> Is there a way to have the producer throw an exception instead of just being blocked when high memory water mark is reached on the server? (Using java client)
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Thu Oct  4 12:26:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Oct 2012 12:26:57 +0100
Subject: [rabbitmq-discuss] memory flow control
In-Reply-To: <757FC9E4-11AD-4E94-AE42-F42E9ABE1D40@rabbitmq.com>
References: <0f493c8c-38e1-4a17-95a9-de57d4fd3539@googlegroups.com>	<5e828191-e9fa-4a67-9b92-fefb0b4cdf70@googlegroups.com>
	<757FC9E4-11AD-4E94-AE42-F42E9ABE1D40@rabbitmq.com>
Message-ID: <506D7281.6000904@rabbitmq.com>

On 04/10/12 12:14, Tim Watson wrote:
> EWOULDBLOCK can only be detected on an nio socket/channel, so this isn't possible with the java-client in its current incarnation.

It's more likely that we'll go the route of inventing a protocol 
extension so the server can tell the client it's blocked. That way we 
don't have to rewrite the whole Java client, and also the server can say 
*why* it's blocked.

This isn't going to happen immediately though.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Oct  4 12:29:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Oct 2012 12:29:08 +0100
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
Message-ID: <506D7304.3070801@rabbitmq.com>

On 04/10/12 11:50, Raviv Pavel wrote:
> It seems that when I hit the memory watermark, it doesn't go back to
> green (and still blocks publishers) even if I purge or delete the queue
> that caused it.
> Any idea?

Are you saying that the memory use drops back below the watermark, but 
the memory alarm is still on and thus publishers are blocked, or are you 
saying that the memory use does not drop below the watermark even though 
you purged the queue?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From prabodh.upreti at vce.com  Thu Oct  4 12:40:33 2012
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Thu, 4 Oct 2012 04:40:33 -0700 (PDT)
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <BF222C64-132D-4DC0-BACE-A0BABBB8A3D2@rabbitmq.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
	<1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>
	<5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>
	<E66D7093-DBAF-4A34-BF67-2C2923D0D744@rabbitmq.com>
	<1349296620851-22327.post@n5.nabble.com>
	<10C8AE39-4224-4026-806D-B93419923B55@rabbitmq.com>
	<BF222C64-132D-4DC0-BACE-A0BABBB8A3D2@rabbitmq.com>
Message-ID: <1349350833151-22357.post@n5.nabble.com>

Tim

Thank you. That makes sense now.  I did not completely realize the fact
these queues were temporary and the system clears them once session is done. 
I saw a lot of these  temp queues in the system and was worried they would
clog up the system.  I guess the sessions were not properly closed and that
is why they are still sitting there.

One follow up.  It sounds like I need an external monitor to clean up the
system time to time.  For instance, if the temp queue has no consumer
connected remove it etc.

regards

prabodh



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/share-a-pre-built-queue-tp22319p22357.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Thu Oct  4 12:46:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Oct 2012 12:46:35 +0100
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <1349350833151-22357.post@n5.nabble.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>	<1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>	<5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>	<E66D7093-DBAF-4A34-BF67-2C2923D0D744@rabbitmq.com>	<1349296620851-22327.post@n5.nabble.com>	<10C8AE39-4224-4026-806D-B93419923B55@rabbitmq.com>	<BF222C64-132D-4DC0-BACE-A0BABBB8A3D2@rabbitmq.com>
	<1349350833151-22357.post@n5.nabble.com>
Message-ID: <506D771B.5010308@rabbitmq.com>

On 04/10/12 12:40, Prabodh Upreti wrote:
> One follow up.  It sounds like I need an external monitor to clean up the
> system time to time.  For instance, if the temp queue has no consumer
> connected remove it etc.

If you declare the queue with exclusive = true then the queue should be 
automatically deleted when the consumer disconnects. You shouldn't need 
an external monitor.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From watson.timothy at gmail.com  Thu Oct  4 13:01:52 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 4 Oct 2012 13:01:52 +0100
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <1349350833151-22357.post@n5.nabble.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
	<1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>
	<5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>
	<E66D7093-DBAF-4A34-BF67-2C2923D0D744@rabbitmq.com>
	<1349296620851-22327.post@n5.nabble.com>
	<10C8AE39-4224-4026-806D-B93419923B55@rabbitmq.com>
	<BF222C64-132D-4DC0-BACE-A0BABBB8A3D2@rabbitmq.com>
	<1349350833151-22357.post@n5.nabble.com>
Message-ID: <BCA0033E-3329-4AD5-8A9A-5223A655627E@rabbitmq.com>

If you make the queue exclusive then the broker will automatically remove it once it notices the client has disconnected. We do our own housekeeping in that respect, but detecting 'stale' sockets can take quite some time depending on the underlying os/network configuration, so you might want to consider enabling heartbeats if you want post session cleanup to take place within a shorter time boundary.

On 4 Oct 2012, at 12:40, Prabodh Upreti <prabodh.upreti at vce.com> wrote:

> Tim
> 
> Thank you. That makes sense now.  I did not completely realize the fact
> these queues were temporary and the system clears them once session is done. 
> I saw a lot of these  temp queues in the system and was worried they would
> clog up the system.  I guess the sessions were not properly closed and that
> is why they are still sitting there.
> 
> One follow up.  It sounds like I need an external monitor to clean up the
> system time to time.  For instance, if the temp queue has no consumer
> connected remove it etc.
> 
> regards
> 
> prabodh
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/share-a-pre-built-queue-tp22319p22357.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From watson.timothy at gmail.com  Thu Oct  4 13:04:09 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 4 Oct 2012 13:04:09 +0100
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <BCA0033E-3329-4AD5-8A9A-5223A655627E@rabbitmq.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
	<1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>
	<5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>
	<E66D7093-DBAF-4A34-BF67-2C2923D0D744@rabbitmq.com>
	<1349296620851-22327.post@n5.nabble.com>
	<10C8AE39-4224-4026-806D-B93419923B55@rabbitmq.com>
	<BF222C64-132D-4DC0-BACE-A0BABBB8A3D2@rabbitmq.com>
	<1349350833151-22357.post@n5.nabble.com>
	<BCA0033E-3329-4AD5-8A9A-5223A655627E@rabbitmq.com>
Message-ID: <B6F36AED-E58B-48C8-841F-8E71160F6B89@rabbitmq.com>

Sorry I didnt see simon's response before posting this, but yes - exactly what he said.

On 4 Oct 2012, at 13:01, Tim Watson <watson.timothy at gmail.com> wrote:

> If you make the queue exclusive then the broker will automatically remove it once it notices the client has disconnected. We do our own housekeeping in that respect, but detecting 'stale' sockets can take quite some time depending on the underlying os/network configuration, so you might want to consider enabling heartbeats if you want post session cleanup to take place within a shorter time boundary.
> 
> On 4 Oct 2012, at 12:40, Prabodh Upreti <prabodh.upreti at vce.com> wrote:
> 
>> Tim
>> 
>> Thank you. That makes sense now.  I did not completely realize the fact
>> these queues were temporary and the system clears them once session is done. 
>> I saw a lot of these  temp queues in the system and was worried they would
>> clog up the system.  I guess the sessions were not properly closed and that
>> is why they are still sitting there.
>> 
>> One follow up.  It sounds like I need an external monitor to clean up the
>> system time to time.  For instance, if the temp queue has no consumer
>> connected remove it etc.
>> 
>> regards
>> 
>> prabodh
>> 
>> 
>> 
>> --
>> View this message in context: http://rabbitmq.1065348.n5.nabble.com/share-a-pre-built-queue-tp22319p22357.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dev440 at gmail.com  Thu Oct  4 13:40:25 2012
From: dev440 at gmail.com (chetan dev)
Date: Thu, 4 Oct 2012 18:10:25 +0530
Subject: [rabbitmq-discuss] Acknowledged
In-Reply-To: <506D6FCB.7050009@rabbitmq.com>
References: <CAB0ZxM5ktX9iC17zKPZwOBrqdZOrO05t+rfUege6Cwrf06cw0A@mail.gmail.com>
	<CAB0ZxM76QV_OR1L4CqYE0rwQqZu_nk=w5GJmtw3snY=Jz2RBGg@mail.gmail.com>
	<506D51C0.9040204@rabbitmq.com>
	<CAB0ZxM7Mver_TOL4-aQKtS1GCZE2Y_4-uK9ywkDK1+Nj-t1-Qw@mail.gmail.com>
	<506D675E.9090908@rabbitmq.com>
	<CAB0ZxM4VT48z2_wtg=dfDCipERaFmbUNCc-fwNOgr6T5hvgnYw@mail.gmail.com>
	<506D6FCB.7050009@rabbitmq.com>
Message-ID: <CAB0ZxM4-+CTsqOBLqteFLjG4wAGeDC3LqDPSDREDLfe978vFFA@mail.gmail.com>

Thank you very much emile . i got it

On Thu, Oct 4, 2012 at 4:45 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 04/10/12 11:52, chetan dev wrote:
> > as you can see there are multiple delivery tag with the same output that
> > means event is getting fired multiple time for a published message
>
> I see you get delivery-tag 2 twice, delivery-tag 3 three times,
> delivery-tag 4 four times, and so on, but those delivery tags are only
> sent by the broker once. My guess is that you are chaining another
> callback handler each time an ack is received. Once you correct the
> mistake you will see that basic.acks are received in step with publishes.
>
>
> -Emile
>



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/ec8bbcc9/attachment.htm>

From prabodh.upreti at vce.com  Thu Oct  4 14:22:29 2012
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Thu, 4 Oct 2012 06:22:29 -0700 (PDT)
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <B6F36AED-E58B-48C8-841F-8E71160F6B89@rabbitmq.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
	<1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>
	<5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>
	<E66D7093-DBAF-4A34-BF67-2C2923D0D744@rabbitmq.com>
	<1349296620851-22327.post@n5.nabble.com>
	<10C8AE39-4224-4026-806D-B93419923B55@rabbitmq.com>
	<BF222C64-132D-4DC0-BACE-A0BABBB8A3D2@rabbitmq.com>
	<1349350833151-22357.post@n5.nabble.com>
	<BCA0033E-3329-4AD5-8A9A-5223A655627E@rabbitmq.com>
	<B6F36AED-E58B-48C8-841F-8E71160F6B89@rabbitmq.com>
Message-ID: <1349356949777-22362.post@n5.nabble.com>

Perfect.  Hope this is my last question.

I will have many clients interacting with the broker.  I need to really
control what they can do with the system.  I am planning to publish filters
they can subscribe to via REST interfaces.

1.  How can I give them permissions so they can only create exclusive = true 
queues.

2.  The reason I was going with the pre-built queue was so that I could have
5 keys bound to the FIXED named queue and they would not need to worry about
binding all the keys to their temp queue.  If they can't do that then I just 
have to inform them about the keys so they can use the right ones.  Please
let me know if there is a better way to manage this.

Once again thank you both for you feedback.

regards

prabodh



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/share-a-pre-built-queue-tp22319p22362.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alan.antonuk at gmail.com  Thu Oct  4 14:51:28 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 4 Oct 2012 09:51:28 -0400
Subject: [rabbitmq-discuss] Support for Python 3.x in rabbitmq-codegen
In-Reply-To: <5065C31D.4010307@rabbitmq.com>
References: <CAAt2po+c6vrsjMzxojZcz0MbYuNfHQKaGK=MPgkjV=GmZpYnhA@mail.gmail.com>
	<5065C31D.4010307@rabbitmq.com>
Message-ID: <CAAt2poKjM+-qbWHcjG3LbnHhK_fp6HbE6PL3z7VhxAx=e0JkNA@mail.gmail.com>

Ping?

On Fri, Sep 28, 2012 at 11:32 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 26/09/12 16:37, Alan Antonuk wrote:
>
>> Would the RabbitMQ team be willing to accept this change?
>>
>
> Yes, that looks plausible. Although probably after the weekend now.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/0ed33122/attachment.htm>

From simon at rabbitmq.com  Thu Oct  4 15:27:40 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Oct 2012 15:27:40 +0100
Subject: [rabbitmq-discuss] Support for Python 3.x in rabbitmq-codegen
In-Reply-To: <CAAt2poKjM+-qbWHcjG3LbnHhK_fp6HbE6PL3z7VhxAx=e0JkNA@mail.gmail.com>
References: <CAAt2po+c6vrsjMzxojZcz0MbYuNfHQKaGK=MPgkjV=GmZpYnhA@mail.gmail.com>	<5065C31D.4010307@rabbitmq.com>
	<CAAt2poKjM+-qbWHcjG3LbnHhK_fp6HbE6PL3z7VhxAx=e0JkNA@mail.gmail.com>
Message-ID: <506D9CDC.4070805@rabbitmq.com>

On 04/10/12 14:51, Alan Antonuk wrote:
> Ping?

...good point. Merged onto default / rabbitmq_v2_8_x now.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Oct  4 15:53:24 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Oct 2012 15:53:24 +0100
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
	<506D7304.3070801@rabbitmq.com>
	<CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>
Message-ID: <506DA2E4.2050100@rabbitmq.com>

On 04/10/12 13:01, Raviv Pavel wrote:
> Based on the management UI, memory usage doesn't drop and publishers are
> still blocked.

Hmm. In that case my first guess would be that the queue you deleted / 
purged wasn't the queue which was using all the memory. Check the memory 
use of other queues - this can be found on the queue details page, or 
with "rabbitmqctl list_queues name memory". Also, check the VM-wide 
memory statistics (on the node details page, under "advanced". This 
might give a clue as to where the memory is going.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Thu Oct  4 15:54:37 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 04 Oct 2012 15:54:37 +0100
Subject: [rabbitmq-discuss] memory flow control
In-Reply-To: <5e828191-e9fa-4a67-9b92-fefb0b4cdf70@googlegroups.com>
References: <0f493c8c-38e1-4a17-95a9-de57d4fd3539@googlegroups.com>
	<5e828191-e9fa-4a67-9b92-fefb0b4cdf70@googlegroups.com>
Message-ID: <506DA32D.5030500@rabbitmq.com>

On 04/10/12 11:47, Raviv Pavel wrote:
> I think I've read somewhere that it's not currently possible.
> I need the same thing :(
>
> On Tuesday, September 25, 2012 11:47:18 PM UTC+2, Dmitriy Stolyarov wrote:
>
>     Hi,
>     Is there a way to have the producer throw an exception instead of
>     just being blocked when high memory water mark is reached on the
>     server? (Using java client)

Why you would want to treat this condition any different from a network 
delay/disruption or a slow server?

It possible to detect that, indirectly, using a technique I described in 
http://rabbitmq.1065348.n5.nabble.com/Memory-Management-Concerns-Questions-tp13225p13233.html 
(which I shall henceforth call "user level EWOULDBLOCK" ;)

Matthias.

From matthias at rabbitmq.com  Thu Oct  4 15:57:07 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 04 Oct 2012 15:57:07 +0100
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <506DA2E4.2050100@rabbitmq.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
	<506D7304.3070801@rabbitmq.com>
	<CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>
	<506DA2E4.2050100@rabbitmq.com>
Message-ID: <506DA3C3.7030008@rabbitmq.com>

On 04/10/12 15:53, Simon MacMullen wrote:
> On 04/10/12 13:01, Raviv Pavel wrote:
>> Based on the management UI, memory usage doesn't drop and publishers are
>> still blocked.
>
> Hmm. In that case my first guess would be that the queue you deleted /
> purged wasn't the queue which was using all the memory. Check the memory
> use of other queues - this can be found on the queue details page, or
> with "rabbitmqctl list_queues name memory". Also, check the VM-wide
> memory statistics (on the node details page, under "advanced". This
> might give a clue as to where the memory is going.

...and please make sure you are running the latest version of RabbitMQ 
(2.8.7, atm), since we have fixed a few memory leaks in the in recent 
versions.

Matthias.

From michael.s.klishin at gmail.com  Thu Oct  4 15:59:54 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 4 Oct 2012 18:59:54 +0400
Subject: [rabbitmq-discuss] ANN Langohr documentation site
Message-ID: <CAE3HoVTa+WRu5BcbSU1UragK5ZPp_C3XbWVpZp-qWhZz4YXZBA@mail.gmail.com>

Langohr is a Clojure RabbitMQ client that embraces the AMQP 0.9.1 model.

Langohr is not a new project and not quite ready for 1.0 yet but it is past
most of breaking API changes and the bulk of the docs is
now available at http://clojurerabbitmq.info.

A slightly longer announcement:
http://blog.clojurewerkz.org/blog/2012/10/04/announcing-langohr-documentation-guides/
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/2b11c578/attachment.htm>

From simon at rabbitmq.com  Thu Oct  4 16:34:56 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Oct 2012 16:34:56 +0100
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <CACx7p4A15YO5u-ste82O2A_HG5rES4KR+C1u2n2AM48ZM2h9=w@mail.gmail.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
	<506D7304.3070801@rabbitmq.com>
	<CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>
	<506DA2E4.2050100@rabbitmq.com> <506DA3C3.7030008@rabbitmq.com>
	<CACx7p4A2U7aJ3odR9PRPKOU=YRa+iMB=BRBjxzT=Fx1yD4cncw@mail.gmail.com>
	<CACx7p4A15YO5u-ste82O2A_HG5rES4KR+C1u2n2AM48ZM2h9=w@mail.gmail.com>
Message-ID: <506DACA0.7040208@rabbitmq.com>

Hard to believe that's to do with the server not starting - can you post 
a more complete log?

On 04/10/12 16:32, Raviv Pavel wrote:
> After upgrading the server won't start. from the logs:
>
> =ERROR REPORT==== 4-Oct-2012::17:11:59 ===
> ** Generic server <0.341.0> terminating
> ** Last message in was {'$gen_cast',
>                             {method,
>
>   {'queue.declare',0,<<"es1">>,false,true,false,
>                                     false,false,
>
>   [{<<"x-ha-policy">>,longstr,<<"all">>}]},
>                                 none,noflow}}
>
>
> Thanks
> /--/Raviv
> /
> /
>
>
>
> On Thu, Oct 4, 2012 at 5:05 PM, Raviv Pavel <raviv at gigya-inc.com
> <mailto:raviv at gigya-inc.com>> wrote:
>
>     All queues are empty and "rabbitmqctl list_queues name memory" shows
>     they use about 3K each.
>     VM memory stats are much lower then the one shown in the overview.
>     We're using 2.8.1 - I'll try upgrading to 2.8.7
>
>     Thanks
>     /--/Raviv
>     /
>     /
>
>
>
>     On Thu, Oct 4, 2012 <tel:2012> at 4:57 PM, Matthias Radestock
>     <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>
>         On 04/10/12 15:53, Simon MacMullen wrote:
>
>             On 04/10/12 13:01, Raviv Pavel wrote:
>
>                 Based on the management UI, memory usage doesn't drop
>                 and publishers are
>                 still blocked.
>
>
>             Hmm. In that case my first guess would be that the queue you
>             deleted /
>             purged wasn't the queue which was using all the memory.
>             Check the memory
>             use of other queues - this can be found on the queue details
>             page, or
>             with "rabbitmqctl list_queues name memory". Also, check the
>             VM-wide
>             memory statistics (on the node details page, under
>             "advanced". This
>             might give a clue as to where the memory is going.
>
>
>         ...and please make sure you are running the latest version of
>         RabbitMQ (2.8.7, atm), since we have fixed a few memory leaks in
>         the in recent versions.
>
>         Matthias.
>
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Oct  4 16:57:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Oct 2012 16:57:35 +0100
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <CACx7p4Cnf6C16C05vL5CU66R16mWWmSK9cU-uPmi2WgP8-OMOg@mail.gmail.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
	<506D7304.3070801@rabbitmq.com>
	<CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>
	<506DA2E4.2050100@rabbitmq.com> <506DA3C3.7030008@rabbitmq.com>
	<CACx7p4A2U7aJ3odR9PRPKOU=YRa+iMB=BRBjxzT=Fx1yD4cncw@mail.gmail.com>
	<CACx7p4A15YO5u-ste82O2A_HG5rES4KR+C1u2n2AM48ZM2h9=w@mail.gmail.com>
	<506DACA0.7040208@rabbitmq.com>
	<CACx7p4Cnf6C16C05vL5CU66R16mWWmSK9cU-uPmi2WgP8-OMOg@mail.gmail.com>
Message-ID: <506DB1EF.6070902@rabbitmq.com>

So that looks to me like mongo-qa2 is a RAM node, and you are starting 
it before mongo-qa1, which is presumably a disc node?

What happens if you start mongo-qa1 first?

Cheers, Simon

On 04/10/12 16:38, Raviv Pavel wrote:
> Upgraded the other node (there are two) and it fails to start.
> Here is the startup log:
>
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v2.8.7  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2012 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : rabbit at mongo-qa2
> app descriptor :
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.7/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> config file(s) : (none)
> cookie hash    : pu0BlS9+G2N9yLfd51TkmA==
> log            : /var/log/rabbitmq/rabbit at mongo-qa2.log
> sasl log       : /var/log/rabbitmq/rabbit at mongo-qa2-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at mongo-qa2
> erlang version : 5.8.4
>
> -- rabbit boot start
> starting file handle cache server
> ...done
> starting worker pool
>   ...done
> starting database                                                     ...
>
> BOOT FAILED
> ===========
>
> Error description:
>     {error,{failed_to_cluster_with,['rabbit at mongo-qa1'],
> "Mnesia could not connect to any disc nodes."}}
>
> Log files (may contain more information):
>     /var/log/rabbitmq/rabbit at mongo-qa2.log
>     /var/log/rabbitmq/rabbit at mongo-qa2-sasl.log
>
> Stack trace:
>     [{rabbit_mnesia,init_db,3},
>      {rabbit_mnesia,init,0},
>      {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>      {rabbit,run_boot_step,1},
>      {rabbit,'-start/2-lc$^0/1-0-',1},
>      {rabbit,start,2},
>      {application_master,start_it_old,4}]
>
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>
>
> Thanks
> /--/Raviv
> /
> /
>
>
>
> On Thu, Oct 4, 2012 at 5:34 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Hard to believe that's to do with the server not starting - can you
>     post a more complete log?
>
>
>     On 04/10/12 16:32, Raviv Pavel wrote:
>
>         After upgrading the server won't start. from the logs:
>
>         =ERROR REPORT==== 4-Oct-2012 <tel:2012>::17:11:59 ===
>         ** Generic server <0.341.0 <tel:0.341.0>> terminating
>         ** Last message in was {'$gen_cast',
>                                      {method,
>
>            {'queue.declare',0,<<"es1">>,__false,true,false,
>                                              false,false,
>
>            [{<<"x-ha-policy">>,longstr,<<__"all">>}]},
>                                          none,noflow}}
>
>
>         Thanks
>         /--/Raviv
>         /
>
>         /
>
>
>
>         On Thu, Oct 4, 2012 <tel:2012> at 5:05 PM, Raviv Pavel
>         <raviv at gigya-inc.com <mailto:raviv at gigya-inc.com>
>         <mailto:raviv at gigya-inc.com <mailto:raviv at gigya-inc.com>>> wrote:
>
>              All queues are empty and "rabbitmqctl list_queues name
>         memory" shows
>              they use about 3K each.
>              VM memory stats are much lower then the one shown in the
>         overview.
>              We're using 2.8.1 - I'll try upgrading to 2.8.7
>
>              Thanks
>              /--/Raviv
>              /
>              /
>
>
>
>              On Thu, Oct 4, 2012 <tel:2012> <tel:2012 <tel:2012>> at
>         4:57 PM, Matthias Radestock
>
>         <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>
>         <mailto:matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>>__>
>         wrote:
>
>                  On 04/10/12 15:53, Simon MacMullen wrote:
>
>                      On 04/10/12 13:01, Raviv Pavel wrote:
>
>                          Based on the management UI, memory usage
>         doesn't drop
>                          and publishers are
>                          still blocked.
>
>
>                      Hmm. In that case my first guess would be that the
>         queue you
>                      deleted /
>                      purged wasn't the queue which was using all the memory.
>                      Check the memory
>                      use of other queues - this can be found on the
>         queue details
>                      page, or
>                      with "rabbitmqctl list_queues name memory". Also,
>         check the
>                      VM-wide
>                      memory statistics (on the node details page, under
>         "advanced". This
>                      might give a clue as to where the memory is going.
>
>
>                  ...and please make sure you are running the latest
>         version of
>                  RabbitMQ (2.8.7, atm), since we have fixed a few memory
>         leaks in
>                  the in recent versions.
>
>                  Matthias.
>
>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Thu Oct  4 17:17:17 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 04 Oct 2012 17:17:17 +0100
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <CACx7p4Ab=awWVHzjYFx=rTAo4S2vMzeBJ=wZLMyea3SZ6BYeuw@mail.gmail.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
	<506D7304.3070801@rabbitmq.com>
	<CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>
	<506DA2E4.2050100@rabbitmq.com> <506DA3C3.7030008@rabbitmq.com>
	<CACx7p4A2U7aJ3odR9PRPKOU=YRa+iMB=BRBjxzT=Fx1yD4cncw@mail.gmail.com>
	<CACx7p4A15YO5u-ste82O2A_HG5rES4KR+C1u2n2AM48ZM2h9=w@mail.gmail.com>
	<506DACA0.7040208@rabbitmq.com>
	<CACx7p4Cnf6C16C05vL5CU66R16mWWmSK9cU-uPmi2WgP8-OMOg@mail.gmail.com>
	<CACx7p4Ab=awWVHzjYFx=rTAo4S2vMzeBJ=wZLMyea3SZ6BYeuw@mail.gmail.com>
Message-ID: <506DB68D.3080502@rabbitmq.com>

On 04/10/12 16:57, Raviv Pavel wrote:
> Back to the original problem:
> 1. I set the watermark very low so I can reach it, effectively  78MB

Ah. Was this what you had done in the first place?

> 2. server starts with empty queues and memory usage is 66MB
> 3. I start publishing messages and reach the watermark
> 4. publisher gets blocked
> 5. I purge the queue but memory stays the same

When you set the watermark very low, close to the "empty" memory use, it 
is very possible that the memory level will go over and never go under 
again. Caches, lazy instantiation and so on. RabbitMQ is not designed 
for highly constrained memory environments.

Cheers. Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alan.antonuk at gmail.com  Thu Oct  4 20:47:12 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 4 Oct 2012 15:47:12 -0400
Subject: [rabbitmq-discuss] Support for Python 3.x in rabbitmq-codegen
In-Reply-To: <506D9CDC.4070805@rabbitmq.com>
References: <CAAt2po+c6vrsjMzxojZcz0MbYuNfHQKaGK=MPgkjV=GmZpYnhA@mail.gmail.com>
	<5065C31D.4010307@rabbitmq.com>
	<CAAt2poKjM+-qbWHcjG3LbnHhK_fp6HbE6PL3z7VhxAx=e0JkNA@mail.gmail.com>
	<506D9CDC.4070805@rabbitmq.com>
Message-ID: <CAAt2poJUG_D-5uwH+YHOKy2vMH+nWVZ8rgz_kCGPY1NLuLc2Dg@mail.gmail.com>

Excellent! Thanks.

On Thu, Oct 4, 2012 at 10:27 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 04/10/12 14:51, Alan Antonuk wrote:
>
>> Ping?
>>
>
> ...good point. Merged onto default / rabbitmq_v2_8_x now.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/6013633a/attachment.htm>

From nithyanirmal at gmail.com  Thu Oct  4 23:28:55 2012
From: nithyanirmal at gmail.com (Nithya Vijayakumar)
Date: Thu, 4 Oct 2012 15:28:55 -0700
Subject: [rabbitmq-discuss] do we need to delete data folder during rpm
	upgrades?
Message-ID: <CAJinw2or6idyKvBT5HCHfwdRLSkz_AOZhrU6gNDQm5CufbMbzA@mail.gmail.com>

Hi,

We recently upgraded from 2.7.1 to 2.8.6. After the rpm upgrade, in some
instances we notice that our two node HA setup doesn't start until the data
folder is deleted. Is this required for upgrades? Is there any
format/schema change that might be needing this?

Thanks,
Nithya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/4135cc32/attachment.htm>

From abrightwell at LCE.com  Fri Oct  5 00:13:45 2012
From: abrightwell at LCE.com (Adam Brightwell)
Date: Thu, 4 Oct 2012 23:13:45 +0000
Subject: [rabbitmq-discuss] Re-subscribing to a queue in a cluster
Message-ID: <BD46CD450E3D7843BCE36FF301A8BC4C2AA318A6@LCEEXMB02.LCE.com>

Hello All,

I have been banging my head up against this one for a little while now and
I was hoping that the group could help me wrap my head around the proper
"workflow" for re-subscribing to a mirrored-queue in when a node is "lost".
So, to better understand my scenario here is a line by line description:

1. Create a cluster of two nodes.  Let's call them Node A and Node B.

2. Create a mirrored-queue on Node A and set its "x-ha-policy" to "all" so
that it will be mirrored across to Node B.
3. Subscribe to the mirrored-queue on with a consumer through Node B.
4. Publish message on Node B. Validated consumer received message.
5. Publish message on Node A. Validated consumer received message.
6. "Lose" Node A. (either shutdown or kill to simulate catastrophic
failure)
7. The consumer's "handleCancel(consumerTag)" method is called.

This is where I realize I am suppose to handle the canceling of the
consumer.  I have tried the following in order to "re-subscribe" to the
mirrored-queue that is now owned by Node B since Node A is no longer in
the picture.


1. Create new consumer and call basicConsume on the original channel.
2. Close original channel, recreate channel and call basicConsume with the
new channel.
3. Close the original channel, close the original Connection.  Reconnect,
recreate channel, call basicConsume with the new channel.

Not one of these approaches works.  With each, I have published messages
to the mirrored-queue on Node B.  The messages are either not consumed OR
they will be consumed and unacknowledged.  In the latter case, they are
not being processed by my consumer or at least not making it to the
"handleDelivery()" method.


What am I missing?

Any help, guidance, pointers or words of wisdom from the community would
be greatly appreciated.

Thanks,
Adam


From watson.timothy at gmail.com  Fri Oct  5 08:05:07 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 5 Oct 2012 08:05:07 +0100
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <1349356949777-22362.post@n5.nabble.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
	<1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>
	<5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>
	<E66D7093-DBAF-4A34-BF67-2C2923D0D744@rabbitmq.com>
	<1349296620851-22327.post@n5.nabble.com>
	<10C8AE39-4224-4026-806D-B93419923B55@rabbitmq.com>
	<BF222C64-132D-4DC0-BACE-A0BABBB8A3D2@rabbitmq.com>
	<1349350833151-22357.post@n5.nabble.com>
	<BCA0033E-3329-4AD5-8A9A-5223A655627E@rabbitmq.com>
	<B6F36AED-E58B-48C8-841F-8E71160F6B89@rabbitmq.com>
	<1349356949777-22362.post@n5.nabble.com>
Message-ID: <F95E5E62-4083-450A-B1C9-F6AE80AB071D@rabbitmq.com>

Prabodh,

On 4 Oct 2012, at 14:22, Prabodh Upreti <prabodh.upreti at vce.com> wrote:

> Perfect.  Hope this is my last question.
> 
> I will have many clients interacting with the broker.  I need to really
> control what they can do with the system.  I am planning to publish filters
> they can subscribe to via REST interfaces.
> 
> 1.  How can I give them permissions so they can only create exclusive = true 
> queues.
> 

Afaik that is not currently possible, so you'll have to enforce this in your application(s). Ironically if the queues were not exclusive then you could delegate the queue.declare to a utility layer in the rest service and simply return the queue name, but of course you'd then have to deal with monitoring the client(s) and deal with disconnects yourself. There are probably several variations on this theme too, with intermediary clients or brokers handling the upstream connectivity and so on, not to mention the potential to use federation and/or shovel  to achieve some of this middle man's role. Ultimately though, I suspect that the complexity outweighs the benefits every time.

Personally I would take the reduced complexity of exclusive queues bound to the topic exchange and live with the potential loophole, especially if I'm in control of the client code base(es). If it is important to try hard to avoid letting clients create queues with the wrong parameters, then the best approach IMO would be to write a simplified high level API that sits on top of the AMQP client and (have consumers) code the clients against that, hiding the details of the connection and to some extend the underlying technology from them.

> 2.  The reason I was going with the pre-built queue was so that I could have
> 5 keys bound to the FIXED named queue and they would not need to worry about
> binding all the keys to their temp queue.  If they can't do that then I just 
> have to inform them about the keys so they can use the right ones.  Please
> let me know if there is a better way to manage this.
> 

That sounds like a workable Domitian to me. Getting the keys from a service call or via an additional application wide control channel are both pretty common approaches in the integration space.

> Once again thank you both for you feedback.
> 
> regards
> 
> prabodh
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/share-a-pre-built-queue-tp22319p22362.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From yhtonline at gmail.com  Fri Oct  5 08:14:46 2012
From: yhtonline at gmail.com (yuan hongtao)
Date: Fri, 5 Oct 2012 15:14:46 +0800
Subject: [rabbitmq-discuss] How can we stop rpcserver gracefully?
In-Reply-To: <506D5722.6070603@rabbitmq.com>
References: <9bff4849-4fcb-44e8-a78d-bacd8ce64705@googlegroups.com>
	<506D5722.6070603@rabbitmq.com>
Message-ID: <CAF+7jKqjgcS+xx+00CcV4GqsZHLL=4vz+HOm1RhU_pq7g27sPw@mail.gmail.com>

Thanks Emile for the response and help.
We really want to have a function for terminating rpc server, when clients
still sending msg to that, I mean, that function will make rpc server stop
to recieve new msg from que, and we can stop rpc server easyly and
gracefully.

or any suggestion/best practices for stopping rpc server will be very
appreciated!

2012/10/4 Emile Joubert <emile at rabbitmq.com>

> Hi,
>
> On 04/10/12 04:10, Hongtao wrote:
> > but, for shtutting down rpc server,  how can we make sure all
> > messages have been dealt with, and no msg lost. we want a graceful
> > shutdown process, seems no document talking about that.
> >
> > if we call: execService.shutdown();
> >
> > Consumer.handleDelivery will not be triggerred then?
>
> If you make sure not to acknowledge RPC requests until after sending the
> RPC reply then message will not be lost, even if you shut down the RPC
> server. Your clients must be prepared to handle duplicates though, as
> replies might be sent more than once.
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121005/67068236/attachment.htm>

From watson.timothy at gmail.com  Fri Oct  5 08:23:04 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 5 Oct 2012 08:23:04 +0100
Subject: [rabbitmq-discuss] share a pre-built queue
In-Reply-To: <F95E5E62-4083-450A-B1C9-F6AE80AB071D@rabbitmq.com>
References: <693B3AE2852C4F4384A26CC7C50072EE05BF84FC@MX14A.corp.emc.com>
	<1E61E49C-0A87-4A3A-96A3-117F334E0D6C@rabbitmq.com>
	<5C34B914-1183-48B3-9C1B-8C3D3082C422@rabbitmq.com>
	<E66D7093-DBAF-4A34-BF67-2C2923D0D744@rabbitmq.com>
	<1349296620851-22327.post@n5.nabble.com>
	<10C8AE39-4224-4026-806D-B93419923B55@rabbitmq.com>
	<BF222C64-132D-4DC0-BACE-A0BABBB8A3D2@rabbitmq.com>
	<1349350833151-22357.post@n5.nabble.com>
	<BCA0033E-3329-4AD5-8A9A-5223A655627E@rabbitmq.com>
	<B6F36AED-E58B-48C8-841F-8E71160F6B89@rabbitmq.com>
	<1349356949777-22362.post@n5.nabble.com>
	<F95E5E62-4083-450A-B1C9-F6AE80AB071D@rabbitmq.com>
Message-ID: <BA9B96DA-E08C-476A-A366-BC86A43785DC@rabbitmq.com>

Erm, thanks autocorrect!

On 5 Oct 2012, at 08:05, Tim Watson <watson.timothy at gmail.com> wrote:

>  the details of the connection and to some extend the underlying technology from them.
> 

s/extend/extent

> 
> That sounds like a workable Domitian to me.

s/Domitian/solution
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121005/9ab6e3fe/attachment.htm>

From michal.a.michalak at gmail.com  Thu Oct  4 15:50:05 2012
From: michal.a.michalak at gmail.com (=?UTF-8?Q?Micha=C5=82_Michalak?=)
Date: Thu, 4 Oct 2012 07:50:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Finding out only unacked messages
Message-ID: <db18ed0e-fdc0-4615-9189-8e0e189569cb@googlegroups.com>

Hello. I am seeking to filter out only messages that have been taken for 
consumption but not acked properly. I am working with service which normal 
workflow is: take message, work with it for some time, ack it when work is 
completed. Now consider situation when producer service puts a message in 
queue, then consumer service takes message and dies during work. Since 
there was no ack, message stays in queue. There was no intentional reject 
because service is down. I wouldn't want to use TTL because it can happen 
that one service quickly bursts with few thousands messages for another 
service to process them slowly one by one, so they will be waiting in queue 
quite some time and that can't be consider an error. My goal is to avoid 
looping when service will recover, then take again the message, again goes 
down during work with no ack, recover again, etc. The best solution would 
be to filter out 

Many thanks for any help and/or possible design pattern.
MM
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/f643cfd1/attachment.htm>

From jacob at cookiejunkie.com  Fri Oct  5 02:15:40 2012
From: jacob at cookiejunkie.com (jgyllen)
Date: Thu, 4 Oct 2012 18:15:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Declaring bindings by an app that is not the
	consumer
Message-ID: <fbdec0be-23e6-42e4-82fc-26e97b2861ff@googlegroups.com>

I'm building an app where producers need to have messages routed to 
consumers. The producers are web app instances and the consumers are 
stateful backend servers that are responsible for processing messages 
tagged with a specific label. Deciding which consumer is responsible for a 
specific label is decided by a third app (called the "broker"). A consumer 
is responsible for one or more labels and no two consumers are responsible 
for the same one. The responsibilities can change over time depending on 
the load or availability of backend servers. Each consumer has one queue 
and its labels are set using bindings with the routing key as the label.

Now I'm wondering who should declare the bindings. In all RabbitMQ examples 
I have seen and other apps I have worked on, the bindings are declared by 
the consumer. To follow that convention the broker would need to notify the 
backend servers for them to declare the correct bindings. Or I'm wondering 
if the broker could do it, and if so, are there any drawbacks?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/230a1515/attachment.htm>

From tobias.wissmueller at googlemail.com  Fri Oct  5 07:05:07 2012
From: tobias.wissmueller at googlemail.com (=?UTF-8?Q?Tobias_Wissm=C3=BCller?=)
Date: Thu, 4 Oct 2012 23:05:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Problem installing RabbitMQ with Puppet on
	CentOS 6.2
Message-ID: <5a61a2fa-495c-49dd-8345-d6a591ea2832@googlegroups.com>

Hi Everyone,

I encounter a strange problem when applying my puppet module I have created 
for installing RabbitMQ. To be more precise, I encounter the problem when 
enabling the plugins. 

The relevant resources look as follows:

$version = "2.8.7"
$url     = "http://www.rabbitmq.com/releases/rabbitmq-server/v${version}/rabbitmq-server-${version}-1.noarch.rpm"

package{"erlang":
    ensure => "present",
}

package{"rabbitmq-server":
    provider => "rpm",
    source   => $url,
    require  => Package["erlang"]
}

exec{"rabbitmq-plugins":
    path    => "/usr/bin:/usr/sbin:/bin",
    command => "rabbitmq-plugins enable rabbitmq_management",
    require => Package["rabbitmq-server"]
}


The error I get:

/Stage[main]/Rabbitmq/Exec[rabbitmq-plugins]/returns: erlexec: HOME must be set

/Stage[main]/Rabbitmq/Service[rabbitmq-server]: Dependency Exec[rabbitmq-plugins] has failures: true

The thing is, that HOME is set. Have checked that during a puppet run by 
creating an exec resource to echo HOME.

When I log into the box that I create with veewee and vagrant, I can 
execute "rabbitmq-plugins enable rabbitmq_management" without any problems. 
But I always get the error from within puppet.

Starting rabbitmq-server leaves me with the following:

[{pid,2834},
{running_applications,[{rabbit,"RabbitMQ","2.8.7"},
                    {ssl,"Erlang/OTP SSL application","4.1.6"},
                    {public_key,"Public key infrastructure","0.13"},
                    {crypto,"CRYPTO version 2","2.0.4"},
                    {mnesia,"MNESIA  CXC 138 12","4.5"},
                    {os_mon,"CPO  CXC 138 46","2.2.7"},
                    {sasl,"SASL  CXC 138 11","2.1.10"},
                    {stdlib,"ERTS  CXC 138 10","1.17.5"},
                    {kernel,"ERTS  CXC 138 10","2.14.5"}]},
{os,{unix,linux}},
{erlang_version,"Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1] [async-threads:30] [kernel-poll:true]\n"},
{memory,[{total,24993120},
      {processes,10328496},
      {processes_used,10321296},
      {system,14664624},
      {atom,1175905},
      {atom_used,1143841},
      {binary,17192},
      {code,11416020},
      {ets,766168}]},
{vm_memory_high_watermark,0.4},
{vm_memory_limit,205851852},
{disk_free_limit,1000000000},
{disk_free,7089795072},
{file_descriptors,[{total_limit,924},
                {total_used,4},
                {sockets_limit,829},
                {sockets_used,2}]},
{processes,[{limit,1048576},{used,131}]},
{run_queue,0},
{uptime,6}]


The whole puppet manifest can be found under 
https://github.com/tobias-wissmueller/dev_ops_central/blob/master/modules/rabbitmq/manifests/init.pp

Also have posted this problem over at Serverfault<http://serverfault.com/questions/434942/veewee-vagrant-puppet-erlang-and-rabbitmq>
.

Any help is highly appreciated since I am totally stuck here.

Thanks a lot!

Cheers,
Tobi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/df315e5f/attachment.htm>

From raviv at gigya-inc.com  Thu Oct  4 13:01:43 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Thu, 4 Oct 2012 14:01:43 +0200
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <506D7304.3070801@rabbitmq.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
	<506D7304.3070801@rabbitmq.com>
Message-ID: <CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>

Based on the management UI, memory usage doesn't drop and publishers are
still blocked.

Thanks
*--*Raviv
*
*



On Thu, Oct 4, 2012 at 1:29 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 04/10/12 11:50, Raviv Pavel wrote:
>
>> It seems that when I hit the memory watermark, it doesn't go back to
>> green (and still blocks publishers) even if I purge or delete the queue
>> that caused it.
>> Any idea?
>>
>
> Are you saying that the memory use drops back below the watermark, but the
> memory alarm is still on and thus publishers are blocked, or are you saying
> that the memory use does not drop below the watermark even though you
> purged the queue?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/a68734cb/attachment.htm>

From raviv at gigya-inc.com  Thu Oct  4 16:05:20 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Thu, 4 Oct 2012 17:05:20 +0200
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <506DA3C3.7030008@rabbitmq.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
	<506D7304.3070801@rabbitmq.com>
	<CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>
	<506DA2E4.2050100@rabbitmq.com> <506DA3C3.7030008@rabbitmq.com>
Message-ID: <CACx7p4A2U7aJ3odR9PRPKOU=YRa+iMB=BRBjxzT=Fx1yD4cncw@mail.gmail.com>

All queues are empty and  "rabbitmqctl list_queues name memory" shows they
use about 3K each.
VM memory stats are much lower then the one shown in the overview.
We're using 2.8.1 - I'll try upgrading to 2.8.7

Thanks
*--*Raviv
*
*



On Thu, Oct 4, 2012 at 4:57 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 04/10/12 15:53, Simon MacMullen wrote:
>
>> On 04/10/12 13:01, Raviv Pavel wrote:
>>
>>> Based on the management UI, memory usage doesn't drop and publishers are
>>> still blocked.
>>>
>>
>> Hmm. In that case my first guess would be that the queue you deleted /
>> purged wasn't the queue which was using all the memory. Check the memory
>> use of other queues - this can be found on the queue details page, or
>> with "rabbitmqctl list_queues name memory". Also, check the VM-wide
>> memory statistics (on the node details page, under "advanced". This
>> might give a clue as to where the memory is going.
>>
>
> ...and please make sure you are running the latest version of RabbitMQ
> (2.8.7, atm), since we have fixed a few memory leaks in the in recent
> versions.
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/1198f967/attachment.htm>

From raviv at gigya-inc.com  Thu Oct  4 16:32:21 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Thu, 4 Oct 2012 17:32:21 +0200
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <CACx7p4A2U7aJ3odR9PRPKOU=YRa+iMB=BRBjxzT=Fx1yD4cncw@mail.gmail.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
	<506D7304.3070801@rabbitmq.com>
	<CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>
	<506DA2E4.2050100@rabbitmq.com> <506DA3C3.7030008@rabbitmq.com>
	<CACx7p4A2U7aJ3odR9PRPKOU=YRa+iMB=BRBjxzT=Fx1yD4cncw@mail.gmail.com>
Message-ID: <CACx7p4A15YO5u-ste82O2A_HG5rES4KR+C1u2n2AM48ZM2h9=w@mail.gmail.com>

After upgrading the server won't start. from the logs:

=ERROR REPORT==== 4-Oct-2012::17:11:59 ===
** Generic server <0.341.0> terminating
** Last message in was {'$gen_cast',
                           {method,

 {'queue.declare',0,<<"es1">>,false,true,false,
                                   false,false,
                                   [{<<"x-ha-policy">>,longstr,<<"all">>}]},
                               none,noflow}}


Thanks
*--*Raviv
*
*



On Thu, Oct 4, 2012 at 5:05 PM, Raviv Pavel <raviv at gigya-inc.com> wrote:

> All queues are empty and  "rabbitmqctl list_queues name memory" shows they
> use about 3K each.
> VM memory stats are much lower then the one shown in the overview.
> We're using 2.8.1 - I'll try upgrading to 2.8.7
>
> Thanks
> *--*Raviv
> *
> *
>
>
>
> On Thu, Oct 4, 2012 at 4:57 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:
>
>> On 04/10/12 15:53, Simon MacMullen wrote:
>>
>>> On 04/10/12 13:01, Raviv Pavel wrote:
>>>
>>>> Based on the management UI, memory usage doesn't drop and publishers are
>>>> still blocked.
>>>>
>>>
>>> Hmm. In that case my first guess would be that the queue you deleted /
>>> purged wasn't the queue which was using all the memory. Check the memory
>>> use of other queues - this can be found on the queue details page, or
>>> with "rabbitmqctl list_queues name memory". Also, check the VM-wide
>>> memory statistics (on the node details page, under "advanced". This
>>> might give a clue as to where the memory is going.
>>>
>>
>> ...and please make sure you are running the latest version of RabbitMQ
>> (2.8.7, atm), since we have fixed a few memory leaks in the in recent
>> versions.
>>
>> Matthias.
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/3d15c1a1/attachment.htm>

From raviv at gigya-inc.com  Thu Oct  4 16:38:46 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Thu, 4 Oct 2012 17:38:46 +0200
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <506DACA0.7040208@rabbitmq.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
	<506D7304.3070801@rabbitmq.com>
	<CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>
	<506DA2E4.2050100@rabbitmq.com> <506DA3C3.7030008@rabbitmq.com>
	<CACx7p4A2U7aJ3odR9PRPKOU=YRa+iMB=BRBjxzT=Fx1yD4cncw@mail.gmail.com>
	<CACx7p4A15YO5u-ste82O2A_HG5rES4KR+C1u2n2AM48ZM2h9=w@mail.gmail.com>
	<506DACA0.7040208@rabbitmq.com>
Message-ID: <CACx7p4Cnf6C16C05vL5CU66R16mWWmSK9cU-uPmi2WgP8-OMOg@mail.gmail.com>

Upgraded the other node (there are two) and it fails to start.
Here is the startup log:


+---+   +---+
|   |   |   |
|   |   |   |
|   |   |   |
|   +---+   +-------+
|                   |
| RabbitMQ  +---+   |
|           |   |   |
|   v2.8.7  +---+   |
|                   |
+-------------------+
AMQP 0-9-1 / 0-9 / 0-8
Copyright (C) 2007-2012 VMware, Inc.
Licensed under the MPL.  See http://www.rabbitmq.com/

node           : rabbit at mongo-qa2
app descriptor :
/usr/lib/rabbitmq/lib/rabbitmq_server-2.8.7/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : pu0BlS9+G2N9yLfd51TkmA==
log            : /var/log/rabbitmq/rabbit at mongo-qa2.log
sasl log       : /var/log/rabbitmq/rabbit at mongo-qa2-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at mongo-qa2
erlang version : 5.8.4

-- rabbit boot start
starting file handle cache server
...done
starting worker pool
 ...done
starting database                                                     ...

BOOT FAILED
===========

Error description:
   {error,{failed_to_cluster_with,['rabbit at mongo-qa1'],
                                  "Mnesia could not connect to any disc
nodes."}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at mongo-qa2.log
   /var/log/rabbitmq/rabbit at mongo-qa2-sasl.log

Stack trace:
   [{rabbit_mnesia,init_db,3},
    {rabbit_mnesia,init,0},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
    {rabbit,run_boot_step,1},
    {rabbit,'-start/2-lc$^0/1-0-',1},
    {rabbit,start,2},
    {application_master,start_it_old,4}]

{"Kernel pid
terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}


Thanks
*--*Raviv
*
*



On Thu, Oct 4, 2012 at 5:34 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hard to believe that's to do with the server not starting - can you post a
> more complete log?
>
>
> On 04/10/12 16:32, Raviv Pavel wrote:
>
>> After upgrading the server won't start. from the logs:
>>
>> =ERROR REPORT==== 4-Oct-2012::17:11:59 ===
>> ** Generic server <0.341.0> terminating
>> ** Last message in was {'$gen_cast',
>>                             {method,
>>
>>   {'queue.declare',0,<<"es1">>,**false,true,false,
>>                                     false,false,
>>
>>   [{<<"x-ha-policy">>,longstr,<<**"all">>}]},
>>                                 none,noflow}}
>>
>>
>> Thanks
>> /--/Raviv
>> /
>>
>> /
>>
>>
>>
>> On Thu, Oct 4, 2012 at 5:05 PM, Raviv Pavel <raviv at gigya-inc.com
>> <mailto:raviv at gigya-inc.com>> wrote:
>>
>>     All queues are empty and "rabbitmqctl list_queues name memory" shows
>>     they use about 3K each.
>>     VM memory stats are much lower then the one shown in the overview.
>>     We're using 2.8.1 - I'll try upgrading to 2.8.7
>>
>>     Thanks
>>     /--/Raviv
>>     /
>>     /
>>
>>
>>
>>     On Thu, Oct 4, 2012 <tel:2012> at 4:57 PM, Matthias Radestock
>>
>>     <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>**> wrote:
>>
>>         On 04/10/12 15:53, Simon MacMullen wrote:
>>
>>             On 04/10/12 13:01, Raviv Pavel wrote:
>>
>>                 Based on the management UI, memory usage doesn't drop
>>                 and publishers are
>>                 still blocked.
>>
>>
>>             Hmm. In that case my first guess would be that the queue you
>>             deleted /
>>             purged wasn't the queue which was using all the memory.
>>             Check the memory
>>             use of other queues - this can be found on the queue details
>>             page, or
>>             with "rabbitmqctl list_queues name memory". Also, check the
>>             VM-wide
>>             memory statistics (on the node details page, under
>>             "advanced". This
>>             might give a clue as to where the memory is going.
>>
>>
>>         ...and please make sure you are running the latest version of
>>         RabbitMQ (2.8.7, atm), since we have fixed a few memory leaks in
>>         the in recent versions.
>>
>>         Matthias.
>>
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/6aa90c75/attachment.htm>

From raviv at gigya-inc.com  Thu Oct  4 16:44:22 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Thu, 4 Oct 2012 17:44:22 +0200
Subject: [rabbitmq-discuss] memory flow control
In-Reply-To: <506DA32D.5030500@rabbitmq.com>
References: <0f493c8c-38e1-4a17-95a9-de57d4fd3539@googlegroups.com>
	<5e828191-e9fa-4a67-9b92-fefb0b4cdf70@googlegroups.com>
	<506DA32D.5030500@rabbitmq.com>
Message-ID: <CACx7p4AWe_qG+joee2a3JFYsWVib6S-bKXmAaLcSLuqVX7Likg@mail.gmail.com>

Because it's not slower - it's blocked and the SDK doesn't allow me to
specify a timeout.
So once a rabbit node gets clogged with unacked messages and hits it's
memory watermark, any thread in my app trying to publish will get blocked
forever.
I've been looking at the source for the .NET SDK (which w'ere using) and it
blocks on flushing to the TCP stream.
I ended up modifying the SDK to set a send timeout on the socket, so when
the server blocks producers, I get an exception after 2 seconds instead of
being blocked.

Thanks
*--*Raviv
*
*



On Thu, Oct 4, 2012 at 4:54 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 04/10/12 11:47, Raviv Pavel wrote:
>
>> I think I've read somewhere that it's not currently possible.
>> I need the same thing :(
>>
>> On Tuesday, September 25, 2012 11:47:18 PM UTC+2, Dmitriy Stolyarov
>> wrote:
>>
>>     Hi,
>>     Is there a way to have the producer throw an exception instead of
>>     just being blocked when high memory water mark is reached on the
>>     server? (Using java client)
>>
>
> Why you would want to treat this condition any different from a network
> delay/disruption or a slow server?
>
> It possible to detect that, indirectly, using a technique I described in
> http://rabbitmq.1065348.n5.**nabble.com/Memory-Management-**
> Concerns-Questions-**tp13225p13233.html<http://rabbitmq.1065348.n5.nabble.com/Memory-Management-Concerns-Questions-tp13225p13233.html>(which I shall henceforth call "user level EWOULDBLOCK" ;)
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/dbd7270e/attachment.htm>

From raviv at gigya-inc.com  Thu Oct  4 16:57:22 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Thu, 4 Oct 2012 17:57:22 +0200
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <CACx7p4Cnf6C16C05vL5CU66R16mWWmSK9cU-uPmi2WgP8-OMOg@mail.gmail.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
	<506D7304.3070801@rabbitmq.com>
	<CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>
	<506DA2E4.2050100@rabbitmq.com> <506DA3C3.7030008@rabbitmq.com>
	<CACx7p4A2U7aJ3odR9PRPKOU=YRa+iMB=BRBjxzT=Fx1yD4cncw@mail.gmail.com>
	<CACx7p4A15YO5u-ste82O2A_HG5rES4KR+C1u2n2AM48ZM2h9=w@mail.gmail.com>
	<506DACA0.7040208@rabbitmq.com>
	<CACx7p4Cnf6C16C05vL5CU66R16mWWmSK9cU-uPmi2WgP8-OMOg@mail.gmail.com>
Message-ID: <CACx7p4Ab=awWVHzjYFx=rTAo4S2vMzeBJ=wZLMyea3SZ6BYeuw@mail.gmail.com>

On a hunch I went on and upgraded the other node in the cluster which
didn't start either.
Trying to start the first node again worked and now both are up.

Back to the original problem:
1. I set the watermark very low so I can reach it, effectively  78MB
2. server starts with empty queues and memory usage is 66MB
3. I start publishing messages and reach the watermark
4. publisher gets blocked
5. I purge the queue but memory stays the same

Thanks
*--*Raviv
*
*



On Thu, Oct 4, 2012 at 5:38 PM, Raviv Pavel <raviv at gigya-inc.com> wrote:

> Upgraded the other node (there are two) and it fails to start.
> Here is the startup log:
>
>
> +---+   +---+
> |   |   |   |
> |   |   |   |
> |   |   |   |
> |   +---+   +-------+
> |                   |
> | RabbitMQ  +---+   |
> |           |   |   |
> |   v2.8.7  +---+   |
> |                   |
> +-------------------+
> AMQP 0-9-1 / 0-9 / 0-8
> Copyright (C) 2007-2012 VMware, Inc.
> Licensed under the MPL.  See http://www.rabbitmq.com/
>
> node           : rabbit at mongo-qa2
> app descriptor :
> /usr/lib/rabbitmq/lib/rabbitmq_server-2.8.7/sbin/../ebin/rabbit.app
> home dir       : /var/lib/rabbitmq
> config file(s) : (none)
> cookie hash    : pu0BlS9+G2N9yLfd51TkmA==
> log            : /var/log/rabbitmq/rabbit at mongo-qa2.log
> sasl log       : /var/log/rabbitmq/rabbit at mongo-qa2-sasl.log
> database dir   : /var/lib/rabbitmq/mnesia/rabbit at mongo-qa2
> erlang version : 5.8.4
>
> -- rabbit boot start
> starting file handle cache server
> ...done
> starting worker pool
>  ...done
> starting database                                                     ...
>
> BOOT FAILED
> ===========
>
> Error description:
>    {error,{failed_to_cluster_with,['rabbit at mongo-qa1'],
>                                   "Mnesia could not connect to any disc
> nodes."}}
>
> Log files (may contain more information):
>    /var/log/rabbitmq/rabbit at mongo-qa2.log
>    /var/log/rabbitmq/rabbit at mongo-qa2-sasl.log
>
> Stack trace:
>    [{rabbit_mnesia,init_db,3},
>     {rabbit_mnesia,init,0},
>     {rabbit,'-run_boot_step/1-lc$^1/1-1-',1},
>     {rabbit,run_boot_step,1},
>     {rabbit,'-start/2-lc$^0/1-0-',1},
>     {rabbit,start,2},
>     {application_master,start_it_old,4}]
>
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}}"}
>
>
> Thanks
> *--*Raviv
> *
> *
>
>
>
> On Thu, Oct 4, 2012 at 5:34 PM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> Hard to believe that's to do with the server not starting - can you post
>> a more complete log?
>>
>>
>> On 04/10/12 16:32, Raviv Pavel wrote:
>>
>>> After upgrading the server won't start. from the logs:
>>>
>>> =ERROR REPORT==== 4-Oct-2012::17:11:59 ===
>>> ** Generic server <0.341.0> terminating
>>> ** Last message in was {'$gen_cast',
>>>                             {method,
>>>
>>>   {'queue.declare',0,<<"es1">>,**false,true,false,
>>>                                     false,false,
>>>
>>>   [{<<"x-ha-policy">>,longstr,<<**"all">>}]},
>>>                                 none,noflow}}
>>>
>>>
>>> Thanks
>>> /--/Raviv
>>> /
>>>
>>> /
>>>
>>>
>>>
>>> On Thu, Oct 4, 2012 at 5:05 PM, Raviv Pavel <raviv at gigya-inc.com
>>> <mailto:raviv at gigya-inc.com>> wrote:
>>>
>>>     All queues are empty and "rabbitmqctl list_queues name memory" shows
>>>     they use about 3K each.
>>>     VM memory stats are much lower then the one shown in the overview.
>>>     We're using 2.8.1 - I'll try upgrading to 2.8.7
>>>
>>>     Thanks
>>>     /--/Raviv
>>>     /
>>>     /
>>>
>>>
>>>
>>>     On Thu, Oct 4, 2012 <tel:2012> at 4:57 PM, Matthias Radestock
>>>
>>>     <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>**> wrote:
>>>
>>>         On 04/10/12 15:53, Simon MacMullen wrote:
>>>
>>>             On 04/10/12 13:01, Raviv Pavel wrote:
>>>
>>>                 Based on the management UI, memory usage doesn't drop
>>>                 and publishers are
>>>                 still blocked.
>>>
>>>
>>>             Hmm. In that case my first guess would be that the queue you
>>>             deleted /
>>>             purged wasn't the queue which was using all the memory.
>>>             Check the memory
>>>             use of other queues - this can be found on the queue details
>>>             page, or
>>>             with "rabbitmqctl list_queues name memory". Also, check the
>>>             VM-wide
>>>             memory statistics (on the node details page, under
>>>             "advanced". This
>>>             might give a clue as to where the memory is going.
>>>
>>>
>>>         ...and please make sure you are running the latest version of
>>>         RabbitMQ (2.8.7, atm), since we have fixed a few memory leaks in
>>>         the in recent versions.
>>>
>>>         Matthias.
>>>
>>>
>>>
>>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121004/a1fd0efb/attachment.htm>

From emile at rabbitmq.com  Fri Oct  5 10:06:13 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 05 Oct 2012 10:06:13 +0100
Subject: [rabbitmq-discuss] Finding out only unacked messages
In-Reply-To: <db18ed0e-fdc0-4615-9189-8e0e189569cb@googlegroups.com>
References: <db18ed0e-fdc0-4615-9189-8e0e189569cb@googlegroups.com>
Message-ID: <506EA305.3020300@rabbitmq.com>

Hi Micha?,

On 04/10/12 15:50, Micha? Michalak wrote:
> Now consider situation when producer service puts a message in queue,
> then consumer service takes message and dies during work. Since there
> was no ack, message stays in queue.

If a consumer dies then all unacknowledged messages are requeued.
Another consumer can then consume such messages which will have the
redelivered flag set.

> The best solution would be to filter out 

It is not possible to ask the broker to only deliver some kinds of
messages when consuming from a queue. Messages will be delivered in the
order that they appear in the queue.


-Emile


From emile at rabbitmq.com  Fri Oct  5 10:26:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 05 Oct 2012 10:26:45 +0100
Subject: [rabbitmq-discuss] How can we stop rpcserver gracefully?
In-Reply-To: <CAF+7jKqjgcS+xx+00CcV4GqsZHLL=4vz+HOm1RhU_pq7g27sPw@mail.gmail.com>
References: <9bff4849-4fcb-44e8-a78d-bacd8ce64705@googlegroups.com>
	<506D5722.6070603@rabbitmq.com>
	<CAF+7jKqjgcS+xx+00CcV4GqsZHLL=4vz+HOm1RhU_pq7g27sPw@mail.gmail.com>
Message-ID: <506EA7D5.3070908@rabbitmq.com>

Hi,

On 05/10/12 08:14, yuan hongtao wrote:
> We really want to have a function for terminating rpc server, when
> clients still sending msg to that, I mean, that function will make rpc
> server stop to recieve new msg from que, and we can stop rpc server
> easyly and gracefully.

You could define a special 'stop' message which the server interprets as
a request to shut down. How you propagate that request to the
ExecutorService and beyond will depend on the specifics of your
implementation.


-Emile



From emile at rabbitmq.com  Fri Oct  5 10:39:57 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 05 Oct 2012 10:39:57 +0100
Subject: [rabbitmq-discuss] Declaring bindings by an app that is not the
 consumer
In-Reply-To: <fbdec0be-23e6-42e4-82fc-26e97b2861ff@googlegroups.com>
References: <fbdec0be-23e6-42e4-82fc-26e97b2861ff@googlegroups.com>
Message-ID: <506EAAED.9000708@rabbitmq.com>

Hi,

On 05/10/12 02:15, jgyllen wrote:
> Or I'm wondering if the broker could do it, and if so, are
> there any drawbacks?

Nothing is set in stone about who must manage bindings. If you have a
dedicated service separate from consumers that knows how to configure
bindings then allow it to  take that responsibility.

Bear in mind that it is not possible to perform an unbind and a bind
atomically, regardless of who manages the bindings. "Moving" a label
might introduce to the tiny risk of messages being delivered to multiple
queues or not being routed to any queue, depending on the order of the
bind and unbind. The latter case can be detected if the publisher uses
the mandatory flag:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish.mandatory

-Emile



From simon at rabbitmq.com  Fri Oct  5 10:35:27 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Oct 2012 10:35:27 +0100
Subject: [rabbitmq-discuss] do we need to delete data folder during rpm
 upgrades?
In-Reply-To: <CAJinw2or6idyKvBT5HCHfwdRLSkz_AOZhrU6gNDQm5CufbMbzA@mail.gmail.com>
References: <CAJinw2or6idyKvBT5HCHfwdRLSkz_AOZhrU6gNDQm5CufbMbzA@mail.gmail.com>
Message-ID: <506EA9DF.4080402@rabbitmq.com>

On 04/10/12 23:28, Nithya Vijayakumar wrote:
> We recently upgraded from 2.7.1 to 2.8.6. After the rpm upgrade, in some
> instances we notice that our two node HA setup doesn't start until the
> data folder is deleted. Is this required for upgrades? Is there any
> format/schema change that might be needing this?

There are schema changes, but RabbitMQ should take care of them for you 
automatically. What are you seeing when it doesn't start?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Oct  5 10:45:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Oct 2012 10:45:57 +0100
Subject: [rabbitmq-discuss] Problem installing RabbitMQ with Puppet on
 CentOS 6.2
In-Reply-To: <5a61a2fa-495c-49dd-8345-d6a591ea2832@googlegroups.com>
References: <5a61a2fa-495c-49dd-8345-d6a591ea2832@googlegroups.com>
Message-ID: <506EAC55.7040003@rabbitmq.com>

Hmm. There's nothing very obvious that I can think of. I've looked in 
the OTP source and that message really only appears if HOME is not set.

Things you might try:

* Run /usr/lib/rabbitmq/bin/rabbitmq-plugins instead, to remove a 
wrapper script

* Edit /usr/lib/rabbitmq/bin/rabbitmq-plugins to insert "echo $HOME" 
just before "exec erl", see if it's really set at that point.

* If all else fails, edit the enabled plugins file directly rather than 
invoking rabbitmq-plugins. Set the contents of 
/etc/rabbitmq/enabled_plugins to exactly the string:

[rabbitmq_management].

including the full stop.

Cheers, Simon

On 05/10/12 07:05, Tobias Wissm?ller wrote:
> Hi Everyone,
>
> I encounter a strange problem when applying my puppet module I have
> created for installing RabbitMQ. To be more precise, I encounter the
> problem when enabling the plugins.
>
> The relevant resources look as follows:
>
> |$version = "2.8.7"
> $url     = "http://www.rabbitmq.com/releases/rabbitmq-server/v${version}/rabbitmq-server-${version}-1.noarch.rpm"
>
> package{"erlang":
>      ensure => "present",
> }
>
> package{"rabbitmq-server":
>      provider => "rpm",
>      source   => $url,
>      require  => Package["erlang"]
> }
>
> exec{"rabbitmq-plugins":
>      path    => "/usr/bin:/usr/sbin:/bin",
>      command => "rabbitmq-plugins enable rabbitmq_management",
>      require => Package["rabbitmq-server"]
> }|
>
>
> The error I get:
>
> |/Stage[main]/Rabbitmq/Exec[rabbitmq-plugins]/returns: erlexec: HOME must be set|
>
> |/Stage[main]/Rabbitmq/Service[rabbitmq-server]: Dependency Exec[rabbitmq-plugins] has failures: true
> |
>
> The thing is, that HOME is set. Have checked that during a puppet run by
> creating an exec resource to echo HOME.
>
> When I log into the box that I create with veewee and vagrant, I can
> execute "rabbitmq-plugins enable rabbitmq_management" without any
> problems. But I always get the error from within puppet.
>
> Starting rabbitmq-server leaves me with the following:
>
> |[{pid,2834},
> {running_applications,[{rabbit,"RabbitMQ","2.8.7"},
>                      {ssl,"Erlang/OTP SSL application","4.1.6"},
>                      {public_key,"Public key infrastructure","0.13"},
>                      {crypto,"CRYPTO version 2","2.0.4"},
>                      {mnesia,"MNESIA  CXC 138 12","4.5"},
>                      {os_mon,"CPO  CXC 138 46","2.2.7"},
>                      {sasl,"SASL  CXC 138 11","2.1.10"},
>                      {stdlib,"ERTS  CXC 138 10","1.17.5"},
>                      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
> {os,{unix,linux}},
> {erlang_version,"Erlang R14B04 (erts-5.8.5) [source] [64-bit] [rq:1] [async-threads:30] [kernel-poll:true]\n"},
> {memory,[{total,24993120},
>        {processes,10328496},
>        {processes_used,10321296},
>        {system,14664624},
>        {atom,1175905},
>        {atom_used,1143841},
>        {binary,17192},
>        {code,11416020},
>        {ets,766168}]},
> {vm_memory_high_watermark,0.4},
> {vm_memory_limit,205851852},
> {disk_free_limit,1000000000},
> {disk_free,7089795072},
> {file_descriptors,[{total_limit,924},
>                  {total_used,4},
>                  {sockets_limit,829},
>                  {sockets_used,2}]},
> {processes,[{limit,1048576},{used,131}]},
> {run_queue,0},
> {uptime,6}]|
>
>
> The whole puppet manifest can be found under
> https://github.com/tobias-wissmueller/dev_ops_central/blob/master/modules/rabbitmq/manifests/init.pp
>
> Also have posted this problem over at Serverfault
> <http://serverfault.com/questions/434942/veewee-vagrant-puppet-erlang-and-rabbitmq>.
>
> Any help is highly appreciated since I am totally stuck here.
>
> Thanks a lot!
>
> Cheers,
> Tobi
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Oct  5 11:21:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 05 Oct 2012 11:21:01 +0100
Subject: [rabbitmq-discuss] Statistics database could not be contacted.
 Message rates and queue lengths will not be shown.
In-Reply-To: <CAHv8OSQs5eyyY11SVpQijqQro9C+Va_9_jXjubBxJFte-jt5mA@mail.gmail.com>
References: <CAHv8OSQ7UJ9L_s+rLJaJeMJ_v8LNcLvkWorotrhSCi1JX=nWYg@mail.gmail.com>
	<506D5668.7040205@rabbitmq.com>
	<CAHv8OSQs5eyyY11SVpQijqQro9C+Va_9_jXjubBxJFte-jt5mA@mail.gmail.com>
Message-ID: <506EB48D.3010100@rabbitmq.com>

Hmm. I see various messages about network partitions in the logs; that's 
not encouraging. We really don't recommend use of clusters on networks 
that may be subject to partitions. I suspect that may be the root of the 
problem.

Cheers, Simon

On 04/10/12 10:36, Wong Kam Hoong wrote:
> Hi Simon,
>
> The RabbitMQ was clustered (3 RabbitMQs), attached are the full log. The
> problem happened in between 3-Oct to 4-Oct, I upgraded RabbitMQ to
> v2.8.7 on 3-Oct.
>
> Thanks & Regards,
> Wong
>
>
> On Thu, Oct 4, 2012 at 5:27 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Hi. There's no good set of circumstances to see that message - the
>     stats db should be restarted if it fails. Is this clustered or
>     standalone? Can you post logs?
>
>     Cheers, Simon
>
>
>     On 03/10/12 22:56, Wong Kam Hoong wrote:
>
>         Hi RabbitMQ  team,
>
>         Recently I upgrade my rabbitmq nodes with the latest version
>         2.8.7, but
>         i saw weird message show on the web admin page:
>
>         "Statistics database could not be contacted. Message rates and queue
>         lengths will not be shown."
>
>         I not able to see any statistic such as current produce/consume
>         rate,
>         and how many messages in each queue.
>
>         Please advise how can i enable back the statistic.
>
>         Regards,
>         Wong
>
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From mpietrek at skytap.com  Fri Oct  5 17:13:33 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 5 Oct 2012 09:13:33 -0700
Subject: [rabbitmq-discuss] Statistics database could not be contacted.
 Message rates and queue lengths will not be shown.
In-Reply-To: <506EB48D.3010100@rabbitmq.com>
References: <CAHv8OSQ7UJ9L_s+rLJaJeMJ_v8LNcLvkWorotrhSCi1JX=nWYg@mail.gmail.com>
	<506D5668.7040205@rabbitmq.com>
	<CAHv8OSQs5eyyY11SVpQijqQro9C+Va_9_jXjubBxJFte-jt5mA@mail.gmail.com>
	<506EB48D.3010100@rabbitmq.com>
Message-ID: <CACLE7iy+KYPiE_zoignvjFgwrj-b6uhsr8Z-+V+kPdq+oNFUxw@mail.gmail.com>

> We really don't recommend use of clusters on networks that may be subject
to partitions.

A follow up question then. We run our brokers in clusters, and hopefully
nothing ever goes down, we never have network partitions, etc... (and in
fact, we've had clusters running for months at a time without issue.)

The question is, in the unfortunate event of a network partition, should we
just expect to lose the capability of the statistics database? It's
important for us to know, as I've written additional tooling that uses the
HTTP API to manipulate various things, and when the stats database isn't
available, various fields returned by the HTTP APIs (like message counts)
seem to vanish.

Thanks,

Matt

On Fri, Oct 5, 2012 at 3:21 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hmm. I see various messages about network partitions in the logs; that's
> not encouraging. We really don't recommend use of clusters on networks that
> may be subject to partitions. I suspect that may be the root of the problem.
>
> Cheers, Simon
>
>
> On 04/10/12 10:36, Wong Kam Hoong wrote:
>
>> Hi Simon,
>>
>> The RabbitMQ was clustered (3 RabbitMQs), attached are the full log. The
>> problem happened in between 3-Oct to 4-Oct, I upgraded RabbitMQ to
>> v2.8.7 on 3-Oct.
>>
>> Thanks & Regards,
>> Wong
>>
>>
>> On Thu, Oct 4, 2012 at 5:27 PM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     Hi. There's no good set of circumstances to see that message - the
>>     stats db should be restarted if it fails. Is this clustered or
>>     standalone? Can you post logs?
>>
>>     Cheers, Simon
>>
>>
>>     On 03/10/12 22:56, Wong Kam Hoong wrote:
>>
>>         Hi RabbitMQ  team,
>>
>>         Recently I upgrade my rabbitmq nodes with the latest version
>>         2.8.7, but
>>         i saw weird message show on the web admin page:
>>
>>         "Statistics database could not be contacted. Message rates and
>> queue
>>         lengths will not be shown."
>>
>>         I not able to see any statistic such as current produce/consume
>>         rate,
>>         and how many messages in each queue.
>>
>>         Please advise how can i enable back the statistic.
>>
>>         Regards,
>>         Wong
>>
>>
>>
>>         ______________________________**___________________
>>         rabbitmq-discuss mailing list
>>         rabbitmq-discuss at lists.__rabbi**tmq.com <http://rabbitmq.com>
>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>         https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>
>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, VMware
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121005/4525cf4b/attachment.htm>

From nithyanirmal at gmail.com  Fri Oct  5 18:52:19 2012
From: nithyanirmal at gmail.com (Nithya Vijayakumar)
Date: Fri, 5 Oct 2012 10:52:19 -0700
Subject: [rabbitmq-discuss] do we need to delete data folder during rpm
	upgrades?
In-Reply-To: <506EA9DF.4080402@rabbitmq.com>
References: <CAJinw2or6idyKvBT5HCHfwdRLSkz_AOZhrU6gNDQm5CufbMbzA@mail.gmail.com>
	<506EA9DF.4080402@rabbitmq.com>
Message-ID: <CAJinw2rWhAYSM3th4m--CH4_Evxfu=_5nR9vCgno=XAM5xrZjw@mail.gmail.com>

Thanks Simon. After the rpm upgrade, when we try to start the nodes and
they error out. We also tried killall -u rabbitmq before restart. Issue
doesn't happen always, only once in a while.

       {merge_schema_failed,

               "Bad cookie in table definition rabbit_topic_trie_node:...


After we delete the data folder, rabbitmq starts fine. We would prefer not
to delete the data folder as we need to copy out the queues and users and
restore them.

Thanks,

Nithya


On Fri, Oct 5, 2012 at 2:35 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 04/10/12 23:28, Nithya Vijayakumar wrote:
>
>> We recently upgraded from 2.7.1 to 2.8.6. After the rpm upgrade, in some
>> instances we notice that our two node HA setup doesn't start until the
>> data folder is deleted. Is this required for upgrades? Is there any
>> format/schema change that might be needing this?
>>
>
> There are schema changes, but RabbitMQ should take care of them for you
> automatically. What are you seeing when it doesn't start?
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121005/5c392f2b/attachment.htm>

From jacob at cookiejunkie.com  Fri Oct  5 19:03:56 2012
From: jacob at cookiejunkie.com (Jacob Gyllenstierna)
Date: Fri, 5 Oct 2012 11:03:56 -0700
Subject: [rabbitmq-discuss] Declaring bindings by an app that is not the
	consumer
In-Reply-To: <506EAAED.9000708@rabbitmq.com>
References: <fbdec0be-23e6-42e4-82fc-26e97b2861ff@googlegroups.com>
	<506EAAED.9000708@rabbitmq.com>
Message-ID: <CA+284Rd94iuofBM4a76M2qt9ZbXJVOskXFxpE4NjmcwhzGvcpw@mail.gmail.com>

Thanks Emile. Will give that a try.

Btw, do you know why your reply doesn't show up on the web?


On Fri, Oct 5, 2012 at 2:39 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 05/10/12 02:15, jgyllen wrote:
> > Or I'm wondering if the broker could do it, and if so, are
> > there any drawbacks?
>
> Nothing is set in stone about who must manage bindings. If you have a
> dedicated service separate from consumers that knows how to configure
> bindings then allow it to  take that responsibility.
>
> Bear in mind that it is not possible to perform an unbind and a bind
> atomically, regardless of who manages the bindings. "Moving" a label
> might introduce to the tiny risk of messages being delivered to multiple
> queues or not being routed to any queue, depending on the order of the
> bind and unbind. The latter case can be detected if the publisher uses
> the mandatory flag:
>
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish.mandatory
>
> -Emile
>
>
>


-- 
Jacob Gyllenstierna
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121005/25655916/attachment.htm>

From tim at rabbitmq.com  Fri Oct  5 21:33:57 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 5 Oct 2012 21:33:57 +0100
Subject: [rabbitmq-discuss] RabbitMQ very slow (or never) shuts down
In-Reply-To: <9BD373B8-8A11-45CA-8CE4-A0AD7EC5F29C@rabbitmq.com>
References: <CACLE7iwmsR=_E5EnhZuG3E7Zn+rhaNq32UpnRGMyAhhg7VG_Ww@mail.gmail.com>
	<CACLE7iykNc1pe4RP+chkS3iAkMLixv-rfOqDzOwa2YmboOtPYQ@mail.gmail.com>
	<5051BD53.3000401@rabbitmq.com>
	<B353EDDF-D85F-475B-B93A-9E99FDF2EA31@rabbitmq.com>
	<CACLE7ixuiiz6MNuLXHYdLoSnu+p5Drp7++3wvo8umQFCn2=2KQ@mail.gmail.com>
	<49F9DCE2-2ED2-4791-94FC-1FB57D237A8C@rabbitmq.com>
	<CACLE7ixf0Jeq1hNSM8ojqaBGTC+4ELpaf2JfbaPtaQV0L0hiMA@mail.gmail.com>
	<DF417068-6E61-4473-97DE-3B618014B590@rabbitmq.com>
	<CACLE7iz-D4xkRy7JuP4F5g0NFtsTWW5htJ+fyuboVXTspKJA0Q@mail.gmail.com>
	<B35E667D-AF62-4901-9556-38F7ABD9A49C@rabbitmq.com>
	<CACLE7ixEcFQNBtNmATs1GN4z7XXiNw==oVQJ9us0-7XxmYWmdA@mail.gmail.com>
	<9BD373B8-8A11-45CA-8CE4-A0AD7EC5F29C@rabbitmq.com>
Message-ID: <952567CC-38E4-48AB-882D-37A44F027AF9@rabbitmq.com>

Quick update for you Matt. I was able to fully reproduce the behaviour you saw by dropping certain packets sent from the downstream federation client to the upstream broker during connection.close. We filed a bug and have implemented a fix, which should appear in a forthcoming release!

Cheers,
Tim

On 19 Sep 2012, at 22:17, Tim Watson wrote:

> Hi Matt
> 
> On 19 Sep 2012, at 20:21, Matt Pietrek wrote:
> 
>> Excellent. Thanks for the update. I really do appreciate it.
>> 
>> Just for my own curiosity, do you have any sort of local repro, or are you still just trying to make sense of my logs?
>> 
> 
> Very much the latter at the moment. We've filed a bug to investigate and I'm going to apply some specific packet filtering during shutdown to see what kind of impact a lost FIN/SYN might make. I'm also going to be reviewing the supervision hierarchy in the erlang client (which federation uses) to see if there's and shutdown/timeout choices that aren't quite right.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From esente at gmail.com  Fri Oct  5 21:42:15 2012
From: esente at gmail.com (Son Tran-Nguyen)
Date: Fri, 5 Oct 2012 13:42:15 -0700
Subject: [rabbitmq-discuss] Redeliever message with path in exchange to
	exchange binding
Message-ID: <CAB3emm3R0i6EtaE5H2GdWrhLdD851e0W0mN-JMivJ8X0YKMfTA@mail.gmail.com>

Hi,

I am trying to write a custom exchange type in which when bound to another
exchange, it will change the message so that the final queue will also know
which path the message were routes to.

For example, A is bound to B so that message published to A will be routed
to B and come to any queue bound to B. But when it's turn for B to route to
its queue, it will either change the exchange_name of the #basic_message,
or add B to a path tuple in the headers.

However, I failed to do such a thing. My custom exchange has the route/2 as
following:

route(X=#exchange{ name = XName},
      D=#delivery{ message = #basic_message{exchange_name = XName }}) ->
    Exchange = exchange_type(X), % a helper to detect the actual exchange
type, default to topic
    Exchange:route(X, D);

route(X=#exchange{ name = XName},
      D=#delivery{ msg_seq_no = MsgSeqNo,
        message = BasicMsg = #basic_message{
            exchange_name = Followee,
            routing_keys = [Key], content = Content }}) ->

    % Change the delivery here to NewDelivery
    Exchange = exchange_type(X),
    Exchange:route(X, NewDelivery).

I thought that when the message is published to the first exchange, it will
find all the bound destinations, including the bound exchange, and route
message there. When I debug it, I see that the second route/2 function
clause is also called, so the message should be routed and delivered to any
bound queues/exchanges of the second exchange. I also make sure to change
the message id, message sequence number to make sure I have a total
different message.

However, the queue bound to the second exchange only receives one message
from the first exchange.

Can anybody help me with this?


Sincerely,


Son Tran-Nguyen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121005/f70e6cad/attachment.htm>

From alex at inferiorhumanorgans.com  Sun Oct  7 06:18:13 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Sat, 06 Oct 2012 22:18:13 -0700
Subject: [rabbitmq-discuss] Proper protocol for dealing with crash dumps?
In-Reply-To: <506CAD22.5030305@rabbitmq.com>
References: <20120929132049.GA88595@bloaty> <50680EE6.6050301@rabbitmq.com>
	<20121002140903.GD65786@bloaty> <506CAD22.5030305@rabbitmq.com>
Message-ID: <50711095.4010104@inferiorhumanorgans.com>

On 10/3/12 2:24 PM, Matthias Radestock wrote:

> R13B03 is ancient, and countless bugs have been fixed since then,
> including memory leaks. Though, tbh, it's not the first place I'd look.
> Rabbit 2.8.7 plugs some leaks, but they were confined to HA queues (see
> the release notes for more details), so unless you are using those then
> upgrading won't help.
> 
> Have you changed the memory watermark settings of rabbit at all? If not
> then rabbit really shouldn't run out of memory unless another program is
> stealing the memory, or your app is creating lots of exchanges, queues
> or bindings. Or lots of connections. Or you are using some exotic
> plug-ins with hitherto undiscovered bugs. In all those cases, grabbing
> the output of 'rabbitmqctl report' before rabbit dies should offer some
> clues.

The config changes are, I think, limited to shovel related items,
logging, disk space, and TCP bits.  These machines have under 2GB of RAM
so allocating in excess of 700MB seems a bit odd.

In an ideal world we'd see around 48,000 messages per day *at the very
most*.  In practice, we're running into problems where an order of
magnitude more messages are being queued up under some circumstances...
but I'd expect that rabbit should handle that gracefully and block the
connection, no?

- alex


From matthias at rabbitmq.com  Sun Oct  7 08:05:22 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 07 Oct 2012 08:05:22 +0100
Subject: [rabbitmq-discuss] Proper protocol for dealing with crash dumps?
In-Reply-To: <50711095.4010104@inferiorhumanorgans.com>
References: <20120929132049.GA88595@bloaty> <50680EE6.6050301@rabbitmq.com>
	<20121002140903.GD65786@bloaty> <506CAD22.5030305@rabbitmq.com>
	<50711095.4010104@inferiorhumanorgans.com>
Message-ID: <507129B2.4080106@rabbitmq.com>

Alex,

On 07/10/12 06:18, Alex Zepeda wrote:
> These machines have under 2GB of RAM so allocating in excess of 700MB
> seems a bit odd.

The total memory and high watermark are shown in the rabbit logs, e.g.
s.t. like

=INFO REPORT==== 3-Oct-2012::20:31:08 ===
Memory limit set to 4814MB of 12036MB total.

So check that these figures make sense for your setup.

> In an ideal world we'd see around 48,000 messages per day *at the
> very most*.  In practice, we're running into problems where an order
> of magnitude more messages are being queued up under some
> circumstances... but I'd expect that rabbit should handle that
> gracefully and block the connection, no?

When under memory pressure rabbit will page the messages to disk, and
block producers to control the rate of message influx so it can keep up. 
Hence high message volumes should not cause rabbit to run out of memory.

As suggested previously, when rabbit is using more memory than you
expect the output of 'rabbitmqctl report' should shed some light on
where it's going.

Regards,

Matthias.

From matthias at rabbitmq.com  Sun Oct  7 08:22:41 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 07 Oct 2012 08:22:41 +0100
Subject: [rabbitmq-discuss] Redeliever message with path in exchange to
 exchange binding
In-Reply-To: <CAB3emm3R0i6EtaE5H2GdWrhLdD851e0W0mN-JMivJ8X0YKMfTA@mail.gmail.com>
References: <CAB3emm3R0i6EtaE5H2GdWrhLdD851e0W0mN-JMivJ8X0YKMfTA@mail.gmail.com>
Message-ID: <50712DC1.6010600@rabbitmq.com>

Son,

On 05/10/12 21:42, Son Tran-Nguyen wrote:
> I am trying to write a custom exchange type in which when bound to
> another exchange, it will change the message so that the final queue
> will also know which path the message were routes to.

Message routing determines the destinations of messages. It does not 
deliver the messages to these destinations, nor can it alter the messages.

Take a look at the signature of exchange:route/2:

route(rabbit_types:exchange(), rabbit_types:delivery()) ->
         rabbit_router:match_result()

where

rabbit_router:match_result() :: [rabbit_types:binding_destination()]

rabbit_types:binding_destination() ::
         rabbit_amqqueue:name() | rabbit_exchange:name()

i.e. route/2 returns a list of exchanges and queues.


So what you are trying to do simply cannot be done.


Regards,

Matthias.

From esente at gmail.com  Sun Oct  7 09:02:33 2012
From: esente at gmail.com (Son Tran-Nguyen)
Date: Sun, 7 Oct 2012 01:02:33 -0700
Subject: [rabbitmq-discuss] Redeliever message with path in exchange to
 exchange binding
In-Reply-To: <50712DC1.6010600@rabbitmq.com>
References: <CAB3emm3R0i6EtaE5H2GdWrhLdD851e0W0mN-JMivJ8X0YKMfTA@mail.gmail.com>
	<50712DC1.6010600@rabbitmq.com>
Message-ID: <CAB3emm1F6ZZ9c6Z54BecT0YSCuqxTc0pzcRPnahMNiaD3MYrNw@mail.gmail.com>

I understand the signature of exchange:route/2, but what would rabbitmq do
after acquiring all the destinations? Would it deliver the message to those
destinations?

Sincerely,


Son Tran-Nguyen



On Sun, Oct 7, 2012 at 12:22 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Son,
>
>
> On 05/10/12 21:42, Son Tran-Nguyen wrote:
>
>> I am trying to write a custom exchange type in which when bound to
>> another exchange, it will change the message so that the final queue
>> will also know which path the message were routes to.
>>
>
> Message routing determines the destinations of messages. It does not
> deliver the messages to these destinations, nor can it alter the messages.
>
> Take a look at the signature of exchange:route/2:
>
> route(rabbit_types:exchange(), rabbit_types:delivery()) ->
>         rabbit_router:match_result()
>
> where
>
> rabbit_router:match_result() :: [rabbit_types:binding_**destination()]
>
> rabbit_types:binding_**destination() ::
>         rabbit_amqqueue:name() | rabbit_exchange:name()
>
> i.e. route/2 returns a list of exchanges and queues.
>
>
> So what you are trying to do simply cannot be done.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121007/6e275040/attachment.htm>

From matthias at rabbitmq.com  Sun Oct  7 09:54:29 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 07 Oct 2012 09:54:29 +0100
Subject: [rabbitmq-discuss] Redeliever message with path in exchange to
 exchange binding
In-Reply-To: <CAB3emm1F6ZZ9c6Z54BecT0YSCuqxTc0pzcRPnahMNiaD3MYrNw@mail.gmail.com>
References: <CAB3emm3R0i6EtaE5H2GdWrhLdD851e0W0mN-JMivJ8X0YKMfTA@mail.gmail.com>
	<50712DC1.6010600@rabbitmq.com>
	<CAB3emm1F6ZZ9c6Z54BecT0YSCuqxTc0pzcRPnahMNiaD3MYrNw@mail.gmail.com>
Message-ID: <50714345.3010004@rabbitmq.com>

On 07/10/12 09:02, Son Tran-Nguyen wrote:
> I understand the signature of exchange:route/2, but what would rabbitmq
> do after acquiring all the destinations? Would it deliver the message to
> those destinations?

Yes. See the code fragment at 
http://hg.rabbitmq.com/rabbitmq-server/file/16c6f6dc3d15/src/rabbit_channel.erl#l629

Matthias.

From nathanael.rensen at zettaserve.com  Mon Oct  8 01:56:30 2012
From: nathanael.rensen at zettaserve.com (Rensen, Nathanael)
Date: Mon, 8 Oct 2012 00:56:30 +0000
Subject: [rabbitmq-discuss] 2.8.7 - Unexpected termination of HA node
Message-ID: <03CFB894A02BE24885082C694F789A7B13BF1920@PERMLS03.zettaserve.com>

While testing RabbitMQ version 2.8.7 I've encountered an issue where the slave node in a HA pair terminates when the master is forcefully rebooted.

The environment is Centos 6.3 with RabbitMQ 2.8.7, Erlang R14B, with a durable queue mirrored across a pair of nodes in a HA cluster. The master is rebooted using reboot -nf to simulate an ungraceful failure. When the master comes back up the slave node terminates with error log shown below.

The behaviour when testing with version 2.8.6 was that the queue would vanish from the cluster. With version 2.8.7 the queue remains intact, but the slave node terminates.

I've found that if the rabbitmq-server is not configured to start at boot the slave node eventually promotes itself to master and survives the eventual restart of the original master.

Nathanael

=INFO REPORT==== 5-Oct-2012::17:24:35 ===
rabbit on node 'rabbit at zg-dev-nr-002' down

=INFO REPORT==== 5-Oct-2012::17:24:35 ===
Statistics database started.

=INFO REPORT==== 5-Oct-2012::17:24:35 ===
Mirrored-queue (queue 'zg-ha-test' in vhost '/'): Slave
<'rabbit at zg-dev-nr-001'.3.252.0> saw deaths of mirrors
<'rabbit at zg-dev-nr-002'.2.252.0>

=INFO REPORT==== 5-Oct-2012::17:24:35 ===
Mirrored-queue (queue 'zg-ha-test' in vhost '/'): Promoting slave
<'rabbit at zg-dev-nr-001'.3.252.0> to master

=ERROR REPORT==== 5-Oct-2012::17:24:35 ===
** Generic server <0.253.0> terminating
** Last message in was {mnesia_tm,'rabbit at zg-dev-nr-002',
                                  {vote_yes,{tid,2235,<0.253.0>}}}
** When Server state == {state,
                            {3,<0.253.0>},
                            {{3,<0.253.0>},undefined},
                            {{3,<0.253.0>},undefined},
                            {resource,<<"/">>,queue,<<"zg-ha-test">>},
                            rabbit_mirror_queue_coordinator,
                            {6,
                             [{{3,<0.253.0>},
                               {view_member,
                                   {3,<0.253.0>},
                                   [],
                                   {3,<0.253.0>},
                                   {3,<0.253.0>}}}]},
                            0,[],
                            [<0.336.0>],
                            {[],[]},
                            [],undefined}
** Reason for termination ==
** {function_clause,
       [{gm,handle_info,
            [{mnesia_tm,'rabbit at zg-dev-nr-002',
                 {vote_yes,{tid,2235,<0.253.0>}}},
             {state,
                 {3,<0.253.0>},
                 {{3,<0.253.0>},undefined},
                 {{3,<0.253.0>},undefined},
                 {resource,<<"/">>,queue,<<"zg-ha-test">>},
                 rabbit_mirror_queue_coordinator,
                 {6,
                  [{{3,<0.253.0>},
                    {view_member,
                        {3,<0.253.0>},
                        [],
                        {3,<0.253.0>},
                        {3,<0.253.0>}}}]},
                 0,[],
                 [<0.336.0>],
                 {[],[]},
                 [],undefined}]},
        {gen_server2,handle_msg,2},
        {proc_lib,wake_up,3}]}

=ERROR REPORT==== 5-Oct-2012::17:24:36 ===
** Generic server <0.252.0> terminating
** Last message in was {'EXIT',<0.336.0>,
                        {function_clause,
                         [{gm,handle_info,
                           [{mnesia_tm,'rabbit at zg-dev-nr-002',
                             {vote_yes,{tid,2235,<0.253.0>}}},
                            {state,
                             {3,<0.253.0>},
                             {{3,<0.253.0>},undefined},
                             {{3,<0.253.0>},undefined},
                             {resource,<<"/">>,queue,<<"zg-ha-test">>},
                             rabbit_mirror_queue_coordinator,
                             {6,
                              [{{3,<0.253.0>},
                                {view_member,
                                 {3,<0.253.0>},
                                 [],
                                 {3,<0.253.0>},
                                 {3,<0.253.0>}}}]},
                             0,[],
                             [<0.336.0>],
                             {[],[]},
                             [],undefined}]},
                          {gen_server2,handle_msg,2},
                          {proc_lib,wake_up,3}]}}
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"/">>,queue,<<"zg-ha-test">>},
                          true,false,none,
                          [{<<"x-ha-policy">>,longstr,<<"all">>}],
                          <0.252.0>,[],all},
                         none,false,rabbit_mirror_queue_master,
                         {state,<0.253.0>,<0.336.0>,rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,undefined,0,undefined},
                           {0,{[],[]}},
[... lots of stuff omitted...]
                           {291,
                           29148,
                           {0,nil},
                           undefined,
                           {0,nil},
                           {qistate,

"/var/lib/rabbitmq/mnesia/rabbit at zg-dev-nr-001/queues/EVSP28XGBN529KMXDI7YW0GM2",
                            {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},
                              {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             []},
                            undefined,0,262144,
                            #Fun<rabbit_variable_queue.2.121033067>,
                            {0,nil}},
                           {{client_msstate,msg_store_persistent,
                             <<64,124,193,190,179,5,132,252,0,55,122,227,216,
                               123,112,237>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},
                              {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,303177,

"/var/lib/rabbitmq/mnesia/rabbit at zg-dev-nr-001/msg_store_persistent"},
                             rabbit_msg_store_ets_index,

"/var/lib/rabbitmq/mnesia/rabbit at zg-dev-nr-001/msg_store_persistent",
                             <0.246.0>,307274,299080,311371,315468},
                            {client_msstate,msg_store_transient,
                             <<38,48,43,9,149,2,213,22,77,78,223,24,149,53,175,
                               245>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},
                              {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,282692,

"/var/lib/rabbitmq/mnesia/rabbit at zg-dev-nr-001/msg_store_transient"},
                             rabbit_msg_store_ets_index,

"/var/lib/rabbitmq/mnesia/rabbit at zg-dev-nr-001/msg_store_transient",
                             <0.241.0>,286789,278595,290886,294983}},
                           true,0,#Fun<rabbit_mirror_queue_slave.1.40624233>,
                           291,0,infinity,291,0,152,0,291,
                           {rates,
                            {{1349,429050,591110},0},
                            {{1349,429050,591110},0},
                            1076.4632093998348,1076.4632093998348,
                            {1349,429051,592073}},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           0,0,
                           {rates,
                            {{1349,429050,591110},0},
                            {{1349,429050,591110},0},
                            1071.7981467372135,1076.4632093998348,
                            {1349,429051,592073}}},
                          0,
                          {dict,6,16,16,8,80,48,
                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],
                             [[<<218,200,61,58,97,50,72,197,144,158,220,215,
                                 159,163,253,105>>|
                               published]],
                             [[<<80,182,167,56,95,139,134,134,192,40,123,239,
                                 62,193,49,206>>|
                               published],
                              [<<159,219,2,228,110,119,150,246,97,74,183,72,
                                 254,233,74,33>>|
                               published],
                              [<<223,108,153,205,69,107,192,83,254,145,181,
                                 172,15,61,33,190>>|
                               published]],
                             [],[],[],[],
                             [[<<8,84,74,65,208,81,184,115,74,86,225,237,241,
                                 172,148,18>>|
                               published]],
                             [],[],[],[],[],
                             [[<<"?jq$???S!?,a??u?">>|published]],
                             []}}},
                          [],
                          {dict,0,16,16,8,80,48,
                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          {set,0,16,16,8,80,48,
                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}}},
                         {[],[]},
                         undefined,undefined,#Ref<0.0.0.1342>,undefined,
                         {state,fine,5000,#Ref<0.0.0.1406>},
                         {0,nil},
                         undefined,undefined,undefined,
                         {dict,1,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],
                            [[<7527.317.0>|#Ref<0.0.0.732>]],
                            [],[],[],[],[],[],[],[],[]}}},
                         1,
                         {{0,nil},{0,nil}},
                         undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                          {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         undefined,undefined}
** Reason for termination ==
** {noproc,{gen_server2,call,[<0.253.0>,info,infinity]}}
** In 'terminate' callback with reason ==
** {function_clause,
       [{gm,handle_info,
            [{mnesia_tm,'rabbit at zg-dev-nr-002',
                 {vote_yes,{tid,2235,<0.253.0>}}},
             {state,
                 {3,<0.253.0>},
                 {{3,<0.253.0>},undefined},
                 {{3,<0.253.0>},undefined},
                 {resource,<<"/">>,queue,<<"zg-ha-test">>},
                 rabbit_mirror_queue_coordinator,
                 {6,
                  [{{3,<0.253.0>},
                    {view_member,
                        {3,<0.253.0>},
                        [],
                        {3,<0.253.0>},
                        {3,<0.253.0>}}}]},
                 0,[],
                 [<0.336.0>],
                 {[],[]},
                 [],undefined}]},
        {gen_server2,handle_msg,2},
        {proc_lib,wake_up,3}]}

=INFO REPORT==== 5-Oct-2012::17:24:36 ===
rabbit on node 'rabbit at zg-dev-nr-002' up

=ERROR REPORT==== 5-Oct-2012::17:24:36 ===
** Generic server <0.292.0> terminating
** Last message in was {mnesia_tm,'rabbit at zg-dev-nr-002',
                                  {vote_yes,{tid,2236,<0.292.0>}}}
** When Server state == {state,<0.290.0>,<0.291.0>,rabbit_mgmt_sup,
                            [{rabbit_mgmt_db,
                                 {rabbit_mgmt_db,start_link,[]},
                                 permanent,4294967295,worker,
                                 [rabbit_mgmt_db]}]}
** Reason for termination ==
** {unexpected_info,{mnesia_tm,'rabbit at zg-dev-nr-002',
                               {vote_yes,{tid,2236,<0.292.0>}}}}

=INFO REPORT==== 5-Oct-2012::17:24:36 ===
    application: rabbitmq_management
    exited: shutdown
    type: permanent

=INFO REPORT==== 5-Oct-2012::17:24:36 ===
stopped TCP Listener on [::]:5672

________________________________

ZettaServe Disclaimer: This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately if you have received this email by mistake and delete this email from your system. Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. ZettaServe Pty Ltd accepts no liability for any damage caused by any virus transmitted by this email.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121008/416518b3/attachment.htm>

From mcintoshj at gmail.com  Mon Oct  8 02:33:13 2012
From: mcintoshj at gmail.com (McIntosh Jason)
Date: Sun, 7 Oct 2012 20:33:13 -0500
Subject: [rabbitmq-discuss] RabbitMQ Performance Tests and max of ~4000
	msg/sec
Message-ID: <C089F57B-1675-4871-BE58-21FBC2BB0A0B@gmail.com>

So I've been trying to design a rabbit configuration to eke the most performance possible out of a system.  However, despite a lot of repeated attempts, I'm not able to get more than 4-5k messages/sec out of any rabbit server.  Here are the results of some tests:

Single connection, Single Exchange, Single queue:  ~4000 msg/sec
Single connection, Single Exchange, Two queues  :  ~4000 msg/sec
Single connection, Two Exchanges, Single queue  :  ~4000 msg/sec
Single connections, Two Exchanges, Two queues   :  ~4000 msg/sec
Two connections, Two Exchanges, Two queues      :  ~3300 msg/sec (could be a fluke, haven't repeated this test)

The message rates I've NOT computationally verified - just reading off summary of what rabbit says is going through it's exchanges/queues.  I'll probably work on some more accurate metrics later, but right now, I'm just trying to figure out what to tweak.

While the test was running, I saw at most a 2mb/sec data write rate, and only about 50-60% CPU use.  Rabbit overview in the admin interface:
Name	File descriptors (?)
(used / available)
Socket descriptors (?)
(used / available)
Erlang processes
(used / available)
Memory	Disk space	Uptime	Type
rabbit at jasons-mac-pro
35 / 1024
3 / 829
204 / 1048576
496.3MB
2.2GB high watermark
3.0TB
953.7MB low watermark
1h 18m	Disc Stats *

At this point, I'm not sure what the heck to do to get more performance out of Rabbit and could use some advice.  Below is the setup I've got, sample code, etc.  Any advice would be welcome! 

Thanks!
Jason


Here's the setup:
Two Exchanges, TestExchange and TestExchange2
Two Queues, Test and Test2
Bindings for each exchange to the queue with the routing key = Queue name.  I've got the queues setup as direct and durable, as are the queues (durable).

Here's the java code I'm testing with:
import java.io.IOException;

import org.apache.commons.lang.RandomStringUtils;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import com.rabbitmq.client.MessageProperties;

public class TestRabbitConnection {

	public static void main(String[] args) throws Exception {
		ConnectionFactory factory = new ConnectionFactory();
		factory.setHost("localhost");
		factory.setUsername("guest");
		factory.setPassword("guest");
		Connection conn = factory.newConnection();
		Channel channel = conn.createChannel();
		Thread t = new Thread(new RabbitMqTester("TestExchange", "Test", channel));
//		Thread t2 = new Thread(new RabbitMqTester("TestExchange2", "Test2", channel));
		t.start();
//		t2.start();
	
		t.join();
//		t2.join();
	}
	
	private static class RabbitMqTester implements Runnable {
		private final Channel channel;
		private final String exchange;
		private final String routingKey;
		private final byte[] contents = RandomStringUtils.randomAlphabetic(20).getBytes();

		public RabbitMqTester(String exchange, String routingKey, Channel channel) {
			this.exchange = exchange;
			this.routingKey = routingKey;
			this.channel = channel;
		}

		@Override
		public void run() {
			try {
				while(true) {
					channel.basicPublish(exchange, routingKey, MessageProperties.MINIMAL_PERSISTENT_BASIC, contents);
				}
			} catch (IOException e) {
				throw new RuntimeException(e);
			}
		}
		
	}
}


I'm testing on a MacPro with the following plugins/Erlang:
11 plugins activated:
* amqp_client-2.8.7
* erlando-2.8.7
* mochiweb-2.3.1-rmq2.8.7-gitd541e9a
* rabbitmq_federation-2.8.7
* rabbitmq_federation_management-2.8.7
* rabbitmq_management-2.8.7
* rabbitmq_management_agent-2.8.7
* rabbitmq_mochiweb-2.8.7
* rabbitmq_shovel-2.8.7
* rabbitmq_shovel_management-2.8.7
* webmachine-1.9.1-rmq2.8.7-git52e62bc

erlang version : 5.9.2


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121007/7d419e92/attachment.htm>

From mcintoshj at gmail.com  Mon Oct  8 02:55:32 2012
From: mcintoshj at gmail.com (McIntosh Jason)
Date: Sun, 7 Oct 2012 20:55:32 -0500
Subject: [rabbitmq-discuss] RabbitMQ Performance Tests and max of ~4000
	msg/sec
In-Reply-To: <C089F57B-1675-4871-BE58-21FBC2BB0A0B@gmail.com>
References: <C089F57B-1675-4871-BE58-21FBC2BB0A0B@gmail.com>
Message-ID: <25952366-C794-44AA-B021-303DD154AEEF@gmail.com>

So an interesting addendum:

I tossed a slight modification of my main method:

		List<Thread> threadsStarted = new ArrayList<Thread>();
		for (int i = 0; i < 5; i++) {
			Thread t = new Thread(new RabbitMqTester("TestExchange", "Test", channel));
			threadsStarted.add(t);
			t.start();
		}
		for (Thread t : threadsStarted) {
			t.join();
		}
And started seeing 16k messages per second.  I'll be doing some more testing to see where my block might be.  Could be as simple as how I'm handling threads...
Thanks!
Jason


On Oct 7, 2012, at 8:33 PM, McIntosh Jason wrote:

> So I've been trying to design a rabbit configuration to eke the most performance possible out of a system.  However, despite a lot of repeated attempts, I'm not able to get more than 4-5k messages/sec out of any rabbit server.  Here are the results of some tests:
> 
> Single connection, Single Exchange, Single queue:  ~4000 msg/sec
> Single connection, Single Exchange, Two queues  :  ~4000 msg/sec
> Single connection, Two Exchanges, Single queue  :  ~4000 msg/sec
> Single connections, Two Exchanges, Two queues   :  ~4000 msg/sec
> Two connections, Two Exchanges, Two queues      :  ~3300 msg/sec (could be a fluke, haven't repeated this test)
> 
> The message rates I've NOT computationally verified - just reading off summary of what rabbit says is going through it's exchanges/queues.  I'll probably work on some more accurate metrics later, but right now, I'm just trying to figure out what to tweak.
> 
> While the test was running, I saw at most a 2mb/sec data write rate, and only about 50-60% CPU use.  Rabbit overview in the admin interface:
> Name	File descriptors (?)
> (used / available)
> Socket descriptors (?)
> (used / available)
> Erlang processes
> (used / available)
> Memory	Disk space	Uptime	Type
> rabbit at jasons-mac-pro
> 35 / 1024
> 3 / 829
> 204 / 1048576
> 496.3MB
> 2.2GB high watermark
> 3.0TB
> 953.7MB low watermark
> 1h 18m	Disc Stats *
> 
> At this point, I'm not sure what the heck to do to get more performance out of Rabbit and could use some advice.  Below is the setup I've got, sample code, etc.  Any advice would be welcome! 
> 
> Thanks!
> Jason
> 
> 
> Here's the setup:
> Two Exchanges, TestExchange and TestExchange2
> Two Queues, Test and Test2
> Bindings for each exchange to the queue with the routing key = Queue name.  I've got the queues setup as direct and durable, as are the queues (durable).
> 
> Here's the java code I'm testing with:
> import java.io.IOException;
> 
> import org.apache.commons.lang.RandomStringUtils;
> 
> import com.rabbitmq.client.Channel;
> import com.rabbitmq.client.Connection;
> import com.rabbitmq.client.ConnectionFactory;
> import com.rabbitmq.client.MessageProperties;
> 
> public class TestRabbitConnection {
> 
> 	public static void main(String[] args) throws Exception {
> 		ConnectionFactory factory = new ConnectionFactory();
> 		factory.setHost("localhost");
> 		factory.setUsername("guest");
> 		factory.setPassword("guest");
> 		Connection conn = factory.newConnection();
> 		Channel channel = conn.createChannel();
> 		Thread t = new Thread(new RabbitMqTester("TestExchange", "Test", channel));
> //		Thread t2 = new Thread(new RabbitMqTester("TestExchange2", "Test2", channel));
> 		t.start();
> //		t2.start();
> 	
> 		t.join();
> //		t2.join();
> 	}
> 	
> 	private static class RabbitMqTester implements Runnable {
> 		private final Channel channel;
> 		private final String exchange;
> 		private final String routingKey;
> 		private final byte[] contents = RandomStringUtils.randomAlphabetic(20).getBytes();
> 
> 		public RabbitMqTester(String exchange, String routingKey, Channel channel) {
> 			this.exchange = exchange;
> 			this.routingKey = routingKey;
> 			this.channel = channel;
> 		}
> 
> 		@Override
> 		public void run() {
> 			try {
> 				while(true) {
> 					channel.basicPublish(exchange, routingKey, MessageProperties.MINIMAL_PERSISTENT_BASIC, contents);
> 				}
> 			} catch (IOException e) {
> 				throw new RuntimeException(e);
> 			}
> 		}
> 		
> 	}
> }
> 
> 
> I'm testing on a MacPro with the following plugins/Erlang:
> 11 plugins activated:
> * amqp_client-2.8.7
> * erlando-2.8.7
> * mochiweb-2.3.1-rmq2.8.7-gitd541e9a
> * rabbitmq_federation-2.8.7
> * rabbitmq_federation_management-2.8.7
> * rabbitmq_management-2.8.7
> * rabbitmq_management_agent-2.8.7
> * rabbitmq_mochiweb-2.8.7
> * rabbitmq_shovel-2.8.7
> * rabbitmq_shovel_management-2.8.7
> * webmachine-1.9.1-rmq2.8.7-git52e62bc
> 
> erlang version : 5.9.2
> 
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121007/1f710332/attachment.htm>

From raviv at gigya-inc.com  Mon Oct  8 09:57:11 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Mon, 8 Oct 2012 10:57:11 +0200
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <506DB68D.3080502@rabbitmq.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
	<506D7304.3070801@rabbitmq.com>
	<CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>
	<506DA2E4.2050100@rabbitmq.com> <506DA3C3.7030008@rabbitmq.com>
	<CACx7p4A2U7aJ3odR9PRPKOU=YRa+iMB=BRBjxzT=Fx1yD4cncw@mail.gmail.com>
	<CACx7p4A15YO5u-ste82O2A_HG5rES4KR+C1u2n2AM48ZM2h9=w@mail.gmail.com>
	<506DACA0.7040208@rabbitmq.com>
	<CACx7p4Cnf6C16C05vL5CU66R16mWWmSK9cU-uPmi2WgP8-OMOg@mail.gmail.com>
	<CACx7p4Ab=awWVHzjYFx=rTAo4S2vMzeBJ=wZLMyea3SZ6BYeuw@mail.gmail.com>
	<506DB68D.3080502@rabbitmq.com>
Message-ID: <CACx7p4A3yJKOP6CN_Z-OwnMvsD==LNSBGXtUz++tLmpWC=b6aQ@mail.gmail.com>

Makes sense.
I'm trying to reproduce with higher watermark by publishing messages,
consuming them but not acking (this is what happened in production) but
can't get the memory to go above the watermark.
Can you explain or point me to an explanation of Rabbit's memory usage?

Also, When hitting the watermark, the server seems to block the producer on
the socket level, instead of sending a flow control message. Since the .Net
SDK doesn't expose a send timeout, publishing is blocked forever.
Any reason for not exposing such timeout?


Thanks
*--*Raviv
*
*



On Thu, Oct 4, 2012 at 6:17 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 04/10/12 16:57, Raviv Pavel wrote:
>
>> Back to the original problem:
>> 1. I set the watermark very low so I can reach it, effectively  78MB
>>
>
> Ah. Was this what you had done in the first place?
>
>
>  2. server starts with empty queues and memory usage is 66MB
>> 3. I start publishing messages and reach the watermark
>> 4. publisher gets blocked
>> 5. I purge the queue but memory stays the same
>>
>
> When you set the watermark very low, close to the "empty" memory use, it
> is very possible that the memory level will go over and never go under
> again. Caches, lazy instantiation and so on. RabbitMQ is not designed for
> highly constrained memory environments.
>
> Cheers. Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121008/656c98df/attachment.htm>

From videlalvaro at gmail.com  Mon Oct  8 10:02:41 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 8 Oct 2012 11:02:41 +0200
Subject: [rabbitmq-discuss] [ANN] php-amqplib now supports basic_return
Message-ID: <37E08E94-ECD1-4781-9E36-2AA71E7A9D06@gmail.com>

Hi,

Thanks to contributions from some of its users php-amqplib now supports basic_returns plus some other bug fixes.

https://github.com/videlalvaro/php-amqplib/

Regards,

Alvaro

From matthias at rabbitmq.com  Mon Oct  8 10:26:34 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 08 Oct 2012 10:26:34 +0100
Subject: [rabbitmq-discuss] Access Refused
In-Reply-To: <556325346CA26341B6F0530E07F90D96016C6812CB88@GBGH-EXCH-CMS.sig.ads>
References: <556325346CA26341B6F0530E07F90D96016C6812CB0C@GBGH-EXCH-CMS.sig.ads>
	<506D53EF.6000505@rabbitmq.com>
	<556325346CA26341B6F0530E07F90D96016C6812CB88@GBGH-EXCH-CMS.sig.ads>
Message-ID: <50729C4A.2040804@rabbitmq.com>

Jim,

On 04/10/12 11:05, Jim Swainston wrote:
> Could you please confirm a couple of things for me...
>
> The only port that need to be open for access to RabbitMQ as a
> consumer is 5672

Correct.

> The message 'Server channel error: 403, message: ACCESS_REFUSED -
> access to queue 'amq.gen-gx1n4EQIgnm7NVZlwZI2e5' in vhost '/blah'
> refused for user 'username'' is coming from the RabbitMQ server, not
> the client.

Correct.

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Oct  8 11:20:37 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 08 Oct 2012 11:20:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ Performance Tests and max of ~4000
 msg/sec
In-Reply-To: <25952366-C794-44AA-B021-303DD154AEEF@gmail.com>
References: <C089F57B-1675-4871-BE58-21FBC2BB0A0B@gmail.com>
	<25952366-C794-44AA-B021-303DD154AEEF@gmail.com>
Message-ID: <5072A8F5.2060000@rabbitmq.com>

Jason,

On 08/10/12 02:55, McIntosh Jason wrote:
> So an interesting addendum:
>
> I tossed a slight modification of my main method:
>
> List<Thread> threadsStarted = new ArrayList<Thread>();
> for (int i = 0; i < 5; i++) {
> Thread t = new Thread(new RabbitMqTester("TestExchange", "Test", channel));
> threadsStarted.add(t);
> t.start();
> }
> for (Thread t : threadsStarted) {
> t.join();
> }
> And started seeing 16k messages per second.  I'll be doing some more
> testing to see where my block might be.  Could be as simple as how I'm
> handling threads...

Your messages are marked as 'persistent', and I am guessing you declared 
the queues as durable.

As a result every message has to be written to disk, which limits the 
throughput to disk write speed. Additionally, rabbit has to do an fsync 
every now and then in order to bound the number of messages that might 
be lost in a crash. That is an expensive operation but is coalesced 
across concurrent activities. Hence you are seeing a higher overall 
throughput with multiple publishers.

Regards,

Matthias.

From simon at rabbitmq.com  Mon Oct  8 11:35:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 08 Oct 2012 11:35:04 +0100
Subject: [rabbitmq-discuss] Memory watermark alert not resetting.
In-Reply-To: <CACx7p4A3yJKOP6CN_Z-OwnMvsD==LNSBGXtUz++tLmpWC=b6aQ@mail.gmail.com>
References: <2fb9a6a2-077d-4ce9-911f-56a6f3d53fa8@googlegroups.com>
	<506D7304.3070801@rabbitmq.com>
	<CACx7p4BCsmZLRnp-pYBhJho4o5agYAJGU+wDTMy-MdmoPFroaQ@mail.gmail.com>
	<506DA2E4.2050100@rabbitmq.com> <506DA3C3.7030008@rabbitmq.com>
	<CACx7p4A2U7aJ3odR9PRPKOU=YRa+iMB=BRBjxzT=Fx1yD4cncw@mail.gmail.com>
	<CACx7p4A15YO5u-ste82O2A_HG5rES4KR+C1u2n2AM48ZM2h9=w@mail.gmail.com>
	<506DACA0.7040208@rabbitmq.com>
	<CACx7p4Cnf6C16C05vL5CU66R16mWWmSK9cU-uPmi2WgP8-OMOg@mail.gmail.com>
	<CACx7p4Ab=awWVHzjYFx=rTAo4S2vMzeBJ=wZLMyea3SZ6BYeuw@mail.gmail.com>
	<506DB68D.3080502@rabbitmq.com>
	<CACx7p4A3yJKOP6CN_Z-OwnMvsD==LNSBGXtUz++tLmpWC=b6aQ@mail.gmail.com>
Message-ID: <5072AC58.9010104@rabbitmq.com>

On 08/10/2012 9:57AM, Raviv Pavel wrote:
> Makes sense.
> I'm trying to reproduce with higher watermark by publishing messages,
> consuming them but not acking (this is what happened in production) but
> can't get the memory to go above the watermark.

You will eventually, but this may take quite a long time. RabbitMQ will 
page messages to disc under memory pressure, this includes 
consumed-but-unacked messages. But there is a small per-message cost for 
messages in general, and a small per-message-per-queue cost for 
consumed-but-unacked messages. So with enough messages this can add up 
and block publishers.

> Can you explain or point me to an explanation of Rabbit's memory usage?

Nothing much is documented yet. We are working on this, along with 
better memory use details in ctl / mgmt.

> Also, When hitting the watermark, the server seems to block the producer
> on the socket level, instead of sending a flow control message.

The flow control messages in the spec are unfortunately not very useful, 
since they rely on the client taking notice of them in a timely way. In 
practice this tends not to happen.

> Since
> the .Net SDK doesn't expose a send timeout, publishing is blocked forever.
> Any reason for not exposing such timeout?

I think since you could wrap it easily enough yourself this came down to 
API complexity.

Cheers, Simon

From simon at rabbitmq.com  Mon Oct  8 11:44:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 08 Oct 2012 11:44:55 +0100
Subject: [rabbitmq-discuss] do we need to delete data folder during rpm
 upgrades?
In-Reply-To: <CAJinw2rWhAYSM3th4m--CH4_Evxfu=_5nR9vCgno=XAM5xrZjw@mail.gmail.com>
References: <CAJinw2or6idyKvBT5HCHfwdRLSkz_AOZhrU6gNDQm5CufbMbzA@mail.gmail.com>
	<506EA9DF.4080402@rabbitmq.com>
	<CAJinw2rWhAYSM3th4m--CH4_Evxfu=_5nR9vCgno=XAM5xrZjw@mail.gmail.com>
Message-ID: <5072AEA7.1050909@rabbitmq.com>

Are you starting all nodes (near) simultaneously post upgrade?

During cluster upgrade we get the first node to start to do the mnesia 
upgrade, others then don't do that part. I think the error you are 
seeing is consistent with there being two "first" nodes in the upgrade.

In future we might be able to add better locking around this, although 
for various reasons it's not as easy as it sounds.

Cheers, Simon

On 05/10/2012 6:52PM, Nithya Vijayakumar wrote:
> Thanks Simon. After the rpm upgrade, when we try to start the nodes and
> they error out. We also tried killall -u rabbitmq before restart. Issue
> doesn't happen always, only once in a while.
>
>         {merge_schema_failed,
>
>                 "Bad cookie in table definition rabbit_topic_trie_node:...
>
>
> After we delete the data folder, rabbitmq starts fine. We would prefer
> not to delete the data folder as we need to copy out the queues and
> users and restore them.
>
> Thanks,
>
> Nithya
>
>
>
> On Fri, Oct 5, 2012 at 2:35 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 04/10/12 23:28, Nithya Vijayakumar wrote:
>
>         We recently upgraded from 2.7.1 to 2.8.6. After the rpm upgrade,
>         in some
>         instances we notice that our two node HA setup doesn't start
>         until the
>         data folder is deleted. Is this required for upgrades? Is there any
>         format/schema change that might be needing this?
>
>
>     There are schema changes, but RabbitMQ should take care of them for
>     you automatically. What are you seeing when it doesn't start?
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>

From simon at rabbitmq.com  Mon Oct  8 11:50:45 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 08 Oct 2012 11:50:45 +0100
Subject: [rabbitmq-discuss] Statistics database could not be contacted.
 Message rates and queue lengths will not be shown.
In-Reply-To: <CACLE7iy+KYPiE_zoignvjFgwrj-b6uhsr8Z-+V+kPdq+oNFUxw@mail.gmail.com>
References: <CAHv8OSQ7UJ9L_s+rLJaJeMJ_v8LNcLvkWorotrhSCi1JX=nWYg@mail.gmail.com>
	<506D5668.7040205@rabbitmq.com>
	<CAHv8OSQs5eyyY11SVpQijqQro9C+Va_9_jXjubBxJFte-jt5mA@mail.gmail.com>
	<506EB48D.3010100@rabbitmq.com>
	<CACLE7iy+KYPiE_zoignvjFgwrj-b6uhsr8Z-+V+kPdq+oNFUxw@mail.gmail.com>
Message-ID: <5072B005.4090508@rabbitmq.com>

Certainly if the stats DB is not around you won't see message counts - 
that's its purpose.

It's certainly not *intended* that a network partition lead to the stats 
DB going away. It's possible we could do better in this case, but we 
store the current location of the stats DB in a distributed DB so you 
can imagine how partitioning would lead to problems. I don't want to 
spend too much time on this since clusters are not designed for 
unreliable networks anyway.

Cheers, Simon

On 05/10/2012 5:13PM, Matt Pietrek wrote:
>
>  > We really don't recommend use of clusters on networks that may be
> subject to partitions.
>
> A follow up question then. We run our brokers in clusters, and hopefully
> nothing ever goes down, we never have network partitions, etc... (and in
> fact, we've had clusters running for months at a time without issue.)
>
> The question is, in the unfortunate event of a network partition, should
> we just expect to lose the capability of the statistics database? It's
> important for us to know, as I've written additional tooling that uses
> the HTTP API to manipulate various things, and when the stats database
> isn't available, various fields returned by the HTTP APIs (like message
> counts) seem to vanish.
>
> Thanks,
>
> Matt
>
> On Fri, Oct 5, 2012 at 3:21 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Hmm. I see various messages about network partitions in the logs;
>     that's not encouraging. We really don't recommend use of clusters on
>     networks that may be subject to partitions. I suspect that may be
>     the root of the problem.
>
>     Cheers, Simon
>
>
>     On 04/10/12 10:36, Wong Kam Hoong wrote:
>
>         Hi Simon,
>
>         The RabbitMQ was clustered (3 RabbitMQs), attached are the full
>         log. The
>         problem happened in between 3-Oct to 4-Oct, I upgraded RabbitMQ to
>         v2.8.7 on 3-Oct.
>
>         Thanks & Regards,
>         Wong
>
>
>         On Thu, Oct 4, 2012 at 5:27 PM, Simon MacMullen
>         <simon at rabbitmq.com <mailto:simon at rabbitmq.com>
>         <mailto:simon at rabbitmq.com <mailto:simon at rabbitmq.com>>> wrote:
>
>              Hi. There's no good set of circumstances to see that
>         message - the
>              stats db should be restarted if it fails. Is this clustered or
>              standalone? Can you post logs?
>
>              Cheers, Simon
>
>
>              On 03/10/12 22:56, Wong Kam Hoong wrote:
>
>                  Hi RabbitMQ  team,
>
>                  Recently I upgrade my rabbitmq nodes with the latest
>         version
>                  2.8.7, but
>                  i saw weird message show on the web admin page:
>
>                  "Statistics database could not be contacted. Message
>         rates and queue
>                  lengths will not be shown."
>
>                  I not able to see any statistic such as current
>         produce/consume
>                  rate,
>                  and how many messages in each queue.
>
>                  Please advise how can i enable back the statistic.
>
>                  Regards,
>                  Wong
>
>
>
>                  ___________________________________________________
>                  rabbitmq-discuss mailing list
>                  rabbitmq-discuss at lists.__rabbi__tmq.com
>         <http://rabbitmq.com>
>                  <mailto:rabbitmq-discuss at __lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>>
>         https://lists.rabbitmq.com/____cgi-bin/mailman/listinfo/____rabbitmq-discuss
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>
>
>         <https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>>
>
>
>
>              --
>              Simon MacMullen
>              RabbitMQ, VMware
>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>     _________________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.__rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From tim at rabbitmq.com  Mon Oct  8 12:02:11 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 8 Oct 2012 12:02:11 +0100
Subject: [rabbitmq-discuss] 2.8.7 - Unexpected termination of HA node
In-Reply-To: <03CFB894A02BE24885082C694F789A7B13BF1920@PERMLS03.zettaserve.com>
References: <03CFB894A02BE24885082C694F789A7B13BF1920@PERMLS03.zettaserve.com>
Message-ID: <8CC4A591-0EE3-43CA-AC42-B113D9C4001D@rabbitmq.com>

Hi Nathanael,

We are aware of a bug regarding a stale master pid, which results from a master node restarting before the slave notices, and we *are* trying to fix this situation! The changes between 2.8.6 and 2.8.7 did not explicitly aim to fix this bug, and we previously saw symptoms that the master would not get restarted and that node would not be mirrored correctly - this sounds exactly like 'the queue [would] vanish from the cluster" which you describe. Clearly one of the 2.8.7 changes has caused a worse symptom to appear when the stale master is detected, so first of all, thanks very much for reporting this!

If you could provide me with logs for the two nodes, from both the master (during startup) and the slave that died, that would enormously helpful. From what I'm reading in your email, the second node actually crashes altogether when it detects that the master dies right? Can you please make sure the logs you post are in files with the node name and/or some indication in the file name whether that log is for the master or the slave? That would be really helpful in replicating and trying to fix this behaviour.

Cheers,
Tim

On 8 Oct 2012, at 01:56, Rensen, Nathanael wrote:

> While testing RabbitMQ version 2.8.7 I've encountered an issue where the slave node in a HA pair terminates when the master is forcefully rebooted.
>  
> The environment is Centos 6.3 with RabbitMQ 2.8.7, Erlang R14B, with a durable queue mirrored across a pair of nodes in a HA cluster. The master is rebooted using reboot -nf to simulate an ungraceful failure. When the master comes back up the slave node terminates with error log shown below.
>  
> The behaviour when testing with version 2.8.6 was that the queue would vanish from the cluster. With version 2.8.7 the queue remains intact, but the slave node terminates.
>  
> I've found that if the rabbitmq-server is not configured to start at boot the slave node eventually promotes itself to master and survives the eventual restart of the original master.
>  
> Nathanael
>  
> =INFO REPORT==== 5-Oct-2012::17:24:35 ===
> rabbit on node 'rabbit at zg-dev-nr-002' down
>  
> =INFO REPORT==== 5-Oct-2012::17:24:35 ===
> Statistics database started.
>  
> =INFO REPORT==== 5-Oct-2012::17:24:35 ===
> Mirrored-queue (queue 'zg-ha-test' in vhost '/'): Slave
> <'rabbit at zg-dev-nr-001'.3.252.0> saw deaths of mirrors
> <'rabbit at zg-dev-nr-002'.2.252.0>
>  
> =INFO REPORT==== 5-Oct-2012::17:24:35 ===
> Mirrored-queue (queue 'zg-ha-test' in vhost '/'): Promoting slave
> <'rabbit at zg-dev-nr-001'.3.252.0> to master
>  
> =ERROR REPORT==== 5-Oct-2012::17:24:35 ===
> ** Generic server <0.253.0> terminating
> ** Last message in was {mnesia_tm,'rabbit at zg-dev-nr-002',
>                                   {vote_yes,{tid,2235,<0.253.0>}}}
> ** When Server state == {state,
>                             {3,<0.253.0>},
>                             {{3,<0.253.0>},undefined},
>                             {{3,<0.253.0>},undefined},
>                             {resource,<<"/">>,queue,<<"zg-ha-test">>},
>                             rabbit_mirror_queue_coordinator,
>                             {6,
>                              [{{3,<0.253.0>},
>                                {view_member,
>                                    {3,<0.253.0>},
>                                    [],
>                                    {3,<0.253.0>},
>                                    {3,<0.253.0>}}}]},
>                             0,[],
>                             [<0.336.0>],
>                             {[],[]},
>                             [],undefined}
> ** Reason for termination ==
> ** {function_clause,
>        [{gm,handle_info,
>             [{mnesia_tm,'rabbit at zg-dev-nr-002',
>                  {vote_yes,{tid,2235,<0.253.0>}}},
>              {state,
>                  {3,<0.253.0>},
>                  {{3,<0.253.0>},undefined},
>                  {{3,<0.253.0>},undefined},
>                  {resource,<<"/">>,queue,<<"zg-ha-test">>},
>                  rabbit_mirror_queue_coordinator,
>                  {6,
>                   [{{3,<0.253.0>},
>                     {view_member,
>                         {3,<0.253.0>},
>                         [],
>                         {3,<0.253.0>},
>                         {3,<0.253.0>}}}]},
>                  0,[],
>                  [<0.336.0>],
>                  {[],[]},
>                  [],undefined}]},
>         {gen_server2,handle_msg,2},
>         {proc_lib,wake_up,3}]}
>  
> =ERROR REPORT==== 5-Oct-2012::17:24:36 ===
> ** Generic server <0.252.0> terminating
> ** Last message in was {'EXIT',<0.336.0>,
>                         {function_clause,
>                          [{gm,handle_info,
>                            [{mnesia_tm,'rabbit at zg-dev-nr-002',
>                              {vote_yes,{tid,2235,<0.253.0>}}},
>                             {state,
>                              {3,<0.253.0>},
>                              {{3,<0.253.0>},undefined},
>                              {{3,<0.253.0>},undefined},
>                              {resource,<<"/">>,queue,<<"zg-ha-test">>},
>                              rabbit_mirror_queue_coordinator,
>                              {6,
>                               [{{3,<0.253.0>},
>                                 {view_member,
>                                  {3,<0.253.0>},
>                                  [],
>                                  {3,<0.253.0>},
>                                  {3,<0.253.0>}}}]},
>                              0,[],
>                              [<0.336.0>],
>                              {[],[]},
>                              [],undefined}]},
>                           {gen_server2,handle_msg,2},
>                           {proc_lib,wake_up,3}]}}
> ** When Server state == {q,
>                          {amqqueue,
>                           {resource,<<"/">>,queue,<<"zg-ha-test">>},
>                           true,false,none,
>                           [{<<"x-ha-policy">>,longstr,<<"all">>}],
>                           <0.252.0>,[],all},
>                          none,false,rabbit_mirror_queue_master,
>                          {state,<0.253.0>,<0.336.0>,rabbit_variable_queue,
>                           {vqstate,
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            {delta,undefined,0,undefined},
>                            {0,{[],[]}},
> [... lots of stuff omitted...]
>                            {291,
>                            29148,
>                            {0,nil},
>                            undefined,
>                            {0,nil},
>                            {qistate,
>  
> "/var/lib/rabbitmq/mnesia/rabbit at zg-dev-nr-001/queues/EVSP28XGBN529KMXDI7YW0GM2",
>                             {{dict,0,16,16,8,80,48,
>                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              []},
>                             undefined,0,262144,
>                             #Fun<rabbit_variable_queue.2.121033067>,
>                             {0,nil}},
>                            {{client_msstate,msg_store_persistent,
>                              <<64,124,193,190,179,5,132,252,0,55,122,227,216,
>                                123,112,237>>,
>                              {dict,0,16,16,8,80,48,
>                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              {state,303177,
>  
> "/var/lib/rabbitmq/mnesia/rabbit at zg-dev-nr-001/msg_store_persistent"},
>                              rabbit_msg_store_ets_index,
>  
> "/var/lib/rabbitmq/mnesia/rabbit at zg-dev-nr-001/msg_store_persistent",
>                              <0.246.0>,307274,299080,311371,315468},
>                             {client_msstate,msg_store_transient,
>                              <<38,48,43,9,149,2,213,22,77,78,223,24,149,53,175,
>                                245>>,
>                              {dict,0,16,16,8,80,48,
>                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              {state,282692,
>  
> "/var/lib/rabbitmq/mnesia/rabbit at zg-dev-nr-001/msg_store_transient"},
>                              rabbit_msg_store_ets_index,
>  
> "/var/lib/rabbitmq/mnesia/rabbit at zg-dev-nr-001/msg_store_transient",
>                              <0.241.0>,286789,278595,290886,294983}},
>                            true,0,#Fun<rabbit_mirror_queue_slave.1.40624233>,
>                            291,0,infinity,291,0,152,0,291,
>                            {rates,
>                             {{1349,429050,591110},0},
>                             {{1349,429050,591110},0},
>                             1076.4632093998348,1076.4632093998348,
>                             {1349,429051,592073}},
>                            {0,nil},
>                            {0,nil},
>                            {0,nil},
>                            {0,nil},
>                            0,0,
>                            {rates,
>                             {{1349,429050,591110},0},
>                             {{1349,429050,591110},0},
>                             1071.7981467372135,1076.4632093998348,
>                             {1349,429051,592073}}},
>                           0,
>                           {dict,6,16,16,8,80,48,
>                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],
>                              [[<<218,200,61,58,97,50,72,197,144,158,220,215,
>                                  159,163,253,105>>|
>                                published]],
>                              [[<<80,182,167,56,95,139,134,134,192,40,123,239,
>                                  62,193,49,206>>|
>                                published],
>                               [<<159,219,2,228,110,119,150,246,97,74,183,72,
>                                  254,233,74,33>>|
>                                published],
>                               [<<223,108,153,205,69,107,192,83,254,145,181,
>                                  172,15,61,33,190>>|
>                                published]],
>                              [],[],[],[],
>                              [[<<8,84,74,65,208,81,184,115,74,86,225,237,241,
>                                  172,148,18>>|
>                                published]],
>                              [],[],[],[],[],
>                              [[<<"?jq$???S!?,a??u?">>|published]],
>                              []}}},
>                           [],
>                           {dict,0,16,16,8,80,48,
>                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}},
>                           {set,0,16,16,8,80,48,
>                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}}},
>                          {[],[]},
>                          undefined,undefined,#Ref<0.0.0.1342>,undefined,
>                          {state,fine,5000,#Ref<0.0.0.1406>},
>                          {0,nil},
>                          undefined,undefined,undefined,
>                          {dict,1,16,16,8,80,48,
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                           {{[],[],[],[],[],[],
>                             [[<7527.317.0>|#Ref<0.0.0.732>]],
>                             [],[],[],[],[],[],[],[],[]}}},
>                          1,
>                          {{0,nil},{0,nil}},
>                          undefined,
>                          {dict,0,16,16,8,80,48,
>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                          undefined,undefined}
> ** Reason for termination ==
> ** {noproc,{gen_server2,call,[<0.253.0>,info,infinity]}}
> ** In 'terminate' callback with reason ==
> ** {function_clause,
>        [{gm,handle_info,
>             [{mnesia_tm,'rabbit at zg-dev-nr-002',
>                  {vote_yes,{tid,2235,<0.253.0>}}},
>              {state,
>                  {3,<0.253.0>},
>                  {{3,<0.253.0>},undefined},
>                  {{3,<0.253.0>},undefined},
>                  {resource,<<"/">>,queue,<<"zg-ha-test">>},
>                  rabbit_mirror_queue_coordinator,
>                  {6,
>                   [{{3,<0.253.0>},
>                     {view_member,
>                         {3,<0.253.0>},
>                         [],
>                         {3,<0.253.0>},
>                         {3,<0.253.0>}}}]},
>                  0,[],
>                  [<0.336.0>],
>                  {[],[]},
>                  [],undefined}]},
>         {gen_server2,handle_msg,2},
>         {proc_lib,wake_up,3}]}
>  
> =INFO REPORT==== 5-Oct-2012::17:24:36 ===
> rabbit on node 'rabbit at zg-dev-nr-002' up
>  
> =ERROR REPORT==== 5-Oct-2012::17:24:36 ===
> ** Generic server <0.292.0> terminating
> ** Last message in was {mnesia_tm,'rabbit at zg-dev-nr-002',
>                                   {vote_yes,{tid,2236,<0.292.0>}}}
> ** When Server state == {state,<0.290.0>,<0.291.0>,rabbit_mgmt_sup,
>                             [{rabbit_mgmt_db,
>                                  {rabbit_mgmt_db,start_link,[]},
>                                  permanent,4294967295,worker,
>                                  [rabbit_mgmt_db]}]}
> ** Reason for termination ==
> ** {unexpected_info,{mnesia_tm,'rabbit at zg-dev-nr-002',
>                                {vote_yes,{tid,2236,<0.292.0>}}}}
>  
> =INFO REPORT==== 5-Oct-2012::17:24:36 ===
>     application: rabbitmq_management
>     exited: shutdown
>     type: permanent
>  
> =INFO REPORT==== 5-Oct-2012::17:24:36 ===
> stopped TCP Listener on [::]:5672
> 
> 
> ZettaServe Disclaimer: This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately if you have received this email by mistake and delete this email from your system. Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. ZettaServe Pty Ltd accepts no liability for any damage caused by any virus transmitted by this email.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Mon Oct  8 12:23:37 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 08 Oct 2012 12:23:37 +0100
Subject: [rabbitmq-discuss] Re-subscribing to a queue in a cluster
In-Reply-To: <BD46CD450E3D7843BCE36FF301A8BC4C2AA318A6@LCEEXMB02.LCE.com>
References: <BD46CD450E3D7843BCE36FF301A8BC4C2AA318A6@LCEEXMB02.LCE.com>
Message-ID: <5072B7B9.5080302@rabbitmq.com>


Hi Adam,

On 05/10/12 00:13, Adam Brightwell wrote:
> 1. Create new consumer and call basicConsume on the original channel.
> 2. Close original channel, recreate channel and call basicConsume with the
> new channel.
> 3. Close the original channel, close the original Connection.  Reconnect,
> recreate channel, call basicConsume with the new channel.

All three options should work, but it is not necessary to re-establish a
new consumer, channel or connection unless directly connected to the
failing node and therefore all options do more work than necessary. The
only required action is to resubscribe the existing consumer (and that
consumer must be prepared to receive duplicate messages).

> OR they will be consumed and unacknowledged. In the latter case, they
> are not being processed by my consumer or at least not making it to
> the "handleDelivery()" method.

So messages are consumed without acknowledgement, but don't make it to
the handleDelivery method? Can you explain what you mean by that?

Also, what version of RabbitMQ are you using? You are advised to use the
latest version.


-Emile



From eduardo.pinheiro.pt at gmail.com  Mon Oct  8 17:49:28 2012
From: eduardo.pinheiro.pt at gmail.com (edup_pt)
Date: Mon, 8 Oct 2012 09:49:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Pluggable exchange types (bug 22169) landed
	on default
In-Reply-To: <4B9032A3.3090604@lshift.net>
References: <4B9032A3.3090604@lshift.net>
Message-ID: <1349714968779-22415.post@n5.nabble.com>

Hi,

Great Post. For which i understand you talk about an exchange in client
javascript side, right? 

What i pretend to do is to have an exchange inside the same network,
meaning, if i have a main application in html/javascript i would like that
all others client browser's (in the same network) connects directly to this
main html/javascript  exchange (that is in the internal network). 

This exchange in client side will connect to other exchange that is in the
rabbitmq server for cases that the users are not in the same network.

Im looking for this exchanges in client side for (java, html/javascript and 
other languages)

Any ideia that can help me?

Thanks a lot.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Pluggable-exchange-types-bug-22169-landed-on-default-tp14982p22415.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From m.luchak at smartasking.com  Mon Oct  8 20:17:03 2012
From: m.luchak at smartasking.com (m.luchak at smartasking.com)
Date: Mon, 8 Oct 2012 15:17:03 -0400 (EDT)
Subject: [rabbitmq-discuss] PossibleAuthenticationFailureException
	intermittent
Message-ID: <1349723823.595123593@apps.rackspace.com>


Hi All,
 
I have an intermittent error, PossibleAuthenticationFailureException,  when restablishing connections to rabbit (2.8.6). This only occurs when I am testing a client connected on 3G and reconnect after I receive a shutdownexception (heartbeat).    Again, only "sometimes"...
 
It can't be a basic user/password fail as it only occurs @ 1 in 25 times on reconnect. 
 
Is there a config on the server that limits the number of connectons per client that could give this error?  Perhaps a connection lingering on the server? 
 
Any other hints or pointers?
 
thanks all,
Matthew
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121008/0f927a9e/attachment.htm>

From alex at inferiorhumanorgans.com  Mon Oct  8 20:20:06 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Mon, 8 Oct 2012 12:20:06 -0700
Subject: [rabbitmq-discuss] Proper protocol for dealing with crash dumps?
In-Reply-To: <507129B2.4080106@rabbitmq.com>
References: <20120929132049.GA88595@bloaty> <50680EE6.6050301@rabbitmq.com>
	<20121002140903.GD65786@bloaty> <506CAD22.5030305@rabbitmq.com>
	<50711095.4010104@inferiorhumanorgans.com>
	<507129B2.4080106@rabbitmq.com>
Message-ID: <20121008192006.GC95272@bloaty>

On Sun, Oct 07, 2012 at 08:05:22AM +0100, Matthias Radestock wrote:

> The total memory and high watermark are shown in the rabbit logs, e.g.
> s.t. like
> 
> =INFO REPORT==== 3-Oct-2012::20:31:08 ===
> Memory limit set to 4814MB of 12036MB total.
> 
> So check that these figures make sense for your setup.

=INFO REPORT==== 8-Oct-2012::10:00:43 ===
Memory limit set to 395MB of 988MB total.

> As suggested previously, when rabbit is using more memory than you
> expect the output of 'rabbitmqctl report' should shed some light on
> where it's going.

I'll try, but generally the devices having the most trouble have the
most unreliable connections, so logging in is often very difficult.

The other thing I'm seeing is that shovel appears to be getting
stuck (but the shovel status shows it's running) on a number
of these devices.  What sort of diagnostics would be useful
here?

- alex

From matthias at rabbitmq.com  Mon Oct  8 20:44:11 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 08 Oct 2012 20:44:11 +0100
Subject: [rabbitmq-discuss] Proper protocol for dealing with crash dumps?
In-Reply-To: <20121008192006.GC95272@bloaty>
References: <20120929132049.GA88595@bloaty> <50680EE6.6050301@rabbitmq.com>
	<20121002140903.GD65786@bloaty> <506CAD22.5030305@rabbitmq.com>
	<50711095.4010104@inferiorhumanorgans.com>
	<507129B2.4080106@rabbitmq.com> <20121008192006.GC95272@bloaty>
Message-ID: <50732D0B.4010600@rabbitmq.com>

Alex,

On 08/10/12 20:20, Alex Zepeda wrote:
> =INFO REPORT==== 8-Oct-2012::10:00:43 ===
> Memory limit set to 395MB of 988MB total.

Right, so rabbit attempting to allocate 700Mb looks a bit suspicious but 
could still be ok, i.e. if it wasn't using much at the time.

Could a client might be sending a very large message?

>> As suggested previously, when rabbit is using more memory than you
>> expect the output of 'rabbitmqctl report' should shed some light on
>> where it's going.
>
> I'll try, but generally the devices having the most trouble have the
> most unreliable connections, so logging in is often very difficult.

You may want to set up some automated monitoring/logging, so when a 
problem does arise you can look at the most recent reports in the post 
mortem.

> The other thing I'm seeing is that shovel appears to be getting
> stuck (but the shovel status shows it's running) on a number
> of these devices.  What sort of diagnostics would be useful
> here?

Have you got heartbeats enabled? If not then turn them on.

Do the shovel connections show up at the destination?

Btw, have you got a prefetch_count set in your shovel config and are 
running in an ack mode other than no_ack? If not then that might explain 
the unexpectedly high memory usage since a stuck shovel connection would 
cause messages to pile up in memory in the shovel.

Regards,

Matthias.

From james.mcmahon at TASC.COM  Mon Oct  8 21:02:25 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Mon, 8 Oct 2012 20:02:25 +0000
Subject: [rabbitmq-discuss] Failure to return from call to newConnection()
Message-ID: <242E9559AA2C354CB60C81A952FCBEB5017F7E@TSEAMB01>

      I am experiencing a problem that I have been unable to pin down. When I attempt to use a java class to listen for messages bound to a particular exchange by a particular routing key, I get a "Connection timed out" error. Here is my code:


public class ReceiveLogsDirect {

  private static final String EXCHANGE_NAME = "ABC_SERVER";

  public static void main(String[] argv) throws Exception {

      String hostName = "localhost";
      int portNumber = 5672;

      if (argv.length < 1 || argv.length == 2 || argv.length > 3){
          System.err.println("Usage: ReceiveLogsDirect [session ID] [RabbitMQ server IP, optional] [RabbitMQ server port #, optional]");
          System.exit(1);
      }
      else if (argv.length == 1) {
          hostName = "localhost";
          portNumber = 5672; // default port that rabbitMQ listens to
      }
      else if  (argv.length == 3) {
          hostName = argv[1];
          portNumber = Integer.parseInt(argv[2]);
      }

      ConnectionFactory factory = new ConnectionFactory();


      factory.setHost(hostName);
      factory.setPort(portNumber);
      factory.setUsername("guest");
      factory.setPassword("guest");
      factory.setVirtualHost("/");

      System.out.println(" [*] HERE 1");
      Connection connection = factory.newConnection();
      System.out.println(" [*] HERE 2");
      Channel channel = connection.createChannel();


    channel.exchangeDeclare(EXCHANGE_NAME, "direct");
    String queueName = channel.queueDeclare().getQueue();

        channel.queueBind(queueName, EXCHANGE_NAME, argv[0]);
        System.out.println(" [*] bindingKey " + argv[0]  +  " is bound to queue on exchange " + EXCHANGE_NAME );

    System.out.println(" [*] Waiting for messages. To exit press CTRL+C");

    QueueingConsumer consumer = new QueueingConsumer(channel);
    channel.basicConsume(queueName, true, consumer);

    while (true) {
      QueueingConsumer.Delivery delivery = consumer.nextDelivery();
      String message = new String(delivery.getBody());
      String routingKey = delivery.getEnvelope().getRoutingKey();

      System.out.println(" [x] Received message for " + routingKey + " >>>" + message);
    }
  }

I used simple print statements to pinpoint the source of the problem at the line where I call newConnection().

     The error I get is this:

 [*] HERE 1
Exception in thread "main" java.net.ConnectException: Connection timed out: connect
    at java.net.PlainSocketImpl.socketConnect(Native Method)
    at java.net.PlainSocketImpl.doConnect(Unknown Source)
    at java.net.PlainSocketImpl.connectToAddress(Unknown Source)
    at java.net.PlainSocketImpl.connect(Unknown Source)
    at java.net.SocksSocketImpl.connect(Unknown Source)
    at java.net.Socket.connect(Unknown Source)
    at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:441)
    at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:480)
    at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:509)
    at com.tasc.prism.queue.ReceiveLogsDirect.main(ReceiveLogsDirect.java:55)

     My install of rabbitMQ is 2.7.0. Oddly, I have been able to execute this in another command shell window and it works. I am wondering why I'm having trouble in the second shell? Surely I must be able to execute multiple instances of ReceiveLogsDirect simultaneously, right?

    Could it be a runtime environment problem? I set my class path exactly the same in both shells.

    Any thoughts or similar experience with such a problem? Thank you.

- Jim



CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121008/24bfc369/attachment.htm>

From prabodh.upreti at vce.com  Mon Oct  8 21:21:30 2012
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Mon, 8 Oct 2012 13:21:30 -0700 (PDT)
Subject: [rabbitmq-discuss] message viewer
Message-ID: <1349727690996-22420.post@n5.nabble.com>

Hello

Is there a message viewer UI tool I could use?  I need a UI where I can
display all the messages being published to the broker.  I already have a
java client  I can use to consume messages but not one that a nicer
interface which I can give to end users.  If there is not one available then
I will have to build one. thank you.

regards

prabodh



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/message-viewer-tp22420.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From alex at inferiorhumanorgans.com  Mon Oct  8 21:27:24 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Mon, 8 Oct 2012 13:27:24 -0700
Subject: [rabbitmq-discuss] Proper protocol for dealing with crash dumps?
In-Reply-To: <50732D0B.4010600@rabbitmq.com>
References: <20120929132049.GA88595@bloaty> <50680EE6.6050301@rabbitmq.com>
	<20121002140903.GD65786@bloaty> <506CAD22.5030305@rabbitmq.com>
	<50711095.4010104@inferiorhumanorgans.com>
	<507129B2.4080106@rabbitmq.com> <20121008192006.GC95272@bloaty>
	<50732D0B.4010600@rabbitmq.com>
Message-ID: <20121008202723.GD95272@bloaty>

On Mon, Oct 08, 2012 at 08:44:11PM +0100, Matthias Radestock wrote:

> Right, so rabbit attempting to allocate 700Mb looks a bit suspicious but 
> could still be ok, i.e. if it wasn't using much at the time.
> 
> Could a client might be sending a very large message?

I suppose anything's possible.  Is there some high water mark for message
size?  A typical message should be around 400 bytes of text.

> Have you got heartbeats enabled? If not then turn them on.

Yes.

> Do the shovel connections show up at the destination?

Yes, with a five second timeout.

> Btw, have you got a prefetch_count set in your shovel config and are 
> running in an ack mode other than no_ack? If not then that might explain 
> the unexpectedly high memory usage since a stuck shovel connection would 
> cause messages to pile up in memory in the shovel.

The shovel config looks like so:

		{shovel_one
                    [ {sources,
                        [ {broker, "amqp://"} ]}
                    , {destinations,
                        [ {broker, "amqp://user:password at remote.hostname?heartbeat=5"} ]}
                    , {queue, <<"queue_name">>}
                    , {ack_mode, on_confirm}
                    , {publish_properties, [ {delivery_mode, 2} ]}
                    , {reconnect_delay, 35}
                    ]}
                ]}
    ]}

- alex

From dougbarth at gmail.com  Mon Oct  8 22:00:12 2012
From: dougbarth at gmail.com (Doug Barth)
Date: Mon, 8 Oct 2012 14:00:12 -0700 (PDT)
Subject: [rabbitmq-discuss] rabbitmqctl list_connections hanging
Message-ID: <54308ebf-a80d-4e85-9bb8-a1ab86a66af8@googlegroups.com>

Hi,

Our RabbitMQ server suddenly started hanging when running "rabbitmqctl 
list_connections". All other commands seem to work just fine, and viewing 
the connection the HTTP interface works. It's just the command line that is 
hanging.

Here's all I see:

# /usr/sbin/rabbitmqctl list_connections
Listing connections ...

Is there something I can do to help troubleshoot this? Here's the output 
from "rabbitmqctl report" before it hangs on trying to pull connections.

# /usr/sbin/rabbitmqctl report
Reporting server status on {{2012,10,8},{20,54,53}}

Status of node rabbit at db1 ...
[{pid,32745},
 {running_applications,
     [{rabbitmq_management,"RabbitMQ Management Console","2.8.5"},
      {xmerl,"XML parser","1.2.10"},
      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.5"},
      {amqp_client,"RabbitMQ AMQP Client","2.8.5"},
      {rabbit,"RabbitMQ","2.8.5"},
      {os_mon,"CPO  CXC 138 46","2.2.7"},
      {sasl,"SASL  CXC 138 11","2.1.10"},
      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.5"},
      {webmachine,"webmachine","1.9.1-rmq2.8.5-git52e62bc"},
      {mochiweb,"MochiMedia Web Server","1.4.1"},
      {crypto,"CRYPTO version 2","2.0.4"},
      {inets,"INETS  CXC 138 49","5.7.1"},
      {mnesia,"MNESIA  CXC 138 12","4.5"},
      {stdlib,"ERTS  CXC 138 10","1.17.5"},
      {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,
     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:8:8] [rq:8] 
[async-threads:30] [kernel-poll:true]\n"},
 {memory,
     [{total,504912632},
      {processes,421348016},
      {processes_used,419304016},
      {system,83564616},
      {atom,4044769},
      {atom_used,4023674},
      {binary,34192176},
      {code,18261044},
      {ets,21905592}]},
 {vm_memory_high_watermark,0.25},
 {vm_memory_limit,4223227904},
 {disk_free_limit,1000000000},
 {disk_free,330037432320},
 {file_descriptors,
     [{total_limit,3996},
      {total_used,290},
      {sockets_limit,3594},
      {sockets_used,225}]},
 {processes,[{limit,1048576},{used,5329}]},
 {run_queue,0},
 {uptime,5162544}]

Cluster status of node rabbit at db1 ...
[{nodes,[{disc,[rabbit at db1]}]},{running_nodes,[rabbit at db1]}]

Application environment of node rabbit at db1 ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,fine},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {disk_free_limit,1000000000},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at db1.log"}},
 {frame_max,131072},
 {hipe_compile,false},
 {included_applications,[]},
 {log_levels,[{connection,info}]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at db1-sasl.log"}},
 {server_properties,[]},
 {ssl_cert_login_from,distinguished_name},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {linger,{true,0}},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.25}]

Connections:

Session terminated, killing shell... ...killed.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121008/ae12b96b/attachment.htm>

From matthias at rabbitmq.com  Mon Oct  8 22:06:48 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 08 Oct 2012 22:06:48 +0100
Subject: [rabbitmq-discuss] Proper protocol for dealing with crash dumps?
In-Reply-To: <20121008202723.GD95272@bloaty>
References: <20120929132049.GA88595@bloaty> <50680EE6.6050301@rabbitmq.com>
	<20121002140903.GD65786@bloaty> <506CAD22.5030305@rabbitmq.com>
	<50711095.4010104@inferiorhumanorgans.com>
	<507129B2.4080106@rabbitmq.com> <20121008192006.GC95272@bloaty>
	<50732D0B.4010600@rabbitmq.com> <20121008202723.GD95272@bloaty>
Message-ID: <50734068.1070002@rabbitmq.com>

Alex,

On 08/10/12 21:27, Alex Zepeda wrote:
> Is there some high water mark for message size?

Nope. Preventing out-of-memory errors due to ingestion of enormous 
messages is on our to do list.

>> Have you got heartbeats enabled? If not then turn them on.
>
> Yes.
>
>> Do the shovel connections show up at the destination?
>
> Yes, with a five second timeout.

So, just to be clear, you have connections that are "stuck" but do show 
up at the destination with a non-zero heartbeat/timeout? That's odd.

> The shovel config looks like so:
>
> 		{shovel_one
>                      [ {sources,
>                          [ {broker, "amqp://"} ]}
>                      , {destinations,
>                          [ {broker, "amqp://user:password at remote.hostname?heartbeat=5"} ]}
>                      , {queue, <<"queue_name">>}
>                      , {ack_mode, on_confirm}
>                      , {publish_properties, [ {delivery_mode, 2} ]}
>                      , {reconnect_delay, 35}
>                      ]}
>                  ]}
>      ]}

You can't got a prefetch_count set. This will cause all messages to pile 
up in memory in the event of a connection getting stuck.

Regards,

Matthias.


From simon at rabbitmq.com  Mon Oct  8 22:13:48 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 08 Oct 2012 22:13:48 +0100
Subject: [rabbitmq-discuss] message viewer
In-Reply-To: <1349727690996-22420.post@n5.nabble.com>
References: <1349727690996-22420.post@n5.nabble.com>
Message-ID: <5073420C.9000408@rabbitmq.com>

You can get messages in the management UI, expand "Get Messages" on the 
queue details page.

I'm not aware of anything else that's particularly UI-ish.

Cheers, Simon

On 08/10/2012 9:21PM, Prabodh Upreti wrote:
> Hello
>
> Is there a message viewer UI tool I could use?  I need a UI where I can
> display all the messages being published to the broker.  I already have a
> java client  I can use to consume messages but not one that a nicer
> interface which I can give to end users.  If there is not one available then
> I will have to build one. thank you.
>
> regards
>
> prabodh
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/message-viewer-tp22420.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Mon Oct  8 22:16:28 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 08 Oct 2012 22:16:28 +0100
Subject: [rabbitmq-discuss] PossibleAuthenticationFailureException
	intermittent
In-Reply-To: <1349723823.595123593@apps.rackspace.com>
References: <1349723823.595123593@apps.rackspace.com>
Message-ID: <507342AC.3080203@rabbitmq.com>

PossibleAuthenticationFailureException just means "the server closed the 
connection unexpectedly during AMQP handshake". It's required to do that 
in the case of authentication failure, but there can be other reasons, 
hence the name.

Check the server logs at the time the error occurs, more detail should 
be logged there.

Cheers, Simon

On 08/10/2012 8:17PM, m.luchak at smartasking.com wrote:
> Hi All,
>
> I have an intermittent error, PossibleAuthenticationFailureException,
> when restablishing connections to rabbit (2.8.6). This only occurs when
> I am testing a client connected on 3G and reconnect after I receive a
> shutdownexception (heartbeat).    Again, only "sometimes"...
>
> It can't be a basic user/password fail as it only occurs @ 1 in 25 times
> on reconnect.
>
> Is there a config on the server that limits the number of connectons per
> client that could give this error?  Perhaps a connection lingering on
> the server?
>
> Any other hints or pointers?
>
> thanks all,
>
> Matthew
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Mon Oct  8 22:22:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 08 Oct 2012 22:22:10 +0100
Subject: [rabbitmq-discuss] Failure to return from call to
	newConnection()
In-Reply-To: <242E9559AA2C354CB60C81A952FCBEB5017F7E@TSEAMB01>
References: <242E9559AA2C354CB60C81A952FCBEB5017F7E@TSEAMB01>
Message-ID: <50734402.9000307@rabbitmq.com>

The stack trace you have posted really does look like a standard case of 
the TCP connection timing out. I suggest you make absolutely sure that 
you really are connecting to the host/port you think you are.

Cheers, Simon

On 08/10/2012 9:02PM, McMahon, James S (TASC) wrote:
>        I am experiencing a problem that I have been unable to pin down.
> When I attempt to use a java class to listen for messages bound to a
> particular exchange by a particular routing key, I get a "Connection
> timed out" error. Here is my code:
>
>
> public class ReceiveLogsDirect {
>
>    private static final String EXCHANGE_NAME = "ABC_SERVER";
>
>    public static void main(String[] argv) throws Exception {
>
>        String hostName = "localhost";
>        int portNumber = 5672;
>
>        if (argv.length < 1 || argv.length == 2 || argv.length > 3){
>            System.err.println("Usage: ReceiveLogsDirect [session ID]
> [RabbitMQ server IP, optional] [RabbitMQ server port #, optional]");
>            System.exit(1);
>        }
>        else if (argv.length == 1) {
>            hostName = "localhost";
>            portNumber = 5672; // default port that rabbitMQ listens to
>        }
>        else if  (argv.length == 3) {
>            hostName = argv[1];
>            portNumber = Integer.parseInt(argv[2]);
>        }
>
>        ConnectionFactory factory = new ConnectionFactory();
>
>
>        factory.setHost(hostName);
>        factory.setPort(portNumber);
>        factory.setUsername("guest");
>        factory.setPassword("guest");
>        factory.setVirtualHost("/");
>
>        System.out.println(" [*] HERE 1");
>        Connection connection = factory.newConnection();
>        System.out.println(" [*] HERE 2");
>        Channel channel = connection.createChannel();
>
>
>      channel.exchangeDeclare(EXCHANGE_NAME, "direct");
>      String queueName = channel.queueDeclare().getQueue();
>
>          channel.queueBind(queueName, EXCHANGE_NAME, argv[0]);
>          System.out.println(" [*] bindingKey " + argv[0]  +  " is bound
> to queue on exchange " + EXCHANGE_NAME );
>
>      System.out.println(" [*] Waiting for messages. To exit press CTRL+C");
>
>      QueueingConsumer consumer = new QueueingConsumer(channel);
>      channel.basicConsume(queueName, true, consumer);
>
>      while (true) {
>        QueueingConsumer.Delivery delivery = consumer.nextDelivery();
>        String message = new String(delivery.getBody());
>        String routingKey = delivery.getEnvelope().getRoutingKey();
>
>        System.out.println(" [x] Received message for " + routingKey + "
>  >>>" + message);
>      }
>    }
>
> I used simple print statements to pinpoint the source of the problem at
> the line where I call newConnection().
>
>       The error I get is this:
>
>   [*] HERE 1
> Exception in thread "main" java.net.ConnectException: Connection timed
> out: connect
>      at java.net.PlainSocketImpl.socketConnect(Native Method)
>      at java.net.PlainSocketImpl.doConnect(Unknown Source)
>      at java.net.PlainSocketImpl.connectToAddress(Unknown Source)
>      at java.net.PlainSocketImpl.connect(Unknown Source)
>      at java.net.SocksSocketImpl.connect(Unknown Source)
>      at java.net.Socket.connect(Unknown Source)
>      at
> com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:441)
>      at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:480)
>      at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:509)
>      at
> com.tasc.prism.queue.ReceiveLogsDirect.main(ReceiveLogsDirect.java:55)
>
>       My install of rabbitMQ is 2.7.0. Oddly, I have been able to
> execute this in another command shell window and it works. I am
> wondering why I'm having trouble in the second shell? Surely I must be
> able to execute multiple instances of ReceiveLogsDirect simultaneously,
> right?
>
>      Could it be a runtime environment problem? I set my class path
> exactly the same in both shells.
>
>      Any thoughts or similar experience with such a problem? Thank you.
>
> - Jim
>
>
> CONFIDENTIALITY NOTICE: This message and any attachments or files
> transmitted with it (collectively, the "Message") are intended only for
> the addressee and may contain information that is privileged,
> proprietary and/or prohibited from disclosure by law or contract. If you
> are not the intended recipient: (a) please do not read, copy or
> retransmit the Message; (b) permanently delete and/or destroy all
> electronic and hard copies of the Message; (c) notify us by return
> email; and (d) you are hereby notified that any dissemination,
> distribution or copying of the Message is strictly prohibited.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matthias at rabbitmq.com  Mon Oct  8 22:30:02 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 08 Oct 2012 22:30:02 +0100
Subject: [rabbitmq-discuss] rabbitmqctl list_connections hanging
In-Reply-To: <54308ebf-a80d-4e85-9bb8-a1ab86a66af8@googlegroups.com>
References: <54308ebf-a80d-4e85-9bb8-a1ab86a66af8@googlegroups.com>
Message-ID: <507345DA.4040601@rabbitmq.com>

Doug,

On 08/10/12 22:00, Doug Barth wrote:
> Our RabbitMQ server suddenly started hanging when running "rabbitmqctl
> list_connections". All other commands seem to work just fine, and
> viewing the connection the HTTP interface works. It's just the command
> line that is hanging.

Is there anything of interest in the rabbit.log or rabbit-sasl.log?

Also, please post the output of

rabbitmqctl eval '[process_info(P) || P <- 
rabbit_networking:connections()].'

(all on one line)

Regards,

Matthias.


From dougbarth at gmail.com  Mon Oct  8 22:48:38 2012
From: dougbarth at gmail.com (Doug Barth)
Date: Mon, 8 Oct 2012 16:48:38 -0500
Subject: [rabbitmq-discuss] rabbitmqctl list_connections hanging
In-Reply-To: <507345DA.4040601@rabbitmq.com>
References: <54308ebf-a80d-4e85-9bb8-a1ab86a66af8@googlegroups.com>
	<507345DA.4040601@rabbitmq.com>
Message-ID: <CAFaaYAbtHjhgY+33=5tQRqKTesajbL3PH7Q1GumqdMaauh0oKA@mail.gmail.com>

On Mon, Oct 8, 2012 at 4:30 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Is there anything of interest in the rabbit.log or rabbit-sasl.log?
>
> Also, please post the output of
>
> rabbitmqctl eval '[process_info(P) || P <-
> rabbit_networking:connections()].'
>

Nothing jumps out to me in either log. I have attached the full sasl
log and a portion of the other log with an hour on either side of when
that command started timing out (11:40).

The "rabbitmqctl eval" command is hanging, so I don't have any output
from that command. Here's the state of that process.

rabbitmq 30176  0.3  0.0 137836 11672 ?        Ssl  16:39   0:00
/usr/lib64/erlang/erts-5.8.5/bin/beam.smp -- -root /usr/lib64/erlang
-progname erl -- -home /var/lib/rabbitmq -- -pa
/usr/lib/rabbitmq/lib/rabbitmq_server-2.8.5/sbin/../ebin -noshell
-noinput -hidden -sname rabbitmqctl30176 -s rabbit_control -nodename
rabbit at db1 -extra eval [process_info(P) || P <-
rabbit_networking:connections()].
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at db1.log
Type: application/octet-stream
Size: 377208 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121008/2720802f/attachment.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at db1-sasl.log
Type: application/octet-stream
Size: 6117 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121008/2720802f/attachment-0001.obj>

From alex at inferiorhumanorgans.com  Mon Oct  8 22:55:37 2012
From: alex at inferiorhumanorgans.com (Alex Zepeda)
Date: Mon, 8 Oct 2012 14:55:37 -0700
Subject: [rabbitmq-discuss] Proper protocol for dealing with crash dumps?
In-Reply-To: <50734068.1070002@rabbitmq.com>
References: <20120929132049.GA88595@bloaty> <50680EE6.6050301@rabbitmq.com>
	<20121002140903.GD65786@bloaty> <506CAD22.5030305@rabbitmq.com>
	<50711095.4010104@inferiorhumanorgans.com>
	<507129B2.4080106@rabbitmq.com> <20121008192006.GC95272@bloaty>
	<50732D0B.4010600@rabbitmq.com> <20121008202723.GD95272@bloaty>
	<50734068.1070002@rabbitmq.com>
Message-ID: <20121008215537.GG95272@bloaty>

On Mon, Oct 08, 2012 at 10:06:48PM +0100, Matthias Radestock wrote:

> So, just to be clear, you have connections that are "stuck" but do show 
> up at the destination with a non-zero heartbeat/timeout? That's odd.

The devices send messages to a local queue (shovel) and other messages 
directly to a remote rabbit server.  Some of these devices are able to
send out the remote messages, but the messages in the shovel queue
aren't being sent.  The last time I checked a device in this state,
I ran the command: rabbitmqctl eval 'rabbit_shovel_status:status().'

Which indicated to me that the shovel was active.  I have not checked
the remote rabbit instance (yet).  All of the shovel configurations
should be identical.

If/when I succeed in logging into one of these stuck devices, are
there any pertinent commands I should run?

> > The shovel config looks like so:
> >
> > 		{shovel_one
> >                      [ {sources,
> >                          [ {broker, "amqp://"} ]}
> >                      , {destinations,
> >                          [ {broker, "amqp://user:password at remote.hostname?heartbeat=5"} ]}
> >                      , {queue, <<"queue_name">>}
> >                      , {ack_mode, on_confirm}
> >                      , {publish_properties, [ {delivery_mode, 2} ]}
> >                      , {reconnect_delay, 35}
> >                      ]}
> >                  ]}
> >      ]}
> 
> You can't got a prefetch_count set. This will cause all messages to pile 
> up in memory in the event of a connection getting stuck.

Should I set prefetch_count?  The queue in this case is durable, and
messages should be delivered to the local queue with delivery_mode = 2.

- alex

From matthias at rabbitmq.com  Mon Oct  8 23:02:16 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 08 Oct 2012 23:02:16 +0100
Subject: [rabbitmq-discuss] Proper protocol for dealing with crash dumps?
In-Reply-To: <20121008215537.GG95272@bloaty>
References: <20120929132049.GA88595@bloaty> <50680EE6.6050301@rabbitmq.com>
	<20121002140903.GD65786@bloaty> <506CAD22.5030305@rabbitmq.com>
	<50711095.4010104@inferiorhumanorgans.com>
	<507129B2.4080106@rabbitmq.com> <20121008192006.GC95272@bloaty>
	<50732D0B.4010600@rabbitmq.com> <20121008202723.GD95272@bloaty>
	<50734068.1070002@rabbitmq.com> <20121008215537.GG95272@bloaty>
Message-ID: <50734D68.5090107@rabbitmq.com>

Alex,

On 08/10/12 22:55, Alex Zepeda wrote:
> On Mon, Oct 08, 2012 at 10:06:48PM +0100, Matthias Radestock wrote: I
> have not checked the remote rabbit instance (yet).

Please do.

> If/when I succeed in logging into one of these stuck devices, are
> there any pertinent commands I should run?

Not that I can think of. But please do check the logs for any abnormalities.

> Should I set prefetch_count?

Sorry, bad grammar on my part was obscuring the point there. Yes, you
should.

> The queue in this case is durable, and messages should be delivered
> to the local queue with delivery_mode = 2.

W/o a prefetch_count the messages won't stay in the local queue; they
will be sent to the shovel, where, if the outbound connect is stuck,
they will sit in memory.

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Oct  8 23:11:49 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 08 Oct 2012 23:11:49 +0100
Subject: [rabbitmq-discuss] rabbitmqctl list_connections hanging
In-Reply-To: <CAFaaYAbtHjhgY+33=5tQRqKTesajbL3PH7Q1GumqdMaauh0oKA@mail.gmail.com>
References: <54308ebf-a80d-4e85-9bb8-a1ab86a66af8@googlegroups.com>
	<507345DA.4040601@rabbitmq.com>
	<CAFaaYAbtHjhgY+33=5tQRqKTesajbL3PH7Q1GumqdMaauh0oKA@mail.gmail.com>
Message-ID: <50734FA5.8080909@rabbitmq.com>

Doug,

On 08/10/12 22:48, Doug Barth wrote:
> Nothing jumps out to me in either log.

Yes, they do look fine.

> I have attached the full sasl log and a portion of the other log with
> an hour on either side of when that command started timing out
> (11:40).

Hmm. So connections were still being accepted after the problem surfaced?

> The "rabbitmqctl eval" command is hanging

Interesting. Give these two a try:

rabbitmqctl eval 'rabbit_mnesia:running_clustered_nodes().'

rabbitmqctl eval 'process_info(whereis(rabbit_tcp_client_sup)).'


Regards,

Matthias.

From dougbarth at gmail.com  Tue Oct  9 03:35:15 2012
From: dougbarth at gmail.com (Doug Barth)
Date: Mon, 8 Oct 2012 21:35:15 -0500
Subject: [rabbitmq-discuss] rabbitmqctl list_connections hanging
In-Reply-To: <50734FA5.8080909@rabbitmq.com>
References: <54308ebf-a80d-4e85-9bb8-a1ab86a66af8@googlegroups.com>
	<507345DA.4040601@rabbitmq.com>
	<CAFaaYAbtHjhgY+33=5tQRqKTesajbL3PH7Q1GumqdMaauh0oKA@mail.gmail.com>
	<50734FA5.8080909@rabbitmq.com>
Message-ID: <CAFaaYAZB=fY=rsvaJN1E8pLceRMOEriQMRPLNJxzZPecce1biA@mail.gmail.com>

On Mon, Oct 8, 2012 at 5:11 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> Hmm. So connections were still being accepted after the problem surfaced?

Yes, AMQP connections are still accepted and all our existing
connections seem fine.

>> The "rabbitmqctl eval" command is hanging
>
>
> Interesting. Give these two a try:
>
> rabbitmqctl eval 'rabbit_mnesia:running_clustered_nodes().'

$ sudo /usr/sbin/rabbitmqctl eval 'rabbit_mnesia:running_clustered_nodes().'
[rabbit at db1]
...done.

> rabbitmqctl eval 'process_info(whereis(rabbit_tcp_client_sup)).'

$ sudo /usr/sbin/rabbitmqctl eval
'process_info(whereis(rabbit_tcp_client_sup)).'
[{registered_name,rabbit_tcp_client_sup},
 {current_function,{gen_server,loop,6}},
 {initial_call,{proc_lib,init_p,5}},
 {status,waiting},
 {message_queue_len,0},
 {messages,[]},
 {links,[<4825.22471.134>,<4825.15945.205>,<4825.5788.206>,<4825.18338.206>,
         <4825.18756.206>,<4825.18840.206>,<4825.18880.206>,<4825.18814.206>,
         <4825.18818.206>,<4825.18800.206>,<4825.18629.206>,<4825.18412.206>,
         <4825.15784.206>,<4825.16819.206>,<4825.18079.206>,<4825.17195.206>,
         <4825.16802.206>,<4825.16665.206>,<4825.14034.206>,<4825.15285.206>,
         <4825.12749.206>,<4825.13888.206>,<4825.8936.206>,<4825.22353.205>,
         <4825.26205.205>,<4825.5649.206>,<4825.5276.206>,<4825.22405.205>,
         <4825.22421.205>,<4825.22430.205>,<4825.22413.205>,<4825.22385.205>,
         <4825.22397.205>,<4825.22369.205>,<4825.22262.205>,<4825.22280.205>,
         <4825.22337.205>,<4825.22272.205>,<4825.22236.205>,<4825.22247.205>,
         <4825.28096.183>,<4825.11731.205>,<4825.15219.205>,<4825.15564.205>,
         <4825.15661.205>,<4825.15761.205>,<4825.15609.205>,<4825.15583.205>,
         <4825.15420.205>,<4825.15491.205>,<4825.15530.205>,<4825.15462.205>,
         <4825.15349.205>,<4825.15391.205>,<4825.15303.205>,<4825.15167.205>,
         <4825.15203.205>,<4825.15171.205>,<4825.13953.205>,<4825.15120.205>,
         <4825.15150.205>,<4825.13596.205>,<4825.8586.205>,<4825.11065.205>,
         <4825.11448.205>,<4825.9839.205>,<4825.10639.205>,<4825.14778.197>,
         <4825.23363.201>,<4825.12978.203>,<4825.1680.197>,<4825.9942.197>,
         <4825.7391.183>,<4825.7524.183>,<4825.28015.183>,<4825.28072.183>,
         <4825.28080.183>,<4825.28056.183>,<4825.28060.183>,<4825.28023.183>,
         <4825.7556.183>,<4825.7564.183>,<4825.7532.183>,<4825.7439.183>,
         <4825.7484.183>,<4825.7508.183>,<4825.7516.183>,<4825.7500.183>,
         <4825.7468.183>,<4825.7476.183>,<4825.7407.183>,<4825.7431.183>,
         <4825.7415.183>,<4825.7399.183>,<4825.7257.183>,<4825.7323.183>,
         <4825.7355.183>,<4825.7371.183>,<4825.7379.183>,<4825.7363.183>,
         <4825.7339.183>,<4825.7347.183>,<4825.7331.183>,<4825.7290.183>,
         <4825.7306.183>,<4825.7314.183>,<4825.7298.183>,<4825.7273.183>,
         <4825.7281.183>,<4825.7265.183>,<4825.5267.183>,<4825.5352.183>,
         <4825.7099.183>,<4825.7108.183>,<4825.5364.183>,<4825.5316.183>,
         <4825.5328.183>,<4825.5308.183>,<4825.5235.183>,<4825.5251.183>,
         <4825.5259.183>,<4825.5243.183>,<4825.5137.183>,<4825.879.72>,
         <4825.26671.133>,<4825.30502.133>,<4825.1342.134>,<4825.1580.134>,
         <4825.1600.134>,<4825.1325.134>,<4825.30114.133>,<4825.30232.133>,
         <4825.30357.133>,<4825.30439.133>,<4825.30336.133>,<4825.30138.133>,
         <4825.29556.133>,<4825.30110.133>,<4825.28857.133>,<4825.21364.133>,
         <4825.25532.133>,<4825.25694.133>,<4825.25867.133>,<4825.24236.133>,
         <4825.25520.133>,<4825.27515.113>,<4825.18533.133>,<4825.21356.133>,
         <4825.27495.113>,<4825.22630.45>,<4825.23299.66>,<4825.26012.70>,
         <4825.26125.70>,<4825.26129.70>,<4825.871.72>,<4825.26103.70>,
         <4825.26117.70>,<4825.26000.70>,<4825.26008.70>,<4825.25992.70>,
         <4825.23058.66>,<4825.23193.66>,<4825.23241.66>,<4825.23283.66>,
         <4825.23267.66>,<4825.23225.66>,<4825.23200.66>,<4825.23125.66>,
         <4825.23161.66>,<4825.23177.66>,<4825.23145.66>,<4825.23090.66>,
         <4825.23109.66>,<4825.23074.66>,<4825.22925.66>,<4825.22990.66>,
         <4825.23022.66>,<4825.23038.66>,<4825.23006.66>,<4825.22958.66>,
         <4825.22974.66>,<4825.22941.66>,<4825.22856.66>,<4825.22888.66>,
         <4825.22908.66>,<4825.22872.66>,<4825.22821.66>,<4825.22840.66>,
         <4825.30414.1>,<4825.30532.1>,<4825.22598.45>,<4825.22614.45>,
         <4825.22566.45>,<4825.22582.45>,<4825.22550.45>,<4825.30478.1>,
         <4825.30510.1>,<4825.30524.1>,<4825.30494.1>,<4825.30502.1>,
         <4825.30486.1>,<4825.30446.1>,<4825.30462.1>,<4825.30470.1>,
         <4825.30454.1>,<4825.30430.1>,<4825.30438.1>,<4825.30422.1>,
         <4825.30341.1>,<4825.30382.1>,<4825.30398.1>,<4825.30406.1>,
         <4825.30390.1>,<4825.30358.1>,<4825.30366.1>,<4825.30345.1>,
         <4825.4332.0>,<4825.30325.1>,<4825.30333.1>,<4825.574.0>,
         <4825.1477.0>,<4825.163.0>]},
 {dictionary,[{'$ancestors',[rabbit_sup,<4825.162.0>]},
              {'$initial_call',{supervisor2,init,1}}]},
 {trap_exit,true},
 {error_handler,error_handler},
 {priority,normal},
 {group_leader,<4825.161.0>},
 {total_heap_size,8362},
 {heap_size,4181},
 {stack_size,9},
 {reductions,88549449},
 {garbage_collection,[{min_bin_vheap_size,46368},
                      {min_heap_size,233},
                      {fullsweep_after,65535},
                      {minor_gcs,47}]},
 {suspending,[]}]
...done.

Thanks,
Doug

From matthias at rabbitmq.com  Tue Oct  9 05:21:50 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 09 Oct 2012 05:21:50 +0100
Subject: [rabbitmq-discuss] rabbitmqctl list_connections hanging
In-Reply-To: <CAFaaYAZB=fY=rsvaJN1E8pLceRMOEriQMRPLNJxzZPecce1biA@mail.gmail.com>
References: <54308ebf-a80d-4e85-9bb8-a1ab86a66af8@googlegroups.com>
	<507345DA.4040601@rabbitmq.com>
	<CAFaaYAbtHjhgY+33=5tQRqKTesajbL3PH7Q1GumqdMaauh0oKA@mail.gmail.com>
	<50734FA5.8080909@rabbitmq.com>
	<CAFaaYAZB=fY=rsvaJN1E8pLceRMOEriQMRPLNJxzZPecce1biA@mail.gmail.com>
Message-ID: <5073A65E.9010709@rabbitmq.com>

On 09/10/12 03:35, Doug Barth wrote:
> On Mon, Oct 8, 2012 at 5:11 PM, Matthias Radestock
> <matthias at rabbitmq.com> wrote:
>> Hmm. So connections were still being accepted after the problem surfaced?
>
> Yes, AMQP connections are still accepted and all our existing
> connections seem fine.

ok.

> $ sudo /usr/sbin/rabbitmqctl eval
> 'process_info(whereis(rabbit_tcp_client_sup)).'
> [{registered_name,rabbit_tcp_client_sup},
>   {current_function,{gen_server,loop,6}},
>   {initial_call,{proc_lib,init_p,5}},
>   {status,waiting},
>   {message_queue_len,0},
>   {messages,[]},
 > ...

Good. That's consistent with the fact that connections are still being 
accepted.

Bear with me, this may take a few iterations... (if you can let me have 
a shell on the machine we could do this more quickly)...

Next try:

rabbitmqctl eval '[process_info(ConnSup) || {_, ConnSup, supervisor, _} 
<- supervisor:which_children(rabbit_tcp_client_sup)].'


Regards,

Matthias.

From info at geocast.net  Tue Oct  9 08:10:55 2012
From: info at geocast.net (Geocast)
Date: Tue, 9 Oct 2012 15:10:55 +0800
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
Message-ID: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>

Hello,

I am running rabbitmq as a cluster node, the version 2.8.2, erlang info:
Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:8:8]
[async-threads:30] [kernel-poll:true]

The system is Ubuntu server 9.10 64 bit.

This rabbitmq has been running for long days without problems.
Today I restarted it but failed. The info:


root at rabbitmq2:/var/log/rabbitmq# cat startup_err

Crash dump was written to: erl_crash.dump
eheap_alloc: Cannot allocate 2850821240 bytes of memory (of type "heap").
Aborted

root at rabbitmq2:/var/log/rabbitmq# free -m
             total       used       free     shared    buffers     cached
Mem:          8004       1242       6761          0         13        870
-/+ buffers/cache:        359       7645
Swap:            0          0          0

root at rabbitmq2:/var/log/rabbitmq# rabbitmqctl status
Status of node 'testmq-slave at rabbitmq2' ...
Error: unable to connect to node 'testmq-slave at rabbitmq2': nodedown

DIAGNOSTICS
===========

nodes in question: ['testmq-slave at rabbitmq2']

hosts, their running nodes and ports:
- rabbitmq2: [{rabbitmqctl4487,63660}]

current node details:
- node name: rabbitmqctl4487 at rabbitmq2
- home dir: /var/lib/rabbitmq
- cookie hash: ****



As you see, my system has enough free memory, but rabbitmq aborted in
the process of starting.
Please help, thanks in advance.

From emile at rabbitmq.com  Tue Oct  9 10:17:17 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 09 Oct 2012 10:17:17 +0100
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
Message-ID: <5073EB9D.600@rabbitmq.com>

Hi,

On 09/10/12 08:10, Geocast wrote:
> This rabbitmq has been running for long days without problems.
> Today I restarted it but failed. The info:
> 
> root at rabbitmq2:/var/log/rabbitmq# cat startup_err

The reason for the broker crashing in the first place is more likely to
be in the main broker logfile or the broker sasl file. You should look
at that also.

> Crash dump was written to: erl_crash.dump
> eheap_alloc: Cannot allocate 2850821240 bytes of memory (of type "heap").
> Aborted

I assume the quoted error was generated upon attempted startup after the
crash. The crash would have caused the broker to stop in such a way that
an expensive and lengthy recovery process is required at startup, in
order to recover messages.

> root at rabbitmq2:/var/log/rabbitmq# free -m
>              total       used       free     shared    buffers     cached
> Mem:          8004       1242       6761          0         13        870

> As you see, my system has enough free memory, but rabbitmq aborted in
> the process of starting.

It does looks like there is enough free memory and that allocation
should succeed, but this depends on when the "free" command was run.
There may have been less free memory while the broker was trying to
start up. Is there any other reason why the OS might refuse? Are there
any ulimits in effect that might prevent it? Does the OS syslog say
anything? The root user might not be subject to the same limit, so it
might be worth running the broker as root, just to start up.

Can you get Erlang to allocate that much memory independently from the
running the broker? Try this test - start an Erlang VM

 erl

and enter this:

 size(<<0:2850821240/unit:8>>).

The result should be 2850821240. If you receive an error instead then
the broker is unlikely to have enough RAM to recover messages at startup.


-Emile

From info at geocast.net  Tue Oct  9 10:31:18 2012
From: info at geocast.net (Geocast)
Date: Tue, 9 Oct 2012 17:31:18 +0800
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <5073EB9D.600@rabbitmq.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
Message-ID: <CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>

Hello Emile,

Thanks for your kind answer. This is my test:

root at rabbitmq2:~# free -m
             total       used       free     shared    buffers     cached
Mem:          8004        452       7551          0          9         88
-/+ buffers/cache:        354       7649
Swap:            0          0          0
root at rabbitmq2:~#
root at rabbitmq2:~# erl
Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:8:8]
[async-threads:0] [kernel-poll:false]

Eshell V5.9.1  (abort with ^G)
1> size(<<0:2850821240/unit:8>>).

Crash dump was written to: erl_crash.dump
binary_alloc: Cannot allocate 5701642511 bytes of memory (of type "binary").
Aborted

It seems so strange, why the memory allocation fails though there is
enough free memory there?

Thanks again.



2012/10/9 Emile Joubert <emile at rabbitmq.com>:
> Hi,
>
> On 09/10/12 08:10, Geocast wrote:
>> This rabbitmq has been running for long days without problems.
>> Today I restarted it but failed. The info:
>>
>> root at rabbitmq2:/var/log/rabbitmq# cat startup_err
>
> The reason for the broker crashing in the first place is more likely to
> be in the main broker logfile or the broker sasl file. You should look
> at that also.
>
>> Crash dump was written to: erl_crash.dump
>> eheap_alloc: Cannot allocate 2850821240 bytes of memory (of type "heap").
>> Aborted
>
> I assume the quoted error was generated upon attempted startup after the
> crash. The crash would have caused the broker to stop in such a way that
> an expensive and lengthy recovery process is required at startup, in
> order to recover messages.
>
>> root at rabbitmq2:/var/log/rabbitmq# free -m
>>              total       used       free     shared    buffers     cached
>> Mem:          8004       1242       6761          0         13        870
>
>> As you see, my system has enough free memory, but rabbitmq aborted in
>> the process of starting.
>
> It does looks like there is enough free memory and that allocation
> should succeed, but this depends on when the "free" command was run.
> There may have been less free memory while the broker was trying to
> start up. Is there any other reason why the OS might refuse? Are there
> any ulimits in effect that might prevent it? Does the OS syslog say
> anything? The root user might not be subject to the same limit, so it
> might be worth running the broker as root, just to start up.
>
> Can you get Erlang to allocate that much memory independently from the
> running the broker? Try this test - start an Erlang VM
>
>  erl
>
> and enter this:
>
>  size(<<0:2850821240/unit:8>>).
>
> The result should be 2850821240. If you receive an error instead then
> the broker is unlikely to have enough RAM to recover messages at startup.
>
>
> -Emile

From emile at rabbitmq.com  Tue Oct  9 11:04:03 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 09 Oct 2012 11:04:03 +0100
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
Message-ID: <5073F693.9050809@rabbitmq.com>

On 09/10/12 10:31, Geocast wrote:
> It seems so strange, why the memory allocation fails though there is
> enough free memory there?

Memory allocation failures can have many causes and are difficult to
diagnose without access to the machine. You should check the syslog,
kernel parameters and hardening configuration (if any) and ulimits. You
should also consider adding more swap and tweaking the overcommit ratio.
A forum dedicated to Ubuntu 9.10 or Linux will be able to offer more
comprehensive help.

Other more drastic options you might consider:

Temporarily install more more RAM.

Transfer the database directory to a server with more RAM, while setting
the nodename the same as the original host. Then copy the database
directory back after a clean shutdown.

If you don't need the contents of the queues then the recovery process
can be avoided by discarding the database directory.



-Emile


From james.mcmahon at TASC.COM  Tue Oct  9 11:19:57 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Tue, 9 Oct 2012 10:19:57 +0000
Subject: [rabbitmq-discuss] Failure to return from call to
 newConnection()
In-Reply-To: <50734402.9000307@rabbitmq.com>
References: <242E9559AA2C354CB60C81A952FCBEB5017F7E@TSEAMB01>,
	<50734402.9000307@rabbitmq.com>
Message-ID: <242E9559AA2C354CB60C81A952FCBEB501801E@TSEAMB01>

     Thank you for your help, Simon. I did look more closely at the situation as you suggested. It seems that I can only start one process listening to a specific port at IP address of the rabbitMQ server. I can't start the second listening to the same port at the same address.

     In one command shell, I start my listener on port 5672. It works great. I then start up a second command shell, the first still running. I tell the second instance of my listener process to listen to the same port. It never returns, and I get the connection timed out error. If I start my second process without pointing it to a port or using an IP address, it works just fine. To the untrained (ie, me), this tells me that the second works because it goes to my rabbitMQ server instance locally, rather than through IP and port.

    So in summary: two listener processes in different command shells on the same physical laptop, started from the command line. Trying to listen on the same port, to the same rabbitMQ server instance at IP. Not being familiar with port configurations and limitations, shouldn't I be able to have multiple listener processes listening to incoming on the same port? The evidence appears to say "no". Why is that?

- Jim

________________________________________
From: Simon MacMullen [simon at rabbitmq.com]
Sent: Monday, October 08, 2012 5:22 PM
To: Discussions about RabbitMQ
Cc: McMahon, James S (TASC)
Subject: Re: [rabbitmq-discuss] Failure to return from call to newConnection()

The stack trace you have posted really does look like a standard case of
the TCP connection timing out. I suggest you make absolutely sure that
you really are connecting to the host/port you think you are.

Cheers, Simon

On 08/10/2012 9:02PM, McMahon, James S (TASC) wrote:
>        I am experiencing a problem that I have been unable to pin down.
> When I attempt to use a java class to listen for messages bound to a
> particular exchange by a particular routing key, I get a "Connection
> timed out" error. Here is my code:
>
>
> public class ReceiveLogsDirect {
>
>    private static final String EXCHANGE_NAME = "ABC_SERVER";
>
>    public static void main(String[] argv) throws Exception {
>
>        String hostName = "localhost";
>        int portNumber = 5672;
>
>        if (argv.length < 1 || argv.length == 2 || argv.length > 3){
>            System.err.println("Usage: ReceiveLogsDirect [session ID]
> [RabbitMQ server IP, optional] [RabbitMQ server port #, optional]");
>            System.exit(1);
>        }
>        else if (argv.length == 1) {
>            hostName = "localhost";
>            portNumber = 5672; // default port that rabbitMQ listens to
>        }
>        else if  (argv.length == 3) {
>            hostName = argv[1];
>            portNumber = Integer.parseInt(argv[2]);
>        }
>
>        ConnectionFactory factory = new ConnectionFactory();
>
>
>        factory.setHost(hostName);
>        factory.setPort(portNumber);
>        factory.setUsername("guest");
>        factory.setPassword("guest");
>        factory.setVirtualHost("/");
>
>        System.out.println(" [*] HERE 1");
>        Connection connection = factory.newConnection();
>        System.out.println(" [*] HERE 2");
>        Channel channel = connection.createChannel();
>
>
>      channel.exchangeDeclare(EXCHANGE_NAME, "direct");
>      String queueName = channel.queueDeclare().getQueue();
>
>          channel.queueBind(queueName, EXCHANGE_NAME, argv[0]);
>          System.out.println(" [*] bindingKey " + argv[0]  +  " is bound
> to queue on exchange " + EXCHANGE_NAME );
>
>      System.out.println(" [*] Waiting for messages. To exit press CTRL+C");
>
>      QueueingConsumer consumer = new QueueingConsumer(channel);
>      channel.basicConsume(queueName, true, consumer);
>
>      while (true) {
>        QueueingConsumer.Delivery delivery = consumer.nextDelivery();
>        String message = new String(delivery.getBody());
>        String routingKey = delivery.getEnvelope().getRoutingKey();
>
>        System.out.println(" [x] Received message for " + routingKey + "
>  >>>" + message);
>      }
>    }
>
> I used simple print statements to pinpoint the source of the problem at
> the line where I call newConnection().
>
>       The error I get is this:
>
>   [*] HERE 1
> Exception in thread "main" java.net.ConnectException: Connection timed
> out: connect
>      at java.net.PlainSocketImpl.socketConnect(Native Method)
>      at java.net.PlainSocketImpl.doConnect(Unknown Source)
>      at java.net.PlainSocketImpl.connectToAddress(Unknown Source)
>      at java.net.PlainSocketImpl.connect(Unknown Source)
>      at java.net.SocksSocketImpl.connect(Unknown Source)
>      at java.net.Socket.connect(Unknown Source)
>      at
> com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:441)
>      at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:480)
>      at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:509)
>      at
> com.tasc.prism.queue.ReceiveLogsDirect.main(ReceiveLogsDirect.java:55)
>
>       My install of rabbitMQ is 2.7.0. Oddly, I have been able to
> execute this in another command shell window and it works. I am
> wondering why I'm having trouble in the second shell? Surely I must be
> able to execute multiple instances of ReceiveLogsDirect simultaneously,
> right?
>
>      Could it be a runtime environment problem? I set my class path
> exactly the same in both shells.
>
>      Any thoughts or similar experience with such a problem? Thank you.
>
> - Jim
>
>
> CONFIDENTIALITY NOTICE: This message and any attachments or files
> transmitted with it (collectively, the "Message") are intended only for
> the addressee and may contain information that is privileged,
> proprietary and/or prohibited from disclosure by law or contract. If you
> are not the intended recipient: (a) please do not read, copy or
> retransmit the Message; (b) permanently delete and/or destroy all
> electronic and hard copies of the Message; (c) notify us by return
> email; and (d) you are hereby notified that any dissemination,
> distribution or copying of the Message is strictly prohibited.
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.

From matthias at rabbitmq.com  Tue Oct  9 11:32:21 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 09 Oct 2012 11:32:21 +0100
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <5073F693.9050809@rabbitmq.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
	<5073F693.9050809@rabbitmq.com>
Message-ID: <5073FD35.5060406@rabbitmq.com>

On 09/10/12 11:04, Emile Joubert wrote:
> On 09/10/12 10:31, Geocast wrote:
>> It seems so strange, why the memory allocation fails though there is
>> enough free memory there?
>
> Memory allocation failures can have many causes and are difficult to
> diagnose without access to the machine.

How much memory did *rabbit* think it had available when it last started 
successfully? Check the rabbit.log for an entry like this:

=INFO REPORT==== 3-Oct-2012::20:31:08 ===
Memory limit set to 4814MB of 12036MB total.


Regards,

Matthias.

From info at geocast.net  Tue Oct  9 11:51:01 2012
From: info at geocast.net (Geocast)
Date: Tue, 9 Oct 2012 18:51:01 +0800
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <5073F693.9050809@rabbitmq.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
	<5073F693.9050809@rabbitmq.com>
Message-ID: <CANC53sFhQHvqpRdqqPjnsBS2tDDo=+1pY+kH4BpUQHsXVXsfFw@mail.gmail.com>

I have added the swap to 32G, and restarted the broker, the top command shows:

(screencut attached)

it's still in process, wish I get good luck.
Thank you.


2012/10/9 Emile Joubert <emile at rabbitmq.com>:
> On 09/10/12 10:31, Geocast wrote:
>> It seems so strange, why the memory allocation fails though there is
>> enough free memory there?
>
> Memory allocation failures can have many causes and are difficult to
> diagnose without access to the machine. You should check the syslog,
> kernel parameters and hardening configuration (if any) and ulimits. You
> should also consider adding more swap and tweaking the overcommit ratio.
> A forum dedicated to Ubuntu 9.10 or Linux will be able to offer more
> comprehensive help.
>
> Other more drastic options you might consider:
>
> Temporarily install more more RAM.
>
> Transfer the database directory to a server with more RAM, while setting
> the nodename the same as the original host. Then copy the database
> directory back after a clean shutdown.
>
> If you don't need the contents of the queues then the recovery process
> can be avoided by discarding the database directory.
>
>
>
> -Emile
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: top.png
Type: image/png
Size: 20073 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121009/f3c09bd5/attachment.png>

From matthias at rabbitmq.com  Tue Oct  9 12:23:36 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 09 Oct 2012 12:23:36 +0100
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <CANC53sFhQHvqpRdqqPjnsBS2tDDo=+1pY+kH4BpUQHsXVXsfFw@mail.gmail.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
	<5073F693.9050809@rabbitmq.com>
	<CANC53sFhQHvqpRdqqPjnsBS2tDDo=+1pY+kH4BpUQHsXVXsfFw@mail.gmail.com>
Message-ID: <50740938.7020309@rabbitmq.com>

On 09/10/12 11:51, Geocast wrote:
> I have added the swap to 32G, and restarted the broker
>
> it's still in process

Please let us know whether that worked, and a rough idea of how much 
memory it needed.

Matthias.

From info at geocast.net  Tue Oct  9 12:48:51 2012
From: info at geocast.net (Geocast)
Date: Tue, 9 Oct 2012 19:48:51 +0800
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <50740938.7020309@rabbitmq.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
	<5073F693.9050809@rabbitmq.com>
	<CANC53sFhQHvqpRdqqPjnsBS2tDDo=+1pY+kH4BpUQHsXVXsfFw@mail.gmail.com>
	<50740938.7020309@rabbitmq.com>
Message-ID: <CANC53sFqMe9DvuVbPRa8ERc9nCBjSbDGmPk4cpYWs6HhZrPg2Q@mail.gmail.com>

Currently the memory use:
pyh at rabbitmq2:~$ free -m
             total       used       free     shared    buffers     cached
Mem:          8004       7951         52          0          1         11
-/+ buffers/cache:       7938         65
Swap:        35812      31715       4096

The size of queues:

pyh at rabbitmq2:/data/rabbitmq/server/db/testmq-slave$ du -h .
736M	./queues/A5A29UQ5I7EMQFZFI8I7QNGZY
677M	./queues/7ITLKQ8F63PVVN8GUAPWS4152
359M	./queues/8W2IBTOABRYWVGC3IQM6WG9Z3
966M	./queues/EGCZR6H1JUA1NDZ6NOBCXIN9Y
1.1G	./queues/A6IFRZMWMUSGJ50ZG2V2N6ORZ
962M	./queues/6JGALLR6VOJVXWPWPPG2TDLXL
1.1M	./queues/4ILKGJ2S87IEDT0JQ4AUM04XU
67M	./queues/AYN8KGZ9G6OYJ7XKJYNMFCGNV
1.1G	./queues/4F8M7PYY08B7HZB2PD9SVIUJ6
346M	./queues/8PPAJNJZKUWQBGPHO9LI45FD3
938M	./queues/AEKXQ145TG2FBUFHHTNBMX2VD
215M	./queues/8M5J2LAMRKP5QAXDFN1N1GDJS
1.1G	./queues/BFJ2UY9VY8Y33JCYZ0OQ62K8Q
450M	./queues/83G424V3FBCJ6UA2RPA1KQ33S
215M	./queues/5TG6T0I85IXL62ZH7GH0OU9JM
883M	./queues/DMQY72Q00Q2N3V8551BYVOSY3
655M	./queues/61PRRPH54E4209RIDJ0O8A5GQ
11G	./queues
17G	./msg_store_persistent
4.0K	./msg_store_transient
28G	.

Thanks.

2012/10/9 Matthias Radestock <matthias at rabbitmq.com>:
> On 09/10/12 11:51, Geocast wrote:
>>
>> I have added the swap to 32G, and restarted the broker
>>
>> it's still in process
>
>
> Please let us know whether that worked, and a rough idea of how much memory
> it needed.
>
> Matthias.

From info at geocast.net  Tue Oct  9 14:33:30 2012
From: info at geocast.net (Geocast)
Date: Tue, 9 Oct 2012 21:33:30 +0800
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <CANC53sFqMe9DvuVbPRa8ERc9nCBjSbDGmPk4cpYWs6HhZrPg2Q@mail.gmail.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
	<5073F693.9050809@rabbitmq.com>
	<CANC53sFhQHvqpRdqqPjnsBS2tDDo=+1pY+kH4BpUQHsXVXsfFw@mail.gmail.com>
	<50740938.7020309@rabbitmq.com>
	<CANC53sFqMe9DvuVbPRa8ERc9nCBjSbDGmPk4cpYWs6HhZrPg2Q@mail.gmail.com>
Message-ID: <CANC53sF4MFrYeGB+vBAzkS9sOWpEHandgRKgyFc_bnq8UBf-Mg@mail.gmail.com>

The current status: all 32GB swap has been used out. The system dies,
call IDC support to restart the server now.

2012/10/9 Geocast <info at geocast.net>:
> Currently the memory use:
> pyh at rabbitmq2:~$ free -m
>              total       used       free     shared    buffers     cached
> Mem:          8004       7951         52          0          1         11
> -/+ buffers/cache:       7938         65
> Swap:        35812      31715       4096
>
> The size of queues:
>
> pyh at rabbitmq2:/data/rabbitmq/server/db/testmq-slave$ du -h .
> 736M    ./queues/A5A29UQ5I7EMQFZFI8I7QNGZY
> 677M    ./queues/7ITLKQ8F63PVVN8GUAPWS4152
> 359M    ./queues/8W2IBTOABRYWVGC3IQM6WG9Z3
> 966M    ./queues/EGCZR6H1JUA1NDZ6NOBCXIN9Y
> 1.1G    ./queues/A6IFRZMWMUSGJ50ZG2V2N6ORZ
> 962M    ./queues/6JGALLR6VOJVXWPWPPG2TDLXL
> 1.1M    ./queues/4ILKGJ2S87IEDT0JQ4AUM04XU
> 67M     ./queues/AYN8KGZ9G6OYJ7XKJYNMFCGNV
> 1.1G    ./queues/4F8M7PYY08B7HZB2PD9SVIUJ6
> 346M    ./queues/8PPAJNJZKUWQBGPHO9LI45FD3
> 938M    ./queues/AEKXQ145TG2FBUFHHTNBMX2VD
> 215M    ./queues/8M5J2LAMRKP5QAXDFN1N1GDJS
> 1.1G    ./queues/BFJ2UY9VY8Y33JCYZ0OQ62K8Q
> 450M    ./queues/83G424V3FBCJ6UA2RPA1KQ33S
> 215M    ./queues/5TG6T0I85IXL62ZH7GH0OU9JM
> 883M    ./queues/DMQY72Q00Q2N3V8551BYVOSY3
> 655M    ./queues/61PRRPH54E4209RIDJ0O8A5GQ
> 11G     ./queues
> 17G     ./msg_store_persistent
> 4.0K    ./msg_store_transient
> 28G     .
>
> Thanks.
>
> 2012/10/9 Matthias Radestock <matthias at rabbitmq.com>:
>> On 09/10/12 11:51, Geocast wrote:
>>>
>>> I have added the swap to 32G, and restarted the broker
>>>
>>> it's still in process
>>
>>
>> Please let us know whether that worked, and a rough idea of how much memory
>> it needed.
>>
>> Matthias.

From scripthawk at gmail.com  Tue Oct  9 14:57:06 2012
From: scripthawk at gmail.com (script hawk)
Date: Tue, 9 Oct 2012 06:57:06 -0700 (PDT)
Subject: [rabbitmq-discuss] node-amqp rabbitmq channel
Message-ID: <73fab593-8294-48b9-863e-84cb56ba0385@googlegroups.com>

node-amqp https://github.com/postwait/node-amqp doesn't seem to support 
rabbitmq channel. 
I couldn't find a connection.CreateChannel method. What I like to do is to 
use a channel for each application that uses rabbitmq. 
Any idea? Appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121009/0daf7549/attachment.htm>

From simon at rabbitmq.com  Tue Oct  9 15:53:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 09 Oct 2012 15:53:08 +0100
Subject: [rabbitmq-discuss] Failure to return from call to
	newConnection()
In-Reply-To: <242E9559AA2C354CB60C81A952FCBEB501801E@TSEAMB01>
References: <242E9559AA2C354CB60C81A952FCBEB5017F7E@TSEAMB01>,
	<50734402.9000307@rabbitmq.com>
	<242E9559AA2C354CB60C81A952FCBEB501801E@TSEAMB01>
Message-ID: <50743A54.3030906@rabbitmq.com>

I am not quite sure what you are saying. You can only start one service 
*listening* to a given port IP address combination (i.e. you can only 
have one RabbitMQ *server* on a given port on a given interface). But 
I'm not sure if that's what you mean by "listening". Normally we refer 
to the server as "listening" and the client as "connecting".

But definitely more than one client can connect to a server on the same 
IP address / port.

I'm also not sure what you mean by "it goes to my rabbitMQ server 
instance locally, rather than through IP and port". Connections are 
always to an IP address and port.

But "Connection timed out" means that you are trying to connect to a 
host which is not responding at all, even to reject your connection 
attempt - probably because there is a firewall in the way. Honestly, 
that's what's happening.

Cheers, Simon

On 09/10/12 11:19, McMahon, James S (TASC) wrote:
> Thank you for your help, Simon. I did look more closely at the
> situation as you suggested. It seems that I can only start one
> process listening to a specific port at IP address of the rabbitMQ
> server. I can't start the second listening to the same port at the
> same address.
>
> In one command shell, I start my listener on port 5672. It works
> great. I then start up a second command shell, the first still
> running. I tell the second instance of my listener process to listen
> to the same port. It never returns, and I get the connection timed
> out error. If I start my second process without pointing it to a port
> or using an IP address, it works just fine. To the untrained (ie,
> me), this tells me that the second works because it goes to my
> rabbitMQ server instance locally, rather than through IP and port.
>
> So in summary: two listener processes in different command shells on
> the same physical laptop, started from the command line. Trying to
> listen on the same port, to the same rabbitMQ server instance at IP.
> Not being familiar with port configurations and limitations,
> shouldn't I be able to have multiple listener processes listening to
> incoming on the same port? The evidence appears to say "no". Why is
> that?
>
> - Jim
>
> ________________________________________ From: Simon MacMullen
> [simon at rabbitmq.com] Sent: Monday, October 08, 2012 5:22 PM To:
> Discussions about RabbitMQ Cc: McMahon, James S (TASC) Subject: Re:
> [rabbitmq-discuss] Failure to return from call to newConnection()
>
> The stack trace you have posted really does look like a standard case
> of the TCP connection timing out. I suggest you make absolutely sure
> that you really are connecting to the host/port you think you are.
>
> Cheers, Simon
>
> On 08/10/2012 9:02PM, McMahon, James S (TASC) wrote:
>> I am experiencing a problem that I have been unable to pin down.
>> When I attempt to use a java class to listen for messages bound to
>> a particular exchange by a particular routing key, I get a
>> "Connection timed out" error. Here is my code:
>>
>>
>> public class ReceiveLogsDirect {
>>
>> private static final String EXCHANGE_NAME = "ABC_SERVER";
>>
>> public static void main(String[] argv) throws Exception {
>>
>> String hostName = "localhost"; int portNumber = 5672;
>>
>> if (argv.length < 1 || argv.length == 2 || argv.length > 3){
>> System.err.println("Usage: ReceiveLogsDirect [session ID] [RabbitMQ
>> server IP, optional] [RabbitMQ server port #, optional]");
>> System.exit(1); } else if (argv.length == 1) { hostName =
>> "localhost"; portNumber = 5672; // default port that rabbitMQ
>> listens to } else if  (argv.length == 3) { hostName = argv[1];
>> portNumber = Integer.parseInt(argv[2]); }
>>
>> ConnectionFactory factory = new ConnectionFactory();
>>
>>
>> factory.setHost(hostName); factory.setPort(portNumber);
>> factory.setUsername("guest"); factory.setPassword("guest");
>> factory.setVirtualHost("/");
>>
>> System.out.println(" [*] HERE 1"); Connection connection =
>> factory.newConnection(); System.out.println(" [*] HERE 2"); Channel
>> channel = connection.createChannel();
>>
>>
>> channel.exchangeDeclare(EXCHANGE_NAME, "direct"); String queueName
>> = channel.queueDeclare().getQueue();
>>
>> channel.queueBind(queueName, EXCHANGE_NAME, argv[0]);
>> System.out.println(" [*] bindingKey " + argv[0]  +  " is bound to
>> queue on exchange " + EXCHANGE_NAME );
>>
>> System.out.println(" [*] Waiting for messages. To exit press
>> CTRL+C");
>>
>> QueueingConsumer consumer = new QueueingConsumer(channel);
>> channel.basicConsume(queueName, true, consumer);
>>
>> while (true) { QueueingConsumer.Delivery delivery =
>> consumer.nextDelivery(); String message = new
>> String(delivery.getBody()); String routingKey =
>> delivery.getEnvelope().getRoutingKey();
>>
>> System.out.println(" [x] Received message for " + routingKey + "
>>>>> " + message);
>> } }
>>
>> I used simple print statements to pinpoint the source of the
>> problem at the line where I call newConnection().
>>
>> The error I get is this:
>>
>> [*] HERE 1 Exception in thread "main" java.net.ConnectException:
>> Connection timed out: connect at
>> java.net.PlainSocketImpl.socketConnect(Native Method) at
>> java.net.PlainSocketImpl.doConnect(Unknown Source) at
>> java.net.PlainSocketImpl.connectToAddress(Unknown Source) at
>> java.net.PlainSocketImpl.connect(Unknown Source) at
>> java.net.SocksSocketImpl.connect(Unknown Source) at
>> java.net.Socket.connect(Unknown Source) at
>> com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:441)
>>
>>
at
>> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:480)
>>
>>
at
>> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:509)
>>
>>
at
>> com.tasc.prism.queue.ReceiveLogsDirect.main(ReceiveLogsDirect.java:55)
>>
>>
>>
My install of rabbitMQ is 2.7.0. Oddly, I have been able to
>> execute this in another command shell window and it works. I am
>> wondering why I'm having trouble in the second shell? Surely I must
>> be able to execute multiple instances of ReceiveLogsDirect
>> simultaneously, right?
>>
>> Could it be a runtime environment problem? I set my class path
>> exactly the same in both shells.
>>
>> Any thoughts or similar experience with such a problem? Thank you.
>>
>> - Jim
>>
>>
>> CONFIDENTIALITY NOTICE: This message and any attachments or files
>> transmitted with it (collectively, the "Message") are intended only
>> for the addressee and may contain information that is privileged,
>> proprietary and/or prohibited from disclosure by law or contract.
>> If you are not the intended recipient: (a) please do not read, copy
>> or retransmit the Message; (b) permanently delete and/or destroy
>> all electronic and hard copies of the Message; (c) notify us by
>> return email; and (d) you are hereby notified that any
>> dissemination, distribution or copying of the Message is strictly
>> prohibited.
>>
>>
>>
>> _______________________________________________ rabbitmq-discuss
>> mailing list rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>>
CONFIDENTIALITY NOTICE: This message and any attachments or files 
transmitted with it (collectively, the "Message") are intended only for 
the addressee and may contain information that is privileged, 
proprietary and/or prohibited from disclosure by law or contract. If you 
are not the intended recipient: (a) please do not read, copy or 
retransmit the Message; (b) permanently delete and/or destroy all 
electronic and hard copies of the Message; (c) notify us by return 
email; and (d) you are hereby notified that any dissemination, 
distribution or copying of the Message is strictly prohibited.
>


-- 
Simon MacMullen
RabbitMQ, VMware

From abrightwell at LCE.com  Tue Oct  9 17:07:06 2012
From: abrightwell at LCE.com (Adam Brightwell)
Date: Tue, 9 Oct 2012 16:07:06 +0000
Subject: [rabbitmq-discuss] Re-subscribing to a queue in a cluster
In-Reply-To: <5072B7B9.5080302@rabbitmq.com>
Message-ID: <BD46CD450E3D7843BCE36FF301A8BC4C2AA33C57@LCEEXMB02.LCE.com>

Hey Emile,

Thanks for the response.

So, I think I found my issue.  Or at least it resolved my issue.

It would appear that in order to "re-subscribe" I had to handle this
action in a separate thread.  If I use the following "test" code in my
consumer's "handleCancel()" method it would not work:

public void handleCancel(String consumerTag) {
    Channel channel = super.getChannel();
    TestConsumer consumer = new TestConsumer();
    channel.basicConsume(this.queue, consumer);
}

However, if I put the "basicConsume" off on its own thread, like the
following, I have success:

public void handleCancel(String consumerTag) {
    Channel channel = super.getChannel();
    TestConsumer consumer = new TestConsumer();

    Thread t = new Thread() {
        public void run() {
            try {
                channel.basicConsume(queue, consumer);
            } catch (IOException exception) {
                exception.printStackTrace();
            }
        }
    };
}

Digging further into the threading/concurrency model of RabbitMQ, I found
that I obviously have to be careful about concurrently executing
operations on a single channel.  And I also found that the connection
operations are apparently thread-safe except the ones that involve RPC
calls.  I understand that the "basicConsume" just so happens to be an RPC
based command.

So, with the above in mind, what I can only assume is happening is that
the RPC call involved with the basicConsume is blocking other Channel
based operations.  This is why I suspect that the "basicAck" was unable to
execute successfully and that the "handleDelivery" was never being reached.

I hope this makes sense, but to sum it up it seems that I simply had a
threading problem.  I'm in the process of updating our consumer and
application to handle this properly, but I was curious if there are any
established patterns or guidelines the community might suggest?  For
instance, having a thread pool dedicated for such operations, utilizing
java's ExecutorService or is there something already built in to the
client api that will provide me a way to run this code if I wrapped it in
a Runnable, Callable, etc.?

Also, as a side note, has any consideration been given to using java's
concurrency model more widely in the java client api?  For instance,
synchronization of methods or code blocks to possibly help avoid such
situations?

As for my version, I am currently locked in to 2.8.1.  Unfortunately, I
cannot upgrade yet.  However, I have validated this same behavior in 2.8.7.

Thanks again for all your help, it is greatly appreciated.

Thanks,
Adam



On 10/8/12 7:23 AM, "Emile Joubert" <emile at rabbitmq.com> wrote:

>
>Hi Adam,
>
>On 05/10/12 00:13, Adam Brightwell wrote:
>> 1. Create new consumer and call basicConsume on the original channel.
>> 2. Close original channel, recreate channel and call basicConsume with
>>the
>> new channel.
>> 3. Close the original channel, close the original Connection.
>>Reconnect,
>> recreate channel, call basicConsume with the new channel.
>
>All three options should work, but it is not necessary to re-establish a
>new consumer, channel or connection unless directly connected to the
>failing node and therefore all options do more work than necessary. The
>only required action is to resubscribe the existing consumer (and that
>consumer must be prepared to receive duplicate messages).
>
>> OR they will be consumed and unacknowledged. In the latter case, they
>> are not being processed by my consumer or at least not making it to
>> the "handleDelivery()" method.
>
>So messages are consumed without acknowledgement, but don't make it to
>the handleDelivery method? Can you explain what you mean by that?
>
>Also, what version of RabbitMQ are you using? You are advised to use the
>latest version.
>
>
>-Emile
>
>


From james.mcmahon at TASC.COM  Tue Oct  9 17:11:41 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Tue, 9 Oct 2012 16:11:41 +0000
Subject: [rabbitmq-discuss] Failure to return from call to
 newConnection()
In-Reply-To: <50743A54.3030906@rabbitmq.com>
References: <242E9559AA2C354CB60C81A952FCBEB5017F7E@TSEAMB01>,
	<50734402.9000307@rabbitmq.com>
	<242E9559AA2C354CB60C81A952FCBEB501801E@TSEAMB01>,
	<50743A54.3030906@rabbitmq.com>
Message-ID: <242E9559AA2C354CB60C81A952FCBEB5018098@TSEAMB01>

       Let me try again, more carefully applying terminology.

      I've got a java class to receive messages through a direct exchange. In my class, I establish a new ConnectionFactory, factory. I use factory.setHost, under the impression that this is how I would tell it where to find my rabbitMQ server. For discussion purposes, let's say my rabbitMQ server runs on 123.456.666.6. I use factory.setPort, under the impression that this is how I indicate on which port my rabbitMQ server is listening. I've been using 5672, which I believe is the default used by rabbitMQ server.


     All of the following is executed on the same physical machine, co-resident with the rabbitMQ server.


     I execute my java class a first time in a command shell like this:

java -cp %CP% myClass EXCHANGE_A   123.456.666.6   5672

In that shell window, the class returns with a message that it is waiting for any messages posted to rabbitMQ for EXCHANGE_A.


     In a second shell window I try to execute a second instance of this class, for a second and different directed exchange:

java -cp %CP% myClass EXCHANGE_B   123.456.666.6   5672

This is not successful. When myClass reaches the point where it tries to do this

Connection connection = factory.newConnection();

it sits there until it eventually times out.


     If in that second shell window I execute the command as follows, without stipulating the IP or port

java -cp %CP% myClass EXCHANGE_B

it returns immediately, telling me that it is waiting for any messages posted to rabbitMQ for EXCHANGE_B. It was successful executing newConnection.


    There's no firewall. All of these are on one physical computer for testing purposes. What am I not understanding correctly that causes this

java -cp %CP% myClass EXCHANGE_B   123.456.666.6   5672

to time out?

________________________________________
From: Simon MacMullen [simon at rabbitmq.com]
Sent: Tuesday, October 09, 2012 10:53 AM
To: McMahon, James S (TASC)
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Failure to return from call to newConnection()

I am not quite sure what you are saying. You can only start one service
*listening* to a given port IP address combination (i.e. you can only
have one RabbitMQ *server* on a given port on a given interface). But
I'm not sure if that's what you mean by "listening". Normally we refer
to the server as "listening" and the client as "connecting".

But definitely more than one client can connect to a server on the same
IP address / port.

I'm also not sure what you mean by "it goes to my rabbitMQ server
instance locally, rather than through IP and port". Connections are
always to an IP address and port.

But "Connection timed out" means that you are trying to connect to a
host which is not responding at all, even to reject your connection
attempt - probably because there is a firewall in the way. Honestly,
that's what's happening.

Cheers, Simon

On 09/10/12 11:19, McMahon, James S (TASC) wrote:
> Thank you for your help, Simon. I did look more closely at the
> situation as you suggested. It seems that I can only start one
> process listening to a specific port at IP address of the rabbitMQ
> server. I can't start the second listening to the same port at the
> same address.
>
> In one command shell, I start my listener on port 5672. It works
> great. I then start up a second command shell, the first still
> running. I tell the second instance of my listener process to listen
> to the same port. It never returns, and I get the connection timed
> out error. If I start my second process without pointing it to a port
> or using an IP address, it works just fine. To the untrained (ie,
> me), this tells me that the second works because it goes to my
> rabbitMQ server instance locally, rather than through IP and port.
>
> So in summary: two listener processes in different command shells on
> the same physical laptop, started from the command line. Trying to
> listen on the same port, to the same rabbitMQ server instance at IP.
> Not being familiar with port configurations and limitations,
> shouldn't I be able to have multiple listener processes listening to
> incoming on the same port? The evidence appears to say "no". Why is
> that?
>
> - Jim
>
> ________________________________________ From: Simon MacMullen
> [simon at rabbitmq.com] Sent: Monday, October 08, 2012 5:22 PM To:
> Discussions about RabbitMQ Cc: McMahon, James S (TASC) Subject: Re:
> [rabbitmq-discuss] Failure to return from call to newConnection()
>
> The stack trace you have posted really does look like a standard case
> of the TCP connection timing out. I suggest you make absolutely sure
> that you really are connecting to the host/port you think you are.
>
> Cheers, Simon
>
> On 08/10/2012 9:02PM, McMahon, James S (TASC) wrote:
>> I am experiencing a problem that I have been unable to pin down.
>> When I attempt to use a java class to listen for messages bound to
>> a particular exchange by a particular routing key, I get a
>> "Connection timed out" error. Here is my code:
>>
>>
>> public class ReceiveLogsDirect {
>>
>> private static final String EXCHANGE_NAME = "ABC_SERVER";
>>
>> public static void main(String[] argv) throws Exception {
>>
>> String hostName = "localhost"; int portNumber = 5672;
>>
>> if (argv.length < 1 || argv.length == 2 || argv.length > 3){
>> System.err.println("Usage: ReceiveLogsDirect [session ID] [RabbitMQ
>> server IP, optional] [RabbitMQ server port #, optional]");
>> System.exit(1); } else if (argv.length == 1) { hostName =
>> "localhost"; portNumber = 5672; // default port that rabbitMQ
>> listens to } else if  (argv.length == 3) { hostName = argv[1];
>> portNumber = Integer.parseInt(argv[2]); }
>>
>> ConnectionFactory factory = new ConnectionFactory();
>>
>>
>> factory.setHost(hostName); factory.setPort(portNumber);
>> factory.setUsername("guest"); factory.setPassword("guest");
>> factory.setVirtualHost("/");
>>
>> System.out.println(" [*] HERE 1"); Connection connection =
>> factory.newConnection(); System.out.println(" [*] HERE 2"); Channel
>> channel = connection.createChannel();
>>
>>
>> channel.exchangeDeclare(EXCHANGE_NAME, "direct"); String queueName
>> = channel.queueDeclare().getQueue();
>>
>> channel.queueBind(queueName, EXCHANGE_NAME, argv[0]);
>> System.out.println(" [*] bindingKey " + argv[0]  +  " is bound to
>> queue on exchange " + EXCHANGE_NAME );
>>
>> System.out.println(" [*] Waiting for messages. To exit press
>> CTRL+C");
>>
>> QueueingConsumer consumer = new QueueingConsumer(channel);
>> channel.basicConsume(queueName, true, consumer);
>>
>> while (true) { QueueingConsumer.Delivery delivery =
>> consumer.nextDelivery(); String message = new
>> String(delivery.getBody()); String routingKey =
>> delivery.getEnvelope().getRoutingKey();
>>
>> System.out.println(" [x] Received message for " + routingKey + "
>>>>> " + message);
>> } }
>>
>> I used simple print statements to pinpoint the source of the
>> problem at the line where I call newConnection().
>>
>> The error I get is this:
>>
>> [*] HERE 1 Exception in thread "main" java.net.ConnectException:
>> Connection timed out: connect at
>> java.net.PlainSocketImpl.socketConnect(Native Method) at
>> java.net.PlainSocketImpl.doConnect(Unknown Source) at
>> java.net.PlainSocketImpl.connectToAddress(Unknown Source) at
>> java.net.PlainSocketImpl.connect(Unknown Source) at
>> java.net.SocksSocketImpl.connect(Unknown Source) at
>> java.net.Socket.connect(Unknown Source) at
>> com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:441)
>>
>>
at
>> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:480)
>>
>>
at
>> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:509)
>>
>>
at
>> com.tasc.prism.queue.ReceiveLogsDirect.main(ReceiveLogsDirect.java:55)
>>
>>
>>
My install of rabbitMQ is 2.7.0. Oddly, I have been able to
>> execute this in another command shell window and it works. I am
>> wondering why I'm having trouble in the second shell? Surely I must
>> be able to execute multiple instances of ReceiveLogsDirect
>> simultaneously, right?
>>
>> Could it be a runtime environment problem? I set my class path
>> exactly the same in both shells.
>>
>> Any thoughts or similar experience with such a problem? Thank you.
>>
>> - Jim
>>
>>
>> CONFIDENTIALITY NOTICE: This message and any attachments or files
>> transmitted with it (collectively, the "Message") are intended only
>> for the addressee and may contain information that is privileged,
>> proprietary and/or prohibited from disclosure by law or contract.
>> If you are not the intended recipient: (a) please do not read, copy
>> or retransmit the Message; (b) permanently delete and/or destroy
>> all electronic and hard copies of the Message; (c) notify us by
>> return email; and (d) you are hereby notified that any
>> dissemination, distribution or copying of the Message is strictly
>> prohibited.
>>
>>
>>
>> _______________________________________________ rabbitmq-discuss
>> mailing list rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>>
CONFIDENTIALITY NOTICE: This message and any attachments or files
transmitted with it (collectively, the "Message") are intended only for
the addressee and may contain information that is privileged,
proprietary and/or prohibited from disclosure by law or contract. If you
are not the intended recipient: (a) please do not read, copy or
retransmit the Message; (b) permanently delete and/or destroy all
electronic and hard copies of the Message; (c) notify us by return
email; and (d) you are hereby notified that any dissemination,
distribution or copying of the Message is strictly prohibited.
>


--
Simon MacMullen
RabbitMQ, VMware
CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.

From mpietrek at skytap.com  Tue Oct  9 18:54:42 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 9 Oct 2012 10:54:42 -0700
Subject: [rabbitmq-discuss] Querying broker info like rabbitmqctl does?
Message-ID: <CACLE7ixQSeU72bvWBby6MS2-KOwpsZhdVxEZ=KgFdy0OfjfJPQ@mail.gmail.com>

I've come across a situation that's semi-obvious in retrospect given what I
know of RabbitMQ, but nonetheless escaped me till now.

I've written a variety of automation code in Python using the rabbitmq
management API. Things like purging queues, dumping queue contents to
files, simulating broker failover, etc...

Today I created a situation where I knew that there was an unacknowledged
message in a queue, and I could observe that was the case via the Web UI.
However, my code was getting a value of '0' for the messages_unacknowledged
column from /api/queues.

I eventually figured out that my HTTP call occurred before the default five
second statistics database update. Thus, if I waited a few seconds before
issuing the call, I got back the expected value of '1'.

Now, some of my automation depends on the values I get from the HTTP API to
be correct "now", rather than behind by some non-trivial interval.

Now, I realize that this is an inherently racy circumstance. I'm just
trying to reduce the window as much as possible. As I see it, I have three
options:

   - Crank up the default update interval, suppressing perf as I go to
   smaller intervals
   - Somehow query the broker in the same way that rabbitmqctl does. I
   assume this involves writing Erlang code, which I'd like to avoid for time
   reasons.
   - Call rabbitmqctl and capture/parse the output.

Again, I realize that any solution is inherently only a snapshot in time -
Thoughts on how to best achieve the most recently correct values, ideally
in Python and without learning Erlang? :-)

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121009/1e5f2501/attachment.htm>

From matthias at rabbitmq.com  Tue Oct  9 18:56:55 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 09 Oct 2012 18:56:55 +0100
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <CANC53sF4MFrYeGB+vBAzkS9sOWpEHandgRKgyFc_bnq8UBf-Mg@mail.gmail.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
	<5073F693.9050809@rabbitmq.com>
	<CANC53sFhQHvqpRdqqPjnsBS2tDDo=+1pY+kH4BpUQHsXVXsfFw@mail.gmail.com>
	<50740938.7020309@rabbitmq.com>
	<CANC53sFqMe9DvuVbPRa8ERc9nCBjSbDGmPk4cpYWs6HhZrPg2Q@mail.gmail.com>
	<CANC53sF4MFrYeGB+vBAzkS9sOWpEHandgRKgyFc_bnq8UBf-Mg@mail.gmail.com>
Message-ID: <50746567.4030103@rabbitmq.com>

On 09/10/12 14:33, Geocast wrote:
> The current status: all 32GB swap has been used out. The system dies,
> call IDC support to restart the server now.

It will probably need a lot more than 32GB to recover. I suggest you 
provide it with as much swap as you can.

I've managed to reproduce this "need lots of memory when recovering from 
unclean shutdown" behaviour. We will fix that in a future release.

Regards,

Matthias.

From matthias at rabbitmq.com  Tue Oct  9 19:30:00 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 09 Oct 2012 19:30:00 +0100
Subject: [rabbitmq-discuss] Rabbit won't restart - no next heap size
	found
In-Reply-To: <5066A629.3010702@rabbitmq.com>
References: <8140e6d9-86a6-46a6-a5ef-e53d6dd7d2e4@googlegroups.com>
	<5061F578.6080300@rabbitmq.com>
	<CAJ0FASqDONKd-UL-EbitRqA6h3zaeqxAG9LZFKmoQTsFyck0=A@mail.gmail.com>
	<50620619.8050108@rabbitmq.com>
	<CAJ0FASogr824Uw37GnpMKG4_su60wC1uXnxVTfWd+CdkAQySwA@mail.gmail.com>
	<50622B0D.7050709@rabbitmq.com>
	<CAJ0FASqb90V8juMj06ZWyj47-H5KCUXUc+9Jr=-Cr+VLfxSg9g@mail.gmail.com>
	<5066A629.3010702@rabbitmq.com>
Message-ID: <50746D28.9010203@rabbitmq.com>

Mike,

did you make any progress on this?

We have since discovered that rabbit can use lot of memory on recovery 
from an unclean shutdown, so this may well be the problem you are 
running into. We'll fix that in an upcoming release, but meanwhile the 
suggestions below should get you going.

Matthias.
On 29/09/12 08:41, Matthias Radestock wrote:
> Mike,
>
> On 28/09/12 22:06, Mike Khristo wrote:
>> Added a 200G swap... it used some of it, but still seg faults at
>> startup.
>
> Did it fail with the same error, i.e. "eheap_alloc: Cannot allocate ....
> bytes of memory"? That would be kinda surprising.
>
> Is there anything in the log files?
>
> There are scenarios in which an error can trigger the writing of an
> enormous log message, and it's the latter that is exhausting memory. If
> so, the log should contain the error.
>
>> Is there any way to split up the data on disk so I can get 2 rabbits
>> up with half the data each?
>
> Hmm. The following should work:
>
> 1) make a backup of the rabbit database dir
>
> 2) cd into the database dir and remove the "clean shutdown" markers with
>     rm -f `find . -name "clean.dot"`
> If rabbit was shut down cleanly there should be one of these per queue
> plus one each in the msg_store_persistent and msg_store_transient dirs.
> If rabbit wasn't shut down cleanly and those files aren't present then
> not to worry.
>
> 3) in the msg_store_persistent dir remove half the *.rdq files
>
> 4) start rabbit
>
> Then process all the messages in that rabbit, stop it, restore the
> backup and repeat the above but this time removing the other half of the
> *.rdq files.
>
>
> Regards,
>
> Matthias.


From mikekhristo at gmail.com  Tue Oct  9 20:09:26 2012
From: mikekhristo at gmail.com (Mike Khristo)
Date: Tue, 9 Oct 2012 12:09:26 -0700
Subject: [rabbitmq-discuss] Rabbit won't restart - no next heap size
	found
In-Reply-To: <50746D28.9010203@rabbitmq.com>
References: <8140e6d9-86a6-46a6-a5ef-e53d6dd7d2e4@googlegroups.com>
	<5061F578.6080300@rabbitmq.com>
	<CAJ0FASqDONKd-UL-EbitRqA6h3zaeqxAG9LZFKmoQTsFyck0=A@mail.gmail.com>
	<50620619.8050108@rabbitmq.com>
	<CAJ0FASogr824Uw37GnpMKG4_su60wC1uXnxVTfWd+CdkAQySwA@mail.gmail.com>
	<50622B0D.7050709@rabbitmq.com>
	<CAJ0FASqb90V8juMj06ZWyj47-H5KCUXUc+9Jr=-Cr+VLfxSg9g@mail.gmail.com>
	<5066A629.3010702@rabbitmq.com> <50746D28.9010203@rabbitmq.com>
Message-ID: <CAJ0FASpJ2-fBRZEg0MsHXvDWpkVZ+YZXiQ4Z0gD0xb3_6CiDYw@mail.gmail.com>

Got it going but it was just sheer luck... the 25th attempt to start it got
it working, somehow. Even with 200G swap, it didn't help.


On Tue, Oct 9, 2012 at 11:30 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Mike,
>
> did you make any progress on this?
>
> We have since discovered that rabbit can use lot of memory on recovery
> from an unclean shutdown, so this may well be the problem you are running
> into. We'll fix that in an upcoming release, but meanwhile the suggestions
> below should get you going.
>
> Matthias.
>
> On 29/09/12 08:41, Matthias Radestock wrote:
>
>> Mike,
>>
>> On 28/09/12 22:06, Mike Khristo wrote:
>>
>>> Added a 200G swap... it used some of it, but still seg faults at
>>> startup.
>>>
>>
>> Did it fail with the same error, i.e. "eheap_alloc: Cannot allocate ....
>> bytes of memory"? That would be kinda surprising.
>>
>> Is there anything in the log files?
>>
>> There are scenarios in which an error can trigger the writing of an
>> enormous log message, and it's the latter that is exhausting memory. If
>> so, the log should contain the error.
>>
>>  Is there any way to split up the data on disk so I can get 2 rabbits
>>> up with half the data each?
>>>
>>
>> Hmm. The following should work:
>>
>> 1) make a backup of the rabbit database dir
>>
>> 2) cd into the database dir and remove the "clean shutdown" markers with
>>     rm -f `find . -name "clean.dot"`
>> If rabbit was shut down cleanly there should be one of these per queue
>> plus one each in the msg_store_persistent and msg_store_transient dirs.
>> If rabbit wasn't shut down cleanly and those files aren't present then
>> not to worry.
>>
>> 3) in the msg_store_persistent dir remove half the *.rdq files
>>
>> 4) start rabbit
>>
>> Then process all the messages in that rabbit, stop it, restore the
>> backup and repeat the above but this time removing the other half of the
>> *.rdq files.
>>
>>
>> Regards,
>>
>> Matthias.
>>
>
>


-- 
-mk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121009/9fd937e5/attachment.htm>

From prabodh.upreti at vce.com  Tue Oct  9 20:40:03 2012
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Tue, 9 Oct 2012 12:40:03 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit CAS(Central Authentication Service)
	integration
Message-ID: <1349811603124-22452.post@n5.nabble.com>

Hello

Any guidance on rabbitmq authentication/authorization via CAS.  We would
like to remove the user login/pw from rabbitmq and manage it via CAS. I
would appreciate any feeback. Thank you.

regards

prabodh



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbit-CAS-Central-Authentication-Service-integration-tp22452.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From swang at nopsec.com  Tue Oct  9 21:36:13 2012
From: swang at nopsec.com (Shang Wang)
Date: Wed, 10 Oct 2012 04:36:13 +0800
Subject: [rabbitmq-discuss] Problem installing rabbitmq-server on ubuntu
Message-ID: <CAEJ9-NnO-T5ywt40QGveqj1L9SdQimQdprz=279SLj=992HbFQ@mail.gmail.com>

Dear all:

I have never met this issue before, and I searched but no result was found
so far.

I tried to install rabbitmq-server on ubuntu 11.04, but I got following
error:

    Starting rabbitmq-server: TIMEOUT - check
/var/log/rabbitmq/startup_{log,err}
    rabbitmq-server.
    invoke-rc.d: initscript rabbitmq-server, action "start" failed.
    dpkg: error processing rabbitmq-server (--configure):
     subprocess installed post-installation script returned error exit
status 1
    No apport report written because MaxReports is reached already
    Errors were encountered while processing:
     rabbitmq-server
    E: Sub-process /usr/bin/dpkg returned an error code (1)

I looked into the file /var/log/rabbitmq/startup_log:

    {error_logger,{{2012,10,9},{20,20,34}},"Protocol: ~p: register error:
~p~n",["inet_tcp",{{badmatch,{error,etimedout}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}

{error_logger,{{2012,10,9},{20,20,34}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.107>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,510}],[]]}

{error_logger,{{2012,10,9},{20,20,34}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbitmq_multi7006,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}

{error_logger,{{2012,10,9},{20,20,34}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}

{error_logger,{{2012,10,9},{20,20,34}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
    {"Kernel pid
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

in the file /var/log/rabbitmq/startup_err:

    Kernel pid terminated (application_controller)
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})

I honestly do not have much knowledge about using rabbitmq, and I did many
installations before and were all working fine. I looked up a little and
found this<http://www.mentby.com/Group/rabbitmq-discuss/having-trouble-installing-on-ubuntu.html>
and
this<http://serverfault.com/questions/225795/error-when-installing-rabbitmq-server-on-ubuntu-10-10>,
and they addressed that it might be the DNS that caused the problem. I
looked into /etc/hosts and shows like this:
127.0.0.1     localhost localhost.localdomain
184.106.149.253     NopSec

So what seems to be the problem? Non of the results that I found seem to
provide useful information, please help, thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/be6a0d9f/attachment.htm>

From info at geocast.net  Wed Oct 10 03:24:09 2012
From: info at geocast.net (Geocast)
Date: Wed, 10 Oct 2012 10:24:09 +0800
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <50746567.4030103@rabbitmq.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
	<5073F693.9050809@rabbitmq.com>
	<CANC53sFhQHvqpRdqqPjnsBS2tDDo=+1pY+kH4BpUQHsXVXsfFw@mail.gmail.com>
	<50740938.7020309@rabbitmq.com>
	<CANC53sFqMe9DvuVbPRa8ERc9nCBjSbDGmPk4cpYWs6HhZrPg2Q@mail.gmail.com>
	<CANC53sF4MFrYeGB+vBAzkS9sOWpEHandgRKgyFc_bnq8UBf-Mg@mail.gmail.com>
	<50746567.4030103@rabbitmq.com>
Message-ID: <CANC53sFUdqo965ciEw4O-+E3ELR=smSbotOunQNZdXVxjwQB5A@mail.gmail.com>

I added the swap to 128GB, try to recover it now.


2012/10/10 Matthias Radestock <matthias at rabbitmq.com>:
> On 09/10/12 14:33, Geocast wrote:
>>
>> The current status: all 32GB swap has been used out. The system dies,
>> call IDC support to restart the server now.
>
>
> It will probably need a lot more than 32GB to recover. I suggest you provide
> it with as much swap as you can.
>
> I've managed to reproduce this "need lots of memory when recovering from
> unclean shutdown" behaviour. We will fix that in a future release.
>
> Regards,
>
> Matthias.

From info at geocast.net  Wed Oct 10 09:02:56 2012
From: info at geocast.net (Geocast)
Date: Wed, 10 Oct 2012 16:02:56 +0800
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <CANC53sFUdqo965ciEw4O-+E3ELR=smSbotOunQNZdXVxjwQB5A@mail.gmail.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
	<5073F693.9050809@rabbitmq.com>
	<CANC53sFhQHvqpRdqqPjnsBS2tDDo=+1pY+kH4BpUQHsXVXsfFw@mail.gmail.com>
	<50740938.7020309@rabbitmq.com>
	<CANC53sFqMe9DvuVbPRa8ERc9nCBjSbDGmPk4cpYWs6HhZrPg2Q@mail.gmail.com>
	<CANC53sF4MFrYeGB+vBAzkS9sOWpEHandgRKgyFc_bnq8UBf-Mg@mail.gmail.com>
	<50746567.4030103@rabbitmq.com>
	<CANC53sFUdqo965ciEw4O-+E3ELR=smSbotOunQNZdXVxjwQB5A@mail.gmail.com>
Message-ID: <CANC53sGrfdRCQGdzzZvBq3yWumN5EOKUciOFCk3o32Wvoqai1w@mail.gmail.com>

128GB swap is crashed also, :(
root at rabbitmq2:/var/log/rabbitmq# cat startup_err

Crash dump was written to: erl_crash.dump
eheap_alloc: Cannot allocate 16992218280 bytes of memory (of type "heap").
Aborted


2012/10/10 Geocast <info at geocast.net>:
> I added the swap to 128GB, try to recover it now.
>
>
> 2012/10/10 Matthias Radestock <matthias at rabbitmq.com>:
>> On 09/10/12 14:33, Geocast wrote:
>>>
>>> The current status: all 32GB swap has been used out. The system dies,
>>> call IDC support to restart the server now.
>>
>>
>> It will probably need a lot more than 32GB to recover. I suggest you provide
>> it with as much swap as you can.
>>
>> I've managed to reproduce this "need lots of memory when recovering from
>> unclean shutdown" behaviour. We will fix that in a future release.
>>
>> Regards,
>>
>> Matthias.

From matthias at rabbitmq.com  Wed Oct 10 09:08:08 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 10 Oct 2012 09:08:08 +0100
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <CANC53sGrfdRCQGdzzZvBq3yWumN5EOKUciOFCk3o32Wvoqai1w@mail.gmail.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
	<5073F693.9050809@rabbitmq.com>
	<CANC53sFhQHvqpRdqqPjnsBS2tDDo=+1pY+kH4BpUQHsXVXsfFw@mail.gmail.com>
	<50740938.7020309@rabbitmq.com>
	<CANC53sFqMe9DvuVbPRa8ERc9nCBjSbDGmPk4cpYWs6HhZrPg2Q@mail.gmail.com>
	<CANC53sF4MFrYeGB+vBAzkS9sOWpEHandgRKgyFc_bnq8UBf-Mg@mail.gmail.com>
	<50746567.4030103@rabbitmq.com>
	<CANC53sFUdqo965ciEw4O-+E3ELR=smSbotOunQNZdXVxjwQB5A@mail.gmail.com>
	<CANC53sGrfdRCQGdzzZvBq3yWumN5EOKUciOFCk3o32Wvoqai1w@mail.gmail.com>
Message-ID: <50752CE8.7030007@rabbitmq.com>

On 10/10/12 09:02, Geocast wrote:
> 128GB swap is crashed also, :(

When I wrote "I suggest you provide it with as much swap as you can." I 
meant it.

Also, keep an eye on how much memory/swap it is using, just in case 
there is something else going here and for some reason rabbit cannot 
allocate memory when it should be able to.

Matthias.

From simon at rabbitmq.com  Wed Oct 10 10:34:37 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Oct 2012 10:34:37 +0100
Subject: [rabbitmq-discuss] Querying broker info like rabbitmqctl does?
In-Reply-To: <CACLE7ixQSeU72bvWBby6MS2-KOwpsZhdVxEZ=KgFdy0OfjfJPQ@mail.gmail.com>
References: <CACLE7ixQSeU72bvWBby6MS2-KOwpsZhdVxEZ=KgFdy0OfjfJPQ@mail.gmail.com>
Message-ID: <5075412D.8020807@rabbitmq.com>

On 09/10/12 18:54, Matt Pietrek wrote:
> Now, I realize that this is an inherently racy circumstance.

As long as you realise that :-)

> I'm just
> trying to reduce the window as much as possible. As I see it, I have
> three options:
>
>   * Crank up the default update interval, suppressing perf as I go to
>     smaller intervals

Sounds less than wonderful as you note.

>   * Somehow query the broker in the same way that rabbitmqctl does. I
>     assume this involves writing Erlang code, which I'd like to avoid
>     for time reasons.

Well it involves interaction with Erlang. You can join an Erlang 
distributed system from Java for example, and there exists code which 
uses this to get rabbitmqctl-like statistics.

I can't say I'd recommend it though - complex and fragile.

>   * Call rabbitmqctl and capture/parse the output.

This is probably easiest of the three. The output is designed to be easy 
to parse, FWIW.

If you were interested in the messages_ready stat I'd suggest you 
passive declare the queue over AMQP - the declare-ok you get back will 
give you that number. But there's no space in the protocol for 
messages_unacknowledged :-(

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Oct 10 10:46:16 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Oct 2012 10:46:16 +0100
Subject: [rabbitmq-discuss] Rabbit CAS(Central Authentication Service)
 integration
In-Reply-To: <1349811603124-22452.post@n5.nabble.com>
References: <1349811603124-22452.post@n5.nabble.com>
Message-ID: <507543E8.7000604@rabbitmq.com>

On 09/10/12 20:40, Prabodh Upreti wrote:
> Any guidance on rabbitmq authentication/authorization via CAS.  We would
> like to remove the user login/pw from rabbitmq and manage it via CAS. I
> would appreciate any feeback. Thank you.

I had not heard of CAS before, but looking at http://www.jasig.org/cas/ 
it seems very HTTP-centric. All of the architecture diagrams and 
examples seem to assume a user visiting a site in a web browser.

I don't know if you can get CAS to back on to an LDAP server, if so you 
could connect RabbitMQ to the same LDAP server. That's about the best I 
can offer you I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Oct 10 11:19:25 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Oct 2012 11:19:25 +0100
Subject: [rabbitmq-discuss] Problem installing rabbitmq-server on ubuntu
In-Reply-To: <CAEJ9-NnO-T5ywt40QGveqj1L9SdQimQdprz=279SLj=992HbFQ@mail.gmail.com>
References: <CAEJ9-NnO-T5ywt40QGveqj1L9SdQimQdprz=279SLj=992HbFQ@mail.gmail.com>
Message-ID: <50754BAD.2020305@rabbitmq.com>

Which version of RabbitMQ are you running?

There are various networking misconfigurations that can cause this sort 
of error message. I had hoped we had made such errors clearer and more 
readable, but if you're running an old version that won't help.

Some things you might check:

1) Is the hostname resolvable?
1a) Does "ping $(hostname -s)" work?

2) Do you have working localhost?
2a) Does "ping localhost" work?

3) Is there something stopping RabbitMQ from seeing epmd?
3a) Does an epmd process get started?
3b) If it does, is something blocking port 4369 on localhost? Can you 
telnet to that port?

Cheers, Simon

On 09/10/12 21:36, Shang Wang wrote:
> Dear all:
>
> I have never met this issue before, and I searched but no result was
> found so far.
>
> I tried to install rabbitmq-server on ubuntu 11.04, but I got following
> error:
>
>      Starting rabbitmq-server: TIMEOUT - check
> /var/log/rabbitmq/startup_{log,err}
>      rabbitmq-server.
>      invoke-rc.d: initscript rabbitmq-server, action "start" failed.
>      dpkg: error processing rabbitmq-server (--configure):
>       subprocess installed post-installation script returned error exit
> status 1
>      No apport report written because MaxReports is reached already
>      Errors were encountered while processing:
>       rabbitmq-server
>      E: Sub-process /usr/bin/dpkg returned an error code (1)
>
> I looked into the file /var/log/rabbitmq/startup_log:
>
>      {error_logger,{{2012,10,9},{20,20,34}},"Protocol: ~p: register
> error:
> ~p~n",["inet_tcp",{{badmatch,{error,etimedout}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>
> {error_logger,{{2012,10,9},{20,20,34}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.21.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.107>,<0.18.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,510}],[]]}
>
> {error_logger,{{2012,10,9},{20,20,34}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfa,{net_kernel,start_link,[[rabbitmq_multi7006,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>
> {error_logger,{{2012,10,9},{20,20,34}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfa,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>
> {error_logger,{{2012,10,9},{20,20,34}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>      {"Kernel pid
> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>
> in the file /var/log/rabbitmq/startup_err:
>
>      Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>
> I honestly do not have much knowledge about using rabbitmq, and I did
> many installations before and were all working fine. I looked up a
> little and found this
> <http://www.mentby.com/Group/rabbitmq-discuss/having-trouble-installing-on-ubuntu.html> and
> this
> <http://serverfault.com/questions/225795/error-when-installing-rabbitmq-server-on-ubuntu-10-10>,
> and they addressed that it might be the DNS that caused the problem. I
> looked into /etc/hosts and shows like this:
> 127.0.0.1     localhost localhost.localdomain
> 184.106.149.253     NopSec
>
> So what seems to be the problem? Non of the results that I found seem to
> provide useful information, please help, thanks.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Oct 10 11:26:18 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 10 Oct 2012 11:26:18 +0100
Subject: [rabbitmq-discuss] Problem installing rabbitmq-server on ubuntu
In-Reply-To: <CAEJ9-NnO-T5ywt40QGveqj1L9SdQimQdprz=279SLj=992HbFQ@mail.gmail.com>
References: <CAEJ9-NnO-T5ywt40QGveqj1L9SdQimQdprz=279SLj=992HbFQ@mail.gmail.com>
Message-ID: <50754D4A.9060203@rabbitmq.com>

Hi,

On 09/10/12 21:36, Shang Wang wrote:

> ["inet_tcp",{{badmatch,{error,etimedout}},
> {reason,{'EXIT',nodistribution}},

You are right to check hostnames and DNS. If you have a firewall
installed temporarily disable it. It may be too strict.

Make sure epmd can run. Does "epmd -names" return anything? You may also
want to stop epmd if it was running ("epmd -kill") and run it in debug
mode in a separate terminal: "epmd -debug". If there are any problem
binding to the default interface then the output should point that out.

If that is working then next try "erl -sname testnode". This should
succeed and present you with a prompt. Enter "node()." at the prompt to
confirm what Erlang thinks the nodename is.

If that all works then the broker should start up.



-Emile



From streetcat at gmail.com  Wed Oct 10 11:22:17 2012
From: streetcat at gmail.com (Raviv Pavel)
Date: Wed, 10 Oct 2012 03:22:17 -0700 (PDT)
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
Message-ID: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>

I have an auto-delete, durable, non mirrored, not exclusive queue, that is 
empty (no messages), idle, and has no consumers
However, it's still not being auto deleted.
Any idea why?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/d184f258/attachment.htm>

From simon at rabbitmq.com  Wed Oct 10 13:06:02 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Oct 2012 13:06:02 +0100
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
In-Reply-To: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
References: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
Message-ID: <507564AA.90002@rabbitmq.com>

Has it *ever* had consumers? auto_delete queues will delete themselves 
when their consumer count drops to 0 from a higher number. Otherwise 
they would delete themselves as soon as they were declared...

Empty / idle is not relevant BTW.

Cheers, Simon

On 10/10/12 11:22, Raviv Pavel wrote:
> I have an auto-delete, durable, non mirrored, not exclusive queue, that
> is empty (no messages), idle, and has no consumers
> However, it's still not being auto deleted.
> Any idea why?
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From videlalvaro at gmail.com  Wed Oct 10 13:37:22 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 10 Oct 2012 14:37:22 +0200
Subject: [rabbitmq-discuss] Washington DC Meetup
Message-ID: <CAMcAHLWW_k-nsHigrAB7gR_1C9rsYYyii4YayjUOHfNhgNvB5A@mail.gmail.com>

Hi,

I'll be in Washington DC next week from the 15th till the 19th and thought
maybe someone on the list would like to meet for some beers and talk about
RabbitMQ, messaging or whatever?

If you are interested let me know.

Cheers,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/3ee18758/attachment.htm>

From raviv at gigya-inc.com  Wed Oct 10 14:06:02 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Wed, 10 Oct 2012 15:06:02 +0200
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
In-Reply-To: <507564AA.90002@rabbitmq.com>
References: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
	<507564AA.90002@rabbitmq.com>
Message-ID: <CACx7p4AyYRa9O7qHtpGrhLNrbYYqpxugXaR5m-WcNfrXSUUTjQ@mail.gmail.com>

Can't remember if they had consumers or not.
Does it also depends on the auto-delete flag of the exchange?

Thanks
*--*Raviv
*
*



On Wed, Oct 10, 2012 at 2:06 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Has it *ever* had consumers? auto_delete queues will delete themselves
> when their consumer count drops to 0 from a higher number. Otherwise they
> would delete themselves as soon as they were declared...
>
> Empty / idle is not relevant BTW.
>
> Cheers, Simon
>
> On 10/10/12 11:22, Raviv Pavel wrote:
>
>> I have an auto-delete, durable, non mirrored, not exclusive queue, that
>> is empty (no messages), idle, and has no consumers
>> However, it's still not being auto deleted.
>> Any idea why?
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/162123ca/attachment.htm>

From simlu at su.se  Wed Oct 10 14:45:40 2012
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Wed, 10 Oct 2012 15:45:40 +0200
Subject: [rabbitmq-discuss] Rabbit CAS(Central Authentication Service)
 integration
In-Reply-To: <507543E8.7000604@rabbitmq.com>
References: <1349811603124-22452.post@n5.nabble.com>
	<507543E8.7000604@rabbitmq.com>
Message-ID: <20121010134540.GV10330@data.it.su.se>

(Sorry, resent from the correct mail. mailinglistadmin, disregard my
previous mail and sorry!)

We want to use Shibboleth instead of the build in HTTP Auth which
provides similar functionality as CAS does.

On Wed, 2012-10-10 at 10:46:16 +0100, Simon MacMullen wrote:
> On 09/10/12 20:40, Prabodh Upreti wrote:
> >Any guidance on rabbitmq authentication/authorization via CAS.  We would
> >like to remove the user login/pw from rabbitmq and manage it via CAS. I
> >would appreciate any feeback. Thank you.
> 
> I had not heard of CAS before, but looking at
> http://www.jasig.org/cas/ it seems very HTTP-centric. All of the
> architecture diagrams and examples seem to assume a user visiting a
> site in a web browser.
> 
> I don't know if you can get CAS to back on to an LDAP server, if so
> you could connect RabbitMQ to the same LDAP server. That's about the
> best I can offer you I'm afraid.

Is there no "off" switch for the HTTP Auth in mochiweb? I'd prefer to
use our own web-auth and have everyone that comes in become admin, aka
adminparty.

We can limit the number of users inside of Shibboleth/CAS.

Thanks,
- Simon

From dseltzer at tveyes.com  Wed Oct 10 14:49:57 2012
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Wed, 10 Oct 2012 09:49:57 -0400
Subject: [rabbitmq-discuss] Repairing a a crashed cluster
Message-ID: <CAHW0W4PRo7V3CqU2ELXz26Y+PYXyPCojBvEdKPYWL7Vfh=umdQ@mail.gmail.com>

Hi everyone,

I have a RabbitMQ cluster with two disk nodes.

Last night something happened to the network and both RabbitMQ servers
crashed.

node1 reports the following:

> BOOT FAILED
> ===========
>
> Timeout contacting cluster nodes: [rabbit at node2].

node2 reports the reciprocal

> BOOT FAILED
> ===========
>
> Timeout contacting cluster nodes: [rabbit at node1].


My instinct, for the sake of uptime, is to say: "okay, forget node2, lets
break the cluster and bring node1 online".

My problem is that according to the docs I need to issue a "rabbitmqctl
force_reset", which I can't do unless the server is running.

I tried starting it using "rabbitmq-server -detached" but the server just
exited after loading plugins.

Does anyone know the right course of action in this scenario?

Many Thanks!

-Dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/364c5858/attachment.htm>

From simon at rabbitmq.com  Wed Oct 10 14:50:47 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Oct 2012 14:50:47 +0100
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
In-Reply-To: <CACx7p4AyYRa9O7qHtpGrhLNrbYYqpxugXaR5m-WcNfrXSUUTjQ@mail.gmail.com>
References: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
	<507564AA.90002@rabbitmq.com>
	<CACx7p4AyYRa9O7qHtpGrhLNrbYYqpxugXaR5m-WcNfrXSUUTjQ@mail.gmail.com>
Message-ID: <50757D37.9010409@rabbitmq.com>

On 10/10/12 14:06, Raviv Pavel wrote:
> Can't remember if they had consumers or not.
> Does it also depends on the auto-delete flag of the exchange?

No, it's the other way round. An auto-delete exchange will delete itself 
once the last queue unbinds.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From raviv at gigya-inc.com  Wed Oct 10 15:38:53 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Wed, 10 Oct 2012 16:38:53 +0200
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
In-Reply-To: <50757D37.9010409@rabbitmq.com>
References: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
	<507564AA.90002@rabbitmq.com>
	<CACx7p4AyYRa9O7qHtpGrhLNrbYYqpxugXaR5m-WcNfrXSUUTjQ@mail.gmail.com>
	<50757D37.9010409@rabbitmq.com>
Message-ID: <CACx7p4Bt0yWYoj1dcrp=Na1XyJ6v9DXvvCUSDwtPbshKYvgqDQ@mail.gmail.com>

So if a queue is empty and there are no active consumers, what prevents if
from being deleted?

Thanks
*--*Raviv
*
*



On Wed, Oct 10, 2012 at 3:50 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 10/10/12 14:06, Raviv Pavel wrote:
>
>> Can't remember if they had consumers or not.
>> Does it also depends on the auto-delete flag of the exchange?
>>
>
> No, it's the other way round. An auto-delete exchange will delete itself
> once the last queue unbinds.
>
> Cheers, Simon
>
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/f52482a1/attachment.htm>

From simon at rabbitmq.com  Wed Oct 10 15:42:02 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Oct 2012 15:42:02 +0100
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
In-Reply-To: <CACx7p4Bt0yWYoj1dcrp=Na1XyJ6v9DXvvCUSDwtPbshKYvgqDQ@mail.gmail.com>
References: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
	<507564AA.90002@rabbitmq.com>
	<CACx7p4AyYRa9O7qHtpGrhLNrbYYqpxugXaR5m-WcNfrXSUUTjQ@mail.gmail.com>
	<50757D37.9010409@rabbitmq.com>
	<CACx7p4Bt0yWYoj1dcrp=Na1XyJ6v9DXvvCUSDwtPbshKYvgqDQ@mail.gmail.com>
Message-ID: <5075893A.4060401@rabbitmq.com>

On 10/10/12 15:38, Raviv Pavel wrote:
> So if a queue is empty and there are no active consumers, what prevents
> if from being deleted?

As I said before, has it *ever* had consumers? If it has never had 
consumers it won't be deleted.

Also, whether it is empty does not matter. It would be deleted just as 
easily if it were not empty.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Oct 10 16:53:19 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Oct 2012 16:53:19 +0100
Subject: [rabbitmq-discuss] Repairing a a crashed cluster
In-Reply-To: <CAHW0W4PRo7V3CqU2ELXz26Y+PYXyPCojBvEdKPYWL7Vfh=umdQ@mail.gmail.com>
References: <CAHW0W4PRo7V3CqU2ELXz26Y+PYXyPCojBvEdKPYWL7Vfh=umdQ@mail.gmail.com>
Message-ID: <507599EF.7040307@rabbitmq.com>

On 10/10/12 14:49, Dave Seltzer wrote:
> My instinct, for the sake of uptime, is to say: "okay, forget node2,
> lets break the cluster and bring node1 online".
>
> My problem is that according to the docs I need to issue a "rabbitmqctl
> force_reset", which I can't do unless the server is running.
>
> I tried starting it using "rabbitmq-server -detached" but the server
> just exited after loading plugins.
>
> Does anyone know the right course of action in this scenario?

Hi. The bad news is that the released versions of RabbitMQ do not handle 
this situation well. The good news is that the next release will do better.

However, in your situation it is possible to break the cluster and bring 
node1 up. But it's a bit fiddly.

First of all, you will need to start node1 with the environment variable 
RABBITMQ_NODE_ONLY set to some value. This will start the Erlang VM 
without attempting to start RabbitMQ or Mnesia. Exactly how you do this 
depends on how you have RabbitMQ installed, but on Unix you would 
typically add that to /etc/rabbitmq/rabbitmq-env.conf. Note that our 
init scripts wait for RabbitMQ to start, so /etc/init.d/rabbitmq-server 
will hang, but the node will start.

Once you have the node running, you can then invoke:

   rabbitmqctl eval 'mnesia:start(),[mnesia:force_load_table(T) || T <- 
rabbit_mnesia:table_names()],mnesia:del_table_copy(schema, rabbit at node2).'

(all as one line), with node2 substituted in. This should respond with:

   {atomic,ok}

Then you can invoke

   rabbitmqctl stop

to stop node1 again. At this point it should have forgotten node2 and be 
able to start again normally.

Note that we don't use "rabbitmqctl force_reset" since that would reset 
node1, and the point is to make it forget node2.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mpietrek at skytap.com  Wed Oct 10 17:01:26 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 10 Oct 2012 09:01:26 -0700
Subject: [rabbitmq-discuss] Querying broker info like rabbitmqctl does?
In-Reply-To: <5075412D.8020807@rabbitmq.com>
References: <CACLE7ixQSeU72bvWBby6MS2-KOwpsZhdVxEZ=KgFdy0OfjfJPQ@mail.gmail.com>
	<5075412D.8020807@rabbitmq.com>
Message-ID: <CACLE7izKZUZNqzMga9WGBPCxPnPXCqL7J8uFfXRcKRkpoQt8oQ@mail.gmail.com>

Thanks for the informative reply, Simon. It's about what I expected, but
didn't want to exclude the possibility that there was some other magic that
I wasn't aware of.

Matt

On Wed, Oct 10, 2012 at 2:34 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 09/10/12 18:54, Matt Pietrek wrote:
>
>> Now, I realize that this is an inherently racy circumstance.
>>
>
> As long as you realise that :-)
>
>  I'm just
>> trying to reduce the window as much as possible. As I see it, I have
>> three options:
>>
>>   * Crank up the default update interval, suppressing perf as I go to
>>     smaller intervals
>>
>
> Sounds less than wonderful as you note.
>
>    * Somehow query the broker in the same way that rabbitmqctl does. I
>>
>>     assume this involves writing Erlang code, which I'd like to avoid
>>     for time reasons.
>>
>
> Well it involves interaction with Erlang. You can join an Erlang
> distributed system from Java for example, and there exists code which uses
> this to get rabbitmqctl-like statistics.
>
> I can't say I'd recommend it though - complex and fragile.
>
>    * Call rabbitmqctl and capture/parse the output.
>>
>
> This is probably easiest of the three. The output is designed to be easy
> to parse, FWIW.
>
> If you were interested in the messages_ready stat I'd suggest you passive
> declare the queue over AMQP - the declare-ok you get back will give you
> that number. But there's no space in the protocol for
> messages_unacknowledged :-(
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/d17953e0/attachment.htm>

From marc.villacorta at gmail.com  Wed Oct 10 15:28:26 2012
From: marc.villacorta at gmail.com (Marc)
Date: Wed, 10 Oct 2012 07:28:26 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ 2.8.7 + LDAP + other_bind
Message-ID: <1dcccbfd-6484-4ee5-8732-19e1768cc77b@googlegroups.com>

Hello all!

For authentication I need to bind to a Microsoft Active Directory.

Let's say my bind user is '*uxxx*' with password '*pxxx*'.
Let's say the user I try to authenticate is '*uyyy*' with password '*pyyy*'.

I use the *other_bind<http://hg.rabbitmq.com/rabbitmq-auth-backend-ldap/file/d76afaf44415/README#l100>
* configuration option in order to bind with user '*uxxx*'.

Like this:

    { rabbit, [{auth_backends, [rabbit_auth_backend_ldap]}]},

    { rabbitmq_auth_backend_ldap, [

        {servers, ["myldapserver"]},

        {other_bind, {"uxxx", "pxxx"}},

        {dn_lookup_base, "DC=my,DC=domain,DC=com"},

        {dn_lookup_attribute, "AccountName"},

        {user_dn_pattern, 
> "CN=${username},OU=users,OU=mycompany,DC=my,DC=domain,DC=com"},

        {log,true}

    ]}


but when I try to login with user '*uyyy*' I get this in my logs: 
 

> =INFO REPORT==== 10-Oct-2012::16:21:04 ===

LDAP backend: connecting to ["myldapserver"]


> =INFO REPORT==== 10-Oct-2012::16:21:04 ===

LDAP backend: bind request = {'BindRequest',3,

                                
>  "CN=uyyy,OU=users,OU=mycompany,DC=my,DC=domain,DC=com",

                                 {simple,<<"pyyy">>}}


> =INFO REPORT==== 10-Oct-2012::16:21:04 ===

LDAP backend: bind reply = {ok,

                            {'LDAPMessage',1,

                             {bindResponse,

                              {'BindResponse',invalidCredentials,[],

                               [56,48,48,57,48,51,48,56,58,32,76,100,97,112,

                                69,114,114,58,32,68,83,73,68,45,48,67,48,57,

                                
> 48,51,65,57,44,32,99,111,109,109,101,110,116,

                                
> 58,32,65,99,99,101,112,116,83,101,99,117,114,

                                
> 105,116,121,67,111,110,116,101,120,116,32,101,

                                
> 114,114,111,114,44,32,100,97,116,97,32,53,50,

                                101,44,32,118,49,100,98,48,0],

                               asn1_NOVALUE,asn1_NOVALUE}},

                             asn1_NOVALUE}}


I understand the bind request is being forged with the wrong user.
Could that be a bug in the LDAP plugin?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/7726fbdc/attachment.htm>

From simon at rabbitmq.com  Wed Oct 10 17:22:59 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Oct 2012 17:22:59 +0100
Subject: [rabbitmq-discuss] RabbitMQ 2.8.7 + LDAP + other_bind
In-Reply-To: <1dcccbfd-6484-4ee5-8732-19e1768cc77b@googlegroups.com>
References: <1dcccbfd-6484-4ee5-8732-19e1768cc77b@googlegroups.com>
Message-ID: <5075A0E3.9070407@rabbitmq.com>

Hi!

The other_bind option is only used for authorisation queries - i.e. the 
queries we make *after* authenticating a user, to determine what rights 
they have.

The user's provided username and password are used to bind to LDAP for 
authentication.

I'm not sure how authentication could work any other way - I guess we 
could try to look up username and password, but I assume any sensible 
LDAP server will not store passwords in plain text anyway.

Cheers, Simon

On 10/10/12 15:28, Marc wrote:
> Hello all!
>
> For authentication I need to bind to a Microsoft Active Directory.
>
> Let's say my bind user is '/uxxx/' with password '/pxxx/'.
> Let's say the user I try to authenticate is '/uyyy/' with password '/pyyy/'.
>
> I use the /other_bind
> <http://hg.rabbitmq.com/rabbitmq-auth-backend-ldap/file/d76afaf44415/README#l100>/
> configuration option in order to bind with user '/uxxx/'.
>
> Like this:
>
>          { rabbit, [{auth_backends, [rabbit_auth_backend_ldap]}]},
>
>          { rabbitmq_auth_backend_ldap, [
>
>              {servers, ["myldapserver"]},
>
>              {other_bind, {"uxxx", "pxxx"}},
>
>              {dn_lookup_base, "DC=my,DC=domain,DC=com"},
>
>              {dn_lookup_attribute, "AccountName"},
>
>              {user_dn_pattern,
>     "CN=${username},OU=users,OU=mycompany,DC=my,DC=domain,DC=com"},
>
>              {log,true}
>
>          ]}
>
>
> but when I try to login with user '/uyyy/' I get this in my logs:
>
>     =INFO REPORT==== 10-Oct-2012::16:21:04 ===
>
>     LDAP backend: connecting to ["myldapserver"]
>
>
>     =INFO REPORT==== 10-Oct-2012::16:21:04 ===
>
>     LDAP backend: bind request = {'BindRequest',3,
>
>
>       "CN=uyyy,OU=users,OU=mycompany,DC=my,DC=domain,DC=com",
>
>                                       {simple,<<"pyyy">>}}
>
>
>     =INFO REPORT==== 10-Oct-2012::16:21:04 ===
>
>     LDAP backend: bind reply = {ok,
>
>                                  {'LDAPMessage',1,
>
>                                   {bindResponse,
>
>                                    {'BindResponse',invalidCredentials,[],
>
>
>       [56,48,48,57,48,51,48,56,58,32,76,100,97,112,
>
>
>     69,114,114,58,32,68,83,73,68,45,48,67,48,57,
>
>
>     48,51,65,57,44,32,99,111,109,109,101,110,116,
>
>
>     58,32,65,99,99,101,112,116,83,101,99,117,114,
>
>
>     105,116,121,67,111,110,116,101,120,116,32,101,
>
>
>     114,114,111,114,44,32,100,97,116,97,32,53,50,
>
>                                      101,44,32,118,49,100,98,48,0],
>
>                                     asn1_NOVALUE,asn1_NOVALUE}},
>
>                                   asn1_NOVALUE}}
>
>
> I understand the bind request is being forged with the wrong user.
> Could that be a bug in the LDAP plugin?
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Oct 10 17:27:22 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 10 Oct 2012 17:27:22 +0100
Subject: [rabbitmq-discuss] Rabbit CAS(Central Authentication Service)
 integration
In-Reply-To: <20121010134540.GV10330@data.it.su.se>
References: <1349811603124-22452.post@n5.nabble.com>
	<507543E8.7000604@rabbitmq.com>
	<20121010134540.GV10330@data.it.su.se>
Message-ID: <5075A1EA.5020507@rabbitmq.com>

On 10/10/12 14:45, Simon Lundstr?m wrote:
> Is there no "off" switch for the HTTP Auth in mochiweb? I'd prefer to
> use our own web-auth and have everyone that comes in become admin, aka
> adminparty.

Ah, right, we're talking about the management plugin? No, there's no way 
to turn off authentication I'm afraid. Well, you could probably use an 
HTTP proxy for that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dseltzer at tveyes.com  Wed Oct 10 19:23:11 2012
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Wed, 10 Oct 2012 14:23:11 -0400
Subject: [rabbitmq-discuss] Repairing a a crashed cluster
In-Reply-To: <507599EF.7040307@rabbitmq.com>
References: <CAHW0W4PRo7V3CqU2ELXz26Y+PYXyPCojBvEdKPYWL7Vfh=umdQ@mail.gmail.com>
	<507599EF.7040307@rabbitmq.com>
Message-ID: <CAHW0W4O1aeqLJ9m4agB-7jqyLG+_yyf4ScTxW6yZe5OpJF_wMg@mail.gmail.com>

Thank you so much for such a thorough response!

I followed your instructions and everything came back up.

Hopefully this helps someone else!

-Dave

On Wed, Oct 10, 2012 at 11:53 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 10/10/12 14:49, Dave Seltzer wrote:
>
>> My instinct, for the sake of uptime, is to say: "okay, forget node2,
>> lets break the cluster and bring node1 online".
>>
>> My problem is that according to the docs I need to issue a "rabbitmqctl
>> force_reset", which I can't do unless the server is running.
>>
>> I tried starting it using "rabbitmq-server -detached" but the server
>> just exited after loading plugins.
>>
>> Does anyone know the right course of action in this scenario?
>>
>
> Hi. The bad news is that the released versions of RabbitMQ do not handle
> this situation well. The good news is that the next release will do better.
>
> However, in your situation it is possible to break the cluster and bring
> node1 up. But it's a bit fiddly.
>
> First of all, you will need to start node1 with the environment variable
> RABBITMQ_NODE_ONLY set to some value. This will start the Erlang VM without
> attempting to start RabbitMQ or Mnesia. Exactly how you do this depends on
> how you have RabbitMQ installed, but on Unix you would typically add that
> to /etc/rabbitmq/rabbitmq-env.**conf. Note that our init scripts wait for
> RabbitMQ to start, so /etc/init.d/rabbitmq-server will hang, but the node
> will start.
>
> Once you have the node running, you can then invoke:
>
>   rabbitmqctl eval 'mnesia:start(),[mnesia:force_**load_table(T) || T <-
> rabbit_mnesia:table_names()],**mnesia:del_table_copy(schema, rabbit at node2
> ).'
>
> (all as one line), with node2 substituted in. This should respond with:
>
>   {atomic,ok}
>
> Then you can invoke
>
>   rabbitmqctl stop
>
> to stop node1 again. At this point it should have forgotten node2 and be
> able to start again normally.
>
> Note that we don't use "rabbitmqctl force_reset" since that would reset
> node1, and the point is to make it forget node2.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
Dave Seltzer <dseltzer at tveyes.com>
Chief Systems Architect
TVEyes
(203) 254-3600 x222
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/707469f7/attachment.htm>

From eduardo.pinheiro at muzzley.com  Wed Oct 10 19:24:40 2012
From: eduardo.pinheiro at muzzley.com (Eduardo Pinheiro)
Date: Wed, 10 Oct 2012 11:24:40 -0700
Subject: [rabbitmq-discuss] Rabbitmq exchange on client side - javascript
Message-ID: <5075BD68.9060104@muzzley.com>

Dear All,

Imagine that you have three applications APP A (192.168.1.1), APP B 
(192.168.1.59) and APP C (172.53.23.40).

     - They all have internet access
     - APP A and APP B are in the same network with the same internet 
connection
     - APP C is in other network with a different internet connection
     - We have a rabbitmq server in internet: myrabbit.com with an 
exchange called ABC

So the normal implementation to have this 3 apps integrated is tall of 
them connects to myrabbit.com server exchange: ABC

I would like to make an exchange in the client (ex: APP A) and connect 
this exchange to ABC exchange in myrabbit.com, so when APP A and APP B 
talk they talk in the same network ("no latency") and when APP B talks 
with APP C rabbit will deal with that (like federation works).

Example: in apachemq we can have an "exchange" in client side.


The thing is that i don't want to install a full rabbitmq server in 
client side. I would like to work with javascript for example or a 
simple java application.

Do you have any ideas that can help me?

Thanks in advance.

Best Regards,

Eduardo



-- 
Eduardo Pinheiro | Founder
---------------------------------------------------------------------------------
tlm. +351 91 220 63 90
eduardo.pinheiro at muzzley.com
skype: edup_pt
http://pt.linkedin.com/in/eduardopinheiro

muzzley
www.muzzley.com
---------------------------------------------------------------------------------


From prabodh.upreti at vce.com  Wed Oct 10 19:32:41 2012
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Wed, 10 Oct 2012 11:32:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit CAS(Central Authentication Service)
	integration
In-Reply-To: <5075A1EA.5020507@rabbitmq.com>
References: <1349811603124-22452.post@n5.nabble.com>
	<507543E8.7000604@rabbitmq.com>
	<20121010134540.GV10330@data.it.su.se>
	<5075A1EA.5020507@rabbitmq.com>
Message-ID: <1349893961236-22477.post@n5.nabble.com>

hello

Could you please explain how you have configured Shibboleth with rabbit.
Sounds like I need to do the same with CAS.  I don't want to go the route of
creating a plugin. thank you



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbit-CAS-Central-Authentication-Service-integration-tp22452p22477.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From g.kishore at gmail.com  Wed Oct 10 19:38:05 2012
From: g.kishore at gmail.com (kishore g)
Date: Wed, 10 Oct 2012 11:38:05 -0700
Subject: [rabbitmq-discuss] Rabbitmq consumer grouping
Message-ID: <CABaj-Qb9RN39vBmPzySXWEhZi5--GNDstzUSy5zPpo2kMbRx4g@mail.gmail.com>

Hi,

I am writing this email to get feedback about a rabbitmq consumer
group. We developed this recipe using Helix, a generic cluster
management system which we open sourced yesterday. In order to
demonstrate the ease of developing applications with Helix, we chose
to write a rabbitmq-consumer-group.

You can find more info about that here

https://github.com/linkedin/helix/wiki/Sample_App

It would be great if you can provide feedback about this app.

Thanks for your time.

Thanks,
Kishore G


Additional info about Helix.
Home Page: http://linkedin.github.com/helix/
Github source: https://github.com/linkedin/helix
Documentation: https://github.com/linkedin/helix/wiki
Javadocs: http://linkedin.github.com/helix/apidocs/

From srdan at burtcorp.com  Wed Oct 10 19:40:08 2012
From: srdan at burtcorp.com (Srdan Kvrgic)
Date: Wed, 10 Oct 2012 20:40:08 +0200
Subject: [rabbitmq-discuss] Driver connecting to multiple instances in a
	cluster
Message-ID: <6CBED9D9-E4DC-4ECB-ADCF-0245BEC6FB3C@burtcorp.com>

Hi all,

The itch:
The rabbitmq driver connects and sends message to only one of the rabbitmq instances in a cluster limiting performance at high speeds due to inter-instance message forwarding. 

The background:
We've been using rabbitmq for a long time now and with the 2.8 release it's become cemented as an integral part of our system. It's great. The thing is, we send a lot of messages through the system - thousands a second. And we use multiple queues over a cluster of rabbitmq servers. The problem with that is that the driver will only connect to one of the rabbitmq instances and rely on the cluster to forward messages to queues hosted on the other instance. 

Let me put it to you this way. Assume we have a cluster (MQ1, MQ2) with two queues (fragments1, fragments2) under same exchange. The client connects to MQ1.

If the client wants to send a message to fragments 1, the message will be sent by client and received and routed by MQ1.

On the other hand, if the client wants to post a message on fragments2, MQ1 will have to forward the message to MQ2 which means the message will be sent from client, received by MQ1, sent by MQ1 and received and routed by MQ2.

This is a neat solution but when running at high speed it becomes a bottleneck. So, we created autobahn which is a jruby transport layer wrapper that automatically connects to all MQ instances and sends the message to the server that hosts the queue. That gave us a massive boost in throughput. Yey us.

So why am I on the figurative soap-box? The problem's solved, right? Why am I not on a beach under an umbrella wearing a stupid-ass hat and sipping on a Bahama-mama? Well.. The throughput improvement was so substantial that I couldn't help feeling this should be the driver's default behavior.

Right?

Is anything like this planned? Are we the only ones who've encountered this? It wasn't very tricky to implement really..

Kind regards,
Srdan


--
Srdan Urban Kvrgic
LABS, Burt

www.burtcorp.com
http://twitter.com/srdan | http://twitter.com/burtcorp
???????????????????????????????????????????
The Analytics Platform for Online Media







From jerryk at rbcon.com  Wed Oct 10 21:54:10 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Wed, 10 Oct 2012 13:54:10 -0700
Subject: [rabbitmq-discuss] Driver connecting to multiple instances in a
	cluster
In-Reply-To: <6CBED9D9-E4DC-4ECB-ADCF-0245BEC6FB3C@burtcorp.com>
References: <6CBED9D9-E4DC-4ECB-ADCF-0245BEC6FB3C@burtcorp.com>
Message-ID: <CAE0Sz=wwE6gu4dbmCRCi_PsDyfPeoCFCOP9_gLoabGSmELgSmw@mail.gmail.com>

Hi, Srdan:

Out of curiosity, what sort of benchmarked throughput improvement did you
experience connecting directly to the cluster node on which the destination
queue lived?

Best regards,
Jerry

On Wed, Oct 10, 2012 at 11:40 AM, Srdan Kvrgic <srdan at burtcorp.com> wrote:

> Hi all,
>
> The itch:
> The rabbitmq driver connects and sends message to only one of the rabbitmq
> instances in a cluster limiting performance at high speeds due to
> inter-instance message forwarding.
>
> The background:
> We've been using rabbitmq for a long time now and with the 2.8 release
> it's become cemented as an integral part of our system. It's great. The
> thing is, we send a lot of messages through the system - thousands a
> second. And we use multiple queues over a cluster of rabbitmq servers. The
> problem with that is that the driver will only connect to one of the
> rabbitmq instances and rely on the cluster to forward messages to queues
> hosted on the other instance.
>
> Let me put it to you this way. Assume we have a cluster (MQ1, MQ2) with
> two queues (fragments1, fragments2) under same exchange. The client
> connects to MQ1.
>
> If the client wants to send a message to fragments 1, the message will be
> sent by client and received and routed by MQ1.
>
> On the other hand, if the client wants to post a message on fragments2,
> MQ1 will have to forward the message to MQ2 which means the message will be
> sent from client, received by MQ1, sent by MQ1 and received and routed by
> MQ2.
>
> This is a neat solution but when running at high speed it becomes a
> bottleneck. So, we created autobahn which is a jruby transport layer
> wrapper that automatically connects to all MQ instances and sends the
> message to the server that hosts the queue. That gave us a massive boost in
> throughput. Yey us.
>
> So why am I on the figurative soap-box? The problem's solved, right? Why
> am I not on a beach under an umbrella wearing a stupid-ass hat and sipping
> on a Bahama-mama? Well.. The throughput improvement was so substantial that
> I couldn't help feeling this should be the driver's default behavior.
>
> Right?
>
> Is anything like this planned? Are we the only ones who've encountered
> this? It wasn't very tricky to implement really..
>
> Kind regards,
> Srdan
>
>
> --
> Srdan Urban Kvrgic
> LABS, Burt
>
> www.burtcorp.com
> http://twitter.com/srdan | http://twitter.com/burtcorp
> ???????????????????????????????????????????
> The Analytics Platform for Online Media
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/e8dc1606/attachment.htm>

From info at geocast.net  Thu Oct 11 02:18:47 2012
From: info at geocast.net (Geocast)
Date: Thu, 11 Oct 2012 09:18:47 +0800
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <50752CE8.7030007@rabbitmq.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
	<5073F693.9050809@rabbitmq.com>
	<CANC53sFhQHvqpRdqqPjnsBS2tDDo=+1pY+kH4BpUQHsXVXsfFw@mail.gmail.com>
	<50740938.7020309@rabbitmq.com>
	<CANC53sFqMe9DvuVbPRa8ERc9nCBjSbDGmPk4cpYWs6HhZrPg2Q@mail.gmail.com>
	<CANC53sF4MFrYeGB+vBAzkS9sOWpEHandgRKgyFc_bnq8UBf-Mg@mail.gmail.com>
	<50746567.4030103@rabbitmq.com>
	<CANC53sFUdqo965ciEw4O-+E3ELR=smSbotOunQNZdXVxjwQB5A@mail.gmail.com>
	<CANC53sGrfdRCQGdzzZvBq3yWumN5EOKUciOFCk3o32Wvoqai1w@mail.gmail.com>
	<50752CE8.7030007@rabbitmq.com>
Message-ID: <CANC53sHU=kVG7ZGGJbfr=bcSDrPxPZEe+tfams_F=8S8e0vk8Q@mail.gmail.com>

The 160GB swap is even not enough for repair it, the error info:

Crash dump was written to: erl_crash.dump
eheap_alloc: Cannot allocate 13593774640 bytes of memory (of type "heap").
Aborted

I gave up it, :)

2012/10/10 Matthias Radestock <matthias at rabbitmq.com>:
> On 10/10/12 09:02, Geocast wrote:
>>
>> 128GB swap is crashed also, :(
>
>
> When I wrote "I suggest you provide it with as much swap as you can." I
> meant it.
>
> Also, keep an eye on how much memory/swap it is using, just in case there is
> something else going here and for some reason rabbit cannot allocate memory
> when it should be able to.
>
> Matthias.

From mlartz at gmail.com  Thu Oct 11 02:59:34 2012
From: mlartz at gmail.com (Michael Artz)
Date: Wed, 10 Oct 2012 18:59:34 -0700 (PDT)
Subject: [rabbitmq-discuss] Perfomance Calculations?
Message-ID: <701337b3-4eac-49be-840d-0ee953bcdb0d@googlegroups.com>

Is there any way to estimate the rough performance expectations for a given 
CPU/RAM combination?  We've been running some perf tests with RabbitMQ on 
AWS and have been getting some interesting results.  We started with micro 
instances (~400MB RAM, up to 1.2Ghz in burst), and saw sustained throughput 
rates of about 400 messages/second (16 byte messages), with the occasional 
spike up to 2K messages/second, which we attributed to AWS's CPU allocation 
algorithms.  On a personal machine (Mac Mini) we were seeing ~7K 
messages/second.  In both cases, the management API lists blocked_by as 
'flow'.

So, for capacity planning, we'd like to estimate the hardware (or VM size) 
that we would need to process a given number of messages/second via a topic 
exchange with at least one bound queue.  Do any numbers like this exist, or 
are we going to have to develop them ourselves?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121010/61b23810/attachment.htm>

From pablomolnar at gmail.com  Thu Oct 11 05:22:53 2012
From: pablomolnar at gmail.com (Pablo Molnar)
Date: Thu, 11 Oct 2012 01:22:53 -0300
Subject: [rabbitmq-discuss] Driver connecting to multiple instances in a
	cluster
In-Reply-To: <6CBED9D9-E4DC-4ECB-ADCF-0245BEC6FB3C@burtcorp.com>
References: <6CBED9D9-E4DC-4ECB-ADCF-0245BEC6FB3C@burtcorp.com>
Message-ID: <CANVSfp+a0Y5fXwOk+DiVADfSBvynmWuQXb6segDg8myAAYe2Cw@mail.gmail.com>

That seems great, you are saving one hop and load balancing the connections
right?
You have this autobahn product open sourced somewhere? Would be if we
could experiment a little with your work!

Cheers,
Pablo

On Wed, Oct 10, 2012 at 3:40 PM, Srdan Kvrgic <srdan at burtcorp.com> wrote:

> Hi all,
>
> The itch:
> The rabbitmq driver connects and sends message to only one of the rabbitmq
> instances in a cluster limiting performance at high speeds due to
> inter-instance message forwarding.
>
> The background:
> We've been using rabbitmq for a long time now and with the 2.8 release
> it's become cemented as an integral part of our system. It's great. The
> thing is, we send a lot of messages through the system - thousands a
> second. And we use multiple queues over a cluster of rabbitmq servers. The
> problem with that is that the driver will only connect to one of the
> rabbitmq instances and rely on the cluster to forward messages to queues
> hosted on the other instance.
>
> Let me put it to you this way. Assume we have a cluster (MQ1, MQ2) with
> two queues (fragments1, fragments2) under same exchange. The client
> connects to MQ1.
>
> If the client wants to send a message to fragments 1, the message will be
> sent by client and received and routed by MQ1.
>
> On the other hand, if the client wants to post a message on fragments2,
> MQ1 will have to forward the message to MQ2 which means the message will be
> sent from client, received by MQ1, sent by MQ1 and received and routed by
> MQ2.
>
> This is a neat solution but when running at high speed it becomes a
> bottleneck. So, we created autobahn which is a jruby transport layer
> wrapper that automatically connects to all MQ instances and sends the
> message to the server that hosts the queue. That gave us a massive boost in
> throughput. Yey us.
>
> So why am I on the figurative soap-box? The problem's solved, right? Why
> am I not on a beach under an umbrella wearing a stupid-ass hat and sipping
> on a Bahama-mama? Well.. The throughput improvement was so substantial that
> I couldn't help feeling this should be the driver's default behavior.
>
> Right?
>
> Is anything like this planned? Are we the only ones who've encountered
> this? It wasn't very tricky to implement really..
>
> Kind regards,
> Srdan
>
>
> --
> Srdan Urban Kvrgic
> LABS, Burt
>
> www.burtcorp.com
> http://twitter.com/srdan | http://twitter.com/burtcorp
> ???????????????????????????????????????????
> The Analytics Platform for Online Media
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/761cc6eb/attachment.htm>

From simlu at su.se  Thu Oct 11 05:38:45 2012
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Thu, 11 Oct 2012 06:38:45 +0200
Subject: [rabbitmq-discuss] Rabbit CAS(Central Authentication Service)
 integration
In-Reply-To: <1349893961236-22477.post@n5.nabble.com>
References: <1349811603124-22452.post@n5.nabble.com>
	<507543E8.7000604@rabbitmq.com>
	<20121010134540.GV10330@data.it.su.se>
	<5075A1EA.5020507@rabbitmq.com>
	<1349893961236-22477.post@n5.nabble.com>
Message-ID: <20121011043845.GW10330@data.it.su.se>

On Wed, 2012-10-10 at 11:32:41 -0700, Prabodh Upreti wrote:
> hello
> 
> Could you please explain how you have configured Shibboleth with rabbit.
> Sounds like I need to do the same with CAS.  I don't want to go the route of
> creating a plugin. thank you

We haven't, but we'd like to.

The only solution is to use a http proxy as Simon suggests, I guess.

- Simon

From matthias at rabbitmq.com  Thu Oct 11 07:16:03 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 11 Oct 2012 07:16:03 +0100
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <CANC53sHU=kVG7ZGGJbfr=bcSDrPxPZEe+tfams_F=8S8e0vk8Q@mail.gmail.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
	<5073F693.9050809@rabbitmq.com>
	<CANC53sFhQHvqpRdqqPjnsBS2tDDo=+1pY+kH4BpUQHsXVXsfFw@mail.gmail.com>
	<50740938.7020309@rabbitmq.com>
	<CANC53sFqMe9DvuVbPRa8ERc9nCBjSbDGmPk4cpYWs6HhZrPg2Q@mail.gmail.com>
	<CANC53sF4MFrYeGB+vBAzkS9sOWpEHandgRKgyFc_bnq8UBf-Mg@mail.gmail.com>
	<50746567.4030103@rabbitmq.com>
	<CANC53sFUdqo965ciEw4O-+E3ELR=smSbotOunQNZdXVxjwQB5A@mail.gmail.com>
	<CANC53sGrfdRCQGdzzZvBq3yWumN5EOKUciOFCk3o32Wvoqai1w@mail.gmail.com>
	<50752CE8.7030007@rabbitmq.com>
	<CANC53sHU=kVG7ZGGJbfr=bcSDrPxPZEe+tfams_F=8S8e0vk8Q@mail.gmail.com>
Message-ID: <50766423.2020200@rabbitmq.com>

On 11/10/12 02:18, Geocast wrote:
> The 160GB swap is even not enough

Did you keep an eye on how much memory/swap it was actually using?


Matthias.

From matthias at rabbitmq.com  Thu Oct 11 07:24:14 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 11 Oct 2012 07:24:14 +0100
Subject: [rabbitmq-discuss] Perfomance Calculations?
In-Reply-To: <701337b3-4eac-49be-840d-0ee953bcdb0d@googlegroups.com>
References: <701337b3-4eac-49be-840d-0ee953bcdb0d@googlegroups.com>
Message-ID: <5076660E.5010504@rabbitmq.com>

Michael,

On 11/10/12 02:59, Michael Artz wrote:
> We started with micro instances (~400MB RAM, up to 1.2Ghz in burst), and
> saw sustained throughput rates of about 400 messages/second (16 byte
> messages),

You should be seeing *much* higher rates than that.

I recommend that you get some baseline figures by running one of 
rabbit's off-the-shelf performance measurement applications, such as 
com.rabbitmq.examples.MulticastMain, which ships with the Java client. 
That will help you identify any weaknesses in your own test code.

Regards,

Matthias.

From matthias at rabbitmq.com  Thu Oct 11 07:49:06 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 11 Oct 2012 07:49:06 +0100
Subject: [rabbitmq-discuss] Driver connecting to multiple instances in a
 cluster
In-Reply-To: <6CBED9D9-E4DC-4ECB-ADCF-0245BEC6FB3C@burtcorp.com>
References: <6CBED9D9-E4DC-4ECB-ADCF-0245BEC6FB3C@burtcorp.com>
Message-ID: <50766BE2.9030109@rabbitmq.com>

Srdan,

On 10/10/12 19:40, Srdan Kvrgic wrote:
> Let me put it to you this way. Assume we have a cluster (MQ1, MQ2)
> with two queues (fragments1, fragments2) under same exchange. The
> client connects to MQ1.
>
> If the client wants to send a message to fragments 1, the message
> will be sent by client and received and routed by MQ1.
>
> On the other hand, if the client wants to post a message on
> fragments2, MQ1 will have to forward the message to MQ2 which means
> the message will be sent from client, received by MQ1, sent by MQ1
> and received and routed by MQ2.

...and if the consumer(s) for MQ2 are connected to MQ1 then there is a 
second hop to traverse.

And yes, this is fairly expensive.

> This is a neat solution but when running at high speed it becomes a
> bottleneck. So, we created autobahn which is a jruby transport layer
> wrapper that automatically connects to all MQ instances and sends the
> message to the server that hosts the queue. That gave us a massive
> boost in throughput. Yey us.
>
> So why am I on the figurative soap-box? The problem's solved, right?
> Why am I not on a beach under an umbrella wearing a stupid-ass hat
> and sipping on a Bahama-mama? Well.. The throughput improvement was
> so substantial that I couldn't help feeling this should be the
> driver's default behavior.

Unfortunately that is impossible in the general case:

1) In AMQP a single published message can get routed to multiple queues. 
Indeed that is typical for pub-sub type applications. If those queues 
reside on different nodes then there is no 'right' node to publish to.

2) AMQP is a connection-oriented protocol, and the notion of sessions, 
manifested in AMQP's concept of channels, is important. For example, 
ordering guarantees, transactions/confirms, qos prefetching and error 
handling are all scoped to channels. So performing operations across 
multiple connections has different behaviour than when doing so across a 
single connection. This may not matter to some applications, but in 
general it does.

3) There is no way for a client to find out which node a queue resides 
on, other than going via the management interface, which is not 
something you'd want to happen in a plain AMQP client.

4) A mirrored queue's master node of queue can change during its 
lifetime due to failover events.


Regards,

Matthias.

From matthias at rabbitmq.com  Thu Oct 11 08:49:44 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 11 Oct 2012 08:49:44 +0100
Subject: [rabbitmq-discuss] Rabbitmq consumer grouping
In-Reply-To: <CABaj-Qb9RN39vBmPzySXWEhZi5--GNDstzUSy5zPpo2kMbRx4g@mail.gmail.com>
References: <CABaj-Qb9RN39vBmPzySXWEhZi5--GNDstzUSy5zPpo2kMbRx4g@mail.gmail.com>
Message-ID: <50767A18.10309@rabbitmq.com>

Kishore,

On 10/10/12 19:38, kishore g wrote:
> I am writing this email to get feedback about a rabbitmq consumer
> group. We developed this recipe using Helix, a generic cluster
> management system which we open sourced yesterday. In order to
> demonstrate the ease of developing applications with Helix, we chose
> to write a rabbitmq-consumer-group.
>
> You can find more info about that here
>
> https://github.com/linkedin/helix/wiki/Sample_App
>
> It would be great if you can provide feedback about this app.

That looks pretty interesting.

One question: wouldn't you get the same failure-handling and scaling 
behaviour by having all consumers consume from all queues? RabbitMQ's 
own consumer load balancing should ensure that messages are distributed 
fairly to consumers in such a set up.

Regards,

Matthias.

From g.kishore at gmail.com  Wed Oct 10 18:28:05 2012
From: g.kishore at gmail.com (kishore g)
Date: Wed, 10 Oct 2012 10:28:05 -0700
Subject: [rabbitmq-discuss] Consumer group
Message-ID: <CABaj-QbJz=_k=vJ4r75qKDRL-KovZQ-G5yTNf4cP=pkNtpuMjQ@mail.gmail.com>

Hi,

I am writing this email to get feedback about a rabbitmq consumer
group. We developed this recipe using Helix, a generic cluster
management system which we open sourced yesterday. In order to
demonstrate the ease of developing applications with Helix, we chose
to write a rabbitmq-consumer-group.

You can find more info about that here

https://github.com/linkedin/helix/wiki/Sample_App

It would be great if you can provide feedback about this app.

Thanks for your time.

Thanks,
Kishore G


Additional info about Helix.
Home Page: http://linkedin.github.com/helix/
Github source: https://github.com/linkedin/helix
Documentation: https://github.com/linkedin/helix/wiki
Javadocs: http://linkedin.github.com/helix/apidocs/

From serzer at gmail.com  Thu Oct 11 10:15:46 2012
From: serzer at gmail.com (Serj Kozlov)
Date: Thu, 11 Oct 2012 02:15:46 -0700 (PDT)
Subject: [rabbitmq-discuss] Cannot run first example from tutorial.
Message-ID: <9a937082-9a66-4c40-8164-e2fc863e3492@googlegroups.com>

Hi, i've installed rabbitmq on my fresh debian server.
I did not made any changes to configuration of the rabbitmq, just installed 
and started it.
But when i'm trying to run tutorial 1, something goes wrong - receive.py 
doesn't receive any messages at all without any errors. I am using exact 
code from a tutorial.
Please help me to find an issue of problem.
Here are the logs of rabbitmq: 

rabbit at main.log: 

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
Limiting to approx 924 file handles (829 sockets)

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
Memory limit set to 102MB of 256MB total.

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
Disk free limit set to 1000MB

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
Disk free space insufficient. Free bytes:496087040 Limit:1000000000

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
    alarm_handler: {set,{{resource_limit,disk,rabbit at main},[]}}

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
Adding vhost '/'

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
Creating user 'guest'

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
Setting user tags for user 'guest' to [administrator]

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
Setting permissions for 'guest' in '/' to '.*', '.*', '.*'

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
msg_store_transient: using rabbit_msg_store_ets_index to provide index

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
msg_store_persistent: using rabbit_msg_store_ets_index to provide index

=WARNING REPORT==== 11-Oct-2012::12:50:47 ===
msg_store_persistent: rebuilding indices from scratch

=INFO REPORT==== 11-Oct-2012::12:50:47 ===
started TCP Listener on [::]:5672

=INFO REPORT==== 11-Oct-2012::12:53:54 ===
accepting AMQP connection <0.304.0> (127.0.0.1:46381 -> 127.0.0.1:5672)

=INFO REPORT==== 11-Oct-2012::12:54:03 ===
accepting AMQP connection <0.315.0> (127.0.0.1:46392 -> 127.0.0.1:5672)

=INFO REPORT==== 11-Oct-2012::12:54:34 ===
accepting AMQP connection <0.329.0> (127.0.0.1:46393 -> 127.0.0.1:5672)

=WARNING REPORT==== 11-Oct-2012::12:54:41 ===
closing AMQP connection <0.304.0> (127.0.0.1:46381 -> 127.0.0.1:5672):
connection_closed_abruptly


startup_log:

node           : rabbit at main
app descriptor : 
/usr/lib/rabbitmq/lib/rabbitmq_server-2.8.7/sbin/../ebin/rabbit.app
home dir       : /var/lib/rabbitmq
config file(s) : (none)
cookie hash    : zKewt7vgZWMGE+qFuDTfvQ==
log            : /var/log/rabbitmq/rabbit at main.log
sasl log       : /var/log/rabbitmq/rabbit at main-sasl.log
database dir   : /var/lib/rabbitmq/mnesia/rabbit at main
erlang version : 5.8

-- rabbit boot start
starting file handle cache server                                     
...done
starting worker pool                                                 
 ...done
starting database                                                     
...done
starting database sync                                               
 ...done
starting codec correctness check                                     
 ...done
-- external infrastructure ready
starting plugin registry                                             
 ...done
starting auth mechanism cr-demo                                       
...done
starting auth mechanism amqplain                                     
 ...done
starting auth mechanism plain                                         
...done
starting statistics event manager                                     
...done
starting logging server                                               
...done
starting exchange type direct                                         
...done
starting exchange type fanout                                         
...done
starting exchange type headers                                       
 ...done
starting exchange type topic                                         
 ...done
-- kernel ready
starting alarm handler                                               
 ...done
starting node monitor                                                 
...done
starting cluster delegate                                             
...done
starting guid generator                                               
...done
starting memory monitor                                               
...done
-- core initialized
starting empty DB check                                               
...done
starting exchange, queue and binding recovery                         
...done
starting mirror queue slave sup                                       
...done
starting adding mirrors to queues                                     
...done
-- message delivery logic ready
starting error log relay                                             
 ...done
starting networking                                                   
...done
starting direct client                                               
 ...done
starting notify cluster nodes                                         
...done


 broker running


 rabbitmqctl status

Status of node rabbit at main ...
[{pid,1745},
 {running_applications,[{rabbit,"RabbitMQ","2.8.7"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.14"},
                        {os_mon,"CPO  CXC 138 46","2.2.5"},
                        {sasl,"SASL  CXC 138 11","2.1.9.2"},
                        {stdlib,"ERTS  CXC 138 10","1.17"},
                        {kernel,"ERTS  CXC 138 10","2.14"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14A (erts-5.8) [source] [64-bit] [smp:2:2] [rq:2] 
[async-threads:30] [kernel-poll:true]\n"},
 {memory,[{total,25998168},
          {processes,10079192},
          {processes_used,10060152},
          {system,15918976},
          {atom,1135057},
          {atom_used,1132083},
          {binary,140824},
          {code,12184336},
          {ets,772144}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,107374182},
 {disk_free_limit,1000000000},
 {disk_free,475242496},
 {file_descriptors,[{total_limit,924},
                    {total_used,5},
                    {sockets_limit,829},
                    {sockets_used,3}]},
 {processes,[{limit,1048576},{used,136}]},
 {run_queue,0},
 {uptime,1392}]
...done.


rabbit at main-sasl.log and startup_err logs are empty.

Thanks a lot for your help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/4048a40d/attachment.htm>

From emile at rabbitmq.com  Thu Oct 11 10:38:15 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 11 Oct 2012 10:38:15 +0100
Subject: [rabbitmq-discuss] Cannot run first example from tutorial.
In-Reply-To: <9a937082-9a66-4c40-8164-e2fc863e3492@googlegroups.com>
References: <9a937082-9a66-4c40-8164-e2fc863e3492@googlegroups.com>
Message-ID: <50769387.1080405@rabbitmq.com>

Hi Serj,

On 11/10/12 10:15, Serj Kozlov wrote:
>     =INFO REPORT==== 11-Oct-2012::12:50:47 ===
>     Disk free space insufficient. Free bytes:496087040 Limit:1000000000
> 
>     =INFO REPORT==== 11-Oct-2012::12:50:47 ===
>         alarm_handler: {set,{{resource_limit,disk,rabbit at main},[]}}

The problem is that you don't have enough disk space. The broker will
block further messages until sufficient space is available. You can
solve this problem by supplying more disk space or by configuring a
lower limit. See the configuration file documentation on how to do that:

http://www.rabbitmq.com/configure.html



-Emile


From info at geocast.net  Thu Oct 11 10:48:29 2012
From: info at geocast.net (Geocast)
Date: Thu, 11 Oct 2012 17:48:29 +0800
Subject: [rabbitmq-discuss] Help with my rabbitmq crashing
In-Reply-To: <50766423.2020200@rabbitmq.com>
References: <CANC53sEJM5E-BPiqBiZAnCADtCh12RHcDKBBtRxOAs05JR71iw@mail.gmail.com>
	<5073EB9D.600@rabbitmq.com>
	<CANC53sENDs8tv24=q5XpBOpwhYk0du4gCJw_LshaOBBRu2Rbkg@mail.gmail.com>
	<5073F693.9050809@rabbitmq.com>
	<CANC53sFhQHvqpRdqqPjnsBS2tDDo=+1pY+kH4BpUQHsXVXsfFw@mail.gmail.com>
	<50740938.7020309@rabbitmq.com>
	<CANC53sFqMe9DvuVbPRa8ERc9nCBjSbDGmPk4cpYWs6HhZrPg2Q@mail.gmail.com>
	<CANC53sF4MFrYeGB+vBAzkS9sOWpEHandgRKgyFc_bnq8UBf-Mg@mail.gmail.com>
	<50746567.4030103@rabbitmq.com>
	<CANC53sFUdqo965ciEw4O-+E3ELR=smSbotOunQNZdXVxjwQB5A@mail.gmail.com>
	<CANC53sGrfdRCQGdzzZvBq3yWumN5EOKUciOFCk3o32Wvoqai1w@mail.gmail.com>
	<50752CE8.7030007@rabbitmq.com>
	<CANC53sHU=kVG7ZGGJbfr=bcSDrPxPZEe+tfams_F=8S8e0vk8Q@mail.gmail.com>
	<50766423.2020200@rabbitmq.com>
Message-ID: <CANC53sGX6JApO-je=4_d5Fc0OLJzOOycmwRGpsStronnZPLfKw@mail.gmail.com>

the top shows all memroy are using by the rabbit process.

2012/10/11 Matthias Radestock <matthias at rabbitmq.com>:
> On 11/10/12 02:18, Geocast wrote:
>>
>> The 160GB swap is even not enough
>
>
> Did you keep an eye on how much memory/swap it was actually using?
>
>
> Matthias.

From emile at rabbitmq.com  Thu Oct 11 11:02:00 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 11 Oct 2012 11:02:00 +0100
Subject: [rabbitmq-discuss] Re-subscribing to a queue in a cluster
In-Reply-To: <BD46CD450E3D7843BCE36FF301A8BC4C2AA33C57@LCEEXMB02.LCE.com>
References: <BD46CD450E3D7843BCE36FF301A8BC4C2AA33C57@LCEEXMB02.LCE.com>
Message-ID: <50769918.4050407@rabbitmq.com>

Hi Adam,

On 09/10/12 17:07, Adam Brightwell wrote:
> the RPC call involved with the basicConsume is blocking other Channel
> based operations.  This is why I suspect that the "basicAck" was unable to
> execute successfully and that the "handleDelivery" was never being reached.

If you have multiple consumers per channel then long-running consumers
may hold up dispatch of callbacks to other consumers on that channel.
The Java API guide has more information:

http://www.rabbitmq.com/api-guide.html

> instance, having a thread pool dedicated for such operations, utilizing
> java's ExecutorService or is there something already built in to the
> client api that will provide me a way to run this code if I wrapped it in
> a Runnable, Callable, etc.?

You may supply your own ExecutorService if you need to - see the API
guide again.

> Also, as a side note, has any consideration been given to using java's
> concurrency model more widely in the java client api?  For instance,
> synchronization of methods or code blocks to possibly help avoid such
> situations?

I'm not sure how much more concurrency can be offered without violating
ordering constraints. Please feel free to suggest concrete improvements.



-Emile


From marc.villacorta at gmail.com  Thu Oct 11 11:46:46 2012
From: marc.villacorta at gmail.com (Marc Villacorta)
Date: Thu, 11 Oct 2012 12:46:46 +0200
Subject: [rabbitmq-discuss] RabbitMQ 2.8.7 + LDAP + other_bind
In-Reply-To: <5075A0E3.9070407@rabbitmq.com>
References: <1dcccbfd-6484-4ee5-8732-19e1768cc77b@googlegroups.com>
	<5075A0E3.9070407@rabbitmq.com>
Message-ID: <CAGHhR3cKuY0bMxCf_BGb4RL2-1ZieJEx+tuChwcCD1G9=zLpcw@mail.gmail.com>

Thank you,

Now I realized the other_bind option is not what I want.
Jenkins LDAP has this 'Manager DN' to establish the initial bind.
Then they look up the username using a 'User search filter'.
I am not sure either about the user password. I don't see it in the network
traces thus, I think the application validates the password somehow.

Cheers, Marc

On Wed, Oct 10, 2012 at 6:22 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi!
>
> The other_bind option is only used for authorisation queries - i.e. the
> queries we make *after* authenticating a user, to determine what rights
> they have.
>
> The user's provided username and password are used to bind to LDAP for
> authentication.
>
> I'm not sure how authentication could work any other way - I guess we
> could try to look up username and password, but I assume any sensible LDAP
> server will not store passwords in plain text anyway.
>
> Cheers, Simon
>
>
> On 10/10/12 15:28, Marc wrote:
>
>> Hello all!
>>
>> For authentication I need to bind to a Microsoft Active Directory.
>>
>> Let's say my bind user is '/uxxx/' with password '/pxxx/'.
>> Let's say the user I try to authenticate is '/uyyy/' with password
>> '/pyyy/'.
>>
>> I use the /other_bind
>> <http://hg.rabbitmq.com/**rabbitmq-auth-backend-ldap/**
>> file/d76afaf44415/README#l100<http://hg.rabbitmq.com/rabbitmq-auth-backend-ldap/file/d76afaf44415/README#l100>
>> >**/
>> configuration option in order to bind with user '/uxxx/'.
>>
>>
>> Like this:
>>
>>          { rabbit, [{auth_backends, [rabbit_auth_backend_ldap]}]},
>>
>>          { rabbitmq_auth_backend_ldap, [
>>
>>              {servers, ["myldapserver"]},
>>
>>              {other_bind, {"uxxx", "pxxx"}},
>>
>>              {dn_lookup_base, "DC=my,DC=domain,DC=com"},
>>
>>              {dn_lookup_attribute, "AccountName"},
>>
>>              {user_dn_pattern,
>>     "CN=${username},OU=users,OU=**mycompany,DC=my,DC=domain,DC=**com"},
>>
>>              {log,true}
>>
>>          ]}
>>
>>
>> but when I try to login with user '/uyyy/' I get this in my logs:
>>
>>
>>     =INFO REPORT==== 10-Oct-2012::16:21:04 ===
>>
>>     LDAP backend: connecting to ["myldapserver"]
>>
>>
>>     =INFO REPORT==== 10-Oct-2012::16:21:04 ===
>>
>>     LDAP backend: bind request = {'BindRequest',3,
>>
>>
>>       "CN=uyyy,OU=users,OU=**mycompany,DC=my,DC=domain,DC=**com",
>>
>>                                       {simple,<<"pyyy">>}}
>>
>>
>>     =INFO REPORT==== 10-Oct-2012::16:21:04 ===
>>
>>     LDAP backend: bind reply = {ok,
>>
>>                                  {'LDAPMessage',1,
>>
>>                                   {bindResponse,
>>
>>                                    {'BindResponse',**
>> invalidCredentials,[],
>>
>>
>>       [56,48,48,57,48,51,48,56,58,**32,76,100,97,112,
>>
>>
>>     69,114,114,58,32,68,83,73,68,**45,48,67,48,57,
>>
>>
>>     48,51,65,57,44,32,99,111,109,**109,101,110,116,
>>
>>
>>     58,32,65,99,99,101,112,116,83,**101,99,117,114,
>>
>>
>>     105,116,121,67,111,110,116,**101,120,116,32,101,
>>
>>
>>     114,114,111,114,44,32,100,97,**116,97,32,53,50,
>>
>>                                      101,44,32,118,49,100,98,48,0],
>>
>>                                     asn1_NOVALUE,asn1_NOVALUE}},
>>
>>                                   asn1_NOVALUE}}
>>
>>
>> I understand the bind request is being forged with the wrong user.
>> Could that be a bug in the LDAP plugin?
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/88a55100/attachment.htm>

From simon at rabbitmq.com  Thu Oct 11 11:54:39 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Oct 2012 11:54:39 +0100
Subject: [rabbitmq-discuss] node-amqp rabbitmq channel
In-Reply-To: <73fab593-8294-48b9-863e-84cb56ba0385@googlegroups.com>
References: <73fab593-8294-48b9-863e-84cb56ba0385@googlegroups.com>
Message-ID: <5076A56F.3050400@rabbitmq.com>

On 09/10/12 14:57, script hawk wrote:
> node-amqp https://github.com/postwait/node-amqp doesn't seem to support
> rabbitmq channel.
> I couldn't find a connection.CreateChannel method. What I like to do is
> to use a channel for each application that uses rabbitmq.
> Any idea? Appreciated.

I am no node-amqp expert (is the author around?), but from a quick peek 
at the source it looks like one of those clients which tries to abstract 
away the concept of channels. So I'm not sure you can do that. But 
connections are not too expensive :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Thu Oct 11 11:56:56 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 11 Oct 2012 11:56:56 +0100
Subject: [rabbitmq-discuss] Failure to return from call to
	newConnection()
In-Reply-To: <242E9559AA2C354CB60C81A952FCBEB5018098@TSEAMB01>
References: <242E9559AA2C354CB60C81A952FCBEB5017F7E@TSEAMB01>,
	<50734402.9000307@rabbitmq.com>
	<242E9559AA2C354CB60C81A952FCBEB501801E@TSEAMB01>,
	<50743A54.3030906@rabbitmq.com>
	<242E9559AA2C354CB60C81A952FCBEB5018098@TSEAMB01>
Message-ID: <5076A5F8.6080606@rabbitmq.com>

James,

so

On 09/10/12 17:11, McMahon, James S (TASC) wrote:
> java -cp %CP% myClass EXCHANGE_A   123.456.666.6   5672

works, but

> java -cp %CP% myClass EXCHANGE_B   123.456.666.6   5672

fails to establish the connection?

That seems exceedingly unlikely. Can you post a console transcript of
invoking the above in the same command shell? i.e. run the first
command, C-c it, then run the second.

> There's no firewall. All of these are on one physical computer for
> testing purposes.

The machine's internal firewall could be interfering.

Regards,

Matthias.

From simon at rabbitmq.com  Thu Oct 11 11:58:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 11 Oct 2012 11:58:06 +0100
Subject: [rabbitmq-discuss] Rabbitmq exchange on client side - javascript
In-Reply-To: <5075BD68.9060104@muzzley.com>
References: <5075BD68.9060104@muzzley.com>
Message-ID: <5076A63E.40002@rabbitmq.com>

I'm afraid there's no mini-broker or similar for RabbitMQ. You would 
have to install the full broker.

Cheers, Simon

On 10/10/12 19:24, Eduardo Pinheiro wrote:
> Dear All,
>
> Imagine that you have three applications APP A (192.168.1.1), APP B
> (192.168.1.59) and APP C (172.53.23.40).
>
>      - They all have internet access
>      - APP A and APP B are in the same network with the same internet
> connection
>      - APP C is in other network with a different internet connection
>      - We have a rabbitmq server in internet: myrabbit.com with an
> exchange called ABC
>
> So the normal implementation to have this 3 apps integrated is tall of
> them connects to myrabbit.com server exchange: ABC
>
> I would like to make an exchange in the client (ex: APP A) and connect
> this exchange to ABC exchange in myrabbit.com, so when APP A and APP B
> talk they talk in the same network ("no latency") and when APP B talks
> with APP C rabbit will deal with that (like federation works).
>
> Example: in apachemq we can have an "exchange" in client side.
>
>
> The thing is that i don't want to install a full rabbitmq server in
> client side. I would like to work with javascript for example or a
> simple java application.
>
> Do you have any ideas that can help me?
>
> Thanks in advance.
>
> Best Regards,
>
> Eduardo
>
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From prabodh.upreti at vce.com  Thu Oct 11 15:13:55 2012
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Thu, 11 Oct 2012 07:13:55 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit CAS(Central Authentication Service)
	integration
In-Reply-To: <1349893961236-22477.post@n5.nabble.com>
References: <1349811603124-22452.post@n5.nabble.com>
	<507543E8.7000604@rabbitmq.com>
	<20121010134540.GV10330@data.it.su.se>
	<5075A1EA.5020507@rabbitmq.com>
	<1349893961236-22477.post@n5.nabble.com>
Message-ID: <1349964835117-22498.post@n5.nabble.com>

Hello Simon

Is there a good documentation I can follow for setting up the HTTP proxy.  I
see bits and pieces but not getting the full picture.  Also, I see a plugin
in one of the threads talk about http authen proxy.  Is that something I
could use? thx.

regards



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbit-CAS-Central-Authentication-Service-integration-tp22452p22498.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Ramachandrarao.K at saint-gobain.com  Thu Oct 11 15:25:34 2012
From: Ramachandrarao.K at saint-gobain.com (Ramachandrarao, K [ SGGI - IT ])
Date: Thu, 11 Oct 2012 19:55:34 +0530
Subject: [rabbitmq-discuss] Reg: Total Transfers
Message-ID: <8A9DF2095351E74AB39CF6BF78F20CC904F5A0F1@L00EXCEC1.zl.if.atcsg.net>

Dear Team,

 

We are new to RabbitMQ. We are using the Version 2.8.4 and the Client is
Python 2.7 

 

Could anybody help us on the Following points.

 

1.       How to check the total messages transferred via Exchange or a
Queue for a Period. 

a.       Ex. Today  there is X number of Message are published and X
numbers are received (Message transfer statistics)

2.       How to configure the Flow Control, and Charts in RabbitMQ.

3.       How to add  a new tracing log automatically.

 

Thanks and Regards

 

Ramachandra Rao K

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/b1155e1e/attachment.htm>

From srdan at burtcorp.com  Thu Oct 11 16:24:42 2012
From: srdan at burtcorp.com (Srdan Kvrgic)
Date: Thu, 11 Oct 2012 17:24:42 +0200
Subject: [rabbitmq-discuss] Driver connecting to multiple instances in a
	cluster
In-Reply-To: <CAE0Sz=wwE6gu4dbmCRCi_PsDyfPeoCFCOP9_gLoabGSmELgSmw@mail.gmail.com>
References: <6CBED9D9-E4DC-4ECB-ADCF-0245BEC6FB3C@burtcorp.com>
	<CAE0Sz=wwE6gu4dbmCRCi_PsDyfPeoCFCOP9_gLoabGSmELgSmw@mail.gmail.com>
Message-ID: <0EFB46A3-A2C8-4A79-BB0F-05D0AB37A0E7@burtcorp.com>

I don't seem to have the test data on those tests left =/ Sorry. But the gain was substantial. This ancient performance document shows that adding more mq:s to a cluster doesn't do much for performance.  http://goo.gl/z3tgG 

That was 2.6 though. 2.8 is better, but it cannot break the laws of physics. The network interfaces will get saturated, especially in the cloud (where we're running)

Kind regards,
Srdan

On Oct 10, 2012, at 22:54 , Jerry Kuch wrote:

> Hi, Srdan:
> 
> Out of curiosity, what sort of benchmarked throughput improvement did you experience connecting directly to the cluster node on which the destination queue lived?
> 
> Best regards,
> Jerry
> 
> On Wed, Oct 10, 2012 at 11:40 AM, Srdan Kvrgic <srdan at burtcorp.com> wrote:
> Hi all,
> 
> The itch:
> The rabbitmq driver connects and sends message to only one of the rabbitmq instances in a cluster limiting performance at high speeds due to inter-instance message forwarding.
> 
> The background:
> We've been using rabbitmq for a long time now and with the 2.8 release it's become cemented as an integral part of our system. It's great. The thing is, we send a lot of messages through the system - thousands a second. And we use multiple queues over a cluster of rabbitmq servers. The problem with that is that the driver will only connect to one of the rabbitmq instances and rely on the cluster to forward messages to queues hosted on the other instance.
> 
> Let me put it to you this way. Assume we have a cluster (MQ1, MQ2) with two queues (fragments1, fragments2) under same exchange. The client connects to MQ1.
> 
> If the client wants to send a message to fragments 1, the message will be sent by client and received and routed by MQ1.
> 
> On the other hand, if the client wants to post a message on fragments2, MQ1 will have to forward the message to MQ2 which means the message will be sent from client, received by MQ1, sent by MQ1 and received and routed by MQ2.
> 
> This is a neat solution but when running at high speed it becomes a bottleneck. So, we created autobahn which is a jruby transport layer wrapper that automatically connects to all MQ instances and sends the message to the server that hosts the queue. That gave us a massive boost in throughput. Yey us.
> 
> So why am I on the figurative soap-box? The problem's solved, right? Why am I not on a beach under an umbrella wearing a stupid-ass hat and sipping on a Bahama-mama? Well.. The throughput improvement was so substantial that I couldn't help feeling this should be the driver's default behavior.
> 
> Right?
> 
> Is anything like this planned? Are we the only ones who've encountered this? It wasn't very tricky to implement really..
> 
> Kind regards,
> Srdan
> 
> 
> --
> Srdan Urban Kvrgic
> LABS, Burt
> 
> www.burtcorp.com
> http://twitter.com/srdan | http://twitter.com/burtcorp
> ???????????????????????????????????????????
> The Analytics Platform for Online Media
> 
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
Srdan Urban Kvrgic
LABS, Burt
+46 70 432 2472

www.burtcorp.com
http://twitter.com/srdan | http://twitter.com/burtcorp
???????????????????????????????????????????
The Analytics Platform for Online Media






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/243ca2e6/attachment.htm>

From srdan at burtcorp.com  Thu Oct 11 16:25:23 2012
From: srdan at burtcorp.com (Srdan Kvrgic)
Date: Thu, 11 Oct 2012 17:25:23 +0200
Subject: [rabbitmq-discuss] Driver connecting to multiple instances in a
	cluster
In-Reply-To: <CANVSfp+a0Y5fXwOk+DiVADfSBvynmWuQXb6segDg8myAAYe2Cw@mail.gmail.com>
References: <6CBED9D9-E4DC-4ECB-ADCF-0245BEC6FB3C@burtcorp.com>
	<CANVSfp+a0Y5fXwOk+DiVADfSBvynmWuQXb6segDg8myAAYe2Cw@mail.gmail.com>
Message-ID: <DC0ED466-769D-4B70-B03B-B73043945F6D@burtcorp.com>

Sure, it's on github.com/burtcorp/autobahn


Kind regards,
Srdan

On Oct 11, 2012, at 6:22 , Pablo Molnar wrote:

> That seems great, you are saving one hop and load balancing the connections right? 
> You have this autobahn product open sourced somewhere? Would be if we could experiment a little with your work!
> 
> Cheers,
> Pablo
> 
> On Wed, Oct 10, 2012 at 3:40 PM, Srdan Kvrgic <srdan at burtcorp.com> wrote:
> Hi all,
> 
> The itch:
> The rabbitmq driver connects and sends message to only one of the rabbitmq instances in a cluster limiting performance at high speeds due to inter-instance message forwarding.
> 
> The background:
> We've been using rabbitmq for a long time now and with the 2.8 release it's become cemented as an integral part of our system. It's great. The thing is, we send a lot of messages through the system - thousands a second. And we use multiple queues over a cluster of rabbitmq servers. The problem with that is that the driver will only connect to one of the rabbitmq instances and rely on the cluster to forward messages to queues hosted on the other instance.
> 
> Let me put it to you this way. Assume we have a cluster (MQ1, MQ2) with two queues (fragments1, fragments2) under same exchange. The client connects to MQ1.
> 
> If the client wants to send a message to fragments 1, the message will be sent by client and received and routed by MQ1.
> 
> On the other hand, if the client wants to post a message on fragments2, MQ1 will have to forward the message to MQ2 which means the message will be sent from client, received by MQ1, sent by MQ1 and received and routed by MQ2.
> 
> This is a neat solution but when running at high speed it becomes a bottleneck. So, we created autobahn which is a jruby transport layer wrapper that automatically connects to all MQ instances and sends the message to the server that hosts the queue. That gave us a massive boost in throughput. Yey us.
> 
> So why am I on the figurative soap-box? The problem's solved, right? Why am I not on a beach under an umbrella wearing a stupid-ass hat and sipping on a Bahama-mama? Well.. The throughput improvement was so substantial that I couldn't help feeling this should be the driver's default behavior.
> 
> Right?
> 
> Is anything like this planned? Are we the only ones who've encountered this? It wasn't very tricky to implement really..
> 
> Kind regards,
> Srdan
> 
> 
> --
> Srdan Urban Kvrgic
> LABS, Burt
> 
> www.burtcorp.com
> http://twitter.com/srdan | http://twitter.com/burtcorp
> ???????????????????????????????????????????
> The Analytics Platform for Online Media
> 
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

--
Srdan Urban Kvrgic
LABS, Burt
+46 70 432 2472

www.burtcorp.com
http://twitter.com/srdan | http://twitter.com/burtcorp
???????????????????????????????????????????
The Analytics Platform for Online Media






-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/8e199a3d/attachment.htm>

From ymmudym at gmail.com  Thu Oct 11 16:40:39 2012
From: ymmudym at gmail.com (ymmud ym)
Date: Thu, 11 Oct 2012 21:10:39 +0530
Subject: [rabbitmq-discuss] ymmudym@gmail.com
Message-ID: <CAF6AHhUMzj1+NLWJ0Uf3qsjH4do9MTji8wxreNsEPnAxuqzT=g@mail.gmail.com>

ymmudym at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/8e46d843/attachment.htm>

From ymmudym at gmail.com  Thu Oct 11 16:41:28 2012
From: ymmudym at gmail.com (vedanth)
Date: Thu, 11 Oct 2012 08:41:28 -0700 (PDT)
Subject: [rabbitmq-discuss] Messages not being delivered to the queue(but
 sender shows 'Message sent')
Message-ID: <1349970088288-22502.post@n5.nabble.com>

Hi Everyone
           Am new to rabbit mq. I just installed rabbit mq
(rabbitmq-server-2.8.7-1.noarch.rpm, able to start rabbit mq
successfully)and started with some sample java programs as suggested in
*http://www.rabbitmq.com/tutorials/tutorial-one-java.html*.
 
Once i execute the Send class i get a message "/[x] Sent 'Hello World!/'".
On the other terminal whien i start the Recv it just shows "/[*] Waiting for
messages. To exit press CTRL+C/" but does not receive any messages which is
sent.

Also when i check 
>*rabbitmqctl list_queues name messages_ready messages_unacknowledged
messages durable*
It shows the queue without any messages:

*Listing queues ...
hello   0       0       0       false
...done.
*

Any solutions on this problem would be of great help.

Thanks in advance...




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Messages-not-being-delivered-to-the-queue-but-sender-shows-Message-sent-tp22502.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From g.kishore at gmail.com  Thu Oct 11 16:47:43 2012
From: g.kishore at gmail.com (kishore g)
Date: Thu, 11 Oct 2012 08:47:43 -0700
Subject: [rabbitmq-discuss] Rabbitmq consumer grouping
In-Reply-To: <CABaj-QY6A_H1RQfw=x3nE8Ffb-3T+hVAvk7SncyAW8REee2xLA@mail.gmail.com>
References: <CABaj-Qb9RN39vBmPzySXWEhZi5--GNDstzUSy5zPpo2kMbRx4g@mail.gmail.com>
	<50767A18.10309@rabbitmq.com>
	<CABaj-QY6A_H1RQfw=x3nE8Ffb-3T+hVAvk7SncyAW8REee2xLA@mail.gmail.com>
Message-ID: <CABaj-QaPo_QjTTRyvkJ9Bg9rpdznX7gf8KmOBmR9UDe-fJqy6w@mail.gmail.com>

+list

On Thu, Oct 11, 2012 at 8:46 AM, kishore g <g.kishore at gmail.com> wrote:
> Thanks Matthias,
>
> I was not aware of consumer load balancing feature, does it assign
> each queue to one consumer or any consumers will consume from any
> queue. I was talking about a case where the queues(partitions) are
> divided among the consumers. Lets say the consumers want to do some
> aggregation on a key, then it would be better if all messages for a
> given key go to one consumer. Does it make sense?
>
> Thanks,
> Kishore G
>
> On Thu, Oct 11, 2012 at 12:49 AM, Matthias Radestock
> <matthias at rabbitmq.com> wrote:
>> Kishore,
>>
>>
>> On 10/10/12 19:38, kishore g wrote:
>>>
>>> I am writing this email to get feedback about a rabbitmq consumer
>>> group. We developed this recipe using Helix, a generic cluster
>>> management system which we open sourced yesterday. In order to
>>> demonstrate the ease of developing applications with Helix, we chose
>>> to write a rabbitmq-consumer-group.
>>>
>>> You can find more info about that here
>>>
>>> https://github.com/linkedin/helix/wiki/Sample_App
>>>
>>> It would be great if you can provide feedback about this app.
>>
>>
>> That looks pretty interesting.
>>
>> One question: wouldn't you get the same failure-handling and scaling
>> behaviour by having all consumers consume from all queues? RabbitMQ's own
>> consumer load balancing should ensure that messages are distributed fairly
>> to consumers in such a set up.
>>
>> Regards,
>>
>> Matthias.

From michael.s.klishin at gmail.com  Thu Oct 11 18:22:35 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 11 Oct 2012 21:22:35 +0400
Subject: [rabbitmq-discuss] A non-AMQP exit
Message-ID: <CAE3HoVRF3zm60ECtSL3ztR_=kC7WMx7RsJs2J=LqGu+jcYYv=w@mail.gmail.com>

While verifying a fix for amq-client today, I've noticed that a couple of
amqp gem examples that
previously passed no longer do. One of them is

https://github.com/ruby-amqp/amqp/blob/6c3774efe71bd65e18a45fbd4511b3104a5d2dd7/spec/integration/multiple_consumers_per_queue_spec.rb#L263-319

Here's what the log (rabbitmq-server 2.8.7) reveals:
https://gist.github.com/fa2f90216c4587a82cca

Function in question is
https://gist.github.com/61951978dab3b7e742df

I am not sure how to track it down without building rabbit from source. The
test uses the immediate flag so
we will remove it anyway but I thought I should post this here.

If this looks like something serious, I can build rabbit from source, add
more logging and try again.

Thanks,
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/6bd54304/attachment.htm>

From michael.s.klishin at gmail.com  Thu Oct 11 20:03:36 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 11 Oct 2012 23:03:36 +0400
Subject: [rabbitmq-discuss] ANN amqp gem 0.9.8 is released
Message-ID: <CAE3HoVQ6x0zdQo+ijHtoe4=g_O2_5Z-PgHKcEzQgT3KZLi51dw@mail.gmail.com>

amqp gem 0.9.8 is released to rubygems.org [1].

This is a bug fix release:

 * Passwords are now filtered out in connection exception messages.
Contributed by Tobias Schmidt.
 * When the broker closes a channel, amqp gem now properly acknowledges it
with channel.close-ok, see [2].
   Kudos to James Keane for reporting the issue.

1. https://rubygems.org/gems/amqp/versions/0.9.8
2. https://github.com/rabbitmq/rabbitmq-server/issues/10
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/9594c2ef/attachment.htm>

From dwaynecampbell13 at gmail.com  Thu Oct 11 13:14:25 2012
From: dwaynecampbell13 at gmail.com (Dwayne Campbell)
Date: Thu, 11 Oct 2012 05:14:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Disable Per-Connection Flow Control
Message-ID: <9672780c-6a7b-4ef2-91fe-97ec82b2fb2c@googlegroups.com>

Hi Guys,

RabbitMQ now turns on flow control often even at 1.5 MB/s.  I have read 
before to increase the TCP buffer size, however I do not have access to 
increase the TCP buffer size o the machines.

How can i disable Per-Connection Flow Control ?   Memory based  and Disk 
based control is enough for me.

The consumers are consuming the messages according to the at about the same 
rate or greater as  they are being published.

Quick Server Spec

16GB RAM 
2 Cores

Using 2.8.7

--
Dwayne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/682158eb/attachment.htm>

From matthias at rabbitmq.com  Thu Oct 11 21:15:56 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 11 Oct 2012 21:15:56 +0100
Subject: [rabbitmq-discuss] A non-AMQP exit
In-Reply-To: <CAE3HoVRF3zm60ECtSL3ztR_=kC7WMx7RsJs2J=LqGu+jcYYv=w@mail.gmail.com>
References: <CAE3HoVRF3zm60ECtSL3ztR_=kC7WMx7RsJs2J=LqGu+jcYYv=w@mail.gmail.com>
Message-ID: <507728FC.5000700@rabbitmq.com>

Michael,

On 11/10/12 18:22, Michael Klishin wrote:
> While verifying a fix for amq-client today, I've noticed that a
> couple of amqp gem examples that previously passed no longer do. One
> of them is
>
> https://github.com/ruby-amqp/amqp/blob/6c3774efe71bd65e18a45fbd4511b3104a5d2dd7/spec/integration/multiple_consumers_per_queue_spec.rb#L263-319
>
>  Here's what the log (rabbitmq-server 2.8.7) reveals:
> https://gist.github.com/fa2f90216c4587a82cca
>
> Function in question is https://gist.github.com/61951978dab3b7e742df

The most likely reason is a client sending a basic.consume and following 
that up straight away with a basic.cancel w/o waiting for the 
basic.consume_ok first. Such pipelining of synchronous commands is not 
permitted by the spec.

Regards,

Matthias.

From prabodh.upreti at vce.com  Thu Oct 11 21:24:40 2012
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Thu, 11 Oct 2012 13:24:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit CAS(Central Authentication Service)
	integration
In-Reply-To: <1349964835117-22498.post@n5.nabble.com>
References: <1349811603124-22452.post@n5.nabble.com>
	<507543E8.7000604@rabbitmq.com>
	<20121010134540.GV10330@data.it.su.se>
	<5075A1EA.5020507@rabbitmq.com>
	<1349893961236-22477.post@n5.nabble.com>
	<1349964835117-22498.post@n5.nabble.com>
Message-ID: <1349987080415-22510.post@n5.nabble.com>

Ok, I have decided to build something similar to 

rabbitmq-auth-backend-http   found in github.  Simon I think you wrote that.
Is this a good option?

One question I had is it looks like I need to get the whole rabbitsource and
build it. Is that really necessary? thank you.

regards



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbit-CAS-Central-Authentication-Service-integration-tp22452p22510.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Thu Oct 11 21:46:14 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 11 Oct 2012 21:46:14 +0100
Subject: [rabbitmq-discuss] rabbitmqctl list_connections hanging
In-Reply-To: <CAFaaYAYr8jH6iZOQjW+WAOUM3Mi9Tc8AGLz7UYF0UCJi7mZCSA@mail.gmail.com>
References: <54308ebf-a80d-4e85-9bb8-a1ab86a66af8@googlegroups.com>
	<507345DA.4040601@rabbitmq.com>
	<CAFaaYAbtHjhgY+33=5tQRqKTesajbL3PH7Q1GumqdMaauh0oKA@mail.gmail.com>
	<50734FA5.8080909@rabbitmq.com>
	<CAFaaYAZB=fY=rsvaJN1E8pLceRMOEriQMRPLNJxzZPecce1biA@mail.gmail.com>
	<5073A65E.9010709@rabbitmq.com>
	<CAFaaYAZ2CZvGJ5g3zsQmDdh1kqZAF8KK8MmeLB4VOy+-M+SJfg@mail.gmail.com>
	<50759920.3020903@rabbitmq.com>
	<CAFaaYAYr8jH6iZOQjW+WAOUM3Mi9Tc8AGLz7UYF0UCJi7mZCSA@mail.gmail.com>
Message-ID: <50773016.8070709@rabbitmq.com>

Doug,

(putting the list back on cc)

the results of the endoscopy of your rabbit is that the hanging 
'rabbitmqctl list_connections' is caused by a bug we fixed in 2.8.7 
("fix possible deadlock during broker shutdown" in the release notes, 
but it turns out this can also affect connection closure). So I suggest 
you upgrade.


Regards,

Matthias.

From jerryk at rbcon.com  Thu Oct 11 22:10:21 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Thu, 11 Oct 2012 14:10:21 -0700
Subject: [rabbitmq-discuss] Rabbit CAS(Central Authentication Service)
	integration
In-Reply-To: <1349987080415-22510.post@n5.nabble.com>
References: <1349811603124-22452.post@n5.nabble.com>
	<507543E8.7000604@rabbitmq.com>
	<20121010134540.GV10330@data.it.su.se>
	<5075A1EA.5020507@rabbitmq.com>
	<1349893961236-22477.post@n5.nabble.com>
	<1349964835117-22498.post@n5.nabble.com>
	<1349987080415-22510.post@n5.nabble.com>
Message-ID: <CAE0Sz=x8LisGRkvo5SW5fpXPCUNStN=ZLk50GerJ__sSEw9yGQ@mail.gmail.com>

Hi, Prabodh:

Developing RabbitMQ plugins does require you to check out a decent amount
of Rabbit source so that you have necessary include files and the like.

There's a nice description, along with a step by step, worked example in
sections 12.2 and 12.3 of "RabbitMQ in Action."

http://www.manning.com/videla/


Do note that this will involve learning and writing some Erlang code.

Best regards,
Jerry

On Thu, Oct 11, 2012 at 1:24 PM, Prabodh Upreti <prabodh.upreti at vce.com>wrote:

> Ok, I have decided to build something similar to
>
> rabbitmq-auth-backend-http   found in github.  Simon I think you wrote
> that.
> Is this a good option?
>
> One question I had is it looks like I need to get the whole rabbitsource
> and
> build it. Is that really necessary? thank you.
>
> regards
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Rabbit-CAS-Central-Authentication-Service-integration-tp22452p22510.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/52d2eb5c/attachment.htm>

From saibabu.maddineni at gmail.com  Thu Oct 11 22:18:24 2012
From: saibabu.maddineni at gmail.com (saibabu maddineni)
Date: Thu, 11 Oct 2012 14:18:24 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbbitMQ and Biztalk Port
Message-ID: <9524c212-3d70-40c5-83e2-ebe92b3fa5be@googlegroups.com>

Hi,
 

*
http://social.technet.microsoft.com/wiki/contents/articles/7401.biztalk-and-rabbitmq.aspx
*<http://social.technet.microsoft.com/wiki/contents/articles/7401.biztalk-and-rabbitmq.aspx>

 
I followed above link to configure rabbmitmq in Biztalk, but nothing 
happend. 

I am trying implement RabbitMQ using Biztalk. My requirement is send 
message to Que and receiving message from Que. I already setup rabbitmq in 
Biztalk with the help of article. When I drop the message in biztalk side 
its not failing but in Que I don?t see any messages.

 
Can you please specify the what needs to be done for this. Below are the 
settings I am using, Mytest que is predefine Q. do I need to specify any 
thing on that action section and section is binding section please suggest.
 
please see the Biztalk configure attachment, please suggest how to use 
RabbitMQ in Biztalk while receving and sending message from and to.
 
 
 

Appreciate for early response.

 

I am stuck on the middle please help me on this issue.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/df7e2be5/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: BT1.png
Type: image/x-png
Size: 9492 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/df7e2be5/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: BT2.png
Type: image/x-png
Size: 13083 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/df7e2be5/attachment-0001.bin>

From matthias at rabbitmq.com  Thu Oct 11 22:20:27 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 11 Oct 2012 22:20:27 +0100
Subject: [rabbitmq-discuss] Rabbitmq consumer grouping
In-Reply-To: <CABaj-QaPo_QjTTRyvkJ9Bg9rpdznX7gf8KmOBmR9UDe-fJqy6w@mail.gmail.com>
References: <CABaj-Qb9RN39vBmPzySXWEhZi5--GNDstzUSy5zPpo2kMbRx4g@mail.gmail.com>
	<50767A18.10309@rabbitmq.com>
	<CABaj-QY6A_H1RQfw=x3nE8Ffb-3T+hVAvk7SncyAW8REee2xLA@mail.gmail.com>
	<CABaj-QaPo_QjTTRyvkJ9Bg9rpdznX7gf8KmOBmR9UDe-fJqy6w@mail.gmail.com>
Message-ID: <5077381B.90804@rabbitmq.com>

On 11/10/12 16:47, kishore g wrote:
>> I was not aware of consumer load balancing feature, does it assign
>> each queue to one consumer or any consumers will consume from any
>> queue.

The latter, and tcp backpressure from consumers, or, if basic.qos 
prefetch is set, the flow of acks, affects the selection of a consumer 
for a message and thus balances the load.

>> I was talking about a case where the queues(partitions) are
>> divided among the consumers. Lets say the consumers want to do some
>> aggregation on a key, then it would be better if all messages for a
>> given key go to one consumer. Does it make sense?

I see. You are right, that is not something that rabbitmq supports 
directly. It's been on our todo list for a while and we get asked about 
it occasionally.

Regards,

Matthias.

From wongkamhoong at gmail.com  Fri Oct 12 03:50:04 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Fri, 12 Oct 2012 10:50:04 +0800
Subject: [rabbitmq-discuss] How to change TTL after declared queue
Message-ID: <CAHv8OSQMAhrVZLddvPbXR_Osioxe=urRnMU0ZfLJoO-aEx4KCw@mail.gmail.com>

Hi RabbitMQ Team,

How can I change the TTL of the queues declared? Do I need to remove the
existing queues and redeclare them? Or there is other way to update the TTL
without remove them?

Regards,
Wong
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121012/34ec08e0/attachment.htm>

From michael.s.klishin at gmail.com  Fri Oct 12 03:52:55 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 12 Oct 2012 06:52:55 +0400
Subject: [rabbitmq-discuss] How to change TTL after declared queue
In-Reply-To: <CAHv8OSQMAhrVZLddvPbXR_Osioxe=urRnMU0ZfLJoO-aEx4KCw@mail.gmail.com>
References: <CAHv8OSQMAhrVZLddvPbXR_Osioxe=urRnMU0ZfLJoO-aEx4KCw@mail.gmail.com>
Message-ID: <CAE3HoVSMJgmKViXv1oyXNFBQqxqr2KX8tF99UzPTNKatC4kqKw@mail.gmail.com>

2012/10/12 Wong Kam Hoong <wongkamhoong at gmail.com>

> How can I change the TTL of the queues declared? Do I need to remove the
> existing queues and redeclare them?


Correct.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121012/31b1647f/attachment.htm>

From wongkamhoong at gmail.com  Fri Oct 12 04:24:42 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Fri, 12 Oct 2012 11:24:42 +0800
Subject: [rabbitmq-discuss] How to change TTL after declared queue
In-Reply-To: <CAE3HoVSMJgmKViXv1oyXNFBQqxqr2KX8tF99UzPTNKatC4kqKw@mail.gmail.com>
References: <CAHv8OSQMAhrVZLddvPbXR_Osioxe=urRnMU0ZfLJoO-aEx4KCw@mail.gmail.com>
	<CAE3HoVSMJgmKViXv1oyXNFBQqxqr2KX8tF99UzPTNKatC4kqKw@mail.gmail.com>
Message-ID: <CAHv8OSTOdKdA23QxFsgmiO+yPo1UVxzY_hVCwEESJf=+Fk7Kow@mail.gmail.com>

Hi Michael,

Noted, thanks!

Regards,
Wong

On Fri, Oct 12, 2012 at 10:52 AM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2012/10/12 Wong Kam Hoong <wongkamhoong at gmail.com>
>
>> How can I change the TTL of the queues declared? Do I need to remove the
>> existing queues and redeclare them?
>
>
> Correct.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121012/e3a2191b/attachment.htm>

From wongkamhoong at gmail.com  Fri Oct 12 09:17:50 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Fri, 12 Oct 2012 16:17:50 +0800
Subject: [rabbitmq-discuss] Message TTL
Message-ID: <CAHv8OSQhiyRew_8hiod-v0M+bKpYwicXAJedC-PU-S8K_6nBVw@mail.gmail.com>

Hi RabbitMQ Team,

A quick question, currently I'm using the "x-message-ttl" during queue
declaration, as far as I know the TTL will restrict how long time the
message produced can survive in the queue. If I didn't set the parameter,
what will happen to the messages produced to the queue? They will forever
retain in the queue as long as nobody consume them?

Regards,
Wong
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121012/fb9eb428/attachment.htm>

From francesco at rabbitmq.com  Fri Oct 12 09:25:23 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 12 Oct 2012 09:25:23 +0100
Subject: [rabbitmq-discuss] Message TTL
In-Reply-To: <CAHv8OSQhiyRew_8hiod-v0M+bKpYwicXAJedC-PU-S8K_6nBVw@mail.gmail.com>
References: <CAHv8OSQhiyRew_8hiod-v0M+bKpYwicXAJedC-PU-S8K_6nBVw@mail.gmail.com>
Message-ID: <87mwzs2j2k.wl%francesco@rabbitmq.com>

At Fri, 12 Oct 2012 16:17:50 +0800,
Wong Kam Hoong wrote:
> A quick question, currently I'm using the "x-message-ttl" during queue
> declaration, as far as I know the TTL will restrict how long time the
> message produced can survive in the queue. If I didn't set the parameter,
> what will happen to the messages produced to the queue? They will forever
> retain in the queue as long as nobody consume them?

Yes, that's correct.

--
Francesco * Often in error, never in doubt

From a.shneyderman at gmail.com  Fri Oct 12 09:36:50 2012
From: a.shneyderman at gmail.com (Alex Shneyderman)
Date: Fri, 12 Oct 2012 10:36:50 +0200
Subject: [rabbitmq-discuss] Tracer tool question.
Message-ID: <CA+smePLihcc64CTHF6Bbxim_WHS9tV3KKQbMj3xYZu1UxCrAkg@mail.gmail.com>

Hello, everyone!

I am using java client (v 2.8.4) and I am trying to setup Tracer tool.
I run local client that connects to the remote rabbit server (to which
I connect with username and password). Now as far as I understood
tracer allows me to point to the target server while listening on
localhost's port 5673. Then my client connects to the localhost:5673
and tracer makes connection to the remote host and start logging the
conversation between my client and remote rabbit.

Now, I started Tracer and trying to connect my client to it does not
seem to work. I get errors on the client side telling me

Caused by: java.net.ConnectException: Connection refused
	at java.net.PlainSocketImpl.socketConnect(Native Method)
	at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:351)
	at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:213)
	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:200)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:432)
	at java.net.Socket.connect(Socket.java:529)
	at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:445)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:504)
	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:545)
	at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:160)
	... 7 more

Tracer's logs are empty.

Anyone knows what is going on and how can I make tracer work for me?

Cheers,
Alex.

From wongkamhoong at gmail.com  Fri Oct 12 09:38:57 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Fri, 12 Oct 2012 16:38:57 +0800
Subject: [rabbitmq-discuss] Message TTL
In-Reply-To: <87mwzs2j2k.wl%francesco@rabbitmq.com>
References: <CAHv8OSQhiyRew_8hiod-v0M+bKpYwicXAJedC-PU-S8K_6nBVw@mail.gmail.com>
	<87mwzs2j2k.wl%francesco@rabbitmq.com>
Message-ID: <CAHv8OSST=RWhKfwwc9taTZWPnuWK1qrc_cDvu9P3J-NxFxDPYA@mail.gmail.com>

Hi Francesco,

Thanks for confirmation!

Best Regards,
Wong

On Fri, Oct 12, 2012 at 4:25 PM, Francesco Mazzoli
<francesco at rabbitmq.com>wrote:

> At Fri, 12 Oct 2012 16:17:50 +0800,
> Wong Kam Hoong wrote:
> > A quick question, currently I'm using the "x-message-ttl" during queue
> > declaration, as far as I know the TTL will restrict how long time the
> > message produced can survive in the queue. If I didn't set the parameter,
> > what will happen to the messages produced to the queue? They will forever
> > retain in the queue as long as nobody consume them?
>
> Yes, that's correct.
>
> --
> Francesco * Often in error, never in doubt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121012/0e5b29b7/attachment.htm>

From tim at rabbitmq.com  Fri Oct 12 09:42:32 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 12 Oct 2012 09:42:32 +0100
Subject: [rabbitmq-discuss] Tracer tool question.
In-Reply-To: <CA+smePLihcc64CTHF6Bbxim_WHS9tV3KKQbMj3xYZu1UxCrAkg@mail.gmail.com>
References: <CA+smePLihcc64CTHF6Bbxim_WHS9tV3KKQbMj3xYZu1UxCrAkg@mail.gmail.com>
Message-ID: <5077D7F8.2060409@rabbitmq.com>

Alex,

Once you've started Tracer up, is the port open and listening correctly 
(e.g., can you see it using netstat) and is it accessible from the 
client application - can you telnet to it for example? These would be 
the first port of call I suspect.

On 10/12/2012 09:36 AM, Alex Shneyderman wrote:
> Hello, everyone!
>
> I am using java client (v 2.8.4) and I am trying to setup Tracer tool.
> I run local client that connects to the remote rabbit server (to which
> I connect with username and password). Now as far as I understood
> tracer allows me to point to the target server while listening on
> localhost's port 5673. Then my client connects to the localhost:5673
> and tracer makes connection to the remote host and start logging the
> conversation between my client and remote rabbit.
>
> Now, I started Tracer and trying to connect my client to it does not
> seem to work. I get errors on the client side telling me
>
> Caused by: java.net.ConnectException: Connection refused
> 	at java.net.PlainSocketImpl.socketConnect(Native Method)
> 	at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:351)
> 	at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:213)
> 	at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:200)
> 	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:432)
> 	at java.net.Socket.connect(Socket.java:529)
> 	at com.rabbitmq.client.ConnectionFactory.createFrameHandler(ConnectionFactory.java:445)
> 	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:504)
> 	at com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:545)
> 	at org.springframework.amqp.rabbit.connection.AbstractConnectionFactory.createBareConnection(AbstractConnectionFactory.java:160)
> 	... 7 more
>
> Tracer's logs are empty.
>
> Anyone knows what is going on and how can I make tracer work for me?
>
> Cheers,
> Alex.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Fri Oct 12 10:13:58 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 12 Oct 2012 10:13:58 +0100
Subject: [rabbitmq-discuss] RabbbitMQ and Biztalk Port
In-Reply-To: <9524c212-3d70-40c5-83e2-ebe92b3fa5be@googlegroups.com>
References: <9524c212-3d70-40c5-83e2-ebe92b3fa5be@googlegroups.com>
Message-ID: <5077DF56.9060502@rabbitmq.com>

Hi,

On 11/10/12 22:18, saibabu maddineni wrote:
> but nothing happend.
> I don?t see any messages.

I'm afraid this is not enough information to diagnose your problem. I
would suggest validating the infrastructure with something simpler
first, e.g. do the RabbitMQ WCF tests pass? Has the author of the
article you referred to had any suggestions?


-Emile




From ymmudym at gmail.com  Thu Oct 11 16:35:44 2012
From: ymmudym at gmail.com (vedanth)
Date: Thu, 11 Oct 2012 08:35:44 -0700 (PDT)
Subject: [rabbitmq-discuss] Messages not being delivered to the queue(but
 sender shows 'Message sent')
Message-ID: <1349969744701-22501.post@n5.nabble.com>

Hi Everyone           Am new to rabbit mq. I just installed rabbit mq
(rabbitmq-server-2.8.7-1.noarch.rpm, able to start rabbit mq
successfully)and started with some sample java programs as suggested in
*http://www.rabbitmq.com/tutorials/tutorial-one-java.html*. Once i execute
the Send class i get a message "/[x] Sent 'Hello World!/'". On the other
terminal whien i start the Recv it just shows "/[*] Waiting for messages. To
exit press CTRL+C/" but does not receive any messages which is sent.Also
when i check >*rabbitmqctl list_queues name messages_ready
messages_unacknowledged messages durable*It shows the queue without any
messages:*Listing queues ...hello   0       0       0      
false...done.*Any solutions on this problem would be of great help.Thanks in
advance...



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Messages-not-being-delivered-to-the-queue-but-sender-shows-Message-sent-tp22501.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121011/41d3dd1a/attachment.htm>

From tim at rabbitmq.com  Fri Oct 12 11:02:02 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 12 Oct 2012 11:02:02 +0100
Subject: [rabbitmq-discuss] Messages not being delivered to the
 queue(but sender shows 'Message sent')
In-Reply-To: <1349970088288-22502.post@n5.nabble.com>
References: <1349970088288-22502.post@n5.nabble.com>
Message-ID: <5077EA9A.5030600@rabbitmq.com>

Hi Vedanth,

Can you execute the command `rabbitmqctl report` against your broker and 
post the output please? Are you by any chance running rabbitmq in an 
environment with a limited amount of memory? This situation can occur 
when the mounted file system rabbit is running on has very little 
memory: the broker starts and almost immediately the disk alarm goes 
off, which prevents you from using rabbit (as producers become blocked 
until we've managed to reclaim enough disk space to handle throughput 
properly).

Cheers,
Tim

On 10/11/2012 04:41 PM, vedanth wrote:
> Hi Everyone
>             Am new to rabbit mq. I just installed rabbit mq
> (rabbitmq-server-2.8.7-1.noarch.rpm, able to start rabbit mq
> successfully)and started with some sample java programs as suggested in
> *http://www.rabbitmq.com/tutorials/tutorial-one-java.html*.
>
> Once i execute the Send class i get a message "/[x] Sent 'Hello World!/'".
> On the other terminal whien i start the Recv it just shows "/[*] Waiting for
> messages. To exit press CTRL+C/" but does not receive any messages which is
> sent.
>
> Also when i check
>> *rabbitmqctl list_queues name messages_ready messages_unacknowledged
> messages durable*
> It shows the queue without any messages:
>
> *Listing queues ...
> hello   0       0       0       false
> ...done.
> *
>
> Any solutions on this problem would be of great help.
>
> Thanks in advance...
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Messages-not-being-delivered-to-the-queue-but-sender-shows-Message-sent-tp22502.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Fri Oct 12 11:17:40 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 12 Oct 2012 11:17:40 +0100
Subject: [rabbitmq-discuss] Messages not being delivered to the
 queue(but sender shows 'Message sent')
In-Reply-To: <1349970088288-22502.post@n5.nabble.com>
References: <1349970088288-22502.post@n5.nabble.com>
Message-ID: <5077EE44.2050106@rabbitmq.com>

Hi,

On 11/10/12 16:41, vedanth wrote:
> Any solutions on this problem would be of great help.

You should check the logfile which will probably contain a message about
running out of disk space. By default the broker requires 1Gb free
space. You can either supply more disk space or lower the limit. See the
configuration file documentation on how to do that:
http://www.rabbitmq.com/configure.html
paying attention to the "disk_free_limit" setting.


-Emile

From tim at rabbitmq.com  Fri Oct 12 11:23:53 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 12 Oct 2012 11:23:53 +0100
Subject: [rabbitmq-discuss] Reg: Total Transfers
In-Reply-To: <8A9DF2095351E74AB39CF6BF78F20CC904F5A0F1@L00EXCEC1.zl.if.atcsg.net>
References: <8A9DF2095351E74AB39CF6BF78F20CC904F5A0F1@L00EXCEC1.zl.if.atcsg.net>
Message-ID: <5077EFB9.4010109@rabbitmq.com>

On 10/11/2012 03:25 PM, Ramachandrarao, K [ SGGI - IT ] wrote:
>
> Dear Team,
>
> We are new to RabbitMQ. We are using the Version 2.8.4 and the Client 
> is Python 2.7
>
> Could anybody help us on the Following points.
>
> 1.How to check the total messages transferred via Exchange or a Queue 
> for a Period.
>
> a.Ex. Today  there is X number of Message are published and X numbers 
> are received (Message transfer statistics)
>

You could do this in a number of ways. I would suggest looking at the 
management plugin (http://www.rabbitmq.com/management.html) which will 
provides statistics for queue length, message rates globally and per 
channel, data rates per connection, etc.

> 2.How to configure the Flow Control, and Charts in RabbitMQ.
>

I'm not sure what you mean by configuring Charts. There are instructions 
explaining how to configure Memory based Flow Control on the website at 
http://www.rabbitmq.com/memory.html.

> 3.How to add  a new tracing log automatically.
>

Again, I'm not entirely sure what you're asking here. If you're talking 
about tracing using the fire-hose tracer plugin, then the instructions 
are available at http://www.rabbitmq.com/firehose.html. If you want to 
automate this task, then you can do so in a number of ways. The 
management plugin has a REST API that you can use to query for 
information. The rabbitmqctl script can obviously be invoked via 
whatever command line tools integration is available to you, if you so 
wish. Is this what you're asking about?

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121012/980685d0/attachment.htm>

From Ramachandrarao.K at saint-gobain.com  Fri Oct 12 11:46:10 2012
From: Ramachandrarao.K at saint-gobain.com (Ramachandrarao, K [ SGGI - IT ])
Date: Fri, 12 Oct 2012 16:16:10 +0530
Subject: [rabbitmq-discuss] Reg: Total Transfers
In-Reply-To: <5077EFB9.4010109@rabbitmq.com>
References: <8A9DF2095351E74AB39CF6BF78F20CC904F5A0F1@L00EXCEC1.zl.if.atcsg.net>
	<5077EFB9.4010109@rabbitmq.com>
Message-ID: <8A9DF2095351E74AB39CF6BF78F20CC904F5A7A6@L00EXCEC1.zl.if.atcsg.net>

Dear Tim,

 

Thanks for the information, we will try this and revert back for any
quires.

 

Thanks and Regards

 

Ramachandra Rao K

From: Tim Watson [mailto:tim at rabbitmq.com] 
Sent: Friday, October 12, 2012 3:54 PM
To: Discussions about RabbitMQ
Cc: Ramachandrarao, K [ SGGI - IT ]
Subject: Re: [rabbitmq-discuss] Reg: Total Transfers

 

On 10/11/2012 03:25 PM, Ramachandrarao, K [ SGGI - IT ] wrote: 

Dear Team,

 

We are new to RabbitMQ. We are using the Version 2.8.4 and the Client is
Python 2.7 

 

Could anybody help us on the Following points.

 

1.       How to check the total messages transferred via Exchange or a
Queue for a Period. 

Ex. Today  there is X number of Message are published and X numbers are
received (Message transfer statistics)


You could do this in a number of ways. I would suggest looking at the
management plugin (http://www.rabbitmq.com/management.html) which will
provides statistics for queue length, message rates globally and per
channel, data rates per connection, etc. 




How to configure the Flow Control, and Charts in RabbitMQ.


I'm not sure what you mean by configuring Charts. There are instructions
explaining how to configure Memory based Flow Control on the website at
http://www.rabbitmq.com/memory.html.




2.       How to add  a new tracing log automatically.

 


Again, I'm not entirely sure what you're asking here. If you're talking
about tracing using the fire-hose tracer plugin, then the instructions
are available at http://www.rabbitmq.com/firehose.html. If you want to
automate this task, then you can do so in a number of ways. The
management plugin has a REST API that you can use to query for
information. The rabbitmqctl script can obviously be invoked via
whatever command line tools integration is available to you, if you so
wish. Is this what you're asking about?

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121012/efc6f375/attachment.htm>

From simon at rabbitmq.com  Fri Oct 12 12:14:16 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 12 Oct 2012 12:14:16 +0100
Subject: [rabbitmq-discuss] Disable Per-Connection Flow Control
In-Reply-To: <9672780c-6a7b-4ef2-91fe-97ec82b2fb2c@googlegroups.com>
References: <9672780c-6a7b-4ef2-91fe-97ec82b2fb2c@googlegroups.com>
Message-ID: <5077FB88.6060208@rabbitmq.com>

On 11/10/12 13:14, Dwayne Campbell wrote:
> Hi Guys,
>
> RabbitMQ now turns on flow control often even at 1.5 MB/s.  I have read
> before to increase the TCP buffer size, however I do not have access to
> increase the TCP buffer size o the machines.
>
> How can i disable Per-Connection Flow Control ?   Memory based  and Disk
> based control is enough for me.

Hi. You should be aware that the flow control is indicating that some 
part of the message pipeline is overloaded. If you were to turn off flow 
control it would just lead to messages backing up ahead of that part of 
the pipeline - leading to memory use ballooning very rapidly and no 
increase in throughput.

If you are sending lots of tiny messages then the routing part of the 
pipeline can be the most expensive - my workstation manages only about 
2.5MB/s with zero-length messages.

The advice about increasing the buffer size is to allow your machine to 
handle short bursts of messages, at higher rates than it can manage in a 
steady state. It won't get you a higher steady state rate.

To process messages faster on a single machine you might enable HiPE 
compilation: see http://www.rabbitmq.com/configure.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ward.mark at gmail.com  Fri Oct 12 15:07:16 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Fri, 12 Oct 2012 07:07:16 -0700 (PDT)
Subject: [rabbitmq-discuss] bug descriptions
Message-ID: <b7992c4d-14b4-4fed-b7f6-e76f52d96dfa@googlegroups.com>

Hi,

I have found a thread where the issue tracker is private but I am wondering 
is there a way to find out what a bug was when it has been fixed and merged 
into a release?  There is a new release of the .net client and I see it has 
a few bug fix branches but I have not been able to track down a description 
on the bugs.

-Mark

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121012/1232cf87/attachment.htm>

From simon at rabbitmq.com  Fri Oct 12 15:16:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 12 Oct 2012 15:16:41 +0100
Subject: [rabbitmq-discuss] bug descriptions
In-Reply-To: <b7992c4d-14b4-4fed-b7f6-e76f52d96dfa@googlegroups.com>
References: <b7992c4d-14b4-4fed-b7f6-e76f52d96dfa@googlegroups.com>
Message-ID: <50782649.4000104@rabbitmq.com>

On 12/10/12 15:07, Mark Ward wrote:
> I have found a thread where the issue tracker is private but I am
> wondering is there a way to find out what a bug was when it has been
> fixed and merged into a release?  There is a new release of the .net
> client and I see it has a few bug fix branches but I have not been able
> to track down a description on the bugs.

We post release notes for each release, listing all bug fixes and new 
features. These can be obtained from:

http://www.rabbitmq.com/changelog.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From prabodh.upreti at vce.com  Fri Oct 12 15:19:41 2012
From: prabodh.upreti at vce.com (Prabodh Upreti)
Date: Fri, 12 Oct 2012 07:19:41 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit CAS(Central Authentication Service)
	integration
In-Reply-To: <CAE0Sz=x8LisGRkvo5SW5fpXPCUNStN=ZLk50GerJ__sSEw9yGQ@mail.gmail.com>
References: <1349811603124-22452.post@n5.nabble.com>
	<507543E8.7000604@rabbitmq.com>
	<20121010134540.GV10330@data.it.su.se>
	<5075A1EA.5020507@rabbitmq.com>
	<1349893961236-22477.post@n5.nabble.com>
	<1349964835117-22498.post@n5.nabble.com>
	<1349987080415-22510.post@n5.nabble.com>
	<CAE0Sz=x8LisGRkvo5SW5fpXPCUNStN=ZLk50GerJ__sSEw9yGQ@mail.gmail.com>
Message-ID: <1350051581256-22531.post@n5.nabble.com>

Thank you. I had bought this book but did not realize there was a very good
chapter on writing the plugins. I am going through this right now. 

regards



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Rabbit-CAS-Central-Authentication-Service-integration-tp22452p22531.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Fri Oct 12 15:20:56 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 12 Oct 2012 15:20:56 +0100
Subject: [rabbitmq-discuss] bug descriptions
In-Reply-To: <50782649.4000104@rabbitmq.com>
References: <b7992c4d-14b4-4fed-b7f6-e76f52d96dfa@googlegroups.com>
	<50782649.4000104@rabbitmq.com>
Message-ID: <50782748.4090805@rabbitmq.com>

On 12/10/12 15:16, Simon MacMullen wrote:
> We post release notes for each release, listing all bug fixes and new
> features. These can be obtained from:
>
> http://www.rabbitmq.com/changelog.html

In case that is not obvious...

You can click on the version number to take you to the release 
announcement, which in turn contains a link to an attachment with the 
release notes.

Matthias.


From thomlemonrabbit at gmail.com  Fri Oct 12 17:08:18 2012
From: thomlemonrabbit at gmail.com (Thom Lemon)
Date: Fri, 12 Oct 2012 12:08:18 -0400
Subject: [rabbitmq-discuss] RabbitMQ Examples/Libraries and Visual Studio
	2012 .Net C#
Message-ID: <CAOFhxeEnj6p4X5LNhk=nsgcjqg1hg=nH9fm0JDNd=yk3px8ewg@mail.gmail.com>

I just downloaded the .Net samples and library source code and tools
(rabbitmq-dotnet-client-2.8.7.zip) and tried to open
the RabbitMQDotNetClient.sln in Visual Studio 2012. When VS tried to
migrate it I got a boat load of errors and warnings that don't clearly
identify what is wrong, at least to me.

Has anyone gone through this process and figured it out?
My visual Studio skills are pretty rusty and I am not sure how to just pull
the libraries into a new project to try that path to see if I can get
things to build.

Any help would be appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121012/6a071707/attachment.htm>

From emile at rabbitmq.com  Fri Oct 12 19:02:52 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 12 Oct 2012 19:02:52 +0100
Subject: [rabbitmq-discuss] RabbitMQ Examples/Libraries and Visual
 Studio 2012 .Net C#
In-Reply-To: <CAOFhxeEnj6p4X5LNhk=nsgcjqg1hg=nH9fm0JDNd=yk3px8ewg@mail.gmail.com>
References: <CAOFhxeEnj6p4X5LNhk=nsgcjqg1hg=nH9fm0JDNd=yk3px8ewg@mail.gmail.com>
Message-ID: <50785B4C.1060506@rabbitmq.com>

Hi,

On 12/10/12 17:08, Thom Lemon wrote:
> I got a boat load of errors and warnings that don't clearly
> identify what is wrong, at least to me.

I assume you are following the instructions at
http://www.rabbitmq.com/build-dotnet-client.html

Did you copy Local.props.example to Local.props as suggested?


-Emile



From tsuraan at gmail.com  Fri Oct 12 19:06:07 2012
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 12 Oct 2012 13:06:07 -0500
Subject: [rabbitmq-discuss] What can cause mnesia partitioning?
Message-ID: <CALKcMwLx8N1KgbXjDpSKAAPX8szouTxMJCof3+YcF+Jm0oOCBQ@mail.gmail.com>

We had a pair of computers running a rabbit cluster, and somehow their
mnesia databases diverged.  Each computer was running its own rabbit
happily, but they both had cluster_status messages showing only
themselves as the only "running" node, and they both had log messages
to the effect of:

Mnesia('rabbit at node-1'): ** ERROR ** mnesia_event got
{inconsistent_database, starting_partitioned_network, 'rabbit at node-2'}

I restarted both rabbit instances, and they both came up in an
apparently functional single-node instance (cluster_status on each
still showed the other node as a disc node, but not as a running
node).  From my reading of http://www.rabbitmq.com/clustering.html, it
doesn't seem like that should happen, unless each node was somehow
convinced that it was the most up to date disc node.  Otherwise, one
of the nodes should have waited 30 seconds for the other one, and then
crashed if it couldn't be reached, right?  What sort of circumstances
would cause both nodes to think they were the most up to date, and
that they should continue running on their own?

Along that line, is there any way to configure a rabbit node to only
run if it can contact a strict majority of disc nodes?  I think that
would make this sort of problem less likely to happen, assuming the
problem stems from a network partition, or perhaps even from some
period of time where each machine was running while the other was not.

From mpietrek at skytap.com  Fri Oct 12 21:01:21 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 12 Oct 2012 13:01:21 -0700
Subject: [rabbitmq-discuss] Loss of queues after network partition?
Message-ID: <CACLE7iyF8XFc2hGmy0YyaUJmGkV05dDZ6v5dXOsTJeq_6+KcKg@mail.gmail.com>

I'll be the first to admit that this is a somewhat unusual/complicated
circumstance, but I'm posting this on the chance there's something unusual.
This is RabbitMQ is *2.8.7 *on Erlang R15B01.

We have two brokers (mq1, mq2) running clustered with all HA queues. A VIP
is in front of them.

At some point there was a network event, and afterwards, a queue vanished.
(Still trying to figure out exactly what the network hiccup was, but it's
fair to say there was a communication disruption between the nodes.)  My
guess from looking at the logs is that each node had a moment where it
couldn't see the other, so took actions that were ultimately incompatible
when both nodes were visible to each other.

The actual error as seen by our code is a missing queue named "charon".
You'll see it near the end of the rabbit at mq2.log (below):

*{amqp_error,not_found,"no queue 'charon' in vhost '/'",'queue.declare'}*

Prior to the network event, our client was successfully reading from the
charon queue.


*Here's the relevant parts of the rabbit at mq1.log file
====================================================*
=INFO REPORT==== 11-Oct-2012::14:01:58 ===
rabbit on node rabbit at mq2 down

=ERROR REPORT==== 11-Oct-2012::14:02:03 ===
Mnesia(rabbit at mq1): ** ERROR ** mnesia_event got {inconsistent_database,
running_partitioned_network, rabbit at mq2}

=ERROR REPORT==== 11-Oct-2012::14:02:03 ===
** Generic server <0.547.0> terminating
** Last message in was {mnesia_locker,rabbit at mq2,granted}
** When Server state == {state,
                            {0,<0.547.0>},
                            {{0,<0.547.0>},undefined},
                            {{0,<0.547.0>},undefined},
                            {resource,<<"/">>,queue,<<"charon">>},
                            rabbit_mirror_queue_coordinator,
                            {3,
                             [{{0,<0.547.0>},
                               {view_member,
                                   {0,<0.547.0>},
                                   [],
                                   {0,<0.547.0>},
                                   {0,<0.547.0>}}}]},
                            1,[],
                            [<0.546.0>],
                            {[],[]},
                            [],undefined}
** Reason for termination ==
** {function_clause,
       [{gm,handle_info,
            [{mnesia_locker,rabbit at mq2,granted},
             {state,
                 {0,<0.547.0>},
                 {{0,<0.547.0>},undefined},
                 {{0,<0.547.0>},undefined},
                 {resource,<<"/">>,queue,<<"charon">>},
                 rabbit_mirror_queue_coordinator,
                 {3,
                  [{{0,<0.547.0>},
                    {view_member,
                        {0,<0.547.0>},
                        [],
                        {0,<0.547.0>},
                        {0,<0.547.0>}}}]},
                 1,[],
                 [<0.546.0>],
                 {[],[]},
                 [],undefined}],
            [{file,"src/gm.erl"},{line,665}]},

{gen_server2,handle_msg,2,[{file,"src/gen_server2.erl"},{line,912}]},
        {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}

=ERROR REPORT==== 11-Oct-2012::14:02:03 ===
** Generic server <0.545.0> terminating
** Last message in was {'EXIT',<0.546.0>,
                        {function_clause,
                         [{gm,handle_info,
                           [{mnesia_locker,rabbit at mq2,granted},
                            {state,
                             {0,<0.547.0>},
                             {{0,<0.547.0>},undefined},
                             {{0,<0.547.0>},undefined},
                             {resource,<<"/">>,queue,<<"charon">>},
                             rabbit_mirror_queue_coordinator,
                             {3,
                              [{{0,<0.547.0>},
                                {view_member,
                                 {0,<0.547.0>},
                                 [],
                                 {0,<0.547.0>},
                                 {0,<0.547.0>}}}]},
                             1,[],
                             [<0.546.0>],
                             {[],[]},
                             [],undefined}],
                           [{file,"src/gm.erl"},{line,665}]},
                          {gen_server2,handle_msg,2,
                           [{file,"src/gen_server2.erl"},{line,912}]},
                          {proc_lib,wake_up,3,
                           [{file,"proc_lib.erl"},{line,237}]}]}}
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"/">>,queue,<<"charon">>},
                          true,false,none,
                          [{<<"x-ha-policy">>,longstr,<<"all">>}],
                          <0.545.0>,[],all},
                         none,false,rabbit_mirror_queue_master,
                         {state,<0.547.0>,<0.546.0>,rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,undefined,0,undefined},
                           {0,{[],[]}},
                           {0,{[],[]}},
                           0,
                           {0,nil},
                           undefined,
                           {0,nil},
                           {qistate,
                            "/highland/var/lib/rabbit at mq1
/queues/4L2SY4TVRPM8HP85JDVO85BPL",
                            {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             []},
                            undefined,0,262144,
                            #Fun<rabbit_variable_queue.2.121500735>,
                            {0,nil}},
                           {{client_msstate,msg_store_persistent,

<<112,32,84,92,54,73,67,43,231,35,164,79,106,8,27,
                               132>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,237637,
                              "/highland/var/lib/rabbit at mq1
/msg_store_persistent"},
                             rabbit_msg_store_ets_index,
                             "/highland/var/lib/rabbit at mq1
/msg_store_persistent",
                             <0.289.0>,241734,233540,245831,249928},
                            {client_msstate,msg_store_transient,

<<204,18,155,40,29,120,124,76,144,83,195,135,250,
                               91,216,3>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,217152,
                              "/highland/var/lib/rabbit at mq1
/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                             "/highland/var/lib/rabbit at mq1
/msg_store_transient",
                             <0.284.0>,221249,213055,225346,229443}},

true,0,#Fun<rabbit_amqqueue_process.5.24780734>,0,
                           0,infinity,0,0,0,0,0,
                           {rates,
                            {{1349,988602,967125},0},
                            {{1349,988602,967125},0},
                            0.0,0.0,
                            {1349,988606,141019}},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           0,0,
                           {rates,
                            {{1349,988602,967125},0},
                            {{1349,988602,967125},0},
                            0.0,0.0,
                            {1349,988606,141019}}},
                          0,
                          {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          [],
                          {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          {set,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}}},
                         {[],[]},
                         undefined,undefined,undefined,undefined,
                         {state,fine,5000,undefined},
                         {0,nil},
                         undefined,undefined,undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         1,
                         {{0,nil},{0,nil}},
                         undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         undefined,undefined}
** Reason for termination ==
** {noproc,{gen_server2,call,[<0.547.0>,info,infinity]}}
** In 'terminate' callback with reason ==
** {function_clause,
       [{gm,handle_info,
            [{mnesia_locker,rabbit at mq2,granted},
             {state,
                 {0,<0.547.0>},
                 {{0,<0.547.0>},undefined},
                 {{0,<0.547.0>},undefined},
                 {resource,<<"/">>,queue,<<"charon">>},
                 rabbit_mirror_queue_coordinator,
                 {3,
                  [{{0,<0.547.0>},
                    {view_member,
                        {0,<0.547.0>},
                        [],
                        {0,<0.547.0>},
                        {0,<0.547.0>}}}]},
                 1,[],
                 [<0.546.0>],
                 {[],[]},
                 [],undefined}],
            [{file,"src/gm.erl"},{line,665}]},

{gen_server2,handle_msg,2,[{file,"src/gen_server2.erl"},{line,912}]},
        {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}

=INFO REPORT==== 11-Oct-2012::14:02:03 ===
Mirrored-queue (queue 'cmcmd' in vhost '/'): Master <rabbit at mq1.2.665.0>
saw deaths of mirrors <rabbit at mq2.1.383.0>

=INFO REPORT==== 11-Oct-2012::14:02:03 ===
Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Master
<rabbit at mq1.2.605.0> saw deaths of mirrors <rabbit at mq2.1.377.0>

=INFO REPORT==== 11-Oct-2012::14:02:03 ===
global: Name conflict terminating {rabbit_mgmt_db,<3198.32532.0>}

=INFO REPORT==== 11-Oct-2012::14:26:40 ===
accepting AMQP connection <0.6507.1> (10.72.0.50:46742 -> 10.72.0.47:5672)

=INFO REPORT==== 11-Oct-2012::14:26:40 ===
closing AMQP connection <0.6507.1> (10.72.0.50:46742 -> 10.72.0.47:5672)




*And here's the relevant parts of the rabbit at m2.log file
====================================================*
=ERROR REPORT==== 11-Oct-2012::14:01:37 ===
** Node rabbit at mq1 not responding **
** Removing (timedout) connection **

=INFO REPORT==== 11-Oct-2012::14:01:37 ===
rabbit on node rabbit at mq1 down

=INFO REPORT==== 11-Oct-2012::14:01:40 ===
Statistics database started.

=INFO REPORT==== 11-Oct-2012::14:01:43 ===
Mirrored-queue (queue 'cmcmd' in vhost '/'): Slave <rabbit at mq2.1.383.0> saw
deaths of mirrors <rabbit at mq1.2.665.0>

=INFO REPORT==== 11-Oct-2012::14:01:43 ===
Mirrored-queue (queue 'cmcmd' in vhost '/'): Promoting slave
<rabbit at mq2.1.383.0> to master

=INFO REPORT==== 11-Oct-2012::14:01:43 ===
Mirrored-queue (queue 'charon' in vhost '/'): Slave <rabbit at mq2.1.371.0>
saw deaths of mirrors <rabbit at mq1.2.545.0>

=INFO REPORT==== 11-Oct-2012::14:01:43 ===
Mirrored-queue (queue 'charon' in vhost '/'): Promoting slave
<rabbit at mq2.1.371.0> to master

=INFO REPORT==== 11-Oct-2012::14:01:43 ===
Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Slave
<rabbit at mq2.1.377.0> saw deaths of mirrors <rabbit at mq1.2.605.0>

=INFO REPORT==== 11-Oct-2012::14:01:43 ===
Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Promoting slave
<rabbit at mq2.1.377.0> to master

=ERROR REPORT==== 11-Oct-2012::14:05:03 ===
Mnesia(rabbit at mq2): ** ERROR ** mnesia_event got {inconsistent_database,
running_partitioned_network, rabbit at mq1}

=INFO REPORT==== 11-Oct-2012::14:05:03 ===
Statistics database started.

=ERROR REPORT==== 11-Oct-2012::14:29:39 ===
** Generic server <0.32583.0> terminating
** Last message in was {'$gen_cast',{gm_deaths,[<0.5504.1>]}}
** When Server state == {state,
                            {amqqueue,
                                {resource,<<"/">>,queue,<<"charon">>},
                                true,false,none,
                                [{<<"x-ha-policy">>,longstr,<<"all">>}],
                                <0.371.0>,[],all},
                            <0.372.0>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            #Fun<rabbit_mirror_queue_master.1.32244930>,
                            #Fun<rabbit_mirror_queue_master.2.32244930>}
** Reason for termination ==
** {bad_return_value,
       {error,
           {{badmatch,[]},
            [{rabbit_mirror_queue_misc,'-remove_from_queue/2-fun-0-',2,
                 [{file,"src/rabbit_mirror_queue_misc.erl"},{line,63}]},
             {mnesia_tm,apply_fun,3,[{file,"mnesia_tm.erl"},{line,829}]},
             {mnesia_tm,execute_transaction,5,
                 [{file,"mnesia_tm.erl"},{line,809}]},
             {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1,
                 [{file,"src/rabbit_misc.erl"},{line,440}]},
             {worker_pool_worker,handle_call,3,
                 [{file,"src/worker_pool_worker.erl"},{line,80}]},
             {gen_server2,handle_msg,2,
                 [{file,"src/gen_server2.erl"},{line,879}]},
             {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}}}

=ERROR REPORT==== 11-Oct-2012::14:29:39 ===
** Generic server <0.371.0> terminating
** Last message in was {'EXIT',<0.32583.0>,
                        {bad_return_value,
                         {error,
                          {{badmatch,[]},
                           [{rabbit_mirror_queue_misc,
                             '-remove_from_queue/2-fun-0-',2,
                             [{file,"src/rabbit_mirror_queue_misc.erl"},
                              {line,63}]},
                            {mnesia_tm,apply_fun,3,
                             [{file,"mnesia_tm.erl"},{line,829}]},
                            {mnesia_tm,execute_transaction,5,
                             [{file,"mnesia_tm.erl"},{line,809}]},
                            {rabbit_misc,
                             '-execute_mnesia_transaction/1-fun-0-',1,
                             [{file,"src/rabbit_misc.erl"},{line,440}]},
                            {worker_pool_worker,handle_call,3,

[{file,"src/worker_pool_worker.erl"},{line,80}]},
                            {gen_server2,handle_msg,2,
                             [{file,"src/gen_server2.erl"},{line,879}]},
                            {proc_lib,wake_up,3,
                             [{file,"proc_lib.erl"},{line,237}]}]}}}}
** When Server state == {q,
                         {amqqueue,
                          {resource,<<"/">>,queue,<<"charon">>},
                          true,false,none,
                          [{<<"x-ha-policy">>,longstr,<<"all">>}],
                          <0.371.0>,[],all},
                         none,false,rabbit_mirror_queue_master,
                         {state,<0.372.0>,<0.32583.0>,rabbit_variable_queue,
                          {vqstate,
                           {0,{[],[]}},
                           {0,{[],[]}},
                           {delta,undefined,0,undefined},
                           {0,{[],[]}},
                           {0,{[],[]}},
                           0,
                           {0,nil},
                           undefined,
                           {0,nil},
                           {qistate,
                            "/highland/var/lib/rabbit at mq2
/queues/4L2SY4TVRPM8HP85JDVO85BPL",
                            {{dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             []},
                            undefined,0,262144,
                            #Fun<rabbit_variable_queue.2.121500735>,
                            {0,nil}},
                           {{client_msstate,msg_store_persistent,

<<23,245,132,154,3,96,225,184,108,75,232,224,184,
                               114,108,141>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,282693,
                              "/highland/var/lib/rabbit at mq2
/msg_store_persistent"},
                             rabbit_msg_store_ets_index,
                             "/highland/var/lib/rabbit at mq2
/msg_store_persistent",
                             <0.285.0>,286790,278596,290887,294984},
                            {client_msstate,msg_store_transient,

<<17,62,75,125,126,21,66,37,170,44,198,72,18,94,
                               170,197>>,
                             {dict,0,16,16,8,80,48,
                              {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                               []},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []}}},
                             {state,262208,
                              "/highland/var/lib/rabbit at mq2
/msg_store_transient"},
                             rabbit_msg_store_ets_index,
                             "/highland/var/lib/rabbit at mq2
/msg_store_transient",
                             <0.280.0>,266305,258111,270402,274499}},

true,0,#Fun<rabbit_mirror_queue_slave.1.69615989>,
                           0,0,infinity,0,0,0,0,0,
                           {rates,
                            {{1349,989325,677031},0},
                            {{1349,989325,677031},0},
                            0.0,0.0,
                            {1349,989505,348090}},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           {0,nil},
                           0,0,
                           {rates,
                            {{1349,989325,677031},0},
                            {{1349,989325,677031},0},
                            0.0,0.0,
                            {1349,989505,348090}}},
                          0,
                          {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          [],
                          {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}},
                          {set,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                             []}}}},
                         {[],[]},
                         undefined,undefined,undefined,undefined,
                         {state,fine,5000,undefined},
                         {0,nil},
                         undefined,undefined,undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         1,
                         {{0,nil},{0,nil}},
                         undefined,
                         {dict,0,16,16,8,80,48,
                          {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},

{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
                         undefined,undefined}
** Reason for termination ==
** {noproc,{gen_server2,call,[<0.372.0>,info,infinity]}}
** In 'terminate' callback with reason ==
** {bad_return_value,
       {error,
           {{badmatch,[]},
            [{rabbit_mirror_queue_misc,'-remove_from_queue/2-fun-0-',2,
                 [{file,"src/rabbit_mirror_queue_misc.erl"},{line,63}]},
             {mnesia_tm,apply_fun,3,[{file,"mnesia_tm.erl"},{line,829}]},
             {mnesia_tm,execute_transaction,5,
                 [{file,"mnesia_tm.erl"},{line,809}]},
             {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1,
                 [{file,"src/rabbit_misc.erl"},{line,440}]},
             {worker_pool_worker,handle_call,3,
                 [{file,"src/worker_pool_worker.erl"},{line,80}]},
             {gen_server2,handle_msg,2,
                 [{file,"src/gen_server2.erl"},{line,879}]},
             {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}}}

=INFO REPORT==== 11-Oct-2012::14:29:43 ===
accepting AMQP connection <0.5524.1> (10.72.0.23:36056 -> 10.72.0.56:5672)

=INFO REPORT==== 11-Oct-2012::14:29:44 ===
accepting AMQP connection <0.5574.1> (10.72.0.23:36064 -> 10.72.0.56:5672)

=INFO REPORT==== 11-Oct-2012::17:56:16 ===
accepting AMQP connection <0.23868.1> (10.72.0.53:57122 -> 10.72.0.56:5672)

=ERROR REPORT==== 11-Oct-2012::17:56:16 ===
connection <0.23868.1>, channel 1 - error:
{amqp_error,not_found,"no queue 'charon' in vhost '/'",'queue.declare'}

=WARNING REPORT==== 11-Oct-2012::17:56:16 ===
closing AMQP connection <0.23868.1> (10.72.0.53:57122 -> 10.72.0.56:5672):
connection_closed_abruptly

=INFO REPORT==== 11-Oct-2012::17:56:16 ===
accepting AMQP connection <0.23878.1> (10.72.0.52:56025 -> 10.72.0.56:5672)

=ERROR REPORT==== 11-Oct-2012::17:56:16 ===
connection <0.23878.1>, channel 1 - error:
{amqp_error,not_found,"no queue 'charon' in vhost '/'",'queue.declare'}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121012/891ba884/attachment.htm>

From mpietrek at skytap.com  Sat Oct 13 00:43:02 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 12 Oct 2012 16:43:02 -0700
Subject: [rabbitmq-discuss] RabbitMQ stops responding for a few seconds,
 logs a "Context: shutdown_error", then resumes as if nothing happened
Message-ID: <CACLE7ixR5y3xTGfWXoXh506WoiSGzONKKTJ=m8PFXsf0E+AYGA@mail.gmail.com>

We've hit an odd circumstance in production that we can't make heads or
tails of. Our setup is two RabbitMQ 2.8.6 nodes running clustered with all
HA queues.

In front of them is a VIP managed by a keepalive instances running on the
same host as the RabbitMQ nodes. Every 5 seconds the keepalive instance
runs a custom script that queries the node local broker via the HTTP API,
requesting the set of queues (/api/queues).


From dwaynecampbell13 at gmail.com  Sat Oct 13 02:16:10 2012
From: dwaynecampbell13 at gmail.com (Dwayne Campbell)
Date: Fri, 12 Oct 2012 21:16:10 -0400
Subject: [rabbitmq-discuss] Disable Per-Connection Flow Control
In-Reply-To: <5077FB88.6060208@rabbitmq.com>
References: <9672780c-6a7b-4ef2-91fe-97ec82b2fb2c@googlegroups.com>
	<5077FB88.6060208@rabbitmq.com>
Message-ID: <CAHo58sjJYn3XiBguctA2ohvrfeh1EjUqU_018==7cTAAYcVDhw@mail.gmail.com>

Simon,

Thank you very much for your reply.

 **

Using HIPE compilation reduced the flow control significantly.I now get
flow controlled at around 4.1 MB/S to 7.2 MB/S .However flow control
 seems to steadily remain on at 3.8MB/s for the rest of the time RabbitMQ
runs.


Each message is about approximately 300 bytes at most 800 bytes

Multiple connections(independent applications) will be made from the same
host to the RabbitMQ Server. Each connection will be sending small messages
really fast to the broker(RabbitMQ Server)****

** **

What optimizations can be made to increase throughput on RabbitMQ Server or
 the routing part of the pipeline ? Would cluster be the next option to
evaluate ?

** **

** **
Is there any output that i can gather to analyze which part of
the pipeline is the bottleneck ?


--

Dwayne


On Fri, Oct 12, 2012 at 7:14 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 11/10/12 13:14, Dwayne Campbell wrote:
>
>> Hi Guys,
>>
>> RabbitMQ now turns on flow control often even at 1.5 MB/s.  I have read
>> before to increase the TCP buffer size, however I do not have access to
>> increase the TCP buffer size o the machines.
>>
>> How can i disable Per-Connection Flow Control ?   Memory based  and Disk
>> based control is enough for me.
>>
>
> Hi. You should be aware that the flow control is indicating that some part
> of the message pipeline is overloaded. If you were to turn off flow control
> it would just lead to messages backing up ahead of that part of the
> pipeline - leading to memory use ballooning very rapidly and no increase in
> throughput.
>
> If you are sending lots of tiny messages then the routing part of the
> pipeline can be the most expensive - my workstation manages only about
> 2.5MB/s with zero-length messages.
>
> The advice about increasing the buffer size is to allow your machine to
> handle short bursts of messages, at higher rates than it can manage in a
> steady state. It won't get you a higher steady state rate.
>
> To process messages faster on a single machine you might enable HiPE
> compilation: see http://www.rabbitmq.com/**configure.html<http://www.rabbitmq.com/configure.html>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121012/216aea06/attachment.htm>

From ymmudym at gmail.com  Sat Oct 13 08:43:36 2012
From: ymmudym at gmail.com (vedanth)
Date: Sat, 13 Oct 2012 00:43:36 -0700 (PDT)
Subject: [rabbitmq-discuss] Messages not being delivered to the
 queue(but sender shows 'Message sent')
In-Reply-To: <5077EE44.2050106@rabbitmq.com>
References: <1349970088288-22502.post@n5.nabble.com>
	<5077EE44.2050106@rabbitmq.com>
Message-ID: <1350114216313-22539.post@n5.nabble.com>

Thank u Tim and Emile for the suggestion, you guys were right the disk space
was only 625MB, when i increased it to 1.5G rabbit mq had no problems..... 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Messages-not-being-delivered-to-the-queue-but-sender-shows-Message-sent-tp22502p22539.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121013/ceb0a35c/attachment.htm>

From samuel.net at gmail.com  Sat Oct 13 13:58:18 2012
From: samuel.net at gmail.com (Samuel Chen)
Date: Sat, 13 Oct 2012 20:58:18 +0800
Subject: [rabbitmq-discuss] Is the release date typo for 2.8.7 ?
Message-ID: <CAFnnZrgM2rJ7vdm0CSu6vZ1EQMyG0bPfCgv2qnvWm67CqcieAA@mail.gmail.com>

Hi,

On the homepage, the release date is 27 Sep.
But on http://www.rabbitmq.com/news.html#2012-09-27T16:05:00+0100, the date
is
RabbitMQ 2.8.7 release<http://lists.rabbitmq.com/pipermail/rabbitmq-announce/2012-September/000051.html>
---> 22 August 2012
Looks like a typo.

- Sam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121013/da994612/attachment.htm>

From ward.mark at gmail.com  Sun Oct 14 06:35:37 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Sat, 13 Oct 2012 22:35:37 -0700 (PDT)
Subject: [rabbitmq-discuss] protecting the cluster from large messages
Message-ID: <c99aa6c6-9d2c-414b-b3f7-9bda61b3c8d4@googlegroups.com>

Hi,

Does RabbitMQ have a feature to discard a message before saving it to a 
queue and mirroring the message if it is greater than a specific/customized 
size?  I am thinking a message size check would prevent a cluster crash 
because a client sent messages to big to process and mirror.  

If so how would I go about setting this up?

I have not found enough information if the frame size is something I can 
try.

-Mark

p.s. I am asking because in my test cluster I can reliably destroy my 
cluster in a negative way with messages that surpass memory resources.  I 
have learned to use the watermark to help manage acceptable large messages 
but the high watermark has not helped to prevent the receipt of 
a destructively large messages.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121013/ba036329/attachment.htm>

From aggarwalsandeep at optonline.net  Sun Oct 14 07:39:30 2012
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Sat, 13 Oct 2012 23:39:30 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ as messaging hub between .Net and JMS
	based services
Message-ID: <c49d8f4f-d8be-4ae8-aa46-3a99d2669389@googlegroups.com>

Hi - 

I'm trying to implement RabbitMQ as the core messaging hub to be used in my 
company in the following configuration. Has someone used Rabbit this way 
(or something similar)? Please share your experiences. 

1. Install RabbitMQ broker in the intranet zone for all internal apps. All 
internal apps use Windows, IIS, .Net stack. We can use the .Net client for 
RabbitMQ and have done some proof-of-concept testing and seems to be 
working fine. 
2. Install RabbitMQ in the DMZ zone for the external apps such as customer 
facing web portal (WebLogic, JSF, Oracle) and another vendor app (JBoss, 
Linux and Oracle). 
3. Both of these brokers need to be working in high-availability (HA in 
active/active) mode.

The problem is that the new vendor app that we are trying to plug in here 
(under external apps) provides MQ features using JMS. But since this is a 
vendor app, we don't have access to the source code and we cannot make 
changes to start using rabbitMQ's Java client for this app. I need to use 
some JMS compliant messaging provider for this app. For instance, I can use 
JBoss MQ or otherwise buy IBM MQ (which could always be done technically 
but it's cost prohibitive for us for now).

I'm trying to figure out if I can use RabbitMQ as a JMS provider? If I can 
do so in a production environment, then we can keep RabbitMQ as the core 
messaging backbone for the firm without having to use a different JMS 
provider. Please share if someone has run into something similar.  

Thx in advance...

Sandy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121013/4562608e/attachment.htm>

From aggarwalsandeep at optonline.net  Sun Oct 14 07:43:20 2012
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Sat, 13 Oct 2012 23:43:20 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ production ready in Windows
In-Reply-To: <f32ceb09-f115-457a-b778-732958bb5e89@googlegroups.com>
References: <e8aa15e4-c760-4904-8e55-93bca3df4ef9@googlegroups.com>
	<f32ceb09-f115-457a-b778-732958bb5e89@googlegroups.com>
Message-ID: <d8152d44-7907-45a5-a764-d94dbdb3fe9b@googlegroups.com>

Hi - 

I was trying to install Erlang on Win 2003 server but for some reason I 
don't see the bin folder getting setup. However, it seems to be working 
fine on the 2008 box. Are you aware of any issues on 2003? Thx!

Sandy

On Thursday, October 4, 2012 4:34:04 AM UTC-4, Christoph wrote:
>
> Yes - without any problems (Windows 2008 R2)
>
> On Monday, October 1, 2012 11:42:20 AM UTC+2, R??acki Krzysztof wrote:
>>
>> Hi,
>>
>> I'm trying to introduce RabbitMQ as our backbone messaging service. My 
>> first basic question is whether RabbitMQ is used in production on Windows 
>> server from 2003 onwards ?
>>
>> Thank you
>>
>> Chris
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121013/b0181312/attachment.htm>

From aggarwalsandeep at optonline.net  Sun Oct 14 07:51:01 2012
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Sat, 13 Oct 2012 23:51:01 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ versus ActiveMQ
Message-ID: <b5a6c8b9-a40a-4b56-9c4b-14daa2cf2748@googlegroups.com>

Hi -

I'm trying to compare RabbitMQ to ActiveMQ. Does someone has good links or 
info to share? 

Thanks,
Sandy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121013/c49917a7/attachment.htm>

From chinmay.cet at gmail.com  Sat Oct 13 19:52:42 2012
From: chinmay.cet at gmail.com (Chinmay Sahoo)
Date: Sun, 14 Oct 2012 00:22:42 +0530
Subject: [rabbitmq-discuss] Question on Rabbit MQ
Message-ID: <CAFNeBJPRKxp1CXtfTqW62g0X8OeL-LFephKzmcMpK9sbn2+ZbA@mail.gmail.com>

Hi,

I like erlang and thus the interest in RabbitMQ.

1. Can I use any other database(apart from Mnesia) for persistence ?

2. Does Queue Data replication exists ?

3. How well does RabbitMQ confirms to the ONCE-ONLY philosophy. Will
RabbitMQ send a same message to the consumer twice ? Cause this can be
a problem in some areas such as payment processing where the message
would be processed twice unless the scenario is somehow handled in
consumer.

4. I will test RabbitMQ on Windows but would like to have it on Unix in Prod.
Are there any tools to help migrate the instance of RabbitMQ from
Windows to Unix ?


Regards,
Chinmay

From dmitry.polyanovsky at gmail.com  Sun Oct 14 15:27:12 2012
From: dmitry.polyanovsky at gmail.com (Dmitry Polyanovsky)
Date: Sun, 14 Oct 2012 07:27:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
In-Reply-To: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
References: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
Message-ID: <f64caa3a-6947-4bcf-96ee-077b94f5da44@googlegroups.com>

Hi,
they will be deleted after first consumer "touch" them. If any consumer 
will never connect to queue, it will be never deleted.

On Wednesday, October 10, 2012 12:22:17 PM UTC+2, Raviv Pavel wrote:
>
> I have an auto-delete, durable, non mirrored, not exclusive queue, that is 
> empty (no messages), idle, and has no consumers
> However, it's still not being auto deleted.
> Any idea why?
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121014/70846ef7/attachment.htm>

From streetcat at gmail.com  Sun Oct 14 12:20:58 2012
From: streetcat at gmail.com (Raviv Pavel)
Date: Sun, 14 Oct 2012 04:20:58 -0700 (PDT)
Subject: [rabbitmq-discuss] Erlang version issue when Upgrading to 2.8.7-1
Message-ID: <1a5770c3-b3ea-4335-b5b1-688fef50fa22@googlegroups.com>

I'm trying to upgrade from 2.8.4 to 2.8.7-1 but I'm getting: erlang >= 
R12B-3 is needed by rabbitmq-server-2.8.7-1.noarch
Which doesn't make sense because rabbit reports it's using R15B01
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121014/83d1a230/attachment.htm>

From jerryk at rbcon.com  Sun Oct 14 18:08:40 2012
From: jerryk at rbcon.com (Jerry Kuch)
Date: Sun, 14 Oct 2012 10:08:40 -0700
Subject: [rabbitmq-discuss] Erlang version issue when Upgrading to
	2.8.7-1
In-Reply-To: <1a5770c3-b3ea-4335-b5b1-688fef50fa22@googlegroups.com>
References: <1a5770c3-b3ea-4335-b5b1-688fef50fa22@googlegroups.com>
Message-ID: <CAE0Sz=yDRqFOfEWGS5c+PNmxi-Z99SJneqOUybe+_6jXma1ALA@mail.gmail.com>

Hi, Raviv:

How did you install your Erlang?  From an RPM or did you build from source
or obtain it in some other packaging format?  If not the RPM, the 'rpm'
tool won't know about your Erlang when it checks the dependencies of
Rabbit...

Best regards,
Jerry

On Sun, Oct 14, 2012 at 4:20 AM, Raviv Pavel <streetcat at gmail.com> wrote:

> I'm trying to upgrade from 2.8.4 to 2.8.7-1 but I'm getting: erlang >=
> R12B-3 is needed by rabbitmq-server-2.8.7-1.noarch
> Which doesn't make sense because rabbit reports it's using R15B01
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121014/60135164/attachment.htm>

From bruno at chalopin.fr  Mon Oct 15 07:28:41 2012
From: bruno at chalopin.fr (Bruno CHALOPIN)
Date: Sun, 14 Oct 2012 23:28:41 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ production ready in Windows
In-Reply-To: <d8152d44-7907-45a5-a764-d94dbdb3fe9b@googlegroups.com>
References: <e8aa15e4-c760-4904-8e55-93bca3df4ef9@googlegroups.com>
	<f32ceb09-f115-457a-b778-732958bb5e89@googlegroups.com>
	<d8152d44-7907-45a5-a764-d94dbdb3fe9b@googlegroups.com>
Message-ID: <b6a594a0-a6ca-46cb-bdd3-e1485797304c@googlegroups.com>

Hi,

Had the same problem (with an error message during installation) and it was 
because i haven't installed vc 2010 runtimes first.

Le dimanche 14 octobre 2012 08:43:20 UTC+2, Sandy a ?crit :
>
> Hi - 
>
> I was trying to install Erlang on Win 2003 server but for some reason I 
> don't see the bin folder getting setup. However, it seems to be working 
> fine on the 2008 box. Are you aware of any issues on 2003? Thx!
>
> Sandy
>
> On Thursday, October 4, 2012 4:34:04 AM UTC-4, Christoph wrote:
>>
>> Yes - without any problems (Windows 2008 R2)
>>
>> On Monday, October 1, 2012 11:42:20 AM UTC+2, R??acki Krzysztof wrote:
>>>
>>> Hi,
>>>
>>> I'm trying to introduce RabbitMQ as our backbone messaging service. My 
>>> first basic question is whether RabbitMQ is used in production on Windows 
>>> server from 2003 onwards ?
>>>
>>> Thank you
>>>
>>> Chris
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121014/7b61d0bf/attachment.htm>

From matthias at rabbitmq.com  Mon Oct 15 07:37:49 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 15 Oct 2012 07:37:49 +0100
Subject: [rabbitmq-discuss] RabbitMQ production ready in Windows
In-Reply-To: <b6a594a0-a6ca-46cb-bdd3-e1485797304c@googlegroups.com>
References: <e8aa15e4-c760-4904-8e55-93bca3df4ef9@googlegroups.com>
	<f32ceb09-f115-457a-b778-732958bb5e89@googlegroups.com>
	<d8152d44-7907-45a5-a764-d94dbdb3fe9b@googlegroups.com>
	<b6a594a0-a6ca-46cb-bdd3-e1485797304c@googlegroups.com>
Message-ID: <507BAF3D.4090405@rabbitmq.com>

Bruno, Sandy,

On 15/10/12 07:28, Bruno CHALOPIN wrote:
> Had the same problem (with an error message during installation) and it
> was because i haven't installed vc 2010 runtimes first.

There was a file missing from the Erlang R15B02 release, which got 
subsequently re-added. So from http://www.erlang.org/download.html, make 
sure you download the "with MSVCR100" installers.

If that doesn't fix the problem then let us know and we'll investigate 
further.

Regards,

Matthias.

From tim at rabbitmq.com  Mon Oct 15 08:25:47 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 15 Oct 2012 08:25:47 +0100
Subject: [rabbitmq-discuss] RabbitMQ stops responding for a few seconds,
	logs a "Context: shutdown_error",
	then resumes as if nothing happened
In-Reply-To: <CACLE7ixR5y3xTGfWXoXh506WoiSGzONKKTJ=m8PFXsf0E+AYGA@mail.gmail.com>
References: <CACLE7ixR5y3xTGfWXoXh506WoiSGzONKKTJ=m8PFXsf0E+AYGA@mail.gmail.com>
Message-ID: <26A02451-6DDB-42BB-AB23-B2451597A93B@rabbitmq.com>

Hi Matt,

Usual request for any scrubbed log(s) you can provide please! :)

Also, if you could confirm that /api/queues every 5 seconds is the only non-amqp traffic the broker(s) will be subject to, that'd be quite useful to know as well.

Cheers,

Tim


On 13 Oct 2012, at 00:43, Matt Pietrek wrote:

> We've hit an odd circumstance in production that we can't make heads or tails of. Our setup is two RabbitMQ 2.8.6 nodes running clustered with all HA queues.
> 
> In front of them is a VIP managed by a keepalive instances running on the same host as the RabbitMQ nodes. Every 5 seconds the keepalive instance runs a custom script that queries the node local broker via the HTTP API,  requesting the set of queues (/api/queues).
> 
> From our logs, I can see that there was a single interval where the HTTP request returned a 404 error. (The time was the same on both brokers) Previous to this moment in time, all HTTP queries were successful, and after this moment in time, all queries were sucessful - As I said, just one blip on each broker.
> 
> The only interesting thing we noticed in the logs was that the primary broker's rabbit at xxx-sasl file had this little snippet about 30 seconds after the hiccup occurred:
> 
> =SUPERVISOR REPORT==== 12-Oct-2012::15:06:47 ===
> Supervisor: {<0.25499.41>, rabbit_channel_sup_sup}
> Context: shutdown_error
> Reason: shutdown
> Offender: [{pid,<0.25503.41>},
> {name,channel_sup},
> {mfa,{rabbit_channel_sup,start_link,[]}},
> {restart_type,temporary},
> {shutdown,infinity},
> {child_type,supervisor}]
> 
> I'm mostly at a loss to process what the snippet is telling me, nor can tell if the two things are related. Any help is appreciated!
> 
> Thanks,
> 
> Matt
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From watson.timothy at gmail.com  Mon Oct 15 08:35:53 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 15 Oct 2012 08:35:53 +0100
Subject: [rabbitmq-discuss] Question on Rabbit MQ
In-Reply-To: <CAFNeBJPRKxp1CXtfTqW62g0X8OeL-LFephKzmcMpK9sbn2+ZbA@mail.gmail.com>
References: <CAFNeBJPRKxp1CXtfTqW62g0X8OeL-LFephKzmcMpK9sbn2+ZbA@mail.gmail.com>
Message-ID: <E9359267-FF87-424B-BB32-6A28568F2C6F@rabbitmq.com>

Hi

On 13 Oct 2012, at 19:52, Chinmay Sahoo wrote:

> Hi,
> 
> I like erlang and thus the interest in RabbitMQ.
> 
> 1. Can I use any other database(apart from Mnesia) for persistence ?
> 

Mnesia is used to persist schema information (e.g., vhosts, queues, exchanges, bindings, users, etc) and no, you cannot use another database for that at this time. You should note that Mnesia is *not* used to persist messages - instead rabbit has its own disk based persistence mechanism, and you *can* replace this, although the only alternative store that I know of currently is Tokyo Cabinet.  

> 2. Does Queue Data replication exists ?
> 

Yes - please see http://www.rabbitmq.com/distributed.html and http://www.rabbitmq.com/ha.html for more details on some of these options.

> 3. How well does RabbitMQ confirms to the ONCE-ONLY philosophy. Will
> RabbitMQ send a same message to the consumer twice ? Cause this can be
> a problem in some areas such as payment processing where the message
> would be processed twice unless the scenario is somehow handled in
> consumer.
> 

Yes indeed. See http://rabbitmq.1065348.n5.nabble.com/Exactly-Once-Delivery-td16826.html for a good explanation of why in our view, handling this in the consumer is *necessary* in most cases.

> 4. I will test RabbitMQ on Windows but would like to have it on Unix in Prod.
> Are there any tools to help migrate the instance of RabbitMQ from
> Windows to Unix ?
> 

I certainly haven't heard of any. Are you talking about migrating the definitions of queues/exchanges/bindings/etc, or persistent messages, or both?


From alexis at rabbitmq.com  Mon Oct 15 09:22:54 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 15 Oct 2012 09:22:54 +0100
Subject: [rabbitmq-discuss] protecting the cluster from large messages
In-Reply-To: <c99aa6c6-9d2c-414b-b3f7-9bda61b3c8d4@googlegroups.com>
References: <c99aa6c6-9d2c-414b-b3f7-9bda61b3c8d4@googlegroups.com>
Message-ID: <CACOPnvf1Wt_5tyJyL+61K8FP4WbGGVbQuZZYPo9_1MO5CDASDA@mail.gmail.com>

Mark,

> p.s. I am asking because in my test cluster I can reliably destroy my
> cluster in a negative way with messages that surpass memory resources.  I
> have learned to use the watermark to help manage acceptable large messages
> but the high watermark has not helped to prevent the receipt of a
> destructively large messages.

How big are these messages?

alexis




On Sun, Oct 14, 2012 at 6:35 AM, Mark Ward <ward.mark at gmail.com> wrote:
> Hi,
>
> Does RabbitMQ have a feature to discard a message before saving it to a
> queue and mirroring the message if it is greater than a specific/customized
> size?  I am thinking a message size check would prevent a cluster crash
> because a client sent messages to big to process and mirror.
>
> If so how would I go about setting this up?
>
> I have not found enough information if the frame size is something I can
> try.
>
> -Mark
>
> p.s. I am asking because in my test cluster I can reliably destroy my
> cluster in a negative way with messages that surpass memory resources.  I
> have learned to use the watermark to help manage acceptable large messages
> but the high watermark has not helped to prevent the receipt of a
> destructively large messages.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From info at geocast.net  Mon Oct 15 09:50:12 2012
From: info at geocast.net (Geocast)
Date: Mon, 15 Oct 2012 16:50:12 +0800
Subject: [rabbitmq-discuss] disconnect a node from the cluster
Message-ID: <CANC53sFfNMP1Hkj7wMWFY+S6JzkfKwDeEuy9=UnoG7mVGBB0uw@mail.gmail.com>

Hello,

How to disconnect a rabbitmq node from a cluster? but don't loss any queue.

Thanks.

From francesco at rabbitmq.com  Mon Oct 15 10:05:07 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Mon, 15 Oct 2012 10:05:07 +0100
Subject: [rabbitmq-discuss] disconnect a node from the cluster
In-Reply-To: <CANC53sFfNMP1Hkj7wMWFY+S6JzkfKwDeEuy9=UnoG7mVGBB0uw@mail.gmail.com>
References: <CANC53sFfNMP1Hkj7wMWFY+S6JzkfKwDeEuy9=UnoG7mVGBB0uw@mail.gmail.com>
Message-ID: <87a9vocdh8.wl%francesco@rabbitmq.com>

At Mon, 15 Oct 2012 16:50:12 +0800,
Geocast wrote:
> How to disconnect a rabbitmq node from a cluster? but don't loss any queue.

I guess you want to remove a node from a cluster.  The way to do that is simply
to stop the node and reset it.

However, the queues on the reseted node will be lost, you'll need to re-declare
them.  HA queues will survive if they reside on more nodes apart from the
reseted one.

---
Francesco

From emile at rabbitmq.com  Mon Oct 15 10:13:50 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 15 Oct 2012 10:13:50 +0100
Subject: [rabbitmq-discuss] Is the release date typo for 2.8.7 ?
In-Reply-To: <CAFnnZrgM2rJ7vdm0CSu6vZ1EQMyG0bPfCgv2qnvWm67CqcieAA@mail.gmail.com>
References: <CAFnnZrgM2rJ7vdm0CSu6vZ1EQMyG0bPfCgv2qnvWm67CqcieAA@mail.gmail.com>
Message-ID: <507BD3CE.7060807@rabbitmq.com>

On 13/10/12 13:58, Samuel Chen wrote:
> Looks like a typo.

Thanks for pointing this out - fixed now. The release date for 2.8.7 was
27 Sept 2012.

-Emile

From info at geocast.net  Mon Oct 15 10:41:46 2012
From: info at geocast.net (Geocast)
Date: Mon, 15 Oct 2012 17:41:46 +0800
Subject: [rabbitmq-discuss] disconnect a node from the cluster
In-Reply-To: <87a9vocdh8.wl%francesco@rabbitmq.com>
References: <CANC53sFfNMP1Hkj7wMWFY+S6JzkfKwDeEuy9=UnoG7mVGBB0uw@mail.gmail.com>
	<87a9vocdh8.wl%francesco@rabbitmq.com>
Message-ID: <CANC53sEuH21kvzxyQEqGVv8mqZP3X9N1=TN2rqGQ-nZ8vLNOLQ@mail.gmail.com>

thanks for the info.

2012/10/15 Francesco Mazzoli <francesco at rabbitmq.com>:
> At Mon, 15 Oct 2012 16:50:12 +0800,
> Geocast wrote:
>> How to disconnect a rabbitmq node from a cluster? but don't loss any queue.
>
> I guess you want to remove a node from a cluster.  The way to do that is simply
> to stop the node and reset it.
>
> However, the queues on the reseted node will be lost, you'll need to re-declare
> them.  HA queues will survive if they reside on more nodes apart from the
> reseted one.
>
> ---
> Francesco
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From irmo.manie at gmail.com  Mon Oct 15 10:49:51 2012
From: irmo.manie at gmail.com (Irmo Manie)
Date: Mon, 15 Oct 2012 11:49:51 +0200
Subject: [rabbitmq-discuss] Memory limit cleanup, hanging connections.
Message-ID: <CAAcXTOYbW=wAuD77ZDLTjQzGO+yZtCfO9BKuO5qK2HptJF7eeA@mail.gmail.com>

Hi,

We ran into a situation where we hit a memory limit by queues being filled
upt, causing all connections to be in a blocked or blocking state.

We're killed all connections from the client side and deleted the filled up
queues.
While the broker is still cleaning up /msg_store_transient (which is
horribly slow), it also still lists all the connections as alive, being
still blocked.

Is it possible that when the broker is still in memory alarm mode, the
connections (blocked) are not checked for their heartbeat and therefore are
kept alive?

And what is the cause of the slowness of the cleanup when deleting queues
with only transient messages?

- Irmo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/0db0b661/attachment.htm>

From ymmudym at gmail.com  Mon Oct 15 11:03:18 2012
From: ymmudym at gmail.com (vedanth)
Date: Mon, 15 Oct 2012 03:03:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Dealing with Java JMS client
Message-ID: <1350295398067-22559.post@n5.nabble.com>

Hi Everyone,		Am trying to use openamq java jms client with rabbit mq(Version
rabbitmq-server-2.8.7-.noarch.rpm).I have downloaded the openamq jms client
from *https://github.com/imatix/openamq-jms* which currently implements 0.9
amqp spec. When i execute the sample program as suggested in *readme.txt* i
get an exception which says "Unsupported field table type". Detailed
stacktrace bin]# ./serviceProvidingClient.sh 192.168.2.41:5672 guest guest
/main 2012-10-15 14:53:18,260 INFO
[org.openamq.requestreply1.ServiceProvidingClient] Starting...106 [main]
INFO org.openamq.client.transport.SocketTransportConnection - Attempting
connection to apache.treetechnologies.net:5672324 [AnonymousIoService-1-1]
INFO org.openamq.client.protocol.AMQProtocolHandler - Exception caught
therefore going to attempt failover:
org.apache.mina.filter.codec.ProtocolDecoderException:
org.openamq.framing.AMQFrameDecodingException: Unsupported field table type:
F (70), length=290, sizeRead=0, sizeRemaining=318 (Hexdump: 00 00 00 58 12
70 75 62 6C 69 73 68 65 72 5F 63 6F 6E 66 69 72 6D 73 74 01 1A 65 78 63 68
61 6E 67 65 5F 65 78 63 68 61 6E 67 65 5F 62 69 6E 64 69 6E 67 73 74 01 0A
62 61 73 69 63 2E 6E 61 63 6B 74 01 16 63 6F 6E 73 75 6D 65 72 5F 63 61 6E
63 65 6C 5F 6E 6F 74 69 66 79 74 01 09 63 6F 70 79 72 69 67 68 74 53 00 00
00 24 43 6F 70 79 72 69 67 68 74 20 28 43 29 20 32 30 30 37 2D 32 30 31 32
20 56 4D 77 61 72 65 2C 20 49 6E 63 2E 0B 69 6E 66 6F 72 6D 61 74 69 6F 6E
53 00 00 00 35 4C 69 63 65 6E 73 65 64 20 75 6E 64 65 72 20 74 68 65 20 4D
50 4C 2E 20 20 53 65 65 20 68 74 74 70 3A 2F 2F 77 77 77 2E 72 61 62 62 69
74 6D 71 2E 63 6F 6D 2F 08 70 6C 61 74 66 6F 72 6D 53 00 00 00 0A 45 72 6C
61 6E 67 2F 4F 54 50 07 70 72 6F 64 75 63 74 53 00 00 00 08 52 61 62 62 69
74 4D 51 07 76 65 72 73 69 6F 6E 53 00 00 00 05 32 2E 38 2E 37 00 00 00 0E
50 4C 41 49 4E 20 41 4D 51 50 4C 41 49 4E 00 00 00 05 65 6E 5F 55 53
CE)org.apache.mina.filter.codec.ProtocolDecoderException:
org.openamq.framing.AMQFrameDecodingException: Unsupported field table type:
F (70), length=290, sizeRead=0, sizeRemaining=318 (Hexdump: 00 00 00 58 12
70 75 62 6C 69 73 68 65 72 5F 63 6F 6E 66 69 72 6D 73 74 01 1A 65 78 63 68
61 6E 67 65 5F 65 78 63 68 61 6E 67 65 5F 62 69 6E 64 69 6E 67 73 74 01 0A
62 61 73 69 63 2E 6E 61 63 6B 74 01 16 63 6F 6E 73 75 6D 65 72 5F 63 61 6E
63 65 6C 5F 6E 6F 74 69 66 79 74 01 09 63 6F 70 79 72 69 67 68 74 53 00 00
00 24 43 6F 70 79 72 69 67 68 74 20 28 43 29 20 32 30 30 37 2D 32 30 31 32
20 56 4D 77 61 72 65 2C 20 49 6E 63 2E 0B 69 6E 66 6F 72 6D 61 74 69 6F 6E
53 00 00 00 35 4C 69 63 65 6E 73 65 64 20 75 6E 64 65 72 20 74 68 65 20 4D
50 4C 2E 20 20 53 65 65 20 68 74 74 70 3A 2F 2F 77 77 77 2E 72 61 62 62 69
74 6D 71 2E 63 6F 6D 2F 08 70 6C 61 74 66 6F 72 6D 53 00 00 00 0A 45 72 6C
61 6E 67 2F 4F 54 50 07 70 72 6F 64 75 63 74 53 00 00 00 08 52 61 62 62 69
74 4D 51 07 76 65 72 73 69 6F 6E 53 00 00 00 05 32 2E 38 2E 37 00 00 00 0E
50 4C 41 49 4E 20 41 4D 51 50 4C 41 49 4E 00 00 00 05 65 6E 5F 55 53 CE)       
at
org.apache.mina.filter.codec.ProtocolCodecFilter.messageReceived(ProtocolCodecFilter.java:169)       
at
org.apache.mina.common.support.AbstractIoFilterChain.callNextMessageReceived(AbstractIoFilterChain.java:501)       
at
org.apache.mina.common.support.AbstractIoFilterChain.access$1000(AbstractIoFilterChain.java:51)       
at
org.apache.mina.common.support.AbstractIoFilterChain$EntryImpl$1.messageReceived(AbstractIoFilterChain.java:788)       
at
org.apache.mina.filter.ThreadPoolFilter.processEvent(ThreadPoolFilter.java:718)       
at
org.apache.mina.filter.ThreadPoolFilter$Worker.processEvents(ThreadPoolFilter.java:474)       
at
org.apache.mina.filter.ThreadPoolFilter$Worker.run(ThreadPoolFilter.java:429)Caused
by: org.openamq.framing.AMQFrameDecodingException: Unsupported field table
type: F (70), length=290, sizeRead=0, sizeRemaining=318        at
org.openamq.framing.FieldTable.(FieldTable.java:65)        at
org.openamq.framing.EncodingUtils.readFieldTable(EncodingUtils.java:264)       
at
org.openamq.framing.ConnectionStartBody.populateMethodBodyFromBuffer(ConnectionStartBody.java:58)       
at
org.openamq.framing.AMQMethodBody.populateFromBuffer(AMQMethodBody.java:46)       
at org.openamq.framing.AMQFrame.populateFromBuffer(AMQFrame.java:49)       
at
org.openamq.framing.AMQDataBlockDecoder.createAndPopulateFrame(AMQDataBlockDecoder.java:82)       
at
org.openamq.framing.AMQDataBlockDecoder.decode(AMQDataBlockDecoder.java:95)       
at org.openamq.codec.AMQDecoder.doDecodeDataBlock(AMQDecoder.java:54)       
at org.openamq.codec.AMQDecoder.doDecode(AMQDecoder.java:37)        at
org.apache.mina.filter.codec.CumulativeProtocolDecoder.decode(CumulativeProtocolDecoder.java:97)       
at
org.apache.mina.filter.codec.ProtocolCodecFilter.messageReceived(ProtocolCodecFilter.java:158)       
... 6 more334 [AnonymousIoService-1-1] INFO
org.openamq.client.protocol.AMQProtocolHandler - Session closed called with
failover state currently FailoverState: NOT STARTED334
[AnonymousIoService-1-1] INFO org.openamq.client.protocol.AMQProtocolHandler
- Protocol Session [org.openamq.client.protocol.AMQProtocolHandler at 69945ce]
closed341 [main] INFO org.openamq.client.AMQConnection - Unable to connect
to broker at 192.168.2.41:5672org.openamq.AMQException: Error:
org.openamq.client.protocol.FailoverException: Failing over about to start       
at
org.openamq.client.state.StateWaiter.waituntilStateHasChanged(StateWaiter.java:59)       
at
org.openamq.client.state.AMQStateManager.attainState(AMQStateManager.java:204)       
at
org.openamq.client.protocol.AMQProtocolHandler.attainState(AMQProtocolHandler.java:392)       
at
org.openamq.client.AMQConnection.makeBrokerConnection(AMQConnection.java:247)       
at org.openamq.client.AMQConnection.(AMQConnection.java:181)        at
org.openamq.client.AMQConnection.(AMQConnection.java:154)        at
org.openamq.requestreply1.ServiceProvidingClient.(ServiceProvidingClient.java:28)       
at
org.openamq.requestreply1.ServiceProvidingClient.main(ServiceProvidingClient.java:152)Caused
by: org.openamq.client.protocol.FailoverException: Failing over about to
start        at
org.openamq.client.protocol.AMQProtocolHandler$FailoverHandler.run(AMQProtocolHandler.java:93)       
at java.lang.Thread.run(Thread.java:679)345 [Thread-2] INFO
org.openamq.client.protocol.AMQProtocolHandler - Starting failover
processmain 2012-10-15 14:53:18,650 ERROR
[org.openamq.requestreply1.ServiceProvidingClient] Error:
org.openamq.AMQException: Unable to connect to any specified broker in list
192.168.2.41:5672org.openamq.AMQException: Unable to connect to any
specified broker in list 192.168.2.41:5672        at
org.openamq.client.AMQConnection.(AMQConnection.java:198)        at
org.openamq.client.AMQConnection.(AMQConnection.java:154)        at
org.openamq.requestreply1.ServiceProvidingClient.(ServiceProvidingClient.java:28)       
at
org.openamq.requestreply1.ServiceProvidingClient.main(ServiceProvidingClient.java:152)10119
[AnonymousIoService-1-2] INFO org.openamq.client.protocol.AMQProtocolHandler
- Session closed called with failover state currently FailoverState: IN
PROGRESS10119 [AnonymousIoService-1-2] INFO
org.openamq.client.protocol.AMQProtocolHandler - Protocol Session
[org.openamq.client.protocol.AMQProtocolHandler at 69945ce] closed[root at apache
bin]#Any help on using java jms client with rabbitmq-server-2.8.7 would be
of great help



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Dealing-with-Java-JMS-client-tp22559.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/98269cc4/attachment.htm>

From tim at rabbitmq.com  Mon Oct 15 11:22:52 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 15 Oct 2012 11:22:52 +0100
Subject: [rabbitmq-discuss] Loss of queues after network partition?
In-Reply-To: <CACLE7iyF8XFc2hGmy0YyaUJmGkV05dDZ6v5dXOsTJeq_6+KcKg@mail.gmail.com>
References: <CACLE7iyF8XFc2hGmy0YyaUJmGkV05dDZ6v5dXOsTJeq_6+KcKg@mail.gmail.com>
Message-ID: <507BE3FC.30104@rabbitmq.com>

Hi Matt,

This is a problem we're aware of (i.e., we have an open bug which we're 
working on!) and are looking at ways of handling it. What is basically 
happening here is that mnesia gets into an inconsistent state due to a 
network partition and the mnesia transaction manager sends unanticipated 
(and unhandled) messages to certain Erlang processes causing a crash.

Whilst this falls into the category of "Rabbit clusters do not handle 
network partitions" obviously we want to prevent this sort of thing 
happening and as I say, we're looking at various ways of responding in a 
somewhat more user friendly manner.

In the meanwhile, I'd be very interested to see if the queue information 
has actually been deleted from mnesia when this happens. Are these HA 
queues durable and do they all "come back to life" after restarting the 
node(s)?

Cheers,
Tim

On 10/12/2012 09:01 PM, Matt Pietrek wrote:
> I'll be the first to admit that this is a somewhat unusual/complicated 
> circumstance, but I'm posting this on the chance there's something 
> unusual. This is RabbitMQ is *2.8.7 *on Erlang R15B01.
>
> We have two brokers (mq1, mq2) running clustered with all HA queues. A 
> VIP is in front of them.
>
> At some point there was a network event, and afterwards, a queue 
> vanished. (Still trying to figure out exactly what the network hiccup 
> was, but it's fair to say there was a communication disruption between 
> the nodes.)  My guess from looking at the logs is that each node had a 
> moment where it couldn't see the other, so took actions that were 
> ultimately incompatible when both nodes were visible to each other.
>
> The actual error as seen by our code is a missing queue named 
> "charon". You'll see it near the end of the rabbit at mq2.log (below):
>
> *{amqp_error,not_found,"no queue 'charon' in vhost '/'",'queue.declare'}*
>
> Prior to the network event, our client was successfully reading from 
> the charon queue.
>
>
> *Here's the relevant parts of the rabbit at mq1.log file
> ====================================================*
> =INFO REPORT==== 11-Oct-2012::14:01:58 ===
> rabbit on node rabbit at mq2 down
>
> =ERROR REPORT==== 11-Oct-2012::14:02:03 ===
> Mnesia(rabbit at mq1): ** ERROR ** mnesia_event got 
> {inconsistent_database, running_partitioned_network, rabbit at mq2}
>
> =ERROR REPORT==== 11-Oct-2012::14:02:03 ===
> ** Generic server <0.547.0> terminating
> ** Last message in was {mnesia_locker,rabbit at mq2,granted}
> ** When Server state == {state,
>                             {0,<0.547.0>},
>                             {{0,<0.547.0>},undefined},
>                             {{0,<0.547.0>},undefined},
>                             {resource,<<"/">>,queue,<<"charon">>},
>                             rabbit_mirror_queue_coordinator,
>                             {3,
>                              [{{0,<0.547.0>},
>                                {view_member,
>                                    {0,<0.547.0>},
>                                    [],
>                                    {0,<0.547.0>},
>                                    {0,<0.547.0>}}}]},
>                             1,[],
>                             [<0.546.0>],
>                             {[],[]},
>                             [],undefined}
> ** Reason for termination ==
> ** {function_clause,
>        [{gm,handle_info,
>             [{mnesia_locker,rabbit at mq2,granted},
>              {state,
>                  {0,<0.547.0>},
>                  {{0,<0.547.0>},undefined},
>                  {{0,<0.547.0>},undefined},
>                  {resource,<<"/">>,queue,<<"charon">>},
>                  rabbit_mirror_queue_coordinator,
>                  {3,
>                   [{{0,<0.547.0>},
>                     {view_member,
>                         {0,<0.547.0>},
>                         [],
>                         {0,<0.547.0>},
>                         {0,<0.547.0>}}}]},
>                  1,[],
>                  [<0.546.0>],
>                  {[],[]},
>                  [],undefined}],
>             [{file,"src/gm.erl"},{line,665}]},
>         
> {gen_server2,handle_msg,2,[{file,"src/gen_server2.erl"},{line,912}]},
>         {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}
>
> =ERROR REPORT==== 11-Oct-2012::14:02:03 ===
> ** Generic server <0.545.0> terminating
> ** Last message in was {'EXIT',<0.546.0>,
>                         {function_clause,
>                          [{gm,handle_info,
>                            [{mnesia_locker,rabbit at mq2,granted},
>                             {state,
>                              {0,<0.547.0>},
>                              {{0,<0.547.0>},undefined},
>                              {{0,<0.547.0>},undefined},
>                              {resource,<<"/">>,queue,<<"charon">>},
>                              rabbit_mirror_queue_coordinator,
>                              {3,
>                               [{{0,<0.547.0>},
>                                 {view_member,
>                                  {0,<0.547.0>},
>                                  [],
>                                  {0,<0.547.0>},
>                                  {0,<0.547.0>}}}]},
>                              1,[],
>                              [<0.546.0>],
>                              {[],[]},
>                              [],undefined}],
>                            [{file,"src/gm.erl"},{line,665}]},
>                           {gen_server2,handle_msg,2,
>                            [{file,"src/gen_server2.erl"},{line,912}]},
>                           {proc_lib,wake_up,3,
>                            [{file,"proc_lib.erl"},{line,237}]}]}}
> ** When Server state == {q,
>                          {amqqueue,
>                           {resource,<<"/">>,queue,<<"charon">>},
>                           true,false,none,
>                           [{<<"x-ha-policy">>,longstr,<<"all">>}],
> <0.545.0>,[],all},
>                          none,false,rabbit_mirror_queue_master,
>                          {state,<0.547.0>,<0.546.0>,rabbit_variable_queue,
>                           {vqstate,
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            {delta,undefined,0,undefined},
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            0,
>                            {0,nil},
>                            undefined,
>                            {0,nil},
>                            {qistate,
>                             
> "/highland/var/lib/rabbit at mq1/queues/4L2SY4TVRPM8HP85JDVO85BPL",
>                             {{dict,0,16,16,8,80,48,
>                               
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>                               
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              []},
>                             undefined,0,262144,
>                             #Fun<rabbit_variable_queue.2.121500735>,
>                             {0,nil}},
>                            {{client_msstate,msg_store_persistent,
> <<112,32,84,92,54,73,67,43,231,35,164,79,106,8,27,
>                                132>>,
>                              {dict,0,16,16,8,80,48,
>                               
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>                               
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              {state,237637,
>                               
> "/highland/var/lib/rabbit at mq1/msg_store_persistent"},
>                              rabbit_msg_store_ets_index,
>                              
> "/highland/var/lib/rabbit at mq1/msg_store_persistent",
> <0.289.0>,241734,233540,245831,249928},
>                             {client_msstate,msg_store_transient,
> <<204,18,155,40,29,120,124,76,144,83,195,135,250,
>                                91,216,3>>,
>                              {dict,0,16,16,8,80,48,
>                               
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>                               
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              {state,217152,
>                               
> "/highland/var/lib/rabbit at mq1/msg_store_transient"},
>                              rabbit_msg_store_ets_index,
>                              
> "/highland/var/lib/rabbit at mq1/msg_store_transient",
> <0.284.0>,221249,213055,225346,229443}},
>                            
> true,0,#Fun<rabbit_amqqueue_process.5.24780734>,0,
>                            0,infinity,0,0,0,0,0,
>                            {rates,
>                             {{1349,988602,967125},0},
>                             {{1349,988602,967125},0},
>                             0.0,0.0,
>                             {1349,988606,141019}},
>                            {0,nil},
>                            {0,nil},
>                            {0,nil},
>                            {0,nil},
>                            0,0,
>                            {rates,
>                             {{1349,988602,967125},0},
>                             {{1349,988602,967125},0},
>                             0.0,0.0,
>                             {1349,988606,141019}}},
>                           0,
>                           {dict,0,16,16,8,80,48,
>                            
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}},
>                           [],
>                           {dict,0,16,16,8,80,48,
>                            
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}},
>                           {set,0,16,16,8,80,48,
>                            
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}}},
>                          {[],[]},
>                          undefined,undefined,undefined,undefined,
>                          {state,fine,5000,undefined},
>                          {0,nil},
>                          undefined,undefined,undefined,
>                          {dict,0,16,16,8,80,48,
>                           
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                           
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                          1,
>                          {{0,nil},{0,nil}},
>                          undefined,
>                          {dict,0,16,16,8,80,48,
>                           
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                           
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                          undefined,undefined}
> ** Reason for termination ==
> ** {noproc,{gen_server2,call,[<0.547.0>,info,infinity]}}
> ** In 'terminate' callback with reason ==
> ** {function_clause,
>        [{gm,handle_info,
>             [{mnesia_locker,rabbit at mq2,granted},
>              {state,
>                  {0,<0.547.0>},
>                  {{0,<0.547.0>},undefined},
>                  {{0,<0.547.0>},undefined},
>                  {resource,<<"/">>,queue,<<"charon">>},
>                  rabbit_mirror_queue_coordinator,
>                  {3,
>                   [{{0,<0.547.0>},
>                     {view_member,
>                         {0,<0.547.0>},
>                         [],
>                         {0,<0.547.0>},
>                         {0,<0.547.0>}}}]},
>                  1,[],
>                  [<0.546.0>],
>                  {[],[]},
>                  [],undefined}],
>             [{file,"src/gm.erl"},{line,665}]},
>         
> {gen_server2,handle_msg,2,[{file,"src/gen_server2.erl"},{line,912}]},
>         {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}
>
> =INFO REPORT==== 11-Oct-2012::14:02:03 ===
> Mirrored-queue (queue 'cmcmd' in vhost '/'): Master 
> <rabbit at mq1.2.665.0> saw deaths of mirrors <rabbit at mq2.1.383.0>
>
> =INFO REPORT==== 11-Oct-2012::14:02:03 ===
> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Master 
> <rabbit at mq1.2.605.0> saw deaths of mirrors <rabbit at mq2.1.377.0>
>
> =INFO REPORT==== 11-Oct-2012::14:02:03 ===
> global: Name conflict terminating {rabbit_mgmt_db,<3198.32532.0>}
>
> =INFO REPORT==== 11-Oct-2012::14:26:40 ===
> accepting AMQP connection <0.6507.1> (10.72.0.50:46742 
> <http://10.72.0.50:46742> -> 10.72.0.47:5672 <http://10.72.0.47:5672>)
>
> =INFO REPORT==== 11-Oct-2012::14:26:40 ===
> closing AMQP connection <0.6507.1> (10.72.0.50:46742 
> <http://10.72.0.50:46742> -> 10.72.0.47:5672 <http://10.72.0.47:5672>)
>
>
>
>
> *And here's the relevant parts of the rabbit at m2.log file
> ====================================================*
> =ERROR REPORT==== 11-Oct-2012::14:01:37 ===
> ** Node rabbit at mq1 not responding **
> ** Removing (timedout) connection **
>
> =INFO REPORT==== 11-Oct-2012::14:01:37 ===
> rabbit on node rabbit at mq1 down
>
> =INFO REPORT==== 11-Oct-2012::14:01:40 ===
> Statistics database started.
>
> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
> Mirrored-queue (queue 'cmcmd' in vhost '/'): Slave 
> <rabbit at mq2.1.383.0> saw deaths of mirrors <rabbit at mq1.2.665.0>
>
> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
> Mirrored-queue (queue 'cmcmd' in vhost '/'): Promoting slave 
> <rabbit at mq2.1.383.0> to master
>
> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
> Mirrored-queue (queue 'charon' in vhost '/'): Slave 
> <rabbit at mq2.1.371.0> saw deaths of mirrors <rabbit at mq1.2.545.0>
>
> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
> Mirrored-queue (queue 'charon' in vhost '/'): Promoting slave 
> <rabbit at mq2.1.371.0> to master
>
> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Slave 
> <rabbit at mq2.1.377.0> saw deaths of mirrors <rabbit at mq1.2.605.0>
>
> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Promoting 
> slave <rabbit at mq2.1.377.0> to master
>
> =ERROR REPORT==== 11-Oct-2012::14:05:03 ===
> Mnesia(rabbit at mq2): ** ERROR ** mnesia_event got 
> {inconsistent_database, running_partitioned_network, rabbit at mq1}
>
> =INFO REPORT==== 11-Oct-2012::14:05:03 ===
> Statistics database started.
>
> =ERROR REPORT==== 11-Oct-2012::14:29:39 ===
> ** Generic server <0.32583.0> terminating
> ** Last message in was {'$gen_cast',{gm_deaths,[<0.5504.1>]}}
> ** When Server state == {state,
>                             {amqqueue,
>                                 {resource,<<"/">>,queue,<<"charon">>},
>                                 true,false,none,
>                                 [{<<"x-ha-policy">>,longstr,<<"all">>}],
> <0.371.0>,[],all},
> <0.372.0>,
>                             {dict,0,16,16,8,80,48,
>                                 
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}},
>                             #Fun<rabbit_mirror_queue_master.1.32244930>,
>                             #Fun<rabbit_mirror_queue_master.2.32244930>}
> ** Reason for termination ==
> ** {bad_return_value,
>        {error,
>            {{badmatch,[]},
>             [{rabbit_mirror_queue_misc,'-remove_from_queue/2-fun-0-',2,
>                  [{file,"src/rabbit_mirror_queue_misc.erl"},{line,63}]},
>              {mnesia_tm,apply_fun,3,[{file,"mnesia_tm.erl"},{line,829}]},
>              {mnesia_tm,execute_transaction,5,
>                  [{file,"mnesia_tm.erl"},{line,809}]},
>              {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1,
>                  [{file,"src/rabbit_misc.erl"},{line,440}]},
>              {worker_pool_worker,handle_call,3,
>                  [{file,"src/worker_pool_worker.erl"},{line,80}]},
>              {gen_server2,handle_msg,2,
>                  [{file,"src/gen_server2.erl"},{line,879}]},
>              {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}}}
>
> =ERROR REPORT==== 11-Oct-2012::14:29:39 ===
> ** Generic server <0.371.0> terminating
> ** Last message in was {'EXIT',<0.32583.0>,
>                         {bad_return_value,
>                          {error,
>                           {{badmatch,[]},
>                            [{rabbit_mirror_queue_misc,
>                              '-remove_from_queue/2-fun-0-',2,
>                              [{file,"src/rabbit_mirror_queue_misc.erl"},
>                               {line,63}]},
>                             {mnesia_tm,apply_fun,3,
>                              [{file,"mnesia_tm.erl"},{line,829}]},
>                             {mnesia_tm,execute_transaction,5,
>                              [{file,"mnesia_tm.erl"},{line,809}]},
>                             {rabbit_misc,
>                              '-execute_mnesia_transaction/1-fun-0-',1,
>                              [{file,"src/rabbit_misc.erl"},{line,440}]},
>                             {worker_pool_worker,handle_call,3,
>                              
> [{file,"src/worker_pool_worker.erl"},{line,80}]},
>                             {gen_server2,handle_msg,2,
>                              [{file,"src/gen_server2.erl"},{line,879}]},
>                             {proc_lib,wake_up,3,
>                              [{file,"proc_lib.erl"},{line,237}]}]}}}}
> ** When Server state == {q,
>                          {amqqueue,
>                           {resource,<<"/">>,queue,<<"charon">>},
>                           true,false,none,
>                           [{<<"x-ha-policy">>,longstr,<<"all">>}],
> <0.371.0>,[],all},
>                          none,false,rabbit_mirror_queue_master,
>                          
> {state,<0.372.0>,<0.32583.0>,rabbit_variable_queue,
>                           {vqstate,
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            {delta,undefined,0,undefined},
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            0,
>                            {0,nil},
>                            undefined,
>                            {0,nil},
>                            {qistate,
>                             
> "/highland/var/lib/rabbit at mq2/queues/4L2SY4TVRPM8HP85JDVO85BPL",
>                             {{dict,0,16,16,8,80,48,
>                               
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>                               
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              []},
>                             undefined,0,262144,
>                             #Fun<rabbit_variable_queue.2.121500735>,
>                             {0,nil}},
>                            {{client_msstate,msg_store_persistent,
> <<23,245,132,154,3,96,225,184,108,75,232,224,184,
>                                114,108,141>>,
>                              {dict,0,16,16,8,80,48,
>                               
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>                               
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              {state,282693,
>                               
> "/highland/var/lib/rabbit at mq2/msg_store_persistent"},
>                              rabbit_msg_store_ets_index,
>                              
> "/highland/var/lib/rabbit at mq2/msg_store_persistent",
> <0.285.0>,286790,278596,290887,294984},
>                             {client_msstate,msg_store_transient,
> <<17,62,75,125,126,21,66,37,170,44,198,72,18,94,
>                                170,197>>,
>                              {dict,0,16,16,8,80,48,
>                               
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>                               
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              {state,262208,
>                               
> "/highland/var/lib/rabbit at mq2/msg_store_transient"},
>                              rabbit_msg_store_ets_index,
>                              
> "/highland/var/lib/rabbit at mq2/msg_store_transient",
> <0.280.0>,266305,258111,270402,274499}},
>                            
> true,0,#Fun<rabbit_mirror_queue_slave.1.69615989>,
>                            0,0,infinity,0,0,0,0,0,
>                            {rates,
>                             {{1349,989325,677031},0},
>                             {{1349,989325,677031},0},
>                             0.0,0.0,
>                             {1349,989505,348090}},
>                            {0,nil},
>                            {0,nil},
>                            {0,nil},
>                            {0,nil},
>                            0,0,
>                            {rates,
>                             {{1349,989325,677031},0},
>                             {{1349,989325,677031},0},
>                             0.0,0.0,
>                             {1349,989505,348090}}},
>                           0,
>                           {dict,0,16,16,8,80,48,
>                            
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}},
>                           [],
>                           {dict,0,16,16,8,80,48,
>                            
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}},
>                           {set,0,16,16,8,80,48,
>                            
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}}},
>                          {[],[]},
>                          undefined,undefined,undefined,undefined,
>                          {state,fine,5000,undefined},
>                          {0,nil},
>                          undefined,undefined,undefined,
>                          {dict,0,16,16,8,80,48,
>                           
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                           
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                          1,
>                          {{0,nil},{0,nil}},
>                          undefined,
>                          {dict,0,16,16,8,80,48,
>                           
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                           
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                          undefined,undefined}
> ** Reason for termination ==
> ** {noproc,{gen_server2,call,[<0.372.0>,info,infinity]}}
> ** In 'terminate' callback with reason ==
> ** {bad_return_value,
>        {error,
>            {{badmatch,[]},
>             [{rabbit_mirror_queue_misc,'-remove_from_queue/2-fun-0-',2,
>                  [{file,"src/rabbit_mirror_queue_misc.erl"},{line,63}]},
>              {mnesia_tm,apply_fun,3,[{file,"mnesia_tm.erl"},{line,829}]},
>              {mnesia_tm,execute_transaction,5,
>                  [{file,"mnesia_tm.erl"},{line,809}]},
>              {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1,
>                  [{file,"src/rabbit_misc.erl"},{line,440}]},
>              {worker_pool_worker,handle_call,3,
>                  [{file,"src/worker_pool_worker.erl"},{line,80}]},
>              {gen_server2,handle_msg,2,
>                  [{file,"src/gen_server2.erl"},{line,879}]},
>              {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}}}
>
> =INFO REPORT==== 11-Oct-2012::14:29:43 ===
> accepting AMQP connection <0.5524.1> (10.72.0.23:36056 
> <http://10.72.0.23:36056> -> 10.72.0.56:5672 <http://10.72.0.56:5672>)
>
> =INFO REPORT==== 11-Oct-2012::14:29:44 ===
> accepting AMQP connection <0.5574.1> (10.72.0.23:36064 
> <http://10.72.0.23:36064> -> 10.72.0.56:5672 <http://10.72.0.56:5672>)
>
> =INFO REPORT==== 11-Oct-2012::17:56:16 ===
> accepting AMQP connection <0.23868.1> (10.72.0.53:57122 
> <http://10.72.0.53:57122> -> 10.72.0.56:5672 <http://10.72.0.56:5672>)
>
> =ERROR REPORT==== 11-Oct-2012::17:56:16 ===
> connection <0.23868.1>, channel 1 - error:
> {amqp_error,not_found,"no queue 'charon' in vhost '/'",'queue.declare'}
>
> =WARNING REPORT==== 11-Oct-2012::17:56:16 ===
> closing AMQP connection <0.23868.1> (10.72.0.53:57122 
> <http://10.72.0.53:57122> -> 10.72.0.56:5672 <http://10.72.0.56:5672>):
> connection_closed_abruptly
>
> =INFO REPORT==== 11-Oct-2012::17:56:16 ===
> accepting AMQP connection <0.23878.1> (10.72.0.52:56025 
> <http://10.72.0.52:56025> -> 10.72.0.56:5672 <http://10.72.0.56:5672>)
>
> =ERROR REPORT==== 11-Oct-2012::17:56:16 ===
> connection <0.23878.1>, channel 1 - error:
> {amqp_error,not_found,"no queue 'charon' in vhost '/'",'queue.declare'}
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/f61759f4/attachment.htm>

From simon at rabbitmq.com  Mon Oct 15 11:38:33 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 15 Oct 2012 11:38:33 +0100
Subject: [rabbitmq-discuss] Disable Per-Connection Flow Control
In-Reply-To: <CAHo58sjJYn3XiBguctA2ohvrfeh1EjUqU_018==7cTAAYcVDhw@mail.gmail.com>
References: <9672780c-6a7b-4ef2-91fe-97ec82b2fb2c@googlegroups.com>
	<5077FB88.6060208@rabbitmq.com>
	<CAHo58sjJYn3XiBguctA2ohvrfeh1EjUqU_018==7cTAAYcVDhw@mail.gmail.com>
Message-ID: <507BE7A9.7090000@rabbitmq.com>

On 13/10/12 02:16, Dwayne Campbell wrote:
> Simon,
>
> Thank you very much for your reply.

No problem!

> Using HIPE compilation reduced the flow control significantly.I now get
> flow controlled at around 4.1 MB/S to 7.2 MB/S .However flow control
>   seems to steadily remain on at 3.8MB/s for the rest of the time
> RabbitMQ runs.

When sending tiny messages almost all of your costs are per message 
rather than per byte - so it makes more sense to think in terms of the 
number of messages / second rather than bytes / second.

> Each message is about approximately 300 bytes at most 800 bytes
>
>
> Multiple connections(independent applications) will be made from the
> same host to the RabbitMQ Server. Each connection will be sending small
> messages really fast to the broker(RabbitMQ Server)____

I'm not currently sure about whether you've been describing the 
behaviour of a live system or some tests you've been running - if you've 
been describing tests then bear in mind that RabbitMQ will exhibit a 
reasonable amount of parallelism - so just testing with one connection 
will not tell you the total message rate you can handle.

> What optimizations can be made to increase throughput on RabbitMQ Server
> or the routing part of the pipeline ?

It sounds like you're CPU bound in routing - so the next step is to 
ensure your routing is as simple as possible. Exchange type is the 
primary factor here. Headers is (a lot) slower than topic, topic is 
slower than direct and direct is slower than fanout (except in the 
default direct exchange, which is as fast as fanout).

> Would cluster be the next option to evaluate ?

Yes, it should scale pretty much linearly for this workload.

> Is there any output that i can gather to analyze which part of
> the pipeline is the bottleneck ?

Not at the moment within RabbitMQ; future releases might expose more 
details about this. But in the tiny-non-persistent-messages (I think 
your messages are not persistent?) case it's usually routing, with 
framing coming a close second.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Oct 15 11:44:48 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 15 Oct 2012 11:44:48 +0100
Subject: [rabbitmq-discuss] Memory limit cleanup, hanging connections.
In-Reply-To: <CAAcXTOYbW=wAuD77ZDLTjQzGO+yZtCfO9BKuO5qK2HptJF7eeA@mail.gmail.com>
References: <CAAcXTOYbW=wAuD77ZDLTjQzGO+yZtCfO9BKuO5qK2HptJF7eeA@mail.gmail.com>
Message-ID: <507BE920.4080405@rabbitmq.com>

On 15/10/12 10:49, Irmo Manie wrote:
> Hi,
>
> We ran into a situation where we hit a memory limit by queues being
> filled upt, causing all connections to be in a blocked or blocking state.
>
> We're killed all connections from the client side and deleted the filled
> up queues.
> While the broker is still cleaning up /msg_store_transient (which is
> horribly slow), it also still lists all the connections as alive, being
> still blocked.
>
> Is it possible that when the broker is still in memory alarm mode, the
> connections (blocked) are not checked for their heartbeat and therefore
> are kept alive?

Yes, that's absolutely correct. The blocked connections don't perform 
any network operations at all - which means that not only don't they 
check for heartbeats, they don't even detect the TCP connection being 
torn down. As soon as the memory alarm clears, the connections will 
unblock, notice the TCP connection having gone away, and vanish.

> And what is the cause of the slowness of the cleanup when deleting
> queues with only transient messages?

If you've "filled up" all your queues then they will have been paging to 
disc for some time - cleaning all that up can be quite slow.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Oct 15 11:45:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 15 Oct 2012 11:45:57 +0100
Subject: [rabbitmq-discuss] protecting the cluster from large messages
In-Reply-To: <c99aa6c6-9d2c-414b-b3f7-9bda61b3c8d4@googlegroups.com>
References: <c99aa6c6-9d2c-414b-b3f7-9bda61b3c8d4@googlegroups.com>
Message-ID: <507BE965.1020808@rabbitmq.com>

On 14/10/12 06:35, Mark Ward wrote:
> Does RabbitMQ have a feature to discard a message before saving it to a
> queue and mirroring the message if it is greater than a
> specific/customized size?  I am thinking a message size check would
> prevent a cluster crash because a client sent messages to big to process
> and mirror.

No, it doesn't. This might be introduced in future.

> If so how would I go about setting this up?
>
> I have not found enough information if the frame size is something I can
> try.

The frame size won't help I'm afraid.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Mon Oct 15 11:44:46 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 15 Oct 2012 11:44:46 +0100
Subject: [rabbitmq-discuss] What can cause mnesia partitioning?
In-Reply-To: <CALKcMwLx8N1KgbXjDpSKAAPX8szouTxMJCof3+YcF+Jm0oOCBQ@mail.gmail.com>
References: <CALKcMwLx8N1KgbXjDpSKAAPX8szouTxMJCof3+YcF+Jm0oOCBQ@mail.gmail.com>
Message-ID: <507BE91E.6000401@rabbitmq.com>

Hi

On 10/12/2012 07:06 PM, tsuraan wrote:
> We had a pair of computers running a rabbit cluster, and somehow their
> mnesia databases diverged.  Each computer was running its own rabbit
> happily, but they both had cluster_status messages showing only
> themselves as the only "running" node, and they both had log messages
> to the effect of:
>
> Mnesia('rabbit at node-1'): ** ERROR ** mnesia_event got
> {inconsistent_database, starting_partitioned_network, 'rabbit at node-2'}

This indicates that a netsplit has occurred; A situation that mnesia 
(and therefore clustered rabbit) does not handle well.

> I restarted both rabbit instances, and they both came up in an
> apparently functional single-node instance (cluster_status on each
> still showed the other node as a disc node, but not as a running
> node).  From my reading of http://www.rabbitmq.com/clustering.html, it
> doesn't seem like that should happen, unless each node was somehow
> convinced that it was the most up to date disc node.  Otherwise, one
> of the nodes should have waited 30 seconds for the other one, and then
> crashed if it couldn't be reached, right?  What sort of circumstances
> would cause both nodes to think they were the most up to date, and
> that they should continue running on their own?

A netsplit can cause this to happen. The 30 second delay behaviour is 
for when all the nodes in a cluster have been shut down cleanly, but 
this will not work if the mnesia databases have diverged due to a netsplit.

> Along that line, is there any way to configure a rabbit node to only
> run if it can contact a strict majority of disc nodes?  I think that
> would make this sort of problem less likely to happen, assuming the
> problem stems from a network partition, or perhaps even from some
> period of time where each machine was running while the other was not.

The latter case should not present a problem, as the mnesia databases 
won't have diverged as such, therefore mnesia will synchronise them 
whilst starting up the node that was offline temporarily. In terms of 
configuring rabbit to 'only run if it can contact a strcit majority of 
disc nodes', there are other issues to consider besides the number of 
nodes that can be contacted. Mnesia will not magically recover from 
netsplits without intervention, so this problem is actually non-trivial 
to fix - nevertheless, we are actively looking for solutions to this 
situation!

Cheers,
Tim

From tim at rabbitmq.com  Mon Oct 15 11:46:13 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 15 Oct 2012 11:46:13 +0100
Subject: [rabbitmq-discuss] Dealing with Java JMS client
In-Reply-To: <1350295398067-22559.post@n5.nabble.com>
References: <1350295398067-22559.post@n5.nabble.com>
Message-ID: <507BE975.5000703@rabbitmq.com>

Hi,

RabbitMQ is an implementation of AMQP and does not currently support 
JMS, so this will not work. You will need to the the official RabbitMQ 
java client directly in order to access RabbitMQ.

Cheers,
Tim

On 10/15/2012 11:03 AM, vedanth wrote:
> Hi Everyone, Am trying to use openamq java jms client with rabbit 
> mq(Version rabbitmq-server-2.8.7-.noarch.rpm). I have downloaded the 
> openamq jms client from *https://github.com/imatix/openamq-jms* which 
> currently implements 0.9 amqp spec. When i execute the sample program 
> as suggested in *readme.txt* i get an exception which says 
> "Unsupported field table type". Detailed stacktrace bin]# 
> ./serviceProvidingClient.sh 192.168.2.41:5672 guest guest / main 
> 2012-10-15 14:53:18,260 INFO 
> [org.openamq.requestreply1.ServiceProvidingClient] Starting... 106 
> [main] INFO org.openamq.client.transport.SocketTransportConnection - 
> Attempting connection to apache.treetechnologies.net:5672 324 
> [AnonymousIoService-1-1] INFO 
> org.openamq.client.protocol.AMQProtocolHandler - Exception caught 
> therefore going to attempt failover: 
> org.apache.mina.filter.codec.ProtocolDecoderException: 
> org.openamq.framing.AMQFrameDecodingException: Unsupported field table 
> type: F (70), length=290, sizeRead=0, sizeRemaining=318 (Hexdump: 00 
> 00 00 58 12 70 75 62 6C 69 73 68 65 72 5F 63 6F 6E 66 69 72 6D 73 74 
> 01 1A 65 78 63 68 61 6E 67 65 5F 65 78 63 68 61 6E 67 65 5F 62 69 6E 
> 64 69 6E 67 73 74 01 0A 62 61 73 69 63 2E 6E 61 63 6B 74 01 16 63 6F 
> 6E 73 75 6D 65 72 5F 63 61 6E 63 65 6C 5F 6E 6F 74 69 66 79 74 01 09 
> 63 6F 70 79 72 69 67 68 74 53 00 00 00 24 43 6F 70 79 72 69 67 68 74 
> 20 28 43 29 20 32 30 30 37 2D 32 30 31 32 20 56 4D 77 61 72 65 2C 20 
> 49 6E 63 2E 0B 69 6E 66 6F 72 6D 61 74 69 6F 6E 53 00 00 00 35 4C 69 
> 63 65 6E 73 65 64 20 75 6E 64 65 72 20 74 68 65 20 4D 50 4C 2E 20 20 
> 53 65 65 20 68 74 74 70 3A 2F 2F 77 77 77 2E 72 61 62 62 69 74 6D 71 
> 2E 63 6F 6D 2F 08 70 6C 61 74 66 6F 72 6D 53 00 00 00 0A 45 72 6C 61 
> 6E 67 2F 4F 54 50 07 70 72 6F 64 75 63 74 53 00 00 00 08 52 61 62 62 
> 69 74 4D 51 07 76 65 72 73 69 6F 6E 53 00 00 00 05 32 2E 38 2E 37 00 
> 00 00 0E 50 4C 41 49 4E 20 41 4D 51 50 4C 41 49 4E 00 00 00 05 65 6E 
> 5F 55 53 CE) org.apache.mina.filter.codec.ProtocolDecoderException: 
> org.openamq.framing.AMQFrameDecodingException: Unsupported field table 
> type: F (70), length=290, sizeRead=0, sizeRemaining=318 (Hexdump: 00 
> 00 00 58 12 70 75 62 6C 69 73 68 65 72 5F 63 6F 6E 66 69 72 6D 73 74 
> 01 1A 65 78 63 68 61 6E 67 65 5F 65 78 63 68 61 6E 67 65 5F 62 69 6E 
> 64 69 6E 67 73 74 01 0A 62 61 73 69 63 2E 6E 61 63 6B 74 01 16 63 6F 
> 6E 73 75 6D 65 72 5F 63 61 6E 63 65 6C 5F 6E 6F 74 69 66 79 74 01 09 
> 63 6F 70 79 72 69 67 68 74 53 00 00 00 24 43 6F 70 79 72 69 67 68 74 
> 20 28 43 29 20 32 30 30 37 2D 32 30 31 32 20 56 4D 77 61 72 65 2C 20 
> 49 6E 63 2E 0B 69 6E 66 6F 72 6D 61 74 69 6F 6E 53 00 00 00 35 4C 69 
> 63 65 6E 73 65 64 20 75 6E 64 65 72 20 74 68 65 20 4D 50 4C 2E 20 20 
> 53 65 65 20 68 74 74 70 3A 2F 2F 77 77 77 2E 72 61 62 62 69 74 6D 71 
> 2E 63 6F 6D 2F 08 70 6C 61 74 66 6F 72 6D 53 00 00 00 0A 45 72 6C 61 
> 6E 67 2F 4F 54 50 07 70 72 6F 64 75 63 74 53 00 00 00 08 52 61 62 62 
> 69 74 4D 51 07 76 65 72 73 69 6F 6E 53 00 00 00 05 32 2E 38 2E 37 00 
> 00 00 0E 50 4C 41 49 4E 20 41 4D 51 50 4C 41 49 4E 00 00 00 05 65 6E 
> 5F 55 53 CE) at 
> org.apache.mina.filter.codec.ProtocolCodecFilter.messageReceived(ProtocolCodecFilter.java:169) 
> at 
> org.apache.mina.common.support.AbstractIoFilterChain.callNextMessageReceived(AbstractIoFilterChain.java:501) 
> at 
> org.apache.mina.common.support.AbstractIoFilterChain.access$1000(AbstractIoFilterChain.java:51) 
> at 
> org.apache.mina.common.support.AbstractIoFilterChain$EntryImpl$1.messageReceived(AbstractIoFilterChain.java:788) 
> at 
> org.apache.mina.filter.ThreadPoolFilter.processEvent(ThreadPoolFilter.java:718) 
> at 
> org.apache.mina.filter.ThreadPoolFilter$Worker.processEvents(ThreadPoolFilter.java:474) 
> at 
> org.apache.mina.filter.ThreadPoolFilter$Worker.run(ThreadPoolFilter.java:429) 
> Caused by: org.openamq.framing.AMQFrameDecodingException: Unsupported 
> field table type: F (70), length=290, sizeRead=0, sizeRemaining=318 at 
> org.openamq.framing.FieldTable.(FieldTable.java:65) at 
> org.openamq.framing.EncodingUtils.readFieldTable(EncodingUtils.java:264) 
> at 
> org.openamq.framing.ConnectionStartBody.populateMethodBodyFromBuffer(ConnectionStartBody.java:58) 
> at 
> org.openamq.framing.AMQMethodBody.populateFromBuffer(AMQMethodBody.java:46) 
> at org.openamq.framing.AMQFrame.populateFromBuffer(AMQFrame.java:49) 
> at 
> org.openamq.framing.AMQDataBlockDecoder.createAndPopulateFrame(AMQDataBlockDecoder.java:82) 
> at 
> org.openamq.framing.AMQDataBlockDecoder.decode(AMQDataBlockDecoder.java:95) 
> at org.openamq.codec.AMQDecoder.doDecodeDataBlock(AMQDecoder.java:54) 
> at org.openamq.codec.AMQDecoder.doDecode(AMQDecoder.java:37) at 
> org.apache.mina.filter.codec.CumulativeProtocolDecoder.decode(CumulativeProtocolDecoder.java:97) 
> at 
> org.apache.mina.filter.codec.ProtocolCodecFilter.messageReceived(ProtocolCodecFilter.java:158) 
> ... 6 more 334 [AnonymousIoService-1-1] INFO 
> org.openamq.client.protocol.AMQProtocolHandler - Session closed called 
> with failover state currently FailoverState: NOT STARTED 334 
> [AnonymousIoService-1-1] INFO 
> org.openamq.client.protocol.AMQProtocolHandler - Protocol Session 
> [org.openamq.client.protocol.AMQProtocolHandler at 69945ce] closed 341 
> [main] INFO org.openamq.client.AMQConnection - Unable to connect to 
> broker at 192.168.2.41:5672 org.openamq.AMQException: Error: 
> org.openamq.client.protocol.FailoverException: Failing over about to 
> start at 
> org.openamq.client.state.StateWaiter.waituntilStateHasChanged(StateWaiter.java:59) 
> at 
> org.openamq.client.state.AMQStateManager.attainState(AMQStateManager.java:204) 
> at 
> org.openamq.client.protocol.AMQProtocolHandler.attainState(AMQProtocolHandler.java:392) 
> at 
> org.openamq.client.AMQConnection.makeBrokerConnection(AMQConnection.java:247) 
> at org.openamq.client.AMQConnection.(AMQConnection.java:181) at 
> org.openamq.client.AMQConnection.(AMQConnection.java:154) at 
> org.openamq.requestreply1.ServiceProvidingClient.(ServiceProvidingClient.java:28) 
> at 
> org.openamq.requestreply1.ServiceProvidingClient.main(ServiceProvidingClient.java:152) 
> Caused by: org.openamq.client.protocol.FailoverException: Failing over 
> about to start at 
> org.openamq.client.protocol.AMQProtocolHandler$FailoverHandler.run(AMQProtocolHandler.java:93) 
> at java.lang.Thread.run(Thread.java:679) 345 [Thread-2] INFO 
> org.openamq.client.protocol.AMQProtocolHandler - Starting failover 
> process main 2012-10-15 14:53:18,650 ERROR 
> [org.openamq.requestreply1.ServiceProvidingClient] Error: 
> org.openamq.AMQException: Unable to connect to any specified broker in 
> list 192.168.2.41:5672 org.openamq.AMQException: Unable to connect to 
> any specified broker in list 192.168.2.41:5672 at 
> org.openamq.client.AMQConnection.(AMQConnection.java:198) at 
> org.openamq.client.AMQConnection.(AMQConnection.java:154) at 
> org.openamq.requestreply1.ServiceProvidingClient.(ServiceProvidingClient.java:28) 
> at 
> org.openamq.requestreply1.ServiceProvidingClient.main(ServiceProvidingClient.java:152) 
> 10119 [AnonymousIoService-1-2] INFO 
> org.openamq.client.protocol.AMQProtocolHandler - Session closed called 
> with failover state currently FailoverState: IN PROGRESS 10119 
> [AnonymousIoService-1-2] INFO 
> org.openamq.client.protocol.AMQProtocolHandler - Protocol Session 
> [org.openamq.client.protocol.AMQProtocolHandler at 69945ce] closed 
> [root at apache bin]# Any help on using java jms client with 
> rabbitmq-server-2.8.7 would be of great help
> ------------------------------------------------------------------------
> View this message in context: Dealing with Java JMS client 
> <http://rabbitmq.1065348.n5.nabble.com/Dealing-with-Java-JMS-client-tp22559.html>
> Sent from the RabbitMQ mailing list archive 
> <http://rabbitmq.1065348.n5.nabble.com/> at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/e5f4b066/attachment.htm>

From tim at rabbitmq.com  Mon Oct 15 11:51:48 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 15 Oct 2012 11:51:48 +0100
Subject: [rabbitmq-discuss] Dealing with Java JMS client
In-Reply-To: <507BE975.5000703@rabbitmq.com>
References: <1350295398067-22559.post@n5.nabble.com>
	<507BE975.5000703@rabbitmq.com>
Message-ID: <507BEAC4.1070707@rabbitmq.com>

On 10/15/2012 11:46 AM, Tim Watson wrote:
> Hi,
>
> RabbitMQ is an implementation of AMQP and does not currently support 
> JMS, so this will not work. You will need to the the official RabbitMQ 
> java client directly in order to access RabbitMQ.
>

Sorry, I should probably clarify here. A JMS client that claims to 
support AMQP-0.9.1 *might* work with RabbitMQ, but at also may not and 
you would need to contact the JMS component author/vendor if you are 
running into problems with it. For details of RabbitMQ's conformance to 
the AMQP 0.9.1 specification, see 
http://www.rabbitmq.com/specification.html for more details.

Cheers,

Tim

> Cheers,
> Tim
>
> On 10/15/2012 11:03 AM, vedanth wrote:
>> Hi Everyone, Am trying to use openamq java jms client with rabbit 
>> mq(Version rabbitmq-server-2.8.7-.noarch.rpm). I have downloaded the 
>> openamq jms client from *https://github.com/imatix/openamq-jms* which 
>> currently implements 0.9 amqp spec. When i execute the sample program 
>> as suggested in *readme.txt* i get an exception which says 
>> "Unsupported field table type". Detailed stacktrace bin]# 
>> ./serviceProvidingClient.sh 192.168.2.41:5672 guest guest / main 
>> 2012-10-15 14:53:18,260 INFO 
>> [org.openamq.requestreply1.ServiceProvidingClient] Starting... 106 
>> [main] INFO org.openamq.client.transport.SocketTransportConnection - 
>> Attempting connection to apache.treetechnologies.net:5672 324 
>> [AnonymousIoService-1-1] INFO 
>> org.openamq.client.protocol.AMQProtocolHandler - Exception caught 
>> therefore going to attempt failover: 
>> org.apache.mina.filter.codec.ProtocolDecoderException: 
>> org.openamq.framing.AMQFrameDecodingException: Unsupported field 
>> table type: F (70), length=290, sizeRead=0, sizeRemaining=318 
>> (Hexdump: 00 00 00 58 12 70 75 62 6C 69 73 68 65 72 5F 63 6F 6E 66 69 
>> 72 6D 73 74 01 1A 65 78 63 68 61 6E 67 65 5F 65 78 63 68 61 6E 67 65 
>> 5F 62 69 6E 64 69 6E 67 73 74 01 0A 62 61 73 69 63 2E 6E 61 63 6B 74 
>> 01 16 63 6F 6E 73 75 6D 65 72 5F 63 61 6E 63 65 6C 5F 6E 6F 74 69 66 
>> 79 74 01 09 63 6F 70 79 72 69 67 68 74 53 00 00 00 24 43 6F 70 79 72 
>> 69 67 68 74 20 28 43 29 20 32 30 30 37 2D 32 30 31 32 20 56 4D 77 61 
>> 72 65 2C 20 49 6E 63 2E 0B 69 6E 66 6F 72 6D 61 74 69 6F 6E 53 00 00 
>> 00 35 4C 69 63 65 6E 73 65 64 20 75 6E 64 65 72 20 74 68 65 20 4D 50 
>> 4C 2E 20 20 53 65 65 20 68 74 74 70 3A 2F 2F 77 77 77 2E 72 61 62 62 
>> 69 74 6D 71 2E 63 6F 6D 2F 08 70 6C 61 74 66 6F 72 6D 53 00 00 00 0A 
>> 45 72 6C 61 6E 67 2F 4F 54 50 07 70 72 6F 64 75 63 74 53 00 00 00 08 
>> 52 61 62 62 69 74 4D 51 07 76 65 72 73 69 6F 6E 53 00 00 00 05 32 2E 
>> 38 2E 37 00 00 00 0E 50 4C 41 49 4E 20 41 4D 51 50 4C 41 49 4E 00 00 
>> 00 05 65 6E 5F 55 53 CE) 
>> org.apache.mina.filter.codec.ProtocolDecoderException: 
>> org.openamq.framing.AMQFrameDecodingException: Unsupported field 
>> table type: F (70), length=290, sizeRead=0, sizeRemaining=318 
>> (Hexdump: 00 00 00 58 12 70 75 62 6C 69 73 68 65 72 5F 63 6F 6E 66 69 
>> 72 6D 73 74 01 1A 65 78 63 68 61 6E 67 65 5F 65 78 63 68 61 6E 67 65 
>> 5F 62 69 6E 64 69 6E 67 73 74 01 0A 62 61 73 69 63 2E 6E 61 63 6B 74 
>> 01 16 63 6F 6E 73 75 6D 65 72 5F 63 61 6E 63 65 6C 5F 6E 6F 74 69 66 
>> 79 74 01 09 63 6F 70 79 72 69 67 68 74 53 00 00 00 24 43 6F 70 79 72 
>> 69 67 68 74 20 28 43 29 20 32 30 30 37 2D 32 30 31 32 20 56 4D 77 61 
>> 72 65 2C 20 49 6E 63 2E 0B 69 6E 66 6F 72 6D 61 74 69 6F 6E 53 00 00 
>> 00 35 4C 69 63 65 6E 73 65 64 20 75 6E 64 65 72 20 74 68 65 20 4D 50 
>> 4C 2E 20 20 53 65 65 20 68 74 74 70 3A 2F 2F 77 77 77 2E 72 61 62 62 
>> 69 74 6D 71 2E 63 6F 6D 2F 08 70 6C 61 74 66 6F 72 6D 53 00 00 00 0A 
>> 45 72 6C 61 6E 67 2F 4F 54 50 07 70 72 6F 64 75 63 74 53 00 00 00 08 
>> 52 61 62 62 69 74 4D 51 07 76 65 72 73 69 6F 6E 53 00 00 00 05 32 2E 
>> 38 2E 37 00 00 00 0E 50 4C 41 49 4E 20 41 4D 51 50 4C 41 49 4E 00 00 
>> 00 05 65 6E 5F 55 53 CE) at 
>> org.apache.mina.filter.codec.ProtocolCodecFilter.messageReceived(ProtocolCodecFilter.java:169) 
>> at 
>> org.apache.mina.common.support.AbstractIoFilterChain.callNextMessageReceived(AbstractIoFilterChain.java:501) 
>> at 
>> org.apache.mina.common.support.AbstractIoFilterChain.access$1000(AbstractIoFilterChain.java:51) 
>> at 
>> org.apache.mina.common.support.AbstractIoFilterChain$EntryImpl$1.messageReceived(AbstractIoFilterChain.java:788) 
>> at 
>> org.apache.mina.filter.ThreadPoolFilter.processEvent(ThreadPoolFilter.java:718) 
>> at 
>> org.apache.mina.filter.ThreadPoolFilter$Worker.processEvents(ThreadPoolFilter.java:474) 
>> at 
>> org.apache.mina.filter.ThreadPoolFilter$Worker.run(ThreadPoolFilter.java:429) 
>> Caused by: org.openamq.framing.AMQFrameDecodingException: Unsupported 
>> field table type: F (70), length=290, sizeRead=0, sizeRemaining=318 
>> at org.openamq.framing.FieldTable.(FieldTable.java:65) at 
>> org.openamq.framing.EncodingUtils.readFieldTable(EncodingUtils.java:264) 
>> at 
>> org.openamq.framing.ConnectionStartBody.populateMethodBodyFromBuffer(ConnectionStartBody.java:58) 
>> at 
>> org.openamq.framing.AMQMethodBody.populateFromBuffer(AMQMethodBody.java:46) 
>> at org.openamq.framing.AMQFrame.populateFromBuffer(AMQFrame.java:49) 
>> at 
>> org.openamq.framing.AMQDataBlockDecoder.createAndPopulateFrame(AMQDataBlockDecoder.java:82) 
>> at 
>> org.openamq.framing.AMQDataBlockDecoder.decode(AMQDataBlockDecoder.java:95) 
>> at org.openamq.codec.AMQDecoder.doDecodeDataBlock(AMQDecoder.java:54) 
>> at org.openamq.codec.AMQDecoder.doDecode(AMQDecoder.java:37) at 
>> org.apache.mina.filter.codec.CumulativeProtocolDecoder.decode(CumulativeProtocolDecoder.java:97) 
>> at 
>> org.apache.mina.filter.codec.ProtocolCodecFilter.messageReceived(ProtocolCodecFilter.java:158) 
>> ... 6 more 334 [AnonymousIoService-1-1] INFO 
>> org.openamq.client.protocol.AMQProtocolHandler - Session closed 
>> called with failover state currently FailoverState: NOT STARTED 334 
>> [AnonymousIoService-1-1] INFO 
>> org.openamq.client.protocol.AMQProtocolHandler - Protocol Session 
>> [org.openamq.client.protocol.AMQProtocolHandler at 69945ce] closed 341 
>> [main] INFO org.openamq.client.AMQConnection - Unable to connect to 
>> broker at 192.168.2.41:5672 org.openamq.AMQException: Error: 
>> org.openamq.client.protocol.FailoverException: Failing over about to 
>> start at 
>> org.openamq.client.state.StateWaiter.waituntilStateHasChanged(StateWaiter.java:59) 
>> at 
>> org.openamq.client.state.AMQStateManager.attainState(AMQStateManager.java:204) 
>> at 
>> org.openamq.client.protocol.AMQProtocolHandler.attainState(AMQProtocolHandler.java:392) 
>> at 
>> org.openamq.client.AMQConnection.makeBrokerConnection(AMQConnection.java:247) 
>> at org.openamq.client.AMQConnection.(AMQConnection.java:181) at 
>> org.openamq.client.AMQConnection.(AMQConnection.java:154) at 
>> org.openamq.requestreply1.ServiceProvidingClient.(ServiceProvidingClient.java:28) 
>> at 
>> org.openamq.requestreply1.ServiceProvidingClient.main(ServiceProvidingClient.java:152) 
>> Caused by: org.openamq.client.protocol.FailoverException: Failing 
>> over about to start at 
>> org.openamq.client.protocol.AMQProtocolHandler$FailoverHandler.run(AMQProtocolHandler.java:93) 
>> at java.lang.Thread.run(Thread.java:679) 345 [Thread-2] INFO 
>> org.openamq.client.protocol.AMQProtocolHandler - Starting failover 
>> process main 2012-10-15 14:53:18,650 ERROR 
>> [org.openamq.requestreply1.ServiceProvidingClient] Error: 
>> org.openamq.AMQException: Unable to connect to any specified broker 
>> in list 192.168.2.41:5672 org.openamq.AMQException: Unable to connect 
>> to any specified broker in list 192.168.2.41:5672 at 
>> org.openamq.client.AMQConnection.(AMQConnection.java:198) at 
>> org.openamq.client.AMQConnection.(AMQConnection.java:154) at 
>> org.openamq.requestreply1.ServiceProvidingClient.(ServiceProvidingClient.java:28) 
>> at 
>> org.openamq.requestreply1.ServiceProvidingClient.main(ServiceProvidingClient.java:152) 
>> 10119 [AnonymousIoService-1-2] INFO 
>> org.openamq.client.protocol.AMQProtocolHandler - Session closed 
>> called with failover state currently FailoverState: IN PROGRESS 10119 
>> [AnonymousIoService-1-2] INFO 
>> org.openamq.client.protocol.AMQProtocolHandler - Protocol Session 
>> [org.openamq.client.protocol.AMQProtocolHandler at 69945ce] closed 
>> [root at apache bin]# Any help on using java jms client with 
>> rabbitmq-server-2.8.7 would be of great help
>> ------------------------------------------------------------------------
>> View this message in context: Dealing with Java JMS client 
>> <http://rabbitmq.1065348.n5.nabble.com/Dealing-with-Java-JMS-client-tp22559.html>
>> Sent from the RabbitMQ mailing list archive 
>> <http://rabbitmq.1065348.n5.nabble.com/> at Nabble.com.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/84c47bdd/attachment.htm>

From matthias at rabbitmq.com  Mon Oct 15 12:07:59 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 15 Oct 2012 12:07:59 +0100
Subject: [rabbitmq-discuss] Dealing with Java JMS client
In-Reply-To: <507BEAC4.1070707@rabbitmq.com>
References: <1350295398067-22559.post@n5.nabble.com>
	<507BE975.5000703@rabbitmq.com> <507BEAC4.1070707@rabbitmq.com>
Message-ID: <507BEE8F.4080400@rabbitmq.com>

On 15/10/12 11:51, Tim Watson wrote:
> Sorry, I should probably clarify here. A JMS client that claims to
> support AMQP-0.9.1 *might* work with RabbitMQ, but at also may not and
> you would need to contact the JMS component author/vendor if you are
> running into problems with it. For details of RabbitMQ's conformance to
> the AMQP 0.9.1 specification, see
> http://www.rabbitmq.com/specification.html for more details.

...and for the particular error - "Unsupported field table type: F (70)" 
- see http://www.rabbitmq.com/amqp-0-9-1-errata.html#section_3. 
According to that, the type should be supported in a 0-9 client, but I 
guess the openamq client is not conforming to the spec in that regard. 
Since rabbit will send such a type during the connection establishment 
handshake, you won't be getting very far with a client that trips over 
that type.

Regards,

Matthias.

From irmo.manie at gmail.com  Mon Oct 15 12:15:41 2012
From: irmo.manie at gmail.com (Irmo Manie)
Date: Mon, 15 Oct 2012 13:15:41 +0200
Subject: [rabbitmq-discuss] Memory limit cleanup, hanging connections.
In-Reply-To: <507BE920.4080405@rabbitmq.com>
References: <CAAcXTOYbW=wAuD77ZDLTjQzGO+yZtCfO9BKuO5qK2HptJF7eeA@mail.gmail.com>
	<507BE920.4080405@rabbitmq.com>
Message-ID: <CAAcXTOZyAtTQDoTH_8E=xcPtaxGCbtdbDRRnkLpLHcm=cwMYUw@mail.gmail.com>

On Mon, Oct 15, 2012 at 12:44 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> Yes, that's absolutely correct. The blocked connections don't perform any
> network operations at all - which means that not only don't they check for
> heartbeats, they don't even detect the TCP connection being torn down. As
> soon as the memory alarm clears, the connections will unblock, notice the
> TCP connection having gone away, and vanish.
>
>
Ok, good to know. I reckon the connections themselves don't take that much
resources or keep hold of memory consuming parts? That it's purely the
queues and their messages eating the memory?


> If you've "filled up" all your queues then they will have been paging to
> disc for some time - cleaning all that up can be quite slow.
>
>
Any reason why this is that slow? Does it look up every message 1 by 1 in
the storage or something?

Cheers,
- Irmo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/7c5b75cf/attachment.htm>

From simon at rabbitmq.com  Mon Oct 15 12:23:00 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 15 Oct 2012 12:23:00 +0100
Subject: [rabbitmq-discuss] Memory limit cleanup, hanging connections.
In-Reply-To: <CAAcXTOZyAtTQDoTH_8E=xcPtaxGCbtdbDRRnkLpLHcm=cwMYUw@mail.gmail.com>
References: <CAAcXTOYbW=wAuD77ZDLTjQzGO+yZtCfO9BKuO5qK2HptJF7eeA@mail.gmail.com>
	<507BE920.4080405@rabbitmq.com>
	<CAAcXTOZyAtTQDoTH_8E=xcPtaxGCbtdbDRRnkLpLHcm=cwMYUw@mail.gmail.com>
Message-ID: <507BF214.6090304@rabbitmq.com>

On 15/10/12 12:15, Irmo Manie wrote:
> Ok, good to know. I reckon the connections themselves don't take that
> much resources or keep hold of memory consuming parts? That it's purely
> the queues and their messages eating the memory?

Yes, it should be.

>     If you've "filled up" all your queues then they will have been
>     paging to disc for some time - cleaning all that up can be quite slow.
>
>
> Any reason why this is that slow? Does it look up every message 1 by 1
> in the storage or something?

Yes, because the message store is shared between queues (so that when 
you send one message to 100 queues we don't duplicate it 100 times.)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From irmo.manie at gmail.com  Mon Oct 15 13:01:19 2012
From: irmo.manie at gmail.com (Irmo Manie)
Date: Mon, 15 Oct 2012 14:01:19 +0200
Subject: [rabbitmq-discuss] Memory limit cleanup, hanging connections.
In-Reply-To: <507BF214.6090304@rabbitmq.com>
References: <CAAcXTOYbW=wAuD77ZDLTjQzGO+yZtCfO9BKuO5qK2HptJF7eeA@mail.gmail.com>
	<507BE920.4080405@rabbitmq.com>
	<CAAcXTOZyAtTQDoTH_8E=xcPtaxGCbtdbDRRnkLpLHcm=cwMYUw@mail.gmail.com>
	<507BF214.6090304@rabbitmq.com>
Message-ID: <CAAcXTObJW0NZmXgpqmV2D8sFN0GQDzvo764MYxdUw5x0o9fH0g@mail.gmail.com>

Yes, it should be.
>
> Yes, because the message store is shared between queues (so that when you
> send one message to 100 queues we don't duplicate it 100 times.)
>
>
Ok clear, thanks!

- Irmo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/0495aac9/attachment.htm>

From deepdesai.nitt at gmail.com  Mon Oct 15 13:49:21 2012
From: deepdesai.nitt at gmail.com (deep desai)
Date: Mon, 15 Oct 2012 18:19:21 +0530
Subject: [rabbitmq-discuss] Init script hangs for rabbitmq daemon
Message-ID: <CAJHL58b3Fv4oXFVYPEmWbJZ4RxJM-gwgD-1SnsjB_TkMKN9goA@mail.gmail.com>

I am running a rabbitmq-server version 2.8.7-1 Init script works fine
sometimes and it simply hangs sometimes even when checking status.
Running a strace shows it stops at wait4(-1 checking status..

I have tried killing all the processes run by user rabbitmq and then
start the server by /etc/init.d/rabbitmq-server start but the same
problem arises some times.

The logs dont show any errors

From tim at rabbitmq.com  Mon Oct 15 13:59:02 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 15 Oct 2012 13:59:02 +0100
Subject: [rabbitmq-discuss] Init script hangs for rabbitmq daemon
In-Reply-To: <CAJHL58b3Fv4oXFVYPEmWbJZ4RxJM-gwgD-1SnsjB_TkMKN9goA@mail.gmail.com>
References: <CAJHL58b3Fv4oXFVYPEmWbJZ4RxJM-gwgD-1SnsjB_TkMKN9goA@mail.gmail.com>
Message-ID: <507C0896.2030000@rabbitmq.com>

Hi

On 10/15/2012 01:49 PM, deep desai wrote:
> I am running a rabbitmq-server version 2.8.7-1 Init script works fine
> sometimes and it simply hangs sometimes even when checking status.
> Running a strace shows it stops at wait4(-1 checking status..

Are you saying that /etc/init.d/rabbitmq-server status hangs?

> I have tried killing all the processes run by user rabbitmq and then
> start the server by /etc/init.d/rabbitmq-server start but the same
> problem arises some times.

What operating system are you running? How did you install RabbitMQ? 
What user are you executing the init script as?

From tim at rabbitmq.com  Mon Oct 15 15:03:57 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 15 Oct 2012 15:03:57 +0100
Subject: [rabbitmq-discuss] Init script hangs for rabbitmq daemon
In-Reply-To: <507C0896.2030000@rabbitmq.com>
References: <CAJHL58b3Fv4oXFVYPEmWbJZ4RxJM-gwgD-1SnsjB_TkMKN9goA@mail.gmail.com>
	<507C0896.2030000@rabbitmq.com>
Message-ID: <507C17CD.5060809@rabbitmq.com>

Please keep the list on CC.

On 10/15/2012 02:51 PM, deep desai wrote:
> hi,
>
> It runs it as root only..

Can you manually run that command on those machines? What exactly is 
puppet configured to do?

>
>>> >>
>>> >>  Okay let me try that once.
>>> >>  The problem is: I use puppet to check if rabbitmq is running or not,
>>> >>  and if not it starts it; when puppet runs and checks rabbitmq's status
>>> >>  it hangs and puppet run breaks.
>>>
>>> >
>>> >  What user is puppet trying to run that command as!?
>>> >
>>> >
>>> >>  On Mon, Oct 15, 2012 at 7:04 PM, Tim Watson<tim at rabbitmq.com>   wrote:
>>> >>>
>>> >>>  Hi,
>>> >>>
>>> >>>  As per the instructions on the website
>>> >>>  (http://www.rabbitmq.com/install-rpm.html) you should start and stop
>>> >>>  rabbitmq using `/sbin/service rabbitmq-server stop/start/etc` rather than
>>> >>>  interacting with the init scripts yourself.
>>> >>>
>>> >>>  Cheers,
>>> >>>  Tim
>>> >>>

On 10/15/2012 01:59 PM, Tim Watson wrote:
> Hi
>
> On 10/15/2012 01:49 PM, deep desai wrote:
>> I am running a rabbitmq-server version 2.8.7-1 Init script works fine
>> sometimes and it simply hangs sometimes even when checking status.
>> Running a strace shows it stops at wait4(-1 checking status..
>

The wait( -1 ) operating system call is pretty low level - do you have 
any idea *where* that call originated?

> Are you saying that /etc/init.d/rabbitmq-server status hangs?
>
>> I have tried killing all the processes run by user rabbitmq and then
>> start the server by /etc/init.d/rabbitmq-server start but the same
>> problem arises some times.
>
> What operating system are you running? How did you install RabbitMQ? 
> What user are you executing the init script as?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From Michael.Laing at nytimes.com  Mon Oct 15 15:59:53 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Mon, 15 Oct 2012 10:59:53 -0400
Subject: [rabbitmq-discuss] Field Type 'A'
Message-ID: <CCA19D29.526E%Michael.Laing@nytimes.com>

In http://www.rabbitmq.com/amqp-0-9-1-errata.html#section_3 it says that Field Type 'A' is not supported by RabbitMQ.

However in my work on the nodejs client I implemented support for this field type specifically because it is used in sender-selected distribution, federation, and firehose/tracing.

An erratum in the errata perhaps?

Michael
NYTimes
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/c005fbf8/attachment.htm>

From ttom.kelly at gmail.com  Mon Oct 15 16:07:10 2012
From: ttom.kelly at gmail.com (tom kelly)
Date: Mon, 15 Oct 2012 16:07:10 +0100
Subject: [rabbitmq-discuss] AMQP restart
Message-ID: <CAKwS4ihkJQL0GUikY0C1t62LLJntNM3BDiFssV2pjHvB27r_1Q@mail.gmail.com>

Hi List,
New user here, debugging some code I inherited so apologies if my questions
below are irrelevant.

I'm investigating an amqp crash that I've seen in my logs a few times and
after a code review of the amqp component I'm a bit concerned that my
connections may be dying & silently failing when this crash occurs.

I'm using an older version that unlinked from the process that called
"start_link", anyone know why that was? I'm publishing through this channel
by calling amqp_channel:cast, so now I'm worried that if the connection &
channel were closed down everything that I thought I was publishing after
this error just silently failed. And because of the unlink there's no way
the application would have known.

I plan upgrading to the latest version but I'm not sure that it has all the
features to help solve this problem. I see that the unlink is gone and the
supervision policy is still:{one_for_all, 0, 1} So I guess this means I
have to trap exits and I have responsibility for reopening the connection &
channel if it dies?
But before I restart it, what happens to any attempts to publish messages?
I see there's new confirmation functionality that sounds like it might do
what's required but from my reading it seems that if amqp_channel is shut
down after a crash on the connection then all the confirm info is
discarded. Is there no way to keep this process alive and try to re-open
the connection immediately on failure?

I'm just about to plug in the new version and play with the confirmations
but any explanations of the current design might help enormously,
Thanks,
//TTom.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/c6319e82/attachment.htm>

From matthias at rabbitmq.com  Mon Oct 15 16:10:19 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 15 Oct 2012 16:10:19 +0100
Subject: [rabbitmq-discuss] Field Type 'A'
In-Reply-To: <CCA19D29.526E%Michael.Laing@nytimes.com>
References: <CCA19D29.526E%Michael.Laing@nytimes.com>
Message-ID: <507C275B.4090409@rabbitmq.com>

On 15/10/12 15:59, Laing, Michael P. wrote:
> In http://www.rabbitmq.com/amqp-0-9-1-errata.html#section_3 it says that
> Field Type 'A' is not supported by RabbitMQ.

It actually says:

<quote>
RabbitMQ continues to use the tags in the third column, and implements 
the field-array type in the broker and at least the "supported" clients.
</quote>

Matthias.

From Michael.Laing at nytimes.com  Mon Oct 15 16:24:57 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Mon, 15 Oct 2012 11:24:57 -0400
Subject: [rabbitmq-discuss] Field Type 'A'
In-Reply-To: <507C275B.4090409@rabbitmq.com>
Message-ID: <CCA1A072.5274%Michael.Laing@nytimes.com>

Ah so it does.

Then the table is misleading in my opinion, causing developers for
'unsupported' clients to mistakenly implement the column in the table and
think they are done. Not the desired outcome, and an understandable
oversight by the nodejs-amqp author, I think.

Plus the comment is ambiguous as it says that field-array type is
implemented but not which tag is used. It should also be placed in C above
to make it clear that it goes with the table.

Or perhaps a RabbitMQ column separate from Qpid would make sense.

Michael

On 10/15/12 11:10 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>On 15/10/12 15:59, Laing, Michael P. wrote:
>> In http://www.rabbitmq.com/amqp-0-9-1-errata.html#section_3 it says that
>> Field Type 'A' is not supported by RabbitMQ.
>
>It actually says:
>
><quote>
>RabbitMQ continues to use the tags in the third column, and implements
>the field-array type in the broker and at least the "supported" clients.
></quote>
>
>Matthias.


From aaron.pfeifer at gmail.com  Mon Oct 15 16:32:38 2012
From: aaron.pfeifer at gmail.com (Aaron Pfeifer)
Date: Mon, 15 Oct 2012 11:32:38 -0400
Subject: [rabbitmq-discuss] Response times for publisher confirms
Message-ID: <CACxyq579SGwzuFpX_xQikkYOP5yX139UQuoi_r1r-qYCO9WwgA@mail.gmail.com>

Hey everyone -

We've been running some tests on a RabbitMQ stack that we have running in
EC2 and encountered some unexpected behaviors in the response times for
publisher confirms and wanted to see if folks here had an idea of what the
root cause might be.

First, some details on the stack:
* EC2 m1.xlarge (15GB memory, 8 EC2 compute units, 64-bit, 1 Gigabit
Ethernet)
* Ubuntu 10.04
* Erlang R13B03
* RabbitMQ 2.8.5
* Mounted to 4 RAID0 ephemeral drives (I believe 400GB each)

...and some details on the setup:
* 16 durable, fanout exchanges
* 16 durable queues
* Each exchange mapped to a single queue
* Each message published as persistent

We have about 5,000 connections (over many servers) publishing a message
once every 15s.  Each connection has publisher confirms enabled.  Each
message is approximately 10-15KB in size (give or take).  While running
this test we tracked the following data:

* Maximum amount of time to receive a confirm: http://i.imgur.com/SrXJP.png
* Average amount of time to receive a confirm: http://i.imgur.com/ryWmr.png

Looking at this graph seems to indicate that there's something going on in
RabbitMQ about every 10 minutes that causes a significant increase in the
amount of time it takes to receive a publisher confirm.

To get some further data about what was happening during each of these
spikes, we logged the following data through vmstat and iostat on the
machine: https://gist.github.com/3874134.  You'll notice that during this
spike we experience a significant decrease in the amount of data being
written to disk and a significant increase in the await time on each disk.

And just a little background: we were planning on using durable queues and
publisher confirms to verify that the message was actually received by
RabbitMQ.  I believe I've also read that publisher confirms are typically
preferred to transactions.

Is this expected behavior for the type of test we're running?  If so, is
there anything we can do to make things a bit more consistent?

Thanks for any thoughts!

-Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/e0a41547/attachment.htm>

From mpietrek at skytap.com  Mon Oct 15 18:15:29 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 15 Oct 2012 10:15:29 -0700
Subject: [rabbitmq-discuss] Loss of queues after network partition?
In-Reply-To: <507BE3FC.30104@rabbitmq.com>
References: <CACLE7iyF8XFc2hGmy0YyaUJmGkV05dDZ6v5dXOsTJeq_6+KcKg@mail.gmail.com>
	<507BE3FC.30104@rabbitmq.com>
Message-ID: <CACLE7iy47mMa-_K5Y96SbMSiy8=17puBZfqR8Gv36fu_b=Ly9Q@mail.gmail.com>

Thanks Tim! Glad to know I'm not crazy.

> Are these HA queues durable and do they all "come back to life" after
restarting the node(s)?

Unfortunately, I wasn't around when this particular problem occurred, but
as the designated RabbitMQ expert, I got to piece together events from the
logs.

So, I can tell you that the queues are all declared as HA. However, we
didn't see the queues again until after we explicitly created them.
Unfortunately, it doesn't look like there was a broker restart between when
the queue was gone and when they were later declared, so no idea if a
restart would have brought the queues back to life. Sorry about that...

Matt

On Mon, Oct 15, 2012 at 3:22 AM, Tim Watson <tim at rabbitmq.com> wrote:

>  Hi Matt,
>
> This is a problem we're aware of (i.e., we have an open bug which we're
> working on!) and are looking at ways of handling it. What is basically
> happening here is that mnesia gets into an inconsistent state due to a
> network partition and the mnesia transaction manager sends unanticipated
> (and unhandled) messages to certain Erlang processes causing a crash.
>
> Whilst this falls into the category of "Rabbit clusters do not handle
> network partitions" obviously we want to prevent this sort of thing
> happening and as I say, we're looking at various ways of responding in a
> somewhat more user friendly manner.
>
> In the meanwhile, I'd be very interested to see if the queue information
> has actually been deleted from mnesia when this happens. Are these HA
> queues durable and do they all "come back to life" after restarting the
> node(s)?
>
> Cheers,
> Tim
>
>
> On 10/12/2012 09:01 PM, Matt Pietrek wrote:
>
> I'll be the first to admit that this is a somewhat unusual/complicated
> circumstance, but I'm posting this on the chance there's something unusual.
> This is RabbitMQ is *2.8.7 *on Erlang R15B01.
>
> We have two brokers (mq1, mq2) running clustered with all HA queues. A VIP
> is in front of them.
>
> At some point there was a network event, and afterwards, a queue vanished.
> (Still trying to figure out exactly what the network hiccup was, but it's
> fair to say there was a communication disruption between the nodes.)  My
> guess from looking at the logs is that each node had a moment where it
> couldn't see the other, so took actions that were ultimately incompatible
> when both nodes were visible to each other.
>
> The actual error as seen by our code is a missing queue named "charon".
> You'll see it near the end of the rabbit at mq2.log (below):
>
> *{amqp_error,not_found,"no queue 'charon' in vhost '/'",'queue.declare'}*
>
> Prior to the network event, our client was successfully reading from the
> charon queue.
>
>
> *Here's the relevant parts of the rabbit at mq1.log file
> ====================================================*
> =INFO REPORT==== 11-Oct-2012::14:01:58 ===
> rabbit on node rabbit at mq2 down
>
> =ERROR REPORT==== 11-Oct-2012::14:02:03 ===
> Mnesia(rabbit at mq1): ** ERROR ** mnesia_event got {inconsistent_database,
> running_partitioned_network, rabbit at mq2}
>
> =ERROR REPORT==== 11-Oct-2012::14:02:03 ===
> ** Generic server <0.547.0> terminating
> ** Last message in was {mnesia_locker,rabbit at mq2,granted}
> ** When Server state == {state,
>                             {0,<0.547.0>},
>                             {{0,<0.547.0>},undefined},
>                             {{0,<0.547.0>},undefined},
>                             {resource,<<"/">>,queue,<<"charon">>},
>                             rabbit_mirror_queue_coordinator,
>                             {3,
>                              [{{0,<0.547.0>},
>                                {view_member,
>                                    {0,<0.547.0>},
>                                    [],
>                                    {0,<0.547.0>},
>                                    {0,<0.547.0>}}}]},
>                             1,[],
>                             [<0.546.0>],
>                             {[],[]},
>                             [],undefined}
> ** Reason for termination ==
> ** {function_clause,
>        [{gm,handle_info,
>             [{mnesia_locker,rabbit at mq2,granted},
>              {state,
>                  {0,<0.547.0>},
>                  {{0,<0.547.0>},undefined},
>                  {{0,<0.547.0>},undefined},
>                  {resource,<<"/">>,queue,<<"charon">>},
>                  rabbit_mirror_queue_coordinator,
>                  {3,
>                   [{{0,<0.547.0>},
>                     {view_member,
>                         {0,<0.547.0>},
>                         [],
>                         {0,<0.547.0>},
>                         {0,<0.547.0>}}}]},
>                  1,[],
>                  [<0.546.0>],
>                  {[],[]},
>                  [],undefined}],
>             [{file,"src/gm.erl"},{line,665}]},
>
> {gen_server2,handle_msg,2,[{file,"src/gen_server2.erl"},{line,912}]},
>         {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}
>
> =ERROR REPORT==== 11-Oct-2012::14:02:03 ===
> ** Generic server <0.545.0> terminating
> ** Last message in was {'EXIT',<0.546.0>,
>                         {function_clause,
>                          [{gm,handle_info,
>                            [{mnesia_locker,rabbit at mq2,granted},
>                             {state,
>                              {0,<0.547.0>},
>                              {{0,<0.547.0>},undefined},
>                              {{0,<0.547.0>},undefined},
>                              {resource,<<"/">>,queue,<<"charon">>},
>                              rabbit_mirror_queue_coordinator,
>                              {3,
>                               [{{0,<0.547.0>},
>                                 {view_member,
>                                  {0,<0.547.0>},
>                                  [],
>                                  {0,<0.547.0>},
>                                  {0,<0.547.0>}}}]},
>                              1,[],
>                              [<0.546.0>],
>                              {[],[]},
>                              [],undefined}],
>                            [{file,"src/gm.erl"},{line,665}]},
>                           {gen_server2,handle_msg,2,
>                            [{file,"src/gen_server2.erl"},{line,912}]},
>                           {proc_lib,wake_up,3,
>                            [{file,"proc_lib.erl"},{line,237}]}]}}
> ** When Server state == {q,
>                          {amqqueue,
>                           {resource,<<"/">>,queue,<<"charon">>},
>                           true,false,none,
>                           [{<<"x-ha-policy">>,longstr,<<"all">>}],
>                           <0.545.0>,[],all},
>                          none,false,rabbit_mirror_queue_master,
>                          {state,<0.547.0>,<0.546.0>,rabbit_variable_queue,
>                           {vqstate,
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            {delta,undefined,0,undefined},
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            0,
>                            {0,nil},
>                            undefined,
>                            {0,nil},
>                            {qistate,
>                             "/highland/var/lib/rabbit at mq1
> /queues/4L2SY4TVRPM8HP85JDVO85BPL",
>                             {{dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              []},
>                             undefined,0,262144,
>                             #Fun<rabbit_variable_queue.2.121500735>,
>                             {0,nil}},
>                            {{client_msstate,msg_store_persistent,
>
> <<112,32,84,92,54,73,67,43,231,35,164,79,106,8,27,
>                                132>>,
>                              {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              {state,237637,
>                               "/highland/var/lib/rabbit at mq1
> /msg_store_persistent"},
>                              rabbit_msg_store_ets_index,
>                              "/highland/var/lib/rabbit at mq1
> /msg_store_persistent",
>                              <0.289.0>,241734,233540,245831,249928},
>                             {client_msstate,msg_store_transient,
>
> <<204,18,155,40,29,120,124,76,144,83,195,135,250,
>                                91,216,3>>,
>                              {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              {state,217152,
>                               "/highland/var/lib/rabbit at mq1
> /msg_store_transient"},
>                              rabbit_msg_store_ets_index,
>                              "/highland/var/lib/rabbit at mq1
> /msg_store_transient",
>                              <0.284.0>,221249,213055,225346,229443}},
>
> true,0,#Fun<rabbit_amqqueue_process.5.24780734>,0,
>                            0,infinity,0,0,0,0,0,
>                            {rates,
>                             {{1349,988602,967125},0},
>                             {{1349,988602,967125},0},
>                             0.0,0.0,
>                             {1349,988606,141019}},
>                            {0,nil},
>                            {0,nil},
>                            {0,nil},
>                            {0,nil},
>                            0,0,
>                            {rates,
>                             {{1349,988602,967125},0},
>                             {{1349,988602,967125},0},
>                             0.0,0.0,
>                             {1349,988606,141019}}},
>                           0,
>                           {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}},
>                           [],
>                           {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}},
>                           {set,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}}},
>                          {[],[]},
>                          undefined,undefined,undefined,undefined,
>                          {state,fine,5000,undefined},
>                          {0,nil},
>                          undefined,undefined,undefined,
>                          {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                          1,
>                          {{0,nil},{0,nil}},
>                          undefined,
>                          {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                          undefined,undefined}
> ** Reason for termination ==
> ** {noproc,{gen_server2,call,[<0.547.0>,info,infinity]}}
> ** In 'terminate' callback with reason ==
> ** {function_clause,
>        [{gm,handle_info,
>             [{mnesia_locker,rabbit at mq2,granted},
>              {state,
>                  {0,<0.547.0>},
>                  {{0,<0.547.0>},undefined},
>                  {{0,<0.547.0>},undefined},
>                  {resource,<<"/">>,queue,<<"charon">>},
>                  rabbit_mirror_queue_coordinator,
>                  {3,
>                   [{{0,<0.547.0>},
>                     {view_member,
>                         {0,<0.547.0>},
>                         [],
>                         {0,<0.547.0>},
>                         {0,<0.547.0>}}}]},
>                  1,[],
>                  [<0.546.0>],
>                  {[],[]},
>                  [],undefined}],
>             [{file,"src/gm.erl"},{line,665}]},
>
> {gen_server2,handle_msg,2,[{file,"src/gen_server2.erl"},{line,912}]},
>         {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}
>
> =INFO REPORT==== 11-Oct-2012::14:02:03 ===
> Mirrored-queue (queue 'cmcmd' in vhost '/'): Master <rabbit at mq1.2.665.0><rabbit at mq1.2.665.0>saw deaths of mirrors
> <rabbit at mq2.1.383.0> <rabbit at mq2.1.383.0>
>
> =INFO REPORT==== 11-Oct-2012::14:02:03 ===
> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Master
> <rabbit at mq1.2.605.0> <rabbit at mq1.2.605.0> saw deaths of mirrors
> <rabbit at mq2.1.377.0> <rabbit at mq2.1.377.0>
>
> =INFO REPORT==== 11-Oct-2012::14:02:03 ===
> global: Name conflict terminating {rabbit_mgmt_db,<3198.32532.0>}
>
> =INFO REPORT==== 11-Oct-2012::14:26:40 ===
> accepting AMQP connection <0.6507.1> (10.72.0.50:46742 -> 10.72.0.47:5672)
>
> =INFO REPORT==== 11-Oct-2012::14:26:40 ===
> closing AMQP connection <0.6507.1> (10.72.0.50:46742 -> 10.72.0.47:5672)
>
>
>
>
> *And here's the relevant parts of the rabbit at m2.log file
> ====================================================*
> =ERROR REPORT==== 11-Oct-2012::14:01:37 ===
> ** Node rabbit at mq1 not responding **
> ** Removing (timedout) connection **
>
> =INFO REPORT==== 11-Oct-2012::14:01:37 ===
> rabbit on node rabbit at mq1 down
>
> =INFO REPORT==== 11-Oct-2012::14:01:40 ===
> Statistics database started.
>
> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
> Mirrored-queue (queue 'cmcmd' in vhost '/'): Slave <rabbit at mq2.1.383.0><rabbit at mq2.1.383.0>saw deaths of mirrors
> <rabbit at mq1.2.665.0> <rabbit at mq1.2.665.0>
>
> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
> Mirrored-queue (queue 'cmcmd' in vhost '/'): Promoting slave
> <rabbit at mq2.1.383.0> <rabbit at mq2.1.383.0> to master
>
> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
> Mirrored-queue (queue 'charon' in vhost '/'): Slave <rabbit at mq2.1.371.0><rabbit at mq2.1.371.0>saw deaths of mirrors
> <rabbit at mq1.2.545.0> <rabbit at mq1.2.545.0>
>
> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
> Mirrored-queue (queue 'charon' in vhost '/'): Promoting slave
> <rabbit at mq2.1.371.0> <rabbit at mq2.1.371.0> to master
>
> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Slave
> <rabbit at mq2.1.377.0> <rabbit at mq2.1.377.0> saw deaths of mirrors
> <rabbit at mq1.2.605.0> <rabbit at mq1.2.605.0>
>
> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Promoting
> slave <rabbit at mq2.1.377.0> <rabbit at mq2.1.377.0> to master
>
> =ERROR REPORT==== 11-Oct-2012::14:05:03 ===
> Mnesia(rabbit at mq2): ** ERROR ** mnesia_event got {inconsistent_database,
> running_partitioned_network, rabbit at mq1}
>
> =INFO REPORT==== 11-Oct-2012::14:05:03 ===
> Statistics database started.
>
> =ERROR REPORT==== 11-Oct-2012::14:29:39 ===
> ** Generic server <0.32583.0> terminating
> ** Last message in was {'$gen_cast',{gm_deaths,[<0.5504.1>]}}
> ** When Server state == {state,
>                             {amqqueue,
>                                 {resource,<<"/">>,queue,<<"charon">>},
>                                 true,false,none,
>                                 [{<<"x-ha-policy">>,longstr,<<"all">>}],
>                                 <0.371.0>,[],all},
>                             <0.372.0>,
>                             {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}},
>                             #Fun<rabbit_mirror_queue_master.1.32244930>,
>                             #Fun<rabbit_mirror_queue_master.2.32244930>}
> ** Reason for termination ==
> ** {bad_return_value,
>        {error,
>            {{badmatch,[]},
>             [{rabbit_mirror_queue_misc,'-remove_from_queue/2-fun-0-',2,
>                  [{file,"src/rabbit_mirror_queue_misc.erl"},{line,63}]},
>              {mnesia_tm,apply_fun,3,[{file,"mnesia_tm.erl"},{line,829}]},
>              {mnesia_tm,execute_transaction,5,
>                  [{file,"mnesia_tm.erl"},{line,809}]},
>              {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1,
>                  [{file,"src/rabbit_misc.erl"},{line,440}]},
>              {worker_pool_worker,handle_call,3,
>                  [{file,"src/worker_pool_worker.erl"},{line,80}]},
>              {gen_server2,handle_msg,2,
>                  [{file,"src/gen_server2.erl"},{line,879}]},
>              {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}}}
>
> =ERROR REPORT==== 11-Oct-2012::14:29:39 ===
> ** Generic server <0.371.0> terminating
> ** Last message in was {'EXIT',<0.32583.0>,
>                         {bad_return_value,
>                          {error,
>                           {{badmatch,[]},
>                            [{rabbit_mirror_queue_misc,
>                              '-remove_from_queue/2-fun-0-',2,
>                              [{file,"src/rabbit_mirror_queue_misc.erl"},
>                               {line,63}]},
>                             {mnesia_tm,apply_fun,3,
>                              [{file,"mnesia_tm.erl"},{line,829}]},
>                             {mnesia_tm,execute_transaction,5,
>                              [{file,"mnesia_tm.erl"},{line,809}]},
>                             {rabbit_misc,
>                              '-execute_mnesia_transaction/1-fun-0-',1,
>                              [{file,"src/rabbit_misc.erl"},{line,440}]},
>                             {worker_pool_worker,handle_call,3,
>
> [{file,"src/worker_pool_worker.erl"},{line,80}]},
>                             {gen_server2,handle_msg,2,
>                              [{file,"src/gen_server2.erl"},{line,879}]},
>                             {proc_lib,wake_up,3,
>                              [{file,"proc_lib.erl"},{line,237}]}]}}}}
> ** When Server state == {q,
>                          {amqqueue,
>                           {resource,<<"/">>,queue,<<"charon">>},
>                           true,false,none,
>                           [{<<"x-ha-policy">>,longstr,<<"all">>}],
>                           <0.371.0>,[],all},
>                          none,false,rabbit_mirror_queue_master,
>
> {state,<0.372.0>,<0.32583.0>,rabbit_variable_queue,
>                           {vqstate,
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            {delta,undefined,0,undefined},
>                            {0,{[],[]}},
>                            {0,{[],[]}},
>                            0,
>                            {0,nil},
>                            undefined,
>                            {0,nil},
>                            {qistate,
>                             "/highland/var/lib/rabbit at mq2
> /queues/4L2SY4TVRPM8HP85JDVO85BPL",
>                             {{dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              []},
>                             undefined,0,262144,
>                             #Fun<rabbit_variable_queue.2.121500735>,
>                             {0,nil}},
>                            {{client_msstate,msg_store_persistent,
>
> <<23,245,132,154,3,96,225,184,108,75,232,224,184,
>                                114,108,141>>,
>                              {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              {state,282693,
>                               "/highland/var/lib/rabbit at mq2
> /msg_store_persistent"},
>                              rabbit_msg_store_ets_index,
>                              "/highland/var/lib/rabbit at mq2
> /msg_store_persistent",
>                              <0.285.0>,286790,278596,290887,294984},
>                             {client_msstate,msg_store_transient,
>
> <<17,62,75,125,126,21,66,37,170,44,198,72,18,94,
>                                170,197>>,
>                              {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                []},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []}}},
>                              {state,262208,
>                               "/highland/var/lib/rabbit at mq2
> /msg_store_transient"},
>                              rabbit_msg_store_ets_index,
>                              "/highland/var/lib/rabbit at mq2
> /msg_store_transient",
>                              <0.280.0>,266305,258111,270402,274499}},
>
> true,0,#Fun<rabbit_mirror_queue_slave.1.69615989>,
>                            0,0,infinity,0,0,0,0,0,
>                            {rates,
>                             {{1349,989325,677031},0},
>                             {{1349,989325,677031},0},
>                             0.0,0.0,
>                             {1349,989505,348090}},
>                            {0,nil},
>                            {0,nil},
>                            {0,nil},
>                            {0,nil},
>                            0,0,
>                            {rates,
>                             {{1349,989325,677031},0},
>                             {{1349,989325,677031},0},
>                             0.0,0.0,
>                             {1349,989505,348090}}},
>                           0,
>                           {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}},
>                           [],
>                           {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}},
>                           {set,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                              []}}}},
>                          {[],[]},
>                          undefined,undefined,undefined,undefined,
>                          {state,fine,5000,undefined},
>                          {0,nil},
>                          undefined,undefined,undefined,
>                          {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                          1,
>                          {{0,nil},{0,nil}},
>                          undefined,
>                          {dict,0,16,16,8,80,48,
>
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>                          undefined,undefined}
> ** Reason for termination ==
> ** {noproc,{gen_server2,call,[<0.372.0>,info,infinity]}}
> ** In 'terminate' callback with reason ==
> ** {bad_return_value,
>        {error,
>            {{badmatch,[]},
>             [{rabbit_mirror_queue_misc,'-remove_from_queue/2-fun-0-',2,
>                  [{file,"src/rabbit_mirror_queue_misc.erl"},{line,63}]},
>              {mnesia_tm,apply_fun,3,[{file,"mnesia_tm.erl"},{line,829}]},
>              {mnesia_tm,execute_transaction,5,
>                  [{file,"mnesia_tm.erl"},{line,809}]},
>              {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1,
>                  [{file,"src/rabbit_misc.erl"},{line,440}]},
>              {worker_pool_worker,handle_call,3,
>                  [{file,"src/worker_pool_worker.erl"},{line,80}]},
>              {gen_server2,handle_msg,2,
>                  [{file,"src/gen_server2.erl"},{line,879}]},
>              {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}}}
>
> =INFO REPORT==== 11-Oct-2012::14:29:43 ===
> accepting AMQP connection <0.5524.1> (10.72.0.23:36056 -> 10.72.0.56:5672)
>
> =INFO REPORT==== 11-Oct-2012::14:29:44 ===
> accepting AMQP connection <0.5574.1> (10.72.0.23:36064 -> 10.72.0.56:5672)
>
> =INFO REPORT==== 11-Oct-2012::17:56:16 ===
> accepting AMQP connection <0.23868.1> (10.72.0.53:57122 -> 10.72.0.56:5672
> )
>
> =ERROR REPORT==== 11-Oct-2012::17:56:16 ===
> connection <0.23868.1>, channel 1 - error:
> {amqp_error,not_found,"no queue 'charon' in vhost '/'",'queue.declare'}
>
> =WARNING REPORT==== 11-Oct-2012::17:56:16 ===
> closing AMQP connection <0.23868.1> (10.72.0.53:57122 -> 10.72.0.56:5672):
> connection_closed_abruptly
>
> =INFO REPORT==== 11-Oct-2012::17:56:16 ===
> accepting AMQP connection <0.23878.1> (10.72.0.52:56025 -> 10.72.0.56:5672
> )
>
> =ERROR REPORT==== 11-Oct-2012::17:56:16 ===
> connection <0.23878.1>, channel 1 - error:
> {amqp_error,not_found,"no queue 'charon' in vhost '/'",'queue.declare'}
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/f5ad61db/attachment.htm>

From mpietrek at skytap.com  Mon Oct 15 18:50:20 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Mon, 15 Oct 2012 10:50:20 -0700
Subject: [rabbitmq-discuss] RabbitMQ stops responding for a few seconds,
 logs a "Context: shutdown_error", then resumes as if nothing happened
In-Reply-To: <26A02451-6DDB-42BB-AB23-B2451597A93B@rabbitmq.com>
References: <CACLE7ixR5y3xTGfWXoXh506WoiSGzONKKTJ=m8PFXsf0E+AYGA@mail.gmail.com>
	<26A02451-6DDB-42BB-AB23-B2451597A93B@rabbitmq.com>
Message-ID: <CACLE7ix19MuPU+p9ynr7CXYcb5wNkwrQUmiHh9o5DE+o0HPBsw@mail.gmail.com>

Tim,

Unfortunately, the RabbitMQ logs are rather silent around the time of this
observed behavior. However, looking at other logs, I'm starting to suspect
that something triggered rsyslog (running on the same box) to send hundreds
of thousands of old log lines to another server, thus potentially choking
the ability of other processes (e.g. Rabbit) from responding during this
time.

I'll update this thread if I subsequently find something else beyond this.
For now, I'm inclined to call this closed.

On Mon, Oct 15, 2012 at 12:25 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Matt,
>
> Usual request for any scrubbed log(s) you can provide please! :)
>
> Also, if you could confirm that /api/queues every 5 seconds is the only
> non-amqp traffic the broker(s) will be subject to, that'd be quite useful
> to know as well.
>
> Cheers,
>
> Tim
>
>
> On 13 Oct 2012, at 00:43, Matt Pietrek wrote:
>
> > We've hit an odd circumstance in production that we can't make heads or
> tails of. Our setup is two RabbitMQ 2.8.6 nodes running clustered with all
> HA queues.
> >
> > In front of them is a VIP managed by a keepalive instances running on
> the same host as the RabbitMQ nodes. Every 5 seconds the keepalive instance
> runs a custom script that queries the node local broker via the HTTP API,
>  requesting the set of queues (/api/queues).
> >
> > From our logs, I can see that there was a single interval where the HTTP
> request returned a 404 error. (The time was the same on both brokers)
> Previous to this moment in time, all HTTP queries were successful, and
> after this moment in time, all queries were sucessful - As I said, just one
> blip on each broker.
> >
> > The only interesting thing we noticed in the logs was that the primary
> broker's rabbit at xxx-sasl file had this little snippet about 30 seconds
> after the hiccup occurred:
> >
> > =SUPERVISOR REPORT==== 12-Oct-2012::15:06:47 ===
> > Supervisor: {<0.25499.41>, rabbit_channel_sup_sup}
> > Context: shutdown_error
> > Reason: shutdown
> > Offender: [{pid,<0.25503.41>},
> > {name,channel_sup},
> > {mfa,{rabbit_channel_sup,start_link,[]}},
> > {restart_type,temporary},
> > {shutdown,infinity},
> > {child_type,supervisor}]
> >
> > I'm mostly at a loss to process what the snippet is telling me, nor can
> tell if the two things are related. Any help is appreciated!
> >
> > Thanks,
> >
> > Matt
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/32a8f171/attachment.htm>

From inebriectomy at gmail.com  Mon Oct 15 17:10:02 2012
From: inebriectomy at gmail.com (Jason Antman)
Date: Mon, 15 Oct 2012 09:10:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Monitoring A Queue
Message-ID: <602d0b86-217f-4bc2-9896-72a1334a8e12@googlegroups.com>

I've been tasked with monitoring a queue used by two applications, which 
are considered black boxes from my point of view (App A puts messages into 
a queue, App B consumes them; I have no control over the code for either 
app). I need to measure the rate of messages (messages/second) moving 
successfully from App A to App B through the queue. We're concerned with 
both pileups in the queue (producer working normally, consumer halted) and 
lack of new messages (producer halted). The end result will be a Nagios 
check plugin, which alerts when messages/second throughput falls below a 
given level, and also produces performance data for graphing.

I've been examining the JSON results from the management API 
(/api/queues/vhost_name/queue_name), and have come to the following 
conclusions:
1) There are no monotonically increasing counters of the number of messages 
in to the queue and number of messages out of the queue. Therefore, there's 
no way for me to figure the rate on an arbitrary time scale.
2) The "messages" element in the JSON array is the number of messages 
currently sitting in the queue, not a counter of the number that have 
passed through it.
3) The API does provide backing_queue_status.avg_ingress_rate and 
backing_queue_status.avg_egress_rate. Going by Matthew's post to 
"Monitoring Message Throughput" 
(http://rabbitmq.1065348.n5.nabble.com/Monitoring-Message-Throughput-td17436.html#a17438) 
from February, 2010, I gather that these values are averaged over approx. 
10 seconds. I'm also assuming that ingress is *every* message into the 
queue, and egress is... *every* message grabbed from the queue, regardless 
of ACK? So even if consumers are not acking any messages, this rate will 
still show them? 

Are these correct?

It would be really helpful if someone could explain exactly what 
avg_in/egress_rate and avg_ack_in/egress_rate mean.

I also found some reference to a Ticket 23 (though I don't see any links to 
the RMQ ticketing system) that dealt with monitoring:
http://grokbase.com/t/rabbitmq/rabbitmq-discuss/10ag2hejbb/ticket-23-new-comment-monitoring-message-throughput

Any guidance would be greatly appreciated. I've been trying to monitor this 
for over a day now, and can't seem to figure out the best way to do it...

Thanks,
Jason Antman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/c25b2214/attachment.htm>

From tim at rabbitmq.com  Mon Oct 15 20:49:33 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 15 Oct 2012 20:49:33 +0100
Subject: [rabbitmq-discuss] Loss of queues after network partition?
In-Reply-To: <CACLE7iy47mMa-_K5Y96SbMSiy8=17puBZfqR8Gv36fu_b=Ly9Q@mail.gmail.com>
References: <CACLE7iyF8XFc2hGmy0YyaUJmGkV05dDZ6v5dXOsTJeq_6+KcKg@mail.gmail.com>
	<507BE3FC.30104@rabbitmq.com>
	<CACLE7iy47mMa-_K5Y96SbMSiy8=17puBZfqR8Gv36fu_b=Ly9Q@mail.gmail.com>
Message-ID: <AC35F983-5099-4518-9898-632E2BDDD43E@rabbitmq.com>

Hi Matt,

On 15 Oct 2012, at 18:15, Matt Pietrek wrote:

> Thanks Tim! Glad to know I'm not crazy.
> 

No indeed, thanks for reporting this!

> > Are these HA queues durable and do they all "come back to life" after restarting the node(s)?
> 
> Unfortunately, I wasn't around when this particular problem occurred, but as the designated RabbitMQ expert, I got to piece together events from the logs.
> 
> So, I can tell you that the queues are all declared as HA. However, we didn't see the queues again until after we explicitly created them. Unfortunately, it doesn't look like there was a broker restart between when the queue was gone and when they were later declared, so no idea if a restart would have brought the queues back to life. Sorry about that...
> 

Ok not to worry, we'll keep that potential scenario in mind anyway.

Cheers,
Tim

> Matt
> 
> On Mon, Oct 15, 2012 at 3:22 AM, Tim Watson <tim at rabbitmq.com> wrote:
> Hi Matt,
> 
> This is a problem we're aware of (i.e., we have an open bug which we're working on!) and are looking at ways of handling it. What is basically happening here is that mnesia gets into an inconsistent state due to a network partition and the mnesia transaction manager sends unanticipated (and unhandled) messages to certain Erlang processes causing a crash.
> 
> Whilst this falls into the category of "Rabbit clusters do not handle network partitions" obviously we want to prevent this sort of thing happening and as I say, we're looking at various ways of responding in a somewhat more user friendly manner.
> 
> In the meanwhile, I'd be very interested to see if the queue information has actually been deleted from mnesia when this happens. Are these HA queues durable and do they all "come back to life" after restarting the node(s)?
> 
> Cheers,
> Tim
> 
> 
> On 10/12/2012 09:01 PM, Matt Pietrek wrote:
>> I'll be the first to admit that this is a somewhat unusual/complicated circumstance, but I'm posting this on the chance there's something unusual. This is RabbitMQ is 2.8.7 on Erlang R15B01.
>> 
>> We have two brokers (mq1, mq2) running clustered with all HA queues. A VIP is in front of them. 
>> 
>> At some point there was a network event, and afterwards, a queue vanished. (Still trying to figure out exactly what the network hiccup was, but it's fair to say there was a communication disruption between the nodes.)  My guess from looking at the logs is that each node had a moment where it couldn't see the other, so took actions that were ultimately incompatible when both nodes were visible to each other.
>> 
>> The actual error as seen by our code is a missing queue named "charon". You'll see it near the end of the rabbit at mq2.log (below):
>> 
>> {amqp_error,not_found,"no queue 'charon' in vhost '/'",'queue.declare'}
>> 
>> Prior to the network event, our client was successfully reading from the charon queue.
>> 
>> 
>> Here's the relevant parts of the rabbit at mq1.log file
>> ====================================================
>> =INFO REPORT==== 11-Oct-2012::14:01:58 ===
>> rabbit on node rabbit at mq2 down
>> 
>> =ERROR REPORT==== 11-Oct-2012::14:02:03 ===
>> Mnesia(rabbit at mq1): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, rabbit at mq2}
>> 
>> =ERROR REPORT==== 11-Oct-2012::14:02:03 ===
>> ** Generic server <0.547.0> terminating
>> ** Last message in was {mnesia_locker,rabbit at mq2,granted}
>> ** When Server state == {state,
>>                             {0,<0.547.0>},
>>                             {{0,<0.547.0>},undefined},
>>                             {{0,<0.547.0>},undefined},
>>                             {resource,<<"/">>,queue,<<"charon">>},
>>                             rabbit_mirror_queue_coordinator,
>>                             {3,
>>                              [{{0,<0.547.0>},
>>                                {view_member,
>>                                    {0,<0.547.0>},
>>                                    [],
>>                                    {0,<0.547.0>},
>>                                    {0,<0.547.0>}}}]},
>>                             1,[],
>>                             [<0.546.0>],
>>                             {[],[]},
>>                             [],undefined}
>> ** Reason for termination == 
>> ** {function_clause,
>>        [{gm,handle_info,
>>             [{mnesia_locker,rabbit at mq2,granted},
>>              {state,
>>                  {0,<0.547.0>},
>>                  {{0,<0.547.0>},undefined},
>>                  {{0,<0.547.0>},undefined},
>>                  {resource,<<"/">>,queue,<<"charon">>},
>>                  rabbit_mirror_queue_coordinator,
>>                  {3,
>>                   [{{0,<0.547.0>},
>>                     {view_member,
>>                         {0,<0.547.0>},
>>                         [],
>>                         {0,<0.547.0>},
>>                         {0,<0.547.0>}}}]},
>>                  1,[],
>>                  [<0.546.0>],
>>                  {[],[]},
>>                  [],undefined}],
>>             [{file,"src/gm.erl"},{line,665}]},
>>         {gen_server2,handle_msg,2,[{file,"src/gen_server2.erl"},{line,912}]},
>>         {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}
>> 
>> =ERROR REPORT==== 11-Oct-2012::14:02:03 ===
>> ** Generic server <0.545.0> terminating
>> ** Last message in was {'EXIT',<0.546.0>,
>>                         {function_clause,
>>                          [{gm,handle_info,
>>                            [{mnesia_locker,rabbit at mq2,granted},
>>                             {state,
>>                              {0,<0.547.0>},
>>                              {{0,<0.547.0>},undefined},
>>                              {{0,<0.547.0>},undefined},
>>                              {resource,<<"/">>,queue,<<"charon">>},
>>                              rabbit_mirror_queue_coordinator,
>>                              {3,
>>                               [{{0,<0.547.0>},
>>                                 {view_member,
>>                                  {0,<0.547.0>},
>>                                  [],
>>                                  {0,<0.547.0>},
>>                                  {0,<0.547.0>}}}]},
>>                              1,[],
>>                              [<0.546.0>],
>>                              {[],[]},
>>                              [],undefined}],
>>                            [{file,"src/gm.erl"},{line,665}]},
>>                           {gen_server2,handle_msg,2,
>>                            [{file,"src/gen_server2.erl"},{line,912}]},
>>                           {proc_lib,wake_up,3,
>>                            [{file,"proc_lib.erl"},{line,237}]}]}}
>> ** When Server state == {q,
>>                          {amqqueue,
>>                           {resource,<<"/">>,queue,<<"charon">>},
>>                           true,false,none,
>>                           [{<<"x-ha-policy">>,longstr,<<"all">>}],
>>                           <0.545.0>,[],all},
>>                          none,false,rabbit_mirror_queue_master,
>>                          {state,<0.547.0>,<0.546.0>,rabbit_variable_queue,
>>                           {vqstate,
>>                            {0,{[],[]}},
>>                            {0,{[],[]}},
>>                            {delta,undefined,0,undefined},
>>                            {0,{[],[]}},
>>                            {0,{[],[]}},
>>                            0,
>>                            {0,nil},
>>                            undefined,
>>                            {0,nil},
>>                            {qistate,
>>                             "/highland/var/lib/rabbit at mq1/queues/4L2SY4TVRPM8HP85JDVO85BPL",
>>                             {{dict,0,16,16,8,80,48,
>>                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                []},
>>                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                 []}}},
>>                              []},
>>                             undefined,0,262144,
>>                             #Fun<rabbit_variable_queue.2.121500735>,
>>                             {0,nil}},
>>                            {{client_msstate,msg_store_persistent,
>>                              <<112,32,84,92,54,73,67,43,231,35,164,79,106,8,27,
>>                                132>>,
>>                              {dict,0,16,16,8,80,48,
>>                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                []},
>>                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                 []}}},
>>                              {state,237637,
>>                               "/highland/var/lib/rabbit at mq1/msg_store_persistent"},
>>                              rabbit_msg_store_ets_index,
>>                              "/highland/var/lib/rabbit at mq1/msg_store_persistent",
>>                              <0.289.0>,241734,233540,245831,249928},
>>                             {client_msstate,msg_store_transient,
>>                              <<204,18,155,40,29,120,124,76,144,83,195,135,250,
>>                                91,216,3>>,
>>                              {dict,0,16,16,8,80,48,
>>                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                []},
>>                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                 []}}},
>>                              {state,217152,
>>                               "/highland/var/lib/rabbit at mq1/msg_store_transient"},
>>                              rabbit_msg_store_ets_index,
>>                              "/highland/var/lib/rabbit at mq1/msg_store_transient",
>>                              <0.284.0>,221249,213055,225346,229443}},
>>                            true,0,#Fun<rabbit_amqqueue_process.5.24780734>,0,
>>                            0,infinity,0,0,0,0,0,
>>                            {rates,
>>                             {{1349,988602,967125},0},
>>                             {{1349,988602,967125},0},
>>                             0.0,0.0,
>>                             {1349,988606,141019}},
>>                            {0,nil},
>>                            {0,nil},
>>                            {0,nil},
>>                            {0,nil},
>>                            0,0,
>>                            {rates,
>>                             {{1349,988602,967125},0},
>>                             {{1349,988602,967125},0},
>>                             0.0,0.0,
>>                             {1349,988606,141019}}},
>>                           0,
>>                           {dict,0,16,16,8,80,48,
>>                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                              []}}},
>>                           [],
>>                           {dict,0,16,16,8,80,48,
>>                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                              []}}},
>>                           {set,0,16,16,8,80,48,
>>                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                              []}}}},
>>                          {[],[]},
>>                          undefined,undefined,undefined,undefined,
>>                          {state,fine,5000,undefined},
>>                          {0,nil},
>>                          undefined,undefined,undefined,
>>                          {dict,0,16,16,8,80,48,
>>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>>                          1,
>>                          {{0,nil},{0,nil}},
>>                          undefined,
>>                          {dict,0,16,16,8,80,48,
>>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>>                          undefined,undefined}
>> ** Reason for termination == 
>> ** {noproc,{gen_server2,call,[<0.547.0>,info,infinity]}}
>> ** In 'terminate' callback with reason ==
>> ** {function_clause,
>>        [{gm,handle_info,
>>             [{mnesia_locker,rabbit at mq2,granted},
>>              {state,
>>                  {0,<0.547.0>},
>>                  {{0,<0.547.0>},undefined},
>>                  {{0,<0.547.0>},undefined},
>>                  {resource,<<"/">>,queue,<<"charon">>},
>>                  rabbit_mirror_queue_coordinator,
>>                  {3,
>>                   [{{0,<0.547.0>},
>>                     {view_member,
>>                         {0,<0.547.0>},
>>                         [],
>>                         {0,<0.547.0>},
>>                         {0,<0.547.0>}}}]},
>>                  1,[],
>>                  [<0.546.0>],
>>                  {[],[]},
>>                  [],undefined}],
>>             [{file,"src/gm.erl"},{line,665}]},
>>         {gen_server2,handle_msg,2,[{file,"src/gen_server2.erl"},{line,912}]},
>>         {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}
>> 
>> =INFO REPORT==== 11-Oct-2012::14:02:03 ===
>> Mirrored-queue (queue 'cmcmd' in vhost '/'): Master <rabbit at mq1.2.665.0> saw deaths of mirrors <rabbit at mq2.1.383.0> 
>> 
>> =INFO REPORT==== 11-Oct-2012::14:02:03 ===
>> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Master <rabbit at mq1.2.605.0> saw deaths of mirrors <rabbit at mq2.1.377.0> 
>> 
>> =INFO REPORT==== 11-Oct-2012::14:02:03 ===
>> global: Name conflict terminating {rabbit_mgmt_db,<3198.32532.0>}
>> 
>> =INFO REPORT==== 11-Oct-2012::14:26:40 ===
>> accepting AMQP connection <0.6507.1> (10.72.0.50:46742 -> 10.72.0.47:5672)
>> 
>> =INFO REPORT==== 11-Oct-2012::14:26:40 ===
>> closing AMQP connection <0.6507.1> (10.72.0.50:46742 -> 10.72.0.47:5672)
>> 
>> 
>> 
>> 
>> And here's the relevant parts of the rabbit at m2.log file
>> ====================================================
>> =ERROR REPORT==== 11-Oct-2012::14:01:37 ===
>> ** Node rabbit at mq1 not responding **
>> ** Removing (timedout) connection **
>> 
>> =INFO REPORT==== 11-Oct-2012::14:01:37 ===
>> rabbit on node rabbit at mq1 down
>> 
>> =INFO REPORT==== 11-Oct-2012::14:01:40 ===
>> Statistics database started.
>> 
>> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
>> Mirrored-queue (queue 'cmcmd' in vhost '/'): Slave <rabbit at mq2.1.383.0> saw deaths of mirrors <rabbit at mq1.2.665.0> 
>> 
>> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
>> Mirrored-queue (queue 'cmcmd' in vhost '/'): Promoting slave <rabbit at mq2.1.383.0> to master
>> 
>> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
>> Mirrored-queue (queue 'charon' in vhost '/'): Slave <rabbit at mq2.1.371.0> saw deaths of mirrors <rabbit at mq1.2.545.0> 
>> 
>> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
>> Mirrored-queue (queue 'charon' in vhost '/'): Promoting slave <rabbit at mq2.1.371.0> to master
>> 
>> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
>> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Slave <rabbit at mq2.1.377.0> saw deaths of mirrors <rabbit at mq1.2.605.0> 
>> 
>> =INFO REPORT==== 11-Oct-2012::14:01:43 ===
>> Mirrored-queue (queue 'ConfigurationManager' in vhost '/'): Promoting slave <rabbit at mq2.1.377.0> to master
>> 
>> =ERROR REPORT==== 11-Oct-2012::14:05:03 ===
>> Mnesia(rabbit at mq2): ** ERROR ** mnesia_event got {inconsistent_database, running_partitioned_network, rabbit at mq1}
>> 
>> =INFO REPORT==== 11-Oct-2012::14:05:03 ===
>> Statistics database started.
>> 
>> =ERROR REPORT==== 11-Oct-2012::14:29:39 ===
>> ** Generic server <0.32583.0> terminating
>> ** Last message in was {'$gen_cast',{gm_deaths,[<0.5504.1>]}}
>> ** When Server state == {state,
>>                             {amqqueue,
>>                                 {resource,<<"/">>,queue,<<"charon">>},
>>                                 true,false,none,
>>                                 [{<<"x-ha-policy">>,longstr,<<"all">>}],
>>                                 <0.371.0>,[],all},
>>                             <0.372.0>,
>>                             {dict,0,16,16,8,80,48,
>>                                 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                  []},
>>                                 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                   [],[]}}},
>>                             #Fun<rabbit_mirror_queue_master.1.32244930>,
>>                             #Fun<rabbit_mirror_queue_master.2.32244930>}
>> ** Reason for termination == 
>> ** {bad_return_value,
>>        {error,
>>            {{badmatch,[]},
>>             [{rabbit_mirror_queue_misc,'-remove_from_queue/2-fun-0-',2,
>>                  [{file,"src/rabbit_mirror_queue_misc.erl"},{line,63}]},
>>              {mnesia_tm,apply_fun,3,[{file,"mnesia_tm.erl"},{line,829}]},
>>              {mnesia_tm,execute_transaction,5,
>>                  [{file,"mnesia_tm.erl"},{line,809}]},
>>              {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1,
>>                  [{file,"src/rabbit_misc.erl"},{line,440}]},
>>              {worker_pool_worker,handle_call,3,
>>                  [{file,"src/worker_pool_worker.erl"},{line,80}]},
>>              {gen_server2,handle_msg,2,
>>                  [{file,"src/gen_server2.erl"},{line,879}]},
>>              {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}}}
>> 
>> =ERROR REPORT==== 11-Oct-2012::14:29:39 ===
>> ** Generic server <0.371.0> terminating
>> ** Last message in was {'EXIT',<0.32583.0>,
>>                         {bad_return_value,
>>                          {error,
>>                           {{badmatch,[]},
>>                            [{rabbit_mirror_queue_misc,
>>                              '-remove_from_queue/2-fun-0-',2,
>>                              [{file,"src/rabbit_mirror_queue_misc.erl"},
>>                               {line,63}]},
>>                             {mnesia_tm,apply_fun,3,
>>                              [{file,"mnesia_tm.erl"},{line,829}]},
>>                             {mnesia_tm,execute_transaction,5,
>>                              [{file,"mnesia_tm.erl"},{line,809}]},
>>                             {rabbit_misc,
>>                              '-execute_mnesia_transaction/1-fun-0-',1,
>>                              [{file,"src/rabbit_misc.erl"},{line,440}]},
>>                             {worker_pool_worker,handle_call,3,
>>                              [{file,"src/worker_pool_worker.erl"},{line,80}]},
>>                             {gen_server2,handle_msg,2,
>>                              [{file,"src/gen_server2.erl"},{line,879}]},
>>                             {proc_lib,wake_up,3,
>>                              [{file,"proc_lib.erl"},{line,237}]}]}}}}
>> ** When Server state == {q,
>>                          {amqqueue,
>>                           {resource,<<"/">>,queue,<<"charon">>},
>>                           true,false,none,
>>                           [{<<"x-ha-policy">>,longstr,<<"all">>}],
>>                           <0.371.0>,[],all},
>>                          none,false,rabbit_mirror_queue_master,
>>                          {state,<0.372.0>,<0.32583.0>,rabbit_variable_queue,
>>                           {vqstate,
>>                            {0,{[],[]}},
>>                            {0,{[],[]}},
>>                            {delta,undefined,0,undefined},
>>                            {0,{[],[]}},
>>                            {0,{[],[]}},
>>                            0,
>>                            {0,nil},
>>                            undefined,
>>                            {0,nil},
>>                            {qistate,
>>                             "/highland/var/lib/rabbit at mq2/queues/4L2SY4TVRPM8HP85JDVO85BPL",
>>                             {{dict,0,16,16,8,80,48,
>>                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                []},
>>                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                 []}}},
>>                              []},
>>                             undefined,0,262144,
>>                             #Fun<rabbit_variable_queue.2.121500735>,
>>                             {0,nil}},
>>                            {{client_msstate,msg_store_persistent,
>>                              <<23,245,132,154,3,96,225,184,108,75,232,224,184,
>>                                114,108,141>>,
>>                              {dict,0,16,16,8,80,48,
>>                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                []},
>>                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                 []}}},
>>                              {state,282693,
>>                               "/highland/var/lib/rabbit at mq2/msg_store_persistent"},
>>                              rabbit_msg_store_ets_index,
>>                              "/highland/var/lib/rabbit at mq2/msg_store_persistent",
>>                              <0.285.0>,286790,278596,290887,294984},
>>                             {client_msstate,msg_store_transient,
>>                              <<17,62,75,125,126,21,66,37,170,44,198,72,18,94,
>>                                170,197>>,
>>                              {dict,0,16,16,8,80,48,
>>                               {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                []},
>>                               {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                 []}}},
>>                              {state,262208,
>>                               "/highland/var/lib/rabbit at mq2/msg_store_transient"},
>>                              rabbit_msg_store_ets_index,
>>                              "/highland/var/lib/rabbit at mq2/msg_store_transient",
>>                              <0.280.0>,266305,258111,270402,274499}},
>>                            true,0,#Fun<rabbit_mirror_queue_slave.1.69615989>,
>>                            0,0,infinity,0,0,0,0,0,
>>                            {rates,
>>                             {{1349,989325,677031},0},
>>                             {{1349,989325,677031},0},
>>                             0.0,0.0,
>>                             {1349,989505,348090}},
>>                            {0,nil},
>>                            {0,nil},
>>                            {0,nil},
>>                            {0,nil},
>>                            0,0,
>>                            {rates,
>>                             {{1349,989325,677031},0},
>>                             {{1349,989325,677031},0},
>>                             0.0,0.0,
>>                             {1349,989505,348090}}},
>>                           0,
>>                           {dict,0,16,16,8,80,48,
>>                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                              []}}},
>>                           [],
>>                           {dict,0,16,16,8,80,48,
>>                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                              []}}},
>>                           {set,0,16,16,8,80,48,
>>                            {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>                            {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                              []}}}},
>>                          {[],[]},
>>                          undefined,undefined,undefined,undefined,
>>                          {state,fine,5000,undefined},
>>                          {0,nil},
>>                          undefined,undefined,undefined,
>>                          {dict,0,16,16,8,80,48,
>>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>>                          1,
>>                          {{0,nil},{0,nil}},
>>                          undefined,
>>                          {dict,0,16,16,8,80,48,
>>                           {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},
>>                           {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},
>>                          undefined,undefined}
>> ** Reason for termination == 
>> ** {noproc,{gen_server2,call,[<0.372.0>,info,infinity]}}
>> ** In 'terminate' callback with reason ==
>> ** {bad_return_value,
>>        {error,
>>            {{badmatch,[]},
>>             [{rabbit_mirror_queue_misc,'-remove_from_queue/2-fun-0-',2,
>>                  [{file,"src/rabbit_mirror_queue_misc.erl"},{line,63}]},
>>              {mnesia_tm,apply_fun,3,[{file,"mnesia_tm.erl"},{line,829}]},
>>              {mnesia_tm,execute_transaction,5,
>>                  [{file,"mnesia_tm.erl"},{line,809}]},
>>              {rabbit_misc,'-execute_mnesia_transaction/1-fun-0-',1,
>>                  [{file,"src/rabbit_misc.erl"},{line,440}]},
>>              {worker_pool_worker,handle_call,3,
>>                  [{file,"src/worker_pool_worker.erl"},{line,80}]},
>>              {gen_server2,handle_msg,2,
>>                  [{file,"src/gen_server2.erl"},{line,879}]},
>>              {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,237}]}]}}}
>> 
>> =INFO REPORT==== 11-Oct-2012::14:29:43 ===
>> accepting AMQP connection <0.5524.1> (10.72.0.23:36056 -> 10.72.0.56:5672)
>> 
>> =INFO REPORT==== 11-Oct-2012::14:29:44 ===
>> accepting AMQP connection <0.5574.1> (10.72.0.23:36064 -> 10.72.0.56:5672)
>> 
>> =INFO REPORT==== 11-Oct-2012::17:56:16 ===
>> accepting AMQP connection <0.23868.1> (10.72.0.53:57122 -> 10.72.0.56:5672)
>> 
>> =ERROR REPORT==== 11-Oct-2012::17:56:16 ===
>> connection <0.23868.1>, channel 1 - error:
>> {amqp_error,not_found,"no queue 'charon' in vhost '/'",'queue.declare'}
>> 
>> =WARNING REPORT==== 11-Oct-2012::17:56:16 ===
>> closing AMQP connection <0.23868.1> (10.72.0.53:57122 -> 10.72.0.56:5672):
>> connection_closed_abruptly
>> 
>> =INFO REPORT==== 11-Oct-2012::17:56:16 ===
>> accepting AMQP connection <0.23878.1> (10.72.0.52:56025 -> 10.72.0.56:5672)
>> 
>> =ERROR REPORT==== 11-Oct-2012::17:56:16 ===
>> connection <0.23878.1>, channel 1 - error:
>> {amqp_error,not_found,"no queue 'charon' in vhost '/'",'queue.declare'}
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> 
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


From tim at rabbitmq.com  Mon Oct 15 20:50:11 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 15 Oct 2012 20:50:11 +0100
Subject: [rabbitmq-discuss] RabbitMQ stops responding for a few seconds,
	logs a "Context: shutdown_error",
	then resumes as if nothing happened
In-Reply-To: <CACLE7ix19MuPU+p9ynr7CXYcb5wNkwrQUmiHh9o5DE+o0HPBsw@mail.gmail.com>
References: <CACLE7ixR5y3xTGfWXoXh506WoiSGzONKKTJ=m8PFXsf0E+AYGA@mail.gmail.com>
	<26A02451-6DDB-42BB-AB23-B2451597A93B@rabbitmq.com>
	<CACLE7ix19MuPU+p9ynr7CXYcb5wNkwrQUmiHh9o5DE+o0HPBsw@mail.gmail.com>
Message-ID: <D03E1C14-36D6-46BF-B4E8-DD7F7D4FB6C0@rabbitmq.com>

Matt,

Ok no problem, but do let us know if anything like this shows up again!

Cheers,
Tim


On 15 Oct 2012, at 18:50, Matt Pietrek wrote:

> Tim,
> 
> Unfortunately, the RabbitMQ logs are rather silent around the time of this observed behavior. However, looking at other logs, I'm starting to suspect that something triggered rsyslog (running on the same box) to send hundreds of thousands of old log lines to another server, thus potentially choking the ability of other processes (e.g. Rabbit) from responding during this time.
> 
> I'll update this thread if I subsequently find something else beyond this. For now, I'm inclined to call this closed.
> 
> On Mon, Oct 15, 2012 at 12:25 AM, Tim Watson <tim at rabbitmq.com> wrote:
> Hi Matt,
> 
> Usual request for any scrubbed log(s) you can provide please! :)
> 
> Also, if you could confirm that /api/queues every 5 seconds is the only non-amqp traffic the broker(s) will be subject to, that'd be quite useful to know as well.
> 
> Cheers,
> 
> Tim
> 
> 
> On 13 Oct 2012, at 00:43, Matt Pietrek wrote:
> 
> > We've hit an odd circumstance in production that we can't make heads or tails of. Our setup is two RabbitMQ 2.8.6 nodes running clustered with all HA queues.
> >
> > In front of them is a VIP managed by a keepalive instances running on the same host as the RabbitMQ nodes. Every 5 seconds the keepalive instance runs a custom script that queries the node local broker via the HTTP API,  requesting the set of queues (/api/queues).
> >
> > From our logs, I can see that there was a single interval where the HTTP request returned a 404 error. (The time was the same on both brokers) Previous to this moment in time, all HTTP queries were successful, and after this moment in time, all queries were sucessful - As I said, just one blip on each broker.
> >
> > The only interesting thing we noticed in the logs was that the primary broker's rabbit at xxx-sasl file had this little snippet about 30 seconds after the hiccup occurred:
> >
> > =SUPERVISOR REPORT==== 12-Oct-2012::15:06:47 ===
> > Supervisor: {<0.25499.41>, rabbit_channel_sup_sup}
> > Context: shutdown_error
> > Reason: shutdown
> > Offender: [{pid,<0.25503.41>},
> > {name,channel_sup},
> > {mfa,{rabbit_channel_sup,start_link,[]}},
> > {restart_type,temporary},
> > {shutdown,infinity},
> > {child_type,supervisor}]
> >
> > I'm mostly at a loss to process what the snippet is telling me, nor can tell if the two things are related. Any help is appreciated!
> >
> > Thanks,
> >
> > Matt
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From aggarwalsandeep at optonline.net  Tue Oct 16 01:17:12 2012
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Mon, 15 Oct 2012 17:17:12 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ production ready in Windows
In-Reply-To: <b6a594a0-a6ca-46cb-bdd3-e1485797304c@googlegroups.com>
References: <e8aa15e4-c760-4904-8e55-93bca3df4ef9@googlegroups.com>
	<f32ceb09-f115-457a-b778-732958bb5e89@googlegroups.com>
	<d8152d44-7907-45a5-a764-d94dbdb3fe9b@googlegroups.com>
	<b6a594a0-a6ca-46cb-bdd3-e1485797304c@googlegroups.com>
Message-ID: <48049334-de08-4dd6-9094-d9e206ee9271@googlegroups.com>

This worked great. Thx a lot. 

On Monday, October 15, 2012 2:28:42 AM UTC-4, Bruno CHALOPIN wrote:
>
> Hi,
>
> Had the same problem (with an error message during installation) and it 
> was because i haven't installed vc 2010 runtimes first.
>
> Le dimanche 14 octobre 2012 08:43:20 UTC+2, Sandy a ?crit :
>>
>> Hi - 
>>
>> I was trying to install Erlang on Win 2003 server but for some reason I 
>> don't see the bin folder getting setup. However, it seems to be working 
>> fine on the 2008 box. Are you aware of any issues on 2003? Thx!
>>
>> Sandy
>>
>> On Thursday, October 4, 2012 4:34:04 AM UTC-4, Christoph wrote:
>>>
>>> Yes - without any problems (Windows 2008 R2)
>>>
>>> On Monday, October 1, 2012 11:42:20 AM UTC+2, R??acki Krzysztof wrote:
>>>>
>>>> Hi,
>>>>
>>>> I'm trying to introduce RabbitMQ as our backbone messaging service. My 
>>>> first basic question is whether RabbitMQ is used in production on Windows 
>>>> server from 2003 onwards ?
>>>>
>>>> Thank you
>>>>
>>>> Chris
>>>>
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121015/e6b36553/attachment.htm>

From wongkamhoong at gmail.com  Tue Oct 16 03:20:14 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Tue, 16 Oct 2012 10:20:14 +0800
Subject: [rabbitmq-discuss] RabbitMQ node stopped while broker still up
Message-ID: <CAHv8OSRbwbg8GcNqa10qt-DL50Y6Cyx46J4dKF4NpUP8eJct8w@mail.gmail.com>

Hi RabbitMQ Team,

This morning while I checked the RabbitMQs status through web admin, I
found that one of the RabbitMQ node stopped.

RabbitMQ v2.8.7
Erlang v*R14B04*
*Cluster: Yes, 3 RabbitMQs*

Attached is the log for your reference.

After I restarted the service, then everything back to normal.

I wonder is the problem related to partitioned network:

http://rabbitmq.1065348.n5.nabble.com/Statistics-database-could-not-be-contacted-Message-rates-and-queue-lengths-will-not-be-shown-td22331.html

Thanks & Regards,
Wong
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/85d36ff9/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit.zip
Type: application/zip
Size: 4446 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/85d36ff9/attachment.zip>

From Kuldeep.Jasani at necindia.in  Tue Oct 16 00:46:56 2012
From: Kuldeep.Jasani at necindia.in (Kuldeep Jasani)
Date: Tue, 16 Oct 2012 07:46:56 +0800
Subject: [rabbitmq-discuss] Messages disappearing from RMQ v2.8.4
Message-ID: <2021BE26A04D2E40BF88955AB4EBB96A05EBA5CE@NECSAP-SIN-XCH.NECSAPSIN.COM>

Dear All,

 

I would sound naive, but please forgive me. This is my first post to
this community; I appreciate all hardwork and effort you all have put to
make this MQ a great success!

 

I have following Query:-

1. Are there specific changes to 2.7.1 build as compared to 2.8.4
version for RHEL x64 distribution which anticipates message loss from
RMQ?

2. Is implementation from MQ API any different from 2.4.2 => 2.7.1 =>
2.8.4 will any specific implementation cause such instance?

 

I believe and have seen RMQ  being the best MQ around; Thanks for being
around.

 

Regards,

Kuldeep

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/9025c7b9/attachment.htm>

From Oren.Berenson at aimia.com  Tue Oct 16 09:42:46 2012
From: Oren.Berenson at aimia.com (Oren Berenson)
Date: Tue, 16 Oct 2012 09:42:46 +0100
Subject: [rabbitmq-discuss] bindings using complex criteria
Message-ID: <42E9885A5A6DCB4588AC4C308153AA2C5E092824@GALMSXMB01.LMUK.local>

Hi,

We need to do binding using greater than, less than etc using a combination of several key/values. For example a consumer must only receive messages where value > 10 and  y < dateTime >  x.

Assuming we have a component that can generate all the required headers before the message is sent to an exchange, is it possible to do such thing with Headers exchange? 
Would it perform well? We are looking at a throughput of 1000 messages per second at least. 
What would be the best approach for such requirement?

Thanks



From simon at rabbitmq.com  Tue Oct 16 10:10:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 16 Oct 2012 10:10:41 +0100
Subject: [rabbitmq-discuss] RabbitMQ node stopped while broker still up
In-Reply-To: <CAHv8OSRbwbg8GcNqa10qt-DL50Y6Cyx46J4dKF4NpUP8eJct8w@mail.gmail.com>
References: <CAHv8OSRbwbg8GcNqa10qt-DL50Y6Cyx46J4dKF4NpUP8eJct8w@mail.gmail.com>
Message-ID: <507D2491.9020207@rabbitmq.com>

Hi. There's nothing in that log to indicate why the node shut down - can 
you post the sasl log somewhere?

I don't know if it's related to the network partition. But please bear 
in mind that network partitions are really bad for RabbitMQ clusters.

Cheers, Simon

On 16/10/12 03:20, Wong Kam Hoong wrote:
> Hi RabbitMQ Team,
>
> This morning while I checked the RabbitMQs status through web admin, I
> found that one of the RabbitMQ node stopped.
>
> RabbitMQ v2.8.7
> Erlang v*R14B04*
> *Cluster: Yes, 3 RabbitMQs*
>
> Attached is the log for your reference.
>
> After I restarted the service, then everything back to normal.
>
> I wonder is the problem related to partitioned network:
>
> http://rabbitmq.1065348.n5.nabble.com/Statistics-database-could-not-be-contacted-Message-rates-and-queue-lengths-will-not-be-shown-td22331.html
>
> Thanks & Regards,
> Wong
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Oct 16 10:22:47 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 16 Oct 2012 10:22:47 +0100
Subject: [rabbitmq-discuss] bindings using complex criteria
In-Reply-To: <42E9885A5A6DCB4588AC4C308153AA2C5E092824@GALMSXMB01.LMUK.local>
References: <42E9885A5A6DCB4588AC4C308153AA2C5E092824@GALMSXMB01.LMUK.local>
Message-ID: <507D2767.5050709@rabbitmq.com>

On 16/10/12 09:42, Oren Berenson wrote:
> We need to do binding using greater than, less than etc using a
> combination of several key/values. For example a consumer must only
> receive messages where value > 10 and  y < dateTime >  x.
>
> Assuming we have a component that can generate all the required
> headers before the message is sent to an exchange, is it possible to
> do such thing with Headers exchange? Would it perform well? We are
> looking at a throughput of 1000 messages per second at least. What
> would be the best approach for such requirement?

I'm afraid the headers exchange will only do exact matching. It should 
perform OK, though.

I'm not sure there is any built in functionality for what you want to 
do, short of "write your own exchange type" which may not be what you 
want to hear...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From wongkamhoong at gmail.com  Tue Oct 16 10:32:14 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Tue, 16 Oct 2012 17:32:14 +0800
Subject: [rabbitmq-discuss] RabbitMQ node stopped while broker still up
In-Reply-To: <507D2491.9020207@rabbitmq.com>
References: <CAHv8OSRbwbg8GcNqa10qt-DL50Y6Cyx46J4dKF4NpUP8eJct8w@mail.gmail.com>
	<507D2491.9020207@rabbitmq.com>
Message-ID: <CAHv8OSQmLrr=fRj6dK954GzAK9vWXNroxEJtL_Boz6ceBpBgNg@mail.gmail.com>

Hi Simon,

I check in the sasl log, but it not being update for long time, the issue
happened at 16-oct-2012 but the latest info showed in the log is only up to
2-oct-2012.

Attached is the requested sasl log for the server.

Yea, I remember you mentioned before RabbitMQ not recommend to run in
partitioned network, we still waiting network team to tell us whether those
RabbitMQs is it really deployed in a partitioned network..

Just curios, how RabbitMQ identify whether the nodes deployed
in partitioned network? I asked this question so that I can discuss better
with network team.

Regards,
Wong


On Tue, Oct 16, 2012 at 5:10 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi. There's nothing in that log to indicate why the node shut down - can
> you post the sasl log somewhere?
>
> I don't know if it's related to the network partition. But please bear in
> mind that network partitions are really bad for RabbitMQ clusters.
>
> Cheers, Simon
>
>
> On 16/10/12 03:20, Wong Kam Hoong wrote:
>
>> Hi RabbitMQ Team,
>>
>> This morning while I checked the RabbitMQs status through web admin, I
>> found that one of the RabbitMQ node stopped.
>>
>> RabbitMQ v2.8.7
>> Erlang v*R14B04*
>> *Cluster: Yes, 3 RabbitMQs*
>>
>>
>> Attached is the log for your reference.
>>
>> After I restarted the service, then everything back to normal.
>>
>> I wonder is the problem related to partitioned network:
>>
>> http://rabbitmq.1065348.n5.**nabble.com/Statistics-**
>> database-could-not-be-**contacted-Message-rates-and-**
>> queue-lengths-will-not-be-**shown-td22331.html<http://rabbitmq.1065348.n5.nabble.com/Statistics-database-could-not-be-contacted-Message-rates-and-queue-lengths-will-not-be-shown-td22331.html>
>>
>> Thanks & Regards,
>> Wong
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/e7af806d/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sasl.zip
Type: application/zip
Size: 11352 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/e7af806d/attachment.zip>

From simon at rabbitmq.com  Tue Oct 16 11:33:06 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 16 Oct 2012 11:33:06 +0100
Subject: [rabbitmq-discuss] RabbitMQ node stopped while broker still up
In-Reply-To: <CAHv8OSQmLrr=fRj6dK954GzAK9vWXNroxEJtL_Boz6ceBpBgNg@mail.gmail.com>
References: <CAHv8OSRbwbg8GcNqa10qt-DL50Y6Cyx46J4dKF4NpUP8eJct8w@mail.gmail.com>
	<507D2491.9020207@rabbitmq.com>
	<CAHv8OSQmLrr=fRj6dK954GzAK9vWXNroxEJtL_Boz6ceBpBgNg@mail.gmail.com>
Message-ID: <507D37E2.5020809@rabbitmq.com>

Hmm. The SASL log will not necessarily have to contain anything, it is 
really more of an error log. So I guess there was no error.

Aha! The log contains:

   =INFO REPORT==== 16-Oct-2012::00:48:36 ===
   Halting Erlang VM

We only log that after invocation of "rabbitmqctl stop". So the reason 
that node shut down was, umm, someone told it to.

And regarding network partitions, we get information about that from 
Mnesia. Mnesia will log something like:

   =ERROR REPORT==== 16-Oct-2012::00:04:19 ===
   Mnesia(nplay at app2): ** ERROR ** mnesia_event got
     {inconsistent_database, running_partitioned_network, nplay at web2}

when it has detected a network partition. Note the 
"running_partitioned_network" - it will also log a very similar message 
with "starting_partitioned_network" the first time it starts *after* a 
partition.

Future versions of RabbitMQ will make this information more accessible.

Cheers, Simon

On 16/10/12 10:32, Wong Kam Hoong wrote:
> Hi Simon,
>
> I check in the sasl log, but it not being update for long time, the
> issue happened at 16-oct-2012 but the latest info showed in the log is
> only up to 2-oct-2012.
>
> Attached is the requested sasl log for the server.
>
> Yea, I remember you mentioned before RabbitMQ not recommend to run in
> partitioned network, we still waiting network team to tell us whether
> those RabbitMQs is it really deployed in a partitioned network..
>
> Just curios, how RabbitMQ identify whether the nodes deployed
> in partitioned network? I asked this question so that I can discuss
> better with network team.
>
> Regards,
> Wong
>
>
> On Tue, Oct 16, 2012 at 5:10 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Hi. There's nothing in that log to indicate why the node shut down -
>     can you post the sasl log somewhere?
>
>     I don't know if it's related to the network partition. But please
>     bear in mind that network partitions are really bad for RabbitMQ
>     clusters.
>
>     Cheers, Simon
>
>
>     On 16/10/12 03:20, Wong Kam Hoong wrote:
>
>         Hi RabbitMQ Team,
>
>         This morning while I checked the RabbitMQs status through web
>         admin, I
>         found that one of the RabbitMQ node stopped.
>
>         RabbitMQ v2.8.7
>         Erlang v*R14B04*
>         *Cluster: Yes, 3 RabbitMQs*
>
>
>         Attached is the log for your reference.
>
>         After I restarted the service, then everything back to normal.
>
>         I wonder is the problem related to partitioned network:
>
>         http://rabbitmq.1065348.n5.__nabble.com/Statistics-__database-could-not-be-__contacted-Message-rates-and-__queue-lengths-will-not-be-__shown-td22331.html
>         <http://rabbitmq.1065348.n5.nabble.com/Statistics-database-could-not-be-contacted-Message-rates-and-queue-lengths-will-not-be-shown-td22331.html>
>
>         Thanks & Regards,
>         Wong
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Oct 16 11:42:36 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 16 Oct 2012 11:42:36 +0100
Subject: [rabbitmq-discuss] Messages disappearing from RMQ v2.8.4
In-Reply-To: <2021BE26A04D2E40BF88955AB4EBB96A05EBA5CE@NECSAP-SIN-XCH.NECSAPSIN.COM>
References: <2021BE26A04D2E40BF88955AB4EBB96A05EBA5CE@NECSAP-SIN-XCH.NECSAPSIN.COM>
Message-ID: <507D3A1C.1090202@rabbitmq.com>

On 16/10/12 00:46, Kuldeep Jasani wrote:
> I have following Query:-
>
> 1. Are there specific changes to 2.7.1 build as compared to 2.8.4
> version for RHEL x64 distribution which anticipates message loss from RMQ?

Well, we always try to ensure that we don't lose messages :-) There are 
plenty of bugs fixed in 2.8.4 compared to 2.7.1. But 2.8.7 has even fewer...

> 2. Is implementation from MQ API any different from 2.4.2 => 2.7.1 =>
> 2.8.4 will any specific implementation cause such instance?

The APIs are basically the same.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From raphael.degiusti at guardis.com  Tue Oct 16 11:47:31 2012
From: raphael.degiusti at guardis.com (=?ISO-8859-1?Q?Rapha=EBl_De_GIUSTI?=)
Date: Tue, 16 Oct 2012 12:47:31 +0200
Subject: [rabbitmq-discuss] "service rabbitmq-server start" hangs when using
	python's Popen from subprocess.
Message-ID: <CAFw-dimu4Z34C14rnyogDZRsTAV44XKqhOp6jRar-i4TYQ5Jkw@mail.gmail.com>

Hi everyone,

Starting the rabbitmq-server service with python's Popen from subprocess
makes it hang.

Here's the little snippet to reproduce it (tested on Fedora 16 + Python2.7
and Centos 6.3 + Python2.6)

from subprocess import PIPE, Popen
> proc = Popen('service rabbitmq-server start', shell=True, stderr=PIPE,
> stdout=PIPE)
> print proc.communicate()


Problem is with "stdout=PIPE", I think.

The following snippet works, using proc.wait()

from subprocess import PIPE, Popen
> proc = Popen('service rabbitmq-server start', shell=True, stderr=PIPE,
> stdout=PIPE)
> print proc.wait()


Any idea on how to fix it using proc.communicate() because I need feedback
from the "subprocess.PIPE" ?

Thank you.

Raphael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/3e3d2df0/attachment.htm>

From tim at rabbitmq.com  Tue Oct 16 12:28:33 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 16 Oct 2012 12:28:33 +0100
Subject: [rabbitmq-discuss] Response times for publisher confirms
In-Reply-To: <CACxyq579SGwzuFpX_xQikkYOP5yX139UQuoi_r1r-qYCO9WwgA@mail.gmail.com>
References: <CACxyq579SGwzuFpX_xQikkYOP5yX139UQuoi_r1r-qYCO9WwgA@mail.gmail.com>
Message-ID: <B306DD00-5B75-438B-9804-B9DEE96A8466@rabbitmq.com>

Hi

On 15 Oct 2012, at 16:32, Aaron Pfeifer wrote:

> Hey everyone -
> 
> We've been running some tests on a RabbitMQ stack that we have running in EC2 and encountered some unexpected behaviors in the response times for publisher confirms and wanted to see if folks here had an idea of what the root cause might be.
> 
> First, some details on the stack:
> * EC2 m1.xlarge (15GB memory, 8 EC2 compute units, 64-bit, 1 Gigabit Ethernet)
> * Ubuntu 10.04
> * Erlang R13B03
> * RabbitMQ 2.8.5
> * Mounted to 4 RAID0 ephemeral drives (I believe 400GB each)
> 
> ...and some details on the setup:
> * 16 durable, fanout exchanges
> * 16 durable queues
> * Each exchange mapped to a single queue
> * Each message published as persistent
> 
> We have about 5,000 connections (over many servers) publishing a message once every 15s.  Each connection has publisher confirms enabled.  Each message is approximately 10-15KB in size (give or take).  While running this test we tracked the following data:
> 
> * Maximum amount of time to receive a confirm: http://i.imgur.com/SrXJP.png
> * Average amount of time to receive a confirm: http://i.imgur.com/ryWmr.png
> 
> Looking at this graph seems to indicate that there's something going on in RabbitMQ about every 10 minutes that causes a significant increase in the amount of time it takes to receive a publisher confirm.
> 
> To get some further data about what was happening during each of these spikes, we logged the following data through vmstat and iostat on the machine: https://gist.github.com/3874134.  You'll notice that during this spike we experience a significant decrease in the amount of data being written to disk and a significant increase in the await time on each disk.
> 

I note from vmstat that there are quite a few other processes running - are you sure that there is no contention for the disk between rabbit and another application running on the instance? If another application is performing synchronous I/O then that might account for some of what you're seeing.

Are you publishing and/or expecting confirms in batches? Can you see a constant (flat) throughput in the management UI as well?

> And just a little background: we were planning on using durable queues and publisher confirms to verify that the message was actually received by RabbitMQ.  I believe I've also read that publisher confirms are typically preferred to transactions.
> 

Yes they're generally much faster than transactions. Bare in mind though, that if you're asking for confirms and the messages are persistent, then you're asking rabbit to fsync to disk repeatedly which is very expensive. Whether or not this is related to what you're seeing every 10 minutes is a little unclear to me, though some of the more knowledgeable rabbits may spot something I've missed here.

If you're interested in amortizing the round trip cost, then you could consider dealing with confirms asynchronously as well. But either way, it's probably worth making sure there's not I/O contention from outside sources at regular intervals first. 


From tim at rabbitmq.com  Tue Oct 16 12:34:12 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 16 Oct 2012 12:34:12 +0100
Subject: [rabbitmq-discuss] "service rabbitmq-server start" hangs when
	using python's Popen from subprocess.
In-Reply-To: <CAFw-dimu4Z34C14rnyogDZRsTAV44XKqhOp6jRar-i4TYQ5Jkw@mail.gmail.com>
References: <CAFw-dimu4Z34C14rnyogDZRsTAV44XKqhOp6jRar-i4TYQ5Jkw@mail.gmail.com>
Message-ID: <311797F5-F900-4DF2-9F1C-D6047A9A1737@rabbitmq.com>

When you run RabbitMQ on an rpm based distro using /sbin/service then the init script is going to redirect stdio, as you would expect for a service/daemon. You'll need to start RabbitMQ directly from the ./scripts/rabbitmq-server shell script I guess, if you want to grab stdio - or tail the logs? 

On 16 Oct 2012, at 11:47, Rapha?l De GIUSTI wrote:

> Hi everyone,
> 
> Starting the rabbitmq-server service with python's Popen from subprocess makes it hang.
> 
> Here's the little snippet to reproduce it (tested on Fedora 16 + Python2.7 and Centos 6.3 + Python2.6)
> 
> from subprocess import PIPE, Popen
> proc = Popen('service rabbitmq-server start', shell=True, stderr=PIPE, stdout=PIPE)
> print proc.communicate()
> 
> Problem is with "stdout=PIPE", I think.
> 
> The following snippet works, using proc.wait()
> 
> from subprocess import PIPE, Popen
> proc = Popen('service rabbitmq-server start', shell=True, stderr=PIPE, stdout=PIPE)
> print proc.wait()
> 
> Any idea on how to fix it using proc.communicate() because I need feedback from the "subprocess.PIPE" ?
> 
> Thank you.
> 
> Raphael
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From matthias at rabbitmq.com  Tue Oct 16 12:38:17 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 16 Oct 2012 12:38:17 +0100
Subject: [rabbitmq-discuss] Response times for publisher confirms
In-Reply-To: <B306DD00-5B75-438B-9804-B9DEE96A8466@rabbitmq.com>
References: <CACxyq579SGwzuFpX_xQikkYOP5yX139UQuoi_r1r-qYCO9WwgA@mail.gmail.com>
	<B306DD00-5B75-438B-9804-B9DEE96A8466@rabbitmq.com>
Message-ID: <507D4729.6070209@rabbitmq.com>

On 16/10/12 12:28, Tim Watson wrote:
> Yes they're generally much faster than transactions. Bare in mind
> though, that if you're asking for confirms and the messages are
> persistent, then you're asking rabbit to fsync to disk repeatedly
> which is very expensive. Whether or not this is related to what
> you're seeing every 10 minutes is a little unclear to me, though some
> of the more knowledgeable rabbits may spot something I've missed
> here.

Nothing in rabbit is scheduled at a ten minute interval.

I can just about imagine that with a very regular load some ten minute 
pattern might emerge, but the more likely cause is some other 
application causing io contention.

Regards,

Matthias.

From matthias at rabbitmq.com  Tue Oct 16 12:52:29 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 16 Oct 2012 12:52:29 +0100
Subject: [rabbitmq-discuss] Field Type 'A'
In-Reply-To: <CCA1A072.5274%Michael.Laing@nytimes.com>
References: <CCA1A072.5274%Michael.Laing@nytimes.com>
Message-ID: <507D4A7D.1020308@rabbitmq.com>

Michael,

On 15/10/12 16:24, Laing, Michael P. wrote:
> Then the table is misleading in my opinion, causing developers for
> 'unsupported' clients to mistakenly implement the column in the table and
> think they are done. Not the desired outcome, and an understandable
> oversight by the nodejs-amqp author, I think.
>
> Plus the comment is ambiguous as it says that field-array type is
> implemented but not which tag is used. It should also be placed in C above
> to make it clear that it goes with the table.
>
> Or perhaps a RabbitMQ column separate from Qpid would make sense.

Well, that entire section, as stated, is a copy of an email to the AMQP 
dev list. So we really shouldn't change it. But guess what, I just have :)

Matthias.

From tim at rabbitmq.com  Tue Oct 16 12:57:31 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 16 Oct 2012 12:57:31 +0100
Subject: [rabbitmq-discuss] AMQP restart
In-Reply-To: <CAKwS4ihkJQL0GUikY0C1t62LLJntNM3BDiFssV2pjHvB27r_1Q@mail.gmail.com>
References: <CAKwS4ihkJQL0GUikY0C1t62LLJntNM3BDiFssV2pjHvB27r_1Q@mail.gmail.com>
Message-ID: <11E928B9-DE40-42CB-BA7C-7034398EF240@rabbitmq.com>

Hi!

On 15 Oct 2012, at 16:07, tom kelly wrote:

> Hi List,
> New user here, debugging some code I inherited so apologies if my questions below are irrelevant.
> 
> I'm investigating an amqp crash that I've seen in my logs a few times and after a code review of the amqp component I'm a bit concerned that my connections may be dying & silently failing when this crash occurs.
> 

Ok, let's look at that then.

> I'm using an older version that unlinked from the process that called "start_link", anyone know why that was? I'm publishing through this channel by calling amqp_channel:cast, so now I'm worried that if the connection & channel were closed down everything that I thought I was publishing after this error just silently failed. And because of the unlink there's no way the application would have known.
> 

I'm really no too sure about this unlink business, but if you could clarify where that was happening then I can probably look through the hg logs to try and figure out what was going on there.

> I plan upgrading to the latest version but I'm not sure that it has all the features to help solve this problem. I see that the unlink is gone and the supervision policy is still:{one_for_all, 0, 1} So I guess this means I have to trap exits and I have responsibility for reopening the connection & channel if it dies?

My reading of the supervision hierarchy is thus:

The application has a top level simple_one_for_one supervisor for all connections, which handles the amqp_connection_sup. This just ensures that each connection can actually be started and they connection_sup is temporary, so no restarts will ever take place. This is presumably what you'd expect, as we're not trying to second guess how long your connections need to live for.

The actual connection consists of a few processes - the gen_connection, connection_type_sup and channel_sup_sup. This is a one_for_all supervisor and the actual gen_connection process is an 'intrinsic' worker, so a non-normal exit will kill the supervisor (and sibling processes), but a normal exit will take everyone else down cleanly.

Now the channel_sup_sup starts a temporary worker (amqp_channel_sup) and that starts an intrinsic worker.  So all in all, it looks to me as if the connection and channel will be properly re-established if a non-normal exit occurs.

> But before I restart it, what happens to any attempts to publish messages? I see there's new confirmation functionality that sounds like it might do what's required but from my reading it seems that if amqp_channel is shut down after a crash on the connection then all the confirm info is discarded. Is there no way to keep this process alive and try to re-open the connection immediately on failure?
> 

I'm not really sure what you're asking here, but my reading of the client is that if you're expecting a confirm and you've not seen it, then you can/should assume the message wasn't accepted by the broker. If you're asking about tracking the confirms between channel instances, then yes, you'll need to do that yourself, using whatever mechanism suits your design (shared/stable storage, stateful parent process, etc).

> I'm just about to plug in the new version and play with the confirmations but any explanations of the current design might help enormously,
> Thanks,
> //TTom.


Well I hope my comments have made it a bit clearly and not worse! Please *do* feel free to come back with any questions, or to clear up anything I've not explained properly.

Cheers,
Tim


From raphael.degiusti at guardis.com  Tue Oct 16 13:15:05 2012
From: raphael.degiusti at guardis.com (=?ISO-8859-1?Q?Rapha=EBl_De_GIUSTI?=)
Date: Tue, 16 Oct 2012 14:15:05 +0200
Subject: [rabbitmq-discuss] "service rabbitmq-server start" hangs when
 using python's Popen from subprocess.
In-Reply-To: <311797F5-F900-4DF2-9F1C-D6047A9A1737@rabbitmq.com>
References: <CAFw-dimu4Z34C14rnyogDZRsTAV44XKqhOp6jRar-i4TYQ5Jkw@mail.gmail.com>
	<311797F5-F900-4DF2-9F1C-D6047A9A1737@rabbitmq.com>
Message-ID: <CAFw-di=qF1FmawgoNb=qsk5qBCo6eOQqPwBDMw4-OrwGRLvx7g@mail.gmail.com>

Well, I have the same problem when subprocessing
"/etc/init.d/rabbitmq-server start".

Note that I have no problem subprocessing "service rabbitmq-server status"
or "service rabbitmq-server stop" (or any other service).

My only issue is with the start method of /etc/init.d/rabbitmq-server init
script.



On Tue, Oct 16, 2012 at 1:34 PM, Tim Watson <tim at rabbitmq.com> wrote:

> When you run RabbitMQ on an rpm based distro using /sbin/service then the
> init script is going to redirect stdio, as you would expect for a
> service/daemon. You'll need to start RabbitMQ directly from the
> ./scripts/rabbitmq-server shell script I guess, if you want to grab stdio -
> or tail the logs?
>
> On 16 Oct 2012, at 11:47, Rapha?l De GIUSTI wrote:
>
> > Hi everyone,
> >
> > Starting the rabbitmq-server service with python's Popen from subprocess
> makes it hang.
> >
> > Here's the little snippet to reproduce it (tested on Fedora 16 +
> Python2.7 and Centos 6.3 + Python2.6)
> >
> > from subprocess import PIPE, Popen
> > proc = Popen('service rabbitmq-server start', shell=True, stderr=PIPE,
> stdout=PIPE)
> > print proc.communicate()
> >
> > Problem is with "stdout=PIPE", I think.
> >
> > The following snippet works, using proc.wait()
> >
> > from subprocess import PIPE, Popen
> > proc = Popen('service rabbitmq-server start', shell=True, stderr=PIPE,
> stdout=PIPE)
> > print proc.wait()
> >
> > Any idea on how to fix it using proc.communicate() because I need
> feedback from the "subprocess.PIPE" ?
> >
> > Thank you.
> >
> > Raphael
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/9bfe378f/attachment.htm>

From richard at psonar.com  Tue Oct 16 13:46:18 2012
From: richard at psonar.com (Richard Urwin)
Date: Tue, 16 Oct 2012 13:46:18 +0100
Subject: [rabbitmq-discuss] Problem with RabbitMQ HA cluster on EC2 (Windows)
Message-ID: <08bd01cdab9c$3d2671f0$b77355d0$@psonar.com>

Hi everyone,

 

I?m having problems clustering RabbitMQ on EC2 in Windows.

 

Apologies for the length of this post, but I thought it best to include all my steps:

a)      to help with diagnosis

b)      for anyone else who wants to set up a Windows RabbitMQ HA cluster on EC2 (if we manage to resolve the issue!)

 

Here?s what I?ve done so far:

 

1)      Started 2x EC2 Windows Server 2008 RC2 instances in a ?Rabbit? security group

 

2)      On each EC2 instance:

-          Installed Erlang R15B02 Windows 64 Bit Binary File with MSVCR100

-          installed RabbitMQ v2.8.7

-          installed the management plugin

-          reinstalled the service to enable the plugin: http://www.rabbitmq.com/plugins.html#windows-restart

 

-          opened up Windows Firewall port 4369 (for Erlang Epmd)

-          opened up Windows Firewall port 5672 (the node port)

-          opened up Windows Firewall port range 55700-55800 (for erlang node kernel communication)

-          opened up Windows Firewall port 55672 (for the management website, not strictly necessary)

 

-          copied an identical ?.erlang.cookie? file to:

o   C:\Windows

o   C:\Users\Administrator

 

-          Created ?rabbit.config?:

o   Located in C:\Users\Administrator\AppData\Roaming\RabbitMQ?

o   with contents: [{kernel, [{inet_dist_listen_min, 55700}, {inet_dist_listen_max, 55800}]}].

 

3)      In the ?Rabbit? security group:

-          opened up ports 4369, 5672, 55672, 55700-55800

 

NOTE: I initially had problems installing on one instance, creating an AMI from the installation and starting up another instance from that AMI ? ?rabbitmqctl status? always indicated the node wasn?t running, so I uninstalled RabbitMQ then reinstalled it and this worked. My guess would be it?s something related to the computer name, but I?m not sure what, since the database should have been recreated with the new instance name (if indeed it did change) when it started up. I can?t think of anything else that would cause this (any suggestions?)

 

4)      Followed the clustering instructions: http://www.rabbitmq.com/clustering.html.

 

The problem is when attempting to cluster. Running the command:

 

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin>rabbitmqctl cluster rabbit at ec2-XX-XX-XX-XX.compute-1.amazonaws.com

 

I get the result:

 

Clustering node 'rabbit at IP-0XXXXXXX' with ['rabbit at ec2- XX-XX-XX-XX.compute-1.amazonaws.com'] ...

Error: {no_running_cluster_nodes,['rabbit at ec2- XX-XX-XX-XX.compute-1.amazonaws.com'], ['rabbit at ec2- XX-XX-XX-XX.compute-1.amazonaws.com']}

 

I think this is because I?m attempting to use the EC2 Public DNS.

 

I then added mappings to my hosts file, to map to my two instances:

 

10.XXX.XX.XX     rabbit01               # Public DNS: ec2-XX-XX-XX-XX.compute-1.amazonaws.com

10.XXX.XX.XX     rabbit02               # Public DNS: ec2-XX-XX-XX-XX.compute-1.amazonaws.com

 

Running the command (with different hostname):

 

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin>rabbitmqctl cluster rabbit at rabbit02 <mailto:rabbit at ec2-XX-XX-XX-XX.compute-1.amazonaws.com> 

 

I get the same result:

 

Clustering node 'rabbit@ IP-0AAXXXXX? with [rabbit at rabbit02] ...

Error: {no_running_cluster_nodes,[rabbit at rabbit02],[rabbit at rabbit02]}

 

I know this mapping can be used to access the other Windows computer, because I can use it to access the management console in a web browser:

 

http://rabbit02:55672/#/

 

I then tried to change the computer name from IP-0AAXXXXX to rabbit01 (in case this was a problem) but upon reboot, it hadn?t changed. 

 

Does anyone have any suggestions?

 

Thanks,

Rich

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/31a17364/attachment.htm>

From raphael.degiusti at guardis.com  Tue Oct 16 14:25:27 2012
From: raphael.degiusti at guardis.com (=?ISO-8859-1?Q?Rapha=EBl_De_GIUSTI?=)
Date: Tue, 16 Oct 2012 15:25:27 +0200
Subject: [rabbitmq-discuss] "service rabbitmq-server start" hangs when
 using python's Popen from subprocess.
In-Reply-To: <CAFw-di=qF1FmawgoNb=qsk5qBCo6eOQqPwBDMw4-OrwGRLvx7g@mail.gmail.com>
References: <CAFw-dimu4Z34C14rnyogDZRsTAV44XKqhOp6jRar-i4TYQ5Jkw@mail.gmail.com>
	<311797F5-F900-4DF2-9F1C-D6047A9A1737@rabbitmq.com>
	<CAFw-di=qF1FmawgoNb=qsk5qBCo6eOQqPwBDMw4-OrwGRLvx7g@mail.gmail.com>
Message-ID: <CAFw-di=qOU81wGuWe7YstPb7GCV8UL++Q-DPjtANsPVZVAGFCg@mail.gmail.com>

It seems that the following line in /etc/init.d/rabbitmq-server script is
the cause of the Popen hang

        setsid sh -c "RABBITMQ_PID_FILE=$PID_FILE $DAEMON > \
>             ${INIT_LOG_DIR}/startup_log 2> ${INIT_LOG_DIR}/startup_err" &


If I modify the script so it does not use setsid sh -c, the subprocess call
does not hang anymore, but I expect side-effects if I do this.

        RABBITMQ_PID_FILE=$PID_FILE $DAEMON > \
>             ${INIT_LOG_DIR}/startup_log 2> ${INIT_LOG_DIR}/startup_err &


Any idea on how to fix it with my python Popen method ?

On Tue, Oct 16, 2012 at 2:15 PM, Rapha?l De GIUSTI <
raphael.degiusti at guardis.com> wrote:

> Well, I have the same problem when subprocessing
> "/etc/init.d/rabbitmq-server start".
>
> Note that I have no problem subprocessing "service rabbitmq-server status"
> or "service rabbitmq-server stop" (or any other service).
>
> My only issue is with the start method of /etc/init.d/rabbitmq-server init
> script.
>
>
>
>
> On Tue, Oct 16, 2012 at 1:34 PM, Tim Watson <tim at rabbitmq.com> wrote:
>
>> When you run RabbitMQ on an rpm based distro using /sbin/service then the
>> init script is going to redirect stdio, as you would expect for a
>> service/daemon. You'll need to start RabbitMQ directly from the
>> ./scripts/rabbitmq-server shell script I guess, if you want to grab stdio -
>> or tail the logs?
>>
>> On 16 Oct 2012, at 11:47, Rapha?l De GIUSTI wrote:
>>
>> > Hi everyone,
>> >
>> > Starting the rabbitmq-server service with python's Popen from
>> subprocess makes it hang.
>> >
>> > Here's the little snippet to reproduce it (tested on Fedora 16 +
>> Python2.7 and Centos 6.3 + Python2.6)
>> >
>> > from subprocess import PIPE, Popen
>> > proc = Popen('service rabbitmq-server start', shell=True, stderr=PIPE,
>> stdout=PIPE)
>> > print proc.communicate()
>> >
>> > Problem is with "stdout=PIPE", I think.
>> >
>> > The following snippet works, using proc.wait()
>> >
>> > from subprocess import PIPE, Popen
>> > proc = Popen('service rabbitmq-server start', shell=True, stderr=PIPE,
>> stdout=PIPE)
>> > print proc.wait()
>> >
>> > Any idea on how to fix it using proc.communicate() because I need
>> feedback from the "subprocess.PIPE" ?
>> >
>> > Thank you.
>> >
>> > Raphael
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/ae0f7c15/attachment.htm>

From tim at rabbitmq.com  Tue Oct 16 14:29:27 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 16 Oct 2012 14:29:27 +0100
Subject: [rabbitmq-discuss] "service rabbitmq-server start" hangs when
 using python's Popen from subprocess.
In-Reply-To: <CAFw-di=qOU81wGuWe7YstPb7GCV8UL++Q-DPjtANsPVZVAGFCg@mail.gmail.com>
References: <CAFw-dimu4Z34C14rnyogDZRsTAV44XKqhOp6jRar-i4TYQ5Jkw@mail.gmail.com>
	<311797F5-F900-4DF2-9F1C-D6047A9A1737@rabbitmq.com>
	<CAFw-di=qF1FmawgoNb=qsk5qBCo6eOQqPwBDMw4-OrwGRLvx7g@mail.gmail.com>
	<CAFw-di=qOU81wGuWe7YstPb7GCV8UL++Q-DPjtANsPVZVAGFCg@mail.gmail.com>
Message-ID: <507D6137.7000608@rabbitmq.com>

On 16/10/2012 14:25, Rapha?l De GIUSTI wrote:
> It seems that the following line in /etc/init.d/rabbitmq-server script
> is the cause of the Popen hang
>
>              setsid sh -c "RABBITMQ_PID_FILE=$PID_FILE $DAEMON > \
>                  ${INIT_LOG_DIR}/startup_log 2>
>     ${INIT_LOG_DIR}/startup_err" &
>
>

Yes ok that makes sense, but you didn't say anything about popen 
hanging, but rather proc.communicate() hanging, which is why I suggested 
it's the i/o redirection. If popen doesn't like setsid and friends 
(i.e., nohup) then I suspect you're a bit stuck.

> If I modify the script so it does not use setsid sh -c, the subprocess
> call does not hang anymore, but I expect side-effects if I do this.
>
>              RABBITMQ_PID_FILE=$PID_FILE $DAEMON > \
>                  ${INIT_LOG_DIR}/startup_log 2>
>     ${INIT_LOG_DIR}/startup_err &
>
>

Well a daemon is not supposed to be running in the shell that calls 
`service <name> start` so it's wrong to change the init script. As I 
said, you can invoke the rabbitmq-server start script (which the init 
script calls) by hand if you like.

> Any idea on how to fix it with my python Popen method ?
>
> On Tue, Oct 16, 2012 at 2:15 PM, Rapha?l De GIUSTI
> <raphael.degiusti at guardis.com <mailto:raphael.degiusti at guardis.com>> wrote:
>
>     Well, I have the same problem when subprocessing
>     "/etc/init.d/rabbitmq-server start".
>
>     Note that I have no problem subprocessing "service rabbitmq-server
>     status" or "service rabbitmq-server stop" (or any other service).
>
>     My only issue is with the start method of
>     /etc/init.d/rabbitmq-server init script.
>
>
>
>
>     On Tue, Oct 16, 2012 at 1:34 PM, Tim Watson <tim at rabbitmq.com
>     <mailto:tim at rabbitmq.com>> wrote:
>
>         When you run RabbitMQ on an rpm based distro using /sbin/service
>         then the init script is going to redirect stdio, as you would
>         expect for a service/daemon. You'll need to start RabbitMQ
>         directly from the ./scripts/rabbitmq-server shell script I
>         guess, if you want to grab stdio - or tail the logs?
>
>         On 16 Oct 2012, at 11:47, Rapha?l De GIUSTI wrote:
>
>          > Hi everyone,
>          >
>          > Starting the rabbitmq-server service with python's Popen from
>         subprocess makes it hang.
>          >
>          > Here's the little snippet to reproduce it (tested on Fedora
>         16 + Python2.7 and Centos 6.3 + Python2.6)
>          >
>          > from subprocess import PIPE, Popen
>          > proc = Popen('service rabbitmq-server start', shell=True,
>         stderr=PIPE, stdout=PIPE)
>          > print proc.communicate()
>          >
>          > Problem is with "stdout=PIPE", I think.
>          >
>          > The following snippet works, using proc.wait()
>          >
>          > from subprocess import PIPE, Popen
>          > proc = Popen('service rabbitmq-server start', shell=True,
>         stderr=PIPE, stdout=PIPE)
>          > print proc.wait()
>          >
>          > Any idea on how to fix it using proc.communicate() because I
>         need feedback from the "subprocess.PIPE" ?
>          >
>          > Thank you.
>          >
>          > Raphael
>          > _______________________________________________
>          > rabbitmq-discuss mailing list
>          > rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>          >
>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>         _______________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From Oren.Berenson at aimia.com  Tue Oct 16 11:59:23 2012
From: Oren.Berenson at aimia.com (Oren Berenson)
Date: Tue, 16 Oct 2012 11:59:23 +0100
Subject: [rabbitmq-discuss] bindings using complex criteria
In-Reply-To: <507D2767.5050709@rabbitmq.com>
References: <42E9885A5A6DCB4588AC4C308153AA2C5E092824@GALMSXMB01.LMUK.local>,
	<507D2767.5050709@rabbitmq.com>
Message-ID: <42E9885A5A6DCB4588AC4C308153AA2C5E092825@GALMSXMB01.LMUK.local>

It is not what I was hopping to hear, but thanks for the very quick response :-)
________________________________________
From: Simon MacMullen [simon at rabbitmq.com]
Sent: Tuesday, October 16, 2012 10:22 AM
To: Discussions about RabbitMQ
Cc: Oren Berenson
Subject: Re: [rabbitmq-discuss] bindings using complex criteria

On 16/10/12 09:42, Oren Berenson wrote:
> We need to do binding using greater than, less than etc using a
> combination of several key/values. For example a consumer must only
> receive messages where value > 10 and  y < dateTime >  x.
>
> Assuming we have a component that can generate all the required
> headers before the message is sent to an exchange, is it possible to
> do such thing with Headers exchange? Would it perform well? We are
> looking at a throughput of 1000 messages per second at least. What
> would be the best approach for such requirement?

I'm afraid the headers exchange will only do exact matching. It should
perform OK, though.

I'm not sure there is any built in functionality for what you want to
do, short of "write your own exchange type" which may not be what you
want to hear...

Cheers, Simon

--
Simon MacMullen
RabbitMQ, VMware



From erlang at rambocoder.com  Tue Oct 16 14:12:47 2012
From: erlang at rambocoder.com (rambocoder)
Date: Tue, 16 Oct 2012 06:12:47 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbbitMQ and Biztalk Port
In-Reply-To: <9524c212-3d70-40c5-83e2-ebe92b3fa5be@googlegroups.com>
References: <9524c212-3d70-40c5-83e2-ebe92b3fa5be@googlegroups.com>
Message-ID: <a1e529c6-bc12-4f83-9c09-91b2b9b0ed3c@googlegroups.com>

You soap action headers are empty. BizTalk needs to know what WCF action to 
perform based on the "operation" context information of the message.

Best bet is to get a simple C# console app working publishing messages to 
the rabbitmq wcf endpoint and then take the wcf configuration xml from that 
and try to fill in the blanks on the WCF-custom of Biztalk.

-rambocoder

On Thursday, October 11, 2012 5:18:24 PM UTC-4, saibabu maddineni wrote:
>
> Hi,
>  
>
> *
> http://social.technet.microsoft.com/wiki/contents/articles/7401.biztalk-and-rabbitmq.aspx
> *<http://social.technet.microsoft.com/wiki/contents/articles/7401.biztalk-and-rabbitmq.aspx>
>
>  
> I followed above link to configure rabbmitmq in Biztalk, but nothing 
> happend. 
>
> I am trying implement RabbitMQ using Biztalk. My requirement is send 
> message to Que and receiving message from Que. I already setup rabbitmq in 
> Biztalk with the help of article. When I drop the message in biztalk side 
> its not failing but in Que I don?t see any messages.
>
>  
> Can you please specify the what needs to be done for this. Below are the 
> settings I am using, Mytest que is predefine Q. do I need to specify any 
> thing on that action section and section is binding section please suggest.
>  
> please see the Biztalk configure attachment, please suggest how to use 
> RabbitMQ in Biztalk while receving and sending message from and to.
>  
>  
>  
>
> Appreciate for early response.
>
>  
>
> I am stuck on the middle please help me on this issue.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/5ad897ea/attachment.htm>

From watson.timothy at gmail.com  Tue Oct 16 15:28:33 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 16 Oct 2012 15:28:33 +0100
Subject: [rabbitmq-discuss] Problem with RabbitMQ HA cluster on EC2
	(Windows)
In-Reply-To: <08bd01cdab9c$3d2671f0$b77355d0$@psonar.com>
References: <08bd01cdab9c$3d2671f0$b77355d0$@psonar.com>
Message-ID: <E76308DC-F385-48F1-A649-8F4778297C76@rabbitmq.com>

Hi

On 16 Oct 2012, at 13:46, "Richard Urwin" <richard at psonar.com> wrote:

> Hi everyone,
>  

Snip

> 
> The problem is when attempting to cluster. Running the command:
>  
> C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin>rabbitmqctl cluster rabbit at ec2-XX-XX-XX-XX.compute-1.amazonaws.com
>  
> I get the result:
>  
> Clustering node 'rabbit at IP-0XXXXXXX' with ['rabbit at ec2- XX-XX-XX-XX.compute-1.amazonaws.com'] ...
> Error: {no_running_cluster_nodes,['rabbit at ec2- XX-XX-XX-XX.compute-1.amazonaws.com'], ['rabbit at ec2- XX-XX-XX-XX.compute-1.amazonaws.com']}
>  
> I think this is because I?m attempting to use the EC2 Public DNS.
>  
> I then added mappings to my hosts file, to map to my two instances:
>  
> 10.XXX.XX.XX     rabbit01               # Public DNS: ec2-XX-XX-XX-XX.compute-1.amazonaws.com
> 10.XXX.XX.XX     rabbit02               # Public DNS: ec2-XX-XX-XX-XX.compute-1.amazonaws.com
>  
> Running the command (with different hostname):
>  
> C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin>rabbitmqctl cluster rabbit at rabbit02
>  
> I get the same result:
>  
> Clustering node 'rabbit@ IP-0AAXXXXX? with [rabbit at rabbit02] ...
> Error: {no_running_cluster_nodes,[rabbit at rabbit02],[rabbit at rabbit02]}
>  

Ok but what do those rabbits think the node names are?

> I know this mapping can be used to access the other Windows computer, because I can use it to access the management console in a web browser:
>  
> http://rabbit02:55672/#/
>  

That doesn't mean that erlang knows the nodes as rabbit at rabbit2 though.

> I then tried to change the computer name from IP-0AAXXXXX to rabbit01 (in case this was a problem) but upon reboot, it hadn?t changed.
>  

When you start rabbit on the host, run rabbitmqctl status on the host itself and see what the node name looks like. This needs to match up so that all the nodes have a consistent view of the names. I would expect some /etc/hosts configuration to solve any naming difficulties. Remember that rabbit uses short names (without the domain) by default.

> Does anyone have any suggestions?
>  
> Thanks,
> Rich
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/babc491c/attachment.htm>

From aaron.pfeifer at gmail.com  Tue Oct 16 15:46:11 2012
From: aaron.pfeifer at gmail.com (Aaron Pfeifer)
Date: Tue, 16 Oct 2012 10:46:11 -0400
Subject: [rabbitmq-discuss] Response times for publisher confirms
In-Reply-To: <507D4729.6070209@rabbitmq.com>
References: <CACxyq579SGwzuFpX_xQikkYOP5yX139UQuoi_r1r-qYCO9WwgA@mail.gmail.com>
	<B306DD00-5B75-438B-9804-B9DEE96A8466@rabbitmq.com>
	<507D4729.6070209@rabbitmq.com>
Message-ID: <CACxyq569DhWAA5y0GEcpmyyQ8-m3+4dLqrot3+8EdWs9ZXodZg@mail.gmail.com>

Thanks for the notes!  A couple of clarifications:

* There aren't really any other applications running on the box -- it's
entirely meant for RabbitMQ processing only.  I've run atop during the
spikes and no other applications are writing to or reading from the disk.
 I've added atop output to the gist if there's additional info there worth
noting.  You'll notice that both RDDSK and WRDSK drop during this spike for
the RabbitMQ process. https://gist.github.com/3874134

* Currently we're waiting for the confirm after every publish.  It's not
ideal, but it's what we're limited to right now.  We internally "batch"
publishes (i.e. we group multiple related messages into a single RabbitMQ
message) just due to the reduction in network usage from compression -- is
there an additional batching mechanism supported by the RabbitMQ protocol?
(happy to dive into our batches further, but I'm not sure it's related here)

* I'd say there's a pretty constant throughput in the management UI most of
the time.

-Aaron

On Tue, Oct 16, 2012 at 7:38 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 16/10/12 12:28, Tim Watson wrote:
>
>> Yes they're generally much faster than transactions. Bare in mind
>> though, that if you're asking for confirms and the messages are
>> persistent, then you're asking rabbit to fsync to disk repeatedly
>> which is very expensive. Whether or not this is related to what
>> you're seeing every 10 minutes is a little unclear to me, though some
>> of the more knowledgeable rabbits may spot something I've missed
>> here.
>>
>
> Nothing in rabbit is scheduled at a ten minute interval.
>
> I can just about imagine that with a very regular load some ten minute
> pattern might emerge, but the more likely cause is some other application
> causing io contention.
>
> Regards,
>
> Matthias.
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/47716ebc/attachment.htm>

From saibabu.maddineni at gmail.com  Tue Oct 16 15:48:40 2012
From: saibabu.maddineni at gmail.com (saibabu maddineni)
Date: Tue, 16 Oct 2012 10:48:40 -0400
Subject: [rabbitmq-discuss] RabbbitMQ and Biztalk Port
In-Reply-To: <a1e529c6-bc12-4f83-9c09-91b2b9b0ed3c@googlegroups.com>
References: <9524c212-3d70-40c5-83e2-ebe92b3fa5be@googlegroups.com>
	<a1e529c6-bc12-4f83-9c09-91b2b9b0ed3c@googlegroups.com>
Message-ID: <CACF3+9Mf4NrX-_gVf1XEt3Uk18gEK=pO4U1PN--XP7VToxAP7g@mail.gmail.com>

can you please tell me how to specify the soap action header. In general
scenario we can specify the Operation Names and Action. But in this
scenario what type of OperationName and Action can be specify ?

if you can give clear informaton that would be great help.

Thanks,
-Sai

On Tue, Oct 16, 2012 at 9:12 AM, rambocoder <erlang at rambocoder.com> wrote:

> You soap action headers are empty. BizTalk needs to know what WCF action
> to perform based on the "operation" context information of the message.
>
> Best bet is to get a simple C# console app working publishing messages to
> the rabbitmq wcf endpoint and then take the wcf configuration xml from that
> and try to fill in the blanks on the WCF-custom of Biztalk.
>
> -rambocoder
>
>
> On Thursday, October 11, 2012 5:18:24 PM UTC-4, saibabu maddineni wrote:
>>
>> Hi,
>>
>>
>> *http://social.technet.microsoft.com/wiki/contents/
>> articles/7401.biztalk-and-rabbitmq.aspx*<http://social.technet.microsoft.com/wiki/contents/articles/7401.biztalk-and-rabbitmq.aspx>
>>
>>
>> I followed above link to configure rabbmitmq in Biztalk, but nothing
>> happend.
>>
>> I am trying implement RabbitMQ using Biztalk. My requirement is send
>> message to Que and receiving message from Que. I already setup rabbitmq in
>> Biztalk with the help of article. When I drop the message in biztalk side
>> its not failing but in Que I don?t see any messages.
>>
>>
>> Can you please specify the what needs to be done for this. Below are the
>> settings I am using, Mytest que is predefine Q. do I need to specify any
>> thing on that action section and section is binding section please suggest.
>>
>> please see the Biztalk configure attachment, please suggest how to use
>> RabbitMQ in Biztalk while receving and sending message from and to.
>>
>>
>>
>>
>> Appreciate for early response.
>>
>>
>>
>> I am stuck on the middle please help me on this issue.
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/c45a4b53/attachment.htm>

From matthias at rabbitmq.com  Tue Oct 16 15:53:07 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 16 Oct 2012 15:53:07 +0100
Subject: [rabbitmq-discuss] Response times for publisher confirms
In-Reply-To: <CACxyq569DhWAA5y0GEcpmyyQ8-m3+4dLqrot3+8EdWs9ZXodZg@mail.gmail.com>
References: <CACxyq579SGwzuFpX_xQikkYOP5yX139UQuoi_r1r-qYCO9WwgA@mail.gmail.com>
	<B306DD00-5B75-438B-9804-B9DEE96A8466@rabbitmq.com>
	<507D4729.6070209@rabbitmq.com>
	<CACxyq569DhWAA5y0GEcpmyyQ8-m3+4dLqrot3+8EdWs9ZXodZg@mail.gmail.com>
Message-ID: <507D74D3.8010304@rabbitmq.com>

Aaron,

On 16/10/12 15:46, Aaron Pfeifer wrote:
> * There aren't really any other applications running on the box -- it's
> entirely meant for RabbitMQ processing only.

Might just be an EC2 issue then, such as a noisy neighbour or weirdness 
in the "RAID0 ephemeral drive" implementation.

> * Currently we're waiting for the confirm after every publish.  It's not
> ideal, but it's what we're limited to right now.  We internally "batch"
> publishes (i.e. we group multiple related messages into a single
> RabbitMQ message) just due to the reduction in network usage from
> compression -- is there an additional batching mechanism supported by
> the RabbitMQ protocol?

Nah; what you are doing sounds fine.

Matthias.

From Michael.Laing at nytimes.com  Tue Oct 16 16:17:37 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Tue, 16 Oct 2012 11:17:37 -0400
Subject: [rabbitmq-discuss] Field Type 'A'
In-Reply-To: <507D4A7D.1020308@rabbitmq.com>
Message-ID: <CCA2ECF5.52D8%Michael.Laing@nytimes.com>

Thanks! A small item, but it ricocheted into the development we had been
doing in nodejs, forcing fixes.

We're now migrating our core code to python, partially due to problems
with node-amqp, and have started contributing to pika, e.g. we added
Consumer Cancel Notifications.

Michael

On 10/16/12 7:52 AM, "Matthias Radestock" <matthias at rabbitmq.com> wrote:

>Michael,
>
>On 15/10/12 16:24, Laing, Michael P. wrote:
>> Then the table is misleading in my opinion, causing developers for
>> 'unsupported' clients to mistakenly implement the column in the table
>>and
>> think they are done. Not the desired outcome, and an understandable
>> oversight by the nodejs-amqp author, I think.
>>
>> Plus the comment is ambiguous as it says that field-array type is
>> implemented but not which tag is used. It should also be placed in C
>>above
>> to make it clear that it goes with the table.
>>
>> Or perhaps a RabbitMQ column separate from Qpid would make sense.
>
>Well, that entire section, as stated, is a copy of an email to the AMQP
>dev list. So we really shouldn't change it. But guess what, I just have :)
>
>Matthias.


From richard at psonar.com  Tue Oct 16 16:34:56 2012
From: richard at psonar.com (Richard Urwin)
Date: Tue, 16 Oct 2012 16:34:56 +0100
Subject: [rabbitmq-discuss] Problem with RabbitMQ HA cluster on
	EC2	(Windows)
In-Reply-To: <E76308DC-F385-48F1-A649-8F4778297C76@rabbitmq.com>
References: <08bd01cdab9c$3d2671f0$b77355d0$@psonar.com>
	<E76308DC-F385-48F1-A649-8F4778297C76@rabbitmq.com>
Message-ID: <09ea01cdabb3$cc78b1d0$656a1570$@psonar.com>

Hi Tim,

 

Thanks for the rapid response!

 

OK, so I added the following into each hosts file:

 

IP-0AF23E1E       10.XX.XX.XX

IP-0AD25792      10.XX.XX.XX

 

The names now match everywhere and are correctly mapped to the private IPs.

 

Now when I run:

 

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin>rabbitmqctl cluster rabbit at IP-0AF23E1E

 

I have success:

 

Clustering node 'rabbit at IP-0AD25792' with ['rabbit at IP-0AF23E1E'] ...

...done.

 

?and checking the cluster status with:

 

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin>rabbitmqctl cluster_status

 

?gives:

 

Cluster status of node 'rabbit at IP-0AD25792' ...

[{nodes,[{disc,['rabbit at IP-0AF23E1E']},{ram,['rabbit at IP-0AD25792']}]},

{running_nodes,['rabbit at IP-0AF23E1E','rabbit at IP-0AD25792']}]

...done.

 

BUT:

 

I had to open all of the ports within the EC2 security group and Windows firewall.

 

As mentioned, I have this (and only this) in my rabbit.config:

 

[{kernel, [{inet_dist_listen_min, 55700}, {inet_dist_listen_max, 55800}]}].

 

But it doesn?t appear to be restricting the ports (since when I restrict the firewalls back to that range, it can?t cluster.)

 

Can you see what?s wrong?

 

Thanks,

Rich

 

 

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: 16 October 2012 15:29
To: Discussions about RabbitMQ
Cc: <rabbitmq-discuss at lists.rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Problem with RabbitMQ HA cluster on EC2 (Windows)

 

Hi


On 16 Oct 2012, at 13:46, "Richard Urwin" <richard at psonar.com> wrote:

Hi everyone,

 

 

Snip

 

 

The problem is when attempting to cluster. Running the command:

 

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin>rabbitmqctl cluster rabbit at ec2-XX-XX-XX-XX.compute-1.amazonaws.com

 

I get the result:

 

Clustering node 'rabbit at IP-0XXXXXXX' with ['rabbit at ec2- XX-XX-XX-XX.compute-1.amazonaws.com'] ...

Error: {no_running_cluster_nodes,['rabbit at ec2- XX-XX-XX-XX.compute-1.amazonaws.com'], ['rabbit at ec2- XX-XX-XX-XX.compute-1.amazonaws.com']}

 

I think this is because I?m attempting to use the EC2 Public DNS.

 

I then added mappings to my hosts file, to map to my two instances:

 

10.XXX.XX.XX     rabbit01               # Public DNS: ec2-XX-XX-XX-XX.compute-1.amazonaws.com

10.XXX.XX.XX     rabbit02               # Public DNS: ec2-XX-XX-XX-XX.compute-1.amazonaws.com

 

Running the command (with different hostname):

 

C:\Program Files (x86)\RabbitMQ Server\rabbitmq_server-2.8.7\sbin>rabbitmqctl cluster rabbit at rabbit02 <mailto:rabbit at ec2-XX-XX-XX-XX.compute-1.amazonaws.com> 

 

I get the same result:

 

Clustering node 'rabbit@ IP-0AAXXXXX? with [rabbit at rabbit02] ...

Error: {no_running_cluster_nodes,[rabbit at rabbit02],[rabbit at rabbit02]}

 

 

Ok but what do those rabbits think the node names are?





I know this mapping can be used to access the other Windows computer, because I can use it to access the management console in a web browser:

 

http://rabbit02:55672/#/

 

 

That doesn't mean that erlang knows the nodes as rabbit at rabbit2 though.





I then tried to change the computer name from IP-0AAXXXXX to rabbit01 (in case this was a problem) but upon reboot, it hadn?t changed. 

 

 

When you start rabbit on the host, run rabbitmqctl status on the host itself and see what the node name looks like. This needs to match up so that all the nodes have a consistent view of the names. I would expect some /etc/hosts configuration to solve any naming difficulties. Remember that rabbit uses short names (without the domain) by default.





Does anyone have any suggestions?

 

Thanks,

Rich

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/48af0e43/attachment.htm>

From charles at dyfis.net  Tue Oct 16 17:39:04 2012
From: charles at dyfis.net (Charles Duffy)
Date: Tue, 16 Oct 2012 11:39:04 -0500
Subject: [rabbitmq-discuss] Safely replaying archived messages from an
	external store
Message-ID: <k5k2jp$3bk$1@ger.gmane.org>

Howdy --

I have a process where, on startup, I want to ensure that an internal 
state machine (using data fed off an AMQP fanout exchange) is 
synchronized with the state it would be in had it been continuously 
listening to the feed for the last several hours. (State is guaranteed 
to be dependent only on messages received within a defined window).

This means archiving messages in an external store (such as a database) 
in such a way that they can be replayed, in-order, with no losses. As 
the timestamp in the AMQP header is no more than second-resolution, and 
I don't trust client-generated timestamps to be synchronized (yes, we 
use NTP, but this is fed by datacenters that span continents, and I'm 
wary of jitter resulting in race conditions where multiple instances are 
out-of-sync), the algorithm that comes to mind is as follows:

Archiver process:
- Read first message. Note header timestamp. Discard.
- Read and discard further messages until header timestamp changes 
(second boundary crossed).
- Record each message keyed by a (second_timestamp, idx) tuple, 
resetting idx to 0 at each second boundary.

State machine process:
- Read first message. Note header timestamp. Discard.
- Read and discard further messages until header timestamp changes 
(second boundary crossed). First message on a new second boundary will 
henceforth be referred to as "first message".
- Query archive database for messages between beginning of window and 
time of first message, inclusive of the latter; replay into engine.
- Until the first message, or a message newer than same [as measured by 
the (header_time, idx) tuple], has been retrieved from the database:
-- Query archive database for oldest message newer than most recent seen 
in database, LIMIT 1; replay into engine.
- Close database connection; replay all received messages directly into 
engine.

Does this have obvious holes? Is a better approach (again, not trusting 
the clocks of the clients which add content to the exchange to be 
accurate) available?

Thanks!


From jason at jasonantman.com  Tue Oct 16 18:00:30 2012
From: jason at jasonantman.com (Jason Antman)
Date: Tue, 16 Oct 2012 13:00:30 -0400
Subject: [rabbitmq-discuss] Fwd: Monitoring A Queue
In-Reply-To: <602d0b86-217f-4bc2-9896-72a1334a8e12@googlegroups.com>
References: <602d0b86-217f-4bc2-9896-72a1334a8e12@googlegroups.com>
Message-ID: <507D92AE.2050907@jasonantman.com>

I've been tasked with monitoring a queue used by two applications, which 
are considered black boxes from my point of view (App A puts messages 
into a queue, App B consumes them; I have no control over the code for 
either app). I need to measure the rate of messages (messages/second) 
moving successfully from App A to App B through the queue. We're 
concerned with both pileups in the queue (producer working normally, 
consumer halted) and lack of new messages (producer halted). The end 
result will be a Nagios check plugin, which alerts when messages/second 
throughput falls below a given level, and also produces performance data 
for graphing.

I've been examining the JSON results from the management API 
(/api/queues/vhost_name/queue_name), and have come to the following 
conclusions:

1) There are no monotonically increasing counters of the number of 
messages in to the queue and number of messages out of the queue. 
Therefore, there's no way for me to figure the rate on an arbitrary time 
scale.

2) The "messages" element in the JSON array is the number of messages 
currently sitting in the queue, not a counter of the number that have 
passed through it.

3) The API does provide backing_queue_status.avg_ingress_rate and 
backing_queue_status.avg_egress_rate. Going by Matthew's post to 
"Monitoring Message Throughput" 
(http://rabbitmq.1065348.n5.nabble.com/Monitoring-Message-Throughput-td17436.html#a17438 
<http://rabbitmq.1065348.n5.nabble.com/Monitoring-Message-Throughput-td17436.html#a17438>) 
from February, 2010, I gather that these values are averaged over 
approx. 10 seconds. I'm also assuming that ingress is *every* message 
into the queue, and egress is... *every* message grabbed from the queue, 
regardless of ACK? So even if consumers are not acking any messages, 
this rate will still show them? And I assume that means these values 
wouldn't be useful for a low-utilization, bursty queue (i.e., say, a 
30-message burst every few minutes)?

Are these correct?

It would be really helpful if someone could explain exactly what 
avg_in/egress_rate and avg_ack_in/egress_rate mean in the JSON output - 
I've done a bunch of testing with a Pika client connected to RabbitMQ 
2.8.7 on my workstation, but I can't seem to draw a clear connection 
between what my client is doing and what avg_ingress_rate and 
avg_egress_rate show in the JSON, or what the avg_ack_[in|e]gress_rate  
show, when I watch everything simultaneously.

I also found some reference to a Ticket 23 (though I don't see any links 
to the RMQ ticketing system) that dealt with monitoring, but no 
reference to any updates to it:
http://grokbase.com/t/rabbitmq/rabbitmq-discuss/10ag2hejbb/ticket-23-new-comment-monitoring-message-throughput 
<http://grokbase.com/t/rabbitmq/rabbitmq-discuss/10ag2hejbb/ticket-23-new-comment-monitoring-message-throughput>

Any guidance/advice/pointers would be greatly appreciated. I've been 
working on this monitoring for two days now, and I can't find anything 
that I'm confident is a correct solution...

Thanks,
Jason Antman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121016/4e5f2859/attachment.htm>

From wongkamhoong at gmail.com  Wed Oct 17 03:04:51 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Wed, 17 Oct 2012 10:04:51 +0800
Subject: [rabbitmq-discuss] RabbitMQ node stopped while broker still up
In-Reply-To: <507D37E2.5020809@rabbitmq.com>
References: <CAHv8OSRbwbg8GcNqa10qt-DL50Y6Cyx46J4dKF4NpUP8eJct8w@mail.gmail.com>
	<507D2491.9020207@rabbitmq.com>
	<CAHv8OSQmLrr=fRj6dK954GzAK9vWXNroxEJtL_Boz6ceBpBgNg@mail.gmail.com>
	<507D37E2.5020809@rabbitmq.com>
Message-ID: <CAHv8OSTdu==-yKXU8FxVB5QNisXBFCOETR_93YUSEv1B9fezQw@mail.gmail.com>

Hi Simon,

I checked the log and noticed every time when start this particular
RabbitMQ, the log showed some error messages as follow:

=ERROR REPORT==== 4-Oct-2012::05:46:57 ===
Mnesia(nplay at app2): ** ERROR ** mnesia_event got {inconsistent_database,
starting_partitioned_network, nplay at web1}

=ERROR REPORT==== 4-Oct-2012::05:46:57 ===
Mnesia(nplay at app2): ** ERROR ** mnesia_event got {inconsistent_database,
starting_partitioned_network, nplay at web2}

Why the errors logged? Is it related to my cluster setting?

This is production environment, I can guaranteed no one dare to execute the
command "rabbitmqctl stop".

Regards,
Wong

On Tue, Oct 16, 2012 at 6:33 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hmm. The SASL log will not necessarily have to contain anything, it is
> really more of an error log. So I guess there was no error.
>
> Aha! The log contains:
>
>   =INFO REPORT==== 16-Oct-2012::00:48:36 ===
>   Halting Erlang VM
>
> We only log that after invocation of "rabbitmqctl stop". So the reason
> that node shut down was, umm, someone told it to.
>
> And regarding network partitions, we get information about that from
> Mnesia. Mnesia will log something like:
>
>   =ERROR REPORT==== 16-Oct-2012::00:04:19 ===
>   Mnesia(nplay at app2): ** ERROR ** mnesia_event got
>     {inconsistent_database, running_partitioned_network, nplay at web2}
>
> when it has detected a network partition. Note the
> "running_partitioned_network" - it will also log a very similar message
> with "starting_partitioned_network" the first time it starts *after* a
> partition.
>
> Future versions of RabbitMQ will make this information more accessible.
>
> Cheers, Simon
>
>
> On 16/10/12 10:32, Wong Kam Hoong wrote:
>
>> Hi Simon,
>>
>> I check in the sasl log, but it not being update for long time, the
>> issue happened at 16-oct-2012 but the latest info showed in the log is
>> only up to 2-oct-2012.
>>
>> Attached is the requested sasl log for the server.
>>
>> Yea, I remember you mentioned before RabbitMQ not recommend to run in
>> partitioned network, we still waiting network team to tell us whether
>> those RabbitMQs is it really deployed in a partitioned network..
>>
>> Just curios, how RabbitMQ identify whether the nodes deployed
>> in partitioned network? I asked this question so that I can discuss
>> better with network team.
>>
>> Regards,
>> Wong
>>
>>
>> On Tue, Oct 16, 2012 at 5:10 PM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     Hi. There's nothing in that log to indicate why the node shut down -
>>     can you post the sasl log somewhere?
>>
>>     I don't know if it's related to the network partition. But please
>>     bear in mind that network partitions are really bad for RabbitMQ
>>     clusters.
>>
>>     Cheers, Simon
>>
>>
>>     On 16/10/12 03:20, Wong Kam Hoong wrote:
>>
>>         Hi RabbitMQ Team,
>>
>>         This morning while I checked the RabbitMQs status through web
>>         admin, I
>>         found that one of the RabbitMQ node stopped.
>>
>>         RabbitMQ v2.8.7
>>         Erlang v*R14B04*
>>         *Cluster: Yes, 3 RabbitMQs*
>>
>>
>>         Attached is the log for your reference.
>>
>>         After I restarted the service, then everything back to normal.
>>
>>         I wonder is the problem related to partitioned network:
>>
>>         http://rabbitmq.1065348.n5.__n**abble.com/Statistics-__**
>> database-could-not-be-__**contacted-Message-rates-and-__**
>> queue-lengths-will-not-be-__**shown-td22331.html<http://nabble.com/Statistics-__database-could-not-be-__contacted-Message-rates-and-__queue-lengths-will-not-be-__shown-td22331.html>
>>
>>         <http://rabbitmq.1065348.n5.**nabble.com/Statistics-**
>> database-could-not-be-**contacted-Message-rates-and-**
>> queue-lengths-will-not-be-**shown-td22331.html<http://rabbitmq.1065348.n5.nabble.com/Statistics-database-could-not-be-contacted-Message-rates-and-queue-lengths-will-not-be-shown-td22331.html>
>> >
>>
>>         Thanks & Regards,
>>         Wong
>>
>>
>>         ______________________________**___________________
>>         rabbitmq-discuss mailing list
>>         rabbitmq-discuss at lists.__rabbi**tmq.com <http://rabbitmq.com>
>>         <mailto:rabbitmq-discuss@**lists.rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> >
>>         https://lists.rabbitmq.com/__**cgi-bin/mailman/listinfo/__**
>> rabbitmq-discuss<https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss>
>>
>>         <https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**
>> rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>> >
>>
>>
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, VMware
>>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/06d3e598/attachment.htm>

From chenglin.li at quanshi.com  Wed Oct 17 03:11:51 2012
From: chenglin.li at quanshi.com (Li, Chenglin)
Date: Wed, 17 Oct 2012 10:11:51 +0800
Subject: [rabbitmq-discuss] =?gb2312?b?ob5TT1Ohv2lzc3VlcyBhYm91dCAgZXhl?=
	=?gb2312?b?Y3V0aW9uIGphdmFzY3JpcHQgaW4gSVBob25l?=
Message-ID: <000901cdac0c$c6263470$52729d50$@li@quanshi.com>

Hi All

 

we want to use RabbitMQ javascript library to IPhone, and we use UIWebView
to execute javascript: stringByEvaluatingJavaScriptFromString, but there are
some restrictions for execution JS on IOS as below:

 

/***************************************************************************
*/

JavaScript execution time is limited to 10 seconds for each top-level entry
point. If your script executes for more than 10 seconds, the web view stops
executing the script. This is likely to occur at a random place in your
code, so unintended consequences may result. This limit is imposed because
JavaScript execution may cause the main thread to block, so when scripts are
running, the user is not able to interact with the webpage.

/***************************************************************************
/

 

 

I want to confirm with you :

1. Does the rabbitmq javascript library have above issues? rabbitmq
javascript execution time will be over 10 seconds? 

2. if above issue exist, how to resolve it?

 

 

Thanks,

Jack

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/594df306/attachment.htm>

From a.shneyderman at gmail.com  Wed Oct 17 10:02:51 2012
From: a.shneyderman at gmail.com (Alex Shneyderman)
Date: Wed, 17 Oct 2012 11:02:51 +0200
Subject: [rabbitmq-discuss] the cost of creating a queue?
Message-ID: <CA+smePJyc9eE1PKzMgDsT_ow9EVahYSk=196eP_fu+2FZP=yGg@mail.gmail.com>

Hi, all!

I am curious if there are any numbers available on what amount of
resources does it take to create a queue? It is a clustered env. Most
of the queues are mirrored (durable and non).

The design of the system I have in mind is that I create one (maybe
two) queue per instance (each instance has 5 consumers and one
publisher and they all live on two connections to rabbit one for
publisher and one for consumers) that is part of the system. There are
up-to 100 instances ATM and that number might grow in the future. So,
there are about 100-200 queues that get created and need to be kept up
by Rabbit. I am curious if there is any estimate on how much RAM per
queue is required? Disk space? Any gotchas in the design you see right
from its description :-) ?

Rabbit 2.8.6 running on EC2.

Cheers,
Alex.

From ryan.rajkomar at gmail.com  Wed Oct 17 09:58:19 2012
From: ryan.rajkomar at gmail.com (Shadowalker)
Date: Wed, 17 Oct 2012 01:58:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Use a mysql databse table as the provider for
	rabbitmq queue
Message-ID: <c035a8fb-87fa-4a98-9f5c-137d85fcb6ec@googlegroups.com>

Hi,

I've just stumbled upon rabbitmq and I think it could very well help in a 
project that I'm currently working on. But there's one thing that I'd like 
to get some input about though :

My project consist of one, two or more applications that, though separated, 
need to keep some of their datas synchronized.

For example say I have two use cases that could happen at the same time :

First project has a app A and a app B : when app A insert some specific 
data in its db i need to get a meesage to appB to do the corresponding 
action on its own db
Second project has only app A and when I insert stuff in A's db it 
shouldn't send anything anywhere.

In both cases, I'll like to have app A and app B identical : I don't want 
to have to change app A's code jsut because app B is here.

So my question is : Is there anyway to plug the raabitmq consumer directly 
onto a specific table in app A's database so that every time  something 
happens appB can come and consume the data.

Cheers,
Shadowalker.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/13e7934a/attachment.htm>

From emile at rabbitmq.com  Wed Oct 17 10:35:11 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 17 Oct 2012 10:35:11 +0100
Subject: [rabbitmq-discuss] Use a mysql databse table as the provider
 for rabbitmq queue
In-Reply-To: <c035a8fb-87fa-4a98-9f5c-137d85fcb6ec@googlegroups.com>
References: <c035a8fb-87fa-4a98-9f5c-137d85fcb6ec@googlegroups.com>
Message-ID: <507E7BCF.8060504@rabbitmq.com>

Hi,

On 17/10/12 09:58, Shadowalker wrote:
> plug the raabitmq consumer directly onto a specific table

I'm sure there are many different ways of doing this. A possible
solution is to create a database trigger for A's table that sends an
update message when a change occurs. Application B (or any other
interested party) can then consume these messages and know that they
might need to synchronise from the table.

-Emile

From simon at rabbitmq.com  Wed Oct 17 10:40:22 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Oct 2012 10:40:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ node stopped while broker still up
In-Reply-To: <CAHv8OSTdu==-yKXU8FxVB5QNisXBFCOETR_93YUSEv1B9fezQw@mail.gmail.com>
References: <CAHv8OSRbwbg8GcNqa10qt-DL50Y6Cyx46J4dKF4NpUP8eJct8w@mail.gmail.com>
	<507D2491.9020207@rabbitmq.com>
	<CAHv8OSQmLrr=fRj6dK954GzAK9vWXNroxEJtL_Boz6ceBpBgNg@mail.gmail.com>
	<507D37E2.5020809@rabbitmq.com>
	<CAHv8OSTdu==-yKXU8FxVB5QNisXBFCOETR_93YUSEv1B9fezQw@mail.gmail.com>
Message-ID: <507E7D06.505@rabbitmq.com>

On 17/10/12 03:04, Wong Kam Hoong wrote:
> Hi Simon,
>
> I checked the log and noticed every time when start this particular
> RabbitMQ, the log showed some error messages as follow:
>
> =ERROR REPORT==== 4-Oct-2012::05:46:57 ===
> Mnesia(nplay at app2): ** ERROR ** mnesia_event got {inconsistent_database,
> starting_partitioned_network, nplay at web1}
>
> =ERROR REPORT==== 4-Oct-2012::05:46:57 ===
> Mnesia(nplay at app2): ** ERROR ** mnesia_event got {inconsistent_database,
> starting_partitioned_network, nplay at web2}
>
> Why the errors logged? Is it related to my cluster setting?

That log message ("starting_partitioned_network") means that Mnesia 
detected it was partitioned last time it was up, and is recovering from 
it now (where the recovery is fairly brutal - the node logging that 
message has thrown away any local changes, and has resynchronised with 
whichever nodes it found running).

> This is production environment, I can guaranteed no one dare to execute
> the command "rabbitmqctl stop".

Well, I can promise that we only log that message "Halting Erlang VM" in 
response to "rabbitmqctl stop". If you don't believe me you can check - 
it's emitted in rabbit:stop_and_halt():

http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_8_x/src/rabbit.erl#l310

which is only invoked here:

http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_8_x/src/rabbit_control.erl#l161

- the handler for "rabbitmqctl stop".

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Dhinesh.P at saint-gobain.com  Wed Oct 17 10:47:10 2012
From: Dhinesh.P at saint-gobain.com (Dhinesh, P [ Maples - IT ])
Date: Wed, 17 Oct 2012 15:17:10 +0530
Subject: [rabbitmq-discuss] Re : rabbitmqadmin configuration
Message-ID: <00946F8B780BAB43A04111EEAA7B47F603DE5932@L00EXCEC1.zl.if.atcsg.net>

Hello,

 

We are using RabbitMQ 2.8.4 with python 2.7.3...

 

We need to configure the rabbitmqadmin ..

 

If Anyone have idea reg the conf, kindly guide us to go next level..

 

Thanks and Regards,

 

Dhinesh P 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/04a9ec54/attachment.htm>

From simon at rabbitmq.com  Wed Oct 17 10:50:29 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Oct 2012 10:50:29 +0100
Subject: [rabbitmq-discuss] Re : rabbitmqadmin configuration
In-Reply-To: <00946F8B780BAB43A04111EEAA7B47F603DE5932@L00EXCEC1.zl.if.atcsg.net>
References: <00946F8B780BAB43A04111EEAA7B47F603DE5932@L00EXCEC1.zl.if.atcsg.net>
Message-ID: <507E7F65.1000709@rabbitmq.com>

On 17/10/12 10:47, Dhinesh, P [ Maples - IT ] wrote:
> If Anyone have idea reg the conf, kindly guide us to go next level..

"rabbitmqadmin help config" will give you some brief guidance on its 
configuration file.

It is really unclear what you are asking.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Wed Oct 17 10:50:35 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 17 Oct 2012 10:50:35 +0100
Subject: [rabbitmq-discuss] Use a mysql databse table as the provider
 for rabbitmq queue
In-Reply-To: <c035a8fb-87fa-4a98-9f5c-137d85fcb6ec@googlegroups.com>
References: <c035a8fb-87fa-4a98-9f5c-137d85fcb6ec@googlegroups.com>
Message-ID: <507E7F6B.8090003@rabbitmq.com>

Hi,

On 10/17/2012 09:58 AM, Shadowalker wrote:
> Hi,
>
> I've just stumbled upon rabbitmq and I think it could very well help 
> in a project that I'm currently working on. But there's one thing that 
> I'd like to get some input about though :
>
> My project consist of one, two or more applications that, though 
> separated, need to keep some of their datas synchronized.
>
> For example say I have two use cases that could happen at the same time :
>
> First project has a app A and a app B : when app A insert some 
> specific data in its db i need to get a meesage to appB to do the 
> corresponding action on its own db
> Second project has only app A and when I insert stuff in A's db it 
> shouldn't send anything anywhere.
>
> In both cases, I'll like to have app A and app B identical : I don't 
> want to have to change app A's code jsut because app B is here.
>
> So my question is : Is there anyway to plug the raabitmq consumer 
> directly onto a specific table in app A's database so that every time  
> something happens appB can come and consume the data.
>

Well, I'm not sure I would choose this approach personally, and I'll 
explain why. But as I'm rather attention deficit I'll cut to the chase 
first and say "yes - it is *possible* to do this - but you'll have to 
put in a lot of work to make it happen" and as I said, I certainly 
wouldn't recommend doing it. Now I'll explain why it's a bad idea IMHO 
and then I'll explain how you can do it if you insist on following this 
path.

First of all, you are creating a very tight coupling between the 
application and the database schema, which will be difficult to work 
with if the design changes (which most do) over time. Secondly, you are 
going to be running code *inside the database server* which is fraught 
with danger. Thirdly, it's going to be very difficult to test and/or 
debug when things go wrong. Our industry tends to favour integrating 
systems using messaging technology so much because doing so decouples 
applications from one another, at least to a certain extent.

The deceptively simple alternative to messaging, and it is often 
ineffective and costly to develop and maintain, is to share data using 
files and/or a shared database. Both applications share tables and/or 
schemas and either poll for changes using worker processes (or threads) 
on the one hand, or utilise notification features of the database system 
itself on the other (e,g., Microsoft SQL Server Notification Services). 
But this approach is full of problems, ranging from contention for 
reads/writes on shared tables, to timing issues where both applications 
make very subtle implicit assumptions about the order in which the 
various participants in the system are interacting with the database, 
leading to functional errors.

One reason that messaging based integration has been so successful is 
that it gets us *away* from these problems, and allows applications to 
simplify their model of interaction with the outside world. AMQP in 
particular allows an application developer to think in terms of 
asynchronously publishing events (for consumption elsewhere) or 
consuming data in a variety of ways, based purely on the usage pattern 
required.

Let's assume that you did implement this capability and whenever your 
publishing application writes to the database, a message gets sent to an 
exchange on a rabbit broker somewhere, which the other application is 
consuming via some queue. What happens if the machine or data centre the 
broker is running on crashes? What happens if the broker becomes 
overloaded and starts to assert tcp back-pressure on the publisher - 
which, remember, is running inside a database!? What happens if the 
database server has to be restarted? And each of these 'what happens' 
questions must be answered from the perspective of

1. the code running inside the database server
2. the application writing to the database
3. the application listening to the queue(s)
4. the RabbitMQ broker itself

That is an *awful* lot of moving parts, one of which is critical to your 
infrastructure (i.e., the database server) and largely not under you 
control (in so much as the semantics for running user defined code 
inside the database server and the error handling behaviour of such, are 
likely to be highly constrained). Even in an environment where you're 
running your user defined function in an external operating system 
process (e.g., Oracle UDFs written in java) the failure modes are 
terrifying. Even in an environment which gives you a very clear picture 
of the constrained runtime in which you're operating (e.g., custom .NET 
code running inside MS SQL Server as a UDF or stored procedure) there 
are questions about how stable and safe this approach is. And even in 
those environments, where stability and safety *can* be understood and 
controlled to some extent, there is still the question of semantics. If 
the publication fails, what does the application writing to the database 
see? Does the insert/update fail? Doing so would require making a 
synchronous call in the trigger/callback, which would block the database 
server and create contention for the table! Failing to make the call 
synchronous would lead to silent failures however! There are no happy 
endings here, I can assure you.

Now that I hope I've put you off this idea, here's how you can do it if 
you disagree. Write a user defined function in C (consulting 
http://dev.mysql.com/doc/refman/5.1/en/adding-udf.html or whatever 
resources you have available to assist in this) and in your user defined 
function, use the RabbitMQ native/C client (librabbitmq) to talk to 
rabbit. The details of doing all of this are left as an exercise to the 
daring. Do bare in mind that MySQL UDFs *must* be thread safe, that 
librabbitmq has no explicit support for threading whatsoever and that 
blocking in a udf is probably the first step on the road to bedlam.

Cheers,
Tim
> Cheers,
> Shadowalker.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/3faf4694/attachment.htm>

From wongkamhoong at gmail.com  Wed Oct 17 10:58:37 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Wed, 17 Oct 2012 17:58:37 +0800
Subject: [rabbitmq-discuss] RabbitMQ node stopped while broker still up
In-Reply-To: <507E7D06.505@rabbitmq.com>
References: <CAHv8OSRbwbg8GcNqa10qt-DL50Y6Cyx46J4dKF4NpUP8eJct8w@mail.gmail.com>
	<507D2491.9020207@rabbitmq.com>
	<CAHv8OSQmLrr=fRj6dK954GzAK9vWXNroxEJtL_Boz6ceBpBgNg@mail.gmail.com>
	<507D37E2.5020809@rabbitmq.com>
	<CAHv8OSTdu==-yKXU8FxVB5QNisXBFCOETR_93YUSEv1B9fezQw@mail.gmail.com>
	<507E7D06.505@rabbitmq.com>
Message-ID: <CAHv8OSQWXKTQ199qDawrzZxVL2K8WRrg_KDGHAQNFTvKgoojog@mail.gmail.com>

Hi Simon,

Usually i used command "/sbin/service rabbitmq-server stop" to stop the
rabbitmq.

Is it possible the command invoke the "rabbitmqctl stop"?

If yes, then it explain the situation.

Regards,
Wong

On Wed, Oct 17, 2012 at 5:40 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 17/10/12 03:04, Wong Kam Hoong wrote:
>
>> Hi Simon,
>>
>> I checked the log and noticed every time when start this particular
>> RabbitMQ, the log showed some error messages as follow:
>>
>> =ERROR REPORT==== 4-Oct-2012::05:46:57 ===
>> Mnesia(nplay at app2): ** ERROR ** mnesia_event got {inconsistent_database,
>> starting_partitioned_network, nplay at web1}
>>
>> =ERROR REPORT==== 4-Oct-2012::05:46:57 ===
>> Mnesia(nplay at app2): ** ERROR ** mnesia_event got {inconsistent_database,
>> starting_partitioned_network, nplay at web2}
>>
>> Why the errors logged? Is it related to my cluster setting?
>>
>
> That log message ("starting_partitioned_**network") means that Mnesia
> detected it was partitioned last time it was up, and is recovering from it
> now (where the recovery is fairly brutal - the node logging that message
> has thrown away any local changes, and has resynchronised with whichever
> nodes it found running).
>
>
>  This is production environment, I can guaranteed no one dare to execute
>> the command "rabbitmqctl stop".
>>
>
> Well, I can promise that we only log that message "Halting Erlang VM" in
> response to "rabbitmqctl stop". If you don't believe me you can check -
> it's emitted in rabbit:stop_and_halt():
>
> http://hg.rabbitmq.com/**rabbitmq-server/file/rabbitmq_**
> v2_8_x/src/rabbit.erl#l310<http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_8_x/src/rabbit.erl#l310>
>
> which is only invoked here:
>
> http://hg.rabbitmq.com/**rabbitmq-server/file/rabbitmq_**
> v2_8_x/src/rabbit_control.erl#**l161<http://hg.rabbitmq.com/rabbitmq-server/file/rabbitmq_v2_8_x/src/rabbit_control.erl#l161>
>
> - the handler for "rabbitmqctl stop".
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/f758f539/attachment.htm>

From simon at rabbitmq.com  Wed Oct 17 10:59:44 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Oct 2012 10:59:44 +0100
Subject: [rabbitmq-discuss] RabbitMQ node stopped while broker still up
In-Reply-To: <CAHv8OSQWXKTQ199qDawrzZxVL2K8WRrg_KDGHAQNFTvKgoojog@mail.gmail.com>
References: <CAHv8OSRbwbg8GcNqa10qt-DL50Y6Cyx46J4dKF4NpUP8eJct8w@mail.gmail.com>
	<507D2491.9020207@rabbitmq.com>
	<CAHv8OSQmLrr=fRj6dK954GzAK9vWXNroxEJtL_Boz6ceBpBgNg@mail.gmail.com>
	<507D37E2.5020809@rabbitmq.com>
	<CAHv8OSTdu==-yKXU8FxVB5QNisXBFCOETR_93YUSEv1B9fezQw@mail.gmail.com>
	<507E7D06.505@rabbitmq.com>
	<CAHv8OSQWXKTQ199qDawrzZxVL2K8WRrg_KDGHAQNFTvKgoojog@mail.gmail.com>
Message-ID: <507E8190.6030502@rabbitmq.com>

On 17/10/12 10:58, Wong Kam Hoong wrote:
> Usually i used command "/sbin/service rabbitmq-server stop" to stop the
> rabbitmq.
>
> Is it possible the command invoke the "rabbitmqctl stop"?
>
> If yes, then it explain the situation.

Oh, yes, it does. Sorry if I didn't make that clear.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From Dhinesh.P at saint-gobain.com  Wed Oct 17 11:01:24 2012
From: Dhinesh.P at saint-gobain.com (Dhinesh, P [ Maples - IT ])
Date: Wed, 17 Oct 2012 15:31:24 +0530
Subject: [rabbitmq-discuss] Re : rabbitmqadmin configuration
In-Reply-To: <507E7F65.1000709@rabbitmq.com>
References: <00946F8B780BAB43A04111EEAA7B47F603DE5932@L00EXCEC1.zl.if.atcsg.net>
	<507E7F65.1000709@rabbitmq.com>
Message-ID: <00946F8B780BAB43A04111EEAA7B47F603DE597F@L00EXCEC1.zl.if.atcsg.net>

Dear Simon,

 

I tried with the below command..

 

 

 

But it is nothing display....

 

And also I tried  with below link..

 

http://www.rabbitmq.com/management-cli.html..

 

Thanks and regards,

 

Dhinesh P

 

 

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Wednesday, October 17, 2012 3:20 PM
To: Discussions about RabbitMQ
Cc: Dhinesh, P [ Maples - IT ]
Subject: Re: [rabbitmq-discuss] Re : rabbitmqadmin configuration

 

On 17/10/12 10:47, Dhinesh, P [ Maples - IT ] wrote:

> If Anyone have idea reg the conf, kindly guide us to go next level..

 

"rabbitmqadmin help config" will give you some brief guidance on its
configuration file.

 

It is really unclear what you are asking.

 

Cheers, Simon

 

--

Simon MacMullen

RabbitMQ, VMware

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/64f39306/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/png
Size: 1957 bytes
Desc: image001.png
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/64f39306/attachment.png>

From simon at rabbitmq.com  Wed Oct 17 11:04:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Oct 2012 11:04:10 +0100
Subject: [rabbitmq-discuss] Re : rabbitmqadmin configuration
In-Reply-To: <00946F8B780BAB43A04111EEAA7B47F603DE597F@L00EXCEC1.zl.if.atcsg.net>
References: <00946F8B780BAB43A04111EEAA7B47F603DE5932@L00EXCEC1.zl.if.atcsg.net>
	<507E7F65.1000709@rabbitmq.com>
	<00946F8B780BAB43A04111EEAA7B47F603DE597F@L00EXCEC1.zl.if.atcsg.net>
Message-ID: <507E829A.4070207@rabbitmq.com>

Don't you need to invoke "python.exe rabbitmqadmin" on Windows?

Cheers, Simon

On 17/10/12 11:01, Dhinesh, P [ Maples - IT ] wrote:
> Dear Simon,
>
> I tried with the below command..
>
> But it is nothing display?.
>
> And also I tried  with below link..
>
> http://www.rabbitmq.com/management-cli.html..
>
> Thanks and regards,
>
> Dhinesh P
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Wednesday, October 17, 2012 3:20 PM
> To: Discussions about RabbitMQ
> Cc: Dhinesh, P [ Maples - IT ]
> Subject: Re: [rabbitmq-discuss] Re : rabbitmqadmin configuration
>
> On 17/10/12 10:47, Dhinesh, P [ Maples - IT ] wrote:
>
>  > If Anyone have idea reg the conf, kindly guide us to go next level..
>
> "rabbitmqadmin help config" will give you some brief guidance on its
> configuration file.
>
> It is really unclear what you are asking.
>
> Cheers, Simon
>
> --
>
> Simon MacMullen
>
> RabbitMQ, VMware
>


-- 
Simon MacMullen
RabbitMQ, VMware

From Dhinesh.P at saint-gobain.com  Wed Oct 17 11:08:23 2012
From: Dhinesh.P at saint-gobain.com (Dhinesh, P [ Maples - IT ])
Date: Wed, 17 Oct 2012 15:38:23 +0530
Subject: [rabbitmq-discuss] Re : rabbitmqadmin configuration
In-Reply-To: <507E829A.4070207@rabbitmq.com>
References: <00946F8B780BAB43A04111EEAA7B47F603DE5932@L00EXCEC1.zl.if.atcsg.net>
	<507E7F65.1000709@rabbitmq.com>
	<00946F8B780BAB43A04111EEAA7B47F603DE597F@L00EXCEC1.zl.if.atcsg.net>
	<507E829A.4070207@rabbitmq.com>
Message-ID: <00946F8B780BAB43A04111EEAA7B47F603DE59A7@L00EXCEC1.zl.if.atcsg.net>

Yes.....you are right...

Regards,

Dhinesh P


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Wednesday, October 17, 2012 3:34 PM
To: Dhinesh, P [ Maples - IT ]
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Re : rabbitmqadmin configuration

Don't you need to invoke "python.exe rabbitmqadmin" on Windows?

Cheers, Simon

On 17/10/12 11:01, Dhinesh, P [ Maples - IT ] wrote:
> Dear Simon,
>
> I tried with the below command..
>
> But it is nothing display....
>
> And also I tried  with below link..
>
> http://www.rabbitmq.com/management-cli.html..
>
> Thanks and regards,
>
> Dhinesh P
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Wednesday, October 17, 2012 3:20 PM
> To: Discussions about RabbitMQ
> Cc: Dhinesh, P [ Maples - IT ]
> Subject: Re: [rabbitmq-discuss] Re : rabbitmqadmin configuration
>
> On 17/10/12 10:47, Dhinesh, P [ Maples - IT ] wrote:
>
>  > If Anyone have idea reg the conf, kindly guide us to go next
level..
>
> "rabbitmqadmin help config" will give you some brief guidance on its 
> configuration file.
>
> It is really unclear what you are asking.
>
> Cheers, Simon
>
> --
>
> Simon MacMullen
>
> RabbitMQ, VMware
>


--
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Wed Oct 17 11:04:09 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 17 Oct 2012 11:04:09 +0100
Subject: [rabbitmq-discuss]
 =?utf-8?b?44CQU09T44CRaXNzdWVzIGFib3V0ICBleGVj?=
 =?utf-8?q?ution_javascript_in_IPhone?=
In-Reply-To: <000901cdac0c$c6263470$52729d50$@li@quanshi.com>
References: <000901cdac0c$c6263470$52729d50$@li@quanshi.com>
Message-ID: <507E8299.40105@rabbitmq.com>

Hi,


On 10/17/2012 03:11 AM, Li, Chenglin wrote:
>
> Hi All
>
> we want to use RabbitMQ javascript library to IPhone, and we use 
> UIWebView to execute javascript: 
> stringByEvaluatingJavaScriptFromString, but there are some 
> restrictions for execution JS on IOS as below:
>
> /****************************************************************************/
>
> JavaScript execution time is limited to 10 seconds for each top-level 
> entry point. If your script executes for more than 10 seconds, the web 
> view stops executing the script. This is likely to occur at a random 
> place in your code, so unintended consequences may result. This limit 
> is imposed because JavaScript execution may cause the main thread to 
> block, so when scripts are running, the user is not able to interact 
> with the webpage.
>
> /***************************************************************************/
>
> I want to confirm with you :
>
> 1. Does the rabbitmq javascript library have above issues? rabbitmq 
> javascript execution time will be over 10 seconds?
>

There are a number of javascript libraries around, and some of them 
(probably?) offer non-blocking options. You might start by looking at 
http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/. 
But you should bare in mind that it is impossible to guarantee 'how 
long' something will take when the network is involved. The workaround 
is usually to spawn a worker thread or some such, though I have idea 
what kind of approaches will be available on iOS.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/fc5e0024/attachment.htm>

From emile at rabbitmq.com  Wed Oct 17 11:14:12 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 17 Oct 2012 11:14:12 +0100
Subject: [rabbitmq-discuss] Safely replaying archived messages from an
 external store
In-Reply-To: <k5k2jp$3bk$1@ger.gmane.org>
References: <k5k2jp$3bk$1@ger.gmane.org>
Message-ID: <507E84F4.1070905@rabbitmq.com>

Hi Charles,

On 16/10/12 17:39, Charles Duffy wrote:
> Does this have obvious holes? Is a better approach (again, not trusting 
> the clocks of the clients which add content to the exchange to be 
> accurate) available?

I've not analysed your description in detail, but here are some thoughts:

You are correct that AMQP timestamps have 1sec resolution, but nothing
prevents publishers from adding a custom header with greater resolution.

There is a potential for messages to arrive inbetween retrieving
messages from the database and normally consuming messages from the
broker. Make sure you don't leave the door open for race conditions.

You may also want to look at the last value cached plugin:
https://github.com/squaremo/rabbitmq-lvc-plugin
though I'm not sure whether that is used in production.


-Emile



From francesco at rabbitmq.com  Wed Oct 17 11:16:16 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 17 Oct 2012 11:16:16 +0100
Subject: [rabbitmq-discuss] the cost of creating a queue?
In-Reply-To: <CA+smePJyc9eE1PKzMgDsT_ow9EVahYSk=196eP_fu+2FZP=yGg@mail.gmail.com>
References: <CA+smePJyc9eE1PKzMgDsT_ow9EVahYSk=196eP_fu+2FZP=yGg@mail.gmail.com>
Message-ID: <87zk3lcsjz.wl%francesco@rabbitmq.com>

At Wed, 17 Oct 2012 11:02:51 +0200,
Alex Shneyderman wrote:
> I am curious if there are any numbers available on what amount of
> resources does it take to create a queue? It is a clustered env. Most
> of the queues are mirrored (durable and non).
> 
> The design of the system I have in mind is that I create one (maybe
> two) queue per instance (each instance has 5 consumers and one
> publisher and they all live on two connections to rabbit one for
> publisher and one for consumers) that is part of the system. There are
> up-to 100 instances ATM and that number might grow in the future. So,
> there are about 100-200 queues that get created and need to be kept up
> by Rabbit. I am curious if there is any estimate on how much RAM per
> queue is required? Disk space? Any gotchas in the design you see right
> from its description :-) ?

100-200 queues won't be a problem, at all.  I cannot give you exact numbers, but
creating a queue basically amounts to creating a record in the mnesia database,
and the record is quite tiny:
<http://hg.rabbitmq.com/rabbitmq-server/file/c6fbb723f718/include/rabbit.hrl#l49>.

There will be an overhead when creating a queue in a clustered rabbit (since the
mnesia transaction has to be synchronised across the nodes) but there won't be
much creating an HA queue (the slaves are contacted asynchronously when creating
the queue).

---
Francesco.

From simon at rabbitmq.com  Wed Oct 17 11:20:20 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Oct 2012 11:20:20 +0100
Subject: [rabbitmq-discuss] the cost of creating a queue?
In-Reply-To: <87zk3lcsjz.wl%francesco@rabbitmq.com>
References: <CA+smePJyc9eE1PKzMgDsT_ow9EVahYSk=196eP_fu+2FZP=yGg@mail.gmail.com>
	<87zk3lcsjz.wl%francesco@rabbitmq.com>
Message-ID: <507E8664.1060305@rabbitmq.com>

On 17/10/12 11:16, Francesco Mazzoli wrote:
> 100-200 queues won't be a problem, at all.  I cannot give you exact numbers, but
> creating a queue basically amounts to creating a record in the mnesia database,
> and the record is quite tiny:
> <http://hg.rabbitmq.com/rabbitmq-server/file/c6fbb723f718/include/rabbit.hrl#l49>.

The memory cost of the process is higher, although this is not huge 
either. To the OP: a few hundred queues is no big deal at all. I would 
start to worry when we're talking hundreds of thousands :-)

> There will be an overhead when creating a queue in a clustered rabbit (since the
> mnesia transaction has to be synchronised across the nodes) but there won't be
> much creating an HA queue (the slaves are contacted asynchronously when creating
> the queue).

This sounds like HA queues are cheaper to create than non-HA ones. Which 
is not true. To the OP: high rates of queue creation / deletion might be 
a problem, but it sounds like you are not planning on doing that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Wed Oct 17 11:20:20 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 17 Oct 2012 11:20:20 +0100
Subject: [rabbitmq-discuss] Use a mysql databse table as the provider
 for rabbitmq queue
In-Reply-To: <CAG=bwtN0O+VnDiFDes1rsvFFiQzdczPyeeEUiRc21O1ksuWU_A@mail.gmail.com>
References: <c035a8fb-87fa-4a98-9f5c-137d85fcb6ec@googlegroups.com>
	<507E7F6B.8090003@rabbitmq.com>
	<CAG=bwtN0O+VnDiFDes1rsvFFiQzdczPyeeEUiRc21O1ksuWU_A@mail.gmail.com>
Message-ID: <507E8664.9050609@rabbitmq.com>

Hi

Please keep the list on CC - the info is useful for everyone. :)

On 10/17/2012 11:05 AM, Ryan R. wrote:
> Hi,
> Thanks for that long and quite detailed answer.
>
> Based on what you're saying plugging the rabbitmq provider directly on 
> the table would not be ideal and would most likely bring issues that 
> I'd rather avoid.
>

That's certainly my view.

> That said, could you provide some insight on a potentielly viable 
> solution for my project.
> Reminder :
> I want to keep my applications separate in terms of DB and code (avoid 
> triggers if possible)
> The reason for this is that depending on the situations, I would 
> deploy only one, two, or more applications out of the whole project ( 
> which roughly includes about 5 separate applications, each of which 
> needs to be fully usable withou the others as well as with, without 
> changing code not db config)
>

 From what I'm hearing, the primary concern here is that we want to be 
able to deploy any application in isolation and have it still work, 
regardless of whether or not the others are up an running. This is 
exactly the kind of scenario where messaging is supposed to help! If it 
was me, I would look at data first and foremost, and ask myself what 
information needs to be publicised. In each application I would publish 
that information, not via the database (which I would keep for internal 
use), but by publishing data to an exchange on the RabbitMQ broker. 
Publication is asynchronous and will not fail if there are no consumers 
- the data will simply get routed to a queue and sit there until someone 
eventually 'asks for it'. Then I would look at what external information 
my application(s) might want to consume. I would set up each application 
to consume only data it needs, again from the messaging broker not the 
database. Consuming can be asynchronous or synchronous - you can choose 
which - and worker threads or other similar tools can be used make this 
information available to the 'main application code' when required. A 
nice client library may do some or all of this 'worker/listener with 
callbacks' stuff for you.

Now lets consider that design for a moment. Each application publishes 
data (asynchronously) regardless of whether or not someone is around to 
consume it. If there are no consumers, the data sits around in the 
queue. If you don't want this, then you can have the data expire 
immediately or after some timeout - rabbit will allow you do configure 
all of these patterns quite easily. The consuming part introduces 
slightly more new paths on your code, as you've got to decide how to get 
received messages from the consuming callbacks, back into the 
application code, but this isn't too hard. You can configure rabbit so 
that each message is consumed by only one application, or a copy is sent 
to all consumers, or you can route messages to specific consumers based 
on routing keys. The possibilities are numerous, and many good examples 
are available in the tutorials on our website!!!

Now the only common thing that you've got to deal with in each 
application is plugging in the messaging sub system - i.e., each 
application needs to hook up to RabbitMQ using a client API and write a 
bit of glue code for publishing and consuming. Apart from that common 
factor, which if your applications are all written in the same language, 
can be delegated to a shared library, you've kept those applications 
completely decoupled.

I hope that helps you to get started thinking about ways in which rabbit 
could help with your project. I do recommend going through the tutorials 
to get an idea of some of what's possible, and do feel free to come back 
here and ask about anything that's unclear or just to discuss ideas with 
the rest of the community.

Cheers,
Tim

> Cheers,
> Ryan.
>
> 2012/10/17 Tim Watson <tim at rabbitmq.com <mailto:tim at rabbitmq.com>>
>
>     Hi,
>
>     On 10/17/2012 09:58 AM, Shadowalker wrote:
>>     Hi,
>>
>>     I've just stumbled upon rabbitmq and I think it could very well
>>     help in a project that I'm currently working on. But there's one
>>     thing that I'd like to get some input about though :
>>
>>     My project consist of one, two or more applications that, though
>>     separated, need to keep some of their datas synchronized.
>>
>>     For example say I have two use cases that could happen at the
>>     same time :
>>
>>     First project has a app A and a app B : when app A insert some
>>     specific data in its db i need to get a meesage to appB to do the
>>     corresponding action on its own db
>>     Second project has only app A and when I insert stuff in A's db
>>     it shouldn't send anything anywhere.
>>
>>     In both cases, I'll like to have app A and app B identical : I
>>     don't want to have to change app A's code jsut because app B is here.
>>
>>     So my question is : Is there anyway to plug the raabitmq consumer
>>     directly onto a specific table in app A's database so that every
>>     time  something happens appB can come and consume the data.
>>
>
>     Well, I'm not sure I would choose this approach personally, and
>     I'll explain why. But as I'm rather attention deficit I'll cut to
>     the chase first and say "yes - it is *possible* to do this - but
>     you'll have to put in a lot of work to make it happen" and as I
>     said, I certainly wouldn't recommend doing it. Now I'll explain
>     why it's a bad idea IMHO and then I'll explain how you can do it
>     if you insist on following this path.
>
>     First of all, you are creating a very tight coupling between the
>     application and the database schema, which will be difficult to
>     work with if the design changes (which most do) over time.
>     Secondly, you are going to be running code *inside the database
>     server* which is fraught with danger. Thirdly, it's going to be
>     very difficult to test and/or debug when things go wrong. Our
>     industry tends to favour integrating systems using messaging
>     technology so much because doing so decouples applications from
>     one another, at least to a certain extent.
>
>     The deceptively simple alternative to messaging, and it is often
>     ineffective and costly to develop and maintain, is to share data
>     using files and/or a shared database. Both applications share
>     tables and/or schemas and either poll for changes using worker
>     processes (or threads) on the one hand, or utilise notification
>     features of the database system itself on the other (e,g.,
>     Microsoft SQL Server Notification Services). But this approach is
>     full of problems, ranging from contention for reads/writes on
>     shared tables, to timing issues where both applications make very
>     subtle implicit assumptions about the order in which the various
>     participants in the system are interacting with the database,
>     leading to functional errors.
>
>     One reason that messaging based integration has been so successful
>     is that it gets us *away* from these problems, and allows
>     applications to simplify their model of interaction with the
>     outside world. AMQP in particular allows an application developer
>     to think in terms of asynchronously publishing events (for
>     consumption elsewhere) or consuming data in a variety of ways,
>     based purely on the usage pattern required.
>
>     Let's assume that you did implement this capability and whenever
>     your publishing application writes to the database, a message gets
>     sent to an exchange on a rabbit broker somewhere, which the other
>     application is consuming via some queue. What happens if the
>     machine or data centre the broker is running on crashes? What
>     happens if the broker becomes overloaded and starts to assert tcp
>     back-pressure on the publisher - which, remember, is running
>     inside a database!? What happens if the database server has to be
>     restarted? And each of these 'what happens' questions must be
>     answered from the perspective of
>
>     1. the code running inside the database server
>     2. the application writing to the database
>     3. the application listening to the queue(s)
>     4. the RabbitMQ broker itself
>
>     That is an *awful* lot of moving parts, one of which is critical
>     to your infrastructure (i.e., the database server) and largely not
>     under you control (in so much as the semantics for running user
>     defined code inside the database server and the error handling
>     behaviour of such, are likely to be highly constrained). Even in
>     an environment where you're running your user defined function in
>     an external operating system process (e.g., Oracle UDFs written in
>     java) the failure modes are terrifying. Even in an environment
>     which gives you a very clear picture of the constrained runtime in
>     which you're operating (e.g., custom .NET code running inside MS
>     SQL Server as a UDF or stored procedure) there are questions about
>     how stable and safe this approach is. And even in those
>     environments, where stability and safety *can* be understood and
>     controlled to some extent, there is still the question of
>     semantics. If the publication fails, what does the application
>     writing to the database see? Does the insert/update fail? Doing so
>     would require making a synchronous call in the trigger/callback,
>     which would block the database server and create contention for
>     the table! Failing to make the call synchronous would lead to
>     silent failures however! There are no happy endings here, I can
>     assure you.
>
>     Now that I hope I've put you off this idea, here's how you can do
>     it if you disagree. Write a user defined function in C (consulting
>     http://dev.mysql.com/doc/refman/5.1/en/adding-udf.html or whatever
>     resources you have available to assist in this) and in your user
>     defined function, use the RabbitMQ native/C client (librabbitmq)
>     to talk to rabbit. The details of doing all of this are left as an
>     exercise to the daring. Do bare in mind that MySQL UDFs *must* be
>     thread safe, that librabbitmq has no explicit support for
>     threading whatsoever and that blocking in a udf is probably the
>     first step on the road to bedlam.
>
>     Cheers,
>     Tim
>>     Cheers,
>>     Shadowalker.
>>
>>
>>     _______________________________________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.rabbitmq.com  <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/2c4e2d7c/attachment.htm>

From tim at rabbitmq.com  Wed Oct 17 11:25:08 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 17 Oct 2012 11:25:08 +0100
Subject: [rabbitmq-discuss]
 =?utf-8?b?44CQU09T44CRaXNzdWVzIGFib3V0ICBleGVj?=
 =?utf-8?q?ution_javascript_in_IPhone?=
In-Reply-To: <507E8299.40105@rabbitmq.com>
References: <000901cdac0c$c6263470$52729d50$@li@quanshi.com>
	<507E8299.40105@rabbitmq.com>
Message-ID: <507E8784.6050408@rabbitmq.com>

On 10/17/2012 11:04 AM, Tim Watson wrote:
> thread or some such, though I have idea what kind of approaches will 
> be available on iOS.

s/I have idea/I have no idea/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/8118e220/attachment.htm>

From tim at rabbitmq.com  Wed Oct 17 11:31:11 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 17 Oct 2012 11:31:11 +0100
Subject: [rabbitmq-discuss] Problem with RabbitMQ HA cluster on
	EC2	(Windows)
In-Reply-To: <09ea01cdabb3$cc78b1d0$656a1570$@psonar.com>
References: <08bd01cdab9c$3d2671f0$b77355d0$@psonar.com>
	<E76308DC-F385-48F1-A649-8F4778297C76@rabbitmq.com>
	<09ea01cdabb3$cc78b1d0$656a1570$@psonar.com>
Message-ID: <507E88EF.1050803@rabbitmq.com>

On 10/16/2012 04:34 PM, Richard Urwin wrote:
>
> Hi Tim,
>
> Thanks for the rapid response!
>

You're welcome - I had to think a bit longer about this second one 
though! ;)

> OK, so I added the following into each hosts file:
>
> IP-0AF23E1E       10.XX.XX.XX
>
> IP-0AD25792      10.XX.XX.XX
>
> The names now match everywhere and are correctly mapped to the private 
> IPs.
>
> Now when I run:
>
> C:\Program Files (x86)\RabbitMQ 
> Server\rabbitmq_server-2.8.7\sbin>rabbitmqctl cluster rabbit at IP-0AF23E1E
>
> I have success:
>
> Clustering node 'rabbit at IP-0AD25792' with ['rabbit at IP-0AF23E1E'] ...
>
> ...done.
>
> ...and checking the cluster status with:
>
> C:\Program Files (x86)\RabbitMQ 
> Server\rabbitmq_server-2.8.7\sbin>rabbitmqctl cluster_status
>
> ...gives:
>
> Cluster status of node 'rabbit at IP-0AD25792' ...
>
> [{nodes,[{disc,['rabbit at IP-0AF23E1E']},{ram,['rabbit at IP-0AD25792']}]},
>
> {running_nodes,['rabbit at IP-0AF23E1E','rabbit at IP-0AD25792']}]
>
> ...done.
>

Great!

> BUT:
>
> I had to open all of the ports within the EC2 security group and 
> Windows firewall.
>
> As mentioned, I have this (and only this) in my rabbit.config:
>
> [{kernel, [{inet_dist_listen_min, 55700}, {inet_dist_listen_max, 
> 55800}]}].
>
> But it doesn't appear to be restricting the ports (since when I 
> restrict the firewalls back to that range, it can't cluster.)
>
> Can you see what's wrong?
>

Hmn. If you set these net_kernel parameters for an Erlang node, then you 
need to restart epmd on that host IIRC. The routing is usually thus

$ rabbitmqctl stop
$ epmd -names
epmd: up and running on port 4369 with data:
$ epmd -kill

Then restart your rabbit (on that node!) and you *should* be good to go. 
Note that if `epmd -names` returns some running erlang nodes on that 
host then you'll need to stop/kill them before stopping epmd itself.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/91966a28/attachment.htm>

From ryan.rajkomar at gmail.com  Wed Oct 17 11:40:35 2012
From: ryan.rajkomar at gmail.com (Ryan R.)
Date: Wed, 17 Oct 2012 12:40:35 +0200
Subject: [rabbitmq-discuss] Use a mysql databse table as the provider
 for rabbitmq queue
In-Reply-To: <507E8664.9050609@rabbitmq.com>
References: <c035a8fb-87fa-4a98-9f5c-137d85fcb6ec@googlegroups.com>
	<507E7F6B.8090003@rabbitmq.com>
	<CAG=bwtN0O+VnDiFDes1rsvFFiQzdczPyeeEUiRc21O1ksuWU_A@mail.gmail.com>
	<507E8664.9050609@rabbitmq.com>
Message-ID: <CAG=bwtM4uPEw8JQ-9jTJPy0z=8xgVLDVxNo_Sdt1+xcOYBnMAA@mail.gmail.com>

I think I understand what you mean with the shared library.
However, in my case, RabbitMQ would only be installed if need be (meaning
more than one of the apps are present, and two of those need to be
synchronised for part of their data).

That said, using a shared library would require me to "include/import" said
library when I need to, therefore making me change my app code depending of
the situation I'm in.

And said library would only be required when there's a RabbitMQ available
anyway.

Now a bit further in your message you talk about a listener library.
I'd like to know a bit more about this.
How would an external library be able to listen to anything happening
within my app ?
Would it be listening on the DB queries ?

Cheers,
Ryan.

2012/10/17 Tim Watson <tim at rabbitmq.com>

>  Hi
>
> Please keep the list on CC - the info is useful for everyone. :)
>
>
> On 10/17/2012 11:05 AM, Ryan R. wrote:
>
> Hi,
> Thanks for that long and quite detailed answer.
>
> Based on what you're saying plugging the rabbitmq provider directly on the
> table would not be ideal and would most likely bring issues that I'd rather
> avoid.
>
>
> That's certainly my view.
>
>
> That said, could you provide some insight on a potentielly viable solution
> for my project.
> Reminder :
> I want to keep my applications separate in terms of DB and code (avoid
> triggers if possible)
> The reason for this is that depending on the situations, I would deploy
> only one, two, or more applications out of the whole project ( which
> roughly includes about 5 separate applications, each of which needs to be
> fully usable withou the others as well as with, without changing code not
> db config)
>
>
> From what I'm hearing, the primary concern here is that we want to be able
> to deploy any application in isolation and have it still work, regardless
> of whether or not the others are up an running. This is exactly the kind of
> scenario where messaging is supposed to help! If it was me, I would look at
> data first and foremost, and ask myself what information needs to be
> publicised. In each application I would publish that information, not via
> the database (which I would keep for internal use), but by publishing data
> to an exchange on the RabbitMQ broker. Publication is asynchronous and will
> not fail if there are no consumers - the data will simply get routed to a
> queue and sit there until someone eventually 'asks for it'. Then I would
> look at what external information my application(s) might want to consume.
> I would set up each application to consume only data it needs, again from
> the messaging broker not the database. Consuming can be asynchronous or
> synchronous - you can choose which - and worker threads or other similar
> tools can be used make this information available to the 'main application
> code' when required. A nice client library may do some or all of this
> 'worker/listener with callbacks' stuff for you.
>
> Now lets consider that design for a moment. Each application publishes
> data (asynchronously) regardless of whether or not someone is around to
> consume it. If there are no consumers, the data sits around in the queue.
> If you don't want this, then you can have the data expire immediately or
> after some timeout - rabbit will allow you do configure all of these
> patterns quite easily. The consuming part introduces slightly more new
> paths on your code, as you've got to decide how to get received messages
> from the consuming callbacks, back into the application code, but this
> isn't too hard. You can configure rabbit so that each message is consumed
> by only one application, or a copy is sent to all consumers, or you can
> route messages to specific consumers based on routing keys. The
> possibilities are numerous, and many good examples are available in the
> tutorials on our website!!!
>
> Now the only common thing that you've got to deal with in each application
> is plugging in the messaging sub system - i.e., each application needs to
> hook up to RabbitMQ using a client API and write a bit of glue code for
> publishing and consuming. Apart from that common factor, which if your
> applications are all written in the same language, can be delegated to a
> shared library, you've kept those applications completely decoupled.
>
> I hope that helps you to get started thinking about ways in which rabbit
> could help with your project. I do recommend going through the tutorials to
> get an idea of some of what's possible, and do feel free to come back here
> and ask about anything that's unclear or just to discuss ideas with the
> rest of the community.
>
> Cheers,
> Tim
>
>
> Cheers,
> Ryan.
>
> 2012/10/17 Tim Watson <tim at rabbitmq.com>
>
>>  Hi,
>>
>> On 10/17/2012 09:58 AM, Shadowalker wrote:
>>
>> Hi,
>>
>> I've just stumbled upon rabbitmq and I think it could very well help in a
>> project that I'm currently working on. But there's one thing that I'd like
>> to get some input about though :
>>
>> My project consist of one, two or more applications that, though
>> separated, need to keep some of their datas synchronized.
>>
>> For example say I have two use cases that could happen at the same time :
>>
>> First project has a app A and a app B : when app A insert some specific
>> data in its db i need to get a meesage to appB to do the corresponding
>> action on its own db
>> Second project has only app A and when I insert stuff in A's db it
>> shouldn't send anything anywhere.
>>
>> In both cases, I'll like to have app A and app B identical : I don't want
>> to have to change app A's code jsut because app B is here.
>>
>> So my question is : Is there anyway to plug the raabitmq consumer
>> directly onto a specific table in app A's database so that every time
>> something happens appB can come and consume the data.
>>
>>
>> Well, I'm not sure I would choose this approach personally, and I'll
>> explain why. But as I'm rather attention deficit I'll cut to the chase
>> first and say "yes - it is *possible* to do this - but you'll have to put
>> in a lot of work to make it happen" and as I said, I certainly wouldn't
>> recommend doing it. Now I'll explain why it's a bad idea IMHO and then I'll
>> explain how you can do it if you insist on following this path.
>>
>> First of all, you are creating a very tight coupling between the
>> application and the database schema, which will be difficult to work with
>> if the design changes (which most do) over time. Secondly, you are going to
>> be running code *inside the database server* which is fraught with danger.
>> Thirdly, it's going to be very difficult to test and/or debug when things
>> go wrong. Our industry tends to favour integrating systems using messaging
>> technology so much because doing so decouples applications from one
>> another, at least to a certain extent.
>>
>> The deceptively simple alternative to messaging, and it is often
>> ineffective and costly to develop and maintain, is to share data using
>> files and/or a shared database. Both applications share tables and/or
>> schemas and either poll for changes using worker processes (or threads) on
>> the one hand, or utilise notification features of the database system
>> itself on the other (e,g., Microsoft SQL Server Notification Services). But
>> this approach is full of problems, ranging from contention for reads/writes
>> on shared tables, to timing issues where both applications make very subtle
>> implicit assumptions about the order in which the various participants in
>> the system are interacting with the database, leading to functional errors.
>>
>> One reason that messaging based integration has been so successful is
>> that it gets us *away* from these problems, and allows applications to
>> simplify their model of interaction with the outside world. AMQP in
>> particular allows an application developer to think in terms of
>> asynchronously publishing events (for consumption elsewhere) or consuming
>> data in a variety of ways, based purely on the usage pattern required.
>>
>> Let's assume that you did implement this capability and whenever your
>> publishing application writes to the database, a message gets sent to an
>> exchange on a rabbit broker somewhere, which the other application is
>> consuming via some queue. What happens if the machine or data centre the
>> broker is running on crashes? What happens if the broker becomes overloaded
>> and starts to assert tcp back-pressure on the publisher - which, remember,
>> is running inside a database!? What happens if the database server has to
>> be restarted? And each of these 'what happens' questions must be answered
>> from the perspective of
>>
>> 1. the code running inside the database server
>> 2. the application writing to the database
>> 3. the application listening to the queue(s)
>> 4. the RabbitMQ broker itself
>>
>> That is an *awful* lot of moving parts, one of which is critical to your
>> infrastructure (i.e., the database server) and largely not under you
>> control (in so much as the semantics for running user defined code inside
>> the database server and the error handling behaviour of such, are likely to
>> be highly constrained). Even in an environment where you're running your
>> user defined function in an external operating system process (e.g., Oracle
>> UDFs written in java) the failure modes are terrifying. Even in an
>> environment which gives you a very clear picture of the constrained runtime
>> in which you're operating (e.g., custom .NET code running inside MS SQL
>> Server as a UDF or stored procedure) there are questions about how stable
>> and safe this approach is. And even in those environments, where stability
>> and safety *can* be understood and controlled to some extent, there is
>> still the question of semantics. If the publication fails, what does the
>> application writing to the database see? Does the insert/update fail? Doing
>> so would require making a synchronous call in the trigger/callback, which
>> would block the database server and create contention for the table!
>> Failing to make the call synchronous would lead to silent failures however!
>> There are no happy endings here, I can assure you.
>>
>> Now that I hope I've put you off this idea, here's how you can do it if
>> you disagree. Write a user defined function in C (consulting
>> http://dev.mysql.com/doc/refman/5.1/en/adding-udf.html or whatever
>> resources you have available to assist in this) and in your user defined
>> function, use the RabbitMQ native/C client (librabbitmq) to talk to rabbit.
>> The details of doing all of this are left as an exercise to the daring. Do
>> bare in mind that MySQL UDFs *must* be thread safe, that librabbitmq has no
>> explicit support for threading whatsoever and that blocking in a udf is
>> probably the first step on the road to bedlam.
>>
>> Cheers,
>> Tim
>>
>> Cheers,
>> Shadowalker.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/81b4be2b/attachment.htm>

From emile at rabbitmq.com  Wed Oct 17 12:06:33 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 17 Oct 2012 12:06:33 +0100
Subject: [rabbitmq-discuss] Unexpected log generated
In-Reply-To: <507E90A1.7080502@gmail.com>
References: <507E90A1.7080502@gmail.com>
Message-ID: <507E9139.4020706@rabbitmq.com>


Hi,

On 17/10/12 11:27, Wong Kam Hoong wrote:
> Hi RabbitMQ Team,
> 
> Recently i checked the RabbitMQ log, i saw there are a lot unexpected
> log generated which I really can't understand what they are..
> 
> *_Sample Log_*
> =ERROR REPORT==== 17-Oct-2012::00:02:55 ===
> ** Generic server <0.401.0> terminating
> . . . 
> 
> Attached is the full log for your reference.

Unfortunately this was larger than the allowed 1Mb, preventing your
message from showing up on the mailing list.

The logfile included this error:

** Reason for termination ==
** {{case_clause,{{{value,{4431712,{drop,61,0,false}}},{[],[]}},
                  {empty,{[],[]}}}},
    [{gm,find_common,3},
     {gm,find_prefix_common_suffix,2},
     {gm,'-handle_msg/2-fun-0-',7},
     {gm,with_member_acc,3},
     {lists,foldl,3},
     {gm,handle_msg,2},
     {gm,handle_cast,2},
     {gen_server2,handle_msg,2}]}

This error has the same signature as a bug that has been fixed in more
recent versions of the broker. Can you please confirm which version of
RabbitMQ you are using and whether the problem persists if you upgrade
to the latest version?



-Emile



From tim at rabbitmq.com  Wed Oct 17 12:03:00 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 17 Oct 2012 12:03:00 +0100
Subject: [rabbitmq-discuss] Use a mysql databse table as the provider
 for rabbitmq queue
In-Reply-To: <CAG=bwtM4uPEw8JQ-9jTJPy0z=8xgVLDVxNo_Sdt1+xcOYBnMAA@mail.gmail.com>
References: <c035a8fb-87fa-4a98-9f5c-137d85fcb6ec@googlegroups.com>
	<507E7F6B.8090003@rabbitmq.com>
	<CAG=bwtN0O+VnDiFDes1rsvFFiQzdczPyeeEUiRc21O1ksuWU_A@mail.gmail.com>
	<507E8664.9050609@rabbitmq.com>
	<CAG=bwtM4uPEw8JQ-9jTJPy0z=8xgVLDVxNo_Sdt1+xcOYBnMAA@mail.gmail.com>
Message-ID: <507E9064.8090804@rabbitmq.com>

On 10/17/2012 11:40 AM, Ryan R. wrote:
> I think I understand what you mean with the shared library.
> However, in my case, RabbitMQ would only be installed if need be 
> (meaning more than one of the apps are present, and two of those need 
> to be synchronised for part of their data).
>

That actually complicates the picture somewhat - is there a reason why 
this is the case? In a typical integration architecture, the messaging 
broker is deployed centrally (on the LAN somewhere) and clients choose 
whether or not they want to connect to it from whatever machine they're 
running on. To me, it is sounding like you're describing an architecture 
where both applications reside on the same machine and assuming that the 
broker will also need to be co-resident with them, which is not really 
the case, though there's nothing to prohibit that either.

> That said, using a shared library would require me to "include/import" 
> said library when I need to, therefore making me change my app code 
> depending of the situation I'm in.
>

Well yes, if you're going to add messaging capabilities to your 
applications that don't currently support it, then you are going to have 
to write *some* code and integrate it into them! :)

> And said library would only be required when there's a RabbitMQ 
> available anyway.
>

I think you're making your life more complicated than it needs to be by 
thinking about whether the messaging broker is available vs. not. The 
broker should *always* be available when applications residing on 
different machines need to communicate with one another, regardless of 
whether those applications are running or not. Again, it feels like 
you're trying to deal with applications running on the same machine - 
have I picked that up correctly? It might help if you explained your 
architecture in a bit more detail, so I can understand exactly what 
you're trying to achieve.

> Now a bit further in your message you talk about a listener library.
> I'd like to know a bit more about this.
> How would an external library be able to listen to anything happening 
> within my app ?
> Would it be listening on the DB queries ?
>

No, not at all. Let's say you've got two applications, App1 and App2. 
You'll write some library code that both applications share, that 
probably looks something like this (with *wide* variations depending on 
language/platform - I've just written pseudo code to keep things simple):

-------------------------------------

function init = do
     read_config_file_for_this_app
     open_connection_to_broker
     store_connection_somewhere_in_memory
end

function listen = do
     get_connection_from_memory
     read_message_from_broker
     pass_message_to_application_thread_somehow
     listen
end

function publish = do
     get_connection_from_memory
     send_message_to_broker
end

-------------------------------------

Now in your applications, you'll call the shared 'init' library function 
when you're starting up to bootstrap the connection to the broker. When 
your application is publishing data, it calls publish and if/when you 
need to subscribe to data then you'll call 'listen'. The fact is that 
'how to listen' for incoming messages really depends on how you're going 
to use them. But the point is that the applications read from and write 
to the messaging broker, and do so independently of database tables. You 
*may* decide to do something like write a middle-man application that 
periodically reads a database table and publishes each row to the 
messaging broker so it can be read from a queue, or do that with a 
worker thread instead of a separate application. I would *not* do 
anything here with the database though. If applications need to share 
data, then **they should send it to one another via message queues.** If 
they need to persist data, they should persist their own data in their 
own tables in the database, but they should **not use the database to 
communicate with one another.** That is the key thing with using 
messaging instead shared data(bases).

There is an overhead in sending (and in some cases, duplicating) data 
between applications of course. This is *more* than compensated for by 
the reduced coupling that comes from integrating using messaging 
technology. This approach may not be suited to integrating applications 
that are running on the same physical machine and are tightly and 
deliberately coupled however. I can't really elaborate on the 
suitability of messaging for your project without understanding a good 
deal more about it I'm afraid.

I hope that clears a few things up at least! :)

Cheers,
Tim


From a.shneyderman at gmail.com  Wed Oct 17 12:12:17 2012
From: a.shneyderman at gmail.com (Alex Shneyderman)
Date: Wed, 17 Oct 2012 13:12:17 +0200
Subject: [rabbitmq-discuss] the cost of creating a queue?
In-Reply-To: <507E8664.1060305@rabbitmq.com>
References: <CA+smePJyc9eE1PKzMgDsT_ow9EVahYSk=196eP_fu+2FZP=yGg@mail.gmail.com>
	<87zk3lcsjz.wl%francesco@rabbitmq.com>
	<507E8664.1060305@rabbitmq.com>
Message-ID: <CA+smePJxqZeDaSh-MbSm3=7Jpg=AWjQDPXdDV0YYvGO0NyHgoA@mail.gmail.com>

Thanks, guys!

Cheers,
Alex.

On Wed, Oct 17, 2012 at 12:20 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 17/10/12 11:16, Francesco Mazzoli wrote:
>>
>> 100-200 queues won't be a problem, at all.  I cannot give you exact
>> numbers, but
>> creating a queue basically amounts to creating a record in the mnesia
>> database,
>> and the record is quite tiny:
>>
>> <http://hg.rabbitmq.com/rabbitmq-server/file/c6fbb723f718/include/rabbit.hrl#l49>.
>
>
> The memory cost of the process is higher, although this is not huge either.
> To the OP: a few hundred queues is no big deal at all. I would start to
> worry when we're talking hundreds of thousands :-)
>
>
>> There will be an overhead when creating a queue in a clustered rabbit
>> (since the
>> mnesia transaction has to be synchronised across the nodes) but there
>> won't be
>> much creating an HA queue (the slaves are contacted asynchronously when
>> creating
>> the queue).
>
>
> This sounds like HA queues are cheaper to create than non-HA ones. Which is
> not true. To the OP: high rates of queue creation / deletion might be a
> problem, but it sounds like you are not planning on doing that.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware

From emile at rabbitmq.com  Wed Oct 17 12:31:30 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 17 Oct 2012 12:31:30 +0100
Subject: [rabbitmq-discuss] Deprecating messagepatterns libraries
Message-ID: <507E9712.1020405@rabbitmq.com>


Hi,

We are considering deprecating the RabbitMQ Java and .NET
messagepatterns libraries, as part of a cleanup exercise:

http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/
http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/

These libraries were meant to provide some higher-level abstractions on
top of the regular Java and .NET libraries, but evidence suggests that
they are not being used much. And they haven't had any updates for years.

Please let us know if you have any objections to both of these being
deprecated.


-Emile



From francesco at rabbitmq.com  Wed Oct 17 13:18:44 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Wed, 17 Oct 2012 13:18:44 +0100
Subject: [rabbitmq-discuss] the cost of creating a queue?
In-Reply-To: <507E8664.1060305@rabbitmq.com>
References: <CA+smePJyc9eE1PKzMgDsT_ow9EVahYSk=196eP_fu+2FZP=yGg@mail.gmail.com>
	<87zk3lcsjz.wl%francesco@rabbitmq.com>
	<507E8664.1060305@rabbitmq.com>
Message-ID: <87wqypcmvv.wl%francesco@rabbitmq.com>

At Wed, 17 Oct 2012 11:20:20 +0100,
Simon MacMullen wrote:
> > There will be an overhead when creating a queue in a clustered rabbit (since the
> > mnesia transaction has to be synchronised across the nodes) but there won't be
> > much creating an HA queue (the slaves are contacted asynchronously when creating
> > the queue).
> 
> This sounds like HA queues are cheaper to create than non-HA ones. Which 
> is not true. To the OP: high rates of queue creation / deletion might be 
> a problem, but it sounds like you are not planning on doing that.

Right, what I meant is that there isn't a big overhead compared to normal queues
in a cluster (which could be conceivable).

--
Francesco

From ryan.rajkomar at gmail.com  Wed Oct 17 14:03:25 2012
From: ryan.rajkomar at gmail.com (Ryan R.)
Date: Wed, 17 Oct 2012 15:03:25 +0200
Subject: [rabbitmq-discuss] Use a mysql databse table as the provider
 for rabbitmq queue
In-Reply-To: <507E9064.8090804@rabbitmq.com>
References: <c035a8fb-87fa-4a98-9f5c-137d85fcb6ec@googlegroups.com>
	<507E7F6B.8090003@rabbitmq.com>
	<CAG=bwtN0O+VnDiFDes1rsvFFiQzdczPyeeEUiRc21O1ksuWU_A@mail.gmail.com>
	<507E8664.9050609@rabbitmq.com>
	<CAG=bwtM4uPEw8JQ-9jTJPy0z=8xgVLDVxNo_Sdt1+xcOYBnMAA@mail.gmail.com>
	<507E9064.8090804@rabbitmq.com>
Message-ID: <CAG=bwtOfCBi6zY0kHiHz90mHc1hmV7wJyWF6Up-9ZVXGH8E0qg@mail.gmail.com>

Ok I've definitely got what you're trying to say concerning the use of DBs
and message broker.

To explain a bit more, I'll answer the few questiosn you've scattered
across your reply :

Is it a distributed architecture ?

Definitely yes, each app will run on a different server

Why do I need to keep apps separate ?

Simply because my project can be viewed as a application suite composed of
about 5 different apps. The end-user will be able to choose which of the
apps he wants and I want to only provide what is absolutely necessary for
the end-user based on what he asked for, nothing more nothing less.
Therefore if the end user only wants one app out five I'm not going to
provide him with a RabbitMQ, he will have no use for it. However should he
asked for a set of apps that need to communicate, then I'll install a
RabbitMQ to let them communicate.
Now like I said, I'm looking for a way to do this without changing anything
in the apps' code.
What I'm looking for is a solution where I would have something like a
"watcher" external app that would keep an eye on what's going on in each
app and manage the content of each RabbitMQ queues accordingly.

That peculiar aspect of the apps is for my longterm evolution of my app :
for my personal use, the simpler approach of the code for pushing a mesage
in the queues embedded in the app would be fine. But since I'd like to make
it evolve to something else, I'd rather think ahead and try to do so right
now.

Hope these explanations help a little more.

Cheers,
Ryan.

2012/10/17 Tim Watson <tim at rabbitmq.com>

> On 10/17/2012 11:40 AM, Ryan R. wrote:
>
>> I think I understand what you mean with the shared library.
>> However, in my case, RabbitMQ would only be installed if need be (meaning
>> more than one of the apps are present, and two of those need to be
>> synchronised for part of their data).
>>
>>
> That actually complicates the picture somewhat - is there a reason why
> this is the case? In a typical integration architecture, the messaging
> broker is deployed centrally (on the LAN somewhere) and clients choose
> whether or not they want to connect to it from whatever machine they're
> running on. To me, it is sounding like you're describing an architecture
> where both applications reside on the same machine and assuming that the
> broker will also need to be co-resident with them, which is not really the
> case, though there's nothing to prohibit that either.
>
>
>  That said, using a shared library would require me to "include/import"
>> said library when I need to, therefore making me change my app code
>> depending of the situation I'm in.
>>
>>
> Well yes, if you're going to add messaging capabilities to your
> applications that don't currently support it, then you are going to have to
> write *some* code and integrate it into them! :)
>
>
>  And said library would only be required when there's a RabbitMQ available
>> anyway.
>>
>>
> I think you're making your life more complicated than it needs to be by
> thinking about whether the messaging broker is available vs. not. The
> broker should *always* be available when applications residing on different
> machines need to communicate with one another, regardless of whether those
> applications are running or not. Again, it feels like you're trying to deal
> with applications running on the same machine - have I picked that up
> correctly? It might help if you explained your architecture in a bit more
> detail, so I can understand exactly what you're trying to achieve.
>
>
>  Now a bit further in your message you talk about a listener library.
>> I'd like to know a bit more about this.
>> How would an external library be able to listen to anything happening
>> within my app ?
>> Would it be listening on the DB queries ?
>>
>>
> No, not at all. Let's say you've got two applications, App1 and App2.
> You'll write some library code that both applications share, that probably
> looks something like this (with *wide* variations depending on
> language/platform - I've just written pseudo code to keep things simple):
>
> ------------------------------**-------
>
> function init = do
>     read_config_file_for_this_app
>     open_connection_to_broker
>     store_connection_somewhere_in_**memory
> end
>
> function listen = do
>     get_connection_from_memory
>     read_message_from_broker
>     pass_message_to_application_**thread_somehow
>     listen
> end
>
> function publish = do
>     get_connection_from_memory
>     send_message_to_broker
> end
>
> ------------------------------**-------
>
> Now in your applications, you'll call the shared 'init' library function
> when you're starting up to bootstrap the connection to the broker. When
> your application is publishing data, it calls publish and if/when you need
> to subscribe to data then you'll call 'listen'. The fact is that 'how to
> listen' for incoming messages really depends on how you're going to use
> them. But the point is that the applications read from and write to the
> messaging broker, and do so independently of database tables. You *may*
> decide to do something like write a middle-man application that
> periodically reads a database table and publishes each row to the messaging
> broker so it can be read from a queue, or do that with a worker thread
> instead of a separate application. I would *not* do anything here with the
> database though. If applications need to share data, then **they should
> send it to one another via message queues.** If they need to persist data,
> they should persist their own data in their own tables in the database, but
> they should **not use the database to communicate with one another.** That
> is the key thing with using messaging instead shared data(bases).
>
> There is an overhead in sending (and in some cases, duplicating) data
> between applications of course. This is *more* than compensated for by the
> reduced coupling that comes from integrating using messaging technology.
> This approach may not be suited to integrating applications that are
> running on the same physical machine and are tightly and deliberately
> coupled however. I can't really elaborate on the suitability of messaging
> for your project without understanding a good deal more about it I'm afraid.
>
> I hope that clears a few things up at least! :)
>
> Cheers,
> Tim
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/5dccd217/attachment.htm>

From simon at rabbitmq.com  Wed Oct 17 14:15:23 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Oct 2012 14:15:23 +0100
Subject: [rabbitmq-discuss] Monitoring A Queue
In-Reply-To: <602d0b86-217f-4bc2-9896-72a1334a8e12@googlegroups.com>
References: <602d0b86-217f-4bc2-9896-72a1334a8e12@googlegroups.com>
Message-ID: <507EAF6B.5080504@rabbitmq.com>

Hi!

On 15/10/12 17:10, Jason Antman wrote:
> I've been examining the JSON results from the management API
> (/api/queues/vhost_name/queue_name), and have come to the following
> conclusions:
> 1) There are no monotonically increasing counters of the number of
> messages in to the queue and number of messages out of the queue.
> Therefore, there's no way for me to figure the rate on an arbitrary time
> scale.

I'm afraid so, yes. message_stats.publish and message_stats.deliver_get 
are an approximation of what you want, but they only count messages from 
currently open channels. This may change in future, we're aware of it as 
a limitation.

But you may be able to get away with using those if your applications 
tend to keep connections open for a long time.

> 2) The "messages" element in the JSON array is the number of messages
> currently sitting in the queue, not a counter of the number that have
> passed through it.

Yes.

> 3) The API does provide backing_queue_status.avg_ingress_rate and
> backing_queue_status.avg_egress_rate. Going by Matthew's post to
> "Monitoring Message Throughput"
> (http://rabbitmq.1065348.n5.nabble.com/Monitoring-Message-Throughput-td17436.html#a17438)

It's worth noting that that thread is quite old - it predates the 
management plugin for a start.

> from February, 2010, I gather that these values are averaged over
> approx. 10 seconds. I'm also assuming that ingress is *every* message
> into the queue, and egress is... *every* message grabbed from the queue,
> regardless of ACK? So even if consumers are not acking any messages,
> this rate will still show them?

Maybe. The trouble is that those stats are maintained by the backing 
queue for its own purposes, they're only coincidentally useful for 
anyone else.

One issue is that the backing_queue_status only counts messages that 
actually make it into the backing queue. Messages can fly through the 
queue and never touch the backing queue if there is an autoack consumer 
ready to receive them.

> Are these correct?
>
> It would be really helpful if someone could explain exactly what
> avg_in/egress_rate and avg_ack_in/egress_rate mean.

Hope this helps.

> I also found some reference to a Ticket 23 (though I don't see any links
> to the RMQ ticketing system) that dealt with monitoring:
> http://grokbase.com/t/rabbitmq/rabbitmq-discuss/10ag2hejbb/ticket-23-new-comment-monitoring-message-throughput

Oh, that was someone who lost control of their ticketing system(!) and 
starting spamming us. Ignore it.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Oct 17 14:18:12 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Oct 2012 14:18:12 +0100
Subject: [rabbitmq-discuss] Monitoring A Queue
In-Reply-To: <507EAF6B.5080504@rabbitmq.com>
References: <602d0b86-217f-4bc2-9896-72a1334a8e12@googlegroups.com>
	<507EAF6B.5080504@rabbitmq.com>
Message-ID: <507EB014.1070209@rabbitmq.com>

On 17/10/12 14:15, Simon MacMullen wrote:
> Messages can fly through the queue and never touch the backing queue
> if there is an autoack consumer ready to receive them.

...and if the queue is empty, of course!

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ward.mark at gmail.com  Wed Oct 17 14:38:15 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Wed, 17 Oct 2012 06:38:15 -0700 (PDT)
Subject: [rabbitmq-discuss] understanding the inet_dist_listen_min
	inet_dist_listen_max
Message-ID: <f263271a-bb71-499c-a0e5-56808c7415ad@googlegroups.com>

Hi,

To help networking manage firewalls the inet_dist_listen needs to be used 
in the RabbitMQ configuration.  I have not been able to find information on 
best practices with the min/max values.  Is it possible to use a single 
port range for the min/max or how much of a span should be provided for a 
RabbitMQ cluster?

-Mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/f6075669/attachment.htm>

From tim at rabbitmq.com  Wed Oct 17 14:32:33 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 17 Oct 2012 14:32:33 +0100
Subject: [rabbitmq-discuss] Use a mysql databse table as the provider
 for rabbitmq queue
In-Reply-To: <CAG=bwtOfCBi6zY0kHiHz90mHc1hmV7wJyWF6Up-9ZVXGH8E0qg@mail.gmail.com>
References: <c035a8fb-87fa-4a98-9f5c-137d85fcb6ec@googlegroups.com>
	<507E7F6B.8090003@rabbitmq.com>
	<CAG=bwtN0O+VnDiFDes1rsvFFiQzdczPyeeEUiRc21O1ksuWU_A@mail.gmail.com>
	<507E8664.9050609@rabbitmq.com>
	<CAG=bwtM4uPEw8JQ-9jTJPy0z=8xgVLDVxNo_Sdt1+xcOYBnMAA@mail.gmail.com>
	<507E9064.8090804@rabbitmq.com>
	<CAG=bwtOfCBi6zY0kHiHz90mHc1hmV7wJyWF6Up-9ZVXGH8E0qg@mail.gmail.com>
Message-ID: <507EB371.6060807@rabbitmq.com>

Hi Ryan,

On 10/17/2012 02:03 PM, Ryan R. wrote:
> Ok I've definitely got what you're trying to say concerning the use of 
> DBs and message broker.
>

Good, and your post has helped me to understand what you're doing more 
clearly, so this should get easier now.

> To explain a bit more, I'll answer the few questiosn you've scattered 
> across your reply :
>
> Is it a distributed architecture ?
>
> Definitely yes, each app will run on a different server
>

Ok, so that's more the classic integration architecture for sure.

> Why do I need to keep apps separate ?
>
> Simply because my project can be viewed as a application suite 
> composed of about 5 different apps. The end-user will be able to 
> choose which of the apps he wants and I want to only provide what is 
> absolutely necessary for the end-user based on what he asked for, 
> nothing more nothing less. Therefore if the end user only wants one 
> app out five I'm not going to provide him with a RabbitMQ, he will 
> have no use for it. However should he asked for a set of apps that 
> need to communicate, then I'll install a RabbitMQ to let them communicate.

Ok, well that is certainly do-able and I can understand the reasons why 
a particular customer site that doesn't need the middle-ware might as 
well skip it.

> Now like I said, I'm looking for a way to do this without changing 
> anything in the apps' code.
> What I'm looking for is a solution where I would have something like a 
> "watcher" external app that would keep an eye on what's going on in 
> each app and manage the content of each RabbitMQ queues accordingly.
>

Right, and in fact that's probably quite a common pattern in integration 
architectures. What I would ask is this: how are these applications 
supposed to know about the incoming data? And how, for that matter, is 
the data supposed to get into the queues in the first place?

Now, one solution to this is to do what you say and write a new 
application, a copy of which resides alongside each main app in the 
system and basically does two things:

1. periodically read data from the database for application 1 and write 
it to a queue
2. constantly (in a worker thread, or periodically in the main one) read 
data from a queue and write it to the application database

This is fine, in theory, as long as you bare in mind that what you're 
basically doing is making the overall system into a sort of 'shared 
database where tables are replicated/synchronised via queues'. Think 
about it a while and it's clear that, even if the tables being read from 
and/or written to are different, that basically you end up with the same 
thing. Then ask yourself if you'd design a distributed database that 
uses a messaging system as its replication back-bone.

Now I don't want to completely put you off that approach. It certainly 
has some things going for it: you do not need to change the application 
code anywhere, and if the application doesn't need the messaging system 
then you just avoid installing the 'watcher' process (and broker) in the 
first place. Job done!

There are things to consider with this approach though, which will 
re-enforce my point about it being like a distributed database that 
isn't. Consider some rhetorical questions about the systems that may or 
may not be communicating:

- do they rely on incoming information in order to do their job?
- does incoming information lead (causally) to more outgoing information?
- does outgoing information rely on future incoming information?
- and for any of the above, does the order in which information is 
handled ever matter?

If the answer to any of those questions is 'yes', then it might be worth 
reconsidering the use of a separate 'watcher'. All of those scenarios 
can lead to races, deadlocks and all manner of other problems usually 
associated with concurrent application development, because a 
distributed system that uses asynchronous message passing is 
*inherently* concurrent in nature and races/deadlocks/etc are all *much* 
harder to spot (and fix) when they're distributed!

> That peculiar aspect of the apps is for my longterm evolution of my 
> app : for my personal use, the simpler approach of the code for 
> pushing a mesage in the queues embedded in the app would be fine. But 
> since I'd like to make it evolve to something else, I'd rather think 
> ahead and try to do so right now.
>

Well, I'm unable to comment on the design choices for a technology I 
know nothing about, but I will offer this. If messaging is made into a 
specific (service) layer for an application, that application should 
usually be able to evolve without ever changing the messaging code. The 
event publication subsystem is, after all, a fairly static design point 
- you choose what to publish and when (which can, of course, be made 
configurable in any language/platform) and then just leave the 
publication code alone. The event listening subsystem is likewise fairly 
static. You start a worker thread (or external process) and register 
callbacks that get run when a message arrives. Just as with the 
publication subsystem, you can pass whatever callbacks you like and 
these can be chosen at build time *or* at runtime, possibly driven by 
configuration settings if that is required. Finally, the remaining 
problem is what to do when there *is no broker* because the application 
is standalone. I think this is fairly simple - just set a flag (or 
configuration value) when starting you application and let the event 
handling subsystems (both the listener and publisher) treat all function 
calls as a no-op when there is no broker to communicate with.

The great advantage of this approach, IMO, is precisely the one you seem 
to want - that the applications can be evolved over time to publish new 
data and/or respond to new (or existing) messages in varying ways. 
Providing you have the infrastructure to make decisions about what to do 
in callbacks based on configuration settings, you *might* even be able 
to add new behaviours to your applications without writing any code! ;)

But..... There is the up-front cost of embedding the messaging 
technology into your applications in the first place. Personally, I 
would not make that cost the primary driver behind the design decision 
though. In your shoes, I would consider carefully how the interactions 
between these applications work and understand the distribution and 
information sharing model they need to conform to first. Once that is 
clear, then you can decide whether or not the timing, ordering and/or 
existential questions about the system architecture as a whole really 
matter or not. If they don't, then you might as well choose the external 
'watcher' as this minimises the impact on your code base and simplifies 
your deployments. If, on the other hand, they do matter, then you should 
*very* carefully consider whether the decoupling that the 'watcher' 
offers is likely to be a hindrance or a help. If enough of those causal 
relationships in the information sharing model require coupling of some 
kind, then interacting directly with a messaging system (where you can 
choose whether or not you care about acknowledgements/receipts, 
batching, transactions/confirms, and other such features) might well 
prove to be architecturally important.

HTH and makes some degree of sense!

Cheers,
Tim

> Hope these explanations help a little more.
>
> Cheers,
> Ryan.
>
> 2012/10/17 Tim Watson <tim at rabbitmq.com <mailto:tim at rabbitmq.com>>
>
>     On 10/17/2012 11:40 AM, Ryan R. wrote:
>
>         I think I understand what you mean with the shared library.
>         However, in my case, RabbitMQ would only be installed if need
>         be (meaning more than one of the apps are present, and two of
>         those need to be synchronised for part of their data).
>
>
>     That actually complicates the picture somewhat - is there a reason
>     why this is the case? In a typical integration architecture, the
>     messaging broker is deployed centrally (on the LAN somewhere) and
>     clients choose whether or not they want to connect to it from
>     whatever machine they're running on. To me, it is sounding like
>     you're describing an architecture where both applications reside
>     on the same machine and assuming that the broker will also need to
>     be co-resident with them, which is not really the case, though
>     there's nothing to prohibit that either.
>
>
>         That said, using a shared library would require me to
>         "include/import" said library when I need to, therefore making
>         me change my app code depending of the situation I'm in.
>
>
>     Well yes, if you're going to add messaging capabilities to your
>     applications that don't currently support it, then you are going
>     to have to write *some* code and integrate it into them! :)
>
>
>         And said library would only be required when there's a
>         RabbitMQ available anyway.
>
>
>     I think you're making your life more complicated than it needs to
>     be by thinking about whether the messaging broker is available vs.
>     not. The broker should *always* be available when applications
>     residing on different machines need to communicate with one
>     another, regardless of whether those applications are running or
>     not. Again, it feels like you're trying to deal with applications
>     running on the same machine - have I picked that up correctly? It
>     might help if you explained your architecture in a bit more
>     detail, so I can understand exactly what you're trying to achieve.
>
>
>         Now a bit further in your message you talk about a listener
>         library.
>         I'd like to know a bit more about this.
>         How would an external library be able to listen to anything
>         happening within my app ?
>         Would it be listening on the DB queries ?
>
>
>     No, not at all. Let's say you've got two applications, App1 and
>     App2. You'll write some library code that both applications share,
>     that probably looks something like this (with *wide* variations
>     depending on language/platform - I've just written pseudo code to
>     keep things simple):
>
>     -------------------------------------
>
>     function init = do
>         read_config_file_for_this_app
>         open_connection_to_broker
>         store_connection_somewhere_in_memory
>     end
>
>     function listen = do
>         get_connection_from_memory
>         read_message_from_broker
>         pass_message_to_application_thread_somehow
>         listen
>     end
>
>     function publish = do
>         get_connection_from_memory
>         send_message_to_broker
>     end
>
>     -------------------------------------
>
>     Now in your applications, you'll call the shared 'init' library
>     function when you're starting up to bootstrap the connection to
>     the broker. When your application is publishing data, it calls
>     publish and if/when you need to subscribe to data then you'll call
>     'listen'. The fact is that 'how to listen' for incoming messages
>     really depends on how you're going to use them. But the point is
>     that the applications read from and write to the messaging broker,
>     and do so independently of database tables. You *may* decide to do
>     something like write a middle-man application that periodically
>     reads a database table and publishes each row to the messaging
>     broker so it can be read from a queue, or do that with a worker
>     thread instead of a separate application. I would *not* do
>     anything here with the database though. If applications need to
>     share data, then **they should send it to one another via message
>     queues.** If they need to persist data, they should persist their
>     own data in their own tables in the database, but they should
>     **not use the database to communicate with one another.** That is
>     the key thing with using messaging instead shared data(bases).
>
>     There is an overhead in sending (and in some cases, duplicating)
>     data between applications of course. This is *more* than
>     compensated for by the reduced coupling that comes from
>     integrating using messaging technology. This approach may not be
>     suited to integrating applications that are running on the same
>     physical machine and are tightly and deliberately coupled however.
>     I can't really elaborate on the suitability of messaging for your
>     project without understanding a good deal more about it I'm afraid.
>
>     I hope that clears a few things up at least! :)
>
>     Cheers,
>     Tim
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/79ed34af/attachment.htm>

From tim at rabbitmq.com  Wed Oct 17 14:43:25 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 17 Oct 2012 14:43:25 +0100
Subject: [rabbitmq-discuss] understanding the inet_dist_listen_min
	inet_dist_listen_max
In-Reply-To: <f263271a-bb71-499c-a0e5-56808c7415ad@googlegroups.com>
References: <f263271a-bb71-499c-a0e5-56808c7415ad@googlegroups.com>
Message-ID: <507EB5FD.6060705@rabbitmq.com>

Hi

On 10/17/2012 02:38 PM, Mark Ward wrote:
> Hi,
>
> To help networking manage firewalls the inet_dist_listen needs to be 
> used in the RabbitMQ configuration.  I have not been able to find 
> information on best practices with the min/max values.  Is it possible 
> to use a single port range for the min/max or how much of a span 
> should be provided for a RabbitMQ cluster?
>

The inet_dist settings you've mentioned are actually part of the Erlang 
distribution mechanism. When Erlang nodes want to talk to each other, 
they do so via the Erlang Port Mapper Daemon. If you want to limit the 
ports available then you can, but you will need a port available for 
each Erlang node in the distributed system. So don't limit the available 
ports to a value lower than the number of nodes that need to talk to 
each other!

HTH

From ward.mark at gmail.com  Wed Oct 17 15:06:25 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Wed, 17 Oct 2012 07:06:25 -0700 (PDT)
Subject: [rabbitmq-discuss] understanding the inet_dist_listen_min
	inet_dist_listen_max
In-Reply-To: <f263271a-bb71-499c-a0e5-56808c7415ad@googlegroups.com>
References: <f263271a-bb71-499c-a0e5-56808c7415ad@googlegroups.com>
Message-ID: <c71adfb9-388d-477d-8068-859d096dcd71@googlegroups.com>

I think I found a related thread

http://comments.gmane.org/gmane.comp.networking.rabbitmq.general/14867


On Wednesday, October 17, 2012 8:38:15 AM UTC-5, Mark Ward wrote:
>
> Hi,
>
> To help networking manage firewalls the inet_dist_listen needs to be used 
> in the RabbitMQ configuration.  I have not been able to find information on 
> best practices with the min/max values.  Is it possible to use a single 
> port range for the min/max or how much of a span should be provided for a 
> RabbitMQ cluster?
>
> -Mark
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/da11e5b5/attachment.htm>

From endy_tj at lycos.com  Wed Oct 17 13:41:44 2012
From: endy_tj at lycos.com (Endy Tjahjono)
Date: Wed, 17 Oct 2012 05:41:44 -0700 (PDT)
Subject: [rabbitmq-discuss] ERLANG_HOME not set correctly
Message-ID: <26985651-74af-4438-8afd-6fb926fc8a1e@googlegroups.com>

Hi,

I'm completely new to RabbitMQ, but I have read tutorial 1 - 6. I'm trying 
to install RabbitMQ on several windows servers, using rabbitmq-server-2.8.7 
and otp_win32_R15B02. Most installations work without errors, but on two 
servers, both Server 2003, after the installation is completed, when I 
tried to run rabbitmqctl.bat from folder "C:\Program Files\RabbitMQ 
Server\rabbitmq_server-2.8.7\sbin", I got an error:

    ******************************
    ERLANG_HOME not set correctly.
    ******************************

    Please either set ERLANG_HOME to point to your Erlang installation or 
place the
    RabbitMQ server distribution in the Erlang lib folder.

But ERLANG_HOME is already set to C:\Program Files\erl5.9.2. I have checked 
this through the SET command and through my computer - properties - 
advanced - environment variables.

I have also tried restarting the server. No changes.

What else should I check?

--
Endy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/c88d188c/attachment.htm>

From tim at rabbitmq.com  Wed Oct 17 15:13:30 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 17 Oct 2012 15:13:30 +0100
Subject: [rabbitmq-discuss] ERLANG_HOME not set correctly
In-Reply-To: <26985651-74af-4438-8afd-6fb926fc8a1e@googlegroups.com>
References: <26985651-74af-4438-8afd-6fb926fc8a1e@googlegroups.com>
Message-ID: <507EBD0A.9010603@rabbitmq.com>

Hi

On 10/17/2012 01:41 PM, Endy Tjahjono wrote:
> Hi,
>
> I'm completely new to RabbitMQ, but I have read tutorial 1 - 6. I'm 
> trying to install RabbitMQ on several windows servers, using 
> rabbitmq-server-2.8.7 and otp_win32_R15B02. Most installations work 
> without errors, but on two servers, both Server 2003, after the 
> installation is completed, when I tried to run rabbitmqctl.bat from 
> folder "C:\Program Files\RabbitMQ Server\rabbitmq_server-2.8.7\sbin", 
> I got an error:
>
>     ******************************
>     ERLANG_HOME not set correctly.
>     ******************************
>
>     Please either set ERLANG_HOME to point to your Erlang installation 
> or place the
>     RabbitMQ server distribution in the Erlang lib folder.
>
> But ERLANG_HOME is already set to C:\Program Files\erl5.9.2. I have 
> checked this through the SET command and through my computer - 
> properties - advanced - environment variables.
>
> I have also tried restarting the server. No changes.
>
> What else should I check?
>

Is the ERLANG_HOME environment variable set for *all* users or just for 
one account? It is possible that the user it is set for is not the user 
that broker is being run by. Try setting this as a system environment 
variable and see if that helps.

> --
> Endy
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/e9cff7bd/attachment.htm>

From simon at rabbitmq.com  Wed Oct 17 15:22:23 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Oct 2012 15:22:23 +0100
Subject: [rabbitmq-discuss] ERLANG_HOME not set correctly
In-Reply-To: <26985651-74af-4438-8afd-6fb926fc8a1e@googlegroups.com>
References: <26985651-74af-4438-8afd-6fb926fc8a1e@googlegroups.com>
Message-ID: <507EBF1F.7020205@rabbitmq.com>

Are these win64? Does C:\Program Files\erl5.9.2\bin not exist even after 
installing Erlang?

There is a bug in some versions of the 64 bit Erlang installer which 
does not install the MSVC runtime if it is not already installed, 
leading to a completely broken installation.

If this happened to you, please completely uninstall Erlang and 
RabbitMQ, then install the fixed Erlang from:

http://www.erlang.org/download/otp_win64_R15B02_with_MSVCR100_installer_fix.exe

then RabbitMQ.

Cheers, Simon

On 17/10/12 13:41, Endy Tjahjono wrote:
> Hi,
>
> I'm completely new to RabbitMQ, but I have read tutorial 1 - 6. I'm
> trying to install RabbitMQ on several windows servers, using
> rabbitmq-server-2.8.7 and otp_win32_R15B02. Most installations work
> without errors, but on two servers, both Server 2003, after the
> installation is completed, when I tried to run rabbitmqctl.bat from
> folder "C:\Program Files\RabbitMQ Server\rabbitmq_server-2.8.7\sbin", I
> got an error:
>
>      ******************************
>      ERLANG_HOME not set correctly.
>      ******************************
>
>      Please either set ERLANG_HOME to point to your Erlang installation
> or place the
>      RabbitMQ server distribution in the Erlang lib folder.
>
> But ERLANG_HOME is already set to C:\Program Files\erl5.9.2. I have
> checked this through the SET command and through my computer -
> properties - advanced - environment variables.
>
> I have also tried restarting the server. No changes.
>
> What else should I check?
>
> --
> Endy
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From charles at dyfis.net  Wed Oct 17 15:32:30 2012
From: charles at dyfis.net (Charles Duffy)
Date: Wed, 17 Oct 2012 09:32:30 -0500
Subject: [rabbitmq-discuss] Safely replaying archived messages from an
 external store
In-Reply-To: <507E84F4.1070905@rabbitmq.com>
References: <k5k2jp$3bk$1@ger.gmane.org>
	<507E84F4.1070905@rabbitmq.com>
Message-ID: <CAEHm_siDaCBSS-hr-C0fAPwo-gU1perJ9_WNWpFQN9weVShJmA@mail.gmail.com>

[Please pardon any duplicates -- cancelled an initial reply held for
moderation; sending this one as a subscriber].

On Wed, Oct 17, 2012 at 5:14 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> You are correct that AMQP timestamps have 1sec resolution, but nothing
> prevents publishers from adding a custom header with greater resolution.
>
> There is a potential for messages to arrive inbetween retrieving
> messages from the database and normally consuming messages from the
> broker. Make sure you don't leave the door open for race conditions.
>

Thank you for your response.

I was under the impression, in generating the initial proposal, that the
second-resolution timestamp was provided by the AMQP server, not the client
-- being client-provided, I can't trust it for the same reason that I can't
trust a milisecond-resolution timestamp in a client-provided header.
Consequently, it's back to the drawing board there.

My current approach assumes that delivery order will be consistent across
clients. This seems to be required by the section of the AMQP spec reading "The
server MUST deliver messages of the same priority in order irrespective of
their individual persistence"; if this is the case, I can pull the first
message off the queue, find it in the database (polling until it exists),
and use the database insert ordering (as recorded by an AUTO_INCREMENT key)
to manage replay.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/412042ba/attachment.htm>

From ward.mark at gmail.com  Wed Oct 17 16:53:13 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Wed, 17 Oct 2012 08:53:13 -0700 (PDT)
Subject: [rabbitmq-discuss] cluster buster
Message-ID: <b2d7eeda-b5cb-406a-abec-b03bf4e9a2e3@googlegroups.com>

Hello,
I am testing what happens to the cluster when nodes are shutdown.  The 
results of my testing have not been positive.  I hope to either be advised 
if I have a mistake in my cluster setup or if something is really going 
wrong.

The issue is when I shutdown a server using the Windows Services to stop a 
node the cluster does fail over the queue but does not continue delivering 
messages to the subscriber.  The subscriber also does not receive any 
errors.  The client's connection still has a running status but no data 
flows.  I am able to reproduce this error.

I have added two test run results to this email. I have more tests and the 
results saved if more information is required.  I can also rerun future 
tests.

I have the following puny virtual machines for my cluster.
3 Virtual Machines
? Windows 2008 R2 sp1 64-bit
? 1 GB of RAM
? 16 GB of drive space free
RabbitMQ: 2.8.7
Erlang: R15B02
RabbitMQ is setup as the following on each of the nodes:
[ {kernel, [{inet_dist_listen_min, 55021}, {inet_dist_listen_max, 55021} ] 
},
{rabbit, 
[{cluster_nodes, ['rabbit at RIOBARON-1', 'rabbit at RIOOVERLORD-1', 
'rabbit at CUST1-MASTER']}
,{vm_memory_high_watermark, 0.2}]
} 
].

Virtual Host: MoBunniesMoProblems
Queue: MoData: Mirror(all) and Durable
Admin is setup on all nodes.
Using the .NET client version: 2.8.7 (nuget download)
The publisher uses SelectConfirm with messages set to persistent.
The subscriber uses BasicConsume with BasicQos set depending on the test. 
(10, 1000, 5)
Message size has been 3,196 bytes
100,000 messages sent in each test.

---------------------------------------------------------------------------------------------
Test 01:
Assumptions: shutdown cluster node.  A new server will be master of the 
queue.  subscriber should continue to receive messages.  reconnection is 
possible and duplicate messages are possible.
Result: A node took ownership of the node's queue.  The subscriber failed 
to continue after the node was shutdown.  connection was never dropped.

Test Notes
Before testing make sure all servers in the cluster are active and see each 
other.  Admin confirmed this with all green for nodes.
Publish 100k messages 3,196 in size with no subscriber active.
When all messages have been published Turn on subscriber.
During subscriber's active download of the messages shut down the node that 
is the master of the queue.
Queue will fail over to the next oldest node.
Subscriber connection will not be inturrupted but will stop receiving data.

riobaron-1: the connection server.  The publisher will send to this server. 
 The subscriber will connect to this server.
riooverlord-1: MoData queue master.  queue was mirrored on riobaron-1 and 
cust1-master.  Stats server.
cust1-master: mirror: second oldest server in the cluster.  

During the publishing the high watermark for memory and drive space was 
never reached.

After riooverlord-1 was shutdown using Windows Service manager to shutdown 
the rabbitMQ service.  cust1-master was promoted as the MoData queue master.
Subscriber data send stopped but the connection was still active.  Timeout 
on the connection was set to 25 seconds.  The connection never timed out 
even after letting it sit for 24 hours.

Results of log files:
riobaron-1's log file
=INFO REPORT==== 16-Oct-2012::08:02:15 ===
rabbit on node 'rabbit at RIOOVERLORD-1' down


=ERROR REPORT==== 16-Oct-2012::08:02:15 ===
Mnesia('rabbit at RIOBARON-1'): ** ERROR ** mnesia_event got 
{inconsistent_database, bad_decision, 'rabbit at RIOOVERLORD-1'}

cust1-master's log file

=INFO REPORT==== 16-Oct-2012::08:02:18 ===
Statistics database started.


=INFO REPORT==== 16-Oct-2012::08:02:18 ===
Mirrored-queue (queue 'Q' in vhost '/'): Slave 
<'rabbit at CUST1-MASTER'.2.255.0> saw deaths of mirrors 
<'rabbit at RIOOVERLORD-1'.1.220.0> 


=INFO REPORT==== 16-Oct-2012::08:02:18 ===
Mirrored-queue (queue 'Q' in vhost '/'): Promoting slave 
<'rabbit at CUST1-MASTER'.2.255.0> to master


=INFO REPORT==== 16-Oct-2012::08:02:18 ===
rabbit on node 'rabbit at RIOOVERLORD-1' down


=INFO REPORT==== 16-Oct-2012::08:02:18 ===
Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Slave 
<'rabbit at CUST1-MASTER'.2.253.0> saw deaths of mirrors 
<'rabbit at RIOOVERLORD-1'.1.219.0> 


=INFO REPORT==== 16-Oct-2012::08:02:18 ===
Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Promoting 
slave <'rabbit at CUST1-MASTER'.2.253.0> to master


=ERROR REPORT==== 16-Oct-2012::08:02:18 ===
Mnesia('rabbit at CUST1-MASTER'): ** ERROR ** mnesia_event got 
{inconsistent_database, bad_decision, 'rabbit at RIOOVERLORD-1'}

riooverlord-1's log file

=INFO REPORT==== 16-Oct-2012::08:02:16 ===
Stopping Rabbit


=INFO REPORT==== 16-Oct-2012::08:02:16 ===
    application: rabbitmq_management
    exited: stopped
    type: permanent


=INFO REPORT==== 16-Oct-2012::08:02:16 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent


=INFO REPORT==== 16-Oct-2012::08:02:16 ===
stopped TCP Listener on 0.0.0.0:5672


=INFO REPORT==== 16-Oct-2012::08:02:16 ===
stopped TCP Listener on [::]:5672


=INFO REPORT==== 16-Oct-2012::08:02:16 ===
    application: rabbit
    exited: stopped
    type: permanent


=ERROR REPORT==== 16-Oct-2012::08:02:16 ===
Error in process <0.20312.2> on node 'rabbit at RIOOVERLORD-1' with exit 
value: 
{badarg,[{mnesia_tm,commit_participant,6,[{file,"mnesia_tm.erl"},{line,1750}]}]}



=INFO REPORT==== 16-Oct-2012::08:02:16 ===
    application: mnesia
    exited: stopped
    type: permanent


=INFO REPORT==== 16-Oct-2012::08:02:16 ===
    application: os_mon
    exited: stopped
    type: permanent


=INFO REPORT==== 16-Oct-2012::08:02:16 ===
Halting Erlang VM


---------------------------------------------------------------------------------------------
Test 02:
Assumption: send data into cluster. shutdown cluster master node of the 
queue.  subscriber should continue to receive messages.
Result: a new node promoted to master of the queue upon the shutdown. 
 subscriber did not receive data after the promotion.  connection was still 
running and no errors from the client.

Test Notes:
All nodes in the cluster were online and green.  The queue was mirrored on 
all nodes.
queue starts off with 0 messages in the queue.

riobaron-1: connection server.  publisher connected to this server. 
 subscriber connects to this server.  youngest server in the cluster
cust1-master: stats server and master of MoData queue.   oldest server
riooverlord: second oldest server.

After the publisher completed the subscriber was turned on.  During the 
subscribers connection and active data being received the riobaron-1 server 
was shutdown.  The subscriber reconnected to riooverlord-1.  Data resumed 
to send to the subscriber.  During the subscription the cust1-master node 
was shutdown.  Subscription stopped.  connection remained active and 
running.
rioverlord-1 become the new master of the MoData queue.

Waited on the cluster but the connection remained active but no data 
received from the cluster.  When the client is shutdown and makes a new 
connection sending will resume.

Results from log files:

riobaron-1: 
=INFO REPORT==== 17-Oct-2012::08:15:35 ===
rabbit on node 'rabbit at RIOOVERLORD-1' up


=INFO REPORT==== 17-Oct-2012::08:24:46 ===
Stopping Rabbit


=INFO REPORT==== 17-Oct-2012::08:24:46 ===
    application: rabbitmq_management
    exited: stopped
    type: permanent


=INFO REPORT==== 17-Oct-2012::08:24:46 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent


=INFO REPORT==== 17-Oct-2012::08:24:46 ===
stopped TCP Listener on 0.0.0.0:5672


=INFO REPORT==== 17-Oct-2012::08:24:46 ===
stopped TCP Listener on [::]:5672


=INFO REPORT==== 17-Oct-2012::08:24:46 ===
    application: rabbit
    exited: stopped
    type: permanent


=INFO REPORT==== 17-Oct-2012::08:24:46 ===
    application: mnesia
    exited: stopped
    type: permanent


=INFO REPORT==== 17-Oct-2012::08:24:46 ===
    application: os_mon
    exited: stopped
    type: permanent


=INFO REPORT==== 17-Oct-2012::08:24:46 ===
Halting Erlang VM

cust1-master:
=INFO REPORT==== 17-Oct-2012::08:15:12 ===
Statistics database started.


=INFO REPORT==== 17-Oct-2012::08:15:32 ===
rabbit on node 'rabbit at RIOBARON-1' up


=INFO REPORT==== 17-Oct-2012::08:15:38 ===
rabbit on node 'rabbit at RIOOVERLORD-1' up


=INFO REPORT==== 17-Oct-2012::08:16:03 ===
Adding mirror of queue 'MoData' in vhost 'MoBunnyMoProblems' on node 
'rabbit at RIOOVERLORD-1': <3151.343.0>


=INFO REPORT==== 17-Oct-2012::08:16:03 ===
Adding mirror of queue 'MoData' in vhost 'MoBunnyMoProblems' on node 
'rabbit at RIOBARON-1': <3150.354.0>


=INFO REPORT==== 17-Oct-2012::08:24:49 ===
rabbit on node 'rabbit at RIOBARON-1' down


=INFO REPORT==== 17-Oct-2012::08:27:11 ===
rabbit on node 'rabbit at RIOBARON-1' up


=INFO REPORT==== 17-Oct-2012::08:46:05 ===
rabbit on node 'rabbit at RIOBARON-1' down


=INFO REPORT==== 17-Oct-2012::08:46:44 ===
Stopping Rabbit


=INFO REPORT==== 17-Oct-2012::08:46:44 ===
    application: rabbitmq_management
    exited: stopped
    type: permanent


=INFO REPORT==== 17-Oct-2012::08:46:44 ===
    application: rabbitmq_management_agent
    exited: stopped
    type: permanent


=INFO REPORT==== 17-Oct-2012::08:46:44 ===
stopped TCP Listener on 0.0.0.0:5672


=INFO REPORT==== 17-Oct-2012::08:46:44 ===
stopped TCP Listener on [::]:5672


=INFO REPORT==== 17-Oct-2012::08:46:45 ===
    application: rabbit
    exited: stopped
    type: permanent


=INFO REPORT==== 17-Oct-2012::08:46:45 ===
    application: mnesia
    exited: stopped
    type: permanent


=INFO REPORT==== 17-Oct-2012::08:46:45 ===
    application: os_mon
    exited: stopped
    type: permanent


=INFO REPORT==== 17-Oct-2012::08:46:45 ===
Halting Erlang VM

riooverlord-1:

=INFO REPORT==== 17-Oct-2012::08:24:47 ===
rabbit on node 'rabbit at RIOBARON-1' down


=INFO REPORT==== 17-Oct-2012::08:24:47 ===
Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Slave 
<'rabbit at RIOOVERLORD-1'.3.343.0> saw deaths of mirrors 
<'rabbit at RIOBARON-1'.2.354.0> 


=INFO REPORT==== 17-Oct-2012::08:24:47 ===
Mirrored-queue (queue 'Q' in vhost '/'): Slave 
<'rabbit at RIOOVERLORD-1'.3.258.0> saw deaths of mirrors 
<'rabbit at RIOBARON-1'.2.252.0> 



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/59a63a76/attachment.htm>

From ward.mark at gmail.com  Wed Oct 17 17:04:34 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Wed, 17 Oct 2012 09:04:34 -0700 (PDT)
Subject: [rabbitmq-discuss] cluster buster
In-Reply-To: <b2d7eeda-b5cb-406a-abec-b03bf4e9a2e3@googlegroups.com>
References: <b2d7eeda-b5cb-406a-abec-b03bf4e9a2e3@googlegroups.com>
Message-ID: <27f0227e-5804-48cd-88b7-dc5e465bdbb4@googlegroups.com>

Tim's post to my earlier question about the inet_dist_listen setting might 
be impacting my testing as my cluster in the tests described were using a 
single port.  I have performed a test with 7 ports in the range and still 
received the same results. I am in the process of doing this test again 
with about 9 ports in the range.

the thread 
http://rabbitmq.1065348.n5.nabble.com/understanding-the-inet-dist-listen-min-inet-dist-listen-max-tc22644.html


On Wednesday, October 17, 2012 10:53:13 AM UTC-5, Mark Ward wrote:
>
> Hello,
> I am testing what happens to the cluster when nodes are shutdown.  The 
> results of my testing have not been positive.  I hope to either be advised 
> if I have a mistake in my cluster setup or if something is really going 
> wrong.
>
> The issue is when I shutdown a server using the Windows Services to stop a 
> node the cluster does fail over the queue but does not continue delivering 
> messages to the subscriber.  The subscriber also does not receive any 
> errors.  The client's connection still has a running status but no data 
> flows.  I am able to reproduce this error.
>
> I have added two test run results to this email. I have more tests and the 
> results saved if more information is required.  I can also rerun future 
> tests.
>
> I have the following puny virtual machines for my cluster.
> 3 Virtual Machines
> ? Windows 2008 R2 sp1 64-bit
> ? 1 GB of RAM
> ? 16 GB of drive space free
> RabbitMQ: 2.8.7
> Erlang: R15B02
> RabbitMQ is setup as the following on each of the nodes:
> [ {kernel, [{inet_dist_listen_min, 55021}, {inet_dist_listen_max, 55021} 
> ] },
> {rabbit, 
> [{cluster_nodes, ['rabbit at RIOBARON-1', 'rabbit at RIOOVERLORD-1', 
> 'rabbit at CUST1-MASTER']}
> ,{vm_memory_high_watermark, 0.2}]
> } 
> ].
>
> Virtual Host: MoBunniesMoProblems
> Queue: MoData: Mirror(all) and Durable
> Admin is setup on all nodes.
> Using the .NET client version: 2.8.7 (nuget download)
> The publisher uses SelectConfirm with messages set to persistent.
> The subscriber uses BasicConsume with BasicQos set depending on the test. 
> (10, 1000, 5)
> Message size has been 3,196 bytes
> 100,000 messages sent in each test.
>
>
> ---------------------------------------------------------------------------------------------
> Test 01:
> Assumptions: shutdown cluster node.  A new server will be master of the 
> queue.  subscriber should continue to receive messages.  reconnection is 
> possible and duplicate messages are possible.
> Result: A node took ownership of the node's queue.  The subscriber failed 
> to continue after the node was shutdown.  connection was never dropped.
>
> Test Notes
> Before testing make sure all servers in the cluster are active and see 
> each other.  Admin confirmed this with all green for nodes.
> Publish 100k messages 3,196 in size with no subscriber active.
> When all messages have been published Turn on subscriber.
> During subscriber's active download of the messages shut down the node 
> that is the master of the queue.
> Queue will fail over to the next oldest node.
> Subscriber connection will not be inturrupted but will stop receiving data.
>
> riobaron-1: the connection server.  The publisher will send to this 
> server.  The subscriber will connect to this server.
> riooverlord-1: MoData queue master.  queue was mirrored on riobaron-1 and 
> cust1-master.  Stats server.
> cust1-master: mirror: second oldest server in the cluster.  
>
> During the publishing the high watermark for memory and drive space was 
> never reached.
>
> After riooverlord-1 was shutdown using Windows Service manager to shutdown 
> the rabbitMQ service.  cust1-master was promoted as the MoData queue master.
> Subscriber data send stopped but the connection was still active.  Timeout 
> on the connection was set to 25 seconds.  The connection never timed out 
> even after letting it sit for 24 hours.
>
> Results of log files:
> riobaron-1's log file
> =INFO REPORT==== 16-Oct-2012::08:02:15 ===
> rabbit on node 'rabbit at RIOOVERLORD-1' down
>
>
> =ERROR REPORT==== 16-Oct-2012::08:02:15 ===
> Mnesia('rabbit at RIOBARON-1'): ** ERROR ** mnesia_event got 
> {inconsistent_database, bad_decision, 'rabbit at RIOOVERLORD-1'}
>
> cust1-master's log file
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Statistics database started.
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Mirrored-queue (queue 'Q' in vhost '/'): Slave 
> <'rabbit at CUST1-MASTER'.2.255.0> saw deaths of mirrors 
> <'rabbit at RIOOVERLORD-1'.1.220.0> 
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Mirrored-queue (queue 'Q' in vhost '/'): Promoting slave 
> <'rabbit at CUST1-MASTER'.2.255.0> to master
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> rabbit on node 'rabbit at RIOOVERLORD-1' down
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Slave 
> <'rabbit at CUST1-MASTER'.2.253.0> saw deaths of mirrors 
> <'rabbit at RIOOVERLORD-1'.1.219.0> 
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Promoting 
> slave <'rabbit at CUST1-MASTER'.2.253.0> to master
>
>
> =ERROR REPORT==== 16-Oct-2012::08:02:18 ===
> Mnesia('rabbit at CUST1-MASTER'): ** ERROR ** mnesia_event got 
> {inconsistent_database, bad_decision, 'rabbit at RIOOVERLORD-1'}
>
> riooverlord-1's log file
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
> Stopping Rabbit
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
> stopped TCP Listener on 0.0.0.0:5672
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
> stopped TCP Listener on [::]:5672
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: rabbit
>     exited: stopped
>     type: permanent
>
>
> =ERROR REPORT==== 16-Oct-2012::08:02:16 ===
> Error in process <0.20312.2> on node 'rabbit at RIOOVERLORD-1' with exit 
> value: 
> {badarg,[{mnesia_tm,commit_participant,6,[{file,"mnesia_tm.erl"},{line,1750}]}]}
>
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: mnesia
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: os_mon
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
> Halting Erlang VM
>
>
>
> ---------------------------------------------------------------------------------------------
> Test 02:
> Assumption: send data into cluster. shutdown cluster master node of the 
> queue.  subscriber should continue to receive messages.
> Result: a new node promoted to master of the queue upon the shutdown. 
>  subscriber did not receive data after the promotion.  connection was still 
> running and no errors from the client.
>
> Test Notes:
> All nodes in the cluster were online and green.  The queue was mirrored on 
> all nodes.
> queue starts off with 0 messages in the queue.
>
> riobaron-1: connection server.  publisher connected to this server. 
>  subscriber connects to this server.  youngest server in the cluster
> cust1-master: stats server and master of MoData queue.   oldest server
> riooverlord: second oldest server.
>
> After the publisher completed the subscriber was turned on.  During the 
> subscribers connection and active data being received the riobaron-1 server 
> was shutdown.  The subscriber reconnected to riooverlord-1.  Data resumed 
> to send to the subscriber.  During the subscription the cust1-master node 
> was shutdown.  Subscription stopped.  connection remained active and 
> running.
> rioverlord-1 become the new master of the MoData queue.
>
> Waited on the cluster but the connection remained active but no data 
> received from the cluster.  When the client is shutdown and makes a new 
> connection sending will resume.
>
> Results from log files:
>
> riobaron-1: 
> =INFO REPORT==== 17-Oct-2012::08:15:35 ===
> rabbit on node 'rabbit at RIOOVERLORD-1' up
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
> Stopping Rabbit
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
> stopped TCP Listener on 0.0.0.0:5672
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
> stopped TCP Listener on [::]:5672
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: rabbit
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: mnesia
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: os_mon
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
> Halting Erlang VM
>
> cust1-master:
> =INFO REPORT==== 17-Oct-2012::08:15:12 ===
> Statistics database started.
>
>
> =INFO REPORT==== 17-Oct-2012::08:15:32 ===
> rabbit on node 'rabbit at RIOBARON-1' up
>
>
> =INFO REPORT==== 17-Oct-2012::08:15:38 ===
> rabbit on node 'rabbit at RIOOVERLORD-1' up
>
>
> =INFO REPORT==== 17-Oct-2012::08:16:03 ===
> Adding mirror of queue 'MoData' in vhost 'MoBunnyMoProblems' on node 
> 'rabbit at RIOOVERLORD-1': <3151.343.0>
>
>
> =INFO REPORT==== 17-Oct-2012::08:16:03 ===
> Adding mirror of queue 'MoData' in vhost 'MoBunnyMoProblems' on node 
> 'rabbit at RIOBARON-1': <3150.354.0>
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:49 ===
> rabbit on node 'rabbit at RIOBARON-1' down
>
>
> =INFO REPORT==== 17-Oct-2012::08:27:11 ===
> rabbit on node 'rabbit at RIOBARON-1' up
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:05 ===
> rabbit on node 'rabbit at RIOBARON-1' down
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
> Stopping Rabbit
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
> stopped TCP Listener on 0.0.0.0:5672
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
> stopped TCP Listener on [::]:5672
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>     application: rabbit
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>     application: mnesia
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>     application: os_mon
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:45 ===
> Halting Erlang VM
>
> riooverlord-1:
>
> =INFO REPORT==== 17-Oct-2012::08:24:47 ===
> rabbit on node 'rabbit at RIOBARON-1' down
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:47 ===
> Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Slave 
> <'rabbit at RIOOVERLORD-1'.3.343.0> saw deaths of mirrors 
> <'rabbit at RIOBARON-1'.2.354.0> 
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:47 ===
> Mirrored-queue (queue 'Q' in vhost '/'): Slave 
> <'rabbit at RIOOVERLORD-1'.3.258.0> saw deaths of mirrors 
> <'rabbit at RIOBARON-1'.2.252.0> 
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/01848a6c/attachment.htm>

From simon at rabbitmq.com  Wed Oct 17 17:10:34 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Oct 2012 17:10:34 +0100
Subject: [rabbitmq-discuss] cluster buster
In-Reply-To: <b2d7eeda-b5cb-406a-abec-b03bf4e9a2e3@googlegroups.com>
References: <b2d7eeda-b5cb-406a-abec-b03bf4e9a2e3@googlegroups.com>
Message-ID: <507ED87A.5090404@rabbitmq.com>

On 17/10/12 16:53, Mark Ward wrote:
> The issue is when I shutdown a server using the Windows Services to stop
> a node the cluster does fail over the queue but does not continue
> delivering messages to the subscriber.  The subscriber also does not
> receive any errors.  The client's connection still has a running status
> but no data flows.  I am able to reproduce this error.

Have you read this:

http://www.rabbitmq.com/ha.html#behaviour

"Clients that were consuming from the mirrored-queue and support our 
Consumer Cancellation Notifications extension will receive a 
notification that their subscription to the mirrored-queue has been 
abruptly cancelled. At this point they should re-consume from the queue, 
which will pick up the new master. The reason for sending this 
notification is that informing clients of the loss of the master is 
essential: otherwise the client may continue to issue acknowledgements 
for messages they were sent by the old, failed master, and not expect 
that they might be about to see the same messages again, this time sent 
by the new master. Of course, clients that were connected to the failed 
node will find their connections failed, and will need to reconnect to a 
surviving node of the cluster."

?

If the consumer is connected to a node other than the one that failed, 
it will not be disconnected, but it will be sent a cancellation 
notification and will have to reissue basic.consume.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ward.mark at gmail.com  Wed Oct 17 17:27:06 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Wed, 17 Oct 2012 09:27:06 -0700 (PDT)
Subject: [rabbitmq-discuss] cluster buster
In-Reply-To: <b2d7eeda-b5cb-406a-abec-b03bf4e9a2e3@googlegroups.com>
References: <b2d7eeda-b5cb-406a-abec-b03bf4e9a2e3@googlegroups.com>
Message-ID: <e07354f5-6f24-4640-aad7-e46ee3156cd0@googlegroups.com>

Thanks Simon,

This is putting me on the right track to resolve this in my client.  I am 
using the .NET client and if I am understanding it correctly to handle the 
cancel extension I need to extend the QueueingBasicConsumer and override 
the OnCancel() method to provide my clients access to the cancel extension?

http://www.rabbitmq.com/consumer-cancel.html

http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.QueueingBasicConsumer.html

-Mark


-------------------------------------------
Oct 17, 2012; 11:10am   Simon MacMullen-2
On 17/10/12 16:53, Mark Ward wrote: 
> The issue is when I shutdown a server using the Windows Services to stop 
> a node the cluster does fail over the queue but does not continue 
> delivering messages to the subscriber.  The subscriber also does not 
> receive any errors.  The client's connection still has a running status 
> but no data flows.  I am able to reproduce this error. 

Have you read this: 

http://www.rabbitmq.com/ha.html#behaviour

"Clients that were consuming from the mirrored-queue and support our 
Consumer Cancellation Notifications extension will receive a 
notification that their subscription to the mirrored-queue has been 
abruptly cancelled. At this point they should re-consume from the queue, 
which will pick up the new master. The reason for sending this 
notification is that informing clients of the loss of the master is 
essential: otherwise the client may continue to issue acknowledgements 
for messages they were sent by the old, failed master, and not expect 
that they might be about to see the same messages again, this time sent 
by the new master. Of course, clients that were connected to the failed 
node will find their connections failed, and will need to reconnect to a 
surviving node of the cluster." 

? 

If the consumer is connected to a node other than the one that failed, 
it will not be disconnected, but it will be sent a cancellation 
notification and will have to reissue basic.consume. 

Cheers, Simon 

-- 
Simon MacMullen 
RabbitMQ, VMware 

On Wednesday, October 17, 2012 10:53:13 AM UTC-5, Mark Ward wrote:
>
> Hello,
> I am testing what happens to the cluster when nodes are shutdown.  The 
> results of my testing have not been positive.  I hope to either be advised 
> if I have a mistake in my cluster setup or if something is really going 
> wrong.
>
> The issue is when I shutdown a server using the Windows Services to stop a 
> node the cluster does fail over the queue but does not continue delivering 
> messages to the subscriber.  The subscriber also does not receive any 
> errors.  The client's connection still has a running status but no data 
> flows.  I am able to reproduce this error.
>
> I have added two test run results to this email. I have more tests and the 
> results saved if more information is required.  I can also rerun future 
> tests.
>
> I have the following puny virtual machines for my cluster.
> 3 Virtual Machines
> ? Windows 2008 R2 sp1 64-bit
> ? 1 GB of RAM
> ? 16 GB of drive space free
> RabbitMQ: 2.8.7
> Erlang: R15B02
> RabbitMQ is setup as the following on each of the nodes:
> [ {kernel, [{inet_dist_listen_min, 55021}, {inet_dist_listen_max, 55021} 
> ] },
> {rabbit, 
> [{cluster_nodes, ['rabbit at RIOBARON-1', 'rabbit at RIOOVERLORD-1', 
> 'rabbit at CUST1-MASTER']}
> ,{vm_memory_high_watermark, 0.2}]
> } 
> ].
>
> Virtual Host: MoBunniesMoProblems
> Queue: MoData: Mirror(all) and Durable
> Admin is setup on all nodes.
> Using the .NET client version: 2.8.7 (nuget download)
> The publisher uses SelectConfirm with messages set to persistent.
> The subscriber uses BasicConsume with BasicQos set depending on the test. 
> (10, 1000, 5)
> Message size has been 3,196 bytes
> 100,000 messages sent in each test.
>
>
> ---------------------------------------------------------------------------------------------
> Test 01:
> Assumptions: shutdown cluster node.  A new server will be master of the 
> queue.  subscriber should continue to receive messages.  reconnection is 
> possible and duplicate messages are possible.
> Result: A node took ownership of the node's queue.  The subscriber failed 
> to continue after the node was shutdown.  connection was never dropped.
>
> Test Notes
> Before testing make sure all servers in the cluster are active and see 
> each other.  Admin confirmed this with all green for nodes.
> Publish 100k messages 3,196 in size with no subscriber active.
> When all messages have been published Turn on subscriber.
> During subscriber's active download of the messages shut down the node 
> that is the master of the queue.
> Queue will fail over to the next oldest node.
> Subscriber connection will not be inturrupted but will stop receiving data.
>
> riobaron-1: the connection server.  The publisher will send to this 
> server.  The subscriber will connect to this server.
> riooverlord-1: MoData queue master.  queue was mirrored on riobaron-1 and 
> cust1-master.  Stats server.
> cust1-master: mirror: second oldest server in the cluster.  
>
> During the publishing the high watermark for memory and drive space was 
> never reached.
>
> After riooverlord-1 was shutdown using Windows Service manager to shutdown 
> the rabbitMQ service.  cust1-master was promoted as the MoData queue master.
> Subscriber data send stopped but the connection was still active.  Timeout 
> on the connection was set to 25 seconds.  The connection never timed out 
> even after letting it sit for 24 hours.
>
> Results of log files:
> riobaron-1's log file
> =INFO REPORT==== 16-Oct-2012::08:02:15 ===
> rabbit on node 'rabbit at RIOOVERLORD-1' down
>
>
> =ERROR REPORT==== 16-Oct-2012::08:02:15 ===
> Mnesia('rabbit at RIOBARON-1'): ** ERROR ** mnesia_event got 
> {inconsistent_database, bad_decision, 'rabbit at RIOOVERLORD-1'}
>
> cust1-master's log file
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Statistics database started.
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Mirrored-queue (queue 'Q' in vhost '/'): Slave 
> <'rabbit at CUST1-MASTER'.2.255.0> saw deaths of mirrors 
> <'rabbit at RIOOVERLORD-1'.1.220.0> 
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Mirrored-queue (queue 'Q' in vhost '/'): Promoting slave 
> <'rabbit at CUST1-MASTER'.2.255.0> to master
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> rabbit on node 'rabbit at RIOOVERLORD-1' down
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Slave 
> <'rabbit at CUST1-MASTER'.2.253.0> saw deaths of mirrors 
> <'rabbit at RIOOVERLORD-1'.1.219.0> 
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Promoting 
> slave <'rabbit at CUST1-MASTER'.2.253.0> to master
>
>
> =ERROR REPORT==== 16-Oct-2012::08:02:18 ===
> Mnesia('rabbit at CUST1-MASTER'): ** ERROR ** mnesia_event got 
> {inconsistent_database, bad_decision, 'rabbit at RIOOVERLORD-1'}
>
> riooverlord-1's log file
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
> Stopping Rabbit
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
> stopped TCP Listener on 0.0.0.0:5672
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
> stopped TCP Listener on [::]:5672
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: rabbit
>     exited: stopped
>     type: permanent
>
>
> =ERROR REPORT==== 16-Oct-2012::08:02:16 ===
> Error in process <0.20312.2> on node 'rabbit at RIOOVERLORD-1' with exit 
> value: 
> {badarg,[{mnesia_tm,commit_participant,6,[{file,"mnesia_tm.erl"},{line,1750}]}]}
>
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: mnesia
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: os_mon
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
> Halting Erlang VM
>
>
>
> ---------------------------------------------------------------------------------------------
> Test 02:
> Assumption: send data into cluster. shutdown cluster master node of the 
> queue.  subscriber should continue to receive messages.
> Result: a new node promoted to master of the queue upon the shutdown. 
>  subscriber did not receive data after the promotion.  connection was still 
> running and no errors from the client.
>
> Test Notes:
> All nodes in the cluster were online and green.  The queue was mirrored on 
> all nodes.
> queue starts off with 0 messages in the queue.
>
> riobaron-1: connection server.  publisher connected to this server. 
>  subscriber connects to this server.  youngest server in the cluster
> cust1-master: stats server and master of MoData queue.   oldest server
> riooverlord: second oldest server.
>
> After the publisher completed the subscriber was turned on.  During the 
> subscribers connection and active data being received the riobaron-1 server 
> was shutdown.  The subscriber reconnected to riooverlord-1.  Data resumed 
> to send to the subscriber.  During the subscription the cust1-master node 
> was shutdown.  Subscription stopped.  connection remained active and 
> running.
> rioverlord-1 become the new master of the MoData queue.
>
> Waited on the cluster but the connection remained active but no data 
> received from the cluster.  When the client is shutdown and makes a new 
> connection sending will resume.
>
> Results from log files:
>
> riobaron-1: 
> =INFO REPORT==== 17-Oct-2012::08:15:35 ===
> rabbit on node 'rabbit at RIOOVERLORD-1' up
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
> Stopping Rabbit
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
> stopped TCP Listener on 0.0.0.0:5672
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
> stopped TCP Listener on [::]:5672
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: rabbit
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: mnesia
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: os_mon
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
> Halting Erlang VM
>
> cust1-master:
> =INFO REPORT==== 17-Oct-2012::08:15:12 ===
> Statistics database started.
>
>
> =INFO REPORT==== 17-Oct-2012::08:15:32 ===
> rabbit on node 'rabbit at RIOBARON-1' up
>
>
> =INFO REPORT==== 17-Oct-2012::08:15:38 ===
> rabbit on node 'rabbit at RIOOVERLORD-1' up
>
>
> =INFO REPORT==== 17-Oct-2012::08:16:03 ===
> Adding mirror of queue 'MoData' in vhost 'MoBunnyMoProblems' on node 
> 'rabbit at RIOOVERLORD-1': <3151.343.0>
>
>
> =INFO REPORT==== 17-Oct-2012::08:16:03 ===
> Adding mirror of queue 'MoData' in vhost 'MoBunnyMoProblems' on node 
> 'rabbit at RIOBARON-1': <3150.354.0>
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:49 ===
> rabbit on node 'rabbit at RIOBARON-1' down
>
>
> =INFO REPORT==== 17-Oct-2012::08:27:11 ===
> rabbit on node 'rabbit at RIOBARON-1' up
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:05 ===
> rabbit on node 'rabbit at RIOBARON-1' down
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
> Stopping Rabbit
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
> stopped TCP Listener on 0.0.0.0:5672
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
> stopped TCP Listener on [::]:5672
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>     application: rabbit
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>     application: mnesia
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>     application: os_mon
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:45 ===
> Halting Erlang VM
>
> riooverlord-1:
>
> =INFO REPORT==== 17-Oct-2012::08:24:47 ===
> rabbit on node 'rabbit at RIOBARON-1' down
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:47 ===
> Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Slave 
> <'rabbit at RIOOVERLORD-1'.3.343.0> saw deaths of mirrors 
> <'rabbit at RIOBARON-1'.2.354.0> 
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:47 ===
> Mirrored-queue (queue 'Q' in vhost '/'): Slave 
> <'rabbit at RIOOVERLORD-1'.3.258.0> saw deaths of mirrors 
> <'rabbit at RIOBARON-1'.2.252.0> 
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/3c074348/attachment.htm>

From simon at rabbitmq.com  Wed Oct 17 17:39:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 17 Oct 2012 17:39:04 +0100
Subject: [rabbitmq-discuss] cluster buster
In-Reply-To: <e07354f5-6f24-4640-aad7-e46ee3156cd0@googlegroups.com>
References: <b2d7eeda-b5cb-406a-abec-b03bf4e9a2e3@googlegroups.com>
	<e07354f5-6f24-4640-aad7-e46ee3156cd0@googlegroups.com>
Message-ID: <507EDF28.5080305@rabbitmq.com>

The method QueueingBasicConsumer.OnCancel() gets invoked whenever your 
consumer gets cancelled for *any* reason - including if you asked for it 
via BasicCancel(), or if the connection was closed.

Instead you probably want to override HandleBasicCancel(string) (which 
by default invokes OnCancel()). HandleBasicCancel(string) is only 
invoked in the case where the server caused the cancellation - either 
because the queue failed over, or it was deleted.

Cheers, Simon

On 17/10/12 17:27, Mark Ward wrote:
> Thanks Simon,
>
> This is putting me on the right track to resolve this in my client.  I
> am using the .NET client and if I am understanding it correctly to
> handle the cancel extension I need to extend the QueueingBasicConsumer
> and override the OnCancel() method to provide my clients access to the
> cancel extension?
>
> http://www.rabbitmq.com/consumer-cancel.html
>
> http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-net-2.0-htmldoc/type-RabbitMQ.Client.QueueingBasicConsumer.html
>
> -Mark
>
>
> -------------------------------------------
> Oct 17, 2012; 11:10am   Simon MacMullen-2
> On 17/10/12 16:53, Mark Ward wrote:
>  > The issue is when I shutdown a server using the Windows Services to stop
>  > a node the cluster does fail over the queue but does not continue
>  > delivering messages to the subscriber.  The subscriber also does not
>  > receive any errors.  The client's connection still has a running status
>  > but no data flows.  I am able to reproduce this error.
>
> Have you read this:
>
> http://www.rabbitmq.com/ha.html#behaviour
>
> "Clients that were consuming from the mirrored-queue and support our
> Consumer Cancellation Notifications extension will receive a
> notification that their subscription to the mirrored-queue has been
> abruptly cancelled. At this point they should re-consume from the queue,
> which will pick up the new master. The reason for sending this
> notification is that informing clients of the loss of the master is
> essential: otherwise the client may continue to issue acknowledgements
> for messages they were sent by the old, failed master, and not expect
> that they might be about to see the same messages again, this time sent
> by the new master. Of course, clients that were connected to the failed
> node will find their connections failed, and will need to reconnect to a
> surviving node of the cluster."
>
> ?
>
> If the consumer is connected to a node other than the one that failed,
> it will not be disconnected, but it will be sent a cancellation
> notification and will have to reissue basic.consume.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
> On Wednesday, October 17, 2012 10:53:13 AM UTC-5, Mark Ward wrote:
>
>     Hello,
>     I am testing what happens to the cluster when nodes are shutdown.
>       The results of my testing have not been positive.  I hope to
>     either be advised if I have a mistake in my cluster setup or if
>     something is really going wrong.
>
>     The issue is when I shutdown a server using the Windows Services to
>     stop a node the cluster does fail over the queue but does not
>     continue delivering messages to the subscriber.  The subscriber also
>     does not receive any errors.  The client's connection still has a
>     running status but no data flows.  I am able to reproduce this error.
>
>     I have added two test run results to this email. I have more tests
>     and the results saved if more information is required.  I can also
>     rerun future tests.
>
>     I have the following puny virtual machines for my cluster.
>     3 Virtual Machines
>     ?Windows 2008 R2 sp1 64-bit
>     ?1 GB of RAM
>     ?16 GB of drive space free
>     RabbitMQ: 2.8.7
>     Erlang: R15B02
>     RabbitMQ is setup as the following on each of the nodes:
>     [{kernel, [{inet_dist_listen_min, 55021}, {inet_dist_listen_max,
>     55021} ] },
>     {rabbit,
>     [{cluster_nodes, ['rabbit at RIOBARON-1', 'rabbit at RIOOVERLORD-1',
>     'rabbit at CUST1-MASTER']}
>     ,{vm_memory_high_watermark, 0.2}]
>     }
>     ].
>
>     Virtual Host: MoBunniesMoProblems
>     Queue: MoData: Mirror(all) and Durable
>     Admin is setup on all nodes.
>     Using the .NET client version: 2.8.7 (nuget download)
>     The publisher uses SelectConfirm with messages set to persistent.
>     The subscriber uses BasicConsume with BasicQos set depending on the
>     test. (10, 1000, 5)
>     Message size has been 3,196 bytes
>     100,000 messages sent in each test.
>
>     ---------------------------------------------------------------------------------------------
>     Test 01:
>     Assumptions: shutdown cluster node.  A new server will be master of
>     the queue.  subscriber should continue to receive messages.
>       reconnection is possible and duplicate messages are possible.
>     Result: A node took ownership of the node's queue.  The subscriber
>     failed to continue after the node was shutdown.  connection was
>     never dropped.
>
>     Test Notes
>     Before testing make sure all servers in the cluster are active and
>     see each other.  Admin confirmed this with all green for nodes.
>     Publish 100k messages 3,196 in size with no subscriber active.
>     When all messages have been published Turn on subscriber.
>     During subscriber's active download of the messages shut down the
>     node that is the master of the queue.
>     Queue will fail over to the next oldest node.
>     Subscriber connection will not be inturrupted but will stop
>     receiving data.
>
>     riobaron-1: the connection server.  The publisher will send to this
>     server.  The subscriber will connect to this server.
>     riooverlord-1: MoData queue master.  queue was mirrored on
>     riobaron-1 and cust1-master.  Stats server.
>     cust1-master: mirror: second oldest server in the cluster.
>
>     During the publishing the high watermark for memory and drive space
>     was never reached.
>
>     After riooverlord-1 was shutdown using Windows Service manager to
>     shutdown the rabbitMQ service.  cust1-master was promoted as the
>     MoData queue master.
>     Subscriber data send stopped but the connection was still active.
>       Timeout on the connection was set to 25 seconds.  The connection
>     never timed out even after letting it sit for 24 hours.
>
>     Results of log files:
>     riobaron-1's log file
>     =INFO REPORT==== 16-Oct-2012::08:02:15 ===
>     rabbit on node 'rabbit at RIOOVERLORD-1' down
>
>
>     =ERROR REPORT==== 16-Oct-2012::08:02:15 ===
>     Mnesia('rabbit at RIOBARON-1'): ** ERROR ** mnesia_event got
>     {inconsistent_database, bad_decision, 'rabbit at RIOOVERLORD-1'}
>
>     cust1-master's log file
>
>     =INFO REPORT==== 16-Oct-2012::08:02:18 ===
>     Statistics database started.
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:18 ===
>     Mirrored-queue (queue 'Q' in vhost '/'): Slave
>     <'rabbit at CUST1-MASTER'.2.255.0> saw deaths of mirrors
>     <'rabbit at RIOOVERLORD-1'.1.220.0>
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:18 ===
>     Mirrored-queue (queue 'Q' in vhost '/'): Promoting slave
>     <'rabbit at CUST1-MASTER'.2.255.0> to master
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:18 ===
>     rabbit on node 'rabbit at RIOOVERLORD-1' down
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:18 ===
>     Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Slave
>     <'rabbit at CUST1-MASTER'.2.253.0> saw deaths of mirrors
>     <'rabbit at RIOOVERLORD-1'.1.219.0>
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:18 ===
>     Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'):
>     Promoting slave <'rabbit at CUST1-MASTER'.2.253.0> to master
>
>
>     =ERROR REPORT==== 16-Oct-2012::08:02:18 ===
>     Mnesia('rabbit at CUST1-MASTER'): ** ERROR ** mnesia_event got
>     {inconsistent_database, bad_decision, 'rabbit at RIOOVERLORD-1'}
>
>     riooverlord-1's log file
>
>     =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     Stopping Rabbit
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>          application: rabbitmq_management
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>          application: rabbitmq_management_agent
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     stopped TCP Listener on 0.0.0.0:5672 <http://0.0.0.0:5672>
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     stopped TCP Listener on [::]:5672
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>          application: rabbit
>          exited: stopped
>          type: permanent
>
>
>     =ERROR REPORT==== 16-Oct-2012::08:02:16 ===
>     Error in process <0.20312.2> on node 'rabbit at RIOOVERLORD-1' with
>     exit value:
>     {badarg,[{mnesia_tm,commit_participant,6,[{file,"mnesia_tm.erl"},{line,1750}]}]}
>
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>          application: mnesia
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>          application: os_mon
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     Halting Erlang VM
>
>
>     ---------------------------------------------------------------------------------------------
>     Test 02:
>     Assumption: send data into cluster. shutdown cluster master node of
>     the queue.  subscriber should continue to receive messages.
>     Result: a new node promoted to master of the queue upon the
>     shutdown.  subscriber did not receive data after the promotion.
>       connection was still running and no errors from the client.
>
>     Test Notes:
>     All nodes in the cluster were online and green.  The queue was
>     mirrored on all nodes.
>     queue starts off with 0 messages in the queue.
>
>     riobaron-1: connection server.  publisher connected to this server.
>       subscriber connects to this server.  youngest server in the cluster
>     cust1-master: stats server and master of MoData queue.   oldest server
>     riooverlord: second oldest server.
>
>     After the publisher completed the subscriber was turned on.  During
>     the subscribers connection and active data being received the
>     riobaron-1 server was shutdown.  The subscriber reconnected to
>     riooverlord-1.  Data resumed to send to the subscriber.  During the
>     subscription the cust1-master node was shutdown.  Subscription
>     stopped.  connection remained active and running.
>     rioverlord-1 become the new master of the MoData queue.
>
>     Waited on the cluster but the connection remained active but no data
>     received from the cluster.  When the client is shutdown and makes a
>     new connection sending will resume.
>
>     Results from log files:
>
>     riobaron-1:
>     =INFO REPORT==== 17-Oct-2012::08:15:35 ===
>     rabbit on node 'rabbit at RIOOVERLORD-1' up
>
>
>     =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     Stopping Rabbit
>
>
>     =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>          application: rabbitmq_management
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>          application: rabbitmq_management_agent
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     stopped TCP Listener on 0.0.0.0:5672 <http://0.0.0.0:5672>
>
>
>     =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     stopped TCP Listener on [::]:5672
>
>
>     =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>          application: rabbit
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>          application: mnesia
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>          application: os_mon
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     Halting Erlang VM
>
>     cust1-master:
>     =INFO REPORT==== 17-Oct-2012::08:15:12 ===
>     Statistics database started.
>
>
>     =INFO REPORT==== 17-Oct-2012::08:15:32 ===
>     rabbit on node 'rabbit at RIOBARON-1' up
>
>
>     =INFO REPORT==== 17-Oct-2012::08:15:38 ===
>     rabbit on node 'rabbit at RIOOVERLORD-1' up
>
>
>     =INFO REPORT==== 17-Oct-2012::08:16:03 ===
>     Adding mirror of queue 'MoData' in vhost 'MoBunnyMoProblems' on node
>     'rabbit at RIOOVERLORD-1': <3151.343.0>
>
>
>     =INFO REPORT==== 17-Oct-2012::08:16:03 ===
>     Adding mirror of queue 'MoData' in vhost 'MoBunnyMoProblems' on node
>     'rabbit at RIOBARON-1': <3150.354.0>
>
>
>     =INFO REPORT==== 17-Oct-2012::08:24:49 ===
>     rabbit on node 'rabbit at RIOBARON-1' down
>
>
>     =INFO REPORT==== 17-Oct-2012::08:27:11 ===
>     rabbit on node 'rabbit at RIOBARON-1' up
>
>
>     =INFO REPORT==== 17-Oct-2012::08:46:05 ===
>     rabbit on node 'rabbit at RIOBARON-1' down
>
>
>     =INFO REPORT==== 17-Oct-2012::08:46:44 ===
>     Stopping Rabbit
>
>
>     =INFO REPORT==== 17-Oct-2012::08:46:44 ===
>          application: rabbitmq_management
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 17-Oct-2012::08:46:44 ===
>          application: rabbitmq_management_agent
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 17-Oct-2012::08:46:44 ===
>     stopped TCP Listener on 0.0.0.0:5672 <http://0.0.0.0:5672>
>
>
>     =INFO REPORT==== 17-Oct-2012::08:46:44 ===
>     stopped TCP Listener on [::]:5672
>
>
>     =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>          application: rabbit
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>          application: mnesia
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>          application: os_mon
>          exited: stopped
>          type: permanent
>
>
>     =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>     Halting Erlang VM
>
>     riooverlord-1:
>
>     =INFO REPORT==== 17-Oct-2012::08:24:47 ===
>     rabbit on node 'rabbit at RIOBARON-1' down
>
>
>     =INFO REPORT==== 17-Oct-2012::08:24:47 ===
>     Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Slave
>     <'rabbit at RIOOVERLORD-1'.3.343.0> saw deaths of mirrors
>     <'rabbit at RIOBARON-1'.2.354.0>
>
>
>     =INFO REPORT==== 17-Oct-2012::08:24:47 ===
>     Mirrored-queue (queue 'Q' in vhost '/'): Slave
>     <'rabbit at RIOOVERLORD-1'.3.258.0> saw deaths of mirrors
>     <'rabbit at RIOBARON-1'.2.252.0>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From ward.mark at gmail.com  Wed Oct 17 18:01:06 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Wed, 17 Oct 2012 10:01:06 -0700 (PDT)
Subject: [rabbitmq-discuss] cluster buster
In-Reply-To: <b2d7eeda-b5cb-406a-abec-b03bf4e9a2e3@googlegroups.com>
References: <b2d7eeda-b5cb-406a-abec-b03bf4e9a2e3@googlegroups.com>
Message-ID: <751badee-708b-42e5-8916-cd45f377b710@googlegroups.com>

Simon,

This was exactly what I needed.  I have tested my client and I was able to 
reconnect on the fault and resume subscription.

-Mark
 
-------------------------------------------------------------
Oct 17, 2012; 11:39am   Simon MacMullen-2
The method QueueingBasicConsumer.OnCancel() gets invoked whenever your 
consumer gets cancelled for *any* reason - including if you asked for it 
via BasicCancel(), or if the connection was closed. 

Instead you probably want to override HandleBasicCancel(string) (which 
by default invokes OnCancel()). HandleBasicCancel(string) is only 
invoked in the case where the server caused the cancellation - either 
because the queue failed over, or it was deleted. 

Cheers, Simon 
---------------------------------------

On Wednesday, October 17, 2012 10:53:13 AM UTC-5, Mark Ward wrote:
>
> Hello,
> I am testing what happens to the cluster when nodes are shutdown.  The 
> results of my testing have not been positive.  I hope to either be advised 
> if I have a mistake in my cluster setup or if something is really going 
> wrong.
>
> The issue is when I shutdown a server using the Windows Services to stop a 
> node the cluster does fail over the queue but does not continue delivering 
> messages to the subscriber.  The subscriber also does not receive any 
> errors.  The client's connection still has a running status but no data 
> flows.  I am able to reproduce this error.
>
> I have added two test run results to this email. I have more tests and the 
> results saved if more information is required.  I can also rerun future 
> tests.
>
> I have the following puny virtual machines for my cluster.
> 3 Virtual Machines
> ? Windows 2008 R2 sp1 64-bit
> ? 1 GB of RAM
> ? 16 GB of drive space free
> RabbitMQ: 2.8.7
> Erlang: R15B02
> RabbitMQ is setup as the following on each of the nodes:
> [ {kernel, [{inet_dist_listen_min, 55021}, {inet_dist_listen_max, 55021} 
> ] },
> {rabbit, 
> [{cluster_nodes, ['rabbit at RIOBARON-1', 'rabbit at RIOOVERLORD-1', 
> 'rabbit at CUST1-MASTER']}
> ,{vm_memory_high_watermark, 0.2}]
> } 
> ].
>
> Virtual Host: MoBunniesMoProblems
> Queue: MoData: Mirror(all) and Durable
> Admin is setup on all nodes.
> Using the .NET client version: 2.8.7 (nuget download)
> The publisher uses SelectConfirm with messages set to persistent.
> The subscriber uses BasicConsume with BasicQos set depending on the test. 
> (10, 1000, 5)
> Message size has been 3,196 bytes
> 100,000 messages sent in each test.
>
>
> ---------------------------------------------------------------------------------------------
> Test 01:
> Assumptions: shutdown cluster node.  A new server will be master of the 
> queue.  subscriber should continue to receive messages.  reconnection is 
> possible and duplicate messages are possible.
> Result: A node took ownership of the node's queue.  The subscriber failed 
> to continue after the node was shutdown.  connection was never dropped.
>
> Test Notes
> Before testing make sure all servers in the cluster are active and see 
> each other.  Admin confirmed this with all green for nodes.
> Publish 100k messages 3,196 in size with no subscriber active.
> When all messages have been published Turn on subscriber.
> During subscriber's active download of the messages shut down the node 
> that is the master of the queue.
> Queue will fail over to the next oldest node.
> Subscriber connection will not be inturrupted but will stop receiving data.
>
> riobaron-1: the connection server.  The publisher will send to this 
> server.  The subscriber will connect to this server.
> riooverlord-1: MoData queue master.  queue was mirrored on riobaron-1 and 
> cust1-master.  Stats server.
> cust1-master: mirror: second oldest server in the cluster.  
>
> During the publishing the high watermark for memory and drive space was 
> never reached.
>
> After riooverlord-1 was shutdown using Windows Service manager to shutdown 
> the rabbitMQ service.  cust1-master was promoted as the MoData queue master.
> Subscriber data send stopped but the connection was still active.  Timeout 
> on the connection was set to 25 seconds.  The connection never timed out 
> even after letting it sit for 24 hours.
>
> Results of log files:
> riobaron-1's log file
> =INFO REPORT==== 16-Oct-2012::08:02:15 ===
> rabbit on node 'rabbit at RIOOVERLORD-1' down
>
>
> =ERROR REPORT==== 16-Oct-2012::08:02:15 ===
> Mnesia('rabbit at RIOBARON-1'): ** ERROR ** mnesia_event got 
> {inconsistent_database, bad_decision, 'rabbit at RIOOVERLORD-1'}
>
> cust1-master's log file
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Statistics database started.
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Mirrored-queue (queue 'Q' in vhost '/'): Slave 
> <'rabbit at CUST1-MASTER'.2.255.0> saw deaths of mirrors 
> <'rabbit at RIOOVERLORD-1'.1.220.0> 
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Mirrored-queue (queue 'Q' in vhost '/'): Promoting slave 
> <'rabbit at CUST1-MASTER'.2.255.0> to master
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> rabbit on node 'rabbit at RIOOVERLORD-1' down
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Slave 
> <'rabbit at CUST1-MASTER'.2.253.0> saw deaths of mirrors 
> <'rabbit at RIOOVERLORD-1'.1.219.0> 
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:18 ===
> Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Promoting 
> slave <'rabbit at CUST1-MASTER'.2.253.0> to master
>
>
> =ERROR REPORT==== 16-Oct-2012::08:02:18 ===
> Mnesia('rabbit at CUST1-MASTER'): ** ERROR ** mnesia_event got 
> {inconsistent_database, bad_decision, 'rabbit at RIOOVERLORD-1'}
>
> riooverlord-1's log file
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
> Stopping Rabbit
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
> stopped TCP Listener on 0.0.0.0:5672
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
> stopped TCP Listener on [::]:5672
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: rabbit
>     exited: stopped
>     type: permanent
>
>
> =ERROR REPORT==== 16-Oct-2012::08:02:16 ===
> Error in process <0.20312.2> on node 'rabbit at RIOOVERLORD-1' with exit 
> value: 
> {badarg,[{mnesia_tm,commit_participant,6,[{file,"mnesia_tm.erl"},{line,1750}]}]}
>
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: mnesia
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
>     application: os_mon
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 16-Oct-2012::08:02:16 ===
> Halting Erlang VM
>
>
>
> ---------------------------------------------------------------------------------------------
> Test 02:
> Assumption: send data into cluster. shutdown cluster master node of the 
> queue.  subscriber should continue to receive messages.
> Result: a new node promoted to master of the queue upon the shutdown. 
>  subscriber did not receive data after the promotion.  connection was still 
> running and no errors from the client.
>
> Test Notes:
> All nodes in the cluster were online and green.  The queue was mirrored on 
> all nodes.
> queue starts off with 0 messages in the queue.
>
> riobaron-1: connection server.  publisher connected to this server. 
>  subscriber connects to this server.  youngest server in the cluster
> cust1-master: stats server and master of MoData queue.   oldest server
> riooverlord: second oldest server.
>
> After the publisher completed the subscriber was turned on.  During the 
> subscribers connection and active data being received the riobaron-1 server 
> was shutdown.  The subscriber reconnected to riooverlord-1.  Data resumed 
> to send to the subscriber.  During the subscription the cust1-master node 
> was shutdown.  Subscription stopped.  connection remained active and 
> running.
> rioverlord-1 become the new master of the MoData queue.
>
> Waited on the cluster but the connection remained active but no data 
> received from the cluster.  When the client is shutdown and makes a new 
> connection sending will resume.
>
> Results from log files:
>
> riobaron-1: 
> =INFO REPORT==== 17-Oct-2012::08:15:35 ===
> rabbit on node 'rabbit at RIOOVERLORD-1' up
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
> Stopping Rabbit
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
> stopped TCP Listener on 0.0.0.0:5672
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
> stopped TCP Listener on [::]:5672
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: rabbit
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: mnesia
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
>     application: os_mon
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:46 ===
> Halting Erlang VM
>
> cust1-master:
> =INFO REPORT==== 17-Oct-2012::08:15:12 ===
> Statistics database started.
>
>
> =INFO REPORT==== 17-Oct-2012::08:15:32 ===
> rabbit on node 'rabbit at RIOBARON-1' up
>
>
> =INFO REPORT==== 17-Oct-2012::08:15:38 ===
> rabbit on node 'rabbit at RIOOVERLORD-1' up
>
>
> =INFO REPORT==== 17-Oct-2012::08:16:03 ===
> Adding mirror of queue 'MoData' in vhost 'MoBunnyMoProblems' on node 
> 'rabbit at RIOOVERLORD-1': <3151.343.0>
>
>
> =INFO REPORT==== 17-Oct-2012::08:16:03 ===
> Adding mirror of queue 'MoData' in vhost 'MoBunnyMoProblems' on node 
> 'rabbit at RIOBARON-1': <3150.354.0>
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:49 ===
> rabbit on node 'rabbit at RIOBARON-1' down
>
>
> =INFO REPORT==== 17-Oct-2012::08:27:11 ===
> rabbit on node 'rabbit at RIOBARON-1' up
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:05 ===
> rabbit on node 'rabbit at RIOBARON-1' down
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
> Stopping Rabbit
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
>     application: rabbitmq_management
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
>     application: rabbitmq_management_agent
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
> stopped TCP Listener on 0.0.0.0:5672
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:44 ===
> stopped TCP Listener on [::]:5672
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>     application: rabbit
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>     application: mnesia
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:45 ===
>     application: os_mon
>     exited: stopped
>     type: permanent
>
>
> =INFO REPORT==== 17-Oct-2012::08:46:45 ===
> Halting Erlang VM
>
> riooverlord-1:
>
> =INFO REPORT==== 17-Oct-2012::08:24:47 ===
> rabbit on node 'rabbit at RIOBARON-1' down
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:47 ===
> Mirrored-queue (queue 'MoData' in vhost 'MoBunnyMoProblems'): Slave 
> <'rabbit at RIOOVERLORD-1'.3.343.0> saw deaths of mirrors 
> <'rabbit at RIOBARON-1'.2.354.0> 
>
>
> =INFO REPORT==== 17-Oct-2012::08:24:47 ===
> Mirrored-queue (queue 'Q' in vhost '/'): Slave 
> <'rabbit at RIOOVERLORD-1'.3.258.0> saw deaths of mirrors 
> <'rabbit at RIOBARON-1'.2.252.0> 
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/840b1f80/attachment.htm>

From tom.brandish at tekcomms.com  Wed Oct 17 22:32:50 2012
From: tom.brandish at tekcomms.com (Brandish, Tom)
Date: Wed, 17 Oct 2012 21:32:50 +0000
Subject: [rabbitmq-discuss] Problems compiling RabbitMQ-C Kit on Sparc
	32-bit...
Message-ID: <4EF820DB2B020C42A6AE6807469B524D0148A4B2@US-PLNO-EXM01-P.global.tektronix.net>

Hi,

I have been able to successfully compile RabbitMQ-C on 64-bit Linux, but I am having difficulty doing so on Sparc 32-bit.  It looks I am missing some headers but with some 64-bit routines but why would I need the 64-bit stuff while compiling on a 32-bit system?

Here is my log:

aclocal: writing aclocal.m4
autoreconf: Entering directory `.'
autoreconf: configure.ac: not using Gettext
autoreconf: running: aclocal -I m4
autoreconf: configure.ac: tracing
autoreconf: running: libtoolize --copy
libtoolize: putting auxiliary files in `.'.
libtoolize: copying file `./ltmain.sh'
libtoolize: putting macros in AC_CONFIG_MACRO_DIR, `m4'.
libtoolize: copying file `m4/libtool.m4'
libtoolize: copying file `m4/ltoptions.m4'
libtoolize: copying file `m4/ltsugar.m4'
libtoolize: copying file `m4/ltversion.m4'
libtoolize: copying file `m4/lt~obsolete.m4'
autoreconf: running: /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/autoconf
autoreconf: running: /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/autoheader
autoreconf: running: automake --add-missing --copy --no-force
configure.ac:29: installing `./config.guess'
configure.ac:29: installing `./config.sub'
configure.ac:22: installing `./install-sh'
configure.ac:22: installing `./missing'
Makefile.am: installing `./depcomp'
autoreconf: Leaving directory `.'
checking for a BSD-compatible install... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking for style of include used by make... GNU
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking dependency style of gcc... gcc3
checking how to run the C preprocessor... gcc -E
checking for grep that handles long lines and -e... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
checking for egrep... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking minix/config.h usability... no
checking minix/config.h presence... no
checking for minix/config.h... no
checking whether it is safe to define __EXTENSIONS__... yes
checking build system type... sparc-sun-solaris2.10
checking host system type... sparc-sun-solaris2.10
checking how to print strings... printf
checking for a sed that does not truncate output... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/sed
checking for fgrep... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep -F
checking for ld used by gcc... /sea/compilers/native/gcc-4.4.5/V1.3/bin/ld
checking if the linker (/sea/compilers/native/gcc-4.4.5/V1.3/bin/ld) is GNU ld... yes
checking for BSD- or MS-compatible name lister (nm)... /sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B
checking the name lister (/sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B) interface... BSD nm
checking whether ln -s works... yes
checking the maximum length of command line arguments... 786240
checking whether the shell understands some XSI constructs... yes
checking whether the shell understands "+="... no
checking how to convert sparc-sun-solaris2.10 file names to sparc-sun-solaris2.10 format... func_convert_file_noop
checking how to convert sparc-sun-solaris2.10 file names to toolchain format... func_convert_file_noop
checking for /sea/compilers/native/gcc-4.4.5/V1.3/bin/ld option to reload object files... -r
checking for objdump... objdump
checking how to recognize dependent libraries... pass_all
checking for dlltool... no
checking how to associate runtime and link libraries... printf %s\n
checking for ar... ar
checking for archiver @FILE support... @
checking for strip... strip
checking for ranlib... ranlib
checking command to parse /sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B output from gcc object... ok
checking for sysroot... no
checking for mt... mt
checking if mt is a manifest tool... no
checking for dlfcn.h... yes
checking for objdir... .libs
checking if gcc supports -fno-rtti -fno-exceptions... no
checking for gcc option to produce PIC... -fPIC -DPIC
checking if gcc PIC flag -fPIC -DPIC works... yes
checking if gcc static flag -static works... no
checking if gcc supports -c -o file.o... yes
checking if gcc supports -c -o file.o... (cached) yes
checking whether the gcc linker (/sea/compilers/native/gcc-4.4.5/V1.3/bin/ld) supports shared libraries... yes
checking whether -lc should be explicitly linked in... yes
checking dynamic linker characteristics... solaris2.10 ld.so
checking how to hardcode library paths into programs... immediate
checking whether stripping libraries is possible... yes
checking if libtool supports shared libraries... yes
checking whether to build shared libraries... yes
checking whether to build static libraries... no
checking for gcc option to accept ISO C99... -std=gnu99
checking whether byte ordering is bigendian... yes
checking for inline... inline
checking if compiler accepts '-Wall'... yes
checking if compiler accepts '-Wextra'... yes
checking if compiler accepts '-pedantic'... yes
checking if compiler accepts '-Wstrict-prototypes'... yes
checking if compiler accepts '-Wcast-align'... yes
checking if compiler accepts '-fno-common'... yes
checking if compiler accepts '-fvisibility=hidden'... yes
checking if linker accepts '-no-undefined'... yes
checking for a Python interpreter with version >= 2.5... python
checking for python... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/python
checking for python version... 2.7
checking for python platform... sunos5
checking for python script directory... ${prefix}/lib/python2.7/site-packages
checking for python extension module directory... ${exec_prefix}/lib/python2.7/site-packages
checking python module: json... yes
checking for popt.h... no
checking for poptGetContext in -lpopt... no
configure: creating ./config.status
config.status: creating librabbitmq.pc
config.status: creating Makefile
config.status: creating config.h
config.status: executing depfiles commands
config.status: executing libtool commands
configure: WARNING: unrecognized options: --enable-32-bit

rabbitmq-c build options:
        Host: sparc-sun-solaris2.10
        Version: 0.2.0
        64-bit: no
        Tools: no
        Documentation: no

  GEN    librabbitmq/amqp_framing.h
  GEN    librabbitmq/amqp_framing.c
make  all-am
make[1]: Entering directory `/home/spiuser/gitwa/rabbitmq-c'
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_api.lo
In file included from librabbitmq/amqp_api.c:37:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_connection.lo
In file included from librabbitmq/amqp_connection.c:37:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
librabbitmq/amqp_connection.c: In function 'amqp_send_frame':
librabbitmq/amqp_connection.c:365: warning: pointer targets in assignment differ in signedness
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_framing.lo
In file included from librabbitmq/amqp_framing.c:38:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_mem.lo
In file included from librabbitmq/amqp_mem.c:37:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_socket.lo
In file included from librabbitmq/amqp_socket.c:37:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_table.lo
In file included from librabbitmq/amqp_table.c:37:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_url.lo
In file included from librabbitmq/amqp_url.c:37:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CC     librabbitmq/unix/librabbitmq_librabbitmq_la-socket.lo
In file included from librabbitmq/unix/socket.c:37:
./librabbitmq/amqp_private.h: In function 'amqp_e64':
./librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
./librabbitmq/amqp_private.h: In function 'amqp_d64':
./librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CCLD   librabbitmq/librabbitmq.la
  CC     examples/examples_libutils_la-utils.lo
  CC     examples/unix/examples_libutils_la-platform_utils.lo
  CCLD   examples/libutils.la
  CC     examples/amqp_bind.o
  CCLD   examples/amqp_bind
librabbitmq/.libs/librabbitmq.so: undefined reference to `connect'
librabbitmq/.libs/librabbitmq.so: undefined reference to `ntohll'
librabbitmq/.libs/librabbitmq.so: undefined reference to `send'
librabbitmq/.libs/librabbitmq.so: undefined reference to `freeaddrinfo'
librabbitmq/.libs/librabbitmq.so: undefined reference to `htonll'
librabbitmq/.libs/librabbitmq.so: undefined reference to `recv'
librabbitmq/.libs/librabbitmq.so: undefined reference to `setsockopt'
librabbitmq/.libs/librabbitmq.so: undefined reference to `socket'
librabbitmq/.libs/librabbitmq.so: undefined reference to `getaddrinfo'
collect2: ld returned 1 exit status

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/a660c574/attachment.htm>

From ekirpichov at gmail.com  Wed Oct 17 22:41:49 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Wed, 17 Oct 2012 14:41:49 -0700
Subject: [rabbitmq-discuss] RabbitMQ rendered non-operational after killing
	1 node of 3 h/a
Message-ID: <CANVKUrXgWoSMoQWtUuYo37BaMPRq2Q3L3wSfgc=iCdcrAPKJRA@mail.gmail.com>

Hi,

I have a cluster of 3 rabbits (version 2.7.1), and a bunch of services
that connect to it and declare a bunch of H/A queues. Some of the
queues are exclusive, some aren't.

Some of the services are connected to rabbit01 and some to rabbit03.
Nobody's connected to rabbit02.

Then I kill rabbit02, and, after a short while (but not immediately),
rabbitmqctl list_queues, rabbitmqctl list_connections and rabbitmqctl
list_channels completely stop working - they just hang.

After these start hanging, I killed all applications that were
connected to RabbitMQ, and then I killed rabbit03 so only rabbit01
remained. But those rabbitmqctl commands were still hanging. However,
if I restart rabbit01 and bring up the other cluster nodes, everything
is working again.

It seems like there was some internal error that lead to death of a
mirrored queue coordinator process, or something... I'm attaching the
log from rabbit01.

-- 
Eugene Kirpichov
http://www.linkedin.com/in/eugenekirpichov
We're hiring! http://tinyurl.com/mirantis-openstack-engineer
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at control01.log
Type: application/octet-stream
Size: 24844 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121017/cb02d087/attachment.obj>

From brett.r.cameron at gmail.com  Wed Oct 17 23:00:47 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Thu, 18 Oct 2012 11:00:47 +1300
Subject: [rabbitmq-discuss] Problems compiling RabbitMQ-C Kit on Sparc
	32-bit...
In-Reply-To: <4EF820DB2B020C42A6AE6807469B524D0148A4B2@US-PLNO-EXM01-P.global.tektronix.net>
References: <4EF820DB2B020C42A6AE6807469B524D0148A4B2@US-PLNO-EXM01-P.global.tektronix.net>
Message-ID: <CALPqkiqHVB8A7doUoiJpUtU1W5_WdGFH+oC9qN_GGs3ZoByPQg@mail.gmail.com>

Tom,

I think you've got a couple of problems here. I don't have access to a
32-bit Solaris system right now to check, but first up I suspect that you
might need to add something like "-lsocket -lxnet -lnsl" to the link
statement. This should resolve most of the missing symbols, but my guess is
that htonll() will be missing on your (I'm guessing reasonably old) system.
There should be ways and means around this... I might just be able to get
access to a suitable machine and have a look into it.

Brett



On Thu, Oct 18, 2012 at 10:32 AM, Brandish, Tom
<tom.brandish at tekcomms.com>wrote:

>  Hi,****
>
> ** **
>
> I have been able to successfully compile RabbitMQ-C on 64-bit Linux, but I
> am having difficulty doing so on Sparc 32-bit.  It looks I am missing some
> headers but with some 64-bit routines but why would I need the 64-bit stuff
> while compiling on a 32-bit system?****
>
> ** **
>
> Here is my log:****
>
> ** **
>
> aclocal: writing aclocal.m4****
>
> autoreconf: Entering directory `.'****
>
> autoreconf: configure.ac: not using Gettext****
>
> autoreconf: running: aclocal -I m4****
>
> autoreconf: configure.ac: tracing****
>
> autoreconf: running: libtoolize --copy****
>
> libtoolize: putting auxiliary files in `.'.****
>
> libtoolize: copying file `./ltmain.sh'****
>
> libtoolize: putting macros in AC_CONFIG_MACRO_DIR, `m4'.****
>
> libtoolize: copying file `m4/libtool.m4'****
>
> libtoolize: copying file `m4/ltoptions.m4'****
>
> libtoolize: copying file `m4/ltsugar.m4'****
>
> libtoolize: copying file `m4/ltversion.m4'****
>
> libtoolize: copying file `m4/lt~obsolete.m4'****
>
> autoreconf: running:
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/autoconf
> ****
>
> autoreconf: running:
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/autoheader
> ****
>
> autoreconf: running: automake --add-missing --copy --no-force****
>
> configure.ac:29: installing `./config.guess'****
>
> configure.ac:29: installing `./config.sub'****
>
> configure.ac:22: installing `./install-sh'****
>
> configure.ac:22: installing `./missing'****
>
> Makefile.am: installing `./depcomp'****
>
> autoreconf: Leaving directory `.'****
>
> checking for a BSD-compatible install...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/install
> -c****
>
> checking whether build environment is sane... yes****
>
> checking for a thread-safe mkdir -p...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/mkdir
> -p****
>
> checking for gawk... gawk****
>
> checking whether make sets $(MAKE)... yes****
>
> checking for style of include used by make... GNU****
>
> checking for gcc... gcc****
>
> checking whether the C compiler works... yes****
>
> checking for C compiler default output file name... a.out****
>
> checking for suffix of executables...****
>
> checking whether we are cross compiling... no****
>
> checking for suffix of object files... o****
>
> checking whether we are using the GNU C compiler... yes****
>
> checking whether gcc accepts -g... yes****
>
> checking for gcc option to accept ISO C89... none needed****
>
> checking dependency style of gcc... gcc3****
>
> checking how to run the C preprocessor... gcc -E****
>
> checking for grep that handles long lines and -e...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
> ****
>
> checking for egrep...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
> -E****
>
> checking for ANSI C header files... yes****
>
> checking for sys/types.h... yes****
>
> checking for sys/stat.h... yes****
>
> checking for stdlib.h... yes****
>
> checking for string.h... yes****
>
> checking for memory.h... yes****
>
> checking for strings.h... yes****
>
> checking for inttypes.h... yes****
>
> checking for stdint.h... yes****
>
> checking for unistd.h... yes****
>
> checking minix/config.h usability... no****
>
> checking minix/config.h presence... no****
>
> checking for minix/config.h... no****
>
> checking whether it is safe to define __EXTENSIONS__... yes****
>
> checking build system type... sparc-sun-solaris2.10****
>
> checking host system type... sparc-sun-solaris2.10****
>
> checking how to print strings... printf****
>
> checking for a sed that does not truncate output...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/sed
> ****
>
> checking for fgrep...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
> -F****
>
> checking for ld used by gcc... /sea/compilers/native/gcc-4.4.5/V1.3/bin/ld
> ****
>
> checking if the linker (/sea/compilers/native/gcc-4.4.5/V1.3/bin/ld) is
> GNU ld... yes****
>
> checking for BSD- or MS-compatible name lister (nm)...
> /sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B****
>
> checking the name lister (/sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B)
> interface... BSD nm****
>
> checking whether ln -s works... yes****
>
> checking the maximum length of command line arguments... 786240****
>
> checking whether the shell understands some XSI constructs... yes****
>
> checking whether the shell understands "+="... no****
>
> checking how to convert sparc-sun-solaris2.10 file names to
> sparc-sun-solaris2.10 format... func_convert_file_noop****
>
> checking how to convert sparc-sun-solaris2.10 file names to toolchain
> format... func_convert_file_noop****
>
> checking for /sea/compilers/native/gcc-4.4.5/V1.3/bin/ld option to reload
> object files... -r****
>
> checking for objdump... objdump****
>
> checking how to recognize dependent libraries... pass_all****
>
> checking for dlltool... no****
>
> checking how to associate runtime and link libraries... printf %s\n****
>
> checking for ar... ar****
>
> checking for archiver @FILE support... @****
>
> checking for strip... strip****
>
> checking for ranlib... ranlib****
>
> checking command to parse /sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B
> output from gcc object... ok****
>
> checking for sysroot... no****
>
> checking for mt... mt****
>
> checking if mt is a manifest tool... no****
>
> checking for dlfcn.h... yes****
>
> checking for objdir... .libs****
>
> checking if gcc supports -fno-rtti -fno-exceptions... no****
>
> checking for gcc option to produce PIC... -fPIC -DPIC****
>
> checking if gcc PIC flag -fPIC -DPIC works... yes****
>
> checking if gcc static flag -static works... no****
>
> checking if gcc supports -c -o file.o... yes****
>
> checking if gcc supports -c -o file.o... (cached) yes****
>
> checking whether the gcc linker
> (/sea/compilers/native/gcc-4.4.5/V1.3/bin/ld) supports shared libraries...
> yes****
>
> checking whether -lc should be explicitly linked in... yes****
>
> checking dynamic linker characteristics... solaris2.10 ld.so****
>
> checking how to hardcode library paths into programs... immediate****
>
> checking whether stripping libraries is possible... yes****
>
> checking if libtool supports shared libraries... yes****
>
> checking whether to build shared libraries... yes****
>
> checking whether to build static libraries... no****
>
> checking for gcc option to accept ISO C99... -std=gnu99****
>
> checking whether byte ordering is bigendian... yes****
>
> checking for inline... inline****
>
> checking if compiler accepts '-Wall'... yes****
>
> checking if compiler accepts '-Wextra'... yes****
>
> checking if compiler accepts '-pedantic'... yes****
>
> checking if compiler accepts '-Wstrict-prototypes'... yes****
>
> checking if compiler accepts '-Wcast-align'... yes****
>
> checking if compiler accepts '-fno-common'... yes****
>
> checking if compiler accepts '-fvisibility=hidden'... yes****
>
> checking if linker accepts '-no-undefined'... yes****
>
> checking for a Python interpreter with version >= 2.5... python****
>
> checking for python...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/python
> ****
>
> checking for python version... 2.7****
>
> checking for python platform... sunos5****
>
> checking for python script directory...
> ${prefix}/lib/python2.7/site-packages****
>
> checking for python extension module directory...
> ${exec_prefix}/lib/python2.7/site-packages****
>
> checking python module: json... yes****
>
> checking for popt.h... no****
>
> checking for poptGetContext in -lpopt... no****
>
> configure: creating ./config.status****
>
> config.status: creating librabbitmq.pc****
>
> config.status: creating Makefile****
>
> config.status: creating config.h****
>
> config.status: executing depfiles commands****
>
> config.status: executing libtool commands****
>
> configure: WARNING: unrecognized options: --enable-32-bit****
>
> ** **
>
> rabbitmq-c build options:****
>
>         Host: sparc-sun-solaris2.10****
>
>         Version: 0.2.0****
>
>         64-bit: no****
>
>         Tools: no****
>
>         Documentation: no****
>
> ** **
>
>   GEN    librabbitmq/amqp_framing.h****
>
>   GEN    librabbitmq/amqp_framing.c****
>
> make  all-am****
>
> make[1]: Entering directory `/home/spiuser/gitwa/rabbitmq-c'****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_api.lo****
>
> In file included from librabbitmq/amqp_api.c:37:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_connection.lo****
>
> In file included from librabbitmq/amqp_connection.c:37:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
> librabbitmq/amqp_connection.c: In function 'amqp_send_frame':****
>
> librabbitmq/amqp_connection.c:365: warning: pointer targets in assignment
> differ in signedness****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_framing.lo****
>
> In file included from librabbitmq/amqp_framing.c:38:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_mem.lo****
>
> In file included from librabbitmq/amqp_mem.c:37:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_socket.lo****
>
> In file included from librabbitmq/amqp_socket.c:37:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_table.lo****
>
> In file included from librabbitmq/amqp_table.c:37:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_url.lo****
>
> In file included from librabbitmq/amqp_url.c:37:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
>   CC     librabbitmq/unix/librabbitmq_librabbitmq_la-socket.lo****
>
> In file included from librabbitmq/unix/socket.c:37:****
>
> ./librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> ./librabbitmq/amqp_private.h:251: warning: implicit declaration of
> function 'htonll'****
>
> ./librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> ./librabbitmq/amqp_private.h:251: warning: implicit declaration of
> function 'ntohll'****
>
>   CCLD   librabbitmq/librabbitmq.la****
>
>   CC     examples/examples_libutils_la-utils.lo****
>
>   CC     examples/unix/examples_libutils_la-platform_utils.lo****
>
>   CCLD   examples/libutils.la****
>
>   CC     examples/amqp_bind.o****
>
>   CCLD   examples/amqp_bind****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `connect'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `ntohll'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `send'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `freeaddrinfo'***
> *
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `htonll'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `recv'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `setsockopt'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `socket'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `getaddrinfo'****
>
> collect2: ld returned 1 exit status****
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/31d81b81/attachment.htm>

From tomasz.zuber at zettaserve.com  Thu Oct 18 02:10:08 2012
From: tomasz.zuber at zettaserve.com (Zuber, Tomasz)
Date: Thu, 18 Oct 2012 01:10:08 +0000
Subject: [rabbitmq-discuss] Setting socket options in .NET client
Message-ID: <91F95518D4FAA04290B584CCF9D0D2171C373996@PERMLS03.zettaserve.com>

Hello,

I am involved in a project that uses the .NET RabbitMQ client.

We have some clients that will be connecting to a broker over a high latency, high bandwidth link. To improve message throughput, we need to tweak some socket options, namely the send buffer size.
In addition, we would also like to reduce the socket timeout when connecting.

As far as I can see, the .NET client does not support setting any of these options easily through its API.

I have been able to achieve this by using some dirty workarounds like reflection or subclassing implementation classes, however, it would be ideal if this functionality could be added into the API (maybe the ConnectionFactory?).

I am also happy to make a few changes to the .NET client code, and submit these if it helps at all.

Kind Regards,

Tomasz Zuber


________________________________

ZettaServe Disclaimer: This email and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you are not the named addressee you should not disseminate, distribute or copy this e-mail. Please notify the sender immediately if you have received this email by mistake and delete this email from your system. Computer viruses can be transmitted via email. The recipient should check this email and any attachments for the presence of viruses. ZettaServe Pty Ltd accepts no liability for any damage caused by any virus transmitted by this email.


From wongkamhoong at gmail.com  Thu Oct 18 02:32:00 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Thu, 18 Oct 2012 09:32:00 +0800
Subject: [rabbitmq-discuss] Unexpected log generated
In-Reply-To: <507E9139.4020706@rabbitmq.com>
References: <507E90A1.7080502@gmail.com>
	<507E9139.4020706@rabbitmq.com>
Message-ID: <CAHv8OSRTh6=yKDwcgNwRGy6Lz06ny1wozROHH1rs_0y23GoObQ@mail.gmail.com>

Hi Emile,

I'm using RabbitMQ *v2.8.7* with Erlang *R14B04*

Regards,
Wong


On Wed, Oct 17, 2012 at 7:06 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 17/10/12 11:27, Wong Kam Hoong wrote:
> > Hi RabbitMQ Team,
> >
> > Recently i checked the RabbitMQ log, i saw there are a lot unexpected
> > log generated which I really can't understand what they are..
> >
> > *_Sample Log_*
> > =ERROR REPORT==== 17-Oct-2012::00:02:55 ===
> > ** Generic server <0.401.0> terminating
> > . . .
> >
> > Attached is the full log for your reference.
>
> Unfortunately this was larger than the allowed 1Mb, preventing your
> message from showing up on the mailing list.
>
> The logfile included this error:
>
> ** Reason for termination ==
> ** {{case_clause,{{{value,{4431712,{drop,61,0,false}}},{[],[]}},
>                   {empty,{[],[]}}}},
>     [{gm,find_common,3},
>      {gm,find_prefix_common_suffix,2},
>      {gm,'-handle_msg/2-fun-0-',7},
>      {gm,with_member_acc,3},
>      {lists,foldl,3},
>      {gm,handle_msg,2},
>      {gm,handle_cast,2},
>      {gen_server2,handle_msg,2}]}
>
> This error has the same signature as a bug that has been fixed in more
> recent versions of the broker. Can you please confirm which version of
> RabbitMQ you are using and whether the problem persists if you upgrade
> to the latest version?
>
>
>
> -Emile
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/e87aca02/attachment.htm>

From wongkamhoong at gmail.com  Thu Oct 18 03:08:42 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Thu, 18 Oct 2012 10:08:42 +0800
Subject: [rabbitmq-discuss] Unexpected log generated
In-Reply-To: <CAHv8OSRTh6=yKDwcgNwRGy6Lz06ny1wozROHH1rs_0y23GoObQ@mail.gmail.com>
References: <507E90A1.7080502@gmail.com> <507E9139.4020706@rabbitmq.com>
	<CAHv8OSRTh6=yKDwcgNwRGy6Lz06ny1wozROHH1rs_0y23GoObQ@mail.gmail.com>
Message-ID: <CAHv8OSSB5pQQ3mwin3oosONRxVeUFObk1Em2MiZfefc4BUhCQg@mail.gmail.com>

Hi Emile,

RabbitMQ *v2.8.7*
Erlang *R14B04*

Sorry about the attachment, I don't know maximum size allowed limit to 1mb.
Before I zip the log, the log original size was 30mb++.

I saw a lot of similar patterns in the log, I had attached them in this
email.

Regards,
Wong


On Thu, Oct 18, 2012 at 9:32 AM, Wong Kam Hoong <wongkamhoong at gmail.com>wrote:

> Hi Emile,
>
> I'm using RabbitMQ *v2.8.7* with Erlang *R14B04*
>
> Regards,
> Wong
>
>
> On Wed, Oct 17, 2012 at 7:06 PM, Emile Joubert <emile at rabbitmq.com> wrote:
>
>>
>> Hi,
>>
>> On 17/10/12 11:27, Wong Kam Hoong wrote:
>> > Hi RabbitMQ Team,
>> >
>> > Recently i checked the RabbitMQ log, i saw there are a lot unexpected
>> > log generated which I really can't understand what they are..
>> >
>> > *_Sample Log_*
>> > =ERROR REPORT==== 17-Oct-2012::00:02:55 ===
>> > ** Generic server <0.401.0> terminating
>> > . . .
>> >
>> > Attached is the full log for your reference.
>>
>> Unfortunately this was larger than the allowed 1Mb, preventing your
>> message from showing up on the mailing list.
>>
>> The logfile included this error:
>>
>> ** Reason for termination ==
>> ** {{case_clause,{{{value,{4431712,{drop,61,0,false}}},{[],[]}},
>>                   {empty,{[],[]}}}},
>>     [{gm,find_common,3},
>>      {gm,find_prefix_common_suffix,2},
>>      {gm,'-handle_msg/2-fun-0-',7},
>>      {gm,with_member_acc,3},
>>      {lists,foldl,3},
>>      {gm,handle_msg,2},
>>      {gm,handle_cast,2},
>>      {gen_server2,handle_msg,2}]}
>>
>> This error has the same signature as a bug that has been fixed in more
>> recent versions of the broker. Can you please confirm which version of
>> RabbitMQ you are using and whether the problem persists if you upgrade
>> to the latest version?
>>
>>
>>
>> -Emile
>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/b4fd56ed/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: error_patterns.zip
Type: application/zip
Size: 876 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/b4fd56ed/attachment.zip>

From brett.r.cameron at gmail.com  Thu Oct 18 04:15:02 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Thu, 18 Oct 2012 16:15:02 +1300
Subject: [rabbitmq-discuss] Problems compiling RabbitMQ-C Kit on Sparc
	32-bit...
In-Reply-To: <CALPqkiqHVB8A7doUoiJpUtU1W5_WdGFH+oC9qN_GGs3ZoByPQg@mail.gmail.com>
References: <4EF820DB2B020C42A6AE6807469B524D0148A4B2@US-PLNO-EXM01-P.global.tektronix.net>
	<CALPqkiqHVB8A7doUoiJpUtU1W5_WdGFH+oC9qN_GGs3ZoByPQg@mail.gmail.com>
Message-ID: <CALPqkioe-VGvg1U3-3+J9LSeE2Q17RdaHgza8YhufJ1hHf9OhA@mail.gmail.com>

Tom,

Just thinking about it, network byte order and Solaris SPARC are both big
endian, so you can probably just do something like the following (or some
variant thereof):

#if defined(__sparc)
#define ntohll(x) (x)
#define htonll(x) (x)
#endif

Regards,
Brett

On Thu, Oct 18, 2012 at 11:00 AM, Brett Cameron
<brett.r.cameron at gmail.com>wrote:

> Tom,
>
> I think you've got a couple of problems here. I don't have access to a
> 32-bit Solaris system right now to check, but first up I suspect that you
> might need to add something like "-lsocket -lxnet -lnsl" to the link
> statement. This should resolve most of the missing symbols, but my guess is
> that htonll() will be missing on your (I'm guessing reasonably old) system.
> There should be ways and means around this... I might just be able to get
> access to a suitable machine and have a look into it.
>
> Brett
>
>
>
> On Thu, Oct 18, 2012 at 10:32 AM, Brandish, Tom <tom.brandish at tekcomms.com
> > wrote:
>
>>  Hi,****
>>
>> ** **
>>
>> I have been able to successfully compile RabbitMQ-C on 64-bit Linux, but
>> I am having difficulty doing so on Sparc 32-bit.  It looks I am missing
>> some headers but with some 64-bit routines but why would I need the 64-bit
>> stuff while compiling on a 32-bit system?****
>>
>> ** **
>>
>> Here is my log:****
>>
>> ** **
>>
>> aclocal: writing aclocal.m4****
>>
>> autoreconf: Entering directory `.'****
>>
>> autoreconf: configure.ac: not using Gettext****
>>
>> autoreconf: running: aclocal -I m4****
>>
>> autoreconf: configure.ac: tracing****
>>
>> autoreconf: running: libtoolize --copy****
>>
>> libtoolize: putting auxiliary files in `.'.****
>>
>> libtoolize: copying file `./ltmain.sh'****
>>
>> libtoolize: putting macros in AC_CONFIG_MACRO_DIR, `m4'.****
>>
>> libtoolize: copying file `m4/libtool.m4'****
>>
>> libtoolize: copying file `m4/ltoptions.m4'****
>>
>> libtoolize: copying file `m4/ltsugar.m4'****
>>
>> libtoolize: copying file `m4/ltversion.m4'****
>>
>> libtoolize: copying file `m4/lt~obsolete.m4'****
>>
>> autoreconf: running:
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/autoconf
>> ****
>>
>> autoreconf: running:
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/autoheader
>> ****
>>
>> autoreconf: running: automake --add-missing --copy --no-force****
>>
>> configure.ac:29: installing `./config.guess'****
>>
>> configure.ac:29: installing `./config.sub'****
>>
>> configure.ac:22: installing `./install-sh'****
>>
>> configure.ac:22: installing `./missing'****
>>
>> Makefile.am: installing `./depcomp'****
>>
>> autoreconf: Leaving directory `.'****
>>
>> checking for a BSD-compatible install...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/install
>> -c****
>>
>> checking whether build environment is sane... yes****
>>
>> checking for a thread-safe mkdir -p...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/mkdir
>> -p****
>>
>> checking for gawk... gawk****
>>
>> checking whether make sets $(MAKE)... yes****
>>
>> checking for style of include used by make... GNU****
>>
>> checking for gcc... gcc****
>>
>> checking whether the C compiler works... yes****
>>
>> checking for C compiler default output file name... a.out****
>>
>> checking for suffix of executables...****
>>
>> checking whether we are cross compiling... no****
>>
>> checking for suffix of object files... o****
>>
>> checking whether we are using the GNU C compiler... yes****
>>
>> checking whether gcc accepts -g... yes****
>>
>> checking for gcc option to accept ISO C89... none needed****
>>
>> checking dependency style of gcc... gcc3****
>>
>> checking how to run the C preprocessor... gcc -E****
>>
>> checking for grep that handles long lines and -e...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
>> ****
>>
>> checking for egrep...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
>> -E****
>>
>> checking for ANSI C header files... yes****
>>
>> checking for sys/types.h... yes****
>>
>> checking for sys/stat.h... yes****
>>
>> checking for stdlib.h... yes****
>>
>> checking for string.h... yes****
>>
>> checking for memory.h... yes****
>>
>> checking for strings.h... yes****
>>
>> checking for inttypes.h... yes****
>>
>> checking for stdint.h... yes****
>>
>> checking for unistd.h... yes****
>>
>> checking minix/config.h usability... no****
>>
>> checking minix/config.h presence... no****
>>
>> checking for minix/config.h... no****
>>
>> checking whether it is safe to define __EXTENSIONS__... yes****
>>
>> checking build system type... sparc-sun-solaris2.10****
>>
>> checking host system type... sparc-sun-solaris2.10****
>>
>> checking how to print strings... printf****
>>
>> checking for a sed that does not truncate output...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/sed
>> ****
>>
>> checking for fgrep...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
>> -F****
>>
>> checking for ld used by gcc... /sea/compilers/native/gcc-4.4.5/V1.3/bin/ld
>> ****
>>
>> checking if the linker (/sea/compilers/native/gcc-4.4.5/V1.3/bin/ld) is
>> GNU ld... yes****
>>
>> checking for BSD- or MS-compatible name lister (nm)...
>> /sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B****
>>
>> checking the name lister (/sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B)
>> interface... BSD nm****
>>
>> checking whether ln -s works... yes****
>>
>> checking the maximum length of command line arguments... 786240****
>>
>> checking whether the shell understands some XSI constructs... yes****
>>
>> checking whether the shell understands "+="... no****
>>
>> checking how to convert sparc-sun-solaris2.10 file names to
>> sparc-sun-solaris2.10 format... func_convert_file_noop****
>>
>> checking how to convert sparc-sun-solaris2.10 file names to toolchain
>> format... func_convert_file_noop****
>>
>> checking for /sea/compilers/native/gcc-4.4.5/V1.3/bin/ld option to reload
>> object files... -r****
>>
>> checking for objdump... objdump****
>>
>> checking how to recognize dependent libraries... pass_all****
>>
>> checking for dlltool... no****
>>
>> checking how to associate runtime and link libraries... printf %s\n****
>>
>> checking for ar... ar****
>>
>> checking for archiver @FILE support... @****
>>
>> checking for strip... strip****
>>
>> checking for ranlib... ranlib****
>>
>> checking command to parse /sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B
>> output from gcc object... ok****
>>
>> checking for sysroot... no****
>>
>> checking for mt... mt****
>>
>> checking if mt is a manifest tool... no****
>>
>> checking for dlfcn.h... yes****
>>
>> checking for objdir... .libs****
>>
>> checking if gcc supports -fno-rtti -fno-exceptions... no****
>>
>> checking for gcc option to produce PIC... -fPIC -DPIC****
>>
>> checking if gcc PIC flag -fPIC -DPIC works... yes****
>>
>> checking if gcc static flag -static works... no****
>>
>> checking if gcc supports -c -o file.o... yes****
>>
>> checking if gcc supports -c -o file.o... (cached) yes****
>>
>> checking whether the gcc linker
>> (/sea/compilers/native/gcc-4.4.5/V1.3/bin/ld) supports shared libraries...
>> yes****
>>
>> checking whether -lc should be explicitly linked in... yes****
>>
>> checking dynamic linker characteristics... solaris2.10 ld.so****
>>
>> checking how to hardcode library paths into programs... immediate****
>>
>> checking whether stripping libraries is possible... yes****
>>
>> checking if libtool supports shared libraries... yes****
>>
>> checking whether to build shared libraries... yes****
>>
>> checking whether to build static libraries... no****
>>
>> checking for gcc option to accept ISO C99... -std=gnu99****
>>
>> checking whether byte ordering is bigendian... yes****
>>
>> checking for inline... inline****
>>
>> checking if compiler accepts '-Wall'... yes****
>>
>> checking if compiler accepts '-Wextra'... yes****
>>
>> checking if compiler accepts '-pedantic'... yes****
>>
>> checking if compiler accepts '-Wstrict-prototypes'... yes****
>>
>> checking if compiler accepts '-Wcast-align'... yes****
>>
>> checking if compiler accepts '-fno-common'... yes****
>>
>> checking if compiler accepts '-fvisibility=hidden'... yes****
>>
>> checking if linker accepts '-no-undefined'... yes****
>>
>> checking for a Python interpreter with version >= 2.5... python****
>>
>> checking for python...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/python
>> ****
>>
>> checking for python version... 2.7****
>>
>> checking for python platform... sunos5****
>>
>> checking for python script directory...
>> ${prefix}/lib/python2.7/site-packages****
>>
>> checking for python extension module directory...
>> ${exec_prefix}/lib/python2.7/site-packages****
>>
>> checking python module: json... yes****
>>
>> checking for popt.h... no****
>>
>> checking for poptGetContext in -lpopt... no****
>>
>> configure: creating ./config.status****
>>
>> config.status: creating librabbitmq.pc****
>>
>> config.status: creating Makefile****
>>
>> config.status: creating config.h****
>>
>> config.status: executing depfiles commands****
>>
>> config.status: executing libtool commands****
>>
>> configure: WARNING: unrecognized options: --enable-32-bit****
>>
>> ** **
>>
>> rabbitmq-c build options:****
>>
>>         Host: sparc-sun-solaris2.10****
>>
>>         Version: 0.2.0****
>>
>>         64-bit: no****
>>
>>         Tools: no****
>>
>>         Documentation: no****
>>
>> ** **
>>
>>   GEN    librabbitmq/amqp_framing.h****
>>
>>   GEN    librabbitmq/amqp_framing.c****
>>
>> make  all-am****
>>
>> make[1]: Entering directory `/home/spiuser/gitwa/rabbitmq-c'****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_api.lo****
>>
>> In file included from librabbitmq/amqp_api.c:37:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_connection.lo****
>>
>> In file included from librabbitmq/amqp_connection.c:37:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>> librabbitmq/amqp_connection.c: In function 'amqp_send_frame':****
>>
>> librabbitmq/amqp_connection.c:365: warning: pointer targets in assignment
>> differ in signedness****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_framing.lo****
>>
>> In file included from librabbitmq/amqp_framing.c:38:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_mem.lo****
>>
>> In file included from librabbitmq/amqp_mem.c:37:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_socket.lo****
>>
>> In file included from librabbitmq/amqp_socket.c:37:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_table.lo****
>>
>> In file included from librabbitmq/amqp_table.c:37:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_url.lo****
>>
>> In file included from librabbitmq/amqp_url.c:37:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>>   CC     librabbitmq/unix/librabbitmq_librabbitmq_la-socket.lo****
>>
>> In file included from librabbitmq/unix/socket.c:37:****
>>
>> ./librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> ./librabbitmq/amqp_private.h:251: warning: implicit declaration of
>> function 'htonll'****
>>
>> ./librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> ./librabbitmq/amqp_private.h:251: warning: implicit declaration of
>> function 'ntohll'****
>>
>>   CCLD   librabbitmq/librabbitmq.la****
>>
>>   CC     examples/examples_libutils_la-utils.lo****
>>
>>   CC     examples/unix/examples_libutils_la-platform_utils.lo****
>>
>>   CCLD   examples/libutils.la****
>>
>>   CC     examples/amqp_bind.o****
>>
>>   CCLD   examples/amqp_bind****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `connect'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `ntohll'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `send'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `freeaddrinfo'**
>> **
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `htonll'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `recv'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `setsockopt'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `socket'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `getaddrinfo'***
>> *
>>
>> collect2: ld returned 1 exit status****
>>
>> ** **
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/ec60ee16/attachment.htm>

From taggart at taggarts.org  Thu Oct 18 04:09:46 2012
From: taggart at taggarts.org (scott taggart)
Date: Wed, 17 Oct 2012 20:09:46 -0700
Subject: [rabbitmq-discuss] Newbie Question: Very elementary Q creation vs.
	producer order
Message-ID: <507F72FA.3020008@taggarts.org>

I am very new to rabbitmq - still reading documentation.

I cannot guarantee the order in which my producer and consumer processes 
are started so...

Can I create a message Q independently of my producers and consumers 
(before either starts) and then have the producer post messages before 
any consumer(s) come alive...

or

can the producer create a Q (if it happens to start before any 
consumers), and post messages before any consumers start?

Thanks


From michael.s.klishin at gmail.com  Thu Oct 18 04:30:58 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 18 Oct 2012 07:30:58 +0400
Subject: [rabbitmq-discuss] Newbie Question: Very elementary Q creation
 vs. producer order
In-Reply-To: <507F72FA.3020008@taggarts.org>
References: <507F72FA.3020008@taggarts.org>
Message-ID: <CAE3HoVR4XcWD_uMFYi9_79X4iTTWSJFjMy90XcKDWqji_aET2A@mail.gmail.com>

2012/10/18 scott taggart <taggart at taggarts.org>

> Can I create a message Q independently of my producers and consumers
> (before either starts) and then have the producer post messages before any
> consumer(s) come alive...
>

Any application can declare queues, exchanges and bindings.


>
> can the producer create a Q (if it happens to start before any consumers),
> and post messages before any consumers start?
>

Messages routed to queues without consumers will just sit there waiting for
consumers to appear.

This approach will work, however, your producers will have to know quite a
bit about how consumers work (at least what queues
and bindings they need).
-- 
MK
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/c72c1f36/attachment.htm>

From emile at rabbitmq.com  Thu Oct 18 10:15:40 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 18 Oct 2012 10:15:40 +0100
Subject: [rabbitmq-discuss] Setting socket options in .NET client
In-Reply-To: <91F95518D4FAA04290B584CCF9D0D2171C373996@PERMLS03.zettaserve.com>
References: <91F95518D4FAA04290B584CCF9D0D2171C373996@PERMLS03.zettaserve.com>
Message-ID: <507FC8BC.1090507@rabbitmq.com>


Hi Tomasz,

On 18/10/12 02:10, Zuber, Tomasz wrote:
> As far as I can see, the .NET client does not support setting any of
> these options easily through its API.

We are aware of this limitation and there is a bug open to offer control
over socket options. In the meantime you will need to recompile after
making the necessary changes to SocketFrameHandler_0_9.m_socket.

> I am also happy to make a few changes to the .NET client code, and
> submit these if it helps at all.

Thanks for your kind offer. The easiest way to do this is to fork the
github repository and submit a pull request. You will also need to sign
a contributor agreement, but we can discuss that off-line.



-Emile


From mathsunn at gmail.com  Thu Oct 18 10:01:53 2012
From: mathsunn at gmail.com (Mathieu Juers)
Date: Thu, 18 Oct 2012 02:01:53 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbitmq doesn't start after installation of
	rabbitmq_management
Message-ID: <671d2b29-7a44-4e8d-b690-b26afa954473@googlegroups.com>

Hello,

After activating the plugin rabbitmq_management the rabbitmq server doesn't 
start.

I tested on an identical environment and I do not have this problem, 
rabbitmq works very well.

Here are the logs, could you help me?

More informations :
Linux Debian 6.0 Squeeze
Erlang version : R14A
Rabbit version : 2.8.7

Thanks,
Mathieu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/816719ba/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_log.zip
Type: application/zip
Size: 78437 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/816719ba/attachment.zip>

From simon at rabbitmq.com  Thu Oct 18 10:19:21 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Oct 2012 10:19:21 +0100
Subject: [rabbitmq-discuss] Rabbitmq doesn't start after installation of
 rabbitmq_management
In-Reply-To: <671d2b29-7a44-4e8d-b690-b26afa954473@googlegroups.com>
References: <671d2b29-7a44-4e8d-b690-b26afa954473@googlegroups.com>
Message-ID: <507FC999.9040605@rabbitmq.com>

On 18/10/12 10:01, Mathieu Juers wrote:
> After activating the plugin rabbitmq_management the rabbitmq server
> doesn't start.

 From the startup_log:

{cannot_read_enabled_plugins_file,"/etc/rabbitmq/enabled_plugins",eacces}

So somehow this file has ended up unreadable by the rabbitmq user. It 
should be owned by root, with 644 permissions or so.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dev440 at gmail.com  Thu Oct 18 10:24:28 2012
From: dev440 at gmail.com (chetan dev)
Date: Thu, 18 Oct 2012 14:54:28 +0530
Subject: [rabbitmq-discuss] RabbitMq Message Notification
Message-ID: <CAB0ZxM4jgOgJGebzAWf_qfARBEA--AB2NSPVyHARtssgNHJvFg@mail.gmail.com>

Hi,

Is there a service or by any mean i can generate an event  whenever
a message is received in a queue and which keeps monitoring it continuosly.
i want to do it independently of application for  publisher. publisher
just publishes the message and thats it. i dont want anything to be done on
publishers side



Thanks
-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/2754cd00/attachment.htm>

From simon at rabbitmq.com  Thu Oct 18 10:27:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Oct 2012 10:27:51 +0100
Subject: [rabbitmq-discuss] RabbitMq Message Notification
In-Reply-To: <CAB0ZxM4jgOgJGebzAWf_qfARBEA--AB2NSPVyHARtssgNHJvFg@mail.gmail.com>
References: <CAB0ZxM4jgOgJGebzAWf_qfARBEA--AB2NSPVyHARtssgNHJvFg@mail.gmail.com>
Message-ID: <507FCB97.90208@rabbitmq.com>

On 18/10/12 10:24, chetan dev wrote:
> Is there a service or by any mean i can generate an event  whenever
> a message is received in a queue and which keeps monitoring it continuosly.
> i want to do it independently of application for  publisher. publisher
> just publishes the message and thats it. i dont want anything to be done
> on publishers side

Check out the firehose:

http://www.rabbitmq.com/firehose.html

and the tracing plugin:

http://hg.rabbitmq.com/rabbitmq-tracing/file/d809ae76b053/README

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From watson.timothy at gmail.com  Thu Oct 18 10:28:14 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 18 Oct 2012 10:28:14 +0100
Subject: [rabbitmq-discuss] Newbie Question: Very elementary Q creation
	vs. producer order
In-Reply-To: <507F72FA.3020008@taggarts.org>
References: <507F72FA.3020008@taggarts.org>
Message-ID: <CD18EA82-79C9-4952-9424-37623CF24479@rabbitmq.com>

Hi

On 18 Oct 2012, at 04:09, scott taggart <taggart at taggarts.org> wrote:

> I am very new to rabbitmq - still reading documentation.
> 
> I cannot guarantee the order in which my producer and consumer processes are started so...
> 
> Can I create a message Q independently of my producers and consumers (before either starts) and then have the producer post messages before any consumer(s) come alive...
> 
> or
> 
> can the producer create a Q (if it happens to start before any consumers), and post messages before any consumers start?
> 

In AMQP a queue.declare is more like an assertion - the queue will be created if it doesn't exist but either way the operation will still succeed as long as you have access rights. Just declare the queue in both producer and consumer and it'll work fine as long as the two declarations do not differ in any arguments passed.


> Thanks
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ejsmont.artur at gmail.com  Thu Oct 18 10:30:23 2012
From: ejsmont.artur at gmail.com (Artur Ejsmont)
Date: Thu, 18 Oct 2012 20:30:23 +1100
Subject: [rabbitmq-discuss] question on message ordering guarantees
Message-ID: <CABv2Cn2J758KHSuT8ix5dczV3qA5-Xihospc7yzHwRQjSYpiLA@mail.gmail.com>

Hi there everyone,

I am working on a rabbitmq based messaging system and i was wondering if
you could help me out :)

I was wondering how could i enforce events being processed in the order
they are published?

Let me draw the rough setup:

1. We would have single exchange for the app, publishers dont setup routing
they just push into the exchange and disconnect whenever. Multiple
publishers can send messages regarding same object (for example a video).

2. Each type of consumer gets a separate queue and creates 1-n bindings to
get copies of messages that match the key into it's queue. Consumers
connect and disconnect but the queue remains in place as messages and
queues are persistent.

3. To make it a bit more complex you can have competing consumers consuming
from the same queue. For example video encoder would take a lot of time to
process so we would have  multiple parallel instances running.

Now, the issue is that i am not clear on what are the guarantees about
message ordering, especially around client failures, disconnects etc. Is
there some trick to get part of messages in guaranteed order as in ActiveMQ
message groups? I would like to have some guarantee that for example all
messages regarding a single video would be processed in the order they were
published.

I am not sure what would be the best way to deal with it so i ask you for
some directions or advice :)

Sorry for such a lengthy message and thank you very much for help

Artur

-- 
Visit me at:
http://artur.ejsmont.org/blog/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/30d85c7b/attachment.htm>

From dev440 at gmail.com  Thu Oct 18 10:44:58 2012
From: dev440 at gmail.com (chetan dev)
Date: Thu, 18 Oct 2012 15:14:58 +0530
Subject: [rabbitmq-discuss] RabbitMq Message Notification
In-Reply-To: <507FCB97.90208@rabbitmq.com>
References: <CAB0ZxM4jgOgJGebzAWf_qfARBEA--AB2NSPVyHARtssgNHJvFg@mail.gmail.com>
	<507FCB97.90208@rabbitmq.com>
Message-ID: <CAB0ZxM45W2yvBBFYdVru2cQGG2wxObB01_p8_Ks3y73PMfaZGw@mail.gmail.com>

Hi,

When a message is published in a queue , publisher application has done its
work now  how can i trigger that a message is received in queue in another
application. is there a service available for that or i need to make a
separate service or is there any other way?

Thanks

On Thu, Oct 18, 2012 at 2:57 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 18/10/12 10:24, chetan dev wrote:
>
>> Is there a service or by any mean i can generate an event  whenever
>> a message is received in a queue and which keeps monitoring it
>> continuosly.
>> i want to do it independently of application for  publisher. publisher
>> just publishes the message and thats it. i dont want anything to be done
>> on publishers side
>>
>
> Check out the firehose:
>
> http://www.rabbitmq.com/**firehose.html<http://www.rabbitmq.com/firehose.html>
>
> and the tracing plugin:
>
> http://hg.rabbitmq.com/**rabbitmq-tracing/file/**d809ae76b053/README<http://hg.rabbitmq.com/rabbitmq-tracing/file/d809ae76b053/README>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/8e773d5a/attachment.htm>

From simon at rabbitmq.com  Thu Oct 18 11:17:45 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Oct 2012 11:17:45 +0100
Subject: [rabbitmq-discuss] RabbitMq Message Notification
In-Reply-To: <CAB0ZxM45W2yvBBFYdVru2cQGG2wxObB01_p8_Ks3y73PMfaZGw@mail.gmail.com>
References: <CAB0ZxM4jgOgJGebzAWf_qfARBEA--AB2NSPVyHARtssgNHJvFg@mail.gmail.com>
	<507FCB97.90208@rabbitmq.com>
	<CAB0ZxM45W2yvBBFYdVru2cQGG2wxObB01_p8_Ks3y73PMfaZGw@mail.gmail.com>
Message-ID: <507FD749.3020104@rabbitmq.com>

It's not very clear what you are asking. If you are asking for something 
outside of your existing publisher and consumer apps to see messages 
that are published / consumed then the firehose / tracer are what you want.

But maybe it sounds like you are asking how a consuming app can know 
that a message has been published? Your consuming app should just 
consume from the queue - it will be given the message as soon as one 
arrives.

Cheers, Simon

On 18/10/12 10:44, chetan dev wrote:
> Hi,
>
> When a message is published in a queue , publisher application has done
> its work now  how can i trigger that a message is received in queue in
> another application. is there a service available for that or i need to
> make a separate service or is there any other way?
>
> Thanks
>
> On Thu, Oct 18, 2012 at 2:57 PM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 18/10/12 10:24, chetan dev wrote:
>
>         Is there a service or by any mean i can generate an event  whenever
>         a message is received in a queue and which keeps monitoring it
>         continuosly.
>         i want to do it independently of application for  publisher.
>         publisher
>         just publishes the message and thats it. i dont want anything to
>         be done
>         on publishers side
>
>
>     Check out the firehose:
>
>     http://www.rabbitmq.com/__firehose.html
>     <http://www.rabbitmq.com/firehose.html>
>
>     and the tracing plugin:
>
>     http://hg.rabbitmq.com/__rabbitmq-tracing/file/__d809ae76b053/README
>     <http://hg.rabbitmq.com/rabbitmq-tracing/file/d809ae76b053/README>
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>
>
>
> --
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
>


-- 
Simon MacMullen
RabbitMQ, VMware

From dev440 at gmail.com  Thu Oct 18 11:22:07 2012
From: dev440 at gmail.com (chetan dev)
Date: Thu, 18 Oct 2012 15:52:07 +0530
Subject: [rabbitmq-discuss] RabbitMq Message Notification
In-Reply-To: <507FD749.3020104@rabbitmq.com>
References: <CAB0ZxM4jgOgJGebzAWf_qfARBEA--AB2NSPVyHARtssgNHJvFg@mail.gmail.com>
	<507FCB97.90208@rabbitmq.com>
	<CAB0ZxM45W2yvBBFYdVru2cQGG2wxObB01_p8_Ks3y73PMfaZGw@mail.gmail.com>
	<507FD749.3020104@rabbitmq.com>
Message-ID: <CAB0ZxM5cY6ZoT=jCXfH1EiR41WHJbS=ZVFiB-MHeO5uK25XjTA@mail.gmail.com>

Hi,
Thanks for the prompt reply . what i meant was is there anything analogous
to MSMQ triggers in rabbitmq and similarly an MSMQ trigger service as given
by Microsoft.

Thanks in advance

On Thu, Oct 18, 2012 at 3:47 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> It's not very clear what you are asking. If you are asking for something
> outside of your existing publisher and consumer apps to see messages that
> are published / consumed then the firehose / tracer are what you want.
>
> But maybe it sounds like you are asking how a consuming app can know that
> a message has been published? Your consuming app should just consume from
> the queue - it will be given the message as soon as one arrives.
>
> Cheers, Simon
>
>
> On 18/10/12 10:44, chetan dev wrote:
>
>> Hi,
>>
>> When a message is published in a queue , publisher application has done
>> its work now  how can i trigger that a message is received in queue in
>> another application. is there a service available for that or i need to
>> make a separate service or is there any other way?
>>
>> Thanks
>>
>> On Thu, Oct 18, 2012 at 2:57 PM, Simon MacMullen <simon at rabbitmq.com
>> <mailto:simon at rabbitmq.com>> wrote:
>>
>>     On 18/10/12 10:24, chetan dev wrote:
>>
>>         Is there a service or by any mean i can generate an event
>>  whenever
>>         a message is received in a queue and which keeps monitoring it
>>         continuosly.
>>         i want to do it independently of application for  publisher.
>>         publisher
>>         just publishes the message and thats it. i dont want anything to
>>         be done
>>         on publishers side
>>
>>
>>     Check out the firehose:
>>
>>     http://www.rabbitmq.com/__**firehose.html<http://www.rabbitmq.com/__firehose.html>
>>
>>     <http://www.rabbitmq.com/**firehose.html<http://www.rabbitmq.com/firehose.html>
>> >
>>
>>     and the tracing plugin:
>>
>>     http://hg.rabbitmq.com/__**rabbitmq-tracing/file/__**
>> d809ae76b053/README<http://hg.rabbitmq.com/__rabbitmq-tracing/file/__d809ae76b053/README>
>>
>>     <http://hg.rabbitmq.com/**rabbitmq-tracing/file/**d809ae76b053/README<http://hg.rabbitmq.com/rabbitmq-tracing/file/d809ae76b053/README>
>> >
>>
>>     Cheers, Simon
>>
>>     --
>>     Simon MacMullen
>>     RabbitMQ, VMware
>>
>>
>>
>>
>> --
>> Cheten  Dev
>>
>> B.Tech Final Year
>> Dept. of Electrical Engg.
>> IIT Delhi, New Delhi
>> ph 8527333215
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/a19b8260/attachment.htm>

From simon at rabbitmq.com  Thu Oct 18 11:28:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 18 Oct 2012 11:28:04 +0100
Subject: [rabbitmq-discuss] RabbitMQ rendered non-operational after
 killing 1 node of 3 h/a
In-Reply-To: <CANVKUrXgWoSMoQWtUuYo37BaMPRq2Q3L3wSfgc=iCdcrAPKJRA@mail.gmail.com>
References: <CANVKUrXgWoSMoQWtUuYo37BaMPRq2Q3L3wSfgc=iCdcrAPKJRA@mail.gmail.com>
Message-ID: <507FD9B4.8030802@rabbitmq.com>

On 17/10/12 22:41, Eugene Kirpichov wrote:
> It seems like there was some internal error that lead to death of a
> mirrored queue coordinator process, or something... I'm attaching the
> log from rabbit01.

Thanks.

That looks like a bug which has been substantially mitigated since 
2.7.1, although a complete fix for it will be in the next release.

To be honest, we have fixed a lot of bugs in mirrored queues since 2.7.1 
- so I would strongly recommend an upgrade anyway.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Thu Oct 18 11:43:11 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 18 Oct 2012 11:43:11 +0100
Subject: [rabbitmq-discuss] question on message ordering guarantees
In-Reply-To: <CABv2Cn2J758KHSuT8ix5dczV3qA5-Xihospc7yzHwRQjSYpiLA@mail.gmail.com>
References: <CABv2Cn2J758KHSuT8ix5dczV3qA5-Xihospc7yzHwRQjSYpiLA@mail.gmail.com>
Message-ID: <507FDD3F.9080608@rabbitmq.com>

Hi

On 10/18/2012 10:30 AM, Artur Ejsmont wrote:
> Hi there everyone,
>
> I am working on a rabbitmq based messaging system and i was wondering 
> if you could help me out :)
>
> I was wondering how could i enforce events being processed in the 
> order they are published?
>

So from http://www.rabbitmq.com/semantics.html, we can see:

"Section 4.7 of the AMQP 0-9-1 core specification explains the 
conditions under which ordering is guaranteed: messages published in one 
channel, passing through one exchange and one queue and one outgoing 
channel will be received in the same order that they were sent. RabbitMQ 
offers stronger guarantees since release 2.7.0.

Messages can be returned to the queue using AMQP methods that feature a 
requeue parameter (basic.recover, basic.reject and basic.nack), or due 
to a channel closing while holding unacknowledged messages. Any of these 
scenarios caused messages to be requeued at the back of the queue for 
RabbitMQ releases earlier than 2.7.0. From RabbitMQ release 2.7.0, 
messages *are always held in the queue in publication order*, *even in 
the presence of requeueing or channel closure*.

With release 2.7.0 and later *it is still possible for individual 
consumers to observe messages out of order if the queue has multiple 
subscribers*. This is due to the actions of other subscribers who may 
requeue messages. From the perspective of the queue the messages are 
always held in the publication order."

So you've got to think about it in those terms. It's exactly the same 
with ActiveMQ message groups, because they are based on the Exclusive 
Consumer feature, which states: "The broker will pick a single 
MessageConsumer to get all the messages for a queue to ensure ordering. 
If that consumer fails, the broker will auto failover and choose another 
consumer." (http://activemq.apache.org/exclusive-consumer.html) except 
that groups are parallel, so: "... logically Message Groups are kinda 
like a parallel Exclusive Consumer 
<http://activemq.apache.org/exclusive-consumer.html>. Rather than all 
messages going to a single consumer, the standard JMS header 
*JMSXGroupID* is used to define which /message group/ the message 
belongs to. The Message Group feature then ensures that all messages for 
the same message group will be sent to the same JMS consumer - while 
that consumer stays alive. As soon as the consumer dies another will be 
chosen." (http://activemq.apache.org/message-groups.html).

You might be able kludge something similar using the consistent hash 
exchange plugin 
(http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/file/rabbitmq_v2_8_7/README.md) 
but you will *not* get the same kind of guarantees.

We have been asked about this feature before and will probably implement 
something like it in a future release.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/a09740b3/attachment.htm>

From alexis at rabbitmq.com  Thu Oct 18 12:03:53 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 18 Oct 2012 12:03:53 +0100
Subject: [rabbitmq-discuss] question on message ordering guarantees
In-Reply-To: <507FDD3F.9080608@rabbitmq.com>
References: <CABv2Cn2J758KHSuT8ix5dczV3qA5-Xihospc7yzHwRQjSYpiLA@mail.gmail.com>
	<507FDD3F.9080608@rabbitmq.com>
Message-ID: <CACOPnvcigoqyma51-HiYFToGOZEQ6JHaBLhVguae86iJna1shQ@mail.gmail.com>

If you use the consistent hashing exchange, then you can make sure
that two messages with the same key are sent to the same queue.  Then,
provided you do not allow parallel processing of those messages due to
how they are consumed, you can "process in order" as required.





On Thu, Oct 18, 2012 at 11:43 AM, Tim Watson <tim at rabbitmq.com> wrote:
> Hi
>
>
> On 10/18/2012 10:30 AM, Artur Ejsmont wrote:
>
> Hi there everyone,
>
> I am working on a rabbitmq based messaging system and i was wondering if you
> could help me out :)
>
> I was wondering how could i enforce events being processed in the order they
> are published?
>
>
> So from http://www.rabbitmq.com/semantics.html, we can see:
>
> "Section 4.7 of the AMQP 0-9-1 core specification explains the conditions
> under which ordering is guaranteed: messages published in one channel,
> passing through one exchange and one queue and one outgoing channel will be
> received in the same order that they were sent. RabbitMQ offers stronger
> guarantees since release 2.7.0.
>
> Messages can be returned to the queue using AMQP methods that feature a
> requeue parameter (basic.recover, basic.reject and basic.nack), or due to a
> channel closing while holding unacknowledged messages. Any of these
> scenarios caused messages to be requeued at the back of the queue for
> RabbitMQ releases earlier than 2.7.0. From RabbitMQ release 2.7.0, messages
> are always held in the queue in publication order, even in the presence of
> requeueing or channel closure.
>
> With release 2.7.0 and later it is still possible for individual consumers
> to observe messages out of order if the queue has multiple subscribers. This
> is due to the actions of other subscribers who may requeue messages. From
> the perspective of the queue the messages are always held in the publication
> order."
>
> So you've got to think about it in those terms. It's exactly the same with
> ActiveMQ message groups, because they are based on the Exclusive Consumer
> feature, which states: "The broker will pick a single MessageConsumer to get
> all the messages for a queue to ensure ordering. If that consumer fails, the
> broker will auto failover and choose another consumer."
> (http://activemq.apache.org/exclusive-consumer.html) except that groups are
> parallel, so: "... logically Message Groups are kinda like a parallel
> Exclusive Consumer. Rather than all messages going to a single consumer, the
> standard JMS header JMSXGroupID is used to define which message group the
> message belongs to. The Message Group feature then ensures that all messages
> for the same message group will be sent to the same JMS consumer - while
> that consumer stays alive. As soon as the consumer dies another will be
> chosen." (http://activemq.apache.org/message-groups.html).
>
> You might be able kludge something similar using the consistent hash
> exchange plugin
> (http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/file/rabbitmq_v2_8_7/README.md)
> but you will *not* get the same kind of guarantees.
>
> We have been asked about this feature before and will probably implement
> something like it in a future release.
>
> Cheers,
> Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From emile at rabbitmq.com  Thu Oct 18 12:11:39 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 18 Oct 2012 12:11:39 +0100
Subject: [rabbitmq-discuss] Unexpected log generated
In-Reply-To: <CAHv8OSSB5pQQ3mwin3oosONRxVeUFObk1Em2MiZfefc4BUhCQg@mail.gmail.com>
References: <507E90A1.7080502@gmail.com> <507E9139.4020706@rabbitmq.com>
	<CAHv8OSRTh6=yKDwcgNwRGy6Lz06ny1wozROHH1rs_0y23GoObQ@mail.gmail.com>
	<CAHv8OSSB5pQQ3mwin3oosONRxVeUFObk1Em2MiZfefc4BUhCQg@mail.gmail.com>
Message-ID: <507FE3EB.70101@rabbitmq.com>

Hi,

On 18/10/12 03:08, Wong Kam Hoong wrote:
> RabbitMQ *v2.8.7*
> Erlang *R14B04*
> 
> Sorry about the attachment, I don't know maximum size allowed limit to
> 1mb. Before I zip the log, the log original size was 30mb++.

Thank you for sending this information. In order for us to investigate
this further could you also please provide the output of "rabbitmqctl
report"?

The log shows nodes restarting a few times - is there a sequence of
events that reliably triggers these log entries?



-Emile


From alexis at rabbitmq.com  Thu Oct 18 12:05:47 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 18 Oct 2012 12:05:47 +0100
Subject: [rabbitmq-discuss] question on message ordering guarantees
In-Reply-To: <CACOPnvcigoqyma51-HiYFToGOZEQ6JHaBLhVguae86iJna1shQ@mail.gmail.com>
References: <CABv2Cn2J758KHSuT8ix5dczV3qA5-Xihospc7yzHwRQjSYpiLA@mail.gmail.com>
	<507FDD3F.9080608@rabbitmq.com>
	<CACOPnvcigoqyma51-HiYFToGOZEQ6JHaBLhVguae86iJna1shQ@mail.gmail.com>
Message-ID: <CACOPnvfyOUAUMb5KeHZxeXmc6O8=eKBAXWDVV7c5JppzZjeO4w@mail.gmail.com>

See the long discussion on ordering posted in the depths of the thread here:

http://www.quora.com/RabbitMQ/RabbitMQ-vs-Kafka-which-one-for-durable-messaging-with-good-query-features/

Note that Kafka has at most one consumer per 'partition' which is
equivalent to the property Tim described.


On Thu, Oct 18, 2012 at 12:03 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
> If you use the consistent hashing exchange, then you can make sure
> that two messages with the same key are sent to the same queue.  Then,
> provided you do not allow parallel processing of those messages due to
> how they are consumed, you can "process in order" as required.
>
>
>
>
>
> On Thu, Oct 18, 2012 at 11:43 AM, Tim Watson <tim at rabbitmq.com> wrote:
>> Hi
>>
>>
>> On 10/18/2012 10:30 AM, Artur Ejsmont wrote:
>>
>> Hi there everyone,
>>
>> I am working on a rabbitmq based messaging system and i was wondering if you
>> could help me out :)
>>
>> I was wondering how could i enforce events being processed in the order they
>> are published?
>>
>>
>> So from http://www.rabbitmq.com/semantics.html, we can see:
>>
>> "Section 4.7 of the AMQP 0-9-1 core specification explains the conditions
>> under which ordering is guaranteed: messages published in one channel,
>> passing through one exchange and one queue and one outgoing channel will be
>> received in the same order that they were sent. RabbitMQ offers stronger
>> guarantees since release 2.7.0.
>>
>> Messages can be returned to the queue using AMQP methods that feature a
>> requeue parameter (basic.recover, basic.reject and basic.nack), or due to a
>> channel closing while holding unacknowledged messages. Any of these
>> scenarios caused messages to be requeued at the back of the queue for
>> RabbitMQ releases earlier than 2.7.0. From RabbitMQ release 2.7.0, messages
>> are always held in the queue in publication order, even in the presence of
>> requeueing or channel closure.
>>
>> With release 2.7.0 and later it is still possible for individual consumers
>> to observe messages out of order if the queue has multiple subscribers. This
>> is due to the actions of other subscribers who may requeue messages. From
>> the perspective of the queue the messages are always held in the publication
>> order."
>>
>> So you've got to think about it in those terms. It's exactly the same with
>> ActiveMQ message groups, because they are based on the Exclusive Consumer
>> feature, which states: "The broker will pick a single MessageConsumer to get
>> all the messages for a queue to ensure ordering. If that consumer fails, the
>> broker will auto failover and choose another consumer."
>> (http://activemq.apache.org/exclusive-consumer.html) except that groups are
>> parallel, so: "... logically Message Groups are kinda like a parallel
>> Exclusive Consumer. Rather than all messages going to a single consumer, the
>> standard JMS header JMSXGroupID is used to define which message group the
>> message belongs to. The Message Group feature then ensures that all messages
>> for the same message group will be sent to the same JMS consumer - while
>> that consumer stays alive. As soon as the consumer dies another will be
>> chosen." (http://activemq.apache.org/message-groups.html).
>>
>> You might be able kludge something similar using the consistent hash
>> exchange plugin
>> (http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/file/rabbitmq_v2_8_7/README.md)
>> but you will *not* get the same kind of guarantees.
>>
>> We have been asked about this feature before and will probably implement
>> something like it in a future release.
>>
>> Cheers,
>> Tim
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>

From ejsmont.artur at gmail.com  Thu Oct 18 12:25:04 2012
From: ejsmont.artur at gmail.com (Artur Ejsmont)
Date: Thu, 18 Oct 2012 22:25:04 +1100
Subject: [rabbitmq-discuss] question on message ordering guarantees
In-Reply-To: <CACOPnvfyOUAUMb5KeHZxeXmc6O8=eKBAXWDVV7c5JppzZjeO4w@mail.gmail.com>
References: <CABv2Cn2J758KHSuT8ix5dczV3qA5-Xihospc7yzHwRQjSYpiLA@mail.gmail.com>
	<507FDD3F.9080608@rabbitmq.com>
	<CACOPnvcigoqyma51-HiYFToGOZEQ6JHaBLhVguae86iJna1shQ@mail.gmail.com>
	<CACOPnvfyOUAUMb5KeHZxeXmc6O8=eKBAXWDVV7c5JppzZjeO4w@mail.gmail.com>
Message-ID: <CABv2Cn3i6AW1Fto38NqFj0Tp-kY8p3i1XSjrAguS0wV3GWS8Ug@mail.gmail.com>

Thanks guys! these were very helpful and quick responses.

I will read the docs you recommended and come back in case of any further
ideas or questions :)

Thanks a lot

Art

On 18 October 2012 22:05, Alexis Richardson <alexis at rabbitmq.com> wrote:

> See the long discussion on ordering posted in the depths of the thread
> here:
>
>
> http://www.quora.com/RabbitMQ/RabbitMQ-vs-Kafka-which-one-for-durable-messaging-with-good-query-features/
>
> Note that Kafka has at most one consumer per 'partition' which is
> equivalent to the property Tim described.
>
>
> On Thu, Oct 18, 2012 at 12:03 PM, Alexis Richardson <alexis at rabbitmq.com>
> wrote:
> > If you use the consistent hashing exchange, then you can make sure
> > that two messages with the same key are sent to the same queue.  Then,
> > provided you do not allow parallel processing of those messages due to
> > how they are consumed, you can "process in order" as required.
> >
> >
> >
> >
> >
> > On Thu, Oct 18, 2012 at 11:43 AM, Tim Watson <tim at rabbitmq.com> wrote:
> >> Hi
> >>
> >>
> >> On 10/18/2012 10:30 AM, Artur Ejsmont wrote:
> >>
> >> Hi there everyone,
> >>
> >> I am working on a rabbitmq based messaging system and i was wondering
> if you
> >> could help me out :)
> >>
> >> I was wondering how could i enforce events being processed in the order
> they
> >> are published?
> >>
> >>
> >> So from http://www.rabbitmq.com/semantics.html, we can see:
> >>
> >> "Section 4.7 of the AMQP 0-9-1 core specification explains the
> conditions
> >> under which ordering is guaranteed: messages published in one channel,
> >> passing through one exchange and one queue and one outgoing channel
> will be
> >> received in the same order that they were sent. RabbitMQ offers stronger
> >> guarantees since release 2.7.0.
> >>
> >> Messages can be returned to the queue using AMQP methods that feature a
> >> requeue parameter (basic.recover, basic.reject and basic.nack), or due
> to a
> >> channel closing while holding unacknowledged messages. Any of these
> >> scenarios caused messages to be requeued at the back of the queue for
> >> RabbitMQ releases earlier than 2.7.0. From RabbitMQ release 2.7.0,
> messages
> >> are always held in the queue in publication order, even in the presence
> of
> >> requeueing or channel closure.
> >>
> >> With release 2.7.0 and later it is still possible for individual
> consumers
> >> to observe messages out of order if the queue has multiple subscribers.
> This
> >> is due to the actions of other subscribers who may requeue messages.
> From
> >> the perspective of the queue the messages are always held in the
> publication
> >> order."
> >>
> >> So you've got to think about it in those terms. It's exactly the same
> with
> >> ActiveMQ message groups, because they are based on the Exclusive
> Consumer
> >> feature, which states: "The broker will pick a single MessageConsumer
> to get
> >> all the messages for a queue to ensure ordering. If that consumer
> fails, the
> >> broker will auto failover and choose another consumer."
> >> (http://activemq.apache.org/exclusive-consumer.html) except that
> groups are
> >> parallel, so: "... logically Message Groups are kinda like a parallel
> >> Exclusive Consumer. Rather than all messages going to a single
> consumer, the
> >> standard JMS header JMSXGroupID is used to define which message group
> the
> >> message belongs to. The Message Group feature then ensures that all
> messages
> >> for the same message group will be sent to the same JMS consumer - while
> >> that consumer stays alive. As soon as the consumer dies another will be
> >> chosen." (http://activemq.apache.org/message-groups.html).
> >>
> >> You might be able kludge something similar using the consistent hash
> >> exchange plugin
> >> (
> http://hg.rabbitmq.com/rabbitmq-consistent-hash-exchange/file/rabbitmq_v2_8_7/README.md
> )
> >> but you will *not* get the same kind of guarantees.
> >>
> >> We have been asked about this feature before and will probably implement
> >> something like it in a future release.
> >>
> >> Cheers,
> >> Tim
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
>



-- 
Visit me at:
http://artur.ejsmont.org/blog/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/e3d754b3/attachment.htm>

From ekirpichov at gmail.com  Thu Oct 18 15:48:59 2012
From: ekirpichov at gmail.com (Eugene Kirpichov)
Date: Thu, 18 Oct 2012 07:48:59 -0700
Subject: [rabbitmq-discuss] RabbitMQ rendered non-operational after
 killing 1 node of 3 h/a
In-Reply-To: <507FD9B4.8030802@rabbitmq.com>
References: <CANVKUrXgWoSMoQWtUuYo37BaMPRq2Q3L3wSfgc=iCdcrAPKJRA@mail.gmail.com>
	<507FD9B4.8030802@rabbitmq.com>
Message-ID: <CANVKUrWFZpfbsZPDMQwDL-qGwhie7PHrAAJu+M-LjVd47cG2AQ@mail.gmail.com>

Thanks Simon! I'll try that with 2.8.7.

On Thu, Oct 18, 2012 at 3:28 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 17/10/12 22:41, Eugene Kirpichov wrote:
>>
>> It seems like there was some internal error that lead to death of a
>> mirrored queue coordinator process, or something... I'm attaching the
>> log from rabbit01.
>
>
> Thanks.
>
> That looks like a bug which has been substantially mitigated since 2.7.1,
> although a complete fix for it will be in the next release.
>
> To be honest, we have fixed a lot of bugs in mirrored queues since 2.7.1 -
> so I would strongly recommend an upgrade anyway.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware



-- 
Eugene Kirpichov
http://www.linkedin.com/in/eugenekirpichov
We're hiring! http://tinyurl.com/mirantis-openstack-engineer

From michael.justin at gmx.net  Thu Oct 18 17:11:52 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 18 Oct 2012 18:11:52 +0200
Subject: [rabbitmq-discuss] STOMP plugin - durable subscription limitation
Message-ID: <k5p9o9$kqi$1@ger.gmane.org>

Hello,

there is a limitation in the STOMP plugin when using durable subscriptions.

With normal topic destinations, the SUBSCRIBE command can use different 
'id' frame headers to create concurrent subscriptions for the same 
topic. This can be achieved by assigning a unique identifier per 
consumer, so that incoming messages can be routed to the consumer based 
on the value of the subscription id header. Example:

1. RabbitMQ with a normal (non-durable) subscription

SUBSCRIBE
destination:/topic/ExampleTopic
ack:auto
id:{F09BD8A4-0C7B-4830-B4B5-B3F5D76E5A7C}

MESSAGE
message-id:id123
destination:/topic/ExampleTopic
subscription:{F09BD8A4-0C7B-4830-B4B5-B3F5D76E5A7C}


However, RabbitMQ uses the id header differently for topic 
subscriptions. Sending and receiving requires to set the same value, so 
that consumers are not able to assign any random identifier in the 
SUBSCRIBE frame. Is this correct so far and as designed?

This has the effect that a client can not handle more than one consumer 
for the same durable subscription because a SUBSCRIBE frame can not use 
a client-side assigned identifier in the same way and use it to route 
incoming messages based on this id between internal 'consumers'.

Example:

2. RabbitMQ with durable subscription

SUBSCRIBE
destination:/topic/TOOL.DEFAULT
receipt:yes
ack:auto
id:durable-subscription-name
persistent:true

received:
MESSAGE
receipt:receipt
persistent:true
content-type:text/plain
subscription:durable-subscription-name
destination:/topic/TOOL.DEFAULT
message-id:T_durable-subscription-name@@session-whuoJn95NxH3Ic-lQIr-Wl@@1
content-length:9

In ActiveMQ and other brokers with STOMP support, a durable topic 
subscription uses a special header for the subscription id 
(activemq.subscriptionName), which leaves the id header still available 
for a client-assigned unique identifer.

3. ActiveMQ example

SUBSCRIBE
destination:/topic/TEST.DEFAULT
ack:auto
id:{F09BD8A4-0C7B-4830-B4B5-B3F5D76E5A7C}
activemq.subscriptionName:test

MESSAGE
message-id:ID:mj-PC-49312-1350574103726-4:2:-1:1:1
destination:/topic/TEST.DEFAULT
timestamp:1350574179240
expires:0
subscription:{F09BD8A4-0C7B-4830-B4B5-B3F5D76E5A7C}
persistent:true
priority:4

The STOMP 1.0 specification says:

"You can also specify an id header which can then later on be used to 
UNSUBSCRIBE from the specific subscription as you may end up with 
overlapping subscriptions using selectors with the same destination."

In RabbitMQ however, overlapping subscriptions seem to be impossible for 
a durable topic, as there is no way to specify unique values for the id. 
Is this correct?

Many thanks in advance
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From tom.brandish at tekcomms.com  Thu Oct 18 17:28:08 2012
From: tom.brandish at tekcomms.com (Brandish, Tom)
Date: Thu, 18 Oct 2012 16:28:08 +0000
Subject: [rabbitmq-discuss] Problems compiling RabbitMQ-C Kit on
	Sparc	32-bit...
In-Reply-To: <CALPqkioe-VGvg1U3-3+J9LSeE2Q17RdaHgza8YhufJ1hHf9OhA@mail.gmail.com>
References: <4EF820DB2B020C42A6AE6807469B524D0148A4B2@US-PLNO-EXM01-P.global.tektronix.net>
	<CALPqkiqHVB8A7doUoiJpUtU1W5_WdGFH+oC9qN_GGs3ZoByPQg@mail.gmail.com>
	<CALPqkioe-VGvg1U3-3+J9LSeE2Q17RdaHgza8YhufJ1hHf9OhA@mail.gmail.com>
Message-ID: <4EF820DB2B020C42A6AE6807469B524D0149E651@US-PLNO-EXM01-P.global.tektronix.net>

Brett,

Thanks for your responses.  I created a new header file with your definitions, included it and was able to compile.

Appreciate your help.

Best Regards,
Tom Brandish

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Brett Cameron
Sent: Wednesday, October 17, 2012 10:15 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Problems compiling RabbitMQ-C Kit on Sparc 32-bit...

Tom,

Just thinking about it, network byte order and Solaris SPARC are both big endian, so you can probably just do something like the following (or some variant thereof):

#if defined(__sparc)
#define ntohll(x) (x)
#define htonll(x) (x)
#endif

Regards,
Brett
On Thu, Oct 18, 2012 at 11:00 AM, Brett Cameron <brett.r.cameron at gmail.com<mailto:brett.r.cameron at gmail.com>> wrote:
Tom,

I think you've got a couple of problems here. I don't have access to a 32-bit Solaris system right now to check, but first up I suspect that you might need to add something like "-lsocket -lxnet -lnsl" to the link statement. This should resolve most of the missing symbols, but my guess is that htonll() will be missing on your (I'm guessing reasonably old) system. There should be ways and means around this... I might just be able to get access to a suitable machine and have a look into it.

Brett


On Thu, Oct 18, 2012 at 10:32 AM, Brandish, Tom <tom.brandish at tekcomms.com<mailto:tom.brandish at tekcomms.com>> wrote:
Hi,

I have been able to successfully compile RabbitMQ-C on 64-bit Linux, but I am having difficulty doing so on Sparc 32-bit.  It looks I am missing some headers but with some 64-bit routines but why would I need the 64-bit stuff while compiling on a 32-bit system?

Here is my log:

aclocal: writing aclocal.m4
autoreconf: Entering directory `.'
autoreconf: configure.ac<http://configure.ac>: not using Gettext
autoreconf: running: aclocal -I m4
autoreconf: configure.ac<http://configure.ac>: tracing
autoreconf: running: libtoolize --copy
libtoolize: putting auxiliary files in `.'.
libtoolize: copying file `./ltmain.sh'
libtoolize: putting macros in AC_CONFIG_MACRO_DIR, `m4'.
libtoolize: copying file `m4/libtool.m4'
libtoolize: copying file `m4/ltoptions.m4'
libtoolize: copying file `m4/ltsugar.m4'
libtoolize: copying file `m4/ltversion.m4'
libtoolize: copying file `m4/lt~obsolete.m4'
autoreconf: running: /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/autoconf
autoreconf: running: /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/autoheader
autoreconf: running: automake --add-missing --copy --no-force
configure.ac:29<http://configure.ac:29>: installing `./config.guess'
configure.ac:29<http://configure.ac:29>: installing `./config.sub'
configure.ac:22<http://configure.ac:22>: installing `./install-sh'
configure.ac:22<http://configure.ac:22>: installing `./missing'
Makefile.am: installing `./depcomp'
autoreconf: Leaving directory `.'
checking for a BSD-compatible install... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking for style of include used by make... GNU
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables...
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking dependency style of gcc... gcc3
checking how to run the C preprocessor... gcc -E
checking for grep that handles long lines and -e... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
checking for egrep... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking minix/config.h usability... no
checking minix/config.h presence... no
checking for minix/config.h... no
checking whether it is safe to define __EXTENSIONS__... yes
checking build system type... sparc-sun-solaris2.10
checking host system type... sparc-sun-solaris2.10
checking how to print strings... printf
checking for a sed that does not truncate output... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/sed
checking for fgrep... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep -F
checking for ld used by gcc... /sea/compilers/native/gcc-4.4.5/V1.3/bin/ld
checking if the linker (/sea/compilers/native/gcc-4.4.5/V1.3/bin/ld) is GNU ld... yes
checking for BSD- or MS-compatible name lister (nm)... /sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B
checking the name lister (/sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B) interface... BSD nm
checking whether ln -s works... yes
checking the maximum length of command line arguments... 786240
checking whether the shell understands some XSI constructs... yes
checking whether the shell understands "+="... no
checking how to convert sparc-sun-solaris2.10 file names to sparc-sun-solaris2.10 format... func_convert_file_noop
checking how to convert sparc-sun-solaris2.10 file names to toolchain format... func_convert_file_noop
checking for /sea/compilers/native/gcc-4.4.5/V1.3/bin/ld option to reload object files... -r
checking for objdump... objdump
checking how to recognize dependent libraries... pass_all
checking for dlltool... no
checking how to associate runtime and link libraries... printf %s\n
checking for ar... ar
checking for archiver @FILE support... @
checking for strip... strip
checking for ranlib... ranlib
checking command to parse /sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B output from gcc object... ok
checking for sysroot... no
checking for mt... mt
checking if mt is a manifest tool... no
checking for dlfcn.h... yes
checking for objdir... .libs
checking if gcc supports -fno-rtti -fno-exceptions... no
checking for gcc option to produce PIC... -fPIC -DPIC
checking if gcc PIC flag -fPIC -DPIC works... yes
checking if gcc static flag -static works... no
checking if gcc supports -c -o file.o... yes
checking if gcc supports -c -o file.o... (cached) yes
checking whether the gcc linker (/sea/compilers/native/gcc-4.4.5/V1.3/bin/ld) supports shared libraries... yes
checking whether -lc should be explicitly linked in... yes
checking dynamic linker characteristics... solaris2.10 ld.so
checking how to hardcode library paths into programs... immediate
checking whether stripping libraries is possible... yes
checking if libtool supports shared libraries... yes
checking whether to build shared libraries... yes
checking whether to build static libraries... no
checking for gcc option to accept ISO C99... -std=gnu99
checking whether byte ordering is bigendian... yes
checking for inline... inline
checking if compiler accepts '-Wall'... yes
checking if compiler accepts '-Wextra'... yes
checking if compiler accepts '-pedantic'... yes
checking if compiler accepts '-Wstrict-prototypes'... yes
checking if compiler accepts '-Wcast-align'... yes
checking if compiler accepts '-fno-common'... yes
checking if compiler accepts '-fvisibility=hidden'... yes
checking if linker accepts '-no-undefined'... yes
checking for a Python interpreter with version >= 2.5... python
checking for python... /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/python
checking for python version... 2.7
checking for python platform... sunos5
checking for python script directory... ${prefix}/lib/python2.7/site-packages
checking for python extension module directory... ${exec_prefix}/lib/python2.7/site-packages
checking python module: json... yes
checking for popt.h... no
checking for poptGetContext in -lpopt... no
configure: creating ./config.status
config.status: creating librabbitmq.pc
config.status: creating Makefile
config.status: creating config.h
config.status: executing depfiles commands
config.status: executing libtool commands
configure: WARNING: unrecognized options: --enable-32-bit

rabbitmq-c build options:
        Host: sparc-sun-solaris2.10
        Version: 0.2.0
        64-bit: no
        Tools: no
        Documentation: no

  GEN    librabbitmq/amqp_framing.h
  GEN    librabbitmq/amqp_framing.c
make  all-am
make[1]: Entering directory `/home/spiuser/gitwa/rabbitmq-c'
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_api.lo
In file included from librabbitmq/amqp_api.c:37:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_connection.lo
In file included from librabbitmq/amqp_connection.c:37:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
librabbitmq/amqp_connection.c: In function 'amqp_send_frame':
librabbitmq/amqp_connection.c:365: warning: pointer targets in assignment differ in signedness
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_framing.lo
In file included from librabbitmq/amqp_framing.c:38:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_mem.lo
In file included from librabbitmq/amqp_mem.c:37:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_socket.lo
In file included from librabbitmq/amqp_socket.c:37:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_table.lo
In file included from librabbitmq/amqp_table.c:37:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_url.lo
In file included from librabbitmq/amqp_url.c:37:
librabbitmq/amqp_private.h: In function 'amqp_e64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
librabbitmq/amqp_private.h: In function 'amqp_d64':
librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CC     librabbitmq/unix/librabbitmq_librabbitmq_la-socket.lo
In file included from librabbitmq/unix/socket.c:37:
./librabbitmq/amqp_private.h: In function 'amqp_e64':
./librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'htonll'
./librabbitmq/amqp_private.h: In function 'amqp_d64':
./librabbitmq/amqp_private.h:251: warning: implicit declaration of function 'ntohll'
  CCLD   librabbitmq/librabbitmq.la<http://librabbitmq.la>
  CC     examples/examples_libutils_la-utils.lo
  CC     examples/unix/examples_libutils_la-platform_utils.lo
  CCLD   examples/libutils.la<http://libutils.la>
  CC     examples/amqp_bind.o
  CCLD   examples/amqp_bind
librabbitmq/.libs/librabbitmq.so: undefined reference to `connect'
librabbitmq/.libs/librabbitmq.so: undefined reference to `ntohll'
librabbitmq/.libs/librabbitmq.so: undefined reference to `send'
librabbitmq/.libs/librabbitmq.so: undefined reference to `freeaddrinfo'
librabbitmq/.libs/librabbitmq.so: undefined reference to `htonll'
librabbitmq/.libs/librabbitmq.so: undefined reference to `recv'
librabbitmq/.libs/librabbitmq.so: undefined reference to `setsockopt'
librabbitmq/.libs/librabbitmq.so: undefined reference to `socket'
librabbitmq/.libs/librabbitmq.so: undefined reference to `getaddrinfo'
collect2: ld returned 1 exit status


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/f5f1115c/attachment.htm>

From haggardii at gmail.com  Thu Oct 18 15:33:34 2012
From: haggardii at gmail.com (Matt Haggard)
Date: Thu, 18 Oct 2012 08:33:34 -0600
Subject: [rabbitmq-discuss] Typos on tutorials
Message-ID: <CAL+xXwNZsKaBdWsGeZeW=oR5QmaTzP7WEi_X++qVq7OB0NpXNQ@mail.gmail.com>

Thank you for the great tutorials!  I noticed three typos on them:

http://www.rabbitmq.com/tutorials/tutorial-one-python.html
s/to the one queue/to one queue/

http://www.rabbitmq.com/tutorials/tutorial-two-python.html
s/using Task Queue/using a Task Queue/

http://www.rabbitmq.com/tutorials/tutorial-six-python.html
s/request is send to/request is sent to/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/ee7a5dd6/attachment.htm>

From nicolas.bosansky at gmail.com  Thu Oct 18 16:50:07 2012
From: nicolas.bosansky at gmail.com (Nicolas Bosansky)
Date: Thu, 18 Oct 2012 08:50:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue consumers are blocked on
	SocketInputStream.socketRead0
Message-ID: <7e422990-7a67-4dca-8ada-aead1e225cc7@googlegroups.com>

Hello,
We have a rabbitMQ consumer that takes messages from a queue and write them 
in a HBase store.
When HBase connection fails, the consumer get an exception and messages are 
not acknowledged, that's ok.
After a few minutes, the consumer doesn't get messages anymore, even after 
restarting Hbase.

When debugging rabbitMQ client, we have noticed, that it is blocked on the 
following line: SocketInputStream:129 ( Java build 1.6.0_33-b03)
The Frame class is waiting for messages, but the used socket doesn't 
receive any data anymore.
We also notice, that there is no timeout on this socket.

  public static Frame readFrom(DataInputStream is) throws IOException {
        int type;
        int channel;

        try {
            type = is.readUnsignedByte();
        } catch (SocketTimeoutException ste) {
            // System.err.println("Timed out waiting for a frame.");
            return null; // failed
        }
        ....
}

Here is my rabbitMQ report : 

Reporting server status on {{2012,10,18},{15,39,34}}

Status of node rabbit at localhost
[{pid,20127},
 {running_applications,[{rabbit,"RabbitMQ","2.7.1"},
                        {os_mon,"CPO  CXC 138 46","2.2.7"},
                        {sasl,"SASL  CXC 138 11","2.1.10"},
                        {mnesia,"MNESIA  CXC 138 12","4.5"},
                        {stdlib,"ERTS  CXC 138 10","1.17.5"},
                        {kernel,"ERTS  CXC 138 10","2.14.5"}]},
 {os,{unix,linux}},
 {erlang_version,"Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:4:4] 
[rq:4] [async-threads:30] [kernel-poll:true]\n"},
 {memory,[{total,47487536},
          {processes,12533768},
          {processes_used,12228104},
          {system,34953768},
          {atom,1183993},
          {atom_used,1157601},
          {binary,16573424},
          {code,11134417},
          {ets,4108160}]},
 {vm_memory_high_watermark,0.39999999990305685},
 {vm_memory_limit,3300904140}]

Cluster status of node rabbit at samcrow ...
[{nodes,[{disc,[rabbit at samcrow]}]},{running_nodes,[rabbit at samcrow]}]

Application environment of node rabbit at samcrow ...
[{auth_backends,[rabbit_auth_backend_internal]},
 {auth_mechanisms,['PLAIN','AMQPLAIN']},
 {backing_queue_module,rabbit_variable_queue},
 {cluster_nodes,[]},
 {collect_statistics,none},
 {collect_statistics_interval,5000},
 {default_permissions,[<<".*">>,<<".*">>,<<".*">>]},
 {default_user,<<"guest">>},
 {default_user_tags,[administrator]},
 {default_vhost,<<"/">>},
 {delegate_count,16},
 {error_logger,{file,"/var/log/rabbitmq/rabbit at samcrow.log"}},
 {frame_max,131072},
 {hipe_compile,false},
 {included_applications,[]},
 {msg_store_file_size_limit,16777216},
 {msg_store_index_module,rabbit_msg_store_ets_index},
 {queue_index_max_journal_entries,262144},
 {sasl_error_logger,{file,"/var/log/rabbitmq/rabbit at samcrow-sasl.log"}},
 {server_properties,[]},
 {ssl_listeners,[]},
 {ssl_options,[]},
 {tcp_listen_options,[binary,
                      {packet,raw},
                      {reuseaddr,true},
                      {backlog,128},
                      {nodelay,true},
                      {exit_on_close,false}]},
 {tcp_listeners,[5672]},
 {trace_vhosts,[]},
 {vm_memory_high_watermark,0.4}]

Connections:
pid address port peer_address peer_port ssl peer_cert_subject 
peer_cert_issuer peer_cert_validity auth_mechanism ssl_protocol 
ssl_key_exchange ssl_cipher ssl_hash protocol user vhost timeout frame_max 
client_properties recv_oct recv_cnt send_oct send_cnt send_pend state 
channels
<rabbit at samcrow.2.2883.0> 127.0.0.1 5672 127.0.0.1 15220 false PLAIN {0,9,1} 
guest / 0 131072[{"product","RabbitMQ"},{"information","Licensed under the 
MPL. See 
http://www.rabbitmq.com/"},{"platform","Java"},{"capabilities",[{"exchange_exchange_bindings",true},{"consumer_cancel_notify",true},{"basic.nack",true},{"publisher_confirms",true}]},{"copyright","Copyright 
(C) 2007-2012 VMware, Inc."},{"version","2.8.1"}] 11864749 27712 26676264 
11607 0 running 23

I use rabbitMQ client version 2.8.1.

Do you have any idea ?
Thanks in advance,
Nicolas




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/eb96cc48/attachment.htm>

From alan.antonuk at gmail.com  Thu Oct 18 18:28:52 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 18 Oct 2012 13:28:52 -0400
Subject: [rabbitmq-discuss] Problems compiling RabbitMQ-C Kit on Sparc
	32-bit...
In-Reply-To: <4EF820DB2B020C42A6AE6807469B524D0149E651@US-PLNO-EXM01-P.global.tektronix.net>
References: <4EF820DB2B020C42A6AE6807469B524D0148A4B2@US-PLNO-EXM01-P.global.tektronix.net>
	<CALPqkiqHVB8A7doUoiJpUtU1W5_WdGFH+oC9qN_GGs3ZoByPQg@mail.gmail.com>
	<CALPqkioe-VGvg1U3-3+J9LSeE2Q17RdaHgza8YhufJ1hHf9OhA@mail.gmail.com>
	<4EF820DB2B020C42A6AE6807469B524D0149E651@US-PLNO-EXM01-P.global.tektronix.net>
Message-ID: <CAAt2poK+-A+WvkVrBobuPS-Gdr6KbdzZvRVM6twq_LgWUdxNqw@mail.gmail.com>

Good to see you found a workaround for these issues.

I hope to provide fixes for these issues in the future.

I've added these to the bug tracker as two separate issues:
https://github.com/alanxz/rabbitmq-c/issues/66 (the htonll/ntohll issue)

https://github.com/alanxz/rabbitmq-c/issues/67 (the issue of linking
against the socket and networking libraries)

-Alan

On Thu, Oct 18, 2012 at 12:28 PM, Brandish, Tom
<tom.brandish at tekcomms.com>wrote:

>  Brett,****
>
> ** **
>
> Thanks for your responses.  I created a new header file with your
> definitions, included it and was able to compile.****
>
> ** **
>
> Appreciate your help.****
>
> ** **
>
> Best Regards,****
>
> Tom Brandish****
>
> ** **
>
> *From:* rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Brett Cameron
> *Sent:* Wednesday, October 17, 2012 10:15 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] Problems compiling RabbitMQ-C Kit on
> Sparc 32-bit...****
>
> ** **
>
> Tom,
>
> Just thinking about it, network byte order and Solaris SPARC are both big
> endian, so you can probably just do something like the following (or some
> variant thereof):
>
> #if defined(__sparc)
> #define ntohll(x) (x)
> #define htonll(x) (x)
> #endif
>
> Regards,
> Brett****
>
> On Thu, Oct 18, 2012 at 11:00 AM, Brett Cameron <brett.r.cameron at gmail.com>
> wrote:****
>
> Tom,
>
> I think you've got a couple of problems here. I don't have access to a
> 32-bit Solaris system right now to check, but first up I suspect that you
> might need to add something like "-lsocket -lxnet -lnsl" to the link
> statement. This should resolve most of the missing symbols, but my guess is
> that htonll() will be missing on your (I'm guessing reasonably old) system.
> There should be ways and means around this... I might just be able to get
> access to a suitable machine and have a look into it.
>
> Brett
>
>
> ****
>
> On Thu, Oct 18, 2012 at 10:32 AM, Brandish, Tom <tom.brandish at tekcomms.com>
> wrote:****
>
>   Hi,****
>
>  ****
>
> I have been able to successfully compile RabbitMQ-C on 64-bit Linux, but I
> am having difficulty doing so on Sparc 32-bit.  It looks I am missing some
> headers but with some 64-bit routines but why would I need the 64-bit stuff
> while compiling on a 32-bit system?****
>
>  ****
>
> Here is my log:****
>
>  ****
>
> aclocal: writing aclocal.m4****
>
> autoreconf: Entering directory `.'****
>
> autoreconf: configure.ac: not using Gettext****
>
> autoreconf: running: aclocal -I m4****
>
> autoreconf: configure.ac: tracing****
>
> autoreconf: running: libtoolize --copy****
>
> libtoolize: putting auxiliary files in `.'.****
>
> libtoolize: copying file `./ltmain.sh'****
>
> libtoolize: putting macros in AC_CONFIG_MACRO_DIR, `m4'.****
>
> libtoolize: copying file `m4/libtool.m4'****
>
> libtoolize: copying file `m4/ltoptions.m4'****
>
> libtoolize: copying file `m4/ltsugar.m4'****
>
> libtoolize: copying file `m4/ltversion.m4'****
>
> libtoolize: copying file `m4/lt~obsolete.m4'****
>
> autoreconf: running:
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/autoconf
> ****
>
> autoreconf: running:
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/autoheader
> ****
>
> autoreconf: running: automake --add-missing --copy --no-force****
>
> configure.ac:29: installing `./config.guess'****
>
> configure.ac:29: installing `./config.sub'****
>
> configure.ac:22: installing `./install-sh'****
>
> configure.ac:22: installing `./missing'****
>
> Makefile.am: installing `./depcomp'****
>
> autoreconf: Leaving directory `.'****
>
> checking for a BSD-compatible install...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/install
> -c****
>
> checking whether build environment is sane... yes****
>
> checking for a thread-safe mkdir -p...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/mkdir
> -p****
>
> checking for gawk... gawk****
>
> checking whether make sets $(MAKE)... yes****
>
> checking for style of include used by make... GNU****
>
> checking for gcc... gcc****
>
> checking whether the C compiler works... yes****
>
> checking for C compiler default output file name... a.out****
>
> checking for suffix of executables...****
>
> checking whether we are cross compiling... no****
>
> checking for suffix of object files... o****
>
> checking whether we are using the GNU C compiler... yes****
>
> checking whether gcc accepts -g... yes****
>
> checking for gcc option to accept ISO C89... none needed****
>
> checking dependency style of gcc... gcc3****
>
> checking how to run the C preprocessor... gcc -E****
>
> checking for grep that handles long lines and -e...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
> ****
>
> checking for egrep...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
> -E****
>
> checking for ANSI C header files... yes****
>
> checking for sys/types.h... yes****
>
> checking for sys/stat.h... yes****
>
> checking for stdlib.h... yes****
>
> checking for string.h... yes****
>
> checking for memory.h... yes****
>
> checking for strings.h... yes****
>
> checking for inttypes.h... yes****
>
> checking for stdint.h... yes****
>
> checking for unistd.h... yes****
>
> checking minix/config.h usability... no****
>
> checking minix/config.h presence... no****
>
> checking for minix/config.h... no****
>
> checking whether it is safe to define __EXTENSIONS__... yes****
>
> checking build system type... sparc-sun-solaris2.10****
>
> checking host system type... sparc-sun-solaris2.10****
>
> checking how to print strings... printf****
>
> checking for a sed that does not truncate output...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/sed
> ****
>
> checking for fgrep...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
> -F****
>
> checking for ld used by gcc... /sea/compilers/native/gcc-4.4.5/V1.3/bin/ld
> ****
>
> checking if the linker (/sea/compilers/native/gcc-4.4.5/V1.3/bin/ld) is
> GNU ld... yes****
>
> checking for BSD- or MS-compatible name lister (nm)...
> /sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B****
>
> checking the name lister (/sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B)
> interface... BSD nm****
>
> checking whether ln -s works... yes****
>
> checking the maximum length of command line arguments... 786240****
>
> checking whether the shell understands some XSI constructs... yes****
>
> checking whether the shell understands "+="... no****
>
> checking how to convert sparc-sun-solaris2.10 file names to
> sparc-sun-solaris2.10 format... func_convert_file_noop****
>
> checking how to convert sparc-sun-solaris2.10 file names to toolchain
> format... func_convert_file_noop****
>
> checking for /sea/compilers/native/gcc-4.4.5/V1.3/bin/ld option to reload
> object files... -r****
>
> checking for objdump... objdump****
>
> checking how to recognize dependent libraries... pass_all****
>
> checking for dlltool... no****
>
> checking how to associate runtime and link libraries... printf %s\n****
>
> checking for ar... ar****
>
> checking for archiver @FILE support... @****
>
> checking for strip... strip****
>
> checking for ranlib... ranlib****
>
> checking command to parse /sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B
> output from gcc object... ok****
>
> checking for sysroot... no****
>
> checking for mt... mt****
>
> checking if mt is a manifest tool... no****
>
> checking for dlfcn.h... yes****
>
> checking for objdir... .libs****
>
> checking if gcc supports -fno-rtti -fno-exceptions... no****
>
> checking for gcc option to produce PIC... -fPIC -DPIC****
>
> checking if gcc PIC flag -fPIC -DPIC works... yes****
>
> checking if gcc static flag -static works... no****
>
> checking if gcc supports -c -o file.o... yes****
>
> checking if gcc supports -c -o file.o... (cached) yes****
>
> checking whether the gcc linker
> (/sea/compilers/native/gcc-4.4.5/V1.3/bin/ld) supports shared libraries...
> yes****
>
> checking whether -lc should be explicitly linked in... yes****
>
> checking dynamic linker characteristics... solaris2.10 ld.so****
>
> checking how to hardcode library paths into programs... immediate****
>
> checking whether stripping libraries is possible... yes****
>
> checking if libtool supports shared libraries... yes****
>
> checking whether to build shared libraries... yes****
>
> checking whether to build static libraries... no****
>
> checking for gcc option to accept ISO C99... -std=gnu99****
>
> checking whether byte ordering is bigendian... yes****
>
> checking for inline... inline****
>
> checking if compiler accepts '-Wall'... yes****
>
> checking if compiler accepts '-Wextra'... yes****
>
> checking if compiler accepts '-pedantic'... yes****
>
> checking if compiler accepts '-Wstrict-prototypes'... yes****
>
> checking if compiler accepts '-Wcast-align'... yes****
>
> checking if compiler accepts '-fno-common'... yes****
>
> checking if compiler accepts '-fvisibility=hidden'... yes****
>
> checking if linker accepts '-no-undefined'... yes****
>
> checking for a Python interpreter with version >= 2.5... python****
>
> checking for python...
> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/python
> ****
>
> checking for python version... 2.7****
>
> checking for python platform... sunos5****
>
> checking for python script directory...
> ${prefix}/lib/python2.7/site-packages****
>
> checking for python extension module directory...
> ${exec_prefix}/lib/python2.7/site-packages****
>
> checking python module: json... yes****
>
> checking for popt.h... no****
>
> checking for poptGetContext in -lpopt... no****
>
> configure: creating ./config.status****
>
> config.status: creating librabbitmq.pc****
>
> config.status: creating Makefile****
>
> config.status: creating config.h****
>
> config.status: executing depfiles commands****
>
> config.status: executing libtool commands****
>
> configure: WARNING: unrecognized options: --enable-32-bit****
>
>  ****
>
> rabbitmq-c build options:****
>
>         Host: sparc-sun-solaris2.10****
>
>         Version: 0.2.0****
>
>         64-bit: no****
>
>         Tools: no****
>
>         Documentation: no****
>
>  ****
>
>   GEN    librabbitmq/amqp_framing.h****
>
>   GEN    librabbitmq/amqp_framing.c****
>
> make  all-am****
>
> make[1]: Entering directory `/home/spiuser/gitwa/rabbitmq-c'****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_api.lo****
>
> In file included from librabbitmq/amqp_api.c:37:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_connection.lo****
>
> In file included from librabbitmq/amqp_connection.c:37:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
> librabbitmq/amqp_connection.c: In function 'amqp_send_frame':****
>
> librabbitmq/amqp_connection.c:365: warning: pointer targets in assignment
> differ in signedness****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_framing.lo****
>
> In file included from librabbitmq/amqp_framing.c:38:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_mem.lo****
>
> In file included from librabbitmq/amqp_mem.c:37:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_socket.lo****
>
> In file included from librabbitmq/amqp_socket.c:37:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_table.lo****
>
> In file included from librabbitmq/amqp_table.c:37:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_url.lo****
>
> In file included from librabbitmq/amqp_url.c:37:****
>
> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'htonll'****
>
> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
> 'ntohll'****
>
>   CC     librabbitmq/unix/librabbitmq_librabbitmq_la-socket.lo****
>
> In file included from librabbitmq/unix/socket.c:37:****
>
> ./librabbitmq/amqp_private.h: In function 'amqp_e64':****
>
> ./librabbitmq/amqp_private.h:251: warning: implicit declaration of
> function 'htonll'****
>
> ./librabbitmq/amqp_private.h: In function 'amqp_d64':****
>
> ./librabbitmq/amqp_private.h:251: warning: implicit declaration of
> function 'ntohll'****
>
>   CCLD   librabbitmq/librabbitmq.la****
>
>   CC     examples/examples_libutils_la-utils.lo****
>
>   CC     examples/unix/examples_libutils_la-platform_utils.lo****
>
>   CCLD   examples/libutils.la****
>
>   CC     examples/amqp_bind.o****
>
>   CCLD   examples/amqp_bind****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `connect'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `ntohll'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `send'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `freeaddrinfo'***
> *
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `htonll'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `recv'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `setsockopt'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `socket'****
>
> librabbitmq/.libs/librabbitmq.so: undefined reference to `getaddrinfo'****
>
> collect2: ld returned 1 exit status****
>
>  ****
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>
>  ** **
>
> ** **
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/1185c1b3/attachment.htm>

From ttom.kelly at gmail.com  Thu Oct 18 21:09:41 2012
From: ttom.kelly at gmail.com (tom kelly)
Date: Thu, 18 Oct 2012 21:09:41 +0100
Subject: [rabbitmq-discuss] AMQP restart
In-Reply-To: <11E928B9-DE40-42CB-BA7C-7034398EF240@rabbitmq.com>
References: <CAKwS4ihkJQL0GUikY0C1t62LLJntNM3BDiFssV2pjHvB27r_1Q@mail.gmail.com>
	<11E928B9-DE40-42CB-BA7C-7034398EF240@rabbitmq.com>
Message-ID: <CAKwS4iiSwZ5=5aAejKv5tWm4_HkHj9K5ascQMqHwVioE_m4-iA@mail.gmail.com>

Hi Tim,

Thanks for your answers!

My original question on the links & supervisors came from my need to know
that when my mystery error (cause still unknown but more than likely caused
by myself) occurred I got some type of exit or notification so that i could
do something about it. I've built a wrapper around it now that monitors the
connection & channel so can happily forget about meddling with the
supervision tree :-)

While doing this I've built up more understanding of the library and added
the confirmation & retry handling to my wrapper relatively easily. So I
just want to say good work on rabbitmq-erlang-client guys!

//TTom.


On Tue, Oct 16, 2012 at 12:57 PM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi!
>
> On 15 Oct 2012, at 16:07, tom kelly wrote:
>
> > Hi List,
> > New user here, debugging some code I inherited so apologies if my
> questions below are irrelevant.
> >
> > I'm investigating an amqp crash that I've seen in my logs a few times
> and after a code review of the amqp component I'm a bit concerned that my
> connections may be dying & silently failing when this crash occurs.
> >
>
> Ok, let's look at that then.
>
> > I'm using an older version that unlinked from the process that called
> "start_link", anyone know why that was? I'm publishing through this channel
> by calling amqp_channel:cast, so now I'm worried that if the connection &
> channel were closed down everything that I thought I was publishing after
> this error just silently failed. And because of the unlink there's no way
> the application would have known.
> >
>
> I'm really no too sure about this unlink business, but if you could
> clarify where that was happening then I can probably look through the hg
> logs to try and figure out what was going on there.
>
> > I plan upgrading to the latest version but I'm not sure that it has all
> the features to help solve this problem. I see that the unlink is gone and
> the supervision policy is still:{one_for_all, 0, 1} So I guess this means I
> have to trap exits and I have responsibility for reopening the connection &
> channel if it dies?
>
> My reading of the supervision hierarchy is thus:
>
> The application has a top level simple_one_for_one supervisor for all
> connections, which handles the amqp_connection_sup. This just ensures that
> each connection can actually be started and they connection_sup is
> temporary, so no restarts will ever take place. This is presumably what
> you'd expect, as we're not trying to second guess how long your connections
> need to live for.
>
> The actual connection consists of a few processes - the gen_connection,
> connection_type_sup and channel_sup_sup. This is a one_for_all supervisor
> and the actual gen_connection process is an 'intrinsic' worker, so a
> non-normal exit will kill the supervisor (and sibling processes), but a
> normal exit will take everyone else down cleanly.
>
> Now the channel_sup_sup starts a temporary worker (amqp_channel_sup) and
> that starts an intrinsic worker.  So all in all, it looks to me as if the
> connection and channel will be properly re-established if a non-normal exit
> occurs.
>
> > But before I restart it, what happens to any attempts to publish
> messages? I see there's new confirmation functionality that sounds like it
> might do what's required but from my reading it seems that if amqp_channel
> is shut down after a crash on the connection then all the confirm info is
> discarded. Is there no way to keep this process alive and try to re-open
> the connection immediately on failure?
> >
>
> I'm not really sure what you're asking here, but my reading of the client
> is that if you're expecting a confirm and you've not seen it, then you
> can/should assume the message wasn't accepted by the broker. If you're
> asking about tracking the confirms between channel instances, then yes,
> you'll need to do that yourself, using whatever mechanism suits your design
> (shared/stable storage, stateful parent process, etc).
>
> > I'm just about to plug in the new version and play with the
> confirmations but any explanations of the current design might help
> enormously,
> > Thanks,
> > //TTom.
>
>
> Well I hope my comments have made it a bit clearly and not worse! Please
> *do* feel free to come back with any questions, or to clear up anything
> I've not explained properly.
>
> Cheers,
> Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/5574094a/attachment.htm>

From wongkamhoong at gmail.com  Fri Oct 19 03:18:49 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Fri, 19 Oct 2012 10:18:49 +0800
Subject: [rabbitmq-discuss] Unexpected log generated
In-Reply-To: <507FE3EB.70101@rabbitmq.com>
References: <507E90A1.7080502@gmail.com> <507E9139.4020706@rabbitmq.com>
	<CAHv8OSRTh6=yKDwcgNwRGy6Lz06ny1wozROHH1rs_0y23GoObQ@mail.gmail.com>
	<CAHv8OSSB5pQQ3mwin3oosONRxVeUFObk1Em2MiZfefc4BUhCQg@mail.gmail.com>
	<507FE3EB.70101@rabbitmq.com>
Message-ID: <CAHv8OSTOdVRWKzOJGmiWhq=ZFw0piXHoLT7yYvXiEk8wQ3vQMw@mail.gmail.com>

Hi Emile,

FYI, I had stopped that RabbitMQ instance for few days after the incident.
Anyway I temporary start the instance back to generate the report for you,
please find the report in the attachment.

I'm not really sure the restarts were done by me or RabbitMQ, I only
perform restart after noticed the node down.

Regards,
Wong


On Thu, Oct 18, 2012 at 7:11 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 18/10/12 03:08, Wong Kam Hoong wrote:
> > RabbitMQ *v2.8.7*
> > Erlang *R14B04*
> >
> > Sorry about the attachment, I don't know maximum size allowed limit to
> > 1mb. Before I zip the log, the log original size was 30mb++.
>
> Thank you for sending this information. In order for us to investigate
> this further could you also please provide the output of "rabbitmqctl
> report"?
>
> The log shows nodes restarting a few times - is there a sequence of
> events that reliably triggers these log entries?
>
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/feab4475/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmctl_report.zip
Type: application/zip
Size: 8582 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/feab4475/attachment.zip>

From psl88506 at gmail.com  Fri Oct 19 08:01:02 2012
From: psl88506 at gmail.com (PSL 88506)
Date: Fri, 19 Oct 2012 12:31:02 +0530
Subject: [rabbitmq-discuss] Upgrading RabbitMQ2.8.6
Message-ID: <CANPBPZnfRu8+yEzZd9UXuhZa-4evcOVnnURFvhN24uHiGSFKjQ@mail.gmail.com>

Currently we are using RabbitMQ 2.8.4 and Erlang 5.2
We want to upgrade to RabbitMQ 2.8.6

Would Erlang 5.2 supports RabbitMQ 2.8.6
or Erlang also needs to be upgraded.

Please respond as this is our urgent requirement.

Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/4c15dcf6/attachment.htm>

From watson.timothy at gmail.com  Fri Oct 19 08:34:37 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 19 Oct 2012 08:34:37 +0100
Subject: [rabbitmq-discuss] Upgrading RabbitMQ2.8.6
In-Reply-To: <CANPBPZnfRu8+yEzZd9UXuhZa-4evcOVnnURFvhN24uHiGSFKjQ@mail.gmail.com>
References: <CANPBPZnfRu8+yEzZd9UXuhZa-4evcOVnnURFvhN24uHiGSFKjQ@mail.gmail.com>
Message-ID: <95DBAC69-9ADA-4343-B5CB-BE67CA1A5483@rabbitmq.com>

Hi 

On 19 Oct 2012, at 08:01, PSL 88506 <psl88506 at gmail.com> wrote:

> Currently we are using RabbitMQ 2.8.4 and Erlang 5.2
> We want to upgrade to RabbitMQ 2.8.6
> 
> Would Erlang 5.2 supports RabbitMQ 2.8.6 
> or Erlang also needs to be upgraded.
> 
> Please respond as this is our urgent requirement.
> 

All 2.8.x versions of the broker will run with Erlang >= R12B03. Some plugins require later versions. So no, you do not have to upgrade erlang if you don't want to, though we recommend doing so if it is possible because the latest erlang often provides important bug fixes and in many cases, major performance improvements.

T

From matthias at rabbitmq.com  Fri Oct 19 09:30:41 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 19 Oct 2012 09:30:41 +0100
Subject: [rabbitmq-discuss] Upgrading RabbitMQ2.8.6
In-Reply-To: <CANPBPZnfRu8+yEzZd9UXuhZa-4evcOVnnURFvhN24uHiGSFKjQ@mail.gmail.com>
References: <CANPBPZnfRu8+yEzZd9UXuhZa-4evcOVnnURFvhN24uHiGSFKjQ@mail.gmail.com>
Message-ID: <50810FB1.5060001@rabbitmq.com>

On 19/10/12 08:01, PSL 88506 wrote:
> Currently we are using RabbitMQ 2.8.4 and Erlang 5.2
> We want to upgrade to RabbitMQ 2.8.6
>
> Would Erlang 5.2 supports RabbitMQ 2.8.6
> or Erlang also needs to be upgraded.

I doubt that you are running Erlang 5.2, since that corresponds to R9B 
(see http://www.erlang.org/documentation.html for the mapping) - a 
version that RabbitMQ has never supported.

RabbitMQ's Erlang version requirements are documented at 
http://www.rabbitmq.com/which-erlang.html

These haven't changed between 2.8.4 and later versions, so whatever 
Erlang you have RabbitMQ running on at the moment should work fine with 
the latest version of RabbitMQ.

Regards,

Matthias.

From psl88506 at gmail.com  Fri Oct 19 09:58:40 2012
From: psl88506 at gmail.com (PSL 88506)
Date: Fri, 19 Oct 2012 14:28:40 +0530
Subject: [rabbitmq-discuss] Upgrading RabbitMQ2.8.6
In-Reply-To: <50810FB1.5060001@rabbitmq.com>
References: <CANPBPZnfRu8+yEzZd9UXuhZa-4evcOVnnURFvhN24uHiGSFKjQ@mail.gmail.com>
	<50810FB1.5060001@rabbitmq.com>
Message-ID: <CANPBPZkAzpKHe7F8fzkZ_qPP0pmEO=Y46D81X3kDoXvAbEadTA@mail.gmail.com>

I'm sorry. Erlang we are using is 5.9.

Eshell V5.9  (abort with ^G)

Thanks a lot. We'll proceed as you suggested.

Thanks once again for your response


On Fri, Oct 19, 2012 at 2:00 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 19/10/12 08:01, PSL 88506 wrote:
>
>> Currently we are using RabbitMQ 2.8.4 and Erlang 5.2
>> We want to upgrade to RabbitMQ 2.8.6
>>
>> Would Erlang 5.2 supports RabbitMQ 2.8.6
>> or Erlang also needs to be upgraded.
>>
>
> I doubt that you are running Erlang 5.2, since that corresponds to R9B
> (see http://www.erlang.org/**documentation.html<http://www.erlang.org/documentation.html>for the mapping) - a version that RabbitMQ has never supported.
>
> RabbitMQ's Erlang version requirements are documented at
> http://www.rabbitmq.com/which-**erlang.html<http://www.rabbitmq.com/which-erlang.html>
>
> These haven't changed between 2.8.4 and later versions, so whatever Erlang
> you have RabbitMQ running on at the moment should work fine with the latest
> version of RabbitMQ.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/dc21f97e/attachment.htm>

From nicolas.bosansky at gmail.com  Fri Oct 19 07:40:07 2012
From: nicolas.bosansky at gmail.com (Nicolas Bosansky)
Date: Thu, 18 Oct 2012 23:40:07 -0700 (PDT)
Subject: [rabbitmq-discuss] Queue consumers are blocked on
	SocketInputStream.socketRead0
In-Reply-To: <7e422990-7a67-4dca-8ada-aead1e225cc7@googlegroups.com>
References: <7e422990-7a67-4dca-8ada-aead1e225cc7@googlegroups.com>
Message-ID: <3e208c17-dce2-48cb-84f9-385fbbb095c2@googlegroups.com>

One more details I forgot to mention yesterday:
When HBase store is not available, the number of messages in the queue 
grows.
If you restart HBase quickly, the messages will be consumed without 
problem, but if we wait too much time to restart it, no message anymore 
will be consumed even though the queue is full of messages (27K messages).

>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/6dca7d03/attachment.htm>

From jan.schumacher.js at googlemail.com  Fri Oct 19 09:27:09 2012
From: jan.schumacher.js at googlemail.com (Jan Schumacher)
Date: Fri, 19 Oct 2012 01:27:09 -0700 (PDT)
Subject: [rabbitmq-discuss] requeue to HA mirrored queue
Message-ID: <e09b42bf-c6f1-46a0-990a-ba1cf7515de1@googlegroups.com>

Hi everybody!
I'm trying to reject a message on a clustered rabbitmq with the queue 
property requeue=true. The queue has set the argument requeue to true.
And the problem is, it just doesn't work. 
After sending the message to the queue the message is set to unacknowledged 
and after rejecting the message it won't be rejected to the queue and is 
gone to nowhere.
So i've tested the same issue with a non clustered rabbitmq server and it 
works.
My question is: Is it possible to requeue messages on clustered rabbitmqs?
Best regards!
Jan Schumacher
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/76a2af6f/attachment.htm>

From matt at soupmatt.com  Thu Oct 18 18:20:53 2012
From: matt at soupmatt.com (Matt Campbell)
Date: Thu, 18 Oct 2012 10:20:53 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit Management HTTP API issue - deleted
 queues linger in API responses
Message-ID: <757bbda1-844b-43c5-b5bb-040d7747c21d@googlegroups.com>

RabbitMQ version: 2.8.7
Erlang version: R14B04

We are seeing an issue where queues that have been deleted using the amqp 
basic.delete command tend to linger in the Management console and in calls 
to the HTTP API. This is an issue for us as we are using that API to 
discover dynamically created and deleted queues. Can anyone confirm this 
behavior or offer a suggestion as to how we can mitigate it?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/61a66801/attachment.htm>

From matt at soupmatt.com  Thu Oct 18 19:13:35 2012
From: matt at soupmatt.com (Matt Campbell)
Date: Thu, 18 Oct 2012 11:13:35 -0700 (PDT)
Subject: [rabbitmq-discuss] Rabbit Management HTTP API issue - deleted
 queues linger in API responses
In-Reply-To: <757bbda1-844b-43c5-b5bb-040d7747c21d@googlegroups.com>
References: <757bbda1-844b-43c5-b5bb-040d7747c21d@googlegroups.com>
Message-ID: <b3dd8a14-2e5c-4ae1-a984-a7f8210a15df@googlegroups.com>

On Thursday, October 18, 2012 12:20:54 PM UTC-5, Matt Campbell wrote:
>
> RabbitMQ version: 2.8.7
> Erlang version: R14B04
>
> We are seeing an issue where queues that have been deleted using the amqp 
> basic.delete command tend to linger in the Management console and in calls 
> to the HTTP API. This is an issue for us as we are using that API to 
> discover dynamically created and deleted queues. Can anyone confirm this 
> behavior or offer a suggestion as to how we can mitigate it?
>
> Thanks,
>
> Matt
>

I learned some more about what is going on. If I try to redeclare the 
queue, rabbit returns an error unless I match the queue arguments, as I 
would expect, but then if I go to delete the queue, I get an error saying 
it doesn't exist.

Our setup for this environment is a single node running in cluster mode (we 
are planning on adding a second node in the near future) and all our queues 
are declared with x-ha-policy set to all.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121018/6ebc6870/attachment.htm>

From psl88506 at gmail.com  Fri Oct 19 10:24:34 2012
From: psl88506 at gmail.com (PSL 88506)
Date: Fri, 19 Oct 2012 14:54:34 +0530
Subject: [rabbitmq-discuss] Upgrading RabbitMQ2.8.6
In-Reply-To: <50811BFD.3040207@rabbitmq.com>
References: <CANPBPZnfRu8+yEzZd9UXuhZa-4evcOVnnURFvhN24uHiGSFKjQ@mail.gmail.com>
	<50810FB1.5060001@rabbitmq.com>
	<CANPBPZkAzpKHe7F8fzkZ_qPP0pmEO=Y46D81X3kDoXvAbEadTA@mail.gmail.com>
	<CANPBPZmBWZivfFmcNB1x8qVK7WfR-1ThPSeozCDk+Z6SA2b_og@mail.gmail.com>
	<50811BFD.3040207@rabbitmq.com>
Message-ID: <CANPBPZnVFQbwpYt1jqCZ6=dC07t=1F0mhQWZUKQpWXUpiucUQw@mail.gmail.com>

When i try to understand about installation procedure for 2.8.6

All links are getting redirected to same page with following URL:
http://www.rabbitmq.com/**download.html<http://www.rabbitmq.com/download.html>

I tried to navigate from below link:-
http://www.rabbitmq.com/news.**html <http://www.rabbitmq.com/news.html>
and scroll to the section RabbitMQ 2.8.6 release
<http://lists.rabbitmq.com/**pipermail/rabbitmq-announce/**
2012-August/000050.html<http://lists.rabbitmq.com/pipermail/rabbitmq-announce/2012-August/000050.html>
>

and select hyperlink for Installation Guides for Generic Unix
It is forwarded to page - http://www.rabbitmq.com/**
install-generic-unix.html<http://www.rabbitmq.com/install-generic-unix.html>

I see the same installation guides for 2.8.6 and 2.8.4

Currently we are using 2.8.4, we are in the process to upgrade to 2.8.6

Please help.
Thanks in advance.

On Fri, Oct 19, 2012 at 2:53 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Please send this question to the mailing list.
>
> Matthias.
>
>
> On 19/10/12 10:16, PSL 88506 wrote:
>
>> Thanks a lot for responding to my previous post.
>> Another clarification is required :
>>
>> When i try to understand about installation procedure for 2.8.6
>>
>> All links are getting redirected to same page with following URL:
>> http://www.rabbitmq.com/**download.html<http://www.rabbitmq.com/download.html>
>>
>> I tried to navigate from below link:-
>> http://www.rabbitmq.com/news.**html <http://www.rabbitmq.com/news.html>
>> and scroll to the section RabbitMQ 2.8.6 release
>> <http://lists.rabbitmq.com/**pipermail/rabbitmq-announce/**
>> 2012-August/000050.html<http://lists.rabbitmq.com/pipermail/rabbitmq-announce/2012-August/000050.html>
>> >
>>
>> and select hyperlink for Installation Guides for Generic Unix
>> It is forwarded to page - http://www.rabbitmq.com/**
>> install-generic-unix.html<http://www.rabbitmq.com/install-generic-unix.html>
>>
>> I see the same installation guides for 2.8.6 and 2.8.4
>>
>> Currently we are using 2.8.4, we are in the process to upgrade to 2.8.6
>>
>> Please help.
>> Thanks in advance.
>>
>> On Fri, Oct 19, 2012 at 2:28 PM, PSL 88506 <psl88506 at gmail.com
>> <mailto:psl88506 at gmail.com>> wrote:
>>
>>     I'm sorry. Erlang we are using is 5.9.
>>
>>     Eshell V5.9  (abort with ^G)
>>
>>     Thanks a lot. We'll proceed as you suggested.
>>
>>     Thanks once again for your response
>>
>>
>>     On Fri, Oct 19, 2012 at 2:00 PM, Matthias Radestock
>>     <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>**> wrote:
>>
>>         On 19/10/12 08:01, PSL 88506 wrote:
>>
>>             Currently we are using RabbitMQ 2.8.4 and Erlang 5.2
>>             We want to upgrade to RabbitMQ 2.8.6
>>
>>             Would Erlang 5.2 supports RabbitMQ 2.8.6
>>             or Erlang also needs to be upgraded.
>>
>>
>>         I doubt that you are running Erlang 5.2, since that corresponds
>>         to R9B (see http://www.erlang.org/__**documentation.html<http://www.erlang.org/__documentation.html>
>>
>>         <http://www.erlang.org/**documentation.html<http://www.erlang.org/documentation.html>>
>> for the mapping) - a
>>         version that RabbitMQ has never supported.
>>
>>         RabbitMQ's Erlang version requirements are documented at
>>         http://www.rabbitmq.com/which-**__erlang.html<http://www.rabbitmq.com/which-__erlang.html>
>>
>>         <http://www.rabbitmq.com/**which-erlang.html<http://www.rabbitmq.com/which-erlang.html>
>> >
>>
>>         These haven't changed between 2.8.4 and later versions, so
>>         whatever Erlang you have RabbitMQ running on at the moment
>>         should work fine with the latest version of RabbitMQ.
>>
>>         Regards,
>>
>>         Matthias.
>>
>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/984f76c4/attachment.htm>

From francesco at rabbitmq.com  Fri Oct 19 10:29:36 2012
From: francesco at rabbitmq.com (Francesco Mazzoli)
Date: Fri, 19 Oct 2012 10:29:36 +0100
Subject: [rabbitmq-discuss] requeue to HA mirrored queue
In-Reply-To: <e09b42bf-c6f1-46a0-990a-ba1cf7515de1@googlegroups.com>
References: <e09b42bf-c6f1-46a0-990a-ba1cf7515de1@googlegroups.com>
Message-ID: <87objybyin.wl%francesco@rabbitmq.com>

At Fri, 19 Oct 2012 01:27:09 -0700 (PDT),
Jan Schumacher wrote:
> Hi everybody!
> I'm trying to reject a message on a clustered rabbitmq with the queue property
> requeue=true. The queue has set the argument requeue to true.
> And the problem is, it just doesn't work. 
> After sending the message to the queue the message is set to unacknowledged
> and after rejecting the message it won't be rejected to the queue and is gone
> to nowhere.

I'm not sure I understand your description, that's my interpretation:

*   Publish a message to an exchange and it gets routed to an HA queue
*   Consume the message from the queue
*   Reject the message with `requeue=true'
*   The queue disappears

We'd need the logs to understand what's going on, but we fixed a bug in the
slave synchronisation code in 2.8.7, and requeuing messages was one of the ways
to trigger it, so I'd suggest to try to upgrade.

If that doesn't work, describe what you're doing more precisely and post the
logs.

--
Francesco

From tim at rabbitmq.com  Fri Oct 19 10:35:54 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 19 Oct 2012 10:35:54 +0100
Subject: [rabbitmq-discuss] requeue to HA mirrored queue
In-Reply-To: <87objybyin.wl%francesco@rabbitmq.com>
References: <e09b42bf-c6f1-46a0-990a-ba1cf7515de1@googlegroups.com>
	<87objybyin.wl%francesco@rabbitmq.com>
Message-ID: <50811EFA.5000902@rabbitmq.com>

On 10/19/2012 10:29 AM, Francesco Mazzoli wrote:
> At Fri, 19 Oct 2012 01:27:09 -0700 (PDT),
> Jan Schumacher wrote:
>> Hi everybody!
>> I'm trying to reject a message on a clustered rabbitmq with the queue property
>> requeue=true. The queue has set the argument requeue to true.
>> And the problem is, it just doesn't work.
>> After sending the message to the queue the message is set to unacknowledged
>> and after rejecting the message it won't be rejected to the queue and is gone
>> to nowhere.
> I'm not sure I understand your description, that's my interpretation:
>
> *   Publish a message to an exchange and it gets routed to an HA queue
> *   Consume the message from the queue
> *   Reject the message with `requeue=true'
> *   The queue disappears

I think he means the message disappears

>
> We'd need the logs to understand what's going on, but we fixed a bug in the
> slave synchronisation code in 2.8.7, and requeuing messages was one of the ways
> to trigger it, so I'd suggest to try to upgrade.
>
> If that doesn't work, describe what you're doing more precisely and post the
> logs.
>
> --
> Francesco
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simlu at su.se  Fri Oct 19 11:01:18 2012
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Fri, 19 Oct 2012 12:01:18 +0200
Subject: [rabbitmq-discuss] rabbitmqadmin and default node behaviour
Message-ID: <20121019100118.GB1210@kaka.it.su.se>

Hello!

I asked this question on IRC, but was asked my Michael to move it to the
mailinglist.

I'm trying to understand why rabbitmqadmin doesn't use the "default"
node when no config file is specified.
I use a config (stored in the default location) but I everytime I use
rabbitmqadmin I don't want to explicitly specify the node for every
command.
Someone must have had a good reason for not doing this in the first
place, but I cannot figure it out.

My suggestion:
* Always use nodename "default" if no other is specified via the node
switch.
* Use the default config if not other config is specified via the config
switch.

I'm willing to create a pull request for this, I just wanted to discuss
it first.

Thanks and have a nice weekend!
- Simon

---

Simon Lundstr?m
IT Services
Stockholm University

From simlu at su.se  Fri Oct 19 11:31:23 2012
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Fri, 19 Oct 2012 12:31:23 +0200
Subject: [rabbitmq-discuss] BUG: Failing nodes with HA-queue stops
 message flow
In-Reply-To: <5069A741.6020005@rabbitmq.com>
References: <20121001120316.GJ560@kaka.it.su.se>
	<5069898A.5070004@rabbitmq.com>
	<20121001124833.GA35664@kaka.it.su.se>
	<506993AB.8000107@rabbitmq.com>
	<20121001140733.GB35664@kaka.it.su.se>
	<5069A741.6020005@rabbitmq.com>
Message-ID: <20121019103123.GD1210@kaka.it.su.se>

Hello Matthias!

On Mon, 2012-10-01 at 15:22:57 +0100, Matthias Radestock wrote:
> On 01/10/12 15:07, Simon Lundstr?m wrote:
> >I have no idea how *I* should be handling consumer cancel notification
> >(can't find this in the documentation), but I'm pretty sure Ruby AMQP
> >handles it, see
> ><https://github.com/ruby-amqp/amq-client/commit/49951878a8ff4bdbcead3c13eb7737ade6e70669>
> >and <https://groups.google.com/forum/#!topic/ruby-amqp/KKxv4DFVJVk>.
> 
> It *supports* CCNs, but I am pretty sure you'll need to set up a
> call back to actually *handle* them (i.e. re-consume).

Just for future reference, yes Ruby AMQP supports CCN and it works.
Here[1] is my thread on their mailinglist.

1) <https://groups.google.com/d/topic/ruby-amqp/81phyuMJTv8/discussion>

Have a nice weekend!
- Simon

---

Simon Lundstr?m
IT Services
Stockholm University

From simon at rabbitmq.com  Fri Oct 19 12:04:53 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 19 Oct 2012 12:04:53 +0100
Subject: [rabbitmq-discuss] Nightlies now available - help us test RabbitMQ
	3.0
Message-ID: <508133D5.8030108@rabbitmq.com>

Hi everyone! We've just put in place a nightly build system for the 
RabbitMQ server and clients. You can download nightlies from 
http://www.rabbitmq.com/nightly-builds.html

We've also put documentation for what will be the next version of 
RabbitMQ at http://next.rabbitmq.com/documentation.html.

We're evolving towards a model where we have feature releases every few 
months, with bugfix releases in between. It's possible there will be a 
2.8.8 bugfix release, but that's not what the current nightlies are - 
they represent what will be RabbitMQ 3.0.

So with some caveats in place:

  * Obviously we do not suggest running nightlies on production systems.

  * We don't always guarantee upgrades from one nightly to another will
    work - you may have to reset everything and start again sometimes.

  * You would also have to reset everything and start again to revert to
    a stable release from a nightly.

...I'd invite you to have a look at what's coming, and tell use what you 
think.

I'm going to write more on the subject as we get closer to the release, 
but some of the major new features include:

  * HA queues are configured dynamically by a new policy mechanism,
    rather than by declaring them with "x-ha-policy". HA-ness
    can be changed at any time. HA queues are also much faster.

  * Federated exchanges are now normal exchanges, with federation
    similarly configured dynamically by policy. The "x-federation"
    exchange type is no more.

  * Clustering commands in rabbitmqctl have been rewritten to make
    clustering easier and more robust.

  * Web-STOMP and MQTT plugins are included.

  * Lots of other smaller new features and bug fixes.

The network protocol hasn't changed; you can run 2.x clients against 3.x 
server and vice versa.

So please try it out, and talk to us!

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Oct 19 12:45:26 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 19 Oct 2012 12:45:26 +0100
Subject: [rabbitmq-discuss] Typos on tutorials
In-Reply-To: <CAL+xXwNZsKaBdWsGeZeW=oR5QmaTzP7WEi_X++qVq7OB0NpXNQ@mail.gmail.com>
References: <CAL+xXwNZsKaBdWsGeZeW=oR5QmaTzP7WEi_X++qVq7OB0NpXNQ@mail.gmail.com>
Message-ID: <50813D56.2070801@rabbitmq.com>

On 18/10/12 15:33, Matt Haggard wrote:
> Thank you for the great tutorials!  I noticed three typos on them:

Ah, thanks. Fixed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From terance at socialtwist.com  Fri Oct 19 12:48:13 2012
From: terance at socialtwist.com (Terance)
Date: Fri, 19 Oct 2012 04:48:13 -0700 (PDT)
Subject: [rabbitmq-discuss] backup and fail-over to remote disaster recovery
	site
Message-ID: <1350647293415-22706.post@n5.nabble.com>

Hi,

We want to set up RabbitMQ such that the current state of the broker is
backed up at a remote disaster recovery site at real time. We also want our
clients (producers and consumers) to fail-over to this remote broker in case
the main broker becomes unreachable for some reason. I was looking at the
Distributed broker approaches supported by RabbitMQ at
http://www.rabbitmq.com/distributed.html but I'm not sure If what we are
looking for can be achieved. Please let me know if you know how to do this.

Thanks,
Terance.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/backup-and-fail-over-to-remote-disaster-recovery-site-tp22706.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Fri Oct 19 13:38:51 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 19 Oct 2012 13:38:51 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin and default node behaviour
In-Reply-To: <20121019100118.GB1210@kaka.it.su.se>
References: <20121019100118.GB1210@kaka.it.su.se>
Message-ID: <508149DB.7010701@rabbitmq.com>

On 19/10/12 11:01, Simon Lundstr?m wrote:
> Hello!

Hi!

> I'm trying to understand why rabbitmqadmin doesn't use the "default"
> node when no config file is specified.
> I use a config (stored in the default location) but I everytime I use
> rabbitmqadmin I don't want to explicitly specify the node for every
> command.
> Someone must have had a good reason for not doing this in the first
> place, but I cannot figure it out.

Hmm. Not sure I remember. The best explanation is at

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018191.html

There's obviously a concern about not breaking the case where there is 
no config file. Maybe that was all.

> My suggestion:
> * Always use nodename "default" if no other is specified via the node
> switch.
> * Use the default config if not other config is specified via the config
> switch.
>
> I'm willing to create a pull request for this, I just wanted to discuss
> it first.

Yes, that sounds reasonable.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Fri Oct 19 14:00:25 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 19 Oct 2012 14:00:25 +0100
Subject: [rabbitmq-discuss] backup and fail-over to remote disaster
 recovery site
In-Reply-To: <1350647293415-22706.post@n5.nabble.com>
References: <1350647293415-22706.post@n5.nabble.com>
Message-ID: <50814EE9.4020004@rabbitmq.com>

On 19/10/12 12:48, Terance wrote:
> We want to set up RabbitMQ such that the current state of the broker is
> backed up at a remote disaster recovery site at real time. We also want our
> clients (producers and consumers) to fail-over to this remote broker in case
> the main broker becomes unreachable for some reason. I was looking at the
> Distributed broker approaches supported by RabbitMQ at
> http://www.rabbitmq.com/distributed.html but I'm not sure If what we are
> looking for can be achieved. Please let me know if you know how to do this.

Hi. Interesting question. Some thoughts:

CAP theorem tells us you're not going to get a transparent solution to 
this problem. If it's remote you need to be partition-tolerant, and you 
almost certainly want to be available too. So consistency has to go. 
That rules out clustering.

So you could use the shovel or federation to get messages published from 
your main site to your recovery site. That's fairly easy (assuming your 
broker definitions are not too dynamic); what is harder is ensuring that 
messages are consumed from the recovery site in some sort of correlation 
with them being consumed at the main site. There's nothing built in to 
Rabbit which can do that.

There are some possibilities which may or may not work for you. You 
could federate / shovel into queues with a message TTL at the remote 
site to bound the amount of data you hold - but at failover you could 
have a lot of duplicate messages to work through, and if your main site 
queues back up enough, messages could be expired at the remote site when 
they have not been processed at the main site.

Possibly the most plausible solution is to synchronise the mnesia 
directory from main to remote and only boot the remote broker on 
failover. This stands a decent chance of recovering your persistent 
messages of failure; but keeping the filesystems reliably in sync is its 
own challenge. And we don't guarantee to recover everything after (the 
equivalent of) an unclean shutdown.

Hmm, you've got me thinking about replication now...

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Fri Oct 19 14:08:59 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 19 Oct 2012 14:08:59 +0100
Subject: [rabbitmq-discuss] Queue consumers are blocked on
	SocketInputStream.socketRead0
In-Reply-To: <7e422990-7a67-4dca-8ada-aead1e225cc7@googlegroups.com>
References: <7e422990-7a67-4dca-8ada-aead1e225cc7@googlegroups.com>
Message-ID: <508150EB.2010108@rabbitmq.com>

Hi

Please do not use the google group, as we do not own or subscribe to it. 
Thanks!

In terms of your question, please see my comments inline (below).

On 10/18/2012 04:50 PM, Nicolas Bosansky wrote:
> Hello,
> We have a rabbitMQ consumer that takes messages from a queue and write 
> them in a HBase store.
> When HBase connection fails, the consumer get an exception and 
> messages are not acknowledged, that's ok.
> After a few minutes, the consumer doesn't get messages anymore, even 
> after restarting Hbase.
>

Firstly, I don't really understand what you're describing here. What 
does the HBase connection failure have to do with the rabbitmq consumer? 
Are you saying that the HBase connection failure causes an unhandled 
exception on the thread which the consumer is running in? What does this 
have to do with acks - are you saying that your client code does not ack 
messages which arrive that cannot be written to HBase? That's fine, but 
you ought to nack/reject them unless you're hanging on to them 
deliberately in order to deal with them later on. Perhaps this is what 
is causing the problem?

"If a consumer dies without sending an acknowledgement the AMQP broker 
will redeliver it to another consumer or, if none are available at the 
time, the broker will wait until at least one consumer is registered for 
the same queue before attempting redelivery." - 
http://www.rabbitmq.com/tutorials/amqp-concepts.html

So if you do not ack the messages you've already received *nor* 
nack/reject them, then you're not going to get any more messages until 
you do? Am I missing something here, or are you just not instructing the 
broker that you're ready to continue consuming from the queue (by 
dealing with the messages it has already sent you which need to be 
ack'ed or rejected)?

> When debugging rabbitMQ client, we have noticed, that it is blocked on 
> the following line: SocketInputStream:129 ( Java build 1.6.0_33-b03)
> The Frame class is waiting for messages, but the used socket doesn't 
> receive any data anymore.
> We also notice, that there is no timeout on this socket.
>

There isn't meant to be a timeout when reading frames.

From emile at rabbitmq.com  Fri Oct 19 14:22:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 19 Oct 2012 14:22:29 +0100
Subject: [rabbitmq-discuss] STOMP plugin - durable subscription
	limitation
In-Reply-To: <k5p9o9$kqi$1@ger.gmane.org>
References: <k5p9o9$kqi$1@ger.gmane.org>
Message-ID: <50815415.8090308@rabbitmq.com>

Hi Michael,

On 18/10/12 17:11, Michael Justin wrote:
> However, RabbitMQ uses the id header differently for topic 
> subscriptions. Sending and receiving requires to set the same value, so 
> that consumers are not able to assign any random identifier in the 
> SUBSCRIBE frame. Is this correct so far and as designed?

Consumers are able to assign arbitrary values in the id header when
subscribing with any kind of destination, precisely for the reason that
you need: so that messages delivered for that subscription can be
matched up.

Unless I'm misunderstanding your question, your examples even show that
this works. The subscriptions with id
{F09BD8A4-0C7B-4830-B4B5-B3F5D76E5A7C} has messages delivered with the
same value in the subscription: header. Likewise with the subscription
containing "durable-subscription-name" as the value of the id header.
The delivered message has "durable-subscription-name" in the
subscription header so that the client can match the message up with the
subscription.

> This has the effect that a client can not handle more than one consumer 
> for the same durable subscription because a SUBSCRIBE frame can not use 
> a client-side assigned identifier in the same way and use it to route 
> incoming messages based on this id between internal 'consumers'.

This is what the "id:" and "subscription:" headers were designed for.

> Example:
> 
> 2. RabbitMQ with durable subscription
> 
> SUBSCRIBE
> destination:/topic/TOOL.DEFAULT
> receipt:yes
> ack:auto
> id:durable-subscription-name

This value ^

> persistent:true
> 
> received:
> MESSAGE
> receipt:receipt
> persistent:true
> content-type:text/plain
> subscription:durable-subscription-name

is the same as this one ^

> destination:/topic/TOOL.DEFAULT
> message-id:T_durable-subscription-name@@session-whuoJn95NxH3Ic-lQIr-Wl@@1
> content-length:9

> The STOMP 1.0 specification says:
> 
> "You can also specify an id header which can then later on be used to 
> UNSUBSCRIBE from the specific subscription as you may end up with 
> overlapping subscriptions using selectors with the same destination."

As far as I can see RabbitMQ fully adheres to the spec, which also says
of MESSAGE frames: "The subscription header will be set to match the id
header of the subscription that is receiving the message".

> In RabbitMQ however, overlapping subscriptions seem to be impossible for 
> a durable topic, as there is no way to specify unique values for the id. 
> Is this correct?

If I'm misunderstanding your question then please send another
illustration that shows what information is missing. Is the problem with
the STOMP spec or with the RabbitMQ implementation of it?



-Emile


From nicolas.bosansky at gmail.com  Fri Oct 19 15:02:30 2012
From: nicolas.bosansky at gmail.com (Nicolas Bosansky)
Date: Fri, 19 Oct 2012 16:02:30 +0200
Subject: [rabbitmq-discuss] Queue consumers are blocked on
	SocketInputStream.socketRead0
In-Reply-To: <508150EB.2010108@rabbitmq.com>
References: <7e422990-7a67-4dca-8ada-aead1e225cc7@googlegroups.com>
	<508150EB.2010108@rabbitmq.com>
Message-ID: <CAGj2pKhp3mXaAcbMqkfQAYkuw6gY0EnPrd0pm6fzD35bXa05og@mail.gmail.com>

Hi,

Thanks for your response and sorry for using google groups.

We just have found why we don't get messages anymore from the broker.
Your explanation corresponds exactly to our problem : when Hbase connection
fails, it generates an exception, and in this case, we don't 'ack' nor
'nack/reject' the message.

Now, we nack the message when something wrong occurs and so we get the next
messages from the queue.

Thanks again,
Nicolas


2012/10/19 Tim Watson <tim at rabbitmq.com>

> Hi
>
> Please do not use the google group, as we do not own or subscribe to it.
> Thanks!
>
> In terms of your question, please see my comments inline (below).
>
> On 10/18/2012 04:50 PM, Nicolas Bosansky wrote:
>
>> Hello,
>> We have a rabbitMQ consumer that takes messages from a queue and write
>> them in a HBase store.
>> When HBase connection fails, the consumer get an exception and messages
>> are not acknowledged, that's ok.
>> After a few minutes, the consumer doesn't get messages anymore, even
>> after restarting Hbase.
>>
>>
> Firstly, I don't really understand what you're describing here. What does
> the HBase connection failure have to do with the rabbitmq consumer? Are you
> saying that the HBase connection failure causes an unhandled exception on
> the thread which the consumer is running in? What does this have to do with
> acks - are you saying that your client code does not ack messages which
> arrive that cannot be written to HBase? That's fine, but you ought to
> nack/reject them unless you're hanging on to them deliberately in order to
> deal with them later on. Perhaps this is what is causing the problem?
>
> "If a consumer dies without sending an acknowledgement the AMQP broker
> will redeliver it to another consumer or, if none are available at the
> time, the broker will wait until at least one consumer is registered for
> the same queue before attempting redelivery." - http://www.rabbitmq.com/**
> tutorials/amqp-concepts.html<http://www.rabbitmq.com/tutorials/amqp-concepts.html>
>
> So if you do not ack the messages you've already received *nor*
> nack/reject them, then you're not going to get any more messages until you
> do? Am I missing something here, or are you just not instructing the broker
> that you're ready to continue consuming from the queue (by dealing with the
> messages it has already sent you which need to be ack'ed or rejected)?
>
>  When debugging rabbitMQ client, we have noticed, that it is blocked on
>> the following line: SocketInputStream:129 ( Java build 1.6.0_33-b03)
>> The Frame class is waiting for messages, but the used socket doesn't
>> receive any data anymore.
>> We also notice, that there is no timeout on this socket.
>>
>>
> There isn't meant to be a timeout when reading frames.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/e12e668a/attachment.htm>

From tim at rabbitmq.com  Fri Oct 19 15:00:21 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 19 Oct 2012 15:00:21 +0100
Subject: [rabbitmq-discuss] Queue consumers are blocked on
	SocketInputStream.socketRead0
In-Reply-To: <CAGj2pKhp3mXaAcbMqkfQAYkuw6gY0EnPrd0pm6fzD35bXa05og@mail.gmail.com>
References: <7e422990-7a67-4dca-8ada-aead1e225cc7@googlegroups.com>
	<508150EB.2010108@rabbitmq.com>
	<CAGj2pKhp3mXaAcbMqkfQAYkuw6gY0EnPrd0pm6fzD35bXa05og@mail.gmail.com>
Message-ID: <50815CF5.808@rabbitmq.com>

Hi

On 10/19/2012 03:02 PM, Nicolas Bosansky wrote:
> Hi,
>
> Thanks for your response and sorry for using google groups.
>

Ok no probs, I don't want you to think I'm telling you off! :D

> We just have found why we don't get messages anymore from the broker.
> Your explanation corresponds exactly to our problem : when Hbase 
> connection fails, it generates an exception, and in this case, we 
> don't 'ack' nor 'nack/reject' the message.
>
> Now, we nack the message when something wrong occurs and so we get the 
> next messages from the queue.
>

Awesome - glad it works for you now.

Cheers,
Tim

> Thanks again,
> Nicolas
>
>
> 2012/10/19 Tim Watson <tim at rabbitmq.com <mailto:tim at rabbitmq.com>>
>
>     Hi
>
>     Please do not use the google group, as we do not own or subscribe
>     to it. Thanks!
>
>     In terms of your question, please see my comments inline (below).
>
>     On 10/18/2012 04:50 PM, Nicolas Bosansky wrote:
>
>         Hello,
>         We have a rabbitMQ consumer that takes messages from a queue
>         and write them in a HBase store.
>         When HBase connection fails, the consumer get an exception and
>         messages are not acknowledged, that's ok.
>         After a few minutes, the consumer doesn't get messages
>         anymore, even after restarting Hbase.
>
>
>     Firstly, I don't really understand what you're describing here.
>     What does the HBase connection failure have to do with the
>     rabbitmq consumer? Are you saying that the HBase connection
>     failure causes an unhandled exception on the thread which the
>     consumer is running in? What does this have to do with acks - are
>     you saying that your client code does not ack messages which
>     arrive that cannot be written to HBase? That's fine, but you ought
>     to nack/reject them unless you're hanging on to them deliberately
>     in order to deal with them later on. Perhaps this is what is
>     causing the problem?
>
>     "If a consumer dies without sending an acknowledgement the AMQP
>     broker will redeliver it to another consumer or, if none are
>     available at the time, the broker will wait until at least one
>     consumer is registered for the same queue before attempting
>     redelivery." - http://www.rabbitmq.com/tutorials/amqp-concepts.html
>
>     So if you do not ack the messages you've already received *nor*
>     nack/reject them, then you're not going to get any more messages
>     until you do? Am I missing something here, or are you just not
>     instructing the broker that you're ready to continue consuming
>     from the queue (by dealing with the messages it has already sent
>     you which need to be ack'ed or rejected)?
>
>         When debugging rabbitMQ client, we have noticed, that it is
>         blocked on the following line: SocketInputStream:129 ( Java
>         build 1.6.0_33-b03)
>         The Frame class is waiting for messages, but the used socket
>         doesn't receive any data anymore.
>         We also notice, that there is no timeout on this socket.
>
>
>     There isn't meant to be a timeout when reading frames.
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/eb9a75c3/attachment.htm>

From emile at rabbitmq.com  Fri Oct 19 15:26:56 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 19 Oct 2012 15:26:56 +0100
Subject: [rabbitmq-discuss] STOMP plugin - durable subscription
	limitation
In-Reply-To: <50815415.8090308@rabbitmq.com>
References: <k5p9o9$kqi$1@ger.gmane.org> <50815415.8090308@rabbitmq.com>
Message-ID: <50816330.7080900@rabbitmq.com>

Hi Michael,

On 19/10/12 14:22, Emile Joubert wrote:
> If I'm misunderstanding your question then please send another
> illustration that shows what information is missing. Is the problem with
> the STOMP spec or with the RabbitMQ implementation of it?

After sending this I discovered that some relevant documentation about
the handling of message-id headers in STOMP in RabbitMQ was not
published, so I've done that now: "message-id" is not allowed in SEND
frames, because it clashes with the header that the server places in the
MESSAGE frame. I now realise that this prohibition is what you might
have been referring to.

AMQP also has a message-id property and if you want to set that then you
can use the special "amqp-message-id:" header. The same
"amqp-message-id:" will appear in delivered MESSAGE frames.


-Emile





From eliao at seegrid.com  Fri Oct 19 15:41:19 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Fri, 19 Oct 2012 14:41:19 +0000
Subject: [rabbitmq-discuss] nodename variable and mnesia directory
Message-ID: <E94F626F5C43D14F8B8479C5EBD79038A85DD645@vmexchange02.seegrid.local>

Hi,

We are currently running rabbitmq on a system where there is a need to change the hostname occasionally.  Right now, when the hostname is changed, we also update the NODENAME variable in the rabbitmq-env.conf file.

The problem we're having right now is that due to a bug when setting up the rabbitmq-env.conf file, sometimes the NODENAME variable exists but is not set to anything ( NODENAME=) so rabbit never successfully starts up.  Even after setting the NODENAME variable to the hostname, rabbit still doesn't start up properly.

The only way that I could find to recover from this situation without killing the erlang process, was to also set a MNESIA_DIR variable. After I did that, once the NODENAME was set to the correct hostname, rabbit started up properly.

A couple of questions:
Is this the proper way to fix the situation?
Will this have unintended consequences?

We are running rabbitmq-server-2.8.6 and erlang-R15B.

Thanks!

Liz
Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From emile at rabbitmq.com  Fri Oct 19 16:13:35 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 19 Oct 2012 16:13:35 +0100
Subject: [rabbitmq-discuss] RabbbitMQ and Biztalk Port
In-Reply-To: <CACF3+9Mf4NrX-_gVf1XEt3Uk18gEK=pO4U1PN--XP7VToxAP7g@mail.gmail.com>
References: <9524c212-3d70-40c5-83e2-ebe92b3fa5be@googlegroups.com>
	<a1e529c6-bc12-4f83-9c09-91b2b9b0ed3c@googlegroups.com>
	<CACF3+9Mf4NrX-_gVf1XEt3Uk18gEK=pO4U1PN--XP7VToxAP7g@mail.gmail.com>
Message-ID: <50816E1F.9000304@rabbitmq.com>

On 16/10/12 15:48, saibabu maddineni wrote:
> if you can give clear informaton that would be great help.

There is no indication in the original article about what additional
steps might be required or what the potential obstacles might be. I
suggest you employ a process of elimination to verify that all of the
individual components of your system are working. E.g. confirm that the
RabbitMQ WCF tests pass and check that BizTalk works with another
provider. Then join the components once you are happy that they all work
individually. If you experience any problem with the RabbitMQ WCF
binding during verification then please let us know.

If you are still stuck after this point and no-one else on the list can
provide assistance then you should consider making use of the BizTalk
support channels.


-Emile


From dseltzer at tveyes.com  Fri Oct 19 16:47:51 2012
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Fri, 19 Oct 2012 11:47:51 -0400
Subject: [rabbitmq-discuss] Web Management Plugin Sluggishness
Message-ID: <dab2720d8c79fd954963a4b4da524430@mail.gmail.com>

Hello,



We have a number of RabbitMQ clusters in our environment. Recently I?ve
started rolling out some new HA Clusters running RabbitMQ 2.8.7 on Erlang
R15B02 in Centos.



In the most recent version of RabbitMQ we?re seeing some significant
sluggishness in the Web Management Plugin. It almost seems like it?s
javascript related because the whole browser (Chrome) gets a bit sluggish.



Is anyone else seeing this?



We have introduced one other change which is that I?ve switched from
HAProxy to Zen Load Balancer. I don?t think this has anything to do with it
though, because when I test against an individual server I still get
sluggishness.



-Dave
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/335bed20/attachment.htm>

From dseltzer at tveyes.com  Fri Oct 19 17:26:51 2012
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Fri, 19 Oct 2012 12:26:51 -0400
Subject: [rabbitmq-discuss] Web Management Plugin Sluggishness
In-Reply-To: <dab2720d8c79fd954963a4b4da524430@mail.gmail.com>
References: <dab2720d8c79fd954963a4b4da524430@mail.gmail.com>
Message-ID: <CAHW0W4NPJjU4ZUVWvDf4Eiw1fWvkUbsXSgcPkbtuL3fi3LiVSw@mail.gmail.com>

Digging a little bit deeper, the symptom I'm seeing is that it's taking a
while to load key json data from the http API.

Specifically: *http://queue01:55672/api/nodes* is taking more than 3
seconds to load.

Is anyone aware of what would cause this slowness?

-Dave


On Fri, Oct 19, 2012 at 11:47 AM, Dave Seltzer <dseltzer at tveyes.com> wrote:

> Hello,
>
>
>
> We have a number of RabbitMQ clusters in our environment. Recently I?ve
> started rolling out some new HA Clusters running RabbitMQ 2.8.7 on Erlang
> R15B02 in Centos.
>
>
>
> In the most recent version of RabbitMQ we?re seeing some significant
> sluggishness in the Web Management Plugin. It almost seems like it?s
> javascript related because the whole browser (Chrome) gets a bit sluggish.
>
>
>
> Is anyone else seeing this?
>
>
>
> We have introduced one other change which is that I?ve switched from
> HAProxy to Zen Load Balancer. I don?t think this has anything to do with it
> though, because when I test against an individual server I still get
> sluggishness.
>
>
>
> -Dave
>
>
>



-- 
Dave Seltzer <dseltzer at tveyes.com>
Chief Systems Architect
TVEyes
(203) 254-3600 x222
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/ac84aa88/attachment.htm>

From simon at rabbitmq.com  Fri Oct 19 17:41:03 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 19 Oct 2012 17:41:03 +0100
Subject: [rabbitmq-discuss] Web Management Plugin Sluggishness
In-Reply-To: <CAHW0W4NPJjU4ZUVWvDf4Eiw1fWvkUbsXSgcPkbtuL3fi3LiVSw@mail.gmail.com>
References: <dab2720d8c79fd954963a4b4da524430@mail.gmail.com>
	<CAHW0W4NPJjU4ZUVWvDf4Eiw1fWvkUbsXSgcPkbtuL3fi3LiVSw@mail.gmail.com>
Message-ID: <5081829F.9060502@rabbitmq.com>

In 2.8.x (and prior), /api/nodes will make an RPC call to each node in 
turn to get the node-specific stats. If one node is heavily loaded or 
slow in responding for whatever reason this will mean /api/nodes will 
take a long time to return.

This has changed on default already, for basically the reason you're 
running into, and the nodes emit stats events for the management DB to 
pick up.

If you invoke:

rabbitmqctl eval '[timer:tc(fun () -> 
rabbit_mgmt_external_stats:info(N), N end) || N <- 
rabbit_mnesia:running_clustered_nodes()].'

(all one line)

then rabbitmqctl will make all these RPC calls and time them (the times 
are in microseconds). That might let you know if you have a problem node.

Cheers, Simon

On 19/10/12 17:26, Dave Seltzer wrote:
> Digging a little bit deeper, the symptom I'm seeing is that it's taking
> a while to load key json data from the http API.
>
> Specifically: _http://queue01:55672/api/nodes_ is taking more than 3
> seconds to load.
>
> Is anyone aware of what would cause this slowness?
>
> -Dave
>
>
> On Fri, Oct 19, 2012 at 11:47 AM, Dave Seltzer <dseltzer at tveyes.com
> <mailto:dseltzer at tveyes.com>> wrote:
>
>     Hello,
>
>     We have a number of RabbitMQ clusters in our environment. Recently
>     I?ve started rolling out some new HA Clusters running RabbitMQ 2.8.7
>     on Erlang R15B02 in Centos.
>
>     In the most recent version of RabbitMQ we?re seeing some significant
>     sluggishness in the Web Management Plugin. It almost seems like it?s
>     javascript related because the whole browser (Chrome) gets a bit
>     sluggish.
>
>     Is anyone else seeing this?
>
>     We have introduced one other change which is that I?ve switched from
>     HAProxy to Zen Load Balancer. I don?t think this has anything to do
>     with it though, because when I test against an individual server I
>     still get sluggishness.
>
>     -Dave
>
>
>
>
> --
> Dave Seltzer <mailto:dseltzer at tveyes.com>
> Chief Systems Architect
> TVEyes
> (203) 254-3600 x222
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Fri Oct 19 17:42:55 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 19 Oct 2012 17:42:55 +0100
Subject: [rabbitmq-discuss] nodename variable and mnesia directory
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD79038A85DD645@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD79038A85DD645@vmexchange02.seegrid.local>
Message-ID: <5081830F.70706@rabbitmq.com>

Hi

On 10/19/2012 03:41 PM, Elizabeth Liao wrote:
> Hi,
>
> We are currently running rabbitmq on a system where there is a need to change the hostname occasionally.  Right now, when the hostname is changed, we also update the NODENAME variable in the rabbitmq-env.conf file.

The first thing I'm going to say is that this isn't really a desirable 
state of affairs. Why do you need to change NODENAME at all, just 
because the host name has changed? This seems like an odd step to me - 
can you explain the rationale behind it?

> The problem we're having right now is that due to a bug when setting up the rabbitmq-env.conf file, sometimes the NODENAME variable exists but is not set to anything ( NODENAME=) so rabbit never successfully starts up.  Even after setting the NODENAME variable to the hostname, rabbit still doesn't start up properly.

Can you explain a bit more about this 'bug' please? What exactly is 
going wrong?

> The only way that I could find to recover from this situation without killing the erlang process, was to also set a MNESIA_DIR variable. After I did that, once the NODENAME was set to the correct hostname, rabbit started up properly.

Now this makes no sense at all to me. If you are trying to recover 
'without killing the erlang process' then how are you planning on 
changing the NODENAME? Once an erlang node has become part of a 
distributed system, you cannot arbitrarily change the node's name 
without restarting the net_kernel AFAIK so I can't see how this is even 
possible. Also, because you're stating that 'rabbit started up properly' 
I'm assuming that you have in fact taken the node offline (using 
`rabbitmqctl stop` or one of the various service scripts that invokes 
it) and that you are now starting the node again. The rabbit startup 
scripts (and associated infrastructure) is not set up to handle changing 
the name of a node post-installation in this manner, so I would not 
expect this to work smoothly.

> A couple of questions:
> Is this the proper way to fix the situation?

No. As I said a moment ago, rabbit is not set up for this kind of 
scenario so I'd be very cautious about doing this and would really 
recommend against it.

> Will this have unintended consequences?

I have no idea, but it is entirely possible that various things could 
break in obscure and alarming ways. I really would not do this if I were 
you.

> We are running rabbitmq-server-2.8.6 and erlang-R15B.
>
> Thanks!

Liz. I would like to help you find a safe work-around so that you can 
use rabbit in your environment. I would really like to understand why 
the changing of a machine's host-name is causing problems for you. I 
fully realise that after changing the hostname, it is possible that a 
restart may be required (although I'd have to do some research to verify 
whether or not this is a hard requirement). But I cannot understand why 
a change to the machine's host name requires changing the rabbit 
NODENAME at all, unless you've altered the rabbit start scripts to use 
'longnames' configuration (i.e., including the complete host name in the 
node name) in which case, a simple solution to your problem might be to 
switch back to using 'shortnames'. If erlang is started using -sname 
rabbit@`hostname -s` and your /etc/hosts configuration supports 
resolving the machine's IP to the short version of the name, then 
changing the hostname shouldn't cause all of these headaches.

For example, if I launch rabbit with something like this:

env RABBITMQ_NODENAME=rabbit RABBITMQ_NODE_PORT=5672 
RABBITMQ_LOG_BASE="/tmp" 
RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia" 
RABBITMQ_PID_FILE="/tmp/rabbitmq-rabbit.pid" 
RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch" 
RABBITMQ_ENABLED_PLUGINS_FILE="/tmp/enabled-plugins" 
RABBITMQ_CONFIG_FILE="/tmp/etc/rabbit" ./scripts/rabbitmq-server

Then change the hostname, then stop rabbit and start it again, 
everything is fine.

Cheers,
Tim

> Liz
> Email Confidentiality Notice
>
> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From dseltzer at tveyes.com  Fri Oct 19 17:51:43 2012
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Fri, 19 Oct 2012 12:51:43 -0400
Subject: [rabbitmq-discuss] Web Management Plugin Sluggishness
In-Reply-To: <5081829F.9060502@rabbitmq.com>
References: <dab2720d8c79fd954963a4b4da524430@mail.gmail.com>
	<CAHW0W4NPJjU4ZUVWvDf4Eiw1fWvkUbsXSgcPkbtuL3fi3LiVSw@mail.gmail.com>
	<5081829F.9060502@rabbitmq.com>
Message-ID: <CAHW0W4NTLsb8_RCFvac56q8G-OmkQcyb9X+9yvxSa5FuyCjp3w@mail.gmail.com>

Thanks Simon,

Running that revealed that both of my RabbitMQ servers are equally slow:

The output shows:
[{1966992,rabbit at queue02},{1302805,rabbit at queue01}]
...done.

I believe this means that data took 1.9 seconds from egressqueue02 and 1.3
seconds from egressqueue01.

In terms of looking for the cause of the slowness is this usually related
to DiskIO, or am I looking at a CPU issue.

Thanks!

-Dave


On Fri, Oct 19, 2012 at 12:41 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> In 2.8.x (and prior), /api/nodes will make an RPC call to each node in
> turn to get the node-specific stats. If one node is heavily loaded or slow
> in responding for whatever reason this will mean /api/nodes will take a
> long time to return.
>
> This has changed on default already, for basically the reason you're
> running into, and the nodes emit stats events for the management DB to pick
> up.
>
> If you invoke:
>
> rabbitmqctl eval '[timer:tc(fun () -> rabbit_mgmt_external_stats:**info(N),
> N end) || N <- rabbit_mnesia:running_**clustered_nodes()].'
>
> (all one line)
>
> then rabbitmqctl will make all these RPC calls and time them (the times
> are in microseconds). That might let you know if you have a problem node.
>
> Cheers, Simon
>
> On 19/10/12 17:26, Dave Seltzer wrote:
>
>> Digging a little bit deeper, the symptom I'm seeing is that it's taking
>> a while to load key json data from the http API.
>>
>> Specifically: _http://queue01:55672/api/**nodes_<http://queue01:55672/api/nodes_>is taking more than 3
>> seconds to load.
>>
>> Is anyone aware of what would cause this slowness?
>>
>> -Dave
>>
>>
>> On Fri, Oct 19, 2012 at 11:47 AM, Dave Seltzer <dseltzer at tveyes.com
>> <mailto:dseltzer at tveyes.com>> wrote:
>>
>>     Hello,
>>
>>     We have a number of RabbitMQ clusters in our environment. Recently
>>     I?ve started rolling out some new HA Clusters running RabbitMQ 2.8.7
>>     on Erlang R15B02 in Centos.
>>
>>     In the most recent version of RabbitMQ we?re seeing some significant
>>     sluggishness in the Web Management Plugin. It almost seems like it?s
>>     javascript related because the whole browser (Chrome) gets a bit
>>     sluggish.
>>
>>     Is anyone else seeing this?
>>
>>     We have introduced one other change which is that I?ve switched from
>>     HAProxy to Zen Load Balancer. I don?t think this has anything to do
>>     with it though, because when I test against an individual server I
>>     still get sluggishness.
>>
>>     -Dave
>>
>>
>>
>>
>> --
>> Dave Seltzer <mailto:dseltzer at tveyes.com>
>> Chief Systems Architect
>> TVEyes
>> (203) 254-3600 x222
>>
>>
>>
>> ______________________________**_________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>>
>>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
Dave Seltzer <dseltzer at tveyes.com>
Chief Systems Architect
TVEyes
(203) 254-3600 x222
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/018fc0ce/attachment.htm>

From simon at rabbitmq.com  Fri Oct 19 17:58:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 19 Oct 2012 17:58:10 +0100
Subject: [rabbitmq-discuss] Web Management Plugin Sluggishness
In-Reply-To: <CAHW0W4NTLsb8_RCFvac56q8G-OmkQcyb9X+9yvxSa5FuyCjp3w@mail.gmail.com>
References: <dab2720d8c79fd954963a4b4da524430@mail.gmail.com>
	<CAHW0W4NPJjU4ZUVWvDf4Eiw1fWvkUbsXSgcPkbtuL3fi3LiVSw@mail.gmail.com>
	<5081829F.9060502@rabbitmq.com>
	<CAHW0W4NTLsb8_RCFvac56q8G-OmkQcyb9X+9yvxSa5FuyCjp3w@mail.gmail.com>
Message-ID: <508186A2.6060309@rabbitmq.com>

On 19/10/12 17:51, Dave Seltzer wrote:
> In terms of looking for the cause of the slowness is this usually
> related to DiskIO, or am I looking at a CPU issue.

Depends on what's slow!

Let's iterate again:

rabbitmqctl eval '[timer:tc(fun () -> rabbit_mgmt_external_stats:info(N, 
[K]), {N, K} end) || K <- 
[os_pid,mem_ets,mem_binary,mem_proc,mem_proc_used,mem_atom,mem_atom_used,mem_code,fd_used,fd_total,sockets_used,sockets_total,mem_used,mem_limit,mem_alarm,disk_free_limit,disk_free,disk_free_alarm,proc_used,proc_total,statistics_level,erlang_version,uptime,run_queue,processors,exchange_types,auth_mechanisms,applications], 
N <- [rabbit at queue01,rabbit at queue02]].'

This will provide a time for each individual info item.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dseltzer at tveyes.com  Fri Oct 19 19:25:51 2012
From: dseltzer at tveyes.com (Dave Seltzer)
Date: Fri, 19 Oct 2012 14:25:51 -0400
Subject: [rabbitmq-discuss] Web Management Plugin Sluggishness
In-Reply-To: <508186A2.6060309@rabbitmq.com>
References: <dab2720d8c79fd954963a4b4da524430@mail.gmail.com>
	<CAHW0W4NPJjU4ZUVWvDf4Eiw1fWvkUbsXSgcPkbtuL3fi3LiVSw@mail.gmail.com>
	<5081829F.9060502@rabbitmq.com>
	<CAHW0W4NTLsb8_RCFvac56q8G-OmkQcyb9X+9yvxSa5FuyCjp3w@mail.gmail.com>
	<508186A2.6060309@rabbitmq.com>
Message-ID: <CAHW0W4OuH7E-nhn2pBzkLHoem_YwM=sEAGwV3wJ9R2HABg3-Jg@mail.gmail.com>

Running that script produces this:

[{490415,{rabbit at queue01,os_pid}},
 {7465,{rabbit at queue02,os_pid}},
 {470,{rabbit at queue01,mem_ets}},
 {912,{rabbit at queue02,mem_ets}},
 {249,{rabbit at queue01,mem_binary}},
 {584,{rabbit at queue02,mem_binary}},
 {173,{rabbit at queue01,mem_proc}},
 {660,{rabbit at queue02,mem_proc}},
 {172,{rabbit at queue01,mem_proc_used}},
 {555,{rabbit at queue02,mem_proc_used}},
 {144,{rabbit at queue01,mem_atom}},
 {1066,{rabbit at queue02,mem_atom}},
 {256,{rabbit at queue01,mem_atom_used}},
 {716,{rabbit at queue02,mem_atom_used}},
 {178,{rabbit at queue01,mem_code}},
 {474,{rabbit at queue02,mem_code}},
 {62,{rabbit at queue01,fd_used}},
 {422,{rabbit at queue02,fd_used}},
 {62,{rabbit at queue01,fd_total}},
 {437,{rabbit at queue02,fd_total}},
 {76,{rabbit at queue01,sockets_used}},
 {446,{rabbit at queue02,sockets_used}},
 {78,{rabbit at queue01,sockets_total}},
 {678,{rabbit at queue02,sockets_total}},
 {181,{rabbit at queue01,mem_used}},
 {1126,{rabbit at queue02,mem_used}},
 {71,{rabbit at queue01,mem_limit}},
 {7747,{rabbit at queue02,mem_limit}},
 {94,{rabbit at queue01,mem_alarm}},
 {636,{rabbit at queue02,mem_alarm}},
 {87,{rabbit at queue01,disk_free_limit}},
 {588,{rabbit at queue02,disk_free_limit}},
 {1152028,{rabbit at queue01,disk_free}},
 {1694075,{rabbit at queue02,disk_free}},
 {635870,{rabbit at queue01,disk_free_alarm}},
 {310155,{rabbit at queue02,disk_free_alarm}},
 {999554,{rabbit at queue01,proc_used}},
 {823,{rabbit at queue02,proc_used}},
 {1286885,{rabbit at queue01,proc_total}},
 {27490,{rabbit at queue02,proc_total}},
 {1207,{rabbit at queue01,statistics_level}},
 {960135,{rabbit at queue02,statistics_level}},
 {70,{rabbit at queue01,erlang_version}},
 {956790,{rabbit at queue02,erlang_version}},
 {47244,{rabbit at queue01,uptime}},
 {2882,{rabbit at queue02,uptime}},
 {949552,{rabbit at queue01,run_queue}},
 {93713,{rabbit at queue02,run_queue}},
 {974491,{rabbit at queue01,processors}},
 {789,{rabbit at queue02,processors}},
 {99,{rabbit at queue01,exchange_types}},
 {938,{rabbit at queue02,exchange_types}},
 {87,{rabbit at queue01,auth_mechanisms}},
 {428,{rabbit at queue02,auth_mechanisms}},
 {153,{rabbit at queue01,applications}},
 {585,{rabbit at queue02,applications}}]
...done.

Seems like the big values are:
{490415,{rabbit at queue01,os_pid}}
{1152028,{rabbit at queue01,disk_free}}
{1694075,{rabbit at queue02,disk_free}}
{635870,{rabbit at queue01,disk_free_alarm}}
{310155,{rabbit at queue02,disk_free_alarm}}
{1286885,{rabbit at queue01,proc_total}}
{960135,{rabbit at queue02,statistics_level}}
{956790,{rabbit at queue02,erlang_version}}
{949552,{rabbit at queue01,run_queue}}
{93713,{rabbit at queue02,run_queue}}
{974491,{rabbit at queue01,processors}}

The worst offenders are DiskFree on both servers and proc_total on queue01.

I'm not sure what I should be l looking for here.

Again! Thanks so much for your help!

-Dave

On Fri, Oct 19, 2012 at 12:58 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 19/10/12 17:51, Dave Seltzer wrote:
>
>> In terms of looking for the cause of the slowness is this usually
>> related to DiskIO, or am I looking at a CPU issue.
>>
>
> Depends on what's slow!
>
> Let's iterate again:
>
> rabbitmqctl eval '[timer:tc(fun () -> rabbit_mgmt_external_stats:**info(N,
> [K]), {N, K} end) || K <- [os_pid,mem_ets,mem_binary,**
> mem_proc,mem_proc_used,mem_**atom,mem_atom_used,mem_code,**
> fd_used,fd_total,sockets_used,**sockets_total,mem_used,mem_**
> limit,mem_alarm,disk_free_**limit,disk_free,disk_free_**
> alarm,proc_used,proc_total,**statistics_level,erlang_**
> version,uptime,run_queue,**processors,exchange_types,**auth_mechanisms,applications],
> N <- [rabbit at queue01,rabbit at queue02**]].'
>
> This will provide a time for each individual info item.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>



-- 
Dave Seltzer <dseltzer at tveyes.com>
Chief Systems Architect
TVEyes
(203) 254-3600 x222
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/f0c7bfbb/attachment.htm>

From eliao at seegrid.com  Fri Oct 19 19:44:26 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Fri, 19 Oct 2012 18:44:26 +0000
Subject: [rabbitmq-discuss] nodename variable and mnesia directory
In-Reply-To: <5081830F.70706@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD79038A85DD645@vmexchange02.seegrid.local>,
	<5081830F.70706@rabbitmq.com>
Message-ID: <E94F626F5C43D14F8B8479C5EBD79038A85DD854@vmexchange02.seegrid.local>

Hi Tim,

I'm going to back up a bit because it seems that I've misunderstood something previously.

>The first thing I'm going to say is that this isn't really a desirable
state of affairs. Why do you need to change NODENAME at all, just
because the host name has changed? This seems like an odd step to me -
can you explain the rationale behind it?

I had an earlier problem changing the hostname and restarting the rabbitmq-server. The proposed fix was to add the NODENAME variable which I'm guessing was not right? :
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021435.html

>Can you explain a bit more about this 'bug' please? What exactly is
going wrong?

The bug is on our end where the NODENAME is set to an empty string. Of course this is moot if NODENAME doesn't even have to be set in the first place.

Liz
________________________________________
From: Tim Watson [tim at rabbitmq.com]
Sent: Friday, October 19, 2012 12:48 PM
To: Discussions about RabbitMQ
Cc: Elizabeth Liao
Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory

Hi

On 10/19/2012 03:41 PM, Elizabeth Liao wrote:
> Hi,
>
> We are currently running rabbitmq on a system where there is a need to change the hostname occasionally.  Right now, when the hostname is changed, we also update the NODENAME variable in the rabbitmq-env.conf file.

The first thing I'm going to say is that this isn't really a desirable
state of affairs. Why do you need to change NODENAME at all, just
because the host name has changed? This seems like an odd step to me -
can you explain the rationale behind it?

> The problem we're having right now is that due to a bug when setting up the rabbitmq-env.conf file, sometimes the NODENAME variable exists but is not set to anything ( NODENAME=) so rabbit never successfully starts up.  Even after setting the NODENAME variable to the hostname, rabbit still doesn't start up properly.

Can you explain a bit more about this 'bug' please? What exactly is
going wrong?

> The only way that I could find to recover from this situation without killing the erlang process, was to also set a MNESIA_DIR variable. After I did that, once the NODENAME was set to the correct hostname, rabbit started up properly.

Now this makes no sense at all to me. If you are trying to recover
'without killing the erlang process' then how are you planning on
changing the NODENAME? Once an erlang node has become part of a
distributed system, you cannot arbitrarily change the node's name
without restarting the net_kernel AFAIK so I can't see how this is even
possible. Also, because you're stating that 'rabbit started up properly'
I'm assuming that you have in fact taken the node offline (using
`rabbitmqctl stop` or one of the various service scripts that invokes
it) and that you are now starting the node again. The rabbit startup
scripts (and associated infrastructure) is not set up to handle changing
the name of a node post-installation in this manner, so I would not
expect this to work smoothly.

> A couple of questions:
> Is this the proper way to fix the situation?

No. As I said a moment ago, rabbit is not set up for this kind of
scenario so I'd be very cautious about doing this and would really
recommend against it.

> Will this have unintended consequences?

I have no idea, but it is entirely possible that various things could
break in obscure and alarming ways. I really would not do this if I were
you.

> We are running rabbitmq-server-2.8.6 and erlang-R15B.
>
> Thanks!

Liz. I would like to help you find a safe work-around so that you can
use rabbit in your environment. I would really like to understand why
the changing of a machine's host-name is causing problems for you. I
fully realise that after changing the hostname, it is possible that a
restart may be required (although I'd have to do some research to verify
whether or not this is a hard requirement). But I cannot understand why
a change to the machine's host name requires changing the rabbit
NODENAME at all, unless you've altered the rabbit start scripts to use
'longnames' configuration (i.e., including the complete host name in the
node name) in which case, a simple solution to your problem might be to
switch back to using 'shortnames'. If erlang is started using -sname
rabbit@`hostname -s` and your /etc/hosts configuration supports
resolving the machine's IP to the short version of the name, then
changing the hostname shouldn't cause all of these headaches.

For example, if I launch rabbit with something like this:

env RABBITMQ_NODENAME=rabbit RABBITMQ_NODE_PORT=5672
RABBITMQ_LOG_BASE="/tmp"
RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia"
RABBITMQ_PID_FILE="/tmp/rabbitmq-rabbit.pid"
RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch"
RABBITMQ_ENABLED_PLUGINS_FILE="/tmp/enabled-plugins"
RABBITMQ_CONFIG_FILE="/tmp/etc/rabbit" ./scripts/rabbitmq-server

Then change the hostname, then stop rabbit and start it again,
everything is fine.

Cheers,
Tim

> Liz
> Email Confidentiality Notice
>
> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From brendan at soundcloud.com  Fri Oct 19 20:54:18 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Fri, 19 Oct 2012 21:54:18 +0200
Subject: [rabbitmq-discuss] Nightlies now available - help us test
 RabbitMQ 3.0
In-Reply-To: <508133D5.8030108@rabbitmq.com>
References: <508133D5.8030108@rabbitmq.com>
Message-ID: <CAHZsVQav7Pzsvr6rw_rnVBpsoPggxXXJj=w9H7vA--6+n9xVxQ@mail.gmail.com>

That's great news, Simon. The policy configuration for mirrored queues and
federation is exactly what I need!

On Fri, Oct 19, 2012 at 1:04 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Hi everyone! We've just put in place a nightly build system for the
> RabbitMQ server and clients. You can download nightlies from
> http://www.rabbitmq.com/**nightly-builds.html<http://www.rabbitmq.com/nightly-builds.html>
>
> We've also put documentation for what will be the next version of RabbitMQ
> at http://next.rabbitmq.com/**documentation.html<http://next.rabbitmq.com/documentation.html>
> .
>
> We're evolving towards a model where we have feature releases every few
> months, with bugfix releases in between. It's possible there will be a
> 2.8.8 bugfix release, but that's not what the current nightlies are - they
> represent what will be RabbitMQ 3.0.
>
> So with some caveats in place:
>
>  * Obviously we do not suggest running nightlies on production systems.
>
>  * We don't always guarantee upgrades from one nightly to another will
>    work - you may have to reset everything and start again sometimes.
>
>  * You would also have to reset everything and start again to revert to
>    a stable release from a nightly.
>
> ...I'd invite you to have a look at what's coming, and tell use what you
> think.
>
> I'm going to write more on the subject as we get closer to the release,
> but some of the major new features include:
>
>  * HA queues are configured dynamically by a new policy mechanism,
>    rather than by declaring them with "x-ha-policy". HA-ness
>    can be changed at any time. HA queues are also much faster.
>
>  * Federated exchanges are now normal exchanges, with federation
>    similarly configured dynamically by policy. The "x-federation"
>    exchange type is no more.
>
>  * Clustering commands in rabbitmqctl have been rewritten to make
>    clustering easier and more robust.
>
>  * Web-STOMP and MQTT plugins are included.
>
>  * Lots of other smaller new features and bug fixes.
>
> The network protocol hasn't changed; you can run 2.x clients against 3.x
> server and vice versa.
>
> So please try it out, and talk to us!
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/9af8b399/attachment.htm>

From deshai-0 at student.ltu.se  Fri Oct 19 21:09:15 2012
From: deshai-0 at student.ltu.se (Desta Haileselassie Hagos)
Date: Fri, 19 Oct 2012 22:09:15 +0200
Subject: [rabbitmq-discuss] RabbitMQ + Messages between virtual machines and
	physical hosts on a cloud
Message-ID: <CAKiRAqUDH2Go=H-VwLj0dtdKRq7jD5wpNxspoi_LGuh9kSz5OA@mail.gmail.com>

Dear Sir/Madam,

I am trying to exchange messages between Virtula machines running  on a
cloud and the physical hosts which runs OpenStack cloud services where they
are launched on so as to get some sort of information using the RabbitMQ
server. But it doesn't seem to be working out for me. I just want to send
and receive messages or some sort of RPC implementation in which where we
can receive full information of the Virtual Machine instances.

I would, therefore, appreciate if you could be of help in this regard.


With best regards,

Desta



-- 
Desta Haileselassie Hagos
Cell Phone: +46764092132

Lule? University of Technology
Department of Computer Science Electrical and Space Engineering
MSc in Mobile Systems

Professorsv?gen21
977 51
Lule?, Sweden
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/adaa8df4/attachment.htm>

From gmr at meetme.com  Sat Oct 20 02:45:02 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Fri, 19 Oct 2012 21:45:02 -0400
Subject: [rabbitmq-discuss] Nightlies now available - help us test
 RabbitMQ 3.0
In-Reply-To: <508133D5.8030108@rabbitmq.com>
References: <508133D5.8030108@rabbitmq.com>
Message-ID: <D970114465F544488BCD0F6F9FF70B29@meetme.com>

This is great! Thanks!

Since you're talking about new features, how about a request? Since you're making federation config dynamic, how about configuration changes for shovel without having to restart the broker too?

And a bigger request? A counter for the number of messages that have passed through a queue? :)

Will cowboy make it's way in as a replacement for mochiweb? Have you guys seen any improvement in performance with it?

Cheers,

Gavin 


On Friday, October 19, 2012 at 7:04 AM, Simon MacMullen wrote: 
> Hi everyone! We've just put in place a nightly build system for the 
> RabbitMQ server and clients. You can download nightlies from 
> http://www.rabbitmq.com/nightly-builds.html
> 
> We've also put documentation for what will be the next version of 
> RabbitMQ at http://next.rabbitmq.com/documentation.html.
> 
> We're evolving towards a model where we have feature releases every few 
> months, with bugfix releases in between. It's possible there will be a 
> 2.8.8 bugfix release, but that's not what the current nightlies are - 
> they represent what will be RabbitMQ 3.0.
> 
> So with some caveats in place:
> 
> * Obviously we do not suggest running nightlies on production systems.
> 
> * We don't always guarantee upgrades from one nightly to another will
> work - you may have to reset everything and start again sometimes.
> 
> * You would also have to reset everything and start again to revert to
> a stable release from a nightly.
> 
> ...I'd invite you to have a look at what's coming, and tell use what you 
> think.
> 
> I'm going to write more on the subject as we get closer to the release, 
> but some of the major new features include:
> 
> * HA queues are configured dynamically by a new policy mechanism,
> rather than by declaring them with "x-ha-policy". HA-ness
> can be changed at any time. HA queues are also much faster.
> 
> * Federated exchanges are now normal exchanges, with federation
> similarly configured dynamically by policy. The "x-federation"
> exchange type is no more.
> 
> * Clustering commands in rabbitmqctl have been rewritten to make
> clustering easier and more robust.
> 
> * Web-STOMP and MQTT plugins are included.
> 
> * Lots of other smaller new features and bug fixes.
> 
> The network protocol hasn't changed; you can run 2.x clients against 3.x 
> server and vice versa.
> 
> So please try it out, and talk to us!
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/eadc6889/attachment.htm>

From brendan at soundcloud.com  Sat Oct 20 03:38:06 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Sat, 20 Oct 2012 13:38:06 +1100
Subject: [rabbitmq-discuss] Nightlies now available - help us test
 RabbitMQ 3.0
In-Reply-To: <D970114465F544488BCD0F6F9FF70B29@meetme.com>
References: <508133D5.8030108@rabbitmq.com>
	<D970114465F544488BCD0F6F9FF70B29@meetme.com>
Message-ID: <CAHZsVQZfDtodBB6LaDpFz-88ngU0moG+3wUmYMOYBkEaYSUgsw@mail.gmail.com>

To follow on with the possible mochweb replacement, how about choosing a
native/faster JSON serialization lib? =)

On Sat, Oct 20, 2012 at 12:45 PM, Gavin M. Roy <gmr at meetme.com> wrote:

> This is great! Thanks!
>
> Since you're talking about new features, how about a request? Since you're
> making federation config dynamic, how about configuration changes for
> shovel without having to restart the broker too?
>
> And a bigger request? A counter for the number of messages that have
> passed through a queue? :)
>
> Will cowboy make it's way in as a replacement for mochiweb? Have you guys
> seen any improvement in performance with it?
>
> Cheers,
>
> Gavin
>
>
> On Friday, October 19, 2012 at 7:04 AM, Simon MacMullen wrote:
>
> Hi everyone! We've just put in place a nightly build system for the
> RabbitMQ server and clients. You can download nightlies from
> http://www.rabbitmq.com/nightly-builds.html
>
> We've also put documentation for what will be the next version of
> RabbitMQ at http://next.rabbitmq.com/documentation.html.
>
> We're evolving towards a model where we have feature releases every few
> months, with bugfix releases in between. It's possible there will be a
> 2.8.8 bugfix release, but that's not what the current nightlies are -
> they represent what will be RabbitMQ 3.0.
>
> So with some caveats in place:
>
> * Obviously we do not suggest running nightlies on production systems.
>
> * We don't always guarantee upgrades from one nightly to another will
> work - you may have to reset everything and start again sometimes.
>
> * You would also have to reset everything and start again to revert to
> a stable release from a nightly.
>
> ...I'd invite you to have a look at what's coming, and tell use what you
> think.
>
> I'm going to write more on the subject as we get closer to the release,
> but some of the major new features include:
>
> * HA queues are configured dynamically by a new policy mechanism,
> rather than by declaring them with "x-ha-policy". HA-ness
> can be changed at any time. HA queues are also much faster.
>
> * Federated exchanges are now normal exchanges, with federation
> similarly configured dynamically by policy. The "x-federation"
> exchange type is no more.
>
> * Clustering commands in rabbitmqctl have been rewritten to make
> clustering easier and more robust.
>
> * Web-STOMP and MQTT plugins are included.
>
> * Lots of other smaller new features and bug fixes.
>
> The network protocol hasn't changed; you can run 2.x clients against 3.x
> server and vice versa.
>
> So please try it out, and talk to us!
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121020/f98bb7ac/attachment.htm>

From aggarwalsandeep at optonline.net  Sat Oct 20 06:01:49 2012
From: aggarwalsandeep at optonline.net (Sandeep Aggarwal)
Date: Fri, 19 Oct 2012 22:01:49 -0700 (PDT)
Subject: [rabbitmq-discuss] requeue to HA mirrored queue
In-Reply-To: <e09b42bf-c6f1-46a0-990a-ba1cf7515de1@googlegroups.com>
References: <e09b42bf-c6f1-46a0-990a-ba1cf7515de1@googlegroups.com>
Message-ID: <68219c85-397e-4c5a-97d0-82df8e69d217@googlegroups.com>

Hi Jan - I believe it should be possible. I was just trying to play around 
with mirrored queues today and I was able to requeue my test messages. I'll 
confirm after running another test on my work PC - unfortunately I'll have 
to wait until Monday as my laptop is not fully configured yet. One question 
though - are you passing the requeue option in the method to reject at the 
time of rejecting or nacking the message?

On Friday, October 19, 2012 4:27:09 AM UTC-4, Jan Schumacher wrote:
>
> Hi everybody!
> I'm trying to reject a message on a clustered rabbitmq with the queue 
> property requeue=true. The queue has set the argument requeue to true.
> And the problem is, it just doesn't work. 
> After sending the message to the queue the message is set to 
> unacknowledged and after rejecting the message it won't be rejected to the 
> queue and is gone to nowhere.
> So i've tested the same issue with a non clustered rabbitmq server and it 
> works.
> My question is: Is it possible to requeue messages on clustered rabbitmqs?
> Best regards!
> Jan Schumacher
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121019/9ca438ab/attachment.htm>

From alan.antonuk at gmail.com  Sat Oct 20 08:02:12 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sat, 20 Oct 2012 03:02:12 -0400
Subject: [rabbitmq-discuss] Problems compiling RabbitMQ-C Kit on Sparc
	32-bit...
In-Reply-To: <CAAt2poK+-A+WvkVrBobuPS-Gdr6KbdzZvRVM6twq_LgWUdxNqw@mail.gmail.com>
References: <4EF820DB2B020C42A6AE6807469B524D0148A4B2@US-PLNO-EXM01-P.global.tektronix.net>
	<CALPqkiqHVB8A7doUoiJpUtU1W5_WdGFH+oC9qN_GGs3ZoByPQg@mail.gmail.com>
	<CALPqkioe-VGvg1U3-3+J9LSeE2Q17RdaHgza8YhufJ1hHf9OhA@mail.gmail.com>
	<4EF820DB2B020C42A6AE6807469B524D0149E651@US-PLNO-EXM01-P.global.tektronix.net>
	<CAAt2poK+-A+WvkVrBobuPS-Gdr6KbdzZvRVM6twq_LgWUdxNqw@mail.gmail.com>
Message-ID: <CAAt2po+-kfaSOdmafd1S+furjWszWdV7AVES_HSHyh76HTLMew@mail.gmail.com>

Should be fixed in the master branch now.

Interestingly enough rabbitmq-c was defining its own htonll and ntohll
unless the __sun preprocessor macro was defined, I guess its somewhat rare
that this is available on most platforms.

-Alan

On Thu, Oct 18, 2012 at 1:28 PM, Alan Antonuk <alan.antonuk at gmail.com>wrote:

> Good to see you found a workaround for these issues.
>
> I hope to provide fixes for these issues in the future.
>
> I've added these to the bug tracker as two separate issues:
> https://github.com/alanxz/rabbitmq-c/issues/66 (the htonll/ntohll issue)
>
> https://github.com/alanxz/rabbitmq-c/issues/67 (the issue of linking
> against the socket and networking libraries)
>
> -Alan
>
> On Thu, Oct 18, 2012 at 12:28 PM, Brandish, Tom <tom.brandish at tekcomms.com
> > wrote:
>
>>  Brett,****
>>
>> ** **
>>
>> Thanks for your responses.  I created a new header file with your
>> definitions, included it and was able to compile.****
>>
>> ** **
>>
>> Appreciate your help.****
>>
>> ** **
>>
>> Best Regards,****
>>
>> Tom Brandish****
>>
>> ** **
>>
>> *From:* rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
>> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Brett Cameron
>> *Sent:* Wednesday, October 17, 2012 10:15 PM
>> *To:* Discussions about RabbitMQ
>> *Subject:* Re: [rabbitmq-discuss] Problems compiling RabbitMQ-C Kit on
>> Sparc 32-bit...****
>>
>> ** **
>>
>> Tom,
>>
>> Just thinking about it, network byte order and Solaris SPARC are both big
>> endian, so you can probably just do something like the following (or some
>> variant thereof):
>>
>> #if defined(__sparc)
>> #define ntohll(x) (x)
>> #define htonll(x) (x)
>> #endif
>>
>> Regards,
>> Brett****
>>
>> On Thu, Oct 18, 2012 at 11:00 AM, Brett Cameron <
>> brett.r.cameron at gmail.com> wrote:****
>>
>> Tom,
>>
>> I think you've got a couple of problems here. I don't have access to a
>> 32-bit Solaris system right now to check, but first up I suspect that you
>> might need to add something like "-lsocket -lxnet -lnsl" to the link
>> statement. This should resolve most of the missing symbols, but my guess is
>> that htonll() will be missing on your (I'm guessing reasonably old) system.
>> There should be ways and means around this... I might just be able to get
>> access to a suitable machine and have a look into it.
>>
>> Brett
>>
>>
>> ****
>>
>> On Thu, Oct 18, 2012 at 10:32 AM, Brandish, Tom <
>> tom.brandish at tekcomms.com> wrote:****
>>
>>   Hi,****
>>
>>  ****
>>
>> I have been able to successfully compile RabbitMQ-C on 64-bit Linux, but
>> I am having difficulty doing so on Sparc 32-bit.  It looks I am missing
>> some headers but with some 64-bit routines but why would I need the 64-bit
>> stuff while compiling on a 32-bit system?****
>>
>>  ****
>>
>> Here is my log:****
>>
>>  ****
>>
>> aclocal: writing aclocal.m4****
>>
>> autoreconf: Entering directory `.'****
>>
>> autoreconf: configure.ac: not using Gettext****
>>
>> autoreconf: running: aclocal -I m4****
>>
>> autoreconf: configure.ac: tracing****
>>
>> autoreconf: running: libtoolize --copy****
>>
>> libtoolize: putting auxiliary files in `.'.****
>>
>> libtoolize: copying file `./ltmain.sh'****
>>
>> libtoolize: putting macros in AC_CONFIG_MACRO_DIR, `m4'.****
>>
>> libtoolize: copying file `m4/libtool.m4'****
>>
>> libtoolize: copying file `m4/ltoptions.m4'****
>>
>> libtoolize: copying file `m4/ltsugar.m4'****
>>
>> libtoolize: copying file `m4/ltversion.m4'****
>>
>> libtoolize: copying file `m4/lt~obsolete.m4'****
>>
>> autoreconf: running:
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/autoconf
>> ****
>>
>> autoreconf: running:
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/autoheader
>> ****
>>
>> autoreconf: running: automake --add-missing --copy --no-force****
>>
>> configure.ac:29: installing `./config.guess'****
>>
>> configure.ac:29: installing `./config.sub'****
>>
>> configure.ac:22: installing `./install-sh'****
>>
>> configure.ac:22: installing `./missing'****
>>
>> Makefile.am: installing `./depcomp'****
>>
>> autoreconf: Leaving directory `.'****
>>
>> checking for a BSD-compatible install...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/install
>> -c****
>>
>> checking whether build environment is sane... yes****
>>
>> checking for a thread-safe mkdir -p...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/mkdir
>> -p****
>>
>> checking for gawk... gawk****
>>
>> checking whether make sets $(MAKE)... yes****
>>
>> checking for style of include used by make... GNU****
>>
>> checking for gcc... gcc****
>>
>> checking whether the C compiler works... yes****
>>
>> checking for C compiler default output file name... a.out****
>>
>> checking for suffix of executables...****
>>
>> checking whether we are cross compiling... no****
>>
>> checking for suffix of object files... o****
>>
>> checking whether we are using the GNU C compiler... yes****
>>
>> checking whether gcc accepts -g... yes****
>>
>> checking for gcc option to accept ISO C89... none needed****
>>
>> checking dependency style of gcc... gcc3****
>>
>> checking how to run the C preprocessor... gcc -E****
>>
>> checking for grep that handles long lines and -e...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
>> ****
>>
>> checking for egrep...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
>> -E****
>>
>> checking for ANSI C header files... yes****
>>
>> checking for sys/types.h... yes****
>>
>> checking for sys/stat.h... yes****
>>
>> checking for stdlib.h... yes****
>>
>> checking for string.h... yes****
>>
>> checking for memory.h... yes****
>>
>> checking for strings.h... yes****
>>
>> checking for inttypes.h... yes****
>>
>> checking for stdint.h... yes****
>>
>> checking for unistd.h... yes****
>>
>> checking minix/config.h usability... no****
>>
>> checking minix/config.h presence... no****
>>
>> checking for minix/config.h... no****
>>
>> checking whether it is safe to define __EXTENSIONS__... yes****
>>
>> checking build system type... sparc-sun-solaris2.10****
>>
>> checking host system type... sparc-sun-solaris2.10****
>>
>> checking how to print strings... printf****
>>
>> checking for a sed that does not truncate output...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/sed
>> ****
>>
>> checking for fgrep...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/grep
>> -F****
>>
>> checking for ld used by gcc... /sea/compilers/native/gcc-4.4.5/V1.3/bin/ld
>> ****
>>
>> checking if the linker (/sea/compilers/native/gcc-4.4.5/V1.3/bin/ld) is
>> GNU ld... yes****
>>
>> checking for BSD- or MS-compatible name lister (nm)...
>> /sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B****
>>
>> checking the name lister (/sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B)
>> interface... BSD nm****
>>
>> checking whether ln -s works... yes****
>>
>> checking the maximum length of command line arguments... 786240****
>>
>> checking whether the shell understands some XSI constructs... yes****
>>
>> checking whether the shell understands "+="... no****
>>
>> checking how to convert sparc-sun-solaris2.10 file names to
>> sparc-sun-solaris2.10 format... func_convert_file_noop****
>>
>> checking how to convert sparc-sun-solaris2.10 file names to toolchain
>> format... func_convert_file_noop****
>>
>> checking for /sea/compilers/native/gcc-4.4.5/V1.3/bin/ld option to reload
>> object files... -r****
>>
>> checking for objdump... objdump****
>>
>> checking how to recognize dependent libraries... pass_all****
>>
>> checking for dlltool... no****
>>
>> checking how to associate runtime and link libraries... printf %s\n****
>>
>> checking for ar... ar****
>>
>> checking for archiver @FILE support... @****
>>
>> checking for strip... strip****
>>
>> checking for ranlib... ranlib****
>>
>> checking command to parse /sea/compilers/native/gcc-4.4.5/V1.3/bin/nm -B
>> output from gcc object... ok****
>>
>> checking for sysroot... no****
>>
>> checking for mt... mt****
>>
>> checking if mt is a manifest tool... no****
>>
>> checking for dlfcn.h... yes****
>>
>> checking for objdir... .libs****
>>
>> checking if gcc supports -fno-rtti -fno-exceptions... no****
>>
>> checking for gcc option to produce PIC... -fPIC -DPIC****
>>
>> checking if gcc PIC flag -fPIC -DPIC works... yes****
>>
>> checking if gcc static flag -static works... no****
>>
>> checking if gcc supports -c -o file.o... yes****
>>
>> checking if gcc supports -c -o file.o... (cached) yes****
>>
>> checking whether the gcc linker
>> (/sea/compilers/native/gcc-4.4.5/V1.3/bin/ld) supports shared libraries...
>> yes****
>>
>> checking whether -lc should be explicitly linked in... yes****
>>
>> checking dynamic linker characteristics... solaris2.10 ld.so****
>>
>> checking how to hardcode library paths into programs... immediate****
>>
>> checking whether stripping libraries is possible... yes****
>>
>> checking if libtool supports shared libraries... yes****
>>
>> checking whether to build shared libraries... yes****
>>
>> checking whether to build static libraries... no****
>>
>> checking for gcc option to accept ISO C99... -std=gnu99****
>>
>> checking whether byte ordering is bigendian... yes****
>>
>> checking for inline... inline****
>>
>> checking if compiler accepts '-Wall'... yes****
>>
>> checking if compiler accepts '-Wextra'... yes****
>>
>> checking if compiler accepts '-pedantic'... yes****
>>
>> checking if compiler accepts '-Wstrict-prototypes'... yes****
>>
>> checking if compiler accepts '-Wcast-align'... yes****
>>
>> checking if compiler accepts '-fno-common'... yes****
>>
>> checking if compiler accepts '-fvisibility=hidden'... yes****
>>
>> checking if linker accepts '-no-undefined'... yes****
>>
>> checking for a Python interpreter with version >= 2.5... python****
>>
>> checking for python...
>> /uadev/scm/tbrandis/V4.0.0.4-tb/sea-partitions/local/install/sparc-sunos-solaris-9/versions/V4.0.0.TRUNK/bin/python
>> ****
>>
>> checking for python version... 2.7****
>>
>> checking for python platform... sunos5****
>>
>> checking for python script directory...
>> ${prefix}/lib/python2.7/site-packages****
>>
>> checking for python extension module directory...
>> ${exec_prefix}/lib/python2.7/site-packages****
>>
>> checking python module: json... yes****
>>
>> checking for popt.h... no****
>>
>> checking for poptGetContext in -lpopt... no****
>>
>> configure: creating ./config.status****
>>
>> config.status: creating librabbitmq.pc****
>>
>> config.status: creating Makefile****
>>
>> config.status: creating config.h****
>>
>> config.status: executing depfiles commands****
>>
>> config.status: executing libtool commands****
>>
>> configure: WARNING: unrecognized options: --enable-32-bit****
>>
>>  ****
>>
>> rabbitmq-c build options:****
>>
>>         Host: sparc-sun-solaris2.10****
>>
>>         Version: 0.2.0****
>>
>>         64-bit: no****
>>
>>         Tools: no****
>>
>>         Documentation: no****
>>
>>  ****
>>
>>   GEN    librabbitmq/amqp_framing.h****
>>
>>   GEN    librabbitmq/amqp_framing.c****
>>
>> make  all-am****
>>
>> make[1]: Entering directory `/home/spiuser/gitwa/rabbitmq-c'****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_api.lo****
>>
>> In file included from librabbitmq/amqp_api.c:37:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_connection.lo****
>>
>> In file included from librabbitmq/amqp_connection.c:37:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>> librabbitmq/amqp_connection.c: In function 'amqp_send_frame':****
>>
>> librabbitmq/amqp_connection.c:365: warning: pointer targets in assignment
>> differ in signedness****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_framing.lo****
>>
>> In file included from librabbitmq/amqp_framing.c:38:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_mem.lo****
>>
>> In file included from librabbitmq/amqp_mem.c:37:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_socket.lo****
>>
>> In file included from librabbitmq/amqp_socket.c:37:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_table.lo****
>>
>> In file included from librabbitmq/amqp_table.c:37:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>>   CC     librabbitmq/librabbitmq_librabbitmq_la-amqp_url.lo****
>>
>> In file included from librabbitmq/amqp_url.c:37:****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'htonll'****
>>
>> librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> librabbitmq/amqp_private.h:251: warning: implicit declaration of function
>> 'ntohll'****
>>
>>   CC     librabbitmq/unix/librabbitmq_librabbitmq_la-socket.lo****
>>
>> In file included from librabbitmq/unix/socket.c:37:****
>>
>> ./librabbitmq/amqp_private.h: In function 'amqp_e64':****
>>
>> ./librabbitmq/amqp_private.h:251: warning: implicit declaration of
>> function 'htonll'****
>>
>> ./librabbitmq/amqp_private.h: In function 'amqp_d64':****
>>
>> ./librabbitmq/amqp_private.h:251: warning: implicit declaration of
>> function 'ntohll'****
>>
>>   CCLD   librabbitmq/librabbitmq.la****
>>
>>   CC     examples/examples_libutils_la-utils.lo****
>>
>>   CC     examples/unix/examples_libutils_la-platform_utils.lo****
>>
>>   CCLD   examples/libutils.la****
>>
>>   CC     examples/amqp_bind.o****
>>
>>   CCLD   examples/amqp_bind****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `connect'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `ntohll'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `send'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `freeaddrinfo'**
>> **
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `htonll'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `recv'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `setsockopt'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `socket'****
>>
>> librabbitmq/.libs/librabbitmq.so: undefined reference to `getaddrinfo'***
>> *
>>
>> collect2: ld returned 1 exit status****
>>
>>  ****
>>
>> ** **
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss****
>>
>>  ** **
>>
>> ** **
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121020/b3674b53/attachment.htm>

From watson.timothy at gmail.com  Sat Oct 20 10:52:02 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Sat, 20 Oct 2012 10:52:02 +0100
Subject: [rabbitmq-discuss] nodename variable and mnesia directory
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD79038A85DD854@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD79038A85DD645@vmexchange02.seegrid.local>
	<5081830F.70706@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038A85DD854@vmexchange02.seegrid.local>
Message-ID: <FBF9C5AB-BB8E-43CE-BC14-A8BD7A462BC8@rabbitmq.com>

Hi Liz,

Sorry i wasn't aware of the context. What Ian recommended should not be necessary, though I'll follow up with him on Monday to try and figure out why he needed to do that.

Once you change the hostname you,ll possibly need to restart epmd and restart your rabbit, but you shouldn't need to change the node name from say rabbit to hare.

Cheers
Tim



On 19 Oct 2012, at 19:44, Elizabeth Liao <eliao at seegrid.com> wrote:

> Hi Tim,
> 
> I'm going to back up a bit because it seems that I've misunderstood something previously.
> 
>> The first thing I'm going to say is that this isn't really a desirable
> state of affairs. Why do you need to change NODENAME at all, just
> because the host name has changed? This seems like an odd step to me -
> can you explain the rationale behind it?
> 
> I had an earlier problem changing the hostname and restarting the rabbitmq-server. The proposed fix was to add the NODENAME variable which I'm guessing was not right? :
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021435.html
> 
>> Can you explain a bit more about this 'bug' please? What exactly is
> going wrong?
> 
> The bug is on our end where the NODENAME is set to an empty string. Of course this is moot if NODENAME doesn't even have to be set in the first place.
> 
> Liz
> ________________________________________
> From: Tim Watson [tim at rabbitmq.com]
> Sent: Friday, October 19, 2012 12:48 PM
> To: Discussions about RabbitMQ
> Cc: Elizabeth Liao
> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
> 
> Hi
> 
> On 10/19/2012 03:41 PM, Elizabeth Liao wrote:
>> Hi,
>> 
>> We are currently running rabbitmq on a system where there is a need to change the hostname occasionally.  Right now, when the hostname is changed, we also update the NODENAME variable in the rabbitmq-env.conf file.
> 
> The first thing I'm going to say is that this isn't really a desirable
> state of affairs. Why do you need to change NODENAME at all, just
> because the host name has changed? This seems like an odd step to me -
> can you explain the rationale behind it?
> 
>> The problem we're having right now is that due to a bug when setting up the rabbitmq-env.conf file, sometimes the NODENAME variable exists but is not set to anything ( NODENAME=) so rabbit never successfully starts up.  Even after setting the NODENAME variable to the hostname, rabbit still doesn't start up properly.
> 
> Can you explain a bit more about this 'bug' please? What exactly is
> going wrong?
> 
>> The only way that I could find to recover from this situation without killing the erlang process, was to also set a MNESIA_DIR variable. After I did that, once the NODENAME was set to the correct hostname, rabbit started up properly.
> 
> Now this makes no sense at all to me. If you are trying to recover
> 'without killing the erlang process' then how are you planning on
> changing the NODENAME? Once an erlang node has become part of a
> distributed system, you cannot arbitrarily change the node's name
> without restarting the net_kernel AFAIK so I can't see how this is even
> possible. Also, because you're stating that 'rabbit started up properly'
> I'm assuming that you have in fact taken the node offline (using
> `rabbitmqctl stop` or one of the various service scripts that invokes
> it) and that you are now starting the node again. The rabbit startup
> scripts (and associated infrastructure) is not set up to handle changing
> the name of a node post-installation in this manner, so I would not
> expect this to work smoothly.
> 
>> A couple of questions:
>> Is this the proper way to fix the situation?
> 
> No. As I said a moment ago, rabbit is not set up for this kind of
> scenario so I'd be very cautious about doing this and would really
> recommend against it.
> 
>> Will this have unintended consequences?
> 
> I have no idea, but it is entirely possible that various things could
> break in obscure and alarming ways. I really would not do this if I were
> you.
> 
>> We are running rabbitmq-server-2.8.6 and erlang-R15B.
>> 
>> Thanks!
> 
> Liz. I would like to help you find a safe work-around so that you can
> use rabbit in your environment. I would really like to understand why
> the changing of a machine's host-name is causing problems for you. I
> fully realise that after changing the hostname, it is possible that a
> restart may be required (although I'd have to do some research to verify
> whether or not this is a hard requirement). But I cannot understand why
> a change to the machine's host name requires changing the rabbit
> NODENAME at all, unless you've altered the rabbit start scripts to use
> 'longnames' configuration (i.e., including the complete host name in the
> node name) in which case, a simple solution to your problem might be to
> switch back to using 'shortnames'. If erlang is started using -sname
> rabbit@`hostname -s` and your /etc/hosts configuration supports
> resolving the machine's IP to the short version of the name, then
> changing the hostname shouldn't cause all of these headaches.
> 
> For example, if I launch rabbit with something like this:
> 
> env RABBITMQ_NODENAME=rabbit RABBITMQ_NODE_PORT=5672
> RABBITMQ_LOG_BASE="/tmp"
> RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia"
> RABBITMQ_PID_FILE="/tmp/rabbitmq-rabbit.pid"
> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch"
> RABBITMQ_ENABLED_PLUGINS_FILE="/tmp/enabled-plugins"
> RABBITMQ_CONFIG_FILE="/tmp/etc/rabbit" ./scripts/rabbitmq-server
> 
> Then change the hostname, then stop rabbit and start it again,
> everything is fine.
> 
> Cheers,
> Tim
> 
>> Liz
>> Email Confidentiality Notice
>> 
>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> Email Confidentiality Notice
> 
> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From watson.timothy at gmail.com  Sat Oct 20 12:05:20 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Sat, 20 Oct 2012 12:05:20 +0100
Subject: [rabbitmq-discuss] RabbitMQ + Messages between virtual machines
	and physical hosts on a cloud
In-Reply-To: <CAKiRAqUDH2Go=H-VwLj0dtdKRq7jD5wpNxspoi_LGuh9kSz5OA@mail.gmail.com>
References: <CAKiRAqUDH2Go=H-VwLj0dtdKRq7jD5wpNxspoi_LGuh9kSz5OA@mail.gmail.com>
Message-ID: <1D5A60A3-867B-48F6-94C8-9CAD1434B8C1@rabbitmq.com>

What isn't working for you right now? You haven't really given us enough information to be of much help I'm afraid.

On 19 Oct 2012, at 21:09, Desta Haileselassie Hagos <deshai-0 at student.ltu.se> wrote:

> Dear Sir/Madam,
> 
> I am trying to exchange messages between Virtula machines running  on a cloud and the physical hosts which runs OpenStack cloud services where they are launched on so as to get some sort of information using the RabbitMQ server. But it doesn't seem to be working out for me. I just want to send and receive messages or some sort of RPC implementation in which where we can receive full information of the Virtual Machine instances.
> 
> I would, therefore, appreciate if you could be of help in this regard. 
> 
> 
> With best regards,
> 
> Desta
> 
> 
> 
> -- 
> Desta Haileselassie Hagos
> Cell Phone: +46764092132
> 
> Lule? University of Technology
> Department of Computer Science Electrical and Space Engineering
> MSc in Mobile Systems
> 
> Professorsv?gen21
> 977 51
> Lule?, Sweden
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121020/76e79ce3/attachment.htm>

From watson.timothy at gmail.com  Sat Oct 20 12:08:38 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Sat, 20 Oct 2012 12:08:38 +0100
Subject: [rabbitmq-discuss] Nightlies now available - help us test
	RabbitMQ 3.0
In-Reply-To: <CAHZsVQZfDtodBB6LaDpFz-88ngU0moG+3wUmYMOYBkEaYSUgsw@mail.gmail.com>
References: <508133D5.8030108@rabbitmq.com>
	<D970114465F544488BCD0F6F9FF70B29@meetme.com>
	<CAHZsVQZfDtodBB6LaDpFz-88ngU0moG+3wUmYMOYBkEaYSUgsw@mail.gmail.com>
Message-ID: <D0775FA6-3C44-464C-AA47-1B5343F48423@rabbitmq.com>

I dont want to set any expectations here, as Simon hasn't stated explicitly that we will do this, but...

If/when we get the infrastructure in place to distribute binaries for multiple platforms, this might be doable. But at the moment there's no support for native libraries so you might have to wait a wee while for this.

On 20 Oct 2012, at 03:38, Brendan Hay <brendan at soundcloud.com> wrote:

> To follow on with the possible mochweb replacement, how about choosing a native/faster JSON serialization lib? =)
> 
> On Sat, Oct 20, 2012 at 12:45 PM, Gavin M. Roy <gmr at meetme.com> wrote:
> This is great! Thanks!
> 
> Since you're talking about new features, how about a request? Since you're making federation config dynamic, how about configuration changes for shovel without having to restart the broker too?
> 
> And a bigger request? A counter for the number of messages that have passed through a queue? :)
> 
> Will cowboy make it's way in as a replacement for mochiweb? Have you guys seen any improvement in performance with it?
> 
> Cheers,
> 
> Gavin 
> 
> 
> On Friday, October 19, 2012 at 7:04 AM, Simon MacMullen wrote:
>> Hi everyone! We've just put in place a nightly build system for the 
>> RabbitMQ server and clients. You can download nightlies from
>> http://www.rabbitmq.com/nightly-builds.html
>> 
>> We've also put documentation for what will be the next version of
>> RabbitMQ at http://next.rabbitmq.com/documentation.html.
>> 
>> We're evolving towards a model where we have feature releases every few
>> months, with bugfix releases in between. It's possible there will be a
>> 2.8.8 bugfix release, but that's not what the current nightlies are -
>> they represent what will be RabbitMQ 3.0.
>> 
>> So with some caveats in place:
>> 
>> * Obviously we do not suggest running nightlies on production systems.
>> 
>> * We don't always guarantee upgrades from one nightly to another will
>> work - you may have to reset everything and start again sometimes.
>> 
>> * You would also have to reset everything and start again to revert to
>> a stable release from a nightly.
>> 
>> ...I'd invite you to have a look at what's coming, and tell use what you
>> think.
>> 
>> I'm going to write more on the subject as we get closer to the release,
>> but some of the major new features include:
>> 
>> * HA queues are configured dynamically by a new policy mechanism,
>> rather than by declaring them with "x-ha-policy". HA-ness
>> can be changed at any time. HA queues are also much faster.
>> 
>> * Federated exchanges are now normal exchanges, with federation
>> similarly configured dynamically by policy. The "x-federation"
>> exchange type is no more.
>> 
>> * Clustering commands in rabbitmqctl have been rewritten to make
>> clustering easier and more robust.
>> 
>> * Web-STOMP and MQTT plugins are included.
>> 
>> * Lots of other smaller new features and bug fixes.
>> 
>> The network protocol hasn't changed; you can run 2.x clients against 3.x
>> server and vice versa.
>> 
>> So please try it out, and talk to us!
>> 
>> Cheers, Simon
>> 
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121020/5fe87737/attachment.htm>

From matthias at rabbitmq.com  Sat Oct 20 12:27:48 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 20 Oct 2012 12:27:48 +0100
Subject: [rabbitmq-discuss] Nightlies now available - help us test
 RabbitMQ 3.0
In-Reply-To: <D0775FA6-3C44-464C-AA47-1B5343F48423@rabbitmq.com>
References: <508133D5.8030108@rabbitmq.com>
	<D970114465F544488BCD0F6F9FF70B29@meetme.com>
	<CAHZsVQZfDtodBB6LaDpFz-88ngU0moG+3wUmYMOYBkEaYSUgsw@mail.gmail.com>
	<D0775FA6-3C44-464C-AA47-1B5343F48423@rabbitmq.com>
Message-ID: <50828AB4.1090304@rabbitmq.com>

On 20/10/12 12:08, Tim Watson wrote:
> I dont want to set any expectations here, as Simon hasn't stated
> explicitly that we will do this, but...
>
> If/when we get the infrastructure in place to distribute binaries for
> multiple platforms, this might be doable. But at the moment there's no
> support for native libraries so you might have to wait a wee while for this.

Why are we concerned about the performance of http / json? Neither 
appear in the AMQP message path. So what are we trying to improve here? 
The management API/UI? Web-STOMP? I am not aware of many complaints 
about the performance of these, and certainly not any that would point 
to the json codec or http handling as the bottleneck.

Matthias.

From sventurnau at yahoo.com  Sat Oct 20 11:51:34 2012
From: sventurnau at yahoo.com (Sven Turnau)
Date: Sat, 20 Oct 2012 03:51:34 -0700 (PDT)
Subject: [rabbitmq-discuss] (no subject)
Message-ID: <1350730294.34176.YahooMailNeo@web162906.mail.bf1.yahoo.com>


I am at linux ubuntu 12.??
I have installed the next packages.
I get an errormsg:
ImportError: No module named pica
program:
root at LIIZ:/home/olaf/Dropbox/Dropbox/Oct/RabbitMQ# cat ./send.py
#!/usr/bin/env python
#
import pica

root at LIIZ:/home/olaf/Dropbox/Dropbox/Oct/RabbitMQ# 

pika & pipp I installed so:

sudo pip install pika==0.9.5
sudo apt-get install python-pip git-core

I am very thenksful to you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121020/1e6ff481/attachment.htm>

From simon at rabbitmq.com  Sun Oct 21 09:00:04 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sun, 21 Oct 2012 09:00:04 +0100
Subject: [rabbitmq-discuss] Nightlies now available - help us test
 RabbitMQ 3.0
In-Reply-To: <D970114465F544488BCD0F6F9FF70B29@meetme.com>
References: <508133D5.8030108@rabbitmq.com>
	<D970114465F544488BCD0F6F9FF70B29@meetme.com>
Message-ID: <5083AB84.2080801@rabbitmq.com>

On 20/10/2012 2:45AM, Gavin M. Roy wrote:
> Since you're talking about new features, how about a request? Since
> you're making federation config dynamic, how about configuration changes
> for shovel without having to restart the broker too?

That's the obvious next step, yes :)

> And a bigger request? A counter for the number of messages that have
> passed through a queue? :)

I'm not sure that's a bigger request, but again, yes, it's in the backlog.

> Will cowboy make it's way in as a replacement for mochiweb? Have you
> guys seen any improvement in performance with it?

Maybe. cowboy's already in 3.0 for web-stomp, and the idea that RabbitMQ 
contains two web servers is a bit silly. But this might be more of an 
"if it ain't broke" type of thing. And we haven't really tested 
performance - it's not obvious how web-stomp and management performance 
could be compared ;-)

But I don't think any of this stuff will happen for 3.0 specifically, we 
just want to get that out...

Cheers, Simon

From simon at rabbitmq.com  Sun Oct 21 09:06:47 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sun, 21 Oct 2012 09:06:47 +0100
Subject: [rabbitmq-discuss] Nightlies now available - help us test
 RabbitMQ 3.0
In-Reply-To: <50828AB4.1090304@rabbitmq.com>
References: <508133D5.8030108@rabbitmq.com>
	<D970114465F544488BCD0F6F9FF70B29@meetme.com>
	<CAHZsVQZfDtodBB6LaDpFz-88ngU0moG+3wUmYMOYBkEaYSUgsw@mail.gmail.com>
	<D0775FA6-3C44-464C-AA47-1B5343F48423@rabbitmq.com>
	<50828AB4.1090304@rabbitmq.com>
Message-ID: <5083AD17.7080906@rabbitmq.com>

On 20/10/2012 12:27PM, Matthias Radestock wrote:
> Why are we concerned about the performance of http / json? Neither
> appear in the AMQP message path. So what are we trying to improve here?
> The management API/UI? Web-STOMP? I am not aware of many complaints
> about the performance of these, and certainly not any that would point
> to the json codec or http handling as the bottleneck.

When I did performance testing of mgmt a year or so ago, I found that 
JSON encoding really *is* the bottleneck in many cases - this is the 
reason why the ?columns= parameter exists, and also why it's implemented 
in terms of throwing away information just before we encode it.

But no, unless someone has a good reason for why HTTP API performance is 
a big deal for them, faster JSON is pretty low down the list of priorities.

Cheers, Simon

From brendan at soundcloud.com  Sun Oct 21 09:30:32 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Sun, 21 Oct 2012 19:30:32 +1100
Subject: [rabbitmq-discuss] Nightlies now available - help us test
 RabbitMQ 3.0
In-Reply-To: <5083AD17.7080906@rabbitmq.com>
References: <508133D5.8030108@rabbitmq.com>
	<D970114465F544488BCD0F6F9FF70B29@meetme.com>
	<CAHZsVQZfDtodBB6LaDpFz-88ngU0moG+3wUmYMOYBkEaYSUgsw@mail.gmail.com>
	<D0775FA6-3C44-464C-AA47-1B5343F48423@rabbitmq.com>
	<50828AB4.1090304@rabbitmq.com> <5083AD17.7080906@rabbitmq.com>
Message-ID: <CAHZsVQZebP+894wBHPudcK7YDDd3fuBXOMQE8kSu5oJ3aoivGA@mail.gmail.com>

On Sun, Oct 21, 2012 at 7:06 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 20/10/2012 12:27PM, Matthias Radestock wrote:
>
>> Why are we concerned about the performance of http / json? Neither
>> appear in the AMQP message path. So what are we trying to improve here?
>> The management API/UI? Web-STOMP? I am not aware of many complaints
>> about the performance of these, and certainly not any that would point
>> to the json codec or http handling as the bottleneck.
>>
>
> When I did performance testing of mgmt a year or so ago, I found that JSON
> encoding really *is* the bottleneck in many cases - this is the reason why
> the ?columns= parameter exists, and also why it's implemented in terms of
> throwing away information just before we encode it.
>
> But no, unless someone has a good reason for why HTTP API performance is a
> big deal for them, faster JSON is pretty low down the list of priorities.
>

In my case, it's simply to lower the overhead of making repeated calls to
the HTTP API for monitoring and statistics services.

A current example where we see poor performance is when attempting to get
connection metrics from a single node, with in excess of 10K connections.
The Web UI or some other HTTP GET to the /connections endpoint takes
multiple seconds on an averagely utilised machine, even when using ?columns=

Obviously I'd like to a) have granular and informative monitoring and
statistics, but b) avoid monitoring software causing undue load

It would classify it as a nice to have, and I brought it up since the
current bundling of cowboy + mochiweb was mentioned.


> Cheers, Simon
>
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121021/9a13daf1/attachment.htm>

From michael.justin at gmx.net  Sun Oct 21 09:32:08 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Sun, 21 Oct 2012 10:32:08 +0200
Subject: [rabbitmq-discuss] STOMP plugin - durable subscription
	limitation
In-Reply-To: <50815415.8090308@rabbitmq.com>
References: <k5p9o9$kqi$1@ger.gmane.org> <50815415.8090308@rabbitmq.com>
Message-ID: <k60bua$dam$1@ger.gmane.org>

Am 19.10.2012 15:22, Emile Joubert wrote:

> If I'm misunderstanding your question then please send another
> illustration that shows what information is missing. Is the problem with
> the STOMP spec or with the RabbitMQ implementation of it?
>

Many thanks for your answer!

My problem seems to be understanding the configuration of durable 
subscriptions.

Imagine two clients which both want a durable subscription of topic 
"ExampleTopic".

Client 1 subscribes, using the id "my-subscription-id-1"

SUBSCRIBE
destination:/topic/ExampleTopic
id:my-subscription-id-1
persistent:true


Client 2 now could subscribe using the same id:

SUBSCRIBE
destination:/topic/ExampleTopic
id:my-subscription-id-1
persistent:true

The documentation says: "For SUBSCRIBE frames, a shared queue is created 
for each distinct subscription ID x destination pair"

So I understand with the frames shown, the clients would use the same 
shared queue.

Does this mean that all waiting messages in the topic will be 
distributed between the two clients because of the identical 
subscription ID x destination?

Regards
-- 
Michael Justin


From dharshanr at scalegrid.net  Sun Oct 21 21:23:36 2012
From: dharshanr at scalegrid.net (dharshanr)
Date: Sun, 21 Oct 2012 13:23:36 -0700 (PDT)
Subject: [rabbitmq-discuss] {SSL upgrade error, timeout}
Message-ID: <356b01aa-4df9-44cb-9e3a-54492ce13f2b@googlegroups.com>

Hi folks,

I've had a rabbitmq server up for a month now in a development environment. 
I am using SSL and it has been working great. Over the past two days I am 
getting errors when I try to create a queue. Here is what I see in the 
server logs

Server log - =INFO REPORT==== 21-Oct-2012::09:12:44 ===
accepting AMQP connection <0.7614.0> (68.xxx.xx.xx:56366 -> 10.1.1.28:5671) 
*[I have obscured the IP address]*

=ERROR REPORT==== 21-Oct-2012::09:12:49 ===
error on AMQP connection <0.7614.0>: {ssl_upgrade_error,timeout}

In my java client I get the following error - Remote host closed connection 
during handshake.

Here is the cert config I am using on the server 
[
   {rabbit, [
     {ssl_listeners, [5671]},
     {tcp_listeners, [{"127.0.0.1",5672}]},
     {ssl_options, [{cacertfile,"/usr/lib/scalegrid/certs/ca/cacert.pem"},
                    {certfile,"/usr/lib/scalegrid/certs/server/cert.pem"},
                    {keyfile,"/usr/lib/scalegrid/certs/server/key.pem"},
                    {fail_if_no_peer_cert,false}]}
   ]}
].

The certs are self signed certs and not trusted. Any thoughts on how I can 
debug this error?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121021/400db115/attachment.htm>

From andre.torgal at gmail.com  Mon Oct 22 01:09:51 2012
From: andre.torgal at gmail.com (Andre Torgal)
Date: Mon, 22 Oct 2012 01:09:51 +0100
Subject: [rabbitmq-discuss] PHP Client Library
Message-ID: <CALrxoRvRYaBs=cdbFD6403-xjQckwLZnWpBqRre4_xSsp_wQbA@mail.gmail.com>

Hi!

Not sure if this is the proper forum, but here it goes.

I got a rough time getting started using RabbitMQ from PHP because I
was led by the Get Started page to use this lib:
https://github.com/videlalvaro/php-amqplib

I tried endlessly to get nack() to work and just couldn't, it kept throwing

The moment I switched to
http://www.php.net/manual/en/class.amqpqueue.php it just worked like a
charm using, basically, the same publisher/consumer code.

I suppose the reason this lib is listed in
http://www.rabbitmq.com/getstarted.html is the fact that there is a
tutorial with lots of examples.

I wonder how many PHP devs are being affected by this.

Would you update this page if there was another github project with
same examples ported to the native library.

If so, I think I can do it fairly quick, just let me know.

Thanks

Andre

From videlalvaro at gmail.com  Mon Oct 22 04:50:49 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 22 Oct 2012 07:50:49 +0400
Subject: [rabbitmq-discuss] PHP Client Library
In-Reply-To: <CALrxoRvRYaBs=cdbFD6403-xjQckwLZnWpBqRre4_xSsp_wQbA@mail.gmail.com>
References: <CALrxoRvRYaBs=cdbFD6403-xjQckwLZnWpBqRre4_xSsp_wQbA@mail.gmail.com>
Message-ID: <CAMcAHLW2DJx2mLEHfesrhK3ZvQZGLAqBfjuthkKOKSeGYdMr9w@mail.gmail.com>

Hi Andre,

videlalvaro here.

nack would never work for you in that library because it's not implemented
;)

Would you mind opening an issue here:
https://github.com/videlalvaro/php-amqplib/issues?state=open and if
possible add some basic code example with what doesn't work for you?

Regards,

Alvaro

On Mon, Oct 22, 2012 at 4:09 AM, Andre Torgal <andre.torgal at gmail.com>wrote:

> Hi!
>
> Not sure if this is the proper forum, but here it goes.
>
> I got a rough time getting started using RabbitMQ from PHP because I
> was led by the Get Started page to use this lib:
> https://github.com/videlalvaro/php-amqplib
>
> I tried endlessly to get nack() to work and just couldn't, it kept throwing
>
> The moment I switched to
> http://www.php.net/manual/en/class.amqpqueue.php it just worked like a
> charm using, basically, the same publisher/consumer code.
>
> I suppose the reason this lib is listed in
> http://www.rabbitmq.com/getstarted.html is the fact that there is a
> tutorial with lots of examples.
>
> I wonder how many PHP devs are being affected by this.
>
> Would you update this page if there was another github project with
> same examples ported to the native library.
>
> If so, I think I can do it fairly quick, just let me know.
>
> Thanks
>
> Andre
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/d2fe3d9a/attachment.htm>

From videlalvaro at gmail.com  Mon Oct 22 05:51:59 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 22 Oct 2012 08:51:59 +0400
Subject: [rabbitmq-discuss] PHP Client Library
In-Reply-To: <CAMcAHLW2DJx2mLEHfesrhK3ZvQZGLAqBfjuthkKOKSeGYdMr9w@mail.gmail.com>
References: <CALrxoRvRYaBs=cdbFD6403-xjQckwLZnWpBqRre4_xSsp_wQbA@mail.gmail.com>
	<CAMcAHLW2DJx2mLEHfesrhK3ZvQZGLAqBfjuthkKOKSeGYdMr9w@mail.gmail.com>
Message-ID: <CAMcAHLV0PH9UUJbUi9a+aUVCyuHyi03aKxxbb16hXN7zeN+JwQ@mail.gmail.com>

Hi,

I've just implemented that method on videlalvaro/php-amqplib

Regards,

Alvaro

On Mon, Oct 22, 2012 at 7:50 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi Andre,
>
> videlalvaro here.
>
> nack would never work for you in that library because it's not implemented
> ;)
>
> Would you mind opening an issue here:
> https://github.com/videlalvaro/php-amqplib/issues?state=open and if
> possible add some basic code example with what doesn't work for you?
>
> Regards,
>
> Alvaro
>
>
> On Mon, Oct 22, 2012 at 4:09 AM, Andre Torgal <andre.torgal at gmail.com>wrote:
>
>> Hi!
>>
>> Not sure if this is the proper forum, but here it goes.
>>
>> I got a rough time getting started using RabbitMQ from PHP because I
>> was led by the Get Started page to use this lib:
>> https://github.com/videlalvaro/php-amqplib
>>
>> I tried endlessly to get nack() to work and just couldn't, it kept
>> throwing
>>
>> The moment I switched to
>> http://www.php.net/manual/en/class.amqpqueue.php it just worked like a
>> charm using, basically, the same publisher/consumer code.
>>
>> I suppose the reason this lib is listed in
>> http://www.rabbitmq.com/getstarted.html is the fact that there is a
>> tutorial with lots of examples.
>>
>> I wonder how many PHP devs are being affected by this.
>>
>> Would you update this page if there was another github project with
>> same examples ported to the native library.
>>
>> If so, I think I can do it fairly quick, just let me know.
>>
>> Thanks
>>
>> Andre
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/774e60a0/attachment.htm>

From andre.torgal at gmail.com  Mon Oct 22 08:23:52 2012
From: andre.torgal at gmail.com (Andre Torgal)
Date: Mon, 22 Oct 2012 08:23:52 +0100
Subject: [rabbitmq-discuss] PHP Client Library
In-Reply-To: <CAMcAHLV0PH9UUJbUi9a+aUVCyuHyi03aKxxbb16hXN7zeN+JwQ@mail.gmail.com>
References: <CALrxoRvRYaBs=cdbFD6403-xjQckwLZnWpBqRre4_xSsp_wQbA@mail.gmail.com>
	<CAMcAHLW2DJx2mLEHfesrhK3ZvQZGLAqBfjuthkKOKSeGYdMr9w@mail.gmail.com>
	<CAMcAHLV0PH9UUJbUi9a+aUVCyuHyi03aKxxbb16hXN7zeN+JwQ@mail.gmail.com>
Message-ID: <CALrxoRvGjNhNdDxCq93h2SV5UGgTDp69RgGa6u15QH-3B481AQ@mail.gmail.com>

Hi

Sorry, you're right, the problem was with basic_reject, not nack. I'm
glad to open the request but bare in mind I'm now using the PECL
Library.

Please note, my original question is will RabbitMQ list the PECL
library in the Get Started page if a repo with examples exists for it.

Cheers

On Mon, Oct 22, 2012 at 5:51 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi,
>
> I've just implemented that method on videlalvaro/php-amqplib
>
> Regards,
>
> Alvaro
>
>
> On Mon, Oct 22, 2012 at 7:50 AM, Alvaro Videla <videlalvaro at gmail.com>
> wrote:
>>
>> Hi Andre,
>>
>> videlalvaro here.
>>
>> nack would never work for you in that library because it's not implemented
>> ;)
>>
>> Would you mind opening an issue here:
>> https://github.com/videlalvaro/php-amqplib/issues?state=open and if possible
>> add some basic code example with what doesn't work for you?
>>
>> Regards,
>>
>> Alvaro
>>
>>
>> On Mon, Oct 22, 2012 at 4:09 AM, Andre Torgal <andre.torgal at gmail.com>
>> wrote:
>>>
>>> Hi!
>>>
>>> Not sure if this is the proper forum, but here it goes.
>>>
>>> I got a rough time getting started using RabbitMQ from PHP because I
>>> was led by the Get Started page to use this lib:
>>> https://github.com/videlalvaro/php-amqplib
>>>
>>> I tried endlessly to get nack() to work and just couldn't, it kept
>>> throwing
>>>
>>> The moment I switched to
>>> http://www.php.net/manual/en/class.amqpqueue.php it just worked like a
>>> charm using, basically, the same publisher/consumer code.
>>>
>>> I suppose the reason this lib is listed in
>>> http://www.rabbitmq.com/getstarted.html is the fact that there is a
>>> tutorial with lots of examples.
>>>
>>> I wonder how many PHP devs are being affected by this.
>>>
>>> Would you update this page if there was another github project with
>>> same examples ported to the native library.
>>>
>>> If so, I think I can do it fairly quick, just let me know.
>>>
>>> Thanks
>>>
>>> Andre
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From ssigabudeen at qatarairways.com.qa  Sun Oct 21 20:07:47 2012
From: ssigabudeen at qatarairways.com.qa (Syed)
Date: Sun, 21 Oct 2012 12:07:47 -0700 (PDT)
Subject: [rabbitmq-discuss] Apache Camel + RabbitMQ Configuration.
Message-ID: <1350846467427-22739.post@n5.nabble.com>

Hi,

I am using the below specification, I am not able to establish connection
with RabbitMQ using the below configuration. 

Set the VM arguments -Dqpid.dest_syntax=BURL -Dqpid.amqp.version=0-91

RabbitMQ 2.8.5
Camel - 2.10.0
QPID Client - 0.16

Camel Configuration
-------------------------

	<bean id="amqp" class="org.apache.camel.component.amqp.AMQPComponent">
	<property name="connectionFactory">
		<bean class="org.apache.qpid.client.AMQConnectionFactory">
		<constructor-arg index="0" type="java.lang.String"
			value="amqp://guest:guest at host/?brokerlist='tcp://localhost:5672'" />
		</bean>
	</property>
	</bean>

<camelContext xmlns="http://camel.apache.org/schema/spring">
		<route>
			<from uri="amqp:queue:Master" />
			<to
uri="file:D:/delete/?fileName=mydata-${date:now:yyyyMMddhhmmssSSS}.txt" />
		</route>
	</camelContext>

Camel Console Log
------------------------

12/10/21 21:32:27 INFO client.AMQConnection:
Connection:amqp://guest:********@host/?brokerlist='tcp://localhost:5672'
12/10/21 21:32:27 INFO protocol.AMQProtocolSession: Using ProtocolVersion
for Session:0-91
12/10/21 21:32:27 INFO handler.ClientMethodDispatcherImpl: New Method
Dispatcher:AMQProtocolSession[null]
12/10/21 21:32:27 INFO client.AMQConnection: Connecting with ProtocolHandler
Version:0-91
12/10/21 21:32:27 INFO state.StateWaiter: New StateWaiter :AMQState: id = 1
name: CONNECTION_NOT_STARTED:[AMQState: id = 4 name: CONNECTION_OPEN,
AMQState: id = 6 name: CONNECTION_CLOSED]
12/10/21 21:32:27 INFO protocol.AMQProtocolSession: Setting ProtocolVersion
to :0-91
12/10/21 21:32:27 INFO handler.ClientMethodDispatcherImpl: New Method
Dispatcher:AMQProtocolSession[AMQConnection:
Host: localhost
Port: 5672
Virtual Host: 
Client ID: host
Active session count: 0]
12/10/21 21:32:27 INFO security.DynamicSaslRegistrar: Additional SASL
providers successfully registered.
12/10/21 21:32:27 INFO security.CallbackHandlerRegistry: Callback handlers
available for SASL mechanisms: [EXTERNAL, GSSAPI, CRAM-MD5-HASHED, CRAM-MD5,
AMQPLAIN, PLAIN, ANONYMOUS]
12/10/21 21:32:27 INFO client.AMQConnection: Connected with ProtocolHandler
Version:0-91
12/10/21 21:32:27 INFO spring.SpringCamelContext: Route: route1 started and
consuming from: Endpoint[amqp://queue:Master]
12/10/21 21:32:27 INFO spring.SpringCamelContext: Total 1 routes, of which 1
is started.
12/10/21 21:32:27 INFO spring.SpringCamelContext: Apache Camel 2.10.0
(CamelContext: camel-1) started in 1.000 seconds
12/10/21 21:32:27 INFO client.AMQSession: Created
session:org.apache.qpid.client.AMQSession_0_8 at 13e9934

Rabbit MQ Log
------------------
=INFO REPORT==== 21-Oct-2012::21:32:27 ===
accepting AMQP connection <0.783.0> (127.0.0.1:3917 -> 127.0.0.1:5672)

=WARNING REPORT==== 21-Oct-2012::21:32:28 ===
closing AMQP connection <0.783.0> (127.0.0.1:3917 -> 127.0.0.1:5672):
connection_closed_abruptly

Kindly let me know what needs to be done..

Thanks & REgards
Jawahar



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Apache-Camel-RabbitMQ-Configuration-tp22739.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From lwice04 at gmail.com  Mon Oct 22 09:37:31 2012
From: lwice04 at gmail.com (cyj)
Date: Mon, 22 Oct 2012 01:37:31 -0700 (PDT)
Subject: [rabbitmq-discuss] receive no-delay msg from publisher
Message-ID: <1350895051095-22745.post@n5.nabble.com>

i encounter a problem that when i received one msg,i have to proceed a long
time ,so when i received the next msg,i got a delay msg published by the
publisher that i don't need.
i need the no-delay msg so if the msg published too fast, some of them
should be abandoned.
can anybody give me some advice?
i try the immediate flag,but it do not work,beacuse i think  when my program
is running, there   is a consumer connected to  the exchange.

while(true)
{
	std::string msg;
	std::string rk;
	if(!this->waitforMessage(msg ,rk)){
		continue;
        }
        sleep(2000);
}
thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/receive-no-delay-msg-from-publisher-tp22745.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Mon Oct 22 10:18:01 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 22 Oct 2012 10:18:01 +0100
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <1350730294.34176.YahooMailNeo@web162906.mail.bf1.yahoo.com>
References: <1350730294.34176.YahooMailNeo@web162906.mail.bf1.yahoo.com>
Message-ID: <50850F49.6000806@rabbitmq.com>

Hi,

On 20/10/12 11:51, Sven Turnau wrote:
> ImportError: No module named pica

> import pica

There is a python library named "pika" - is that what you meant?

-Emile

From videlalvaro at gmail.com  Mon Oct 22 10:13:46 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 22 Oct 2012 13:13:46 +0400
Subject: [rabbitmq-discuss] (no subject)
In-Reply-To: <50850F49.6000806@rabbitmq.com>
References: <1350730294.34176.YahooMailNeo@web162906.mail.bf1.yahoo.com>
	<50850F49.6000806@rabbitmq.com>
Message-ID: <CAMcAHLUFCidR+sSps+8a0334YawtMc4Y4i-kuR-Y6VPviGEdHA@mail.gmail.com>

In your code you probably want to write

*import pika*

Instead of *import pica*

Cheers

-Alvaro

On Mon, Oct 22, 2012 at 1:18 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 20/10/12 11:51, Sven Turnau wrote:
> > ImportError: No module named pica
>
> > import pica
>
> There is a python library named "pika" - is that what you meant?
>
> -Emile
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/d58f4b04/attachment.htm>

From emile at rabbitmq.com  Mon Oct 22 10:24:29 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 22 Oct 2012 10:24:29 +0100
Subject: [rabbitmq-discuss] {SSL upgrade error, timeout}
In-Reply-To: <356b01aa-4df9-44cb-9e3a-54492ce13f2b@googlegroups.com>
References: <356b01aa-4df9-44cb-9e3a-54492ce13f2b@googlegroups.com>
Message-ID: <508510CD.8040001@rabbitmq.com>

Hi,

On 21/10/12 21:23, dharshanr wrote:
> =ERROR REPORT==== 21-Oct-2012::09:12:49 ===
> error on AMQP connection <0.7614.0>: {ssl_upgrade_error,timeout}

Are you sure the problem is not network-related?

> The certs are self signed certs and not trusted. Any thoughts on how I
> can debug this error?

It is strange that a working setup stops working suddenly. The tips in
the SSL troubleshooting guide might provide more debugging information:

http://www.rabbitmq.com/troubleshooting-ssl.html


-Emile


From simon at rabbitmq.com  Mon Oct 22 10:33:09 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 22 Oct 2012 10:33:09 +0100
Subject: [rabbitmq-discuss] receive no-delay msg from publisher
In-Reply-To: <1350895051095-22745.post@n5.nabble.com>
References: <1350895051095-22745.post@n5.nabble.com>
Message-ID: <508512D5.7040407@rabbitmq.com>

On 22/10/12 09:37, cyj wrote:
> i encounter a problem that when i received one msg,i have to proceed a long
> time ,so when i received the next msg,i got a delay msg published by the
> publisher that i don't need.
> i need the no-delay msg so if the msg published too fast, some of them
> should be abandoned.
> can anybody give me some advice?

Set a message TTL on your queue(s):

http://www.rabbitmq.com/ttl.html

> i try the immediate flag,but it do not work,beacuse i think  when my program
> is running, there   is a consumer connected to  the exchange.

Hmm, that should work. But the 'immediate' flag is going away:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-September/022473.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Mon Oct 22 10:49:10 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 22 Oct 2012 10:49:10 +0100
Subject: [rabbitmq-discuss] STOMP plugin - durable subscription
	limitation
In-Reply-To: <k60bua$dam$1@ger.gmane.org>
References: <k5p9o9$kqi$1@ger.gmane.org> <50815415.8090308@rabbitmq.com>
	<k60bua$dam$1@ger.gmane.org>
Message-ID: <50851696.4040200@rabbitmq.com>

Hi Michael,

On 21/10/12 09:32, Michael Justin wrote:
> So I understand with the frames shown, the clients would use the same 
> shared queue.
> 
> Does this mean that all waiting messages in the topic will be 
> distributed between the two clients because of the identical 
> subscription ID x destination?

Yes, this is correct. Both clients will be consuming from the same queue
and messages will be distributed between them. You can use the prefetch
header to control the distribution:

http://www.rabbitmq.com/stomp.html#pear.p



-Emile


From simon at rabbitmq.com  Mon Oct 22 10:49:18 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 22 Oct 2012 10:49:18 +0100
Subject: [rabbitmq-discuss] Apache Camel + RabbitMQ Configuration.
In-Reply-To: <1350846467427-22739.post@n5.nabble.com>
References: <1350846467427-22739.post@n5.nabble.com>
Message-ID: <5085169E.4050008@rabbitmq.com>

On 21/10/12 20:07, Syed wrote:
> 		<bean class="org.apache.qpid.client.AMQConnectionFactory">
> 		<constructor-arg index="0" type="java.lang.String"
> 			value="amqp://guest:guest at host/?brokerlist='tcp://localhost:5672'" />
> 		</bean>

Hi. I don't *believe* the QPid Java client actually works against 
RabbitMQ, even when you tell it to use AMQP 0-9-1. I think it's crashing 
at some point while setting up the connection (hence 
"connection_closed_abruptly" in the RabbitMQ logs, from our point of 
view it just went away suddenly).

This blog post:

http://arthur.gonigberg.com/2012/02/11/camel-rabbitmq/

talks about connecting to Camel using the RabbitMQ Java client.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Mon Oct 22 11:06:43 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 22 Oct 2012 11:06:43 +0100
Subject: [rabbitmq-discuss] Web Management Plugin Sluggishness
In-Reply-To: <CAHW0W4OuH7E-nhn2pBzkLHoem_YwM=sEAGwV3wJ9R2HABg3-Jg@mail.gmail.com>
References: <dab2720d8c79fd954963a4b4da524430@mail.gmail.com>
	<CAHW0W4NPJjU4ZUVWvDf4Eiw1fWvkUbsXSgcPkbtuL3fi3LiVSw@mail.gmail.com>
	<5081829F.9060502@rabbitmq.com>
	<CAHW0W4NTLsb8_RCFvac56q8G-OmkQcyb9X+9yvxSa5FuyCjp3w@mail.gmail.com>
	<508186A2.6060309@rabbitmq.com>
	<CAHW0W4OuH7E-nhn2pBzkLHoem_YwM=sEAGwV3wJ9R2HABg3-Jg@mail.gmail.com>
Message-ID: <50851AB3.4040400@rabbitmq.com>

On 19/10/12 19:25, Dave Seltzer wrote:
> Seems like the big values are:
> {490415,{rabbit at queue01,os_pid}}
> {1152028,{rabbit at queue01,disk_free}}
> {1694075,{rabbit at queue02,disk_free}}
> {635870,{rabbit at queue01,disk_free_alarm}}
> {310155,{rabbit at queue02,disk_free_alarm}}
> {1286885,{rabbit at queue01,proc_total}}
> {960135,{rabbit at queue02,statistics_level}}
> {956790,{rabbit at queue02,erlang_version}}
> {949552,{rabbit at queue01,run_queue}}
> {93713,{rabbit at queue02,run_queue}}
> {974491,{rabbit at queue01,processors}}

While some of those involve doing real work (e.g. disk_free), many of 
them (os_pid, erlang_version, processors) are really trivial lookups. So 
I suspect it's the cost of the RPC call that is dominating.

I assume that the server is fairly busy; if so then the RPC calls may 
just be taking some time to get scheduled. Although if they're taking 
over a second that's quite busy!

But this suggests that there's probably not an easy fix I'm afraid - 
apart from wait for 3.0 where this is solved.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Mon Oct 22 11:13:23 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 22 Oct 2012 11:13:23 +0100
Subject: [rabbitmq-discuss] Messages not being delivered to the
	queue(but sender shows 'Message sent')
In-Reply-To: <1349969744701-22501.post@n5.nabble.com>
References: <1349969744701-22501.post@n5.nabble.com>
Message-ID: <18C350CE-B2B0-4000-8F81-CDA67B1CD17E@rabbitmq.com>

Hi

If you run the Send class first and then the rabbitmqctl list_queues to check, can you see the messages then?

On 11 Oct 2012, at 16:35, vedanth wrote:

> Hi Everyone Am new to rabbit mq. I just installed rabbit mq (rabbitmq-server-2.8.7-1.noarch.rpm, able to start rabbit mq successfully)and started with some sample java programs as suggested in http://www.rabbitmq.com/tutorials/tutorial-one-java.html. Once i execute the Send class i get a message "[x] Sent 'Hello World!'". On the other terminal whien i start the Recv it just shows "[*] Waiting for messages. To exit press CTRL+C" but does not receive any messages which is sent. Also when i check >rabbitmqctl list_queues name messages_ready messages_unacknowledged messages durable It shows the queue without any messages: Listing queues ... hello 0 0 0 false ...done. Any solutions on this problem would be of great help. Thanks in advance... 
> View this message in context: Messages not being delivered to the queue(but sender shows 'Message sent')
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Mon Oct 22 11:27:02 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 22 Oct 2012 11:27:02 +0100
Subject: [rabbitmq-discuss] Consumer group
In-Reply-To: <CABaj-QbJz=_k=vJ4r75qKDRL-KovZQ-G5yTNf4cP=pkNtpuMjQ@mail.gmail.com>
References: <CABaj-QbJz=_k=vJ4r75qKDRL-KovZQ-G5yTNf4cP=pkNtpuMjQ@mail.gmail.com>
Message-ID: <777F3B41-0B1A-4923-A0DD-34431F64BAF7@rabbitmq.com>

Hi

On 10 Oct 2012, at 18:28, kishore g wrote:

> Hi,
> 
> I am writing this email to get feedback about a rabbitmq consumer
> group. We developed this recipe using Helix, a generic cluster
> management system which we open sourced yesterday. In order to
> demonstrate the ease of developing applications with Helix, we chose
> to write a rabbitmq-consumer-group.
> 
> You can find more info about that here
> 
> https://github.com/linkedin/helix/wiki/Sample_App
> 
> It would be great if you can provide feedback about this app.
> 

This is very interesting, and the sample app seems pretty useful from a client's perspective in terms of recovering from failures especially. One thing I'm interested in understanding is what you would do (in general) with stale values in the case where a network partition has occurred and the leader happened to wind up in the non-quorum island, which I believe is legal in zookeeper so long as you've not overwritten the value yourself. I'm very interested to see what approach can be applied when that happens, as it's a pain having to handle this kind of thing when dealing with consensus protocols. Also do you rely on zookeeper itself to resolve any conflicts when a partitioned cluster comes back together, or is there something in Helix that's handling it - or do the clients get to cooperate to resolve conflicts and if so how? 

Anyway, looks like a very interesting piece of kit. :)

Cheers,
Tim 


From tim at rabbitmq.com  Mon Oct 22 11:34:08 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 22 Oct 2012 11:34:08 +0100
Subject: [rabbitmq-discuss] Pluggable exchange types (bug 22169) landed
	on default
In-Reply-To: <1349714968779-22415.post@n5.nabble.com>
References: <4B9032A3.3090604@lshift.net>
	<1349714968779-22415.post@n5.nabble.com>
Message-ID: <5211DEB7-5F20-4D23-946C-9C59B4A5C2B3@rabbitmq.com>

Hi

On 8 Oct 2012, at 17:49, edup_pt wrote:

> Hi,
> 
> Great Post. For which i understand you talk about an exchange in client
> javascript side, right? 
> 

I don't think that's what Tony was saying actually. A custom exchange (type) would have to be implemented in Erlang, it's just that Tony points out you can break out of the Erlang emulator into something else (like spidermonkey) if you *really* want to.

> What i pretend to do is to have an exchange inside the same network,
> meaning, if i have a main application in html/javascript i would like that
> all others client browser's (in the same network) connects directly to this
> main html/javascript  exchange (that is in the internal network). 
> 
> This exchange in client side will connect to other exchange that is in the
> rabbitmq server for cases that the users are not in the same network.
> 

It's an interesting idea, but this is not what pluggable exchange types are about I'm afriad.

> Im looking for this exchanges in client side for (java, html/javascript and 
> other languages)
> 
> Any ideia that can help me?
> 

Well from the sounds of things, what you'd *really* like is an AMQP node running in the browser. That's a very interesting idea, but not something that is likely to come 'out of the box' anywhere AFAIK. I'd suggest doing a bit more research into things like web-stomp first of all, to see if the messaging patterns you want to implement between (presumably browser based) clients can be achieved simply using something like that. But it's worth baring in mind that AMQP is a broker oriented protocol - certainly 0.9.1 is anyway - and so a broker-less model (where clients speak to one another directly) is not something you'll be able to glue together using the protocol.

It's probably also worth baring in mind that native AMQP isn't likely to run directly inside a browser any time soon, so you should really consider alternatives to get from the browser (clients) to a broker, and then think about smart integration patterns that would allow your clients to behave *as if* they were peers, despite the intermediary role of the broker in the network.

Cheers,

> Thanks a lot.
> 
> 
> 
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Pluggable-exchange-types-bug-22169-landed-on-default-tp14982p22415.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tim at rabbitmq.com  Mon Oct 22 11:35:25 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 22 Oct 2012 11:35:25 +0100
Subject: [rabbitmq-discuss] Pluggable exchange types (bug 22169) landed
	on default
In-Reply-To: <5211DEB7-5F20-4D23-946C-9C59B4A5C2B3@rabbitmq.com>
References: <4B9032A3.3090604@lshift.net>
	<1349714968779-22415.post@n5.nabble.com>
	<5211DEB7-5F20-4D23-946C-9C59B4A5C2B3@rabbitmq.com>
Message-ID: <5222E5DE-773E-4CD7-9784-CF7B7097A8AB@rabbitmq.com>

On this note, you might also want to take a look at https://github.com/tonyg/rabbithub for inspiring ideas.

On 22 Oct 2012, at 11:34, Tim Watson wrote:

> Hi
> 
> On 8 Oct 2012, at 17:49, edup_pt wrote:
> 
>> Hi,
>> 
>> Great Post. For which i understand you talk about an exchange in client
>> javascript side, right? 
>> 
> 
> I don't think that's what Tony was saying actually. A custom exchange (type) would have to be implemented in Erlang, it's just that Tony points out you can break out of the Erlang emulator into something else (like spidermonkey) if you *really* want to.
> 
>> What i pretend to do is to have an exchange inside the same network,
>> meaning, if i have a main application in html/javascript i would like that
>> all others client browser's (in the same network) connects directly to this
>> main html/javascript  exchange (that is in the internal network). 
>> 
>> This exchange in client side will connect to other exchange that is in the
>> rabbitmq server for cases that the users are not in the same network.
>> 
> 
> It's an interesting idea, but this is not what pluggable exchange types are about I'm afriad.
> 
>> Im looking for this exchanges in client side for (java, html/javascript and 
>> other languages)
>> 
>> Any ideia that can help me?
>> 
> 
> Well from the sounds of things, what you'd *really* like is an AMQP node running in the browser. That's a very interesting idea, but not something that is likely to come 'out of the box' anywhere AFAIK. I'd suggest doing a bit more research into things like web-stomp first of all, to see if the messaging patterns you want to implement between (presumably browser based) clients can be achieved simply using something like that. But it's worth baring in mind that AMQP is a broker oriented protocol - certainly 0.9.1 is anyway - and so a broker-less model (where clients speak to one another directly) is not something you'll be able to glue together using the protocol.
> 
> It's probably also worth baring in mind that native AMQP isn't likely to run directly inside a browser any time soon, so you should really consider alternatives to get from the browser (clients) to a broker, and then think about smart integration patterns that would allow your clients to behave *as if* they were peers, despite the intermediary role of the broker in the network.
> 
> Cheers,
> 
>> Thanks a lot.
>> 
>> 
>> 
>> --
>> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Pluggable-exchange-types-bug-22169-landed-on-default-tp14982p22415.html
>> Sent from the RabbitMQ mailing list archive at Nabble.com.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


From tim at rabbitmq.com  Mon Oct 22 11:42:21 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 22 Oct 2012 11:42:21 +0100
Subject: [rabbitmq-discuss] nodename variable and mnesia directory
In-Reply-To: <FBF9C5AB-BB8E-43CE-BC14-A8BD7A462BC8@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD79038A85DD645@vmexchange02.seegrid.local>
	<5081830F.70706@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038A85DD854@vmexchange02.seegrid.local>
	<FBF9C5AB-BB8E-43CE-BC14-A8BD7A462BC8@rabbitmq.com>
Message-ID: <66519775-BEBD-4EA9-9A80-361D16CBE81D@rabbitmq.com>

Hi again,

On 20 Oct 2012, at 10:52, Tim Watson wrote:

> Hi Liz,
> 
> Sorry i wasn't aware of the context. What Ian recommended should not be necessary, though I'll follow up with him on Monday to try and figure out why he needed to do that.
> 
> Once you change the hostname you,ll possibly need to restart epmd and restart your rabbit, but you shouldn't need to change the node name from say rabbit to hare.
> 

Were you able to try this again (changing only the host name but not the node name) and did it work for you? If not I'd like to know so we can investigate.

Cheers
Tim

> Cheers
> Tim
> 
> 
> 
> On 19 Oct 2012, at 19:44, Elizabeth Liao <eliao at seegrid.com> wrote:
> 
>> Hi Tim,
>> 
>> I'm going to back up a bit because it seems that I've misunderstood something previously.
>> 
>>> The first thing I'm going to say is that this isn't really a desirable
>> state of affairs. Why do you need to change NODENAME at all, just
>> because the host name has changed? This seems like an odd step to me -
>> can you explain the rationale behind it?
>> 
>> I had an earlier problem changing the hostname and restarting the rabbitmq-server. The proposed fix was to add the NODENAME variable which I'm guessing was not right? :
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021435.html
>> 
>>> Can you explain a bit more about this 'bug' please? What exactly is
>> going wrong?
>> 
>> The bug is on our end where the NODENAME is set to an empty string. Of course this is moot if NODENAME doesn't even have to be set in the first place.
>> 
>> Liz
>> ________________________________________
>> From: Tim Watson [tim at rabbitmq.com]
>> Sent: Friday, October 19, 2012 12:48 PM
>> To: Discussions about RabbitMQ
>> Cc: Elizabeth Liao
>> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
>> 
>> Hi
>> 
>> On 10/19/2012 03:41 PM, Elizabeth Liao wrote:
>>> Hi,
>>> 
>>> We are currently running rabbitmq on a system where there is a need to change the hostname occasionally.  Right now, when the hostname is changed, we also update the NODENAME variable in the rabbitmq-env.conf file.
>> 
>> The first thing I'm going to say is that this isn't really a desirable
>> state of affairs. Why do you need to change NODENAME at all, just
>> because the host name has changed? This seems like an odd step to me -
>> can you explain the rationale behind it?
>> 
>>> The problem we're having right now is that due to a bug when setting up the rabbitmq-env.conf file, sometimes the NODENAME variable exists but is not set to anything ( NODENAME=) so rabbit never successfully starts up.  Even after setting the NODENAME variable to the hostname, rabbit still doesn't start up properly.
>> 
>> Can you explain a bit more about this 'bug' please? What exactly is
>> going wrong?
>> 
>>> The only way that I could find to recover from this situation without killing the erlang process, was to also set a MNESIA_DIR variable. After I did that, once the NODENAME was set to the correct hostname, rabbit started up properly.
>> 
>> Now this makes no sense at all to me. If you are trying to recover
>> 'without killing the erlang process' then how are you planning on
>> changing the NODENAME? Once an erlang node has become part of a
>> distributed system, you cannot arbitrarily change the node's name
>> without restarting the net_kernel AFAIK so I can't see how this is even
>> possible. Also, because you're stating that 'rabbit started up properly'
>> I'm assuming that you have in fact taken the node offline (using
>> `rabbitmqctl stop` or one of the various service scripts that invokes
>> it) and that you are now starting the node again. The rabbit startup
>> scripts (and associated infrastructure) is not set up to handle changing
>> the name of a node post-installation in this manner, so I would not
>> expect this to work smoothly.
>> 
>>> A couple of questions:
>>> Is this the proper way to fix the situation?
>> 
>> No. As I said a moment ago, rabbit is not set up for this kind of
>> scenario so I'd be very cautious about doing this and would really
>> recommend against it.
>> 
>>> Will this have unintended consequences?
>> 
>> I have no idea, but it is entirely possible that various things could
>> break in obscure and alarming ways. I really would not do this if I were
>> you.
>> 
>>> We are running rabbitmq-server-2.8.6 and erlang-R15B.
>>> 
>>> Thanks!
>> 
>> Liz. I would like to help you find a safe work-around so that you can
>> use rabbit in your environment. I would really like to understand why
>> the changing of a machine's host-name is causing problems for you. I
>> fully realise that after changing the hostname, it is possible that a
>> restart may be required (although I'd have to do some research to verify
>> whether or not this is a hard requirement). But I cannot understand why
>> a change to the machine's host name requires changing the rabbit
>> NODENAME at all, unless you've altered the rabbit start scripts to use
>> 'longnames' configuration (i.e., including the complete host name in the
>> node name) in which case, a simple solution to your problem might be to
>> switch back to using 'shortnames'. If erlang is started using -sname
>> rabbit@`hostname -s` and your /etc/hosts configuration supports
>> resolving the machine's IP to the short version of the name, then
>> changing the hostname shouldn't cause all of these headaches.
>> 
>> For example, if I launch rabbit with something like this:
>> 
>> env RABBITMQ_NODENAME=rabbit RABBITMQ_NODE_PORT=5672
>> RABBITMQ_LOG_BASE="/tmp"
>> RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia"
>> RABBITMQ_PID_FILE="/tmp/rabbitmq-rabbit.pid"
>> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch"
>> RABBITMQ_ENABLED_PLUGINS_FILE="/tmp/enabled-plugins"
>> RABBITMQ_CONFIG_FILE="/tmp/etc/rabbit" ./scripts/rabbitmq-server
>> 
>> Then change the hostname, then stop rabbit and start it again,
>> everything is fine.
>> 
>> Cheers,
>> Tim
>> 
>>> Liz
>>> Email Confidentiality Notice
>>> 
>>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> Email Confidentiality Notice
>> 
>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From Petr.Gotthard at Honeywell.com  Mon Oct 22 11:52:04 2012
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Mon, 22 Oct 2012 10:52:04 +0000
Subject: [rabbitmq-discuss] intenal error when connecting from rabbitmq-c
Message-ID: <F9E85480F62349458DF67CE8BA000D8D17F5C607@FR44EX3005.global.ds.honeywell.com>

Hello,
While the rabbitmq-c on one machine is fine, on another machine I'm getting 'server connection error 541, message: INTERNAL_ERROR' and the rabbitmq log contains the following entries:


=ERROR REPORT==== 22-Oct-2012::12:38:17 ===
AMQP connection <0.2315.0>, channel 1 - error:
{{badmatch,{undefined,<<40,17,97,112,112,108,105,99,97,116,105,111,110,47,
                        110,111,116,97,109>>}},
[{rabbit_framing_amqp_0_9_1,decode_properties,2},
  {rabbit_binary_parser,ensure_content_decoded,1},
  {rabbit_channel,handle_method,3},
  {rabbit_channel,handle_cast,2},
  {gen_server2,handle_msg,2},
  {proc_lib,init_p_do_apply,3}]}


=CRASH REPORT==== 22-Oct-2012::12:38:17 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.2327.0>
    registered_name: []
    exception exit: {{badmatch,
                         {undefined,
                             <<40,17,97,112,112,108,105,99,97,116,105,111,
                               110,47,110,111,116,97,109>>}},
                     [{rabbit_framing_amqp_0_9_1,decode_properties,2},
                      {rabbit_binary_parser,ensure_content_decoded,1},
                      {rabbit_channel,handle_method,3},
                      {rabbit_channel,handle_cast,2},
                      {gen_server2,handle_msg,2},
                      {proc_lib,init_p_do_apply,3}]}
      in function  gen_server2:terminate/3
    ancestors: [<0.2324.0>,<0.2322.0>,<0.2320.0>,rabbit_tcp_client_sup,
                  rabbit_sup,<0.114.0>]
    messages: []
    links: [<0.2324.0>]
    dictionary: [{{credit_to,<0.2323.0>},49},
                  {permission_cache,[{{resource,<<"demo">>,exchange,<<"ais">>},
                                      write}]}]
    trap_exit: true
    status: running
    heap_size: 987
    stack_size: 24
    reductions: 895
  neighbours:



Could you please help me to identify what could be wrong?

Thanks,
Petr
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/f176dd92/attachment.htm>

From matthias at rabbitmq.com  Mon Oct 22 12:13:31 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Oct 2012 12:13:31 +0100
Subject: [rabbitmq-discuss] intenal error when connecting from rabbitmq-c
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D17F5C607@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D17F5C607@FR44EX3005.global.ds.honeywell.com>
Message-ID: <50852A5B.2070606@rabbitmq.com>

Petr,

On 22/10/12 11:52, Gotthard, Petr wrote:
> While the rabbitmq-c on one machine is fine, on another machine I?m
> getting ?server connection error 541, message: INTERNAL_ERROR? and the
> rabbitmq log contains the following entries:
>
> =ERROR REPORT==== 22-Oct-2012::12:38:17 ===
>
> AMQP connection <0.2315.0>, channel 1 - error:
>
> {{badmatch,{undefined,<<40,17,97,112,112,108,105,99,97,116,105,111,110,47,
>
>                          110,111,116,97,109>>}},
>
> [{rabbit_framing_amqp_0_9_1,decode_properties,2},

Looks like the basic.publish headers/properties are invalid. I suggest 
you try sending a message without any headers/properties. If that works 
then carefully check your code that is constructing the 
amqp_basic_properties_t. In particularly, make sure that you are setting 
the flags correctly. See e.g. 
http://comments.gmane.org/gmane.comp.networking.rabbitmq.general/2717

Regards,

Matthias.

From matthias at rabbitmq.com  Mon Oct 22 12:21:29 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Oct 2012 12:21:29 +0100
Subject: [rabbitmq-discuss] Upgrading RabbitMQ2.8.6
In-Reply-To: <CANPBPZnVFQbwpYt1jqCZ6=dC07t=1F0mhQWZUKQpWXUpiucUQw@mail.gmail.com>
References: <CANPBPZnfRu8+yEzZd9UXuhZa-4evcOVnnURFvhN24uHiGSFKjQ@mail.gmail.com>
	<50810FB1.5060001@rabbitmq.com>
	<CANPBPZkAzpKHe7F8fzkZ_qPP0pmEO=Y46D81X3kDoXvAbEadTA@mail.gmail.com>
	<CANPBPZmBWZivfFmcNB1x8qVK7WfR-1ThPSeozCDk+Z6SA2b_og@mail.gmail.com>
	<50811BFD.3040207@rabbitmq.com>
	<CANPBPZnVFQbwpYt1jqCZ6=dC07t=1F0mhQWZUKQpWXUpiucUQw@mail.gmail.com>
Message-ID: <50852C39.8040704@rabbitmq.com>

On 19/10/12 10:24, PSL 88506 wrote:
> When i try to understand about installation procedure for 2.8.6
>
> All links are getting redirected to same page with following URL:
> http://www.rabbitmq.com/download.html

Links will always point to the latest version, which is 2.8.7. I 
recommend you install that rather than 2.8.6. If you really must install 
2.8.6, follow the "Older Versions / Download" link on the download.html 
page.

Regards,

Matthias.

From simon at rabbitmq.com  Mon Oct 22 12:35:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 22 Oct 2012 12:35:10 +0100
Subject: [rabbitmq-discuss] Rabbit Management HTTP API issue - deleted
 queues linger in API responses
In-Reply-To: <b3dd8a14-2e5c-4ae1-a984-a7f8210a15df@googlegroups.com>
References: <757bbda1-844b-43c5-b5bb-040d7747c21d@googlegroups.com>
	<b3dd8a14-2e5c-4ae1-a984-a7f8210a15df@googlegroups.com>
Message-ID: <50852F6E.5010407@rabbitmq.com>

No - this certainly should not be happening.

When this is happening, do you see the queues in "rabbitmqctl list_queues"?

Also, can you post logs (including the sasl log) somewhere?

Cheers, Simon

On 18/10/12 19:13, Matt Campbell wrote:
> On Thursday, October 18, 2012 12:20:54 PM UTC-5, Matt Campbell wrote:
>
>     RabbitMQ version: 2.8.7
>     Erlang version: R14B04
>
>     We are seeing an issue where queues that have been deleted using the
>     amqp basic.delete command tend to linger in the Management console
>     and in calls to the HTTP API. This is an issue for us as we are
>     using that API to discover dynamically created and deleted queues.
>     Can anyone confirm this behavior or offer a suggestion as to how we
>     can mitigate it?
>
>     Thanks,
>
>     Matt
>
>
> I learned some more about what is going on. If I try to redeclare the
> queue, rabbit returns an error unless I match the queue arguments, as I
> would expect, but then if I go to delete the queue, I get an error
> saying it doesn't exist.
>
> Our setup for this environment is a single node running in cluster mode
> (we are planning on adding a second node in the near future) and all our
> queues are declared with x-ha-policy set to all.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Mon Oct 22 12:44:47 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Oct 2012 12:44:47 +0100
Subject: [rabbitmq-discuss] PHP Client Library
In-Reply-To: <CALrxoRvGjNhNdDxCq93h2SV5UGgTDp69RgGa6u15QH-3B481AQ@mail.gmail.com>
References: <CALrxoRvRYaBs=cdbFD6403-xjQckwLZnWpBqRre4_xSsp_wQbA@mail.gmail.com>
	<CAMcAHLW2DJx2mLEHfesrhK3ZvQZGLAqBfjuthkKOKSeGYdMr9w@mail.gmail.com>
	<CAMcAHLV0PH9UUJbUi9a+aUVCyuHyi03aKxxbb16hXN7zeN+JwQ@mail.gmail.com>
	<CALrxoRvGjNhNdDxCq93h2SV5UGgTDp69RgGa6u15QH-3B481AQ@mail.gmail.com>
Message-ID: <508531AF.4020509@rabbitmq.com>

Andre,

On 22/10/12 08:23, Andre Torgal wrote:
> will RabbitMQ list the PECL library in the Get Started page if a repo
> with examples exists for it.

Yes.

Matthias.


From dev440 at gmail.com  Mon Oct 22 14:04:33 2012
From: dev440 at gmail.com (chetan dev)
Date: Mon, 22 Oct 2012 18:34:33 +0530
Subject: [rabbitmq-discuss] Clustering
Message-ID: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>

Hi,
I have two nodes clustered together , but when i stop a node using
rabbbitmqctl stop command and start the broker with rabbitmq-server
detached commnad
now when  i see the cluster status it shows only one broker running while
both of the brokers are running fine.
can anybody explain this or tell me what mistake i am making?

Thanks



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/5fd4d601/attachment.htm>

From tim at rabbitmq.com  Mon Oct 22 14:09:38 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 22 Oct 2012 14:09:38 +0100
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>
References: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>
Message-ID: <578609C0-3747-4EA0-9105-A1F954D27660@rabbitmq.com>

Works for me! ;)

What version(s) of rabbit are you running and can you please post the exact commands you're using to start each node, to stop one of the applications (not the node) and cluster it with the other one and then finally the command you're using to start again.

Cheers
Tim

On 22 Oct 2012, at 14:04, chetan dev wrote:

> Hi,
> I have two nodes clustered together , but when i stop a node using rabbbitmqctl stop command and start the broker with rabbitmq-server detached commnad
> now when  i see the cluster status it shows only one broker running while both of the brokers are running fine.
> can anybody explain this or tell me what mistake i am making?
> 
> Thanks
> 
> 
> 
> -- 
> Cheten  Dev 
> 
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From dev440 at gmail.com  Mon Oct 22 14:17:02 2012
From: dev440 at gmail.com (chetan dev)
Date: Mon, 22 Oct 2012 18:47:02 +0530
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <578609C0-3747-4EA0-9105-A1F954D27660@rabbitmq.com>
References: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>
	<578609C0-3747-4EA0-9105-A1F954D27660@rabbitmq.com>
Message-ID: <CAB0ZxM6iN1av-2AdBgWVdZB-bF3hrDER8651s90JoQrr5tRCaQ@mail.gmail.com>

Hi,

Thanks for your reply i am using 2.8.6
here is what i am doing
1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered
2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
3. now i start the node rabbit at SHIKHARM using rabbitmq-server start commnad
4. and then i check cluster status it shows only one running node
Cluster status of node rabbit at CHETANDEV ...
[{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
 {running_nodes,[rabbit at CHETANDEV]}]
...done.

On Mon, Oct 22, 2012 at 6:39 PM, Tim Watson <tim at rabbitmq.com> wrote:

> Works for me! ;)
>
> What version(s) of rabbit are you running and can you please post the
> exact commands you're using to start each node, to stop one of the
> applications (not the node) and cluster it with the other one and then
> finally the command you're using to start again.
>
> Cheers
> Tim
>
> On 22 Oct 2012, at 14:04, chetan dev wrote:
>
> > Hi,
> > I have two nodes clustered together , but when i stop a node using
> rabbbitmqctl stop command and start the broker with rabbitmq-server
> detached commnad
> > now when  i see the cluster status it shows only one broker running
> while both of the brokers are running fine.
> > can anybody explain this or tell me what mistake i am making?
> >
> > Thanks
> >
> >
> >
> > --
> > Cheten  Dev
> >
> > B.Tech Final Year
> > Dept. of Electrical Engg.
> > IIT Delhi, New Delhi
> > ph 8527333215
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/6d857aaa/attachment.htm>

From u2.storm at gmail.com  Mon Oct 22 14:47:04 2012
From: u2.storm at gmail.com (Artsiom)
Date: Mon, 22 Oct 2012 16:47:04 +0300
Subject: [rabbitmq-discuss] Adding slave for mirrored queue
Message-ID: <50854E58.50807@gmail.com>

Hi all.

Let me ask question regarding mirrored queues.
I have a cluster of 8 nodes(node01, node02, node03 ... and etc.).The 
queue is declared as HA withfollowing params:
x-ha-policy: nodes
x-ha-policy: rabbit at node01, rabbit at node02, rabbit at node03

Is it possible to add more slavesfor that queuew\o deleting and 
redeclaring. If possible, what side-effects are expected?
Will other consumers be able to continue receive messages from that 
queue or they'll get cancellation consumer notification?
I don't want all nodes to be mirrors of that queue (it generates too 
much network traffic).

P.S. Does rabbitmq-c support consumer cancellation notification feature?

--
Best regards,
Artsiom

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/1d289091/attachment.htm>

From watson.timothy at gmail.com  Mon Oct 22 15:21:42 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 22 Oct 2012 15:21:42 +0100
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <CAB0ZxM6iN1av-2AdBgWVdZB-bF3hrDER8651s90JoQrr5tRCaQ@mail.gmail.com>
References: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>
	<578609C0-3747-4EA0-9105-A1F954D27660@rabbitmq.com>
	<CAB0ZxM6iN1av-2AdBgWVdZB-bF3hrDER8651s90JoQrr5tRCaQ@mail.gmail.com>
Message-ID: <F0BE6B42-22CA-4517-8858-C402166ADF37@rabbitmq.com>

Yes but how did you cluster them on the first place? You do realise that rabbit nodes are not clustered automatically?



On 22 Oct 2012, at 14:17, chetan dev <dev440 at gmail.com> wrote:

> Hi,
> 
> Thanks for your reply i am using 2.8.6
> here is what i am doing 
> 1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered 
> 2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
> 3. now i start the node rabbit at SHIKHARM using rabbitmq-server start commnad
> 4. and then i check cluster status it shows only one running node  
> Cluster status of node rabbit at CHETANDEV ...
> [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>  {running_nodes,[rabbit at CHETANDEV]}]
> ...done.
> 
> On Mon, Oct 22, 2012 at 6:39 PM, Tim Watson <tim at rabbitmq.com> wrote:
> Works for me! ;)
> 
> What version(s) of rabbit are you running and can you please post the exact commands you're using to start each node, to stop one of the applications (not the node) and cluster it with the other one and then finally the command you're using to start again.
> 
> Cheers
> Tim
> 
> On 22 Oct 2012, at 14:04, chetan dev wrote:
> 
> > Hi,
> > I have two nodes clustered together , but when i stop a node using rabbbitmqctl stop command and start the broker with rabbitmq-server detached commnad
> > now when  i see the cluster status it shows only one broker running while both of the brokers are running fine.
> > can anybody explain this or tell me what mistake i am making?
> >
> > Thanks
> >
> >
> >
> > --
> > Cheten  Dev
> >
> > B.Tech Final Year
> > Dept. of Electrical Engg.
> > IIT Delhi, New Delhi
> > ph 8527333215
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> -- 
> Cheten  Dev 
> 
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/f2244317/attachment.htm>

From watson.timothy at gmail.com  Mon Oct 22 15:24:12 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 22 Oct 2012 15:24:12 +0100
Subject: [rabbitmq-discuss] Adding slave for mirrored queue
In-Reply-To: <50854E58.50807@gmail.com>
References: <50854E58.50807@gmail.com>
Message-ID: <81DBF17F-B324-485B-82DB-151415D01FDA@rabbitmq.com>

Hi

On 22 Oct 2012, at 14:47, Artsiom <u2.storm at gmail.com> wrote:

> Hi all.
> 
> Let me ask question regarding mirrored queues.
> I have a cluster of 8 nodes(node01, node02, node03 ... and etc.). The queue is                             declared as HA with following params:
> x-ha-policy: nodes
> x-ha-policy: rabbit at node01, rabbit at node02, rabbit at node03
> 
> Is it possible to add more slaves for that queue w\o deleting and redeclaring.

In the current version of rabbit no. In the next feature release 3.0 yes, because ha is controlled by policy rather than at queue declaration time and can be changed at runtime. Check out next.rabbitmq.com for more info.

> If possible, what side-effects are expected?
> Will other consumers be able to continue receive messages from that queue or they'll                                                           get cancellation consumer notification?
> I don't want all nodes to be mirrors of that queue (it generates too much network traffic).
> 
> P.S. Does rabbitmq-c support consumer cancellation notification feature?
> 
> --
> Best regards,
> Artsiom
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/7b1050fe/attachment.htm>

From u2.storm at gmail.com  Mon Oct 22 15:52:16 2012
From: u2.storm at gmail.com (Artsiom)
Date: Mon, 22 Oct 2012 17:52:16 +0300
Subject: [rabbitmq-discuss] Adding slave for mirrored queue
In-Reply-To: <81DBF17F-B324-485B-82DB-151415D01FDA@rabbitmq.com>
References: <50854E58.50807@gmail.com>
	<81DBF17F-B324-485B-82DB-151415D01FDA@rabbitmq.com>
Message-ID: <50855DA0.20008@gmail.com>

Tim, thanks for response.

Does this feature available in nightly builds?
Could you uncover the mystery, when rabbitmq 3.0 release is expected? :)


On 10/22/2012 05:24 PM, Tim Watson wrote:
> Hi
>
> On 22 Oct 2012, at 14:47, Artsiom <u2.storm at gmail.com 
> <mailto:u2.storm at gmail.com>> wrote:
>
>> Hi all.
>>
>> Let me ask question regarding mirrored queues.
>> I have a cluster of 8 nodes(node01, node02, node03 ... and etc.).The 
>> queue is declared as HA withfollowing params:
>> x-ha-policy: nodes
>> x-ha-policy: rabbit at node01, rabbit at node02, rabbit at node03
>>
>> Is it possible to add more slavesfor that queuew\o deleting and 
>> redeclaring.
>
> In the current version of rabbit no. In the next feature release 3.0 
> yes, because ha is controlled by policy rather than at queue 
> declaration time and can be changed at runtime. Check out 
> next.rabbitmq.com <http://next.rabbitmq.com> for more info.
>
>> If possible, what side-effects are expected?
>> Will other consumers be able to continue receive messages from that 
>> queue or they'll get cancellation consumer notification?
>> I don't want all nodes to be mirrors of that queue (it generates too 
>> much network traffic).
>>
>> P.S. Does rabbitmq-c support consumer cancellation notification feature?
>>
>> --
>> Best regards,
>> Artsiom
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com 
>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/2dd0a326/attachment.htm>

From watson.timothy at gmail.com  Mon Oct 22 16:30:54 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 22 Oct 2012 16:30:54 +0100
Subject: [rabbitmq-discuss] Adding slave for mirrored queue
In-Reply-To: <50855DA0.20008@gmail.com>
References: <50854E58.50807@gmail.com>
	<81DBF17F-B324-485B-82DB-151415D01FDA@rabbitmq.com>
	<50855DA0.20008@gmail.com>
Message-ID: <86B6A351-B208-4F74-955F-6897271F6445@rabbitmq.com>


Artisom,

On 22 Oct 2012, at 15:52, Artsiom <u2.storm at gmail.com> wrote:

> Tim, thanks for response.
> 
> Does this feature available in nightly builds?

Yes it is!

> Could you uncover the mystery, when rabbitmq 3.0 release is expected? :)
> 
> 

LOL not really, but most of the tickets associated with it are complete so it should be coming soon!

> On 10/22/2012 05:24 PM, Tim Watson wrote:
>> Hi
>> 
>> On 22 Oct 2012, at 14:47, Artsiom <u2.storm at gmail.com> wrote:
>> 
>>> Hi all.
>>> 
>>> Let me ask question regarding mirrored queues.
>>> I have a cluster of 8 nodes(node01, node02, node03 ... and etc.). The queue is declared as HA with following params:
>>> x-ha-policy: nodes
>>> x-ha-policy: rabbit at node01, rabbit at node02, rabbit at node03
>>> 
>>> Is it possible to add more slaves for that queue w\o deleting and redeclaring.
>> 
>> In the current version of rabbit no. In the next feature release 3.0 yes, because ha is controlled by policy rather than at queue declaration time and can be changed at runtime. Check out next.rabbitmq.com for more info.
>> 
>>> If possible, what side-effects are expected?
>>> Will other consumers be able to continue receive messages from that queue or they'll get cancellation consumer notification?
>>> I don't want all nodes to be mirrors of that queue (it generates too much network traffic).
>>> 
>>> P.S. Does rabbitmq-c support consumer cancellation notification feature?
>>> 
>>> --
>>> Best regards,
>>> Artsiom
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/1b7d75e5/attachment.htm>

From matt at crocodoc.com  Mon Oct 22 17:07:36 2012
From: matt at crocodoc.com (Matt Long)
Date: Mon, 22 Oct 2012 09:07:36 -0700
Subject: [rabbitmq-discuss] Upgrading RabbitMQ2.8.6
In-Reply-To: <50852C39.8040704@rabbitmq.com>
References: <CANPBPZnfRu8+yEzZd9UXuhZa-4evcOVnnURFvhN24uHiGSFKjQ@mail.gmail.com>
	<50810FB1.5060001@rabbitmq.com>
	<CANPBPZkAzpKHe7F8fzkZ_qPP0pmEO=Y46D81X3kDoXvAbEadTA@mail.gmail.com>
	<CANPBPZmBWZivfFmcNB1x8qVK7WfR-1ThPSeozCDk+Z6SA2b_og@mail.gmail.com>
	<50811BFD.3040207@rabbitmq.com>
	<CANPBPZnVFQbwpYt1jqCZ6=dC07t=1F0mhQWZUKQpWXUpiucUQw@mail.gmail.com>
	<50852C39.8040704@rabbitmq.com>
Message-ID: <CAFX3A=1HJW68iyzJNE15QxwUyP-HG=QcC711ueWV68-JahxwsQ@mail.gmail.com>

While we're on the topic of older versions, it appears they are removed
from the RabbitMQ APT repository; only the newest version is ever
available. Is this done on purpose? It has led to some issues for us since
we specify explicit package versions in our provisioning system and
occasionally they'll no longer be there!

Thanks,
Matt

On Mon, Oct 22, 2012 at 4:21 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 19/10/12 10:24, PSL 88506 wrote:
>
>> When i try to understand about installation procedure for 2.8.6
>>
>> All links are getting redirected to same page with following URL:
>> http://www.rabbitmq.com/**download.html<http://www.rabbitmq.com/download.html>
>>
>
> Links will always point to the latest version, which is 2.8.7. I recommend
> you install that rather than 2.8.6. If you really must install 2.8.6,
> follow the "Older Versions / Download" link on the download.html page.
>
>
> Regards,
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
Matt Long
Cofounder and Lead Developer
crocodoc.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/b9f3889b/attachment.htm>

From simon at rabbitmq.com  Mon Oct 22 17:13:41 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 22 Oct 2012 17:13:41 +0100
Subject: [rabbitmq-discuss] Adding slave for mirrored queue
In-Reply-To: <50854E58.50807@gmail.com>
References: <50854E58.50807@gmail.com>
Message-ID: <508570B5.5000501@rabbitmq.com>

On 22/10/12 14:47, Artsiom wrote:
> Is it possible to add more slavesfor that queuew\o deleting and
> redeclaring.

As Tim notes, not until 3.0.

> If possible, what side-effects are expected?

The same as with adding a new cluster node with x-ha-policy:all in 2.8.x 
- the new mirror will be initially unsynchronised and will become 
synchronised when all old messages have been consumed. Producers and 
consumers won't see any side effects when the new mirror comes on line.

> Will other consumers be able to continue receive messages from that
> queue or they'll get cancellation consumer notification?

They will continue to receive messages.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From lvauthrin at gmail.com  Mon Oct 22 20:05:42 2012
From: lvauthrin at gmail.com (Laurent Vauthrin)
Date: Mon, 22 Oct 2012 15:05:42 -0400
Subject: [rabbitmq-discuss] Channel thread-safety
Message-ID: <CAM8Y7yBqrHE8kvF38htNLnqZ3CSCGqkUQLJoaTwDK0p0qfWpoQ@mail.gmail.com>

Hello,

I've done some searching but can't seem to answer a couple of questions.
 In the API guide, I saw:

"Channel instances are safe for use by multiple threads. Requests into a
Channel are serialized, with only one thread being able to run a command on
the Channel at a time. Even so, applications should prefer using a Channel
per thread instead of sharing the same Channel across multiple threads."

And in the Javadocs for Channel, I saw:

"While a Channel can be used by multiple threads, it's important to ensure
that only one thread executes a command at once. Concurrent execution of
commands will likely cause an UnexpectedFrameError to be thrown."

Currently, our service shares the same channel across each request thread
and we synchronize the call to 'basicPublish'.  Looking at the basicPublish
code, it looks like the sequence number member variable is not thread safe
but it doesn't affect us since we're not ack'ing our messages.

My questions are:
1. Should we be using a channel per thread considering that we're
synchronizing the basicPublish call anyway?
2. Can we just share one channel across all threads and not synchronize the
call to basicPublish?

Thanks,
Laurent
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/ab4de8ca/attachment.htm>

From dev440 at gmail.com  Mon Oct 22 20:28:33 2012
From: dev440 at gmail.com (chetan dev)
Date: Tue, 23 Oct 2012 00:58:33 +0530
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <F0BE6B42-22CA-4517-8858-C402166ADF37@rabbitmq.com>
References: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>
	<578609C0-3747-4EA0-9105-A1F954D27660@rabbitmq.com>
	<CAB0ZxM6iN1av-2AdBgWVdZB-bF3hrDER8651s90JoQrr5tRCaQ@mail.gmail.com>
	<F0BE6B42-22CA-4517-8858-C402166ADF37@rabbitmq.com>
Message-ID: <CAB0ZxM7=S7ZnhkrAYhjzZURJO07KyMmfqap+gV67eTUEQvJDuA@mail.gmail.com>

Hi,

Yes i clustered them as given on rabbitmq clustering documentation for e.g
on the first place both nodes are running
now i stopped app using rabbitmqctl stop_app then i reset that node than i
clusterd that node with another using rabbitmqctl cluster rabbit at SHIKHARM
then i started the node using rabbitmqctl start_app
when i checked the cluster status it was showing fine then i did as i
mentioned earlier

Thanks

On Mon, Oct 22, 2012 at 7:51 PM, Tim Watson <watson.timothy at gmail.com>wrote:

> Yes but how did you cluster them on the first place? You do realise that
> rabbit nodes are not clustered automatically?
>
>
>
> On 22 Oct 2012, at 14:17, chetan dev <dev440 at gmail.com> wrote:
>
> Hi,
>
> Thanks for your reply i am using 2.8.6
> here is what i am doing
> 1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered
> 2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
> 3. now i start the node rabbit at SHIKHARM using rabbitmq-server start
> commnad
> 4. and then i check cluster status it shows only one running node
> Cluster status of node rabbit at CHETANDEV ...
> [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>  {running_nodes,[rabbit at CHETANDEV]}]
> ...done.
>
> On Mon, Oct 22, 2012 at 6:39 PM, Tim Watson <tim at rabbitmq.com> wrote:
>
>> Works for me! ;)
>>
>> What version(s) of rabbit are you running and can you please post the
>> exact commands you're using to start each node, to stop one of the
>> applications (not the node) and cluster it with the other one and then
>> finally the command you're using to start again.
>>
>> Cheers
>> Tim
>>
>> On 22 Oct 2012, at 14:04, chetan dev wrote:
>>
>> > Hi,
>> > I have two nodes clustered together , but when i stop a node using
>> rabbbitmqctl stop command and start the broker with rabbitmq-server
>> detached commnad
>> > now when  i see the cluster status it shows only one broker running
>> while both of the brokers are running fine.
>> > can anybody explain this or tell me what mistake i am making?
>> >
>> > Thanks
>> >
>> >
>> >
>> > --
>> > Cheten  Dev
>> >
>> > B.Tech Final Year
>> > Dept. of Electrical Engg.
>> > IIT Delhi, New Delhi
>> > ph 8527333215
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> --
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
>
>  _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/025d40da/attachment.htm>

From michael.s.klishin at gmail.com  Mon Oct 22 20:46:23 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 22 Oct 2012 23:46:23 +0400
Subject: [rabbitmq-discuss] Channel thread-safety
In-Reply-To: <CAM8Y7yBqrHE8kvF38htNLnqZ3CSCGqkUQLJoaTwDK0p0qfWpoQ@mail.gmail.com>
References: <CAM8Y7yBqrHE8kvF38htNLnqZ3CSCGqkUQLJoaTwDK0p0qfWpoQ@mail.gmail.com>
Message-ID: <CAE3HoVTr6esOVC4A6PkKBiZm__PO5=uB-7Hj=oXyKN_5eDtdbg@mail.gmail.com>

2012/10/22 Laurent Vauthrin <lvauthrin at gmail.com>

> My questions are:
> 1. Should we be using a channel per thread considering that we're
> synchronizing the basicPublish call anyway?
>

Yes. Channels are just integer on the wire and a little bit of memory
allocated on the JVM heap. They are very cheap
for all intents and purposes and you are much more likely to max out your
OS and hardware resources (assuming 1 channel per JVM thread) before
you run into issues with channel objects.


> 2. Can we just share one channel across all threads and not synchronize
> the call to basicPublish?
>


No. The real issue with shared channels is that large messages will result
in multiple protocol frames being sent
for a single basicPublish operation. When publishing on the same channel
from multiple threads, this may result
in frames being delivered out of order:

T1 => basicPublish => [Frame11] [Frame12] [Frame13]
T2 => basicPublish => [Frame21] [Frame22] [Frame23]

may result in the following delivery order, all on the same channel:

[Frame11][Frame21][Frame12][Frame13][Frame22][Frame23]

and because all frames are on the same channel, RabbitMQ won't be able to
tell how to reconstruct your messages.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/9625fb67/attachment.htm>

From deshai-0 at student.ltu.se  Mon Oct 22 20:50:04 2012
From: deshai-0 at student.ltu.se (Desta Haileselassie Hagos)
Date: Mon, 22 Oct 2012 21:50:04 +0200
Subject: [rabbitmq-discuss] RabbitMQ + Messages between virtual machines
 and physical hosts on a cloud
In-Reply-To: <CAKiRAqUDH2Go=H-VwLj0dtdKRq7jD5wpNxspoi_LGuh9kSz5OA@mail.gmail.com>
References: <CAKiRAqUDH2Go=H-VwLj0dtdKRq7jD5wpNxspoi_LGuh9kSz5OA@mail.gmail.com>
Message-ID: <CAKiRAqUZZyg4bqvsGEeH8a-+wwS0m=8sC9tJJ6JUMB1T1V1eQg@mail.gmail.com>

Dear Sir/Madam,

The problem is that I am not able to send and receive messages between the
Virtual machines and the physical hosts on my cloud. I want to receive full
information by manipulating the VMs APIs if it is possible.


>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/c8eb2876/attachment.htm>

From brett.r.cameron at gmail.com  Mon Oct 22 21:10:05 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Tue, 23 Oct 2012 09:10:05 +1300
Subject: [rabbitmq-discuss] RabbitMQ + Messages between virtual machines
 and physical hosts on a cloud
In-Reply-To: <CAKiRAqUZZyg4bqvsGEeH8a-+wwS0m=8sC9tJJ6JUMB1T1V1eQg@mail.gmail.com>
References: <CAKiRAqUDH2Go=H-VwLj0dtdKRq7jD5wpNxspoi_LGuh9kSz5OA@mail.gmail.com>
	<CAKiRAqUZZyg4bqvsGEeH8a-+wwS0m=8sC9tJJ6JUMB1T1V1eQg@mail.gmail.com>
Message-ID: <CALPqkipaNufyui=8F522qDrX1A4P66FwtQ_Z4jWrgz+3Lv9ToA@mail.gmail.com>

Desta,

Have you looked at the security profile associated with your VM's? Is it
possible that port 5672 is blocked?

Brett

On Tue, Oct 23, 2012 at 8:50 AM, Desta Haileselassie Hagos <
deshai-0 at student.ltu.se> wrote:

> Dear Sir/Madam,
>
> The problem is that I am not able to send and receive messages between the
> Virtual machines and the physical hosts on my cloud. I want to receive full
> information by manipulating the VMs APIs if it is possible.
>
>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/1f36fb06/attachment.htm>

From matthias at rabbitmq.com  Mon Oct 22 21:26:58 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 22 Oct 2012 21:26:58 +0100
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <CAB0ZxM7=S7ZnhkrAYhjzZURJO07KyMmfqap+gV67eTUEQvJDuA@mail.gmail.com>
References: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>
	<578609C0-3747-4EA0-9105-A1F954D27660@rabbitmq.com>
	<CAB0ZxM6iN1av-2AdBgWVdZB-bF3hrDER8651s90JoQrr5tRCaQ@mail.gmail.com>
	<F0BE6B42-22CA-4517-8858-C402166ADF37@rabbitmq.com>
	<CAB0ZxM7=S7ZnhkrAYhjzZURJO07KyMmfqap+gV67eTUEQvJDuA@mail.gmail.com>
Message-ID: <5085AC12.5060409@rabbitmq.com>

On 22/10/12 20:28, chetan dev wrote:
>>     here is what i am doing
>>     1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered

yes, but...

>> i clustered them as given on rabbitmq clustering documentation for e.g
>> on the first place both nodes are running
>> now i stopped app using rabbitmqctl stop_app then i reset that node than
>> i clusterd that node with another using rabbitmqctl cluster rabbit at SHIKHARM
>> then i started the node using rabbitmqctl start_app
>> when i checked the cluster status it was showing fine then i did as i
>> mentioned earlier

That will make rabbit at CHETANDEV a *ram* node. To make both nodes disk 
nodes the node itself would have to be mentioned in the cluster command 
too, i.e. 'rabbitmqctl cluster rabbit at SHIKHAR rabbit at CHETANDEV'.

>>     2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
>>     3. now i start the node rabbit at SHIKHARM using rabbitmq-server
>>     start commnad

You have just stopped and restarted the clusters' only disk node. Rabbit 
clusters won't function properly if they have only ram nodes.

>>     4. and then i check cluster status it shows only one running node
>>     Cluster status of node rabbit at CHETANDEV ...
>>     [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>>      {running_nodes,[rabbit at CHETANDEV]}]
>>     ...done.

Try running that command against rabbit at SHIKHARM. I suspect it will tell 
you that it only knows about itself.

Anyway, I suggest you change your cluster configuration s.t. both nodes 
are disk nodes.

Regards,

Matthias.

From dharshanr at scalegrid.net  Mon Oct 22 21:48:36 2012
From: dharshanr at scalegrid.net (Dharshan Rangegowda)
Date: Mon, 22 Oct 2012 13:48:36 -0700
Subject: [rabbitmq-discuss] {SSL upgrade error, timeout}
In-Reply-To: <508510CD.8040001@rabbitmq.com>
References: <356b01aa-4df9-44cb-9e3a-54492ce13f2b@googlegroups.com>
	<508510CD.8040001@rabbitmq.com>
Message-ID: <CAC3-Q1RBiLnjMCtuACu-L4_ZM3H7P6+B=LPOyvzHOWQ6yaVsgQ@mail.gmail.com>

Hi Emile,

I ran through the troubleshooting wizard and the openssl connection test
passes - so that makes me think it is not a network issue. However my java
client still fails with the "Remote host closed connection during
handshake" error. I have included the results of the connection test below.
Any other thoughts on how I can debug this?

C:\temp>openssl s_client -connect 199.71.180.59:5671 -CAfile ssltest.pem
CONNECTED(00000003)
depth=1 /CN=ScaleGridCA
verify return:1
depth=0 /CN=i-19-483-VM/O=server
verify return:1
---
Certificate chain
 0 s:/CN=i-19-483-VM/O=server
   i:/CN=ScaleGridCA
 1 s:/CN=ScaleGridCA
   i:/CN=ScaleGridCA
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIC5zCCAc+gAwIBAgIBNDANBgkqhkiG9w0BAQUFADAWMRQwEgYDVQQDEwtTY2Fs
ZUdyaWRDQTAeFw0xMjEwMjIxNjIxNTJaFw0xMzEwMjIxNjIxNTJaMCcxFDASBgNV
BAMTC2ktMTktNDgzLVZNMQ8wDQYDVQQKEwZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEB
AQUAA4IBDwAwggEKAoIBAQDX7e0Jql/WTD7OUDTIQmg+igwhiVO+17QBuDkgSsQ/
9nRJSCZzEKC9guH7V+Veq8UG9G2brqwF10jzuZSOq3CGaBWH+F5KE/U+q2yuR3kt
sOLz6wgMgYnobI1SWjvlkbwYKhgnv689m58Ub5lTISB3aKwT4C0ilnWBbF0v61mq
TFtjwDRAbCPXl9HwbBFoeLpTsiRu76VXWkA6pv9Ndl4hhcg2YLGwWAOdZO2/NUCB
QjqrHOir9ekjmpjWMQmWakN61/ckFuuFtGLOqrcujbRuVpAFFWGd53/quCZ+WKNw
81ZdafFnUSI8ioK2sHGQFxsQKNkpaRuE2/YbrLam+4HPAgMBAAGjLzAtMAkGA1Ud
EwQCMAAwCwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3
DQEBBQUAA4IBAQBqBdvs5eHfVbh8jtp3KF/Q/UG/RtMBrkBnlFWLdBKbhYbWCC1K
5VncFIpQQ2K44G+RWaqMpPgwj4AZso83/JXn11b52ZxGdR8iogrAX4vWw41CNKfr
VX0jj4/TPlwFvdS9Jzd3w/NAvLgQ1JXZdBaWxAagfXl8++5nVdC94sj4GNkrCwyN
r4zBiA6BOsmznVLBLjpoj3WLlrJDGZCTv+PSHDplZtuquDyl37PLOG6F2WUFAxaL
vhj7zKVTGIj7ESXuNYKnTSyLEkxvrlWdKooJKmH+v5xxEM6H2PqFcS/LGwIaUuxc
26AKWBnVcK+Pd86765KirNUwf7Fm2ChKwj9M
-----END CERTIFICATE-----
subject=/CN=i-19-483-VM/O=server
issuer=/CN=ScaleGridCA
---
No client certificate CA names sent
---
SSL handshake has read 1632 bytes and written 444 bytes
---
New, TLSv1/SSLv3, Cipher is AES256-SHA
Server public key is 2048 bit
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1
    Cipher    : AES256-SHA
    Session-ID:
A0F1A911ED174A49B8AACDD54C3F21C1FD332949D892EEDABF84479DC21BB22D
    Session-ID-ctx:
    Master-Key:
8FCF38B3652F0A2E6BA8EEBACF2F7387C84416DDCC365A4FF8A4A4FA4B06343DEE463499007DDD03E1155A4A4D8317EE
    Key-Arg   : None
    Start Time: 1350938613
    Timeout   : 300 (sec)
    Verify return code: 0 (ok)
---
12345678
AMQP    ?closed

On Mon, Oct 22, 2012 at 2:24 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 21/10/12 21:23, dharshanr wrote:
> > =ERROR REPORT==== 21-Oct-2012::09:12:49 ===
> > error on AMQP connection <0.7614.0>: {ssl_upgrade_error,timeout}
>
> Are you sure the problem is not network-related?
>
> > The certs are self signed certs and not trusted. Any thoughts on how I
> > can debug this error?
>
> It is strange that a working setup stops working suddenly. The tips in
> the SSL troubleshooting guide might provide more debugging information:
>
> http://www.rabbitmq.com/troubleshooting-ssl.html
>
>
> -Emile
>
>


-- 
regards,
Dharshan.
www.scalegrid.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/75aee49f/attachment.htm>

From eliao at seegrid.com  Mon Oct 22 23:14:40 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Mon, 22 Oct 2012 22:14:40 +0000
Subject: [rabbitmq-discuss] nodename variable and mnesia directory
In-Reply-To: <66519775-BEBD-4EA9-9A80-361D16CBE81D@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD79038A85DD645@vmexchange02.seegrid.local>
	<5081830F.70706@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038A85DD854@vmexchange02.seegrid.local>
	<FBF9C5AB-BB8E-43CE-BC14-A8BD7A462BC8@rabbitmq.com>,
	<66519775-BEBD-4EA9-9A80-361D16CBE81D@rabbitmq.com>
Message-ID: <E94F626F5C43D14F8B8479C5EBD79038A85DDCE1@vmexchange02.seegrid.local>

Hi,

This is what I tried
 * I start running rabbit with no NODENAME set and entered the following commands
  * rabbitmqctl stop
  * /etc/init.d/rabbitmq-server stop
  * epmd -kill ( Is this correct? I didn't see a restart in the documentation )
  * In /etc/hosts changed line from 127.0.1.1 <oldhostname> <oldhostname>.localdomain -> 127.0.1.1 <newhostname> <newhostname>.localdomain
  * in /etc/sysconfig/network changed HOSTNAME=<oldhostname> -> HOSTNAME=<newhostname>
  * /bin/hostname <newhostname>
 * /etc/init.d/rabbitmq-server start

The error I get is this:
Activating RabbitMQ plugins ...
3 plugins activated:
* amqp_client-2.8.6
* erlando-2.8.6
* rabbitmq_shovel-2.8.6

ERROR: epmd error for host "<oldhostname>": nxdomain (non-existing domain)



________________________________________
From: Tim Watson [tim at rabbitmq.com]
Sent: Monday, October 22, 2012 6:41 AM
To: Discussions about RabbitMQ
Cc: Elizabeth Liao
Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory

Hi again,

On 20 Oct 2012, at 10:52, Tim Watson wrote:

> Hi Liz,
>
> Sorry i wasn't aware of the context. What Ian recommended should not be necessary, though I'll follow up with him on Monday to try and figure out why he needed to do that.
>
> Once you change the hostname you,ll possibly need to restart epmd and restart your rabbit, but you shouldn't need to change the node name from say rabbit to hare.
>

Were you able to try this again (changing only the host name but not the node name) and did it work for you? If not I'd like to know so we can investigate.

Cheers
Tim

> Cheers
> Tim
>
>
>
> On 19 Oct 2012, at 19:44, Elizabeth Liao <eliao at seegrid.com> wrote:
>
>> Hi Tim,
>>
>> I'm going to back up a bit because it seems that I've misunderstood something previously.
>>
>>> The first thing I'm going to say is that this isn't really a desirable
>> state of affairs. Why do you need to change NODENAME at all, just
>> because the host name has changed? This seems like an odd step to me -
>> can you explain the rationale behind it?
>>
>> I had an earlier problem changing the hostname and restarting the rabbitmq-server. The proposed fix was to add the NODENAME variable which I'm guessing was not right? :
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021435.html
>>
>>> Can you explain a bit more about this 'bug' please? What exactly is
>> going wrong?
>>
>> The bug is on our end where the NODENAME is set to an empty string. Of course this is moot if NODENAME doesn't even have to be set in the first place.
>>
>> Liz
>> ________________________________________
>> From: Tim Watson [tim at rabbitmq.com]
>> Sent: Friday, October 19, 2012 12:48 PM
>> To: Discussions about RabbitMQ
>> Cc: Elizabeth Liao
>> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
>>
>> Hi
>>
>> On 10/19/2012 03:41 PM, Elizabeth Liao wrote:
>>> Hi,
>>>
>>> We are currently running rabbitmq on a system where there is a need to change the hostname occasionally.  Right now, when the hostname is changed, we also update the NODENAME variable in the rabbitmq-env.conf file.
>>
>> The first thing I'm going to say is that this isn't really a desirable
>> state of affairs. Why do you need to change NODENAME at all, just
>> because the host name has changed? This seems like an odd step to me -
>> can you explain the rationale behind it?
>>
>>> The problem we're having right now is that due to a bug when setting up the rabbitmq-env.conf file, sometimes the NODENAME variable exists but is not set to anything ( NODENAME=) so rabbit never successfully starts up.  Even after setting the NODENAME variable to the hostname, rabbit still doesn't start up properly.
>>
>> Can you explain a bit more about this 'bug' please? What exactly is
>> going wrong?
>>
>>> The only way that I could find to recover from this situation without killing the erlang process, was to also set a MNESIA_DIR variable. After I did that, once the NODENAME was set to the correct hostname, rabbit started up properly.
>>
>> Now this makes no sense at all to me. If you are trying to recover
>> 'without killing the erlang process' then how are you planning on
>> changing the NODENAME? Once an erlang node has become part of a
>> distributed system, you cannot arbitrarily change the node's name
>> without restarting the net_kernel AFAIK so I can't see how this is even
>> possible. Also, because you're stating that 'rabbit started up properly'
>> I'm assuming that you have in fact taken the node offline (using
>> `rabbitmqctl stop` or one of the various service scripts that invokes
>> it) and that you are now starting the node again. The rabbit startup
>> scripts (and associated infrastructure) is not set up to handle changing
>> the name of a node post-installation in this manner, so I would not
>> expect this to work smoothly.
>>
>>> A couple of questions:
>>> Is this the proper way to fix the situation?
>>
>> No. As I said a moment ago, rabbit is not set up for this kind of
>> scenario so I'd be very cautious about doing this and would really
>> recommend against it.
>>
>>> Will this have unintended consequences?
>>
>> I have no idea, but it is entirely possible that various things could
>> break in obscure and alarming ways. I really would not do this if I were
>> you.
>>
>>> We are running rabbitmq-server-2.8.6 and erlang-R15B.
>>>
>>> Thanks!
>>
>> Liz. I would like to help you find a safe work-around so that you can
>> use rabbit in your environment. I would really like to understand why
>> the changing of a machine's host-name is causing problems for you. I
>> fully realise that after changing the hostname, it is possible that a
>> restart may be required (although I'd have to do some research to verify
>> whether or not this is a hard requirement). But I cannot understand why
>> a change to the machine's host name requires changing the rabbit
>> NODENAME at all, unless you've altered the rabbit start scripts to use
>> 'longnames' configuration (i.e., including the complete host name in the
>> node name) in which case, a simple solution to your problem might be to
>> switch back to using 'shortnames'. If erlang is started using -sname
>> rabbit@`hostname -s` and your /etc/hosts configuration supports
>> resolving the machine's IP to the short version of the name, then
>> changing the hostname shouldn't cause all of these headaches.
>>
>> For example, if I launch rabbit with something like this:
>>
>> env RABBITMQ_NODENAME=rabbit RABBITMQ_NODE_PORT=5672
>> RABBITMQ_LOG_BASE="/tmp"
>> RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia"
>> RABBITMQ_PID_FILE="/tmp/rabbitmq-rabbit.pid"
>> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch"
>> RABBITMQ_ENABLED_PLUGINS_FILE="/tmp/enabled-plugins"
>> RABBITMQ_CONFIG_FILE="/tmp/etc/rabbit" ./scripts/rabbitmq-server
>>
>> Then change the hostname, then stop rabbit and start it again,
>> everything is fine.
>>
>> Cheers,
>> Tim
>>
>>> Liz
>>> Email Confidentiality Notice
>>>
>>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> Email Confidentiality Notice
>>
>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From hcoyote at ghostar.org  Tue Oct 23 00:05:43 2012
From: hcoyote at ghostar.org (Travis)
Date: Mon, 22 Oct 2012 18:05:43 -0500
Subject: [rabbitmq-discuss] Memory leak caused by error_logger in 2.8.6?
Message-ID: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>

Hello,

We're seeing large amounts of memory being used in some of our single
instance 2.8.6 rabbitmq.  When we do a memory
dump, the output appears to say that error_logger is taking up
hundreds of megabytes.  For example:

[{{memory,847631144},
  <4865.6.0>,
  [{registered_name,error_logger},
   {current_function,{gen_event,fetch_msg,5}},
   {initial_call,{proc_lib,init_p,5}},
   {status,waiting},
   {message_queue_len,0},
   {messages,[]},
   {links,[<4865.0.0>,<4865.30.0>]},
   {dictionary,
    [{{xtype_to_module,topic},rabbit_exchange_type_topic},
     {'$ancestors',[<4865.2.0>]},
     {'$initial_call',{gen_event,init_it,6}},
     {guid,{{36630272,1263673450,3038695659,1008081001},3102285}}]},
   {trap_exit,true},
   {error_handler,error_handler},
   {priority,normal},
   {group_leader,<4865.30.0>},
   {total_heap_size,105953765},
   {heap_size,12538050},
   {stack_size,8},
   {reductions,3561515316},
   {garbage_collection,
    [{min_bin_vheap_size,46368},
     {min_heap_size,233},
     {fullsweep_after,65535},
     {minor_gcs,578}]},
   {suspending,[]}]},

(If more of the dump is needed, I can provide)

 We're a bit perplexed as to what's causing this.  There's nothing odd
looking in the logs.  For example, we see stuff like this:

=INFO REPORT==== 22-Oct-2012::18:03:11 ===
accepting AMQP connection <0.1339.402> (127.0.0.1:32803 -> 127.0.0.1:5672)

=WARNING REPORT==== 22-Oct-2012::18:03:11 ===
closing AMQP connection <0.1339.402> (127.0.0.1:32803 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 22-Oct-2012::18:03:12 ===
closing AMQP connection <0.1331.402> (127.0.0.1:32796 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:12 ===
accepting AMQP connection <0.1347.402> (127.0.0.1:32840 -> 127.0.0.1:5672)

=WARNING REPORT==== 22-Oct-2012::18:03:13 ===
closing AMQP connection <0.1347.402> (127.0.0.1:32840 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 22-Oct-2012::18:03:13 ===
closing AMQP connection <0.32496.401> (127.0.0.1:57108 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:13 ===
closing AMQP connection <0.32476.401> (127.0.0.1:57104 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:13 ===
closing AMQP connection <0.32492.401> (127.0.0.1:57107 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:13 ===
closing AMQP connection <0.32468.401> (127.0.0.1:57103 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:14 ===
accepting AMQP connection <0.1355.402> (127.0.0.1:32875 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:14 ===
closing AMQP connection <0.1355.402> (127.0.0.1:32875 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:15 ===
accepting AMQP connection <0.1363.402> (127.0.0.1:32898 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:15 ===
accepting AMQP connection <0.1371.402> (127.0.0.1:32899 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:15 ===
closing AMQP connection <0.1371.402> (127.0.0.1:32899 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:15 ===
closing AMQP connection <0.32484.401> (127.0.0.1:57106 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:15 ===
closing AMQP connection <0.32452.401> (127.0.0.1:57081 -> 127.0.0.1:5672)

=WARNING REPORT==== 22-Oct-2012::18:03:15 ===
closing AMQP connection <0.1363.402> (127.0.0.1:32898 -> 127.0.0.1:5672):
connection_closed_abruptly


Is there a way to tell what's really going on with the error_logger
and if we're really generating so many messages that it's causing
memory to balloon so much?

Travis

-- 
Travis Campbell
travis at ghostar.org

From tbw at rg6.org  Tue Oct 23 01:41:05 2012
From: tbw at rg6.org (theBuckWheat)
Date: Mon, 22 Oct 2012 17:41:05 -0700 (PDT)
Subject: [rabbitmq-discuss] How to structure Master with many slaves? RPC??
Message-ID: <1350952865620-22782.post@n5.nabble.com>

I have a SETI-like slave pool, but I maintain the list of which slaves I want
to send work to and which are kept idle.  The slave does the work assigned
and prepares the response dataset to be sent back..   

Question: since I may turn on a slave to accept some work and later take
others out of the pool dynamically, what is the best RabbitMQ queue
topology?  RPC?  





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-structure-Master-with-many-slaves-RPC-tp22782.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From lvauthrin at gmail.com  Tue Oct 23 02:08:54 2012
From: lvauthrin at gmail.com (Laurent Vauthrin)
Date: Mon, 22 Oct 2012 21:08:54 -0400
Subject: [rabbitmq-discuss] Channel thread-safety
In-Reply-To: <CAE3HoVTr6esOVC4A6PkKBiZm__PO5=uB-7Hj=oXyKN_5eDtdbg@mail.gmail.com>
References: <CAM8Y7yBqrHE8kvF38htNLnqZ3CSCGqkUQLJoaTwDK0p0qfWpoQ@mail.gmail.com>
	<CAE3HoVTr6esOVC4A6PkKBiZm__PO5=uB-7Hj=oXyKN_5eDtdbg@mail.gmail.com>
Message-ID: <CAM8Y7yCLUSV9ker3OWqENkKEFEWPoppos0k3jehWb3-8wqyPaA@mail.gmail.com>

Thanks for clearing that up!

On Mon, Oct 22, 2012 at 3:46 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

>
>
> 2012/10/22 Laurent Vauthrin <lvauthrin at gmail.com>
>
>> My questions are:
>> 1. Should we be using a channel per thread considering that we're
>> synchronizing the basicPublish call anyway?
>>
>
> Yes. Channels are just integer on the wire and a little bit of memory
> allocated on the JVM heap. They are very cheap
> for all intents and purposes and you are much more likely to max out your
> OS and hardware resources (assuming 1 channel per JVM thread) before
> you run into issues with channel objects.
>
>
>> 2. Can we just share one channel across all threads and not synchronize
>> the call to basicPublish?
>>
>
>
> No. The real issue with shared channels is that large messages will result
> in multiple protocol frames being sent
> for a single basicPublish operation. When publishing on the same channel
> from multiple threads, this may result
> in frames being delivered out of order:
>
> T1 => basicPublish => [Frame11] [Frame12] [Frame13]
> T2 => basicPublish => [Frame21] [Frame22] [Frame23]
>
> may result in the following delivery order, all on the same channel:
>
> [Frame11][Frame21][Frame12][Frame13][Frame22][Frame23]
>
> and because all frames are on the same channel, RabbitMQ won't be able to
> tell how to reconstruct your messages.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/ddb12951/attachment.htm>

From watson.timothy at gmail.com  Tue Oct 23 09:12:01 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 23 Oct 2012 09:12:01 +0100
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <CAB0ZxM7=S7ZnhkrAYhjzZURJO07KyMmfqap+gV67eTUEQvJDuA@mail.gmail.com>
References: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>
	<578609C0-3747-4EA0-9105-A1F954D27660@rabbitmq.com>
	<CAB0ZxM6iN1av-2AdBgWVdZB-bF3hrDER8651s90JoQrr5tRCaQ@mail.gmail.com>
	<F0BE6B42-22CA-4517-8858-C402166ADF37@rabbitmq.com>
	<CAB0ZxM7=S7ZnhkrAYhjzZURJO07KyMmfqap+gV67eTUEQvJDuA@mail.gmail.com>
Message-ID: <140F445C-D95D-45F5-874C-F62DB4D695B3@rabbitmq.com>

Please provide me with full details of your environments (os, version, etc) and can you please post a full transcript of all the commands and their output.

Thanks



On 22 Oct 2012, at 20:28, chetan dev <dev440 at gmail.com> wrote:

> Hi,
> 
> Yes i clustered them as given on rabbitmq clustering documentation for e.g
> on the first place both nodes are running 
> now i stopped app using rabbitmqctl stop_app then i reset that node than i clusterd that node with another using rabbitmqctl cluster rabbit at SHIKHARM
> then i started the node using rabbitmqctl start_app
> when i checked the cluster status it was showing fine then i did as i mentioned earlier 
> 
> Thanks
> 
> On Mon, Oct 22, 2012 at 7:51 PM, Tim Watson <watson.timothy at gmail.com> wrote:
> Yes but how did you cluster them on the first place? You do realise that rabbit nodes are not clustered automatically?
> 
> 
> 
> On 22 Oct 2012, at 14:17, chetan dev <dev440 at gmail.com> wrote:
> 
>> Hi,
>> 
>> Thanks for your reply i am using 2.8.6
>> here is what i am doing 
>> 1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered 
>> 2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
>> 3. now i start the node rabbit at SHIKHARM using rabbitmq-server start commnad
>> 4. and then i check cluster status it shows only one running node  
>> Cluster status of node rabbit at CHETANDEV ...
>> [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>>  {running_nodes,[rabbit at CHETANDEV]}]
>> ...done.
>> 
>> On Mon, Oct 22, 2012 at 6:39 PM, Tim Watson <tim at rabbitmq.com> wrote:
>> Works for me! ;)
>> 
>> What version(s) of rabbit are you running and can you please post the exact commands you're using to start each node, to stop one of the applications (not the node) and cluster it with the other one and then finally the command you're using to start again.
>> 
>> Cheers
>> Tim
>> 
>> On 22 Oct 2012, at 14:04, chetan dev wrote:
>> 
>> > Hi,
>> > I have two nodes clustered together , but when i stop a node using rabbbitmqctl stop command and start the broker with rabbitmq-server detached commnad
>> > now when  i see the cluster status it shows only one broker running while both of the brokers are running fine.
>> > can anybody explain this or tell me what mistake i am making?
>> >
>> > Thanks
>> >
>> >
>> >
>> > --
>> > Cheten  Dev
>> >
>> > B.Tech Final Year
>> > Dept. of Electrical Engg.
>> > IIT Delhi, New Delhi
>> > ph 8527333215
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 
>> -- 
>> Cheten  Dev 
>> 
>> B.Tech Final Year
>> Dept. of Electrical Engg.
>> IIT Delhi, New Delhi
>> ph 8527333215
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> -- 
> Cheten  Dev 
> 
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/01aa6e11/attachment.htm>

From watson.timothy at gmail.com  Tue Oct 23 09:18:22 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 23 Oct 2012 09:18:22 +0100
Subject: [rabbitmq-discuss] RabbitMQ + Messages between virtual machines
	and physical hosts on a cloud
In-Reply-To: <CAKiRAqUZZyg4bqvsGEeH8a-+wwS0m=8sC9tJJ6JUMB1T1V1eQg@mail.gmail.com>
References: <CAKiRAqUDH2Go=H-VwLj0dtdKRq7jD5wpNxspoi_LGuh9kSz5OA@mail.gmail.com>
	<CAKiRAqUZZyg4bqvsGEeH8a-+wwS0m=8sC9tJJ6JUMB1T1V1eQg@mail.gmail.com>
Message-ID: <9ACEF152-DE73-41F6-8927-DCA43DC8C2E8@rabbitmq.com>

Hi

On 22 Oct 2012, at 20:50, Desta Haileselassie Hagos <deshai-0 at student.ltu.se> wrote:

> Dear Sir/Madam,
> 
> The problem is that I am not able to send and receive messages between the Virtual machines and the physical hosts on my cloud. I want to receive full information by manipulating the VMs APIs if it is possible.
> 
> 

Ok, let's try and address one problem at a time. Are you saying that you don't know *how* to configure messaging between hosts using rabbit? If so, I would recommend reading through the tutorials on our website in the first instance, then coming back with any questions you might have.

Or are you saying that youve set up rabbit and/or deployed a messaging client application on these machines, but it is not working as expected? In that case: What are you doing to test sending messages between hosts (virtual or otherwise) - how are your rabbit nodes set up? What client(s) are you using? What version of rabbit? Which os/vsn? Can you post a transcript of the failing commands or application and/or server logs, demonstrating the errors you're encountering?


> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/5d29091c/attachment.htm>

From watson.timothy at gmail.com  Tue Oct 23 09:20:31 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 23 Oct 2012 09:20:31 +0100
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <5085AC12.5060409@rabbitmq.com>
References: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>
	<578609C0-3747-4EA0-9105-A1F954D27660@rabbitmq.com>
	<CAB0ZxM6iN1av-2AdBgWVdZB-bF3hrDER8651s90JoQrr5tRCaQ@mail.gmail.com>
	<F0BE6B42-22CA-4517-8858-C402166ADF37@rabbitmq.com>
	<CAB0ZxM7=S7ZnhkrAYhjzZURJO07KyMmfqap+gV67eTUEQvJDuA@mail.gmail.com>
	<5085AC12.5060409@rabbitmq.com>
Message-ID: <31488449-99C6-4430-807E-4657D7A9137A@rabbitmq.com>

Ah of course - sorry i missed that guys. After so recently looking at the 3.0 cluster commands I'd forgotten that the choice of disk/ram was done that way in 2.8.x. 

On 22 Oct 2012, at 21:26, Matthias Radestock <matthias at rabbitmq.com> wrote:

> On 22/10/12 20:28, chetan dev wrote:
>>>    here is what i am doing
>>>    1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered
> 
> yes, but...
> 
>>> i clustered them as given on rabbitmq clustering documentation for e.g
>>> on the first place both nodes are running
>>> now i stopped app using rabbitmqctl stop_app then i reset that node than
>>> i clusterd that node with another using rabbitmqctl cluster rabbit at SHIKHARM
>>> then i started the node using rabbitmqctl start_app
>>> when i checked the cluster status it was showing fine then i did as i
>>> mentioned earlier
> 
> That will make rabbit at CHETANDEV a *ram* node. To make both nodes disk nodes the node itself would have to be mentioned in the cluster command too, i.e. 'rabbitmqctl cluster rabbit at SHIKHAR rabbit at CHETANDEV'.
> 
>>>    2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
>>>    3. now i start the node rabbit at SHIKHARM using rabbitmq-server
>>>    start commnad
> 
> You have just stopped and restarted the clusters' only disk node. Rabbit clusters won't function properly if they have only ram nodes.
> 
>>>    4. and then i check cluster status it shows only one running node
>>>    Cluster status of node rabbit at CHETANDEV ...
>>>    [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>>>     {running_nodes,[rabbit at CHETANDEV]}]
>>>    ...done.
> 
> Try running that command against rabbit at SHIKHARM. I suspect it will tell you that it only knows about itself.
> 
> Anyway, I suggest you change your cluster configuration s.t. both nodes are disk nodes.
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.justin at gmx.net  Tue Oct 23 09:27:40 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Tue, 23 Oct 2012 10:27:40 +0200
Subject: [rabbitmq-discuss] STOMP plugin - durable subscription
	limitation
In-Reply-To: <50851696.4040200@rabbitmq.com>
References: <k5p9o9$kqi$1@ger.gmane.org> <50815415.8090308@rabbitmq.com>
	<k60bua$dam$1@ger.gmane.org> <50851696.4040200@rabbitmq.com>
Message-ID: <k65kdv$jok$1@ger.gmane.org>

Am 22.10.2012 11:49, Emile Joubert wrote:> Hi Michael,
 >
 > On 21/10/12 09:32, Michael Justin wrote:
 >> So I understand with the frames shown, the clients would use the same
 >> shared queue.
 >>
 >> Does this mean that all waiting messages in the topic will be
 >> distributed between the two clients because of the identical
 >> subscription ID x destination?
 >
 > Yes, this is correct. Both clients will be consuming from the same queue
 > and messages will be distributed between them. You can use the prefetch
 > header to control the distribution:
 >
 > http://www.rabbitmq.com/stomp.html#pear.p

This is interesting - so the behavior of the broker is not undefined, 
and clients could implement load balancing with durable subscribers if 
they all use the same subscription ID (instead of using STOMP queues), 
is this correct (just curious)?

-- 
Michael Justin


From watson.timothy at gmail.com  Tue Oct 23 09:33:26 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 23 Oct 2012 09:33:26 +0100
Subject: [rabbitmq-discuss] nodename variable and mnesia directory
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD79038A85DDCE1@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD79038A85DD645@vmexchange02.seegrid.local>
	<5081830F.70706@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038A85DD854@vmexchange02.seegrid.local>
	<FBF9C5AB-BB8E-43CE-BC14-A8BD7A462BC8@rabbitmq.com>
	<66519775-BEBD-4EA9-9A80-361D16CBE81D@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038A85DDCE1@vmexchange02.seegrid.local>
Message-ID: <1EDE5727-72BE-4384-A943-9F79DDB75819@rabbitmq.com>

Hi

On 22 Oct 2012, at 23:14, Elizabeth Liao <eliao at seegrid.com> wrote:

> Hi,
> 
> This is what I tried
> * I start running rabbit with no NODENAME set and entered the following commands
>  * rabbitmqctl stop
>  * /etc/init.d/rabbitmq-server stop
>  * epmd -kill ( Is this correct? I didn't see a restart in the documentation )

That is correct.

>  * In /etc/hosts changed line from 127.0.1.1 <oldhostname> <oldhostname>.localdomain -> 127.0.1.1 <newhostname> <newhostname>.localdomain
>  * in /etc/sysconfig/network changed HOSTNAME=<oldhostname> -> HOSTNAME=<newhostname>
>  * /bin/hostname <newhostname>

At this point I found I needed to log out and back in again, though that was on centos an I'm not sure it's necessary to restart a profile on all operating systems. What os are you running an what does the documentation state about hostname changes? Do you, for example, have to restart the os networking sub system?

> * /etc/init.d/rabbitmq-server start
> 
> The error I get is this:
> Activating RabbitMQ plugins ...
> 3 plugins activated:
> * amqp_client-2.8.6
> * erlando-2.8.6
> * rabbitmq_shovel-2.8.6
> 
> ERROR: epmd error for host "<oldhostname>": nxdomain (non-existing domain)
> 
> 
> 
> ________________________________________
> From: Tim Watson [tim at rabbitmq.com]
> Sent: Monday, October 22, 2012 6:41 AM
> To: Discussions about RabbitMQ
> Cc: Elizabeth Liao
> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
> 
> Hi again,
> 
> On 20 Oct 2012, at 10:52, Tim Watson wrote:
> 
>> Hi Liz,
>> 
>> Sorry i wasn't aware of the context. What Ian recommended should not be necessary, though I'll follow up with him on Monday to try and figure out why he needed to do that.
>> 
>> Once you change the hostname you,ll possibly need to restart epmd and restart your rabbit, but you shouldn't need to change the node name from say rabbit to hare.
>> 
> 
> Were you able to try this again (changing only the host name but not the node name) and did it work for you? If not I'd like to know so we can investigate.
> 
> Cheers
> Tim
> 
>> Cheers
>> Tim
>> 
>> 
>> 
>> On 19 Oct 2012, at 19:44, Elizabeth Liao <eliao at seegrid.com> wrote:
>> 
>>> Hi Tim,
>>> 
>>> I'm going to back up a bit because it seems that I've misunderstood something previously.
>>> 
>>>> The first thing I'm going to say is that this isn't really a desirable
>>> state of affairs. Why do you need to change NODENAME at all, just
>>> because the host name has changed? This seems like an odd step to me -
>>> can you explain the rationale behind it?
>>> 
>>> I had an earlier problem changing the hostname and restarting the rabbitmq-server. The proposed fix was to add the NODENAME variable which I'm guessing was not right? :
>>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021435.html
>>> 
>>>> Can you explain a bit more about this 'bug' please? What exactly is
>>> going wrong?
>>> 
>>> The bug is on our end where the NODENAME is set to an empty string. Of course this is moot if NODENAME doesn't even have to be set in the first place.
>>> 
>>> Liz
>>> ________________________________________
>>> From: Tim Watson [tim at rabbitmq.com]
>>> Sent: Friday, October 19, 2012 12:48 PM
>>> To: Discussions about RabbitMQ
>>> Cc: Elizabeth Liao
>>> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
>>> 
>>> Hi
>>> 
>>> On 10/19/2012 03:41 PM, Elizabeth Liao wrote:
>>>> Hi,
>>>> 
>>>> We are currently running rabbitmq on a system where there is a need to change the hostname occasionally.  Right now, when the hostname is changed, we also update the NODENAME variable in the rabbitmq-env.conf file.
>>> 
>>> The first thing I'm going to say is that this isn't really a desirable
>>> state of affairs. Why do you need to change NODENAME at all, just
>>> because the host name has changed? This seems like an odd step to me -
>>> can you explain the rationale behind it?
>>> 
>>>> The problem we're having right now is that due to a bug when setting up the rabbitmq-env.conf file, sometimes the NODENAME variable exists but is not set to anything ( NODENAME=) so rabbit never successfully starts up.  Even after setting the NODENAME variable to the hostname, rabbit still doesn't start up properly.
>>> 
>>> Can you explain a bit more about this 'bug' please? What exactly is
>>> going wrong?
>>> 
>>>> The only way that I could find to recover from this situation without killing the erlang process, was to also set a MNESIA_DIR variable. After I did that, once the NODENAME was set to the correct hostname, rabbit started up properly.
>>> 
>>> Now this makes no sense at all to me. If you are trying to recover
>>> 'without killing the erlang process' then how are you planning on
>>> changing the NODENAME? Once an erlang node has become part of a
>>> distributed system, you cannot arbitrarily change the node's name
>>> without restarting the net_kernel AFAIK so I can't see how this is even
>>> possible. Also, because you're stating that 'rabbit started up properly'
>>> I'm assuming that you have in fact taken the node offline (using
>>> `rabbitmqctl stop` or one of the various service scripts that invokes
>>> it) and that you are now starting the node again. The rabbit startup
>>> scripts (and associated infrastructure) is not set up to handle changing
>>> the name of a node post-installation in this manner, so I would not
>>> expect this to work smoothly.
>>> 
>>>> A couple of questions:
>>>> Is this the proper way to fix the situation?
>>> 
>>> No. As I said a moment ago, rabbit is not set up for this kind of
>>> scenario so I'd be very cautious about doing this and would really
>>> recommend against it.
>>> 
>>>> Will this have unintended consequences?
>>> 
>>> I have no idea, but it is entirely possible that various things could
>>> break in obscure and alarming ways. I really would not do this if I were
>>> you.
>>> 
>>>> We are running rabbitmq-server-2.8.6 and erlang-R15B.
>>>> 
>>>> Thanks!
>>> 
>>> Liz. I would like to help you find a safe work-around so that you can
>>> use rabbit in your environment. I would really like to understand why
>>> the changing of a machine's host-name is causing problems for you. I
>>> fully realise that after changing the hostname, it is possible that a
>>> restart may be required (although I'd have to do some research to verify
>>> whether or not this is a hard requirement). But I cannot understand why
>>> a change to the machine's host name requires changing the rabbit
>>> NODENAME at all, unless you've altered the rabbit start scripts to use
>>> 'longnames' configuration (i.e., including the complete host name in the
>>> node name) in which case, a simple solution to your problem might be to
>>> switch back to using 'shortnames'. If erlang is started using -sname
>>> rabbit@`hostname -s` and your /etc/hosts configuration supports
>>> resolving the machine's IP to the short version of the name, then
>>> changing the hostname shouldn't cause all of these headaches.
>>> 
>>> For example, if I launch rabbit with something like this:
>>> 
>>> env RABBITMQ_NODENAME=rabbit RABBITMQ_NODE_PORT=5672
>>> RABBITMQ_LOG_BASE="/tmp"
>>> RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia"
>>> RABBITMQ_PID_FILE="/tmp/rabbitmq-rabbit.pid"
>>> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch"
>>> RABBITMQ_ENABLED_PLUGINS_FILE="/tmp/enabled-plugins"
>>> RABBITMQ_CONFIG_FILE="/tmp/etc/rabbit" ./scripts/rabbitmq-server
>>> 
>>> Then change the hostname, then stop rabbit and start it again,
>>> everything is fine.
>>> 
>>> Cheers,
>>> Tim
>>> 
>>>> Liz
>>>> Email Confidentiality Notice
>>>> 
>>>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> Email Confidentiality Notice
>>> 
>>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> Email Confidentiality Notice
> 
> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From watson.timothy at gmail.com  Tue Oct 23 09:38:50 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 23 Oct 2012 09:38:50 +0100
Subject: [rabbitmq-discuss] Memory leak caused by error_logger in 2.8.6?
In-Reply-To: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>
References: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>
Message-ID: <8A746A1E-A89E-420F-BA54-9D27B0E4AE5F@rabbitmq.com>

How log does the situation last when this happens? Can you post the logs 'after' the memory goes up unexpectedly - is there any larger terms in there?



On 23 Oct 2012, at 00:05, Travis <hcoyote at ghostar.org> wrote:

> Hello,
> 
> We're seeing large amounts of memory being used in some of our single
> instance 2.8.6 rabbitmq.  When we do a memory
> dump, the output appears to say that error_logger is taking up
> hundreds of megabytes.  For example:
> 
> [{{memory,847631144},
>  <4865.6.0>,
>  [{registered_name,error_logger},
>   {current_function,{gen_event,fetch_msg,5}},
>   {initial_call,{proc_lib,init_p,5}},
>   {status,waiting},
>   {message_queue_len,0},
>   {messages,[]},
>   {links,[<4865.0.0>,<4865.30.0>]},
>   {dictionary,
>    [{{xtype_to_module,topic},rabbit_exchange_type_topic},
>     {'$ancestors',[<4865.2.0>]},
>     {'$initial_call',{gen_event,init_it,6}},
>     {guid,{{36630272,1263673450,3038695659,1008081001},3102285}}]},
>   {trap_exit,true},
>   {error_handler,error_handler},
>   {priority,normal},
>   {group_leader,<4865.30.0>},
>   {total_heap_size,105953765},
>   {heap_size,12538050},
>   {stack_size,8},
>   {reductions,3561515316},
>   {garbage_collection,
>    [{min_bin_vheap_size,46368},
>     {min_heap_size,233},
>     {fullsweep_after,65535},
>     {minor_gcs,578}]},
>   {suspending,[]}]},
> 
> (If more of the dump is needed, I can provide)
> 
> We're a bit perplexed as to what's causing this.  There's nothing odd
> looking in the logs.  For example, we see stuff like this:
> 
> =INFO REPORT==== 22-Oct-2012::18:03:11 ===
> accepting AMQP connection <0.1339.402> (127.0.0.1:32803 -> 127.0.0.1:5672)
> 
> =WARNING REPORT==== 22-Oct-2012::18:03:11 ===
> closing AMQP connection <0.1339.402> (127.0.0.1:32803 -> 127.0.0.1:5672):
> connection_closed_abruptly
> 
> =INFO REPORT==== 22-Oct-2012::18:03:12 ===
> closing AMQP connection <0.1331.402> (127.0.0.1:32796 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:12 ===
> accepting AMQP connection <0.1347.402> (127.0.0.1:32840 -> 127.0.0.1:5672)
> 
> =WARNING REPORT==== 22-Oct-2012::18:03:13 ===
> closing AMQP connection <0.1347.402> (127.0.0.1:32840 -> 127.0.0.1:5672):
> connection_closed_abruptly
> 
> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
> closing AMQP connection <0.32496.401> (127.0.0.1:57108 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
> closing AMQP connection <0.32476.401> (127.0.0.1:57104 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
> closing AMQP connection <0.32492.401> (127.0.0.1:57107 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
> closing AMQP connection <0.32468.401> (127.0.0.1:57103 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:14 ===
> accepting AMQP connection <0.1355.402> (127.0.0.1:32875 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:14 ===
> closing AMQP connection <0.1355.402> (127.0.0.1:32875 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
> accepting AMQP connection <0.1363.402> (127.0.0.1:32898 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
> accepting AMQP connection <0.1371.402> (127.0.0.1:32899 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
> closing AMQP connection <0.1371.402> (127.0.0.1:32899 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
> closing AMQP connection <0.32484.401> (127.0.0.1:57106 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
> closing AMQP connection <0.32452.401> (127.0.0.1:57081 -> 127.0.0.1:5672)
> 
> =WARNING REPORT==== 22-Oct-2012::18:03:15 ===
> closing AMQP connection <0.1363.402> (127.0.0.1:32898 -> 127.0.0.1:5672):
> connection_closed_abruptly
> 
> 
> Is there a way to tell what's really going on with the error_logger
> and if we're really generating so many messages that it's causing
> memory to balloon so much?
> 
> Travis
> 
> -- 
> Travis Campbell
> travis at ghostar.org
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From watson.timothy at gmail.com  Tue Oct 23 09:40:46 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 23 Oct 2012 09:40:46 +0100
Subject: [rabbitmq-discuss] RabbitMQ + Messages between virtual machines
	and physical hosts on a cloud
In-Reply-To: <9ACEF152-DE73-41F6-8927-DCA43DC8C2E8@rabbitmq.com>
References: <CAKiRAqUDH2Go=H-VwLj0dtdKRq7jD5wpNxspoi_LGuh9kSz5OA@mail.gmail.com>
	<CAKiRAqUZZyg4bqvsGEeH8a-+wwS0m=8sC9tJJ6JUMB1T1V1eQg@mail.gmail.com>
	<9ACEF152-DE73-41F6-8927-DCA43DC8C2E8@rabbitmq.com>
Message-ID: <84B878DB-6611-4FD8-A1AB-BDE520F6385B@rabbitmq.com>

And of course of you have set it up and it's not working, Brett's question (which I foolishly forgot to ask) is perhaps the most important one: is there any firewall between the nodes preventing traffic on the relevant ports from getting through?



On 23 Oct 2012, at 09:18, Tim Watson <watson.timothy at gmail.com> wrote:

> Hi
> 
> On 22 Oct 2012, at 20:50, Desta Haileselassie Hagos <deshai-0 at student.ltu.se> wrote:
> 
>> Dear Sir/Madam,
>> 
>> The problem is that I am not able to send and receive messages between the Virtual machines and the physical hosts on my cloud. I want to receive full information by manipulating the VMs APIs if it is possible.
>> 
>> 
> 
> Ok, let's try and address one problem at a time. Are you saying that you don't know *how* to configure messaging between hosts using rabbit? If so, I would recommend reading through the tutorials on our website in the first instance, then coming back with any questions you might have.
> 
> Or are you saying that youve set up rabbit and/or deployed a messaging client application on these machines, but it is not working as expected? In that case: What are you doing to test sending messages between hosts (virtual or otherwise) - how are your rabbit nodes set up? What client(s) are you using? What version of rabbit? Which os/vsn? Can you post a transcript of the failing commands or application and/or server logs, demonstrating the errors you're encountering?
> 
> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/bbaaf626/attachment.htm>

From watson.timothy at gmail.com  Tue Oct 23 09:42:36 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Tue, 23 Oct 2012 09:42:36 +0100
Subject: [rabbitmq-discuss] Memory leak caused by error_logger in 2.8.6?
In-Reply-To: <8A746A1E-A89E-420F-BA54-9D27B0E4AE5F@rabbitmq.com>
References: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>
	<8A746A1E-A89E-420F-BA54-9D27B0E4AE5F@rabbitmq.com>
Message-ID: <FA9367DD-D418-4E1D-BB68-8E0B1E563CBC@rabbitmq.com>

Hi - sorry typing on my phone isn't too reliable....

s/how log/how long/

On 23 Oct 2012, at 09:38, Tim Watson <watson.timothy at gmail.com> wrote:

> How log does the situation last when this happens? Can you post the logs 'after' the memory goes up unexpectedly - is there any larger terms in there?
> 
> 
> 
> On 23 Oct 2012, at 00:05, Travis <hcoyote at ghostar.org> wrote:
> 
>> Hello,
>> 
>> We're seeing large amounts of memory being used in some of our single
>> instance 2.8.6 rabbitmq.  When we do a memory
>> dump, the output appears to say that error_logger is taking up
>> hundreds of megabytes.  For example:
>> 
>> [{{memory,847631144},
>> <4865.6.0>,
>> [{registered_name,error_logger},
>>  {current_function,{gen_event,fetch_msg,5}},
>>  {initial_call,{proc_lib,init_p,5}},
>>  {status,waiting},
>>  {message_queue_len,0},
>>  {messages,[]},
>>  {links,[<4865.0.0>,<4865.30.0>]},
>>  {dictionary,
>>   [{{xtype_to_module,topic},rabbit_exchange_type_topic},
>>    {'$ancestors',[<4865.2.0>]},
>>    {'$initial_call',{gen_event,init_it,6}},
>>    {guid,{{36630272,1263673450,3038695659,1008081001},3102285}}]},
>>  {trap_exit,true},
>>  {error_handler,error_handler},
>>  {priority,normal},
>>  {group_leader,<4865.30.0>},
>>  {total_heap_size,105953765},
>>  {heap_size,12538050},
>>  {stack_size,8},
>>  {reductions,3561515316},
>>  {garbage_collection,
>>   [{min_bin_vheap_size,46368},
>>    {min_heap_size,233},
>>    {fullsweep_after,65535},
>>    {minor_gcs,578}]},
>>  {suspending,[]}]},
>> 
>> (If more of the dump is needed, I can provide)
>> 
>> We're a bit perplexed as to what's causing this.  There's nothing odd
>> looking in the logs.  For example, we see stuff like this:
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:11 ===
>> accepting AMQP connection <0.1339.402> (127.0.0.1:32803 -> 127.0.0.1:5672)
>> 
>> =WARNING REPORT==== 22-Oct-2012::18:03:11 ===
>> closing AMQP connection <0.1339.402> (127.0.0.1:32803 -> 127.0.0.1:5672):
>> connection_closed_abruptly
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:12 ===
>> closing AMQP connection <0.1331.402> (127.0.0.1:32796 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:12 ===
>> accepting AMQP connection <0.1347.402> (127.0.0.1:32840 -> 127.0.0.1:5672)
>> 
>> =WARNING REPORT==== 22-Oct-2012::18:03:13 ===
>> closing AMQP connection <0.1347.402> (127.0.0.1:32840 -> 127.0.0.1:5672):
>> connection_closed_abruptly
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
>> closing AMQP connection <0.32496.401> (127.0.0.1:57108 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
>> closing AMQP connection <0.32476.401> (127.0.0.1:57104 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
>> closing AMQP connection <0.32492.401> (127.0.0.1:57107 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
>> closing AMQP connection <0.32468.401> (127.0.0.1:57103 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:14 ===
>> accepting AMQP connection <0.1355.402> (127.0.0.1:32875 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:14 ===
>> closing AMQP connection <0.1355.402> (127.0.0.1:32875 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
>> accepting AMQP connection <0.1363.402> (127.0.0.1:32898 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
>> accepting AMQP connection <0.1371.402> (127.0.0.1:32899 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
>> closing AMQP connection <0.1371.402> (127.0.0.1:32899 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
>> closing AMQP connection <0.32484.401> (127.0.0.1:57106 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
>> closing AMQP connection <0.32452.401> (127.0.0.1:57081 -> 127.0.0.1:5672)
>> 
>> =WARNING REPORT==== 22-Oct-2012::18:03:15 ===
>> closing AMQP connection <0.1363.402> (127.0.0.1:32898 -> 127.0.0.1:5672):
>> connection_closed_abruptly
>> 
>> 
>> Is there a way to tell what's really going on with the error_logger
>> and if we're really generating so many messages that it's causing
>> memory to balloon so much?
>> 
>> Travis
>> 
>> -- 
>> Travis Campbell
>> travis at ghostar.org
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dev440 at gmail.com  Tue Oct 23 09:46:10 2012
From: dev440 at gmail.com (chetan dev)
Date: Tue, 23 Oct 2012 14:16:10 +0530
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <31488449-99C6-4430-807E-4657D7A9137A@rabbitmq.com>
References: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>
	<578609C0-3747-4EA0-9105-A1F954D27660@rabbitmq.com>
	<CAB0ZxM6iN1av-2AdBgWVdZB-bF3hrDER8651s90JoQrr5tRCaQ@mail.gmail.com>
	<F0BE6B42-22CA-4517-8858-C402166ADF37@rabbitmq.com>
	<CAB0ZxM7=S7ZnhkrAYhjzZURJO07KyMmfqap+gV67eTUEQvJDuA@mail.gmail.com>
	<5085AC12.5060409@rabbitmq.com>
	<31488449-99C6-4430-807E-4657D7A9137A@rabbitmq.com>
Message-ID: <CAB0ZxM7WUWg2Z6RRupkfOcaSwabKpGki6AN1PTLhcX5DpxJa=w@mail.gmail.com>

Hi,

Thanks you very much for this information
another problem i am facing is i have two nodes clustered lets say
rabbit at SHIKHARM(ram) and rabbit at CHETANDEV(disc)
now if i stop rabbit at SHIKHARM using rabbitmwctl stop command  and then i
stop  rabbit at CHETANDEV  using stop_app command and then reset it this way i
remove it from cluster and restart the node
now rabbit at CHETANDEV starts and works fine but when i try to start
rabbit at SHIKHARM it fails .
i think it is trying to cluster with rabbit at CHETANDEV but that node is now
not in cluster but is there a way so that i can reset rabbit at SHIKHARM and
start it normally
here is the error that i got:
node           : rabbit at SHIKHARM
app descriptor : c:/Program Files/RabbitMQ
Server/rabbitmq_server-2.8.6/sbin/../
ebin/rabbit.app
home dir       : C:\Users\Acer
config file(s) : (none)
cookie hash    : +3xbT32/GKScN3yhCcE0Ag==
log            :
C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
sasl log       :
C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl
.log
database dir   :
c:/Users/Acer/AppData/Roaming/RabbitMQ/db/rabbit at SHIKHARM-mnesi
a
erlang version : 5.9.1

-- rabbit boot start
starting file handle cache server
...done
starting worker pool
 ...done
starting database                                                     ...

BOOT FAILED
===========

Error description:
   {error,{failed_to_cluster_with,[rabbit at CHETANDEV],
                                  "Mnesia could not connect to any disc
nodes."}
}

Log files (may contain more information):
   C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
   C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl.log

Stack trace:
   [{rabbit_mnesia,init_db,3,[]},
    {rabbit_mnesia,init,0,[]},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
    {rabbit,run_boot_step,1,[]},
    {rabbit,'-start/2-lc$^0/1-0-',1,[]},
    {rabbit,start,2,[]},
    {application_master,start_it_old,4,
                        [{file,"application_master.erl"},{line,274}]}]

{"Kernel pid
terminated",application_controller,"{application_start_failure,rabb
it,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}
}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbi
t,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}
}})



Thanks





On Tue, Oct 23, 2012 at 1:50 PM, Tim Watson <watson.timothy at gmail.com>wrote:

> Ah of course - sorry i missed that guys. After so recently looking at the
> 3.0 cluster commands I'd forgotten that the choice of disk/ram was done
> that way in 2.8.x.
>
> On 22 Oct 2012, at 21:26, Matthias Radestock <matthias at rabbitmq.com>
> wrote:
>
> > On 22/10/12 20:28, chetan dev wrote:
> >>>    here is what i am doing
> >>>    1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered
> >
> > yes, but...
> >
> >>> i clustered them as given on rabbitmq clustering documentation for e.g
> >>> on the first place both nodes are running
> >>> now i stopped app using rabbitmqctl stop_app then i reset that node
> than
> >>> i clusterd that node with another using rabbitmqctl cluster
> rabbit at SHIKHARM
> >>> then i started the node using rabbitmqctl start_app
> >>> when i checked the cluster status it was showing fine then i did as i
> >>> mentioned earlier
> >
> > That will make rabbit at CHETANDEV a *ram* node. To make both nodes disk
> nodes the node itself would have to be mentioned in the cluster command
> too, i.e. 'rabbitmqctl cluster rabbit at SHIKHAR rabbit at CHETANDEV'.
> >
> >>>    2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
> >>>    3. now i start the node rabbit at SHIKHARM using rabbitmq-server
> >>>    start commnad
> >
> > You have just stopped and restarted the clusters' only disk node. Rabbit
> clusters won't function properly if they have only ram nodes.
> >
> >>>    4. and then i check cluster status it shows only one running node
> >>>    Cluster status of node rabbit at CHETANDEV ...
> >>>    [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
> >>>     {running_nodes,[rabbit at CHETANDEV]}]
> >>>    ...done.
> >
> > Try running that command against rabbit at SHIKHARM. I suspect it will
> tell you that it only knows about itself.
> >
> > Anyway, I suggest you change your cluster configuration s.t. both nodes
> are disk nodes.
> >
> > Regards,
> >
> > Matthias.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/1830ac65/attachment.htm>

From michael.justin at gmx.net  Tue Oct 23 09:48:17 2012
From: michael.justin at gmx.net (Michael Justin)
Date: Tue, 23 Oct 2012 10:48:17 +0200
Subject: [rabbitmq-discuss] STOMP 1.0 adapter escapes colon as \c (STOMP 1.1
	style)
Message-ID: <k65lkj$uhe$1@ger.gmane.org>

Hello,

a test showed that a colon in a SEND frame will be escaped STOMP 
1.1-style as \c, so this

SEND
destination:/queue/ExampleQueue
testcolon1:a:test

will be received as:

MESSAGE
destination:/queue/ExampleQueue
testcolon1:a\ctest

Is this as designed? The STOMP plugin page does not cover this escape 
mechanism, which was introduced with STOMP 1.1


I also noticed that messages with header line which contains a backslash 
seem to be dropped on the broker side:

SEND
destination:/queue/ExampleQueue
testbackslash:\x

-> the message does not appear in the Management console


Regards
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/


From emile at rabbitmq.com  Tue Oct 23 10:13:53 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 23 Oct 2012 10:13:53 +0100
Subject: [rabbitmq-discuss] How to structure Master with many slaves?
 RPC??
In-Reply-To: <1350952865620-22782.post@n5.nabble.com>
References: <1350952865620-22782.post@n5.nabble.com>
Message-ID: <50865FD1.7040305@rabbitmq.com>

Hi,

On 23/10/12 01:41, theBuckWheat wrote:
> I have a SETI-like slave pool, but I maintain the list of which slaves I want
> to send work to and which are kept idle.  The slave does the work assigned
> and prepares the response dataset to be sent back..   
> 
> Question: since I may turn on a slave to accept some work and later take
> others out of the pool dynamically, what is the best RabbitMQ queue
> topology?  RPC?

If the slaves are interchangeable and you don't care about separating
different types of work items then you only need one work queue and one
response queue. Slaves all consume from the same shared work queue and
send completed work to the shared response queue in this scenario. This
corresponds to the pattern in tutorial 2 and 6:
http://www.rabbitmq.com/tutorials/tutorial-two-python.html
http://www.rabbitmq.com/tutorials/tutorial-six-python.html


-Emile


From tim at rabbitmq.com  Tue Oct 23 10:08:28 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 23 Oct 2012 10:08:28 +0100
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <CAB0ZxM7WUWg2Z6RRupkfOcaSwabKpGki6AN1PTLhcX5DpxJa=w@mail.gmail.com>
References: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>
	<578609C0-3747-4EA0-9105-A1F954D27660@rabbitmq.com>
	<CAB0ZxM6iN1av-2AdBgWVdZB-bF3hrDER8651s90JoQrr5tRCaQ@mail.gmail.com>
	<F0BE6B42-22CA-4517-8858-C402166ADF37@rabbitmq.com>
	<CAB0ZxM7=S7ZnhkrAYhjzZURJO07KyMmfqap+gV67eTUEQvJDuA@mail.gmail.com>
	<5085AC12.5060409@rabbitmq.com>
	<31488449-99C6-4430-807E-4657D7A9137A@rabbitmq.com>
	<CAB0ZxM7WUWg2Z6RRupkfOcaSwabKpGki6AN1PTLhcX5DpxJa=w@mail.gmail.com>
Message-ID: <50865E8C.3070906@rabbitmq.com>

Don't do that - take the second node out of the cluster whilst the other 
node(s) are still running, so that they can see it leaving. See the 
clustering transcripts in http://www.rabbitmq.com/clustering.html for 
details.

On 10/23/2012 09:46 AM, chetan dev wrote:
> Hi,
>
> Thanks you very much for this information
> another problem i am facing is i have two nodes clustered lets say 
> rabbit at SHIKHARM(ram) and rabbit at CHETANDEV(disc)
> now if i stop rabbit at SHIKHARM using rabbitmwctl stop command  and then 
> i stop  rabbit at CHETANDEV  using stop_app command and then reset it 
> this way i remove it from cluster and restart the node
> now rabbit at CHETANDEV starts and works fine but when i try to start 
> rabbit at SHIKHARM it fails .
> i think it is trying to cluster with rabbit at CHETANDEV but that node is 
> now not in cluster but is there a way so that i can reset 
> rabbit at SHIKHARM and start it normally
> here is the error that i got:
> node           : rabbit at SHIKHARM
> app descriptor : c:/Program Files/RabbitMQ 
> Server/rabbitmq_server-2.8.6/sbin/../
> ebin/rabbit.app
> home dir       : C:\Users\Acer
> config file(s) : (none)
> cookie hash    : +3xbT32/GKScN3yhCcE0Ag==
> log            : 
> C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
> sasl log       : 
> C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl
> .log
> database dir   : 
> c:/Users/Acer/AppData/Roaming/RabbitMQ/db/rabbit at SHIKHARM-mnesi
> a
> erlang version : 5.9.1
>
> -- rabbit boot start
> starting file handle cache server                                     
> ...done
> starting worker pool                                                 
>  ...done
> starting database                                                     ...
>
> BOOT FAILED
> ===========
>
> Error description:
>    {error,{failed_to_cluster_with,[rabbit at CHETANDEV],
>                                   "Mnesia could not connect to any 
> disc nodes."}
> }
>
> Log files (may contain more information):
>    C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
>    C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl.log
>
> Stack trace:
>    [{rabbit_mnesia,init_db,3,[]},
>     {rabbit_mnesia,init,0,[]},
>     {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
>     {rabbit,run_boot_step,1,[]},
>     {rabbit,'-start/2-lc$^0/1-0-',1,[]},
>     {rabbit,start,2,[]},
>     {application_master,start_it_old,4,
>                         [{file,"application_master.erl"},{line,274}]}]
>
> {"Kernel pid 
> terminated",application_controller,"{application_start_failure,rabb
> it,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}
> }}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller) 
> ({application_start_failure,rabbi
> t,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}
> }})
>
>
>
> Thanks
>
>
>
>
>
> On Tue, Oct 23, 2012 at 1:50 PM, Tim Watson <watson.timothy at gmail.com 
> <mailto:watson.timothy at gmail.com>> wrote:
>
>     Ah of course - sorry i missed that guys. After so recently looking
>     at the 3.0 cluster commands I'd forgotten that the choice of
>     disk/ram was done that way in 2.8.x.
>
>     On 22 Oct 2012, at 21:26, Matthias Radestock
>     <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>
>     > On 22/10/12 20:28, chetan dev wrote:
>     >>>    here is what i am doing
>     >>>    1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered
>     >
>     > yes, but...
>     >
>     >>> i clustered them as given on rabbitmq clustering documentation
>     for e.g
>     >>> on the first place both nodes are running
>     >>> now i stopped app using rabbitmqctl stop_app then i reset that
>     node than
>     >>> i clusterd that node with another using rabbitmqctl cluster
>     rabbit at SHIKHARM
>     >>> then i started the node using rabbitmqctl start_app
>     >>> when i checked the cluster status it was showing fine then i
>     did as i
>     >>> mentioned earlier
>     >
>     > That will make rabbit at CHETANDEV a *ram* node. To make both nodes
>     disk nodes the node itself would have to be mentioned in the
>     cluster command too, i.e. 'rabbitmqctl cluster rabbit at SHIKHAR
>     rabbit at CHETANDEV'.
>     >
>     >>>    2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop
>     commnad
>     >>>    3. now i start the node rabbit at SHIKHARM using rabbitmq-server
>     >>>    start commnad
>     >
>     > You have just stopped and restarted the clusters' only disk
>     node. Rabbit clusters won't function properly if they have only
>     ram nodes.
>     >
>     >>>    4. and then i check cluster status it shows only one
>     running node
>     >>>    Cluster status of node rabbit at CHETANDEV ...
>     >>>    [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>     >>>     {running_nodes,[rabbit at CHETANDEV]}]
>     >>>    ...done.
>     >
>     > Try running that command against rabbit at SHIKHARM. I suspect it
>     will tell you that it only knows about itself.
>     >
>     > Anyway, I suggest you change your cluster configuration s.t.
>     both nodes are disk nodes.
>     >
>     > Regards,
>     >
>     > Matthias.
>     > _______________________________________________
>     > rabbitmq-discuss mailing list
>     > rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> -- 
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/7ad3d6e3/attachment.htm>

From simon at rabbitmq.com  Tue Oct 23 10:18:52 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 23 Oct 2012 10:18:52 +0100
Subject: [rabbitmq-discuss] Memory leak caused by error_logger in 2.8.6?
In-Reply-To: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>
References: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>
Message-ID: <508660FC.8020706@rabbitmq.com>

On 23/10/12 00:05, Travis wrote:
>     {total_heap_size,105953765},
>     {heap_size,12538050},

> Is there a way to tell what's really going on with the error_logger
> and if we're really generating so many messages that it's causing
> memory to balloon so much?

Hmm.

Looks like it is progressing too slowly towards GC; what happens if you 
GC it manually?

We are considering adding some background process that will GC the 
biggest process every so often, since it seems to be possible to end up 
with processes that consume a lot of memory but haven't chalked up 
enough reductions to get GCed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From dev440 at gmail.com  Tue Oct 23 10:21:15 2012
From: dev440 at gmail.com (chetan dev)
Date: Tue, 23 Oct 2012 14:51:15 +0530
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <50865E8C.3070906@rabbitmq.com>
References: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>
	<578609C0-3747-4EA0-9105-A1F954D27660@rabbitmq.com>
	<CAB0ZxM6iN1av-2AdBgWVdZB-bF3hrDER8651s90JoQrr5tRCaQ@mail.gmail.com>
	<F0BE6B42-22CA-4517-8858-C402166ADF37@rabbitmq.com>
	<CAB0ZxM7=S7ZnhkrAYhjzZURJO07KyMmfqap+gV67eTUEQvJDuA@mail.gmail.com>
	<5085AC12.5060409@rabbitmq.com>
	<31488449-99C6-4430-807E-4657D7A9137A@rabbitmq.com>
	<CAB0ZxM7WUWg2Z6RRupkfOcaSwabKpGki6AN1PTLhcX5DpxJa=w@mail.gmail.com>
	<50865E8C.3070906@rabbitmq.com>
Message-ID: <CAB0ZxM5xb-dPXybW4wq0V+6cG1y2MEznbzue-1gCFHFy5ZTU_w@mail.gmail.com>

Yes , but now the node is failing to start because it is not able to find
other node for clustering
so how do i reset this node to run it normally?

Thanks

On Tue, Oct 23, 2012 at 2:38 PM, Tim Watson <tim at rabbitmq.com> wrote:

>  Don't do that - take the second node out of the cluster whilst the other
> node(s) are still running, so that they can see it leaving. See the
> clustering transcripts in http://www.rabbitmq.com/clustering.html for
> details.
>
>
> On 10/23/2012 09:46 AM, chetan dev wrote:
>
> Hi,
>
>  Thanks you very much for this information
> another problem i am facing is i have two nodes clustered lets say
> rabbit at SHIKHARM(ram) and rabbit at CHETANDEV(disc)
> now if i stop rabbit at SHIKHARM using rabbitmwctl stop command  and then i
> stop  rabbit at CHETANDEV  using stop_app command and then reset it this way
> i remove it from cluster and restart the node
> now rabbit at CHETANDEV starts and works fine but when i try to start
> rabbit at SHIKHARM it fails .
> i think it is trying to cluster with rabbit at CHETANDEV but that node is
> now not in cluster but is there a way so that i can reset rabbit at SHIKHARMand start it normally
> here is the error that i got:
>  node           : rabbit at SHIKHARM
> app descriptor : c:/Program Files/RabbitMQ
> Server/rabbitmq_server-2.8.6/sbin/../
> ebin/rabbit.app
> home dir       : C:\Users\Acer
> config file(s) : (none)
> cookie hash    : +3xbT32/GKScN3yhCcE0Ag==
> log            :
> C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
> sasl log       :
> C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl
> .log
> database dir   :
> c:/Users/Acer/AppData/Roaming/RabbitMQ/db/rabbit at SHIKHARM-mnesi
> a
> erlang version : 5.9.1
>
>  -- rabbit boot start
> starting file handle cache server
> ...done
> starting worker pool
>  ...done
> starting database                                                     ...
>
>  BOOT FAILED
> ===========
>
>  Error description:
>    {error,{failed_to_cluster_with,[rabbit at CHETANDEV],
>                                   "Mnesia could not connect to any disc
> nodes."}
> }
>
>  Log files (may contain more information):
>    C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
>    C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl.log
>
>  Stack trace:
>    [{rabbit_mnesia,init_db,3,[]},
>     {rabbit_mnesia,init,0,[]},
>     {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
>     {rabbit,run_boot_step,1,[]},
>     {rabbit,'-start/2-lc$^0/1-0-',1,[]},
>     {rabbit,start,2,[]},
>     {application_master,start_it_old,4,
>                         [{file,"application_master.erl"},{line,274}]}]
>
>  {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabb
>
> it,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}
> }}}"}
>
>  Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbi
>
> t,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}
> }})
>
>
>
>  Thanks
>
>
>
>
>
> On Tue, Oct 23, 2012 at 1:50 PM, Tim Watson <watson.timothy at gmail.com>wrote:
>
>> Ah of course - sorry i missed that guys. After so recently looking at the
>> 3.0 cluster commands I'd forgotten that the choice of disk/ram was done
>> that way in 2.8.x.
>>
>> On 22 Oct 2012, at 21:26, Matthias Radestock <matthias at rabbitmq.com>
>> wrote:
>>
>> > On 22/10/12 20:28, chetan dev wrote:
>> >>>    here is what i am doing
>> >>>    1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered
>> >
>> > yes, but...
>> >
>> >>> i clustered them as given on rabbitmq clustering documentation for e.g
>> >>> on the first place both nodes are running
>> >>> now i stopped app using rabbitmqctl stop_app then i reset that node
>> than
>> >>> i clusterd that node with another using rabbitmqctl cluster
>> rabbit at SHIKHARM
>> >>> then i started the node using rabbitmqctl start_app
>> >>> when i checked the cluster status it was showing fine then i did as i
>> >>> mentioned earlier
>> >
>> > That will make rabbit at CHETANDEV a *ram* node. To make both nodes disk
>> nodes the node itself would have to be mentioned in the cluster command
>> too, i.e. 'rabbitmqctl cluster rabbit at SHIKHAR rabbit at CHETANDEV'.
>> >
>> >>>    2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
>> >>>    3. now i start the node rabbit at SHIKHARM using rabbitmq-server
>> >>>    start commnad
>> >
>> > You have just stopped and restarted the clusters' only disk node.
>> Rabbit clusters won't function properly if they have only ram nodes.
>> >
>> >>>    4. and then i check cluster status it shows only one running node
>> >>>    Cluster status of node rabbit at CHETANDEV ...
>> >>>    [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>> >>>     {running_nodes,[rabbit at CHETANDEV]}]
>> >>>    ...done.
>> >
>> > Try running that command against rabbit at SHIKHARM. I suspect it will
>> tell you that it only knows about itself.
>> >
>> > Anyway, I suggest you change your cluster configuration s.t. both nodes
>> are disk nodes.
>> >
>> > Regards,
>> >
>> > Matthias.
>>   > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
>  --
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>


-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/51afb9ec/attachment.htm>

From simon at rabbitmq.com  Tue Oct 23 10:28:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 23 Oct 2012 10:28:58 +0100
Subject: [rabbitmq-discuss] Upgrading RabbitMQ2.8.6
In-Reply-To: <CAFX3A=1HJW68iyzJNE15QxwUyP-HG=QcC711ueWV68-JahxwsQ@mail.gmail.com>
References: <CANPBPZnfRu8+yEzZd9UXuhZa-4evcOVnnURFvhN24uHiGSFKjQ@mail.gmail.com>
	<50810FB1.5060001@rabbitmq.com>
	<CANPBPZkAzpKHe7F8fzkZ_qPP0pmEO=Y46D81X3kDoXvAbEadTA@mail.gmail.com>
	<CANPBPZmBWZivfFmcNB1x8qVK7WfR-1ThPSeozCDk+Z6SA2b_og@mail.gmail.com>
	<50811BFD.3040207@rabbitmq.com>
	<CANPBPZnVFQbwpYt1jqCZ6=dC07t=1F0mhQWZUKQpWXUpiucUQw@mail.gmail.com>
	<50852C39.8040704@rabbitmq.com>
	<CAFX3A=1HJW68iyzJNE15QxwUyP-HG=QcC711ueWV68-JahxwsQ@mail.gmail.com>
Message-ID: <5086635A.3000407@rabbitmq.com>

Somewhat on purpose - due to the vagaries of our build system, we treat 
the apt repository as just another build artefact, so it gets created 
from scratch each time. I know this is not ideal.

If you want to pin to a particular version you will need to download the 
deb directly.

Cheers, Simon

On 22/10/12 17:07, Matt Long wrote:
> While we're on the topic of older versions, it appears they are removed
> from the RabbitMQ APT repository; only the newest version is ever
> available. Is this done on purpose? It has led to some issues for us
> since we specify explicit package versions in our provisioning system
> and occasionally they'll no longer be there!
>
> Thanks,
> Matt
>
> On Mon, Oct 22, 2012 at 4:21 AM, Matthias Radestock
> <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>
>     On 19/10/12 10:24, PSL 88506 wrote:
>
>         When i try to understand about installation procedure for 2.8.6
>
>         All links are getting redirected to same page with following URL:
>         http://www.rabbitmq.com/__download.html
>         <http://www.rabbitmq.com/download.html>
>
>
>     Links will always point to the latest version, which is 2.8.7. I
>     recommend you install that rather than 2.8.6. If you really must
>     install 2.8.6, follow the "Older Versions / Download" link on the
>     download.html page.
>
>
>     Regards,
>
>     Matthias.
>     _________________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.__rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>
> --
> Matt Long
> Cofounder and Lead Developer
> crocodoc.com <http://crocodoc.com/>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From tim at rabbitmq.com  Tue Oct 23 10:31:32 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 23 Oct 2012 10:31:32 +0100
Subject: [rabbitmq-discuss] Clustering
In-Reply-To: <CAB0ZxM5xb-dPXybW4wq0V+6cG1y2MEznbzue-1gCFHFy5ZTU_w@mail.gmail.com>
References: <CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg@mail.gmail.com>
	<578609C0-3747-4EA0-9105-A1F954D27660@rabbitmq.com>
	<CAB0ZxM6iN1av-2AdBgWVdZB-bF3hrDER8651s90JoQrr5tRCaQ@mail.gmail.com>
	<F0BE6B42-22CA-4517-8858-C402166ADF37@rabbitmq.com>
	<CAB0ZxM7=S7ZnhkrAYhjzZURJO07KyMmfqap+gV67eTUEQvJDuA@mail.gmail.com>
	<5085AC12.5060409@rabbitmq.com>
	<31488449-99C6-4430-807E-4657D7A9137A@rabbitmq.com>
	<CAB0ZxM7WUWg2Z6RRupkfOcaSwabKpGki6AN1PTLhcX5DpxJa=w@mail.gmail.com>
	<50865E8C.3070906@rabbitmq.com>
	<CAB0ZxM5xb-dPXybW4wq0V+6cG1y2MEznbzue-1gCFHFy5ZTU_w@mail.gmail.com>
Message-ID: <508663F4.3040507@rabbitmq.com>

Post me the *exact* commands you're using on each node, in sequence 
please. If you follow the 'Breaking up a cluster' transcript from 
http://www.rabbitmq.com/clustering.html then you should not have *any* 
problems. In particular, note the use of 'force_reset' on the surviving 
node, so that it does not attempt to connect to nodes that are no longer 
part of the cluster - who's residual configuration is still present on 
the extant node we're now resetting.

On 10/23/2012 10:21 AM, chetan dev wrote:
> Yes , but now the node is failing to start because it is not able to 
> find other node for clustering
> so how do i reset this node to run it normally?
>
> Thanks
>
> On Tue, Oct 23, 2012 at 2:38 PM, Tim Watson <tim at rabbitmq.com 
> <mailto:tim at rabbitmq.com>> wrote:
>
>     Don't do that - take the second node out of the cluster whilst the
>     other node(s) are still running, so that they can see it leaving.
>     See the clustering transcripts in
>     http://www.rabbitmq.com/clustering.html for details.
>
>
>     On 10/23/2012 09:46 AM, chetan dev wrote:
>>     Hi,
>>
>>     Thanks you very much for this information
>>     another problem i am facing is i have two nodes clustered lets
>>     say rabbit at SHIKHARM(ram) and rabbit at CHETANDEV(disc)
>>     now if i stop rabbit at SHIKHARM using rabbitmwctl stop command  and
>>     then i stop  rabbit at CHETANDEV  using stop_app command and then
>>     reset it this way i remove it from cluster and restart the node
>>     now rabbit at CHETANDEV starts and works fine but when i try to
>>     start rabbit at SHIKHARM it fails .
>>     i think it is trying to cluster with rabbit at CHETANDEV but that
>>     node is now not in cluster but is there a way so that i can reset
>>     rabbit at SHIKHARM and start it normally
>>     here is the error that i got:
>>     node           : rabbit at SHIKHARM
>>     app descriptor : c:/Program Files/RabbitMQ
>>     Server/rabbitmq_server-2.8.6/sbin/../
>>     ebin/rabbit.app
>>     home dir       : C:\Users\Acer
>>     config file(s) : (none)
>>     cookie hash    : +3xbT32/GKScN3yhCcE0Ag==
>>     log            :
>>     C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
>>     <mailto:C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log>
>>     sasl log       :
>>     C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl
>>     .log
>>     database dir   :
>>     c:/Users/Acer/AppData/Roaming/RabbitMQ/db/rabbit at SHIKHARM-mnesi
>>     a
>>     erlang version : 5.9.1
>>
>>     -- rabbit boot start
>>     starting file handle cache server                                
>>         ...done
>>     starting worker pool                                            
>>          ...done
>>     starting database                                                
>>         ...
>>
>>     BOOT FAILED
>>     ===========
>>
>>     Error description:
>>        {error,{failed_to_cluster_with,[rabbit at CHETANDEV],
>>                                       "Mnesia could not connect to
>>     any disc nodes."}
>>     }
>>
>>     Log files (may contain more information):
>>     C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
>>     <mailto:C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log>
>>     C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl.log
>>     <mailto:C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl.log>
>>
>>     Stack trace:
>>        [{rabbit_mnesia,init_db,3,[]},
>>         {rabbit_mnesia,init,0,[]},
>>         {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
>>         {rabbit,run_boot_step,1,[]},
>>         {rabbit,'-start/2-lc$^0/1-0-',1,[]},
>>         {rabbit,start,2,[]},
>>         {application_master,start_it_old,4,
>>                            
>>     [{file,"application_master.erl"},{line,274}]}]
>>
>>     {"Kernel pid
>>     terminated",application_controller,"{application_start_failure,rabb
>>     it,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}
>>     }}}"}
>>
>>     Crash dump was written to: erl_crash.dump
>>     Kernel pid terminated (application_controller)
>>     ({application_start_failure,rabbi
>>     t,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}
>>     }})
>>
>>
>>
>>     Thanks
>>
>>
>>
>>
>>
>>     On Tue, Oct 23, 2012 at 1:50 PM, Tim Watson
>>     <watson.timothy at gmail.com <mailto:watson.timothy at gmail.com>> wrote:
>>
>>         Ah of course - sorry i missed that guys. After so recently
>>         looking at the 3.0 cluster commands I'd forgotten that the
>>         choice of disk/ram was done that way in 2.8.x.
>>
>>         On 22 Oct 2012, at 21:26, Matthias Radestock
>>         <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>>
>>         > On 22/10/12 20:28, chetan dev wrote:
>>         >>>    here is what i am doing
>>         >>>    1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are
>>         clustered
>>         >
>>         > yes, but...
>>         >
>>         >>> i clustered them as given on rabbitmq clustering
>>         documentation for e.g
>>         >>> on the first place both nodes are running
>>         >>> now i stopped app using rabbitmqctl stop_app then i reset
>>         that node than
>>         >>> i clusterd that node with another using rabbitmqctl
>>         cluster rabbit at SHIKHARM
>>         >>> then i started the node using rabbitmqctl start_app
>>         >>> when i checked the cluster status it was showing fine
>>         then i did as i
>>         >>> mentioned earlier
>>         >
>>         > That will make rabbit at CHETANDEV a *ram* node. To make both
>>         nodes disk nodes the node itself would have to be mentioned
>>         in the cluster command too, i.e. 'rabbitmqctl cluster
>>         rabbit at SHIKHAR rabbit at CHETANDEV'.
>>         >
>>         >>>    2. now i stop node rabbit at SHIKHARM using  rabbitmqctl
>>         stop commnad
>>         >>>    3. now i start the node rabbit at SHIKHARM using
>>         rabbitmq-server
>>         >>>    start commnad
>>         >
>>         > You have just stopped and restarted the clusters' only disk
>>         node. Rabbit clusters won't function properly if they have
>>         only ram nodes.
>>         >
>>         >>>    4. and then i check cluster status it shows only one
>>         running node
>>         >>>    Cluster status of node rabbit at CHETANDEV ...
>>         >>>  
>>          [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>>         >>>     {running_nodes,[rabbit at CHETANDEV]}]
>>         >>>    ...done.
>>         >
>>         > Try running that command against rabbit at SHIKHARM. I suspect
>>         it will tell you that it only knows about itself.
>>         >
>>         > Anyway, I suggest you change your cluster configuration
>>         s.t. both nodes are disk nodes.
>>         >
>>         > Regards,
>>         >
>>         > Matthias.
>>         > _______________________________________________
>>         > rabbitmq-discuss mailing list
>>         > rabbitmq-discuss at lists.rabbitmq.com
>>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>         >
>>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>         _______________________________________________
>>         rabbitmq-discuss mailing list
>>         rabbitmq-discuss at lists.rabbitmq.com
>>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>>     -- 
>>     Cheten  Dev
>>
>>     B.Tech Final Year
>>     Dept. of Electrical Engg.
>>     IIT Delhi, New Delhi
>>     ph 8527333215
>>
>>
>>
>>     _______________________________________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.rabbitmq.com  <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> -- 
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/27fa243d/attachment.htm>

From emile at rabbitmq.com  Tue Oct 23 11:05:50 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 23 Oct 2012 11:05:50 +0100
Subject: [rabbitmq-discuss] STOMP 1.0 adapter escapes colon as \c (STOMP
 1.1 style)
In-Reply-To: <k65lkj$uhe$1@ger.gmane.org>
References: <k65lkj$uhe$1@ger.gmane.org>
Message-ID: <50866BFE.9060605@rabbitmq.com>


Hi Michael,

On 23/10/12 09:48, Michael Justin wrote:
> Hello,
> 
> a test showed that a colon in a SEND frame will be escaped STOMP 
> 1.1-style as \c, so this
> 
> SEND
> destination:/queue/ExampleQueue
> testcolon1:a:test
> 
> will be received as:
> 
> MESSAGE
> destination:/queue/ExampleQueue
> testcolon1:a\ctest
> 
> Is this as designed? The STOMP plugin page does not cover this escape 
> mechanism, which was introduced with STOMP 1.1

The only difference in framing between 1.0 and 1.1 in the RabbitMQ STOMP
implementation at present is trimming. If the negotiated version is 1.0
then headers are trimmed. Only 1.1 frame parsing is implemented, under
the assumption that this is backwards-compatible.

Are you relying on the STOMP 1.0 behaviour w.r.t colons in header values?

> I also noticed that messages with header line which contains a backslash 
> seem to be dropped on the broker side:
> 
> SEND
> destination:/queue/ExampleQueue
> testbackslash:\x
> 
> -> the message does not appear in the Management console

This is compatible with 1.1, which says that undefined escape sequences
must be treated as a fatal protocol error.

We'd be interested in your opinion of how important strict STOMP 1.0
framing support is to help us decide whether to invest in that effort or
focus on 1.2 instead.


-Emile



From emile at rabbitmq.com  Tue Oct 23 11:18:11 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 23 Oct 2012 11:18:11 +0100
Subject: [rabbitmq-discuss] STOMP plugin - durable subscription
	limitation
In-Reply-To: <k65kdv$jok$1@ger.gmane.org>
References: <k5p9o9$kqi$1@ger.gmane.org> <50815415.8090308@rabbitmq.com>
	<k60bua$dam$1@ger.gmane.org> <50851696.4040200@rabbitmq.com>
	<k65kdv$jok$1@ger.gmane.org>
Message-ID: <50866EE3.4000409@rabbitmq.com>

On 23/10/12 09:27, Michael Justin wrote:
> This is interesting - so the behavior of the broker is not undefined, 
> and clients could implement load balancing with durable subscribers if 
> they all use the same subscription ID (instead of using STOMP queues), 
> is this correct (just curious)?

Yes, I don't see anything preventing it being used in that way.


-Emile





From tim at rabbitmq.com  Tue Oct 23 11:29:57 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 23 Oct 2012 11:29:57 +0100
Subject: [rabbitmq-discuss] Channel thread-safety
In-Reply-To: <CAM8Y7yCLUSV9ker3OWqENkKEFEWPoppos0k3jehWb3-8wqyPaA@mail.gmail.com>
References: <CAM8Y7yBqrHE8kvF38htNLnqZ3CSCGqkUQLJoaTwDK0p0qfWpoQ@mail.gmail.com>
	<CAE3HoVTr6esOVC4A6PkKBiZm__PO5=uB-7Hj=oXyKN_5eDtdbg@mail.gmail.com>
	<CAM8Y7yCLUSV9ker3OWqENkKEFEWPoppos0k3jehWb3-8wqyPaA@mail.gmail.com>
Message-ID: <508671A5.6050007@rabbitmq.com>

Actually, that's not quite right. Channels *are* thread safe in the 
java-client, and can be shared across multiple threads if you wish. As 
the Java client API documentation 
(http://www.rabbitmq.com/api-guide.html) states however:

"Channel instances are safe for use by multiple threads. Requests into a 
Channel are serialized, with only one thread being able to run a command 
on the Channel at a time. Even so, applications should prefer using a 
Channel per thread instead of sharing the same Channel across multiple 
threads."

In other words, because the transmission of AMQP commands via a given 
Channel is serialised, there is probably little or no benefit in sharing 
the channel between threads.

Unfortunately, whilst we've updated the documentation on the website to 
reflect this change (which was merged in September 2011 and released in 
2.7.0) we appear to have missed the javadocs for the Channel class - I 
will get that fixed asap so as to avoid any further confusion!

Cheers,
Tim

On 10/23/2012 02:08 AM, Laurent Vauthrin wrote:
> Thanks for clearing that up!
>
> On Mon, Oct 22, 2012 at 3:46 PM, Michael Klishin 
> <michael.s.klishin at gmail.com <mailto:michael.s.klishin at gmail.com>> wrote:
>
>
>
>     2012/10/22 Laurent Vauthrin <lvauthrin at gmail.com
>     <mailto:lvauthrin at gmail.com>>
>
>         My questions are:
>         1. Should we be using a channel per thread considering that
>         we're synchronizing the basicPublish call anyway?
>
>
>     Yes. Channels are just integer on the wire and a little bit of
>     memory allocated on the JVM heap. They are very cheap
>     for all intents and purposes and you are much more likely to max
>     out your OS and hardware resources (assuming 1 channel per JVM
>     thread) before
>     you run into issues with channel objects.
>
>         2. Can we just share one channel across all threads and not
>         synchronize the call to basicPublish?
>
>
>
>     No. The real issue with shared channels is that large messages
>     will result in multiple protocol frames being sent
>     for a single basicPublish operation. When publishing on the same
>     channel from multiple threads, this may result
>     in frames being delivered out of order:
>
>     T1 => basicPublish => [Frame11] [Frame12] [Frame13]
>     T2 => basicPublish => [Frame21] [Frame22] [Frame23]
>
>     may result in the following delivery order, all on the same channel:
>
>     [Frame11][Frame21][Frame12][Frame13][Frame22][Frame23]
>
>     and because all frames are on the same channel, RabbitMQ won't be
>     able to tell how to reconstruct your messages.
>     -- 
>     MK
>
>     http://github.com/michaelklishin
>     http://twitter.com/michaelklishin
>
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/5eefd15e/attachment.htm>

From tim at rabbitmq.com  Tue Oct 23 11:42:58 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 23 Oct 2012 11:42:58 +0100
Subject: [rabbitmq-discuss] Channel thread-safety
In-Reply-To: <508671A5.6050007@rabbitmq.com>
References: <CAM8Y7yBqrHE8kvF38htNLnqZ3CSCGqkUQLJoaTwDK0p0qfWpoQ@mail.gmail.com>
	<CAE3HoVTr6esOVC4A6PkKBiZm__PO5=uB-7Hj=oXyKN_5eDtdbg@mail.gmail.com>
	<CAM8Y7yCLUSV9ker3OWqENkKEFEWPoppos0k3jehWb3-8wqyPaA@mail.gmail.com>
	<508671A5.6050007@rabbitmq.com>
Message-ID: <508674B2.8050706@rabbitmq.com>

Important addendum: channel calls are *not* thread-safe for 
confirmations: The channel interface is thread-safe now, except for 
counting confirms and checking!

There is an outstanding bug to review this, and the problems associated 
with the fact that publishing and receiving a seqno is not an atomic 
operation.

Anyway - you *may* wish to share a Channel between threads or not, but 
if you're using confirms then you should *not* share a Channel between 
multiple threads. I'll make sure the javadoc changes reflect this state 
of affairs.

Cheers,
Tim

On 10/23/2012 11:29 AM, Tim Watson wrote:
> Actually, that's not quite right. Channels *are* thread safe in the 
> java-client, and can be shared across multiple threads if you wish. As 
> the Java client API documentation 
> (http://www.rabbitmq.com/api-guide.html) states however:
>
> "Channel instances are safe for use by multiple threads. Requests into 
> a Channel are serialized, with only one thread being able to run a 
> command on the Channel at a time. Even so, applications should prefer 
> using a Channel per thread instead of sharing the same Channel across 
> multiple threads."
>
> In other words, because the transmission of AMQP commands via a given 
> Channel is serialised, there is probably little or no benefit in 
> sharing the channel between threads.
>
> Unfortunately, whilst we've updated the documentation on the website 
> to reflect this change (which was merged in September 2011 and 
> released in 2.7.0) we appear to have missed the javadocs for the 
> Channel class - I will get that fixed asap so as to avoid any further 
> confusion!
>
> Cheers,
> Tim
>
> On 10/23/2012 02:08 AM, Laurent Vauthrin wrote:
>> Thanks for clearing that up!
>>
>> On Mon, Oct 22, 2012 at 3:46 PM, Michael Klishin 
>> <michael.s.klishin at gmail.com <mailto:michael.s.klishin at gmail.com>> wrote:
>>
>>
>>
>>     2012/10/22 Laurent Vauthrin <lvauthrin at gmail.com
>>     <mailto:lvauthrin at gmail.com>>
>>
>>         My questions are:
>>         1. Should we be using a channel per thread considering that
>>         we're synchronizing the basicPublish call anyway?
>>
>>
>>     Yes. Channels are just integer on the wire and a little bit of
>>     memory allocated on the JVM heap. They are very cheap
>>     for all intents and purposes and you are much more likely to max
>>     out your OS and hardware resources (assuming 1 channel per JVM
>>     thread) before
>>     you run into issues with channel objects.
>>
>>         2. Can we just share one channel across all threads and not
>>         synchronize the call to basicPublish?
>>
>>
>>
>>     No. The real issue with shared channels is that large messages
>>     will result in multiple protocol frames being sent
>>     for a single basicPublish operation. When publishing on the same
>>     channel from multiple threads, this may result
>>     in frames being delivered out of order:
>>
>>     T1 => basicPublish => [Frame11] [Frame12] [Frame13]
>>     T2 => basicPublish => [Frame21] [Frame22] [Frame23]
>>
>>     may result in the following delivery order, all on the same channel:
>>
>>     [Frame11][Frame21][Frame12][Frame13][Frame22][Frame23]
>>
>>     and because all frames are on the same channel, RabbitMQ won't be
>>     able to tell how to reconstruct your messages.
>>     -- 
>>     MK
>>
>>     http://github.com/michaelklishin
>>     http://twitter.com/michaelklishin
>>
>>
>>     _______________________________________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.rabbitmq.com
>>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/6b69fdfd/attachment.htm>

From tbw at rg6.org  Tue Oct 23 13:41:46 2012
From: tbw at rg6.org (theBuckWheat)
Date: Tue, 23 Oct 2012 05:41:46 -0700 (PDT)
Subject: [rabbitmq-discuss] How to structure Master with many slaves?
	RPC??
In-Reply-To: <50865FD1.7040305@rabbitmq.com>
References: <1350952865620-22782.post@n5.nabble.com>
	<50865FD1.7040305@rabbitmq.com>
Message-ID: <1350996106593-22804.post@n5.nabble.com>

I have a list of discrete tasks sitting on the master server and a (dynamic)
list of remote slaves, and I want to pick a slave from the list and send it
one of these tasks and then do the same for the remaining tasks until all
available slaves are busy.  

After some (variable) time, a slave will be finished and can send the result
file back to the master, after which it will be available to accept the next
task.  
 
So, the architecture issues with respect to using RabbitMQ are:

1) How best to structure pushing work to slaves;  At present, on the master
I keep a table of all slaves and a status flag.  If I set the status to
available, the master (based on a priority selection scheme) can pick one
off the list and push work to it.  The status is then set to 'busy'.  I can
set the status to unavailable at any time and that only removes the slave
from the list of slaves the master can push work to.  

2) How to structure fetching the finished work file?  Push or pull?  At
present, when a slave is finished, it calls the master and only sets a flag. 
Based on a priority scheme, the master will eventually pull the finished
work file from that slave, after which it marks that slave as being
available for work.

The load-balance model seems to apply, but only if I can control which slave
gets the message.  I don't want to broadcast to all slaves due to bandwidth
constraints.  As I read the various queue configurations, I understand how
each can be used, but I don't see a published one that applies to this
particular master-slave configuration because of its dynamic nature.   This
leads me to ponder the RPC model.  Am I missing something?

--tBW








--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-structure-Master-with-many-slaves-RPC-tp22782p22804.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From johnson at edocom.cn  Tue Oct 23 14:42:27 2012
From: johnson at edocom.cn (johnson)
Date: Tue, 23 Oct 2012 21:42:27 +0800
Subject: [rabbitmq-discuss] Issues about RabbitMQ Management HTTP API
References: <mailman.1.1350990001.21562.rabbitmq-discuss@lists.rabbitmq.com>
Message-ID: <201210232142260561404@edocom.cn>

Hi all,

Today I tried to use RabbitMQ Management HTTP API. I just followed the example.

curl -i -u guest:guest -H "content-type:application/json" -XPUT  -d'{"type":"direct"}'  http://198.216.26.95:55672/api/exchanges/%2f/my-new-exchange

HTTP/1.1 204 No Content
Server: MochiWeb/1.1 WebMachine/1.7 (participate in the frantic)
Date: Tue, 23 Oct 2012 13:23:32 GMT
Content-Type: application/json
Content-Length: 0

It works fine. 

However, when I write the JAVA program to do the same thing. My Java code is:

DefaultHttpClient httpclient = new DefaultHttpClient();  
httpclient.getCredentialsProvider().setCredentials(new AuthScope("198.216.26.95", 55672),new UsernamePasswordCredentials("guest", "guest"));
HttpPut httpput = new HttpPut(http://198.216.26.95:55672/api/exchanges/%2f/my-new-exchange);
httpput.addHeader("content-type", "application/json");
JSONObject param = new JSONObject();
param.put("type", "direct");
StringEntity  entity = new StringEntity(param.toString());
httpput.setEntity(entity);
HttpResponse response = httpclient.execute(httpput); 
 
It always returned the following exception.
org.apache.http.NoHttpResponseException: The target server failed to respond
at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:95)
at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:62)
at org.apache.http.impl.io.AbstractMessageParser.parse(AbstractMessageParser.java:254)
at org.apache.http.impl.AbstractHttpClientConnection.receiveResponseHeader(AbstractHttpClientConnection.java:289)
at org.apache.http.impl.conn.DefaultClientConnection.receiveResponseHeader(DefaultClientConnection.java:252)
at org.apache.http.impl.conn.ManagedClientConnectionImpl.receiveResponseHeader(ManagedClientConnectionImpl.java:191)
at org.apache.http.protocol.HttpRequestExecutor.doReceiveResponse(HttpRequestExecutor.java:300)
at org.apache.http.protocol.HttpRequestExecutor.execute(HttpRequestExecutor.java:127)
at org.apache.http.impl.client.DefaultRequestDirector.tryExecute(DefaultRequestDirector.java:712)
at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:517)
at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:906)
at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:1066)
at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:1044)
at org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:1035)


Could anyone help me about this issue?




johnson

From: rabbitmq-discuss-request
Date: 2012-10-23 19:00
To: rabbitmq-discuss
Subject: rabbitmq-discuss Digest, Vol 65, Issue 23
Send rabbitmq-discuss mailing list submissions to
rabbitmq-discuss at lists.rabbitmq.com

To subscribe or unsubscribe via the World Wide Web, visit
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
or, via email, send a message with subject or body 'help' to
rabbitmq-discuss-request at lists.rabbitmq.com

You can reach the person managing the list at
rabbitmq-discuss-owner at lists.rabbitmq.com

When replying, please edit your Subject line so it is more specific
than "Re: Contents of rabbitmq-discuss digest..."


Today's Topics:

   1. Re: intenal error when connecting from rabbitmq-c
      (Matthias Radestock)
   2. Re: Upgrading RabbitMQ2.8.6 (Matthias Radestock)
   3. Re: Rabbit Management HTTP API issue - deleted queues linger
      in API responses (Simon MacMullen)
   4. Re: PHP Client Library (Matthias Radestock)
   5. Clustering (chetan dev)
   6. Re: Clustering (Tim Watson)
   7. Re: Clustering (chetan dev)
   8. Adding slave for mirrored queue (Artsiom)
   9. Re: Clustering (Tim Watson)
  10. Re: Adding slave for mirrored queue (Tim Watson)
  11. Re: Adding slave for mirrored queue (Artsiom)
  12. Re: Adding slave for mirrored queue (Tim Watson)
  13. Re: Upgrading RabbitMQ2.8.6 (Matt Long)
  14. Re: Adding slave for mirrored queue (Simon MacMullen)
  15. Channel thread-safety (Laurent Vauthrin)
  16. Re: Clustering (chetan dev)
  17. Re: Channel thread-safety (Michael Klishin)
  18. Re: RabbitMQ + Messages between virtual machines and physical
      hosts on a cloud (Desta Haileselassie Hagos)
  19. Re: RabbitMQ + Messages between virtual machines and physical
      hosts on a cloud (Brett Cameron)
  20. Re: Clustering (Matthias Radestock)
  21. Re: {SSL upgrade error, timeout} (Dharshan Rangegowda)
  22. Re: nodename variable and mnesia directory (Elizabeth Liao)
  23. Memory leak caused by error_logger in 2.8.6? (Travis)
  24. How to structure Master with many slaves? RPC?? (theBuckWheat)
  25. Re: Channel thread-safety (Laurent Vauthrin)
  26. Re: Clustering (Tim Watson)
  27. Re: RabbitMQ + Messages between virtual machines and physical
      hosts on a cloud (Tim Watson)
  28. Re: Clustering (Tim Watson)
  29. Re: STOMP plugin - durable subscription limitation
      (Michael Justin)
  30. Re: nodename variable and mnesia directory (Tim Watson)
  31. Re: Memory leak caused by error_logger in 2.8.6? (Tim Watson)
  32. Re: RabbitMQ + Messages between virtual machines and physical
      hosts on a cloud (Tim Watson)
  33. Re: Memory leak caused by error_logger in 2.8.6? (Tim Watson)
  34. Re: Clustering (chetan dev)
  35. STOMP 1.0 adapter escapes colon as \c (STOMP 1.1 style)
      (Michael Justin)
  36. Re: How to structure Master with many slaves? RPC??
      (Emile Joubert)
  37. Re: Clustering (Tim Watson)
  38. Re: Memory leak caused by error_logger in 2.8.6? (Simon MacMullen)
  39. Re: Clustering (chetan dev)
  40. Re: Upgrading RabbitMQ2.8.6 (Simon MacMullen)
  41. Re: Clustering (Tim Watson)
  42. Re: STOMP 1.0 adapter escapes colon as \c (STOMP 1.1 style)
      (Emile Joubert)
  43. Re: STOMP plugin - durable subscription limitation (Emile Joubert)
  44. Re: Channel thread-safety (Tim Watson)
  45. Re: Channel thread-safety (Tim Watson)


----------------------------------------------------------------------

Message: 1
Date: Mon, 22 Oct 2012 12:13:31 +0100
From: Matthias Radestock <matthias at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] intenal error when connecting from
rabbitmq-c
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: "Gotthard, Petr" <Petr.Gotthard at Honeywell.com>
Message-ID: <50852A5B.2070606 at rabbitmq.com>
Content-Type: text/plain; charset=windows-1252; format=flowed

Petr,

On 22/10/12 11:52, Gotthard, Petr wrote:
> While the rabbitmq-c on one machine is fine, on another machine I?m
> getting ?server connection error 541, message: INTERNAL_ERROR? and the
> rabbitmq log contains the following entries:
>
> =ERROR REPORT==== 22-Oct-2012::12:38:17 ===
>
> AMQP connection <0.2315.0>, channel 1 - error:
>
> {{badmatch,{undefined,<<40,17,97,112,112,108,105,99,97,116,105,111,110,47,
>
>                          110,111,116,97,109>>}},
>
> [{rabbit_framing_amqp_0_9_1,decode_properties,2},

Looks like the basic.publish headers/properties are invalid. I suggest 
you try sending a message without any headers/properties. If that works 
then carefully check your code that is constructing the 
amqp_basic_properties_t. In particularly, make sure that you are setting 
the flags correctly. See e.g. 
http://comments.gmane.org/gmane.comp.networking.rabbitmq.general/2717

Regards,

Matthias.


------------------------------

Message: 2
Date: Mon, 22 Oct 2012 12:21:29 +0100
From: Matthias Radestock <matthias at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Upgrading RabbitMQ2.8.6
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <50852C39.8040704 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

On 19/10/12 10:24, PSL 88506 wrote:
> When i try to understand about installation procedure for 2.8.6
>
> All links are getting redirected to same page with following URL:
> http://www.rabbitmq.com/download.html

Links will always point to the latest version, which is 2.8.7. I 
recommend you install that rather than 2.8.6. If you really must install 
2.8.6, follow the "Older Versions / Download" link on the download.html 
page.

Regards,

Matthias.


------------------------------

Message: 3
Date: Mon, 22 Oct 2012 12:35:10 +0100
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Rabbit Management HTTP API issue -
deleted queues linger in API responses
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: Matt Campbell <matt at soupmatt.com>
Message-ID: <50852F6E.5010407 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

No - this certainly should not be happening.

When this is happening, do you see the queues in "rabbitmqctl list_queues"?

Also, can you post logs (including the sasl log) somewhere?

Cheers, Simon

On 18/10/12 19:13, Matt Campbell wrote:
> On Thursday, October 18, 2012 12:20:54 PM UTC-5, Matt Campbell wrote:
>
>     RabbitMQ version: 2.8.7
>     Erlang version: R14B04
>
>     We are seeing an issue where queues that have been deleted using the
>     amqp basic.delete command tend to linger in the Management console
>     and in calls to the HTTP API. This is an issue for us as we are
>     using that API to discover dynamically created and deleted queues.
>     Can anyone confirm this behavior or offer a suggestion as to how we
>     can mitigate it?
>
>     Thanks,
>
>     Matt
>
>
> I learned some more about what is going on. If I try to redeclare the
> queue, rabbit returns an error unless I match the queue arguments, as I
> would expect, but then if I go to delete the queue, I get an error
> saying it doesn't exist.
>
> Our setup for this environment is a single node running in cluster mode
> (we are planning on adding a second node in the near future) and all our
> queues are declared with x-ha-policy set to all.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware


------------------------------

Message: 4
Date: Mon, 22 Oct 2012 12:44:47 +0100
From: Matthias Radestock <matthias at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] PHP Client Library
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <508531AF.4020509 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

Andre,

On 22/10/12 08:23, Andre Torgal wrote:
> will RabbitMQ list the PECL library in the Get Started page if a repo
> with examples exists for it.

Yes.

Matthias.



------------------------------

Message: 5
Date: Mon, 22 Oct 2012 18:34:33 +0530
From: chetan dev <dev440 at gmail.com>
Subject: [rabbitmq-discuss] Clustering
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
<CAB0ZxM5P5GDa0j3KbgG14SQqU+Sj8pkppfUp_1q_TgSeX5oEgg at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Hi,
I have two nodes clustered together , but when i stop a node using
rabbbitmqctl stop command and start the broker with rabbitmq-server
detached commnad
now when  i see the cluster status it shows only one broker running while
both of the brokers are running fine.
can anybody explain this or tell me what mistake i am making?

Thanks



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/5fd4d601/attachment.html>

------------------------------

Message: 6
Date: Mon, 22 Oct 2012 14:09:38 +0100
From: Tim Watson <tim at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Clustering
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <578609C0-3747-4EA0-9105-A1F954D27660 at rabbitmq.com>
Content-Type: text/plain; charset=iso-8859-1

Works for me! ;)

What version(s) of rabbit are you running and can you please post the exact commands you're using to start each node, to stop one of the applications (not the node) and cluster it with the other one and then finally the command you're using to start again.

Cheers
Tim

On 22 Oct 2012, at 14:04, chetan dev wrote:

> Hi,
> I have two nodes clustered together , but when i stop a node using rabbbitmqctl stop command and start the broker with rabbitmq-server detached commnad
> now when  i see the cluster status it shows only one broker running while both of the brokers are running fine.
> can anybody explain this or tell me what mistake i am making?
> 
> Thanks
> 
> 
> 
> -- 
> Cheten  Dev 
> 
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



------------------------------

Message: 7
Date: Mon, 22 Oct 2012 18:47:02 +0530
From: chetan dev <dev440 at gmail.com>
Subject: Re: [rabbitmq-discuss] Clustering
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
<CAB0ZxM6iN1av-2AdBgWVdZB-bF3hrDER8651s90JoQrr5tRCaQ at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Hi,

Thanks for your reply i am using 2.8.6
here is what i am doing
1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered
2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
3. now i start the node rabbit at SHIKHARM using rabbitmq-server start commnad
4. and then i check cluster status it shows only one running node
Cluster status of node rabbit at CHETANDEV ...
[{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
 {running_nodes,[rabbit at CHETANDEV]}]
...done.

On Mon, Oct 22, 2012 at 6:39 PM, Tim Watson <tim at rabbitmq.com> wrote:

> Works for me! ;)
>
> What version(s) of rabbit are you running and can you please post the
> exact commands you're using to start each node, to stop one of the
> applications (not the node) and cluster it with the other one and then
> finally the command you're using to start again.
>
> Cheers
> Tim
>
> On 22 Oct 2012, at 14:04, chetan dev wrote:
>
> > Hi,
> > I have two nodes clustered together , but when i stop a node using
> rabbbitmqctl stop command and start the broker with rabbitmq-server
> detached commnad
> > now when  i see the cluster status it shows only one broker running
> while both of the brokers are running fine.
> > can anybody explain this or tell me what mistake i am making?
> >
> > Thanks
> >
> >
> >
> > --
> > Cheten  Dev
> >
> > B.Tech Final Year
> > Dept. of Electrical Engg.
> > IIT Delhi, New Delhi
> > ph 8527333215
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/6d857aaa/attachment-0001.htm>

------------------------------

Message: 8
Date: Mon, 22 Oct 2012 16:47:04 +0300
From: Artsiom <u2.storm at gmail.com>
Subject: [rabbitmq-discuss] Adding slave for mirrored queue
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <50854E58.50807 at gmail.com>
Content-Type: text/plain; charset="windows-1251"; Format="flowed"

Hi all.

Let me ask question regarding mirrored queues.
I have a cluster of 8 nodes(node01, node02, node03 ... and etc.).The 
queue is declared as HA withfollowing params:
x-ha-policy: nodes
x-ha-policy: rabbit at node01, rabbit at node02, rabbit at node03

Is it possible to add more slavesfor that queuew\o deleting and 
redeclaring. If possible, what side-effects are expected?
Will other consumers be able to continue receive messages from that 
queue or they'll get cancellation consumer notification?
I don't want all nodes to be mirrors of that queue (it generates too 
much network traffic).

P.S. Does rabbitmq-c support consumer cancellation notification feature?

--
Best regards,
Artsiom

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/1d289091/attachment-0001.htm>

------------------------------

Message: 9
Date: Mon, 22 Oct 2012 15:21:42 +0100
From: Tim Watson <watson.timothy at gmail.com>
Subject: Re: [rabbitmq-discuss] Clustering
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <F0BE6B42-22CA-4517-8858-C402166ADF37 at rabbitmq.com>
Content-Type: text/plain; charset="us-ascii"

Yes but how did you cluster them on the first place? You do realise that rabbit nodes are not clustered automatically?



On 22 Oct 2012, at 14:17, chetan dev <dev440 at gmail.com> wrote:

> Hi,
> 
> Thanks for your reply i am using 2.8.6
> here is what i am doing 
> 1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered 
> 2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
> 3. now i start the node rabbit at SHIKHARM using rabbitmq-server start commnad
> 4. and then i check cluster status it shows only one running node  
> Cluster status of node rabbit at CHETANDEV ...
> [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>  {running_nodes,[rabbit at CHETANDEV]}]
> ...done.
> 
> On Mon, Oct 22, 2012 at 6:39 PM, Tim Watson <tim at rabbitmq.com> wrote:
> Works for me! ;)
> 
> What version(s) of rabbit are you running and can you please post the exact commands you're using to start each node, to stop one of the applications (not the node) and cluster it with the other one and then finally the command you're using to start again.
> 
> Cheers
> Tim
> 
> On 22 Oct 2012, at 14:04, chetan dev wrote:
> 
> > Hi,
> > I have two nodes clustered together , but when i stop a node using rabbbitmqctl stop command and start the broker with rabbitmq-server detached commnad
> > now when  i see the cluster status it shows only one broker running while both of the brokers are running fine.
> > can anybody explain this or tell me what mistake i am making?
> >
> > Thanks
> >
> >
> >
> > --
> > Cheten  Dev
> >
> > B.Tech Final Year
> > Dept. of Electrical Engg.
> > IIT Delhi, New Delhi
> > ph 8527333215
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> -- 
> Cheten  Dev 
> 
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/f2244317/attachment-0001.htm>

------------------------------

Message: 10
Date: Mon, 22 Oct 2012 15:24:12 +0100
From: Tim Watson <watson.timothy at gmail.com>
Subject: Re: [rabbitmq-discuss] Adding slave for mirrored queue
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: "rabbitmq-discuss at lists.rabbitmq.com"
<rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <81DBF17F-B324-485B-82DB-151415D01FDA at rabbitmq.com>
Content-Type: text/plain; charset="us-ascii"

Hi

On 22 Oct 2012, at 14:47, Artsiom <u2.storm at gmail.com> wrote:

> Hi all.
> 
> Let me ask question regarding mirrored queues.
> I have a cluster of 8 nodes(node01, node02, node03 ... and etc.). The queue is                             declared as HA with following params:
> x-ha-policy: nodes
> x-ha-policy: rabbit at node01, rabbit at node02, rabbit at node03
> 
> Is it possible to add more slaves for that queue w\o deleting and redeclaring.

In the current version of rabbit no. In the next feature release 3.0 yes, because ha is controlled by policy rather than at queue declaration time and can be changed at runtime. Check out next.rabbitmq.com for more info.

> If possible, what side-effects are expected?
> Will other consumers be able to continue receive messages from that queue or they'll                                                           get cancellation consumer notification?
> I don't want all nodes to be mirrors of that queue (it generates too much network traffic).
> 
> P.S. Does rabbitmq-c support consumer cancellation notification feature?
> 
> --
> Best regards,
> Artsiom
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/7b1050fe/attachment-0001.htm>

------------------------------

Message: 11
Date: Mon, 22 Oct 2012 17:52:16 +0300
From: Artsiom <u2.storm at gmail.com>
Subject: Re: [rabbitmq-discuss] Adding slave for mirrored queue
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: Tim Watson <watson.timothy at gmail.com>
Message-ID: <50855DA0.20008 at gmail.com>
Content-Type: text/plain; charset="windows-1251"; Format="flowed"

Tim, thanks for response.

Does this feature available in nightly builds?
Could you uncover the mystery, when rabbitmq 3.0 release is expected? :)


On 10/22/2012 05:24 PM, Tim Watson wrote:
> Hi
>
> On 22 Oct 2012, at 14:47, Artsiom <u2.storm at gmail.com 
> <mailto:u2.storm at gmail.com>> wrote:
>
>> Hi all.
>>
>> Let me ask question regarding mirrored queues.
>> I have a cluster of 8 nodes(node01, node02, node03 ... and etc.).The 
>> queue is declared as HA withfollowing params:
>> x-ha-policy: nodes
>> x-ha-policy: rabbit at node01, rabbit at node02, rabbit at node03
>>
>> Is it possible to add more slavesfor that queuew\o deleting and 
>> redeclaring.
>
> In the current version of rabbit no. In the next feature release 3.0 
> yes, because ha is controlled by policy rather than at queue 
> declaration time and can be changed at runtime. Check out 
> next.rabbitmq.com <http://next.rabbitmq.com> for more info.
>
>> If possible, what side-effects are expected?
>> Will other consumers be able to continue receive messages from that 
>> queue or they'll get cancellation consumer notification?
>> I don't want all nodes to be mirrors of that queue (it generates too 
>> much network traffic).
>>
>> P.S. Does rabbitmq-c support consumer cancellation notification feature?
>>
>> --
>> Best regards,
>> Artsiom
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com 
>> <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/2dd0a326/attachment-0001.htm>

------------------------------

Message: 12
Date: Mon, 22 Oct 2012 16:30:54 +0100
From: Tim Watson <watson.timothy at gmail.com>
Subject: Re: [rabbitmq-discuss] Adding slave for mirrored queue
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>,
Tim Watson <watson.timothy at gmail.com>
Message-ID: <86B6A351-B208-4F74-955F-6897271F6445 at rabbitmq.com>
Content-Type: text/plain; charset="us-ascii"


Artisom,

On 22 Oct 2012, at 15:52, Artsiom <u2.storm at gmail.com> wrote:

> Tim, thanks for response.
> 
> Does this feature available in nightly builds?

Yes it is!

> Could you uncover the mystery, when rabbitmq 3.0 release is expected? :)
> 
> 

LOL not really, but most of the tickets associated with it are complete so it should be coming soon!

> On 10/22/2012 05:24 PM, Tim Watson wrote:
>> Hi
>> 
>> On 22 Oct 2012, at 14:47, Artsiom <u2.storm at gmail.com> wrote:
>> 
>>> Hi all.
>>> 
>>> Let me ask question regarding mirrored queues.
>>> I have a cluster of 8 nodes(node01, node02, node03 ... and etc.). The queue is declared as HA with following params:
>>> x-ha-policy: nodes
>>> x-ha-policy: rabbit at node01, rabbit at node02, rabbit at node03
>>> 
>>> Is it possible to add more slaves for that queue w\o deleting and redeclaring.
>> 
>> In the current version of rabbit no. In the next feature release 3.0 yes, because ha is controlled by policy rather than at queue declaration time and can be changed at runtime. Check out next.rabbitmq.com for more info.
>> 
>>> If possible, what side-effects are expected?
>>> Will other consumers be able to continue receive messages from that queue or they'll get cancellation consumer notification?
>>> I don't want all nodes to be mirrors of that queue (it generates too much network traffic).
>>> 
>>> P.S. Does rabbitmq-c support consumer cancellation notification feature?
>>> 
>>> --
>>> Best regards,
>>> Artsiom
>>> 
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/1b7d75e5/attachment-0001.htm>

------------------------------

Message: 13
Date: Mon, 22 Oct 2012 09:07:36 -0700
From: Matt Long <matt at crocodoc.com>
Subject: Re: [rabbitmq-discuss] Upgrading RabbitMQ2.8.6
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
<CAFX3A=1HJW68iyzJNE15QxwUyP-HG=QcC711ueWV68-JahxwsQ at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

While we're on the topic of older versions, it appears they are removed
from the RabbitMQ APT repository; only the newest version is ever
available. Is this done on purpose? It has led to some issues for us since
we specify explicit package versions in our provisioning system and
occasionally they'll no longer be there!

Thanks,
Matt

On Mon, Oct 22, 2012 at 4:21 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 19/10/12 10:24, PSL 88506 wrote:
>
>> When i try to understand about installation procedure for 2.8.6
>>
>> All links are getting redirected to same page with following URL:
>> http://www.rabbitmq.com/**download.html<http://www.rabbitmq.com/download.html>
>>
>
> Links will always point to the latest version, which is 2.8.7. I recommend
> you install that rather than 2.8.6. If you really must install 2.8.6,
> follow the "Older Versions / Download" link on the download.html page.
>
>
> Regards,
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 
Matt Long
Cofounder and Lead Developer
crocodoc.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/b9f3889b/attachment-0001.htm>

------------------------------

Message: 14
Date: Mon, 22 Oct 2012 17:13:41 +0100
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Adding slave for mirrored queue
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <508570B5.5000501 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

On 22/10/12 14:47, Artsiom wrote:
> Is it possible to add more slavesfor that queuew\o deleting and
> redeclaring.

As Tim notes, not until 3.0.

> If possible, what side-effects are expected?

The same as with adding a new cluster node with x-ha-policy:all in 2.8.x 
- the new mirror will be initially unsynchronised and will become 
synchronised when all old messages have been consumed. Producers and 
consumers won't see any side effects when the new mirror comes on line.

> Will other consumers be able to continue receive messages from that
> queue or they'll get cancellation consumer notification?

They will continue to receive messages.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware


------------------------------

Message: 15
Date: Mon, 22 Oct 2012 15:05:42 -0400
From: Laurent Vauthrin <lvauthrin at gmail.com>
Subject: [rabbitmq-discuss] Channel thread-safety
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
<CAM8Y7yBqrHE8kvF38htNLnqZ3CSCGqkUQLJoaTwDK0p0qfWpoQ at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Hello,

I've done some searching but can't seem to answer a couple of questions.
 In the API guide, I saw:

"Channel instances are safe for use by multiple threads. Requests into a
Channel are serialized, with only one thread being able to run a command on
the Channel at a time. Even so, applications should prefer using a Channel
per thread instead of sharing the same Channel across multiple threads."

And in the Javadocs for Channel, I saw:

"While a Channel can be used by multiple threads, it's important to ensure
that only one thread executes a command at once. Concurrent execution of
commands will likely cause an UnexpectedFrameError to be thrown."

Currently, our service shares the same channel across each request thread
and we synchronize the call to 'basicPublish'.  Looking at the basicPublish
code, it looks like the sequence number member variable is not thread safe
but it doesn't affect us since we're not ack'ing our messages.

My questions are:
1. Should we be using a channel per thread considering that we're
synchronizing the basicPublish call anyway?
2. Can we just share one channel across all threads and not synchronize the
call to basicPublish?

Thanks,
Laurent
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/ab4de8ca/attachment-0001.htm>

------------------------------

Message: 16
Date: Tue, 23 Oct 2012 00:58:33 +0530
From: chetan dev <dev440 at gmail.com>
Subject: Re: [rabbitmq-discuss] Clustering
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
<CAB0ZxM7=S7ZnhkrAYhjzZURJO07KyMmfqap+gV67eTUEQvJDuA at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Hi,

Yes i clustered them as given on rabbitmq clustering documentation for e.g
on the first place both nodes are running
now i stopped app using rabbitmqctl stop_app then i reset that node than i
clusterd that node with another using rabbitmqctl cluster rabbit at SHIKHARM
then i started the node using rabbitmqctl start_app
when i checked the cluster status it was showing fine then i did as i
mentioned earlier

Thanks

On Mon, Oct 22, 2012 at 7:51 PM, Tim Watson <watson.timothy at gmail.com>wrote:

> Yes but how did you cluster them on the first place? You do realise that
> rabbit nodes are not clustered automatically?
>
>
>
> On 22 Oct 2012, at 14:17, chetan dev <dev440 at gmail.com> wrote:
>
> Hi,
>
> Thanks for your reply i am using 2.8.6
> here is what i am doing
> 1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered
> 2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
> 3. now i start the node rabbit at SHIKHARM using rabbitmq-server start
> commnad
> 4. and then i check cluster status it shows only one running node
> Cluster status of node rabbit at CHETANDEV ...
> [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>  {running_nodes,[rabbit at CHETANDEV]}]
> ...done.
>
> On Mon, Oct 22, 2012 at 6:39 PM, Tim Watson <tim at rabbitmq.com> wrote:
>
>> Works for me! ;)
>>
>> What version(s) of rabbit are you running and can you please post the
>> exact commands you're using to start each node, to stop one of the
>> applications (not the node) and cluster it with the other one and then
>> finally the command you're using to start again.
>>
>> Cheers
>> Tim
>>
>> On 22 Oct 2012, at 14:04, chetan dev wrote:
>>
>> > Hi,
>> > I have two nodes clustered together , but when i stop a node using
>> rabbbitmqctl stop command and start the broker with rabbitmq-server
>> detached commnad
>> > now when  i see the cluster status it shows only one broker running
>> while both of the brokers are running fine.
>> > can anybody explain this or tell me what mistake i am making?
>> >
>> > Thanks
>> >
>> >
>> >
>> > --
>> > Cheten  Dev
>> >
>> > B.Tech Final Year
>> > Dept. of Electrical Engg.
>> > IIT Delhi, New Delhi
>> > ph 8527333215
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
> --
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
>
>  _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/025d40da/attachment-0001.htm>

------------------------------

Message: 17
Date: Mon, 22 Oct 2012 23:46:23 +0400
From: Michael Klishin <michael.s.klishin at gmail.com>
Subject: Re: [rabbitmq-discuss] Channel thread-safety
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
<CAE3HoVTr6esOVC4A6PkKBiZm__PO5=uB-7Hj=oXyKN_5eDtdbg at mail.gmail.com>
Content-Type: text/plain; charset="utf-8"

2012/10/22 Laurent Vauthrin <lvauthrin at gmail.com>

> My questions are:
> 1. Should we be using a channel per thread considering that we're
> synchronizing the basicPublish call anyway?
>

Yes. Channels are just integer on the wire and a little bit of memory
allocated on the JVM heap. They are very cheap
for all intents and purposes and you are much more likely to max out your
OS and hardware resources (assuming 1 channel per JVM thread) before
you run into issues with channel objects.


> 2. Can we just share one channel across all threads and not synchronize
> the call to basicPublish?
>


No. The real issue with shared channels is that large messages will result
in multiple protocol frames being sent
for a single basicPublish operation. When publishing on the same channel
from multiple threads, this may result
in frames being delivered out of order:

T1 => basicPublish => [Frame11] [Frame12] [Frame13]
T2 => basicPublish => [Frame21] [Frame22] [Frame23]

may result in the following delivery order, all on the same channel:

[Frame11][Frame21][Frame12][Frame13][Frame22][Frame23]

and because all frames are on the same channel, RabbitMQ won't be able to
tell how to reconstruct your messages.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/9625fb67/attachment-0001.htm>

------------------------------

Message: 18
Date: Mon, 22 Oct 2012 21:50:04 +0200
From: Desta Haileselassie Hagos <deshai-0 at student.ltu.se>
Subject: Re: [rabbitmq-discuss] RabbitMQ + Messages between virtual
machines and physical hosts on a cloud
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
<CAKiRAqUZZyg4bqvsGEeH8a-+wwS0m=8sC9tJJ6JUMB1T1V1eQg at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Dear Sir/Madam,

The problem is that I am not able to send and receive messages between the
Virtual machines and the physical hosts on my cloud. I want to receive full
information by manipulating the VMs APIs if it is possible.


>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/c8eb2876/attachment-0001.htm>

------------------------------

Message: 19
Date: Tue, 23 Oct 2012 09:10:05 +1300
From: Brett Cameron <brett.r.cameron at gmail.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ + Messages between virtual
machines and physical hosts on a cloud
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
<CALPqkipaNufyui=8F522qDrX1A4P66FwtQ_Z4jWrgz+3Lv9ToA at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Desta,

Have you looked at the security profile associated with your VM's? Is it
possible that port 5672 is blocked?

Brett

On Tue, Oct 23, 2012 at 8:50 AM, Desta Haileselassie Hagos <
deshai-0 at student.ltu.se> wrote:

> Dear Sir/Madam,
>
> The problem is that I am not able to send and receive messages between the
> Virtual machines and the physical hosts on my cloud. I want to receive full
> information by manipulating the VMs APIs if it is possible.
>
>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/1f36fb06/attachment-0001.htm>

------------------------------

Message: 20
Date: Mon, 22 Oct 2012 21:26:58 +0100
From: Matthias Radestock <matthias at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Clustering
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <5085AC12.5060409 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

On 22/10/12 20:28, chetan dev wrote:
>>     here is what i am doing
>>     1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered

yes, but...

>> i clustered them as given on rabbitmq clustering documentation for e.g
>> on the first place both nodes are running
>> now i stopped app using rabbitmqctl stop_app then i reset that node than
>> i clusterd that node with another using rabbitmqctl cluster rabbit at SHIKHARM
>> then i started the node using rabbitmqctl start_app
>> when i checked the cluster status it was showing fine then i did as i
>> mentioned earlier

That will make rabbit at CHETANDEV a *ram* node. To make both nodes disk 
nodes the node itself would have to be mentioned in the cluster command 
too, i.e. 'rabbitmqctl cluster rabbit at SHIKHAR rabbit at CHETANDEV'.

>>     2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
>>     3. now i start the node rabbit at SHIKHARM using rabbitmq-server
>>     start commnad

You have just stopped and restarted the clusters' only disk node. Rabbit 
clusters won't function properly if they have only ram nodes.

>>     4. and then i check cluster status it shows only one running node
>>     Cluster status of node rabbit at CHETANDEV ...
>>     [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>>      {running_nodes,[rabbit at CHETANDEV]}]
>>     ...done.

Try running that command against rabbit at SHIKHARM. I suspect it will tell 
you that it only knows about itself.

Anyway, I suggest you change your cluster configuration s.t. both nodes 
are disk nodes.

Regards,

Matthias.


------------------------------

Message: 21
Date: Mon, 22 Oct 2012 13:48:36 -0700
From: Dharshan Rangegowda <dharshanr at scalegrid.net>
Subject: Re: [rabbitmq-discuss] {SSL upgrade error, timeout}
To: Emile Joubert <emile at rabbitmq.com>
Cc: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
<CAC3-Q1RBiLnjMCtuACu-L4_ZM3H7P6+B=LPOyvzHOWQ6yaVsgQ at mail.gmail.com>
Content-Type: text/plain; charset="utf-8"

Hi Emile,

I ran through the troubleshooting wizard and the openssl connection test
passes - so that makes me think it is not a network issue. However my java
client still fails with the "Remote host closed connection during
handshake" error. I have included the results of the connection test below.
Any other thoughts on how I can debug this?

C:\temp>openssl s_client -connect 199.71.180.59:5671 -CAfile ssltest.pem
CONNECTED(00000003)
depth=1 /CN=ScaleGridCA
verify return:1
depth=0 /CN=i-19-483-VM/O=server
verify return:1
---
Certificate chain
 0 s:/CN=i-19-483-VM/O=server
   i:/CN=ScaleGridCA
 1 s:/CN=ScaleGridCA
   i:/CN=ScaleGridCA
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIC5zCCAc+gAwIBAgIBNDANBgkqhkiG9w0BAQUFADAWMRQwEgYDVQQDEwtTY2Fs
ZUdyaWRDQTAeFw0xMjEwMjIxNjIxNTJaFw0xMzEwMjIxNjIxNTJaMCcxFDASBgNV
BAMTC2ktMTktNDgzLVZNMQ8wDQYDVQQKEwZzZXJ2ZXIwggEiMA0GCSqGSIb3DQEB
AQUAA4IBDwAwggEKAoIBAQDX7e0Jql/WTD7OUDTIQmg+igwhiVO+17QBuDkgSsQ/
9nRJSCZzEKC9guH7V+Veq8UG9G2brqwF10jzuZSOq3CGaBWH+F5KE/U+q2yuR3kt
sOLz6wgMgYnobI1SWjvlkbwYKhgnv689m58Ub5lTISB3aKwT4C0ilnWBbF0v61mq
TFtjwDRAbCPXl9HwbBFoeLpTsiRu76VXWkA6pv9Ndl4hhcg2YLGwWAOdZO2/NUCB
QjqrHOir9ekjmpjWMQmWakN61/ckFuuFtGLOqrcujbRuVpAFFWGd53/quCZ+WKNw
81ZdafFnUSI8ioK2sHGQFxsQKNkpaRuE2/YbrLam+4HPAgMBAAGjLzAtMAkGA1Ud
EwQCMAAwCwYDVR0PBAQDAgUgMBMGA1UdJQQMMAoGCCsGAQUFBwMBMA0GCSqGSIb3
DQEBBQUAA4IBAQBqBdvs5eHfVbh8jtp3KF/Q/UG/RtMBrkBnlFWLdBKbhYbWCC1K
5VncFIpQQ2K44G+RWaqMpPgwj4AZso83/JXn11b52ZxGdR8iogrAX4vWw41CNKfr
VX0jj4/TPlwFvdS9Jzd3w/NAvLgQ1JXZdBaWxAagfXl8++5nVdC94sj4GNkrCwyN
r4zBiA6BOsmznVLBLjpoj3WLlrJDGZCTv+PSHDplZtuquDyl37PLOG6F2WUFAxaL
vhj7zKVTGIj7ESXuNYKnTSyLEkxvrlWdKooJKmH+v5xxEM6H2PqFcS/LGwIaUuxc
26AKWBnVcK+Pd86765KirNUwf7Fm2ChKwj9M
-----END CERTIFICATE-----
subject=/CN=i-19-483-VM/O=server
issuer=/CN=ScaleGridCA
---
No client certificate CA names sent
---
SSL handshake has read 1632 bytes and written 444 bytes
---
New, TLSv1/SSLv3, Cipher is AES256-SHA
Server public key is 2048 bit
Compression: NONE
Expansion: NONE
SSL-Session:
    Protocol  : TLSv1
    Cipher    : AES256-SHA
    Session-ID:
A0F1A911ED174A49B8AACDD54C3F21C1FD332949D892EEDABF84479DC21BB22D
    Session-ID-ctx:
    Master-Key:
8FCF38B3652F0A2E6BA8EEBACF2F7387C84416DDCC365A4FF8A4A4FA4B06343DEE463499007DDD03E1155A4A4D8317EE
    Key-Arg   : None
    Start Time: 1350938613
    Timeout   : 300 (sec)
    Verify return code: 0 (ok)
---
12345678
AMQP    ?closed

On Mon, Oct 22, 2012 at 2:24 AM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 21/10/12 21:23, dharshanr wrote:
> > =ERROR REPORT==== 21-Oct-2012::09:12:49 ===
> > error on AMQP connection <0.7614.0>: {ssl_upgrade_error,timeout}
>
> Are you sure the problem is not network-related?
>
> > The certs are self signed certs and not trusted. Any thoughts on how I
> > can debug this error?
>
> It is strange that a working setup stops working suddenly. The tips in
> the SSL troubleshooting guide might provide more debugging information:
>
> http://www.rabbitmq.com/troubleshooting-ssl.html
>
>
> -Emile
>
>


-- 
regards,
Dharshan.
www.scalegrid.net
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/75aee49f/attachment-0001.htm>

------------------------------

Message: 22
Date: Mon, 22 Oct 2012 22:14:40 +0000
From: Elizabeth Liao <eliao at seegrid.com>
Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
To: Tim Watson <tim at rabbitmq.com>, Discussions about RabbitMQ
<rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
<E94F626F5C43D14F8B8479C5EBD79038A85DDCE1 at vmexchange02.seegrid.local>
Content-Type: text/plain; charset="us-ascii"

Hi,

This is what I tried
 * I start running rabbit with no NODENAME set and entered the following commands
  * rabbitmqctl stop
  * /etc/init.d/rabbitmq-server stop
  * epmd -kill ( Is this correct? I didn't see a restart in the documentation )
  * In /etc/hosts changed line from 127.0.1.1 <oldhostname> <oldhostname>.localdomain -> 127.0.1.1 <newhostname> <newhostname>.localdomain
  * in /etc/sysconfig/network changed HOSTNAME=<oldhostname> -> HOSTNAME=<newhostname>
  * /bin/hostname <newhostname>
 * /etc/init.d/rabbitmq-server start

The error I get is this:
Activating RabbitMQ plugins ...
3 plugins activated:
* amqp_client-2.8.6
* erlando-2.8.6
* rabbitmq_shovel-2.8.6

ERROR: epmd error for host "<oldhostname>": nxdomain (non-existing domain)



________________________________________
From: Tim Watson [tim at rabbitmq.com]
Sent: Monday, October 22, 2012 6:41 AM
To: Discussions about RabbitMQ
Cc: Elizabeth Liao
Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory

Hi again,

On 20 Oct 2012, at 10:52, Tim Watson wrote:

> Hi Liz,
>
> Sorry i wasn't aware of the context. What Ian recommended should not be necessary, though I'll follow up with him on Monday to try and figure out why he needed to do that.
>
> Once you change the hostname you,ll possibly need to restart epmd and restart your rabbit, but you shouldn't need to change the node name from say rabbit to hare.
>

Were you able to try this again (changing only the host name but not the node name) and did it work for you? If not I'd like to know so we can investigate.

Cheers
Tim

> Cheers
> Tim
>
>
>
> On 19 Oct 2012, at 19:44, Elizabeth Liao <eliao at seegrid.com> wrote:
>
>> Hi Tim,
>>
>> I'm going to back up a bit because it seems that I've misunderstood something previously.
>>
>>> The first thing I'm going to say is that this isn't really a desirable
>> state of affairs. Why do you need to change NODENAME at all, just
>> because the host name has changed? This seems like an odd step to me -
>> can you explain the rationale behind it?
>>
>> I had an earlier problem changing the hostname and restarting the rabbitmq-server. The proposed fix was to add the NODENAME variable which I'm guessing was not right? :
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021435.html
>>
>>> Can you explain a bit more about this 'bug' please? What exactly is
>> going wrong?
>>
>> The bug is on our end where the NODENAME is set to an empty string. Of course this is moot if NODENAME doesn't even have to be set in the first place.
>>
>> Liz
>> ________________________________________
>> From: Tim Watson [tim at rabbitmq.com]
>> Sent: Friday, October 19, 2012 12:48 PM
>> To: Discussions about RabbitMQ
>> Cc: Elizabeth Liao
>> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
>>
>> Hi
>>
>> On 10/19/2012 03:41 PM, Elizabeth Liao wrote:
>>> Hi,
>>>
>>> We are currently running rabbitmq on a system where there is a need to change the hostname occasionally.  Right now, when the hostname is changed, we also update the NODENAME variable in the rabbitmq-env.conf file.
>>
>> The first thing I'm going to say is that this isn't really a desirable
>> state of affairs. Why do you need to change NODENAME at all, just
>> because the host name has changed? This seems like an odd step to me -
>> can you explain the rationale behind it?
>>
>>> The problem we're having right now is that due to a bug when setting up the rabbitmq-env.conf file, sometimes the NODENAME variable exists but is not set to anything ( NODENAME=) so rabbit never successfully starts up.  Even after setting the NODENAME variable to the hostname, rabbit still doesn't start up properly.
>>
>> Can you explain a bit more about this 'bug' please? What exactly is
>> going wrong?
>>
>>> The only way that I could find to recover from this situation without killing the erlang process, was to also set a MNESIA_DIR variable. After I did that, once the NODENAME was set to the correct hostname, rabbit started up properly.
>>
>> Now this makes no sense at all to me. If you are trying to recover
>> 'without killing the erlang process' then how are you planning on
>> changing the NODENAME? Once an erlang node has become part of a
>> distributed system, you cannot arbitrarily change the node's name
>> without restarting the net_kernel AFAIK so I can't see how this is even
>> possible. Also, because you're stating that 'rabbit started up properly'
>> I'm assuming that you have in fact taken the node offline (using
>> `rabbitmqctl stop` or one of the various service scripts that invokes
>> it) and that you are now starting the node again. The rabbit startup
>> scripts (and associated infrastructure) is not set up to handle changing
>> the name of a node post-installation in this manner, so I would not
>> expect this to work smoothly.
>>
>>> A couple of questions:
>>> Is this the proper way to fix the situation?
>>
>> No. As I said a moment ago, rabbit is not set up for this kind of
>> scenario so I'd be very cautious about doing this and would really
>> recommend against it.
>>
>>> Will this have unintended consequences?
>>
>> I have no idea, but it is entirely possible that various things could
>> break in obscure and alarming ways. I really would not do this if I were
>> you.
>>
>>> We are running rabbitmq-server-2.8.6 and erlang-R15B.
>>>
>>> Thanks!
>>
>> Liz. I would like to help you find a safe work-around so that you can
>> use rabbit in your environment. I would really like to understand why
>> the changing of a machine's host-name is causing problems for you. I
>> fully realise that after changing the hostname, it is possible that a
>> restart may be required (although I'd have to do some research to verify
>> whether or not this is a hard requirement). But I cannot understand why
>> a change to the machine's host name requires changing the rabbit
>> NODENAME at all, unless you've altered the rabbit start scripts to use
>> 'longnames' configuration (i.e., including the complete host name in the
>> node name) in which case, a simple solution to your problem might be to
>> switch back to using 'shortnames'. If erlang is started using -sname
>> rabbit@`hostname -s` and your /etc/hosts configuration supports
>> resolving the machine's IP to the short version of the name, then
>> changing the hostname shouldn't cause all of these headaches.
>>
>> For example, if I launch rabbit with something like this:
>>
>> env RABBITMQ_NODENAME=rabbit RABBITMQ_NODE_PORT=5672
>> RABBITMQ_LOG_BASE="/tmp"
>> RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia"
>> RABBITMQ_PID_FILE="/tmp/rabbitmq-rabbit.pid"
>> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch"
>> RABBITMQ_ENABLED_PLUGINS_FILE="/tmp/enabled-plugins"
>> RABBITMQ_CONFIG_FILE="/tmp/etc/rabbit" ./scripts/rabbitmq-server
>>
>> Then change the hostname, then stop rabbit and start it again,
>> everything is fine.
>>
>> Cheers,
>> Tim
>>
>>> Liz
>>> Email Confidentiality Notice
>>>
>>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> Email Confidentiality Notice
>>
>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.


------------------------------

Message: 23
Date: Mon, 22 Oct 2012 18:05:43 -0500
From: Travis <hcoyote at ghostar.org>
Subject: [rabbitmq-discuss] Memory leak caused by error_logger in
2.8.6?
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID:
<CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw at mail.gmail.com>
Content-Type: text/plain; charset=ISO-8859-1

Hello,

We're seeing large amounts of memory being used in some of our single
instance 2.8.6 rabbitmq.  When we do a memory
dump, the output appears to say that error_logger is taking up
hundreds of megabytes.  For example:

[{{memory,847631144},
  <4865.6.0>,
  [{registered_name,error_logger},
   {current_function,{gen_event,fetch_msg,5}},
   {initial_call,{proc_lib,init_p,5}},
   {status,waiting},
   {message_queue_len,0},
   {messages,[]},
   {links,[<4865.0.0>,<4865.30.0>]},
   {dictionary,
    [{{xtype_to_module,topic},rabbit_exchange_type_topic},
     {'$ancestors',[<4865.2.0>]},
     {'$initial_call',{gen_event,init_it,6}},
     {guid,{{36630272,1263673450,3038695659,1008081001},3102285}}]},
   {trap_exit,true},
   {error_handler,error_handler},
   {priority,normal},
   {group_leader,<4865.30.0>},
   {total_heap_size,105953765},
   {heap_size,12538050},
   {stack_size,8},
   {reductions,3561515316},
   {garbage_collection,
    [{min_bin_vheap_size,46368},
     {min_heap_size,233},
     {fullsweep_after,65535},
     {minor_gcs,578}]},
   {suspending,[]}]},

(If more of the dump is needed, I can provide)

 We're a bit perplexed as to what's causing this.  There's nothing odd
looking in the logs.  For example, we see stuff like this:

=INFO REPORT==== 22-Oct-2012::18:03:11 ===
accepting AMQP connection <0.1339.402> (127.0.0.1:32803 -> 127.0.0.1:5672)

=WARNING REPORT==== 22-Oct-2012::18:03:11 ===
closing AMQP connection <0.1339.402> (127.0.0.1:32803 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 22-Oct-2012::18:03:12 ===
closing AMQP connection <0.1331.402> (127.0.0.1:32796 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:12 ===
accepting AMQP connection <0.1347.402> (127.0.0.1:32840 -> 127.0.0.1:5672)

=WARNING REPORT==== 22-Oct-2012::18:03:13 ===
closing AMQP connection <0.1347.402> (127.0.0.1:32840 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 22-Oct-2012::18:03:13 ===
closing AMQP connection <0.32496.401> (127.0.0.1:57108 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:13 ===
closing AMQP connection <0.32476.401> (127.0.0.1:57104 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:13 ===
closing AMQP connection <0.32492.401> (127.0.0.1:57107 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:13 ===
closing AMQP connection <0.32468.401> (127.0.0.1:57103 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:14 ===
accepting AMQP connection <0.1355.402> (127.0.0.1:32875 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:14 ===
closing AMQP connection <0.1355.402> (127.0.0.1:32875 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:15 ===
accepting AMQP connection <0.1363.402> (127.0.0.1:32898 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:15 ===
accepting AMQP connection <0.1371.402> (127.0.0.1:32899 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:15 ===
closing AMQP connection <0.1371.402> (127.0.0.1:32899 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:15 ===
closing AMQP connection <0.32484.401> (127.0.0.1:57106 -> 127.0.0.1:5672)

=INFO REPORT==== 22-Oct-2012::18:03:15 ===
closing AMQP connection <0.32452.401> (127.0.0.1:57081 -> 127.0.0.1:5672)

=WARNING REPORT==== 22-Oct-2012::18:03:15 ===
closing AMQP connection <0.1363.402> (127.0.0.1:32898 -> 127.0.0.1:5672):
connection_closed_abruptly


Is there a way to tell what's really going on with the error_logger
and if we're really generating so many messages that it's causing
memory to balloon so much?

Travis

-- 
Travis Campbell
travis at ghostar.org


------------------------------

Message: 24
Date: Mon, 22 Oct 2012 17:41:05 -0700 (PDT)
From: theBuckWheat <tbw at rg6.org>
Subject: [rabbitmq-discuss] How to structure Master with many slaves?
RPC??
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <1350952865620-22782.post at n5.nabble.com>
Content-Type: text/plain; charset=us-ascii

I have a SETI-like slave pool, but I maintain the list of which slaves I want
to send work to and which are kept idle.  The slave does the work assigned
and prepares the response dataset to be sent back..   

Question: since I may turn on a slave to accept some work and later take
others out of the pool dynamically, what is the best RabbitMQ queue
topology?  RPC?  





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-structure-Master-with-many-slaves-RPC-tp22782.html
Sent from the RabbitMQ mailing list archive at Nabble.com.


------------------------------

Message: 25
Date: Mon, 22 Oct 2012 21:08:54 -0400
From: Laurent Vauthrin <lvauthrin at gmail.com>
Subject: Re: [rabbitmq-discuss] Channel thread-safety
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
<CAM8Y7yCLUSV9ker3OWqENkKEFEWPoppos0k3jehWb3-8wqyPaA at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Thanks for clearing that up!

On Mon, Oct 22, 2012 at 3:46 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

>
>
> 2012/10/22 Laurent Vauthrin <lvauthrin at gmail.com>
>
>> My questions are:
>> 1. Should we be using a channel per thread considering that we're
>> synchronizing the basicPublish call anyway?
>>
>
> Yes. Channels are just integer on the wire and a little bit of memory
> allocated on the JVM heap. They are very cheap
> for all intents and purposes and you are much more likely to max out your
> OS and hardware resources (assuming 1 channel per JVM thread) before
> you run into issues with channel objects.
>
>
>> 2. Can we just share one channel across all threads and not synchronize
>> the call to basicPublish?
>>
>
>
> No. The real issue with shared channels is that large messages will result
> in multiple protocol frames being sent
> for a single basicPublish operation. When publishing on the same channel
> from multiple threads, this may result
> in frames being delivered out of order:
>
> T1 => basicPublish => [Frame11] [Frame12] [Frame13]
> T2 => basicPublish => [Frame21] [Frame22] [Frame23]
>
> may result in the following delivery order, all on the same channel:
>
> [Frame11][Frame21][Frame12][Frame13][Frame22][Frame23]
>
> and because all frames are on the same channel, RabbitMQ won't be able to
> tell how to reconstruct your messages.
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/ddb12951/attachment-0001.htm>

------------------------------

Message: 26
Date: Tue, 23 Oct 2012 09:12:01 +0100
From: Tim Watson <watson.timothy at gmail.com>
Subject: Re: [rabbitmq-discuss] Clustering
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <140F445C-D95D-45F5-874C-F62DB4D695B3 at rabbitmq.com>
Content-Type: text/plain; charset="us-ascii"

Please provide me with full details of your environments (os, version, etc) and can you please post a full transcript of all the commands and their output.

Thanks



On 22 Oct 2012, at 20:28, chetan dev <dev440 at gmail.com> wrote:

> Hi,
> 
> Yes i clustered them as given on rabbitmq clustering documentation for e.g
> on the first place both nodes are running 
> now i stopped app using rabbitmqctl stop_app then i reset that node than i clusterd that node with another using rabbitmqctl cluster rabbit at SHIKHARM
> then i started the node using rabbitmqctl start_app
> when i checked the cluster status it was showing fine then i did as i mentioned earlier 
> 
> Thanks
> 
> On Mon, Oct 22, 2012 at 7:51 PM, Tim Watson <watson.timothy at gmail.com> wrote:
> Yes but how did you cluster them on the first place? You do realise that rabbit nodes are not clustered automatically?
> 
> 
> 
> On 22 Oct 2012, at 14:17, chetan dev <dev440 at gmail.com> wrote:
> 
>> Hi,
>> 
>> Thanks for your reply i am using 2.8.6
>> here is what i am doing 
>> 1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered 
>> 2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
>> 3. now i start the node rabbit at SHIKHARM using rabbitmq-server start commnad
>> 4. and then i check cluster status it shows only one running node  
>> Cluster status of node rabbit at CHETANDEV ...
>> [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>>  {running_nodes,[rabbit at CHETANDEV]}]
>> ...done.
>> 
>> On Mon, Oct 22, 2012 at 6:39 PM, Tim Watson <tim at rabbitmq.com> wrote:
>> Works for me! ;)
>> 
>> What version(s) of rabbit are you running and can you please post the exact commands you're using to start each node, to stop one of the applications (not the node) and cluster it with the other one and then finally the command you're using to start again.
>> 
>> Cheers
>> Tim
>> 
>> On 22 Oct 2012, at 14:04, chetan dev wrote:
>> 
>> > Hi,
>> > I have two nodes clustered together , but when i stop a node using rabbbitmqctl stop command and start the broker with rabbitmq-server detached commnad
>> > now when  i see the cluster status it shows only one broker running while both of the brokers are running fine.
>> > can anybody explain this or tell me what mistake i am making?
>> >
>> > Thanks
>> >
>> >
>> >
>> > --
>> > Cheten  Dev
>> >
>> > B.Tech Final Year
>> > Dept. of Electrical Engg.
>> > IIT Delhi, New Delhi
>> > ph 8527333215
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 
>> -- 
>> Cheten  Dev 
>> 
>> B.Tech Final Year
>> Dept. of Electrical Engg.
>> IIT Delhi, New Delhi
>> ph 8527333215
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> 
> -- 
> Cheten  Dev 
> 
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/01aa6e11/attachment-0001.htm>

------------------------------

Message: 27
Date: Tue, 23 Oct 2012 09:18:22 +0100
From: Tim Watson <watson.timothy at gmail.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ + Messages between virtual
machines and physical hosts on a cloud
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: "rabbitmq-discuss at lists.rabbitmq.com"
<rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <9ACEF152-DE73-41F6-8927-DCA43DC8C2E8 at rabbitmq.com>
Content-Type: text/plain; charset="us-ascii"

Hi

On 22 Oct 2012, at 20:50, Desta Haileselassie Hagos <deshai-0 at student.ltu.se> wrote:

> Dear Sir/Madam,
> 
> The problem is that I am not able to send and receive messages between the Virtual machines and the physical hosts on my cloud. I want to receive full information by manipulating the VMs APIs if it is possible.
> 
> 

Ok, let's try and address one problem at a time. Are you saying that you don't know *how* to configure messaging between hosts using rabbit? If so, I would recommend reading through the tutorials on our website in the first instance, then coming back with any questions you might have.

Or are you saying that youve set up rabbit and/or deployed a messaging client application on these machines, but it is not working as expected? In that case: What are you doing to test sending messages between hosts (virtual or otherwise) - how are your rabbit nodes set up? What client(s) are you using? What version of rabbit? Which os/vsn? Can you post a transcript of the failing commands or application and/or server logs, demonstrating the errors you're encountering?


> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/5d29091c/attachment-0001.htm>

------------------------------

Message: 28
Date: Tue, 23 Oct 2012 09:20:31 +0100
From: Tim Watson <watson.timothy at gmail.com>
Subject: Re: [rabbitmq-discuss] Clustering
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <31488449-99C6-4430-807E-4657D7A9137A at rabbitmq.com>
Content-Type: text/plain; charset=us-ascii

Ah of course - sorry i missed that guys. After so recently looking at the 3.0 cluster commands I'd forgotten that the choice of disk/ram was done that way in 2.8.x. 

On 22 Oct 2012, at 21:26, Matthias Radestock <matthias at rabbitmq.com> wrote:

> On 22/10/12 20:28, chetan dev wrote:
>>>    here is what i am doing
>>>    1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered
> 
> yes, but...
> 
>>> i clustered them as given on rabbitmq clustering documentation for e.g
>>> on the first place both nodes are running
>>> now i stopped app using rabbitmqctl stop_app then i reset that node than
>>> i clusterd that node with another using rabbitmqctl cluster rabbit at SHIKHARM
>>> then i started the node using rabbitmqctl start_app
>>> when i checked the cluster status it was showing fine then i did as i
>>> mentioned earlier
> 
> That will make rabbit at CHETANDEV a *ram* node. To make both nodes disk nodes the node itself would have to be mentioned in the cluster command too, i.e. 'rabbitmqctl cluster rabbit at SHIKHAR rabbit at CHETANDEV'.
> 
>>>    2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
>>>    3. now i start the node rabbit at SHIKHARM using rabbitmq-server
>>>    start commnad
> 
> You have just stopped and restarted the clusters' only disk node. Rabbit clusters won't function properly if they have only ram nodes.
> 
>>>    4. and then i check cluster status it shows only one running node
>>>    Cluster status of node rabbit at CHETANDEV ...
>>>    [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>>>     {running_nodes,[rabbit at CHETANDEV]}]
>>>    ...done.
> 
> Try running that command against rabbit at SHIKHARM. I suspect it will tell you that it only knows about itself.
> 
> Anyway, I suggest you change your cluster configuration s.t. both nodes are disk nodes.
> 
> Regards,
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


------------------------------

Message: 29
Date: Tue, 23 Oct 2012 10:27:40 +0200
From: Michael Justin <michael.justin at gmx.net>
Subject: Re: [rabbitmq-discuss] STOMP plugin - durable subscription
limitation
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <k65kdv$jok$1 at ger.gmane.org>
Content-Type: text/plain; charset=UTF-8; format=flowed

Am 22.10.2012 11:49, Emile Joubert wrote:> Hi Michael,
 >
 > On 21/10/12 09:32, Michael Justin wrote:
 >> So I understand with the frames shown, the clients would use the same
 >> shared queue.
 >>
 >> Does this mean that all waiting messages in the topic will be
 >> distributed between the two clients because of the identical
 >> subscription ID x destination?
 >
 > Yes, this is correct. Both clients will be consuming from the same queue
 > and messages will be distributed between them. You can use the prefetch
 > header to control the distribution:
 >
 > http://www.rabbitmq.com/stomp.html#pear.p

This is interesting - so the behavior of the broker is not undefined, 
and clients could implement load balancing with durable subscribers if 
they all use the same subscription ID (instead of using STOMP queues), 
is this correct (just curious)?

-- 
Michael Justin



------------------------------

Message: 30
Date: Tue, 23 Oct 2012 09:33:26 +0100
From: Tim Watson <watson.timothy at gmail.com>
Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
To: Elizabeth Liao <eliao at seegrid.com>
Cc: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <1EDE5727-72BE-4384-A943-9F79DDB75819 at rabbitmq.com>
Content-Type: text/plain; charset=us-ascii

Hi

On 22 Oct 2012, at 23:14, Elizabeth Liao <eliao at seegrid.com> wrote:

> Hi,
> 
> This is what I tried
> * I start running rabbit with no NODENAME set and entered the following commands
>  * rabbitmqctl stop
>  * /etc/init.d/rabbitmq-server stop
>  * epmd -kill ( Is this correct? I didn't see a restart in the documentation )

That is correct.

>  * In /etc/hosts changed line from 127.0.1.1 <oldhostname> <oldhostname>.localdomain -> 127.0.1.1 <newhostname> <newhostname>.localdomain
>  * in /etc/sysconfig/network changed HOSTNAME=<oldhostname> -> HOSTNAME=<newhostname>
>  * /bin/hostname <newhostname>

At this point I found I needed to log out and back in again, though that was on centos an I'm not sure it's necessary to restart a profile on all operating systems. What os are you running an what does the documentation state about hostname changes? Do you, for example, have to restart the os networking sub system?

> * /etc/init.d/rabbitmq-server start
> 
> The error I get is this:
> Activating RabbitMQ plugins ...
> 3 plugins activated:
> * amqp_client-2.8.6
> * erlando-2.8.6
> * rabbitmq_shovel-2.8.6
> 
> ERROR: epmd error for host "<oldhostname>": nxdomain (non-existing domain)
> 
> 
> 
> ________________________________________
> From: Tim Watson [tim at rabbitmq.com]
> Sent: Monday, October 22, 2012 6:41 AM
> To: Discussions about RabbitMQ
> Cc: Elizabeth Liao
> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
> 
> Hi again,
> 
> On 20 Oct 2012, at 10:52, Tim Watson wrote:
> 
>> Hi Liz,
>> 
>> Sorry i wasn't aware of the context. What Ian recommended should not be necessary, though I'll follow up with him on Monday to try and figure out why he needed to do that.
>> 
>> Once you change the hostname you,ll possibly need to restart epmd and restart your rabbit, but you shouldn't need to change the node name from say rabbit to hare.
>> 
> 
> Were you able to try this again (changing only the host name but not the node name) and did it work for you? If not I'd like to know so we can investigate.
> 
> Cheers
> Tim
> 
>> Cheers
>> Tim
>> 
>> 
>> 
>> On 19 Oct 2012, at 19:44, Elizabeth Liao <eliao at seegrid.com> wrote:
>> 
>>> Hi Tim,
>>> 
>>> I'm going to back up a bit because it seems that I've misunderstood something previously.
>>> 
>>>> The first thing I'm going to say is that this isn't really a desirable
>>> state of affairs. Why do you need to change NODENAME at all, just
>>> because the host name has changed? This seems like an odd step to me -
>>> can you explain the rationale behind it?
>>> 
>>> I had an earlier problem changing the hostname and restarting the rabbitmq-server. The proposed fix was to add the NODENAME variable which I'm guessing was not right? :
>>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021435.html
>>> 
>>>> Can you explain a bit more about this 'bug' please? What exactly is
>>> going wrong?
>>> 
>>> The bug is on our end where the NODENAME is set to an empty string. Of course this is moot if NODENAME doesn't even have to be set in the first place.
>>> 
>>> Liz
>>> ________________________________________
>>> From: Tim Watson [tim at rabbitmq.com]
>>> Sent: Friday, October 19, 2012 12:48 PM
>>> To: Discussions about RabbitMQ
>>> Cc: Elizabeth Liao
>>> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
>>> 
>>> Hi
>>> 
>>> On 10/19/2012 03:41 PM, Elizabeth Liao wrote:
>>>> Hi,
>>>> 
>>>> We are currently running rabbitmq on a system where there is a need to change the hostname occasionally.  Right now, when the hostname is changed, we also update the NODENAME variable in the rabbitmq-env.conf file.
>>> 
>>> The first thing I'm going to say is that this isn't really a desirable
>>> state of affairs. Why do you need to change NODENAME at all, just
>>> because the host name has changed? This seems like an odd step to me -
>>> can you explain the rationale behind it?
>>> 
>>>> The problem we're having right now is that due to a bug when setting up the rabbitmq-env.conf file, sometimes the NODENAME variable exists but is not set to anything ( NODENAME=) so rabbit never successfully starts up.  Even after setting the NODENAME variable to the hostname, rabbit still doesn't start up properly.
>>> 
>>> Can you explain a bit more about this 'bug' please? What exactly is
>>> going wrong?
>>> 
>>>> The only way that I could find to recover from this situation without killing the erlang process, was to also set a MNESIA_DIR variable. After I did that, once the NODENAME was set to the correct hostname, rabbit started up properly.
>>> 
>>> Now this makes no sense at all to me. If you are trying to recover
>>> 'without killing the erlang process' then how are you planning on
>>> changing the NODENAME? Once an erlang node has become part of a
>>> distributed system, you cannot arbitrarily change the node's name
>>> without restarting the net_kernel AFAIK so I can't see how this is even
>>> possible. Also, because you're stating that 'rabbit started up properly'
>>> I'm assuming that you have in fact taken the node offline (using
>>> `rabbitmqctl stop` or one of the various service scripts that invokes
>>> it) and that you are now starting the node again. The rabbit startup
>>> scripts (and associated infrastructure) is not set up to handle changing
>>> the name of a node post-installation in this manner, so I would not
>>> expect this to work smoothly.
>>> 
>>>> A couple of questions:
>>>> Is this the proper way to fix the situation?
>>> 
>>> No. As I said a moment ago, rabbit is not set up for this kind of
>>> scenario so I'd be very cautious about doing this and would really
>>> recommend against it.
>>> 
>>>> Will this have unintended consequences?
>>> 
>>> I have no idea, but it is entirely possible that various things could
>>> break in obscure and alarming ways. I really would not do this if I were
>>> you.
>>> 
>>>> We are running rabbitmq-server-2.8.6 and erlang-R15B.
>>>> 
>>>> Thanks!
>>> 
>>> Liz. I would like to help you find a safe work-around so that you can
>>> use rabbit in your environment. I would really like to understand why
>>> the changing of a machine's host-name is causing problems for you. I
>>> fully realise that after changing the hostname, it is possible that a
>>> restart may be required (although I'd have to do some research to verify
>>> whether or not this is a hard requirement). But I cannot understand why
>>> a change to the machine's host name requires changing the rabbit
>>> NODENAME at all, unless you've altered the rabbit start scripts to use
>>> 'longnames' configuration (i.e., including the complete host name in the
>>> node name) in which case, a simple solution to your problem might be to
>>> switch back to using 'shortnames'. If erlang is started using -sname
>>> rabbit@`hostname -s` and your /etc/hosts configuration supports
>>> resolving the machine's IP to the short version of the name, then
>>> changing the hostname shouldn't cause all of these headaches.
>>> 
>>> For example, if I launch rabbit with something like this:
>>> 
>>> env RABBITMQ_NODENAME=rabbit RABBITMQ_NODE_PORT=5672
>>> RABBITMQ_LOG_BASE="/tmp"
>>> RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia"
>>> RABBITMQ_PID_FILE="/tmp/rabbitmq-rabbit.pid"
>>> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch"
>>> RABBITMQ_ENABLED_PLUGINS_FILE="/tmp/enabled-plugins"
>>> RABBITMQ_CONFIG_FILE="/tmp/etc/rabbit" ./scripts/rabbitmq-server
>>> 
>>> Then change the hostname, then stop rabbit and start it again,
>>> everything is fine.
>>> 
>>> Cheers,
>>> Tim
>>> 
>>>> Liz
>>>> Email Confidentiality Notice
>>>> 
>>>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> 
>>> Email Confidentiality Notice
>>> 
>>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> Email Confidentiality Notice
> 
> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.


------------------------------

Message: 31
Date: Tue, 23 Oct 2012 09:38:50 +0100
From: Tim Watson <watson.timothy at gmail.com>
Subject: Re: [rabbitmq-discuss] Memory leak caused by error_logger in
2.8.6?
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: "rabbitmq-discuss at lists.rabbitmq.com"
<rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <8A746A1E-A89E-420F-BA54-9D27B0E4AE5F at rabbitmq.com>
Content-Type: text/plain; charset=us-ascii

How log does the situation last when this happens? Can you post the logs 'after' the memory goes up unexpectedly - is there any larger terms in there?



On 23 Oct 2012, at 00:05, Travis <hcoyote at ghostar.org> wrote:

> Hello,
> 
> We're seeing large amounts of memory being used in some of our single
> instance 2.8.6 rabbitmq.  When we do a memory
> dump, the output appears to say that error_logger is taking up
> hundreds of megabytes.  For example:
> 
> [{{memory,847631144},
>  <4865.6.0>,
>  [{registered_name,error_logger},
>   {current_function,{gen_event,fetch_msg,5}},
>   {initial_call,{proc_lib,init_p,5}},
>   {status,waiting},
>   {message_queue_len,0},
>   {messages,[]},
>   {links,[<4865.0.0>,<4865.30.0>]},
>   {dictionary,
>    [{{xtype_to_module,topic},rabbit_exchange_type_topic},
>     {'$ancestors',[<4865.2.0>]},
>     {'$initial_call',{gen_event,init_it,6}},
>     {guid,{{36630272,1263673450,3038695659,1008081001},3102285}}]},
>   {trap_exit,true},
>   {error_handler,error_handler},
>   {priority,normal},
>   {group_leader,<4865.30.0>},
>   {total_heap_size,105953765},
>   {heap_size,12538050},
>   {stack_size,8},
>   {reductions,3561515316},
>   {garbage_collection,
>    [{min_bin_vheap_size,46368},
>     {min_heap_size,233},
>     {fullsweep_after,65535},
>     {minor_gcs,578}]},
>   {suspending,[]}]},
> 
> (If more of the dump is needed, I can provide)
> 
> We're a bit perplexed as to what's causing this.  There's nothing odd
> looking in the logs.  For example, we see stuff like this:
> 
> =INFO REPORT==== 22-Oct-2012::18:03:11 ===
> accepting AMQP connection <0.1339.402> (127.0.0.1:32803 -> 127.0.0.1:5672)
> 
> =WARNING REPORT==== 22-Oct-2012::18:03:11 ===
> closing AMQP connection <0.1339.402> (127.0.0.1:32803 -> 127.0.0.1:5672):
> connection_closed_abruptly
> 
> =INFO REPORT==== 22-Oct-2012::18:03:12 ===
> closing AMQP connection <0.1331.402> (127.0.0.1:32796 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:12 ===
> accepting AMQP connection <0.1347.402> (127.0.0.1:32840 -> 127.0.0.1:5672)
> 
> =WARNING REPORT==== 22-Oct-2012::18:03:13 ===
> closing AMQP connection <0.1347.402> (127.0.0.1:32840 -> 127.0.0.1:5672):
> connection_closed_abruptly
> 
> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
> closing AMQP connection <0.32496.401> (127.0.0.1:57108 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
> closing AMQP connection <0.32476.401> (127.0.0.1:57104 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
> closing AMQP connection <0.32492.401> (127.0.0.1:57107 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
> closing AMQP connection <0.32468.401> (127.0.0.1:57103 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:14 ===
> accepting AMQP connection <0.1355.402> (127.0.0.1:32875 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:14 ===
> closing AMQP connection <0.1355.402> (127.0.0.1:32875 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
> accepting AMQP connection <0.1363.402> (127.0.0.1:32898 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
> accepting AMQP connection <0.1371.402> (127.0.0.1:32899 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
> closing AMQP connection <0.1371.402> (127.0.0.1:32899 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
> closing AMQP connection <0.32484.401> (127.0.0.1:57106 -> 127.0.0.1:5672)
> 
> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
> closing AMQP connection <0.32452.401> (127.0.0.1:57081 -> 127.0.0.1:5672)
> 
> =WARNING REPORT==== 22-Oct-2012::18:03:15 ===
> closing AMQP connection <0.1363.402> (127.0.0.1:32898 -> 127.0.0.1:5672):
> connection_closed_abruptly
> 
> 
> Is there a way to tell what's really going on with the error_logger
> and if we're really generating so many messages that it's causing
> memory to balloon so much?
> 
> Travis
> 
> -- 
> Travis Campbell
> travis at ghostar.org
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


------------------------------

Message: 32
Date: Tue, 23 Oct 2012 09:40:46 +0100
From: Tim Watson <watson.timothy at gmail.com>
Subject: Re: [rabbitmq-discuss] RabbitMQ + Messages between virtual
machines and physical hosts on a cloud
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <84B878DB-6611-4FD8-A1AB-BDE520F6385B at rabbitmq.com>
Content-Type: text/plain; charset="us-ascii"

And of course of you have set it up and it's not working, Brett's question (which I foolishly forgot to ask) is perhaps the most important one: is there any firewall between the nodes preventing traffic on the relevant ports from getting through?



On 23 Oct 2012, at 09:18, Tim Watson <watson.timothy at gmail.com> wrote:

> Hi
> 
> On 22 Oct 2012, at 20:50, Desta Haileselassie Hagos <deshai-0 at student.ltu.se> wrote:
> 
>> Dear Sir/Madam,
>> 
>> The problem is that I am not able to send and receive messages between the Virtual machines and the physical hosts on my cloud. I want to receive full information by manipulating the VMs APIs if it is possible.
>> 
>> 
> 
> Ok, let's try and address one problem at a time. Are you saying that you don't know *how* to configure messaging between hosts using rabbit? If so, I would recommend reading through the tutorials on our website in the first instance, then coming back with any questions you might have.
> 
> Or are you saying that youve set up rabbit and/or deployed a messaging client application on these machines, but it is not working as expected? In that case: What are you doing to test sending messages between hosts (virtual or otherwise) - how are your rabbit nodes set up? What client(s) are you using? What version of rabbit? Which os/vsn? Can you post a transcript of the failing commands or application and/or server logs, demonstrating the errors you're encountering?
> 
> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/bbaaf626/attachment-0001.htm>

------------------------------

Message: 33
Date: Tue, 23 Oct 2012 09:42:36 +0100
From: Tim Watson <watson.timothy at gmail.com>
Subject: Re: [rabbitmq-discuss] Memory leak caused by error_logger in
2.8.6?
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <FA9367DD-D418-4E1D-BB68-8E0B1E563CBC at rabbitmq.com>
Content-Type: text/plain; charset=us-ascii

Hi - sorry typing on my phone isn't too reliable....

s/how log/how long/

On 23 Oct 2012, at 09:38, Tim Watson <watson.timothy at gmail.com> wrote:

> How log does the situation last when this happens? Can you post the logs 'after' the memory goes up unexpectedly - is there any larger terms in there?
> 
> 
> 
> On 23 Oct 2012, at 00:05, Travis <hcoyote at ghostar.org> wrote:
> 
>> Hello,
>> 
>> We're seeing large amounts of memory being used in some of our single
>> instance 2.8.6 rabbitmq.  When we do a memory
>> dump, the output appears to say that error_logger is taking up
>> hundreds of megabytes.  For example:
>> 
>> [{{memory,847631144},
>> <4865.6.0>,
>> [{registered_name,error_logger},
>>  {current_function,{gen_event,fetch_msg,5}},
>>  {initial_call,{proc_lib,init_p,5}},
>>  {status,waiting},
>>  {message_queue_len,0},
>>  {messages,[]},
>>  {links,[<4865.0.0>,<4865.30.0>]},
>>  {dictionary,
>>   [{{xtype_to_module,topic},rabbit_exchange_type_topic},
>>    {'$ancestors',[<4865.2.0>]},
>>    {'$initial_call',{gen_event,init_it,6}},
>>    {guid,{{36630272,1263673450,3038695659,1008081001},3102285}}]},
>>  {trap_exit,true},
>>  {error_handler,error_handler},
>>  {priority,normal},
>>  {group_leader,<4865.30.0>},
>>  {total_heap_size,105953765},
>>  {heap_size,12538050},
>>  {stack_size,8},
>>  {reductions,3561515316},
>>  {garbage_collection,
>>   [{min_bin_vheap_size,46368},
>>    {min_heap_size,233},
>>    {fullsweep_after,65535},
>>    {minor_gcs,578}]},
>>  {suspending,[]}]},
>> 
>> (If more of the dump is needed, I can provide)
>> 
>> We're a bit perplexed as to what's causing this.  There's nothing odd
>> looking in the logs.  For example, we see stuff like this:
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:11 ===
>> accepting AMQP connection <0.1339.402> (127.0.0.1:32803 -> 127.0.0.1:5672)
>> 
>> =WARNING REPORT==== 22-Oct-2012::18:03:11 ===
>> closing AMQP connection <0.1339.402> (127.0.0.1:32803 -> 127.0.0.1:5672):
>> connection_closed_abruptly
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:12 ===
>> closing AMQP connection <0.1331.402> (127.0.0.1:32796 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:12 ===
>> accepting AMQP connection <0.1347.402> (127.0.0.1:32840 -> 127.0.0.1:5672)
>> 
>> =WARNING REPORT==== 22-Oct-2012::18:03:13 ===
>> closing AMQP connection <0.1347.402> (127.0.0.1:32840 -> 127.0.0.1:5672):
>> connection_closed_abruptly
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
>> closing AMQP connection <0.32496.401> (127.0.0.1:57108 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
>> closing AMQP connection <0.32476.401> (127.0.0.1:57104 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
>> closing AMQP connection <0.32492.401> (127.0.0.1:57107 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:13 ===
>> closing AMQP connection <0.32468.401> (127.0.0.1:57103 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:14 ===
>> accepting AMQP connection <0.1355.402> (127.0.0.1:32875 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:14 ===
>> closing AMQP connection <0.1355.402> (127.0.0.1:32875 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
>> accepting AMQP connection <0.1363.402> (127.0.0.1:32898 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
>> accepting AMQP connection <0.1371.402> (127.0.0.1:32899 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
>> closing AMQP connection <0.1371.402> (127.0.0.1:32899 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
>> closing AMQP connection <0.32484.401> (127.0.0.1:57106 -> 127.0.0.1:5672)
>> 
>> =INFO REPORT==== 22-Oct-2012::18:03:15 ===
>> closing AMQP connection <0.32452.401> (127.0.0.1:57081 -> 127.0.0.1:5672)
>> 
>> =WARNING REPORT==== 22-Oct-2012::18:03:15 ===
>> closing AMQP connection <0.1363.402> (127.0.0.1:32898 -> 127.0.0.1:5672):
>> connection_closed_abruptly
>> 
>> 
>> Is there a way to tell what's really going on with the error_logger
>> and if we're really generating so many messages that it's causing
>> memory to balloon so much?
>> 
>> Travis
>> 
>> -- 
>> Travis Campbell
>> travis at ghostar.org
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


------------------------------

Message: 34
Date: Tue, 23 Oct 2012 14:16:10 +0530
From: chetan dev <dev440 at gmail.com>
Subject: Re: [rabbitmq-discuss] Clustering
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
<CAB0ZxM7WUWg2Z6RRupkfOcaSwabKpGki6AN1PTLhcX5DpxJa=w at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Hi,

Thanks you very much for this information
another problem i am facing is i have two nodes clustered lets say
rabbit at SHIKHARM(ram) and rabbit at CHETANDEV(disc)
now if i stop rabbit at SHIKHARM using rabbitmwctl stop command  and then i
stop  rabbit at CHETANDEV  using stop_app command and then reset it this way i
remove it from cluster and restart the node
now rabbit at CHETANDEV starts and works fine but when i try to start
rabbit at SHIKHARM it fails .
i think it is trying to cluster with rabbit at CHETANDEV but that node is now
not in cluster but is there a way so that i can reset rabbit at SHIKHARM and
start it normally
here is the error that i got:
node           : rabbit at SHIKHARM
app descriptor : c:/Program Files/RabbitMQ
Server/rabbitmq_server-2.8.6/sbin/../
ebin/rabbit.app
home dir       : C:\Users\Acer
config file(s) : (none)
cookie hash    : +3xbT32/GKScN3yhCcE0Ag==
log            :
C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
sasl log       :
C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl
.log
database dir   :
c:/Users/Acer/AppData/Roaming/RabbitMQ/db/rabbit at SHIKHARM-mnesi
a
erlang version : 5.9.1

-- rabbit boot start
starting file handle cache server
...done
starting worker pool
 ...done
starting database                                                     ...

BOOT FAILED
===========

Error description:
   {error,{failed_to_cluster_with,[rabbit at CHETANDEV],
                                  "Mnesia could not connect to any disc
nodes."}
}

Log files (may contain more information):
   C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
   C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl.log

Stack trace:
   [{rabbit_mnesia,init_db,3,[]},
    {rabbit_mnesia,init,0,[]},
    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
    {rabbit,run_boot_step,1,[]},
    {rabbit,'-start/2-lc$^0/1-0-',1,[]},
    {rabbit,start,2,[]},
    {application_master,start_it_old,4,
                        [{file,"application_master.erl"},{line,274}]}]

{"Kernel pid
terminated",application_controller,"{application_start_failure,rabb
it,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}
}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller)
({application_start_failure,rabbi
t,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}
}})



Thanks





On Tue, Oct 23, 2012 at 1:50 PM, Tim Watson <watson.timothy at gmail.com>wrote:

> Ah of course - sorry i missed that guys. After so recently looking at the
> 3.0 cluster commands I'd forgotten that the choice of disk/ram was done
> that way in 2.8.x.
>
> On 22 Oct 2012, at 21:26, Matthias Radestock <matthias at rabbitmq.com>
> wrote:
>
> > On 22/10/12 20:28, chetan dev wrote:
> >>>    here is what i am doing
> >>>    1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered
> >
> > yes, but...
> >
> >>> i clustered them as given on rabbitmq clustering documentation for e.g
> >>> on the first place both nodes are running
> >>> now i stopped app using rabbitmqctl stop_app then i reset that node
> than
> >>> i clusterd that node with another using rabbitmqctl cluster
> rabbit at SHIKHARM
> >>> then i started the node using rabbitmqctl start_app
> >>> when i checked the cluster status it was showing fine then i did as i
> >>> mentioned earlier
> >
> > That will make rabbit at CHETANDEV a *ram* node. To make both nodes disk
> nodes the node itself would have to be mentioned in the cluster command
> too, i.e. 'rabbitmqctl cluster rabbit at SHIKHAR rabbit at CHETANDEV'.
> >
> >>>    2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
> >>>    3. now i start the node rabbit at SHIKHARM using rabbitmq-server
> >>>    start commnad
> >
> > You have just stopped and restarted the clusters' only disk node. Rabbit
> clusters won't function properly if they have only ram nodes.
> >
> >>>    4. and then i check cluster status it shows only one running node
> >>>    Cluster status of node rabbit at CHETANDEV ...
> >>>    [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
> >>>     {running_nodes,[rabbit at CHETANDEV]}]
> >>>    ...done.
> >
> > Try running that command against rabbit at SHIKHARM. I suspect it will
> tell you that it only knows about itself.
> >
> > Anyway, I suggest you change your cluster configuration s.t. both nodes
> are disk nodes.
> >
> > Regards,
> >
> > Matthias.
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/1830ac65/attachment-0001.htm>

------------------------------

Message: 35
Date: Tue, 23 Oct 2012 10:48:17 +0200
From: Michael Justin <michael.justin at gmx.net>
Subject: [rabbitmq-discuss] STOMP 1.0 adapter escapes colon as \c
(STOMP 1.1 style)
To: rabbitmq-discuss at lists.rabbitmq.com
Message-ID: <k65lkj$uhe$1 at ger.gmane.org>
Content-Type: text/plain; charset=UTF-8; format=flowed

Hello,

a test showed that a colon in a SEND frame will be escaped STOMP 
1.1-style as \c, so this

SEND
destination:/queue/ExampleQueue
testcolon1:a:test

will be received as:

MESSAGE
destination:/queue/ExampleQueue
testcolon1:a\ctest

Is this as designed? The STOMP plugin page does not cover this escape 
mechanism, which was introduced with STOMP 1.1


I also noticed that messages with header line which contains a backslash 
seem to be dropped on the broker side:

SEND
destination:/queue/ExampleQueue
testbackslash:\x

-> the message does not appear in the Management console


Regards
-- 
Michael Justin
habarisoft - Enterprise Messaging Software for Delphi
http://www.habarisoft.com/



------------------------------

Message: 36
Date: Tue, 23 Oct 2012 10:13:53 +0100
From: Emile Joubert <emile at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] How to structure Master with many
slaves? RPC??
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: theBuckWheat <tbw at rg6.org>
Message-ID: <50865FD1.7040305 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1

Hi,

On 23/10/12 01:41, theBuckWheat wrote:
> I have a SETI-like slave pool, but I maintain the list of which slaves I want
> to send work to and which are kept idle.  The slave does the work assigned
> and prepares the response dataset to be sent back..   
> 
> Question: since I may turn on a slave to accept some work and later take
> others out of the pool dynamically, what is the best RabbitMQ queue
> topology?  RPC?

If the slaves are interchangeable and you don't care about separating
different types of work items then you only need one work queue and one
response queue. Slaves all consume from the same shared work queue and
send completed work to the shared response queue in this scenario. This
corresponds to the pattern in tutorial 2 and 6:
http://www.rabbitmq.com/tutorials/tutorial-two-python.html
http://www.rabbitmq.com/tutorials/tutorial-six-python.html


-Emile



------------------------------

Message: 37
Date: Tue, 23 Oct 2012 10:08:28 +0100
From: Tim Watson <tim at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Clustering
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <50865E8C.3070906 at rabbitmq.com>
Content-Type: text/plain; charset="iso-8859-1"; Format="flowed"

Don't do that - take the second node out of the cluster whilst the other 
node(s) are still running, so that they can see it leaving. See the 
clustering transcripts in http://www.rabbitmq.com/clustering.html for 
details.

On 10/23/2012 09:46 AM, chetan dev wrote:
> Hi,
>
> Thanks you very much for this information
> another problem i am facing is i have two nodes clustered lets say 
> rabbit at SHIKHARM(ram) and rabbit at CHETANDEV(disc)
> now if i stop rabbit at SHIKHARM using rabbitmwctl stop command  and then 
> i stop  rabbit at CHETANDEV  using stop_app command and then reset it 
> this way i remove it from cluster and restart the node
> now rabbit at CHETANDEV starts and works fine but when i try to start 
> rabbit at SHIKHARM it fails .
> i think it is trying to cluster with rabbit at CHETANDEV but that node is 
> now not in cluster but is there a way so that i can reset 
> rabbit at SHIKHARM and start it normally
> here is the error that i got:
> node           : rabbit at SHIKHARM
> app descriptor : c:/Program Files/RabbitMQ 
> Server/rabbitmq_server-2.8.6/sbin/../
> ebin/rabbit.app
> home dir       : C:\Users\Acer
> config file(s) : (none)
> cookie hash    : +3xbT32/GKScN3yhCcE0Ag==
> log            : 
> C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
> sasl log       : 
> C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl
> .log
> database dir   : 
> c:/Users/Acer/AppData/Roaming/RabbitMQ/db/rabbit at SHIKHARM-mnesi
> a
> erlang version : 5.9.1
>
> -- rabbit boot start
> starting file handle cache server                                     
> ...done
> starting worker pool                                                 
>  ...done
> starting database                                                     ...
>
> BOOT FAILED
> ===========
>
> Error description:
>    {error,{failed_to_cluster_with,[rabbit at CHETANDEV],
>                                   "Mnesia could not connect to any 
> disc nodes."}
> }
>
> Log files (may contain more information):
>    C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
>    C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl.log
>
> Stack trace:
>    [{rabbit_mnesia,init_db,3,[]},
>     {rabbit_mnesia,init,0,[]},
>     {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
>     {rabbit,run_boot_step,1,[]},
>     {rabbit,'-start/2-lc$^0/1-0-',1,[]},
>     {rabbit,start,2,[]},
>     {application_master,start_it_old,4,
>                         [{file,"application_master.erl"},{line,274}]}]
>
> {"Kernel pid 
> terminated",application_controller,"{application_start_failure,rabb
> it,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}
> }}}"}
>
> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller) 
> ({application_start_failure,rabbi
> t,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}
> }})
>
>
>
> Thanks
>
>
>
>
>
> On Tue, Oct 23, 2012 at 1:50 PM, Tim Watson <watson.timothy at gmail.com 
> <mailto:watson.timothy at gmail.com>> wrote:
>
>     Ah of course - sorry i missed that guys. After so recently looking
>     at the 3.0 cluster commands I'd forgotten that the choice of
>     disk/ram was done that way in 2.8.x.
>
>     On 22 Oct 2012, at 21:26, Matthias Radestock
>     <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>
>     > On 22/10/12 20:28, chetan dev wrote:
>     >>>    here is what i am doing
>     >>>    1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered
>     >
>     > yes, but...
>     >
>     >>> i clustered them as given on rabbitmq clustering documentation
>     for e.g
>     >>> on the first place both nodes are running
>     >>> now i stopped app using rabbitmqctl stop_app then i reset that
>     node than
>     >>> i clusterd that node with another using rabbitmqctl cluster
>     rabbit at SHIKHARM
>     >>> then i started the node using rabbitmqctl start_app
>     >>> when i checked the cluster status it was showing fine then i
>     did as i
>     >>> mentioned earlier
>     >
>     > That will make rabbit at CHETANDEV a *ram* node. To make both nodes
>     disk nodes the node itself would have to be mentioned in the
>     cluster command too, i.e. 'rabbitmqctl cluster rabbit at SHIKHAR
>     rabbit at CHETANDEV'.
>     >
>     >>>    2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop
>     commnad
>     >>>    3. now i start the node rabbit at SHIKHARM using rabbitmq-server
>     >>>    start commnad
>     >
>     > You have just stopped and restarted the clusters' only disk
>     node. Rabbit clusters won't function properly if they have only
>     ram nodes.
>     >
>     >>>    4. and then i check cluster status it shows only one
>     running node
>     >>>    Cluster status of node rabbit at CHETANDEV ...
>     >>>    [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>     >>>     {running_nodes,[rabbit at CHETANDEV]}]
>     >>>    ...done.
>     >
>     > Try running that command against rabbit at SHIKHARM. I suspect it
>     will tell you that it only knows about itself.
>     >
>     > Anyway, I suggest you change your cluster configuration s.t.
>     both nodes are disk nodes.
>     >
>     > Regards,
>     >
>     > Matthias.
>     > _______________________________________________
>     > rabbitmq-discuss mailing list
>     > rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> -- 
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/7ad3d6e3/attachment-0001.htm>

------------------------------

Message: 38
Date: Tue, 23 Oct 2012 10:18:52 +0100
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Memory leak caused by error_logger in
2.8.6?
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <508660FC.8020706 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

On 23/10/12 00:05, Travis wrote:
>     {total_heap_size,105953765},
>     {heap_size,12538050},

> Is there a way to tell what's really going on with the error_logger
> and if we're really generating so many messages that it's causing
> memory to balloon so much?

Hmm.

Looks like it is progressing too slowly towards GC; what happens if you 
GC it manually?

We are considering adding some background process that will GC the 
biggest process every so often, since it seems to be possible to end up 
with processes that consume a lot of memory but haven't chalked up 
enough reductions to get GCed.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware


------------------------------

Message: 39
Date: Tue, 23 Oct 2012 14:51:15 +0530
From: chetan dev <dev440 at gmail.com>
Subject: Re: [rabbitmq-discuss] Clustering
To: Tim Watson <tim at rabbitmq.com>
Cc: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID:
<CAB0ZxM5xb-dPXybW4wq0V+6cG1y2MEznbzue-1gCFHFy5ZTU_w at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Yes , but now the node is failing to start because it is not able to find
other node for clustering
so how do i reset this node to run it normally?

Thanks

On Tue, Oct 23, 2012 at 2:38 PM, Tim Watson <tim at rabbitmq.com> wrote:

>  Don't do that - take the second node out of the cluster whilst the other
> node(s) are still running, so that they can see it leaving. See the
> clustering transcripts in http://www.rabbitmq.com/clustering.html for
> details.
>
>
> On 10/23/2012 09:46 AM, chetan dev wrote:
>
> Hi,
>
>  Thanks you very much for this information
> another problem i am facing is i have two nodes clustered lets say
> rabbit at SHIKHARM(ram) and rabbit at CHETANDEV(disc)
> now if i stop rabbit at SHIKHARM using rabbitmwctl stop command  and then i
> stop  rabbit at CHETANDEV  using stop_app command and then reset it this way
> i remove it from cluster and restart the node
> now rabbit at CHETANDEV starts and works fine but when i try to start
> rabbit at SHIKHARM it fails .
> i think it is trying to cluster with rabbit at CHETANDEV but that node is
> now not in cluster but is there a way so that i can reset rabbit at SHIKHARMand start it normally
> here is the error that i got:
>  node           : rabbit at SHIKHARM
> app descriptor : c:/Program Files/RabbitMQ
> Server/rabbitmq_server-2.8.6/sbin/../
> ebin/rabbit.app
> home dir       : C:\Users\Acer
> config file(s) : (none)
> cookie hash    : +3xbT32/GKScN3yhCcE0Ag==
> log            :
> C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
> sasl log       :
> C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl
> .log
> database dir   :
> c:/Users/Acer/AppData/Roaming/RabbitMQ/db/rabbit at SHIKHARM-mnesi
> a
> erlang version : 5.9.1
>
>  -- rabbit boot start
> starting file handle cache server
> ...done
> starting worker pool
>  ...done
> starting database                                                     ...
>
>  BOOT FAILED
> ===========
>
>  Error description:
>    {error,{failed_to_cluster_with,[rabbit at CHETANDEV],
>                                   "Mnesia could not connect to any disc
> nodes."}
> }
>
>  Log files (may contain more information):
>    C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
>    C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl.log
>
>  Stack trace:
>    [{rabbit_mnesia,init_db,3,[]},
>     {rabbit_mnesia,init,0,[]},
>     {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
>     {rabbit,run_boot_step,1,[]},
>     {rabbit,'-start/2-lc$^0/1-0-',1,[]},
>     {rabbit,start,2,[]},
>     {application_master,start_it_old,4,
>                         [{file,"application_master.erl"},{line,274}]}]
>
>  {"Kernel pid
> terminated",application_controller,"{application_start_failure,rabb
>
> it,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}
> }}}"}
>
>  Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,rabbi
>
> t,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}
> }})
>
>
>
>  Thanks
>
>
>
>
>
> On Tue, Oct 23, 2012 at 1:50 PM, Tim Watson <watson.timothy at gmail.com>wrote:
>
>> Ah of course - sorry i missed that guys. After so recently looking at the
>> 3.0 cluster commands I'd forgotten that the choice of disk/ram was done
>> that way in 2.8.x.
>>
>> On 22 Oct 2012, at 21:26, Matthias Radestock <matthias at rabbitmq.com>
>> wrote:
>>
>> > On 22/10/12 20:28, chetan dev wrote:
>> >>>    here is what i am doing
>> >>>    1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are clustered
>> >
>> > yes, but...
>> >
>> >>> i clustered them as given on rabbitmq clustering documentation for e.g
>> >>> on the first place both nodes are running
>> >>> now i stopped app using rabbitmqctl stop_app then i reset that node
>> than
>> >>> i clusterd that node with another using rabbitmqctl cluster
>> rabbit at SHIKHARM
>> >>> then i started the node using rabbitmqctl start_app
>> >>> when i checked the cluster status it was showing fine then i did as i
>> >>> mentioned earlier
>> >
>> > That will make rabbit at CHETANDEV a *ram* node. To make both nodes disk
>> nodes the node itself would have to be mentioned in the cluster command
>> too, i.e. 'rabbitmqctl cluster rabbit at SHIKHAR rabbit at CHETANDEV'.
>> >
>> >>>    2. now i stop node rabbit at SHIKHARM using  rabbitmqctl stop commnad
>> >>>    3. now i start the node rabbit at SHIKHARM using rabbitmq-server
>> >>>    start commnad
>> >
>> > You have just stopped and restarted the clusters' only disk node.
>> Rabbit clusters won't function properly if they have only ram nodes.
>> >
>> >>>    4. and then i check cluster status it shows only one running node
>> >>>    Cluster status of node rabbit at CHETANDEV ...
>> >>>    [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>> >>>     {running_nodes,[rabbit at CHETANDEV]}]
>> >>>    ...done.
>> >
>> > Try running that command against rabbit at SHIKHARM. I suspect it will
>> tell you that it only knows about itself.
>> >
>> > Anyway, I suggest you change your cluster configuration s.t. both nodes
>> are disk nodes.
>> >
>> > Regards,
>> >
>> > Matthias.
>>   > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
>
>  --
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>


-- 
Cheten  Dev

B.Tech Final Year
Dept. of Electrical Engg.
IIT Delhi, New Delhi
ph 8527333215
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/51afb9ec/attachment-0001.htm>

------------------------------

Message: 40
Date: Tue, 23 Oct 2012 10:28:58 +0100
From: Simon MacMullen <simon at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Upgrading RabbitMQ2.8.6
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: Matt Long <matt at crocodoc.com>
Message-ID: <5086635A.3000407 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1; format=flowed

Somewhat on purpose - due to the vagaries of our build system, we treat 
the apt repository as just another build artefact, so it gets created 
from scratch each time. I know this is not ideal.

If you want to pin to a particular version you will need to download the 
deb directly.

Cheers, Simon

On 22/10/12 17:07, Matt Long wrote:
> While we're on the topic of older versions, it appears they are removed
> from the RabbitMQ APT repository; only the newest version is ever
> available. Is this done on purpose? It has led to some issues for us
> since we specify explicit package versions in our provisioning system
> and occasionally they'll no longer be there!
>
> Thanks,
> Matt
>
> On Mon, Oct 22, 2012 at 4:21 AM, Matthias Radestock
> <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>
>     On 19/10/12 10:24, PSL 88506 wrote:
>
>         When i try to understand about installation procedure for 2.8.6
>
>         All links are getting redirected to same page with following URL:
>         http://www.rabbitmq.com/__download.html
>         <http://www.rabbitmq.com/download.html>
>
>
>     Links will always point to the latest version, which is 2.8.7. I
>     recommend you install that rather than 2.8.6. If you really must
>     install 2.8.6, follow the "Older Versions / Download" link on the
>     download.html page.
>
>
>     Regards,
>
>     Matthias.
>     _________________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.__rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>     <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>
>
> --
> Matt Long
> Cofounder and Lead Developer
> crocodoc.com <http://crocodoc.com/>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware


------------------------------

Message: 41
Date: Tue, 23 Oct 2012 10:31:32 +0100
From: Tim Watson <tim at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Clustering
To: chetan dev <dev440 at gmail.com>
Cc: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <508663F4.3040507 at rabbitmq.com>
Content-Type: text/plain; charset="iso-8859-1"; Format="flowed"

Post me the *exact* commands you're using on each node, in sequence 
please. If you follow the 'Breaking up a cluster' transcript from 
http://www.rabbitmq.com/clustering.html then you should not have *any* 
problems. In particular, note the use of 'force_reset' on the surviving 
node, so that it does not attempt to connect to nodes that are no longer 
part of the cluster - who's residual configuration is still present on 
the extant node we're now resetting.

On 10/23/2012 10:21 AM, chetan dev wrote:
> Yes , but now the node is failing to start because it is not able to 
> find other node for clustering
> so how do i reset this node to run it normally?
>
> Thanks
>
> On Tue, Oct 23, 2012 at 2:38 PM, Tim Watson <tim at rabbitmq.com 
> <mailto:tim at rabbitmq.com>> wrote:
>
>     Don't do that - take the second node out of the cluster whilst the
>     other node(s) are still running, so that they can see it leaving.
>     See the clustering transcripts in
>     http://www.rabbitmq.com/clustering.html for details.
>
>
>     On 10/23/2012 09:46 AM, chetan dev wrote:
>>     Hi,
>>
>>     Thanks you very much for this information
>>     another problem i am facing is i have two nodes clustered lets
>>     say rabbit at SHIKHARM(ram) and rabbit at CHETANDEV(disc)
>>     now if i stop rabbit at SHIKHARM using rabbitmwctl stop command  and
>>     then i stop  rabbit at CHETANDEV  using stop_app command and then
>>     reset it this way i remove it from cluster and restart the node
>>     now rabbit at CHETANDEV starts and works fine but when i try to
>>     start rabbit at SHIKHARM it fails .
>>     i think it is trying to cluster with rabbit at CHETANDEV but that
>>     node is now not in cluster but is there a way so that i can reset
>>     rabbit at SHIKHARM and start it normally
>>     here is the error that i got:
>>     node           : rabbit at SHIKHARM
>>     app descriptor : c:/Program Files/RabbitMQ
>>     Server/rabbitmq_server-2.8.6/sbin/../
>>     ebin/rabbit.app
>>     home dir       : C:\Users\Acer
>>     config file(s) : (none)
>>     cookie hash    : +3xbT32/GKScN3yhCcE0Ag==
>>     log            :
>>     C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
>>     <mailto:C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log>
>>     sasl log       :
>>     C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl
>>     .log
>>     database dir   :
>>     c:/Users/Acer/AppData/Roaming/RabbitMQ/db/rabbit at SHIKHARM-mnesi
>>     a
>>     erlang version : 5.9.1
>>
>>     -- rabbit boot start
>>     starting file handle cache server                                
>>         ...done
>>     starting worker pool                                            
>>          ...done
>>     starting database                                                
>>         ...
>>
>>     BOOT FAILED
>>     ===========
>>
>>     Error description:
>>        {error,{failed_to_cluster_with,[rabbit at CHETANDEV],
>>                                       "Mnesia could not connect to
>>     any disc nodes."}
>>     }
>>
>>     Log files (may contain more information):
>>     C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log
>>     <mailto:C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM.log>
>>     C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl.log
>>     <mailto:C:/Users/Acer/AppData/Roaming/RabbitMQ/log/rabbit at SHIKHARM-sasl.log>
>>
>>     Stack trace:
>>        [{rabbit_mnesia,init_db,3,[]},
>>         {rabbit_mnesia,init,0,[]},
>>         {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},
>>         {rabbit,run_boot_step,1,[]},
>>         {rabbit,'-start/2-lc$^0/1-0-',1,[]},
>>         {rabbit,start,2,[]},
>>         {application_master,start_it_old,4,
>>                            
>>     [{file,"application_master.erl"},{line,274}]}]
>>
>>     {"Kernel pid
>>     terminated",application_controller,"{application_start_failure,rabb
>>     it,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}
>>     }}}"}
>>
>>     Crash dump was written to: erl_crash.dump
>>     Kernel pid terminated (application_controller)
>>     ({application_start_failure,rabbi
>>     t,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}
>>     }})
>>
>>
>>
>>     Thanks
>>
>>
>>
>>
>>
>>     On Tue, Oct 23, 2012 at 1:50 PM, Tim Watson
>>     <watson.timothy at gmail.com <mailto:watson.timothy at gmail.com>> wrote:
>>
>>         Ah of course - sorry i missed that guys. After so recently
>>         looking at the 3.0 cluster commands I'd forgotten that the
>>         choice of disk/ram was done that way in 2.8.x.
>>
>>         On 22 Oct 2012, at 21:26, Matthias Radestock
>>         <matthias at rabbitmq.com <mailto:matthias at rabbitmq.com>> wrote:
>>
>>         > On 22/10/12 20:28, chetan dev wrote:
>>         >>>    here is what i am doing
>>         >>>    1. two nodes rabbit at SHIKHARM and rabbit at CHETANDEV are
>>         clustered
>>         >
>>         > yes, but...
>>         >
>>         >>> i clustered them as given on rabbitmq clustering
>>         documentation for e.g
>>         >>> on the first place both nodes are running
>>         >>> now i stopped app using rabbitmqctl stop_app then i reset
>>         that node than
>>         >>> i clusterd that node with another using rabbitmqctl
>>         cluster rabbit at SHIKHARM
>>         >>> then i started the node using rabbitmqctl start_app
>>         >>> when i checked the cluster status it was showing fine
>>         then i did as i
>>         >>> mentioned earlier
>>         >
>>         > That will make rabbit at CHETANDEV a *ram* node. To make both
>>         nodes disk nodes the node itself would have to be mentioned
>>         in the cluster command too, i.e. 'rabbitmqctl cluster
>>         rabbit at SHIKHAR rabbit at CHETANDEV'.
>>         >
>>         >>>    2. now i stop node rabbit at SHIKHARM using  rabbitmqctl
>>         stop commnad
>>         >>>    3. now i start the node rabbit at SHIKHARM using
>>         rabbitmq-server
>>         >>>    start commnad
>>         >
>>         > You have just stopped and restarted the clusters' only disk
>>         node. Rabbit clusters won't function properly if they have
>>         only ram nodes.
>>         >
>>         >>>    4. and then i check cluster status it shows only one
>>         running node
>>         >>>    Cluster status of node rabbit at CHETANDEV ...
>>         >>>  
>>          [{nodes,[{disc,[rabbit at SHIKHARM]},{ram,[rabbit at CHETANDEV]}]},
>>         >>>     {running_nodes,[rabbit at CHETANDEV]}]
>>         >>>    ...done.
>>         >
>>         > Try running that command against rabbit at SHIKHARM. I suspect
>>         it will tell you that it only knows about itself.
>>         >
>>         > Anyway, I suggest you change your cluster configuration
>>         s.t. both nodes are disk nodes.
>>         >
>>         > Regards,
>>         >
>>         > Matthias.
>>         > _______________________________________________
>>         > rabbitmq-discuss mailing list
>>         > rabbitmq-discuss at lists.rabbitmq.com
>>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>         >
>>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>         _______________________________________________
>>         rabbitmq-discuss mailing list
>>         rabbitmq-discuss at lists.rabbitmq.com
>>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>         https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>>     -- 
>>     Cheten  Dev
>>
>>     B.Tech Final Year
>>     Dept. of Electrical Engg.
>>     IIT Delhi, New Delhi
>>     ph 8527333215
>>
>>
>>
>>     _______________________________________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.rabbitmq.com  <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> -- 
> Cheten  Dev
>
> B.Tech Final Year
> Dept. of Electrical Engg.
> IIT Delhi, New Delhi
> ph 8527333215
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/27fa243d/attachment-0001.htm>

------------------------------

Message: 42
Date: Tue, 23 Oct 2012 11:05:50 +0100
From: Emile Joubert <emile at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] STOMP 1.0 adapter escapes colon as \c
(STOMP 1.1 style)
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: Michael Justin <michael.justin at gmx.net>
Message-ID: <50866BFE.9060605 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1


Hi Michael,

On 23/10/12 09:48, Michael Justin wrote:
> Hello,
> 
> a test showed that a colon in a SEND frame will be escaped STOMP 
> 1.1-style as \c, so this
> 
> SEND
> destination:/queue/ExampleQueue
> testcolon1:a:test
> 
> will be received as:
> 
> MESSAGE
> destination:/queue/ExampleQueue
> testcolon1:a\ctest
> 
> Is this as designed? The STOMP plugin page does not cover this escape 
> mechanism, which was introduced with STOMP 1.1

The only difference in framing between 1.0 and 1.1 in the RabbitMQ STOMP
implementation at present is trimming. If the negotiated version is 1.0
then headers are trimmed. Only 1.1 frame parsing is implemented, under
the assumption that this is backwards-compatible.

Are you relying on the STOMP 1.0 behaviour w.r.t colons in header values?

> I also noticed that messages with header line which contains a backslash 
> seem to be dropped on the broker side:
> 
> SEND
> destination:/queue/ExampleQueue
> testbackslash:\x
> 
> -> the message does not appear in the Management console

This is compatible with 1.1, which says that undefined escape sequences
must be treated as a fatal protocol error.

We'd be interested in your opinion of how important strict STOMP 1.0
framing support is to help us decide whether to invest in that effort or
focus on 1.2 instead.


-Emile




------------------------------

Message: 43
Date: Tue, 23 Oct 2012 11:18:11 +0100
From: Emile Joubert <emile at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] STOMP plugin - durable subscription
limitation
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Cc: Michael Justin <michael.justin at gmx.net>
Message-ID: <50866EE3.4000409 at rabbitmq.com>
Content-Type: text/plain; charset=ISO-8859-1

On 23/10/12 09:27, Michael Justin wrote:
> This is interesting - so the behavior of the broker is not undefined, 
> and clients could implement load balancing with durable subscribers if 
> they all use the same subscription ID (instead of using STOMP queues), 
> is this correct (just curious)?

Yes, I don't see anything preventing it being used in that way.


-Emile






------------------------------

Message: 44
Date: Tue, 23 Oct 2012 11:29:57 +0100
From: Tim Watson <tim at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Channel thread-safety
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <508671A5.6050007 at rabbitmq.com>
Content-Type: text/plain; charset="iso-8859-1"; Format="flowed"

Actually, that's not quite right. Channels *are* thread safe in the 
java-client, and can be shared across multiple threads if you wish. As 
the Java client API documentation 
(http://www.rabbitmq.com/api-guide.html) states however:

"Channel instances are safe for use by multiple threads. Requests into a 
Channel are serialized, with only one thread being able to run a command 
on the Channel at a time. Even so, applications should prefer using a 
Channel per thread instead of sharing the same Channel across multiple 
threads."

In other words, because the transmission of AMQP commands via a given 
Channel is serialised, there is probably little or no benefit in sharing 
the channel between threads.

Unfortunately, whilst we've updated the documentation on the website to 
reflect this change (which was merged in September 2011 and released in 
2.7.0) we appear to have missed the javadocs for the Channel class - I 
will get that fixed asap so as to avoid any further confusion!

Cheers,
Tim

On 10/23/2012 02:08 AM, Laurent Vauthrin wrote:
> Thanks for clearing that up!
>
> On Mon, Oct 22, 2012 at 3:46 PM, Michael Klishin 
> <michael.s.klishin at gmail.com <mailto:michael.s.klishin at gmail.com>> wrote:
>
>
>
>     2012/10/22 Laurent Vauthrin <lvauthrin at gmail.com
>     <mailto:lvauthrin at gmail.com>>
>
>         My questions are:
>         1. Should we be using a channel per thread considering that
>         we're synchronizing the basicPublish call anyway?
>
>
>     Yes. Channels are just integer on the wire and a little bit of
>     memory allocated on the JVM heap. They are very cheap
>     for all intents and purposes and you are much more likely to max
>     out your OS and hardware resources (assuming 1 channel per JVM
>     thread) before
>     you run into issues with channel objects.
>
>         2. Can we just share one channel across all threads and not
>         synchronize the call to basicPublish?
>
>
>
>     No. The real issue with shared channels is that large messages
>     will result in multiple protocol frames being sent
>     for a single basicPublish operation. When publishing on the same
>     channel from multiple threads, this may result
>     in frames being delivered out of order:
>
>     T1 => basicPublish => [Frame11] [Frame12] [Frame13]
>     T2 => basicPublish => [Frame21] [Frame22] [Frame23]
>
>     may result in the following delivery order, all on the same channel:
>
>     [Frame11][Frame21][Frame12][Frame13][Frame22][Frame23]
>
>     and because all frames are on the same channel, RabbitMQ won't be
>     able to tell how to reconstruct your messages.
>     -- 
>     MK
>
>     http://github.com/michaelklishin
>     http://twitter.com/michaelklishin
>
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/5eefd15e/attachment-0001.htm>

------------------------------

Message: 45
Date: Tue, 23 Oct 2012 11:42:58 +0100
From: Tim Watson <tim at rabbitmq.com>
Subject: Re: [rabbitmq-discuss] Channel thread-safety
To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
Message-ID: <508674B2.8050706 at rabbitmq.com>
Content-Type: text/plain; charset="iso-8859-1"; Format="flowed"

Important addendum: channel calls are *not* thread-safe for 
confirmations: The channel interface is thread-safe now, except for 
counting confirms and checking!

There is an outstanding bug to review this, and the problems associated 
with the fact that publishing and receiving a seqno is not an atomic 
operation.

Anyway - you *may* wish to share a Channel between threads or not, but 
if you're using confirms then you should *not* share a Channel between 
multiple threads. I'll make sure the javadoc changes reflect this state 
of affairs.

Cheers,
Tim

On 10/23/2012 11:29 AM, Tim Watson wrote:
> Actually, that's not quite right. Channels *are* thread safe in the 
> java-client, and can be shared across multiple threads if you wish. As 
> the Java client API documentation 
> (http://www.rabbitmq.com/api-guide.html) states however:
>
> "Channel instances are safe for use by multiple threads. Requests into 
> a Channel are serialized, with only one thread being able to run a 
> command on the Channel at a time. Even so, applications should prefer 
> using a Channel per thread instead of sharing the same Channel across 
> multiple threads."
>
> In other words, because the transmission of AMQP commands via a given 
> Channel is serialised, there is probably little or no benefit in 
> sharing the channel between threads.
>
> Unfortunately, whilst we've updated the documentation on the website 
> to reflect this change (which was merged in September 2011 and 
> released in 2.7.0) we appear to have missed the javadocs for the 
> Channel class - I will get that fixed asap so as to avoid any further 
> confusion!
>
> Cheers,
> Tim
>
> On 10/23/2012 02:08 AM, Laurent Vauthrin wrote:
>> Thanks for clearing that up!
>>
>> On Mon, Oct 22, 2012 at 3:46 PM, Michael Klishin 
>> <michael.s.klishin at gmail.com <mailto:michael.s.klishin at gmail.com>> wrote:
>>
>>
>>
>>     2012/10/22 Laurent Vauthrin <lvauthrin at gmail.com
>>     <mailto:lvauthrin at gmail.com>>
>>
>>         My questions are:
>>         1. Should we be using a channel per thread considering that
>>         we're synchronizing the basicPublish call anyway?
>>
>>
>>     Yes. Channels are just integer on the wire and a little bit of
>>     memory allocated on the JVM heap. They are very cheap
>>     for all intents and purposes and you are much more likely to max
>>     out your OS and hardware resources (assuming 1 channel per JVM
>>     thread) before
>>     you run into issues with channel objects.
>>
>>         2. Can we just share one channel across all threads and not
>>         synchronize the call to basicPublish?
>>
>>
>>
>>     No. The real issue with shared channels is that large messages
>>     will result in multiple protocol frames being sent
>>     for a single basicPublish operation. When publishing on the same
>>     channel from multiple threads, this may result
>>     in frames being delivered out of order:
>>
>>     T1 => basicPublish => [Frame11] [Frame12] [Frame13]
>>     T2 => basicPublish => [Frame21] [Frame22] [Frame23]
>>
>>     may result in the following delivery order, all on the same channel:
>>
>>     [Frame11][Frame21][Frame12][Frame13][Frame22][Frame23]
>>
>>     and because all frames are on the same channel, RabbitMQ won't be
>>     able to tell how to reconstruct your messages.
>>     -- 
>>     MK
>>
>>     http://github.com/michaelklishin
>>     http://twitter.com/michaelklishin
>>
>>
>>     _______________________________________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.rabbitmq.com
>>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/6b69fdfd/attachment-0001.htm>

------------------------------

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


End of rabbitmq-discuss Digest, Vol 65, Issue 23
************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/ac92b725/attachment.htm>

From matt at soupmatt.com  Tue Oct 23 16:52:20 2012
From: matt at soupmatt.com (Matt Campbell)
Date: Tue, 23 Oct 2012 10:52:20 -0500
Subject: [rabbitmq-discuss] Rabbit Management HTTP API issue - deleted
	queues linger in API responses
In-Reply-To: <50852F6E.5010407@rabbitmq.com>
References: <757bbda1-844b-43c5-b5bb-040d7747c21d@googlegroups.com>
	<b3dd8a14-2e5c-4ae1-a984-a7f8210a15df@googlegroups.com>
	<50852F6E.5010407@rabbitmq.com>
Message-ID: <12187BC5-1E3E-42B1-A448-D128D24A2BD3@soupmatt.com>

When we run rabbitmqctl list_queues, the queue does not show up there.

I'll email you directly with a link to the logs.

Matt

On Oct 22, 2012, at 6:35 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> No - this certainly should not be happening.
> 
> When this is happening, do you see the queues in "rabbitmqctl list_queues"?
> 
> Also, can you post logs (including the sasl log) somewhere?
> 
> Cheers, Simon
> 
> On 18/10/12 19:13, Matt Campbell wrote:
>> On Thursday, October 18, 2012 12:20:54 PM UTC-5, Matt Campbell wrote:
>> 
>>    RabbitMQ version: 2.8.7
>>    Erlang version: R14B04
>> 
>>    We are seeing an issue where queues that have been deleted using the
>>    amqp basic.delete command tend to linger in the Management console
>>    and in calls to the HTTP API. This is an issue for us as we are
>>    using that API to discover dynamically created and deleted queues.
>>    Can anyone confirm this behavior or offer a suggestion as to how we
>>    can mitigate it?
>> 
>>    Thanks,
>> 
>>    Matt
>> 
>> 
>> I learned some more about what is going on. If I try to redeclare the
>> queue, rabbit returns an error unless I match the queue arguments, as I
>> would expect, but then if I go to delete the queue, I get an error
>> saying it doesn't exist.
>> 
>> Our setup for this environment is a single node running in cluster mode
>> (we are planning on adding a second node in the near future) and all our
>> queues are declared with x-ha-policy set to all.
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware


From oldhomelh at foxmail.com  Tue Oct 23 00:43:38 2012
From: oldhomelh at foxmail.com (=?gb18030?B?RLX3tcQjxa+2rA==?=)
Date: Tue, 23 Oct 2012 07:43:38 +0800
Subject: [rabbitmq-discuss] the meaning of  prefetch ?
Message-ID: <tencent_51A2C3331389505C36E1F874@qq.com>

Hello,


as far as i know?prefetch means the amount of  messages that cosumer request mq server  once  can get?but I still have some questions as follows 1. In offical website ,it describe that :" it is useful to be able to specify how many messages each consumer can be sent at once before sending the next acknowledgement" . when we first request the server, we can get the amount which  defined by prefetch of messages  into my client buffere pool,then my application will process it,if it can be successfully processed ,the client need send a ACK back to the server, to notice server that the message can be delete.Next,I doubt that whether the server will re-send  some new messages to client?  and  the amount  equals the  value of the prefetch or not  ?
2.when the prefetch  define  will has  effect on my application?
 
andy
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/c4a1ef82/attachment.htm>

From mxiaoguang at 126.com  Mon Oct 22 14:49:13 2012
From: mxiaoguang at 126.com (=?GBK?B?wu3P/rni?=)
Date: Mon, 22 Oct 2012 21:49:13 +0800 (CST)
Subject: [rabbitmq-discuss] Help
Message-ID: <788dabaa.10786.13a88bc030d.Coremail.mxiaoguang@126.com>

Hello
       I want put flash crossdomain.xml file into the RabbitMQ Mochiweb Server, but I cant't find the root dictory of rabbitmq-management.
      I just want to load crossdomain.xml file via http://localhost/crossdomain.xml
 
     Can you understand me! My English is poor! HAHAHA
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121022/4607ed45/attachment.htm>

From emile at rabbitmq.com  Tue Oct 23 17:29:47 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 23 Oct 2012 17:29:47 +0100
Subject: [rabbitmq-discuss] How to structure Master with many slaves?
 RPC??
In-Reply-To: <1350996106593-22804.post@n5.nabble.com>
References: <1350952865620-22782.post@n5.nabble.com>
	<50865FD1.7040305@rabbitmq.com>
	<1350996106593-22804.post@n5.nabble.com>
Message-ID: <5086C5FB.1070104@rabbitmq.com>

Hi,

On 23/10/12 13:41, theBuckWheat wrote:
> I have a list of discrete tasks sitting on the master server and a (dynamic)
> list of remote slaves, and I want to pick a slave from the list and send it
> one of these tasks and then do the same for the remaining tasks until all
> available slaves are busy.  

If slaves are not interchangeable and you need address them each
individually then each slave will need to declare its own queue. The
master will need to know how to address each slave queue and send work
at a rate that matches its processing power. Are you sure you need to do
this though?

> 1) How best to structure pushing work to slaves;  At present, on the master
> I keep a table of all slaves and a status flag.  If I set the status to
> available, the master (based on a priority selection scheme) can pick one
> off the list and push work to it.  The status is then set to 'busy'.  I can
> set the status to unavailable at any time and that only removes the slave
> from the list of slaves the master can push work to.  

This solution involves alot of work for the master, which is responsible
for tracking the status and availability of individual slaves. This also
has the drawback that work given to one slave cannot easily be
reassigned to another slave.

> 2) How to structure fetching the finished work file?  Push or pull?  At
> present, when a slave is finished, it calls the master and only sets a flag. 
> Based on a priority scheme, the master will eventually pull the finished
> work file from that slave, after which it marks that slave as being
> available for work.

Is there any reason why a common reply queue for completed work from all
slaves can't work?

> The load-balance model seems to apply, but only if I can control which slave
> gets the message.  I don't want to broadcast to all slaves due to bandwidth
> constraints.  As I read the various queue configurations, I understand how
> each can be used, but I don't see a published one that applies to this
> particular master-slave configuration because of its dynamic nature.   This
> leads me to ponder the RPC model.  Am I missing something?

Can you explain why you need to assign work so accurately to a specific
slave? Why does it matter which slave performs the work?

A more common approach is to aggregate similar kinds of slaves, or to
separate the work by kind of task and use a shared queue for each. Each
worker (in a given group) subscribes to the same queue and delivers
completed work to a shared reply queue. This allows each slave to work
at its own pace and if a slave crashes before completing the task
another slave can accept the task.

In this scenario you don't broadcast to all slaves - instead you send
one work item to a shared work queue and one slave receives it and
completes it.



-Emile


From hcoyote at ghostar.org  Tue Oct 23 17:35:15 2012
From: hcoyote at ghostar.org (Travis)
Date: Tue, 23 Oct 2012 11:35:15 -0500
Subject: [rabbitmq-discuss] Memory leak caused by error_logger in 2.8.6?
In-Reply-To: <8A746A1E-A89E-420F-BA54-9D27B0E4AE5F@rabbitmq.com>
References: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>
	<8A746A1E-A89E-420F-BA54-9D27B0E4AE5F@rabbitmq.com>
Message-ID: <CAChq9g2sKqV38etQWaRU+F7tsNQsHSzNex9C+=zcFaSsZ2+Vig@mail.gmail.com>

On Tue, Oct 23, 2012 at 3:38 AM, Tim Watson <watson.timothy at gmail.com> wrote:
> How log does the situation last when this happens?
>

It lasts until we restart.

We suspect it has something to do with errors coming from the shovels
on each instance, since we don't see this same behavior on our
cluster.

Our best guess is that when the shovels undergo a period where they
have network issues while talking to the cluster, they start spamming
the logs with output and the memory usage rises.  Once the network
connectivity issues resolve themselves, the memory usage seems to
stabilize and remain moderately flat.

>  Can you post the logs 'after' the memory goes up unexpectedly - is there any larger terms in there?

I don't understand what you mean by "larger terms".

Thanks!
Travis

-- 
Travis Campbell
travis at ghostar.org

From emile at rabbitmq.com  Tue Oct 23 17:44:02 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 23 Oct 2012 17:44:02 +0100
Subject: [rabbitmq-discuss] the meaning of  prefetch ?
In-Reply-To: <tencent_51A2C3331389505C36E1F874@qq.com>
References: <tencent_51A2C3331389505C36E1F874@qq.com>
Message-ID: <5086C952.6040903@rabbitmq.com>

Hi Andy,

On 23/10/12 00:43, D??#?? wrote:
>  1. In offical website ,it describe that :" it is useful to be able to
> specify how many messages each consumer can be sent at once before
> sending the next acknowledgement" . when we first request the server, we
> can get the amount which  defined by prefetch of messages  into my
> client buffere pool,then my application will process it,if it can be
> successfully processed ,the client need send a ACK back to the server,
> to notice server that the message can be delete.Next,I doubt that
> whether the server will re-send  some new messages to client?  and  the
> amount  equals the  value of the prefetch or not  ?

That is correct. As soon as the client send an ACK to the server, the
server will send more messages. The multiple flag was set then many
messages may be sent (up to prefetch messages). If the multiple flag was
not set then only one message will be sent:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.ack.multiple
If there are no messages in the queue, then the client must wait until
more messages arrive.

> 2.when the prefetch  define  will has  effect on my application?

If your application is driven by a queue subscription then it may well
have an effect.


-Emile


From hcoyote at ghostar.org  Tue Oct 23 17:39:35 2012
From: hcoyote at ghostar.org (Travis)
Date: Tue, 23 Oct 2012 11:39:35 -0500
Subject: [rabbitmq-discuss] Memory leak caused by error_logger in 2.8.6?
In-Reply-To: <508660FC.8020706@rabbitmq.com>
References: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>
	<508660FC.8020706@rabbitmq.com>
Message-ID: <CAChq9g2BRHTheC+7LW08i4h+Lk_u-rVMu6j3Y8DzJ2a3JHe1sA@mail.gmail.com>

On Tue, Oct 23, 2012 at 4:18 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>
> Hmm.
>
> Looks like it is progressing too slowly towards GC; what happens if you GC
> it manually?

I'm not sure how to force a manual GC.  I'd be happy to test it out if
you can tell me how.

>
> We are considering adding some background process that will GC the biggest
> process every so often, since it seems to be possible to end up with
> processes that consume a lot of memory but haven't chalked up enough
> reductions to get GCed.
>

Looking at the memory usage graphs across all of these particular
instances, I can see that *some* things are getting GC'd, but usage
generally remains flat at a particular point throughout the day (eg,
it's currently sitting at 25% utilization on one system -- or about
1.2G -- and I can see that memory usage rises to 1.5G at certain
points, but then goes back down to 1.2G ... when we're at 1.2G,
there's basically nothing in the handful of queues and they are
effectively idle).

Travis


-- 
Travis Campbell
travis at ghostar.org

From simon at rabbitmq.com  Tue Oct 23 18:10:33 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 23 Oct 2012 18:10:33 +0100
Subject: [rabbitmq-discuss] Memory leak caused by error_logger in 2.8.6?
In-Reply-To: <CAChq9g2BRHTheC+7LW08i4h+Lk_u-rVMu6j3Y8DzJ2a3JHe1sA@mail.gmail.com>
References: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>
	<508660FC.8020706@rabbitmq.com>
	<CAChq9g2BRHTheC+7LW08i4h+Lk_u-rVMu6j3Y8DzJ2a3JHe1sA@mail.gmail.com>
Message-ID: <5086CF89.30403@rabbitmq.com>

On 23/10/12 17:39, Travis wrote:
> On Tue, Oct 23, 2012 at 4:18 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>>
>> Hmm.
>>
>> Looks like it is progressing too slowly towards GC; what happens if you GC
>> it manually?
>
> I'm not sure how to force a manual GC.  I'd be happy to test it out if
> you can tell me how.

Ah right, I saw an Erlang term in your mail and assumed you were an 
Erlang developer :-) Try:

rabbitmqctl eval 'erlang:garbage_collect(whereis(error_logger)).'

And from another mail:

> Our best guess is that when the shovels undergo a period where they
> have network issues while talking to the cluster, they start spamming
> the logs with output and the memory usage rises.  Once the network
> connectivity issues resolve themselves, the memory usage seems to
> stabilize and remain moderately flat.

That makes sense - during the outage the error logger does a lot of work 
but doesn't get quite as far as GCing, then after the outage is over it 
does so much less work that it never goes through enough reductions to GC.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Oct 23 18:18:40 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 23 Oct 2012 18:18:40 +0100
Subject: [rabbitmq-discuss] Help
In-Reply-To: <788dabaa.10786.13a88bc030d.Coremail.mxiaoguang@126.com>
References: <788dabaa.10786.13a88bc030d.Coremail.mxiaoguang@126.com>
Message-ID: <5086D170.1050808@rabbitmq.com>

On 22/10/12 14:49, ??? wrote:
> Hello
>         I want put flash crossdomain.xml file into the RabbitMQ Mochiweb
> Server, but I cant't find the root dictory of rabbitmq-management.
>        I just want to load crossdomain.xml file via
> http://localhost/crossdomain.xml
>       Can you understand me! My English is poor! HAHAHA

Hi!

The root directory actually lives inside the rabbitmq-management plugin 
file. So to add an extra file you'd need to find the plugin, unpack it 
(it's a zip file) and then repack it and replace the original plugin.

The plugins are in 
/usr/lib/rabbitmq/lib/rabbitmq_server-<version>/plugins/ when installed 
from RPMs / debs and C:\Program 
Files\RabbitMQ\rabbitmq_server-<version>\plugins\ with the Windows 
installer.

Alternatively, you could use a proxy and have it serve the extra file.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From hcoyote at ghostar.org  Tue Oct 23 19:02:54 2012
From: hcoyote at ghostar.org (Travis)
Date: Tue, 23 Oct 2012 13:02:54 -0500
Subject: [rabbitmq-discuss] Memory leak caused by error_logger in 2.8.6?
In-Reply-To: <5086CF89.30403@rabbitmq.com>
References: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>
	<508660FC.8020706@rabbitmq.com>
	<CAChq9g2BRHTheC+7LW08i4h+Lk_u-rVMu6j3Y8DzJ2a3JHe1sA@mail.gmail.com>
	<5086CF89.30403@rabbitmq.com>
Message-ID: <CAChq9g2U2FMFgV5Jmb08MXQpKMq29HoX287RCuvhRrtCZ-ktRg@mail.gmail.com>

On Tue, Oct 23, 2012 at 12:10 PM, Simon MacMullen <simon at rabbitmq.com> wrote:
>
> Ah right, I saw an Erlang term in your mail and assumed you were an Erlang
> developer :-) Try:
>
> rabbitmqctl eval 'erlang:garbage_collect(whereis(error_logger)).'
>

Looks like we have a winner.

$ sudo  rabbitmqctl eval
'lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory),
Pid, process_info(Pid)} || Pid <- processes()])), 30).' | head -3
[{{memory,1655528576},
  <4865.6.0>,
  [{registered_name,error_logger},
$ sudo rabbitmqctl eval 'erlang:garbage_collect(whereis(error_logger)).'
true
...done.
$ sudo  rabbitmqctl eval
'lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory),
Pid, process_info(Pid)} || Pid <- processes()])), 30).' | head -3
[{{memory,47744392},
  <4865.244.0>,
  [{current_function,{gen_server2,process_next_msg,1}},

and I confirmed in the management interface that we dropped all the
memory that was in use by the error_logger.

>
> That makes sense - during the outage the error logger does a lot of work but
> doesn't get quite as far as GCing, then after the outage is over it does so
> much less work that it never goes through enough reductions to GC.
>

Travis

-- 
Travis Campbell
travis at ghostar.org

From johnson at edocom.cn  Tue Oct 23 19:13:19 2012
From: johnson at edocom.cn (johnson)
Date: Wed, 24 Oct 2012 02:13:19 +0800
Subject: [rabbitmq-discuss] RABBIT MANAGEMENT HTTP API CANNOT SUPPORT
	"Create Queue and Exchange"?
Message-ID: <201210240213188495325@edocom.cn>

Hi all,

I wrote a sample code to use Rabbitmq management HTTP API. For "Create a new vhost", it works fine.

    HttpPut httpput httpput = new HttpPut();
httpput.setHeader("content-type", "application/json");
    httpput.setURI(new URI("http://192.168.2.129:55672/api/vhosts/my-vhost"));
    DefaultHttpClient httpclient = new DefaultHttpClient();  
    httpclient.getCredentialsProvider().setCredentials(new AuthScope("192.168.2.129", 55672),
                                            new UsernamePasswordCredentials("guest", "guest"));
    HttpResponse response = httpclient.execute(httpput);


But if I want to create a new Exchange or Queue using the same code, it always returns NoHTTPResponseException. It seems that once I setEntity for httpput, the exception occurs.

    HttpPut httpput = new HttpPut();
    httpput.setHeader("content-type", "application/json");

    JSONObject param = new JSONObject();
    param.put("type", "direct");
    StringEntity  entity = new StringEntity(param.toString());
    httpput.setEntity(entity);

    httpput.setURI(new URI("http://192.168.2.129:55672/api/exchanges/%2f/my-new-exchange"));
    DefaultHttpClient httpclient = new DefaultHttpClient();  
    httpclient.getCredentialsProvider().setCredentials(new AuthScope("192.168.2.129", 55672),
                                            new UsernamePasswordCredentials("guest", "guest"));
    
    HttpResponse response = httpclient.execute(httpput);


Could anyone give me some example how to use HTTP API? Thanks.

Johnson



Best regards,
Johnson ??
MOBILE:13776621689                                                                 
TEL: 025-83191712
FAX: 025-58783331
??? ??????????48???????A???A?
??? 210012
 Information System Co. Ltd.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121024/169d91c6/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/jpeg
Size: 14489 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121024/169d91c6/attachment.jpeg>

From matthias at rabbitmq.com  Tue Oct 23 19:16:39 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 23 Oct 2012 19:16:39 +0100
Subject: [rabbitmq-discuss] Memory leak caused by error_logger in 2.8.6?
In-Reply-To: <CAChq9g2U2FMFgV5Jmb08MXQpKMq29HoX287RCuvhRrtCZ-ktRg@mail.gmail.com>
References: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>
	<508660FC.8020706@rabbitmq.com>
	<CAChq9g2BRHTheC+7LW08i4h+Lk_u-rVMu6j3Y8DzJ2a3JHe1sA@mail.gmail.com>
	<5086CF89.30403@rabbitmq.com>
	<CAChq9g2U2FMFgV5Jmb08MXQpKMq29HoX287RCuvhRrtCZ-ktRg@mail.gmail.com>
Message-ID: <5086DF07.5060701@rabbitmq.com>

On 23/10/12 19:02, Travis wrote:
> Looks like we have a winner.
> [...]
> [{{memory,47744392},

47MB straight after a gc is still rather a lot.

Matthias.

From hcoyote at ghostar.org  Tue Oct 23 19:53:23 2012
From: hcoyote at ghostar.org (Travis)
Date: Tue, 23 Oct 2012 13:53:23 -0500
Subject: [rabbitmq-discuss] Memory leak caused by error_logger in 2.8.6?
In-Reply-To: <5086DF07.5060701@rabbitmq.com>
References: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>
	<508660FC.8020706@rabbitmq.com>
	<CAChq9g2BRHTheC+7LW08i4h+Lk_u-rVMu6j3Y8DzJ2a3JHe1sA@mail.gmail.com>
	<5086CF89.30403@rabbitmq.com>
	<CAChq9g2U2FMFgV5Jmb08MXQpKMq29HoX287RCuvhRrtCZ-ktRg@mail.gmail.com>
	<5086DF07.5060701@rabbitmq.com>
Message-ID: <CAChq9g2brts=QHfwaXUJmjHpjp9AUBxe03Y2G+E+aeFZ6pOkkQ@mail.gmail.com>

On Tue, Oct 23, 2012 at 1:16 PM, Matthias Radestock
<matthias at rabbitmq.com> wrote:
> On 23/10/12 19:02, Travis wrote:
>>
>> Looks like we have a winner.
>> [...]
>> [{{memory,47744392},
>
>
> 47MB straight after a gc is still rather a lot.

Considering that the GC cleared out 1.5GB, I think 47MB is a fair
price to pay. :-)

The memory usage of rabbitmq on this host is now down around 150MB, from 1650MB.

Travis
-- 
Travis Campbell
travis at ghostar.org

From ward.mark at gmail.com  Tue Oct 23 20:27:31 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 23 Oct 2012 12:27:31 -0700 (PDT)
Subject: [rabbitmq-discuss] use best practices with IBasicProperties
Message-ID: <32520513-1e84-4603-af61-50ab0680dc87@googlegroups.com>

Hi,

When sending messages with BasicPublish is it suggested to call 
imodel.CreateBasicProperties() for each message or is it OK to reuse an 
instance of IBasicProperties and set the properties per message.

For example.  Say I have a batch of messages I am sending. Each message may 
have a different ContentType.  Should I generate a new IBasicProperties for 
each message or would I be able to reuse the same instance of 
IBasicProperties but set the ContentType for each message?

-Mark
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/2757cf72/attachment.htm>

From simon at rabbitmq.com  Tue Oct 23 22:59:55 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 23 Oct 2012 22:59:55 +0100
Subject: [rabbitmq-discuss] Memory leak caused by error_logger in 2.8.6?
In-Reply-To: <CAChq9g2brts=QHfwaXUJmjHpjp9AUBxe03Y2G+E+aeFZ6pOkkQ@mail.gmail.com>
References: <CAChq9g0hgKBX6LdhDxtva0OAfG+86TVrTcAWCksYs9WYUH1ofw@mail.gmail.com>
	<508660FC.8020706@rabbitmq.com>
	<CAChq9g2BRHTheC+7LW08i4h+Lk_u-rVMu6j3Y8DzJ2a3JHe1sA@mail.gmail.com>
	<5086CF89.30403@rabbitmq.com>
	<CAChq9g2U2FMFgV5Jmb08MXQpKMq29HoX287RCuvhRrtCZ-ktRg@mail.gmail.com>
	<5086DF07.5060701@rabbitmq.com>
	<CAChq9g2brts=QHfwaXUJmjHpjp9AUBxe03Y2G+E+aeFZ6pOkkQ@mail.gmail.com>
Message-ID: <5087135B.1020905@rabbitmq.com>

On 23/10/2012 7:53PM, Travis wrote:
> The memory usage of rabbitmq on this host is now down around 150MB, from 1650MB.

Wow, I dropped a zero, I'd read that process as 165MB. Ouch.

I guess the severity of the "Proactively GC heavyweight processes" bug 
just went up...

Cheers, Simon

From tbw at rg6.org  Wed Oct 24 00:58:12 2012
From: tbw at rg6.org (theBuckWheat)
Date: Tue, 23 Oct 2012 16:58:12 -0700 (PDT)
Subject: [rabbitmq-discuss] How to structure Master with many slaves?
	RPC??
In-Reply-To: <5086C5FB.1070104@rabbitmq.com>
References: <1350952865620-22782.post@n5.nabble.com>
	<50865FD1.7040305@rabbitmq.com>
	<1350996106593-22804.post@n5.nabble.com>
	<5086C5FB.1070104@rabbitmq.com>
Message-ID: <1351036692408-22821.post@n5.nabble.com>

Emile--

Q: Is there any reason why a common reply queue for completed work from all 
slaves can't work? 

A common reply queue could work in this case.

The reason that I need to control task assignment to slaves is that
different slaves have different capabilities as well as availability.  The
task run parameters are set according to which slave they are assigned to,
and I need to be able to remove a slave from the pool at any time.

Does that help?

--tBW





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/How-to-structure-Master-with-many-slaves-RPC-tp22782p22821.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mpietrek at skytap.com  Wed Oct 24 02:22:10 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Tue, 23 Oct 2012 18:22:10 -0700
Subject: [rabbitmq-discuss] Two nodes in a cluster losing sight of each
	other?
Message-ID: <CACLE7izEP=Ac9EvRPP_H3T5Vom1p52=15iqa-qQ+sqVM=toHkQ@mail.gmail.com>

I'm trying to track down a fun one. This is with 2.8.6. (We're in the
process of moving these guys to 2.8.7, but want to understand what's
happening first.)

We have two nodes, mq1 and mq2. They simultaneously lose communication with
each other,  breaking the cluster, although they still continue to function
independently. That is, each one things the other is down.

Now the obvious solution is some sort of network partition. However, in all
of our extensive logs and by pouring over all sorts of system data, I don't
see any evidence of a a network blip. Not saying it's not possible, just
pretty unlikely. The only thing of note I can think of is that we were in
towards the end an "apt-get update" when this happened.

On mq1, the rabbit at mq1.log file is:

=ERROR REPORT==== 22-Oct-2012::09:40:28 ===
** Node rabbit at mq2 not responding **
** Removing (timedout) connection **

=ERROR REPORT==== 22-Oct-2012::09:40:28 ===
webmachine error: path="/api/overview"
{error,
    {error,function_clause,
        [{rabbit_mgmt_wm_overview,'-contexts/1-lc$^0/1-0-',
             [{badrpc,nodedown},rabbit at mq2],
             []},

{rabbit_mgmt_wm_overview,'-rabbit_mochiweb_contexts/0-lc$^0/1-0-',1,
             []},
         {rabbit_mgmt_wm_overview,rabbit_mochiweb_contexts,0,[]},
         {rabbit_mgmt_wm_overview,to_json,2,[]},
         {webmachine_resource,resource_call,3,[]},
         {webmachine_resource,do,3,[]},
         {webmachine_decision_core,resource_call,1,[]},
         {webmachine_decision_core,decision,1,[]}]}}

=ERROR REPORT==== 22-Oct-2012::09:40:28 ===
webmachine error: path="/api/overview"
{error,
    {error,function_clause,
        [{rabbit_mgmt_wm_overview,'-contexts/1-lc$^0/1-0-',
             [{badrpc,nodedown},rabbit at mq2],
             []},

{rabbit_mgmt_wm_overview,'-rabbit_mochiweb_contexts/0-lc$^0/1-0-',1,
             []},
         {rabbit_mgmt_wm_overview,rabbit_mochiweb_contexts,0,[]},
         {rabbit_mgmt_wm_overview,to_json,2,[]},
         {webmachine_resource,resource_call,3,[]},
         {webmachine_resource,do,3,[]},
         {webmachine_decision_core,resource_call,1,[]},
         {webmachine_decision_core,decision,1,[]}]}}
<< several more of these >>

The rabbit at mq1-sasl.log has one of these per queue:
=CRASH REPORT==== 22-Oct-2012::09:40:28 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.260.0>
    registered_name: []
    exception exit: {function_clause,
                     [{gm,handle_info,
                       [{mnesia_locker,rabbit at mq2,granted},
                        {state,
                         {3,<0.260.0>},
                         {{3,<0.260.0>},undefined},
                         {{3,<0.260.0>},undefined},
                         {resource,<<"/">>,queue,<<"charon">>},
                         rabbit_mirror_queue_coordinator,
                         {12,
                          [{{3,<0.260.0>},
                            {view_member,
                             {3,<0.260.0>},
                             [],
                             {3,<0.260.0>},
                             {3,<0.260.0>}}}]},
                         972,[],
                         [<0.1073.0>],
                         {[],[]},
                         [],undefined}],
                       []},
                      {gen_server2,handle_msg,2,[]},
                      {proc_lib,wake_up,3,
                       [{file,"proc_lib.erl"},{line,237}]}]}
      in function  gen_server2:terminate/3
    ancestors: [<0.259.0>,rabbit_mirror_queue_slave_sup,rabbit_sup,
                  <0.145.0>]
    messages: []
    links: [<0.1073.0>]
    dictionary: [{random_seed,{986,23084,10363}}]
    trap_exit: false
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 263704
  neighbours:
    neighbour: [{pid,<0.1073.0>},
                  {registered_name,[]},
                  {initial_call,{gen,init_it,
                                     ['Argument__1','Argument__2',
                                      'Argument__3','Argument__4',
                                      'Argument__5','Argument__6']}},
                  {current_function,{gen,do_call,4}},
                  {ancestors,[<0.259.0>,rabbit_mirror_queue_slave_sup,
                              rabbit_sup,<0.145.0>]},
                  {messages,[]},
                  {links,[<0.259.0>,<0.260.0>]},
                  {dictionary,[]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,377},
                  {stack_size,27},
                  {reductions,23907}]

Meanwhile, on mq2, the rabbit at mq2.log file is:

=INFO REPORT==== 22-Oct-2012::09:40:28 ===
rabbit on node rabbit at mq1 down

=ERROR REPORT==== 22-Oct-2012::09:40:28 ===
Mnesia(rabbit at mq2): ** ERROR ** mnesia_event got {inconsistent_database,
running_partitioned_network, rabbit at mq1}

=INFO REPORT==== 22-Oct-2012::09:40:28 ===
Mirrored-queue (queue 'cmcmd' in vhost '/'): Slave <rabbit at mq2.2.260.0> saw
deaths of mirrors <rabbit at mq1.1.261.0>

=INFO REPORT==== 22-Oct-2012::09:40:28 ===
Mirrored-queue (queue 'cmcmd' in vhost '/'): Promoting slave
<rabbit at mq2.2.260.0> to master

=INFO REPORT==== 22-Oct-2012::09:40:28 ===
Mirrored-queue (queue 'charon' in vhost '/'): Slave <rabbit at mq2.2.258.0>
saw deaths of mirrors <rabbit at mq1.1.259.0>

=INFO REPORT==== 22-Oct-2012::09:40:28 ===
Mirrored-queue (queue 'charon' in vhost '/'): Promoting slave
<rabbit at mq2.2.258.0> to master

=INFO REPORT==== 22-Oct-2012::09:40:28 ===
    application: rabbitmq_management
    exited: shutdown
    type: permanent

and the rabbit at mq2-sasl.log file has:

=SUPERVISOR REPORT==== 22-Oct-2012::09:40:28 ===
     Supervisor: {local,rabbit_mgmt_sup}
     Context:    child_terminated
     Reason:     {shutdown,
                     [{killed,
                          {child,undefined,rabbit_mgmt_db,
                              {rabbit_mgmt_db,start_link,[]},
                              permanent,4294967295,worker,
                              [rabbit_mgmt_db]}}]}
     Offender:   [{pid,<0.303.0>},
                  {name,mirroring},
                  {mfa,
                      {mirrored_supervisor,start_internal,
                          [rabbit_mgmt_sup,
                           [{rabbit_mgmt_db,
                                {rabbit_mgmt_db,start_link,[]},
                                permanent,4294967295,worker,
                                [rabbit_mgmt_db]}]]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 22-Oct-2012::09:40:28 ===
     Supervisor: {local,rabbit_mgmt_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,<0.303.0>},
                  {name,mirroring},
                  {mfa,
                      {mirrored_supervisor,start_internal,
                          [rabbit_mgmt_sup,
                           [{rabbit_mgmt_db,
                                {rabbit_mgmt_db,start_link,[]},
                                permanent,4294967295,worker,
                                [rabbit_mgmt_db]}]]}},
                  {restart_type,permanent},
                  {shutdown,4294967295},
                  {child_type,worker}]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121023/7bb8565b/attachment.htm>

From wongkamhoong at gmail.com  Wed Oct 24 07:46:00 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Wed, 24 Oct 2012 14:46:00 +0800
Subject: [rabbitmq-discuss] RabbitMQ node faced out of disk space problem
	under cluster environment
Message-ID: <CAHv8OSSG8vMrxzm9H8N4TYAAfBdvXLmHH4Pozq50L14061iKpA@mail.gmail.com>

Hi RabbitMQ Team,

If one of the RabbitMQ node under cluster environment facing out of disk
space problem, what will happen?

1) The cluster stop function properly or even worst?
2) Just impacted node stop sync data from others?

Thanks & Regards,
Wong
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121024/d64905b6/attachment.htm>

From tim at rabbitmq.com  Wed Oct 24 09:42:50 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 24 Oct 2012 09:42:50 +0100
Subject: [rabbitmq-discuss] RABBIT MANAGEMENT HTTP API CANNOT SUPPORT
	"Create Queue and Exchange"?
In-Reply-To: <201210240213188495325@edocom.cn>
References: <201210240213188495325@edocom.cn>
Message-ID: <12E5B1CF-CA34-4D7C-B875-AB73E62C544B@rabbitmq.com>

Hi

On 23 Oct 2012, at 19:13, johnson wrote:

> Hi all,
>  
> I wrote a sample code to use Rabbitmq management HTTP API. For "Create a new vhost", it works fine.
>  

<snip>

>  
>  
> But if I want to create a new Exchange or Queue using the same code, it always returns NoHTTPResponseException. It seems that once I setEntity for httpput, the exception occurs.
>  

Is there anything in the rabbit logs to indicate that an error occurred? Also, can you do this using curl on the command line? If that works, then you might need to use something like wireshark to look at what your http client is putting on the wire.

Cheers,
Tim

From tim at rabbitmq.com  Wed Oct 24 09:46:36 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 24 Oct 2012 09:46:36 +0100
Subject: [rabbitmq-discuss] RABBIT MANAGEMENT HTTP API CANNOT SUPPORT
	"Create Queue and Exchange"?
In-Reply-To: <12E5B1CF-CA34-4D7C-B875-AB73E62C544B@rabbitmq.com>
References: <201210240213188495325@edocom.cn>
	<12E5B1CF-CA34-4D7C-B875-AB73E62C544B@rabbitmq.com>
Message-ID: <6D564197-F951-4622-9E0C-AD1AFDF82396@rabbitmq.com>

Also:

>>  httpput.setURI(new URI("http://192.168.2.129:55672/api/exchanges/%2f/my-new-exchange"));

the resource path should be /api/exchanges/<vhost>/<exchange-id> if I'm not mistaken.

On 24 Oct 2012, at 09:42, Tim Watson wrote:

> Hi
> 
> On 23 Oct 2012, at 19:13, johnson wrote:
> 
>> Hi all,
>> 
>> I wrote a sample code to use Rabbitmq management HTTP API. For "Create a new vhost", it works fine.
>> 
> 
> <snip>
> 
>> 
>> 
>> But if I want to create a new Exchange or Queue using the same code, it always returns NoHTTPResponseException. It seems that once I setEntity for httpput, the exception occurs.
>> 
> 
> Is there anything in the rabbit logs to indicate that an error occurred? Also, can you do this using curl on the command line? If that works, then you might need to use something like wireshark to look at what your http client is putting on the wire.
> 
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From oldhomelh at gmail.com  Wed Oct 24 09:56:44 2012
From: oldhomelh at gmail.com (=?GB2312?B?wda6rQ==?=)
Date: Wed, 24 Oct 2012 16:56:44 +0800
Subject: [rabbitmq-discuss] the meaning of prefetch ?
In-Reply-To: <5086C952.6040903@rabbitmq.com>
References: <tencent_51A2C3331389505C36E1F874@qq.com>
	<5086C952.6040903@rabbitmq.com>
Message-ID: <CAG45AFRSC6+eTh7XOvGPhqE75C6TJEvY+gvq2Fm=K6R6XfAy0g@mail.gmail.com>

Thanks for you answers .  if we have a queue ,and many consumers
> subscribe the queue,these consumers  has  a common prefetch
> value,assuming it is 20.if the queue has 20 msg , the rabbitmq will send
> the whole msg to one queue or every queue ?. if send to one ,it means
> other consumers will be idle  ?

2012/10/24 Emile Joubert <emile at rabbitmq.com>

> Hi Andy,
>
> On 23/10/12 00:43, D??#?? wrote:
> >  1. In offical website ,it describe that :" it is useful to be able to
> > specify how many messages each consumer can be sent at once before
> > sending the next acknowledgement" . when we first request the server, we
> > can get the amount which  defined by prefetch of messages  into my
> > client buffere pool,then my application will process it,if it can be
> > successfully processed ,the client need send a ACK back to the server,
> > to notice server that the message can be delete.Next,I doubt that
> > whether the server will re-send  some new messages to client?  and  the
> > amount  equals the  value of the prefetch or not  ?
>
> That is correct. As soon as the client send an ACK to the server, the
> server will send more messages. The multiple flag was set then many
> messages may be sent (up to prefetch messages). If the multiple flag was
> not set then only one message will be sent:
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.ack.multiple
> If there are no messages in the queue, then the client must wait until
> more messages arrive.
>
> > 2.when the prefetch  define  will has  effect on my application?
>
> If your application is driven by a queue subscription then it may well
> have an effect.
>
>
> -Emile
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121024/0e7020fd/attachment.htm>

From matthias at rabbitmq.com  Wed Oct 24 09:59:40 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 24 Oct 2012 09:59:40 +0100
Subject: [rabbitmq-discuss] RABBIT MANAGEMENT HTTP API CANNOT SUPPORT
 "Create Queue and Exchange"?
In-Reply-To: <6D564197-F951-4622-9E0C-AD1AFDF82396@rabbitmq.com>
References: <201210240213188495325@edocom.cn>
	<12E5B1CF-CA34-4D7C-B875-AB73E62C544B@rabbitmq.com>
	<6D564197-F951-4622-9E0C-AD1AFDF82396@rabbitmq.com>
Message-ID: <5087ADFC.2030706@rabbitmq.com>

On 24/10/12 09:46, Tim Watson wrote:
> Also:
>
>>> httpput.setURI(new
>>> URI("http://192.168.2.129:55672/api/exchanges/%2f/my-new-exchange"));
>
>>>
> the resource path should be /api/exchanges/<vhost>/<exchange-id> if
> I'm not mistaken.

The above *is* the correct path for an exchange in the '/' vhost.

As Tim says, try the same with 'curl' and if that works then capture the 
interactions with wireshark and compare them.

Matthias.

From tim at rabbitmq.com  Wed Oct 24 10:05:49 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 24 Oct 2012 10:05:49 +0100
Subject: [rabbitmq-discuss] Two nodes in a cluster losing sight of each
	other?
In-Reply-To: <CACLE7izEP=Ac9EvRPP_H3T5Vom1p52=15iqa-qQ+sqVM=toHkQ@mail.gmail.com>
References: <CACLE7izEP=Ac9EvRPP_H3T5Vom1p52=15iqa-qQ+sqVM=toHkQ@mail.gmail.com>
Message-ID: <42E60130-53D4-4E28-98CE-520D8B4C0A58@rabbitmq.com>

Hi Matt,

On 24 Oct 2012, at 02:22, Matt Pietrek wrote:

> I'm trying to track down a fun one. This is with 2.8.6. (We're in the process of moving these guys to 2.8.7, but want to understand what's happening first.)
> 
> We have two nodes, mq1 and mq2. They simultaneously lose communication with each other,  breaking the cluster, although they still continue to function independently. That is, each one things the other is down.
> 
> Now the obvious solution is some sort of network partition. However, in all of our extensive logs and by pouring over all sorts of system data, I don't see any evidence of a a network blip. Not saying it's not possible, just pretty unlikely. The only thing of note I can think of is that we were in towards the end an "apt-get update" when this happened.
> 

Whilst it looks like there's been a network partition here (indeed the mnesia running_partitioned_network message is pretty explicit about what it thinks has happened), there could be another explanation. If either node is heavily loaded, it is possible that the erlang net kernel cannot get a response back from the other node quickly enough, causing the distribution sub system to see the other node as unreachable (which is indistinguishable from 'down'). If this is what is happening, then you *could* tweak the net_ticktime and give it a higher setting, allowing the net kernel more time to potentially see a response from the other node. This is *not* a panacea however, and can have other consequences as all the rabbits in your cluster will take longer to notice if another node goes down - use with caution!

Cheers,
Tim

From emile at rabbitmq.com  Wed Oct 24 10:20:44 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 24 Oct 2012 10:20:44 +0100
Subject: [rabbitmq-discuss] use best practices with IBasicProperties
In-Reply-To: <32520513-1e84-4603-af61-50ab0680dc87@googlegroups.com>
References: <32520513-1e84-4603-af61-50ab0680dc87@googlegroups.com>
Message-ID: <5087B2EC.2000205@rabbitmq.com>

Hi Mark,

On 23/10/12 20:27, Mark Ward wrote:
> When sending messages with BasicPublish is it suggested to call
> imodel.CreateBasicProperties() for each message or is it OK to reuse an
> instance of IBasicProperties and set the properties per message.

It doesn't matter too much. Re-using an object will incur slightly less
memory churn and garbage collection. I would suggest that code clarity
is a more important consideration though.

-Emile




From simon at rabbitmq.com  Wed Oct 24 10:14:32 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 24 Oct 2012 10:14:32 +0100
Subject: [rabbitmq-discuss] RabbitMQ node faced out of disk space
 problem under cluster environment
In-Reply-To: <CAHv8OSSG8vMrxzm9H8N4TYAAfBdvXLmHH4Pozq50L14061iKpA@mail.gmail.com>
References: <CAHv8OSSG8vMrxzm9H8N4TYAAfBdvXLmHH4Pozq50L14061iKpA@mail.gmail.com>
Message-ID: <5087B178.3030105@rabbitmq.com>

On 24/10/12 07:46, Wong Kam Hoong wrote:
> Hi RabbitMQ Team,
>
> If one of the RabbitMQ node under cluster environment facing out of disk
> space problem, what will happen?
>
> 1) The cluster stop function properly or even worst?
> 2) Just impacted node stop sync data from others?

Disc space monitoring was added in 2.8.2. If the disc space falls below 
the monitored threshold then *the whole cluster* will stop accepting 
publishes until more space becomes available.

This doesn't completely stop you from running out of disc space, but it 
makes it very unlikely that RabbitMQ will take the last disc space on 
the machine.

Running out of disc space will cause RabbitMQ to crash.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Oct 24 10:25:17 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 24 Oct 2012 10:25:17 +0100
Subject: [rabbitmq-discuss] the meaning of prefetch ?
In-Reply-To: <CAG45AFRSC6+eTh7XOvGPhqE75C6TJEvY+gvq2Fm=K6R6XfAy0g@mail.gmail.com>
References: <tencent_51A2C3331389505C36E1F874@qq.com>
	<5086C952.6040903@rabbitmq.com>
	<CAG45AFRSC6+eTh7XOvGPhqE75C6TJEvY+gvq2Fm=K6R6XfAy0g@mail.gmail.com>
Message-ID: <5087B3FD.9050700@rabbitmq.com>

Hi Andy,

On 24/10/12 09:56, ?? wrote:
> Thanks for you answers .  if we have a queue ,and many consumers
> subscribe the queue,these consumers  has  a common prefetch
> value,assuming it is 20.if the queue has 20 msg , the rabbitmq will send
> the whole msg to one queue or every queue ?. if send to one ,it means
> other consumers will be idle  ?  

If the number of messages in the queue is the same as the prefetch count
of all consumers then one consumer will get all the messages in the
queue (until more messages arrive in the queue). This means that other
consumers will be idle.

You can make this outcome less likely by using a smaller prefetch count.



-Emile


From emile at rabbitmq.com  Wed Oct 24 10:33:34 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 24 Oct 2012 10:33:34 +0100
Subject: [rabbitmq-discuss] How to structure Master with many slaves?
 RPC??
In-Reply-To: <1351036692408-22821.post@n5.nabble.com>
References: <1350952865620-22782.post@n5.nabble.com>
	<50865FD1.7040305@rabbitmq.com>
	<1350996106593-22804.post@n5.nabble.com>
	<5086C5FB.1070104@rabbitmq.com>
	<1351036692408-22821.post@n5.nabble.com>
Message-ID: <5087B5EE.6010601@rabbitmq.com>

Hi,

On 24/10/12 00:58, theBuckWheat wrote:
> The reason that I need to control task assignment to slaves is that
> different slaves have different capabilities as well as availability.  The
> task run parameters are set according to which slave they are assigned to,
> and I need to be able to remove a slave from the pool at any time.

If only slaves with a certain capability are able to process a subset of
tasks then you could create a queue for each kind of task. Slaves can
subscribe to the appropriate queue based on their capability. Tasks
should be routed to the correct queue based on the required processing
capability. This way you achieve better decoupling between message
producers and consumers.


-Emile



From matthias at rabbitmq.com  Wed Oct 24 10:34:57 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 24 Oct 2012 10:34:57 +0100
Subject: [rabbitmq-discuss] RabbitMQ node faced out of disk space
 problem under cluster environment
In-Reply-To: <5087B178.3030105@rabbitmq.com>
References: <CAHv8OSSG8vMrxzm9H8N4TYAAfBdvXLmHH4Pozq50L14061iKpA@mail.gmail.com>
	<5087B178.3030105@rabbitmq.com>
Message-ID: <5087B641.3070207@rabbitmq.com>

On 24/10/12 10:14, Simon MacMullen wrote:
> If the disc space falls below the monitored threshold then *the whole
> cluster* will stop accepting publishes until more space becomes
> available.

The same is true for memory alarms, i.e. when *any* node in a cluster 
encounters a memory alarm then *all* nodes will block publishers.

Matthias.

From ernest.staszuk at comarch.pl  Wed Oct 24 12:33:52 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Wed, 24 Oct 2012 13:33:52 +0200
Subject: [rabbitmq-discuss] Termination of queue after sending a message.
In-Reply-To: <9524c212-3d70-40c5-83e2-ebe92b3fa5be@googlegroups.com>
References: <9524c212-3d70-40c5-83e2-ebe92b3fa5be@googlegroups.com>
Message-ID: <5087D220.201@comarch.pl>

Hi,

while using RabbitMQ we encountered problems with queue termination.

I enclose log (with vulnerable parts censored). RabbitMQ version we used 
was 2.8.7 ran on Erlang R15B.
We ran into this issue while sending back to queue dead-lettered message 
as follows:

     1. Message from a queue named let's say "to-process" is delivered
         to consumer and then rejected due to failure.
     2. Since queue "to-process" has dead-letter exchange set to 
"failed-messages"
         it falls down there and then to queue "failed-messages-queue".
     3. Another consumer got this message while listening on 
"failed-messages-queue",
         stored content and headers in memory and sent acknowledgement.
     4. After a certain time there is made an attempt to sent message 
stored in memory
         to the queue form which it was rejected at first (explicitly 
saying to the "to-process" queue).
         To be more precise we are trying to send a message to exchange 
null with routing key "to-process".

And then queue "to-process" vanished unexpectedly. In logs of RabbitMQ 
we found error.

Due this we have some questions:
     - Why did that happen? Is something wrong with what we are doing?
     - Why queue terminated? In my opinion this should never happen 
(even if the message we sent back was broken, I mean isn't that a 
security issue?).
     - What did happened to the messages that was in "to-process" queue? 
Is there any way to find and restore them?
     - Does terminating a (durable) queue can result in messages lossing?

Thank you in advance for the time spent on my problem.

Best regards,
Ernest Staszuk



From ernest.staszuk at comarch.pl  Wed Oct 24 12:40:39 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Wed, 24 Oct 2012 13:40:39 +0200
Subject: [rabbitmq-discuss] Termination of queue after sending a message.
Message-ID: <5087D3B7.9090209@comarch.pl>

Hi,

first sorry for repost, I had forgotten to attach logs.

Orginal message:

While using RabbitMQ we encountered problems with queue termination.

I enclose log (with vulnerable parts censored). RabbitMQ version we used 
was 2.8.7 ran on Erlang R15B.
We ran into this issue while sending back to queue dead-lettered message 
as follows:

     1. Message from a queue named let's say "to-process" is delivered
         to consumer and then rejected due to failure.
     2. Since queue "to-process" has dead-letter exchange set to 
"failed-messages"
         it falls down there and then to queue "failed-messages-queue".
     3. Another consumer got this message while listening on 
"failed-messages-queue",
         stored content and headers in memory and sent acknowledgement.
     4. After a certain time there is made an attempt to sent message 
stored in memory
         to the queue form which it was rejected at first (explicitly 
saying to the "to-process" queue).
         To be more precise we are trying to send a message to exchange 
null with routing key "to-process".

And then queue "to-process" vanished unexpectedly. In logs of RabbitMQ 
we found error.

Due this we have some questions:
     - Why did that happen? Is something wrong with what we are doing?
     - Why queue terminated? In my opinion this should never happen 
(even if the message we sent back was broken, I mean isn't that a 
security issue?).
     - What did happened to the messages that was in "to-process" queue? 
Is there any way to find and restore them?
     - Does terminating a (durable) queue can result in messages lossing?

Thank you in advance for the time spent on my problem.

Best regards,
Ernest Staszuk
-------------- next part --------------
A non-text attachment was scrubbed...
Name: termination.log
Type: text/x-log
Size: 8947 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121024/e058cfe1/attachment.bin>

From prudhviy at gmail.com  Wed Oct 24 12:57:26 2012
From: prudhviy at gmail.com (Bhaskar teja)
Date: Wed, 24 Oct 2012 17:27:26 +0530
Subject: [rabbitmq-discuss] Pika doesnt timeout soon if IP address is not
	reachable
Message-ID: <CAEMO9cAU0NYhNxkcZBrt_kh+vm6YCYnJ+Hivs8Xu5crnBpLrUA@mail.gmail.com>

Hi,

We are using rabbitmq with pika. Our application is in python CGI and we
use pika's blocking connection to connect to rabbitmq.
We create a new connection to rabbitmq every time a new request has come to
CGI.
The problem we face is, if the IP address config is wrong or host OS where
rabbitmq is down, the connection attempt to rabbitmq fails with huge
timeout(>30 seconds).
Basically what we want is the connection attempt should timeout within 1 or
2 seconds regardless of success or failure.
Is there any way we can do that?


Thank you,
Bhaskar teja
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121024/0dfe2e04/attachment.htm>

From simon at rabbitmq.com  Wed Oct 24 13:08:46 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 24 Oct 2012 13:08:46 +0100
Subject: [rabbitmq-discuss] Termination of queue after sending a message.
In-Reply-To: <5087D3B7.9090209@comarch.pl>
References: <5087D3B7.9090209@comarch.pl>
Message-ID: <5087DA4E.8020503@rabbitmq.com>

On 24/10/12 12:40, Ernest Staszuk wrote:
> Hi,

Hi!

>      3. Another consumer got this message while listening on
> "failed-messages-queue",
>          stored content and headers in memory and sent acknowledgement.

Note that at this point it looks like it garbled the "x-death" header, 
flattening it to a string.

>      4. After a certain time there is made an attempt to sent message
> stored in memory
>          to the queue form which it was rejected at first (explicitly
> saying to the "to-process" queue).
>          To be more precise we are trying to send a message to exchange
> null with routing key "to-process".
>
> And then queue "to-process" vanished unexpectedly. In logs of RabbitMQ
> we found error.

The queue crashed.

> Due this we have some questions:
>      - Why did that happen? Is something wrong with what we are doing?

Yes, you flattened the header...

>      - Why queue terminated? In my opinion this should never happen
> (even if the message we sent back was broken, I mean isn't that a
> security issue?).

...but we should still handle that properly! So we would definitely 
consider this a bug.

>      - What did happened to the messages that was in "to-process" queue?
> Is there any way to find and restore them?

In-memory messages will be lost. On-disc messages should come back once 
the node is restarted.

>      - Does terminating a (durable) queue can result in messages lossing?

Yes. Non-persistent messages in the queue will be lost anyway. 
Persistent messages can be lost if they have not yet made it to disc. 
Any messages which have been confirmed to clients (or where the client 
has seen a transaction commit successfully) will definitely be on disc 
and should be recovered.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Oct 24 13:30:45 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 24 Oct 2012 13:30:45 +0100
Subject: [rabbitmq-discuss] Termination of queue after sending a message.
In-Reply-To: <5087DA4E.8020503@rabbitmq.com>
References: <5087D3B7.9090209@comarch.pl> <5087DA4E.8020503@rabbitmq.com>
Message-ID: <5087DF75.5040900@rabbitmq.com>

On 24/10/12 13:08, Simon MacMullen wrote:
>>      - What did happened to the messages that was in "to-process" queue?
>> Is there any way to find and restore them?
>
> In-memory messages will be lost. On-disc messages should come back once
> the node is restarted.

Sorry, no this is not true. It turns out that crashing queues delete 
themselves.

Hmm. I wonder if there's any good reason for that? That seems 
unnecessarily harsh.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From ernest.staszuk at comarch.pl  Wed Oct 24 14:07:23 2012
From: ernest.staszuk at comarch.pl (Ernest Staszuk)
Date: Wed, 24 Oct 2012 15:07:23 +0200
Subject: [rabbitmq-discuss] Termination of queue after sending a message.
In-Reply-To: <5087DF75.5040900@rabbitmq.com>
References: <5087D3B7.9090209@comarch.pl> <5087DA4E.8020503@rabbitmq.com>
	<5087DF75.5040900@rabbitmq.com>
Message-ID: <5087E80B.9040603@comarch.pl>

On 10/24/2012 02:30 PM, Simon MacMullen wrote:
> On 24/10/12 13:08, Simon MacMullen wrote:
>>>      - What did happened to the messages that was in "to-process" 
>>> queue?
>>> Is there any way to find and restore them?
>>
>> In-memory messages will be lost. On-disc messages should come back once
>> the node is restarted.
>
> Sorry, no this is not true. It turns out that crashing queues delete 
> themselves.
>
> Hmm. I wonder if there's any good reason for that? That seems 
> unnecessarily harsh.
>
> Cheers, Simon
>

Thank you for checking that. These replies fully satisfy my curiosity.

Best Regads,
Ernest Staszuk

From mpietrek at skytap.com  Wed Oct 24 17:19:39 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 24 Oct 2012 09:19:39 -0700
Subject: [rabbitmq-discuss] Two nodes in a cluster losing sight of each
	other?
In-Reply-To: <42E60130-53D4-4E28-98CE-520D8B4C0A58@rabbitmq.com>
References: <CACLE7izEP=Ac9EvRPP_H3T5Vom1p52=15iqa-qQ+sqVM=toHkQ@mail.gmail.com>
	<42E60130-53D4-4E28-98CE-520D8B4C0A58@rabbitmq.com>
Message-ID: <CACLE7ixh5ZWsmcX74vYJfF8MXNRFSfQMant3TiK7+p57QMNEmA@mail.gmail.com>

Thanks Tim. I'd come across the net_ticktime before but wasn't sure it was
germane to this issue. We don't touch this value, so it would seem our VM
would have to be busy for 60 seconds. Seems somewhat unlikely (it's
dedicated to hosting MQ and nothing else), but not completely impossible.
I'll continue to dig in this direction.

Matt

On Wed, Oct 24, 2012 at 2:05 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Matt,
>
> On 24 Oct 2012, at 02:22, Matt Pietrek wrote:
>
> > I'm trying to track down a fun one. This is with 2.8.6. (We're in the
> process of moving these guys to 2.8.7, but want to understand what's
> happening first.)
> >
> > We have two nodes, mq1 and mq2. They simultaneously lose communication
> with each other,  breaking the cluster, although they still continue to
> function independently. That is, each one things the other is down.
> >
> > Now the obvious solution is some sort of network partition. However, in
> all of our extensive logs and by pouring over all sorts of system data, I
> don't see any evidence of a a network blip. Not saying it's not possible,
> just pretty unlikely. The only thing of note I can think of is that we were
> in towards the end an "apt-get update" when this happened.
> >
>
> Whilst it looks like there's been a network partition here (indeed the
> mnesia running_partitioned_network message is pretty explicit about what it
> thinks has happened), there could be another explanation. If either node is
> heavily loaded, it is possible that the erlang net kernel cannot get a
> response back from the other node quickly enough, causing the distribution
> sub system to see the other node as unreachable (which is indistinguishable
> from 'down'). If this is what is happening, then you *could* tweak the
> net_ticktime and give it a higher setting, allowing the net kernel more
> time to potentially see a response from the other node. This is *not* a
> panacea however, and can have other consequences as all the rabbits in your
> cluster will take longer to notice if another node goes down - use with
> caution!
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121024/063c25ca/attachment.htm>

From tim at rabbitmq.com  Wed Oct 24 17:22:09 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 24 Oct 2012 17:22:09 +0100
Subject: [rabbitmq-discuss] Two nodes in a cluster losing sight of each
	other?
In-Reply-To: <CACLE7ixh5ZWsmcX74vYJfF8MXNRFSfQMant3TiK7+p57QMNEmA@mail.gmail.com>
References: <CACLE7izEP=Ac9EvRPP_H3T5Vom1p52=15iqa-qQ+sqVM=toHkQ@mail.gmail.com>
	<42E60130-53D4-4E28-98CE-520D8B4C0A58@rabbitmq.com>
	<CACLE7ixh5ZWsmcX74vYJfF8MXNRFSfQMant3TiK7+p57QMNEmA@mail.gmail.com>
Message-ID: <6FA30799-5E3D-46B0-A478-75E823F092C2@rabbitmq.com>

Hi Matt

On 24 Oct 2012, at 17:19, Matt Pietrek wrote:

> Thanks Tim. I'd come across the net_ticktime before but wasn't sure it was germane to this issue. We don't touch this value, so it would seem our VM would have to be busy for 60 seconds. Seems somewhat unlikely (it's dedicated to hosting MQ and nothing else), but not completely impossible. I'll continue to dig in this direction.
> 

Well that's fair enough, but if overload isn't the cause then either the network was being *very* slow or there was a real partition. That mnesia message only comes when distributed Erlang notices that the mnesia nodes have been separate in the past and then are later re-joined.

Cheers,
Tim

> Matt
> 
> On Wed, Oct 24, 2012 at 2:05 AM, Tim Watson <tim at rabbitmq.com> wrote:
> Hi Matt,
> 
> On 24 Oct 2012, at 02:22, Matt Pietrek wrote:
> 
> > I'm trying to track down a fun one. This is with 2.8.6. (We're in the process of moving these guys to 2.8.7, but want to understand what's happening first.)
> >
> > We have two nodes, mq1 and mq2. They simultaneously lose communication with each other,  breaking the cluster, although they still continue to function independently. That is, each one things the other is down.
> >
> > Now the obvious solution is some sort of network partition. However, in all of our extensive logs and by pouring over all sorts of system data, I don't see any evidence of a a network blip. Not saying it's not possible, just pretty unlikely. The only thing of note I can think of is that we were in towards the end an "apt-get update" when this happened.
> >
> 
> Whilst it looks like there's been a network partition here (indeed the mnesia running_partitioned_network message is pretty explicit about what it thinks has happened), there could be another explanation. If either node is heavily loaded, it is possible that the erlang net kernel cannot get a response back from the other node quickly enough, causing the distribution sub system to see the other node as unreachable (which is indistinguishable from 'down'). If this is what is happening, then you *could* tweak the net_ticktime and give it a higher setting, allowing the net kernel more time to potentially see a response from the other node. This is *not* a panacea however, and can have other consequences as all the rabbits in your cluster will take longer to notice if another node goes down - use with caution!
> 
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From james.mcmahon at TASC.COM  Wed Oct 24 19:00:57 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Wed, 24 Oct 2012 18:00:57 +0000
Subject: [rabbitmq-discuss] Means to interact with rabbitMQ from simple html
	UI
Message-ID: <242E9559AA2C354CB60C81A952FCBEB5022F81@TSEAMB01>

     I've explored the rabbitMQ java examples to learn how applications can send and receive messages through rabbitMQ direct exchanges using a java implementation. But in many cases I have only a user interface that is a simple html web page. How can I receive and emit messages through direct exchanges in that case? Are there examples that show me how to interact with rabbitMQ using RESTful calls?

Thanks in advance for your thoughts.  - Jim

CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121024/d5376d42/attachment.htm>

From brett.r.cameron at gmail.com  Wed Oct 24 21:32:02 2012
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Thu, 25 Oct 2012 09:32:02 +1300
Subject: [rabbitmq-discuss] Means to interact with rabbitMQ from simple
 html UI
In-Reply-To: <242E9559AA2C354CB60C81A952FCBEB5022F81@TSEAMB01>
References: <242E9559AA2C354CB60C81A952FCBEB5022F81@TSEAMB01>
Message-ID: <CALPqkiozoeYQb-vEE3xPqV9beJAc31FbdrRmSvp6eBLSt_zm1A@mail.gmail.com>

Jim,

You might like to take a look at
http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/ and
http://commondatastorage.googleapis.com/opensourceprojects/RabbitMQ/RabbitHub.pdf.
I've not tried it, but in theory there should be no problem using RabbitHub
to publish messages in the manner you have described, but (as things stand)
using simple HTML alone you would not be able to use RabbitHub to receive
messages. A better approach might be to write some simple web server-side
component in your language of choice that takes POST and GET requests from
from your HTML web pages and translates the requests into appropriate calls
to RabbitMQ. The RabbitMQ Web STOMP plugin could I think satisfy both of
your requirements, but again you're not looking at just simple HTML with
this.

Regards,
Brett

On Thu, Oct 25, 2012 at 7:00 AM, McMahon, James S (TASC) <
james.mcmahon at tasc.com> wrote:

>       I've explored the rabbitMQ java examples to learn how applications
> can send and receive messages through rabbitMQ direct exchanges using a
> java implementation. But in many cases I have only a user interface that is
> a simple html web page. How can I receive and emit messages through direct
> exchanges in that case? Are there examples that show me how to interact
> with rabbitMQ using RESTful calls?
>
> Thanks in advance for your thoughts.  - Jim
>
> CONFIDENTIALITY NOTICE: This message and any attachments or files
> transmitted with it (collectively, the "Message") are intended only for the
> addressee and may contain information that is privileged, proprietary
> and/or prohibited from disclosure by law or contract. If you are not the
> intended recipient: (a) please do not read, copy or retransmit the Message;
> (b) permanently delete and/or destroy all electronic and hard copies of the
> Message; (c) notify us by return email; and (d) you are hereby notified
> that any dissemination, distribution or copying of the Message is strictly
> prohibited.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/0771bc4d/attachment.htm>

From eliao at seegrid.com  Wed Oct 24 22:06:39 2012
From: eliao at seegrid.com (Elizabeth Liao)
Date: Wed, 24 Oct 2012 21:06:39 +0000
Subject: [rabbitmq-discuss] nodename variable and mnesia directory
In-Reply-To: <1EDE5727-72BE-4384-A943-9F79DDB75819@rabbitmq.com>
References: <E94F626F5C43D14F8B8479C5EBD79038A85DD645@vmexchange02.seegrid.local>
	<5081830F.70706@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038A85DD854@vmexchange02.seegrid.local>
	<FBF9C5AB-BB8E-43CE-BC14-A8BD7A462BC8@rabbitmq.com>
	<66519775-BEBD-4EA9-9A80-361D16CBE81D@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038A85DDCE1@vmexchange02.seegrid.local>,
	<1EDE5727-72BE-4384-A943-9F79DDB75819@rabbitmq.com>
Message-ID: <E94F626F5C43D14F8B8479C5EBD79038A85DE341@vmexchange02.seegrid.local>

I confirmed that when I run the sequence of commands and then log out and log back in, the rabbitmq server seems to start up fine.  However, these commands are run in a script so I didn't want to have to re-login to startup the rabbitmq server.

After trying various things, it seems that rabbit is using the HOSTNAME environment variable and I needed to set that for it to work. So running the following commands appeared to work:

* /etc/init.d/rabbitmq-server stop
* In /etc/hosts changed line from 127.0.1.1 <oldhostname> <oldhostname>.localdomain -> 127.0.1.1 <newhostname> <newhostname>.localdomain
* in /etc/sysconfig/network changed HOSTNAME=<oldhostname> -> HOSTNAME=<newhostname>
* /bin/hostname <newhostname>
* export HOSTNAME=<newhostname>
* /etc/init.d/rabbitmq-server start

Can you confirm this on your system as well?  Is there an added benefit of also running rabbitmqctl stop and epmd -kill?

Thanks.

Liz
________________________________________
From: Tim Watson [watson.timothy at gmail.com]
Sent: Tuesday, October 23, 2012 4:33 AM
To: Elizabeth Liao
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory

Hi

On 22 Oct 2012, at 23:14, Elizabeth Liao <eliao at seegrid.com> wrote:

> Hi,
>
> This is what I tried
> * I start running rabbit with no NODENAME set and entered the following commands
>  * rabbitmqctl stop
>  * /etc/init.d/rabbitmq-server stop
>  * epmd -kill ( Is this correct? I didn't see a restart in the documentation )

That is correct.

>  * In /etc/hosts changed line from 127.0.1.1 <oldhostname> <oldhostname>.localdomain -> 127.0.1.1 <newhostname> <newhostname>.localdomain
>  * in /etc/sysconfig/network changed HOSTNAME=<oldhostname> -> HOSTNAME=<newhostname>
>  * /bin/hostname <newhostname>

At this point I found I needed to log out and back in again, though that was on centos an I'm not sure it's necessary to restart a profile on all operating systems. What os are you running an what does the documentation state about hostname changes? Do you, for example, have to restart the os networking sub system?

> * /etc/init.d/rabbitmq-server start
>
> The error I get is this:
> Activating RabbitMQ plugins ...
> 3 plugins activated:
> * amqp_client-2.8.6
> * erlando-2.8.6
> * rabbitmq_shovel-2.8.6
>
> ERROR: epmd error for host "<oldhostname>": nxdomain (non-existing domain)
>
>
>
> ________________________________________
> From: Tim Watson [tim at rabbitmq.com]
> Sent: Monday, October 22, 2012 6:41 AM
> To: Discussions about RabbitMQ
> Cc: Elizabeth Liao
> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
>
> Hi again,
>
> On 20 Oct 2012, at 10:52, Tim Watson wrote:
>
>> Hi Liz,
>>
>> Sorry i wasn't aware of the context. What Ian recommended should not be necessary, though I'll follow up with him on Monday to try and figure out why he needed to do that.
>>
>> Once you change the hostname you,ll possibly need to restart epmd and restart your rabbit, but you shouldn't need to change the node name from say rabbit to hare.
>>
>
> Were you able to try this again (changing only the host name but not the node name) and did it work for you? If not I'd like to know so we can investigate.
>
> Cheers
> Tim
>
>> Cheers
>> Tim
>>
>>
>>
>> On 19 Oct 2012, at 19:44, Elizabeth Liao <eliao at seegrid.com> wrote:
>>
>>> Hi Tim,
>>>
>>> I'm going to back up a bit because it seems that I've misunderstood something previously.
>>>
>>>> The first thing I'm going to say is that this isn't really a desirable
>>> state of affairs. Why do you need to change NODENAME at all, just
>>> because the host name has changed? This seems like an odd step to me -
>>> can you explain the rationale behind it?
>>>
>>> I had an earlier problem changing the hostname and restarting the rabbitmq-server. The proposed fix was to add the NODENAME variable which I'm guessing was not right? :
>>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021435.html
>>>
>>>> Can you explain a bit more about this 'bug' please? What exactly is
>>> going wrong?
>>>
>>> The bug is on our end where the NODENAME is set to an empty string. Of course this is moot if NODENAME doesn't even have to be set in the first place.
>>>
>>> Liz
>>> ________________________________________
>>> From: Tim Watson [tim at rabbitmq.com]
>>> Sent: Friday, October 19, 2012 12:48 PM
>>> To: Discussions about RabbitMQ
>>> Cc: Elizabeth Liao
>>> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
>>>
>>> Hi
>>>
>>> On 10/19/2012 03:41 PM, Elizabeth Liao wrote:
>>>> Hi,
>>>>
>>>> We are currently running rabbitmq on a system where there is a need to change the hostname occasionally.  Right now, when the hostname is changed, we also update the NODENAME variable in the rabbitmq-env.conf file.
>>>
>>> The first thing I'm going to say is that this isn't really a desirable
>>> state of affairs. Why do you need to change NODENAME at all, just
>>> because the host name has changed? This seems like an odd step to me -
>>> can you explain the rationale behind it?
>>>
>>>> The problem we're having right now is that due to a bug when setting up the rabbitmq-env.conf file, sometimes the NODENAME variable exists but is not set to anything ( NODENAME=) so rabbit never successfully starts up.  Even after setting the NODENAME variable to the hostname, rabbit still doesn't start up properly.
>>>
>>> Can you explain a bit more about this 'bug' please? What exactly is
>>> going wrong?
>>>
>>>> The only way that I could find to recover from this situation without killing the erlang process, was to also set a MNESIA_DIR variable. After I did that, once the NODENAME was set to the correct hostname, rabbit started up properly.
>>>
>>> Now this makes no sense at all to me. If you are trying to recover
>>> 'without killing the erlang process' then how are you planning on
>>> changing the NODENAME? Once an erlang node has become part of a
>>> distributed system, you cannot arbitrarily change the node's name
>>> without restarting the net_kernel AFAIK so I can't see how this is even
>>> possible. Also, because you're stating that 'rabbit started up properly'
>>> I'm assuming that you have in fact taken the node offline (using
>>> `rabbitmqctl stop` or one of the various service scripts that invokes
>>> it) and that you are now starting the node again. The rabbit startup
>>> scripts (and associated infrastructure) is not set up to handle changing
>>> the name of a node post-installation in this manner, so I would not
>>> expect this to work smoothly.
>>>
>>>> A couple of questions:
>>>> Is this the proper way to fix the situation?
>>>
>>> No. As I said a moment ago, rabbit is not set up for this kind of
>>> scenario so I'd be very cautious about doing this and would really
>>> recommend against it.
>>>
>>>> Will this have unintended consequences?
>>>
>>> I have no idea, but it is entirely possible that various things could
>>> break in obscure and alarming ways. I really would not do this if I were
>>> you.
>>>
>>>> We are running rabbitmq-server-2.8.6 and erlang-R15B.
>>>>
>>>> Thanks!
>>>
>>> Liz. I would like to help you find a safe work-around so that you can
>>> use rabbit in your environment. I would really like to understand why
>>> the changing of a machine's host-name is causing problems for you. I
>>> fully realise that after changing the hostname, it is possible that a
>>> restart may be required (although I'd have to do some research to verify
>>> whether or not this is a hard requirement). But I cannot understand why
>>> a change to the machine's host name requires changing the rabbit
>>> NODENAME at all, unless you've altered the rabbit start scripts to use
>>> 'longnames' configuration (i.e., including the complete host name in the
>>> node name) in which case, a simple solution to your problem might be to
>>> switch back to using 'shortnames'. If erlang is started using -sname
>>> rabbit@`hostname -s` and your /etc/hosts configuration supports
>>> resolving the machine's IP to the short version of the name, then
>>> changing the hostname shouldn't cause all of these headaches.
>>>
>>> For example, if I launch rabbit with something like this:
>>>
>>> env RABBITMQ_NODENAME=rabbit RABBITMQ_NODE_PORT=5672
>>> RABBITMQ_LOG_BASE="/tmp"
>>> RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia"
>>> RABBITMQ_PID_FILE="/tmp/rabbitmq-rabbit.pid"
>>> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch"
>>> RABBITMQ_ENABLED_PLUGINS_FILE="/tmp/enabled-plugins"
>>> RABBITMQ_CONFIG_FILE="/tmp/etc/rabbit" ./scripts/rabbitmq-server
>>>
>>> Then change the hostname, then stop rabbit and start it again,
>>> everything is fine.
>>>
>>> Cheers,
>>> Tim
>>>
>>>> Liz
>>>> Email Confidentiality Notice
>>>>
>>>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>> Email Confidentiality Notice
>>>
>>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> Email Confidentiality Notice
>
> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From watson.timothy at gmail.com  Wed Oct 24 22:37:07 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 24 Oct 2012 22:37:07 +0100
Subject: [rabbitmq-discuss] nodename variable and mnesia directory
In-Reply-To: <E94F626F5C43D14F8B8479C5EBD79038A85DE341@vmexchange02.seegrid.local>
References: <E94F626F5C43D14F8B8479C5EBD79038A85DD645@vmexchange02.seegrid.local>
	<5081830F.70706@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038A85DD854@vmexchange02.seegrid.local>
	<FBF9C5AB-BB8E-43CE-BC14-A8BD7A462BC8@rabbitmq.com>
	<66519775-BEBD-4EA9-9A80-361D16CBE81D@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038A85DDCE1@vmexchange02.seegrid.local>
	<1EDE5727-72BE-4384-A943-9F79DDB75819@rabbitmq.com>
	<E94F626F5C43D14F8B8479C5EBD79038A85DE341@vmexchange02.seegrid.local>
Message-ID: <B2C840B9-706A-4568-9E2F-76CC2BFDCF9F@gmail.com>

Hi Liz

On 24 Oct 2012, at 22:06, Elizabeth Liao <eliao at seegrid.com> wrote:

> I confirmed that when I run the sequence of commands and then log out and log back in, the rabbitmq server seems to start up fine.  However, these commands are run in a script so I didn't want to have to re-login to startup the rabbitmq server.
> 
> After trying various things, it seems that rabbit is using the HOSTNAME environment variable and I needed to set that for it to work. So running the following commands appeared to work:
> 
> * /etc/init.d/rabbitmq-server stop
> * In /etc/hosts changed line from 127.0.1.1 <oldhostname> <oldhostname>.localdomain -> 127.0.1.1 <newhostname> <newhostname>.localdomain
> * in /etc/sysconfig/network changed HOSTNAME=<oldhostname> -> HOSTNAME=<newhostname>
> * /bin/hostname <newhostname>
> * export HOSTNAME=<newhostname>
> * /etc/init.d/rabbitmq-server start
> 
> Can you confirm this on your system as well?  Is there an added benefit of also running rabbitmqctl stop and epmd -kill?
> 

Yes that appears to work for me in a vm. If stopping and restarting epmd is not necessary then I would just avoid doing it if I were you.

> Thanks.
> 
> Liz
> ________________________________________
> From: Tim Watson [watson.timothy at gmail.com]
> Sent: Tuesday, October 23, 2012 4:33 AM
> To: Elizabeth Liao
> Cc: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
> 
> Hi
> 
> On 22 Oct 2012, at 23:14, Elizabeth Liao <eliao at seegrid.com> wrote:
> 
>> Hi,
>> 
>> This is what I tried
>> * I start running rabbit with no NODENAME set and entered the following commands
>> * rabbitmqctl stop
>> * /etc/init.d/rabbitmq-server stop
>> * epmd -kill ( Is this correct? I didn't see a restart in the documentation )
> 
> That is correct.
> 
>> * In /etc/hosts changed line from 127.0.1.1 <oldhostname> <oldhostname>.localdomain -> 127.0.1.1 <newhostname> <newhostname>.localdomain
>> * in /etc/sysconfig/network changed HOSTNAME=<oldhostname> -> HOSTNAME=<newhostname>
>> * /bin/hostname <newhostname>
> 
> At this point I found I needed to log out and back in again, though that was on centos an I'm not sure it's necessary to restart a profile on all operating systems. What os are you running an what does the documentation state about hostname changes? Do you, for example, have to restart the os networking sub system?
> 
>> * /etc/init.d/rabbitmq-server start
>> 
>> The error I get is this:
>> Activating RabbitMQ plugins ...
>> 3 plugins activated:
>> * amqp_client-2.8.6
>> * erlando-2.8.6
>> * rabbitmq_shovel-2.8.6
>> 
>> ERROR: epmd error for host "<oldhostname>": nxdomain (non-existing domain)
>> 
>> 
>> 
>> ________________________________________
>> From: Tim Watson [tim at rabbitmq.com]
>> Sent: Monday, October 22, 2012 6:41 AM
>> To: Discussions about RabbitMQ
>> Cc: Elizabeth Liao
>> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
>> 
>> Hi again,
>> 
>> On 20 Oct 2012, at 10:52, Tim Watson wrote:
>> 
>>> Hi Liz,
>>> 
>>> Sorry i wasn't aware of the context. What Ian recommended should not be necessary, though I'll follow up with him on Monday to try and figure out why he needed to do that.
>>> 
>>> Once you change the hostname you,ll possibly need to restart epmd and restart your rabbit, but you shouldn't need to change the node name from say rabbit to hare.
>>> 
>> 
>> Were you able to try this again (changing only the host name but not the node name) and did it work for you? If not I'd like to know so we can investigate.
>> 
>> Cheers
>> Tim
>> 
>>> Cheers
>>> Tim
>>> 
>>> 
>>> 
>>> On 19 Oct 2012, at 19:44, Elizabeth Liao <eliao at seegrid.com> wrote:
>>> 
>>>> Hi Tim,
>>>> 
>>>> I'm going to back up a bit because it seems that I've misunderstood something previously.
>>>> 
>>>>> The first thing I'm going to say is that this isn't really a desirable
>>>> state of affairs. Why do you need to change NODENAME at all, just
>>>> because the host name has changed? This seems like an odd step to me -
>>>> can you explain the rationale behind it?
>>>> 
>>>> I had an earlier problem changing the hostname and restarting the rabbitmq-server. The proposed fix was to add the NODENAME variable which I'm guessing was not right? :
>>>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-July/021435.html
>>>> 
>>>>> Can you explain a bit more about this 'bug' please? What exactly is
>>>> going wrong?
>>>> 
>>>> The bug is on our end where the NODENAME is set to an empty string. Of course this is moot if NODENAME doesn't even have to be set in the first place.
>>>> 
>>>> Liz
>>>> ________________________________________
>>>> From: Tim Watson [tim at rabbitmq.com]
>>>> Sent: Friday, October 19, 2012 12:48 PM
>>>> To: Discussions about RabbitMQ
>>>> Cc: Elizabeth Liao
>>>> Subject: Re: [rabbitmq-discuss] nodename variable and mnesia directory
>>>> 
>>>> Hi
>>>> 
>>>> On 10/19/2012 03:41 PM, Elizabeth Liao wrote:
>>>>> Hi,
>>>>> 
>>>>> We are currently running rabbitmq on a system where there is a need to change the hostname occasionally.  Right now, when the hostname is changed, we also update the NODENAME variable in the rabbitmq-env.conf file.
>>>> 
>>>> The first thing I'm going to say is that this isn't really a desirable
>>>> state of affairs. Why do you need to change NODENAME at all, just
>>>> because the host name has changed? This seems like an odd step to me -
>>>> can you explain the rationale behind it?
>>>> 
>>>>> The problem we're having right now is that due to a bug when setting up the rabbitmq-env.conf file, sometimes the NODENAME variable exists but is not set to anything ( NODENAME=) so rabbit never successfully starts up.  Even after setting the NODENAME variable to the hostname, rabbit still doesn't start up properly.
>>>> 
>>>> Can you explain a bit more about this 'bug' please? What exactly is
>>>> going wrong?
>>>> 
>>>>> The only way that I could find to recover from this situation without killing the erlang process, was to also set a MNESIA_DIR variable. After I did that, once the NODENAME was set to the correct hostname, rabbit started up properly.
>>>> 
>>>> Now this makes no sense at all to me. If you are trying to recover
>>>> 'without killing the erlang process' then how are you planning on
>>>> changing the NODENAME? Once an erlang node has become part of a
>>>> distributed system, you cannot arbitrarily change the node's name
>>>> without restarting the net_kernel AFAIK so I can't see how this is even
>>>> possible. Also, because you're stating that 'rabbit started up properly'
>>>> I'm assuming that you have in fact taken the node offline (using
>>>> `rabbitmqctl stop` or one of the various service scripts that invokes
>>>> it) and that you are now starting the node again. The rabbit startup
>>>> scripts (and associated infrastructure) is not set up to handle changing
>>>> the name of a node post-installation in this manner, so I would not
>>>> expect this to work smoothly.
>>>> 
>>>>> A couple of questions:
>>>>> Is this the proper way to fix the situation?
>>>> 
>>>> No. As I said a moment ago, rabbit is not set up for this kind of
>>>> scenario so I'd be very cautious about doing this and would really
>>>> recommend against it.
>>>> 
>>>>> Will this have unintended consequences?
>>>> 
>>>> I have no idea, but it is entirely possible that various things could
>>>> break in obscure and alarming ways. I really would not do this if I were
>>>> you.
>>>> 
>>>>> We are running rabbitmq-server-2.8.6 and erlang-R15B.
>>>>> 
>>>>> Thanks!
>>>> 
>>>> Liz. I would like to help you find a safe work-around so that you can
>>>> use rabbit in your environment. I would really like to understand why
>>>> the changing of a machine's host-name is causing problems for you. I
>>>> fully realise that after changing the hostname, it is possible that a
>>>> restart may be required (although I'd have to do some research to verify
>>>> whether or not this is a hard requirement). But I cannot understand why
>>>> a change to the machine's host name requires changing the rabbit
>>>> NODENAME at all, unless you've altered the rabbit start scripts to use
>>>> 'longnames' configuration (i.e., including the complete host name in the
>>>> node name) in which case, a simple solution to your problem might be to
>>>> switch back to using 'shortnames'. If erlang is started using -sname
>>>> rabbit@`hostname -s` and your /etc/hosts configuration supports
>>>> resolving the machine's IP to the short version of the name, then
>>>> changing the hostname shouldn't cause all of these headaches.
>>>> 
>>>> For example, if I launch rabbit with something like this:
>>>> 
>>>> env RABBITMQ_NODENAME=rabbit RABBITMQ_NODE_PORT=5672
>>>> RABBITMQ_LOG_BASE="/tmp"
>>>> RABBITMQ_MNESIA_DIR="/tmp/rabbitmq-rabbit-mnesia"
>>>> RABBITMQ_PID_FILE="/tmp/rabbitmq-rabbit.pid"
>>>> RABBITMQ_PLUGINS_EXPAND_DIR="/tmp/rabbitmq-rabbit-plugins-scratch"
>>>> RABBITMQ_ENABLED_PLUGINS_FILE="/tmp/enabled-plugins"
>>>> RABBITMQ_CONFIG_FILE="/tmp/etc/rabbit" ./scripts/rabbitmq-server
>>>> 
>>>> Then change the hostname, then stop rabbit and start it again,
>>>> everything is fine.
>>>> 
>>>> Cheers,
>>>> Tim
>>>> 
>>>>> Liz
>>>>> Email Confidentiality Notice
>>>>> 
>>>>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>> 
>>>> Email Confidentiality Notice
>>>> 
>>>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> Email Confidentiality Notice
>> 
>> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.
> Email Confidentiality Notice
> 
> The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From alexis at rabbitmq.com  Wed Oct 24 22:45:10 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Wed, 24 Oct 2012 22:45:10 +0100
Subject: [rabbitmq-discuss] Means to interact with rabbitMQ from simple
 html UI
In-Reply-To: <CALPqkiozoeYQb-vEE3xPqV9beJAc31FbdrRmSvp6eBLSt_zm1A@mail.gmail.com>
References: <242E9559AA2C354CB60C81A952FCBEB5022F81@TSEAMB01>
	<CALPqkiozoeYQb-vEE3xPqV9beJAc31FbdrRmSvp6eBLSt_zm1A@mail.gmail.com>
Message-ID: <CACOPnvc4=22J=bw6mb1ve_JWaJfQt7C2AA15BujQ6_-UXdMgdQ@mail.gmail.com>

Thanks Brett!

Jim,

See also the HTTP API for management which may do what you need:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_8_7/priv/www/api/index.html

YES.. this does need to be more 'discoverable' on the Rabbit web site!

alexis


On Wed, Oct 24, 2012 at 9:32 PM, Brett Cameron
<brett.r.cameron at gmail.com> wrote:
> Jim,
>
> You might like to take a look at
> http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/ and
> http://commondatastorage.googleapis.com/opensourceprojects/RabbitMQ/RabbitHub.pdf.
> I've not tried it, but in theory there should be no problem using RabbitHub
> to publish messages in the manner you have described, but (as things stand)
> using simple HTML alone you would not be able to use RabbitHub to receive
> messages. A better approach might be to write some simple web server-side
> component in your language of choice that takes POST and GET requests from
> from your HTML web pages and translates the requests into appropriate calls
> to RabbitMQ. The RabbitMQ Web STOMP plugin could I think satisfy both of
> your requirements, but again you're not looking at just simple HTML with
> this.
>
> Regards,
> Brett
>
> On Thu, Oct 25, 2012 at 7:00 AM, McMahon, James S (TASC)
> <james.mcmahon at tasc.com> wrote:
>>
>>      I've explored the rabbitMQ java examples to learn how applications
>> can send and receive messages through rabbitMQ direct exchanges using a java
>> implementation. But in many cases I have only a user interface that is a
>> simple html web page. How can I receive and emit messages through direct
>> exchanges in that case? Are there examples that show me how to interact with
>> rabbitMQ using RESTful calls?
>>
>> Thanks in advance for your thoughts.  - Jim
>>
>> CONFIDENTIALITY NOTICE: This message and any attachments or files
>> transmitted with it (collectively, the "Message") are intended only for the
>> addressee and may contain information that is privileged, proprietary and/or
>> prohibited from disclosure by law or contract. If you are not the intended
>> recipient: (a) please do not read, copy or retransmit the Message; (b)
>> permanently delete and/or destroy all electronic and hard copies of the
>> Message; (c) notify us by return email; and (d) you are hereby notified that
>> any dissemination, distribution or copying of the Message is strictly
>> prohibited.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mpietrek at skytap.com  Thu Oct 25 01:48:35 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 24 Oct 2012 17:48:35 -0700
Subject: [rabbitmq-discuss] Can a downed node affect responsive of HTTP
	queries to other nodes?
Message-ID: <CACLE7ixuzB7FextwyayEPyVe8+TEiO=08pu1BxZS9BTyVsHSjw@mail.gmail.com>

As part of our production monitoring support, we have a script that runs
every five seconds and checks some information about the queues. In
particular, it uses the "/api/queues/..." URL to  query info about them.

All of our queues are declared as HA. Recently we had some problems where a
node just got stuck for 30+ minutes (Known linux kernel bug). However, on
the monitoring running on the healthy node, I was seeing my /api/queues
queries timing out.

I'm guessing that there's some set of the HTTP APIs that when invoked, may
cause network traffic to other nodes. And if those nodes are down, the HTTP
API is essentially useless as it eventually times out waiting for
communication with the downed node.

Can you always helpful RabbitMQ folks tell me if this is indeed the case,
and if there's anything else useful to know when planning a monitoring
strategy using the HTTP API?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121024/f4a9e0bd/attachment.htm>

From wongkamhoong at gmail.com  Thu Oct 25 03:22:08 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Thu, 25 Oct 2012 10:22:08 +0800
Subject: [rabbitmq-discuss] RabbitMQ node faced out of disk space
 problem under cluster environment
In-Reply-To: <5087B178.3030105@rabbitmq.com>
References: <CAHv8OSSG8vMrxzm9H8N4TYAAfBdvXLmHH4Pozq50L14061iKpA@mail.gmail.com>
	<5087B178.3030105@rabbitmq.com>
Message-ID: <CAHv8OSSZUCMR6sXK8a-HEeW2wUXyO-rhp-+WaF9bRAnM=f5new@mail.gmail.com>

Hi Simon,

You meant the cluster not only stop all publish requests and will crash at
the end? Means consume requests also can't be send to the RabbitMQ?

Regards,
Wong

On Wed, Oct 24, 2012 at 5:14 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 24/10/12 07:46, Wong Kam Hoong wrote:
>
>> Hi RabbitMQ Team,
>>
>> If one of the RabbitMQ node under cluster environment facing out of disk
>> space problem, what will happen?
>>
>> 1) The cluster stop function properly or even worst?
>> 2) Just impacted node stop sync data from others?
>>
>
> Disc space monitoring was added in 2.8.2. If the disc space falls below
> the monitored threshold then *the whole cluster* will stop accepting
> publishes until more space becomes available.
>
> This doesn't completely stop you from running out of disc space, but it
> makes it very unlikely that RabbitMQ will take the last disc space on the
> machine.
>
> Running out of disc space will cause RabbitMQ to crash.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/af48adeb/attachment.htm>

From wongkamhoong at gmail.com  Thu Oct 25 03:25:16 2012
From: wongkamhoong at gmail.com (Wong Kam Hoong)
Date: Thu, 25 Oct 2012 10:25:16 +0800
Subject: [rabbitmq-discuss] RabbitMQ node faced out of disk space
 problem under cluster environment
In-Reply-To: <5087B641.3070207@rabbitmq.com>
References: <CAHv8OSSG8vMrxzm9H8N4TYAAfBdvXLmHH4Pozq50L14061iKpA@mail.gmail.com>
	<5087B178.3030105@rabbitmq.com> <5087B641.3070207@rabbitmq.com>
Message-ID: <CAHv8OSSjBbtdQo_QeMqntn4JppB=W6wH6z2v=c1J4iXquNBjhg@mail.gmail.com>

Hi Matthias,

Besides of stop all publishes, how about consumes? Does RabbitMQ stop the
consumes as well?

Regards,
Wong


On Wed, Oct 24, 2012 at 5:34 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 24/10/12 10:14, Simon MacMullen wrote:
>
>> If the disc space falls below the monitored threshold then *the whole
>> cluster* will stop accepting publishes until more space becomes
>> available.
>>
>
> The same is true for memory alarms, i.e. when *any* node in a cluster
> encounters a memory alarm then *all* nodes will block publishers.
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/469700c5/attachment.htm>

From matthias at rabbitmq.com  Thu Oct 25 08:18:14 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Thu, 25 Oct 2012 08:18:14 +0100
Subject: [rabbitmq-discuss] RabbitMQ node faced out of disk space
 problem under cluster environment
In-Reply-To: <CAHv8OSSZUCMR6sXK8a-HEeW2wUXyO-rhp-+WaF9bRAnM=f5new@mail.gmail.com>
References: <CAHv8OSSG8vMrxzm9H8N4TYAAfBdvXLmHH4Pozq50L14061iKpA@mail.gmail.com>
	<5087B178.3030105@rabbitmq.com>
	<CAHv8OSSZUCMR6sXK8a-HEeW2wUXyO-rhp-+WaF9bRAnM=f5new@mail.gmail.com>
Message-ID: <5088E7B6.40601@rabbitmq.com>

On 25/10/12 03:22, Wong Kam Hoong wrote:
> You meant the cluster not only stop all publish requests and will
> crash at the end?

Well, if you really *completely run out* of disk space or memory then
yes, whichever node that is happening on will crash. But that's why we
have alarms in place that block publishing across the entire cluster
when disk space or memory are getting low - before rabbit is in danger
of crashing.

> Besides of stop all publishes, how about consumes? Does RabbitMQ stop
> the consumes as well?

No, assuming you follow the advise from http://www.rabbitmq.com/memory.html
<quote>
other design considerations permitting, it is advisable to only use 
individual AMQP connections for either producing or consuming.
</quote>

Matthias.

From srdan at kvrgic.se  Thu Oct 25 06:33:47 2012
From: srdan at kvrgic.se (Srdan Kvrgic)
Date: Thu, 25 Oct 2012 07:33:47 +0200
Subject: [rabbitmq-discuss] Batching messages
Message-ID: <0AB02CE2-48A6-4F1D-A19B-7B88B2C7EEA7@kvrgic.se>

Hi,

Short story:
Are there any plans to support batching of messages within the rabbitmq eco-system?


Long story:
We at Burtcorp are using rabbit-mq to send relatively small messages (1kb) at rates of a couple of thousand per second. We noticed at one point that there seemed to be a lot of overhead with handling individual messages so we started lumping a bunch of messages in a batch and sending that. The throughput sky-rocketed.

I did some benchmarks back in the day (http://goo.gl/wmEmD). The graphs on page 14 and 16 illustrate the extremes of this point. Maxing out sending 10 byte messages at 5000/s or 10kb at 1200/s.

So the throughput boost is great, as could be expected. There's a reason Amazon bundles your books together when shipping them - the overhead of sending each individually would put them out of business.

Still, there are issues with our manual batching. The problem is when we screw up processing a message. The paradigm is to reject the message you can't process but the problem is we got a batch of 10 messages and we only failed processing one. We can't reject the whole batch. That would mean re-processing the 9 messages that got processed the first time around..

Optimally you would want a system that sends and receives batches of messages but allows you to reject single messages. Have your cake and eat it, as it were...

Also automatic de-/compression in the driver. That also was a great performance boost when the batches started getting big. Lzf ftw!

You think?

Kind regards,
Srdan



From emile at rabbitmq.com  Thu Oct 25 11:06:36 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 25 Oct 2012 11:06:36 +0100
Subject: [rabbitmq-discuss] Batching messages
In-Reply-To: <0AB02CE2-48A6-4F1D-A19B-7B88B2C7EEA7@kvrgic.se>
References: <0AB02CE2-48A6-4F1D-A19B-7B88B2C7EEA7@kvrgic.se>
Message-ID: <50890F2C.1020703@rabbitmq.com>

Hi,

On 25/10/12 06:33, Srdan Kvrgic wrote:
> You think?

There may be other ways of achieving higher throughput that you should
explore first before investing in more complex solutions. A potential
improvement would be to use auto-ack or to acknowledge messages in
batches. And not to use persistence unless necessary. I assume you have
exhausted other options.

Do you get any throughput improvement if you turn off Nagle's algorithm?
Both publishing and consuming can be asynchronous when using RabbitMQ.
If that were not the case then the throughput due to batching would be
more dramatic. I suspect you will see some improvement due to network
batching when turning off Nagle's algorithm.

If the above don't give acceptable gains and you really need batching of
messages then this can be implemented in a library that sits between
your application and the broker. Such a library would be in the best
position to judge the throughput/latency trade-off and limit the batches
based on size or latency constraints. It should be able to pack messages
on the publishing side and unpack on the consuming side.

A possible approach that a library might take to rejecting an individual
message would be to acknowledge the aggregate batch message and to
re-publish the rejected message with a suitable header. Message ordering
will be lost, but this might be a close enough approximation to
rejecting an individual message in many cases.



-Emile




From tim at rabbitmq.com  Thu Oct 25 10:54:17 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 25 Oct 2012 10:54:17 +0100
Subject: [rabbitmq-discuss] Batching messages
In-Reply-To: <0AB02CE2-48A6-4F1D-A19B-7B88B2C7EEA7@kvrgic.se>
References: <0AB02CE2-48A6-4F1D-A19B-7B88B2C7EEA7@kvrgic.se>
Message-ID: <50890C49.60705@rabbitmq.com>

Hi

On 10/25/2012 06:33 AM, Srdan Kvrgic wrote:
> Hi,
>
> Short story:
> Are there any plans to support batching of messages within the rabbitmq eco-system?
>
>
> Long story:
[snip]
> Optimally you would want a system that sends and receives batches of messages but allows you to reject single messages. Have your cake and eat it, as it were...

Sounds good, but...

AMQP already provides batching delivery capabilities and these have been 
discussed previously, for example 
https://groups.google.com/forum/?fromgroups=#!topic/rabbitmq-discuss/CidFKmJrBFI. 
But what you seem to be running up against is the fact that your many 
small messages limit throughput, so you want to bundle them up. I would 
suggest putting a processor between the publisher and consumer which 
unpacks the batches and forwards individual messages to the target 
exchange. This could be achieved by writing a custom exchange type, 
configured to understand how to 'unpack' the batch and where to route 
the forwarded messages to. The consumers would then receive these 
individual messages (possibly in batches!) and could reject some or all 
of them, but that rejection would not be apparent to the outside world 
in any way! So you'd need to then change your design somewhat, perhaps 
by putting 'failed' messages onto a different 'error queue' *or* by 
rejecting them and setting up a TTL and Dead Letter eXchange on the 
destination queue so that you can identify failures transparently. In 
either case, you'd want to add some kind of x-batch-id header to the 
'broken up' messages so that your reprocessing procedure is able to 
identify the source batch from which they came.

Doing this 'in the broker' doesn't really make sense to me. How would 
transactions and/or confirms continue to work, for example?

> Also automatic de-/compression in the driver. That also was a great performance boost when the batches started getting big. Lzf ftw!

Hmn, that's an interesting one! Which client library are you using?

> You think?
>
> Kind regards,
> Srdan
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Thu Oct 25 11:30:59 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 25 Oct 2012 11:30:59 +0100
Subject: [rabbitmq-discuss] Can a downed node affect responsive of HTTP
 queries to other nodes?
In-Reply-To: <CACLE7ixuzB7FextwyayEPyVe8+TEiO=08pu1BxZS9BTyVsHSjw@mail.gmail.com>
References: <CACLE7ixuzB7FextwyayEPyVe8+TEiO=08pu1BxZS9BTyVsHSjw@mail.gmail.com>
Message-ID: <508914E3.50806@rabbitmq.com>

Hi Matt.

In 2.8.x /api/nodes will make RPC calls to each node, but no other paths 
will. In 3.0 that's going to be removed as well.

However, /api/queues, like a lot of other paths, makes calls into Mnesia 
to figure out what things exist. When a node is unresponsive, calls into 
Mnesia can hang...

... but only for long enough for the VM to declare that the node is down 
(again configured by net_ticktime, defaulting to about a minute). After 
that, the node should be declared down and Mnesia should ignore it.

So when you say the node was "stuck", was it completely unresponsive? I 
am wondering if it could be just responsive enough to prevent Erlang 
from considering it down, while still being unresponsive enough to... be 
unresponsive.

Cheers, Simon

On 25/10/12 01:48, Matt Pietrek wrote:
> As part of our production monitoring support, we have a script that runs
> every five seconds and checks some information about the queues. In
> particular, it uses the "/api/queues/..." URL to  query info about them.
>
> All of our queues are declared as HA. Recently we had some problems
> where a node just got stuck for 30+ minutes (Known linux kernel bug).
> However, on the monitoring running on the healthy node, I was seeing my
> /api/queues queries timing out.
>
> I'm guessing that there's some set of the HTTP APIs that when invoked,
> may cause network traffic to other nodes. And if those nodes are down,
> the HTTP API is essentially useless as it eventually times out waiting
> for communication with the downed node.
>
> Can you always helpful RabbitMQ folks tell me if this is indeed the
> case, and if there's anything else useful to know when planning a
> monitoring strategy using the HTTP API?
>
> Thanks,
>
> Matt
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From james.mcmahon at TASC.COM  Thu Oct 25 11:54:54 2012
From: james.mcmahon at TASC.COM (McMahon, James S (TASC))
Date: Thu, 25 Oct 2012 10:54:54 +0000
Subject: [rabbitmq-discuss] Means to interact with rabbitMQ from simple
 html UI
In-Reply-To: <CACOPnvc4=22J=bw6mb1ve_JWaJfQt7C2AA15BujQ6_-UXdMgdQ@mail.gmail.com>
References: <242E9559AA2C354CB60C81A952FCBEB5022F81@TSEAMB01>
	<CALPqkiozoeYQb-vEE3xPqV9beJAc31FbdrRmSvp6eBLSt_zm1A@mail.gmail.com>,
	<CACOPnvc4=22J=bw6mb1ve_JWaJfQt7C2AA15BujQ6_-UXdMgdQ@mail.gmail.com>
Message-ID: <242E9559AA2C354CB60C81A952FCBEB5022FE8@TSEAMB01>

Thank you very much for your replies, Alexis and Brett. I will look into these references you suggest in your replies.

Jim
________________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [rabbitmq-discuss-bounces at lists.rabbitmq.com] on behalf of Alexis Richardson [alexis at rabbitmq.com]
Sent: Wednesday, October 24, 2012 5:45 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Means to interact with rabbitMQ from simple html UI

Thanks Brett!

Jim,

See also the HTTP API for management which may do what you need:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_8_7/priv/www/api/index.html

YES.. this does need to be more 'discoverable' on the Rabbit web site!

alexis


On Wed, Oct 24, 2012 at 9:32 PM, Brett Cameron
<brett.r.cameron at gmail.com> wrote:
> Jim,
>
> You might like to take a look at
> http://www.rabbitmq.com/blog/2012/05/14/introducing-rabbitmq-web-stomp/ and
> http://commondatastorage.googleapis.com/opensourceprojects/RabbitMQ/RabbitHub.pdf.
> I've not tried it, but in theory there should be no problem using RabbitHub
> to publish messages in the manner you have described, but (as things stand)
> using simple HTML alone you would not be able to use RabbitHub to receive
> messages. A better approach might be to write some simple web server-side
> component in your language of choice that takes POST and GET requests from
> from your HTML web pages and translates the requests into appropriate calls
> to RabbitMQ. The RabbitMQ Web STOMP plugin could I think satisfy both of
> your requirements, but again you're not looking at just simple HTML with
> this.
>
> Regards,
> Brett
>
> On Thu, Oct 25, 2012 at 7:00 AM, McMahon, James S (TASC)
> <james.mcmahon at tasc.com> wrote:
>>
>>      I've explored the rabbitMQ java examples to learn how applications
>> can send and receive messages through rabbitMQ direct exchanges using a java
>> implementation. But in many cases I have only a user interface that is a
>> simple html web page. How can I receive and emit messages through direct
>> exchanges in that case? Are there examples that show me how to interact with
>> rabbitMQ using RESTful calls?
>>
>> Thanks in advance for your thoughts.  - Jim
>>
>> CONFIDENTIALITY NOTICE: This message and any attachments or files
>> transmitted with it (collectively, the "Message") are intended only for the
>> addressee and may contain information that is privileged, proprietary and/or
>> prohibited from disclosure by law or contract. If you are not the intended
>> recipient: (a) please do not read, copy or retransmit the Message; (b)
>> permanently delete and/or destroy all electronic and hard copies of the
>> Message; (c) notify us by return email; and (d) you are hereby notified that
>> any dissemination, distribution or copying of the Message is strictly
>> prohibited.
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
CONFIDENTIALITY NOTICE: This message and any attachments or files transmitted with it (collectively, the "Message") are intended only for the addressee and may contain information that is privileged, proprietary and/or prohibited from disclosure by law or contract. If you are not the intended recipient: (a) please do not read, copy or retransmit the Message; (b) permanently delete and/or destroy all electronic and hard copies of the Message; (c) notify us by return email; and (d) you are hereby notified that any dissemination, distribution or copying of the Message is strictly prohibited.

From deshai-0 at student.ltu.se  Thu Oct 25 12:18:25 2012
From: deshai-0 at student.ltu.se (Desta Haileselassie Hagos)
Date: Thu, 25 Oct 2012 13:18:25 +0200
Subject: [rabbitmq-discuss] RabbitMQ, push a script
Message-ID: <CAKiRAqVHc+kZHXVpNGjp36-_74vDfkxjNfPsi7+qFJDj2kPSUw@mail.gmail.com>

Hi,

I have created a script "services.sh" which executes a certain command. I
want to push this script command to RabbitMQ and to read the output of the
script by connecting to RabbitMQ. I am not sure if it is possible though.

But I am new to RabbitMQ, and I would appreciate if you could send me some
pointers on how I can approach it.

Thank you so much.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/3b5665f1/attachment.htm>

From dev440 at gmail.com  Thu Oct 25 12:43:14 2012
From: dev440 at gmail.com (chetan dev)
Date: Thu, 25 Oct 2012 17:13:14 +0530
Subject: [rabbitmq-discuss] Node not running
Message-ID: <CAB0ZxM7++kGH=h-Eqp2tMmGBX-NqDYSPt3urxZ+GNhBkCDLAnw@mail.gmail.com>

Hi,

I have two  clustered disc nodes running happily on different systems for
e.g. node1(system1) and node2(system2).
Now i put on sleep the computer which holds node1 and check cluster status
on system2 , it shows that node2 is running.
Now i start  system1 , node1 starts automatically . But when i check
clustering status on  system 1 , it shows only node1 is running and when i
do the same for system2 it shows that only node2 is running. Now what
happened to clustering ?


Thanks

-- 
Cheten  Dev

B.Tech
IIT Delhi, New Delhi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/5ee63138/attachment.htm>

From brendan at soundcloud.com  Thu Oct 25 13:00:20 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Thu, 25 Oct 2012 14:00:20 +0200
Subject: [rabbitmq-discuss] Per Connection Flow Control Issue
Message-ID: <CAHZsVQYHNXSzOfCy84C5wA4J_8M=iBAp7+caj26nv3fK7txxvg@mail.gmail.com>

I have a strange occurrence with ruby-amqp 0.9.8 and RabbitMQ 2.8.7 /
Erlang R15B02:

Out of a few hundred connections, it appears that less than half a dozen
are marked as 'flow' in the mgmt interface.
The actual channels belonging to these connections are _not_ marked as
blocked, and are considered 'idle'.

On the client machines, netstat shows the peer sockets to have huge (and
growing) send queues.

Does anybody have any experience with similar problems? I am yet to catch
it in the act,
but it appears flow control must kick in at some point and the connection
simply does not
resume reading the pending bytes off the socket after it is issued new
credits.

Posted this here as I'm not sure who/what to point the proverbial finger
at, suggestions appreciated.

- Brendan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/dca27542/attachment.htm>

From emile at rabbitmq.com  Thu Oct 25 13:26:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 25 Oct 2012 13:26:45 +0100
Subject: [rabbitmq-discuss] RabbitMQ, push a script
In-Reply-To: <CAKiRAqVHc+kZHXVpNGjp36-_74vDfkxjNfPsi7+qFJDj2kPSUw@mail.gmail.com>
References: <CAKiRAqVHc+kZHXVpNGjp36-_74vDfkxjNfPsi7+qFJDj2kPSUw@mail.gmail.com>
Message-ID: <50893005.8090207@rabbitmq.com>

Hi,

On 25/10/12 12:18, Desta Haileselassie Hagos wrote:
> I have created a script "services.sh" which executes a certain command.
> I want to push this script command to RabbitMQ and to read the output of
> the script by connecting to RabbitMQ. I am not sure if it is possible
> though.

Take care when sending executable messages. The receiver must have alot
of trust in the sender if you do that.

> But I am new to RabbitMQ, and I would appreciate if you could send me
> some pointers on how I can approach it.

You may be able to implement this using the RPC pattern. See
http://www.rabbitmq.com/tutorials/tutorial-six-python.html


-Emile


From emile at rabbitmq.com  Thu Oct 25 13:36:52 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 25 Oct 2012 13:36:52 +0100
Subject: [rabbitmq-discuss] Node not running
In-Reply-To: <CAB0ZxM7++kGH=h-Eqp2tMmGBX-NqDYSPt3urxZ+GNhBkCDLAnw@mail.gmail.com>
References: <CAB0ZxM7++kGH=h-Eqp2tMmGBX-NqDYSPt3urxZ+GNhBkCDLAnw@mail.gmail.com>
Message-ID: <50893264.40309@rabbitmq.com>

Hi,

On 25/10/12 12:43, chetan dev wrote:
> Now i put on sleep the computer which holds node1 and check cluster

RabbitMQ clusters are not tolerant of partitions. You will need to reset
node1 before it can rejoin the cluster. If you need a distributed system
capable of surviving temporal discontinuities then federation may be
more appropriate. For a comparison see

http://www.rabbitmq.com/distributed.html

-Emile


From tim at rabbitmq.com  Thu Oct 25 13:47:23 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Thu, 25 Oct 2012 13:47:23 +0100
Subject: [rabbitmq-discuss] Node not running
In-Reply-To: <CAB0ZxM7++kGH=h-Eqp2tMmGBX-NqDYSPt3urxZ+GNhBkCDLAnw@mail.gmail.com>
References: <CAB0ZxM7++kGH=h-Eqp2tMmGBX-NqDYSPt3urxZ+GNhBkCDLAnw@mail.gmail.com>
Message-ID: <508934DB.5060002@rabbitmq.com>

Hi

On 10/25/2012 12:43 PM, chetan dev wrote:
> Hi,
>
> I have two  clustered disc nodes running happily on different 
> systems for e.g. node1(system1) and node2(system2).
> Now i put on sleep the computer which holds node1 and check cluster 
> status on system2 , it shows that node2 is running.
> Now i start  system1 , node1 starts automatically . But when i check 
> clustering status on  system 1 , it shows only node1 is running and 
> when i do the same for system2 it shows that only node2 is running. 
> Now what happened to clustering ?
>

By 'putting node1 to sleep' you have created a network partition, and 
rabbitmq clusters are not tolerant to network partitions. If you post 
the logs from both nodes then we can see exactly what went wrong. But in 
general, you should not use clustering on networks that are subject to 
partition or run clustered nodes on servers that are likely to shutdown 
or sleep without first stopping the rabbit node running on them.

>
> Thanks
>
> -- 
> Cheten  Dev
>
> B.Tech
> IIT Delhi, New Delhi
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/c274155b/attachment.htm>

From simon at rabbitmq.com  Thu Oct 25 14:52:00 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 25 Oct 2012 14:52:00 +0100
Subject: [rabbitmq-discuss] Per Connection Flow Control Issue
In-Reply-To: <CAHZsVQYHNXSzOfCy84C5wA4J_8M=iBAp7+caj26nv3fK7txxvg@mail.gmail.com>
References: <CAHZsVQYHNXSzOfCy84C5wA4J_8M=iBAp7+caj26nv3fK7txxvg@mail.gmail.com>
Message-ID: <50894400.2080107@rabbitmq.com>

On 25/10/12 13:00, Brendan Hay wrote:
> I have a strange occurrence with ruby-amqp 0.9.8 and RabbitMQ 2.8.7 /
> Erlang R15B02:
>
> Out of a few hundred connections, it appears that less than half a dozen
> are marked as 'flow' in the mgmt interface.
> The actual channels belonging to these connections are _not_ marked as
> blocked, and are considered 'idle'.

Bear in mind that the "Client blocked" flag on the channel is to tell 
you whether the *client* has blocked the channel by issuing 
"channel.flow", not the server.

I am suspicious that these channels are described as idle though.

> On the client machines, netstat shows the peer sockets to have huge (and
> growing) send queues.
>
> Does anybody have any experience with similar problems? I am yet to
> catch it in the act,
> but it appears flow control must kick in at some point and the
> connection simply does not
> resume reading the pending bytes off the socket after it is issued new
> credits.

What does:

$ rabbitmqctl list_connections name last_blocked_age last_blocked_by

show for these connections? In particular, the last_blocked_age column 
should tell you when flow control last went on for a given connection; 
if it's last_blocked_by is "flow" I would expect that to be a small 
number since flow control should normally go on and off rapidly.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From deshai-0 at student.ltu.se  Thu Oct 25 15:19:35 2012
From: deshai-0 at student.ltu.se (Desta)
Date: Thu, 25 Oct 2012 07:19:35 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ, push a script
In-Reply-To: <50893005.8090207@rabbitmq.com>
References: <CAKiRAqVHc+kZHXVpNGjp36-_74vDfkxjNfPsi7+qFJDj2kPSUw@mail.gmail.com>
	<50893005.8090207@rabbitmq.com>
Message-ID: <1351174775019-22864.post@n5.nabble.com>

Thank you so much for your prompt reply.

I included the path of where my bash script, i.e . "services.sh" is located
to my python script. But it is giving me the following error.

"405 RESOURCE_LOCKED - cannot obtain exclusive access to locked queue
'amq.gen-gA3hbOZr-m1HmmVZGq1uHs' in vhost '/' "


I would appreciate if you could send me a sample script on how I should
include it correctly. What i need is to execute my bash script inside a
python script and display the out put which the "services.sh" is supposed to
display.


With best regards,



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-push-a-script-tp22857p22864.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Thu Oct 25 15:27:46 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 25 Oct 2012 18:27:46 +0400
Subject: [rabbitmq-discuss] Per Connection Flow Control Issue
In-Reply-To: <CAHZsVQYHNXSzOfCy84C5wA4J_8M=iBAp7+caj26nv3fK7txxvg@mail.gmail.com>
References: <CAHZsVQYHNXSzOfCy84C5wA4J_8M=iBAp7+caj26nv3fK7txxvg@mail.gmail.com>
Message-ID: <CAE3HoVT24kWzaZKti2YPZ-j=ShAmJciwx11SRxUwXGd49pY62w@mail.gmail.com>

2012/10/25 Brendan Hay <brendan at soundcloud.com>

> On the client machines, netstat shows the peer sockets to have huge (and
> growing) send queues.
>
> Does anybody have any experience with similar problems? I am yet to catch
> it in the act,
> but it appears flow control must kick in at some point and the connection
> simply does not
> resume reading the pending bytes off the socket after it is issued new
> credits.
>
> Posted this here as I'm not sure who/what to point the proverbial finger
> at, suggestions appreciated.
>

Brendan,

Because amqp gem does not do any implicit or automatic flow control, I'd
expect the root cause
to be in EventMachine. Do you have a way to reproduce this issue?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/ed60f851/attachment.htm>

From brendan at soundcloud.com  Thu Oct 25 15:41:36 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Thu, 25 Oct 2012 16:41:36 +0200
Subject: [rabbitmq-discuss] Per Connection Flow Control Issue
In-Reply-To: <CAE3HoVT24kWzaZKti2YPZ-j=ShAmJciwx11SRxUwXGd49pY62w@mail.gmail.com>
References: <CAHZsVQYHNXSzOfCy84C5wA4J_8M=iBAp7+caj26nv3fK7txxvg@mail.gmail.com>
	<CAE3HoVT24kWzaZKti2YPZ-j=ShAmJciwx11SRxUwXGd49pY62w@mail.gmail.com>
Message-ID: <CAHZsVQbBw-U+On7DzuqJFwZ6hpDxZXeW+UwyCh9yOevhJyVqjw@mail.gmail.com>

Simon: list_connections snippet here -
https://gist.github.com/8056314cece0d44ab21c
Not every channel belonging to those connections marked by 'flow' is
'idle', a seemingly
random distribution are 'active' also, but with no ingress bytes

Michael: No way to reproduce outside of the production environment yet,
will reply
with an example when I can isolate it.

On Thu, Oct 25, 2012 at 4:27 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2012/10/25 Brendan Hay <brendan at soundcloud.com>
>
>> On the client machines, netstat shows the peer sockets to have huge (and
>> growing) send queues.
>>
>> Does anybody have any experience with similar problems? I am yet to catch
>> it in the act,
>> but it appears flow control must kick in at some point and the connection
>> simply does not
>> resume reading the pending bytes off the socket after it is issued new
>> credits.
>>
>> Posted this here as I'm not sure who/what to point the proverbial finger
>> at, suggestions appreciated.
>>
>
> Brendan,
>
> Because amqp gem does not do any implicit or automatic flow control, I'd
> expect the root cause
> to be in EventMachine. Do you have a way to reproduce this issue?
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/943d2f09/attachment.htm>

From simon at rabbitmq.com  Thu Oct 25 15:52:13 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 25 Oct 2012 15:52:13 +0100
Subject: [rabbitmq-discuss] Per Connection Flow Control Issue
In-Reply-To: <CAE3HoVT24kWzaZKti2YPZ-j=ShAmJciwx11SRxUwXGd49pY62w@mail.gmail.com>
References: <CAHZsVQYHNXSzOfCy84C5wA4J_8M=iBAp7+caj26nv3fK7txxvg@mail.gmail.com>
	<CAE3HoVT24kWzaZKti2YPZ-j=ShAmJciwx11SRxUwXGd49pY62w@mail.gmail.com>
Message-ID: <5089521D.7050000@rabbitmq.com>

On 25/10/12 15:27, Michael Klishin wrote:
> Because amqp gem does not do any implicit or automatic flow control, I'd
> expect the root cause
> to be in EventMachine. Do you have a way to reproduce this issue?

The flow control at the server side is implemented by just not reading 
from the socket. So clients do not need to do anything; publishing will 
just block.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Thu Oct 25 15:59:37 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 25 Oct 2012 15:59:37 +0100
Subject: [rabbitmq-discuss] RabbitMQ, push a script
In-Reply-To: <1351174775019-22864.post@n5.nabble.com>
References: <CAKiRAqVHc+kZHXVpNGjp36-_74vDfkxjNfPsi7+qFJDj2kPSUw@mail.gmail.com>
	<50893005.8090207@rabbitmq.com>
	<1351174775019-22864.post@n5.nabble.com>
Message-ID: <508953D9.1050806@rabbitmq.com>

Hi,

On 25/10/12 15:19, Desta wrote:
> "405 RESOURCE_LOCKED - cannot obtain exclusive access to locked queue
> 'amq.gen-gA3hbOZr-m1HmmVZGq1uHs' in vhost '/' "

This error means the queue was declared as exclusive, while you probably
want it to be shared instead. Here are some relevant pointers to the
specification:

http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.exclusive
http://www.rabbitmq.com/amqp-0-9-1-reference.html#constant.resource-locked



-Emile


From deshai-0 at student.ltu.se  Thu Oct 25 17:47:24 2012
From: deshai-0 at student.ltu.se (Desta Haileselassie Hagos)
Date: Thu, 25 Oct 2012 18:47:24 +0200
Subject: [rabbitmq-discuss] RabbitMQ, push a script
In-Reply-To: <508953D9.1050806@rabbitmq.com>
References: <CAKiRAqVHc+kZHXVpNGjp36-_74vDfkxjNfPsi7+qFJDj2kPSUw@mail.gmail.com>
	<50893005.8090207@rabbitmq.com>
	<1351174775019-22864.post@n5.nabble.com>
	<508953D9.1050806@rabbitmq.com>
Message-ID: <CAKiRAqXmB8ZS6+PcxWyynZiLy9RNbveNHJjt0uJObKVBxpxYFA@mail.gmail.com>

Dear Emile,

Thank you for the link. It was so helpful and managed to solve the problem.

I have one more question, I want my queues to be read by many users so that
the queue will not be empty once one user has read the messages.

Is there any way to preserve the messages for all users or for a specific
period of time? Is this supported in RabbitMQ?



Thank you,



On Thu, Oct 25, 2012 at 4:59 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 25/10/12 15:19, Desta wrote:
> > "405 RESOURCE_LOCKED - cannot obtain exclusive access to locked queue
> > 'amq.gen-gA3hbOZr-m1HmmVZGq1uHs' in vhost '/' "
>
> This error means the queue was declared as exclusive, while you probably
> want it to be shared instead. Here are some relevant pointers to the
> specification:
>
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#queue.declare.exclusive
> http://www.rabbitmq.com/amqp-0-9-1-reference.html#constant.resource-locked
>
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/86cdce37/attachment.htm>

From static.void.dev at gmail.com  Thu Oct 25 18:55:09 2012
From: static.void.dev at gmail.com (Mark)
Date: Thu, 25 Oct 2012 10:55:09 -0700
Subject: [rabbitmq-discuss] RabbitMQ, Even Tracking, Rails
Message-ID: <82932988-6FA5-4AE8-9824-58D8CD0A2B70@gmail.com>

I've been looking into RabbitMQ as a possible event/logging tracking system for use with our Rails application. Surprisingly there doesn't seem to be much information/testimonials on using RabbitMQ with Rails so I was hoping to hear some advice from others who may have traveled down this path. Could you explain your use case?

There appears to be 2 players in the ruby amqp space, ruby-amqp/amqp  (asynchronous) and ruby-amqp/bunny (synchronous).  Do people typically choose one over the other and what would be the reasons for choosing? 

Thanks

From static.void.dev at gmail.com  Thu Oct 25 19:16:23 2012
From: static.void.dev at gmail.com (Mark)
Date: Thu, 25 Oct 2012 11:16:23 -0700
Subject: [rabbitmq-discuss] General Questions
Message-ID: <6D56FC26-6C11-4CC1-8123-CD1E5315F351@gmail.com>


Can someone please explain the following:
What are default exchanges used for (anonymous queues?)
How many exchanges are "normal" 
How many queues are "normal"
Are queues usually very general or very specific in nature
Do workers/consumers typically consume from more than one queue or would they consume from a set of related queues

Hopefully some of these questions can be quickly answered so I can start the ball rolling on my next set up questions :)

Thanks all


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/218a0786/attachment.htm>

From michael.s.klishin at gmail.com  Thu Oct 25 19:34:53 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 25 Oct 2012 22:34:53 +0400
Subject: [rabbitmq-discuss] ANN Langohr 1.0.0-beta10 is released
Message-ID: <CAE3HoVRo5J8mRm7sMcRebyk3O3+31hitEoVMGM8u-FNbOH1a7g@mail.gmail.com>

Langohr is a Clojure RabbitMQ client (http://clojurerabbitmq.info) that
embraces AMQP 0.9.1 Model [1].

`1.0-beta10` is a development release with one fix release. We recommend
all users to upgrade to it.


## Changes in 1.0.0-beta10

### langohr.basic/reject now correctly uses basic.reject

langohr.basic/reject now correctly uses `basic.reject` AMQP method
and not `basic.ack`.

Contributed by @natedev.


## Change Log

Langohr change log [2] is available on GitHub.


## Thank You, Contributors

* natedev [3]


1. http://bitly.com/amqp-model-explained
2. https://github.com/michaelklishin/langohr/blob/master/ChangeLog.md
3. http://github.com/natedev
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/a9790958/attachment.htm>

From fmeshkinpour at fonality.com  Thu Oct 25 20:03:43 2012
From: fmeshkinpour at fonality.com (Farshad Meshkinpour)
Date: Thu, 25 Oct 2012 12:03:43 -0700
Subject: [rabbitmq-discuss] Statistics database could not be contacted.
Message-ID: <CAO4q6__z_i2=La0z9BGJiP5kh9ubXCm5eGmpWc91BnRN=j1NMA@mail.gmail.com>

Hello,

I am running RMQ 2.8.6 in a three node cluster.  The first rabbit node that
had statistics database went down.   I had to disable management-plug to
restart the node.

How do I get statistics database restarted?

Any help is greatly appreciated.

Thanks,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/ed850e23/attachment.htm>

From fmeshkinpour at fonality.com  Thu Oct 25 21:08:15 2012
From: fmeshkinpour at fonality.com (fm)
Date: Thu, 25 Oct 2012 13:08:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Statistics database could not be contacted.
 Message rates and queue lengths will not be shown.
In-Reply-To: <5072B005.4090508@rabbitmq.com>
References: <CAHv8OSQ7UJ9L_s+rLJaJeMJ_v8LNcLvkWorotrhSCi1JX=nWYg@mail.gmail.com>
	<506D5668.7040205@rabbitmq.com>
	<CAHv8OSQs5eyyY11SVpQijqQro9C+Va_9_jXjubBxJFte-jt5mA@mail.gmail.com>
	<506EB48D.3010100@rabbitmq.com>
	<CACLE7iy+KYPiE_zoignvjFgwrj-b6uhsr8Z-+V+kPdq+oNFUxw@mail.gmail.com>
	<5072B005.4090508@rabbitmq.com>
Message-ID: <1351195695497-22874.post@n5.nabble.com>

Hello, 
How do we restart/reset/rebuild the statistics database?  I have similar
problem with 2.8.6 in 3 node cluster.  

Thanks,



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Statistics-database-could-not-be-contacted-Message-rates-and-queue-lengths-will-not-be-shown-tp22331p22874.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From erikerik at gmail.com  Thu Oct 25 21:53:05 2012
From: erikerik at gmail.com (Erik Anderson)
Date: Thu, 25 Oct 2012 15:53:05 -0500
Subject: [rabbitmq-discuss] General Questions
In-Reply-To: <6D56FC26-6C11-4CC1-8123-CD1E5315F351@gmail.com>
References: <6D56FC26-6C11-4CC1-8123-CD1E5315F351@gmail.com>
Message-ID: <CADdM08qUQtOa1101tYxeMVYo5-VJ=-QG1fLvFM+jc_8h+CGvGg@mail.gmail.com>

On Thu, Oct 25, 2012 at 1:16 PM, Mark <static.void.dev at gmail.com> wrote:
>
> Can someone please explain the following:
>
> What are default exchanges used for (anonymous queues?)
> How many exchanges are "normal"
> How many queues are "normal"
> Are queues usually very general or very specific in nature
> Do workers/consumers typically consume from more than one queue or would
> they consume from a set of related queues

I'm afraid the answer to nearly all of these is:

It depends.

Asking this question about rabbit is sort of like asking a DBA how
many tables is "normal" or a network engineer how many firewall ACLs
is "normal".

All of these are completely dependent on your specific use case.

I could answer the above questions for my specific situation, as could
many others on the list, but those answers will be of little use for
you, and in fact, may steer you down the wrong direction if you put
too much weight behind any of the answers as being the "right way".

Just dive in - I knew nothing about RabbitMQ before starting my
current project about 4 months ago. Sure, we made some changes along
the way, but fortunately RabbitMQ makes it very easy to change up your
configuration as you go.

-Erik

From static.void.dev at gmail.com  Thu Oct 25 22:17:05 2012
From: static.void.dev at gmail.com (Mark)
Date: Thu, 25 Oct 2012 14:17:05 -0700
Subject: [rabbitmq-discuss] General Questions
In-Reply-To: <CADdM08qUQtOa1101tYxeMVYo5-VJ=-QG1fLvFM+jc_8h+CGvGg@mail.gmail.com>
References: <6D56FC26-6C11-4CC1-8123-CD1E5315F351@gmail.com>
	<CADdM08qUQtOa1101tYxeMVYo5-VJ=-QG1fLvFM+jc_8h+CGvGg@mail.gmail.com>
Message-ID: <215B0B88-657A-4866-B4B0-F78244E98DB9@gmail.com>

Erik, first off I would love to hear about your use case(s). I figured I would get a "it depends" answer so I'll try to be more specific.

Say I wanted to implement some sort of chat functionality with our application. I figure each logged in user would make a web socket connection to some service that would return the content of the messages. Now, would this mean each logged in user would create an anonymous queue and subscribe to it? In that case there could be potentially 10k's of queues. Is this ridicolous?


On Oct 25, 2012, at 1:53 PM, Erik Anderson <erikerik at gmail.com> wrote:

> On Thu, Oct 25, 2012 at 1:16 PM, Mark <static.void.dev at gmail.com> wrote:
>> 
>> Can someone please explain the following:
>> 
>> What are default exchanges used for (anonymous queues?)
>> How many exchanges are "normal"
>> How many queues are "normal"
>> Are queues usually very general or very specific in nature
>> Do workers/consumers typically consume from more than one queue or would
>> they consume from a set of related queues
> 
> I'm afraid the answer to nearly all of these is:
> 
> It depends.
> 
> Asking this question about rabbit is sort of like asking a DBA how
> many tables is "normal" or a network engineer how many firewall ACLs
> is "normal".
> 
> All of these are completely dependent on your specific use case.
> 
> I could answer the above questions for my specific situation, as could
> many others on the list, but those answers will be of little use for
> you, and in fact, may steer you down the wrong direction if you put
> too much weight behind any of the answers as being the "right way".
> 
> Just dive in - I knew nothing about RabbitMQ before starting my
> current project about 4 months ago. Sure, we made some changes along
> the way, but fortunately RabbitMQ makes it very easy to change up your
> configuration as you go.
> 
> -Erik
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From kayode81until at gmail.com  Thu Oct 25 22:36:18 2012
From: kayode81until at gmail.com (kayslay)
Date: Thu, 25 Oct 2012 14:36:18 -0700 (PDT)
Subject: [rabbitmq-discuss] Sending messages with abstract types as
	properties
Message-ID: <0fbaa970-8939-4a10-94f3-a347c7032ba9@googlegroups.com>

I have a message that I'm sending and one of it's properties is an abstract 
type.  When I send this message I get an exception on the receiver from the 
json serializer:
How am I able to receive a message that has an interface or abstract type 
property, here MyPayload is an abstract class?
Thanks
Exception:
Newtonsoft.Json.JsonSerializationException: Could not create an instance of 
type
 MyNamespace.Payloads.MyPayload. Type
 is an interface or abstract class and cannot be instantated. Path 
'Payload.Id',
 line 1, position 17.
   at 
Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateNewObject
(JsonReader reader, JsonObjectContract objectContract, JsonProperty 
containerMem
ber, JsonProperty containerProperty, String id, Boolean& 
createdFromNonDefaultCo
nstructor)
   at 
Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(Js
onReader reader, Type objectType, JsonContract contract, JsonProperty 
member, Js
onContainerContract containerContract, JsonProperty containerMember, Object 
exis
tingValue)
   at 
Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInte
rnal(JsonReader reader, Type objectType, JsonContract contract, 
JsonProperty mem
ber, JsonContainerContract containerContract, JsonProperty containerMember, 
Obje
ct existingValue)
   at 
Newtonsoft.Json.Serialization.JsonSerializerInternalReader.SetPropertyValu
e(JsonProperty property, JsonConverter propertyConverter, 
JsonContainerContract
containerContract, JsonProperty containerProperty, JsonReader reader, 
Object tar
get)
   at 
Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(
Object newObject, JsonReader reader, JsonObjectContract contract, 
JsonProperty m
ember, String id)
   at 
Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(Js
onReader reader, Type objectType, JsonContract contract, JsonProperty 
member, Js
onContainerContract containerContract, JsonProperty containerMember, Object 
exis
tingValue)
   at 
Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateValueInte
rnal(JsonReader reader, Type objectType, JsonContract contract, 
JsonProperty mem
ber, JsonContainerContract containerContract, JsonProperty containerMember, 
Obje
ct existingValue)
   at 
Newtonsoft.Json.Serialization.JsonSerializerInternalReader.Deserialize(Jso
nReader reader, Type objectType, Boolean checkAdditionalContent)
   at Newtonsoft.Json.JsonSerializer.DeserializeInternal(JsonReader reader, 
Type
 objectType)
   at Newtonsoft.Json.JsonSerializer.Deserialize(JsonReader reader, Type 
objectT
ype)
   at Newtonsoft.Json.JsonConvert.DeserializeObject(String value, Type 
type, Jso
nSerializerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value, 
JsonSeriali
zerSettings settings)
   at Newtonsoft.Json.JsonConvert.DeserializeObject[T](String value)
   at EasyNetQ.JsonSerializer.BytesToMessage[T](Byte[] bytes)
   at 
EasyNetQ.RabbitAdvancedBus.<>c__DisplayClass1`1.<Subscribe>b__0(Byte[] bod
y, MessageProperties properties, MessageReceivedInfo messageRecievedInfo)
   at EasyNetQ.RabbitAdvancedBus.<>c__DisplayClass7.<Subscribe>b__6(String 
consu
merTag, UInt64 deliveryTag, Boolean redelivered, String exchange, String 
routing
Key, IBasicProperties properties, Byte[] body)
   at 
EasyNetQ.QueueingConsumerFactory.HandleMessageDelivery(BasicDeliverEventAr
gs basicDeliverEventArgs)
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/06fb4d55/attachment.htm>

From static.void.dev at gmail.com  Thu Oct 25 22:37:23 2012
From: static.void.dev at gmail.com (Mark)
Date: Thu, 25 Oct 2012 14:37:23 -0700
Subject: [rabbitmq-discuss] Example on event based or logging
Message-ID: <639A0E23-263F-4BF9-9B6E-3729807C9D0D@gmail.com>

Any good example on event based reporting and/or logging of web request using RabbitMQ?

From videlalvaro at gmail.com  Thu Oct 25 22:42:13 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 25 Oct 2012 23:42:13 +0200
Subject: [rabbitmq-discuss] Example on event based or logging
In-Reply-To: <639A0E23-263F-4BF9-9B6E-3729807C9D0D@gmail.com>
References: <639A0E23-263F-4BF9-9B6E-3729807C9D0D@gmail.com>
Message-ID: <CAMcAHLVbJhjpNqD9xzCviCaUVeW98CHb0f0e37bD-8DVKFJAvA@mail.gmail.com>

Hi Mark,

Have you seen this tutorial?
http://www.rabbitmq.com/tutorials/tutorial-five-python.html

-Alvaro

On Thu, Oct 25, 2012 at 11:37 PM, Mark <static.void.dev at gmail.com> wrote:

> Any good example on event based reporting and/or logging of web request
> using RabbitMQ?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/b74df695/attachment.htm>

From static.void.dev at gmail.com  Thu Oct 25 23:34:57 2012
From: static.void.dev at gmail.com (Mark)
Date: Thu, 25 Oct 2012 15:34:57 -0700
Subject: [rabbitmq-discuss] Example on event based or logging
In-Reply-To: <CAMcAHLVbJhjpNqD9xzCviCaUVeW98CHb0f0e37bD-8DVKFJAvA@mail.gmail.com>
References: <639A0E23-263F-4BF9-9B6E-3729807C9D0D@gmail.com>
	<CAMcAHLVbJhjpNqD9xzCviCaUVeW98CHb0f0e37bD-8DVKFJAvA@mail.gmail.com>
Message-ID: <B0EEDDB1-457D-4D56-8F2F-6DA258EF5618@gmail.com>

Yes. I was kind of hoping to get some real live examples and applications

On Oct 25, 2012, at 2:42 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi Mark,
> 
> Have you seen this tutorial? http://www.rabbitmq.com/tutorials/tutorial-five-python.html
> 
> -Alvaro
> 
> On Thu, Oct 25, 2012 at 11:37 PM, Mark <static.void.dev at gmail.com> wrote:
> Any good example on event based reporting and/or logging of web request using RabbitMQ?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/c2e0f4dc/attachment.htm>

From alexis at rabbitmq.com  Thu Oct 25 23:42:17 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 25 Oct 2012 23:42:17 +0100
Subject: [rabbitmq-discuss] Example on event based or logging
In-Reply-To: <B0EEDDB1-457D-4D56-8F2F-6DA258EF5618@gmail.com>
References: <639A0E23-263F-4BF9-9B6E-3729807C9D0D@gmail.com>
	<CAMcAHLVbJhjpNqD9xzCviCaUVeW98CHb0f0e37bD-8DVKFJAvA@mail.gmail.com>
	<B0EEDDB1-457D-4D56-8F2F-6DA258EF5618@gmail.com>
Message-ID: <CACOPnvc7O67rkaKV5w0Oew0+UF9nDWrvFG_U_YDKw7=pg09NcA@mail.gmail.com>

does this help?

http://www.control-alt-del.org/2012/03/28/collectd-esper-amqp-opentsdbgraphite-oh-my/




On Thu, Oct 25, 2012 at 11:34 PM, Mark <static.void.dev at gmail.com> wrote:
> Yes. I was kind of hoping to get some real live examples and applications
>
> On Oct 25, 2012, at 2:42 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>
> Hi Mark,
>
> Have you seen this tutorial?
> http://www.rabbitmq.com/tutorials/tutorial-five-python.html
>
> -Alvaro
>
> On Thu, Oct 25, 2012 at 11:37 PM, Mark <static.void.dev at gmail.com> wrote:
>>
>> Any good example on event based reporting and/or logging of web request
>> using RabbitMQ?
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From michael.s.klishin at gmail.com  Thu Oct 25 23:44:07 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 26 Oct 2012 02:44:07 +0400
Subject: [rabbitmq-discuss] General Questions
In-Reply-To: <215B0B88-657A-4866-B4B0-F78244E98DB9@gmail.com>
References: <6D56FC26-6C11-4CC1-8123-CD1E5315F351@gmail.com>
	<CADdM08qUQtOa1101tYxeMVYo5-VJ=-QG1fLvFM+jc_8h+CGvGg@mail.gmail.com>
	<215B0B88-657A-4866-B4B0-F78244E98DB9@gmail.com>
Message-ID: <CAE3HoVR8Sy4kVCz0-Xow6WK0ch_+MraxsB-N7FeKk0jWJxmKiA@mail.gmail.com>

2012/10/26 Mark <static.void.dev at gmail.com>

> Now, would this mean each logged in user would create an anonymous queue
> and subscribe to it? In that case there could be potentially 10k's of
> queues. Is this ridicolous?



10K queues won't be a problem. Keep in mind that for chats and
presence-aware services XMPP may be a better choice,
although there is at least one non-trivial Web chat product that uses
RabbitMQ for internal messaging.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/8b5a0f3b/attachment.htm>

From michael.s.klishin at gmail.com  Thu Oct 25 23:49:29 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 26 Oct 2012 02:49:29 +0400
Subject: [rabbitmq-discuss] General Questions
In-Reply-To: <6D56FC26-6C11-4CC1-8123-CD1E5315F351@gmail.com>
References: <6D56FC26-6C11-4CC1-8123-CD1E5315F351@gmail.com>
Message-ID: <CAE3HoVRWAPOyHJ==HYMBNn2ZhPaME9fgwDyXe7sKZWJ2EoMQZA@mail.gmail.com>

2012/10/25 Mark <static.void.dev at gmail.com>

> What are default exchanges used for (anonymous queues?)


There is only one default exchange. It has one special property: every
queue is automatically bound to it
with the same routing key as queue name. This gives developers a way to
"publish directly to a queue".


> How many exchanges are "normal"


However many you need.


> How many queues are "normal"


Unless you go into hundreds of thousands or millions, it is all fine. For
larger numbers, you'll have to use
a cluster of rabbits. What matters is message rates and how large the
backlog can grow during peak load time.


> Are queues usually very general or very specific in nature


It is more common to see queues separated by purpose rather than having one
queue being used
by all kinds of consumers.


> Do workers/consumers typically consume from more than one queue or would
> they consume from a set of related queues


"Consumer" is a somewhat overloaded term. Consumers in the AMQP 0.9.1 sense
can only use one queue. Applications that
primarily consume and process messages can use any number of queues.

HTH.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/5371e64b/attachment.htm>

From static.void.dev at gmail.com  Thu Oct 25 23:52:59 2012
From: static.void.dev at gmail.com (Mark)
Date: Thu, 25 Oct 2012 15:52:59 -0700
Subject: [rabbitmq-discuss] Example on event based or logging
In-Reply-To: <CACOPnvc7O67rkaKV5w0Oew0+UF9nDWrvFG_U_YDKw7=pg09NcA@mail.gmail.com>
References: <639A0E23-263F-4BF9-9B6E-3729807C9D0D@gmail.com>
	<CAMcAHLVbJhjpNqD9xzCviCaUVeW98CHb0f0e37bD-8DVKFJAvA@mail.gmail.com>
	<B0EEDDB1-457D-4D56-8F2F-6DA258EF5618@gmail.com>
	<CACOPnvc7O67rkaKV5w0Oew0+UF9nDWrvFG_U_YDKw7=pg09NcA@mail.gmail.com>
Message-ID: <3E6F7770-64A0-4418-83D3-F3198D5266A8@gmail.com>

Exactly. Any more real world examples of people using AMQP like this?

On Oct 25, 2012, at 3:42 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:

> does this help?
> 
> http://www.control-alt-del.org/2012/03/28/collectd-esper-amqp-opentsdbgraphite-oh-my/
> 
> 
> 
> 
> On Thu, Oct 25, 2012 at 11:34 PM, Mark <static.void.dev at gmail.com> wrote:
>> Yes. I was kind of hoping to get some real live examples and applications
>> 
>> On Oct 25, 2012, at 2:42 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>> 
>> Hi Mark,
>> 
>> Have you seen this tutorial?
>> http://www.rabbitmq.com/tutorials/tutorial-five-python.html
>> 
>> -Alvaro
>> 
>> On Thu, Oct 25, 2012 at 11:37 PM, Mark <static.void.dev at gmail.com> wrote:
>>> 
>>> Any good example on event based reporting and/or logging of web request
>>> using RabbitMQ?
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From alexis at rabbitmq.com  Thu Oct 25 23:57:29 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Thu, 25 Oct 2012 23:57:29 +0100
Subject: [rabbitmq-discuss] Example on event based or logging
In-Reply-To: <3E6F7770-64A0-4418-83D3-F3198D5266A8@gmail.com>
References: <639A0E23-263F-4BF9-9B6E-3729807C9D0D@gmail.com>
	<CAMcAHLVbJhjpNqD9xzCviCaUVeW98CHb0f0e37bD-8DVKFJAvA@mail.gmail.com>
	<B0EEDDB1-457D-4D56-8F2F-6DA258EF5618@gmail.com>
	<CACOPnvc7O67rkaKV5w0Oew0+UF9nDWrvFG_U_YDKw7=pg09NcA@mail.gmail.com>
	<3E6F7770-64A0-4418-83D3-F3198D5266A8@gmail.com>
Message-ID: <CACOPnvd+a1r22k2Qv6S6N2q6LkiyJ0_vhtYrX8sA5eKmtifOqA@mail.gmail.com>

Lots.  Google is your friend here.  But, see also some cases
http://www.rabbitmq.com/how.html





On Thu, Oct 25, 2012 at 11:52 PM, Mark <static.void.dev at gmail.com> wrote:
> Exactly. Any more real world examples of people using AMQP like this?
>
> On Oct 25, 2012, at 3:42 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>
>> does this help?
>>
>> http://www.control-alt-del.org/2012/03/28/collectd-esper-amqp-opentsdbgraphite-oh-my/
>>
>>
>>
>>
>> On Thu, Oct 25, 2012 at 11:34 PM, Mark <static.void.dev at gmail.com> wrote:
>>> Yes. I was kind of hoping to get some real live examples and applications
>>>
>>> On Oct 25, 2012, at 2:42 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:
>>>
>>> Hi Mark,
>>>
>>> Have you seen this tutorial?
>>> http://www.rabbitmq.com/tutorials/tutorial-five-python.html
>>>
>>> -Alvaro
>>>
>>> On Thu, Oct 25, 2012 at 11:37 PM, Mark <static.void.dev at gmail.com> wrote:
>>>>
>>>> Any good example on event based reporting and/or logging of web request
>>>> using RabbitMQ?
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpietrek at skytap.com  Fri Oct 26 01:18:12 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 25 Oct 2012 17:18:12 -0700
Subject: [rabbitmq-discuss] Validity of /api/aliveness-test in a clustered
	environment
Message-ID: <CACLE7izef-nB9T_BXAx08KG6m7+=SESB9ozDY+8NDZR4a5ENxA@mail.gmail.com>

In our platform, we're using keepalive to manage a VIP that transfers
between multiple nodes that are clustered with all my queues declared HA.

On each node, keepalive runs a script every five seconds (I call it
rabbitmq_alive) which connects specifically to the local rabbitmq node on
that box and determines if the that box's rabbitmq node is responsive.

So for example, with two nodes (mq1 and mq2), each node has:

A rabbitmq instance
A keepalive instance
A rabbitmq_alive instance which connects to the local rabbitmq instance to
check its health.

So far, I've been using /api/aliveness-test/. However, I've noticed that
the /api/aliveness-test queue actually lives on ONLY mq1.  Now imagine the
case where the mq1 node goes highly unresponsive. I'm wondering if my
rabbitmq_alive check on mq2 is actually timing out if mq1 is not alive and
responding in a timely manner.

If this is an issue, I'm wondering if there are alternative, "approved"
manners of checking the health of an individual broker within a cluster?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/b550f1c1/attachment.htm>

From tim at rabbitmq.com  Fri Oct 26 01:57:31 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 26 Oct 2012 01:57:31 +0100
Subject: [rabbitmq-discuss] Sending messages with abstract types as
	properties
In-Reply-To: <0fbaa970-8939-4a10-94f3-a347c7032ba9@googlegroups.com>
References: <0fbaa970-8939-4a10-94f3-a347c7032ba9@googlegroups.com>
Message-ID: <F9F58DEA-3547-4718-877D-4386C7C567B1@rabbitmq.com>

Hi

On 25 Oct 2012, at 22:36, kayslay wrote:

> I have a message that I'm sending and one of it's properties is an abstract type.  When I send this message I get an exception on the receiver from the json serializer:
> How am I able to receive a message that has an interface or abstract type property, here MyPayload is an abstract class?
> Thanks
> Exception:
> Newtonsoft.Json.JsonSerializationException: Could not create an instance of type
>  MyNamespace.Payloads.MyPayload. Type
>  is an interface or abstract class and cannot be instantated. Path 'Payload.Id',
>  line 1, position 17.

This is really a question for however supplies the Newtonsoft.Json package. I know that with some serialisation frameworks this just works transparently, because the framework 'bakes' the concrete classname into the representation at runtime, but gives you back a reference to the type you're expecting. Some frameworks allow you do write serialize/deserialize hooks to do this as well. Generics add a bit more complexity.

Either way, this hasn't really got anything to do with RabbitMQ so I'd suggest contacting the author on github, assuming it is https://github.com/mikehadlow/EasyNetQ that we're talking about.

Cheers,
Tim

From tim at rabbitmq.com  Fri Oct 26 01:59:15 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 26 Oct 2012 01:59:15 +0100
Subject: [rabbitmq-discuss] Sending messages with abstract types as
	properties
In-Reply-To: <F9F58DEA-3547-4718-877D-4386C7C567B1@rabbitmq.com>
References: <0fbaa970-8939-4a10-94f3-a347c7032ba9@googlegroups.com>
	<F9F58DEA-3547-4718-877D-4386C7C567B1@rabbitmq.com>
Message-ID: <50422058-49A9-4A07-B75B-510D21949CDD@rabbitmq.com>

s/however/whoever/

On 26 Oct 2012, at 01:57, Tim Watson wrote:

> Hi
> 
> On 25 Oct 2012, at 22:36, kayslay wrote:
> 
>> I have a message that I'm sending and one of it's properties is an abstract type.  When I send this message I get an exception on the receiver from the json serializer:
>> How am I able to receive a message that has an interface or abstract type property, here MyPayload is an abstract class?
>> Thanks
>> Exception:
>> Newtonsoft.Json.JsonSerializationException: Could not create an instance of type
>> MyNamespace.Payloads.MyPayload. Type
>> is an interface or abstract class and cannot be instantated. Path 'Payload.Id',
>> line 1, position 17.
> 
> This is really a question for however supplies the Newtonsoft.Json package. I know that with some serialisation frameworks this just works transparently, because the framework 'bakes' the concrete classname into the representation at runtime, but gives you back a reference to the type you're expecting. Some frameworks allow you do write serialize/deserialize hooks to do this as well. Generics add a bit more complexity.
> 
> Either way, this hasn't really got anything to do with RabbitMQ so I'd suggest contacting the author on github, assuming it is https://github.com/mikehadlow/EasyNetQ that we're talking about.
> 
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From raviv at gigya-inc.com  Fri Oct 26 07:28:40 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Thu, 25 Oct 2012 23:28:40 -0700 (PDT)
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
In-Reply-To: <f64caa3a-6947-4bcf-96ee-077b94f5da44@googlegroups.com>
References: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
	<f64caa3a-6947-4bcf-96ee-077b94f5da44@googlegroups.com>
Message-ID: <430b9cc7-4219-443d-8505-0946a5ce5967@googlegroups.com>

I find this behavior is problematic, especially when fanning out messages 
to temporary queues.
If I create an auto-delete queue (by code) and then crash before consuming, 
the queue will be stuck there until I delete it.

Is there a way to delete numerous queues by name prefix and/or state?


On Sunday, October 14, 2012 4:27:12 PM UTC+2, Dmitry Polyanovsky wrote:
>
> Hi,
> they will be deleted after first consumer "touch" them. If any consumer 
> will never connect to queue, it will be never deleted.
>
> On Wednesday, October 10, 2012 12:22:17 PM UTC+2, Raviv Pavel wrote:
>>
>> I have an auto-delete, durable, non mirrored, not exclusive queue, that 
>> is empty (no messages), idle, and has no consumers
>> However, it's still not being auto deleted.
>> Any idea why?
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/70905c8b/attachment.htm>

From matthias at rabbitmq.com  Fri Oct 26 08:46:55 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 26 Oct 2012 08:46:55 +0100
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
In-Reply-To: <430b9cc7-4219-443d-8505-0946a5ce5967@googlegroups.com>
References: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
	<f64caa3a-6947-4bcf-96ee-077b94f5da44@googlegroups.com>
	<430b9cc7-4219-443d-8505-0946a5ce5967@googlegroups.com>
Message-ID: <508A3FEF.2080201@rabbitmq.com>

On 26/10/12 07:28, Raviv Pavel wrote:
> I find this behavior is problematic

AMQP/Rabbit could hardly do anything different - if the sole condition 
for auto-deletion was that there are no consumers then the queue would 
get deleted straight after creation, before you've had a chance to 
attach any consumers.

> If I create an auto-delete queue (by code) and then crash before
> consuming, the queue will be stuck there until I delete it.

Couldn't you make the queue 'exclusive' instead of 'auto-delete'?

Or, alternatively, set a lease (http://www.rabbitmq.com/ttl.html#queue-ttl).

Regards,

Matthias.

From mimoun.chikhi at gfi.fr  Fri Oct 26 09:14:17 2012
From: mimoun.chikhi at gfi.fr (Chikhi Mimoun)
Date: Fri, 26 Oct 2012 08:14:17 +0000
Subject: [rabbitmq-discuss] Implementation of EAI Detour Pattern with the
	JAVA API v2.8.7
Message-ID: <1485BF0F8DC5F142B177F1A0BA1A51BF2A9FCB94@AMXPRD0510MB377.eurprd05.prod.outlook.com>

Hi,



I juste began few days ago on rabbitmq and I need some help.



a part of the project is :

- we have a producer that send a message (sometimes with less data)

- we have a consumer that receive the message but needs all datas.



So, sometimes, after the message sent, we need to make a detour in order to complete the message,

before being re-sent to the consumer.



It's a kind of content-based routing.



I found a pattern that matches with this case : the Detour Pattern.



Is it possible to implement this with the current rabbitmq java API and how ?



thx.


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/5b6ac88d/attachment.htm>

From tim at rabbitmq.com  Fri Oct 26 09:47:42 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 26 Oct 2012 09:47:42 +0100
Subject: [rabbitmq-discuss] Implementation of EAI Detour Pattern with
	the JAVA API v2.8.7
In-Reply-To: <1485BF0F8DC5F142B177F1A0BA1A51BF2A9FCB94@AMXPRD0510MB377.eurprd05.prod.outlook.com>
References: <1485BF0F8DC5F142B177F1A0BA1A51BF2A9FCB94@AMXPRD0510MB377.eurprd05.prod.outlook.com>
Message-ID: <8BA63735-5C34-412C-A185-C13C1AB39DD9@rabbitmq.com>

Hi - where does the detour need to go? This kind of content based routing is normally dealt with via a control bus, although you could implement the choice logic using a headers or topic exchange. The *big* question is where this detour takes you - is it to another consumer that is acting as a content enricher, which sounds like what you've described? Anyway, we'd need a bit more information to make any useful suggestions I think

a) where does the additional content come from?
b) is this (a) running in another Java/AMQP client?
c) *how* do you decide to get to (a)? Can you make this decision based on message headers/properties?

If the answer to (b) is 'yes' then you can probably do something quite easily. Bare in mind that any AMQP client can inspect message headers as well as content. So the following points might help you figure this out...

- your (a) is a good example of a Content Enricher
- you can keep track of where messages have been by adding a Routing Slip
- if your Content Enricher is another AMQP client, it can add additional headers and resend transformed messages anywhere it likes
- RabbitMQ provides exchanges that can be used to route messages based on routing keys or header properties

With all those facilities at your disposal, you should be able to do everything you need:

* route messages that 'need enrichment' to the correct processor, based on the presence/lack of a Routine Slip
* route messages marked as 'complete' directly, based on the presence/value of a Routing Slip

I'd need to know more to suggest anything more specific. I can also suggest that frameworks like Spring Integration and Apache Camel provide neat capabilities for integrating with RabbitMQ (using AMQP of course) so that you can write your processing/enriching and header munging code easily.

HTH

Cheers,
Tim


On 26 Oct 2012, at 09:14, Chikhi Mimoun wrote:

> Hi,
>  
> I juste began few days ago on rabbitmq and I need some help.
>  
> a part of the project is :
> - we have a producer that send a message (sometimes with less data)
> - we have a consumer that receive the message but needs all datas.
>  
> So, sometimes, after the message sent, we need to make a detour in order to complete the message,
> before being re-sent to the consumer.
>  
> It's a kind of content-based routing.
>  
> I found a pattern that matches with this case : the Detour Pattern.
>  
> Is it possible to implement this with the current rabbitmq java API and how ?
>  
> thx.
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From tyler at appsecute.com  Fri Oct 26 00:50:26 2012
From: tyler at appsecute.com (Tyler Power)
Date: Thu, 25 Oct 2012 16:50:26 -0700 (PDT)
Subject: [rabbitmq-discuss] Persistent messages on durable queue sometimes
 not delivered to consumers
Message-ID: <32767268-59bf-4cc9-9988-9c6396a74b81@googlegroups.com>

Hi there,

I'm having an issues where *sometimes* messages that appear to be 
successfully pushed to RabbitMQ are not delivered to any subscribers.

I am using RabbitMQ Server 2.4 and the .NET client 2.8.7.0.

I am using the default exchange (""), which sounds adequate for our needs 
right now, but thought I'd point it out incase I'm not using it the way it 
was intended.

In the server I can see the SubmitDeploymentToQueue() method always 
completes successfully, so it appears messages are *always* being submitted 
to RabbitMQ, but in the Consume() method of the consumer, 
the consumer.Queue.Dequeue() method *sometimes* does not return a message, 
so the next line (the console.writeline) is never called etc. and it 
will just sit there blocking.

In this situation where messages appear to be lost, restarting the 
consumers doesn't fix it, the messages are simply never delivered and seem 
to be lost forever.

I have attached the code below, inline, I hope this is OK.


*Server:*

//
// Copyright (c) Appsecute 2011-2012 - ALL RIGHTS RESERVED.
//
using System;
using RabbitMQ.Client;
using System.Threading;
using AppsecuteKernel.Logging;
using AppsecuteServerFramework.Database;
using AppsecuteKernel.Documents.Deployments;
using AppsecuteKernel.Operations.Deployment;
using AppsecuteKernel.Operations.Applications;
using AppsecuteKernel.Operations.Notifications;
using RabbitMQ.Client.Exceptions;
namespace AppsecuteDeploymentScheduler
{
    /// <summary>
    /// Periodically inspects the database and submits deployments to the 
queue once they have met the appropriate criteria.
    /// </summary>
    public class DeploymentScheduler : IDisposable
    {
        /// <summary>
        /// Rabbit MQ properties.
        /// </summary>
        private IModel _channel;
        private IConnection _connection;
        
        
        /// <summary>
        /// A wait handle that other threads can use to wait on the 
scheduler to finish
        /// </summary>
        public ManualResetEvent SchedulerWaitHandle = new ManualResetEvent(
false);

        /// <summary>
        /// A logger for the scheduler to use.
        /// </summary>
        public PlatformLogger Logger = new PlatformLogger(typeof(
DeploymentScheduler));

         /// <summary>
        /// The time in milliseconds the scheduler should sleep for between 
finishing work
        /// and waking up to check/process new work.
        /// </summary>
        private const int SLEEP_MILLISECONDS = 5000;

        /// <summary>
        /// A timer used to peridoically wake up and poll for deployments 
to queue.
        /// </summary>
        private Timer _pollDeploymentsTimer;

        /// <summary>
        /// Creates a new deployment scheduler.
        /// </summary>
        public DeploymentScheduler()
        {
            WriteLine("Starting scheduler");
            OpenConnection();
        }

        /// <summary>
        /// Opens the connection to RabbitMQ.
        /// </summary>
        private void OpenConnection()
        {
            var connectionFactory = new ConnectionFactory { uri = 
ApplicationDeploymentOperations.GetAmqpConnectionUri() };
            WriteLine("Opening RabbitMQ connection...");
            _connection = connectionFactory.CreateConnection();
            if (_connection.IsOpen)
            {
                WriteLine("Connection opened.");
                _connection = connectionFactory.CreateConnection();
                _channel = _connection.CreateModel();
                _channel.QueueDeclare(ApplicationDeploymentOperations.DEPLOYMENT_QUEUE_NAME, 
true, false, false, null);
                ThreadPool.QueueUserWorkItem(ProcessDeployments);
                WriteLine("Scheduler started.");
            }
            else
            {
                WriteLine("Scheduler failed to start.");
            }
        }

        private void WriteLine(string message)
        {
            Console.WriteLine("{0}: {1}", Thread.CurrentThread.ManagedThreadId, 
message);
        }

        /// <summary>
        /// Schedules the scheduler to wake up at a later time to poll the 
database.
        /// </summary>
        private void Reschedule()
        {
            WriteLine("Rescheduling");
            if (_pollDeploymentsTimer != null)
            {
                _pollDeploymentsTimer.Dispose();
            }
            _pollDeploymentsTimer = new Timer(ProcessDeployments, new object(), 
SLEEP_MILLISECONDS, 0);
        }

        /// <summary>
        /// Evaluates deployments and queues them to be deployed if 
appropriate.
        /// </summary>
        private void ProcessDeployments(object state)
        {
            Console.WriteLine();
            WriteLine("Processing deployments");
            try
            {
                var deployments = ApplicationDeploymentDatabaseOperations
.GetApplicationDeploymentsToQueue();
                // If there is any work to do then do it, otherwise 
reschedule this worker
                if (deployments.Count > 0)
                {
                    foreach (var deploymentData in deployments)
                    {
                        ProcessDeployment(deploymentData);
                    }
                    WriteLine("Scheduling completed");
                    // *TODO: If these workers are kept busy (i.e They're 
continuously working instead of sleeping/waking) there is a chance this 
recursive calling could exceed the stack size
*                    ProcessDeployments(null);
                }
                else
                {
                    Reschedule();
                }
            }
            catch (Exception e)
            {
                WriteLine(string.Format("Caught exception processing 
deployments: {0}", e.Message));
                LogException(null, e);
                Reschedule();
            }
        }

        /// <summary>
        /// Processes a deployment, updating the status, raising 
notifications and submitting to the deployment queue
        /// as appropriate.
        /// </summary>
        /// <param name="deploymentData"></param>
        private void ProcessDeployment(ApplicationDeploymentDatadeploymentData)
        {
            try
            {
                MySqlLocking.TryRun(
                    MySqlWrapper.PLATFORM_DATABASE_NAME,
                    string.Format("deployment-scheduler-{0}", 
deploymentData.Id),
                    new TimeSpan(0, 0, 0, 5),
                    api =>
                        {
                            // If the deployment should now wait for manual 
start update the status
                            if (deploymentData.DeploymentStatus.Equals(
ApplicationDeploymentOperations.DEPLOYMENT_STATUS_WAITING_FOR_SCHEDULED_TIME) 
&&
                                deploymentData.IsManualStart)
                            {
                                // Run in a transaction so that if raising 
notifications fails, the status update will be rolled back
                                MySqlWrapper.RunInNewTransaction(
                                    MySqlWrapper.PLATFORM_DATABASE_NAME,
                                    database =>
                                        {
                                            // Update the status first, to 
effectivley reserve this deployment
                                            ApplicationDeploymentOperations
.UpdateDeploymentStatusAtomic(
                                                deploymentData.Id,
                                                
deploymentData.DeploymentStatus,
                                                
ApplicationDeploymentOperations.
                                                    
DEPLOYMENT_STATUS_WAITING_FOR_MANUAL_START);
                                            
RaiseDeploymentWaitingOnManualStartNotification(deploymentData);
                                        });
                                WriteLine(string.Format("Deployment with id 
{0} is now waiting on manual start.", deploymentData.Id));
                                Logger.Info(string.Format("Deployment with 
id {0} is now waiting on manual start.", deploymentData.Id));
                            }
                            else
                            {
                                // Run in a transaction so that if 
submitting to queue fails, the status update will be rolled back
                                MySqlWrapper.RunInNewTransaction(
                                    MySqlWrapper.PLATFORM_DATABASE_NAME,
                                    database =>
                                        {
                                            // Update the status first, to 
effectivley reserve this deployment
                                            ApplicationDeploymentOperations
.UpdateDeploymentStatusAtomic(
                                                deploymentData.Id,
                                                
deploymentData.DeploymentStatus,
                                                
ApplicationDeploymentOperations.DEPLOYMENT_STATUS_QUEUED_FOR_DEPLOYMENT);
                                            // Submit the deployment to the 
queue
                                            
SubmitDeploymentToQueue(deploymentData);
                                        }
                                    );
                                
                                WriteLine(string.Format("Deployment with id 
{0} has been submitted to the deployment queue.", deploymentData.Id));
                                Logger.Info(string.Format("Deployment with 
id {0} has been submitted to the deployment queue.", deploymentData.Id));
                            }
                        });
            }
            catch (Exception e)
            {
                LogException(deploymentData, e);
            }
        }

        /// <summary>
        /// Submits a deployment to the RabbitMQ message queue so that it 
will be processed by a background worker.
        /// </summary>
        /// <param name="deploymentData">The deployment to queue.</param>
        private void SubmitDeploymentToQueue(ApplicationDeploymentDatadeploymentData)
        {
            try
            {
                var basicProperties = _channel.CreateBasicProperties();
                basicProperties.SetPersistent(true);
                _channel.BasicPublish(string.Empty, 
ApplicationDeploymentOperations.DEPLOYMENT_QUEUE_NAME, basicProperties, 
BitConverter.GetBytes(deploymentData.Id));
            }
            catch (Exception)
            {
                Console.WriteLine("Detected broken connection to RabbitMQ, 
restablishing...");
                Dispose();
                OpenConnection();
                throw;
            }
        }

        /// <summary>
        /// Raises a notification for a deployment that is waiting on 
manual start.
        /// </summary>
        /// <param name="applicationDeploymentData">The deployment that is 
waiting on manual start.</param>
        private void RaiseDeploymentWaitingOnManualStartNotification(
ApplicationDeploymentData applicationDeploymentData)
        {
            try
            {
                var applicationData = ApplicationOperations
.GetApplication(applicationDeploymentData.ApplicationId);
                NotificationOperations.RaiseNotification(
                    applicationDeploymentData.SubmitterLegalEntityId,
                    NotificationCode
.ApplicationDeploymentWaitingForManualStart,
                    NotificationSeverity.Warning,
                    "Deployment waiting on manual start",
                    string.Format("Deployment to {0} scheduled for {1} is 
now waiting to be manually started.",
                                  applicationData.DisplayName,
                                  
applicationDeploymentData.ScheduledStartDate),
                    applicationDeploymentData.Id,
                    true);
            }
            catch (Exception)
            {/* eat it*/}
        }

        /// <summary>
        /// Logs an exception, including inner exceptions.
        /// </summary>
        internal void LogException(ApplicationDeploymentDatadeploymentData, 
Exception exception, bool inner = false, string innerMessage = "")
        {
            try
            {
                string errorMessage;
                if (!inner)
                {
                    if (deploymentData != null)
                    {
                        errorMessage = string.Format(
                            "Error caught executing deployment with id {0}for application 
{1}:" +
                            "\r\n\r\nThe exception was:\r\n\t{2}" +
                            "\r\n\r\nThe stacktrace was:\r\n{3}\r\n",
                            deploymentData.Id,
                            deploymentData.ApplicationId,
                            exception.Message,
                            exception.StackTrace);
                    }
                    else
                    {
                        errorMessage = string.Format(
                            "Error caught" +
                            "\r\n\r\nThe exception was:\r\n\t{0}" +
                            "\r\n\r\nThe stacktrace was:\r\n{1}\r\n",
                            exception.Message,
                            exception.StackTrace);
                    }
                }
                else
                {
                    errorMessage = innerMessage + string.Format(
                        "\r\nThe inner exception was:\r\n\t{0}" +
                        "\r\n\r\nThe inner stacktrace was:\r\n{1}\r\n",
                        exception.Message,
                        exception.StackTrace);
                }
                if (exception.InnerException != null)
                {
                    LogException(deploymentData, exception.InnerException, 
true, errorMessage);
                }
                else
                {
                    Logger.Error(errorMessage);
                }
            }
            catch (Exception)
            {/* eat it */}
        }

        /// <summary>
        /// Disposes of the scheduler and frees up resources.
        /// </summary>
        public void Dispose()
        {
            if (_channel != null)
            {
                _channel.Abort();
            }
            if (_connection != null)
            {
                try
                {
                    _connection.Close();
                }
                catch (AlreadyClosedException)
                {
                    /* Eat it */
                }
            }
        }
    }
}


*Consumer:*

//
// Copyright (c) Appsecute 2011-2012 - ALL RIGHTS RESERVED.
//
using System;
using System.IO;
using RabbitMQ.Client;
using AppsecuteKernel.Logging;
using AppsecuteServerFramework.Exceptions;
using AppsecuteKernel.Documents.Deployments;
using AppsecuteKernel.Operations.Deployment;
using AppsecuteKernel.Operations.Applications;
using AppsecuteKernel.Operations.Notifications;
using RabbitMQ.Client.Events;
using RabbitMQ.Client.Exceptions;
namespace AppsecuteDeploymentWorker
{
    /// <summary>
    /// A deployment worker that receives deployment jobs from RabbitMQ.
    /// </summary>
    public class DeploymentWorker : IDisposable
    {
        /// <summary>
        /// Rabbit MQ properties
        /// </summary>
        private IModel _channel;
        private IConnection _connection;

        /// <summary>
        /// A logger for the deployment worker to use.
        /// </summary>
        public PlatformLogger Logger = new PlatformLogger(typeof(
DeploymentWorker));

        /// <summary>
        /// Creates a new deployment worker.
        /// </summary>
        public DeploymentWorker()
        {
            Console.WriteLine("Starting worker");
            OpenConnection();
            Consume();
        }

        /// <summary>
        /// Opens the connection to RabbitMQ and sets up the channel.
        /// </summary>
        private void OpenConnection()
        {
            var connectionFactory = new ConnectionFactory
            {
                uri = ApplicationDeploymentOperations
.GetAmqpConnectionUri(),
                RequestedHeartbeat = 10
            };
            Console.WriteLine("Opening RabbitMQ connection...");
            _connection = connectionFactory.CreateConnection();
            if (_connection.IsOpen)
            {
                Console.WriteLine("Connection opened.");
                _channel = _connection.CreateModel();
                _channel.BasicQos(0, 1, false);
                _channel.QueueDeclare(ApplicationDeploymentOperations.DEPLOYMENT_QUEUE_NAME, 
true, false, false, null);
                Console.WriteLine("Deployment worker started.");
            }
            else
            {
                Console.WriteLine("Deployment worker failed to start.");
            }
        }

        /// <summary>
        /// Starts the synchronus consumption of queued deployments.
        /// This method will only return if a critical exception occurs.
        /// </summary>
        private void Consume()
        {
            var consumer = new QueueingBasicConsumer(_channel);
            _channel.BasicConsume(ApplicationDeploymentOperations.DEPLOYMENT_QUEUE_NAME, 
false, consumer);
            while (true)
            {
                try
                {
                    Console.WriteLine("Waiting for next job...");
                    var messageEvent = (BasicDeliverEventArgs
)consumer.Queue.Dequeue();
                    Console.WriteLine("Processing new job...");
                    try
                    {
                        var applicationDeploymentId = BitConverter.ToInt64(messageEvent.Body, 
0);
                        var applicationDeployment = 
ApplicationDeploymentDatabaseOperations
.GetApplicationDeployment(applicationDeploymentId);
                        DoApplicationDeployment(applicationDeployment);
                        _channel.BasicAck(messageEvent.DeliveryTag, false);
                    }
                    catch (Exception e)
                    {
                        _channel.BasicNack(messageEvent.DeliveryTag, false, 
false);
                        LogException(null, e);
                    }
                }
                catch (EndOfStreamException e)
                {
                    Console.WriteLine("Detected broken connection to 
RabbitMQ, restablishing...");
                    LogException(null, e);
                    Dispose();
                    OpenConnection();
                    Consume();
                }
                catch (Exception e)
                {
                    LogException(null, e);
                    break;
                }
            }
        }

        /// <summary>
        /// Executes an application deployment synchronusly.
        /// </summary>
        /// <param name="applicationDeploymentData">The application 
deployment to execute.</param>
        private void DoApplicationDeployment(ApplicationDeploymentDataapplicationDeploymentData)
        {
            try
            {
                Console.WriteLine("Running deployment with id {0}...", 
applicationDeploymentData.Id);
                Logger.Info(string.Format("Running deployment with id {0}
...", applicationDeploymentData.Id));
                ApplicationDeploymentOperations.SetActualDeploymentStartDate(applicationDeploymentData.Id, 
DateTime.UtcNow);
                ConfirmDeploymentShouldStart(applicationDeploymentData);
                ApplicationDeploymentOperations
.UpdateDeploymentStatusAtomic(
                    applicationDeploymentData.Id, 
                    applicationDeploymentData.DeploymentStatus,
                    ApplicationDeploymentOperations
.DEPLOYMENT_STATUS_DEPLOYING);
                var packagePath = 
DownloadApplicationDeploymentPackage(applicationDeploymentData);
                var stagingDirectory = 
StageApplicationDeploymentPackage(applicationDeploymentData, packagePath);
                PushApplicationDeploymentPackage(applicationDeploymentData, 
stagingDirectory);
                CleanUpApplicationDeploymentPackage(packagePath, 
stagingDirectory);
                ApplicationDeploymentOperations
.UpdateDeploymentStatusAtomic(
                    applicationDeploymentData.Id,
                    ApplicationDeploymentOperations
.DEPLOYMENT_STATUS_DEPLOYING,
                    ApplicationDeploymentOperations
.DEPLOYMENT_STATUS_DEPLOYMENT_SUCCESSFUL);
                ApplicationDeploymentOperations.SetActualDeploymentEndDate(applicationDeploymentData.Id, 
DateTime.UtcNow);
                
RaiseDeploymentSuceededNotification(applicationDeploymentData);
                Console.WriteLine("Deployment succeeded.");
                Logger.Info("Deployment succeeded.");
            }
            catch (Exception e)
            {
                LogException(applicationDeploymentData, e);
                ApplicationDeploymentOperations.MarkDeploymentAsFailed(applicationDeploymentData.Id, 
e.Message);
                ApplicationDeploymentOperations.SetActualDeploymentEndDate(applicationDeploymentData.Id, 
DateTime.UtcNow);
                
RaiseDeploymentFailedNotification(applicationDeploymentData, e.Message);
                Console.WriteLine("Deployment failed.");
                throw;
            }
        }

        /// <summary>
        /// Confirms that a deployment should start based on the current 
time and available deployment window.
        /// </summary>
        /// <param name="deploymentData">The deployment to check.</param>
        private void ConfirmDeploymentShouldStart(ApplicationDeploymentDatadeploymentData)
        {
            if((DateTime.UtcNow - new TimeSpan(0, 5, 0)) > 
deploymentData.ScheduledEndDate)
            {
                throw new AppSnapException(
                    string.Format(
                        "Unable to start as deployment window has passed or 
it was determined that deployment wouldn't complete within the window."));
            }
        }

        /// <summary>
        /// Raises a notification for a failed deployment.
        /// </summary>
        /// <param name="applicationDeploymentData">The deployment that 
failed.</param>
        /// <param name="failureReason">A human readable reason of why the 
deploy failed.</param>
        private void RaiseDeploymentFailedNotification(
ApplicationDeploymentData applicationDeploymentData, string failureReason)
        {
            try
            {
                var applicationData = ApplicationOperations
.GetApplication(applicationDeploymentData.ApplicationId);
                NotificationOperations.RaiseNotification(
                    applicationData.OwnerLegalEntityId,
                    NotificationCode.ApplicationDeploymentFailed,
                    NotificationSeverity.Critical,
                    "Deploy failed",
                    string.Format("Deployment to {0} scheduled for {1}failed with error \"
{2}\".",
                                  applicationData.DisplayName,
                                  
applicationDeploymentData.ScheduledStartDate,
                                  failureReason),
                    applicationDeploymentData.Id,
                    true);
            }
            catch (Exception)
            {/* eat it */}
        }

        /// <summary>
        /// Raises a notification for a successful deployment.
        /// </summary>
        /// <param name="applicationDeploymentData">The deployment that 
succeeded.</param>
        private void RaiseDeploymentSuceededNotification(
ApplicationDeploymentData applicationDeploymentData)
        {
            try
            {
                var applicationData = ApplicationOperations
.GetApplication(applicationDeploymentData.ApplicationId);
                NotificationOperations.RaiseNotification(
                    applicationData.OwnerLegalEntityId,
                    NotificationCode.ApplicationDeploymentFailed,
                    NotificationSeverity.Info,
                    "Deploy succeeded",
                    string.Format("Deployment to {0} scheduled for {1}completed successfully."
,
                                  applicationData.DisplayName,
                                  
applicationDeploymentData.ScheduledStartDate),
                    applicationDeploymentData.Id,
                    true);
            }
            catch (Exception)
            {/* eat it */}
        }

        /// <summary>
        /// Downloads and verifies an application deployment package to a 
local directory.
        /// </summary>
        /// <param name="applicationDeploymentData"></param>
        /// <returns>The full path to the local deployment package once 
downloaded.</returns>
        private string DownloadApplicationDeploymentPackage(
ApplicationDeploymentData applicationDeploymentData)
        {
            Console.WriteLine("Downloading...");
            var downloadedPackagePath = DeploymentPackageDownloadClient
.DownloadDeploymentPackage(new Uri
(applicationDeploymentData.DeploymentPackageDownloadUrl));
            try
            {
                var computedHash = DeploymentFileUtils
.ComputeDeploymentPackageHash(downloadedPackagePath);
                if(applicationDeploymentData.DeploymentPackageHash == null|| computedHash.Equals(applicationDeploymentData.DeploymentPackageHash))
                {
                    return downloadedPackagePath;
                }
                else
                {
                    throw new AppSnapInvalidDataException(
                        "Integrity check of deployment package failed. MD5 
hashes do not match. Deployment package possibly corrupt or incomplete.");
                }
            }
            catch (Exception e)
            {
                CleanUpApplicationDeploymentPackage(downloadedPackagePath, 
null);
                throw new AppSnapException("Failed to download deployment 
package. Fatal error.", e);
            }
        }

        /// <summary>
        /// Extracts a local deployment package to a temp directory.
        /// </summary>
        /// <returns>The full path to the directory the deployment package 
was extracted to.</returns>
        private string StageApplicationDeploymentPackage(
ApplicationDeploymentData applicationDeploymentData, stringdownloadedPackagePath)
        {
            Console.WriteLine("Staging...");
            Logger.Info("Staging...");
            try
            {
                return DeploymentFileUtils
.ExtractDeploymentPackage(downloadedPackagePath);
            }
            catch (Exception e)
            {
                CleanUpApplicationDeploymentPackage(downloadedPackagePath, 
null);
                throw new AppSnapException("Failed to stage deployment. 
Fatal error.", e);
            }
        }

        /// <summary>
        /// Pushes an application deployment package to the cloud.
        /// </summary>
        private void PushApplicationDeploymentPackage(
ApplicationDeploymentData applicationDeploymentData, string stagingPath)
        {
            Console.WriteLine("Pushing...");
            Logger.Info("Pushing...");
            try
            {
                var applicationData = ApplicationOperations
.GetApplication(applicationDeploymentData.ApplicationId);
                DeploymentPusher.UploadApplication(applicationData.CloudLoginId, 
applicationData, stagingPath);
            }
            catch (Exception)
            {
                CleanUpApplicationDeploymentPackage(null, stagingPath);
                throw;
            }
        }

        /// <summary>
        /// Cleans up all temp files from an application deployment.
        /// </summary>
        /// <param name="downloadPackagePath">The full path to the 
downloaded deployment package.</param>
        /// <param name="stagingPath">The full path to the staging 
directory that contains the extracted deployment package.</param>
        private void CleanUpApplicationDeploymentPackage(stringdownloadPackagePath, 
string stagingPath)
        {
            Console.WriteLine("Cleaning up...");
            Logger.Info("Cleaning up...");
            try
            {
                if (!string.IsNullOrWhiteSpace(downloadPackagePath))
                {
                    DeploymentFileUtils.DeleteFile(downloadPackagePath);
                }
                if (!string.IsNullOrWhiteSpace(stagingPath))
                {
                    DeploymentFileUtils.DeleteDirectory(stagingPath);
                }
            }
            catch (Exception e)
            {
                Logger.Error(string.Format("Failed to clean up deployment 
at {0} and {1}. Error was: {2}",
                                           downloadPackagePath,
                                           stagingPath,
                                           e.Message));
            }
        }

        /// <summary>
        /// Logs an exception, including inner exceptions.
        /// </summary>
        internal void LogException(ApplicationDeploymentDatadeploymentData, 
Exception exception, bool inner = false, string innerMessage = "")
        {
            try
            {
                string errorMessage;
                if (!inner)
                {
                    if (deploymentData != null)
                    {
                        errorMessage = string.Format(
                            "Error caught executing deployment with id {0}for application 
{1}:" +
                            "\r\n\r\nThe exception was:\r\n\t{2}" +
                            "\r\n\r\nThe stacktrace was:\r\n{3}\r\n",
                            deploymentData.Id,
                            deploymentData.ApplicationId,
                            exception.Message,
                            exception.StackTrace);
                    }
                    else
                    {
                        errorMessage = string.Format(
                            "Error caught" +
                            "\r\n\r\nThe exception was:\r\n\t{0}" +
                            "\r\n\r\nThe stacktrace was:\r\n{1}\r\n",
                            exception.Message,
                            exception.StackTrace);
                    }
                }
                else
                {
                    errorMessage = innerMessage + string.Format(
                        "\r\nThe inner exception was:\r\n\t{0}" +
                        "\r\n\r\nThe inner stacktrace was:\r\n{1}\r\n",
                        exception.Message,
                        exception.StackTrace);
                }
                if (exception.InnerException != null)
                {
                    LogException(deploymentData, exception.InnerException, 
true, errorMessage);
                }
                else
                {
                    Logger.Error(errorMessage);
                }
            }
            catch (Exception)
            {/* eat it */}
        }

        /// <summary>
        /// Disposes of the deployment worker and frees up resources.
        /// </summary>
        public void Dispose()
        {
            if (_channel != null)
            {
                _channel.Abort();
            }
            if (_connection != null)
            {
                try
                {
                    _connection.Close();
                }
                catch (AlreadyClosedException)
                {
                    /* Eat it */
                }
            }
        }
    }
}

 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121025/bcd2a73d/attachment.htm>

From srdan at kvrgic.se  Fri Oct 26 10:13:03 2012
From: srdan at kvrgic.se (Srdan Kvrgic)
Date: Fri, 26 Oct 2012 11:13:03 +0200
Subject: [rabbitmq-discuss] Batching messages
In-Reply-To: <50890F2C.1020703@rabbitmq.com>
References: <0AB02CE2-48A6-4F1D-A19B-7B88B2C7EEA7@kvrgic.se>
	<50890F2C.1020703@rabbitmq.com>
Message-ID: <5EDBAA62-2A69-4BB6-AD1B-528306BD6DAC@kvrgic.se>


On Oct 25, 2012, at 12:06 , Emile Joubert wrote:

> Hi,
> 
> On 25/10/12 06:33, Srdan Kvrgic wrote:
>> You think?
> 
> There may be other ways of achieving higher throughput that you should
> explore first before investing in more complex solutions. A potential
> improvement would be to use auto-ack or to acknowledge messages in
> batches. And not to use persistence unless necessary. I assume you have
> exhausted other options.

Auto-acking isn't really an option in production for us, but we do already only ack every 50th message or

> Do you get any throughput improvement if you turn off Nagle's algorithm?
> Both publishing and consuming can be asynchronous when using RabbitMQ.
> If that were not the case then the throughput due to batching would be
> more dramatic. I suspect you will see some improvement due to network
> batching when turning off Nagle's algorithm.

Interesting. I'd never heard of it. Must try it out.

> If the above don't give acceptable gains and you really need batching of
> messages then this can be implemented in a library that sits between
> your application and the broker. Such a library would be in the best
> position to judge the throughput/latency trade-off and limit the batches
> based on size or latency constraints. It should be able to pack messages
> on the publishing side and unpack on the consuming side.
> 
> A possible approach that a library might take to rejecting an individual
> message would be to acknowledge the aggregate batch message and to
> re-publish the rejected message with a suitable header. Message ordering
> will be lost, but this might be a close enough approximation to
> rejecting an individual message in many cases.

That's funny because this is what we've found ourselves building. And it's working. Pretty good. The problem is, every once in a while we'll end up changing the format of a particular message, or have it come string-encoded in a different way. A server might then well parse the message, discover it can't make any sense of it and try to repost it in the screwed up way it parsed it first which leaves the message being constantly requeued.

All this is not really a problem for us. This is not a cry for help or anything dramatic like that. We've got a bunch of libraries in place that give us all the functionality we need. I just thought this feature could be useful for new rabbitmq users allowing them easier batching without laying down weeks of work and a world of gotchas. =)

Kind Regards,
Srdan


From andrea.rosa at hp.com  Fri Oct 26 11:12:30 2012
From: andrea.rosa at hp.com (Rosa, Andrea (HP Cloud Services))
Date: Fri, 26 Oct 2012 10:12:30 +0000
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
In-Reply-To: <508A3FEF.2080201@rabbitmq.com>
References: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
	<f64caa3a-6947-4bcf-96ee-077b94f5da44@googlegroups.com>
	<430b9cc7-4219-443d-8505-0946a5ce5967@googlegroups.com>
	<508A3FEF.2080201@rabbitmq.com>
Message-ID: <5F389C517756284F80239F55BCA5DDDD67E83491@G4W3295.americas.hpqcorp.net>

Hi

>Couldn't you make the queue 'exclusive' instead of 'auto-delete'?

That means if I have an exclusive queue and the consumer crash the broker will take care of delete the queue?

>
>Or, alternatively, set a lease (http://www.rabbitmq.com/ttl.html#queue-
>ttl).


The lease feature is available from which version?

Thanks
--
Andrea Rosa

From srdan at burtcorp.com  Fri Oct 26 11:14:09 2012
From: srdan at burtcorp.com (Srdan Kvrgic)
Date: Fri, 26 Oct 2012 12:14:09 +0200
Subject: [rabbitmq-discuss] Batching messages
In-Reply-To: <50890C49.60705@rabbitmq.com>
References: <0AB02CE2-48A6-4F1D-A19B-7B88B2C7EEA7@kvrgic.se>
	<50890C49.60705@rabbitmq.com>
Message-ID: <56DFE0E5-83F0-4F04-B382-C2D46C053856@kvrgic.se>


On Oct 25, 2012, at 11:54 , Tim Watson wrote:

> Hi
> 
> On 10/25/2012 06:33 AM, Srdan Kvrgic wrote:
>> Hi,
>> 
>> Short story:
>> Are there any plans to support batching of messages within the rabbitmq eco-system?
>> 
>> 
>> Long story:
> [snip]
>> Optimally you would want a system that sends and receives batches of messages but allows you to reject single messages. Have your cake and eat it, as it were...
> 
> Sounds good, but...
> 
> AMQP already provides batching delivery capabilities and these have been discussed previously, for example https://groups.google.com/forum/?fromgroups=#!topic/rabbitmq-discuss/CidFKmJrBFI. But what you seem to be running up against is the fact that your many small messages limit throughput, so you want to bundle them up. I would suggest putting a processor between the publisher and consumer which unpacks the batches and forwards individual messages to the target exchange. This could be achieved by writing a custom exchange type, configured to understand how to 'unpack' the batch and where to route the forwarded messages to. The consumers would then receive these individual messages (possibly in batches!) and could reject some or all of them, but that rejection would not be apparent to the outside world in any way! So you'd need to then change your design somewhat, perhaps by putting 'failed' messages onto a different 'error queue' *or* by rejecting them and setting up a TTL and Dead Letter eXchange on the destination queue so that you can identify failures transparently. In either case, you'd want to add some kind of x-batch-id header to the 'broken up' messages so that your reprocessing procedure is able to identify the source batch from which they came.

Are you talking about writing an extension to rabbit-mq as such? I'm not sure I follow your solution. Or rather, it doesn't seem like something it's very easy or practical. =)


> Doing this 'in the broker' doesn't really make sense to me. How would transactions and/or confirms continue to work, for example?

Actually the consumer parts seems to be to be already working like this.. You already get prefetches and what not, I don't see why those shouldn't be delivered in a single data transfer. Perhaps they already are?

The publisher side of this on the other hand doesn't do this by default. I'll have to try disabling Nagle's algorithm to see if that gives use the wings..


>> Also automatic de-/compression in the driver. That also was a great performance boost when the batches started getting big. Lzf ftw!
> 
> Hmn, that's an interesting one! Which client library are you using?

Running jruby we use java libraries for anything performance critical. Like com.ning.compress.lzf.LZFEncoder for compressions. Unless you're talking about the entire library for tracking, batching, routing and compressing. In that case we use autobahn https://github.com/burtcorp/autobahn/

//S



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/e6cb09fe/attachment.htm>

From alexis at rabbitmq.com  Fri Oct 26 11:23:05 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 26 Oct 2012 11:23:05 +0100
Subject: [rabbitmq-discuss] Batching messages
In-Reply-To: <56DFE0E5-83F0-4F04-B382-C2D46C053856@kvrgic.se>
References: <0AB02CE2-48A6-4F1D-A19B-7B88B2C7EEA7@kvrgic.se>
	<50890C49.60705@rabbitmq.com>
	<56DFE0E5-83F0-4F04-B382-C2D46C053856@kvrgic.se>
Message-ID: <CACOPnvfrMqXj-5vX3KKOq1YE88qK64m-ssETJ=eVFJbErdq0oQ@mail.gmail.com>

ISTM that basic.publish could be extended to accept a set of messages
as the payload parameter in lieu of a single message.  Then all
metadata would be the same for all messages in a batch.  In particular
all routing would be the same.  This would improve throughput
especially when the disk is involved.  Once in the queue, messages
would appear as individual data and could be confirmed, consumed, etc,
out-of-batch, but still in-order.



On Fri, Oct 26, 2012 at 11:14 AM, Srdan Kvrgic <srdan at burtcorp.com> wrote:
>
> On Oct 25, 2012, at 11:54 , Tim Watson wrote:
>
> Hi
>
> On 10/25/2012 06:33 AM, Srdan Kvrgic wrote:
>
> Hi,
>
>
> Short story:
>
> Are there any plans to support batching of messages within the rabbitmq
> eco-system?
>
>
>
> Long story:
>
> [snip]
>
> Optimally you would want a system that sends and receives batches of
> messages but allows you to reject single messages. Have your cake and eat
> it, as it were...
>
>
> Sounds good, but...
>
> AMQP already provides batching delivery capabilities and these have been
> discussed previously, for example
> https://groups.google.com/forum/?fromgroups=#!topic/rabbitmq-discuss/CidFKmJrBFI.
> But what you seem to be running up against is the fact that your many small
> messages limit throughput, so you want to bundle them up. I would suggest
> putting a processor between the publisher and consumer which unpacks the
> batches and forwards individual messages to the target exchange. This could
> be achieved by writing a custom exchange type, configured to understand how
> to 'unpack' the batch and where to route the forwarded messages to. The
> consumers would then receive these individual messages (possibly in
> batches!) and could reject some or all of them, but that rejection would not
> be apparent to the outside world in any way! So you'd need to then change
> your design somewhat, perhaps by putting 'failed' messages onto a different
> 'error queue' *or* by rejecting them and setting up a TTL and Dead Letter
> eXchange on the destination queue so that you can identify failures
> transparently. In either case, you'd want to add some kind of x-batch-id
> header to the 'broken up' messages so that your reprocessing procedure is
> able to identify the source batch from which they came.
>
>
> Are you talking about writing an extension to rabbit-mq as such? I'm not
> sure I follow your solution. Or rather, it doesn't seem like something it's
> very easy or practical. =)
>
>
> Doing this 'in the broker' doesn't really make sense to me. How would
> transactions and/or confirms continue to work, for example?
>
>
> Actually the consumer parts seems to be to be already working like this..
> You already get prefetches and what not, I don't see why those shouldn't be
> delivered in a single data transfer. Perhaps they already are?
>
> The publisher side of this on the other hand doesn't do this by default.
> I'll have to try disabling Nagle's algorithm to see if that gives use the
> wings..
>
>
> Also automatic de-/compression in the driver. That also was a great
> performance boost when the batches started getting big. Lzf ftw!
>
>
> Hmn, that's an interesting one! Which client library are you using?
>
>
> Running jruby we use java libraries for anything performance critical. Like
> com.ning.compress.lzf.LZFEncoder for compressions. Unless you're talking
> about the entire library for tracking, batching, routing and compressing. In
> that case we use autobahn https://github.com/burtcorp/autobahn/
>
> //S
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From brendan at soundcloud.com  Fri Oct 26 11:23:12 2012
From: brendan at soundcloud.com (Brendan Hay)
Date: Fri, 26 Oct 2012 12:23:12 +0200
Subject: [rabbitmq-discuss] Per Connection Flow Control Issue
In-Reply-To: <5089521D.7050000@rabbitmq.com>
References: <CAHZsVQYHNXSzOfCy84C5wA4J_8M=iBAp7+caj26nv3fK7txxvg@mail.gmail.com>
	<CAE3HoVT24kWzaZKti2YPZ-j=ShAmJciwx11SRxUwXGd49pY62w@mail.gmail.com>
	<5089521D.7050000@rabbitmq.com>
Message-ID: <CAHZsVQZ4t7tJByvjVQ=OL1XCe2Ujq=g65BgCeOR5waG=vy=oUw@mail.gmail.com>

Yes, so what should the expected observation be - the client code carries
on publishing into a black hole,
which means the send queue on the client/peer socket should keep growing,
and when the rabbit reader is
issued new credits, it will lap it all up?

It just seems the 'flow' status in the UI stays on permanently, it doesn't
seem to be toggling at high speed, just locked.

Currently trying to create a small harness to reproduce this locally.

Thanks,
Brendan


On Thu, Oct 25, 2012 at 4:52 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 25/10/12 15:27, Michael Klishin wrote:
>
>> Because amqp gem does not do any implicit or automatic flow control, I'd
>> expect the root cause
>> to be in EventMachine. Do you have a way to reproduce this issue?
>>
>
> The flow control at the server side is implemented by just not reading
> from the socket. So clients do not need to do anything; publishing will
> just block.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/404112b8/attachment.htm>

From emile at rabbitmq.com  Fri Oct 26 11:41:11 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 26 Oct 2012 11:41:11 +0100
Subject: [rabbitmq-discuss] Persistent messages on durable queue
 sometimes not delivered to consumers
In-Reply-To: <32767268-59bf-4cc9-9988-9c6396a74b81@googlegroups.com>
References: <32767268-59bf-4cc9-9988-9c6396a74b81@googlegroups.com>
Message-ID: <508A68C7.2080604@rabbitmq.com>

Hi,

On 26/10/12 00:50, Tyler Power wrote:
> I am using RabbitMQ Server 2.4

That's quite old. You should consider upgrading.

> I am using the default exchange (""), which sounds adequate for our
> needs right now, but thought I'd point it out incase I'm not using it
> the way it was intended.

Using the default exchange is fine.

> In the server I can see the SubmitDeploymentToQueue() method always
> completes successfully, so it appears messages are /always/ being
> submitted to RabbitMQ, but in the Consume() method of the consumer,
> the consumer.Queue.Dequeue() method /sometimes/ does not return a
> message, so the next line (the console.writeline) is never called etc.
> and it will just sit there blocking.

This is normal behaviour if there is no message. If you think there is
an error then you should independently confirm using the management
plugin or using rabbitmqctl whether there are any messages.

> In this situation where messages appear to be lost, restarting the
> consumers doesn't fix it, the messages are simply never delivered and
> seem to be lost forever.

Messages should never inadvertently get lost.

You can use publisher confirms to make sure messages don't get lost
between the publisher and the broker:
http://www.rabbitmq.com/confirms.html

You can use the mandatory flag to make sure unroutable messages are
detected:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish.mandatory

You can declare queues durable and publish messages persistent to guard
against the broker crashing.

You can use dead-letter-exchanges to make sure messages don't get lost
from queues:
http://www.rabbitmq.com/dlx.html

You can use consumer acknowledgements to make sure messages don't get
lost when consumers crash while processing messages:
http://www.rabbitmq.com/amqp-0-9-1-quickref.html#basic.ack

If you have found a way for messages to get lost then please post a
minimal self-contained piece of code that demonstrates the error on the
latest released version.


-Emile







From simon at rabbitmq.com  Fri Oct 26 11:45:37 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 26 Oct 2012 11:45:37 +0100
Subject: [rabbitmq-discuss] Batching messages
In-Reply-To: <CACOPnvfrMqXj-5vX3KKOq1YE88qK64m-ssETJ=eVFJbErdq0oQ@mail.gmail.com>
References: <0AB02CE2-48A6-4F1D-A19B-7B88B2C7EEA7@kvrgic.se>
	<50890C49.60705@rabbitmq.com>
	<56DFE0E5-83F0-4F04-B382-C2D46C053856@kvrgic.se>
	<CACOPnvfrMqXj-5vX3KKOq1YE88qK64m-ssETJ=eVFJbErdq0oQ@mail.gmail.com>
Message-ID: <508A69D1.6060206@rabbitmq.com>

On 26/10/12 11:23, Alexis Richardson wrote:
> ISTM that basic.publish could be extended to accept a set of messages
> as the payload parameter in lieu of a single message.  Then all
> metadata would be the same for all messages in a batch.  In particular
> all routing would be the same.  This would improve throughput
> especially when the disk is involved.

When the disc is *not* involved.

When the disc *is* involved then its costs are going to dominate 
everything else.

While such a scheme would benefit in some cases, you'd need quite a 
specific workload to really gain from it (one in which queues do very 
little work). And it would add noticeable complexity. Of course, it 
would help us lie on benchmarks ;-)

So I'm not sure. I may do some experiments on the subject at some point.

Another approach is the entirely client-side approach that Emile 
mentions, and that it sounds like Srdan has written. Srdan, would you 
like to share? :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From matthias at rabbitmq.com  Fri Oct 26 11:45:38 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 26 Oct 2012 11:45:38 +0100
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
In-Reply-To: <5F389C517756284F80239F55BCA5DDDD67E83491@G4W3295.americas.hpqcorp.net>
References: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
	<f64caa3a-6947-4bcf-96ee-077b94f5da44@googlegroups.com>
	<430b9cc7-4219-443d-8505-0946a5ce5967@googlegroups.com>
	<508A3FEF.2080201@rabbitmq.com>
	<5F389C517756284F80239F55BCA5DDDD67E83491@G4W3295.americas.hpqcorp.net>
Message-ID: <508A69D2.1060703@rabbitmq.com>

Andrea,

On 26/10/12 11:12, Rosa, Andrea (HP Cloud Services) wrote:
>> Couldn't you make the queue 'exclusive' instead of 'auto-delete'?
>
> That means if I have an exclusive queue and the consumer crash the
> broker will take care of delete the queue?

Yes.

The downside of exclusive queues is that they can only have consumers on 
the connection that created them. So this doesn't work for shared 
queues, or queues created by some app that are subsequently to be 
consumed from by some other app.

>> Or, alternatively, set a lease
>> (http://www.rabbitmq.com/ttl.html#queue-ttl).
>
> The lease feature is available from which version?

2.0.0, according to http://www.rabbitmq.com/changelog.html

Regards,

Matthias.

From simon at rabbitmq.com  Fri Oct 26 11:52:08 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 26 Oct 2012 11:52:08 +0100
Subject: [rabbitmq-discuss] Validity of /api/aliveness-test in a
 clustered environment
In-Reply-To: <CACLE7izef-nB9T_BXAx08KG6m7+=SESB9ozDY+8NDZR4a5ENxA@mail.gmail.com>
References: <CACLE7izef-nB9T_BXAx08KG6m7+=SESB9ozDY+8NDZR4a5ENxA@mail.gmail.com>
Message-ID: <508A6B58.6010307@rabbitmq.com>

On 26/10/12 01:18, Matt Pietrek wrote:
> If this is an issue, I'm wondering if there are alternative, "approved"
> manners of checking the health of an individual broker within a cluster?

aliveness-test declares a queue, publishes a message, and basic.gets it. 
You could do that.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From alexis at rabbitmq.com  Fri Oct 26 12:31:24 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Fri, 26 Oct 2012 12:31:24 +0100
Subject: [rabbitmq-discuss] Batching messages
In-Reply-To: <508A69D1.6060206@rabbitmq.com>
References: <0AB02CE2-48A6-4F1D-A19B-7B88B2C7EEA7@kvrgic.se>
	<50890C49.60705@rabbitmq.com>
	<56DFE0E5-83F0-4F04-B382-C2D46C053856@kvrgic.se>
	<CACOPnvfrMqXj-5vX3KKOq1YE88qK64m-ssETJ=eVFJbErdq0oQ@mail.gmail.com>
	<508A69D1.6060206@rabbitmq.com>
Message-ID: <CACOPnvfJGJ7XpH=WfL7=HD5eDawusDVYNshzR_VE7Kk=WqadCA@mail.gmail.com>

On Fri, Oct 26, 2012 at 11:45 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> On 26/10/12 11:23, Alexis Richardson wrote:
>>
>> ISTM that basic.publish could be extended to accept a set of messages
>> as the payload parameter in lieu of a single message.  Then all
>> metadata would be the same for all messages in a batch.  In particular
>> all routing would be the same.  This would improve throughput
>> especially when the disk is involved.
>
>
> When the disc is *not* involved.
>
> When the disc *is* involved then its costs are going to dominate everything
> else.

Then please could you explain to me (briefly!)...

a. (all other things being equal eg when everything gets added to the
same queue) whether a 1MB message takes the same time to process as a
batch of 100 10KB messages, 1,000 1KB messages, etc..

b. why any differences may arise




> While such a scheme would benefit in some cases, you'd need quite a specific
> workload to really gain from it (one in which queues do very little work).
> And it would add noticeable complexity. Of course, it would help us lie on
> benchmarks ;-)
>
> So I'm not sure. I may do some experiments on the subject at some point.

I'd be interested in seeing what these reveal.



> Another approach is the entirely client-side approach that Emile mentions,
> and that it sounds like Srdan has written. Srdan, would you like to share?
> :-)

I did not quite understand if that approach was language (and client)
specific or not.

From simon at rabbitmq.com  Fri Oct 26 13:41:24 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 26 Oct 2012 13:41:24 +0100
Subject: [rabbitmq-discuss] Per Connection Flow Control Issue
In-Reply-To: <CAHZsVQZ4t7tJByvjVQ=OL1XCe2Ujq=g65BgCeOR5waG=vy=oUw@mail.gmail.com>
References: <CAHZsVQYHNXSzOfCy84C5wA4J_8M=iBAp7+caj26nv3fK7txxvg@mail.gmail.com>
	<CAE3HoVT24kWzaZKti2YPZ-j=ShAmJciwx11SRxUwXGd49pY62w@mail.gmail.com>
	<5089521D.7050000@rabbitmq.com>
	<CAHZsVQZ4t7tJByvjVQ=OL1XCe2Ujq=g65BgCeOR5waG=vy=oUw@mail.gmail.com>
Message-ID: <508A84F4.2050009@rabbitmq.com>

On 26/10/12 11:23, Brendan Hay wrote:
> Yes, so what should the expected observation be - the client code
> carries on publishing into a black hole,
> which means the send queue on the client/peer socket should keep
> growing,

Well, the send queue is limited in size. So the publisher should block 
fairly quickly.

> and when the rabbit reader is
> issued new credits, it will lap it all up?

Yes.

> It just seems the 'flow' status in the UI stays on permanently, it
> doesn't seem to be toggling at high speed, just locked.

Well, the flow status *in the UI* is designed not to toggle at high 
speed, since that would not be very readable - it shows "flow" if the 
connection has been blocked in the last 5 seconds. This is driven by 
"last_blocked_age" and "last_blocked_by".

The rabbitmqctl command results you posted show some connections which 
had blocked some time in the past, all more than 5 seconds ago. 
Unfortunately I forgot to ask you to add "state" to the list of columns, 
to determine if they were blocked now. If we see any connections that 
were blocked by flow control a long time ago, and are still blocked, 
then I'm concerned.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From srdan at kvrgic.se  Fri Oct 26 14:47:08 2012
From: srdan at kvrgic.se (Srdan Kvrgic)
Date: Fri, 26 Oct 2012 15:47:08 +0200
Subject: [rabbitmq-discuss] Batching messages
In-Reply-To: <508A69D1.6060206@rabbitmq.com>
References: <0AB02CE2-48A6-4F1D-A19B-7B88B2C7EEA7@kvrgic.se>
	<50890C49.60705@rabbitmq.com>
	<56DFE0E5-83F0-4F04-B382-C2D46C053856@kvrgic.se>
	<CACOPnvfrMqXj-5vX3KKOq1YE88qK64m-ssETJ=eVFJbErdq0oQ@mail.gmail.com>
	<508A69D1.6060206@rabbitmq.com>
Message-ID: <9BE474E9-9029-44FE-9C0C-051248215A97@kvrgic.se>


On Oct 26, 2012, at 12:45 , Simon MacMullen wrote:

> On 26/10/12 11:23, Alexis Richardson wrote:
>> ISTM that basic.publish could be extended to accept a set of messages
>> as the payload parameter in lieu of a single message.  Then all
>> metadata would be the same for all messages in a batch.  In particular
>> all routing would be the same.  This would improve throughput
>> especially when the disk is involved.
> 
> When the disc is *not* involved.
> 
> When the disc *is* involved then its costs are going to dominate everything else.
> 
> While such a scheme would benefit in some cases, you'd need quite a specific workload to really gain from it (one in which queues do very little work). And it would add noticeable complexity. Of course, it would help us lie on benchmarks ;-)
> 
> So I'm not sure. I may do some experiments on the subject at some point.
> 
> Another approach is the entirely client-side approach that Emile mentions, and that it sounds like Srdan has written. Srdan, would you like to share? :-)

https://github.com/burtcorp/autobahn is a comprehensive project to do all things. It's written in jruby though, so I dunno what good it'll do you. =)

And the solution is very simple, instead of sending message directly, buffer them in a list until there are enough of them. 'Enough' is of course configureable. Once there's enough, BSON|JSON|MsgPack encode the list, compress, send, receive, decompress, decode and Bob's your uncle.

It gets a little complicated when using multiple routing keys. You have to keep lists for each key. But it's not a huge deal. And you have to keep a timeout flusher so you don't keep messages forever. Old batch_publisher was 60-ish lines of ruby, here https://gist.github.com/3958901 


> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, VMware
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From kLeonard at elliottmgmt.com  Fri Oct 26 15:00:46 2012
From: kLeonard at elliottmgmt.com (Kayode Leonard)
Date: Fri, 26 Oct 2012 10:00:46 -0400
Subject: [rabbitmq-discuss] Sending messages with abstract types
	as	properties
In-Reply-To: <50422058-49A9-4A07-B75B-510D21949CDD@rabbitmq.com>
References: <0fbaa970-8939-4a10-94f3-a347c7032ba9@googlegroups.com>
	<F9F58DEA-3547-4718-877D-4386C7C567B1@rabbitmq.com>
	<50422058-49A9-4A07-B75B-510D21949CDD@rabbitmq.com>
Message-ID: <3C305593058FF244B1596E8B288D75A431BE8EC428@MERCURY.elliottmgmt.com>

Will do,
Thanks

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: Thursday, October 25, 2012 8:59 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Sending messages with abstract types as properties

s/however/whoever/

On 26 Oct 2012, at 01:57, Tim Watson wrote:

> Hi
>
> On 25 Oct 2012, at 22:36, kayslay wrote:
>
>> I have a message that I'm sending and one of it's properties is an abstract type.  When I send this message I get an exception on the receiver from the json serializer:
>> How am I able to receive a message that has an interface or abstract type property, here MyPayload is an abstract class?
>> Thanks
>> Exception:
>> Newtonsoft.Json.JsonSerializationException: Could not create an
>> instance of type MyNamespace.Payloads.MyPayload. Type is an interface
>> or abstract class and cannot be instantated. Path 'Payload.Id', line
>> 1, position 17.
>
> This is really a question for however supplies the Newtonsoft.Json package. I know that with some serialisation frameworks this just works transparently, because the framework 'bakes' the concrete classname into the representation at runtime, but gives you back a reference to the type you're expecting. Some frameworks allow you do write serialize/deserialize hooks to do this as well. Generics add a bit more complexity.
>
> Either way, this hasn't really got anything to do with RabbitMQ so I'd suggest contacting the author on github, assuming it is https://github.com/mikehadlow/EasyNetQ that we're talking about.
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


Confidentiality Notice from Elliott Management Corporation:

The information contained in this e-mail and any attachments may be legally privileged, proprietary and/or confidential. If you are not an intended recipient, you are hereby notified that any use, copying, disclosure or distribution of all or any portions of this e-mail and any attachments is strictly prohibited. If you received this e-mail in error, please notify the sender, permanently delete the e-mail and any attachments, and destroy all hard copies immediately.

No warranty is made as to the completeness or accuracy of the information contained in this communication. Any views or opinions presented are those of only the author and do not necessarily represent those of Elliott Management Corporation or its related entities. This communication is for information purposes only and should not be regarded as an offer, solicitation or recommendation to sell or purchase any security or other financial product.

Elliott Management Corporation and its related entities reserve the right to monitor all e-mail communications through their networks.

Thank you.

From deshai-0 at student.ltu.se  Fri Oct 26 15:12:08 2012
From: deshai-0 at student.ltu.se (Desta Haileselassie Hagos)
Date: Fri, 26 Oct 2012 16:12:08 +0200
Subject: [rabbitmq-discuss] RabbbitMQ Queues
Message-ID: <CAKiRAqWqxeGYkxU=GLWpercJBwDUuZY6WEpW==G+t8d-WVpgkg@mail.gmail.com>

Hi ALL,

I have one more question, I want my queues to be read by many users so that
the queue will not be empty once one user has read the messages. Is there
any way to preserve the messages for all users or for a specific period of
time? Is this supported in RabbitMQ?



With best regards,

Desta
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/d15312b1/attachment.htm>

From emile at rabbitmq.com  Fri Oct 26 15:26:09 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 26 Oct 2012 15:26:09 +0100
Subject: [rabbitmq-discuss] RabbitMQ, push a script
In-Reply-To: <CAKiRAqXmB8ZS6+PcxWyynZiLy9RNbveNHJjt0uJObKVBxpxYFA@mail.gmail.com>
References: <CAKiRAqVHc+kZHXVpNGjp36-_74vDfkxjNfPsi7+qFJDj2kPSUw@mail.gmail.com>
	<50893005.8090207@rabbitmq.com>
	<1351174775019-22864.post@n5.nabble.com>
	<508953D9.1050806@rabbitmq.com>
	<CAKiRAqXmB8ZS6+PcxWyynZiLy9RNbveNHJjt0uJObKVBxpxYFA@mail.gmail.com>
Message-ID: <508A9D81.9090102@rabbitmq.com>

Hi,

On 25/10/12 17:47, Desta Haileselassie Hagos wrote:
> I have one more question, I want my queues to be read by many users so
> that the queue will not be empty once one user has read the messages.
> 
> Is there any way to preserve the messages for all users or for a
> specific period of time? Is this supported in RabbitMQ?

It is possible to expire unread messages after a period of time:
http://www.rabbitmq.com/ttl.html#per-queue-message-ttl
But that is probably not what you want. If you want a message to reach
multiple consumers then it is better to declare a separate queue for
each consumer. This is the pattern in tutorial 3:
http://www.rabbitmq.com/tutorials/tutorial-three-python.html


-Emile


From ceri at lshift.net  Fri Oct 26 15:26:02 2012
From: ceri at lshift.net (Ceri Storey)
Date: Fri, 26 Oct 2012 15:26:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ, Even Tracking, Rails
In-Reply-To: <82932988-6FA5-4AE8-9824-58D8CD0A2B70@gmail.com>
References: <82932988-6FA5-4AE8-9824-58D8CD0A2B70@gmail.com>
Message-ID: <508A9D7A.6040107@lshift.net>

(25/10/12 18:55), Mark wrote:
> I've been looking into RabbitMQ as a possible event/logging tracking system for use with our Rails application. Surprisingly there doesn't seem to be much information/testimonials on using RabbitMQ with Rails so I was hoping to hear some advice from others who may have traveled down this path. Could you explain your use case?
>
> There appears to be 2 players in the ruby amqp space, ruby-amqp/amqp  (asynchronous) and ruby-amqp/bunny (synchronous).  Do people typically choose one over the other and what would be the reasons for choosing? 
I'd say that the deciding factor would likely by how well it fits with
the rest of your application in terms of structure--so for example,
Rails is almost entirely (modulo some new features in the unreleased
Rails 4) synchronous, so Bunny would likely be the better choice in that
case. On the other hand, if you are creating a specific consumer
application, then Eventmachine and the AMQP would likely be the better
choice. But as with anything, it'd likely be worth doing a spike to see
how well it fits with your use case.

Cheers,

>
> Thanks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From videlalvaro at gmail.com  Fri Oct 26 15:29:53 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 26 Oct 2012 16:29:53 +0200
Subject: [rabbitmq-discuss] RabbbitMQ Queues
In-Reply-To: <CAKiRAqWqxeGYkxU=GLWpercJBwDUuZY6WEpW==G+t8d-WVpgkg@mail.gmail.com>
References: <CAKiRAqWqxeGYkxU=GLWpercJBwDUuZY6WEpW==G+t8d-WVpgkg@mail.gmail.com>
Message-ID: <CAMcAHLV6Tae11=gJzGPcouC2h2z3oUny=3DRncWkOgtd=NsT7g@mail.gmail.com>

Hi,

If you want your messages to be picked up by more than one consumer then
you have to implement publish subscribe as seen here:

http://www.rabbitmq.com/tutorials/tutorial-three-python.html

Regards,

Alvaro

On Fri, Oct 26, 2012 at 4:12 PM, Desta Haileselassie Hagos <
deshai-0 at student.ltu.se> wrote:

> Hi ALL,
>
> I have one more question, I want my queues to be read by many users so
> that the queue will not be empty once one user has read the messages. Is
> there any way to preserve the messages for all users or for a specific
> period of time? Is this supported in RabbitMQ?
>
>
>
> With best regards,
>
> Desta
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/2a325c42/attachment.htm>

From videlalvaro at gmail.com  Fri Oct 26 15:45:17 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 26 Oct 2012 16:45:17 +0200
Subject: [rabbitmq-discuss] RabbbitMQ Queues
In-Reply-To: <CAKiRAqWqxeGYkxU=GLWpercJBwDUuZY6WEpW==G+t8d-WVpgkg@mail.gmail.com>
References: <CAKiRAqWqxeGYkxU=GLWpercJBwDUuZY6WEpW==G+t8d-WVpgkg@mail.gmail.com>
Message-ID: <CAMcAHLUNNnkarYXt69SmEPdgA_uHSenwQdBY2J8=eUPbJLn=Lw@mail.gmail.com>

Hi Desta,

Now taking a second look to your email maybe you would benefit also from
this plugin: https://github.com/videlalvaro/rabbitmq-recent-history-exchange

At the moment it keeps the last 20 messages that passed by the exchange but
it could be improved to:

a) Let the user configure that amount. Yep now that's horribly hardcoded in
the source code.
b) Instead of keeping the last N messages add some way of keep them by
certain amount of time, but that would add some complexity I guess.

Regards,

Alvaro

On Fri, Oct 26, 2012 at 4:12 PM, Desta Haileselassie Hagos <
deshai-0 at student.ltu.se> wrote:

> Hi ALL,
>
> I have one more question, I want my queues to be read by many users so
> that the queue will not be empty once one user has read the messages. Is
> there any way to preserve the messages for all users or for a specific
> period of time? Is this supported in RabbitMQ?
>
>
>
> With best regards,
>
> Desta
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/84808060/attachment.htm>

From simon at rabbitmq.com  Fri Oct 26 17:18:54 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 26 Oct 2012 17:18:54 +0100
Subject: [rabbitmq-discuss] Statistics database could not be contacted.
In-Reply-To: <CAO4q6__z_i2=La0z9BGJiP5kh9ubXCm5eGmpWc91BnRN=j1NMA@mail.gmail.com>
References: <CAO4q6__z_i2=La0z9BGJiP5kh9ubXCm5eGmpWc91BnRN=j1NMA@mail.gmail.com>
Message-ID: <508AB7EE.8070507@rabbitmq.com>

On 25/10/12 20:03, Farshad Meshkinpour wrote:
> I am running RMQ 2.8.6 in a three node cluster.  The first rabbit node
> that had statistics database went down.   I had to disable
> management-plug to restart the node.
>
> How do I get statistics database restarted?

It should restart automatically. However, there was a bug, fixed in 
2.8.7, in which it could fail to fail over correctly when the node it 
was originally running on went down. Is this what happened to you? I'm 
not sure I fully understand your message.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From mpietrek at skytap.com  Fri Oct 26 21:18:57 2012
From: mpietrek at skytap.com (Matt Pietrek)
Date: Fri, 26 Oct 2012 13:18:57 -0700
Subject: [rabbitmq-discuss] Validity of /api/aliveness-test in a
	clustered environment
In-Reply-To: <508A6B58.6010307@rabbitmq.com>
References: <CACLE7izef-nB9T_BXAx08KG6m7+=SESB9ozDY+8NDZR4a5ENxA@mail.gmail.com>
	<508A6B58.6010307@rabbitmq.com>
Message-ID: <CACLE7ixw+Cznc7Pg_es3Axbp5vv884hOb4i_QZy2gafd9qrzFQ@mail.gmail.com>

Thanks Simon.

Just to make sure I understand fully, does the problem scenario I described
actually occur?

That is, if the aliveness-test queue lives on mq1 and mq1 is unresponsive,
and I then hit the mq2 broker with an /api/aliveness -test request, you'd
expect that request to either time out or take a long time?

Thanks,

Matt

On Fri, Oct 26, 2012 at 3:52 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 26/10/12 01:18, Matt Pietrek wrote:
>
>> If this is an issue, I'm wondering if there are alternative, "approved"
>> manners of checking the health of an individual broker within a cluster?
>>
>
> aliveness-test declares a queue, publishes a message, and basic.gets it.
> You could do that.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/a520e8f0/attachment.htm>

From raviv at gigya-inc.com  Fri Oct 26 23:32:06 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Fri, 26 Oct 2012 15:32:06 -0700 (PDT)
Subject: [rabbitmq-discuss] Erlang version issue when Upgrading to
	2.8.7-1
In-Reply-To: <1a5770c3-b3ea-4335-b5b1-688fef50fa22@googlegroups.com>
References: <1a5770c3-b3ea-4335-b5b1-688fef50fa22@googlegroups.com>
Message-ID: <c5fb21b1-8bc8-4fb4-acd8-44b78c2f27fa@googlegroups.com>

Does anyone have an idea? I'm stuck here 

On Sunday, October 14, 2012 1:20:58 PM UTC+2, Raviv Pavel wrote:
>
> I'm trying to upgrade from 2.8.4 to 2.8.7-1 but I'm getting: erlang >= 
> R12B-3 is needed by rabbitmq-server-2.8.7-1.noarch
> Which doesn't make sense because rabbit reports it's using R15B01
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/10d06c3f/attachment.htm>

From matthias at rabbitmq.com  Fri Oct 26 23:57:28 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 26 Oct 2012 23:57:28 +0100
Subject: [rabbitmq-discuss] Erlang version issue when Upgrading to
	2.8.7-1
In-Reply-To: <c5fb21b1-8bc8-4fb4-acd8-44b78c2f27fa@googlegroups.com>
References: <1a5770c3-b3ea-4335-b5b1-688fef50fa22@googlegroups.com>
	<c5fb21b1-8bc8-4fb4-acd8-44b78c2f27fa@googlegroups.com>
Message-ID: <508B1558.5070306@rabbitmq.com>

On 26/10/12 23:32, Raviv Pavel wrote:
> Does anyone have an idea? I'm stuck here

Jerry replied to your original post the same day. See 
http://rabbitmq.1065348.n5.nabble.com/Erlang-version-issue-when-Upgrading-to-2-8-7-1-tp22547p22548.html

Regards,

Matthias.

From raviv at gigya-inc.com  Sat Oct 27 09:37:49 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Sat, 27 Oct 2012 10:37:49 +0200
Subject: [rabbitmq-discuss] Erlang version issue when Upgrading to
	2.8.7-1
In-Reply-To: <508B1558.5070306@rabbitmq.com>
References: <1a5770c3-b3ea-4335-b5b1-688fef50fa22@googlegroups.com>
	<c5fb21b1-8bc8-4fb4-acd8-44b78c2f27fa@googlegroups.com>
	<508B1558.5070306@rabbitmq.com>
Message-ID: <CACx7p4C5ah2OCEBTjroONbhHTJKMmWYiKZQhP_wL7722T9MT_Q@mail.gmail.com>

My apologies, but his reply doesn't appear in Google groups.
I'm sure we didn't install Erlang from sources but maybe some other way,
What's the best solution?

On Sat, Oct 27, 2012 at 12:57 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 26/10/12 23:32, Raviv Pavel wrote:
>
>> Does anyone have an idea? I'm stuck here
>>
>
> Jerry replied to your original post the same day. See
> http://rabbitmq.1065348.n5.**nabble.com/Erlang-version-**
> issue-when-Upgrading-to-2-8-7-**1-tp22547p22548.html<http://rabbitmq.1065348.n5.nabble.com/Erlang-version-issue-when-Upgrading-to-2-8-7-1-tp22547p22548.html>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121027/41a443eb/attachment.htm>

From matthias at rabbitmq.com  Sat Oct 27 10:02:06 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 27 Oct 2012 10:02:06 +0100
Subject: [rabbitmq-discuss] Erlang version issue when Upgrading to
	2.8.7-1
In-Reply-To: <CACx7p4C5ah2OCEBTjroONbhHTJKMmWYiKZQhP_wL7722T9MT_Q@mail.gmail.com>
References: <1a5770c3-b3ea-4335-b5b1-688fef50fa22@googlegroups.com>
	<c5fb21b1-8bc8-4fb4-acd8-44b78c2f27fa@googlegroups.com>
	<508B1558.5070306@rabbitmq.com>
	<CACx7p4C5ah2OCEBTjroONbhHTJKMmWYiKZQhP_wL7722T9MT_Q@mail.gmail.com>
Message-ID: <508BA30E.3050505@rabbitmq.com>

On 27/10/12 09:37, Raviv Pavel wrote:
> My apologies, but his reply doesn't appear in Google groups.
> I'm sure we didn't install Erlang from sources but maybe some other way,
> What's the best solution?

Follow the instructions at http://www.rabbitmq.com/install-rpm.html

Alternatively, iirc, you may be able to tell rpm to not bail on the 
missing Erlang dependency by supplying '--nodeps', though that is 
dangerous since it will suppress *all* dependency checking.

Regards,

Matthias.

From deshai-0 at student.ltu.se  Sat Oct 27 14:30:44 2012
From: deshai-0 at student.ltu.se (Desta Haileselassie Hagos)
Date: Sat, 27 Oct 2012 15:30:44 +0200
Subject: [rabbitmq-discuss] RabbitMQ, push a script
In-Reply-To: <508A9D81.9090102@rabbitmq.com>
References: <CAKiRAqVHc+kZHXVpNGjp36-_74vDfkxjNfPsi7+qFJDj2kPSUw@mail.gmail.com>
	<50893005.8090207@rabbitmq.com>
	<1351174775019-22864.post@n5.nabble.com>
	<508953D9.1050806@rabbitmq.com>
	<CAKiRAqXmB8ZS6+PcxWyynZiLy9RNbveNHJjt0uJObKVBxpxYFA@mail.gmail.com>
	<508A9D81.9090102@rabbitmq.com>
Message-ID: <CAKiRAqXzgAtTORckHC3PR4oX59eWUkigzRR3C7Z4F9tBKz2UJw@mail.gmail.com>

I want my message to be consumed by 10 people.



On Fri, Oct 26, 2012 at 4:26 PM, Emile Joubert <emile at rabbitmq.com> wrote:

> Hi,
>
> On 25/10/12 17:47, Desta Haileselassie Hagos wrote:
> > I have one more question, I want my queues to be read by many users so
> > that the queue will not be empty once one user has read the messages.
> >
> > Is there any way to preserve the messages for all users or for a
> > specific period of time? Is this supported in RabbitMQ?
>
> It is possible to expire unread messages after a period of time:
> http://www.rabbitmq.com/ttl.html#per-queue-message-ttl
> But that is probably not what you want. If you want a message to reach
> multiple consumers then it is better to declare a separate queue for
> each consumer. This is the pattern in tutorial 3:
> http://www.rabbitmq.com/tutorials/tutorial-three-python.html
>
>
> -Emile
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121027/6d28f7f0/attachment.htm>

From raviv at gigya-inc.com  Sat Oct 27 15:30:19 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Sat, 27 Oct 2012 07:30:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
In-Reply-To: <508A3FEF.2080201@rabbitmq.com>
References: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
	<f64caa3a-6947-4bcf-96ee-077b94f5da44@googlegroups.com>
	<430b9cc7-4219-443d-8505-0946a5ce5967@googlegroups.com>
	<508A3FEF.2080201@rabbitmq.com>
Message-ID: <375f8d16-e363-4c01-9acf-3361d3f7cc3a@googlegroups.com>

Thanks Matthias.

Queue TTL was exactly what I needed. 

On Friday, October 26, 2012 9:47:12 AM UTC+2, Matthias Radestock wrote:
>
> On 26/10/12 07:28, Raviv Pavel wrote: 
> > I find this behavior is problematic 
>
> AMQP/Rabbit could hardly do anything different - if the sole condition 
> for auto-deletion was that there are no consumers then the queue would 
> get deleted straight after creation, before you've had a chance to 
> attach any consumers. 
>
> > If I create an auto-delete queue (by code) and then crash before 
> > consuming, the queue will be stuck there until I delete it. 
>
> Couldn't you make the queue 'exclusive' instead of 'auto-delete'? 
>
> Or, alternatively, set a lease (http://www.rabbitmq.com/ttl.html#queue-ttl). 
>
>
> Regards, 
>
> Matthias. 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121027/b5c9419b/attachment.htm>

From raviv at gigya-inc.com  Sat Oct 27 15:30:19 2012
From: raviv at gigya-inc.com (Raviv Pavel)
Date: Sat, 27 Oct 2012 07:30:19 -0700 (PDT)
Subject: [rabbitmq-discuss] Auto-Delete queues not getting deleted
In-Reply-To: <508A3FEF.2080201@rabbitmq.com>
References: <ac422ddc-89ba-4181-8ea2-0e60e498c98a@googlegroups.com>
	<f64caa3a-6947-4bcf-96ee-077b94f5da44@googlegroups.com>
	<430b9cc7-4219-443d-8505-0946a5ce5967@googlegroups.com>
	<508A3FEF.2080201@rabbitmq.com>
Message-ID: <375f8d16-e363-4c01-9acf-3361d3f7cc3a@googlegroups.com>

Thanks Matthias.

Queue TTL was exactly what I needed. 

On Friday, October 26, 2012 9:47:12 AM UTC+2, Matthias Radestock wrote:
>
> On 26/10/12 07:28, Raviv Pavel wrote: 
> > I find this behavior is problematic 
>
> AMQP/Rabbit could hardly do anything different - if the sole condition 
> for auto-deletion was that there are no consumers then the queue would 
> get deleted straight after creation, before you've had a chance to 
> attach any consumers. 
>
> > If I create an auto-delete queue (by code) and then crash before 
> > consuming, the queue will be stuck there until I delete it. 
>
> Couldn't you make the queue 'exclusive' instead of 'auto-delete'? 
>
> Or, alternatively, set a lease (http://www.rabbitmq.com/ttl.html#queue-ttl). 
>
>
> Regards, 
>
> Matthias. 
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121027/b5c9419b/attachment-0001.htm>

From static.void.dev at gmail.com  Sun Oct 28 16:48:08 2012
From: static.void.dev at gmail.com (Mark)
Date: Sun, 28 Oct 2012 09:48:08 -0700
Subject: [rabbitmq-discuss] AMQP gem(s) and Unicorn
Message-ID: <35667BA8-5F6F-4D24-BC77-4319C2CF428A@gmail.com>

Within a Rails application running on Unicorn, or any other non-evented application server, should one use the AMQP (async) or Bunny (sync) gem? I read in Service-Oriented Design with Ruby and Rails that typically users will use Bunny on the application server side due to the problems/complications of using EventMachine. Is this the case? Is the async AMQP gem recommend in production Unicorn environments?

Another question regarding the documentation on connecting to Unicorn: http://rubyamqp.info/articles/connecting_to_broker/#using_ruby_amqp_gem_with_unicorn How come it doesn't include the use of: AMQP::Utilities::EventLoopHelper.run or AMQP::Integration::Rails.start? I understand that a new thread must be created in the after_fork but is the AMQP::Integration::Rails.start necessary or can/should that be used in any controller/action where we intend to use AMQP? 

Thanks for the help


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121028/69c2b0ba/attachment.htm>

From michael.s.klishin at gmail.com  Sun Oct 28 18:34:47 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 28 Oct 2012 22:34:47 +0400
Subject: [rabbitmq-discuss] AMQP gem(s) and Unicorn
In-Reply-To: <35667BA8-5F6F-4D24-BC77-4319C2CF428A@gmail.com>
References: <35667BA8-5F6F-4D24-BC77-4319C2CF428A@gmail.com>
Message-ID: <CAE3HoVRcY-VsUo3ssqGgfafGdRAWdOka8JzGoVbbHPmX41kzjg@mail.gmail.com>

2012/10/28 Mark <static.void.dev at gmail.com>

> Is this the case? Is the async AMQP gem recommend in production Unicorn
> environments?
>
>
You can use either but Bunny has limitations, performs poorly and needs a
ground-up rewrite.


> Another question regarding the documentation on connecting to Unicorn:
> http://rubyamqp.info/articles/connecting_to_broker/#using_ruby_amqp_gem_with_unicorn How
> come it doesn't include the use of: AMQP::Utilities::EventLoopHelper.run
> or AMQP::Integration::Rails.start? I understand that a new thread must be
> created in the after_fork but is the AMQP::Integration::Rails.start
> necessary or can/should that be used in any controller/action where we
> intend to use AMQP?
>

The docs were written before EventLoopHelper was added. And no, you should
not go through the whole
connection process on every action. Do it once on boot.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121028/35f0390c/attachment.htm>

From ejsmont.artur at gmail.com  Mon Oct 29 03:29:13 2012
From: ejsmont.artur at gmail.com (Artur Ejsmont)
Date: Mon, 29 Oct 2012 14:29:13 +1100
Subject: [rabbitmq-discuss] Cacti templates for rabbitmq available
Message-ID: <CABv2Cn0TGLp7KvC+Di54fKMd-W+iCiW79zKMGUwp==SQcFcPjw@mail.gmail.com>

Hi there everyone,

I have created a cacti host template and a simple rabbitmqctl processing
script for rabbitmq.

Please feel free to check it out and send some feedback:
http://artur.ejsmont.org/blog/content/cacti-rabbitmq-host-template-with-graph-templates-and-gathering-script

I only created them as I could not find any online and I still use cacti
all over the place :)

1. If you know how to get stats over AMQP that would be even better as i
would not need to run the cron. Is there some built-in stats reporting over
AMQP giving rabbitmqctl list/stats features?

2. I also wanted to get some more stats but could not find a way to get
them, is there way to get these:
- avg message age (how much time does it take on avg for message to get
from publisher to consumer
- total bytes sent/read per vhost or per node (value is available per
channel but it can not be summarised to give stable graph)
- total messages published/consumed (i can get depth of the queue but  i
dont know how many messages passed through the system)
- total connections opened (same as above, in case of clients connecting
and disconnecting very fast i wont see the velocity as i can only see the
current connections count)

thanks a lot, take care

Art

-- 
Visit me at:
http://artur.ejsmont.org/blog/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/fe13f300/attachment.htm>

From littypreethkr at gmail.com  Mon Oct 29 06:01:52 2012
From: littypreethkr at gmail.com (littypreethkr)
Date: Sun, 28 Oct 2012 23:01:52 -0700 (PDT)
Subject: [rabbitmq-discuss] pika 0.9.6 and Reconnection Strategies
In-Reply-To: <CAKwdTWcESvm1wdC0cMawFer3Kq_P6wCdf=Dz4oUjjgdiRiO0kg@mail.gmail.com>
References: <CAKwdTWcESvm1wdC0cMawFer3Kq_P6wCdf=Dz4oUjjgdiRiO0kg@mail.gmail.com>
Message-ID: <1351490512146-22923.post@n5.nabble.com>

Hi Gavin,

When are you planning on releasing 0.9.6 version?

Regards,
Litty Preeth



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/pika-0-9-6-and-Reconnection-Strategies-tp22254p22923.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From dev440 at gmail.com  Mon Oct 29 07:36:18 2012
From: dev440 at gmail.com (chetan dev)
Date: Mon, 29 Oct 2012 13:06:18 +0530
Subject: [rabbitmq-discuss] How messages are processed
Message-ID: <CAB0ZxM7+8kQVmhXfD=nU1vmo5eN2oPyGVpHsnog++-+K=nFgmQ@mail.gmail.com>

Hi,

1. There are two console app for consumption of messages in a queue
2. there are currently two messages in queue
3. now i run console app1 it takes out message1 , then i put it on sleep
mode for 10 secs before sending acknowledgement
4. in the meanwhile before ack for the first message went i run console
app2 .
5. i expected the console app to fetch the second message before the ack
for first message was sent but that did not happen.
instead console app 2 waited for ack of message 1 and then processed
message 2
is there a way in which  i can take out message2 before sending ack for
mesage1

Thanks

-- 
Cheten  Dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/2da102f0/attachment.htm>

From matthias at rabbitmq.com  Mon Oct 29 07:54:40 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 29 Oct 2012 07:54:40 +0000
Subject: [rabbitmq-discuss] How messages are processed
In-Reply-To: <CAB0ZxM7+8kQVmhXfD=nU1vmo5eN2oPyGVpHsnog++-+K=nFgmQ@mail.gmail.com>
References: <CAB0ZxM7+8kQVmhXfD=nU1vmo5eN2oPyGVpHsnog++-+K=nFgmQ@mail.gmail.com>
Message-ID: <508E3640.3040303@rabbitmq.com>

On 29/10/12 07:36, chetan dev wrote:
> is there a way in which  i can take out message2 before sending ack for
> mesage1

See the "Fair dispatch" section in 
http://next.rabbitmq.com/tutorials/tutorial-two-python.html

Matthias.

From watson.timothy at gmail.com  Mon Oct 29 07:57:10 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 29 Oct 2012 07:57:10 +0000
Subject: [rabbitmq-discuss] How messages are processed
In-Reply-To: <CAB0ZxM7+8kQVmhXfD=nU1vmo5eN2oPyGVpHsnog++-+K=nFgmQ@mail.gmail.com>
References: <CAB0ZxM7+8kQVmhXfD=nU1vmo5eN2oPyGVpHsnog++-+K=nFgmQ@mail.gmail.com>
Message-ID: <55BD6540-5B7D-4B91-8799-7FC2ED217172@rabbitmq.com>

Hi

On 29 Oct 2012, at 07:36, chetan dev <dev440 at gmail.com> wrote:

> Hi,
> 
> 1. There are two console app for consumption of messages in a queue
> 2. there are currently two messages in queue 
> 3. now i run console app1 it takes out message1 , then i put it on sleep mode for 10 secs before sending acknowledgement 
> 4. in the meanwhile before ack for the first message went i run console app2 .
> 5. i expected the console app to fetch the second message before the ack for first message was sent but that did not happen.
> instead console app 2 waited for ack of message 1 and then processed message 2
> is there a way in which  i can take out message2 before sending ack for mesage1 
> 

I don't think so. If rabbit would let you do that, then the first message was rejected, what would happen to the ordering guarantees?

You'd have to stop using ACKs or send a nack/reject to do this afaik.

> Thanks
> 
> -- 
> Cheten  Dev 
> 
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From watson.timothy at gmail.com  Mon Oct 29 08:02:48 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 29 Oct 2012 08:02:48 +0000
Subject: [rabbitmq-discuss] How messages are processed
In-Reply-To: <55BD6540-5B7D-4B91-8799-7FC2ED217172@rabbitmq.com>
References: <CAB0ZxM7+8kQVmhXfD=nU1vmo5eN2oPyGVpHsnog++-+K=nFgmQ@mail.gmail.com>
	<55BD6540-5B7D-4B91-8799-7FC2ED217172@rabbitmq.com>
Message-ID: <2760CC08-EE93-44C9-9E8D-D7612F7AE3E9@rabbitmq.com>

Sorry that's wrong, I didn't read 2 consumers properly.



On 29 Oct 2012, at 07:57, Tim Watson <watson.timothy at gmail.com> wrote:

> Hi
> 
> On 29 Oct 2012, at 07:36, chetan dev <dev440 at gmail.com> wrote:
> 
>> Hi,
>> 
>> 1. There are two console app for consumption of messages in a queue
>> 2. there are currently two messages in queue 
>> 3. now i run console app1 it takes out message1 , then i put it on sleep mode for 10 secs before sending acknowledgement 
>> 4. in the meanwhile before ack for the first message went i run console app2 .
>> 5. i expected the console app to fetch the second message before the ack for first message was sent but that did not happen.
>> instead console app 2 waited for ack of message 1 and then processed message 2
>> is there a way in which  i can take out message2 before sending ack for mesage1 
>> 
> 
> I don't think so. If rabbit would let you do that, then the first message was rejected, what would happen to the ordering guarantees?
> 
> You'd have to stop using ACKs or send a nack/reject to do this afaik.
> 
>> Thanks
>> 
>> -- 
>> Cheten  Dev 
>> 
>> 
>> 
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From ludo.fleury at gmail.com  Sun Oct 28 06:41:54 2012
From: ludo.fleury at gmail.com (Ludovic Fleury)
Date: Sat, 27 Oct 2012 23:41:54 -0700 (PDT)
Subject: [rabbitmq-discuss] Dead letter exchange behavior / best practice
Message-ID: <fa512b9e-54ab-4de4-b309-92aaef4abe06@googlegroups.com>

Hey,

I'm new to RabbitMQ and I try to use the dead letter exchange feature.
Yet, I don't know if I make a misstake or if I misunderstand the 
documentation about it:

As far as I read in the doc: 

The dead-lettering process adds an array to the header of each 
> dead-lettered message named x-death. 

This array contains an entry for each time the message was dead-lettered. 
> Each such entry is a table that consists of several fields


So basically, I have 2 queues and 2 exchanges:
-"my-exchange" bound to "my-queue"
-"my-dead-exchange" bound to "my-dead-queue"

I have set a DLX on "my-queue" to "my-dead-exchange" and I have set another 
DLX on "my-dead-queue" to ... "my-dead-exchange".
The last DLX is a cylic DLX. I hope this is okay ?

When I first reject a message on "my queue", everything is okay: I have the 
message handled by "my-dead-exchange" and placed to "my-dead-queue".
But then, when I reject again the message... The message is not handled by 
"my-dead-exchange" and nor replaced into the "my-dead-queue".

With the documentation, I understand that: every time a message is 
rejecteted, I would be able to "count" the number of rejection by counting 
on the "x-death" header.
So instead of rejecting with a requeue, I would like to take advantage of 
this behavior by rejecting into a "cylic DLX" (to count the total of 
rejection for a message).

Is my implementation incorrect ? How can I handle this need in RabbitMQ ?
Thanks.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121027/5b6eeccc/attachment.htm>

From ludo.fleury at gmail.com  Sun Oct 28 07:53:15 2012
From: ludo.fleury at gmail.com (Ludovic Fleury)
Date: Sun, 28 Oct 2012 00:53:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Dead letter exchange behavior / best practice
In-Reply-To: <fa512b9e-54ab-4de4-b309-92aaef4abe06@googlegroups.com>
References: <fa512b9e-54ab-4de4-b309-92aaef4abe06@googlegroups.com>
Message-ID: <48b56df6-73ca-4525-9f62-66d16d4f4247@googlegroups.com>

I tried another setup which seems to don't work either...

Here's my second setup:
-"my-exchange" bound to "my-queue"
-"my-ttl-exchange" bound to "my-ttl-queue" with a "x-message-ttl set to 
5000".


- "my-queue" has a DLX set on "my-ttl-exchange'.
- "my-ttl-queue" has a DLX set on "my-exchange".

I have only one worker which consume my-queue.

So the scenario should be simple, a message is published into 
"my-exchange", which place the message into "my-queue".
The worker consume the message in "my-queue", 
if the worker reject the message, it should be placed into "my-ttl-queue" 
with a ttl of 5 seconds.
Since there is no worker consuming "my-ttl-queue", the message ttl will 
expire and ... the message should be re-placed into "my-queue".

Basically, everythig work except the last part: once in "my-ttl-queue", the 
message does'nt seems to be placed in the correct DLX nor in the original 
queue...

So I assume cyclic DLX are not allowed ? 


Le dimanche 28 octobre 2012 07:41:54 UTC+1, Ludovic Fleury a ?crit :
>
> Hey,
>
> I'm new to RabbitMQ and I try to use the dead letter exchange feature.
> Yet, I don't know if I make a misstake or if I misunderstand the 
> documentation about it:
>
> As far as I read in the doc: 
>
> The dead-lettering process adds an array to the header of each 
>> dead-lettered message named x-death. 
>
> This array contains an entry for each time the message was dead-lettered. 
>> Each such entry is a table that consists of several fields
>
>
> So basically, I have 2 queues and 2 exchanges:
> -"my-exchange" bound to "my-queue"
> -"my-dead-exchange" bound to "my-dead-queue"
>
> I have set a DLX on "my-queue" to "my-dead-exchange" and I have set 
> another DLX on "my-dead-queue" to ... "my-dead-exchange".
> The last DLX is a cylic DLX. I hope this is okay ?
>
> When I first reject a message on "my queue", everything is okay: I have 
> the message handled by "my-dead-exchange" and placed to "my-dead-queue".
> But then, when I reject again the message... The message is not handled by 
> "my-dead-exchange" and nor replaced into the "my-dead-queue".
>
> With the documentation, I understand that: every time a message is 
> rejecteted, I would be able to "count" the number of rejection by counting 
> on the "x-death" header.
> So instead of rejecting with a requeue, I would like to take advantage of 
> this behavior by rejecting into a "cylic DLX" (to count the total of 
> rejection for a message).
>
> Is my implementation incorrect ? How can I handle this need in RabbitMQ ?
> Thanks.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121028/624cfce8/attachment.htm>

From thebitterend77 at gmail.com  Fri Oct 26 17:14:51 2012
From: thebitterend77 at gmail.com (gleb Chermennov)
Date: Fri, 26 Oct 2012 09:14:51 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ C# Client - Dispose() hangs
In-Reply-To: <4ceb93f8-a0d0-4461-9c67-a4ab576e0aa1@googlegroups.com>
References: <d67e92d9-32b8-43b4-8b4d-0a153c5565e8@googlegroups.com>
	<c60d444c-272f-456f-90e0-4ed68c7f9dad@googlegroups.com>
	<4ceb93f8-a0d0-4461-9c67-a4ab576e0aa1@googlegroups.com>
Message-ID: <324e245e-d8ab-4506-878f-e82acad12399@googlegroups.com>

Hello guys, I just stumbled onto this exact problem. Is this a bug or what? 
How to overcome this situation?

???????????, 27 ??????? 2012 ?., 22:48:10 UTC+4 ???????????? Micha ???????:
>
> Hi Derek,
>
> Sorry for late reply. I'm still having problems when disposing the 
> connection. Currently the only workaround for me is to call dispose() with 
> a timeout.
>
> Do you have more info about it?
>
> Cheers,
>
> Micha
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121026/5a5cd0f6/attachment.htm>

From thebitterend77 at gmail.com  Sat Oct 27 17:30:13 2012
From: thebitterend77 at gmail.com (gleb Chermennov)
Date: Sat, 27 Oct 2012 09:30:13 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ C# Client - Dispose() hangs
In-Reply-To: <4ceb93f8-a0d0-4461-9c67-a4ab576e0aa1@googlegroups.com>
References: <d67e92d9-32b8-43b4-8b4d-0a153c5565e8@googlegroups.com>
	<c60d444c-272f-456f-90e0-4ed68c7f9dad@googlegroups.com>
	<4ceb93f8-a0d0-4461-9c67-a4ab576e0aa1@googlegroups.com>
Message-ID: <bbf304ec-ffec-4dac-bf52-92c44f6da214@googlegroups.com>

Stumbled onto this yesterday. Is it a bug or what? Is there a suggested 
workaround?

???????????, 27 ??????? 2012 ?., 22:48:10 UTC+4 ???????????? Micha ???????:
>
> Hi Derek,
>
> Sorry for late reply. I'm still having problems when disposing the 
> connection. Currently the only workaround for me is to call dispose() with 
> a timeout.
>
> Do you have more info about it?
>
> Cheers,
>
> Micha
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121027/28403b0d/attachment.htm>

From mcdonnell.myles at googlemail.com  Sun Oct 28 10:12:57 2012
From: mcdonnell.myles at googlemail.com (Myles McDonnell)
Date: Sun, 28 Oct 2012 10:12:57 +0000
Subject: [rabbitmq-discuss] QueueingConsumer extended with the CoDel
	algorithm
Message-ID: <CAJU1BF7NCW4S067zEYNwV46AewSq2jzP_N2ZeW5aRy6ngpkSgw@mail.gmail.com>

Hello All

I'm considering writing a C# implementation of
https://gist.github.com/2658712 as referenced here
http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/
.

Unless this has already been done? Should I fork the .NET RabbitMQ client
and send a pull request when complete?

Any advice much appreciated.

Thanks
Myles
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121028/e258d9d4/attachment.htm>

From watson.timothy at gmail.com  Mon Oct 29 08:25:08 2012
From: watson.timothy at gmail.com (Tim Watson)
Date: Mon, 29 Oct 2012 08:25:08 +0000
Subject: [rabbitmq-discuss] Dead letter exchange behavior / best practice
In-Reply-To: <48b56df6-73ca-4525-9f62-66d16d4f4247@googlegroups.com>
References: <fa512b9e-54ab-4de4-b309-92aaef4abe06@googlegroups.com>
	<48b56df6-73ca-4525-9f62-66d16d4f4247@googlegroups.com>
Message-ID: <5D1FA78A-7AD6-4884-B5D1-78D9CB1AC881@rabbitmq.com>

Hi

On 28 Oct 2012, at 07:53, Ludovic Fleury <ludo.fleury at gmail.com> wrote:

> I tried another setup which seems to don't work either...
> 
> So I assume cyclic DLX are not allowed ? 
> 
> 

Correct, although we're considering dropping this restriction in a future release.

> Le dimanche 28 octobre 2012 07:41:54 UTC+1, Ludovic Fleury a ?crit :
> Hey,
> 
> I'm new to RabbitMQ and I try to use the dead letter exchange feature.
> Yet, I don't know if I make a misstake or if I misunderstand the documentation about it:
> 
> As far as I read in the doc: 
> 
> The dead-lettering process adds an array to the header of each dead-lettered message named x-death. 
> This array contains an entry for each time the message was dead-lettered. 
> Each such entry is a table that consists of several fields
> 
> So basically, I have 2 queues and 2 exchanges:
> -"my-exchange" bound to "my-queue"
> -"my-dead-exchange" bound to "my-dead-queue"
> 
> I have set a DLX on "my-queue" to "my-dead-exchange" and I have set another DLX on "my-dead-queue" to ... "my-dead-exchange".
> The last DLX is a cylic DLX. I hope this is okay ?
> 
> When I first reject a message on "my queue", everything is okay: I have the message handled by "my-dead-exchange" and placed to "my-dead-queue".
> But then, when I reject again the message... The message is not handled by "my-dead-exchange" and nor replaced into the "my-dead-queue".
> 
> With the documentation, I understand that: every time a message is rejecteted, I would be able to "count" the number of rejection by counting on the "x-death" header.
> So instead of rejecting with a requeue, I would like to take advantage of this behavior by rejecting into a "cylic DLX" (to count the total of rejection for a message).
> 
> Is my implementation incorrect ? How can I handle this need in RabbitMQ ?
> Thanks.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/78c22430/attachment.htm>

From matthias at rabbitmq.com  Mon Oct 29 10:12:36 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 29 Oct 2012 10:12:36 +0000
Subject: [rabbitmq-discuss] {SSL upgrade error, timeout}
In-Reply-To: <CAC3-Q1RBiLnjMCtuACu-L4_ZM3H7P6+B=LPOyvzHOWQ6yaVsgQ@mail.gmail.com>
References: <356b01aa-4df9-44cb-9e3a-54492ce13f2b@googlegroups.com>
	<508510CD.8040001@rabbitmq.com>
	<CAC3-Q1RBiLnjMCtuACu-L4_ZM3H7P6+B=LPOyvzHOWQ6yaVsgQ@mail.gmail.com>
Message-ID: <508E5694.6060106@rabbitmq.com>

Dharshan,

On 22/10/12 21:48, Dharshan Rangegowda wrote:
> I ran through the troubleshooting wizard and the openssl connection test
> passes - so that makes me think it is not a network issue. However my
> java client still fails with the "Remote host closed connection during
> handshake" error. I have included the results of the connection test
> below. Any other thoughts on how I can debug this?

One possibility is that the ssl handshake genuinely takes too long (>5 
seconds). When you ran...

> C:\temp>openssl s_client -connect 199.71.180.59:5671

...how long did it take for the handshake to complete?

Also, at the risk of stating the obvious, did you check that your client 
is correctly configured to trust the self-signed cert? I am asking 
because the certificate below...

> -----BEGIN CERTIFICATE-----
> [...]
> -----END CERTIFICATE-----

was issued on 22nd October.

So the fact that your client stopped working then is probably not a 
coincidence.

Regards,

Matthias.

From tim at rabbitmq.com  Mon Oct 29 11:34:18 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 29 Oct 2012 11:34:18 +0000
Subject: [rabbitmq-discuss] RabbitMQ C# Client - Dispose() hangs
In-Reply-To: <bbf304ec-ffec-4dac-bf52-92c44f6da214@googlegroups.com>
References: <d67e92d9-32b8-43b4-8b4d-0a153c5565e8@googlegroups.com>
	<c60d444c-272f-456f-90e0-4ed68c7f9dad@googlegroups.com>
	<4ceb93f8-a0d0-4461-9c67-a4ab576e0aa1@googlegroups.com>
	<bbf304ec-ffec-4dac-bf52-92c44f6da214@googlegroups.com>
Message-ID: <508E69BA.7000707@rabbitmq.com>

Hi

On 10/27/2012 05:30 PM, gleb Chermennov wrote:
> Stumbled onto this yesterday. Is it a bug or what? Is there a 
> suggested workaround?
>

Yes this is a bug. The suggested workaround is to call dispose with a 
timeout. We'll get a fix out as soon as possible.

Cheers,
TIm

> ???????????, 27 ??????? 2012 ?., 22:48:10 UTC+4 ???????????? Micha 
> ???????:
>
>     Hi Derek,
>
>     Sorry for late reply. I'm still having problems when disposing the
>     connection. Currently the only workaround for me is to call
>     dispose() with a timeout.
>
>     Do you have more info about it?
>
>     Cheers,
>
>     Micha
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/5e0b8b7e/attachment.htm>

From tim at rabbitmq.com  Mon Oct 29 12:02:45 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 29 Oct 2012 12:02:45 +0000
Subject: [rabbitmq-discuss] RabbitMQ C# Client - Dispose() hangs
In-Reply-To: <508E69BA.7000707@rabbitmq.com>
References: <d67e92d9-32b8-43b4-8b4d-0a153c5565e8@googlegroups.com>
	<c60d444c-272f-456f-90e0-4ed68c7f9dad@googlegroups.com>
	<4ceb93f8-a0d0-4461-9c67-a4ab576e0aa1@googlegroups.com>
	<bbf304ec-ffec-4dac-bf52-92c44f6da214@googlegroups.com>
	<508E69BA.7000707@rabbitmq.com>
Message-ID: <508E7065.6000808@rabbitmq.com>

BTW - we have a fix for this going through QA at the moment. When it is 
accepted and merged into default, you'll be able to try the fix out 
using our nightly builds (http://www.rabbitmq.com/nightly-builds.html) 
and see if it works for you. You'll be able to tell when this is merged 
by looking at http://hg.rabbitmq.com/rabbitmq-dotnet-client/ - once 
bug25255 is merged into default then the subsequent nightly build will 
include the fix.

Cheers,
Tim

On 10/29/2012 11:34 AM, Tim Watson wrote:
> Hi
>
> On 10/27/2012 05:30 PM, gleb Chermennov wrote:
>> Stumbled onto this yesterday. Is it a bug or what? Is there a 
>> suggested workaround?
>>
>
> Yes this is a bug. The suggested workaround is to call dispose with a 
> timeout. We'll get a fix out as soon as possible.
>
> Cheers,
> TIm
>
>> ???????????, 27 ??????? 2012 ?., 22:48:10 UTC+4 ???????????? Micha 
>> ???????:
>>
>>     Hi Derek,
>>
>>     Sorry for late reply. I'm still having problems when disposing
>>     the connection. Currently the only workaround for me is to call
>>     dispose() with a timeout.
>>
>>     Do you have more info about it?
>>
>>     Cheers,
>>
>>     Micha
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/72440346/attachment.htm>

From tim at rabbitmq.com  Mon Oct 29 12:18:23 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 29 Oct 2012 12:18:23 +0000
Subject: [rabbitmq-discuss] RabbitMQ C# Client - Dispose() hangs
In-Reply-To: <4ceb93f8-a0d0-4461-9c67-a4ab576e0aa1@googlegroups.com>
References: <d67e92d9-32b8-43b4-8b4d-0a153c5565e8@googlegroups.com>
	<c60d444c-272f-456f-90e0-4ed68c7f9dad@googlegroups.com>
	<4ceb93f8-a0d0-4461-9c67-a4ab576e0aa1@googlegroups.com>
Message-ID: <508E740F.2080407@rabbitmq.com>

Micha

On 08/27/2012 07:48 PM, Micha wrote:
> Hi Derek,
>
> Sorry for late reply. I'm still having problems when disposing the connection. Currently the only workaround for me is to call dispose() with a timeout.

If as Derek suggested, you are calling Dispose on your within the 
context of a ConnectionShutdownEvent, then don't do that. You shouldn't 
close a Channel/IModel from within a shutdown callback.

From gmr at meetme.com  Mon Oct 29 14:45:50 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Mon, 29 Oct 2012 10:45:50 -0400
Subject: [rabbitmq-discuss] pika 0.9.6 and Reconnection Strategies
In-Reply-To: <1351490512146-22923.post@n5.nabble.com>
References: <CAKwdTWcESvm1wdC0cMawFer3Kq_P6wCdf=Dz4oUjjgdiRiO0kg@mail.gmail.com>
	<1351490512146-22923.post@n5.nabble.com>
Message-ID: <CAKwdTWdWDMwfgjknMYTExsjkBspg8yHt9yXaX_hLgDmzC8Uqxw@mail.gmail.com>

I'm working to get it up on pypi today.

On Mon, Oct 29, 2012 at 2:01 AM, littypreethkr <littypreethkr at gmail.com>wrote:

> Hi Gavin,
>
> When are you planning on releasing 0.9.6 version?
>
> Regards,
> Litty Preeth
>

-- 

Gavin M. Roy
Chief Technology Officer

 <http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/08599838/attachment.htm>

From simlu at su.se  Mon Oct 29 16:04:42 2012
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Mon, 29 Oct 2012 17:04:42 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin and default node behaviour
In-Reply-To: <508149DB.7010701@rabbitmq.com>
References: <20121019100118.GB1210@kaka.it.su.se>
	<508149DB.7010701@rabbitmq.com>
Message-ID: <20121029160441.GI426@kaka.it.su.se>

On Fri, 2012-10-19 at 13:38:51 +0100, Simon MacMullen wrote:
> On 19/10/12 11:01, Simon Lundstr?m wrote:
> >I'm trying to understand why rabbitmqadmin doesn't use the "default"
> >node when no config file is specified.
> >I use a config (stored in the default location) but I everytime I use
> >rabbitmqadmin I don't want to explicitly specify the node for every
> >command.
> >Someone must have had a good reason for not doing this in the first
> >place, but I cannot figure it out.
> 
> Hmm. Not sure I remember. The best explanation is at
> 
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-February/018191.html
> 
> There's obviously a concern about not breaking the case where there
> is no config file. Maybe that was all.

Ugh, while implementing my solution I understand why it's made the way
it is. Config parsing is messy = S (Especially since my Python- and
ConfigParser-FU is weak)

So, my new suggestion is:

Parse the config/defaults in this order:
# defaults from default_options hash^Wdictionary
# config file, one of:
## specified via --config
### Use it and exit with an error if:
#### File doesn't exist
#### Node in config doesn't exist (default being default node or the one
specified via --node)
## default config file (~/.rabbitmqadmin.conf)
### If file doesn't exist, just ignore it.
### If file exists and node in file doesn't exist
#### exit showing that error message
# Options on the command line

This would also overwrite any options (last parsed "wins").

How does this sound?

Thanks,
- Simon

From tim at rabbitmq.com  Mon Oct 29 16:16:17 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 29 Oct 2012 16:16:17 +0000
Subject: [rabbitmq-discuss] QueueingConsumer extended with the CoDel
	algorithm
In-Reply-To: <CAJU1BF7NCW4S067zEYNwV46AewSq2jzP_N2ZeW5aRy6ngpkSgw@mail.gmail.com>
References: <CAJU1BF7NCW4S067zEYNwV46AewSq2jzP_N2ZeW5aRy6ngpkSgw@mail.gmail.com>
Message-ID: <508EABD1.7040409@rabbitmq.com>

Hi!

On 10/28/2012 10:12 AM, Myles McDonnell wrote:
> Hello All
>
> I'm considering writing a C# implementation of 
> https://gist.github.com/2658712 as referenced here 
> http://www.rabbitmq.com/blog/2012/05/11/some-queuing-theory-throughput-latency-and-bandwidth/.
>
> Unless this has already been done? Should I fork the .NET RabbitMQ 
> client and send a pull request when complete?
>

Nobody has done this so far, and we *do* like contributions! :)

> Any advice much appreciated.
>

You'll need to sign a 'Contributor Licence Agreement', the details of 
which we can discuss off-line. Forking on github and then submitting a 
pull request would be ideal, as we can discuss any QA feedback directly 
against the code that way. It would be good if you could provide a test 
harness too: if we decide to merge your implementation, then we'd have 
to support it in future releases so having a means to verify that it 
behaves as expected would be quite important.

Another alternative, of course, would be to package your implementation 
up into a library that sits on top of the RabbitMQ .NET client, and 
distribute that via NuGet. Of course I don't want to discourage you from 
contributing, but if you do decide to go down that route instead, please 
feel free to come back here with any questions that arise whilst you're 
working on it.

Cheers,
Tim

> Thanks
> Myles
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/98a6b547/attachment.htm>

From simon at rabbitmq.com  Mon Oct 29 16:22:21 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 29 Oct 2012 16:22:21 +0000
Subject: [rabbitmq-discuss] Cacti templates for rabbitmq available
In-Reply-To: <CABv2Cn0TGLp7KvC+Di54fKMd-W+iCiW79zKMGUwp==SQcFcPjw@mail.gmail.com>
References: <CABv2Cn0TGLp7KvC+Di54fKMd-W+iCiW79zKMGUwp==SQcFcPjw@mail.gmail.com>
Message-ID: <508EAD3D.2000209@rabbitmq.com>

On 29/10/12 03:29, Artur Ejsmont wrote:
> Hi there everyone,
>
> I have created a cacti host template and a simple rabbitmqctl processing
> script for rabbitmq.

Cool!

> Please feel free to check it out and send some feedback:
> http://artur.ejsmont.org/blog/content/cacti-rabbitmq-host-template-with-graph-templates-and-gathering-script
>
> I only created them as I could not find any online and I still use cacti
> all over the place :)
>
> 1. If you know how to get stats over AMQP that would be even better as i
> would not need to run the cron. Is there some built-in stats reporting
> over AMQP giving rabbitmqctl list/stats features?

Not really, base AMQP just lets you get some very basic stats (number of 
messages, number of consumers) per queue in the queue.declare-ok method.

Gavin M Roy has started an unofficial plugin which broadcasts management 
info over AMQP:

https://github.com/gmr/rabbitmq-pulse

> 2. I also wanted to get some more stats but could not find a way to get
> them, is there way to get these:
> - avg message age (how much time does it take on avg for message to get
> from publisher to consumer

You can estimate this with (queue length) / (ack rate). But this is of 
course an estimate, not historical data.

> - total bytes sent/read per vhost or per node (value is available per
> channel but it can not be summarised to give stable graph)
> - total messages published/consumed (i can get depth of the queue but  i
> dont know how many messages passed through the system)
> - total connections opened (same as above, in case of clients connecting
> and disconnecting very fast i wont see the velocity as i can only see
> the current connections count)

Yeah, all these are reasonable things to want, and are on the list for 
the next time we revisit management statistics.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From emamdouh at cloud9ers.com  Mon Oct 29 20:38:44 2012
From: emamdouh at cloud9ers.com (Eslam Mamdouh El Husseiny)
Date: Mon, 29 Oct 2012 22:38:44 +0200
Subject: [rabbitmq-discuss] can't start rabbitmq-server
Message-ID: <CAHAaT5u1eO3DcY5ZTa6UJe0bwUg2ep43AbtdopbYn5nWXjTHUA@mail.gmail.com>

Hi All,
i have a problem with rabbitmq 2.7.8-1
it suddenly crashes and i can't start it till i reboot server which isn't
always accepted in production servers
startup_log file :

{error_logger,{{2012,10,29},{22,31,2}},"Protocol: ~p: register error:
> ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>
> {error_logger,{{2012,10,29},{22,31,2}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.87>,<0.16.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,518}],[]]}
>
> {error_logger,{{2012,10,29},{22,31,2}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch5267,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>
> {error_logger,{{2012,10,29},{22,31,2}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>
> {error_logger,{{2012,10,29},{22,31,2}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
> {"Kernel pid
> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>

startup_error file :

> Crash dump was written to: erl_crash.dump
> Kernel pid terminated (application_controller)
> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})


any ideas regarding this issue
Thanks in advance

-- 
Best Regards,
Eslam Mamdouh El Husseiny
*Systems Administrator**
Cloud Niners Ltd.

*
*Cellular: (+2) 011 198 40 40
Mansoura: (+2) 050 234 70 81
Cairo:    (+2) 022 *268 34 60
Fax:      (+2) 022 268 34 63
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/5c920b8e/attachment.htm>

From videlalvaro at gmail.com  Mon Oct 29 20:43:06 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 29 Oct 2012 21:43:06 +0100
Subject: [rabbitmq-discuss] can't start rabbitmq-server
In-Reply-To: <CAHAaT5u1eO3DcY5ZTa6UJe0bwUg2ep43AbtdopbYn5nWXjTHUA@mail.gmail.com>
References: <CAHAaT5u1eO3DcY5ZTa6UJe0bwUg2ep43AbtdopbYn5nWXjTHUA@mail.gmail.com>
Message-ID: <CAMcAHLWAUucjcyHGmfzush0S4EEAEbp2GwJeZORyA_iwxU4PiQ@mail.gmail.com>

Can you check that you don't have another server running in the same port
as RabbitMQ, it's even possible that RabbitMQ is already running there.

On Mon, Oct 29, 2012 at 9:38 PM, Eslam Mamdouh El Husseiny <
emamdouh at cloud9ers.com> wrote:

> Hi All,
> i have a problem with rabbitmq 2.7.8-1
> it suddenly crashes and i can't start it till i reboot server which isn't
> always accepted in production servers
> startup_log file :
>
> {error_logger,{{2012,10,29},{22,31,2}},"Protocol: ~p: register error:
>> ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>>
>> {error_logger,{{2012,10,29},{22,31,2}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.87>,<0.16.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,518}],[]]}
>>
>> {error_logger,{{2012,10,29},{22,31,2}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch5267,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>>
>> {error_logger,{{2012,10,29},{22,31,2}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>>
>> {error_logger,{{2012,10,29},{22,31,2}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>> {"Kernel pid
>> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>
>
> startup_error file :
>
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller)
>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>
>
> any ideas regarding this issue
> Thanks in advance
>
> --
> Best Regards,
> Eslam Mamdouh El Husseiny
> *Systems Administrator**
> Cloud Niners Ltd.
>
> *
> *Cellular: (+2) 011 198 40 40
> Mansoura: (+2) 050 234 70 81
> Cairo:    (+2) 022 *268 34 60
> Fax:      (+2) 022 268 34 63
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/1105f2ba/attachment.htm>

From static.void.dev at gmail.com  Mon Oct 29 20:59:51 2012
From: static.void.dev at gmail.com (Mark)
Date: Mon, 29 Oct 2012 13:59:51 -0700
Subject: [rabbitmq-discuss] AMQP-RPC vs REST
Message-ID: <6BCA7C48-4C2F-4A89-8D36-7217DD3C75BD@gmail.com>

It seems to me that AMQP-RPC may be a bit overkill these days when when one could simply use REST and JSON. Thoughts?

From rtrlists at googlemail.com  Mon Oct 29 21:03:02 2012
From: rtrlists at googlemail.com (Robert Raschke)
Date: Mon, 29 Oct 2012 21:03:02 +0000
Subject: [rabbitmq-discuss] can't start rabbitmq-server
In-Reply-To: <CAHAaT5u1eO3DcY5ZTa6UJe0bwUg2ep43AbtdopbYn5nWXjTHUA@mail.gmail.com>
References: <CAHAaT5u1eO3DcY5ZTa6UJe0bwUg2ep43AbtdopbYn5nWXjTHUA@mail.gmail.com>
Message-ID: <CAH+xwdD7q0UVejP9HHhCBMspkO2X6dAn44qTXh6Qm0r2jSztTg@mail.gmail.com>

It looks as if epmd could not be contacted. The Erlang Port Mapper Daemon
is a separate executable and supports Erlang's distribution facilities. No
idea why RabbitMQ might have difficulty starting or contracting the local
epmd.

Robby
 On Oct 29, 2012 8:40 PM, "Eslam Mamdouh El Husseiny" <
emamdouh at cloud9ers.com> wrote:

> Hi All,
> i have a problem with rabbitmq 2.7.8-1
> it suddenly crashes and i can't start it till i reboot server which isn't
> always accepted in production servers
> startup_log file :
>
> {error_logger,{{2012,10,29},{22,31,2}},"Protocol: ~p: register error:
>> ~p~n",["inet_tcp",{{badmatch,{error,epmd_close}},[{inet_tcp_dist,listen,1},{net_kernel,start_protos,4},{net_kernel,start_protos,3},{net_kernel,init_node,2},{net_kernel,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}]}
>>
>> {error_logger,{{2012,10,29},{22,31,2}},crash_report,[[{initial_call,{net_kernel,init,['Argument__1']}},{pid,<0.19.0>},{registered_name,[]},{error_info,{exit,{error,badarg},[{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[#Port<0.87>,<0.16.0>]},{dictionary,[{longnames,false}]},{trap_exit,true},{status,running},{heap_size,377},{stack_size,24},{reductions,518}],[]]}
>>
>> {error_logger,{{2012,10,29},{22,31,2}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{'EXIT',nodistribution}},{offender,[{pid,undefined},{name,net_kernel},{mfargs,{net_kernel,start_link,[[rabbitmqprelaunch5267,shortnames]]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
>>
>> {error_logger,{{2012,10,29},{22,31,2}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
>>
>> {error_logger,{{2012,10,29},{22,31,2}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
>> {"Kernel pid
>> terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}
>>
>
> startup_error file :
>
>> Crash dump was written to: erl_crash.dump
>> Kernel pid terminated (application_controller)
>> ({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})
>
>
> any ideas regarding this issue
> Thanks in advance
>
> --
> Best Regards,
> Eslam Mamdouh El Husseiny
> *Systems Administrator**
> Cloud Niners Ltd.
>
> *
> *Cellular: (+2) 011 198 40 40
> Mansoura: (+2) 050 234 70 81
> Cairo:    (+2) 022 *268 34 60
> Fax:      (+2) 022 268 34 63
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/94a26131/attachment.htm>

From alexis at rabbitmq.com  Mon Oct 29 22:29:25 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 29 Oct 2012 22:29:25 +0000
Subject: [rabbitmq-discuss] AMQP-RPC vs REST
In-Reply-To: <6BCA7C48-4C2F-4A89-8D36-7217DD3C75BD@gmail.com>
References: <6BCA7C48-4C2F-4A89-8D36-7217DD3C75BD@gmail.com>
Message-ID: <CACOPnvco64FRG=GFUcZ0uBRuMKJMvr4T7nTreq2v7pE7Uz=HCw@mail.gmail.com>

On Mon, Oct 29, 2012 at 8:59 PM, Mark <static.void.dev at gmail.com> wrote:
> It seems to me that AMQP-RPC may be a bit overkill these days when when one could simply use REST and JSON. Thoughts?

Not sure what you mean?

From static.void.dev at gmail.com  Mon Oct 29 22:42:38 2012
From: static.void.dev at gmail.com (Mark)
Date: Mon, 29 Oct 2012 15:42:38 -0700
Subject: [rabbitmq-discuss] AMQP-RPC vs REST
In-Reply-To: <CACOPnvco64FRG=GFUcZ0uBRuMKJMvr4T7nTreq2v7pE7Uz=HCw@mail.gmail.com>
References: <6BCA7C48-4C2F-4A89-8D36-7217DD3C75BD@gmail.com>
	<CACOPnvco64FRG=GFUcZ0uBRuMKJMvr4T7nTreq2v7pE7Uz=HCw@mail.gmail.com>
Message-ID: <2402C987-BA1A-479D-A4FB-C209BB7F0C7C@gmail.com>

For messaging and asych processing AMQP seeming to fit really well. For sync processing though it seems like using simple HTTP to a RESTful service would be easier than RPC over AMQP (http://www.rabbitmq.com/tutorials/tutorial-six-python.html) Just wondering how many of you out there are using AMQP when it comes to RPC and/or connecting services.

On Oct 29, 2012, at 3:29 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:

> On Mon, Oct 29, 2012 at 8:59 PM, Mark <static.void.dev at gmail.com> wrote:
>> It seems to me that AMQP-RPC may be a bit overkill these days when when one could simply use REST and JSON. Thoughts?
> 
> Not sure what you mean?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/4aff6be2/attachment.htm>

From alexis at rabbitmq.com  Mon Oct 29 23:09:42 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Mon, 29 Oct 2012 23:09:42 +0000
Subject: [rabbitmq-discuss] AMQP-RPC vs REST
In-Reply-To: <2402C987-BA1A-479D-A4FB-C209BB7F0C7C@gmail.com>
References: <6BCA7C48-4C2F-4A89-8D36-7217DD3C75BD@gmail.com>
	<CACOPnvco64FRG=GFUcZ0uBRuMKJMvr4T7nTreq2v7pE7Uz=HCw@mail.gmail.com>
	<2402C987-BA1A-479D-A4FB-C209BB7F0C7C@gmail.com>
Message-ID: <CACOPnveGGYfRmKUASXCw0C30b1K6_-hwOqa_mOr9s=XgO=xhCQ@mail.gmail.com>

On Mon, Oct 29, 2012 at 10:42 PM, Mark <static.void.dev at gmail.com> wrote:
> For messaging and asych processing AMQP seeming to fit really well. For sync
> processing though it seems like using simple HTTP to a RESTful service would
> be easier than RPC over AMQP

"It depends" :-)

I don't think you can use words like "simple" without qualifying them
by a use case.

What if the backend service doesn't expose HTTP, or does not benefit
from direct access by clients?





> (http://www.rabbitmq.com/tutorials/tutorial-six-python.html) Just wondering
> how many of you out there are using AMQP when it comes to RPC and/or
> connecting services.
>
> On Oct 29, 2012, at 3:29 PM, Alexis Richardson <alexis at rabbitmq.com> wrote:
>
> On Mon, Oct 29, 2012 at 8:59 PM, Mark <static.void.dev at gmail.com> wrote:
>
> It seems to me that AMQP-RPC may be a bit overkill these days when when one
> could simply use REST and JSON. Thoughts?
>
>
> Not sure what you mean?
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From Michael.Laing at nytimes.com  Tue Oct 30 00:28:43 2012
From: Michael.Laing at nytimes.com (Laing, Michael P.)
Date: Mon, 29 Oct 2012 20:28:43 -0400
Subject: [rabbitmq-discuss] AMQP-RPC vs REST
In-Reply-To: <CACOPnveGGYfRmKUASXCw0C30b1K6_-hwOqa_mOr9s=XgO=xhCQ@mail.gmail.com>
Message-ID: <CCB49247.5994%Michael.Laing@nytimes.com>

We use RPC a lot - async of course.

Though as our services get more reliable we are chaining together message
'pipelines' and re-routing/handling the few exceptions instead.

Our new stuff is http-free, actually. Websockets to the client; amqp (and
some zmq) otherwise. Plus s3 and DynamoDB and other AWS services.

OK... initial connection is http but then we upgrade.

Michael Laing

On 10/29/12 7:09 PM, "Alexis Richardson" <alexis at rabbitmq.com> wrote:

>On Mon, Oct 29, 2012 at 10:42 PM, Mark <static.void.dev at gmail.com> wrote:
>> For messaging and asych processing AMQP seeming to fit really well. For
>>sync
>> processing though it seems like using simple HTTP to a RESTful service
>>would
>> be easier than RPC over AMQP
>
>"It depends" :-)
>
>I don't think you can use words like "simple" without qualifying them
>by a use case.
>
>What if the backend service doesn't expose HTTP, or does not benefit
>from direct access by clients?
>
>
>
>
>
>> (http://www.rabbitmq.com/tutorials/tutorial-six-python.html) Just
>>wondering
>> how many of you out there are using AMQP when it comes to RPC and/or
>> connecting services.
>>
>> On Oct 29, 2012, at 3:29 PM, Alexis Richardson <alexis at rabbitmq.com>
>>wrote:
>>
>> On Mon, Oct 29, 2012 at 8:59 PM, Mark <static.void.dev at gmail.com> wrote:
>>
>> It seems to me that AMQP-RPC may be a bit overkill these days when when
>>one
>> could simply use REST and JSON. Thoughts?
>>
>>
>> Not sure what you mean?
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>_______________________________________________
>rabbitmq-discuss mailing list
>rabbitmq-discuss at lists.rabbitmq.com
>https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From gmr at meetme.com  Tue Oct 30 02:43:51 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Mon, 29 Oct 2012 22:43:51 -0400
Subject: [rabbitmq-discuss] pika 0.9.6 Released
Message-ID: <CAKwdTWfb-1iS+wiGx3JNWNQL8kbBb1Vqz_DdAzvm=hSg5U+dcQ@mail.gmail.com>

After way too much time and way too many patches, I've tagged and pika
0.9.6 and pushed it to pypi. pika 0.9.6 has had over 700 commits from 37
contributors and has significant fixes and improvements since 0.9.5. I'd
like to thank all the contributors who helped get it here and apologize for
the long delay in release. Due to the size of the change, I expect there
may be incompatibilities with 0.9.5, so I advise testing with your code
prior to updating production applications.

New features and highlights:

  - Delivery confirmation support
  - New URLParameters class for connecting with AMQP URLs
  - BlockingConnection will raise exceptions for various events, such as
channel and connection closures.
  - New BlockingConnection methods:
    - process_data_events() - Force BlockingConnection to check for pending
events from RabbitMQ
    - sleep() - Sleep without blocking communication with RabbitMQ
  - New BlockingChannel methods:
    - start_consuming()
    - stop_consuming()
  - Back-pressure detection is now optional via a connection parameter
  - Configurable IOLoop stopping on asynchronous adapters
  - Rewritten unit test coverage from the ground up. While not complete, it
is a significant improvement over previous releases.

Major bugfix areas:

  - Connection handling
  - Blocking functionality in the BlockingConnection
  - SSL
  - UTF-8 Handling

Things removed:

  - pika.reconnection_strategies
  - pika.channel.ChannelTransport
  - pika.log
  - pika.template
  - examples directory, adding examples to documentation instead.
  - functional tests

Pika's documentation has moved to http://pika.readthedocs.org and can be
installed via pip or easy_install.

On pika's future: 0.9.7 is underway and will add back the contributed
Twisted adapter and add a new generator based Basic.Consume method to the
BlockingChannel. In addition, I may extract out pika.spec and the frame
encoding and decoding routines for pamqp (http://github.com/pika/pamqp).
Pika 0.9.7 will hopefully be one of the last 0.9 releases prior to 1.0.

On a side note, in preparation for Python 3 compatibility, I'd like to drop
older versions of Python moving forward. If you're using Pika with anything
below Python 2.6, please respond to me off list or on the Pika list at
pika-python at googlegroups.com.

Bugs can be submitted to https://github.com/pika/pika/issues and while I
may not respond right away, I can be found in #pika on Freenode.

Cheers,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/6100338e/attachment.htm>

From matthias at rabbitmq.com  Tue Oct 30 07:41:05 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 30 Oct 2012 07:41:05 +0000
Subject: [rabbitmq-discuss] Pika doesnt timeout soon if IP address is
 not reachable
In-Reply-To: <CAEMO9cAU0NYhNxkcZBrt_kh+vm6YCYnJ+Hivs8Xu5crnBpLrUA@mail.gmail.com>
References: <CAEMO9cAU0NYhNxkcZBrt_kh+vm6YCYnJ+Hivs8Xu5crnBpLrUA@mail.gmail.com>
Message-ID: <508F8491.2050303@rabbitmq.com>

Bhaskar,

On 24/10/12 12:57, Bhaskar teja wrote:
> The problem we face is, if the IP address config is wrong or host OS
> where rabbitmq is down, the connection attempt to rabbitmq fails with
> huge timeout(>30 seconds).
> Basically what we want is the connection attempt should timeout within 1
> or 2 seconds regardless of success or failure.
> Is there any way we can do that?

I suggest you ask on the pika list - 
https://groups.google.com/forum/#!forum/pika-python


Regards,

Matthias.

From olda.esner at gmail.com  Tue Oct 30 04:27:05 2012
From: olda.esner at gmail.com (=?UTF-8?Q?Olda_E=C5=A1ner?=)
Date: Mon, 29 Oct 2012 21:27:05 -0700 (PDT)
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
 Plugin
In-Reply-To: <CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
Message-ID: <9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>

Hi Tony,

after upgrading to RabbitMQ 2.8.6 from 2.8.5, presence-exchange plugin 
doesn't work. Is there any chance to fix it?

Thank you,

Oldrich

Dne p?tek, 3. ?nora 2012 5:12:14 UTC-8 Tony Garnock-Jones napsal(a):
>
> On 3 February 2012 06:09, Emile Joubert <em... at rabbitmq.com <javascript:>>wrote:
>
>> On 03/02/12 09:35, Liuzhuofu wrote:
>> > 1. What's the behavier of "x-presence" like? direct, fanout or topic?
>> None of those: the presence exchange is a different kind of exchange
>> that drops messages that are published to it. Instead it generates
>> messages when queues bind and unbind.
>>
>
> There's also more detailed discussion of this in the README, 
> https://github.com/tonyg/presence-exchange#readme.
>  
>
>> > 2. One "x-presence" exchange can only get the event that the binding
>> > changes on this exchanges, other bindings on other exchanges, it can not
>> > monitor, am I right?
>> It only produces notifications of binding on the local exchange, not
>> other exchanges.
>>
>
> For the avoidance of doubt, this should get you to where you need to be: 
> clients, when they connect, should bind a temporary (autodelete) queue to a 
> distinguished presence exchange for your application. If they crash, suffer 
> heartbeat failure, or otherwise disconnect, the temporary queue will be 
> deleted, and as a consequence the binding to the presence exchange will be 
> removed, the fact of which will then be broadcast to the presence listeners 
> attached to that exchange.
>
> Regards,
>   Tony
> -- 
> Tony Garnock-Jones
> tonygarn... at gmail.com <javascript:>
> http://homepages.kcbbs.gen.nz/tonyg/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121029/90f5c585/attachment.htm>

From matthias at rabbitmq.com  Tue Oct 30 07:48:37 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 30 Oct 2012 07:48:37 +0000
Subject: [rabbitmq-discuss] Validity of /api/aliveness-test in a
 clustered environment
In-Reply-To: <CACLE7ixw+Cznc7Pg_es3Axbp5vv884hOb4i_QZy2gafd9qrzFQ@mail.gmail.com>
References: <CACLE7izef-nB9T_BXAx08KG6m7+=SESB9ozDY+8NDZR4a5ENxA@mail.gmail.com>
	<508A6B58.6010307@rabbitmq.com>
	<CACLE7ixw+Cznc7Pg_es3Axbp5vv884hOb4i_QZy2gafd9qrzFQ@mail.gmail.com>
Message-ID: <508F8655.5060505@rabbitmq.com>

Matt,

On 26/10/12 21:18, Matt Pietrek wrote:
> Just to make sure I understand fully, does the problem scenario I
> described actually occur?
>
> That is, if the aliveness-test queue lives on mq1 and mq1 is
> unresponsive, and I then hit the mq2 broker with an /api/aliveness -test
> request, you'd expect that request to either time out or take a long time?

Yes - as long as mq1 still is (barely) alive; if it's down then a fresh 
queue will be created on mq2.

Regards,

Matthias.

From gsim at redhat.com  Tue Oct 30 09:15:29 2012
From: gsim at redhat.com (Gordon Sim)
Date: Tue, 30 Oct 2012 09:15:29 +0000
Subject: [rabbitmq-discuss] AMQP-RPC vs REST
In-Reply-To: <CACOPnveGGYfRmKUASXCw0C30b1K6_-hwOqa_mOr9s=XgO=xhCQ@mail.gmail.com>
References: <6BCA7C48-4C2F-4A89-8D36-7217DD3C75BD@gmail.com>
	<CACOPnvco64FRG=GFUcZ0uBRuMKJMvr4T7nTreq2v7pE7Uz=HCw@mail.gmail.com>
	<2402C987-BA1A-479D-A4FB-C209BB7F0C7C@gmail.com>
	<CACOPnveGGYfRmKUASXCw0C30b1K6_-hwOqa_mOr9s=XgO=xhCQ@mail.gmail.com>
Message-ID: <508F9AB1.90804@redhat.com>

On 10/29/2012 11:09 PM, Alexis Richardson wrote:
> On Mon, Oct 29, 2012 at 10:42 PM, Mark <static.void.dev at gmail.com> wrote:
>> For messaging and asych processing AMQP seeming to fit really well. For sync
>> processing though it seems like using simple HTTP to a RESTful service would
>> be easier than RPC over AMQP
>
> "It depends" :-)

Yes, it always does!

While I would think many cases would indeed be best implemented as 
RESTful services, especially where a 'resource oriented' view of the 
system felt natural, I myself would do so not because it is easier (I 
don't think it really is) but for the sake of uniformity.

One benefit of using AMQP even for a strict client-server, 
request-response style conversation, is that it makes it easy to 
introduce intermediaries to process/adapt the request and/or the 
response as the system evolves. You can also easily add in specialised 
processing for different classes of request.

Of course there is nothing that prevents you doing similar things with 
HTTP also, but in my opinion a brokered solution actually makes it 
easier; the available infrastructure does more of the hard work already.

Long running requests also fit quite well with the notion of explicit 
queuing, though again, I'm not implying that they can't be handled with 
HTTP.

This is all just a long-winded way of repeating what Alexis says above 
though!

From terance at socialtwist.com  Tue Oct 30 10:19:44 2012
From: terance at socialtwist.com (Terance Dias)
Date: Tue, 30 Oct 2012 15:49:44 +0530
Subject: [rabbitmq-discuss] backup and fail-over to remote disaster
 recovery site
In-Reply-To: <50814EE9.4020004@rabbitmq.com>
References: <1350647293415-22706.post@n5.nabble.com>
	<50814EE9.4020004@rabbitmq.com>
Message-ID: <CAK76X7RsZL6d4JekXRjVZ_f_R14hmsoj5NGARv_DEPXMR+0s1g@mail.gmail.com>

Thanks for your reply Simon.

Is it possible to use MySQL for persistence of messages in RabbitMQ and
then use the Master-Slave replication that MySQL provides to replicate the
data at the remote site? Are there any performance numbers for this kind of
configuration?

Thanks,
Terance.

On Fri, Oct 19, 2012 at 6:30 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 19/10/12 12:48, Terance wrote:
>
>> We want to set up RabbitMQ such that the current state of the broker is
>> backed up at a remote disaster recovery site at real time. We also want
>> our
>> clients (producers and consumers) to fail-over to this remote broker in
>> case
>> the main broker becomes unreachable for some reason. I was looking at the
>> Distributed broker approaches supported by RabbitMQ at
>> http://www.rabbitmq.com/**distributed.html<http://www.rabbitmq.com/distributed.html>but I'm not sure If what we are
>> looking for can be achieved. Please let me know if you know how to do
>> this.
>>
>
> Hi. Interesting question. Some thoughts:
>
> CAP theorem tells us you're not going to get a transparent solution to
> this problem. If it's remote you need to be partition-tolerant, and you
> almost certainly want to be available too. So consistency has to go. That
> rules out clustering.
>
> So you could use the shovel or federation to get messages published from
> your main site to your recovery site. That's fairly easy (assuming your
> broker definitions are not too dynamic); what is harder is ensuring that
> messages are consumed from the recovery site in some sort of correlation
> with them being consumed at the main site. There's nothing built in to
> Rabbit which can do that.
>
> There are some possibilities which may or may not work for you. You could
> federate / shovel into queues with a message TTL at the remote site to
> bound the amount of data you hold - but at failover you could have a lot of
> duplicate messages to work through, and if your main site queues back up
> enough, messages could be expired at the remote site when they have not
> been processed at the main site.
>
> Possibly the most plausible solution is to synchronise the mnesia
> directory from main to remote and only boot the remote broker on failover.
> This stands a decent chance of recovering your persistent messages of
> failure; but keeping the filesystems reliably in sync is its own challenge.
> And we don't guarantee to recover everything after (the equivalent of) an
> unclean shutdown.
>
> Hmm, you've got me thinking about replication now...
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/c8e13752/attachment.htm>

From rasmus.d.johansson at gmail.com  Tue Oct 30 10:06:08 2012
From: rasmus.d.johansson at gmail.com (Rasmus Johansson)
Date: Tue, 30 Oct 2012 03:06:08 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ routing key topology
Message-ID: <443c7100-6ed8-4bdd-8c49-058c49c63101@googlegroups.com>

Hello,

Say that I have an exchange routing animals to different queues, like: 
queue-dog, queue-horse etc.
And there are some leftovers. Is there a way to tell the route key in the 
web-interface of RabbitMQ to route "not"-dog, "not"-horse etc? Ie 
everything else.


Regards,
R
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/11ae2119/attachment.htm>

From tim at rabbitmq.com  Tue Oct 30 10:29:46 2012
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 30 Oct 2012 10:29:46 +0000
Subject: [rabbitmq-discuss] can't start rabbitmq-server
In-Reply-To: <CAH+xwdD7q0UVejP9HHhCBMspkO2X6dAn44qTXh6Qm0r2jSztTg@mail.gmail.com>
References: <CAHAaT5u1eO3DcY5ZTa6UJe0bwUg2ep43AbtdopbYn5nWXjTHUA@mail.gmail.com>
	<CAH+xwdD7q0UVejP9HHhCBMspkO2X6dAn44qTXh6Qm0r2jSztTg@mail.gmail.com>
Message-ID: <EB21511F-D553-4690-B975-996C899C749D@rabbitmq.com>


On 29 Oct 2012, at 21:03, Robert Raschke wrote:

> It looks as if epmd could not be contacted. The Erlang Port Mapper Daemon is a separate executable and supports Erlang's distribution facilities. No idea why RabbitMQ might have difficulty starting or contracting the local epmd.
> 

Firewall, blocked ports, etc?


From simon at rabbitmq.com  Tue Oct 30 10:31:00 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Oct 2012 10:31:00 +0000
Subject: [rabbitmq-discuss] RabbitMQ routing key topology
In-Reply-To: <443c7100-6ed8-4bdd-8c49-058c49c63101@googlegroups.com>
References: <443c7100-6ed8-4bdd-8c49-058c49c63101@googlegroups.com>
Message-ID: <508FAC64.2030603@rabbitmq.com>

On 30/10/12 10:06, Rasmus Johansson wrote:
> Say that I have an exchange routing animals to different queues, like:
> queue-dog, queue-horse etc.
> And there are some leftovers. Is there a way to tell the route key in
> the web-interface of RabbitMQ to route "not"-dog, "not"-horse etc? Ie
> everything else.

Yes, set the alternate-exchange argument, see 
http://www.rabbitmq.com/ae.html

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From lars.ellebo at schneider-electric.com  Tue Oct 30 10:41:38 2012
From: lars.ellebo at schneider-electric.com (Lars Ellebo)
Date: Tue, 30 Oct 2012 03:41:38 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ Client recommendations
Message-ID: <1351593698046-22959.post@n5.nabble.com>

Hello there

We are currently building a Device running an embedded Java-application.
This Device will contain a RabbitMQ-Client which is supposed to connect to a
RabbitMQ-Server v.2.7.1.

So my question is:
What RabbitMQ-Client would you recommend to embed in the Device, v.2.7.1
(same as server) or v.2.8.7 (the newest)?

The RabbitMQ-Client v.2.8.7 will hopefully be the most stable and best
performing, but is it fully compatible with RabbitMQ-Server v.2.7.1, or
should we rather stick to the RabbitMQ-Client v.2.7.1 compatible with the
RabbitMQ-Server?

Please advise.

/Lars Ellebo




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-Client-recommendations-tp22959.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Tue Oct 30 10:53:35 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Oct 2012 10:53:35 +0000
Subject: [rabbitmq-discuss] rabbitmqadmin and default node behaviour
In-Reply-To: <20121029160441.GI426@kaka.it.su.se>
References: <20121019100118.GB1210@kaka.it.su.se>
	<508149DB.7010701@rabbitmq.com>
	<20121029160441.GI426@kaka.it.su.se>
Message-ID: <508FB1AF.8060003@rabbitmq.com>

On 29/10/12 16:04, Simon Lundstr?m wrote:
> So, my new suggestion is:
>
> Parse the config/defaults in this order:
> # defaults from default_options hash^Wdictionary
> # config file, one of:
> ## specified via --config
> ### Use it and exit with an error if:
> #### File doesn't exist
> #### Node in config doesn't exist (default being default node or the one
> specified via --node)
> ## default config file (~/.rabbitmqadmin.conf)
> ### If file doesn't exist, just ignore it.
> ### If file exists and node in file doesn't exist
> #### exit showing that error message

Does this mean rabbitmqadmin will fail if the default file exists, and 
the user does not specify a node, and the file does not contain a 
default node? That seems wrong.

Other than that this sounds reasonable.

> # Options on the command line
>
> This would also overwrite any options (last parsed "wins").

Yes.

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From simlu at su.se  Tue Oct 30 11:01:01 2012
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Tue, 30 Oct 2012 12:01:01 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin and default node behaviour
In-Reply-To: <508FB1AF.8060003@rabbitmq.com>
References: <20121019100118.GB1210@kaka.it.su.se>
	<508149DB.7010701@rabbitmq.com>
	<20121029160441.GI426@kaka.it.su.se>
	<508FB1AF.8060003@rabbitmq.com>
Message-ID: <20121030110101.GK426@kaka.it.su.se>

On Tue, 2012-10-30 at 10:53:35 +0000, Simon MacMullen wrote:
> On 29/10/12 16:04, Simon Lundstr?m wrote:
> >So, my new suggestion is:
> >
> >Parse the config/defaults in this order:
> ># defaults from default_options hash^Wdictionary
> ># config file, one of:
> >## specified via --config
> >### Use it and exit with an error if:
> >#### File doesn't exist
> >#### Node in config doesn't exist (default being default node or the one
> >specified via --node)
> >## default config file (~/.rabbitmqadmin.conf)
> >### If file doesn't exist, just ignore it.
> >### If file exists and node in file doesn't exist
> >#### exit showing that error message
> 
> Does this mean rabbitmqadmin will fail if the default file exists,
> and the user does not specify a node, and the file does not contain
> a default node?

Exactly.

This is a small price to pay, IMO, compared to always having to specify
either the node or a config file.

> That seems wrong.

How would you propose it should work? The only solutions I can come up
with is the one that currently exists and the one that I propose.

Thanks,
- Simon

From simon at rabbitmq.com  Tue Oct 30 11:10:23 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Oct 2012 11:10:23 +0000
Subject: [rabbitmq-discuss] rabbitmqadmin and default node behaviour
In-Reply-To: <20121030110101.GK426@kaka.it.su.se>
References: <20121019100118.GB1210@kaka.it.su.se>
	<508149DB.7010701@rabbitmq.com>
	<20121029160441.GI426@kaka.it.su.se>
	<508FB1AF.8060003@rabbitmq.com>
	<20121030110101.GK426@kaka.it.su.se>
Message-ID: <508FB59F.9030807@rabbitmq.com>

On 30/10/12 11:01, Simon Lundstr?m wrote:
>> >Does this mean rabbitmqadmin will fail if the default file exists,
>> >and the user does not specify a node, and the file does not contain
>> >a default node?
> Exactly.
>
> This is a small price to pay, IMO, compared to always having to specify
> either the node or a config file.

Surely we can decide what to do in this scenario based on whether the 
config file contains a default node. If it does, use it. If it doesn't, 
use the defaults (guest / guest / localhost).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Tue Oct 30 11:13:03 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Oct 2012 11:13:03 +0000
Subject: [rabbitmq-discuss] Statistics database could not be contacted.
In-Reply-To: <CAO4q6_9SXhWLr-rnT699qTBmT0jah+QC+00+paRAuioDuPxatQ@mail.gmail.com>
References: <CAO4q6__z_i2=La0z9BGJiP5kh9ubXCm5eGmpWc91BnRN=j1NMA@mail.gmail.com>
	<508AB7EE.8070507@rabbitmq.com>
	<CAO4q6_9SXhWLr-rnT699qTBmT0jah+QC+00+paRAuioDuPxatQ@mail.gmail.com>
Message-ID: <508FB63F.4000604@rabbitmq.com>

On 29/10/12 17:36, Farshad Meshkinpour wrote:
> Hi Simon,
> We got 3 nodes in a cluster.  We upgraded one of data center switches on
> Wed night.  The rabbit log indicates loss of connectivity for a short
> time.  After that the node with stats says the other two nodes are down.
>   The other 2 nodes complaints that they couldn't access stats database!
>
> I tried to restart the node with stats database, but it wouldn't start &
> I had to disable management plugin in order to bring the node up.
> I tried to restart one of the other nodes and it wouldn't start unless
> disabling management plugin.
> Then after a day of trying various changed we enabled management-agent
> plugins and each node management came up.
>
> So, what is the recommended procedure and best practices in this situation?

Firstly, upgrade to 2.8.7 since there was a bug in mgmt database 
failover in earlier versions.

> Also, from time-to-time we have to maintain the switches & routers which
> may interrupt the connectivity.  Is there a best practice to plan ahead
> to avoid this type of issues?

RabbitMQ clustering does not tolerate network partitions well. If you 
are planning on causing a network partition, take down all the bits of 
the cluster that will be partitioned first.

Cheers, Simon

>
> Thanks,
> Farshad
>
>
>
>
>
>
> On Fri, Oct 26, 2012 at 9:18 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     On 25/10/12 20:03, Farshad Meshkinpour wrote:
>
>         I am running RMQ 2.8.6 in a three node cluster.  The first
>         rabbit node
>         that had statistics database went down.   I had to disable
>         management-plug to restart the node.
>
>         How do I get statistics database restarted?
>
>
>     It should restart automatically. However, there was a bug, fixed in
>     2.8.7, in which it could fail to fail over correctly when the node
>     it was originally running on went down. Is this what happened to
>     you? I'm not sure I fully understand your message.
>
>     Cheers, Simon
>
>     --
>     Simon MacMullen
>     RabbitMQ, VMware
>
>


-- 
Simon MacMullen
RabbitMQ, VMware

From simlu at su.se  Tue Oct 30 12:12:29 2012
From: simlu at su.se (Simon =?iso-8859-1?Q?Lundstr=F6m?=)
Date: Tue, 30 Oct 2012 13:12:29 +0100
Subject: [rabbitmq-discuss] rabbitmqadmin and default node behaviour
In-Reply-To: <508FB59F.9030807@rabbitmq.com>
References: <20121019100118.GB1210@kaka.it.su.se>
	<508149DB.7010701@rabbitmq.com>
	<20121029160441.GI426@kaka.it.su.se>
	<508FB1AF.8060003@rabbitmq.com>
	<20121030110101.GK426@kaka.it.su.se>
	<508FB59F.9030807@rabbitmq.com>
Message-ID: <20121030121229.GM426@kaka.it.su.se>

On Tue, 2012-10-30 at 11:10:23 +0000, Simon MacMullen wrote:
> On 30/10/12 11:01, Simon Lundstr?m wrote:
> >>>Does this mean rabbitmqadmin will fail if the default file exists,
> >>>and the user does not specify a node, and the file does not contain
> >>>a default node?
> >Exactly.
> >
> >This is a small price to pay, IMO, compared to always having to specify
> >either the node or a config file.
> 
> Surely we can decide what to do in this scenario based on whether
> the config file contains a default node. If it does, use it. If it
> doesn't, use the defaults (guest / guest / localhost).

And this is why you work on RabbitMQ and not me = )
Smart! So basically:

Parse the config/defaults in this order:
# defaults from default_options hash^Wdictionary
# config file
## Find out which config file to use, one of:
### specified via --config
#### Use it and exit with an error if it doesn't exist
### default config file (~/.rabbitmqadmin.conf)
#### If file doesn't exist, just ignore it.
## If node doesn't exist in config and is:
### specified via commandline
#### Display error and exit
### using the default node
#### ignore the config file entirely
# Options on the command line

Thanks,
- Simon

From ward.mark at gmail.com  Tue Oct 30 14:07:02 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 30 Oct 2012 07:07:02 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ C# Client - Dispose() hangs
In-Reply-To: <bbf304ec-ffec-4dac-bf52-92c44f6da214@googlegroups.com>
References: <d67e92d9-32b8-43b4-8b4d-0a153c5565e8@googlegroups.com>
	<c60d444c-272f-456f-90e0-4ed68c7f9dad@googlegroups.com>
	<4ceb93f8-a0d0-4461-9c67-a4ab576e0aa1@googlegroups.com>
	<bbf304ec-ffec-4dac-bf52-92c44f6da214@googlegroups.com>
Message-ID: <909e1198-4d34-4a54-b565-19bbc3b5f726@googlegroups.com>

I ran into this also.  This is my thread on the topic.  Heads up that the 
Google-groups rabbitmq-discuss does not get the replies made from the other 
forums like nabble.

http://rabbitmq.1065348.n5.nabble.com/IModel-Dispose-locks-if-called-during-ConnectionShutdown-event-tc22104.html

The suggestion is to not call dispose on the IModel instance during the 
ConnectionShutdown event.  I had to reword my code to track if it is being 
called in a connectionshutdown or not to know when to call dispose.

-Mark


On Saturday, October 27, 2012 11:30:13 AM UTC-5, gleb Chermennov wrote:
>
> Stumbled onto this yesterday. Is it a bug or what? Is there a suggested 
> workaround?
>
> ???????????, 27 ??????? 2012 ?., 22:48:10 UTC+4 ???????????? Micha ???????:
>>
>> Hi Derek,
>>
>> Sorry for late reply. I'm still having problems when disposing the 
>> connection. Currently the only workaround for me is to call dispose() with 
>> a timeout.
>>
>> Do you have more info about it?
>>
>> Cheers,
>>
>> Micha
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/346cd340/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Oct 30 14:18:24 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 30 Oct 2012 10:18:24 -0400
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
	Plugin
In-Reply-To: <9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
Message-ID: <CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>

On 30 October 2012 00:27, Olda E?ner <olda.esner at gmail.com> wrote:

> after upgrading to RabbitMQ 2.8.6 from 2.8.5, presence-exchange plugin
> doesn't work. Is there any chance to fix it?
>

It's a consequence of the removal from the server's core of support for
"immediate" publication. At least rabbithub and the udp-exchange will also
have to be updated. The fix should be straightforward.

I'll email again when I'm done. Shouldn't be long.

Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/2bc87730/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Oct 30 14:24:06 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 30 Oct 2012 10:24:06 -0400
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
	Plugin
In-Reply-To: <CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
Message-ID: <CAM8fPiQxihYNGtO1vnXxe6u=SfsC7RbyS2X4+ZLdMnkw61Ehig@mail.gmail.com>

On 30 October 2012 10:18, Tony Garnock-Jones <
tonygarnockjones+rabbitmq at gmail.com> wrote:

> I'll email again when I'm done. Shouldn't be long.
>

All three of presence-exchange, udp-exchange and rabbithub have been
updated to the new RabbitMQ server internal API. Try now.

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/d59f9e2d/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Oct 30 14:24:53 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 30 Oct 2012 10:24:53 -0400
Subject: [rabbitmq-discuss] Fwd: Question about RabbitMQ "Presence Exchange"
	Plugin
In-Reply-To: <CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
Message-ID: <CAM8fPiRyZLtuU2+pPzeVbv=K1xQxtsUMLHYNFTdfX5SCS2LcMg@mail.gmail.com>

Google groups fail -> reposting to the list directly.

---------- Forwarded message ----------
From: Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com>
Date: 30 October 2012 10:18
Subject: Re: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
Plugin
To: Olda E?ner <olda.esner at gmail.com>
Cc: rabbitmq-discuss at googlegroups.com, Liuzhuofu <liuzhuofu at huawei.com>,
RabbitMQ Discuss <rabbitmq-discuss at lists.rabbitmq.com>


On 30 October 2012 00:27, Olda E?ner <olda.esner at gmail.com> wrote:

> after upgrading to RabbitMQ 2.8.6 from 2.8.5, presence-exchange plugin
> doesn't work. Is there any chance to fix it?
>

It's a consequence of the removal from the server's core of support for
"immediate" publication. At least rabbithub and the udp-exchange will also
have to be updated. The fix should be straightforward.

I'll email again when I'm done. Shouldn't be long.

Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/



-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/1b160acb/attachment.htm>

From tonygarnockjones+rabbitmq at gmail.com  Tue Oct 30 14:25:04 2012
From: tonygarnockjones+rabbitmq at gmail.com (Tony Garnock-Jones)
Date: Tue, 30 Oct 2012 10:25:04 -0400
Subject: [rabbitmq-discuss] Fwd: Question about RabbitMQ "Presence Exchange"
	Plugin
In-Reply-To: <CAM8fPiQxihYNGtO1vnXxe6u=SfsC7RbyS2X4+ZLdMnkw61Ehig@mail.gmail.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
	<CAM8fPiQxihYNGtO1vnXxe6u=SfsC7RbyS2X4+ZLdMnkw61Ehig@mail.gmail.com>
Message-ID: <CAM8fPiQFPuFvOkmNRYbQstpL0rrnTUedFUOMi6H3f5SuB3JWdg@mail.gmail.com>

Google groups fail -> reposting to the list directly.

---------- Forwarded message ----------
From: Tony Garnock-Jones <tonygarnockjones+rabbitmq at gmail.com>
Date: 30 October 2012 10:24
Subject: Re: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
Plugin
To: Olda E?ner <olda.esner at gmail.com>
Cc: rabbitmq-discuss at googlegroups.com, Liuzhuofu <liuzhuofu at huawei.com>,
RabbitMQ Discuss <rabbitmq-discuss at lists.rabbitmq.com>


On 30 October 2012 10:18, Tony Garnock-Jones <
tonygarnockjones+rabbitmq at gmail.com> wrote:

> I'll email again when I'm done. Shouldn't be long.
>

All three of presence-exchange, udp-exchange and rabbithub have been
updated to the new RabbitMQ server internal API. Try now.

Regards,
  Tony
-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/



-- 
Tony Garnock-Jones
tonygarnockjones at gmail.com
http://homepages.kcbbs.gen.nz/tonyg/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/457c5cc3/attachment.htm>

From simon at rabbitmq.com  Tue Oct 30 14:29:57 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Oct 2012 14:29:57 +0000
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
 Plugin
In-Reply-To: <CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
Message-ID: <508FE465.4080408@rabbitmq.com>

On 30/10/12 14:18, Tony Garnock-Jones wrote:
> On 30 October 2012 00:27, Olda E?ner <olda.esner at gmail.com
> <mailto:olda.esner at gmail.com>> wrote:
>
>     after upgrading to RabbitMQ 2.8.6 from 2.8.5, presence-exchange
>     plugin doesn't work. Is there any chance to fix it?
>
>
> It's a consequence of the removal from the server's core of support for
> "immediate" publication. At least rabbithub and the udp-exchange will
> also have to be updated. The fix should be straightforward.

...although that's happened on default, not 2.8.6.

To the OP: you might need to get the un-updated version of the plugin 
source, and then build that against the 2.8.6 source download.

Alternatively, whatever plugin binary you created for 2.8.5 should still 
work, I don't think any APIs changed?

> I'll email again when I'm done. Shouldn't be long.

*clicks stopwatch* Six minutes, not bad :-)

Cheers, Simon


-- 
Simon MacMullen
RabbitMQ, VMware

From ward.mark at gmail.com  Tue Oct 30 14:45:21 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 30 Oct 2012 07:45:21 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster busting - shut off all nodes at the same
	time.
Message-ID: <b3c53215-74b3-4a7f-a012-385c414acd5f@googlegroups.com>

I am testing what happens when bad things happen to a RabbitMQ cluster so 
that we have an idea what to expect.  This thread is to ask about something 
unexpected.

My basic understanding of the RabbitMQ cluster is what I have read 
http://www.rabbitmq.com/ha.html and experienced in my testing.  

My testing scenario was the following.  
What happens if all cluster nodes where shut down at the same time with 
mirrored persisted data?  No clients were attached to the cluster at this 
time. 
What I was expecting is when the nodes were booted up they would all come 
back online and figure out what they needed for the master of the queue and 
not lose any data.
What I experienced was each server booted up but RabbitMQ failed to start 
on every cluster server and issued an error plus a "erl_crash.dump".  The 
cluster was dead upon start up.  Knowing that RabbitMQ needs to negotiate 
with the cluster to determine its state of the queue I prepared each server 
to start rabbitMQ.  I quickly started the RabbitMQ service on each server. 
 This allowed the nodes time to find each other and the cluster is back 
online.   The queue is online with the expected 101 messages but is 
currently not a synchronized mirror.  Only one node has the queue and the 
data. The other two nodes support the mirror but are not synchronized with 
the existing data.

This is how the test was performed.  A 3 server cluster. Each node is a VM 
guest on a single host running all 3 guest servers.  I hard stopped the 
host which brought down each guest. (preventing the rabbitMQ cluster 
negotiation of masters and notifications of shutdowns).  Restarted the host 
and restarted each guest at the same time.

What I am wondering is what is the best way to bring a cluster back online 
after something like this?  Basically the scenario is like a RabbitMQ 
cluster is found offline.  All servers are off.  You have to bring on the 
cluster without data loss to the persisted queues.  How would you go about 
doing this?  With an idle cluster might be easier but if you have live 
clients trying to connect to the cluster ready to use any nodes brought 
online I bet would be much harder.
Another question is how to have RabbitMQ come back online from a crash like 
this better than having to race through all of the servers starting each 
node. 

-Mark

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/cb0d1a49/attachment.htm>

From alexis at rabbitmq.com  Tue Oct 30 15:18:52 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 30 Oct 2012 15:18:52 +0000
Subject: [rabbitmq-discuss] AMQP-RPC vs REST
In-Reply-To: <508F9AB1.90804@redhat.com>
References: <6BCA7C48-4C2F-4A89-8D36-7217DD3C75BD@gmail.com>
	<CACOPnvco64FRG=GFUcZ0uBRuMKJMvr4T7nTreq2v7pE7Uz=HCw@mail.gmail.com>
	<2402C987-BA1A-479D-A4FB-C209BB7F0C7C@gmail.com>
	<CACOPnveGGYfRmKUASXCw0C30b1K6_-hwOqa_mOr9s=XgO=xhCQ@mail.gmail.com>
	<508F9AB1.90804@redhat.com>
Message-ID: <CACOPnvcAhsze=Qtz=M1r1C5drH9w2DxozqdggoQrkZxrJLdVuQ@mail.gmail.com>

Thanks Mike, and Gordon.

Mark,

I hope this is helping.  There are certainly cases where your approach
makes sense too, eg lots and lots of web APIs.

One question is: when is it useful to combine the intermediated and
decoupled approach described below, with an HTTP messaging API?  This
is a common pattern too - lots of "integration brokers" use it.  One
way this is used is to provide an HTTP + messaging interface to a
backend system that does not use HTTP.  There are other patterns too.
The Rabbit HTTP interface is here:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_8_7/priv/www/api/index.html

alexis





On Tue, Oct 30, 2012 at 9:15 AM, Gordon Sim <gsim at redhat.com> wrote:
> On 10/29/2012 11:09 PM, Alexis Richardson wrote:
>>
>> On Mon, Oct 29, 2012 at 10:42 PM, Mark <static.void.dev at gmail.com> wrote:
>>>
>>> For messaging and asych processing AMQP seeming to fit really well. For
>>> sync
>>> processing though it seems like using simple HTTP to a RESTful service
>>> would
>>> be easier than RPC over AMQP
>>
>>
>> "It depends" :-)
>
>
> Yes, it always does!
>
> While I would think many cases would indeed be best implemented as RESTful
> services, especially where a 'resource oriented' view of the system felt
> natural, I myself would do so not because it is easier (I don't think it
> really is) but for the sake of uniformity.
>
> One benefit of using AMQP even for a strict client-server, request-response
> style conversation, is that it makes it easy to introduce intermediaries to
> process/adapt the request and/or the response as the system evolves. You can
> also easily add in specialised processing for different classes of request.
>
> Of course there is nothing that prevents you doing similar things with HTTP
> also, but in my opinion a brokered solution actually makes it easier; the
> available infrastructure does more of the hard work already.
>
> Long running requests also fit quite well with the notion of explicit
> queuing, though again, I'm not implying that they can't be handled with
> HTTP.
>
> This is all just a long-winded way of repeating what Alexis says above
> though!
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue Oct 30 16:49:37 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 30 Oct 2012 16:49:37 +0000
Subject: [rabbitmq-discuss] Cluster busting - shut off all nodes at the
 same time.
In-Reply-To: <b3c53215-74b3-4a7f-a012-385c414acd5f@googlegroups.com>
References: <b3c53215-74b3-4a7f-a012-385c414acd5f@googlegroups.com>
Message-ID: <50900521.7000001@rabbitmq.com>

I am not sure quite what you are saying. You say that when you started 
the nodes again, none of them successfully started? And there was "an 
error". But then you started them "quickly" and that worked?

When each node is started it decides whether it thinks there are any 
other nodes which were running when it was killed. If so it waits 30 
seconds for them to become available and if nothing appears gives an 
error about "timeout waiting for tables",

Was this the error you saw?

We might make this 30 seconds configurable in future, but we need to 
think of the other case (where people start one node and not the other, 
and don't realise anything is wrong until the timeout).

You should also read:
http://www.rabbitmq.com/ha.html#unsynchronised-slaves

Cheers, Simon

On 30/10/12 14:45, Mark Ward wrote:
> I am testing what happens when bad things happen to a RabbitMQ cluster
> so that we have an idea what to expect.  This thread is to ask about
> something unexpected.
>
> My basic understanding of the RabbitMQ cluster is what I have read
> http://www.rabbitmq.com/ha.html and experienced in my testing.
>
> My testing scenario was the following.
> What happens if all cluster nodes where shut down at the same time with
> mirrored persisted data?  No clients were attached to the cluster at
> this time.
> What I was expecting is when the nodes were booted up they would all
> come back online and figure out what they needed for the master of the
> queue and not lose any data.
> What I experienced was each server booted up but RabbitMQ failed to
> start on every cluster server and issued an error plus a
> "erl_crash.dump".  The cluster was dead upon start up.  Knowing that
> RabbitMQ needs to negotiate with the cluster to determine its state of
> the queue I prepared each server to start rabbitMQ.  I quickly started
> the RabbitMQ service on each server.  This allowed the nodes time to
> find each other and the cluster is back online.   The queue is online
> with the expected 101 messages but is currently not a synchronized
> mirror.  Only one node has the queue and the data. The other two nodes
> support the mirror but are not synchronized with the existing data.
>
> This is how the test was performed.  A 3 server cluster. Each node is a
> VM guest on a single host running all 3 guest servers.  I hard stopped
> the host which brought down each guest. (preventing the rabbitMQ cluster
> negotiation of masters and notifications of shutdowns).  Restarted the
> host and restarted each guest at the same time.
>
> What I am wondering is what is the best way to bring a cluster back
> online after something like this?  Basically the scenario is like a
> RabbitMQ cluster is found offline.  All servers are off.  You have to
> bring on the cluster without data loss to the persisted queues.  How
> would you go about doing this?  With an idle cluster might be easier but
> if you have live clients trying to connect to the cluster ready to use
> any nodes brought online I bet would be much harder.
> Another question is how to have RabbitMQ come back online from a crash
> like this better than having to race through all of the servers starting
> each node.
>
> -Mark
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From gmr at meetme.com  Tue Oct 30 17:32:18 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Tue, 30 Oct 2012 13:32:18 -0400
Subject: [rabbitmq-discuss] Pika doesnt timeout soon if IP address is
	not reachable
In-Reply-To: <508F8491.2050303@rabbitmq.com>
References: <CAEMO9cAU0NYhNxkcZBrt_kh+vm6YCYnJ+Hivs8Xu5crnBpLrUA@mail.gmail.com>
	<508F8491.2050303@rabbitmq.com>
Message-ID: <CAKwdTWfz3MnR=bf-JznHmhcDftBNQW=VqZKDRg6XFSELrFP86A@mail.gmail.com>

In addition, 0.9.6 was released last night and has lower connection
timeouts. You might want to check that out to see if it solves your problem.

On Tue, Oct 30, 2012 at 3:41 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Bhaskar,
>
>
> On 24/10/12 12:57, Bhaskar teja wrote:
>
>> The problem we face is, if the IP address config is wrong or host OS
>> where rabbitmq is down, the connection attempt to rabbitmq fails with
>> huge timeout(>30 seconds).
>> Basically what we want is the connection attempt should timeout within 1
>> or 2 seconds regardless of success or failure.
>> Is there any way we can do that?
>>
>
> I suggest you ask on the pika list - https://groups.google.com/**
> forum/#!forum/pika-python<https://groups.google.com/forum/#!forum/pika-python>
>
>
> Regards,
>
> Matthias.
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 

Gavin M. Roy
Chief Technology Officer

 <http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/90cdd65e/attachment.htm>

From static.void.dev at gmail.com  Tue Oct 30 17:58:38 2012
From: static.void.dev at gmail.com (Mark)
Date: Tue, 30 Oct 2012 10:58:38 -0700
Subject: [rabbitmq-discuss] AMQP-RPC vs REST
In-Reply-To: <CACOPnvcAhsze=Qtz=M1r1C5drH9w2DxozqdggoQrkZxrJLdVuQ@mail.gmail.com>
References: <6BCA7C48-4C2F-4A89-8D36-7217DD3C75BD@gmail.com>
	<CACOPnvco64FRG=GFUcZ0uBRuMKJMvr4T7nTreq2v7pE7Uz=HCw@mail.gmail.com>
	<2402C987-BA1A-479D-A4FB-C209BB7F0C7C@gmail.com>
	<CACOPnveGGYfRmKUASXCw0C30b1K6_-hwOqa_mOr9s=XgO=xhCQ@mail.gmail.com>
	<508F9AB1.90804@redhat.com>
	<CACOPnvcAhsze=Qtz=M1r1C5drH9w2DxozqdggoQrkZxrJLdVuQ@mail.gmail.com>
Message-ID: <E946BF2C-0555-45EC-A3AB-CABA0D060AFE@gmail.com>

Thanks everyone for your responses. I have a lot to digest now :)

On Oct 30, 2012, at 8:18 AM, Alexis Richardson <alexis at rabbitmq.com> wrote:

> Thanks Mike, and Gordon.
> 
> Mark,
> 
> I hope this is helping.  There are certainly cases where your approach
> makes sense too, eg lots and lots of web APIs.
> 
> One question is: when is it useful to combine the intermediated and
> decoupled approach described below, with an HTTP messaging API?  This
> is a common pattern too - lots of "integration brokers" use it.  One
> way this is used is to provide an HTTP + messaging interface to a
> backend system that does not use HTTP.  There are other patterns too.
> The Rabbit HTTP interface is here:
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v2_8_7/priv/www/api/index.html
> 
> alexis
> 
> 
> 
> 
> 
> On Tue, Oct 30, 2012 at 9:15 AM, Gordon Sim <gsim at redhat.com> wrote:
>> On 10/29/2012 11:09 PM, Alexis Richardson wrote:
>>> 
>>> On Mon, Oct 29, 2012 at 10:42 PM, Mark <static.void.dev at gmail.com> wrote:
>>>> 
>>>> For messaging and asych processing AMQP seeming to fit really well. For
>>>> sync
>>>> processing though it seems like using simple HTTP to a RESTful service
>>>> would
>>>> be easier than RPC over AMQP
>>> 
>>> 
>>> "It depends" :-)
>> 
>> 
>> Yes, it always does!
>> 
>> While I would think many cases would indeed be best implemented as RESTful
>> services, especially where a 'resource oriented' view of the system felt
>> natural, I myself would do so not because it is easier (I don't think it
>> really is) but for the sake of uniformity.
>> 
>> One benefit of using AMQP even for a strict client-server, request-response
>> style conversation, is that it makes it easy to introduce intermediaries to
>> process/adapt the request and/or the response as the system evolves. You can
>> also easily add in specialised processing for different classes of request.
>> 
>> Of course there is nothing that prevents you doing similar things with HTTP
>> also, but in my opinion a brokered solution actually makes it easier; the
>> available infrastructure does more of the hard work already.
>> 
>> Long running requests also fit quite well with the notion of explicit
>> queuing, though again, I'm not implying that they can't be handled with
>> HTTP.
>> 
>> This is all just a long-winded way of repeating what Alexis says above
>> though!
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From static.void.dev at gmail.com  Tue Oct 30 18:05:40 2012
From: static.void.dev at gmail.com (Mark)
Date: Tue, 30 Oct 2012 11:05:40 -0700
Subject: [rabbitmq-discuss] RabbitMQ + Logstash + Rails
Message-ID: <D394B1F8-6B18-4A6A-9446-A6C664B893E6@gmail.com>

Anyone out there using RabbitMQ with Logstash and/or Gralyog2? If so, could you please describe your experiences.

General questions about the above technologies. After reading through Logstash it seems the general use case is that there is a Logstash agent sitting on each machine that you want to aggregate logs from. This agent will then tail/read a list of logs and then you can send them off to RabbitMQ via their AMQP output. I see however there is also an AMQP input so instead of having an agent on each machine, why not just send the logs to AMQP and then have a Logstash read from that input? This would remove the need of having an agent on each machine. Are there performance reasons of why not to send everything via AMQP? If one would to do this in Rails (Unicorn server) would it be best to use Bunny or the async AMQP gem? 

Thanks

From ward.mark at gmail.com  Tue Oct 30 18:07:12 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 30 Oct 2012 11:07:12 -0700 (PDT)
Subject: [rabbitmq-discuss] Cluster busting - shut off all nodes at the
	same time.
In-Reply-To: <b3c53215-74b3-4a7f-a012-385c414acd5f@googlegroups.com>
References: <b3c53215-74b3-4a7f-a012-385c414acd5f@googlegroups.com>
Message-ID: <92dc557b-b0c8-4e4a-84c7-cfd250b9c241@googlegroups.com>


Hi Simon,

I am sorry that my post appears all over the place. I am trying to work out 
a clear understanding of a cluster to advise what not do do to avoid data 
loss. It is becoming clear that server maintenance must account for the 
status of the queues in the cluster and great care must be applied to 
maintain the cluster. I have read the unsynchronised-saves section and 
basically the cluster buster testing is to purposely break the cluster in 
the way that the queue synchronization is documented to not handle. By 
doing this I am learning in more detail about how the cluster actually 
works.

After looking at the section again this statement stands out "... ensure 
that your use of messaging generally results in very short or empty queues 
that rapidly drain."  When dealing with the cluster buster test scenarios I 
have been using a scenario that a queue is not empty and is not rapidly 
drained.  

It has us nervous that if each node in the cluster is restarted one at a 
time and allowed to rejoin the cluster then all data in the idle persistent 
queues would be lost. Performing Windows updates might be fatal to idle 
queued data!  To clarify the messages are published with persistent on.

Back to the cluster test scenario....

I guess the conclusion is the cluster performed as designed and it did 
require all nodes in the cluster to be started under the 30 second timeout. 
 Although, I am not sure if the erl_crash.dump is expected.

When all 3 servers were booted things went as expected but with an 
erl_crash.dump.  Each server performed the 30 second search and then 
shutdown + crash.dump.  After I noticed all 3 services were not running I 
quickly started each service under the 30 seconds and the cluster came up 
plus no queue data was lost.

Each server had its relative log 

=INFO REPORT==== 30-Oct-2012::08:36:36 ===
Limiting to approx 924 file handles (829 sockets)

=ERROR REPORT==== 30-Oct-2012::08:37:13 ===
Timeout contacting cluster nodes. Since RabbitMQ was shut down forcefully
it cannot determine which nodes are timing out. Details on all nodes will
follow.

DIAGNOSTICS
===========

nodes in question: ['rabbit at RIOBARON-1','rabbit at CUST1-MASTER']

hosts, their running nodes and ports:
- CUST1-MASTER: [{rabbit,55021}]
- RIOBARON-1: []

current node details:
- node name: 'rabbit at RIOOVERLORD-1'
- home dir: C:\Windows
- cookie hash: MXZdkdzg76BGNNu+ev94Ow==



=INFO REPORT==== 30-Oct-2012::08:37:14 ===
    application: rabbit
    exited: {bad_return,{{rabbit,start,[normal,[]]},
                         {'EXIT',{rabbit,failure_during_boot}}}}
    type: permanent

Then, in the -sasl.log there is the following entry + the "erl_crash.dump" 
file.

=CRASH REPORT==== 30-Oct-2012::08:35:40 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.133.0>
    registered_name: []
    exception exit: {bad_return,{{rabbit,start,[normal,[]]},
                                 {'EXIT',{rabbit,failure_during_boot}}}}
      in function  application_master:init/4 (application_master.erl, line 
138)
    ancestors: [<0.132.0>]
    messages: [{'EXIT',<0.134.0>,normal}]
    links: [<0.132.0>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 132
  neighbours:


I do not know if the sasl.log entry has anything to do with the crash.dump 
file output but I have one.

=erl_crash_dump:0.1
Tue Oct 30 08:37:17 2012
Slogan: Kernel pid terminated (application_controller) 
({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
System version: Erlang R15B02 (erts-5.9.2) [async-threads:30]
Compiled: Mon Sep  3 11:00:33 2012
Taints: 
Atoms: 21679
=memory
total: 16514240
processes: 4423098
processes_used: 4423098
system: 12091142
atom: 495069
atom_used: 481297
binary: 21864
code: 9403948
ets: 27188
=hash_table:atom_tab
size: 19289
used: 13066
objs: 21679
depth: 8
............................


On Tue, Oct 30, 2012 at 11:49 AM, Simon MacMullen <simon at rabbitmq.com> 
wrote:
I am not sure quite what you are saying. You say that when you started the 
nodes again, none of them successfully started? And there was "an error". 
But then you started them "quickly" and that worked?

When each node is started it decides whether it thinks there are any other 
nodes which were running when it was killed. If so it waits 30 seconds for 
them to become available and if nothing appears gives an error about 
"timeout waiting for tables",

Was this the error you saw?

We might make this 30 seconds configurable in future, but we need to think 
of the other case (where people start one node and not the other, and don't 
realise anything is wrong until the timeout).

You should also read:
http://www.rabbitmq.com/ha.html#unsynchronised-slaves

Cheers, Simon

On Tuesday, October 30, 2012 9:45:21 AM UTC-5, Mark Ward wrote:
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/39c8f876/attachment.htm>

From ward.mark at gmail.com  Tue Oct 30 18:52:41 2012
From: ward.mark at gmail.com (Mark Ward)
Date: Tue, 30 Oct 2012 11:52:41 -0700 (PDT)
Subject: [rabbitmq-discuss] cluster reboot of death
Message-ID: <79c287d0-f76e-482b-884c-97fb7a27cc7b@googlegroups.com>

The scenario:

Maintenance on servers in a cluster require server restart.  When each 
server is restarted the next oldest node will be come master of the 
orphaned queues made by the restart. This will continue to happen until the 
last server is the master of all queues.  (ignoring newly created queues 
during maintenance.)  Idle queues with data would be left not synchronized 
and the data would only exist on the master server.  The problem now is the 
last server cannot be restarted or else the rest of the cluster will derive 
a new master for the queues and the idle data would be lost.  Active queues 
will eventually work out and become synchronized in the cluster.  Idle 
queues create a problem.

It appears server maintenance can't be scheduled but is at the mercy of the 
cluster's queues.  If there are idle queues best not perform maintenance 
when synchronized mirrored nodes is down to low "watermark"?  Stagger 
server maintenance in a way that there are frequent update servers and less 
update servers to balance out the cluster?

What is the best way to handle cluster server maintenance?   Is there a way 
to manage an idle queue in a cluster, possibly shuffle it between servers?

-Mark





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/77407882/attachment.htm>

From matwey.kornilov at gmail.com  Tue Oct 30 19:03:22 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Tue, 30 Oct 2012 23:03:22 +0400
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
	Plugin
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
	<CAM8fPiQxihYNGtO1vnXxe6u=SfsC7RbyS2X4+ZLdMnkw61Ehig@mail.gmail.com>
Message-ID: <k6p89p$bkb$1@ger.gmane.org>


Is there a chance to see presence-exchange in official rabbitmq bundle?



From line.eric at gmail.com  Tue Oct 30 18:44:05 2012
From: line.eric at gmail.com (Eric Lin)
Date: Tue, 30 Oct 2012 11:44:05 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ .net client KeepAlive for RMQ behind a
	load balancer
Message-ID: <de59ee4f-a02d-433e-987c-c51c62a89948@googlegroups.com>

Hi, 

We have HA setup for RabbitMQ and all queues are mirrored. The RMQ servers 
are sitting behind a load balancer which has a default TCP 
connection time-out set for 5 mins.

Is there a mechanism in the rabbitmq .net client to keep the connection 
alive?

thanks,
Eric
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/8b82c4d3/attachment.htm>

From matthias at rabbitmq.com  Tue Oct 30 19:46:11 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 30 Oct 2012 19:46:11 +0000
Subject: [rabbitmq-discuss] RabbitMQ .net client KeepAlive for RMQ
 behind a load balancer
In-Reply-To: <de59ee4f-a02d-433e-987c-c51c62a89948@googlegroups.com>
References: <de59ee4f-a02d-433e-987c-c51c62a89948@googlegroups.com>
Message-ID: <50902E83.4020704@rabbitmq.com>

Eric,

On 30/10/12 18:44, Eric Lin wrote:
> Is there a mechanism in the rabbitmq .net client to keep the connection
> alive?

http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v2.8.7/rabbitmq-dotnet-client-2.8.7-client-htmldoc/html/type-RabbitMQ.Client.ConnectionFactory.html#field-F:RabbitMQ.Client.ConnectionFactory.RequestedHeartbeat

Regards,

Matthias.

From michael.s.klishin at gmail.com  Tue Oct 30 20:55:15 2012
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 31 Oct 2012 00:55:15 +0400
Subject: [rabbitmq-discuss] ANN amqp gem docs have moved to rubyamqp.info
Message-ID: <CAE3HoVTsC1isdpQ1QkDqZsCia7+=rH01TVnmoCW3k==J2iUruQ@mail.gmail.com>

This is a quick reminder that amqp gem documentation has moved to
http://rubyamqp.info.
It happened 1 year ago but I still see quite a few people using the guides
at rubydoc.info (rdoc.info).

There are no significant differences between the old guides and the new
site but the old guides are no
longer updated. Most likely they will be removed completely in the future,
leaving rubydoc.info
with API reference only.

So please update your bookmarks and tell your co-workers to do the same:
rubyamqp.info now the
place to find amqp gem documentation.

Thank you.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/dae30ff7/attachment.htm>

From alexis at rabbitmq.com  Tue Oct 30 21:39:14 2012
From: alexis at rabbitmq.com (Alexis Richardson)
Date: Tue, 30 Oct 2012 21:39:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ + Logstash + Rails
In-Reply-To: <D394B1F8-6B18-4A6A-9446-A6C664B893E6@gmail.com>
References: <D394B1F8-6B18-4A6A-9446-A6C664B893E6@gmail.com>
Message-ID: <CACOPnvdm3LfXBUiKW-LMQVNhWV+OokzDhoSweZ8gtzHufHSdfg@mail.gmail.com>

You might also want to ask this on the ruby gem list...

On Tue, Oct 30, 2012 at 6:05 PM, Mark <static.void.dev at gmail.com> wrote:
> Anyone out there using RabbitMQ with Logstash and/or Gralyog2? If so, could you please describe your experiences.
>
> General questions about the above technologies. After reading through Logstash it seems the general use case is that there is a Logstash agent sitting on each machine that you want to aggregate logs from. This agent will then tail/read a list of logs and then you can send them off to RabbitMQ via their AMQP output. I see however there is also an AMQP input so instead of having an agent on each machine, why not just send the logs to AMQP and then have a Logstash read from that input? This would remove the need of having an agent on each machine. Are there performance reasons of why not to send everything via AMQP? If one would to do this in Rails (Unicorn server) would it be best to use Bunny or the async AMQP gem?
>
> Thanks
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From dgillies at brandscreen.com  Tue Oct 30 22:07:31 2012
From: dgillies at brandscreen.com (David Gillies)
Date: Wed, 31 Oct 2012 09:07:31 +1100
Subject: [rabbitmq-discuss] RabbitMQ + Logstash + Rails
In-Reply-To: <CACOPnvdm3LfXBUiKW-LMQVNhWV+OokzDhoSweZ8gtzHufHSdfg@mail.gmail.com>
References: <D394B1F8-6B18-4A6A-9446-A6C664B893E6@gmail.com>
	<CACOPnvdm3LfXBUiKW-LMQVNhWV+OokzDhoSweZ8gtzHufHSdfg@mail.gmail.com>
Message-ID: <CAO70Nwsc1NTvTy-Q4T6GyE03-4SFsUht54OoYYFi8sLOhRXWJw@mail.gmail.com>

I'd highly recommend asking on the #logstash irc channel on freenode.net.
The lead dev's nick is whack and he's very responsive to questions.

I'd hazard a guess that the answer to your questions "why have an agent on
every machine?" and "why not send everything over AMQP?" really boils down
to your requirements.

On 31 October 2012 08:39, Alexis Richardson <alexis at rabbitmq.com> wrote:

> You might also want to ask this on the ruby gem list...
>
> On Tue, Oct 30, 2012 at 6:05 PM, Mark <static.void.dev at gmail.com> wrote:
> > Anyone out there using RabbitMQ with Logstash and/or Gralyog2? If so,
> could you please describe your experiences.
> >
> > General questions about the above technologies. After reading through
> Logstash it seems the general use case is that there is a Logstash agent
> sitting on each machine that you want to aggregate logs from. This agent
> will then tail/read a list of logs and then you can send them off to
> RabbitMQ via their AMQP output. I see however there is also an AMQP input
> so instead of having an agent on each machine, why not just send the logs
> to AMQP and then have a Logstash read from that input? This would remove
> the need of having an agent on each machine. Are there performance reasons
> of why not to send everything via AMQP? If one would to do this in Rails
> (Unicorn server) would it be best to use Bunny or the async AMQP gem?
> >
> > Thanks
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
NOTICE

This e-mail and any attachments are confidential and may contain copyright 
material of Brandscreen or third parties. If you are not the intended 
recipient of this email you should not read, print, re-transmit, store or 
act in reliance on this e-mail or any attachments, and should destroy all 
copies of them. Brandscreen does not guarantee the integrity of any emails 
or any attached files. The views or opinions expressed are the author's own 
and may not reflect the views or opinions of Brandscreen.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/d17bfc20/attachment.htm>

From Bin.Chen at kla-tencor.com  Wed Oct 31 00:09:39 2012
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Tue, 30 Oct 2012 17:09:39 -0700
Subject: [rabbitmq-discuss] rabbit_mgmt_db crashed
Message-ID: <BCC407A444557E41B0D8B0260D684992058F70B8@CA1EXCLV07.adcorp.kla-tencor.com>

Hello,

 

I just noticed a crash report in sasl log of one of our RMQ server.

It seems the management plug-in crashed. The management web page cannot
be opened any more.

 

I had this problem before with an old version. Now I am using 2.8.6
64-bit version on Windows 2008 Server.

The RMQ server is still running fine, but the memory utilization is much
higher than other similar servers without such crash.

This "bad" server uses about 8 GB memory now, while other normal servers
use only about 500 MB memory.

It may eventually hit the high memory water mark soon at 9.6 GB.

 

Here is the complete crash report.

 

 

=CRASH REPORT==== 29-Oct-2012::23:01:08 ===

  crasher:

    initial call: rabbit_mgmt_db:init/1

    pid: <0.284.0>

    registered_name: []

    exception exit: {badarith,

                        [{rabbit_mgmt_db,rate,5,[]},

                         {rabbit_mgmt_db,'-rates/5-lc$^0/1-0-',5,[]},

                         {rabbit_mgmt_db,'-rates/5-lc$^1/1-1-',6,[]},

                         {rabbit_mgmt_db,rates,5,[]},

                         {rabbit_mgmt_db,handle_fine_stat,7,[]},

 
{rabbit_mgmt_db,'-handle_fine_stats/4-lc$^1/1-1-',4,

                             []},

 
{rabbit_mgmt_db,'-handle_event/2-lc$^1/1-0-',4,[]},

                         {rabbit_mgmt_db,handle_event,2,[]}]}

      in function  gen_server:terminate/6 (gen_server.erl, line 747)

    ancestors: [<0.281.0>,rabbit_mgmt_sup,<0.262.0>]

    messages: [{'$gen_cast',

                      {event,

                          {event,channel_stats,

                              [{pid,<0.12756.396>},

                               {transactional,false},

                               {confirm,false},

                               {consumer_count,0},

                               {messages_unacknowledged,0},

                               {messages_unconfirmed,0},

                               {messages_uncommitted,0},

                               {acks_uncommitted,0},

                               {prefetch_count,1},

                               {client_flow_blocked,false},

                               {channel_queue_stats,[]},

                               {channel_exchange_stats,[]},

                               {channel_queue_exchange_stats,[]}],

                              {1351,576868,812003}}}}]

    links: [<0.281.0>]

    dictionary: []

    trap_exit: false

    status: running

    heap_size: 6765

    stack_size: 24

    reductions: 3730467164

  neighbours:

 

 

 

Here is the output of "rabbitmqctl.bat status"

 

 

 

Status of node rabbit at RACK4UNIT001 ...

[{pid,4708},

{running_applications,

     [{rabbitmq_management,"RabbitMQ Management Console","2.8.6"},

      {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.6"},

      {amqp_client,"RabbitMQ AMQP Client","2.8.6"},

      {rabbit,"RabbitMQ","2.8.6"},

      {os_mon,"CPO  CXC 138 46","2.2.10"},

      {sasl,"SASL  CXC 138 11","2.2.1"},

      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.6"},

      {webmachine,"webmachine","1.9.1-rmq2.8.6-git52e62bc"},

      {mochiweb,"MochiMedia Web Server","2.3.1-rmq2.8.6-gitd541e9a"},

      {xmerl,"XML parser","1.3.2"},

      {inets,"INETS  CXC 138 49","5.9.1"},

      {mnesia,"MNESIA  CXC 138 12","4.7.1"},

      {stdlib,"ERTS  CXC 138 10","1.18.2"},

      {kernel,"ERTS  CXC 138 10","2.15.2"}]},

{os,{win32,nt}},

{erlang_version,

     "Erlang R15B02 (erts-5.9.2) [64-bit] [smp:12:12]
[async-threads:30]\n"},

{memory,

     [{total,8512001360},

      {processes,7401925315},

      {processes_used,7401754972},

      {system,1110076045},

      {atom,662409},

      {atom_used,652416},

      {binary,857726336},

      {code,17969722},

      {ets,4550280}]},

{vm_memory_high_watermark,0.4},

{vm_memory_limit,10304190873},

{disk_free_limit,1000000000},

{disk_free,39365828608},

{file_descriptors,

     [{total_limit,16284},

      {total_used,142},

      {sockets_limit,14653},

      {sockets_used,113}]},

{processes,[{limit,1048576},{used,5986}]},

{run_queue,0},

{uptime,104350}]

...done.

 

 

 

Best regards,

--Bin Chen

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/48faac2e/attachment.htm>

From fredbasset1000 at gmail.com  Wed Oct 31 00:53:14 2012
From: fredbasset1000 at gmail.com (fred basset)
Date: Tue, 30 Oct 2012 17:53:14 -0700
Subject: [rabbitmq-discuss] Production ready C++ client library?
Message-ID: <CAE-zcqWL+t+g25i_VUHFj9_z_WrFpLX87xOMFHE0+E+tLnCoQg@mail.gmail.com>

Hi All,

Is there a production ready C++ client library available for Rabbit
MQ?  I'm thinking of using Rabbit MQ on a small embedded Linux system.

Thank you,
Fred

From olda.esner at gmail.com  Wed Oct 31 01:11:12 2012
From: olda.esner at gmail.com (=?UTF-8?B?T2xkxZlpY2ggRcWhbmVy?=)
Date: Tue, 30 Oct 2012 18:11:12 -0700
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
	Plugin
In-Reply-To: <508FE465.4080408@rabbitmq.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
	<508FE465.4080408@rabbitmq.com>
Message-ID: <CAAFAKh4CeV5LR6EonW_HqLUWWBbCbsOkYwh9CYOArWt2LCymCw@mail.gmail.com>

Thank you very much for the fastest fix I have ever seen :)

If you want to update downloads section, I'm including current ez build of
presence plugin.

Regards,

Oldrich

2012/10/30 Simon MacMullen <simon at rabbitmq.com>

> On 30/10/12 14:18, Tony Garnock-Jones wrote:
>
>> On 30 October 2012 00:27, Olda E?ner <olda.esner at gmail.com
>> <mailto:olda.esner at gmail.com>> wrote:
>>
>>     after upgrading to RabbitMQ 2.8.6 from 2.8.5, presence-exchange
>>     plugin doesn't work. Is there any chance to fix it?
>>
>>
>> It's a consequence of the removal from the server's core of support for
>> "immediate" publication. At least rabbithub and the udp-exchange will
>> also have to be updated. The fix should be straightforward.
>>
>
> ...although that's happened on default, not 2.8.6.
>
> To the OP: you might need to get the un-updated version of the plugin
> source, and then build that against the 2.8.6 source download.
>
> Alternatively, whatever plugin binary you created for 2.8.5 should still
> work, I don't think any APIs changed?
>
>
>  I'll email again when I'm done. Shouldn't be long.
>>
>
> *clicks stopwatch* Six minutes, not bad :-)
>
> Cheers, Simon
>
>
> --
> Simon MacMullen
> RabbitMQ, VMware
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/c68bc534/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_presence_exchange-0.0.0.ez
Type: application/octet-stream
Size: 8017 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/c68bc534/attachment.obj>

From olda.esner at gmail.com  Wed Oct 31 01:34:56 2012
From: olda.esner at gmail.com (=?UTF-8?B?T2xkxZlpY2ggRcWhbmVy?=)
Date: Tue, 30 Oct 2012 18:34:56 -0700
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
	Plugin
In-Reply-To: <CAAFAKh4CeV5LR6EonW_HqLUWWBbCbsOkYwh9CYOArWt2LCymCw@mail.gmail.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
	<508FE465.4080408@rabbitmq.com>
	<CAAFAKh4CeV5LR6EonW_HqLUWWBbCbsOkYwh9CYOArWt2LCymCw@mail.gmail.com>
Message-ID: <CAAFAKh7p-oOBeKQuYJneCrH46ZVaC0TRNccEfGgZq8TMstQSTg@mail.gmail.com>

Bad news, plugins seems to work in management console (x-presence exchange
isn't in "red" state) but after binding x-presence exchange to queue,
rabbit server log writes the following:

=ERROR REPORT==== 31-Oct-2012::02:22:37 ===
** Generic server <0.131.0> terminating
** Last message in was {'$gen_cast',
                           {submit_async,#Fun<rabbit_binding.3.58413561>}}
** When Server state == 2
** Reason for termination ==
** {function_clause,
       [{presence_exchange,add_binding,
            [none,
             {exchange,
                 {resource,<<"/">>,exchange,<<"xpresence">>},
                 'x-presence',true,false,false,[],undefined},
             {binding,
                 {resource,<<"/">>,exchange,<<"xpresence">>},
                 <<>>,
                 {resource,<<"/">>,queue,<<"qpresence">>},
                 []}],
            []},
        {rabbit_binding,x_callback,4,[]},
        {rabbit_binding,'-recover_semi_durable_route/3-fun-0-',3,[]},
        {worker_pool_worker,handle_cast,2,[]},
        {gen_server2,handle_msg,2,[]},
        {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}

=ERROR REPORT==== 31-Oct-2012::02:19:08 ===
** Generic server <0.1023.0> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'queue.bind',0,

<<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>,
                                   <<"xpresence">>,<<>>,false,[]},
                               none,noflow}}
** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,1,<0.1019.0>,
                            <0.1021.0>,<0.1019.0>,
                            "127.0.0.1:54877 -> 127.0.0.1:5672",
                            {token,<0.1022.0>,false},
                            none,1,
                            {[],[]},
                            {[],[]},
                            [],[],
                            {user,<<"guest">>,
                                [administrator],
                                rabbit_auth_backend_internal,
                                {internal_user,<<"guest">>,

<<238,155,95,210,98,65,149,74,208,144,18,
                                      191,58,228,155,137,230,224,252,199>>,
                                    [administrator]}},
                            <<"/">>,
                            <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>,
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {set,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {set,0,16,16,8,80,48,

{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            <0.1017.0>,
                            {state,fine,5000,#Ref<0.0.0.8440>},
                            false,1,
                            {{0,nil},{0,nil}},
                            [],
                            [{<<"exchange_exchange_bindings">>,bool,true},
                             {<<"consumer_cancel_notify">>,bool,true},
                             {<<"basic.nack">>,bool,true},
                             {<<"publisher_confirms">>,bool,true}],
                            none}
** Reason for termination ==
** {function_clause,
       [{presence_exchange,add_binding,
            [none,
             {exchange,
                 {resource,<<"/">>,exchange,<<"xpresence">>},
                 'x-presence',true,false,false,[],undefined},
             {binding,
                 {resource,<<"/">>,exchange,<<"xpresence">>},
                 <<>>,
                 {resource,<<"/">>,queue,
                     <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>},
                 []}],
            []},
        {rabbit_binding,'-add/3-fun-0-',3,[]},
        {rabbit_channel,binding_action,9,[]},
        {rabbit_channel,handle_cast,2,[]},
        {gen_server2,handle_msg,2,[]},
        {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}

=ERROR REPORT==== 31-Oct-2012::02:19:08 ===
AMQP connection <0.1019.0>, channel 1 - error:
{function_clause,
    [{presence_exchange,add_binding,
         [none,
          {exchange,
              {resource,<<"/">>,exchange,<<"xpresence">>},
              'x-presence',true,false,false,[],undefined},
          {binding,
              {resource,<<"/">>,exchange,<<"xpresence">>},
              <<>>,
              {resource,<<"/">>,queue,
                  <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>},
              []}],
         []},
     {rabbit_binding,'-add/3-fun-0-',3,[]},
     {rabbit_channel,binding_action,9,[]},
     {rabbit_channel,handle_cast,2,[]},
     {gen_server2,handle_msg,2,[]},
     {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}

=WARNING REPORT==== 31-Oct-2012::02:19:08 ===
Non-AMQP exit reason '{function_clause,
                       [{presence_exchange,add_binding,
                         [none,
                          {exchange,
                           {resource,<<"/">>,exchange,<<"xpresence">>},
                           'x-presence',true,false,false,[],undefined},
                          {binding,
                           {resource,<<"/">>,exchange,<<"xpresence">>},
                           <<>>,
                           {resource,<<"/">>,queue,
                            <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>},
                           []}],
                         []},
                        {rabbit_binding,'-add/3-fun-0-',3,[]},
                        {rabbit_channel,binding_action,9,[]},
                        {rabbit_channel,handle_cast,2,[]},
                        {gen_server2,handle_msg,2,[]},
                        {proc_lib,init_p_do_apply,3,
                         [{file,"proc_lib.erl"},{line,227}]}]}'

Is any of you able to find a source of problem? We are using Java EE
application with spring-rabbit and spring-amqp libraries.

Thank you.

Oldrich

2012/10/30 Old?ich E?ner <olda.esner at gmail.com>

> Thank you very much for the fastest fix I have ever seen :)
>
> If you want to update downloads section, I'm including current ez build of
> presence plugin.
>
> Regards,
>
> Oldrich
>
>
> 2012/10/30 Simon MacMullen <simon at rabbitmq.com>
>
>> On 30/10/12 14:18, Tony Garnock-Jones wrote:
>>
>>> On 30 October 2012 00:27, Olda E?ner <olda.esner at gmail.com
>>> <mailto:olda.esner at gmail.com>> wrote:
>>>
>>>     after upgrading to RabbitMQ 2.8.6 from 2.8.5, presence-exchange
>>>     plugin doesn't work. Is there any chance to fix it?
>>>
>>>
>>> It's a consequence of the removal from the server's core of support for
>>> "immediate" publication. At least rabbithub and the udp-exchange will
>>> also have to be updated. The fix should be straightforward.
>>>
>>
>> ...although that's happened on default, not 2.8.6.
>>
>> To the OP: you might need to get the un-updated version of the plugin
>> source, and then build that against the 2.8.6 source download.
>>
>> Alternatively, whatever plugin binary you created for 2.8.5 should still
>> work, I don't think any APIs changed?
>>
>>
>>  I'll email again when I'm done. Shouldn't be long.
>>>
>>
>> *clicks stopwatch* Six minutes, not bad :-)
>>
>> Cheers, Simon
>>
>>
>> --
>> Simon MacMullen
>> RabbitMQ, VMware
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/e68fb9df/attachment.htm>

From alan.antonuk at gmail.com  Wed Oct 31 02:15:38 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Tue, 30 Oct 2012 22:15:38 -0400
Subject: [rabbitmq-discuss] Production ready C++ client library?
In-Reply-To: <CAE-zcqWL+t+g25i_VUHFj9_z_WrFpLX87xOMFHE0+E+tLnCoQg@mail.gmail.com>
References: <CAE-zcqWL+t+g25i_VUHFj9_z_WrFpLX87xOMFHE0+E+tLnCoQg@mail.gmail.com>
Message-ID: <CAAt2poK2Rdto3w+sidRLXNNwHS5Kh6uzqKFQ3cQN-pWfz2yJfQ@mail.gmail.com>

A listing of C and C++ clients that work with RabbitMQ can be found here:
http://www.rabbitmq.com/devtools.html#c-dev

-Alan

On Tue, Oct 30, 2012 at 8:53 PM, fred basset <fredbasset1000 at gmail.com>wrote:

> Hi All,
>
> Is there a production ready C++ client library available for Rabbit
> MQ?  I'm thinking of using Rabbit MQ on a small embedded Linux system.
>
> Thank you,
> Fred
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121030/c5e13c7c/attachment.htm>

From matthias at rabbitmq.com  Wed Oct 31 05:14:15 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 31 Oct 2012 05:14:15 +0000
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
 Plugin
In-Reply-To: <CAAFAKh7p-oOBeKQuYJneCrH46ZVaC0TRNccEfGgZq8TMstQSTg@mail.gmail.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
	<508FE465.4080408@rabbitmq.com>
	<CAAFAKh4CeV5LR6EonW_HqLUWWBbCbsOkYwh9CYOArWt2LCymCw@mail.gmail.com>
	<CAAFAKh7p-oOBeKQuYJneCrH46ZVaC0TRNccEfGgZq8TMstQSTg@mail.gmail.com>
Message-ID: <5090B3A7.9050401@rabbitmq.com>

Oldrich,

On 31/10/12 01:34, Old?ich E?ner wrote:
> Bad news, plugins seems to work in management console (x-presence
> exchange isn't in "red" state) but after binding x-presence exchange to
> queue, rabbit server log writes the following:

Looks like the plug-in was built against the current head of 'default' 
of RabbitMQ, rather than 2.8.x.

As Simon said...
<quote>
To the OP: you might need to get the un-updated version of the plugin 
source, and then build that against the 2.8.6 source download.
</quote>

Regards,

Matthias.

From pafriend at octavian.org  Wed Oct 31 02:43:00 2012
From: pafriend at octavian.org (Peter A. Friend)
Date: Tue, 30 Oct 2012 19:43:00 -0700
Subject: [rabbitmq-discuss] consumer cancel notify support in pika
Message-ID: <50909034.70307@octavian.org>

Greetings,

I have set up a basic cluster of 3 rabbitmq servers on the same host for 
testing. The problem I am having is that consumers are not getting the 
cancel notification when the server containing a particular queue is 
stopped. None of the queues are durable, and at this point I am trying 
to avoid mirroring, though I noticed that even in mirroring mode the 
cancel notification is not received. I couldn't find any info on how to 
configure this in the python client, or if it is even supported.

Thanks,

Peter

From simon at rabbitmq.com  Wed Oct 31 10:45:10 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 31 Oct 2012 10:45:10 +0000
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
 Plugin
In-Reply-To: <k6p89p$bkb$1@ger.gmane.org>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
	<CAM8fPiQxihYNGtO1vnXxe6u=SfsC7RbyS2X4+ZLdMnkw61Ehig@mail.gmail.com>
	<k6p89p$bkb$1@ger.gmane.org>
Message-ID: <50910136.1040307@rabbitmq.com>

On 30/10/12 19:03, Matwey V. Kornilov wrote:
> Is there a chance to see presence-exchange in official rabbitmq bundle?

We could discuss this on a per-plugin basis with plugin authors, but I 
suspect the *real* problem is that building community plugins from 
source is a pain.

I'm not sure I would just want to import every community plugin going, 
even if the authors were amenable. I keep wondering about providing some 
plugin building service instead.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Oct 31 10:51:58 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 31 Oct 2012 10:51:58 +0000
Subject: [rabbitmq-discuss] Cluster busting - shut off all nodes at the
 same time.
In-Reply-To: <92dc557b-b0c8-4e4a-84c7-cfd250b9c241@googlegroups.com>
References: <b3c53215-74b3-4a7f-a012-385c414acd5f@googlegroups.com>
	<92dc557b-b0c8-4e4a-84c7-cfd250b9c241@googlegroups.com>
Message-ID: <509102CE.3090102@rabbitmq.com>

On 30/10/12 18:07, Mark Ward wrote:
> After looking at the section again this statement stands out "... ensure
> that your use of messaging generally results in very short or empty
> queues that rapidly drain."  When dealing with the cluster buster test
> scenarios I have been using a scenario that a queue is not empty and is
> not rapidly drained.
>
> It has us nervous that if each node in the cluster is restarted one at a
> time and allowed to rejoin the cluster then all data in the idle
> persistent queues would be lost. Performing Windows updates might be
> fatal to idle queued data!  To clarify the messages are published
> with persistent on.

Yes.

We have various enhancements planned to queue synchronisation; the 
current situation is clearly not ideal when queues drain slowly.

One thing you'll be able to do in 3.0 (not that this is at all a perfect 
solution) is switch off mirroring for queues, do any cluster 
maintenance, and then switch mirroring back on. Another non-ideal 
alternative is to take the whole cluster down, do your Windows updates, 
and then start it up again.

> Back to the cluster test scenario....
>
> I guess the conclusion is the cluster performed as designed and it did
> require all nodes in the cluster to be started under the 30 second
> timeout.  Although, I am not sure if the erl_crash.dump is expected.

Yeah, erl_crash.dump is emitted whenever RabbitMQ fails to start. The 
log file entries below are also consistent with this happening.

Cheers, Simon

> When all 3 servers were booted things went as expected but with an
> erl_crash.dump.  Each server performed the 30 second search and then
> shutdown + crash.dump.  After I noticed all 3 services were not running
> I quickly started each service under the 30 seconds and the cluster came
> up plus no queue data was lost.
>
> Each server had its relative log
>
> =INFO REPORT==== 30-Oct-2012::08:36:36 ===
> Limiting to approx 924 file handles (829 sockets)
>
> =ERROR REPORT==== 30-Oct-2012::08:37:13 ===
> Timeout contacting cluster nodes. Since RabbitMQ was shut down forcefully
> it cannot determine which nodes are timing out. Details on all nodes will
> follow.
>
> DIAGNOSTICS
> ===========
>
> nodes in question: ['rabbit at RIOBARON-1','rabbit at CUST1-MASTER']
>
> hosts, their running nodes and ports:
> - CUST1-MASTER: [{rabbit,55021}]
> - RIOBARON-1: []
>
> current node details:
> - node name: 'rabbit at RIOOVERLORD-1'
> - home dir: C:\Windows
> - cookie hash: MXZdkdzg76BGNNu+ev94Ow==
>
>
>
> =INFO REPORT==== 30-Oct-2012::08:37:14 ===
>      application: rabbit
>      exited: {bad_return,{{rabbit,start,[normal,[]]},
>                           {'EXIT',{rabbit,failure_during_boot}}}}
>      type: permanent
>
> Then, in the -sasl.log there is the following entry + the
> "erl_crash.dump" file.
>
> =CRASH REPORT==== 30-Oct-2012::08:35:40 ===
>    crasher:
>      initial call: application_master:init/4
>      pid: <0.133.0>
>      registered_name: []
>      exception exit: {bad_return,{{rabbit,start,[normal,[]]},
>                                   {'EXIT',{rabbit,failure_during_boot}}}}
>        in function  application_master:init/4 (application_master.erl,
> line 138)
>      ancestors: [<0.132.0>]
>      messages: [{'EXIT',<0.134.0>,normal}]
>      links: [<0.132.0>,<0.7.0>]
>      dictionary: []
>      trap_exit: true
>      status: running
>      heap_size: 1597
>      stack_size: 24
>      reductions: 132
>    neighbours:
>
>
> I do not know if the sasl.log entry has anything to do with the
> crash.dump file output but I have one.
>
> =erl_crash_dump:0.1
> Tue Oct 30 08:37:17 2012
> Slogan: Kernel pid terminated (application_controller)
> ({application_start_failure,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{rabbit,failure_during_boot}}}}})
> System version: Erlang R15B02 (erts-5.9.2) [async-threads:30]
> Compiled: Mon Sep  3 11:00:33 2012
> Taints:
> Atoms: 21679
> =memory
> total: 16514240
> processes: 4423098
> processes_used: 4423098
> system: 12091142
> atom: 495069
> atom_used: 481297
> binary: 21864
> code: 9403948
> ets: 27188
> =hash_table:atom_tab
> size: 19289
> used: 13066
> objs: 21679
> depth: 8
> ............................
>
>
> On Tue, Oct 30, 2012 at 11:49 AM, Simon MacMullen <simon at rabbitmq.com>
> wrote:
> I am not sure quite what you are saying. You say that when you started
> the nodes again, none of them successfully started? And there was "an
> error". But then you started them "quickly" and that worked?
>
> When each node is started it decides whether it thinks there are any
> other nodes which were running when it was killed. If so it waits 30
> seconds for them to become available and if nothing appears gives an
> error about "timeout waiting for tables",
>
> Was this the error you saw?
>
> We might make this 30 seconds configurable in future, but we need to
> think of the other case (where people start one node and not the other,
> and don't realise anything is wrong until the timeout).
>
> You should also read:
> http://www.rabbitmq.com/ha.html#unsynchronised-slaves
>
> Cheers, Simon
>
> On Tuesday, October 30, 2012 9:45:21 AM UTC-5, Mark Ward wrote:
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From emile at rabbitmq.com  Wed Oct 31 10:59:51 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 31 Oct 2012 10:59:51 +0000
Subject: [rabbitmq-discuss] RabbitMQ Client recommendations
In-Reply-To: <1351593698046-22959.post@n5.nabble.com>
References: <1351593698046-22959.post@n5.nabble.com>
Message-ID: <509104A7.5060101@rabbitmq.com>

Hi Lars,

On 30/10/12 10:41, Lars Ellebo wrote:
> So my question is:
> What RabbitMQ-Client would you recommend to embed in the Device, v.2.7.1
> (same as server) or v.2.8.7 (the newest)?

This page has compatibility information for the Java client and shows 
that both v2.7.1 and v2.8.7 will work with a 0-9-1 broker:
http://www.rabbitmq.com/specification.html

I would recommend using the latest version. v2.7.1 is almost a year old 
and many bugs have been fixed since. You can find the changes by looking 
at the "java client" section of the release notes linked from the changelog:
http://www.rabbitmq.com/changelog.html


-Emile



From simon at rabbitmq.com  Wed Oct 31 11:07:01 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 31 Oct 2012 11:07:01 +0000
Subject: [rabbitmq-discuss] rabbit_mgmt_db crashed
In-Reply-To: <BCC407A444557E41B0D8B0260D684992058F70B8@CA1EXCLV07.adcorp.kla-tencor.com>
References: <BCC407A444557E41B0D8B0260D684992058F70B8@CA1EXCLV07.adcorp.kla-tencor.com>
Message-ID: <50910655.6040109@rabbitmq.com>

Hi. I remember you posted a similar stack trace six months ago:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/019990.html

I stared at the code involved for some time but was completely unable to 
see how that could occur. I don't suppose you have any way to replicate 
this?

Apart from that, could you post the output of:

rabbitmqctl.bat eval
"lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory),
Pid, process_info(Pid)} || Pid <- processes()])), 30)."

(all on one line)

and

rabbitmqctl.bat report

somewhere please?

Cheers, Simon

On 31/10/12 00:09, Chen, Bin wrote:
> Hello,
>
> I just noticed a crash report in sasl log of one of our RMQ server.
>
> It seems the management plug-in crashed. The management web page cannot
> be opened any more.
>
> I had this problem before with an old version. Now I am using 2.8.6
> 64-bit version on Windows 2008 Server.
>
> The RMQ server is still running fine, but the memory utilization is much
> higher than other similar servers without such crash.
>
> This ?bad? server uses about 8 GB memory now, while other normal servers
> use only about 500 MB memory.
>
> It may eventually hit the high memory water mark soon at 9.6 GB.
>
> Here is the complete crash report.
>
> =CRASH REPORT==== 29-Oct-2012::23:01:08 ===
>
>    crasher:
>
>      initial call: rabbit_mgmt_db:init/1
>
>      pid: <0.284.0>
>
>      registered_name: []
>
>      exception exit: {badarith,
>
>                          [{rabbit_mgmt_db,rate,5,[]},
>
>                           {rabbit_mgmt_db,'-rates/5-lc$^0/1-0-',5,[]},
>
>                           {rabbit_mgmt_db,'-rates/5-lc$^1/1-1-',6,[]},
>
>                           {rabbit_mgmt_db,rates,5,[]},
>
>                           {rabbit_mgmt_db,handle_fine_stat,7,[]},
>
>
> {rabbit_mgmt_db,'-handle_fine_stats/4-lc$^1/1-1-',4,
>
>                               []},
>
>
>         {rabbit_mgmt_db,'-handle_event/2-lc$^1/1-0-',4,[]},
>
>                           {rabbit_mgmt_db,handle_event,2,[]}]}
>
>        in function  gen_server:terminate/6 (gen_server.erl, line 747)
>
>      ancestors: [<0.281.0>,rabbit_mgmt_sup,<0.262.0>]
>
>      messages: [{'$gen_cast',
>
>                        {event,
>
>                            {event,channel_stats,
>
>                                [{pid,<0.12756.396>},
>
>                                 {transactional,false},
>
>                                 {confirm,false},
>
>                                 {consumer_count,0},
>
>                                 {messages_unacknowledged,0},
>
>                                 {messages_unconfirmed,0},
>
>                                 {messages_uncommitted,0},
>
>                                 {acks_uncommitted,0},
>
>                                 {prefetch_count,1},
>
>                                 {client_flow_blocked,false},
>
>                                 {channel_queue_stats,[]},
>
>                                 {channel_exchange_stats,[]},
>
>                                 {channel_queue_exchange_stats,[]}],
>
>                                {1351,576868,812003}}}}]
>
>      links: [<0.281.0>]
>
>      dictionary: []
>
>      trap_exit: false
>
>      status: running
>
>      heap_size: 6765
>
>      stack_size: 24
>
>      reductions: 3730467164
>
>    neighbours:
>
> Here is the output of ?rabbitmqctl.bat status?
>
> Status of node rabbit at RACK4UNIT001 ...
>
> [{pid,4708},
>
> {running_applications,
>
>       [{rabbitmq_management,"RabbitMQ Management Console","2.8.6"},
>
>        {rabbitmq_management_agent,"RabbitMQ Management Agent","2.8.6"},
>
>        {amqp_client,"RabbitMQ AMQP Client","2.8.6"},
>
>        {rabbit,"RabbitMQ","2.8.6"},
>
>        {os_mon,"CPO  CXC 138 46","2.2.10"},
>
>        {sasl,"SASL  CXC 138 11","2.2.1"},
>
>        {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.6"},
>
>        {webmachine,"webmachine","1.9.1-rmq2.8.6-git52e62bc"},
>
>        {mochiweb,"MochiMedia Web Server","2.3.1-rmq2.8.6-gitd541e9a"},
>
>        {xmerl,"XML parser","1.3.2"},
>
>        {inets,"INETS  CXC 138 49","5.9.1"},
>
>        {mnesia,"MNESIA  CXC 138 12","4.7.1"},
>
>        {stdlib,"ERTS  CXC 138 10","1.18.2"},
>
>        {kernel,"ERTS  CXC 138 10","2.15.2"}]},
>
> {os,{win32,nt}},
>
> {erlang_version,
>
>       "Erlang R15B02 (erts-5.9.2) [64-bit] [smp:12:12]
> [async-threads:30]\n"},
>
> {memory,
>
>       [{total,8512001360},
>
>        {processes,7401925315},
>
>        {processes_used,7401754972},
>
>        {system,1110076045},
>
>        {atom,662409},
>
>        {atom_used,652416},
>
>        {binary,857726336},
>
>        {code,17969722},
>
>        {ets,4550280}]},
>
> {vm_memory_high_watermark,0.4},
>
> {vm_memory_limit,10304190873},
>
> {disk_free_limit,1000000000},
>
> {disk_free,39365828608},
>
> {file_descriptors,
>
>       [{total_limit,16284},
>
>        {total_used,142},
>
>        {sockets_limit,14653},
>
>        {sockets_used,113}]},
>
> {processes,[{limit,1048576},{used,5986}]},
>
> {run_queue,0},
>
> {uptime,104350}]
>
> ...done.
>
> Best regards,
>
> --Bin Chen
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, VMware

From oldhomelh at gmail.com  Wed Oct 31 11:35:12 2012
From: oldhomelh at gmail.com (andy lin)
Date: Wed, 31 Oct 2012 04:35:12 -0700 (PDT)
Subject: [rabbitmq-discuss] the problem about the consumer connection can be
	closed
Message-ID: <1351683312763-22996.post@n5.nabble.com>


 the rabbitServer log has some  messages  as follows : 
closing AMQP connection <0.23889.27> (192.168.80.20:53035 ->
192.168.80.23:5672): {inet_error,ehostunreach}

so after some time ,the queue will head up some many messages, the consumers
don't receive any more.But the consumers don't have any exceptions ,so Could
you tell me What situations can cause the problem? Thank  you 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/the-problem-about-the-consumer-connection-can-be-closed-tp22996.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emamdouh at cloud9ers.com  Wed Oct 31 11:48:17 2012
From: emamdouh at cloud9ers.com (emamdouh)
Date: Wed, 31 Oct 2012 04:48:17 -0700 (PDT)
Subject: [rabbitmq-discuss] can't start rabbitmq-server
In-Reply-To: <CAMcAHLWAUucjcyHGmfzush0S4EEAEbp2GwJeZORyA_iwxU4PiQ@mail.gmail.com>
References: <CAHAaT5u1eO3DcY5ZTa6UJe0bwUg2ep43AbtdopbYn5nWXjTHUA@mail.gmail.com>
	<CAMcAHLWAUucjcyHGmfzush0S4EEAEbp2GwJeZORyA_iwxU4PiQ@mail.gmail.com>
Message-ID: <1351684097596-22997.post@n5.nabble.com>

@Alvaro Videla-2 : every time before i start rabbitmq-server i check every
rabbitmq / erlang /epmd processes and i kill them before starting
rabbitmq-server 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/can-t-start-rabbitmq-server-tp22942p22997.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Wed Oct 31 11:55:45 2012
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 31 Oct 2012 11:55:45 +0000
Subject: [rabbitmq-discuss] the problem about the consumer connection
 can be closed
In-Reply-To: <1351683312763-22996.post@n5.nabble.com>
References: <1351683312763-22996.post@n5.nabble.com>
Message-ID: <509111C1.3080702@rabbitmq.com>

Hi Andy,

On 31/10/12 11:35, andy lin wrote:
>   the rabbitServer log has some  messages  as follows :
> closing AMQP connection <0.23889.27> (192.168.80.20:53035 ->
> 192.168.80.23:5672): {inet_error,ehostunreach}

This is a POSIX error with the following description:
"The destination host cannot be reached (probably because the host is 
down or a remote router cannot reach it)."

> so after some time ,the queue will head up some many messages, the consumers
> don't receive any more.But the consumers don't have any exceptions ,so Could
> you tell me What situations can cause the problem? Thank  you

There was probably a network connectivity problem, or the reported host 
is down. The benefit of a messaging broker is that service should resume 
when connectivity to the affected host is restored.


-Emile




From emamdouh at cloud9ers.com  Wed Oct 31 11:50:20 2012
From: emamdouh at cloud9ers.com (emamdouh)
Date: Wed, 31 Oct 2012 04:50:20 -0700 (PDT)
Subject: [rabbitmq-discuss] can't start rabbitmq-server
In-Reply-To: <EB21511F-D553-4690-B975-996C899C749D@rabbitmq.com>
References: <CAHAaT5u1eO3DcY5ZTa6UJe0bwUg2ep43AbtdopbYn5nWXjTHUA@mail.gmail.com>
	<CAH+xwdD7q0UVejP9HHhCBMspkO2X6dAn44qTXh6Qm0r2jSztTg@mail.gmail.com>
	<EB21511F-D553-4690-B975-996C899C749D@rabbitmq.com>
Message-ID: <1351684220193-22999.post@n5.nabble.com>

@Tim Watson-6 : yeah it seems connection between rabbitmq-server and epmd but
i don't think it's a firewall problem as this problem occurs of both
production and development environment which doesn't have any firewall setup
/ configured 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/can-t-start-rabbitmq-server-tp22942p22999.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From raphael.degiusti at guardis.com  Wed Oct 31 13:53:59 2012
From: raphael.degiusti at guardis.com (=?ISO-8859-1?Q?Rapha=EBl_De_GIUSTI?=)
Date: Wed, 31 Oct 2012 14:53:59 +0100
Subject: [rabbitmq-discuss] pika 0.9.6 and Reconnection Strategies
In-Reply-To: <CAKwdTWdWDMwfgjknMYTExsjkBspg8yHt9yXaX_hLgDmzC8Uqxw@mail.gmail.com>
References: <CAKwdTWcESvm1wdC0cMawFer3Kq_P6wCdf=Dz4oUjjgdiRiO0kg@mail.gmail.com>
	<1351490512146-22923.post@n5.nabble.com>
	<CAKwdTWdWDMwfgjknMYTExsjkBspg8yHt9yXaX_hLgDmzC8Uqxw@mail.gmail.com>
Message-ID: <CAFw-dinJEryFaBn+sm7miMj1Zb6j7aGjVBDAA7mNeCtgL6=isQ@mail.gmail.com>

Hi Gavin,

You mentionned giving an example that re-implements the
SimpleReconnectionStrategy class as a demo consumer in you first mail.
Any chance that you already did it ?

Thank you very much !

On Mon, Oct 29, 2012 at 3:45 PM, Gavin M. Roy <gmr at meetme.com> wrote:

> I'm working to get it up on pypi today.
>
>
> On Mon, Oct 29, 2012 at 2:01 AM, littypreethkr <littypreethkr at gmail.com>wrote:
>
>> Hi Gavin,
>>
>> When are you planning on releasing 0.9.6 version?
>>
>> Regards,
>> Litty Preeth
>>
>
> --
>
> Gavin M. Roy
> Chief Technology Officer
>
>  <http://www.meetme.com/>
> 100 Union Square Drive
> New Hope, PA 18938
> p. +1.215.862.1162 x263
> f. +1.215.862.0465
>
> <https://www.facebook.com/pages/MeetMe/21931227129>   <https://twitter.com/meetme>
>     <http://www.youtube.com/user/MeetMeVideos>
>
> The public market leader in social discovery. (NYSE MKT: MEET)
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/d47738e6/attachment.htm>

From gmr at meetme.com  Wed Oct 31 15:19:22 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Wed, 31 Oct 2012 11:19:22 -0400
Subject: [rabbitmq-discuss] consumer cancel notify support in pika
In-Reply-To: <50909034.70307@octavian.org>
References: <50909034.70307@octavian.org>
Message-ID: <CAKwdTWfOkvkp6WCDKeio1H9sGi4DRS=H3Luk_QkFs7VqA-Ce0g@mail.gmail.com>

1) Which version are you using?
2) Are you using an async Connection adapter or BlockingConnection?
3) Did you register for a callback?
Channel.add_on_cancel_callback(your_callback_method)

If you think you're encountering a bug, please open a ticket at
https://github.com/pika/pika/issues<https://github.com/pika/pika/issues?state=open>

Regards,

Gavin

On Tue, Oct 30, 2012 at 10:43 PM, Peter A. Friend <pafriend at octavian.org>wrote:

> Greetings,
>
> I have set up a basic cluster of 3 rabbitmq servers on the same host for
> testing. The problem I am having is that consumers are not getting the
> cancel notification when the server containing a particular queue is
> stopped. None of the queues are durable, and at this point I am trying to
> avoid mirroring, though I noticed that even in mirroring mode the cancel
> notification is not received. I couldn't find any info on how to configure
> this in the python client, or if it is even supported.
>
> Thanks,
>
> Peter
> ______________________________**_________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.**rabbitmq.com<rabbitmq-discuss at lists.rabbitmq.com>
> https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss<https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>



-- 

Gavin M. Roy
Chief Technology Officer

 <http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

<https://www.facebook.com/pages/MeetMe/21931227129>
<https://twitter.com/meetme>
    <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/eaba8a49/attachment.htm>

From videlalvaro at gmail.com  Wed Oct 31 15:31:08 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 31 Oct 2012 16:31:08 +0100
Subject: [rabbitmq-discuss] Production ready C++ client library?
In-Reply-To: <CAAt2poK2Rdto3w+sidRLXNNwHS5Kh6uzqKFQ3cQN-pWfz2yJfQ@mail.gmail.com>
References: <CAE-zcqWL+t+g25i_VUHFj9_z_WrFpLX87xOMFHE0+E+tLnCoQg@mail.gmail.com>
	<CAAt2poK2Rdto3w+sidRLXNNwHS5Kh6uzqKFQ3cQN-pWfz2yJfQ@mail.gmail.com>
Message-ID: <CAMcAHLUjDENBuaLfiX4x7SYFHmyCaszOtc9ApxRrmdz_z+NmQA@mail.gmail.com>

Hi,

I've been testing RabbitMQ on a raspberrypi, I actually clustered 3 of them
and so far so good now.

You can see some screenshots here:
https://twitter.com/old_sound/status/263458492482985984

I'll be uploading a screencast I made later today.

Regards,

Alvaro

On Wed, Oct 31, 2012 at 3:15 AM, Alan Antonuk <alan.antonuk at gmail.com>wrote:

> A listing of C and C++ clients that work with RabbitMQ can be found here:
> http://www.rabbitmq.com/devtools.html#c-dev
>
> -Alan
>
>
> On Tue, Oct 30, 2012 at 8:53 PM, fred basset <fredbasset1000 at gmail.com>wrote:
>
>> Hi All,
>>
>> Is there a production ready C++ client library available for Rabbit
>> MQ?  I'm thinking of using Rabbit MQ on a small embedded Linux system.
>>
>> Thank you,
>> Fred
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/4c4422c6/attachment.htm>

From matwey.kornilov at gmail.com  Wed Oct 31 15:34:11 2012
From: matwey.kornilov at gmail.com (Matwey V.  Kornilov)
Date: Wed, 31 Oct 2012 19:34:11 +0400
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
	Plugin
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
	<CAM8fPiQxihYNGtO1vnXxe6u=SfsC7RbyS2X4+ZLdMnkw61Ehig@mail.gmail.com>
	<k6p89p$bkb$1@ger.gmane.org> <50910136.1040307@rabbitmq.com>
Message-ID: <k6rgdi$g82$1@ger.gmane.org>


You are quite right. Building community plugin RPM is a kind of pain. IMO, 
umbrella should be modernized somehow to provide a way to easily build 
plugin, providing that all *-devel packages are installed.


Simon MacMullen wrote:

> On 30/10/12 19:03, Matwey V. Kornilov wrote:
>> Is there a chance to see presence-exchange in official rabbitmq bundle?
> 
> We could discuss this on a per-plugin basis with plugin authors, but I
> suspect the *real* problem is that building community plugins from
> source is a pain.
> 
> I'm not sure I would just want to import every community plugin going,
> even if the authors were amenable. I keep wondering about providing some
> plugin building service instead.



From aaron.pfeifer at gmail.com  Wed Oct 31 15:35:52 2012
From: aaron.pfeifer at gmail.com (Aaron Pfeifer)
Date: Wed, 31 Oct 2012 11:35:52 -0400
Subject: [rabbitmq-discuss] Lost messages on dead-letter + ttl queue while
	process is restarted?
Message-ID: <CACxyq541-91WPbinDkdbZjZXWct3HyqKcc57_X=njHKk5e6n+Q@mail.gmail.com>

Hey guys -

I'm seeing some unexpected behaviors with lost messages and I wanted to
make sure that this is intended by RabbitMQ.

I have a queue called "messages.log" set up with the following
configuration:
* x-message-ttl: 15000 (15s)
* x-dead-letter-exchange: messages.retry
* durable: true

The expectation is that when I publish a persistent message to
"messages.log" it will sit in the queue for 15s, after which point it'll be
dead-lettered into the "messages.retry" exchange.

I'm seeing the following behaviors:
* When a persistent message is published to "messages.log", after 15s it
gets delivered to the "messages.retry" exchange and lands into the queue
bound to that exchange.
* When a persistent message is published to "messages.log" and the rabbitmq
process then gets force-stopped for less than 15s (i.e. total time for
stopping and starting rabbitmq is less than 15s), the message is still in
"messages.log" and eventually gets delivered to the "messages.retry"
exchange when the TTL is hit
* *However*, when a persistent message is published to "messages.log" and
the rabbitmq process then gets force-stopped for *more than 15s*, the
message disappears.  It's not in "messages.log" and it's not in the queue
bounded to "messages.retry".

My interpretation is that if the RabbitMQ process is not running when a
message's TTL is reached, then the message does not get properly
dead-lettered -- it, instead, just gets dropped on the floor.

Is my understanding correct? Is that the intended behavior?  If so, is
there any way to ensure that this message gets properly persisted /
recovered?

Thanks for any thoughts!

-Aaron
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/b038d247/attachment.htm>

From tinashechipomho at gmail.com  Wed Oct 31 12:06:03 2012
From: tinashechipomho at gmail.com (Tinashe)
Date: Wed, 31 Oct 2012 05:06:03 -0700 (PDT)
Subject: [rabbitmq-discuss] librabbitmq c++ client in VS C++2010
Message-ID: <86ad3f67-4adb-41c4-b0fc-21a7d22b753e@googlegroups.com>

Can someone just give me a step by step guide to compile the c++ client in 
Visual Studio, what I want to do is make a dll in VS C++ 2010.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/ca356c3d/attachment.htm>

From matthias at rabbitmq.com  Wed Oct 31 15:52:23 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 31 Oct 2012 15:52:23 +0000
Subject: [rabbitmq-discuss] Lost messages on dead-letter + ttl queue
 while process is restarted?
In-Reply-To: <CACxyq541-91WPbinDkdbZjZXWct3HyqKcc57_X=njHKk5e6n+Q@mail.gmail.com>
References: <CACxyq541-91WPbinDkdbZjZXWct3HyqKcc57_X=njHKk5e6n+Q@mail.gmail.com>
Message-ID: <50914937.7080100@rabbitmq.com>

Aaron,

On 31/10/12 15:35, Aaron Pfeifer wrote:
> My interpretation is that if the RabbitMQ process is not running when a
> message's TTL is reached, then the message does not get properly
> dead-lettered -- it, instead, just gets dropped on the floor.
>
> Is my understanding correct?

Yes.

> Is that the intended behavior?

No.

While idly browsing our code today I discovered this very bug. About 10 
seconds before I saw your post. Spooky.

We will get this fixed in a future release.

Regards,

Matthias.

From alan.antonuk at gmail.com  Wed Oct 31 16:00:57 2012
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Wed, 31 Oct 2012 12:00:57 -0400
Subject: [rabbitmq-discuss] librabbitmq c++ client in VS C++2010
In-Reply-To: <86ad3f67-4adb-41c4-b0fc-21a7d22b753e@googlegroups.com>
References: <86ad3f67-4adb-41c4-b0fc-21a7d22b753e@googlegroups.com>
Message-ID: <CAAt2poJUk_geTaqCSejrL4YJogWu49wx14nsqrUP4ok-bwGR5A@mail.gmail.com>

Check the rabbitmq-c README.md file:

https://github.com/alanxz/rabbitmq-c/blob/master/README.md

Follow the instructions for building with CMake

-Alan

On Wed, Oct 31, 2012 at 8:06 AM, Tinashe <tinashechipomho at gmail.com> wrote:

> Can someone just give me a step by step guide to compile the c++ client in
> Visual Studio, what I want to do is make a dll in VS C++ 2010.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/c5b703f7/attachment.htm>

From aaron.pfeifer at gmail.com  Wed Oct 31 16:26:10 2012
From: aaron.pfeifer at gmail.com (Aaron Pfeifer)
Date: Wed, 31 Oct 2012 12:26:10 -0400
Subject: [rabbitmq-discuss] Lost messages on dead-letter + ttl queue
 while process is restarted?
In-Reply-To: <50914937.7080100@rabbitmq.com>
References: <CACxyq541-91WPbinDkdbZjZXWct3HyqKcc57_X=njHKk5e6n+Q@mail.gmail.com>
	<50914937.7080100@rabbitmq.com>
Message-ID: <CACxyq57ciVK8ijCFz_ooEeNHpLJ=7cmxmp0aaq9hqq149pVbJw@mail.gmail.com>

Thanks for the info and getting back to me so quickly!  Glad to hear I
wasn't missing something.

-Aaron


On Wed, Oct 31, 2012 at 11:52 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Aaron,
>
>
> On 31/10/12 15:35, Aaron Pfeifer wrote:
>
>> My interpretation is that if the RabbitMQ process is not running when a
>> message's TTL is reached, then the message does not get properly
>> dead-lettered -- it, instead, just gets dropped on the floor.
>>
>> Is my understanding correct?
>>
>
> Yes.
>
>
>  Is that the intended behavior?
>>
>
> No.
>
> While idly browsing our code today I discovered this very bug. About 10
> seconds before I saw your post. Spooky.
>
> We will get this fixed in a future release.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/ad0cee10/attachment.htm>

From fredbasset1000 at gmail.com  Wed Oct 31 16:27:53 2012
From: fredbasset1000 at gmail.com (fred basset)
Date: Wed, 31 Oct 2012 09:27:53 -0700
Subject: [rabbitmq-discuss] Production ready C++ client library?
In-Reply-To: <CAMcAHLUjDENBuaLfiX4x7SYFHmyCaszOtc9ApxRrmdz_z+NmQA@mail.gmail.com>
References: <CAE-zcqWL+t+g25i_VUHFj9_z_WrFpLX87xOMFHE0+E+tLnCoQg@mail.gmail.com>
	<CAAt2poK2Rdto3w+sidRLXNNwHS5Kh6uzqKFQ3cQN-pWfz2yJfQ@mail.gmail.com>
	<CAMcAHLUjDENBuaLfiX4x7SYFHmyCaszOtc9ApxRrmdz_z+NmQA@mail.gmail.com>
Message-ID: <CAE-zcqWa6sj8pAPOvvRPeehzqE11K7PymOhgK-8Jgzu6=kx=uQ@mail.gmail.com>

Hi Alvaro,

Which client library are you using?  Discovered any issues so far?

TY,
Fred

On Wed, Oct 31, 2012 at 8:31 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:
> Hi,
>
> I've been testing RabbitMQ on a raspberrypi, I actually clustered 3 of them
> and so far so good now.
>
> You can see some screenshots here:
> https://twitter.com/old_sound/status/263458492482985984
>
> I'll be uploading a screencast I made later today.
>
> Regards,
>
> Alvaro
>
> On Wed, Oct 31, 2012 at 3:15 AM, Alan Antonuk <alan.antonuk at gmail.com>
> wrote:
>>
>> A listing of C and C++ clients that work with RabbitMQ can be found here:
>> http://www.rabbitmq.com/devtools.html#c-dev
>>
>> -Alan
>>
>>
>> On Tue, Oct 30, 2012 at 8:53 PM, fred basset <fredbasset1000 at gmail.com>
>> wrote:
>>>
>>> Hi All,
>>>
>>> Is there a production ready C++ client library available for Rabbit
>>> MQ?  I'm thinking of using Rabbit MQ on a small embedded Linux system.
>>>
>>> Thank you,
>>> Fred
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From videlalvaro at gmail.com  Wed Oct 31 16:32:03 2012
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 31 Oct 2012 17:32:03 +0100
Subject: [rabbitmq-discuss] Production ready C++ client library?
In-Reply-To: <CAE-zcqWa6sj8pAPOvvRPeehzqE11K7PymOhgK-8Jgzu6=kx=uQ@mail.gmail.com>
References: <CAE-zcqWL+t+g25i_VUHFj9_z_WrFpLX87xOMFHE0+E+tLnCoQg@mail.gmail.com>
	<CAAt2poK2Rdto3w+sidRLXNNwHS5Kh6uzqKFQ3cQN-pWfz2yJfQ@mail.gmail.com>
	<CAMcAHLUjDENBuaLfiX4x7SYFHmyCaszOtc9ApxRrmdz_z+NmQA@mail.gmail.com>
	<CAE-zcqWa6sj8pAPOvvRPeehzqE11K7PymOhgK-8Jgzu6=kx=uQ@mail.gmail.com>
Message-ID: <CAMcAHLXntk4ZjA5OJZ0Y5CJC+wffXZ-8ok10Uc-KqxutX9W+Hw@mail.gmail.com>

Hi,

I'm using the raspberry as server only so I haven't tried running a client
there.


From alal at adchemy.com  Wed Oct 31 17:09:41 2012
From: alal at adchemy.com (Anuj Lal)
Date: Wed, 31 Oct 2012 17:09:41 +0000
Subject: [rabbitmq-discuss] loadbalancer configuration for clustered
	rabbitmq cluster.
Message-ID: <E28E44216D833A45A77BB45901475E8412CE2C91@BY2PRD0511MB416.namprd05.prod.outlook.com>

I have set up clustered HA two node rabitmq cluster ? one running in file mode and other in in memory.
This takes cares of continued flow of messages if one node in cluster is down. I am still testing this scenario.

Load balancing to consumer side ( worker queue or consistent hash  exchange etc) is working. I have got question regarding some load balancing from producer to broker side.

Lets say our load requirement is very very high and one cluster of rabbitMQ is not sufficient to handle  that large load.  To handle very large load,  and to test this configuration I am thinking about create another cluster of rabbitMQ and put both cluster nodes behind  load balancer.  I have  following question


  1.  Is this  approach recommended or tried by anyone.
  2.  What configuration I need to specify in load balancer ? For example, I need to specify server addresses in load balancer. If I have cluster of server, can I specify  like this

            server  cluster1server1.dev.aws.xyz.net:5672,cluster1server2.dev.aws.xyz.net:5672
    server  cluster2server1.dev.aws.xyz.net:5672,cluster2server2.dev.aws.xyz.net:5672

   3. If I don't use load balancer, I use cache of connection like this
      <bean id="connectionFactory"
class="org.springframework.amqp.rabbit.connection.CachingConnectionFactory">
<property name="username" value="${message.broker.apr.userName}" />
<property name="password" value="${message.broker.apr.password}" />
<property name="channelCacheSize" value="${message.broker.numberOfCachedChannelsForBroker}" />
<property name="addresses" value="
cluster1server1.dev.aws.xyz.net:5672,cluster1server2.dev.aws.xyz.net:5672"  />
</bean>

        How can I specify these if I am using load balancer?

In short anybody has used clustered HA rabbitmq behind loadbalancer.  If this option is not recommended than other option I was thinking about cadd more node in a sinle cluster and add other exchange and node, but in that case publisher is going to do round robin kind of mechanish to balance load between two exchanges.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/e22b815b/attachment.htm>

From Bin.Chen at kla-tencor.com  Wed Oct 31 17:15:58 2012
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Wed, 31 Oct 2012 10:15:58 -0700
Subject: [rabbitmq-discuss] rabbit_mgmt_db crashed
In-Reply-To: <50910655.6040109@rabbitmq.com>
References: <BCC407A444557E41B0D8B0260D684992058F70B8@CA1EXCLV07.adcorp.kla-tencor.com>
	<50910655.6040109@rabbitmq.com>
Message-ID: <BCC407A444557E41B0D8B0260D684992058F71AE@CA1EXCLV07.adcorp.kla-tencor.com>

Hi Simon,

Yes, I posted a message for the same problem before.
I was using 2.7.1 32-bit version.
Now I am using 2.8.6 64-bit version.

Unfortunately I've restarted the server to fix the memory issue.
I will run your code if it happens again.

BTW, 
Is rabbit_mgmt_db part of management plug-in?
Do you think this problem can be avoided if I remove the management
plug-in?

Thanks,
--Bin Chen


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Wednesday, October 31, 2012 4:07 AM
To: Discussions about RabbitMQ
Cc: Chen, Bin
Subject: Re: [rabbitmq-discuss] rabbit_mgmt_db crashed

Hi. I remember you posted a similar stack trace six months ago:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/019990.htm
l

I stared at the code involved for some time but was completely unable to
see how that could occur. I don't suppose you have any way to replicate
this?

Apart from that, could you post the output of:

rabbitmqctl.bat eval
"lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory),
Pid, process_info(Pid)} || Pid <- processes()])), 30)."

(all on one line)

and

rabbitmqctl.bat report

somewhere please?

Cheers, Simon

On 31/10/12 00:09, Chen, Bin wrote:
> Hello,
>
> I just noticed a crash report in sasl log of one of our RMQ server.
>
> It seems the management plug-in crashed. The management web page 
> cannot be opened any more.
>
> I had this problem before with an old version. Now I am using 2.8.6 
> 64-bit version on Windows 2008 Server.
>
> The RMQ server is still running fine, but the memory utilization is 
> much higher than other similar servers without such crash.
>
> This "bad" server uses about 8 GB memory now, while other normal 
> servers use only about 500 MB memory.
>
> It may eventually hit the high memory water mark soon at 9.6 GB.
>
> Here is the complete crash report.
>
> =CRASH REPORT==== 29-Oct-2012::23:01:08 ===
>
>    crasher:
>
>      initial call: rabbit_mgmt_db:init/1
>
>      pid: <0.284.0>
>
>      registered_name: []
>
>      exception exit: {badarith,
>
>                          [{rabbit_mgmt_db,rate,5,[]},
>
>                           {rabbit_mgmt_db,'-rates/5-lc$^0/1-0-',5,[]},
>
>                           {rabbit_mgmt_db,'-rates/5-lc$^1/1-1-',6,[]},
>
>                           {rabbit_mgmt_db,rates,5,[]},
>
>                           {rabbit_mgmt_db,handle_fine_stat,7,[]},
>
>
> {rabbit_mgmt_db,'-handle_fine_stats/4-lc$^1/1-1-',4,
>
>                               []},
>
>
>         {rabbit_mgmt_db,'-handle_event/2-lc$^1/1-0-',4,[]},
>
>                           {rabbit_mgmt_db,handle_event,2,[]}]}
>
>        in function  gen_server:terminate/6 (gen_server.erl, line 747)
>
>      ancestors: [<0.281.0>,rabbit_mgmt_sup,<0.262.0>]
>
>      messages: [{'$gen_cast',
>
>                        {event,
>
>                            {event,channel_stats,
>
>                                [{pid,<0.12756.396>},
>
>                                 {transactional,false},
>
>                                 {confirm,false},
>
>                                 {consumer_count,0},
>
>                                 {messages_unacknowledged,0},
>
>                                 {messages_unconfirmed,0},
>
>                                 {messages_uncommitted,0},
>
>                                 {acks_uncommitted,0},
>
>                                 {prefetch_count,1},
>
>                                 {client_flow_blocked,false},
>
>                                 {channel_queue_stats,[]},
>
>                                 {channel_exchange_stats,[]},
>
>                                 {channel_queue_exchange_stats,[]}],
>
>                                {1351,576868,812003}}}}]
>
>      links: [<0.281.0>]
>
>      dictionary: []
>
>      trap_exit: false
>
>      status: running
>
>      heap_size: 6765
>
>      stack_size: 24
>
>      reductions: 3730467164
>
>    neighbours:
>
> Here is the output of "rabbitmqctl.bat status"
>
> Status of node rabbit at RACK4UNIT001 ...
>
> [{pid,4708},
>
> {running_applications,
>
>       [{rabbitmq_management,"RabbitMQ Management Console","2.8.6"},
>
>        {rabbitmq_management_agent,"RabbitMQ Management 
> Agent","2.8.6"},
>
>        {amqp_client,"RabbitMQ AMQP Client","2.8.6"},
>
>        {rabbit,"RabbitMQ","2.8.6"},
>
>        {os_mon,"CPO  CXC 138 46","2.2.10"},
>
>        {sasl,"SASL  CXC 138 11","2.2.1"},
>
>        {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.6"},
>
>        {webmachine,"webmachine","1.9.1-rmq2.8.6-git52e62bc"},
>
>        {mochiweb,"MochiMedia Web Server","2.3.1-rmq2.8.6-gitd541e9a"},
>
>        {xmerl,"XML parser","1.3.2"},
>
>        {inets,"INETS  CXC 138 49","5.9.1"},
>
>        {mnesia,"MNESIA  CXC 138 12","4.7.1"},
>
>        {stdlib,"ERTS  CXC 138 10","1.18.2"},
>
>        {kernel,"ERTS  CXC 138 10","2.15.2"}]},
>
> {os,{win32,nt}},
>
> {erlang_version,
>
>       "Erlang R15B02 (erts-5.9.2) [64-bit] [smp:12:12] 
> [async-threads:30]\n"},
>
> {memory,
>
>       [{total,8512001360},
>
>        {processes,7401925315},
>
>        {processes_used,7401754972},
>
>        {system,1110076045},
>
>        {atom,662409},
>
>        {atom_used,652416},
>
>        {binary,857726336},
>
>        {code,17969722},
>
>        {ets,4550280}]},
>
> {vm_memory_high_watermark,0.4},
>
> {vm_memory_limit,10304190873},
>
> {disk_free_limit,1000000000},
>
> {disk_free,39365828608},
>
> {file_descriptors,
>
>       [{total_limit,16284},
>
>        {total_used,142},
>
>        {sockets_limit,14653},
>
>        {sockets_used,113}]},
>
> {processes,[{limit,1048576},{used,5986}]},
>
> {run_queue,0},
>
> {uptime,104350}]
>
> ...done.
>
> Best regards,
>
> --Bin Chen
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, VMware

From simon at rabbitmq.com  Wed Oct 31 17:17:45 2012
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 31 Oct 2012 17:17:45 +0000
Subject: [rabbitmq-discuss] rabbit_mgmt_db crashed
In-Reply-To: <BCC407A444557E41B0D8B0260D684992058F71AE@CA1EXCLV07.adcorp.kla-tencor.com>
References: <BCC407A444557E41B0D8B0260D684992058F70B8@CA1EXCLV07.adcorp.kla-tencor.com>
	<50910655.6040109@rabbitmq.com>
	<BCC407A444557E41B0D8B0260D684992058F71AE@CA1EXCLV07.adcorp.kla-tencor.com>
Message-ID: <50915D39.3090109@rabbitmq.com>

On 31/10/12 17:15, Chen, Bin wrote:
> Is rabbit_mgmt_db part of management plug-in?

Yes.

> Do you think this problem can be avoided if I remove the management
> plug-in?

Yes. But I'd like to find out what problem you are actually seeing!

Do you still have logs? If so can you post them somewhere?

Cheers, Simon
-- 
Simon MacMullen
RabbitMQ, VMware

From pfriend at gehrytech.com  Wed Oct 31 15:52:31 2012
From: pfriend at gehrytech.com (Peter Friend)
Date: Wed, 31 Oct 2012 10:52:31 -0500
Subject: [rabbitmq-discuss] consumer cancel notify support in pika
In-Reply-To: <CAKwdTWfOkvkp6WCDKeio1H9sGi4DRS=H3Luk_QkFs7VqA-Ce0g@mail.gmail.com>
References: <50909034.70307@octavian.org>
	<CAKwdTWfOkvkp6WCDKeio1H9sGi4DRS=H3Luk_QkFs7VqA-Ce0g@mail.gmail.com>
Message-ID: <B1D697B6-93E6-44DF-8336-86E0EC1BD9F1@gt-global.com>



On Oct 31, 2012, at 8:20 AM, "Gavin M. Roy" <gmr at meetme.com<mailto:gmr at meetme.com>> wrote:

1) Which version are you using?

0.9.5. The 0.9.6 version has method signature changes that make it incompatible with most of the docs out there and I had trouble getting it to work.

2) Are you using an async Connection adapter or BlockingConnection?

I have tried both.

3) Did you register for a callback? Channel.add_on_cancel_callback(your_callback_method)

I have tried when using BlockingConnection but not the asynchronous one yet. My understanding from the docs was that an exception would be thrown in consume(). Is that not correct?




If you think you're encountering a bug, please open a ticket at https://github.com/pika/pika/issues<https://github.com/pika/pika/issues?state=open>

Regards,

Gavin

On Tue, Oct 30, 2012 at 10:43 PM, Peter A. Friend <pafriend at octavian.org<mailto:pafriend at octavian.org>> wrote:
Greetings,

I have set up a basic cluster of 3 rabbitmq servers on the same host for testing. The problem I am having is that consumers are not getting the cancel notification when the server containing a particular queue is stopped. None of the queues are durable, and at this point I am trying to avoid mirroring, though I noticed that even in mirroring mode the cancel notification is not received. I couldn't find any info on how to configure this in the python client, or if it is even supported.

Thanks,

Peter
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



--

Gavin M. Roy
Chief Technology Officer

[http://movies.myyearbook.com/emailsignatureimages/logo2.png]<http://www.meetme.com/>
100 Union Square Drive
New Hope, PA 18938
p. +1.215.862.1162 x263
f. +1.215.862.0465

[http://movies.myyearbook.com/emailsignatureimages/fb_mini.gif]<https://www.facebook.com/pages/MeetMe/21931227129>   [http://movies.myyearbook.com/emailsignatureimages/tw_mini.gif] <https://twitter.com/meetme>    [http://movies.myyearbook.com/emailsignatureimages/yt_mini.gif] <http://www.youtube.com/user/MeetMeVideos>

The public market leader in social discovery. (NYSE MKT: MEET)

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/15339527/attachment.htm>

From gmr at meetme.com  Wed Oct 31 18:12:59 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Wed, 31 Oct 2012 14:12:59 -0400
Subject: [rabbitmq-discuss] consumer cancel notify support in pika
In-Reply-To: <B1D697B6-93E6-44DF-8336-86E0EC1BD9F1@gt-global.com>
References: <50909034.70307@octavian.org>
	<CAKwdTWfOkvkp6WCDKeio1H9sGi4DRS=H3Luk_QkFs7VqA-Ce0g@mail.gmail.com>
	<B1D697B6-93E6-44DF-8336-86E0EC1BD9F1@gt-global.com>
Message-ID: <CAKwdTWdQ08pkaZmxXLkLwm2snx-89qACMf_WCKt0tfkqBMFeCQ@mail.gmail.com>

On Wed, Oct 31, 2012 at 11:52 AM, Peter Friend <pfriend at gehrytech.com>wrote:
>
> 1) Which version are you using?
>
> 0.9.5.
>

0.9.5 didn't pay as close attention to the protocol as 0.9.6 does. I'd
recommend 0.9.6 at this point, especially for RPC calls from RabbitMQ.


> The 0.9.6 version has method signature changes that make it incompatible
> with most of the docs out there and I had trouble getting it to work.
>

Hmm which methods changed that you're having problems with?  Also docs
should be up to date at
https://pika.readthedocs.org/<https://pika.readthedocs.org/en/0.9.6/index.html>
--
let me know if you're having any problems with them.

> 3) Did you register for a callback?
> Channel.add_on_cancel_callback(your_callback_method)
>
> I have tried when using BlockingConnection but not the asynchronous one
> yet. My understanding from the docs was that an exception would be thrown
> in consume(). Is that not correct?
>

The problem with BlockingConnection in 0.9.5 is it doesn't pay attention to
what RabbitMQ is telling it to do, unless you explicitly tell it to do so.
It's likely a bug related to that causing your issue.

Here is an async consumer example that uses 0.9.6 and handles Basic.Cancel
being invoked by RabbitMQ:

https://pika.readthedocs.org/en/latest/examples/asynchronous_consumer_example.html

In the blocking connection, you should see a
pika.exceptions.ConsumerCancelled exception raised.

Hope this helps,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/a1eb7c2c/attachment.htm>

From Bin.Chen at kla-tencor.com  Wed Oct 31 18:48:43 2012
From: Bin.Chen at kla-tencor.com (Chen, Bin)
Date: Wed, 31 Oct 2012 11:48:43 -0700
Subject: [rabbitmq-discuss] rabbit_mgmt_db crashed
In-Reply-To: <50910655.6040109@rabbitmq.com>
References: <BCC407A444557E41B0D8B0260D684992058F70B8@CA1EXCLV07.adcorp.kla-tencor.com>
	<50910655.6040109@rabbitmq.com>
Message-ID: <BCC407A444557E41B0D8B0260D684992058F7213@CA1EXCLV07.adcorp.kla-tencor.com>

Hi Simon,

I found the similar crash reports on another RMQ server.
It had happened a few times.
However, the memory utilization didn't went up greatly as another
server.

Two of the attached zip files are the eval output and report output.
The other one is the sasl log file containing the crash reports.

 
Thanks,
--Bin Chen


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Wednesday, October 31, 2012 4:07 AM
To: Discussions about RabbitMQ
Cc: Chen, Bin
Subject: Re: [rabbitmq-discuss] rabbit_mgmt_db crashed

Hi. I remember you posted a similar stack trace six months ago:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-May/019990.htm
l

I stared at the code involved for some time but was completely unable to
see how that could occur. I don't suppose you have any way to replicate
this?

Apart from that, could you post the output of:

rabbitmqctl.bat eval
"lists:sublist(lists:reverse(lists:sort([{process_info(Pid, memory),
Pid, process_info(Pid)} || Pid <- processes()])), 30)."

(all on one line)

and

rabbitmqctl.bat report

somewhere please?

Cheers, Simon

On 31/10/12 00:09, Chen, Bin wrote:
> Hello,
>
> I just noticed a crash report in sasl log of one of our RMQ server.
>
> It seems the management plug-in crashed. The management web page 
> cannot be opened any more.
>
> I had this problem before with an old version. Now I am using 2.8.6 
> 64-bit version on Windows 2008 Server.
>
> The RMQ server is still running fine, but the memory utilization is 
> much higher than other similar servers without such crash.
>
> This "bad" server uses about 8 GB memory now, while other normal 
> servers use only about 500 MB memory.
>
> It may eventually hit the high memory water mark soon at 9.6 GB.
>
> Here is the complete crash report.
>
> =CRASH REPORT==== 29-Oct-2012::23:01:08 ===
>
>    crasher:
>
>      initial call: rabbit_mgmt_db:init/1
>
>      pid: <0.284.0>
>
>      registered_name: []
>
>      exception exit: {badarith,
>
>                          [{rabbit_mgmt_db,rate,5,[]},
>
>                           {rabbit_mgmt_db,'-rates/5-lc$^0/1-0-',5,[]},
>
>                           {rabbit_mgmt_db,'-rates/5-lc$^1/1-1-',6,[]},
>
>                           {rabbit_mgmt_db,rates,5,[]},
>
>                           {rabbit_mgmt_db,handle_fine_stat,7,[]},
>
>
> {rabbit_mgmt_db,'-handle_fine_stats/4-lc$^1/1-1-',4,
>
>                               []},
>
>
>         {rabbit_mgmt_db,'-handle_event/2-lc$^1/1-0-',4,[]},
>
>                           {rabbit_mgmt_db,handle_event,2,[]}]}
>
>        in function  gen_server:terminate/6 (gen_server.erl, line 747)
>
>      ancestors: [<0.281.0>,rabbit_mgmt_sup,<0.262.0>]
>
>      messages: [{'$gen_cast',
>
>                        {event,
>
>                            {event,channel_stats,
>
>                                [{pid,<0.12756.396>},
>
>                                 {transactional,false},
>
>                                 {confirm,false},
>
>                                 {consumer_count,0},
>
>                                 {messages_unacknowledged,0},
>
>                                 {messages_unconfirmed,0},
>
>                                 {messages_uncommitted,0},
>
>                                 {acks_uncommitted,0},
>
>                                 {prefetch_count,1},
>
>                                 {client_flow_blocked,false},
>
>                                 {channel_queue_stats,[]},
>
>                                 {channel_exchange_stats,[]},
>
>                                 {channel_queue_exchange_stats,[]}],
>
>                                {1351,576868,812003}}}}]
>
>      links: [<0.281.0>]
>
>      dictionary: []
>
>      trap_exit: false
>
>      status: running
>
>      heap_size: 6765
>
>      stack_size: 24
>
>      reductions: 3730467164
>
>    neighbours:
>
> Here is the output of "rabbitmqctl.bat status"
>
> Status of node rabbit at RACK4UNIT001 ...
>
> [{pid,4708},
>
> {running_applications,
>
>       [{rabbitmq_management,"RabbitMQ Management Console","2.8.6"},
>
>        {rabbitmq_management_agent,"RabbitMQ Management 
> Agent","2.8.6"},
>
>        {amqp_client,"RabbitMQ AMQP Client","2.8.6"},
>
>        {rabbit,"RabbitMQ","2.8.6"},
>
>        {os_mon,"CPO  CXC 138 46","2.2.10"},
>
>        {sasl,"SASL  CXC 138 11","2.2.1"},
>
>        {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","2.8.6"},
>
>        {webmachine,"webmachine","1.9.1-rmq2.8.6-git52e62bc"},
>
>        {mochiweb,"MochiMedia Web Server","2.3.1-rmq2.8.6-gitd541e9a"},
>
>        {xmerl,"XML parser","1.3.2"},
>
>        {inets,"INETS  CXC 138 49","5.9.1"},
>
>        {mnesia,"MNESIA  CXC 138 12","4.7.1"},
>
>        {stdlib,"ERTS  CXC 138 10","1.18.2"},
>
>        {kernel,"ERTS  CXC 138 10","2.15.2"}]},
>
> {os,{win32,nt}},
>
> {erlang_version,
>
>       "Erlang R15B02 (erts-5.9.2) [64-bit] [smp:12:12] 
> [async-threads:30]\n"},
>
> {memory,
>
>       [{total,8512001360},
>
>        {processes,7401925315},
>
>        {processes_used,7401754972},
>
>        {system,1110076045},
>
>        {atom,662409},
>
>        {atom_used,652416},
>
>        {binary,857726336},
>
>        {code,17969722},
>
>        {ets,4550280}]},
>
> {vm_memory_high_watermark,0.4},
>
> {vm_memory_limit,10304190873},
>
> {disk_free_limit,1000000000},
>
> {disk_free,39365828608},
>
> {file_descriptors,
>
>       [{total_limit,16284},
>
>        {total_used,142},
>
>        {sockets_limit,14653},
>
>        {sockets_used,113}]},
>
> {processes,[{limit,1048576},{used,5986}]},
>
> {run_queue,0},
>
> {uptime,104350}]
>
> ...done.
>
> Best regards,
>
> --Bin Chen
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


--
Simon MacMullen
RabbitMQ, VMware
-------------- next part --------------
A non-text attachment was scrubbed...
Name: report-output.zip
Type: application/x-zip-compressed
Size: 51941 bytes
Desc: report-output.zip
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/1876792b/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: eval-output.zip
Type: application/x-zip-compressed
Size: 492573 bytes
Desc: eval-output.zip
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/1876792b/attachment-0001.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at RACK3UNIT001-sasl.log.2012.10.31-10.00.00.zip
Type: application/x-zip-compressed
Size: 2130 bytes
Desc: rabbit at RACK3UNIT001-sasl.log.2012.10.31-10.00.00.zip
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/1876792b/attachment-0002.bin>

From pfriend at gehrytech.com  Wed Oct 31 21:03:18 2012
From: pfriend at gehrytech.com (Peter Friend)
Date: Wed, 31 Oct 2012 16:03:18 -0500
Subject: [rabbitmq-discuss] consumer cancel notify support in pika
In-Reply-To: <CAKwdTWdQ08pkaZmxXLkLwm2snx-89qACMf_WCKt0tfkqBMFeCQ@mail.gmail.com>
References: <50909034.70307@octavian.org>
	<CAKwdTWfOkvkp6WCDKeio1H9sGi4DRS=H3Luk_QkFs7VqA-Ce0g@mail.gmail.com>
	<B1D697B6-93E6-44DF-8336-86E0EC1BD9F1@gt-global.com>
	<CAKwdTWdQ08pkaZmxXLkLwm2snx-89qACMf_WCKt0tfkqBMFeCQ@mail.gmail.com>
Message-ID: <10AD22196924954389ADAB923E16F65715437EB0EA@DFW1MBX10.mex07a.mlsrvr.com>

Here are the issues I've had so far with 0.9.6:

1. exchange_declare() type arg is now exchange_type
2. Ran into problems with RPC type calls. In 0.9.5 the docs for channel has:
               queue_declare(self, callback=None, ticket=0, queue='', passive=False, durable=False, exclusive=False, auto_delete=False, nowait=False, arguments={})
   and in 0.9.6:
               queue_declare(self, callback, queue, passive=False, durable=False, exclusive=False, auto_delete=False, nowait=False, arguments=None)

   The callback and queue args are required now so a line that used to be:
               result = channel.queue_declare(exclusive=True, auto_delete=True) should presumably now be:
               result = channel.queue_declare(callback=None, queue='', exclusive=True, auto_delete=True)
   However that results in this error:
               TypeError: queue_declare() got an unexpected keyword argument 'callback'

   This appears to be due to my use of BlockingConnection, so the code actually has to be:
               result = channel.queue_declare(queue='', exclusive=True, auto_delete=True)

   This is confusing if you are reading the docs for channel, and is a behavior change from 0.9.5.

Checking out the async consumer example now, thanks.

Peter





From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin M. Roy
Sent: Wednesday, October 31, 2012 11:13 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] consumer cancel notify support in pika


On Wed, Oct 31, 2012 at 11:52 AM, Peter Friend <pfriend at gehrytech.com<mailto:pfriend at gehrytech.com>> wrote:
1) Which version are you using?
0.9.5.

0.9.5 didn't pay as close attention to the protocol as 0.9.6 does. I'd recommend 0.9.6 at this point, especially for RPC calls from RabbitMQ.

The 0.9.6 version has method signature changes that make it incompatible with most of the docs out there and I had trouble getting it to work.

Hmm which methods changed that you're having problems with?  Also docs should be up to date at https://pika.readthedocs.org/<https://pika.readthedocs.org/en/0.9.6/index.html> -- let me know if you're having any problems with them.
3) Did you register for a callback? Channel.add_on_cancel_callback(your_callback_method)
I have tried when using BlockingConnection but not the asynchronous one yet. My understanding from the docs was that an exception would be thrown in consume(). Is that not correct?

The problem with BlockingConnection in 0.9.5 is it doesn't pay attention to what RabbitMQ is telling it to do, unless you explicitly tell it to do so. It's likely a bug related to that causing your issue.

Here is an async consumer example that uses 0.9.6 and handles Basic.Cancel being invoked by RabbitMQ:

https://pika.readthedocs.org/en/latest/examples/asynchronous_consumer_example.html

In the blocking connection, you should see a pika.exceptions.ConsumerCancelled exception raised.

Hope this helps,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/cc6e1c7e/attachment.htm>

From olda.esner at gmail.com  Wed Oct 31 21:25:01 2012
From: olda.esner at gmail.com (=?UTF-8?Q?Olda_E=C5=A1ner?=)
Date: Wed, 31 Oct 2012 14:25:01 -0700 (PDT)
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
 Plugin
In-Reply-To: <CAAFAKh7p-oOBeKQuYJneCrH46ZVaC0TRNccEfGgZq8TMstQSTg@mail.gmail.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
	<508FE465.4080408@rabbitmq.com>
	<CAAFAKh4CeV5LR6EonW_HqLUWWBbCbsOkYwh9CYOArWt2LCymCw@mail.gmail.com>
	<CAAFAKh7p-oOBeKQuYJneCrH46ZVaC0TRNccEfGgZq8TMstQSTg@mail.gmail.com>
Message-ID: <2d3ab9a5-24b2-4eec-81fa-865fc81fff8e@googlegroups.com>

I tried following:
- cloned rabbitmq-public-umbrella
- inside rabbitmq-public-umbrella directory I created presence-exchange 
folder with current GIT presence-exchange plugin
- build "make VERSION=2.8.7" inside presence-exchange folder, everything 
was successful
- after copying rabbit-presence-exchange-0.0.0.ez into rabbitmq-2.8.7 
plugin folder and restarting rabbit server still the same error appears

Have any of you tried whether presence-exchange plugin is really compatible 
with the latest rabbitmq stable version (2.8.7)?

Thank you very much for any help.

Oldrich

Dne ?ter?, 30. ??jna 2012 18:35:02 UTC-7 Olda E?ner napsal(a):
>
> Bad news, plugins seems to work in management console (x-presence exchange 
> isn't in "red" state) but after binding x-presence exchange to queue, 
> rabbit server log writes the following:
>
> =ERROR REPORT==== 31-Oct-2012::02:22:37 ===
> ** Generic server <0.131.0> terminating
> ** Last message in was {'$gen_cast',
>                            {submit_async,#Fun<rabbit_binding.3.58413561>}}
> ** When Server state == 2
> ** Reason for termination == 
> ** {function_clause,
>        [{presence_exchange,add_binding,
>             [none,
>              {exchange,
>                  {resource,<<"/">>,exchange,<<"xpresence">>},
>                  'x-presence',true,false,false,[],undefined},
>              {binding,
>                  {resource,<<"/">>,exchange,<<"xpresence">>},
>                  <<>>,
>                  {resource,<<"/">>,queue,<<"qpresence">>},
>                  []}],
>             []},
>         {rabbit_binding,x_callback,4,[]},
>         {rabbit_binding,'-recover_semi_durable_route/3-fun-0-',3,[]},
>         {worker_pool_worker,handle_cast,2,[]},
>         {gen_server2,handle_msg,2,[]},
>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]} 
>
> =ERROR REPORT==== 31-Oct-2012::02:19:08 ===
> ** Generic server <0.1023.0> terminating
> ** Last message in was {'$gen_cast',
>                            {method,
>                                {'queue.bind',0,
>                                    
> <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>,
>                                    <<"xpresence">>,<<>>,false,[]},
>                                none,noflow}}
> ** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,1,<0.1019.0>,
>                             <0.1021.0>,<0.1019.0>,
>                             "127.0.0.1:54877 -> 127.0.0.1:5672",
>                             {token,<0.1022.0>,false},
>                             none,1,
>                             {[],[]},
>                             {[],[]},
>                             [],[],
>                             {user,<<"guest">>,
>                                 [administrator],
>                                 rabbit_auth_backend_internal,
>                                 {internal_user,<<"guest">>,
>                                     
> <<238,155,95,210,98,65,149,74,208,144,18,
>                                       191,58,228,155,137,230,224,252,199>>,
>                                     [administrator]}},
>                             <<"/">>,
>                             <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>,
>                             {dict,0,16,16,8,80,48,
>                                 
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}},
>                             {dict,0,16,16,8,80,48,
>                                 
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}},
>                             {set,0,16,16,8,80,48,
>                                 
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}},
>                             {dict,0,16,16,8,80,48,
>                                 
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}},
>                             {set,0,16,16,8,80,48,
>                                 
> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []},
>                                 
> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                   [],[]}}},
>                             <0.1017.0>,
>                             {state,fine,5000,#Ref<0.0.0.8440>},
>                             false,1,
>                             {{0,nil},{0,nil}},
>                             [],
>                             [{<<"exchange_exchange_bindings">>,bool,true},
>                              {<<"consumer_cancel_notify">>,bool,true},
>                              {<<"basic.nack">>,bool,true},
>                              {<<"publisher_confirms">>,bool,true}],
>                             none}
> ** Reason for termination == 
> ** {function_clause,
>        [{presence_exchange,add_binding,
>             [none,
>              {exchange,
>                  {resource,<<"/">>,exchange,<<"xpresence">>},
>                  'x-presence',true,false,false,[],undefined},
>              {binding,
>                  {resource,<<"/">>,exchange,<<"xpresence">>},
>                  <<>>,
>                  {resource,<<"/">>,queue,
>                      <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>},
>                  []}],
>             []},
>         {rabbit_binding,'-add/3-fun-0-',3,[]},
>         {rabbit_channel,binding_action,9,[]},
>         {rabbit_channel,handle_cast,2,[]},
>         {gen_server2,handle_msg,2,[]},
>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
>
> =ERROR REPORT==== 31-Oct-2012::02:19:08 ===
> AMQP connection <0.1019.0>, channel 1 - error:
> {function_clause,
>     [{presence_exchange,add_binding,
>          [none,
>           {exchange,
>               {resource,<<"/">>,exchange,<<"xpresence">>},
>               'x-presence',true,false,false,[],undefined},
>           {binding,
>               {resource,<<"/">>,exchange,<<"xpresence">>},
>               <<>>,
>               {resource,<<"/">>,queue,
>                   <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>},
>               []}],
>          []},
>      {rabbit_binding,'-add/3-fun-0-',3,[]},
>      {rabbit_channel,binding_action,9,[]},
>      {rabbit_channel,handle_cast,2,[]},
>      {gen_server2,handle_msg,2,[]},
>      {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
>
> =WARNING REPORT==== 31-Oct-2012::02:19:08 ===
> Non-AMQP exit reason '{function_clause,
>                        [{presence_exchange,add_binding,
>                          [none,
>                           {exchange,
>                            {resource,<<"/">>,exchange,<<"xpresence">>},
>                            'x-presence',true,false,false,[],undefined},
>                           {binding,
>                            {resource,<<"/">>,exchange,<<"xpresence">>},
>                            <<>>,
>                            {resource,<<"/">>,queue,
>                             <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>},
>                            []}],
>                          []},
>                         {rabbit_binding,'-add/3-fun-0-',3,[]},
>                         {rabbit_channel,binding_action,9,[]},
>                         {rabbit_channel,handle_cast,2,[]},
>                         {gen_server2,handle_msg,2,[]},
>                         {proc_lib,init_p_do_apply,3,
>                          [{file,"proc_lib.erl"},{line,227}]}]}' 
>
> Is any of you able to find a source of problem? We are using Java EE 
> application with spring-rabbit and spring-amqp libraries.
>
> Thank you.
>
> Oldrich
>
> 2012/10/30 Old?ich E?ner <olda.esner at gmail.com>
>
>> Thank you very much for the fastest fix I have ever seen :)
>>
>> If you want to update downloads section, I'm including current ez build 
>> of presence plugin.
>>
>> Regards,
>>
>> Oldrich
>>
>>
>> 2012/10/30 Simon MacMullen <simon at rabbitmq.com>
>>
>>> On 30/10/12 14:18, Tony Garnock-Jones wrote:
>>>
>>>> On 30 October 2012 00:27, Olda E?ner <olda.esner at gmail.com
>>>> <mailto:olda.esner at gmail.com>> wrote:
>>>>
>>>>     after upgrading to RabbitMQ 2.8.6 from 2.8.5, presence-exchange
>>>>     plugin doesn't work. Is there any chance to fix it?
>>>>
>>>>
>>>> It's a consequence of the removal from the server's core of support for
>>>> "immediate" publication. At least rabbithub and the udp-exchange will
>>>> also have to be updated. The fix should be straightforward.
>>>>
>>>
>>> ...although that's happened on default, not 2.8.6.
>>>
>>> To the OP: you might need to get the un-updated version of the plugin 
>>> source, and then build that against the 2.8.6 source download.
>>>
>>> Alternatively, whatever plugin binary you created for 2.8.5 should still 
>>> work, I don't think any APIs changed?
>>>
>>>
>>>  I'll email again when I'm done. Shouldn't be long.
>>>>
>>>
>>> *clicks stopwatch* Six minutes, not bad :-)
>>>
>>> Cheers, Simon
>>>
>>>
>>> -- 
>>> Simon MacMullen
>>> RabbitMQ, VMware
>>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/3afe1746/attachment.htm>

From matthias at rabbitmq.com  Wed Oct 31 21:34:31 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 31 Oct 2012 21:34:31 +0000
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
 Plugin
In-Reply-To: <2d3ab9a5-24b2-4eec-81fa-865fc81fff8e@googlegroups.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
	<508FE465.4080408@rabbitmq.com>
	<CAAFAKh4CeV5LR6EonW_HqLUWWBbCbsOkYwh9CYOArWt2LCymCw@mail.gmail.com>
	<CAAFAKh7p-oOBeKQuYJneCrH46ZVaC0TRNccEfGgZq8TMstQSTg@mail.gmail.com>
	<2d3ab9a5-24b2-4eec-81fa-865fc81fff8e@googlegroups.com>
Message-ID: <50919967.3040601@rabbitmq.com>

Oldrich,

On 31/10/12 21:25, Olda E?ner wrote:
> I tried following:
> - cloned rabbitmq-public-umbrella
> - inside rabbitmq-public-umbrella directory I created presence-exchange
> folder with current GIT presence-exchange plugin

That won't work. As per Simon's recommendation:

<quote>
you might need to get the un-updated version of the plugin source
</quote>

> - build "make VERSION=2.8.7" inside presence-exchange folder, everything
> was successful

Not sure where you got that command from. 
http://www.rabbitmq.com/plugin-development.html#getting-started says

<quote>
Optionally, switch to a different branch, e.g. if you want to build 
plugins for a particular version of RabbitMQ:

$ make BRANCH=<tag> up_c
</quote>

i.e. you'll need 'make BRANCH=rabbitmq_v2_8_7 up_c'. And then 'make'.


Regards,

Matthias.

From pfriend at gehrytech.com  Wed Oct 31 22:01:29 2012
From: pfriend at gehrytech.com (Peter Friend)
Date: Wed, 31 Oct 2012 17:01:29 -0500
Subject: [rabbitmq-discuss] consumer cancel notify support in pika
In-Reply-To: <CAKwdTWdQ08pkaZmxXLkLwm2snx-89qACMf_WCKt0tfkqBMFeCQ@mail.gmail.com>
References: <50909034.70307@octavian.org>
	<CAKwdTWfOkvkp6WCDKeio1H9sGi4DRS=H3Luk_QkFs7VqA-Ce0g@mail.gmail.com>
	<B1D697B6-93E6-44DF-8336-86E0EC1BD9F1@gt-global.com>
	<CAKwdTWdQ08pkaZmxXLkLwm2snx-89qACMf_WCKt0tfkqBMFeCQ@mail.gmail.com>
Message-ID: <10AD22196924954389ADAB923E16F65715437EB115@DFW1MBX10.mex07a.mlsrvr.com>

Gavin,

The cancel callback is being called when I use async methods, so it appears this is just an issue with BlockingConnection. Thanks!

Peter

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gavin M. Roy
Sent: Wednesday, October 31, 2012 11:13 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] consumer cancel notify support in pika


On Wed, Oct 31, 2012 at 11:52 AM, Peter Friend <pfriend at gehrytech.com<mailto:pfriend at gehrytech.com>> wrote:
1) Which version are you using?
0.9.5.

0.9.5 didn't pay as close attention to the protocol as 0.9.6 does. I'd recommend 0.9.6 at this point, especially for RPC calls from RabbitMQ.

The 0.9.6 version has method signature changes that make it incompatible with most of the docs out there and I had trouble getting it to work.

Hmm which methods changed that you're having problems with?  Also docs should be up to date at https://pika.readthedocs.org/<https://pika.readthedocs.org/en/0.9.6/index.html> -- let me know if you're having any problems with them.
3) Did you register for a callback? Channel.add_on_cancel_callback(your_callback_method)
I have tried when using BlockingConnection but not the asynchronous one yet. My understanding from the docs was that an exception would be thrown in consume(). Is that not correct?

The problem with BlockingConnection in 0.9.5 is it doesn't pay attention to what RabbitMQ is telling it to do, unless you explicitly tell it to do so. It's likely a bug related to that causing your issue.

Here is an async consumer example that uses 0.9.6 and handles Basic.Cancel being invoked by RabbitMQ:

https://pika.readthedocs.org/en/latest/examples/asynchronous_consumer_example.html

In the blocking connection, you should see a pika.exceptions.ConsumerCancelled exception raised.

Hope this helps,

Gavin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/c365cdc6/attachment.htm>

From gmr at meetme.com  Wed Oct 31 22:08:59 2012
From: gmr at meetme.com (Gavin M. Roy)
Date: Wed, 31 Oct 2012 18:08:59 -0400
Subject: [rabbitmq-discuss] consumer cancel notify support in pika
In-Reply-To: <10AD22196924954389ADAB923E16F65715437EB0EA@DFW1MBX10.mex07a.mlsrvr.com>
References: <50909034.70307@octavian.org>
	<CAKwdTWfOkvkp6WCDKeio1H9sGi4DRS=H3Luk_QkFs7VqA-Ce0g@mail.gmail.com>
	<B1D697B6-93E6-44DF-8336-86E0EC1BD9F1@gt-global.com>
	<CAKwdTWdQ08pkaZmxXLkLwm2snx-89qACMf_WCKt0tfkqBMFeCQ@mail.gmail.com>
	<10AD22196924954389ADAB923E16F65715437EB0EA@DFW1MBX10.mex07a.mlsrvr.com>
Message-ID: <CAKwdTWcB8do1Uyffaza2SuzAMTJ2Oz-HAL2-9FMuFjQLQfHc2w@mail.gmail.com>

On Wed, Oct 31, 2012 at 5:03 PM, Peter Friend <pfriend at gehrytech.com> wrote:

> Here are the issues I've had so far with 0.9.6:****
>
> ** 1. exchange_declare() type arg is now exchange_type
>

Gotcha, I had moved way from the auto-assignment of reserved keywords.
type, in this case is a reserved word in Python, using it would reassign
the type function to the value passed in. While this does break with 0.9.5,
it does seem like it's the right behavior. Thoughts?

> ****
>
> 2. Ran into problems with RPC type calls. In 0.9.5 the docs for channel
> has:****
>
>                queue_declare(self, callback=None, ticket=0, queue='',
> passive=False, durable=False, exclusive=False, auto_delete=False,
> nowait=False, arguments={})
>

ticket has been removed from all the calls since it is deprecated in the
protocol and not used by anything. I can see how the behavioral change can
cause an issue if you were putting it in by default.


> ****
>
>    and in 0.9.6:****
>
>                queue_declare(self, callback, queue, passive=False,
> durable=False, exclusive=False, auto_delete=False, nowait=False,
> arguments=None)
>
****
>
>    The callback and queue args are required now so a line that used to be:
>
>                result = channel.queue_declare(exclusive=True,
> auto_delete=True) should presumably now be:****
>
>                result = channel.queue_declare(callback=None, queue='',
> exclusive=True, auto_delete=True)****
>
>    However that results in this error:****
>
>                TypeError: queue_declare() got an unexpected keyword
> argument 'callback'
>
Yeah callbacks in BlockingConnection were removed for synchronous commands.

>    This is confusing if you are reading the docs for channel, and is a
> behavior change from 0.9.5.
>
Fair enough, in the async, I see the callback should be None, but queue
should not. Any suggestions for the right behavior here?  I could throw an
exception for passing in an empty queue name.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/94dc7235/attachment.htm>

From olda.esner at gmail.com  Wed Oct 31 22:37:36 2012
From: olda.esner at gmail.com (Oldrich)
Date: Wed, 31 Oct 2012 15:37:36 -0700 (PDT)
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
 Plugin
In-Reply-To: <2d3ab9a5-24b2-4eec-81fa-865fc81fff8e@googlegroups.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
	<508FE465.4080408@rabbitmq.com>
	<CAAFAKh4CeV5LR6EonW_HqLUWWBbCbsOkYwh9CYOArWt2LCymCw@mail.gmail.com>
	<CAAFAKh7p-oOBeKQuYJneCrH46ZVaC0TRNccEfGgZq8TMstQSTg@mail.gmail.com>
	<2d3ab9a5-24b2-4eec-81fa-865fc81fff8e@googlegroups.com>
Message-ID: <33b378cb-fe60-464d-b17d-654954df7917@googlegroups.com>

Creating ez plugin with 'make BRANCH=rabbitmq_v2_8_7 up_c'. And then 
'make'. works.

Some exceptions have disappered but this sentences of steps causes the 
following exception (on clean rabbitmq_2.8.7 installation with 
presence-exchange plugin):

- load rabbitmq management plugin (web based interface)
- create exchange "xpresence" with exchange type "x-presence" - OK
- create queue "qpresence" with binding to exchange "xpresence" and empty 
routing key - OK 
- create queue "client.test5" with binding to exchange "xpresence" and 
routing key "test5" - ERROR

{error,
    {exit,
        {{undef,
             [{rabbit_basic,delivery,
                  [false,
                   {basic_message,
                       {resource,<<"/">>,exchange,<<"xpresence">>},
                       [<<>>],
                       {content,60,
                           {'P_basic',undefined,undefined,
                               [{<<"action">>,longstr,"bind"},
                                {<<"exchange">>,longstr,<<"xpresence">>},
                                {<<"queue">>,longstr,<<"client.test5">>},
                                {<<"key">>,longstr,<<"test5">>}],
                               undefined,undefined,undefined,undefined,
                               undefined,undefined,undefined,undefined,
                               undefined,undefined,undefined},
                           none,none,
                           [<<>>]},
                       <<11,29,48,224,182,246,62,8,151,38,183,173,140,42,185,
                         231>>,
                       false},
                   undefined],
                  []},
              {presence_exchange,add_binding,3,[]},
              {rabbit_binding,'-add/3-fun-0-',3,[]},
              {rabbit_channel,binding_action,9,[]},
              {rabbit_channel,handle_cast,2,[]},
              {gen_server2,handle_msg,2,[]},
              {proc_lib,init_p_do_apply,3,
                  [{file,"proc_lib.erl"},{line,227}]}]},
         {gen_server,call,
             [<0.375.0>,
              {call,
                  {'queue.bind',0,<<"client.test5">>,<<"xpresence">>,
                      <<"test5">>,false,[]},
                  none,<0.243.0>},
              infinity]}},
        [{gen_server,call,3,[{file,"gen_server.erl"},{line,188}]},
         {rabbit_mgmt_util,'-amqp_request/5-fun-0-',4,[]},
         {rabbit_mgmt_util,with_channel,5,[]},
         {rabbit_mgmt_wm_bindings,accept_content,2,[]},
         {webmachine_resource,resource_call,3,[]},
         {webmachine_resource,do,3,[]},
         {webmachine_decision_core,resource_call,1,[]},
         {webmachine_decision_core,accept_helper,0,[]}]}}


Which type of error is it in this case?

Thank you,

Oldrich Esner.

Dne st?eda, 31. ??jna 2012 14:25:01 UTC-7 Oldrich napsal(a):
>
> I tried following:
> - cloned rabbitmq-public-umbrella
> - inside rabbitmq-public-umbrella directory I created presence-exchange 
> folder with current GIT presence-exchange plugin
> - build "make VERSION=2.8.7" inside presence-exchange folder, everything 
> was successful
> - after copying rabbit-presence-exchange-0.0.0.ez into rabbitmq-2.8.7 
> plugin folder and restarting rabbit server still the same error appears
>
> Have any of you tried whether presence-exchange plugin is really 
> compatible with the latest rabbitmq stable version (2.8.7)?
>
> Thank you very much for any help.
>
> Oldrich
>
> Dne ?ter?, 30. ??jna 2012 18:35:02 UTC-7 Olda E?ner napsal(a):
>>
>> Bad news, plugins seems to work in management console (x-presence 
>> exchange isn't in "red" state) but after binding x-presence exchange to 
>> queue, rabbit server log writes the following:
>>
>> =ERROR REPORT==== 31-Oct-2012::02:22:37 ===
>> ** Generic server <0.131.0> terminating
>> ** Last message in was {'$gen_cast',
>>                            {submit_async,#Fun<rabbit_binding.3.58413561>}}
>> ** When Server state == 2
>> ** Reason for termination == 
>> ** {function_clause,
>>        [{presence_exchange,add_binding,
>>             [none,
>>              {exchange,
>>                  {resource,<<"/">>,exchange,<<"xpresence">>},
>>                  'x-presence',true,false,false,[],undefined},
>>              {binding,
>>                  {resource,<<"/">>,exchange,<<"xpresence">>},
>>                  <<>>,
>>                  {resource,<<"/">>,queue,<<"qpresence">>},
>>                  []}],
>>             []},
>>         {rabbit_binding,x_callback,4,[]},
>>         {rabbit_binding,'-recover_semi_durable_route/3-fun-0-',3,[]},
>>         {worker_pool_worker,handle_cast,2,[]},
>>         {gen_server2,handle_msg,2,[]},
>>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]} 
>>
>> =ERROR REPORT==== 31-Oct-2012::02:19:08 ===
>> ** Generic server <0.1023.0> terminating
>> ** Last message in was {'$gen_cast',
>>                            {method,
>>                                {'queue.bind',0,
>>                                    
>> <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>,
>>                                    <<"xpresence">>,<<>>,false,[]},
>>                                none,noflow}}
>> ** When Server state == 
>> {ch,running,rabbit_framing_amqp_0_9_1,1,<0.1019.0>,
>>                             <0.1021.0>,<0.1019.0>,
>>                             "127.0.0.1:54877 -> 127.0.0.1:5672",
>>                             {token,<0.1022.0>,false},
>>                             none,1,
>>                             {[],[]},
>>                             {[],[]},
>>                             [],[],
>>                             {user,<<"guest">>,
>>                                 [administrator],
>>                                 rabbit_auth_backend_internal,
>>                                 {internal_user,<<"guest">>,
>>                                     
>> <<238,155,95,210,98,65,149,74,208,144,18,
>>                                       
>> 191,58,228,155,137,230,224,252,199>>,
>>                                     [administrator]}},
>>                             <<"/">>,
>>                             <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>,
>>                             {dict,0,16,16,8,80,48,
>>                                 
>> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                  []},
>>                                 
>> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                   [],[]}}},
>>                             {dict,0,16,16,8,80,48,
>>                                 
>> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                  []},
>>                                 
>> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                   [],[]}}},
>>                             {set,0,16,16,8,80,48,
>>                                 
>> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                  []},
>>                                 
>> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                   [],[]}}},
>>                             {dict,0,16,16,8,80,48,
>>                                 
>> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                  []},
>>                                 
>> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                   [],[]}}},
>>                             {set,0,16,16,8,80,48,
>>                                 
>> {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                  []},
>>                                 
>> {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>>                                   [],[]}}},
>>                             <0.1017.0>,
>>                             {state,fine,5000,#Ref<0.0.0.8440>},
>>                             false,1,
>>                             {{0,nil},{0,nil}},
>>                             [],
>>                             [{<<"exchange_exchange_bindings">>,bool,true},
>>                              {<<"consumer_cancel_notify">>,bool,true},
>>                              {<<"basic.nack">>,bool,true},
>>                              {<<"publisher_confirms">>,bool,true}],
>>                             none}
>> ** Reason for termination == 
>> ** {function_clause,
>>        [{presence_exchange,add_binding,
>>             [none,
>>              {exchange,
>>                  {resource,<<"/">>,exchange,<<"xpresence">>},
>>                  'x-presence',true,false,false,[],undefined},
>>              {binding,
>>                  {resource,<<"/">>,exchange,<<"xpresence">>},
>>                  <<>>,
>>                  {resource,<<"/">>,queue,
>>                      <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>},
>>                  []}],
>>             []},
>>         {rabbit_binding,'-add/3-fun-0-',3,[]},
>>         {rabbit_channel,binding_action,9,[]},
>>         {rabbit_channel,handle_cast,2,[]},
>>         {gen_server2,handle_msg,2,[]},
>>         {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
>>
>> =ERROR REPORT==== 31-Oct-2012::02:19:08 ===
>> AMQP connection <0.1019.0>, channel 1 - error:
>> {function_clause,
>>     [{presence_exchange,add_binding,
>>          [none,
>>           {exchange,
>>               {resource,<<"/">>,exchange,<<"xpresence">>},
>>               'x-presence',true,false,false,[],undefined},
>>           {binding,
>>               {resource,<<"/">>,exchange,<<"xpresence">>},
>>               <<>>,
>>               {resource,<<"/">>,queue,
>>                   <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>},
>>               []}],
>>          []},
>>      {rabbit_binding,'-add/3-fun-0-',3,[]},
>>      {rabbit_channel,binding_action,9,[]},
>>      {rabbit_channel,handle_cast,2,[]},
>>      {gen_server2,handle_msg,2,[]},
>>      {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}
>>
>> =WARNING REPORT==== 31-Oct-2012::02:19:08 ===
>> Non-AMQP exit reason '{function_clause,
>>                        [{presence_exchange,add_binding,
>>                          [none,
>>                           {exchange,
>>                            {resource,<<"/">>,exchange,<<"xpresence">>},
>>                            'x-presence',true,false,false,[],undefined},
>>                           {binding,
>>                            {resource,<<"/">>,exchange,<<"xpresence">>},
>>                            <<>>,
>>                            {resource,<<"/">>,queue,
>>                             <<"1ae1453a-5218-467d-9f10-b4cd10014d2a">>},
>>                            []}],
>>                          []},
>>                         {rabbit_binding,'-add/3-fun-0-',3,[]},
>>                         {rabbit_channel,binding_action,9,[]},
>>                         {rabbit_channel,handle_cast,2,[]},
>>                         {gen_server2,handle_msg,2,[]},
>>                         {proc_lib,init_p_do_apply,3,
>>                          [{file,"proc_lib.erl"},{line,227}]}]}' 
>>
>> Is any of you able to find a source of problem? We are using Java EE 
>> application with spring-rabbit and spring-amqp libraries.
>>
>> Thank you.
>>
>> Oldrich
>>
>> 2012/10/30 Old?ich E?ner <olda.esner at gmail.com>
>>
>>> Thank you very much for the fastest fix I have ever seen :)
>>>
>>> If you want to update downloads section, I'm including current ez build 
>>> of presence plugin.
>>>
>>> Regards,
>>>
>>> Oldrich
>>>
>>>
>>> 2012/10/30 Simon MacMullen <simon at rabbitmq.com>
>>>
>>>> On 30/10/12 14:18, Tony Garnock-Jones wrote:
>>>>
>>>>> On 30 October 2012 00:27, Olda E?ner <olda.esner at gmail.com
>>>>> <mailto:olda.esner at gmail.com>> wrote:
>>>>>
>>>>>     after upgrading to RabbitMQ 2.8.6 from 2.8.5, presence-exchange
>>>>>     plugin doesn't work. Is there any chance to fix it?
>>>>>
>>>>>
>>>>> It's a consequence of the removal from the server's core of support for
>>>>> "immediate" publication. At least rabbithub and the udp-exchange will
>>>>> also have to be updated. The fix should be straightforward.
>>>>>
>>>>
>>>> ...although that's happened on default, not 2.8.6.
>>>>
>>>> To the OP: you might need to get the un-updated version of the plugin 
>>>> source, and then build that against the 2.8.6 source download.
>>>>
>>>> Alternatively, whatever plugin binary you created for 2.8.5 should 
>>>> still work, I don't think any APIs changed?
>>>>
>>>>
>>>>  I'll email again when I'm done. Shouldn't be long.
>>>>>
>>>>
>>>> *clicks stopwatch* Six minutes, not bad :-)
>>>>
>>>> Cheers, Simon
>>>>
>>>>
>>>> -- 
>>>> Simon MacMullen
>>>> RabbitMQ, VMware
>>>>
>>>
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/759b447f/attachment-0001.htm>

From matthias at rabbitmq.com  Wed Oct 31 22:54:27 2012
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 31 Oct 2012 22:54:27 +0000
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
 Plugin
In-Reply-To: <33b378cb-fe60-464d-b17d-654954df7917@googlegroups.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
	<508FE465.4080408@rabbitmq.com>
	<CAAFAKh4CeV5LR6EonW_HqLUWWBbCbsOkYwh9CYOArWt2LCymCw@mail.gmail.com>
	<CAAFAKh7p-oOBeKQuYJneCrH46ZVaC0TRNccEfGgZq8TMstQSTg@mail.gmail.com>
	<2d3ab9a5-24b2-4eec-81fa-865fc81fff8e@googlegroups.com>
	<33b378cb-fe60-464d-b17d-654954df7917@googlegroups.com>
Message-ID: <5091AC23.1040208@rabbitmq.com>

Oldrich,

On 31/10/12 22:37, Oldrich wrote:
> Creating ez plugin with 'make BRANCH=rabbitmq_v2_8_7 up_c'. And then
> 'make'. works.
>
> - create queue "client.test5" with binding to exchange "xpresence" and
> routing key "test5" - ERROR
> [...]
> Which type of error is it in this case?

This one:

<quote>
you might need to get the un-updated version of the plugin source
</quote>

Specifically you'll need to get the version *before* Tony's recent change.

Regards,

Matthias.

From nick at faceture.com  Wed Oct 31 22:10:39 2012
From: nick at faceture.com (Nick Martin)
Date: Wed, 31 Oct 2012 15:10:39 -0700
Subject: [rabbitmq-discuss] Pub/Sub -- block publisher until all acks
	received from subscribers?
Message-ID: <CAFedJMhM+pfzigOd2SY6_gWUam6-t46Psm=dZuhAP7bHSA7VMQ@mail.gmail.com>

I have a publish-subscribe use case where I would like to block on the
publish side until each of the subscribers confirm that they have completed
handling the message sent by the publisher.

I (incorrectly?) assumed that I could use RabbitMQ and its Java
amqp-client's Channel.waitForConfirmsOrDie method as part of my solution.
The issue is that I haven't found a case in which waitForConfirmsOrDie will
actually block.

According to the javadocs (
http://www.rabbitmq.com/javadoc/com/rabbitmq/client/Channel.html#waitForConfirmsOrDie()),
waitForConfirmsOrDie is supposed to:

> Wait until all messages published since the last call have been either
ack'd or nack'd by the broker. If any of the messages were nack'd,
waitForConfirmsOrDie will throw an IOException. When called on a
non-Confirm channel, it will return immediately.

In order to test that this method really works, I started with example code
from the RabbitMQ website (
http://hg.rabbitmq.com/rabbitmq-java-client/raw-file/da241e35951b/test/src/com/rabbitmq/examples/ConfirmDontLoseMessages.java
).

The example code creates a publisher and a consumer, each on its own
separate thread. Then the publisher sends messages to the exchange while
the consumer consumes the messages. It seems to me that the publisher is
supposed to block until all of the messages are ack'd via its call to
waitForConfirmsOrDie(). Is this what this is really supposed to do?

This example code seemed like it matched up perfectly with what I was
trying to do. But, it doesn't seem to work the way I thought it did. In
fact, if, in the consumer thread, I turn off auto-acking messages, then
waitForConfirmsOrDie() still returns immediately.

I turned off auto ack by just changing one false to true:
ch.queueDeclare(QUEUE_NAME, false, false, false, null);
becomes
ch.queueDeclare(QUEUE_NAME, true, false, false, null); (2nd arg false
instead of true).

I believe this means that acks should no longer be sent by the consumer.

So what does waitForConfirmsOrDie() actually do? When would it block?

If waitForConfirmsOrDie doesn't do what I want, is there a way to make a
publisher wait until all subscribers ack a message before proceeding?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/b4932924/attachment.htm>

From pfriend at gehrytech.com  Wed Oct 31 23:06:43 2012
From: pfriend at gehrytech.com (Peter Friend)
Date: Wed, 31 Oct 2012 18:06:43 -0500
Subject: [rabbitmq-discuss] consumer cancel notify support in pika
In-Reply-To: <CAKwdTWcB8do1Uyffaza2SuzAMTJ2Oz-HAL2-9FMuFjQLQfHc2w@mail.gmail.com>
References: <50909034.70307@octavian.org>
	<CAKwdTWfOkvkp6WCDKeio1H9sGi4DRS=H3Luk_QkFs7VqA-Ce0g@mail.gmail.com>
	<B1D697B6-93E6-44DF-8336-86E0EC1BD9F1@gt-global.com>
	<CAKwdTWdQ08pkaZmxXLkLwm2snx-89qACMf_WCKt0tfkqBMFeCQ@mail.gmail.com>
	<10AD22196924954389ADAB923E16F65715437EB0EA@DFW1MBX10.mex07a.mlsrvr.com>
	<CAKwdTWcB8do1Uyffaza2SuzAMTJ2Oz-HAL2-9FMuFjQLQfHc2w@mail.gmail.com>
Message-ID: <10AD22196924954389ADAB923E16F65715437EB147@DFW1MBX10.mex07a.mlsrvr.com>

 1. exchange_declare() type arg is now exchange_type
Gotcha, I had moved way from the auto-assignment of reserved keywords. type, in this case is a reserved word in Python, using it would reassign the type function to the value passed in. While this does break with 0.9.5, it does seem like it's the right behavior. Thoughts?

I had forgotten that type was a builtin, so definitely a good change.
               TypeError: queue_declare() got an unexpected keyword argument 'callback'
Yeah callbacks in BlockingConnection were removed for synchronous commands.
   This is confusing if you are reading the docs for channel, and is a behavior change from 0.9.5.
Fair enough, in the async, I see the callback should be None, but queue should not. Any suggestions for the right behavior here?  I could throw an exception for passing in an empty queue name.

This tripped me up because lots of example code for RPC (including RabbitMQ In Action) uses the shortened form, and it takes some digging to realize that you need to look at the documentation for queue_declare in BlockingConnection, not channel. Might help if the channel docs mention that the methods may be overridden by the connection type in use?

Peter



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/5e6a0def/attachment.htm>

From olda.esner at gmail.com  Wed Oct 31 23:11:24 2012
From: olda.esner at gmail.com (=?UTF-8?B?T2xkxZlpY2ggRcWhbmVy?=)
Date: Wed, 31 Oct 2012 16:11:24 -0700
Subject: [rabbitmq-discuss] Question about RabbitMQ "Presence Exchange"
	Plugin
In-Reply-To: <5091AC23.1040208@rabbitmq.com>
References: <D027DE656EBD4F4C8EE57361B5EF438E39915F26@szxeml524-mbs.china.huawei.com>
	<4F2BC07E.8050900@rabbitmq.com>
	<CAM8fPiR2DCVV+em-sfo-AwoiMBYc9-N+cQKth8MC0YYvbTCgrA@mail.gmail.com>
	<9304ba54-57ec-4fa7-8990-b74169f53a0c@googlegroups.com>
	<CAM8fPiSYv8O79AMsOz+pSuuqF0x_nJ1_hFefK_8NZQV-dRXz_g@mail.gmail.com>
	<508FE465.4080408@rabbitmq.com>
	<CAAFAKh4CeV5LR6EonW_HqLUWWBbCbsOkYwh9CYOArWt2LCymCw@mail.gmail.com>
	<CAAFAKh7p-oOBeKQuYJneCrH46ZVaC0TRNccEfGgZq8TMstQSTg@mail.gmail.com>
	<2d3ab9a5-24b2-4eec-81fa-865fc81fff8e@googlegroups.com>
	<33b378cb-fe60-464d-b17d-654954df7917@googlegroups.com>
	<5091AC23.1040208@rabbitmq.com>
Message-ID: <CAAFAKh5eMwx30Os2ua0eO5OgMWmqgxc4q4=bRnEkFMitH8ytkg@mail.gmail.com>

Now everything works.

So, I think Tony's change is for trunk version of RabbitMQ and my previous
error wasn't caused by missing immediate deliveries but by incorrect
version of presence-exchange plugin build.

Thank you Matthias

2012/10/31 Matthias Radestock <matthias at rabbitmq.com>

> Oldrich,
>
> On 31/10/12 22:37, Oldrich wrote:
>
>> Creating ez plugin with 'make BRANCH=rabbitmq_v2_8_7 up_c'. And then
>> 'make'. works.
>>
>> - create queue "client.test5" with binding to exchange "xpresence" and
>> routing key "test5" - ERROR
>> [...]
>> Which type of error is it in this case?
>>
>
> This one:
>
> <quote>
>
> you might need to get the un-updated version of the plugin source
> </quote>
>
> Specifically you'll need to get the version *before* Tony's recent change.
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20121031/4fb9a698/attachment.htm>

