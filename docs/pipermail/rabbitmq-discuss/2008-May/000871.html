<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] persistence
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20persistence&In-Reply-To=482DCE1C.7070400%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000865.html">
   <LINK REL="Next"  HREF="000873.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] persistence</H1>
    <B>Lars Bachmann</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20persistence&In-Reply-To=482DCE1C.7070400%40lshift.net"
       TITLE="[rabbitmq-discuss] persistence">lars.bachmann at s2002.tu-chemnitz.de
       </A><BR>
    <I>Wed May 21 10:52:12 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000865.html">[rabbitmq-discuss] persistence
</A></li>
        <LI>Next message: <A HREF="000873.html">[rabbitmq-discuss] persistence
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#871">[ date ]</a>
              <a href="thread.html#871">[ thread ]</a>
              <a href="subject.html#871">[ subject ]</a>
              <a href="author.html#871">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Mathias,

after some days of vacation Im going on with rabbitmq. As i wrote last  
time the reason why the messages were not sent was because of an  
already closed channel.
But still Im not happy with all behaviour and having different issues.
I delayed the time before closing a channel up to 50 seconds. In this  
case i was able to send about 150000 messages correctly. If I try to  
send more messages I also have to increase the delay time. But if the  
communication between producer and broker takes too long i get an  
&quot;java.net.SocketException&quot;. Here the stacktrace:

hit IOException in Producer: trace follows
java.net.SocketException: Connection reset
         at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:96)
         at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
         at  
java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
         at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
         at java.io.DataOutputStream.flush(DataOutputStream.java:106)
         at  
com.rabbitmq.client.impl.SocketFrameHandler.writeFrame(SocketFrameHandler.java:156)
         at  
com.rabbitmq.client.impl.AMQConnection.writeFrame(AMQConnection.java:297)
         at com.rabbitmq.client.impl.AMQCommand.transmit(AMQCommand.java:190)
         at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:369)
         at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:350)
         at  
com.rabbitmq.test.ConcurrentRabbitMQProducerTest.runIt(ConcurrentRabbitMQProducerTest.java:100)
         at  
com.rabbitmq.test.ConcurrentRabbitMQProducerTest.run(ConcurrentRabbitMQProducerTest.java:71)
         at java.lang.Thread.run(Thread.java:619)
Exception in thread &quot;Thread-1&quot; java.lang.RuntimeException:  
java.net.SocketException: Connection reset
         at  
com.rabbitmq.test.ConcurrentRabbitMQProducerTest.run(ConcurrentRabbitMQProducerTest.java:75)
         at java.lang.Thread.run(Thread.java:619)
Caused by: java.net.SocketException: Connection reset
         at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:96)
         at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
         at  
java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:65)
         at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:123)
         at java.io.DataOutputStream.flush(DataOutputStream.java:106)
         at  
com.rabbitmq.client.impl.SocketFrameHandler.writeFrame(SocketFrameHandler.java:156)
         at  
com.rabbitmq.client.impl.AMQConnection.writeFrame(AMQConnection.java:297)
         at com.rabbitmq.client.impl.AMQCommand.transmit(AMQCommand.java:190)
         at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:369)
         at com.rabbitmq.client.impl.ChannelN.basicPublish(ChannelN.java:350)
         at  
com.rabbitmq.test.ConcurrentRabbitMQProducerTest.runIt(ConcurrentRabbitMQProducerTest.java:100)
         at  
com.rabbitmq.test.ConcurrentRabbitMQProducerTest.run(ConcurrentRabbitMQProducerTest.java:71)

After this exception also the broker dont respond anymore. The process  
is still running but i cant connect with an erlang shell to the  
broker. Very strange behaviour. All I can do in this situation is to  
restart the broker ...

My System: Im running rabbitmq 1.3. on a gentoo linux. In the log file  
is nothing unusal. (How can I actually switch the log level to &quot;debug&quot;  
?)

Lars


&gt;<i> Lars,
</I>&gt;<i>
</I>&gt;<i> Matthias Radestock wrote:
</I>&gt;&gt;<i> Lars Bachmann wrote:
</I>&gt;&gt;&gt;<i> by now i tried only 1) and it definitly has some affect. I was   
</I>&gt;&gt;&gt;<i> able to send 70000, 100000 and 150000 messages and all were   
</I>&gt;&gt;&gt;<i> received by the broker. When i wanted to send 200000 i got a   
</I>&gt;&gt;&gt;<i> socketconnection exception.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks for running this experiment. These results give me something  
</I>&gt;&gt;<i>  to go on.
</I>&gt;<i>
</I>&gt;<i> I think I've found the problem, though if my analysis is correct I
</I>&gt;<i> would have expected an error in the server logs. Are you sure there is
</I>&gt;<i> nothing unusual in there? Perhaps you could send me the log output
</I>&gt;<i> recorded by the server when running your test program (in its original
</I>&gt;<i> form, i.e. without the delay in closing the channel).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I>





</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000865.html">[rabbitmq-discuss] persistence
</A></li>
	<LI>Next message: <A HREF="000873.html">[rabbitmq-discuss] persistence
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#871">[ date ]</a>
              <a href="thread.html#871">[ thread ]</a>
              <a href="subject.html#871">[ subject ]</a>
              <a href="author.html#871">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
