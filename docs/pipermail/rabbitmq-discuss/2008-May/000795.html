<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] TCP timeouts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20TCP%20timeouts&In-Reply-To=OF08E88F09.1ABD4866-ON80257442.003AED0B-80257442.003F53FD%40Edftrading.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000792.html">
   <LINK REL="Next"  HREF="000807.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] TCP timeouts</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20TCP%20timeouts&In-Reply-To=OF08E88F09.1ABD4866-ON80257442.003AED0B-80257442.003F53FD%40Edftrading.com"
       TITLE="[rabbitmq-discuss] TCP timeouts">matthias at lshift.net
       </A><BR>
    <I>Wed May  7 18:18:16 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000792.html">[rabbitmq-discuss] TCP timeouts
</A></li>
        <LI>Next message: <A HREF="000807.html">[rabbitmq-discuss] TCP timeouts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#795">[ date ]</a>
              <a href="thread.html#795">[ thread ]</a>
              <a href="subject.html#795">[ subject ]</a>
              <a href="author.html#795">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David,

<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">David.Corcoran at edftrading.com</A> wrote:
&gt;<i> I've run into a problem testing RabbitMQ. My Java clients keep
</I>&gt;<i> disconnecting when using a lot of CPU and the error in the RabbitMQ logs
</I>&gt;<i> is:
</I>&gt;<i> =ERROR REPORT==== 7-May-2008::11:41:44 ===
</I>&gt;<i> error on TCP connection from 127.0.0.1:37299
</I>&gt;<i> {timeout,frame_header}
</I>&gt;<i> 
</I>&gt;<i> I'm using channel.basicGet and I think I've narrowed down the problem. When
</I>&gt;<i> I get a message I process it, then call basicAck once it's done. So the
</I>&gt;<i> code looks like:
</I>&gt;<i> GetResponse basicGet = channel.basicGet(ticket, queueName, false);
</I>&gt;<i>  if (basicGet != null) {
</I>&gt;<i>         process(basicGet);
</I>&gt;<i>         channel.basicAck(basicGet.getEnvelope().getDeliveryTag(), false);
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> if process() looks like this:
</I>&gt;<i>             long start = System.currentTimeMillis();
</I>&gt;<i>             while(true) {
</I>&gt;<i>                 long now = System.currentTimeMillis();
</I>&gt;<i>                 if(now - start &gt; 10000) {
</I>&gt;<i>                     break;
</I>&gt;<i>                 }
</I>&gt;<i>             }
</I>&gt;<i> The client will disconnect. If I add a Thread.sleep(0) into the loop it
</I>&gt;<i> will work fine. The sleep 0 just yields. In my real code it doesn't do that
</I>&gt;<i> loop but does do a lot of maths that can take up to about 1 minute so it
</I>&gt;<i> has the same effect of killing the CPU for a while.
</I>&gt;<i> 
</I>&gt;<i> I guess what's happening is that the connection thread isn't getting any
</I>&gt;<i> time to send heartbeats and the server is disconnecting it. Is there a work
</I>&gt;<i> around for this? Can I change the heartbeat?
</I>&gt;<i> 
</I>&gt;<i> A little more information if that helps:
</I>&gt;<i>  - Quad core machine, only using 1 cpu during this test
</I>&gt;<i>  - 4GB Ram
</I>&gt;<i>  - Erlang 5.5.5 (64bit)
</I>&gt;<i>  - Ubunut 64
</I>&gt;<i>  - Rabbit mq 1.3.0-1
</I>
That is weird. The application thread that is calling process(...), and 
the connection thread are separate threads. The workload on the former 
should not prevent the latter from sending heartbeats, certainly not on 
a quad-core machine.

Can you post the complete example? Also, what version of the jvm are you 
running?


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000792.html">[rabbitmq-discuss] TCP timeouts
</A></li>
	<LI>Next message: <A HREF="000807.html">[rabbitmq-discuss] TCP timeouts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#795">[ date ]</a>
              <a href="thread.html#795">[ thread ]</a>
              <a href="subject.html#795">[ subject ]</a>
              <a href="author.html#795">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
