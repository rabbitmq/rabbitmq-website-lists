<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] no connection established
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20no%20connection%20established&In-Reply-To=3345C962-0443-4B37-A897-A79E1C5871F0%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000834.html">
   <LINK REL="Next"  HREF="000849.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] no connection established</H1>
    <B>Geoffrey Anderson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20no%20connection%20established&In-Reply-To=3345C962-0443-4B37-A897-A79E1C5871F0%40gmail.com"
       TITLE="[rabbitmq-discuss] no connection established">mrcoder at yahoo.com
       </A><BR>
    <I>Tue May 13 20:16:05 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000834.html">[rabbitmq-discuss] no connection established
</A></li>
        <LI>Next message: <A HREF="000849.html">[rabbitmq-discuss] no connection established
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#839">[ date ]</a>
              <a href="thread.html#839">[ thread ]</a>
              <a href="subject.html#839">[ subject ]</a>
              <a href="author.html#839">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
--- Ben Hood &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">0x6e6562 at gmail.com</A>&gt; wrote:

&gt;<i> Hi Geoffrey,
</I>&gt;<i> 
</I>&gt;<i> Sorry to hear that you have run into difficulties.
</I>&gt;<i> 
</I>&gt;<i> On 13 May 2008, at 17:53, Geoffrey Anderson wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; The rabbitmq server runs, it seems, but no connections are being  
</I>&gt;<i> &gt; accepted by it,
</I>&gt;<i> &gt; from the java samples or dotnet sample programs or my own programs.
</I>&gt;<i> 
</I>&gt;<i> Can you try with a simple TCP client, e.g.
</I>&gt;<i> 
</I>&gt;<i> nc 0.0.0.0 5672
</I>&gt;<i> 
</I>&gt;<i> ?
</I>&gt;<i> 
</I>&gt;<i> What shows up in the server log when you do this?
</I>

C:\rabbitmq\rabbitmq-dotnet-1.2.8025.1832-net-2.0\bin&gt;nc
'nc' is not recognized as an internal or external command,
operable program or batch file.


C:\Documents and Settings\ga&gt;telnet 0.0.0.0 5672
Connecting To 0.0.0.0...Could not open connection to the host, on port 5672: Connect
failed

Thank you for the interesting suggestion.  I imagine telnet is just as good as 'nc'
for this purpose although I don't know what 'nc' is.

Seems like no process is listening on port 5672 doesn't it?

OTOH netstat suggests there really IS a process listening there, if I am reading it
correctly:

C:\Documents and Settings\ga&gt;netstat -a

Active Connections

  Proto  Local Address          Foreign Address        State
  TCP    alpeduez:epmap         alpeduez:0             LISTENING
  TCP    alpeduez:microsoft-ds  alpeduez:0             LISTENING
  TCP    alpeduez:1227          alpeduez:0             LISTENING
  TCP    alpeduez:4369          alpeduez:0             LISTENING
  TCP    alpeduez:5672          alpeduez:0             LISTENING
  TCP    alpeduez:1229          localhost:4369         ESTABLISHED
  TCP    alpeduez:4369          localhost:1229         ESTABLISHED


&gt;<i> 
</I>&gt;<i> &gt; For three days I have been trying everything imaginable to me to get  
</I>&gt;<i> &gt; any client
</I>&gt;<i> &gt; program to connect to the rabbitmq server.  For example I disabled  
</I>&gt;<i> &gt; tcpv6 on my
</I>&gt;<i> &gt; system and tried all manner of user permissions in the rabbitmq  
</I>&gt;<i> &gt; server for 'guest'
</I>&gt;<i> &gt; and my custom account 'ga' which I gave all same permissions as  
</I>&gt;<i> &gt; 'guest'.
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> By default Rabbit ships with the user/pass combination guest/guest, so  
</I>&gt;<i> without further ado that should work.
</I>&gt;<i> 
</I>
I agree.  Unfortunately guest/guest really does not work at the moment if the sample
programs are an indication.  I shall remove the guest account's permissions for host
security purposes later after this problem is resoloved.  Default accounts that ship
with server programs are typical attack targets for malware and script kiddies.

&gt;<i> &gt; The web site asks users to send a note to <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">legitimateconcern at rabbitmq.com</A> 
</I>&gt;<i> &gt;  if it takes
</I>&gt;<i> &gt; more than 2 minutes to connect.  Si I have sent a detailed note.   
</I>&gt;<i> &gt; There has been no
</I>&gt;<i> &gt; response to it.
</I>&gt;<i> 
</I>&gt;<i> Don't want to split hairs but the address is <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">legitimategrievance at rabbitmq.com</A> 
</I>&gt;<i> , so you probably sent a message to a non-existent mailbox.
</I>&gt;<i> 
</I>
What I didn't tell you until now -- your answer is actually reasonable given what
you knew -- was that I pulled that email address from (human) memory as I was
writing, really only meant as an approximation to get the idea across of what I had
done.  It's not the email address I really used, which was copied from the web page
at rabbitmq.com into the clipboard memory and then pasted into the mail program
verbatim.  And lo, just a few minutes ago, another person has confirmed receipt of
the original email message, so it's known to be the correct address which I had used
the other day.

&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The web site says  Please join our mailing list or send questions to
</I>&gt;<i> &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">info at rabbitmq.com.</A> We'd love to hear from you.   I've subscribed and  
</I>&gt;<i> &gt; sent a detailed
</I>&gt;<i> &gt; message to the mailing list.  My email did not appear in the mailing  
</I>&gt;<i> &gt; list, and no
</I>&gt;<i> &gt; responses came back.
</I>&gt;<i> 
</I>&gt;<i> Here's one :-)
</I>

Very much appreciated.


&gt;<i> &gt; C:\rabbitmq\rabbitmq-dotnet-1.2.8025.1832- 
</I>&gt;<i> &gt; net-2.0\bin&gt;DeclareQueue.exe alpeduez
</I>&gt;<i> &gt; testqueue
</I>&gt;<i> &gt; None of the specified endpoints were reachable
</I>&gt;<i> &gt; Endpoints attempted:
</I>&gt;<i> &gt;  endpoint=amqp-0-<A HREF="9://alpeduez:5672,">9://alpeduez:5672,</A> attempts=1, outcome=AMQP server  
</I>&gt;<i> &gt; protocol
</I>&gt;<i> &gt; negotiation failure: server version 0-8, t
</I>&gt;<i> &gt; ransport parameters -1:-1
</I>&gt;<i> &gt; Stack trace:
</I>&gt;<i> &gt;   at RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32  
</I>&gt;<i> &gt; maxRedirects,
</I>&gt;<i> &gt; AmqpTcpEndpoint[] endpoints)
</I>&gt;<i> &gt;   at  
</I>&gt;<i> &gt; RabbitMQ.Client.ConnectionFactory.CreateConnection(AmqpTcpEndpoint[]
</I>&gt;<i> &gt; endpoints)
</I>&gt;<i> &gt;   at RabbitMQ.Client.ConnectionFactory.CreateConnection(String  
</I>&gt;<i> &gt; address)
</I>&gt;<i> &gt;   at RabbitMQ.Client.Examples.DeclareQueue.Main(String[] args)
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> You need to specify the protocol version in your config file (refer to  
</I>&gt;<i> the .NET client manual).
</I>&gt;<i> This client is defaulting to AMQP 0-9 whereas Rabbit currently speaks  
</I>&gt;<i> 0-8.
</I>&gt;<i> 
</I>

Your idea is intriguing... I have a good expectation about it.

You may well be correct.  It's interesting though, that the .Net client would be
defaulting to a version of the protocol which is more advanced than the RabbitMQ
server.  I wonder how the author developed the .Net client libs in advance of the
server.  He's a pretty advanced developer. ;)  

More specifically, in my own programs, I had been trying to use a construct like
this:

IProtocol protocol = Protocols.FromEnvironment();
IConnection conn = factory.CreateConnection(protocol, hostName);

To my surprise it didn't work.  Now, I am looking at the .NET client user guide
sections 2.2 and 2.3.

It says there is (or expected to be) an environment variable where it gets its
information:

&quot;If no argument is passed to FromEnvironment() or FromConfiguration(), the value of
Protocols.DefaultAppSettingsKey is used. (At the time of writing, the default
appSettings key is
AMQP_PROTOCOL, the same as the name of the shell environment variable scanned.)&quot;


Well the reality is that my system is telling me there really isn't any such shell
environment variable defined:  

C:\rabbitmq\librabbitmq-java-1.3.0&gt;echo %AMQP_PROTOCOL%
%AMQP_PROTOCOL%

Maybe this missing envoronment variable is why Protocols.FromEnvironment() is not
useful on my system.

Tyring to follow along with your suggestion, I guess there are two ways to get the
sample .NET programs working with the 0.8 protocol rather than 0.9 protocol.

1 - Change the environment variable AMQP_PROTOCOL.  However, my system is reporting
that I don't have this environment variable defined anywhere, so I don't know for
sure what to do.  Should I define one now?  I guess I could try to create one and
see what happens.  I guess I will set AMQP_PROTOCOL to the value &quot;AMQP_0_8&quot;.

2 - Change the .config file for every client application. Seeing as they don't have
config files out of the box, I would need to create config files for each one I
guess.

3 - If I am programming my own code, rather than working with the sample programs, I
could also specify my client to use just the desired protocol in a line of code like
this, per User Guide section 2.2:

Given the following App.config snippet,

&lt;appSettings&gt;
  &lt;add key=&quot;my-protocol&quot; value=&quot;AMQP_0_8&quot;/&gt;
&lt;/appSettings&gt;

the following code will also bind p to the 0-8 IProtocol implementation:

ConnectionFactory factory = new ConnectionFactory();
//IProtocol protocol = Protocols.FromEnvironment();
IProtocol p = Protocols.FromConfiguration(&quot;my-protocol&quot;);
IConnection conn = factory.CreateConnection(p, hostName);

Hopefully my own code will run if I write something like the above.  And I can try
to get the sample programs working later if I have time.


I guess I would ask you to cut to the chase if that's OK.  What did you or other
people actually do specifically on your own systems to get the .NET sample programs
working?   Did you manually create the environment variable AMQP_PROTOCOL and set it
to the value &quot;AMQP_0_8&quot;?


&gt;<i> &gt;
</I>&gt;<i> &gt; 4.  Go look again to see if Tracer saw any traffic:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; C:\rabbitmq\librabbitmq-java-1.3.0&gt;runjava.bat  
</I>&gt;<i> &gt; com.rabbitmq.tools.Tracer
</I>&gt;<i> &gt; Usage: Tracer [&lt;listenport&gt; [&lt;connecthost&gt; [&lt;connectport&gt;]]]
</I>&gt;<i> &gt; Invoked as: Tracer 5673 localhost 5672
</I>&gt;<i> &gt; com.rabbitmq.tools.Tracer.WITHHOLD_INBOUND_HEARTBEATS = false
</I>&gt;<i> &gt; com.rabbitmq.tools.Tracer.WITHHOLD_OUTBOUND_HEARTBEATS = false
</I>&gt;<i> &gt; com.rabbitmq.tools.Tracer.NO_ASSEMBLE_FRAMES = false
</I>&gt;<i> &gt; com.rabbitmq.tools.Tracer.NO_DECODE_FRAMES = false
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It seems no traffic was detected during the dotnet sample program  
</I>&gt;<i> &gt; execution.
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> Your client will need to connect to the listen port of the tracer,  
</I>&gt;<i> i.e. 5673. By default AMQP clients connect to 5672.
</I>&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Ben
</I>&gt;<i> 
</I>&gt;<i> 
</I>

OK that makes some sense.  Tracer is a simple proxy server then.

Thank you for the insightful responses.

Geoffrey


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000834.html">[rabbitmq-discuss] no connection established
</A></li>
	<LI>Next message: <A HREF="000849.html">[rabbitmq-discuss] no connection established
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#839">[ date ]</a>
              <a href="thread.html#839">[ thread ]</a>
              <a href="subject.html#839">[ subject ]</a>
              <a href="author.html#839">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
