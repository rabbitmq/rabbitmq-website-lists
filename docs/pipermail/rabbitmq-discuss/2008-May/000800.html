<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Controlling over-producers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Controlling%20over-producers&In-Reply-To=6c2563b20805070814v3cf83f04n361497ac332114c3%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000793.html">
   <LINK REL="Next"  HREF="000796.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Controlling over-producers</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Controlling%20over-producers&In-Reply-To=6c2563b20805070814v3cf83f04n361497ac332114c3%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Controlling over-producers">matthias at lshift.net
       </A><BR>
    <I>Wed May  7 22:39:41 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000793.html">[rabbitmq-discuss] Controlling over-producers
</A></li>
        <LI>Next message: <A HREF="000796.html">[rabbitmq-discuss] Channel crashes after basic.cancel_ok.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#800">[ date ]</a>
              <a href="thread.html#800">[ thread ]</a>
              <a href="subject.html#800">[ subject ]</a>
              <a href="author.html#800">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Edwin,

Edwin Fine wrote:
&gt;<i>  2. The consumer often gets flooded with messages from the producer
</I>&gt;<i>  when it does some time-based operations. In Erlang, this means that
</I>&gt;<i>  the consumer's Erlang message queue grows to a couple hundred
</I>&gt;<i>  messages, which is not what I want. I want the producer to stop
</I>&gt;<i>  sending messages when the consumer is too busy.
</I>
Do you require end-to-end flow control, i.e. you need to throttle the 
publisher of the messages when the consumer cannot keep up, or just flow 
control between the broker and the consumer?

&gt;<i>  Messages must not be lost and are marked persistent, so I want them to
</I>&gt;<i>  stay on disk until the consumer acknowledges successful processing. Am
</I>&gt;<i>  I correct to assume RabbitMQ does this if I have marked the queue as
</I>&gt;<i>  persistent and have not replied to the basic.deliver with an ack?
</I>
The messages themselves need to be marked as persistent, and the queue 
needs to be marked as durable.

&gt;<i>  3. The channel.flow object is not currently implemented in RabbitMQ; I
</I>&gt;<i>  think this would be perfect to do this.
</I>
channel.flow is rather imperfect :) For starters, it operates on an 
entire channel, whereas it looks like you want it to operate on a 
per-consumer basis.

&gt;<i>  4. IIRC, a suggestion was for the consumer to basic.cancel itself
</I>&gt;<i>  until the load reduces, and then re-subscribe (basic.consume) once the
</I>&gt;<i>  overflow condition has abated. This seems heavy-handed, and possibly
</I>&gt;<i>  resource-intensive, especially since it might happen relatively
</I>&gt;<i>  frequently.
</I>
The frequency is unlikely to be an issue - basic.consume/cancel are 
pretty efficient.

The more serious problem may be prefetching. By the time your consumer 
wants to start throttling there may already be a large number of 
messages in flight. The client will still receive these after issuing a 
basic.cancel, or, for that matter, channel.flow.

You can address that by switching to use basic.get, though that is 
non-blocking.


Matthias


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000793.html">[rabbitmq-discuss] Controlling over-producers
</A></li>
	<LI>Next message: <A HREF="000796.html">[rabbitmq-discuss] Channel crashes after basic.cancel_ok.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#800">[ date ]</a>
              <a href="thread.html#800">[ thread ]</a>
              <a href="subject.html#800">[ subject ]</a>
              <a href="author.html#800">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
