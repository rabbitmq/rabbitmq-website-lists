<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Channel crashes after basic.cancel_ok.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Channel%20crashes%20after%20basic.cancel_ok.&In-Reply-To=6c2563b20805071057l7e486da8k660150772397148%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000796.html">
   <LINK REL="Next"  HREF="000798.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Channel crashes after basic.cancel_ok.</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Channel%20crashes%20after%20basic.cancel_ok.&In-Reply-To=6c2563b20805071057l7e486da8k660150772397148%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Channel crashes after basic.cancel_ok.">0x6e6562 at gmail.com
       </A><BR>
    <I>Wed May  7 21:29:48 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000796.html">[rabbitmq-discuss] Channel crashes after basic.cancel_ok.
</A></li>
        <LI>Next message: <A HREF="000798.html">[rabbitmq-discuss] Channel crashes after basic.cancel_ok.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#797">[ date ]</a>
              <a href="thread.html#797">[ thread ]</a>
              <a href="subject.html#797">[ subject ]</a>
              <a href="author.html#797">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Edwin,

On 7 May 2008, at 18:57, Edwin Fine wrote:

&gt;<i> Using Rabbit 1.3.0, Erlang client, Ubuntu Linux Feisty, Erlang  
</I>&gt;<i> R12B-2 64-bit
</I>&gt;<i>
</I>&gt;<i> Consumer channel crashes as follows when I do the following:
</I>&gt;<i>
</I>&gt;<i> 1. Subscribe (basic.consume)
</I>&gt;<i> 2. Unsubscribe (basic.cancel)
</I>&gt;<i>
</I>&gt;<i> The channel crashes handling the basic.cancel_ok. I can't figure out
</I>&gt;<i> why. The channel is under some load (about 100 - 130 messages/second).
</I>&gt;<i> I haven't yet built a standalone test case to try to reproduce this,
</I>&gt;<i> but it happens consistently in my code.
</I>&gt;<i>
</I>&gt;<i> The code to subscribe is:
</I>&gt;<i>
</I>&gt;<i>    #'basic.consume_ok'{consumer_tag = ConsumerTag} =
</I>&gt;<i> amqp_channel:call(Channel, BasicConsume, self())
</I>&gt;<i>
</I>&gt;<i> and this works fine.
</I>&gt;<i>
</I>&gt;<i> The code to cancel is
</I>&gt;<i>
</I>&gt;<i>    BasicCancel = #'basic.cancel'{consumer_tag = ConsumerTag, nowait  
</I>&gt;<i> = false},
</I>&gt;<i>    #'basic.cancel_ok'{consumer_tag = ConsumerTag} =
</I>&gt;<i> amqp_channel:call(Channel, BasicCancel).
</I>&gt;<i>
</I>&gt;<i> The problem seems to be
</I>&gt;<i>
</I>&gt;<i> ** {function_clause,
</I>&gt;<i>       [{gen_server,reply,
</I>&gt;<i>            [&lt;&lt;&gt;&gt;,
</I>&gt;<i>             {'basic.cancel_ok',&lt;&lt;&quot;XHG.DELIVERY.Q.HTTP031.HC031&quot;&gt;&gt;}]},
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What am I doing wrong? Any ideas?
</I>
What you are seeing is a symptom of an error in the RPC handling.  
Essentially, the channel process is receiving a notification that it  
thinks it has already sent to the invoking process.

It would be really good if you could send some code that might help me  
reproduce this myself.

In the meantime I will look into this and see if I can come up with a  
solution.

HTH,

Ben



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000796.html">[rabbitmq-discuss] Channel crashes after basic.cancel_ok.
</A></li>
	<LI>Next message: <A HREF="000798.html">[rabbitmq-discuss] Channel crashes after basic.cancel_ok.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#797">[ date ]</a>
              <a href="thread.html#797">[ thread ]</a>
              <a href="subject.html#797">[ subject ]</a>
              <a href="author.html#797">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
