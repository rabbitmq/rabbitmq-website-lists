<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] TX for guarantees of completion (was Re:	persistence)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20TX%20for%20guarantees%20of%20completion%20%28was%20Re%3A%0A%09persistence%29&In-Reply-To=20080522102251.mirikefyo0cck4k8%40mail.tu-chemnitz.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000892.html">
   <LINK REL="Next"  HREF="000850.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] TX for guarantees of completion (was Re:	persistence)</H1>
    <B>Tony Garnock-Jones</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20TX%20for%20guarantees%20of%20completion%20%28was%20Re%3A%0A%09persistence%29&In-Reply-To=20080522102251.mirikefyo0cck4k8%40mail.tu-chemnitz.de"
       TITLE="[rabbitmq-discuss] TX for guarantees of completion (was Re:	persistence)">tonyg at lshift.net
       </A><BR>
    <I>Fri May 30 10:15:19 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000892.html">[rabbitmq-discuss] persistence
</A></li>
        <LI>Next message: <A HREF="000850.html">[rabbitmq-discuss] possible bug starting rabbit with NODENAME set?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#891">[ date ]</a>
              <a href="thread.html#891">[ thread ]</a>
              <a href="subject.html#891">[ subject ]</a>
              <a href="author.html#891">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Lars Bachmann wrote:
&gt;<i> Mathias,
</I>&gt;<i> 
</I>&gt;<i> I made some more tests [...]
</I>
Just to reiterate what Matthias said: I think that using TX mode will
get you the behaviour you're after.

If you like, you could try the following:

  1. as soon as you have opened a channel, call txSelect() on it
  2. every 50 (or 10, or 100, or 500) publishes, call txCommit()
  3. just before you call close(), call txCommit()

If you do something like this, you are effectively using the txCommit
(and, importantly, the reply you receive to it from the server) as a
synchronisation point.

The reply to txCommit counts as confirmation from the server that all
the submitted messages prior to the commit have been processed.

The final call to txCommit immediately before close is the part that
forces all the outstanding work to be complete before the socket closes.

You can vary the number in step two to trade off latency against throughput.

Do let us know how this works out for you, if you try it!

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] <A HREF="http://www.lshift.net/">http://www.lshift.net/</A> | Email: <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tonyg at lshift.net</A>


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000892.html">[rabbitmq-discuss] persistence
</A></li>
	<LI>Next message: <A HREF="000850.html">[rabbitmq-discuss] possible bug starting rabbit with NODENAME set?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#891">[ date ]</a>
              <a href="thread.html#891">[ thread ]</a>
              <a href="subject.html#891">[ subject ]</a>
              <a href="author.html#891">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
