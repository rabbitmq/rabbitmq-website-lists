<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] beam instances and growing memory usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20beam%20instances%20and%20growing%20memory%20usage&In-Reply-To=F24DBA33-46BC-443C-9014-465C2EDA4B50%40corp.meez.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000324.html">
   <LINK REL="Next"  HREF="000327.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] beam instances and growing memory usage</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20beam%20instances%20and%20growing%20memory%20usage&In-Reply-To=F24DBA33-46BC-443C-9014-465C2EDA4B50%40corp.meez.com"
       TITLE="[rabbitmq-discuss] beam instances and growing memory usage">matthias at lshift.net
       </A><BR>
    <I>Sat Nov 17 08:46:15 GMT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000324.html">[rabbitmq-discuss] beam instances and growing memory usage
</A></li>
        <LI>Next message: <A HREF="000327.html">[rabbitmq-discuss] Are there any public RabbitMQ feeds (e.g.,	delayed stock prices)?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#326">[ date ]</a>
              <a href="thread.html#326">[ thread ]</a>
              <a href="subject.html#326">[ subject ]</a>
              <a href="author.html#326">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matt,

matt wrote:
&gt;<i> When we did a complete site restart on Tuesday night, Wednesday worked 
</I>&gt;<i> flawlessly.  We rebuilt the cluster (disk based nodes) and created a 
</I>&gt;<i> total of 7 brokers on the box.
</I>
When you are saying &quot;disk based nodes&quot;, do you mean that all broker 
nodes are configured as disk nodes? That is not good for performance. If 
you have all nodes on a single machine and they all write to the same 
disk then there is no point having more than one disk node.

&gt;<i> When I was watching the instances on Wednesday, each instance was 
</I>&gt;<i> taking up about 0.1% of the server ram, according to top. I checked
</I>&gt;<i> yesterday (Thursday) and each instance was taking 2.0%. I just looked
</I>&gt;<i> now (Friday) and it's taking 2.9%. Durable is set to false - so it
</I>&gt;<i> doesn't appear that things should be persisting anywhere. Any ideas
</I>&gt;<i> why it'd be growing over time?
</I>
The growth is not necessarily anything to worry about. You still have 
plenty of memory left and the growth might stop after a while. Keep an 
eye on it.

It is worth checking the queue sizes. Connect to one of the nodes in 
your cluster - any node will do - and run rabbit_amqqueue:stat_all(), e.g.

$ erl -sname debug -hidden -remsh <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at tanto</A>
Erlang (BEAM) emulator version 5.5.5 [source] [async-threads:0] [hipe] 
[kernel-poll:false]
Eshell V5.5.5  (abort with ^G)
(<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at tanto</A>)1&gt; rabbit_amqqueue:stat_all().
[{ok,{resource,&lt;&lt;&quot;/&quot;&gt;&gt;,queue,&lt;&lt;&quot;test queue&quot;&gt;&gt;},0,0}]
(<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at tanto</A>)2&gt; CTRL-c CTRL-c

That will list all the queues in the system, their message queue length 
and their number of consumers.


On another topic, from your 'top' reports I notice that although the CPU 
load is unevenly distributed over the nodes, the distribution changes 
over time and the cumulative CPU times are much more even. So it looks 
like your load-balancing logic is working fine over the long run. 
Curiously though there are two nodes in your latter report which have 
accumulated much less CPU time.


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000324.html">[rabbitmq-discuss] beam instances and growing memory usage
</A></li>
	<LI>Next message: <A HREF="000327.html">[rabbitmq-discuss] Are there any public RabbitMQ feeds (e.g.,	delayed stock prices)?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#326">[ date ]</a>
              <a href="thread.html#326">[ thread ]</a>
              <a href="subject.html#326">[ subject ]</a>
              <a href="author.html#326">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
