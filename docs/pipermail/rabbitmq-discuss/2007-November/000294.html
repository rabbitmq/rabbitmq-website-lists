<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Queue inspector.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Queue%20inspector.&In-Reply-To=472F5EDE.6070805%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000293.html">
   <LINK REL="Next"  HREF="000295.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Queue inspector.</H1>
    <B>matt</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Queue%20inspector.&In-Reply-To=472F5EDE.6070805%40lshift.net"
       TITLE="[rabbitmq-discuss] Queue inspector.">matt at meez.com
       </A><BR>
    <I>Mon Nov  5 19:26:45 GMT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000293.html">[rabbitmq-discuss] Queue inspector.
</A></li>
        <LI>Next message: <A HREF="000295.html">[rabbitmq-discuss] Queue inspector.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#294">[ date ]</a>
              <a href="thread.html#294">[ thread ]</a>
              <a href="subject.html#294">[ subject ]</a>
              <a href="author.html#294">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Getting the message count only appears to get updated when you declare  
the queue.  What if you wanted to poll the queue and see how many  
messages were on it every 15 seconds or so?  Creating a new binding to  
the queue just to get the message count seems a bit expensive.

The main reason for wanting the message count is so that we can  
determine if we need to bring more consumer instances online when  
we're getting hammered (EC2 instances currently).

thx,
-matt

On Nov 5, 2007, at 10:20 AM, Matthias Radestock wrote:

&gt;<i> Matt,
</I>&gt;<i>
</I>&gt;<i> matt wrote:
</I>&gt;&gt;<i> First off, I want to say how much we love amqp and rabbitMQ!
</I>&gt;<i>
</I>&gt;<i> Thank you. It is always nice to hear from real users.
</I>&gt;<i>
</I>&gt;&gt;<i> We've ( meez.com) been using it in our production environment (when
</I>&gt;&gt;<i> it was alpha) for about 6 months now I think.
</I>&gt;&gt;<i> In brief, we use rabbitMQ as a way of communicating with our
</I>&gt;&gt;<i> rendering cluster.  We have user facing tomcat servers that provide a
</I>&gt;&gt;<i> way of giving the user options to create an avatar.  Upon save, we
</I>&gt;&gt;<i> send export requests via rabbitMQ and they're picked up by nodes in
</I>&gt;&gt;<i> the export cloud.  Upon success of the rendered images, a
</I>&gt;&gt;<i> notification is sent back and the user is notified that the exports
</I>&gt;&gt;<i> were successful.
</I>&gt;<i>
</I>&gt;<i> That is a pretty neat use case, and it is good to hear that RabbitMQ
</I>&gt;<i> worked out well for you.
</I>&gt;<i>
</I>&gt;&gt;<i> the big immediate need we're looking for is a way to see how much is
</I>&gt;&gt;<i> being queued up on the rabbitMQ cluster.  That way, we can
</I>&gt;&gt;<i> programatically bring EC2 nodes up or take then down based on need.
</I>&gt;&gt;<i> I know that this is in the pipeline - but is there *any* way of doing
</I>&gt;&gt;<i> this now and/or is there something that could be easily added to  
</I>&gt;&gt;<i> support this?
</I>&gt;<i>
</I>&gt;<i> queue.declare-ok, the result of a queue.declare operation, in one of  
</I>&gt;<i> its fields contains the number of messages in the queue. This is  
</I>&gt;<i> part of the amqp 0-8 spec and implemented by RabbitMQ. In  
</I>&gt;<i> combination with queue.declare's passive flag it allows you to  
</I>&gt;<i> determine the length of existing queues.
</I>&gt;<i>
</I>&gt;<i> If you are using the RabbitMQ Java client, check out
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/javadoc/com/rabbitmq/client/impl/ChannelN.html#queueDeclare(int,%20java.lang.String,%20boolean,%20boolean,%20boolean,%20boolean,%20java.util.Map">http://www.rabbitmq.com/javadoc/com/rabbitmq/client/impl/ChannelN.html#queueDeclare(int,%20java.lang.String,%20boolean,%20boolean,%20boolean,%20boolean,%20java.util.Map</A>) 
</I>&gt;<i> ,
</I>&gt;<i> and
</I>&gt;<i> <A HREF="http://www.rabbitmq.com/javadoc/com/rabbitmq/client/impl/AMQImpl.Queue.DeclareOk.html#getMessageCount(">http://www.rabbitmq.com/javadoc/com/rabbitmq/client/impl/AMQImpl.Queue.DeclareOk.html#getMessageCount(</A>)
</I>&gt;<i>
</I>&gt;<i> This is only a very limited interface - you need to know the names  
</I>&gt;<i> of queues and you only get a report on the number of messages, not  
</I>&gt;<i> their storage size etc - but perhaps that is sufficient for your  
</I>&gt;<i> needs?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hope this helps, and thank you for using RabbitMQ,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Matthias.
</I>

--
Matt Darling
Director, Server Engineering
Meez
182 2nd Street, 5th Floor
San Francisco, CA 94105
(m) 415.505.4623
<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matt at corp.meez.com</A>



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071105/2f6aa72a/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20071105/2f6aa72a/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000293.html">[rabbitmq-discuss] Queue inspector.
</A></li>
	<LI>Next message: <A HREF="000295.html">[rabbitmq-discuss] Queue inspector.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#294">[ date ]</a>
              <a href="thread.html#294">[ thread ]</a>
              <a href="subject.html#294">[ subject ]</a>
              <a href="author.html#294">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
