<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Queue inspector.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Queue%20inspector.&In-Reply-To=167204d20711061013i546692f9h382c6a2b2fb38ca0%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000301.html">
   <LINK REL="Next"  HREF="000305.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Queue inspector.</H1>
    <B>Brian Granger</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Queue%20inspector.&In-Reply-To=167204d20711061013i546692f9h382c6a2b2fb38ca0%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Queue inspector.">ellisonbg.net at gmail.com
       </A><BR>
    <I>Tue Nov  6 20:02:47 GMT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000301.html">[rabbitmq-discuss] Queue inspector.
</A></li>
        <LI>Next message: <A HREF="000305.html">[rabbitmq-discuss] Queue inspector.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#302">[ date ]</a>
              <a href="thread.html#302">[ thread ]</a>
              <a href="subject.html#302">[ subject ]</a>
              <a href="author.html#302">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Brian
</I>&gt;<i>
</I>&gt;<i> Thanks for your note - that helps.
</I>
No problem.

&gt;<i> On 11/6/07, Brian Granger &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ellisonbg.net at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; I am evaluating rabbitmq/amqp to see if it would do what we need it
</I>&gt;<i> &gt; to.  Our system has a worker/master architecture and we would like to
</I>&gt;<i> &gt; use rabbitmq for the master&lt;-&gt; worker messaging.
</I>&gt;<i>
</I>&gt;<i> Great :-)
</I>&gt;<i>
</I>&gt;<i> Work queues are a common pattern and we would love to hear how you get on.
</I>
As I move forward I will let you know how it goes.

&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; There are a few
</I>&gt;<i> &gt; constraints in our system though:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - workers come and go at any time.
</I>&gt;<i>
</I>&gt;<i> Indeed this is also a common situation when you want your system to be
</I>&gt;<i> robust - as I assume you do.  Some of this will be supported more
</I>&gt;<i> 'inherently' in future versions of AMQP, eg for federations of
</I>&gt;<i> brokers.  But I think there is enough in RabbitMQ as it is today, and
</I>&gt;<i> as it currently clusters, to get you going.
</I>
This is definitely a very common pattern - although our system has a
few unusual properties (more on that below)

&gt;<i>
</I>&gt;<i> &gt; - each worker needs a private queue
</I>&gt;<i>
</I>&gt;<i> Is that strictly needed for your use case?
</I>
Yes, each worker does need a private queue so workers can directly
send messages to a given worker.  But, it gets more complicated than
that in a number of ways:

- The master needs to be able to push messages to arbitrary sets of
workers.  Our general syntax (our master in written in python) looks
like this:

push(list_of_workers, msg)

So you see things like this:

push(getIDs(), msg)  that does a broadcast or:

push(range(10), msg) that pushes to workers 0,1,...10

- Obviously, when pushing messages to specific workers, you can't do
dynamic load balancing.  To support dynamic load balancing we have
another single shared FIFO queue that sits on top of the private
worker queues.  We have a scheduler that pulls things off the shared
queue and puts them on the private queues, based on how many messages
there are in the private queues at any given moment.  I am not sure if
rabbitmq/amqp will be able to handle this more complex queue logic as
it would require logic *in* the rabbitmq server......

So, the next question is ..... how easy it is to build custom rabbitmq
servers that have custom queue logic.  Basically, I need queues to be
able to act as clients to other queues.

Currently we have implemented this system using twisted (an
asynchronous networking framework in python).  It works extremely
well....but it doesn't scale to  a large number of workers, which is
why we are looking at erlang/amqp.  It might be the case that we need
to implement our server at a lower level in erlang, but I really like
rabbitmq/amqp.

Any ideas you have about how to approach this would be greatly appreciated.

&gt;<i> You could have workers in groups, sharing a queue on a round robin
</I>&gt;<i> basis.  Then they can 'pull' work and no registry is needed.
</I>
We have thought about things like this, but we would still need to
have the push mode as well.

&gt;<i>
</I>&gt;<i> &gt; - the master process needs to be
</I>&gt;<i> &gt; able to see which workers are currently connected.
</I>&gt;<i>
</I>&gt;<i> Yes - if you want to 'push' work and each worker must have a private queue.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; My initial thought
</I>&gt;<i> &gt; is that this could be accomplished by the master getting a list of
</I>&gt;<i> &gt; queues.
</I>&gt;<i>
</I>&gt;<i> Got it.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; My current thought is to have a separate queue that workers use to
</I>&gt;<i> &gt; register/unregister themselves.  They could put the name of their
</I>&gt;<i> &gt; private queue on this registration queue.
</I>&gt;<i>
</I>&gt;<i> I would certainly do this if you want to 'push' work.  In effect you
</I>&gt;<i> are making the registry explicit and this would be very useful for
</I>&gt;<i> other implementation patterns, eg shared services 'fed' by queues (a
</I>&gt;<i> bit like an 'ESB').
</I>
OK, it is good to know that I am on the right track.

Thanks

Brian

&gt;<i>
</I>&gt;<i> &gt; But, it would be nice to have more introspection capabilities.
</I>&gt;<i>
</I>&gt;<i> I wholly agree!
</I>&gt;<i>
</I>&gt;<i> alexis
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Brian
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 11/6/07, Alexis Richardson &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at cohesiveft.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; Brian
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Not yet, I'm afraid :-(
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Management features are due in a future version of AMQP.  How
</I>&gt;<i> &gt; &gt; important is this for you today?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; alexis
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On 11/5/07, Brian Granger &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ellisonbg.net at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; On a related note, is there a way of querying the server to get the
</I>&gt;<i> &gt; &gt; &gt; names of all the queues?
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Thanks
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Brian
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; On 11/5/07, Matthias Radestock &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; Matt,
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; matt wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Getting the message count only appears to get updated when you declare
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; the queue.  What if you wanted to poll the queue and see how many
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; messages were on it every 15 seconds or so?
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; queue.declare has a passive mode of operation where it doesn't actually
</I>&gt;<i> &gt; &gt; &gt; &gt; create a new queue. That's what I was referring to when I wrote that &quot;in
</I>&gt;<i> &gt; &gt; &gt; &gt; combination with queue.declare's passive flag it allows you to determine
</I>&gt;<i> &gt; &gt; &gt; &gt; the length of existing queues&quot;.
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; Matthias.
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt; &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; &gt; &gt; &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; &gt; &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; &gt; &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; --
</I>&gt;<i> &gt; &gt; Alexis Richardson
</I>&gt;<i> &gt; &gt; +44 20 7617 7339 (UK)
</I>&gt;<i> &gt; &gt; +44 77 9865 2911 (cell)
</I>&gt;<i> &gt; &gt; +1 650 206 2517 (US)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Alexis Richardson
</I>&gt;<i> +44 20 7617 7339 (UK)
</I>&gt;<i> +44 77 9865 2911 (cell)
</I>&gt;<i> +1 650 206 2517 (US)
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000301.html">[rabbitmq-discuss] Queue inspector.
</A></li>
	<LI>Next message: <A HREF="000305.html">[rabbitmq-discuss] Queue inspector.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#302">[ date ]</a>
              <a href="thread.html#302">[ thread ]</a>
              <a href="subject.html#302">[ subject ]</a>
              <a href="author.html#302">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
