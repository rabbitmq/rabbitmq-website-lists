<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Queue inspector.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Queue%20inspector.&In-Reply-To=167204d20711070958x11a2bc6agf3e653e27e839ace%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000305.html">
   <LINK REL="Next"  HREF="000307.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Queue inspector.</H1>
    <B>Brian Granger</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Queue%20inspector.&In-Reply-To=167204d20711070958x11a2bc6agf3e653e27e839ace%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Queue inspector.">ellisonbg.net at gmail.com
       </A><BR>
    <I>Wed Nov  7 20:42:03 GMT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000305.html">[rabbitmq-discuss] Queue inspector.
</A></li>
        <LI>Next message: <A HREF="000307.html">[rabbitmq-discuss] Queue inspector.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#306">[ date ]</a>
              <a href="thread.html#306">[ thread ]</a>
              <a href="subject.html#306">[ subject ]</a>
              <a href="author.html#306">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alexis,

On 11/7/07, Alexis Richardson &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at cohesiveft.com</A>&gt; wrote:
&gt;<i> Brian
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 11/6/07, Brian Granger &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ellisonbg.net at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; our system has a
</I>&gt;<i> &gt; few unusual properties (more on that below)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; &gt; - each worker needs a private queue
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Is that strictly needed for your use case?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Yes, each worker does need a private queue so workers can directly
</I>&gt;<i> &gt; send messages to a given worker.  But, it gets more complicated than
</I>&gt;<i> &gt; that in a number of ways:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; - The master needs to be able to push messages to arbitrary sets of
</I>&gt;<i> &gt; workers.  Our general syntax (our master in written in python) looks
</I>&gt;<i> &gt; like this:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; push(list_of_workers, msg)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; So you see things like this:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; push(getIDs(), msg)  that does a broadcast or:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; push(range(10), msg) that pushes to workers 0,1,...10
</I>&gt;<i>
</I>&gt;<i> OK, this is good.  I assume you also have queues for work done
</I>&gt;<i> (results) and work in progress (lease-based?).
</I>
Yep, these queues would also have to be there.


&gt;<i> &gt; So, the next question is ..... how easy it is to build custom rabbitmq
</I>&gt;<i> &gt; servers that have custom queue logic.  Basically, I need queues to be
</I>&gt;<i> &gt; able to act as clients to other queues.
</I>&gt;<i>
</I>&gt;<i> OK, there are at least three answers to this question :-)
</I>&gt;<i>
</I>&gt;<i> 1. You can do this today by running a scheduler that is a regular
</I>&gt;<i> client and acts both as a producer and a consumer.  You may have
</I>&gt;<i> latency concerns if your units of work are fine grained (say &lt;10ms
</I>&gt;<i> total work time per task).  If you do not, then I would recommend
</I>&gt;<i> looking at this as a solution.  If you do have latency concerns then I
</I>&gt;<i> would still start here as a prototype since you will be able to verify
</I>&gt;<i> that it scales.   By the way, you can also improve latency by
</I>&gt;<i> colocating processes (or using a single process - see 3 below).
</I>
The other option that is related to this one would be to have each
worker pull from both its private queue and the shared one.  I would
just need to make some decisions about which has priority in given
situations.  Unfortunately, latency is a big issue for us - the lower
the better.

&gt;<i> 2. Future versions of AMQP will support 'chaining' of brokers and
</I>&gt;<i> federation better.  Solutions of type 1 will, most likely, be able to
</I>&gt;<i> gracefully adopt the likely new features at low cost.
</I>
I see.  That would be fantastic, as long as the chaining was
relatively flexible.

&gt;<i> 3. You can mod the broker by running 'in broker consumers' and 'in
</I>&gt;<i> broker producers'.  This is a very interesting area for future work
</I>&gt;<i> but it would require a knowledge of Erlang.  We would be happy to help
</I>&gt;<i> on list.  However if this is your goal then I would still start at 1
</I>&gt;<i> (which also lets you try out multiple brokers and remain
</I>&gt;<i> interoperability-compliant).
</I>
I don't mind learning Erlang if it is needed.  My other option is to
just write a custom solution from scratch in Erlang.  But rabbitmq
seems to have many of the pieces already, so I would really like to
use it if possible.  Thanks for the offer of help - I will keep you
posted.

&gt;<i> &gt; Currently we have implemented this system using twisted (an
</I>&gt;<i> &gt; asynchronous networking framework in python).  It works extremely
</I>&gt;<i> &gt; well....but it doesn't scale to  a large number of workers, which is
</I>&gt;<i> &gt; why we are looking at erlang/amqp.
</I>&gt;<i>
</I>&gt;<i> Interesting stuff - how many workers?  (If that's not an impertinent
</I>&gt;<i> question ..)
</I>
We are using this architecture for parallel computing in Python.  Our
workers are basically Python interpreters exposed to the network.  Our
&quot;clients&quot; are also python scripts that submit python code/objects to
the workers to be performed.  As you can imagine I am looking at the
qpid python amqp client.  We have run already with up to 256 workers
and we already see scaling problems.  Our stuff works just fine on
supercomputers, so we would like to scale up to.....2**10, 2**11,
2**12, etc.  We hit scaling problems in a number of ways:

1) # of file descriptors per process.
2) broadcasting/multicasting to all (or large subsets) of workers.
3) Latency - the latency determines the grain size of work, which we
would like to be as small as possible.
4) Large messages.  In some cases, the messages can be very large
(files or large data sets).  It is not uncommon for people to want to
distribute 100 MB messages to subsets of workers.  Our current
solution generates a short lived temporary copy of the large objects
for each worker they are sent to.  This means if we have 128 workers,
we use 128*msg_size memory for a short period of time.  We know how to
fix this in Python, but it still doesn't solve the other scalability
problems.  All that to say, any solution that we come up with must
also be able to handle large messages well.  Does rabbitmq have any
streaming support?

&gt;<i>
</I>&gt;<i> &gt;  It might be the case that we need
</I>&gt;<i> &gt; to implement our server at a lower level in erlang, but I really like
</I>&gt;<i> &gt; rabbitmq/amqp.
</I>&gt;<i>
</I>&gt;<i> Thank-you very much.  I hope we can help you avoid having to care
</I>&gt;<i> about the lower levels.
</I>
I would love to avoid the lower level stuff, but I also realize we
have a somewhat unusual set of design requirements (scalability,
low-latency &amp;&amp; ability to handle large messages).  In various
prototypes we even implemented custom protocols on top of TCP.  Once
you start doing that Erlang becomes a &quot;high-level&quot; solution :)

&gt;<i>
</I>&gt;<i> &gt; &gt; I would certainly do this if you want to 'push' work.  In effect you
</I>&gt;<i> &gt; &gt; are making the registry explicit and this would be very useful for
</I>&gt;<i> &gt; &gt; other implementation patterns, eg shared services 'fed' by queues (a
</I>&gt;<i> &gt; &gt; bit like an 'ESB').
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; OK, it is good to know that I am on the right track.
</I>&gt;<i>
</I>&gt;<i> Cool.  Please let us know if you need help, eg with the deregistration methods.
</I>
Ahh yes, the deregistration methods could be subtle.  The main concern
there is if a worker dies without notifying the server that they are
going to die.  What facilities does rabbitmq/amqp have to handle this
type of stuff?

Thanks much for your help!

Brian


&gt;<i> alexis
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Brian
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; But, it would be nice to have more introspection capabilities.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I wholly agree!
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; alexis
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Thanks
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Brian
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; On 11/6/07, Alexis Richardson &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">alexis.richardson at cohesiveft.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; Brian
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; Not yet, I'm afraid :-(
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; Management features are due in a future version of AMQP.  How
</I>&gt;<i> &gt; &gt; &gt; &gt; important is this for you today?
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; alexis
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; On 11/5/07, Brian Granger &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ellisonbg.net at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; On a related note, is there a way of querying the server to get the
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; names of all the queues?
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Thanks
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Brian
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; On 11/5/07, Matthias Radestock &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; Matt,
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; matt wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; Getting the message count only appears to get updated when you declare
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; the queue.  What if you wanted to poll the queue and see how many
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; messages were on it every 15 seconds or so?
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; queue.declare has a passive mode of operation where it doesn't actually
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; create a new queue. That's what I was referring to when I wrote that &quot;in
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; combination with queue.declare's passive flag it allows you to determine
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; the length of existing queues&quot;.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; Matthias.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; rabbitmq-discuss mailing list
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; <A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; --
</I>&gt;<i> &gt; &gt; &gt; &gt; Alexis Richardson
</I>&gt;<i> &gt; &gt; &gt; &gt; +44 20 7617 7339 (UK)
</I>&gt;<i> &gt; &gt; &gt; &gt; +44 77 9865 2911 (cell)
</I>&gt;<i> &gt; &gt; &gt; &gt; +1 650 206 2517 (US)
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; --
</I>&gt;<i> &gt; &gt; Alexis Richardson
</I>&gt;<i> &gt; &gt; +44 20 7617 7339 (UK)
</I>&gt;<i> &gt; &gt; +44 77 9865 2911 (cell)
</I>&gt;<i> &gt; &gt; +1 650 206 2517 (US)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Alexis Richardson
</I>&gt;<i> +44 20 7617 7339 (UK)
</I>&gt;<i> +44 77 9865 2911 (cell)
</I>&gt;<i> +1 650 206 2517 (US)
</I>&gt;<i>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000305.html">[rabbitmq-discuss] Queue inspector.
</A></li>
	<LI>Next message: <A HREF="000307.html">[rabbitmq-discuss] Queue inspector.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#306">[ date ]</a>
              <a href="thread.html#306">[ thread ]</a>
              <a href="subject.html#306">[ subject ]</a>
              <a href="author.html#306">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
