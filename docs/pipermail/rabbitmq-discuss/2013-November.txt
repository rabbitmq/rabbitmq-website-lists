From agram at blackridge.us  Fri Nov  1 02:42:09 2013
From: agram at blackridge.us (Andy Gram)
Date: Fri, 1 Nov 2013 02:42:09 +0000
Subject: [rabbitmq-discuss] messages stuck using shovel
In-Reply-To: <8c0475d57f2446ca9604949eb4bd05a7@BN1PR07MB199.namprd07.prod.outlook.com>
References: <fdb1d592867044d290aa57bbc45bf33f@BN1PR07MB199.namprd07.prod.outlook.com>
	<8c0475d57f2446ca9604949eb4bd05a7@BN1PR07MB199.namprd07.prod.outlook.com>
Message-ID: <e4d37ce74b4b4870be8399ee7aa3ef89@BN1PR07MB199.namprd07.prod.outlook.com>

And I should have provided this from devmid:

[{ident_refresh,
     {running,
         {source,
             {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
                 "192.168.168.212",undefined,0,0,0,infinity,none,
                 [#Fun<amqp_uri.7.32597394>,#Fun<amqp_uri.7.32597394>],
                 [],[]}},
         {destination,
             {amqp_params_direct,<<"guest">>,none,<<"/">>,rabbit at devmid,none,
                 []}}},
     {{2013,10,31},{17,32,2}}},
{ident_pub,
     {running,
         {source,
             {amqp_params_direct,<<"guest">>,none,<<"/">>,rabbit at devmid,none,
                 []}},
         {destination,
             {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
                 "192.168.168.212",undefined,0,0,0,infinity,none,
                 [#Fun<amqp_uri.7.32597394>,#Fun<amqp_uri.7.32597394>],
                 [],[]}}},
     {{2013,10,31},{17,32,2}}},
{ident_sub,
     {running,
         {source,
             {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
                 "192.168.168.212",undefined,0,0,0,infinity,none,
                 [#Fun<amqp_uri.7.32597394>,#Fun<amqp_uri.7.32597394>],
                 [],[]}},
         {destination,
             {amqp_params_direct,<<"guest">>,none,<<"/">>,rabbit at devmid,none,
                 []}}},
     {{2013,10,31},{17,32,2}}},
{refresh_req,
     {running,
         {source,
             {amqp_params_direct,<<"guest">>,none,<<"/">>,rabbit at devmid,none,
                 []}},
         {destination,
             {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
                 "192.168.168.212",undefined,0,0,0,infinity,none,
                 [#Fun<amqp_uri.7.32597394>,#Fun<amqp_uri.7.32597394>],
                 [],[]}}},
     {{2013,10,31},{17,32,2}}}]
...done.

IP address of devtop is 192.168.168.212. Here's additional info from regarding connections from devtop;

+-------+-----------------------------------------------+---------+----------------+----------+-----------+-----------------+------------------+-----------------+---------------+------------------+-------------------+--------------------+-----------------+-----------+------+------------+----------+----------+----------+----------+-----------+-------+------------+----------+------------------+--------------+---------+---------+-------+
| vhost |                     name                      |  type   | auth_mechanism | channels | frame_max |      host       | last_blocked_age | last_blocked_by |     node      | peer_cert_issuer | peer_cert_subject | peer_cert_validity |    peer_host    | peer_port | port |  protocol  | recv_cnt | recv_oct | send_cnt | send_oct | send_pend |  ssl  | ssl_cipher | ssl_hash | ssl_key_exchange | ssl_protocol |  state  | timeout | user  |
+-------+-----------------------------------------------+---------+----------------+----------+-----------+-----------------+------------------+-----------------+---------------+------------------+-------------------+--------------------+-----------------+-----------+------+------------+----------+----------+----------+----------+-----------+-------+------------+----------+------------------+--------------+---------+---------+-------+
| /     | 127.0.0.1:53029 -> 127.0.0.1:5672             | network | PLAIN          | 2        | 32768     | 127.0.0.1       | infinity         | none            | rabbit at devtop |                  |                   |                    | 127.0.0.1       | 53029     | 5672 | AMQP 0-9-1 | 81       | 1888     | 69       | 2001     | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 127.0.0.1:53030 -> 127.0.0.1:5672             | network | PLAIN          | 2        | 32768     | 127.0.0.1       | infinity         | none            | rabbit at devtop |                  |                   |                    | 127.0.0.1       | 53030     | 5672 | AMQP 0-9-1 | 67       | 926      | 66       | 964      | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.142:38100 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.142 | 38100     | 5672 | AMQP 0-9-1 | 63       | 975      | 63       | 934      | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.142:41887 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.142 | 41887     | 5672 | AMQP 0-9-1 | 64       | 951      | 64       | 1159     | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.142:51473 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.142 | 51473     | 5672 | AMQP 0-9-1 | 64       | 967      | 63       | 924      | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.142:58133 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.142 | 58133     | 5672 | AMQP 0-9-1 | 60       | 870      | 60       | 867      | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.146:36800 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.146 | 36800     | 5672 | AMQP 0-9-1 | 64       | 967      | 63       | 924      | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.146:37081 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.146 | 37081     | 5672 | AMQP 0-9-1 | 63       | 975      | 63       | 934      | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.146:40113 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.146 | 40113     | 5672 | AMQP 0-9-1 | 63       | 951      | 64       | 1159     | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.146:49883 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.146 | 49883     | 5672 | AMQP 0-9-1 | 61       | 1067     | 61       | 888      | 0         | False |            |          |                  |              | running | 600     | guest |
+-------+-----------------------------------------------+---------+----------------+----------+-----------+-----------------+------------------+-----------------+---------------+------------------+-------------------+--------------------+-----------------+-----------+------+------------+----------+----------+----------+----------+-----------+-------+------------+----------+------------------+--------------+---------+---------+-------+

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Andy Gram
Sent: Thursday, October 31, 2013 11:51 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] messages stuck using shovel

I probably should have mentioned that I am using RabbitMQ R3.1.4 with Erlang R14B04 running on linux.

From: rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Andy Gram
Sent: Thursday, October 31, 2013 11:10 AM
To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: [rabbitmq-discuss] messages stuck using shovel

I have a configuration of 3 RabbitMQ nodes; devtop, devmid, devbot. I am implementing a star configuration with devtop as the center of the start. This is a pubsub application over a WAN. Any node can submit a new item to devtop and my publisher application will publish to all nodes, including itself. I am using shovel to instantiate a queue for each node that is bound to a fanout exchange on devtop. The published messages are stuck on devtop as below;

+-------+--------------------------------+-------------+-----------+---------+------------------------+---------------------+--------+----------+----------------+-------------------------+---------------+--------+---------+
| vhost |              name              | auto_delete | consumers | durable | exclusive_consumer_tag |     idle_since      | memory | messages | messages_ready | messages_unacknowledged |     node      | policy | status  |
+-------+--------------------------------+-------------+-----------+---------+------------------------+---------------------+--------+----------+----------------+-------------------------+---------------+--------+---------+
| /     | amq.gen-QXyScDVGCoTv8bhcbrMOrA | False       | 1         | False   |                        | 2013-10-31 10:32:25 | 9456   | 1        | 0              | 1                       | rabbit at devtop |        | running |
| /     | amq.gen-Ya03CVYcY-CEVKOYcSt0Xw | False       | 1         | False   |                        | 2013-10-31 10:32:25 | 9456   | 1        | 0              | 1                       | rabbit at devtop |        | running |
| /     | new_ident_queue                | False       | 1         | True    |                        | 2013-10-31 10:32:28 | 14312  | 0        | 0              | 0                       | rabbit at devtop |        | running |
| /     | pub_idents                     | False       | 0         | True    |                        | 2013-10-31 10:15:52 | 13760  | 0        | 0              | 0                       | rabbit at devtop |        | running |
| /     | refresh_idents                 | False       | 2         | True    |                        | 2013-10-31 10:32:18 | 14192  | 0        | 0              | 0                       | rabbit at devtop |        | running |
| /     | refresh_queue                  | False       | 1         | True    |                        | 2013-10-31 10:32:18 | 13976  | 0        | 0              | 0                       | rabbit at devtop |        | running |
+-------+--------------------------------+-------------+-----------+---------+------------------------+---------------------+--------+----------+----------------+-------------------------+---------------+--------+---------+

The status on devmid is as follows;

+-------+-----------------+-------------+-----------+---------+------------------------+---------------------+--------+----------+----------------+-------------------------+---------------+--------+---------+
| vhost |      name       | auto_delete | consumers | durable | exclusive_consumer_tag |     idle_since      | memory | messages | messages_ready | messages_unacknowledged |     node      | policy | status  |
+-------+-----------------+-------------+-----------+---------+------------------------+---------------------+--------+----------+----------------+-------------------------+---------------+--------+---------+
| /     | ident_updates   | False       | 0         | True    |                        | 2013-10-31 17:32:03 | 21696  | 0        | 0              | 0                       | rabbit at devmid |        | running |
| /     | new_ident_queue | False       | 1         | True    |                        | 2013-10-31 17:32:03 | 21912  | 0        | 0              | 0                       | rabbit at devmid |        | running |
| /     | refresh_idents  | False       | 0         | True    |                        | 2013-10-31 17:32:03 | 21696  | 0        | 0              | 0                       | rabbit at devmid |        | running |
| /     | refresh_queue   | False       | 1         | True    |                        | 2013-10-31 17:32:03 | 21912  | 0        | 0              | 0                       | rabbit at devmid |        | running |
+-------+-----------------+-------------+-----------+---------+------------------------+---------------------+--------+----------+----------------+-------------------------+---------------+--------+---------+

I am expecting shovel from devmid to move the messages from devtop queue to ident_updates queue on devmid. My shovel configuration follows:
{rabbitmq_shovel,
    [ {shovels, [ {ident_pub,
                    [ {sources, [ {broker, "amqp://"}
                        , {declarations, [
                                 {'queue.declare',
                                        [{queue, <<"new_ident_queue">> }
                                        , durable
                                        ]}
                                ]}
                        ]}
                    , {destinations, [ {broker, "amqp://192.168.168.212"}
                        , {declarations, [
                                 {'queue.declare',
                                        [{queue, <<"new_ident_queue">> }
                                        , durable
                                        ]}
                                ]}
                        ]}
                    , {queue, <<"new_ident_queue">>}
                    , {prefetch_count, 1}
                    , {ack_mode, on_confirm}
                    , {publish_properties, [ {delivery_mode, 2} ]}
                    , {reconnect_delay, 5}
                    ]},
                  {ident_sub,
                    [ {destinations, [ {broker, "amqp://"}
                        , {declarations, [
                                {'queue.declare',
                                        [{queue, <<"ident_updates">> }
                                        , durable
                                        ]}
                                ]}
                        ]}
                    , {sources, [ {broker, "amqp://192.168.168.212"}
                        , {declarations, [ {'exchange.declare',
                                [ {exchange, <<"pub_idents">>}
                                        , {type, <<"fanout">>}
                                        ]}
                                , {'queue.declare',
                                        [{queue, <<>> }
                                        , exclusive
                                        ]}
                                , {'queue.bind',
                                        [ {exchange, <<"pub_idents">>}
                                        , {queue,    <<>>}
                                        ]}
                                ]}
                        ]}
                    , {queue, <<>>}
                    , {prefetch_count, 1}
                    , {ack_mode, on_confirm}
                    , {publish_properties, [ {delivery_mode, 2} ]}
                    , {reconnect_delay, 5}
                    ]},
...

My shovel is stuck!! Any help would be appreciated.

Thanks,
Andy


This email message is for the sole use of the intended recipient(s) and may contain confidential and privileged information. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message. If you are the intended recipient, please be advised that the content of this message is subject to access, review and disclosure by the sender's Email System Administrator.


Andy Gram
BlackRidge Technology Inc.
www.blackridge.us<http://www.blackridge.us/>
408-892-4044

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131101/369939ce/attachment.htm>

From jhalterman at gmail.com  Fri Nov  1 04:13:51 2013
From: jhalterman at gmail.com (Jonathan Halterman)
Date: Thu, 31 Oct 2013 21:13:51 -0700
Subject: [rabbitmq-discuss] How do you handle recovering from a faulty
 connection using RabbitMQ java client library?
In-Reply-To: <CAE9K32cdZsROo7rAaw3iHRMQ0KTinXcfJJUVBN5KR2s5KQa99A@mail.gmail.com>
References: <CAE9K32cdZsROo7rAaw3iHRMQ0KTinXcfJJUVBN5KR2s5KQa99A@mail.gmail.com>
Message-ID: <CA+es_-xtQTeSKMo8njPR0BxY7uzyzHE=Pbo5Ccardg4_PAxNqw@mail.gmail.com>

Hi Peter,

Solution C is actually pretty reasonable. There's not much to gain from
using multiple connections to the same server if you're trying to guard
against network failures or cluster partitions. If one connection dies,
they all likely will. Wrapping and recovering connections/channels works
fine, and as Michael mentioned, you might also check out Lyra since it
handles the various corner cases involved in recovering resources for you.

Cheers,
Jonathan


On Thu, Oct 31, 2013 at 10:28 AM, Peter Moberg <moberg.peter at gmail.com>wrote:

> Hi,
>
> I'm interested in knowing how other people handle recovering from a faulty
> connection using the official RabbitMQ java client library. We are using it
> to connect our application servers to our RabbitMQ cluster and we have
> implemented a few different ways to recover from a connection failure, but
> non of them feel quite right.
>
> Imagine this pseudo application:
>
> public class OurClassThatStartsConsumers {
>     Connection conn;
>
>     public void start() {
>         ConnectionFactory factory = new ConnectionFactory();
>         factory.setUsername("someusername");
>         factory.setPassword("somepassword");
>         factory.setHost("somehost");
>         conn = factory.newConnection();
>
>         new Thread(new Consumer(conn.createChannel())).start();
>     }
>   }
> class Consumer1 implements Runnable {
>     public Consumer1(Channel channel) {
>          this.channel = channel;
>     }
>
>     @Override
>     public void run() {
>         while (true) {
>              ... consume incoming messages on the channel...
>             // How do we handle that the connection dies?
>         }
>     }}
>
> In the real world we have several hundreds of consumers. So what happens
> if the connection dies? In the above example Consumer1 can not recover,
> when the connection closes, the Channel also closes, a state from which we
> can not recover. So lets look at some ways to solve this:
>
> Solution A)
>
> Let every consumer have their own connection and register the events that
> triggers when the connection dies and then handle reconnecting.
>
> Pros: It works
>
> Cons:
>
>    - Since we have a lot of consumers, we probably do not want that many
>    connections.
>    - We might possible have a lot of duplicated code for reconnecting to
>    rabbit and handle reconnecting
>
> Solution B)
>
> Have each consumer use the same connection and subscribe to its connection
> failure events.
>
> Pros: Less connections than in Solution A
>
> Cons: Since the connection is closed we need to reopen/replace it. The
> java client library doesn't seem to provide a way to reopen the connection,
> so we would have to replace it with a new connection and then somehow
> notify all the consumers about this new connection and they would have to
> recreate the channels and the consumers. Once again, a lot of logic that i
> don't want to see in the consumer ends up there.
>
> Solution C)
>
> Wrap Connection and Channel classes is classes that handle the
> re-connection logic, the consumer only needs to know about the
> WrappedChannel class. On a connection failure the WrappedConnection with
> deal with re-establishing the connection and once connected the
> WrappedConnection will automatically create new Channels and register
> consumers.
>
> Pros: It work - this is actually the solution we are using today.
>
> Cons: It feels like a hack, I think this is something that should be
> handled more elegantly by the underlying library.
>
> Maybe there is a much better way? The API documentation does not talk that
> much about recovering from a faulty connection. Any input is appreciated :)
>
>
> Thanks,
>
> Peter
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131031/e7ead1b7/attachment.htm>

From abid.varshani at gmail.com  Fri Nov  1 05:36:31 2013
From: abid.varshani at gmail.com (Abid Varshani)
Date: Fri, 1 Nov 2013 11:06:31 +0530
Subject: [rabbitmq-discuss] Destroying connection after
	ShutdownSignalException
In-Reply-To: <CAOwhz-jcgi8VdzmyUrDEyb1d3etuosXPtzBv_LXAwNCOj7ExXg@mail.gmail.com>
References: <CAOwhz-jcgi8VdzmyUrDEyb1d3etuosXPtzBv_LXAwNCOj7ExXg@mail.gmail.com>
Message-ID: <CAOwhz-gLpHaw1ygz=dJyadQxpTm-hb6nLqGq6P7ehpWUBtZoNw@mail.gmail.com>

Can anyone please provide some guidance on this? This is really limiting my
ability to use RabbitMQ effectively with android.

Thanks
Abid


On Tue, Oct 29, 2013 at 9:07 PM, Abid Varshani <abid.varshani at gmail.com>wrote:

> Hi
>
> I am connecting to rabbitmq-server from an android client. And I want to
> be able to destroy the connection whenever network connection is lost. The
> problem is as soon as network connection is lost I get
> ShutdownSignalException. And if I try to close the connection in this state
> it crashes.
>
> Moreover if I run the following command on server, the connection still
> seems to be running.
>
> *rabbitmqctl list_connections*
> *
> *
> What is the best way to destroy the connection after *
> ShutdownSignalException*
> *
> *
> Thanks
> *
> *
> Regards
> Abid
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131101/d47566ab/attachment.htm>

From mklishin at gopivotal.com  Fri Nov  1 08:11:59 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 1 Nov 2013 12:11:59 +0400
Subject: [rabbitmq-discuss] Destroying connection after
	ShutdownSignalException
In-Reply-To: <CAOwhz-gLpHaw1ygz=dJyadQxpTm-hb6nLqGq6P7ehpWUBtZoNw@mail.gmail.com>
References: <CAOwhz-jcgi8VdzmyUrDEyb1d3etuosXPtzBv_LXAwNCOj7ExXg@mail.gmail.com>
	<CAOwhz-gLpHaw1ygz=dJyadQxpTm-hb6nLqGq6P7ehpWUBtZoNw@mail.gmail.com>
Message-ID: <0D004A66-A983-4E24-BA2D-F8C999A4E051@rabbitmq.com>

On 1 Nov 2013, at 09:36, Abid Varshani <abid.varshani at gmail.com> wrote:

> Can anyone please provide some guidance on this?

There was a reply:
http://rabbitmq.1065348.n5.nabble.com/Destroying-connection-after-ShutdownSignalException-tp30959p30961.html

MK

Software Engineer, Pivotal/RabbitMQ



From abid.varshani at gmail.com  Fri Nov  1 08:46:44 2013
From: abid.varshani at gmail.com (Abid Varshani)
Date: Fri, 1 Nov 2013 14:16:44 +0530
Subject: [rabbitmq-discuss] Destroying connection after
	ShutdownSignalException
In-Reply-To: <0D004A66-A983-4E24-BA2D-F8C999A4E051@rabbitmq.com>
References: <CAOwhz-jcgi8VdzmyUrDEyb1d3etuosXPtzBv_LXAwNCOj7ExXg@mail.gmail.com>
	<CAOwhz-gLpHaw1ygz=dJyadQxpTm-hb6nLqGq6P7ehpWUBtZoNw@mail.gmail.com>
	<0D004A66-A983-4E24-BA2D-F8C999A4E051@rabbitmq.com>
Message-ID: <CAOwhz-jSi-s7hUO9tAwjZgthFm1MGNiMJc2aiRjSku41uZqF4w@mail.gmail.com>

Thanks Michael.

I somehow didn't get the email for that reply.

I will take a look at Lyra.

You mentioned I don't need to release the connection explicitly but It
seems I am losing messages due to server not noticing the connection loss.
This is what I am doing.

1. My android client connects to the server and subscribe to a named queue
for messages.
2. Other client sends messages on the named queue and android client
receives it while connected.
3. I break the network connectivity for android client which raises a
ShutdownSignalException.
4. Other client continues to send the messages. I assume server will hold
all these messages and send it to android client whenever the android
client is up again
5. Android client waits for the network to be available and connects to the
server again
6. Android client doesn't receive any of the messages sent while it was not
connected.
7. Other client continues to send messages.
8. Android client receives every other message. That gives me a feeling
that RabbitMQ is still assuming the earlier client is still connected and
sending the messages to it.

Hope this will give you more clear idea about the issue I am facing.

Thanks a lot for your help

Regards
Abid








On Fri, Nov 1, 2013 at 1:41 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 1 Nov 2013, at 09:36, Abid Varshani <abid.varshani at gmail.com> wrote:
>
> > Can anyone please provide some guidance on this?
>
> There was a reply:
>
> http://rabbitmq.1065348.n5.nabble.com/Destroying-connection-after-ShutdownSignalException-tp30959p30961.html
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131101/38a68169/attachment.htm>

From mklishin at gopivotal.com  Fri Nov  1 08:56:31 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 1 Nov 2013 12:56:31 +0400
Subject: [rabbitmq-discuss] Destroying connection after
	ShutdownSignalException
In-Reply-To: <CAOwhz-jSi-s7hUO9tAwjZgthFm1MGNiMJc2aiRjSku41uZqF4w@mail.gmail.com>
References: <CAOwhz-jcgi8VdzmyUrDEyb1d3etuosXPtzBv_LXAwNCOj7ExXg@mail.gmail.com>
	<CAOwhz-gLpHaw1ygz=dJyadQxpTm-hb6nLqGq6P7ehpWUBtZoNw@mail.gmail.com>
	<0D004A66-A983-4E24-BA2D-F8C999A4E051@rabbitmq.com>
	<CAOwhz-jSi-s7hUO9tAwjZgthFm1MGNiMJc2aiRjSku41uZqF4w@mail.gmail.com>
Message-ID: <01E023B4-FB13-449D-AFB8-D03D3D4ABBEE@gopivotal.com>

On 1 Nov 2013, at 12:46, Abid Varshani <abid.varshani at gmail.com> wrote:

> 8. Android client receives every other message. That gives me a feeling that RabbitMQ is still assuming the earlier client is still connected and sending the messages to it.

If you reconnect, RabbitMQ treats every new connection as a separate one. It cannot know if it?s coming
from a client that was connected earlier or not. In fact, as soon as it detects a closed connection,
all unacknowledged messages will be requeued.

Please investigate what changes between reconnections. It can be queue names (for server-named queues),
queues getting deleted (for exclusive or auto-delete queues), bindings not being recovered, etc.

Both the client and RabbitMQ do not notice TCP connection loss immediately because of how TCP works:
it tries retransmitting segments first, then gives up after a certain period of time. AMQP 0-9-1 has heartbeats
exactly for this reason: to make it easier for detect unresponsive peers.

So try setting a heartbeat interval to a low value (say, 4-6 seconds) and see if it helps.

As far as connection loss for publishers goes, unless the peer gets unresponsive in the middle of a write
(to the socket), you should get a visible IOException the next time you publish a message.
--
MK

Software Engineer, Pivotal/RabbitMQ


From abid.varshani at gmail.com  Fri Nov  1 09:25:46 2013
From: abid.varshani at gmail.com (Abid Varshani)
Date: Fri, 1 Nov 2013 14:55:46 +0530
Subject: [rabbitmq-discuss] Destroying connection after
	ShutdownSignalException
In-Reply-To: <01E023B4-FB13-449D-AFB8-D03D3D4ABBEE@gopivotal.com>
References: <CAOwhz-jcgi8VdzmyUrDEyb1d3etuosXPtzBv_LXAwNCOj7ExXg@mail.gmail.com>
	<CAOwhz-gLpHaw1ygz=dJyadQxpTm-hb6nLqGq6P7ehpWUBtZoNw@mail.gmail.com>
	<0D004A66-A983-4E24-BA2D-F8C999A4E051@rabbitmq.com>
	<CAOwhz-jSi-s7hUO9tAwjZgthFm1MGNiMJc2aiRjSku41uZqF4w@mail.gmail.com>
	<01E023B4-FB13-449D-AFB8-D03D3D4ABBEE@gopivotal.com>
Message-ID: <CAOwhz-je9Z-=n0oPN-+wDTJeHx+UcT7H_bk_xVvU_QtDBQ03Hw@mail.gmail.com>

Thanks Michael.

I will relook at my code to see where is it going wrong.

Thanks
Abid


On Fri, Nov 1, 2013 at 2:26 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 1 Nov 2013, at 12:46, Abid Varshani <abid.varshani at gmail.com> wrote:
>
> > 8. Android client receives every other message. That gives me a feeling
> that RabbitMQ is still assuming the earlier client is still connected and
> sending the messages to it.
>
> If you reconnect, RabbitMQ treats every new connection as a separate one.
> It cannot know if it?s coming
> from a client that was connected earlier or not. In fact, as soon as it
> detects a closed connection,
> all unacknowledged messages will be requeued.
>
> Please investigate what changes between reconnections. It can be queue
> names (for server-named queues),
> queues getting deleted (for exclusive or auto-delete queues), bindings not
> being recovered, etc.
>
> Both the client and RabbitMQ do not notice TCP connection loss immediately
> because of how TCP works:
> it tries retransmitting segments first, then gives up after a certain
> period of time. AMQP 0-9-1 has heartbeats
> exactly for this reason: to make it easier for detect unresponsive peers.
>
> So try setting a heartbeat interval to a low value (say, 4-6 seconds) and
> see if it helps.
>
> As far as connection loss for publishers goes, unless the peer gets
> unresponsive in the middle of a write
> (to the socket), you should get a visible IOException the next time you
> publish a message.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131101/bfd3a6ec/attachment.htm>

From tvaghela at slscorp.com  Fri Nov  1 10:00:36 2013
From: tvaghela at slscorp.com (tvaghela at slscorp.com)
Date: 1 Nov 2013 06:00:36 -0400
Subject: [rabbitmq-discuss] =?utf-8?q?Festival_Shutdown_=3A_rabbitmq-discu?=
	=?utf-8?q?ss_Digest=2C_Vol_78=2C_Issue_1?=
Message-ID: <20131101100036.30467.qmail@ns4000790.ip-198-245-63.net>

Hi,

Due to Diwali Festival, SLS will be closed from Oct. 31th to Nov. 6th.
We will return on Nov. 7th to the office. For urgent matter please call on 001-408-852-0067.

For more information about Diwali:
http://en.wikipedia.org/wiki/Diwali

Regards,
Tejas Vaghela



From mike at suteki.co.uk  Fri Nov  1 10:02:23 2013
From: mike at suteki.co.uk (Mike Hadlow)
Date: Fri, 1 Nov 2013 10:02:23 +0000
Subject: [rabbitmq-discuss] How do you handle recovering from a faulty
 connection using RabbitMQ java client library?
In-Reply-To: <CA+es_-xtQTeSKMo8njPR0BxY7uzyzHE=Pbo5Ccardg4_PAxNqw@mail.gmail.com>
References: <CAE9K32cdZsROo7rAaw3iHRMQ0KTinXcfJJUVBN5KR2s5KQa99A@mail.gmail.com>
	<CA+es_-xtQTeSKMo8njPR0BxY7uzyzHE=Pbo5Ccardg4_PAxNqw@mail.gmail.com>
Message-ID: <CAAc6ZR9Ua==Pe7Lh6XMawGpVYmZ629P6HWrXsgEeNc+aOLk3xA@mail.gmail.com>

Hi Peter,

My .NET client library, EasyNetQ (http://easynetq.com) does automatic
reconnection. We use option C with a class called PersistentConnection. An
internal in-memory event bus then distributes connection events to the rest
of the library so consumers get notified when they need to re-consume.
Works well.

Good luck,
Mike


On Fri, Nov 1, 2013 at 4:13 AM, Jonathan Halterman <jhalterman at gmail.com>wrote:

> Hi Peter,
>
> Solution C is actually pretty reasonable. There's not much to gain from
> using multiple connections to the same server if you're trying to guard
> against network failures or cluster partitions. If one connection dies,
> they all likely will. Wrapping and recovering connections/channels works
> fine, and as Michael mentioned, you might also check out Lyra since it
> handles the various corner cases involved in recovering resources for you.
>
> Cheers,
> Jonathan
>
>
> On Thu, Oct 31, 2013 at 10:28 AM, Peter Moberg <moberg.peter at gmail.com>wrote:
>
>> Hi,
>>
>> I'm interested in knowing how other people handle recovering from a
>> faulty connection using the official RabbitMQ java client library. We are
>> using it to connect our application servers to our RabbitMQ cluster and we
>> have implemented a few different ways to recover from a connection failure,
>> but non of them feel quite right.
>>
>> Imagine this pseudo application:
>>
>> public class OurClassThatStartsConsumers {
>>     Connection conn;
>>
>>     public void start() {
>>         ConnectionFactory factory = new ConnectionFactory();
>>         factory.setUsername("someusername");
>>         factory.setPassword("somepassword");
>>         factory.setHost("somehost");
>>         conn = factory.newConnection();
>>
>>         new Thread(new Consumer(conn.createChannel())).start();
>>     }
>>   }
>> class Consumer1 implements Runnable {
>>     public Consumer1(Channel channel) {
>>          this.channel = channel;
>>     }
>>
>>     @Override
>>     public void run() {
>>         while (true) {
>>              ... consume incoming messages on the channel...
>>             // How do we handle that the connection dies?
>>         }
>>     }}
>>
>> In the real world we have several hundreds of consumers. So what happens
>> if the connection dies? In the above example Consumer1 can not recover,
>> when the connection closes, the Channel also closes, a state from which we
>> can not recover. So lets look at some ways to solve this:
>>
>> Solution A)
>>
>> Let every consumer have their own connection and register the events that
>> triggers when the connection dies and then handle reconnecting.
>>
>> Pros: It works
>>
>> Cons:
>>
>>    - Since we have a lot of consumers, we probably do not want that many
>>    connections.
>>    - We might possible have a lot of duplicated code for reconnecting to
>>    rabbit and handle reconnecting
>>
>> Solution B)
>>
>> Have each consumer use the same connection and subscribe to its
>> connection failure events.
>>
>> Pros: Less connections than in Solution A
>>
>> Cons: Since the connection is closed we need to reopen/replace it. The
>> java client library doesn't seem to provide a way to reopen the connection,
>> so we would have to replace it with a new connection and then somehow
>> notify all the consumers about this new connection and they would have to
>> recreate the channels and the consumers. Once again, a lot of logic that i
>> don't want to see in the consumer ends up there.
>>
>> Solution C)
>>
>> Wrap Connection and Channel classes is classes that handle the
>> re-connection logic, the consumer only needs to know about the
>> WrappedChannel class. On a connection failure the WrappedConnection with
>> deal with re-establishing the connection and once connected the
>> WrappedConnection will automatically create new Channels and register
>> consumers.
>>
>> Pros: It work - this is actually the solution we are using today.
>>
>> Cons: It feels like a hack, I think this is something that should be
>> handled more elegantly by the underlying library.
>>
>> Maybe there is a much better way? The API documentation does not talk
>> that much about recovering from a faulty connection. Any input is
>> appreciated :)
>>
>>
>> Thanks,
>>
>> Peter
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131101/4b7da8f1/attachment.htm>

From watson.timothy at gmail.com  Fri Nov  1 10:07:54 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 1 Nov 2013 10:07:54 +0000
Subject: [rabbitmq-discuss] Festival Shutdown : rabbitmq-discuss Digest,
	Vol 77, Issue 32
In-Reply-To: <20131031100142.1525.qmail@ns4000790.ip-198-245-63.net>
References: <20131031100142.1525.qmail@ns4000790.ip-198-245-63.net>
Message-ID: <593F6342-05E5-43CD-B820-5DEB189E9A80@gmail.com>

It's not usual to send out of office notifications to a public, subscribed mailing list. Just so you know.

As a native English speaker, I'd also like to point a few small grammatical issues with your mail, which I hope you will find informative and helpful! :)

On 31 Oct 2013, at 10:01, tvaghela at slscorp.com wrote:
> Due to Diwali Festival, SLS will be closed from Oct. 31th to Nov. 6th.

Since Diwali is a specific festival, you should add the "definite article" in front of it: A definite article indicates that its noun (in this case, the Festival Diwali) is a particular one identifiable to the listener. With that in place, your opening sentence should read:

"Due to the Diwali Festival, SLS will be closed from ...."

Since SLS is not closing because of Diwali, but rather is closed for Diwali (since it is considered appropriate to give employees a day off to celebrate this important festival, a human being's action caused the closure), a more idiomatically correct reading would be:

"SLS will be closed between Oct. 31st and Nov. 6th, for the Diwali Festival."

Note that the thirty-first day of the month (or indeed, any something-first day of the month) should be abbreviated with "st" rather than "th", as per the correct pronunciation. I've used "between" here rather than "from .. to", though either is fine as would "from Oct. 31st until Nov. 6th". 

> We will return on Nov. 7th to the office. For urgent matter please call on 001-408-852-0067.
> 

In the latter sentence, it would be more natural to use the plural, rendering "For urgent matters, please call ...." 

> For more information about Diwali:
> http://en.wikipedia.org/wiki/Diwali
> 

That's good introduction to a fascinating festival. Thanks for sharing that information and I hope all concerned have a wonderful time!

I hope my feedback has been useful!

Kind regards,

Tim Watson

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131101/c54facd1/attachment.htm>

From matthias at rabbitmq.com  Fri Nov  1 13:56:16 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Nov 2013 13:56:16 +0000
Subject: [rabbitmq-discuss] 2.8.5: high cpu usage on return from standby
In-Reply-To: <1383155680214-31012.post@n5.nabble.com>
References: <03df01cd746c$a6476840$f2d638c0$@saseco.dk>	<5020F39E.20007@rabbitmq.com>	<041701cd7498$3c9a0430$b5ce0c90$@saseco.dk>	<50211747.20002@rabbitmq.com>	<C44C93396408924FBBF479F57FD429FCE7AC99@AM2PRD0210MB361.eurprd02.prod.outlook.com>	<50A3C01C.70606@rabbitmq.com>	<1380304107803-29997.post@n5.nabble.com>	<52468727.3040504@rabbitmq.com>
	<1383155680214-31012.post@n5.nabble.com>
Message-ID: <5273B300.10303@rabbitmq.com>

On 30/10/13 17:54, jchannon wrote:
> I have Erlang OTP R16B02 (x64) and this issue still exists

Is your setup the same as the OP's, i.e. rabbit 2.8.5 on windows?

Matthias.

From matthias at rabbitmq.com  Fri Nov  1 14:05:46 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Nov 2013 14:05:46 +0000
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] Introducing Lyra: A High
 Availability RabbitMQ Client
In-Reply-To: <CA+es_-yEZs1b=Hv=cUUAXijxfS6D_A2FLv3zLziGfNTtAMnyhA@mail.gmail.com>
References: <CA+es_-zA5nDKD0xKZCD_0iYXCRscay1WC6h2B3qJLAi2u9Ur5w@mail.gmail.com>	<E76A3ABB-BA09-4610-82F5-A16C45AFC1E0@rabbitmq.com>	<CA+es_-wH0QEdBceYV8-SOe7XK4njD1buNHNjeDroUehvXzdMoA@mail.gmail.com>	<52718C27.8020905@rabbitmq.com>	<CA+es_-w0=pGcLP9+pwEbGAP+JRCa7uc2EPkRamErSWA8BEKh=g@mail.gmail.com>	<52720660.40906@rabbitmq.com>
	<CA+es_-yEZs1b=Hv=cUUAXijxfS6D_A2FLv3zLziGfNTtAMnyhA@mail.gmail.com>
Message-ID: <5273B53A.4050404@rabbitmq.com>

Jonathan,

On 31/10/13 18:54, Jonathan Halterman wrote:
> I don't suppose you're open to enhancing the amqp-client API to include
> something like this? :) One possible change would be the inclusion of a
> VersionedDeliveryTag like object in the Envelope along with some
> corresponding basic ack/nack/reject(VersionedDeliveryTag) methods on the
> Channel interface. The channel's "version" would just be another piece
> of meta information that the user could specify.

Such an API extension doesn't really make sense in the existing client. 
Plus, in order to take advantage of it client code would have to change, 
so you might as well bite the bullet and design a recovery-enabled API 
that wraps the existing API.

> One other idea - Brett Cameron suggested tracking the last delivery tag
> for each channel and dropping any ack/nack/reject requests for delivery
> tags greater than that. If a channel is recovered, the last delivery tag
> for the new channel will most likely be less than any delivery tags for
> messages consumed on the previously closed channel. This is obviously
> not foolproof, but it's not a bad start.

That's better than the present situation, I suppose, but doesn't catch 
the more dangerous of the two ways things can go wrong, i.e. when the 
old delivery tags *are* in range of the new ones then the wrong messages 
get acknowledged.

Matthias.

From jonathan.channon at gmail.com  Fri Nov  1 15:24:44 2013
From: jonathan.channon at gmail.com (jchannon)
Date: Fri, 1 Nov 2013 08:24:44 -0700 (PDT)
Subject: [rabbitmq-discuss] 2.8.5: high cpu usage on return from standby
In-Reply-To: <5273B300.10303@rabbitmq.com>
References: <03df01cd746c$a6476840$f2d638c0$@saseco.dk>
	<5020F39E.20007@rabbitmq.com>
	<041701cd7498$3c9a0430$b5ce0c90$@saseco.dk>
	<50211747.20002@rabbitmq.com>
	<C44C93396408924FBBF479F57FD429FCE7AC99@AM2PRD0210MB361.eurprd02.prod.outlook.com>
	<50A3C01C.70606@rabbitmq.com>
	<1380304107803-29997.post@n5.nabble.com>
	<52468727.3040504@rabbitmq.com>
	<1383155680214-31012.post@n5.nabble.com>
	<5273B300.10303@rabbitmq.com>
Message-ID: <CAHcLveKQKMJ0kbDYCvBuL5Bexw6=Ok47aU4GZEX8pejyrJdX_A@mail.gmail.com>

No, I have the latest RabbitMQ




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/2-8-5-high-cpu-usage-on-return-from-standby-tp21264p31087.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131101/1f952f7e/attachment.htm>

From dmcintyre at gopivotal.com  Fri Nov  1 15:41:35 2013
From: dmcintyre at gopivotal.com (dmcintyre at gopivotal.com)
Date: Fri, 1 Nov 2013 08:41:35 -0700 (PDT)
Subject: [rabbitmq-discuss] PHP PECL AMQP Extension - Multi-consumer support
Message-ID: <94be994a-8599-46bc-ac29-d0db3e12db5d@googlegroups.com>

If you are using the PHP PECL extension, I have a fork of the code which 
you may find useful here:

https://github.com/mcintyred/php-amqp

This fork allows a PHP client to consume from multiple queues, using 
select() for efficiency.

The downside is that it has to use one connection per queue being consumed, 
since the underlying c library only uses one channel per connection.

-----

Duncan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131101/33beba2e/attachment.htm>

From matthias at rabbitmq.com  Fri Nov  1 15:48:25 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Fri, 01 Nov 2013 15:48:25 +0000
Subject: [rabbitmq-discuss] 2.8.5: high cpu usage on return from standby
In-Reply-To: <CAHcLveKQKMJ0kbDYCvBuL5Bexw6=Ok47aU4GZEX8pejyrJdX_A@mail.gmail.com>
References: <03df01cd746c$a6476840$f2d638c0$@saseco.dk>	<5020F39E.20007@rabbitmq.com>	<041701cd7498$3c9a0430$b5ce0c90$@saseco.dk>	<50211747.20002@rabbitmq.com>	<C44C93396408924FBBF479F57FD429FCE7AC99@AM2PRD0210MB361.eurprd02.prod.outlook.com>	<50A3C01C.70606@rabbitmq.com>	<1380304107803-29997.post@n5.nabble.com>	<52468727.3040504@rabbitmq.com>	<1383155680214-31012.post@n5.nabble.com>	<5273B300.10303@rabbitmq.com>
	<CAHcLveKQKMJ0kbDYCvBuL5Bexw6=Ok47aU4GZEX8pejyrJdX_A@mail.gmail.com>
Message-ID: <5273CD49.3010903@rabbitmq.com>

On 01/11/13 15:24, jchannon wrote:
> No, I have the latest RabbitMQ

So Erlang R16B02, RabbitMQ 3.2.0, running on Windows? What flavour of 
Windows? And how reproducible is this? Does it happen when rabbit is 
otherwise idle (when the machine isn't sleeping, obviously)? How long 
does the machine have to have been in standby for the problem to become 
noticeable? Can you stop the rabbit, restart it, put the machine to 
sleep and and then on wake-up see the problem? If so we might be able to 
reproduce this if you send us the contents of your mnesia dir.

Regards,

Matthias.

From mike at suteki.co.uk  Fri Nov  1 16:01:49 2013
From: mike at suteki.co.uk (Mike Hadlow)
Date: Fri, 1 Nov 2013 16:01:49 +0000
Subject: [rabbitmq-discuss] EasyNetQ: Breaking changes to request-response
Message-ID: <CAAc6ZR-1LRSs7nwyitbqzcK5+DdeYPqWrLc18U1dJWR-JpUCzA@mail.gmail.com>

Hi All,

I've just released version 0.17 of EasyNetQ (http://easynetq.com). There
are some breaking changes with the request-response API.

Details here:
http://mikehadlow.blogspot.co.uk/2013/11/easynetq-big-breaking-changes-to.html

Thanks
Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131101/5df7512a/attachment.htm>

From mklishin at gopivotal.com  Fri Nov  1 16:37:59 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 1 Nov 2013 20:37:59 +0400
Subject: [rabbitmq-discuss] rabbitmq nodedown - nodedown - Generic
	server rabbit_disk_monitor terminating
In-Reply-To: <CAFa8q3Z5GCEccmNzO4UwmXLwbXvdD7q8NxfKkhu8fkkrpe-T-g@mail.gmail.com>
References: <4e2b75de-0e07-4a4c-9ef2-e952fe2bea1a@googlegroups.com>
	<EC7BCDA6-DD12-4F7C-8491-8A5482432E69@rabbitmq.com>
	<CAFa8q3a89EB9bSzLqX1tGNATGYurJdcV4ZY82=fXP=iWTEhRtg@mail.gmail.com>
	<9ABF3D5F-69A4-4ED5-A7A8-B9EEB56DD699@gopivotal.com>
	<CAFa8q3Z5GCEccmNzO4UwmXLwbXvdD7q8NxfKkhu8fkkrpe-T-g@mail.gmail.com>
Message-ID: <6393342C-DAEB-4454-B1BA-CC67024D12CE@gopivotal.com>


On 31 Oct 2013, at 17:49, Michael Sander <mes65 at cornell.edu> wrote:

> $ sudo /bin/df -kP /var/lib/rabbitmq/mnesia/
> Filesystem     1024-blocks    Used Available Capacity Mounted on
> /dev/root         10451916 6331368   3596312      64% /
> 
> I'm having a problem sudoing into rabbitmq, this is ulimit for myself though:
> $ ulimit -n
> 1024
> 
> Does this explain anything?

This output looks pretty standard. We will investigate if there may be a subtle difference that causes
the parser to break.

I doubt ulimit -n value can affect df output.
--
MK

Software Engineer, Pivotal/RabbitMQ


From Ron.Cordell at RelayHealth.com  Fri Nov  1 17:45:27 2013
From: Ron.Cordell at RelayHealth.com (Cordell, Ron)
Date: Fri, 1 Nov 2013 17:45:27 +0000
Subject: [rabbitmq-discuss] Rabbit Cluster "hangs" on consumer disconnects
Message-ID: <0B8CD6850421B745BE39BC5C76019232A683F5F6@DDCEP50016.na.corp.mckesson.com>

I?m seeing a strange issue with the Rabbit cluster when we shut down the applications that connect to the cluster.

Here is the setup:

Rabbit 3.1.5 Erlang 16B02 running as a 2-node cluster behind an F5 load balancer
The F5 is currently set to send connections to ONLY the 01 node, but provides a virtual IP to the application.
The application consists of a 5 Windows services running on 4 servers each ? all 5 services connect to the Rabbit cluster and those services are duplicated across 4 servers.

What seems to happen (but not always) is the following sequence of events:


  1.  Issue commands to shut down Windows Services, Windows Services begin shutting down
  2.  At some point during the shutdown process we see the following in the Rabbit logs (truncated for brevity) - there is nothing in the logs before this event, by the way

=WARNING REPORT==== 31-Oct-2013::13:35:57 ===
closing AMQP connection <0.3379.0> (10.100.193.10:50234 -> 10.100.193.80:5672):
connection_closed_abruptly

=WARNING REPORT==== 31-Oct-2013::13:35:57 ===
closing AMQP connection <0.3383.0> (10.100.193.10:50235 -> 10.100.193.80:5672):
connection_closed_abruptly

=WARNING REPORT==== 31-Oct-2013::13:35:57 ===
closing AMQP connection <0.3926.0> (10.100.193.10:50264 -> 10.100.193.80:5672):
connection_closed_abruptly

  1.  The Windows Services that are trying to shut down hang, unable to shut down cleanly
  2.  The F5 load balancer is using a monitor to check to see if the Rabbit nodes are up via the HTTP API, and it shows that both are not responding, so the F5 stops routing traffic to either Rabbit node in the cluster
  3.  Logging onto the rabbit node,
     *   we are able to use the Erlang ping/pong to verify connectivity between nodes
     *   The management plugin UI is unresponsive
     *   We issue a rabbitmqctl stop_app command to node 01, which responds, and we see the following in the rabbit log file:

=INFO REPORT==== 31-Oct-2013::13:56:58 ===
Stopping RabbitMQ

=ERROR REPORT==== 31-Oct-2013::13:57:00 ===
** Generic server <0.6855.0> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'exchange.unbind',0,
                                   <<"ha-execute_suppressmessagedeliveryactivity">>,
                                   <<"MassTransit.Diagnostics.Tracing:GetMessageTraceList">>,
                                   <<>>,false,[]},
                               none,noflow}}
** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,1,<0.4073.0>,
                            <0.6853.0>,<0.4073.0>,
                            <<"10.100.193.10:50286 -> 10.100.193.80:5672">>,
                            {lstate,<0.6854.0>,false,false},
                            none,1,
                            {[],[]},
                            {user,<<"SJINRMQVORTEXWRITE">>,[],
                                rabbit_auth_backend_ldap,
                                {impl,
                                    "CN=SJINRMQ VORTEXWRITE,OU=INRMQ,OU=INTEGRATION,OU=Environments,OU=Servers,DC=RHB,DC=AD",
                                    <<"sQ*4~j5Ca9F_7G">>}},
                            <<"vortex">>,<<>>,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            <0.4070.0>,
                            {state,fine,5000,undefined},
                            false,1,
                            {{0,nil},{0,nil}},
                            [],
                            [{<<"publisher_confirms">>,bool,true},
                             {<<"exchange_exchange_bindings">>,bool,true},
                             {<<"consumer_cancel_notify">>,bool,true},
                             {<<"basic.nack">>,bool,true}],
                            none}
** Reason for termination ==
** {{shutdown,
        {gen_server,call,
            [rabbit_auth_backend_ldap,
             {check_resource,
                 [{username,<<"SJINRMQVORTEXWRITE">>},
                  {user_dn,
                      "CN=SJINRMQ VORTEXWRITE,OU=INRMQ,OU=INTEGRATION,OU=Environments,OU=Servers,DC=RHB,DC=AD"},
                  {vhost,<<"vortex">>},
                  {resource,exchange},
                  {name,<<"ha-execute_suppressmessagedeliveryactivity">>},
                  {permission,write}],
                 {user,<<"SJINRMQVORTEXWRITE">>,[],rabbit_auth_backend_ldap,
                     {impl,
                         "CN=SJINRMQ VORTEXWRITE,OU=INRMQ,OU=INTEGRATION,OU=Environments,OU=Servers,DC=RHB,DC=AD",
                         <<"sQ*4~j5Ca9F_7G">>}}},
             infinity]}},
    [{gen_server,call,3,[{file,"gen_server.erl"},{line,188}]},
     {rabbit_access_control,check_access,5,[]},
     {rabbit_channel,check_resource_access,3,[]},
     {rabbit_channel,binding_action,9,[]},
     {rabbit_channel,handle_cast,2,[]},
     {gen_server2,handle_msg,2,[]},
     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}

=ERROR REPORT==== 31-Oct-2013::13:57:00 ===
** Generic server <0.16344.0> terminating
** Last message in was {'$gen_cast',
                           {method,
                               {'basic.publish',0,
                                   <<"RelayHealth.MessageExchange.Core.Configuration.Events:MessageSubscribersLoaded">>,
                                   <<>>,false,false},
                               {content,60,none,
                                   <<48,128,0,0,0,50,12,67,111,110,116,101,110,
                                     116,45,84,121,112,101,83,0,0,0,32,97,112,
                                     112,108,105,99,97,116,105,111,110,47,118,
                                     110,100,46,109,97,115,115,116,114,97,110,
                                     115,105,116,43,106,115,111,110,2,36,49,97,
                                     102,100,48,48,48,48,45,53,50,97,102,45,
                                     100,52,97,101,45,50,56,50,57,45,48,56,100,
                                     48,97,48,52,56,50,53,102,102>>,
                                   rabbit_framing_amqp_0_9_1,
                                   [<<"{\r\n  \"destinationAddress\": \"rabbitmq://rabbit.integration.rhb.ad/vortex/RelayHealth.MessageExchange.Core.Configuration.Events:MessageSubscribersLoaded\",\r\n  \"headers\": {},\r\n  \"message\": {\r\n    \"eventId\": \"1afd0000-52af-d4ae-dcd2-08d0a04825fe\",\r\n    \"timeCompleted\": \"2013-10-31T08:56:47.178316Z\",\r\n    \"duration\": \"00:00:00.0624004\",\r\n    \"initiatingEventId\": \"1afd0000-52af-d4ae-6927-08d0a04825fc\",\r\n    \"machineName\": \"SJINWEB03\",\r\n    \"processName\": \"RelayHealth.Services.SubscriberActivityService\",\r\n    \"messageSubscriberCount\": 264\r\n  },\r\n  \"messageType\": [\r\n    \"urn:message:RelayHealth.MessageExchange.Core.Configuration.MessageSubscribers:MessageSubscriberCache+MessageSubscribersLoadedImpl\",\r\n    \"urn:message:RelayHealth.MessageExchange.Core.Configuration.Events:MessageSubscribersLoaded\"\r\n  ],\r\n  \"sourceAddress\": \"rabbitmq://rabbit.integration.rhb.ad/vortex/ha-subscriber_activity_service_control_sjinweb03?ha=true&prefetch=1\"\r\n}">>]},
                               flow}}
** When Server state == {ch,running,rabbit_framing_amqp_0_9_1,1,<0.16335.0>,
                            <0.16342.0>,<0.16335.0>,
                            <<"10.100.193.10:54839 -> 10.100.193.80:5672">>,
                            {lstate,<0.16343.0>,false,false},
                            none,1,
                            {[],[]},
                            {user,<<"SJINRMQVORTEXWRITE">>,[],
                                rabbit_auth_backend_ldap,
                                {impl,
                                    "CN=SJINRMQ VORTEXWRITE,OU=INRMQ,OU=INTEGRATION,OU=Environments,OU=Servers,DC=RHB,DC=AD",
                                    <<"sQ*4~j5Ca9F_7G">>}},
                            <<"vortex">>,<<>>,
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {dict,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            {set,0,16,16,8,80,48,
                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []},
                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                  [],[]}}},
                            <0.16333.0>,
                            {state,fine,5000,undefined},
                            true,233,
                            {{0,nil},{0,nil}},
                            [],
                            [{<<"publisher_confirms">>,bool,true},
                             {<<"exchange_exchange_bindings">>,bool,true},
                             {<<"consumer_cancel_notify">>,bool,true},
                             {<<"basic.nack">>,bool,true}],
                            none}
** Reason for termination ==
** {{shutdown,
        {gen_server,call,
            [rabbit_auth_backend_ldap,
             {check_resource,
                 [{username,<<"SJINRMQVORTEXWRITE">>},
                  {user_dn,
                      "CN=SJINRMQ VORTEXWRITE,OU=INRMQ,OU=INTEGRATION,OU=Environments,OU=Servers,DC=RHB,DC=AD"},
                  {vhost,<<"vortex">>},
                  {resource,exchange},
                  {name,
                      <<"RelayHealth.MessageExchange.Core.Configuration.Events:MessageSubscribersLoaded">>},
                  {permission,write}],
                 {user,<<"SJINRMQVORTEXWRITE">>,[],rabbit_auth_backend_ldap,
                     {impl,
                         "CN=SJINRMQ VORTEXWRITE,OU=INRMQ,OU=INTEGRATION,OU=Environments,OU=Servers,DC=RHB,DC=AD",
                         <<"sQ*4~j5Ca9F_7G">>}}},
             infinity]}},
    [{gen_server,call,3,[{file,"gen_server.erl"},{line,188}]},
     {rabbit_access_control,check_access,5,[]},
     {rabbit_channel,check_resource_access,3,[]},
     {rabbit_channel,handle_method,3,[]},
     {rabbit_channel,handle_cast,2,[]},
     {gen_server2,handle_msg,2,[]},
     {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}

=ERROR REPORT==== 31-Oct-2013::13:57:00 ===
** Generic server <0.7275.0> terminating
** Last message in was {'$gen_cast?,

. . . Omitting the rest for brevity as there is one of these for every exchange


  1.  We also issue the stop-app on Rabbit node 02 of the cluster
  2.  Then we issue rabbitmqctl start_app on Node 01, and rabbit starts. The F5 sees that the node is available, adds it to the pool of available nodes and begins routing traffic to it, and the Windows services are able to complete shut down.

I?ve verified that the application code is shutting down connections cleanly. We also don?t see this behavior with the same application in environments where no rabbit cluster is setup, just a single instance.
This appears to be something that happens to Rabbit itself ? the Erlang portion of things seems to be working OK.

I?m attempting to replicate this behavior in other environments so I can try to isolate it but haven?t had a chance to do so thus far, but it does happen in every environment where we have a rabbit cluster.

Any ideas of what I might be missing?

Cheers,

Ron


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131101/1c070404/attachment.htm>

From julian+rabbitmq at dotr.com  Fri Nov  1 21:43:11 2013
From: julian+rabbitmq at dotr.com (Julian Lyndon-Smith)
Date: Fri, 1 Nov 2013 21:43:11 +0000
Subject: [rabbitmq-discuss] websocket mismatch
Message-ID: <CAOOcGr27UoU1vmj_biZ95mikV7CrX5u9_HnaS1HE6XhzT9fKbQ@mail.gmail.com>

I'm trying to use the stomp-js library to connect to rabbitmq 3.2 web-socket

I am getting the error

connection to myserver failed: Error during WebSocket
handshake:Sec-WebSocket-Protocol mismatch

I am using Chrome 30

how can I fix this

thanks

Julian

From mhodges at hawaii.edu  Sat Nov  2 02:28:37 2013
From: mhodges at hawaii.edu (Michael Hodges)
Date: Fri, 1 Nov 2013 16:28:37 -1000
Subject: [rabbitmq-discuss] RabbitMQ usage in higher ed
Message-ID: <CAFrerpiTgvJpAUF9kc=+Mqj1jEkZGrZLjTqrYAhLM3XBSYgw4g@mail.gmail.com>

Dear all,

A colleague of mine recently published a TLS patch for AnyEvent::RabbitMQ,
and heard directly back from a few universities.  It's currently my
understanding that JMS dominates as the open source technology that higher
ed folk in IT use for administrative computing.  I'm wondering and hoping
that there's actually a fair amount of RabbitMQ usage in higher and that
that we are not, for example, the only institution writing a message
producer for Banner.

If you are a higher ed institution and you would willing to identify
yourself as having RabbitMQ in your production environment and you are
willing to provide a little insight as to how it is used, please share.  If
this discussion is not quite on-topic for this list, my apologies.  If it
would be better to respond to me directly and I then provide a summary on
this list, I'd gladly do that.

Many thanks,

Michael Hodges
University of Hawaii
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131101/0315b645/attachment.htm>

From jhalterman at gmail.com  Sat Nov  2 03:59:45 2013
From: jhalterman at gmail.com (Jonathan Halterman)
Date: Fri, 1 Nov 2013 20:59:45 -0700
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] Introducing Lyra: A High
 Availability RabbitMQ Client
In-Reply-To: <5273B53A.4050404@rabbitmq.com>
References: <CA+es_-zA5nDKD0xKZCD_0iYXCRscay1WC6h2B3qJLAi2u9Ur5w@mail.gmail.com>
	<E76A3ABB-BA09-4610-82F5-A16C45AFC1E0@rabbitmq.com>
	<CA+es_-wH0QEdBceYV8-SOe7XK4njD1buNHNjeDroUehvXzdMoA@mail.gmail.com>
	<52718C27.8020905@rabbitmq.com>
	<CA+es_-w0=pGcLP9+pwEbGAP+JRCa7uc2EPkRamErSWA8BEKh=g@mail.gmail.com>
	<52720660.40906@rabbitmq.com>
	<CA+es_-yEZs1b=Hv=cUUAXijxfS6D_A2FLv3zLziGfNTtAMnyhA@mail.gmail.com>
	<5273B53A.4050404@rabbitmq.com>
Message-ID: <CA+es_-zPRZ7Y-y5KQwYpVh-kPWVqDy1tw7r7QYt-Sxd9HMB=zw@mail.gmail.com>

Hi Matthais,

On Fri, Nov 1, 2013 at 7:05 AM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Jonathan,
>
>
> On 31/10/13 18:54, Jonathan Halterman wrote:
>
>> I don't suppose you're open to enhancing the amqp-client API to include
>> something like this? :) One possible change would be the inclusion of a
>> VersionedDeliveryTag like object in the Envelope along with some
>> corresponding basic ack/nack/reject(VersionedDeliveryTag) methods on the
>> Channel interface. The channel's "version" would just be another piece
>> of meta information that the user could specify.
>>
>
> Such an API extension doesn't really make sense in the existing client.
> Plus, in order to take advantage of it client code would have to change, so
> you might as well bite the bullet and design a recovery-enabled API that
> wraps the existing API.
>
>
>  One other idea - Brett Cameron suggested tracking the last delivery tag
>> for each channel and dropping any ack/nack/reject requests for delivery
>> tags greater than that. If a channel is recovered, the last delivery tag
>> for the new channel will most likely be less than any delivery tags for
>> messages consumed on the previously closed channel. This is obviously
>> not foolproof, but it's not a bad start.
>>
>
> That's better than the present situation, I suppose, but doesn't catch the
> more dangerous of the two ways things can go wrong, i.e. when the old
> delivery tags *are* in range of the new ones then the wrong messages get
> acknowledged.


Another approach suggested by Brett - this one seems pretty sound. Start by
tracking the max delivery tag for a channel. If a channel is closed and
recovered, we increment subsequent delivery tags by the max tag we observed
for the previous channel. When the user acks/nacks/rejects a delivery tag,
we decrement by the max tag. If the decremented value is <= 0, then we know
the delivery tag is for a previously closed channel.


From lhwong at gmail.com  Sat Nov  2 05:31:26 2013
From: lhwong at gmail.com (Liong Hung Wong)
Date: Fri, 1 Nov 2013 22:31:26 -0700 (PDT)
Subject: [rabbitmq-discuss] previous connection is NOT automatically closed
	if IP different
Message-ID: <b9e02735-f1a5-4f37-a704-162ab8c79e36@googlegroups.com>

Hi,

According to http://www.rabbitmq.com/reliability.html,
"Connection Failures
In the event of a connection failure, the client will need to establish a 
new connection to the broker. Any channels opened on the previous 
connection will have been automatically closed and these will need 
re-opening too." 

I manage to establish a new connection to the broker, however, if the IP of 
the new connection is different from previous connection (for example, via 
different networks such as 3G and Wifi network or via different router) the 
previous connection will not be closed until the heartbeat timeout (default 
is 600s). 

Consumers
Channel     Consumer tag     Ack required     Exclusive
210.19.225.88:36920 (1)     amq.ctag-ma8QOXnZ_UAK-R7wddQGXA     ?     ?
210.19.225.3:60659 (1)     amq.ctag-igoa2WysTs79WAk969UFJg     ?     ?

Due to that the new connection or channel created is not able to receive 
all of the messages delivered to the queue. The new connection only 
receives alternate message until previous connection is closed.
For example, M1, M2, M3, M4 published to the queue, new connection only 
receives M2, M4 within the 600s; after the previous connection is closed 
the new connection will get M1 and M3. 

If the IP is the same, the previous connection does get closed immediately. 
New connection will get M1, M2, M3, and M4.

I am jusing rabbitmq-java client. is this a bug? 

What can I do to ensure that I can receive all of the messages immediately 
even in the scenario in which IP is different? 

Regards,
--Wong Liong Hung
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131101/e7f6b1a5/attachment.htm>

From lhwong at gmail.com  Sat Nov  2 05:47:36 2013
From: lhwong at gmail.com (L H, Wong )
Date: Sat, 2 Nov 2013 13:47:36 +0800
Subject: [rabbitmq-discuss] When I switch my network connection from one
 wifi router to another, two consumers are created
In-Reply-To: <527224A8.8060305@rabbitmq.com>
References: <681fe292-83ab-4b64-b91d-403c241d23b2@googlegroups.com>
	<527224A8.8060305@rabbitmq.com>
Message-ID: <CAGDK9bk=PiuVWa_2AnrHDWZyNjXQB73cD9VmpHzMXmQ7fS2Pxg@mail.gmail.com>

On Thu, Oct 31, 2013 at 5:36 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 31/10/13 07:46, Liong Hung Wong wrote:
>
> > When I switch my network connection from one wifi router to another, two
> > consumers are created for the queue as below. In that case, messages
> > will be distributed between both consumers, hence, the app only receives
> > alternate message until the first connection timeout due to heartbeat
> > setting.
>
> If you want to ensure that only one consumer can get messages from a
> queue then set the exclusive flag.
>
>
If I set the queue exclusive flag, the new connection/channel can not be
attached to the queue until the first connection timeout. The queue is a
permanent queue so that the client doesn't miss any message published to
the queue when the client is offline.



> > I am not able to cancel the first consumer with
> > channel.basicCancel(consumerTag) when as the connection has already been
> > closed. Is there any way to overcome this problem?
>
> This should not be a problem. If the connection of one consumer has
> already closed by the time the second consumer opened then there will be
> no overlap in subscriptions. If consumers subscribe without autoAck then
> unacknowledged messages will be returned to the queue when a connection
> terminates, and any subsequent consumer will be able to process such
> messages.
>
>
> The first connection has not been closed on the server although it has
been closed on the client side (the close command doesn't get sent to the
server as the network connection is already down). The first connection on
the server only gets closed after heartbeat timeout (default 600s).

During the 600s, M1, M2, M3 and M4 published to the queue. New connection
only get M2, and M4 during the 600s. After the first connection closed, the
new connection/channel gets M1 and M3. What I want to achieve is to be able
to get all of the messages in real-time.




>
> -Emile
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131102/fb35a735/attachment.htm>

From mklishin at gopivotal.com  Sat Nov  2 08:17:24 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 2 Nov 2013 12:17:24 +0400
Subject: [rabbitmq-discuss] previous connection is NOT automatically
	closed if IP different
In-Reply-To: <b9e02735-f1a5-4f37-a704-162ab8c79e36@googlegroups.com>
References: <b9e02735-f1a5-4f37-a704-162ab8c79e36@googlegroups.com>
Message-ID: <2A9CF47F-8C91-45B8-94C2-CF6798BA0D7E@rabbitmq.com>

On 2 Nov 2013, at 09:31, Liong Hung Wong <lhwong at gmail.com> wrote:

> I am jusing rabbitmq-java client. is this a bug? 
> 
> What can I do to ensure that I can receive all of the messages immediately even in the scenario in which IP is different? 

This is how TCP works: it retries retransmission and waits for a certain period of time
before completely closing the connection.

Heartbeat timeout is the feature that undoes this. Set it to a lower value (say, 10 seconds)
in the client:

http://hg.rabbitmq.com/rabbitmq-java-client/file/718eae51bf20/src/com/rabbitmq/client/ConnectionFactory.java#l325

You *can* receive all the messages from a different connection. Whether the client IP is the same does not matter.
Your problem is likely that the unacknowledged messages on the old connection are not being re-queued until RabbitMQ detects connection closure.

Again, see above about heartbeat setting in the client.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Sat Nov  2 08:19:26 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sat, 2 Nov 2013 12:19:26 +0400
Subject: [rabbitmq-discuss] When I switch my network connection from one
	wifi router to another, two consumers are created
In-Reply-To: <CAGDK9bk=PiuVWa_2AnrHDWZyNjXQB73cD9VmpHzMXmQ7fS2Pxg@mail.gmail.com>
References: <681fe292-83ab-4b64-b91d-403c241d23b2@googlegroups.com>
	<527224A8.8060305@rabbitmq.com>
	<CAGDK9bk=PiuVWa_2AnrHDWZyNjXQB73cD9VmpHzMXmQ7fS2Pxg@mail.gmail.com>
Message-ID: <284068AB-7484-4A5F-9B18-718B614FB27D@rabbitmq.com>

On 2 Nov 2013, at 09:47, L H, Wong <lhwong at gmail.com> wrote:

> The first connection has not been closed on the server although it has been closed on the client side (the close command doesn't get sent to the server as the network connection is already down). The first connection on the server only gets closed after heartbeat timeout (default 600s). 
> 
> During the 600s, M1, M2, M3 and M4 published to the queue. New connection only get M2, and M4 during the 600s. After the first connection closed, the new connection/channel gets M1 and M3. What I want to achieve is to be able to get all of the messages in real-time.  

The heartbeat timeout can be configured in the client. Do that and RabbitMQ will detect closed
connections much faster. You can also consider tuning your server?s TCP stack, although
heartbeats is probably a much easier way to solve the problem.

MK

Software Engineer, Pivotal/RabbitMQ



From videlalvaro at gmail.com  Sat Nov  2 08:57:43 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 2 Nov 2013 09:57:43 +0100
Subject: [rabbitmq-discuss] queue selection based on a 'feature list'
In-Reply-To: <CAHEpgBAWHwWLd3xK-CX1MGEHnPP3YHEMw2WWC65Xghso3p571A@mail.gmail.com>
References: <Prayer.1.0.16.1310300954190.22254@dogwood.freil.com>
	<527119B6.8030802@rabbitmq.com>
	<Prayer.1.0.16.1310301129120.22254@dogwood.freil.com>
	<CAHEpgBAWHwWLd3xK-CX1MGEHnPP3YHEMw2WWC65Xghso3p571A@mail.gmail.com>
Message-ID: <CAMcAHLW_tjjXZZdjVyB3q858nTysM3sDb2Mot0DHBwi11Y67jw@mail.gmail.com>

Hi,

I've created a "reverse topic exchange" plugin to accomplish uses cases
like yours.

Take a look here: https://github.com/videlalvaro/rabbitmq-rtopic-exchange

Feedback is most welcome.

Regards,

Alvaro


On Wed, Oct 30, 2013 at 5:28 PM, Chris <stuff at moesel.net> wrote:

> I've had cases where allowing the publisher to specify wildcards would
> help too.  I think it's a very useful custom exchange and would gladly use
> it if RabbitMQ or anyone else ever published it as an extension.
>
> -Chris
>
>
> On Wed, Oct 30, 2013 at 11:29 AM, Lawrence Freil <lef at apago.com> wrote:
>
>> Emile,
>>
>> Thanks for the reply.
>>
>> I had considered this approach and could use this for initial testing,
>> however the feature set that I am looking for is somewhat large and could
>> expand, each time doubling the combinations. I think the end result will be
>> creating an exchange plugin very similar to the topic exchange but where
>> the '*' and '#' can also be used in the message routing keys. Using this
>> wouldn't break any existing topic exchange usage but would allow messages
>> to be crafted with 'I don't care', and if a trailing '#' was always used in
>> the message, adding new features to the servers wouldn't break existing
>> producers.
>>
>>
>> On Oct 30 2013, Emile Joubert wrote:
>>
>>  On 30/10/13 13:54, Lawrence Freil wrote:
>>>
>>>  Is there a way to accomplish this with the current exchanges?
>>>>
>>>
>>> There may be a way to approximate this with a topic exchange if you
>>> associate features with consumers rather than queues. You could create a
>>> queue for each combination of features and bind so that it received
>>> messages that require exactly those features.
>>>
>>> E.g. you could declare queues
>>>
>>> ____, w___, _x___, __y_, ___z,
>>> wx__, ... , w__z, ..., wxyz.
>>>
>>> and bind them:
>>>
>>> ____ with binding key _._._._
>>> w___ with binding key w._._._
>>> _x__ with binding key _.x._._
>>> __y_ with binding key _._.y._
>>> ___z with binding key _._._.z
>>> ...
>>> wx__ with binding key w.x._._
>>> w__z with binding key w._._.z
>>> ...
>>> wxyz with binding key w.x.y.z
>>>
>>> Consumers can then consume from all queues that contain messages that
>>> demand a subset of the features offered by that consumer, e.g. a
>>> consumer that offers
>>>
>>> x and y consumes from ____ and _x__ and __y_ and _xy_
>>> only z  consumes from ____ and ___z
>>> w,x,y,z consumes from all queues
>>>
>>> Then if you publish a message with routing key _.x.y._ it will arrive at
>>> queue _xy_ and be sent to a consumer that is guaranteed to offer x and y.
>>>
>>>
>>> If the number of features is large or rapidly changing then this will
>>> become unmanageable. If the features are strictly associated with queues
>>> rather than consumers then it also won't work.
>>>
>>>
>>>
>>> -Emile
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>> --
>> Lawrence Freil
>> lef at apago.com
>> 770-619-1884
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131102/a09d0688/attachment.htm>

From videlalvaro at gmail.com  Sat Nov  2 09:07:29 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Sat, 2 Nov 2013 10:07:29 +0100
Subject: [rabbitmq-discuss] ANN rabbitmq reverse topic exchange type
Message-ID: <CAMcAHLUNsjZV8df9ZVD2HQ4jwScX+_ev6odQ0qDWe3RU8VpqGw@mail.gmail.com>

Hi,

I've created a new plugin type, that works similar to the topic exchange.
The difference is that the patterns are specified when publishing messages,
and the strings (without special characters) are used when binding queues.

You can read more here:
https://github.com/videlalvaro/rabbitmq-rtopic-exchange

Feedback is most welcomed.

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131102/17be1636/attachment.htm>

From matthias at rabbitmq.com  Sat Nov  2 10:52:57 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 02 Nov 2013 10:52:57 +0000
Subject: [rabbitmq-discuss] [ANNOUNCEMENT] Introducing Lyra: A High
 Availability RabbitMQ Client
In-Reply-To: <CA+es_-zPRZ7Y-y5KQwYpVh-kPWVqDy1tw7r7QYt-Sxd9HMB=zw@mail.gmail.com>
References: <CA+es_-zA5nDKD0xKZCD_0iYXCRscay1WC6h2B3qJLAi2u9Ur5w@mail.gmail.com>	<E76A3ABB-BA09-4610-82F5-A16C45AFC1E0@rabbitmq.com>	<CA+es_-wH0QEdBceYV8-SOe7XK4njD1buNHNjeDroUehvXzdMoA@mail.gmail.com>	<52718C27.8020905@rabbitmq.com>	<CA+es_-w0=pGcLP9+pwEbGAP+JRCa7uc2EPkRamErSWA8BEKh=g@mail.gmail.com>	<52720660.40906@rabbitmq.com>	<CA+es_-yEZs1b=Hv=cUUAXijxfS6D_A2FLv3zLziGfNTtAMnyhA@mail.gmail.com>	<5273B53A.4050404@rabbitmq.com>
	<CA+es_-zPRZ7Y-y5KQwYpVh-kPWVqDy1tw7r7QYt-Sxd9HMB=zw@mail.gmail.com>
Message-ID: <5274D989.10801@rabbitmq.com>

Jonathan,

On 02/11/13 03:59, Jonathan Halterman wrote:
> Another approach suggested by Brett - this one seems pretty sound. Start
> by tracking the max delivery tag for a channel. If a channel is closed
> and recovered, we increment subsequent delivery tags by the max tag we
> observed for the previous channel. When the user acks/nacks/rejects a
> delivery tag, we decrement by the max tag. If the decremented value is
> <= 0, then we know the delivery tag is for a previously closed channel.
> [...]
> What do you think of this approach?

That's a pretty neat idea. I was thinking of using the upper bits of the 
delivery tag to indicate the version, but that uses up the delivery tag 
range too quickly. Brett's idea is much better.

I can see just one problem with it: when an application uses multi-ack 
(http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.ack.multiple) 
and the delivery_tag is for a new message, then only new messages, not 
old ones, are acked, which may surprise the app when it later on gets 
the same old messages redelivered.

OTOH that really is a more general issue with automatic recovery. 
Without recovery, an application can assume that it will not see a 
message twice on the same channel. With recovery that assumption no 
longer holds. Now, one would hope few apps rely on the former, so I 
reckon as long as this potentially breaking behaviour is documented 
prominently then it's not an issue.

Matthias.

From julian+rabbitmq at dotr.com  Sat Nov  2 12:03:55 2013
From: julian+rabbitmq at dotr.com (Julian Lyndon-Smith)
Date: Sat, 2 Nov 2013 12:03:55 +0000
Subject: [rabbitmq-discuss] help! websocket problems
Message-ID: <CAOOcGr2Gpd0JJXDDk-ii1JpkQA_xXh6qyXCFtTXZ+0K8DJd8gA@mail.gmail.com>

I have run into a show-stopper where my websocket client (chrome /
firefox) connects to the rabbitmq server, but stops awaiting switching
protocols

so, my rabbitmq server is on 19.168.99.60, my pc is 192.168.99.222

I seem to connect ok (see below), but the subscribe seems to hang. in
chrome dev tools, you can see it stops at websocket "pending"

afraid to say that this is critical for me, I need to be giving a demo
on this project shortly, so would appreciate any help that anyone
could give

thanks

Julian


Web Socket Opened... vendor.js:12432
>>> CONNECT login:mylogin
passcode:mypassword host:vhost1 accept-version:1.1,1.0
heart-beat:10000,10000 vendor.js:12432
<<< CONNECTED session:session-YpgJEC1oHcI6a5VGClN_Sw
heart-beat:10000,10000 server:RabbitMQ/3.2.0 version:1.1
vendor.js:12432
connected to server RabbitMQ/3.2.0 vendor.js:12432
send PING every 10000ms vendor.js:12432
check PONG every 10000ms vendor.js:12432
>>> SUBSCRIBE id:sub-0 destination:/topic/peerStatus

[chrome dev tools]

info
192.168.99.60/stomp
GET
200
OK
application/json
sockjs-0.3.min.js:27
Script
391?B
78?B
538?ms
537?ms
537?ms

websocket
192.168.99.60/stomp/776/d5wz9c_w
GET
101
Switching Protocols
Pending
Other
127?B
0?B
Pending

From lhwong at gmail.com  Sat Nov  2 13:39:41 2013
From: lhwong at gmail.com (L H, Wong )
Date: Sat, 2 Nov 2013 21:39:41 +0800
Subject: [rabbitmq-discuss] previous connection is NOT automatically
 closed if IP different
In-Reply-To: <2A9CF47F-8C91-45B8-94C2-CF6798BA0D7E@rabbitmq.com>
References: <b9e02735-f1a5-4f37-a704-162ab8c79e36@googlegroups.com>
	<2A9CF47F-8C91-45B8-94C2-CF6798BA0D7E@rabbitmq.com>
Message-ID: <CAGDK9b=RMVUQjkivcd1yxwe5b+xTw1Uh-=7X2AsN0RnSRKe+YA@mail.gmail.com>

Hi MK,

I am aware of the heartbeat setting. However, my application is running on
mobile phone I afraid that if I set the value to lower value like 10s it
will consume more battery power and also cause higher data usage.

Yes, I can receive all messages ultimately. However, I hope that I can get
those messages in real-time and in the order those messages were published.

"Your problem is likely that the unacknowledged messages on the old
connection are not being re-queued until RabbitMQ detects connection
closure."
Is there any way to ensure that the unacknowledged messages on the old
connection are being re-queued immediately and being delivered to other
consumer?

Regards,
Nick



On Sat, Nov 2, 2013 at 4:17 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 2 Nov 2013, at 09:31, Liong Hung Wong <lhwong at gmail.com> wrote:
>
> > I am jusing rabbitmq-java client. is this a bug?
> >
> > What can I do to ensure that I can receive all of the messages
> immediately even in the scenario in which IP is different?
>
> This is how TCP works: it retries retransmission and waits for a certain
> period of time
> before completely closing the connection.
>
> Heartbeat timeout is the feature that undoes this. Set it to a lower value
> (say, 10 seconds)
> in the client:
>
>
> http://hg.rabbitmq.com/rabbitmq-java-client/file/718eae51bf20/src/com/rabbitmq/client/ConnectionFactory.java#l325
>
> You *can* receive all the messages from a different connection. Whether
> the client IP is the same does not matter.
> Your problem is likely that the unacknowledged messages on the old
> connection are not being re-queued until RabbitMQ detects connection
> closure.
>
> Again, see above about heartbeat setting in the client.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131102/58b23d4b/attachment.htm>

From matthias at rabbitmq.com  Sat Nov  2 15:14:43 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 02 Nov 2013 15:14:43 +0000
Subject: [rabbitmq-discuss] previous connection is NOT automatically
 closed if IP different
In-Reply-To: <CAGDK9b=RMVUQjkivcd1yxwe5b+xTw1Uh-=7X2AsN0RnSRKe+YA@mail.gmail.com>
References: <b9e02735-f1a5-4f37-a704-162ab8c79e36@googlegroups.com>	<2A9CF47F-8C91-45B8-94C2-CF6798BA0D7E@rabbitmq.com>
	<CAGDK9b=RMVUQjkivcd1yxwe5b+xTw1Uh-=7X2AsN0RnSRKe+YA@mail.gmail.com>
Message-ID: <527516E3.8090600@rabbitmq.com>

On 02/11/13 13:39, L H, Wong wrote:
> Is there any way to ensure that the unacknowledged messages on the
> old connection are being re-queued immediately and being delivered to
> other consumer?

"immediately" when *what* happens?

If a client properly closes the rabbitmq connection (through the API or
even just doing a full TCP connection closure handshake) then messages
pending ack will get re-queued right at that point.

If, OTOH, there is just some network disruption then rabbit won't know
the connection is dead until various TCP-level timeouts kick in. That is
fundamental to the design of TCP.

AMQP heartbeats exist to give applications control over connection
liveness. So if you want to ensure dead connections get detected
promptly, then use a low AMQP heartbeat interval. The "any way" you are
looking for is exactly that. As Michael explained already.

> if I set the value to lower value like 10s it will consume more
> battery power and also cause higher data usage.

There is no other way to do this. Peers of a connection cannot magically 
detect that the connection is dead. It requires either a positive signal 
(such as controlled connection closure), or negative signal (absence of 
any traffic for some duration of time).

Regards,

Matthias.

From matthias at rabbitmq.com  Sat Nov  2 15:33:21 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sat, 02 Nov 2013 15:33:21 +0000
Subject: [rabbitmq-discuss] Rabbitmq Crash Reports.
In-Reply-To: <27E054594442884E9A46DBCF9AE74081610481@BSDMSATMBX001.mahindrasatyam.ad>
References: <27E054594442884E9A46DBCF9AE74081610481@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <52751B41.8010301@rabbitmq.com>

Rohit,

On 28/10/13 07:31, Rohit Patle wrote:
> After even I shifted to new Erlang version i.e RabbitMQ 3.1.5, Erlang
> R16B02 from RabbitMQ 3.1.5, Erlang R16B01. I am getting the Rabbitmq
> CRASH at-least one time in a day.
>
> FYI I am attaching the CRASH REPORT's for your reference with this mail.
> Kindly suggest what could be the reason and how I can over come the same?

Both of these are just process crash reports, and pretty harmless ones 
at that, not crashes of rabbit itself. So rabbit should happily continue 
working. Do you observe any unusual behaviour at all, or are you simply 
concerned about the appearance of these log entries?

The first error...

> =CRASH REPORT==== 25-Oct-2013::18:27:59 ===
>   crasher:
>     initial call: tls_connection:init/1
>     pid: <0.5793.0>
>     registered_name: []
>     exception exit: {{case_clause,{error,ebadf}},
>                      [{tls_connection,handle_unrecv_data,2,
>                                       [{file,"tls_connection.erl"},
>                                        {line,3021}]},
>                       {tls_connection,terminate,3,
>                                       [{file,"tls_connection.erl"},
>                                        {line,1162}]},
>                       {gen_fsm,terminate,7,[{file,"gen_fsm.erl"},{line,597}]},
>                       {proc_lib,init_p_do_apply,3,
>                                 [{file,"proc_lib.erl"},{line,239}]}]}
>       in function  gen_fsm:terminate/7 (gen_fsm.erl, line 600)


...looks like a bug in the erlang ssl stack, where a sudden closure of 
the socket causes an explosion in the ssl socket termination code. This 
error should be harmless since the connection was already dead at that 
point anyway.

The second error...

> =CRASH REPORT==== 25-Oct-2013::17:55:25 ===
>   crasher:
>     initial call: rabbit_reader:init/4
>     pid: <0.1304.2>
>     registered_name: []
>     exception exit: channel_termination_timeout
>       in function  rabbit_reader:wait_for_channel_termination/2
>       in call from rabbit_reader:handle_exception/3
>       in call from rabbit_reader:terminate/2
>       in call from rabbit_reader:handle_other/2
>       in call from rabbit_reader:mainloop/2
>       in call from rabbit_reader:run/1
>       in call from rabbit_reader:start_connection/7

...can be caused when connections are terminated and the server is busy 
and fails to terminate all the associated processes cleanly in a set 
amount of time. This is largely harmless too.

Regards,

Matthias.

From julian at dotr.com  Sat Nov  2 10:14:57 2013
From: julian at dotr.com (Julian Lyndon-Smith)
Date: Sat, 2 Nov 2013 03:14:57 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ's WebSocket broken
In-Reply-To: <47e4346c-7cec-4f09-bb10-9e7917274958@googlegroups.com>
References: <47e4346c-7cec-4f09-bb10-9e7917274958@googlegroups.com>
Message-ID: <65ccc7a1-8e27-44b9-8db3-a8201d85b1bc@googlegroups.com>

Hey,

did you ever get a solution to this problem ? I've got the same and it's 
driving me nuts :(

thanks

Julian

On Friday, 11 October 2013 07:58:11 UTC+1, Petri Luojus wrote:
>
> Hello,
>
> We're using RabbitMQ in our messaging with several AMQP and STOMP over 
> WebSocket clients. STOMP clients are using JavaScript and stomp.js (
> http://jmesnil.net/stomp-websocket/doc/) in browsers. However, recent 
> stable release for Chrome fixed the following issue: 
> http://code.google.com/p/chromium/issues/detail?id=259666. This in turn 
> broke all Chromium-based clients, and since the WebSocket specification (
> http://dev.w3.org/html5/websockets/) reports "The connection will only be 
> established if the server reports that it has selected one of these 
> subprotocols." it is expected that this fix will be pushed to other 
> browsers too.
>
> Following messages are changed between client and RabbitMQ, after which 
> Chrome reports "Error during WebSocket handshake: Sec-WebSocket-Protocol 
> mismatch". As can be seen from the response, RabbitMQ does not confirm the 
> selected protocol.
>
> GET /stomp/websocket HTTP/1.1
> Upgrade: websocket
> Connection: Upgrade
> Host: xxx.yyy:15674
> Origin: null
> Sec-WebSocket-Protocol: v10.stomp, v11.stomp
> Pragma: no-cache
> Cache-Control: no-cache
> Sec-WebSocket-Key: YRpCwsRP6s2ounZHK4soEQ==
> Sec-WebSocket-Version: 13
> Sec-WebSocket-Extensions: x-webkit-deflate-frame
> User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, 
> like Gecko) Chrome/30.0.1599.69 Safari/537.36
> Cookie: auth=bHVvanVzOk15aGthbGU1; 
> m=1933:600%7C5|2377:large|2491:chart|2663:t|6967:t|34e2:|4e99:t|2c69:t|2a03:t|745a:t|77cb:t|5cf4:t|3a95:avg|54b5:small|29b3:60%7C5|3a8e:chart|54ae:small|29ac:600%7C5|47ba:t|e69:chart|45b9:600%7C5|4a01:t|ca3:t|79d4:chart|640c:small|678e:60%7C5|4e71:large|4d66:500|1d98:t|6cfc:t|15cc:t
>
> HTTP/1.1 101 Switching Protocols
> Upgrade: websocket
> Sec-Websocket-Accept: DGeZKxS98lD43p+4Gkhb17W29E0=
> Connection: Upgrade
>
> RabbitMQ is installed on CentOS 6.4 with the following versions for the 
> server and Erlang
> rabbitmq-server.noarch 3.1.5-1.el6 @epel
> erlang.x86_64 R14B-04.2.el6 @epel
>
> Could you guys look into this issue?
>
> Br,
> Petri
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131102/e4752351/attachment.htm>

From bsellner at seegrid.com  Sat Nov  2 22:04:41 2013
From: bsellner at seegrid.com (Brennan Sellner)
Date: Sat, 2 Nov 2013 18:04:41 -0400
Subject: [rabbitmq-discuss] Stomp, subscriptions, and forward slashes
Message-ID: <527576F9.5040108@seegrid.com>

Hi everyone,

I'm currently in the process of using the web-stomp plugin to add
messaging to the browser to our existing RabbitMQ-linked system.  I've
run into a bit of a snag, however: long before we even contemplated
STOMP, we started including forward slashes in our exchange names (e.g.
robot/hardware/laser or server/chat).

This worked well across a variety of AMQP clients, but is wreaking havoc
with STOMP, since a subscription for all messages on the server/chat
exchange now looks like:

  client.subscribe ( '/exchange/server/chat/#', on_chat_msg );

This fails, with Rabbit complaining thusly (presumably due to the extra
/ and the resulting ambiguity):

=ERROR REPORT==== 2-Nov-2013::17:56:13 ===
STOMP error frame sent:
Message: "Invalid destination"
Detail: "'/server/chat/#' is not a valid exchange destination\n"
Server private detail: none

I'm able to get everything working if I omit the forward slash in the
exchange name.  However, I'd prefer to not have to make a system-wide
breaking change to our exchange names just to add another client.

Is there any way to escape the slash in the exchange name when
subscribing via web-stomp?  I've blindly tried a few options (i.e. '\\/'
or '%47'), but with no luck.  http://www.rabbitmq.com/stomp.html
indicates that the / should be replaced by %47 (and decoded on the far
end?), but I haven't seen any evidence of that occurring.

Any thoughts?

Thanks,

-Brennan

My apologies for the below:

Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From agram at blackridge.us  Sat Nov  2 22:46:54 2013
From: agram at blackridge.us (Andy Gram)
Date: Sat, 2 Nov 2013 22:46:54 +0000
Subject: [rabbitmq-discuss] messages stuck using shovel
In-Reply-To: <e4d37ce74b4b4870be8399ee7aa3ef89@BN1PR07MB199.namprd07.prod.outlook.com>
References: <fdb1d592867044d290aa57bbc45bf33f@BN1PR07MB199.namprd07.prod.outlook.com>
	<8c0475d57f2446ca9604949eb4bd05a7@BN1PR07MB199.namprd07.prod.outlook.com>
	<e4d37ce74b4b4870be8399ee7aa3ef89@BN1PR07MB199.namprd07.prod.outlook.com>
Message-ID: <91919ff83f0e4796b9da6030cf86ee3c@BN1PR07MB199.namprd07.prod.outlook.com>

Well, after trying a bunch of things I found that I needed to add an exchange to the shovel configuration. I guess shovel publishes on the destination. My original understanding was that shovel moved messages from one queue to another but this seems to be wrong. It seems to read a message from the source and publish it to the destination. In any case, messages are moving now and I can progress.

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Andy Gram
Sent: Thursday, October 31, 2013 7:42 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] messages stuck using shovel

And I should have provided this from devmid:

[{ident_refresh,
     {running,
         {source,
             {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
                 "192.168.168.212",undefined,0,0,0,infinity,none,
                 [#Fun<amqp_uri.7.32597394>,#Fun<amqp_uri.7.32597394>],
                 [],[]}},
         {destination,
             {amqp_params_direct,<<"guest">>,none,<<"/">>,rabbit at devmid,none,
                 []}}},
     {{2013,10,31},{17,32,2}}},
{ident_pub,
     {running,
         {source,
             {amqp_params_direct,<<"guest">>,none,<<"/">>,rabbit at devmid,none,
                 []}},
         {destination,
             {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
                 "192.168.168.212",undefined,0,0,0,infinity,none,
                 [#Fun<amqp_uri.7.32597394>,#Fun<amqp_uri.7.32597394>],
                 [],[]}}},
     {{2013,10,31},{17,32,2}}},
{ident_sub,
     {running,
         {source,
             {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
                 "192.168.168.212",undefined,0,0,0,infinity,none,
                 [#Fun<amqp_uri.7.32597394>,#Fun<amqp_uri.7.32597394>],
                 [],[]}},
         {destination,
             {amqp_params_direct,<<"guest">>,none,<<"/">>,rabbit at devmid,none,
                 []}}},
     {{2013,10,31},{17,32,2}}},
{refresh_req,
     {running,
         {source,
             {amqp_params_direct,<<"guest">>,none,<<"/">>,rabbit at devmid,none,
                 []}},
         {destination,
             {amqp_params_network,<<"guest">>,<<"guest">>,<<"/">>,
                 "192.168.168.212",undefined,0,0,0,infinity,none,
                 [#Fun<amqp_uri.7.32597394>,#Fun<amqp_uri.7.32597394>],
                 [],[]}}},
     {{2013,10,31},{17,32,2}}}]
...done.

IP address of devtop is 192.168.168.212. Here's additional info from regarding connections from devtop;

+-------+-----------------------------------------------+---------+----------------+----------+-----------+-----------------+------------------+-----------------+---------------+------------------+-------------------+--------------------+-----------------+-----------+------+------------+----------+----------+----------+----------+-----------+-------+------------+----------+------------------+--------------+---------+---------+-------+
| vhost |                     name                      |  type   | auth_mechanism | channels | frame_max |      host       | last_blocked_age | last_blocked_by |     node      | peer_cert_issuer | peer_cert_subject | peer_cert_validity |    peer_host    | peer_port | port |  protocol  | recv_cnt | recv_oct | send_cnt | send_oct | send_pend |  ssl  | ssl_cipher | ssl_hash | ssl_key_exchange | ssl_protocol |  state  | timeout | user  |
+-------+-----------------------------------------------+---------+----------------+----------+-----------+-----------------+------------------+-----------------+---------------+------------------+-------------------+--------------------+-----------------+-----------+------+------------+----------+----------+----------+----------+-----------+-------+------------+----------+------------------+--------------+---------+---------+-------+
| /     | 127.0.0.1:53029 -> 127.0.0.1:5672             | network | PLAIN          | 2        | 32768     | 127.0.0.1       | infinity         | none            | rabbit at devtop |                  |                   |                    | 127.0.0.1       | 53029     | 5672 | AMQP 0-9-1 | 81       | 1888     | 69       | 2001     | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 127.0.0.1:53030 -> 127.0.0.1:5672             | network | PLAIN          | 2        | 32768     | 127.0.0.1       | infinity         | none            | rabbit at devtop |                  |                   |                    | 127.0.0.1       | 53030     | 5672 | AMQP 0-9-1 | 67       | 926      | 66       | 964      | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.142:38100 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.142 | 38100     | 5672 | AMQP 0-9-1 | 63       | 975      | 63       | 934      | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.142:41887 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.142 | 41887     | 5672 | AMQP 0-9-1 | 64       | 951      | 64       | 1159     | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.142:51473 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.142 | 51473     | 5672 | AMQP 0-9-1 | 64       | 967      | 63       | 924      | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.142:58133 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.142 | 58133     | 5672 | AMQP 0-9-1 | 60       | 870      | 60       | 867      | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.146:36800 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.146 | 36800     | 5672 | AMQP 0-9-1 | 64       | 967      | 63       | 924      | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.146:37081 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.146 | 37081     | 5672 | AMQP 0-9-1 | 63       | 975      | 63       | 934      | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.146:40113 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.146 | 40113     | 5672 | AMQP 0-9-1 | 63       | 951      | 64       | 1159     | 0         | False |            |          |                  |              | running | 600     | guest |
| /     | 192.168.168.146:49883 -> 192.168.168.212:5672 | network | PLAIN          | 1        | 131072    | 192.168.168.212 | infinity         | none            | rabbit at devtop |                  |                   |                    | 192.168.168.146 | 49883     | 5672 | AMQP 0-9-1 | 61       | 1067     | 61       | 888      | 0         | False |            |          |                  |              | running | 600     | guest |
+-------+-----------------------------------------------+---------+----------------+----------+-----------+-----------------+------------------+-----------------+---------------+------------------+-------------------+--------------------+-----------------+-----------+------+------------+----------+----------+----------+----------+-----------+-------+------------+----------+------------------+--------------+---------+---------+-------+

From: rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Andy Gram
Sent: Thursday, October 31, 2013 11:51 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] messages stuck using shovel

I probably should have mentioned that I am using RabbitMQ R3.1.4 with Erlang R14B04 running on linux.

From: rabbitmq-discuss-bounces at lists.rabbitmq.com<mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Andy Gram
Sent: Thursday, October 31, 2013 11:10 AM
To: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Subject: [rabbitmq-discuss] messages stuck using shovel

I have a configuration of 3 RabbitMQ nodes; devtop, devmid, devbot. I am implementing a star configuration with devtop as the center of the start. This is a pubsub application over a WAN. Any node can submit a new item to devtop and my publisher application will publish to all nodes, including itself. I am using shovel to instantiate a queue for each node that is bound to a fanout exchange on devtop. The published messages are stuck on devtop as below;

+-------+--------------------------------+-------------+-----------+---------+------------------------+---------------------+--------+----------+----------------+-------------------------+---------------+--------+---------+
| vhost |              name              | auto_delete | consumers | durable | exclusive_consumer_tag |     idle_since      | memory | messages | messages_ready | messages_unacknowledged |     node      | policy | status  |
+-------+--------------------------------+-------------+-----------+---------+------------------------+---------------------+--------+----------+----------------+-------------------------+---------------+--------+---------+
| /     | amq.gen-QXyScDVGCoTv8bhcbrMOrA | False       | 1         | False   |                        | 2013-10-31 10:32:25 | 9456   | 1        | 0              | 1                       | rabbit at devtop |        | running |
| /     | amq.gen-Ya03CVYcY-CEVKOYcSt0Xw | False       | 1         | False   |                        | 2013-10-31 10:32:25 | 9456   | 1        | 0              | 1                       | rabbit at devtop |        | running |
| /     | new_ident_queue                | False       | 1         | True    |                        | 2013-10-31 10:32:28 | 14312  | 0        | 0              | 0                       | rabbit at devtop |        | running |
| /     | pub_idents                     | False       | 0         | True    |                        | 2013-10-31 10:15:52 | 13760  | 0        | 0              | 0                       | rabbit at devtop |        | running |
| /     | refresh_idents                 | False       | 2         | True    |                        | 2013-10-31 10:32:18 | 14192  | 0        | 0              | 0                       | rabbit at devtop |        | running |
| /     | refresh_queue                  | False       | 1         | True    |                        | 2013-10-31 10:32:18 | 13976  | 0        | 0              | 0                       | rabbit at devtop |        | running |
+-------+--------------------------------+-------------+-----------+---------+------------------------+---------------------+--------+----------+----------------+-------------------------+---------------+--------+---------+

The status on devmid is as follows;

+-------+-----------------+-------------+-----------+---------+------------------------+---------------------+--------+----------+----------------+-------------------------+---------------+--------+---------+
| vhost |      name       | auto_delete | consumers | durable | exclusive_consumer_tag |     idle_since      | memory | messages | messages_ready | messages_unacknowledged |     node      | policy | status  |
+-------+-----------------+-------------+-----------+---------+------------------------+---------------------+--------+----------+----------------+-------------------------+---------------+--------+---------+
| /     | ident_updates   | False       | 0         | True    |                        | 2013-10-31 17:32:03 | 21696  | 0        | 0              | 0                       | rabbit at devmid |        | running |
| /     | new_ident_queue | False       | 1         | True    |                        | 2013-10-31 17:32:03 | 21912  | 0        | 0              | 0                       | rabbit at devmid |        | running |
| /     | refresh_idents  | False       | 0         | True    |                        | 2013-10-31 17:32:03 | 21696  | 0        | 0              | 0                       | rabbit at devmid |        | running |
| /     | refresh_queue   | False       | 1         | True    |                        | 2013-10-31 17:32:03 | 21912  | 0        | 0              | 0                       | rabbit at devmid |        | running |
+-------+-----------------+-------------+-----------+---------+------------------------+---------------------+--------+----------+----------------+-------------------------+---------------+--------+---------+

I am expecting shovel from devmid to move the messages from devtop queue to ident_updates queue on devmid. My shovel configuration follows:
{rabbitmq_shovel,
    [ {shovels, [ {ident_pub,
                    [ {sources, [ {broker, "amqp://"}
                        , {declarations, [
                                 {'queue.declare',
                                        [{queue, <<"new_ident_queue">> }
                                        , durable
                                        ]}
                                ]}
                        ]}
                    , {destinations, [ {broker, "amqp://192.168.168.212"}
                        , {declarations, [
                                 {'queue.declare',
                                        [{queue, <<"new_ident_queue">> }
                                        , durable
                                        ]}
                                ]}
                        ]}
                    , {queue, <<"new_ident_queue">>}
                    , {prefetch_count, 1}
                    , {ack_mode, on_confirm}
                    , {publish_properties, [ {delivery_mode, 2} ]}
                    , {reconnect_delay, 5}
                    ]},
                  {ident_sub,
                    [ {destinations, [ {broker, "amqp://"}
                        , {declarations, [
                                {'queue.declare',
                                        [{queue, <<"ident_updates">> }
                                        , durable
                                        ]}
                                ]}
                        ]}
                    , {sources, [ {broker, "amqp://192.168.168.212"}
                        , {declarations, [ {'exchange.declare',
                                [ {exchange, <<"pub_idents">>}
                                        , {type, <<"fanout">>}
                                        ]}
                                , {'queue.declare',
                                        [{queue, <<>> }
                                        , exclusive
                                        ]}
                                , {'queue.bind',
                                        [ {exchange, <<"pub_idents">>}
                                        , {queue,    <<>>}
                                        ]}
                                ]}
                        ]}
                    , {queue, <<>>}
                    , {prefetch_count, 1}
                    , {ack_mode, on_confirm}
                    , {publish_properties, [ {delivery_mode, 2} ]}
                    , {reconnect_delay, 5}
                    ]},
...

My shovel is stuck!! Any help would be appreciated.

Thanks,
Andy


This email message is for the sole use of the intended recipient(s) and may contain confidential and privileged information. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply email and destroy all copies of the original message. If you are the intended recipient, please be advised that the content of this message is subject to access, review and disclosure by the sender's Email System Administrator.


Andy Gram
BlackRidge Technology Inc.
www.blackridge.us<http://www.blackridge.us/>
408-892-4044

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131102/031c80fa/attachment.htm>

From jhalterman at gmail.com  Sat Nov  2 22:50:03 2013
From: jhalterman at gmail.com (Jonathan Halterman)
Date: Sat, 2 Nov 2013 15:50:03 -0700
Subject: [rabbitmq-discuss] [Java client] - Delay in releasing channel
	numbers
Message-ID: <CA+es_-xWtuT43+88ZQOTdAo0_wDG8FB_5FOoKz67aNoQpbo-rw@mail.gmail.com>

I noticed in the Java client that when a channel is closed as the result of
an invocation, the channel number is released sometime after the
IOException is thrown to the caller. The channel number release does happen
before the channel's ShutdownListener is called, but for the purpose of
recovering a channel with the same number it's often easier to handle the
failed invocation than to wait for the ShutdownListener.

Is this something that can be addressed?

Cheers,
Jonathan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131102/8fc1c62a/attachment.htm>

From mklishin at gopivotal.com  Sun Nov  3 09:16:33 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 3 Nov 2013 13:16:33 +0400
Subject: [rabbitmq-discuss] previous connection is NOT automatically
	closed if IP different
In-Reply-To: <CAGDK9b=RMVUQjkivcd1yxwe5b+xTw1Uh-=7X2AsN0RnSRKe+YA@mail.gmail.com>
References: <b9e02735-f1a5-4f37-a704-162ab8c79e36@googlegroups.com>
	<2A9CF47F-8C91-45B8-94C2-CF6798BA0D7E@rabbitmq.com>
	<CAGDK9b=RMVUQjkivcd1yxwe5b+xTw1Uh-=7X2AsN0RnSRKe+YA@mail.gmail.com>
Message-ID: <717C2559-8EA7-45C6-9479-9C95FA437878@gopivotal.com>

On nov 2, 2013, at 5:39 PM, L H, Wong <lhwong at gmail.com> wrote:

> I am aware of the heartbeat setting. However, my application is running on mobile phone I afraid that if I set the value to lower value like 10s it will consume more battery power and also cause higher data usage.

This is an understandable concern but there are no other options.

I?d suggest using a value of 20 or so. This means a little bit of data (about a dozen of bytes)
will be sent roughly every 10 seconds. There will be no new threads created or significant
amounts of CPU consumed, so net impact on energy consumption and traffic
likely will be very small.
--
MK

Software Engineer, Pivotal/RabbitMQ


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131103/b1e34b19/attachment.pgp>

From matthias at rabbitmq.com  Sun Nov  3 10:18:38 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 03 Nov 2013 10:18:38 +0000
Subject: [rabbitmq-discuss] messages stuck using shovel
In-Reply-To: <91919ff83f0e4796b9da6030cf86ee3c@BN1PR07MB199.namprd07.prod.outlook.com>
References: <fdb1d592867044d290aa57bbc45bf33f@BN1PR07MB199.namprd07.prod.outlook.com>	<8c0475d57f2446ca9604949eb4bd05a7@BN1PR07MB199.namprd07.prod.outlook.com>	<e4d37ce74b4b4870be8399ee7aa3ef89@BN1PR07MB199.namprd07.prod.outlook.com>
	<91919ff83f0e4796b9da6030cf86ee3c@BN1PR07MB199.namprd07.prod.outlook.com>
Message-ID: <527622FE.7070709@rabbitmq.com>

Andy,

On 02/11/13 22:46, Andy Gram wrote:
> I found that I needed to add an exchange to the shovel configuration.
> I guess shovel publishes on the destination. My original
> understanding was that shovel moved messages from one queue to
> another but this seems to be wrong. It seems to read a message from
> the source and publish it to the destination.

See the second sentence at http://www.rabbitmq.com/shovel.html

"The high level goal of a shovel is to reliably and continually take
messages from a queue (a source) in one broker and publish them to
exchanges in another broker (a destination)."

> In any case, messages are moving now and I can progress.

Glad you got it working.

Regards,

Matthias.

From matthias at rabbitmq.com  Sun Nov  3 10:24:26 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Sun, 03 Nov 2013 10:24:26 +0000
Subject: [rabbitmq-discuss] [Java client] - Delay in releasing channel
 numbers
In-Reply-To: <CA+es_-xWtuT43+88ZQOTdAo0_wDG8FB_5FOoKz67aNoQpbo-rw@mail.gmail.com>
References: <CA+es_-xWtuT43+88ZQOTdAo0_wDG8FB_5FOoKz67aNoQpbo-rw@mail.gmail.com>
Message-ID: <5276245A.2010607@rabbitmq.com>

On 02/11/13 22:50, Jonathan Halterman wrote:
> for the purpose of recovering a channel *with the same number*

why do you want to do that?

Matthias.

From mklishin at gopivotal.com  Sun Nov  3 19:07:09 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 3 Nov 2013 23:07:09 +0400
Subject: [rabbitmq-discuss] ANN amqp gem 1.1.1 is released
Message-ID: <96BE0BF1-1165-4ACD-AB1D-101E786D1DE9@rabbitmq.com>

amqp gem 1.1.1 is released [1].

This is a bug fix release. All users are recommended to upgrade.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/11/01/amqp-gem-1-dot-1-1-is-released/

1. http://rubygems.org/gems/amqp/versions/1.1.1

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Sun Nov  3 19:11:54 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 3 Nov 2013 23:11:54 +0400
Subject: [rabbitmq-discuss] RabbitMQ's WebSocket broken
In-Reply-To: <65ccc7a1-8e27-44b9-8db3-a8201d85b1bc@googlegroups.com>
References: <47e4346c-7cec-4f09-bb10-9e7917274958@googlegroups.com>
	<65ccc7a1-8e27-44b9-8db3-a8201d85b1bc@googlegroups.com>
Message-ID: <34F5D355-393C-4C98-9B89-E6618F9494D8@rabbitmq.com>

On 2 Nov 2013, at 14:14, Julian Lyndon-Smith <julian at dotr.com> wrote:

> did you ever get a solution to this problem ? I've got the same and it's driving me nuts :(

Julian,

There was no RabbitMQ release after this issue was reported
but there is a bug filed for this. It will take some time to determine
if the fix can go into a point release. We will post an update
here when that?s clear.

MK

Software Engineer, Pivotal/RabbitMQ



From julian+rabbitmq at dotr.com  Sun Nov  3 19:27:58 2013
From: julian+rabbitmq at dotr.com (Julian Lyndon-Smith)
Date: Sun, 3 Nov 2013 19:27:58 +0000
Subject: [rabbitmq-discuss] RabbitMQ's WebSocket broken
In-Reply-To: <34F5D355-393C-4C98-9B89-E6618F9494D8@rabbitmq.com>
References: <47e4346c-7cec-4f09-bb10-9e7917274958@googlegroups.com>
	<65ccc7a1-8e27-44b9-8db3-a8201d85b1bc@googlegroups.com>
	<34F5D355-393C-4C98-9B89-E6618F9494D8@rabbitmq.com>
Message-ID: <CAOOcGr2PQzoL9s=K0DdgbKOJa1VfV9_Am72msDyBTL7dEiRKLw@mail.gmail.com>

thanks for the update

Julian

On 3 November 2013 19:11, Michael Klishin <mklishin at gopivotal.com> wrote:
> On 2 Nov 2013, at 14:14, Julian Lyndon-Smith <julian at dotr.com> wrote:
>
>> did you ever get a solution to this problem ? I've got the same and it's driving me nuts :(
>
> Julian,
>
> There was no RabbitMQ release after this issue was reported
> but there is a bug filed for this. It will take some time to determine
> if the fix can go into a point release. We will post an update
> here when that?s clear.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>

From lhwong at gmail.com  Mon Nov  4 01:24:26 2013
From: lhwong at gmail.com (L H, Wong )
Date: Mon, 4 Nov 2013 09:24:26 +0800
Subject: [rabbitmq-discuss] previous connection is NOT automatically
 closed if IP different
In-Reply-To: <717C2559-8EA7-45C6-9479-9C95FA437878@gopivotal.com>
References: <b9e02735-f1a5-4f37-a704-162ab8c79e36@googlegroups.com>
	<2A9CF47F-8C91-45B8-94C2-CF6798BA0D7E@rabbitmq.com>
	<CAGDK9b=RMVUQjkivcd1yxwe5b+xTw1Uh-=7X2AsN0RnSRKe+YA@mail.gmail.com>
	<717C2559-8EA7-45C6-9479-9C95FA437878@gopivotal.com>
Message-ID: <CAGDK9bkcRDugpv0TSP9Gebi6FVN64FCv8MMDAyXo8gGyVzJt7Q@mail.gmail.com>

Hi Michael,

Thank you very much for the information. I am wondering why if IP for first
and second connections are the same (in the scenarios in which the
connection lost and resumed almost immediately via same network) the first
connection gets closed almost immediately after the second connection was
established.


Regards,
--Wong Liong Hung




On Sun, Nov 3, 2013 at 5:16 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On nov 2, 2013, at 5:39 PM, L H, Wong <lhwong at gmail.com> wrote:
>
> > I am aware of the heartbeat setting. However, my application is running
> on mobile phone I afraid that if I set the value to lower value like 10s it
> will consume more battery power and also cause higher data usage.
>
> This is an understandable concern but there are no other options.
>
> I?d suggest using a value of 20 or so. This means a little bit of data
> (about a dozen of bytes)
> will be sent roughly every 10 seconds. There will be no new threads
> created or significant
> amounts of CPU consumed, so net impact on energy consumption and traffic
> likely will be very small.
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/dc0e4dc5/attachment.htm>

From carl.hoerberg at gmail.com  Mon Nov  4 04:04:07 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sun, 3 Nov 2013 20:04:07 -0800 (PST)
Subject: [rabbitmq-discuss] Unable to access management portal after
 upgarding erlang and RabbitMQ
In-Reply-To: <1382850984653-30885.post@n5.nabble.com>
References: <2dc98c94.000002d4.0000000b@KAPILPC.vmware.com>
	<52172BFC.2080705@rabbitmq.com>
	<1382850984653-30885.post@n5.nabble.com>
Message-ID: <1383537847745-31118.post@n5.nabble.com>

The Elliptic Curve Cipher implementation in R16B1 and R16B2 is broken: 
http://osdir.com/ml/erlang-programming-bugs/2013-10/msg00004.html

So specify a chiper list without "ecdh*" key exchange algorithms in it. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Unable-to-access-management-portal-after-upgarding-erlang-and-RabbitMQ-tp28946p31118.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Tobias.Gutzmann at ist.com  Mon Nov  4 07:32:53 2013
From: Tobias.Gutzmann at ist.com (Tobias Gutzmann)
Date: Mon, 4 Nov 2013 07:32:53 +0000
Subject: [rabbitmq-discuss] previous connection is NOT automatically
 closed if IP different
In-Reply-To: <CAGDK9bkcRDugpv0TSP9Gebi6FVN64FCv8MMDAyXo8gGyVzJt7Q@mail.gmail.com>
References: <b9e02735-f1a5-4f37-a704-162ab8c79e36@googlegroups.com>
	<2A9CF47F-8C91-45B8-94C2-CF6798BA0D7E@rabbitmq.com>
	<CAGDK9b=RMVUQjkivcd1yxwe5b+xTw1Uh-=7X2AsN0RnSRKe+YA@mail.gmail.com>
	<717C2559-8EA7-45C6-9479-9C95FA437878@gopivotal.com>
	<CAGDK9bkcRDugpv0TSP9Gebi6FVN64FCv8MMDAyXo8gGyVzJt7Q@mail.gmail.com>
Message-ID: <3CE1D10F927704449D41EF6BCB35373D46CF22@hermes>

Hi,

Maybe your client can send a "close connection" through the HTTP API upon reconnecting. I'm not sure about the implementation details, but deleting a connection is supported through the management API: http://hg.rabbitmq.com/rabbitmq-management/raw-file/3646dee55e02/priv/www-api/help.html. Maybe one of the rabbit-gurus can confirm if this should work?

Regards,
Tobias

Fr?n: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] F?r L H, Wong
Skickat: den 4 november 2013 02:24
Till: Michael Klishin
Kopia: Discussions about RabbitMQ
?mne: Re: [rabbitmq-discuss] previous connection is NOT automatically closed if IP different

Hi Michael,
Thank you very much for the information. I am wondering why if IP for first and second connections are the same (in the scenarios in which the connection lost and resumed almost immediately via same network) the first connection gets closed almost immediately after the second connection was established.

Regards,
--Wong Liong Hung


On Sun, Nov 3, 2013 at 5:16 PM, Michael Klishin <mklishin at gopivotal.com<mailto:mklishin at gopivotal.com>> wrote:
On nov 2, 2013, at 5:39 PM, L H, Wong <lhwong at gmail.com<mailto:lhwong at gmail.com>> wrote:

> I am aware of the heartbeat setting. However, my application is running on mobile phone I afraid that if I set the value to lower value like 10s it will consume more battery power and also cause higher data usage.

This is an understandable concern but there are no other options.

I'd suggest using a value of 20 or so. This means a little bit of data (about a dozen of bytes)
will be sent roughly every 10 seconds. There will be no new threads created or significant
amounts of CPU consumed, so net impact on energy consumption and traffic
likely will be very small.
--
MK

Software Engineer, Pivotal/RabbitMQ


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/6248d663/attachment.htm>

From dipidi at gmail.com  Sun Nov  3 21:05:20 2013
From: dipidi at gmail.com (jondot)
Date: Sun, 3 Nov 2013 13:05:20 -0800 (PST)
Subject: [rabbitmq-discuss] [ANN] Sneakers - a performance-centric Ruby /
 RabbitMQ background processing framework
Message-ID: <c1a45161-ca81-4179-8c05-60a81839410e@googlegroups.com>

Hi all,

I'd like to make a first announcement for something I've been working - 
Sneakers.
You can check it out at 

http://sneakers.io

or have a read at the wiki https://github.com/jondot/sneakers/wiki
code is at https://github.com/jondot/sneakers



Since I already built a framework targeted at JRuby 
(https://github.com/jondot/frenzy_bunnies) that's rock solid at production 
for over a year now, this time the requirement was to create a simple, 
performant, framework that would work well on CRuby (the Ruby that we all 
know) that allows the use of gems with C-Extensions (unlike JRuby).

I've added a "why i built it" section at the 
wiki https://github.com/jondot/sneakers/wiki/Why-i-built-it which will 
provide the reasoning for a new framework, and how it's contrasted against 
existing frameworks.

All in all, I hope to get some developer feedback, ease of use and API 
feedback from you all.
As always I'm accepting pull requests happily :)



Today, Sneakers is run in production for 2 of my own projects doing 
Facebook-centric scraping/API calls, and at work doing real time event 
processing (which includes considerable I/O).

On a personal note, this was a project that should have ended in a couple 
of weekends but took around 2 month worth of weekends because I really 
wanted to simplify and streamline every bit, and more importantly because 
of some sad lessons life decided to teach me. Eventually, it is done, but 
before anything else I really am hoping to hear what you guys think.


Thanks,
Dotan, @jondot



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131103/54c33db5/attachment.htm>

From fercascue at gmail.com  Mon Nov  4 08:11:03 2013
From: fercascue at gmail.com (fercascue)
Date: Mon, 4 Nov 2013 00:11:03 -0800 (PST)
Subject: [rabbitmq-discuss] Send RabbitMQ message to port
In-Reply-To: <CANOx8N=i_huS9BMRmDhHtmgSp4QF3S5Wq9Uzz2jtn_W4oAHhEg@mail.gmail.com>
References: <1382729744945-30863.post@n5.nabble.com>
	<CANOx8N=i_huS9BMRmDhHtmgSp4QF3S5Wq9Uzz2jtn_W4oAHhEg@mail.gmail.com>
Message-ID: <1383552663088-31121.post@n5.nabble.com>

Dear Jerry,

Thanks for your comments. 
I would like, when a message arrives to RabbitMq's queue, RabbitMq send it
automatically to a specific port. I'm devloping a listener program, that is
listening to a port (TCP or UDP).

Example: A publisher send a message to RabbitMq queue and when it arrives,
rabbitMq send this message to a port (b.e: 5000). Once the message is sent,
my program could read this message from this specific port. 

I hope this explanation helps!
BR



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Send-RabbitMQ-message-to-port-tp30863p31121.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Nov  4 08:11:28 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 4 Nov 2013 12:11:28 +0400
Subject: [rabbitmq-discuss] previous connection is NOT automatically
	closed if IP different
In-Reply-To: <CAGDK9bkcRDugpv0TSP9Gebi6FVN64FCv8MMDAyXo8gGyVzJt7Q@mail.gmail.com>
References: <b9e02735-f1a5-4f37-a704-162ab8c79e36@googlegroups.com>
	<2A9CF47F-8C91-45B8-94C2-CF6798BA0D7E@rabbitmq.com>
	<CAGDK9b=RMVUQjkivcd1yxwe5b+xTw1Uh-=7X2AsN0RnSRKe+YA@mail.gmail.com>
	<717C2559-8EA7-45C6-9479-9C95FA437878@gopivotal.com>
	<CAGDK9bkcRDugpv0TSP9Gebi6FVN64FCv8MMDAyXo8gGyVzJt7Q@mail.gmail.com>
Message-ID: <720B658B-9351-4BD2-BD5C-3FF3ED3C5DCA@gopivotal.com>

On nov 4, 2013, at 5:24 AM, L H, Wong <lhwong at gmail.com> wrote:

> I am wondering why if IP for first and second connections are the same (in the scenarios in which the connection lost and resumed almost immediately via same network) the first connection gets closed almost immediately after the second connection was established.

I don?t have an immediate answer but IP connections are not identified by IP?s. They are
identified by a tuple of {protocol, client IP, client port, server IP, server port}.

Unless Android tries to be smart and reuse ports in their TCP/IP stack implementation,
client ports should be ephemeral (randomly taken from a pool of tens of thousands
available ports).

May I ask how you manage to reconnect from the same device on a different IP?
--
MK

Software Engineer, Pivotal/RabbitMQ

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/fab24d86/attachment.pgp>

From mklishin at gopivotal.com  Mon Nov  4 08:25:25 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 4 Nov 2013 12:25:25 +0400
Subject: [rabbitmq-discuss] Send RabbitMQ message to port
In-Reply-To: <1383552663088-31121.post@n5.nabble.com>
References: <1382729744945-30863.post@n5.nabble.com>
	<CANOx8N=i_huS9BMRmDhHtmgSp4QF3S5Wq9Uzz2jtn_W4oAHhEg@mail.gmail.com>
	<1383552663088-31121.post@n5.nabble.com>
Message-ID: <F6C2449E-518E-4CCC-B9E4-6982741832E4@rabbitmq.com>

On 4 Nov 2013, at 12:11, fercascue <fercascue at gmail.com> wrote:

> Thanks for your comments. 
> I would like, when a message arrives to RabbitMq's queue, RabbitMq send it
> automatically to a specific port. I'm devloping a listener program, that is
> listening to a port (TCP or UDP).
> 
> Example: A publisher send a message to RabbitMq queue and when it arrives,
> rabbitMq send this message to a port (b.e: 5000). Once the message is sent,
> my program could read this message from this specific port. 

You need to develop a consumer that does that. See
http://www.rabbitmq.com/getstarted.html to get started.

MK

Software Engineer, Pivotal/RabbitMQ



From lhwong at gmail.com  Mon Nov  4 09:56:19 2013
From: lhwong at gmail.com (L H, Wong )
Date: Mon, 4 Nov 2013 17:56:19 +0800
Subject: [rabbitmq-discuss] previous connection is NOT automatically
 closed if IP different
In-Reply-To: <720B658B-9351-4BD2-BD5C-3FF3ED3C5DCA@gopivotal.com>
References: <b9e02735-f1a5-4f37-a704-162ab8c79e36@googlegroups.com>
	<2A9CF47F-8C91-45B8-94C2-CF6798BA0D7E@rabbitmq.com>
	<CAGDK9b=RMVUQjkivcd1yxwe5b+xTw1Uh-=7X2AsN0RnSRKe+YA@mail.gmail.com>
	<717C2559-8EA7-45C6-9479-9C95FA437878@gopivotal.com>
	<CAGDK9bkcRDugpv0TSP9Gebi6FVN64FCv8MMDAyXo8gGyVzJt7Q@mail.gmail.com>
	<720B658B-9351-4BD2-BD5C-3FF3ED3C5DCA@gopivotal.com>
Message-ID: <CAGDK9bmZU2yQoDBLap-oCzvUV38Q-+qixAGSjKoEs1onFtSFSQ@mail.gmail.com>

I believe the port number shown on rabbitmq console (see below) is the
client port. This shows different IP and port is being used by the new
connection.

Consumers
Channel     Consumer tag     Ack required     Exclusive
210.19.225.88:36920 (1)     amq.ctag-ma8QOXnZ_UAK-
R7wddQGXA     ?     ?
210.19.225.3:60659 (1)     amq.ctag-igoa2WysTs79WAk969UFJg     ?     ?


I manage to reconnect from the same device on a different IP by
disconnecting from a Wifi router and connecting to another Wifi router. I
think this is a very common scenario including switching from 3G network to
Wifi network.

--Nick



On Mon, Nov 4, 2013 at 4:11 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On nov 4, 2013, at 5:24 AM, L H, Wong <lhwong at gmail.com> wrote:
>
> > I am wondering why if IP for first and second connections are the same
> (in the scenarios in which the connection lost and resumed almost
> immediately via same network) the first connection gets closed almost
> immediately after the second connection was established.
>
> I don?t have an immediate answer but IP connections are not identified by
> IP?s. They are
> identified by a tuple of {protocol, client IP, client port, server IP,
> server port}.
>
> Unless Android tries to be smart and reuse ports in their TCP/IP stack
> implementation,
> client ports should be ephemeral (randomly taken from a pool of tens of
> thousands
> available ports).
>
> May I ask how you manage to reconnect from the same device on a different
> IP?
> --
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/c3b791be/attachment.htm>

From emile at rabbitmq.com  Mon Nov  4 10:21:30 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 04 Nov 2013 10:21:30 +0000
Subject: [rabbitmq-discuss] Stomp, subscriptions, and forward slashes
In-Reply-To: <527576F9.5040108@seegrid.com>
References: <527576F9.5040108@seegrid.com>
Message-ID: <5277752A.5000307@rabbitmq.com>


On 02/11/13 22:04, Brennan Sellner wrote:

> Is there any way to escape the slash in the exchange name when
> subscribing via web-stomp?  I've blindly tried a few options (i.e. '\\/'
> or '%47'),


You can use %2F as an escaped forward-slash character in STOMP.



-Emile



From mklishin at gopivotal.com  Mon Nov  4 10:22:02 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 4 Nov 2013 14:22:02 +0400
Subject: [rabbitmq-discuss] previous connection is NOT automatically
	closed if IP different
In-Reply-To: <CAGDK9bmZU2yQoDBLap-oCzvUV38Q-+qixAGSjKoEs1onFtSFSQ@mail.gmail.com>
References: <b9e02735-f1a5-4f37-a704-162ab8c79e36@googlegroups.com>
	<2A9CF47F-8C91-45B8-94C2-CF6798BA0D7E@rabbitmq.com>
	<CAGDK9b=RMVUQjkivcd1yxwe5b+xTw1Uh-=7X2AsN0RnSRKe+YA@mail.gmail.com>
	<717C2559-8EA7-45C6-9479-9C95FA437878@gopivotal.com>
	<CAGDK9bkcRDugpv0TSP9Gebi6FVN64FCv8MMDAyXo8gGyVzJt7Q@mail.gmail.com>
	<720B658B-9351-4BD2-BD5C-3FF3ED3C5DCA@gopivotal.com>
	<CAGDK9bmZU2yQoDBLap-oCzvUV38Q-+qixAGSjKoEs1onFtSFSQ@mail.gmail.com>
Message-ID: <1D34FBD7-46AA-4E55-A5F6-2214CC84413F@gopivotal.com>

On 4 Nov 2013, at 13:56, L H, Wong <lhwong at gmail.com> wrote:

> I manage to reconnect from the same device on a different IP by disconnecting from a Wifi router and connecting to another Wifi router. I think this is a very common scenario including switching from 3G network to Wifi network.  

OK.

Then the reason may be that when you switch the active network interface, the kernel forces
(what it considers to be) open TCP connection on the previously active interface to terminate
properly [1], while without NIC switching it will wait and try to retransmit first, before timing out.

Please try measuring how much effect does using lower heartbeat timeouts have on energy use
and see what?s the right balance of timeout period vs energy use is for your app.
Reporting your findings to the list for other Android users may be a good idea, too ;)

1. http://www.tcpipguide.com/free/t_TCPConnectionTermination-2.htm
--
MK

Software Engineer, Pivotal/RabbitMQ



From 314992959 at qq.com  Mon Nov  4 10:41:18 2013
From: 314992959 at qq.com (3k4b251)
Date: Mon, 4 Nov 2013 02:41:18 -0800 (PST)
Subject: [rabbitmq-discuss] =?utf-8?q?rabbitmq-c=2C__how__to__use___x-mess?=
	=?utf-8?q?age-ttl___=EF=BC=9F?=
Message-ID: <1383561678435-31127.post@n5.nabble.com>

can  someone  give  me  a  example ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-to-use-x-message-ttl-tp31127.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From emile at rabbitmq.com  Mon Nov  4 10:41:37 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 04 Nov 2013 10:41:37 +0000
Subject: [rabbitmq-discuss] Unable to access management portal after
 upgarding erlang and RabbitMQ
In-Reply-To: <1383537847745-31118.post@n5.nabble.com>
References: <2dc98c94.000002d4.0000000b@KAPILPC.vmware.com>
	<52172BFC.2080705@rabbitmq.com>
	<1382850984653-30885.post@n5.nabble.com>
	<1383537847745-31118.post@n5.nabble.com>
Message-ID: <527779E1.3010001@rabbitmq.com>

On 04/11/13 04:04, carlhoerberg wrote:
> The Elliptic Curve Cipher implementation in R16B1 and R16B2 is broken: 
> http://osdir.com/ml/erlang-programming-bugs/2013-10/msg00004.html

That conclusion has been challenged. See the rest of the thread that
follows.



-Emile











From mklishin at gopivotal.com  Mon Nov  4 10:47:33 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 4 Nov 2013 14:47:33 +0400
Subject: [rabbitmq-discuss]
 =?utf-8?q?rabbitmq-c=2C__how__to__use___x-mess?=
 =?utf-8?q?age-ttl___=EF=BC=9F?=
In-Reply-To: <1383561678435-31127.post@n5.nabble.com>
References: <1383561678435-31127.post@n5.nabble.com>
Message-ID: <CD33E61E-10B0-463B-A2A4-03EE0CBBB343@rabbitmq.com>

On 4 Nov 2013, at 14:41, 3k4b251 <314992959 at qq.com> wrote:

> can  someone  give  me  a  example ?

You need to construct an extra arguments table and pass it instead of
amqp_empty_table, like here:
https://github.com/alanxz/rabbitmq-c/blob/master/examples/amqp_consumer.c#L186

https://github.com/alanxz/rabbitmq-c/blob/master/tests/test_tables.c provides
examples of how attribute tables are constructed in rabbitmq-c.

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Mon Nov  4 11:26:52 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Nov 2013 11:26:52 +0000
Subject: [rabbitmq-discuss] Rabbit Cluster "hangs" on consumer
	disconnects
In-Reply-To: <0B8CD6850421B745BE39BC5C76019232A683F5F6@DDCEP50016.na.corp.mckesson.com>
References: <0B8CD6850421B745BE39BC5C76019232A683F5F6@DDCEP50016.na.corp.mckesson.com>
Message-ID: <5277847C.4010205@rabbitmq.com>

On 01/11/2013 5:45PM, Cordell, Ron wrote:
>             ** Reason for termination ==
>             ** {{shutdown,
>                      {gen_server,call,
>                          [rabbit_auth_backend_ldap,
>                           {check_resource,
>                               [{username,<<"SJINRMQVORTEXWRITE">>},
>                                {user_dn,
>                                    "CN=SJINRMQ
>             VORTEXWRITE,OU=INRMQ,OU=INTEGRATION,OU=Environments,OU=Servers,DC=RHB,DC=AD"},
>                                {vhost,<<"vortex">>},
>                                {resource,exchange},

So that looks like a bug in the LDAP plugin (the plugin itself shuts 
down before the channels which depend on it). We'll get that fixed, but 
I doubt it's causing the problems you're seeing.

> I?ve verified that the application code is shutting down connections
> cleanly. We also don?t see this behavior with the same application in
> environments where no rabbit cluster is setup, just a single instance.
> This appears to be something that happens to Rabbit itself ? the Erlang
> portion of things seems to be working OK.
>
> I?m attempting to replicate this behavior in other environments so I can
> try to isolate it but haven?t had a chance to do so thus far, but it
> does happen in every environment where we have a rabbit cluster.

What happens if you attempt to shut down the service by issuing 
"rabbitmqctl stop" rather than stopping the Windows service?

Also, we fixed several bugs that could cause deadlocks during shutdown 
in 3.2.0, so it might be worth trying an upgrade.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From 314992959 at qq.com  Mon Nov  4 11:34:31 2013
From: 314992959 at qq.com (3k4b251)
Date: Mon, 4 Nov 2013 03:34:31 -0800 (PST)
Subject: [rabbitmq-discuss]
	=?utf-8?q?rabbitmq-c=2C__how__to__use___x-mess?=
	=?utf-8?q?age-ttl___=EF=BC=9F?=
In-Reply-To: <CD33E61E-10B0-463B-A2A4-03EE0CBBB343@rabbitmq.com>
References: <1383561678435-31127.post@n5.nabble.com>
	<CD33E61E-10B0-463B-A2A4-03EE0CBBB343@rabbitmq.com>
Message-ID: <1383564871475-31131.post@n5.nabble.com>

  It's  seems  a  little difficult to  understand  the example.   I  try to 
set   amqp_table_t    to     amqp_queue_declare().   But  it  didn't work .   
   I  try  to do  like  this.
  amqp_table_t  table;
  amqp_table_entry_t  entry;
  entry.key = amqp_cstring_bytes("x-message-ttl");
  entry.value.kind = AMQP_FIELD_KIND_UTF8;    PS:  I  don't  know  how  to
choose.
  entry.value.value.                        PS:   I  don't  know  how  to 
fill  it.

  table.num_entries =1;
  table.entries = &entry;
  

  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-to-use-x-message-ttl-tp31127p31131.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Mon Nov  4 11:53:42 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 4 Nov 2013 15:53:42 +0400
Subject: [rabbitmq-discuss]
 =?utf-8?q?rabbitmq-c=2C__how__to__use___x-mess?=
 =?utf-8?q?age-ttl___=EF=BC=9F?=
In-Reply-To: <1383564871475-31131.post@n5.nabble.com>
References: <1383561678435-31127.post@n5.nabble.com>
	<CD33E61E-10B0-463B-A2A4-03EE0CBBB343@rabbitmq.com>
	<1383564871475-31131.post@n5.nabble.com>
Message-ID: <35F67396-DCE8-4896-8675-EEFE1C21E73A@rabbitmq.com>

On 4 Nov 2013, at 15:34, 3k4b251 <314992959 at qq.com> wrote:

>  entry.value.kind = AMQP_FIELD_KIND_UTF8;    PS:  I  don't  know  how  to
> choose.

It should be a numerical type, likely AMQP_FIELD_KIND_I64 (signed 64 bit integer)
or AMQP_FIELD_KIND_U32 (unsigned 32 bit integer).

>  entry.value.value.                        PS:   I  don't  know  how  to 
> fill  it.

This should be the x-message-ttl value you want, in milliseconds (and it cannot be 0).

MK

Software Engineer, Pivotal/RabbitMQ



From michael.thorsoe at schneider-electric.com  Mon Nov  4 11:57:53 2013
From: michael.thorsoe at schneider-electric.com (michael.thorsoe at schneider-electric.com)
Date: Mon, 4 Nov 2013 12:57:53 +0100
Subject: [rabbitmq-discuss] C# client connect using SSL
Message-ID: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>

Hi,

Is it possible to connect to a server by just setting the Ssl.Enabled = 
true and not have to install any certificates on the windows client?

Using the Java client, this works, but on the C# client the connection 
isn't established.

Br,
Michael Thorsoe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/cab906f0/attachment.htm>

From fercascue at gmail.com  Mon Nov  4 11:58:26 2013
From: fercascue at gmail.com (fercascue)
Date: Mon, 4 Nov 2013 03:58:26 -0800 (PST)
Subject: [rabbitmq-discuss] Error connecting Stomp Plugin
Message-ID: <1383566306606-31133.post@n5.nabble.com>

Dear all, 

I am experimenting some issues when I try to connect to Stomp plugin. 
I launch a telnet command like this " *telnet localhost 61613*" with this
output:
root at debian64:/var/log/rabbitmq# telnet localhost 61613
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.

But nothing more happens. 
I'm using RabbitMQ 3.1.5 and Erlang R14A.
What is going wrong?

BR.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Error-connecting-Stomp-Plugin-tp31133.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Adam.Ainsworth at TraderMedia.co.uk  Mon Nov  4 12:08:45 2013
From: Adam.Ainsworth at TraderMedia.co.uk (Adam Ainsworth)
Date: Mon, 4 Nov 2013 12:08:45 +0000
Subject: [rabbitmq-discuss] Clean shutdown of a consumer with prefetch
Message-ID: <0FA4957F9E2EB4498102DF92F5BC471701647787C36D@TMG-E2K7CCR1.group.tradermedia.co.uk>

We have Java RabbitMQ consumers with a large prefetch size for performance. When we close down the consumers the messages in the prefetch buffer on the consumer are marked as redelivered.  We do slow additional checks on redelivered messages to avoid duplicates, so this is a significant performance hit at a time when we have one less consumer than normal.

Is it possible to empty the prefetch buffer when we are closing down to avoid this?

Thanks,

Adam

________________________________________


This e-mail is sent on behalf of Trader Media Group Limited, Registered Office: Auto Trader House, Cutbush Park Industrial Estate, Danehill, Lower Earley, Reading, Berkshire, RG6 4UT(Registered in England No. 4768833). This email and any files transmitted with it are confidential and may be legally privileged, and intended solely for the use of the individual or entity to whom they are addressed. If you have received this email in error please notify the sender. This email message has been swept for the presence of computer viruses. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/18b4156b/attachment.htm>

From mklishin at gopivotal.com  Mon Nov  4 12:09:56 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 4 Nov 2013 16:09:56 +0400
Subject: [rabbitmq-discuss] Error connecting Stomp Plugin
In-Reply-To: <1383566306606-31133.post@n5.nabble.com>
References: <1383566306606-31133.post@n5.nabble.com>
Message-ID: <69B50C1E-4F03-446E-8487-2F8B11F092B9@rabbitmq.com>


On 4 Nov 2013, at 15:58, fercascue <fercascue at gmail.com> wrote:

> root at debian64:/var/log/rabbitmq# telnet localhost 61613
> Trying 127.0.0.1...
> Connected to localhost.

See Testing the Adapter on https://www.rabbitmq.com/stomp.html.

Until you use TLS, you need to CONNECT before you get any replies.

MK

Software Engineer, Pivotal/RabbitMQ



From emile at rabbitmq.com  Mon Nov  4 12:13:42 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 04 Nov 2013 12:13:42 +0000
Subject: [rabbitmq-discuss] Error connecting Stomp Plugin
In-Reply-To: <1383566306606-31133.post@n5.nabble.com>
References: <1383566306606-31133.post@n5.nabble.com>
Message-ID: <52778F76.3040509@rabbitmq.com>


Hi,

On 04/11/13 11:58, fercascue wrote:

> root at debian64:/var/log/rabbitmq# telnet localhost 61613
> Trying 127.0.0.1...
> Connected to localhost.
> Escape character is '^]'.
> 
> But nothing more happens. 
> I'm using RabbitMQ 3.1.5 and Erlang R14A.
> What is going wrong?


There is no evidence of an error in your transcript. The server is
expecting a CONNECT frame from the client. See the specification of the
STOMPM version that you intend to use when communicating with the broker:


http://stomp.github.io/stomp-specification-1.0.html
http://stomp.github.io/stomp-specification-1.1.html
http://stomp.github.io/stomp-specification-1.2.html





-Emile





From mklishin at gopivotal.com  Mon Nov  4 12:16:34 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 4 Nov 2013 16:16:34 +0400
Subject: [rabbitmq-discuss] Clean shutdown of a consumer with prefetch
In-Reply-To: <0FA4957F9E2EB4498102DF92F5BC471701647787C36D@TMG-E2K7CCR1.group.tradermedia.co.uk>
References: <0FA4957F9E2EB4498102DF92F5BC471701647787C36D@TMG-E2K7CCR1.group.tradermedia.co.uk>
Message-ID: <BB6B73CC-06B0-42C2-B493-6F53D535ED54@rabbitmq.com>

On 4 Nov 2013, at 16:08, Adam Ainsworth <Adam.Ainsworth at TraderMedia.co.uk> wrote:

> Is it possible to empty the prefetch buffer when we are closing down to avoid this?

I?m afraid not. Even if cancel your consumer first, there still may be in flight messages
that were delivered but not acked.

I assume ?shutdown? here means app shutdown or similar, by the way.

MK

Software Engineer, Pivotal/RabbitMQ



From matthias at rabbitmq.com  Mon Nov  4 12:33:48 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 04 Nov 2013 12:33:48 +0000
Subject: [rabbitmq-discuss] Clean shutdown of a consumer with prefetch
In-Reply-To: <BB6B73CC-06B0-42C2-B493-6F53D535ED54@rabbitmq.com>
References: <0FA4957F9E2EB4498102DF92F5BC471701647787C36D@TMG-E2K7CCR1.group.tradermedia.co.uk>
	<BB6B73CC-06B0-42C2-B493-6F53D535ED54@rabbitmq.com>
Message-ID: <5277942C.9050807@rabbitmq.com>

On 04/11/13 12:16, Michael Klishin wrote:
> On 4 Nov 2013, at 16:08, Adam Ainsworth <Adam.Ainsworth at TraderMedia.co.uk> wrote:
>
>> Is it possible to empty the prefetch buffer when we are closing down to avoid this?
>
> I?m afraid not. Even if cancel your consumer first, there still may be in flight messages
> that were delivered but not acked.

Ah, but you are guaranteed not to get any more messages for a consumer 
after the basic.cancel_ok.

So to get an app to shut down without marking any messages as redelivered...

1) cancel the consumer,
2) continue processing messages
3) when basic.cancel_ok arrives, terminate the connection/channel.

Now, in most AMQP APIs, 3) is the result of 1) and both happen on a 
separate thread to 2), so some extra inter-thread signalling may be 
required.

Matthias.

From mklishin at gopivotal.com  Mon Nov  4 12:37:29 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 4 Nov 2013 16:37:29 +0400
Subject: [rabbitmq-discuss] Clean shutdown of a consumer with prefetch
In-Reply-To: <5277942C.9050807@rabbitmq.com>
References: <0FA4957F9E2EB4498102DF92F5BC471701647787C36D@TMG-E2K7CCR1.group.tradermedia.co.uk>
	<BB6B73CC-06B0-42C2-B493-6F53D535ED54@rabbitmq.com>
	<5277942C.9050807@rabbitmq.com>
Message-ID: <550DE783-3DF0-4FBA-81AE-E82004DAD4D7@rabbitmq.com>

On 4 Nov 2013, at 16:33, Matthias Radestock <matthias at rabbitmq.com> wrote:

> Now, in most AMQP APIs, 3) is the result of 1) and both happen on a separate thread to 2), so some extra inter-thread signalling may be required.

Plus you need to have an indicator that ?all messages were processed? which is a may be tricky
if delivery flow may stop for some time or fluctuate widely.

MK

Software Engineer, Pivotal/RabbitMQ



From emile at rabbitmq.com  Mon Nov  4 12:38:33 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 04 Nov 2013 12:38:33 +0000
Subject: [rabbitmq-discuss] C# client connect using SSL
In-Reply-To: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>
References: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>
Message-ID: <52779549.2070002@rabbitmq.com>


Hi Michael,

On 04/11/13 11:57, michael.thorsoe at schneider-electric.com wrote:

> Is it possible to connect to a server by just setting the Ssl.Enabled =
> trueand not have to install any certificates on the windows client?


I believe you have to follow all the instructions here:
http://www.rabbitmq.com/ssl.html#configuring-dotnet




-Emile




From simon at rabbitmq.com  Mon Nov  4 12:51:48 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Nov 2013 12:51:48 +0000
Subject: [rabbitmq-discuss]
 =?utf-8?q?rabbitmq-c=2C__how__to__use___x-mess?=
 =?utf-8?q?age-ttl___=EF=BC=9F?=
In-Reply-To: <35F67396-DCE8-4896-8675-EEFE1C21E73A@rabbitmq.com>
References: <1383561678435-31127.post@n5.nabble.com>
	<CD33E61E-10B0-463B-A2A4-03EE0CBBB343@rabbitmq.com>
	<1383564871475-31131.post@n5.nabble.com>
	<35F67396-DCE8-4896-8675-EEFE1C21E73A@rabbitmq.com>
Message-ID: <52779864.9080403@rabbitmq.com>

On 04/11/2013 11:53AM, Michael Klishin wrote:
> This should be the x-message-ttl value you want, in milliseconds (and
> it cannot be 0).

Err, it can be 0. It can't be negative.

Cheers, Simon



-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Nov  4 14:05:23 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Nov 2013 14:05:23 +0000
Subject: [rabbitmq-discuss] Feature Req / Bug list
In-Reply-To: <CAJ4uuZbc13rs9SCmU64K9ant630Z+1j1x-Ss2MRBh7fQnnEXdA@mail.gmail.com>
References: <CAJ4uuZZnWrC9tp9V+D021AvPDHDKzfXGChvG+OPgD8E8W-tYMw@mail.gmail.com>
	<526A49E0.3010707@rabbitmq.com>
	<CAJ4uuZbqiokizs4FoGLESS+PDra8JcTKW=6FrxTmpJeg_YumVA@mail.gmail.com>
	<61705EBA-366B-4B77-BBFE-D7B2E14F3E5A@rabbitmq.com>
	<CAJ4uuZb+bgZGRubJ9pAXH2ZMwyxagJ5mTnk3T8xhhEWm_W_L9w@mail.gmail.com>
	<AEADD6B5-832E-4BB0-9312-47EA927F9F0B@rabbitmq.com>
	<CAJ4uuZYpt5-7bd0SnsqNQCb+W0WAcj5WrH9OxWn6-VfGQoLK8w@mail.gmail.com>
	<92E1A6B8-E4D1-47C5-A108-9E254EC2EF9D@rabbitmq.com>
	<CAJ4uuZYNy3kyCtm1sWbRdaprWkOQ4O8KMhBNFwxafg6zbMSX3g@mail.gmail.com>
	<F573E81A-8BD2-4F9A-8643-ABB67E97773E@rabbitmq.com>
	<CAJ4uuZYUqGeBRVEbacpGPeyHxFP2S9F7PND8KPQakjMg9Whgrg@mail.gmail.com>
	<526ECAD9.2030703@rabbitmq.com>
	<CAJ4uuZYmom2AjYrsYOVxDNfkuK4VVhqoEyFqG5c7f+th-Xdx5w@mail.gmail.com>
	<526ED167.1010308@rabbitmq.com>
	<CAJ4uuZb1kd8dQ1c3=o-mzHvYzUNrHcwUxFU8VvEOurUG7EFtfQ@mail.gmail.com>
	<CAJ4uuZbc13rs9SCmU64K9ant630Z+1j1x-Ss2MRBh7fQnnEXdA@mail.gmail.com>
Message-ID: <5277A9A3.3060708@rabbitmq.com>

On 29/10/2013 12:06AM, Graeme N wrote:
> These errors are all really strange, and so I'm hoping you guys can
> reproduce them, and best case scenario, find something that accounts for
> these problems which we can then patch in our production environment.

We haven't been able to recreate your most recent issues - but it's 
possible that they're all copies of the same underlying problem as the 
first lot you reported (which are now fixed).

So would you be able to have another go, with a recent nightly build?

http://www.rabbitmq.com/nightly-builds.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.thorsoe at schneider-electric.com  Mon Nov  4 14:29:02 2013
From: michael.thorsoe at schneider-electric.com (michael.thorsoe at schneider-electric.com)
Date: Mon, 4 Nov 2013 15:29:02 +0100
Subject: [rabbitmq-discuss] C# client connect using SSL
In-Reply-To: <52779549.2070002@rabbitmq.com>
References: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>
	<52779549.2070002@rabbitmq.com>
Message-ID: <OFB7820455.7EA078F2-ONC1257C19.004DD523-C1257C19.004F9031@schneider-electric.com>

I tried the instruction page you suggested but it's still not clear to me.

I just want to do the SSL connection and trust the server certificate 
without having to do any additional certificate installation on the 
clients side. Is that possible?

We have the server running SSL and some java clients connecting using SSL 
just by setting the  useSslProtocol() in the Java client.

Thereby I can see the server is installed correctly and accepting Java SSL 
clients to connect.

On the instruction page it states that:
"In contrast to the Java client, which is happy to use an SSL connection 
without verifying the server's certificate, the .NET client by default 
requires this verification to succeed. To suppress verification, an 
application can set the 
System.Net.Security.SslPolicyErrors.RemoteCertificateNotAvailable and 
System.Net.Security.SslPolicyErrors.RemoteCertificateChainErrors flags in 
SslOption.AcceptablePolicyErrors "

But when I do like this
ConnectionFactory cf = new ConnectionFactory();
cf.Ssl.Enabled = true;
cf.Ssl.AcceptablePolicyErrors = 
System.Net.Security.SslPolicyErrors.RemoteCertificateNotAvailable | 
System.Net.Security.SslPolicyErrors.RemoteCertificateNameMismatch;

I'm still not able to connect!


Br,
Michael Thorsoe
Br,
Michael Thorsoe



From:   Emile Joubert <emile at rabbitmq.com>
To:     Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>, 
Cc:     Michael Thorsoe/DK/Schneider at Europe
Date:   04-11-2013 13:38
Subject:        Re: [rabbitmq-discuss] C# client connect using SSL




Hi Michael,

On 04/11/13 11:57, michael.thorsoe at schneider-electric.com wrote:

> Is it possible to connect to a server by just setting the Ssl.Enabled =
> trueand not have to install any certificates on the windows client?


I believe you have to follow all the instructions here:
http://www.rabbitmq.com/ssl.html#configuring-dotnet




-Emile




______________________________________________________________________
This email has been scanned by the Symantec Email Security.cloud service.
______________________________________________________________________

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/7663cc60/attachment.htm>

From manojbardhan64 at gmail.com  Mon Nov  4 11:50:13 2013
From: manojbardhan64 at gmail.com (Manoj Kumar Bardhan)
Date: Mon, 4 Nov 2013 03:50:13 -0800 (PST)
Subject: [rabbitmq-discuss] Fail to start RabbitMQ
Message-ID: <042e3922-5b8b-4694-99fd-4dd1d304e931@googlegroups.com>

Hi All,


I am getting the below error when I am trying to apply rabbitmqctl 
start_app  command.




{error_logger,{{2013,11,4},{11,26,8}},"Cookie file 
/ngs/app/curot/.erlang.cookie must be accessible by owner only",[]}
{error_logger,{{2013,11,4},{11,26,8}},crash_report,[[{initial_call,{auth,init,['Argument__1']}},{pid,<0.18.0>},{registered_name,[]},{error_info,{exit,{"Cookie 
file /ngs/app/curot/.erlang.cookie must be accessible by owner 
only",[{auth,init_cookie,0,[{file,"auth.erl"},{line,285}]},{auth,init,1,[{file,"auth.erl"},{line,139}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,297}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]},[{gen_server,init_it,6,[{file,"gen_server.erl"},{line,321}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{ancestors,[net_sup,kernel_sup,<0.9.0>]},{messages,[]},{links,[<0.16.0>]},{dictionary,[]},{trap_exit,true},{status,running},{heap_size,610},{stack_size,24},{reductions,401}],[]]}
{error_logger,{{2013,11,4},{11,26,8}},supervisor_report,[{supervisor,{local,net_sup}},{errorContext,start_error},{reason,{"Cookie 
file /ngs/app/curot/.erlang.cookie must be accessible by owner 
only",[{auth,init_cookie,0,[{file,"auth.erl"},{line,285}]},{auth,init,1,[{file,"auth.erl"},{line,139}]},{gen_server,init_it,6,[{file,"gen_server.erl"},{line,297}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]}},{offender,[{pid,undefined},{name,auth},{mfargs,{auth,start_link,[]}},{restart_type,permanent},{shutdown,2000},{child_type,worker}]}]}
{error_logger,{{2013,11,4},{11,26,8}},supervisor_report,[{supervisor,{local,kernel_sup}},{errorContext,start_error},{reason,shutdown},{offender,[{pid,undefined},{name,net_sup},{mfargs,{erl_distribution,start_link,[]}},{restart_type,permanent},{shutdown,infinity},{child_type,supervisor}]}]}
{error_logger,{{2013,11,4},{11,26,8}},std_info,[{application,kernel},{exited,{shutdown,{kernel,start,[normal,[]]}}},{type,permanent}]}
{"Kernel pid 
terminated",application_controller,"{application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}}"}

Crash dump was written to: erl_crash.dump
Kernel pid terminated (application_controller) 
({application_start_failure,kernel,{shutdown,{kernel,start,[normal,[]]}}})


In my machine Erlang is running.

Please help me. 
Awaiting for the response.



Thanks in Advance.
Manoj


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/f4e89d6d/attachment.htm>

From jeremy at fluxlabs.net  Mon Nov  4 14:42:36 2013
From: jeremy at fluxlabs.net (Jeremy McSpadden)
Date: Mon, 4 Nov 2013 14:42:36 +0000
Subject: [rabbitmq-discuss] Fail to start RabbitMQ
In-Reply-To: <042e3922-5b8b-4694-99fd-4dd1d304e931@googlegroups.com>
References: <042e3922-5b8b-4694-99fd-4dd1d304e931@googlegroups.com>
Message-ID: <FA81058A-376D-4185-B8A7-3869E15E61FE@fluxlabs.net>



--
Jeremy McSpadden
Flux Labs, Inc | http://www.fluxlabs.net<http://www.fluxlabs.net/> | Endless Solutions
Office : 850-250-5590x101<tel:850-250-5590;101> | Cell : 850-890-2543<tel:850-890-2543> | Fax : 850-254-2955<tel:850-254-2955>

On Nov 4, 2013, at 8:41 AM, "Manoj Kumar Bardhan" <manojbardhan64 at gmail.com<mailto:manojbardhan64 at gmail.com>> wrote:

{error_logger,{{2013,11,4},{11,26,8}},"Cookie file /ngs/app/curot/.erlang.cookie must be accessible by owner only",[]}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/1fb7b116/attachment.htm>

From mklishin at gopivotal.com  Mon Nov  4 14:46:17 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 4 Nov 2013 18:46:17 +0400
Subject: [rabbitmq-discuss] Fail to start RabbitMQ
In-Reply-To: <042e3922-5b8b-4694-99fd-4dd1d304e931@googlegroups.com>
References: <042e3922-5b8b-4694-99fd-4dd1d304e931@googlegroups.com>
Message-ID: <CAD723B7-19A9-4409-A5D8-A62A76D87B0C@rabbitmq.com>

On 4 Nov 2013, at 15:50, Manoj Kumar Bardhan <manojbardhan64 at gmail.com> wrote:

> {error_logger,{{2013,11,4},{11,26,8}},"Cookie file /ngs/app/curot/.erlang.cookie must be accessible by owner only",[]}

chmod 0600 /ngs/app/curot/.erlang.cookie

MK

Software Engineer, Pivotal/RabbitMQ



From harry.marr at gmail.com  Mon Nov  4 16:00:13 2013
From: harry.marr at gmail.com (Harry Marr)
Date: Mon, 4 Nov 2013 16:00:13 +0000
Subject: [rabbitmq-discuss] ANN Hutch v0.6.0 is out
Message-ID: <CAONrK97mx9tZh+YsmniU5OPV_xHGiyQZ1whw7BkvCdxw=MzOTg@mail.gmail.com>

Hutch version 0.6.0 has been released [1].

This is a minor feature release. For details, see the changelog [2].

[1] https://rubygems.org/gems/hutch/versions/0.6.0
[2] https://github.com/gocardless/hutch/blob/master/CHANGELOG.md

-- 

* Harry Marr*

https://twitter.com/harrymarr
https://github.com/hmarr
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/3f87f329/attachment.htm>

From murugesan at elementum.com  Mon Nov  4 06:22:42 2013
From: murugesan at elementum.com (Murugesan Guruswamy)
Date: Sun, 3 Nov 2013 22:22:42 -0800 (PST)
Subject: [rabbitmq-discuss] consuming a message from exchange does not seem
 to work on java client (3.2.0 as well as 3.1.5)
Message-ID: <b48a420a-057b-4f1e-b0bc-590693564301@googlegroups.com>

Hi,

I am trying to experiment exchanges and publishing it to an exchange using 
following code:

Connection conn = factory.newConnection(addr);

Channel channel = conn.createChannel();

channel.exchangeDeclare(exchangeName, topicName, true); // durable. topic 
is "direct" and "topic" and have tried both

                channel.basicPublish(exchangeName, routingKey, null, 
msg.getBytes());


consumer code: (Tried both Queueing Consumer and my own Consumer imll).

Channel channel = conn.createChannel(); 

channel.exchangeDeclare(exchangeName, topicName, true);

channel.queueDeclare(queueName, true, false, false, null);

channel.queueBind(queueName, exchangeName, routingKey);

QueueingConsumer qCon = new QueueingConsumer(channel);

 channel.basicConsume(queueName, false, qCon);

while (true) {

Delivery delivery = qCon.nextDelivery();

System.out.println("[x] " + new String(delivery.getBody()) + " " + 
delivery.getEnvelope().getRoutingKey());

 qCon.getChannel().basicAck(delivery.getEnvelope().getDeliveryTag(), false);

}

Routing key : "test.abc", queueName : Notification, exchangeName : 
localExchange.

Is there any rabbitmq-server configurations to do?

Please help here.

Thanks,
Murugesan




-- 
 

Legal Disclaimer: The information contained in this message may be 
privileged and confidential. It is intended to be read only by the 
individual or entity to whom it is addressed or by their designee. If the 
reader of this message is not the intended recipient, you are on notice 
that any distribution of this message, in any form, is strictly prohibited. 
If you have received this message in error, please immediately notify the 
sender and delete or destroy any copy of this message 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131103/10f8cbff/attachment.htm>

From mklishin at gopivotal.com  Mon Nov  4 16:12:13 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 4 Nov 2013 20:12:13 +0400
Subject: [rabbitmq-discuss] consuming a message from exchange does not
	seem to work on java client (3.2.0 as well as 3.1.5)
In-Reply-To: <b48a420a-057b-4f1e-b0bc-590693564301@googlegroups.com>
References: <b48a420a-057b-4f1e-b0bc-590693564301@googlegroups.com>
Message-ID: <262B0205-7F2B-4926-923A-89E362A410EA@rabbitmq.com>


On 4 Nov 2013, at 10:22, Murugesan Guruswamy <murugesan at elementum.com> wrote:

> Routing key : "test.abc", queueName : Notification, exchangeName : localExchange.
> 
> Is there any rabbitmq-server configurations to do?

Direct and topic exchange route message based on routing key of the message.
Your example does not show if the key used in queue.bind matches the one used in basic.publish
but it?s very likely to be the issue.

Also, you do not consume messages from exchanges.

See tutorials 3-5 for more info http://www.rabbitmq.com/getstarted.html
and http://www.rabbitmq.com/tutorials/amqp-concepts.html.

Use RabbitMQ management UI to see bindings, message rates and more:
http://www.rabbitmq.com/management.html

MK

Software Engineer, Pivotal/RabbitMQ



From videlalvaro at gmail.com  Mon Nov  4 16:13:29 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 4 Nov 2013 17:13:29 +0100
Subject: [rabbitmq-discuss] consuming a message from exchange does not
 seem to work on java client (3.2.0 as well as 3.1.5)
In-Reply-To: <b48a420a-057b-4f1e-b0bc-590693564301@googlegroups.com>
References: <b48a420a-057b-4f1e-b0bc-590693564301@googlegroups.com>
Message-ID: <CAMcAHLUVxFXobqPTJ7hU0sLB9gbG6HcyLUZLpHTp4mDNXJkDow@mail.gmail.com>

Is the routing key used when publishing the same as the binding key?


On Mon, Nov 4, 2013 at 7:22 AM, Murugesan Guruswamy <murugesan at elementum.com
> wrote:

> Hi,
>
> I am trying to experiment exchanges and publishing it to an exchange using
> following code:
>
> Connection conn = factory.newConnection(addr);
>
> Channel channel = conn.createChannel();
>
> channel.exchangeDeclare(exchangeName, topicName, true); // durable. topic
> is "direct" and "topic" and have tried both
>
>                 channel.basicPublish(exchangeName, routingKey, null,
> msg.getBytes());
>
>
> consumer code: (Tried both Queueing Consumer and my own Consumer imll).
>
> Channel channel = conn.createChannel();
>
> channel.exchangeDeclare(exchangeName, topicName, true);
>
> channel.queueDeclare(queueName, true, false, false, null);
>
> channel.queueBind(queueName, exchangeName, routingKey);
>
> QueueingConsumer qCon = new QueueingConsumer(channel);
>
>  channel.basicConsume(queueName, false, qCon);
>
> while (true) {
>
> Delivery delivery = qCon.nextDelivery();
>
> System.out.println("[x] " + new String(delivery.getBody()) + " " +
> delivery.getEnvelope().getRoutingKey());
>
>  qCon.getChannel().basicAck(delivery.getEnvelope().getDeliveryTag(), false
> );
>
> }
>
> Routing key : "test.abc", queueName : Notification, exchangeName :
> localExchange.
>
> Is there any rabbitmq-server configurations to do?
>
> Please help here.
>
> Thanks,
> Murugesan
>
>
>
>
> Legal Disclaimer: The information contained in this message may be
> privileged and confidential. It is intended to be read only by the
> individual or entity to whom it is addressed or by their designee. If the
> reader of this message is not the intended recipient, you are on notice
> that any distribution of this message, in any form, is strictly prohibited.
> If you have received this message in error, please immediately notify the
> sender and delete or destroy any copy of this message
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/45cbfc57/attachment.htm>

From murugesan at elementum.com  Mon Nov  4 16:41:07 2013
From: murugesan at elementum.com (Murugesan Guruswamy)
Date: Mon, 4 Nov 2013 08:41:07 -0800
Subject: [rabbitmq-discuss] consuming a message from exchange does not
	seem to work on java client (3.2.0 as well as 3.1.5)
In-Reply-To: <262B0205-7F2B-4926-923A-89E362A410EA@rabbitmq.com>
References: <b48a420a-057b-4f1e-b0bc-590693564301@googlegroups.com>
	<262B0205-7F2B-4926-923A-89E362A410EA@rabbitmq.com>
Message-ID: <AE35D907-76FF-409E-98E5-B888D0E9D963@elementum.com>

Michael,


I am using "test.abc" as routing key for both Publish and consume. I had put the comments below on what values are used for queueName, routingKey and exchangeName. For basicPublish, I am not using any queue.bind since this is publishing to exchange.

Only the consumer is using the queue.bind on the queueName, exchangeName.

Any help:
Publish code:
		Connection conn = factory.newConnection(addr);
		Channel channel = conn.createChannel();
		channel.exchangeDeclare("localExchange", "topic", true); // durable
		channel.basicPublish("localExchange", "test.abc", null, msg.getBytes());

Consumer code:
		Connection conn = factory.newConnection(addr);
		Channel channel = conn.createChannel();
		channel.exchangeDeclare("localExchange", "direct", true);
		channel.queueDeclare("Notification", true, false, false, null);
		channel.queueBind("Notification", "localExchange", "test.abc");
		QueueingConsumer qCon = new QueueingConsumer(channel);
                channel.basicConsume("Notification", false, qCon);
		while (true) {
		   Delivery delivery = qCon.nextDelivery();
		   System.out.println("[x] " + new String(delivery.getBody()) + " " + delivery.getEnvelope().getRoutingKey());	
		   qCon.getChannel().basicAck(delivery.getEnvelope().getDeliveryTag(), false);
		}
                


Any suggestions?

Thx,
Murugesan

                


On Nov 4, 2013, at 8:12 AM, Michael Klishin <mklishin at gopivotal.com> wrote:

> 
> On 4 Nov 2013, at 10:22, Murugesan Guruswamy <murugesan at elementum.com> wrote:
> 
>> Routing key : "test.abc", queueName : Notification, exchangeName : localExchange.
>> 
>> Is there any rabbitmq-server configurations to do?
> 
> Direct and topic exchange route message based on routing key of the message.
> Your example does not show if the key used in queue.bind matches the one used in basic.publish
> but it?s very likely to be the issue.
> 
> Also, you do not consume messages from exchanges.
> 
> See tutorials 3-5 for more info http://www.rabbitmq.com/getstarted.html
> and http://www.rabbitmq.com/tutorials/amqp-concepts.html.
> 
> Use RabbitMQ management UI to see bindings, message rates and more:
> http://www.rabbitmq.com/management.html
> 
> MK
> 
> Software Engineer, Pivotal/RabbitMQ
> 
> 


-- 
 

Legal Disclaimer: The information contained in this message may be 
privileged and confidential. It is intended to be read only by the 
individual or entity to whom it is addressed or by their designee. If the 
reader of this message is not the intended recipient, you are on notice 
that any distribution of this message, in any form, is strictly prohibited. 
If you have received this message in error, please immediately notify the 
sender and delete or destroy any copy of this message 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/830fb96e/attachment.htm>

From murugesan at elementum.com  Mon Nov  4 16:41:52 2013
From: murugesan at elementum.com (Murugesan Guruswamy)
Date: Mon, 4 Nov 2013 08:41:52 -0800
Subject: [rabbitmq-discuss] consuming a message from exchange does not
	seem to work on java client (3.2.0 as well as 3.1.5)
In-Reply-To: <CAMcAHLUVxFXobqPTJ7hU0sLB9gbG6HcyLUZLpHTp4mDNXJkDow@mail.gmail.com>
References: <b48a420a-057b-4f1e-b0bc-590693564301@googlegroups.com>
	<CAMcAHLUVxFXobqPTJ7hU0sLB9gbG6HcyLUZLpHTp4mDNXJkDow@mail.gmail.com>
Message-ID: <6BDCEB0E-97B1-4A4A-B9D0-C8371E57B3AF@elementum.com>

Yes, it is the same as the binding key.


On Nov 4, 2013, at 8:13 AM, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Is the routing key used when publishing the same as the binding key?
> 
> 
> On Mon, Nov 4, 2013 at 7:22 AM, Murugesan Guruswamy <murugesan at elementum.com> wrote:
> Hi,
> 
> I am trying to experiment exchanges and publishing it to an exchange using following code:
> 		Connection conn = factory.newConnection(addr);
> 		Channel channel = conn.createChannel();
> 		channel.exchangeDeclare(exchangeName, topicName, true); // durable. topic is "direct" and "topic" and have tried both
>                 channel.basicPublish(exchangeName, routingKey, null, msg.getBytes());
> 
> consumer code: (Tried both Queueing Consumer and my own Consumer imll).
> 
> 		Channel channel = conn.createChannel();		
> 		channel.exchangeDeclare(exchangeName, topicName, true);
> 		channel.queueDeclare(queueName, true, false, false, null);
> 		channel.queueBind(queueName, exchangeName, routingKey);
> 		QueueingConsumer qCon = new QueueingConsumer(channel);
> 		
> 		channel.basicConsume(queueName, false, qCon);
> 		while (true) {
> 			Delivery delivery = qCon.nextDelivery();
> 			System.out.println("[x] " + new String(delivery.getBody()) + " " + delivery.getEnvelope().getRoutingKey());
> 			
> 			qCon.getChannel().basicAck(delivery.getEnvelope().getDeliveryTag(), false);
> 		}
> 
> Routing key : "test.abc", queueName : Notification, exchangeName : localExchange.
> 
> Is there any rabbitmq-server configurations to do?
> 
> Please help here.
> 
> Thanks,
> Murugesan
> 
> 
> 
> 
> Legal Disclaimer: The information contained in this message may be privileged and confidential. It is intended to be read only by the individual or entity to whom it is addressed or by their designee. If the reader of this message is not the intended recipient, you are on notice that any distribution of this message, in any form, is strictly prohibited. If you have received this message in error, please immediately notify the sender and delete or destroy any copy of this message
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
 

Legal Disclaimer: The information contained in this message may be 
privileged and confidential. It is intended to be read only by the 
individual or entity to whom it is addressed or by their designee. If the 
reader of this message is not the intended recipient, you are on notice 
that any distribution of this message, in any form, is strictly prohibited. 
If you have received this message in error, please immediately notify the 
sender and delete or destroy any copy of this message 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/fdb45622/attachment.htm>

From moberg.peter at gmail.com  Mon Nov  4 16:47:21 2013
From: moberg.peter at gmail.com (Peter Moberg)
Date: Mon, 4 Nov 2013 08:47:21 -0800
Subject: [rabbitmq-discuss] How do you handle recovering from a faulty
 connection using RabbitMQ java client library?
In-Reply-To: <CAAc6ZR9Ua==Pe7Lh6XMawGpVYmZ629P6HWrXsgEeNc+aOLk3xA@mail.gmail.com>
References: <CAE9K32cdZsROo7rAaw3iHRMQ0KTinXcfJJUVBN5KR2s5KQa99A@mail.gmail.com>
	<CA+es_-xtQTeSKMo8njPR0BxY7uzyzHE=Pbo5Ccardg4_PAxNqw@mail.gmail.com>
	<CAAc6ZR9Ua==Pe7Lh6XMawGpVYmZ629P6HWrXsgEeNc+aOLk3xA@mail.gmail.com>
Message-ID: <CAE9K32coAKuOn0B__=f4TuONHxsnGdDNb9nVpDK4-x90e+=Q=w@mail.gmail.com>

Thanks for your input! Good to hear that option C is a viable approach. The
Lyra project looks interesting, will keep an eye on it.

/Peter


On Fri, Nov 1, 2013 at 3:02 AM, Mike Hadlow <mike at suteki.co.uk> wrote:

> Hi Peter,
>
> My .NET client library, EasyNetQ (http://easynetq.com) does automatic
> reconnection. We use option C with a class called PersistentConnection. An
> internal in-memory event bus then distributes connection events to the rest
> of the library so consumers get notified when they need to re-consume.
> Works well.
>
> Good luck,
> Mike
>
>
> On Fri, Nov 1, 2013 at 4:13 AM, Jonathan Halterman <jhalterman at gmail.com>wrote:
>
>> Hi Peter,
>>
>> Solution C is actually pretty reasonable. There's not much to gain from
>> using multiple connections to the same server if you're trying to guard
>> against network failures or cluster partitions. If one connection dies,
>> they all likely will. Wrapping and recovering connections/channels works
>> fine, and as Michael mentioned, you might also check out Lyra since it
>> handles the various corner cases involved in recovering resources for you.
>>
>> Cheers,
>> Jonathan
>>
>>
>> On Thu, Oct 31, 2013 at 10:28 AM, Peter Moberg <moberg.peter at gmail.com>wrote:
>>
>>> Hi,
>>>
>>> I'm interested in knowing how other people handle recovering from a
>>> faulty connection using the official RabbitMQ java client library. We are
>>> using it to connect our application servers to our RabbitMQ cluster and we
>>> have implemented a few different ways to recover from a connection failure,
>>> but non of them feel quite right.
>>>
>>> Imagine this pseudo application:
>>>
>>> public class OurClassThatStartsConsumers {
>>>     Connection conn;
>>>
>>>     public void start() {
>>>         ConnectionFactory factory = new ConnectionFactory();
>>>         factory.setUsername("someusername");
>>>         factory.setPassword("somepassword");
>>>         factory.setHost("somehost");
>>>         conn = factory.newConnection();
>>>
>>>         new Thread(new Consumer(conn.createChannel())).start();
>>>     }
>>>   }
>>> class Consumer1 implements Runnable {
>>>     public Consumer1(Channel channel) {
>>>          this.channel = channel;
>>>     }
>>>
>>>     @Override
>>>     public void run() {
>>>         while (true) {
>>>              ... consume incoming messages on the channel...
>>>             // How do we handle that the connection dies?
>>>         }
>>>     }}
>>>
>>> In the real world we have several hundreds of consumers. So what happens
>>> if the connection dies? In the above example Consumer1 can not recover,
>>> when the connection closes, the Channel also closes, a state from which we
>>> can not recover. So lets look at some ways to solve this:
>>>
>>> Solution A)
>>>
>>> Let every consumer have their own connection and register the events
>>> that triggers when the connection dies and then handle reconnecting.
>>>
>>> Pros: It works
>>>
>>> Cons:
>>>
>>>    - Since we have a lot of consumers, we probably do not want that
>>>    many connections.
>>>    - We might possible have a lot of duplicated code for reconnecting
>>>    to rabbit and handle reconnecting
>>>
>>> Solution B)
>>>
>>> Have each consumer use the same connection and subscribe to its
>>> connection failure events.
>>>
>>> Pros: Less connections than in Solution A
>>>
>>> Cons: Since the connection is closed we need to reopen/replace it. The
>>> java client library doesn't seem to provide a way to reopen the connection,
>>> so we would have to replace it with a new connection and then somehow
>>> notify all the consumers about this new connection and they would have to
>>> recreate the channels and the consumers. Once again, a lot of logic that i
>>> don't want to see in the consumer ends up there.
>>>
>>> Solution C)
>>>
>>> Wrap Connection and Channel classes is classes that handle the
>>> re-connection logic, the consumer only needs to know about the
>>> WrappedChannel class. On a connection failure the WrappedConnection with
>>> deal with re-establishing the connection and once connected the
>>> WrappedConnection will automatically create new Channels and register
>>> consumers.
>>>
>>> Pros: It work - this is actually the solution we are using today.
>>>
>>> Cons: It feels like a hack, I think this is something that should be
>>> handled more elegantly by the underlying library.
>>>
>>> Maybe there is a much better way? The API documentation does not talk
>>> that much about recovering from a faulty connection. Any input is
>>> appreciated :)
>>>
>>>
>>> Thanks,
>>>
>>> Peter
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/d3f87f8b/attachment.htm>

From carl.hoerberg at gmail.com  Mon Nov  4 16:57:08 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Mon, 4 Nov 2013 08:57:08 -0800 (PST)
Subject: [rabbitmq-discuss] Unable to access management portal after
 upgarding erlang and RabbitMQ
In-Reply-To: <527779E1.3010001@rabbitmq.com>
References: <2dc98c94.000002d4.0000000b@KAPILPC.vmware.com>
	<52172BFC.2080705@rabbitmq.com>
	<1382850984653-30885.post@n5.nabble.com>
	<1383537847745-31118.post@n5.nabble.com>
	<527779E1.3010001@rabbitmq.com>
Message-ID: <1383584228575-31154.post@n5.nabble.com>

Some TLS clients (like firefox and chrome) seems to choke on the "Supported
Elliptic Curves Extension" which Erlang sends with the ServerHello. 

> Yes, that is for the 'Supported Point Format Extension',
> which the RFC says is fine to send in the ServerHello, but the RFC
> doesn't say anything about the `Supported Elliptic Curves Extension`
> being sent in a ServerHello, only in a ClientHello

http://comments.gmane.org/gmane.comp.lang.erlang.bugs/3816




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Unable-to-access-management-portal-after-upgarding-erlang-and-RabbitMQ-tp28946p31154.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Mon Nov  4 17:00:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Nov 2013 17:00:41 +0000
Subject: [rabbitmq-discuss] consuming a message from exchange does not
 seem to work on java client (3.2.0 as well as 3.1.5)
In-Reply-To: <AE35D907-76FF-409E-98E5-B888D0E9D963@elementum.com>
References: <b48a420a-057b-4f1e-b0bc-590693564301@googlegroups.com>
	<262B0205-7F2B-4926-923A-89E362A410EA@rabbitmq.com>
	<AE35D907-76FF-409E-98E5-B888D0E9D963@elementum.com>
Message-ID: <5277D2B9.3010701@rabbitmq.com>

On 04/11/2013 4:41PM, Murugesan Guruswamy wrote:
> I am using "test.abc" as routing key for both Publish and consume. I had
> put the comments below on what values are used for queueName, routingKey
> and exchangeName. For basicPublish, I am not using any queue.bind since
> this is publishing to exchange.

Your code overall looks like it should work.

Are you publishing before the consumer app has ever been run (and thus 
at a point when the queue / binding does not exist?) If so, the message 
will be dropped.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From murugesan at elementum.com  Mon Nov  4 17:04:35 2013
From: murugesan at elementum.com (Murugesan Guruswamy)
Date: Mon, 4 Nov 2013 09:04:35 -0800
Subject: [rabbitmq-discuss] consuming a message from exchange does not
	seem to work on java client (3.2.0 as well as 3.1.5)
In-Reply-To: <5277D2B9.3010701@rabbitmq.com>
References: <b48a420a-057b-4f1e-b0bc-590693564301@googlegroups.com>
	<262B0205-7F2B-4926-923A-89E362A410EA@rabbitmq.com>
	<AE35D907-76FF-409E-98E5-B888D0E9D963@elementum.com>
	<5277D2B9.3010701@rabbitmq.com>
Message-ID: <0492A90D-5F03-4182-969C-B61881572EFB@elementum.com>

Simon,

But I am actually creating a durable exchange when publishing. Shouldn't it leave the messages in the exchange. Why should the messages be dropped?

I am publishing first to the exchange which is durable.

Thanks,
Murugesan
On Nov 4, 2013, at 9:00 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 04/11/2013 4:41PM, Murugesan Guruswamy wrote:
>> I am using "test.abc" as routing key for both Publish and consume. I had
>> put the comments below on what values are used for queueName, routingKey
>> and exchangeName. For basicPublish, I am not using any queue.bind since
>> this is publishing to exchange.
> 
> Your code overall looks like it should work.
> 
> Are you publishing before the consumer app has ever been run (and thus at a point when the queue / binding does not exist?) If so, the message will be dropped.
> 
> Cheers, Simon
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal


-- 
 

Legal Disclaimer: The information contained in this message may be 
privileged and confidential. It is intended to be read only by the 
individual or entity to whom it is addressed or by their designee. If the 
reader of this message is not the intended recipient, you are on notice 
that any distribution of this message, in any form, is strictly prohibited. 
If you have received this message in error, please immediately notify the 
sender and delete or destroy any copy of this message 

From matthias at rabbitmq.com  Mon Nov  4 17:05:26 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 04 Nov 2013 17:05:26 +0000
Subject: [rabbitmq-discuss] Unable to access management portal after
 upgarding erlang and RabbitMQ
In-Reply-To: <1383584228575-31154.post@n5.nabble.com>
References: <2dc98c94.000002d4.0000000b@KAPILPC.vmware.com>	<52172BFC.2080705@rabbitmq.com>	<1382850984653-30885.post@n5.nabble.com>	<1383537847745-31118.post@n5.nabble.com>	<527779E1.3010001@rabbitmq.com>
	<1383584228575-31154.post@n5.nabble.com>
Message-ID: <5277D3D6.2030208@rabbitmq.com>

On 04/11/13 16:57, carlhoerberg wrote:
> Some TLS clients (like firefox and chrome) seems to choke on the "Supported
> Elliptic Curves Extension" which Erlang sends with the ServerHello.
>
>> Yes, that is for the 'Supported Point Format Extension',
>> which the RFC says is fine to send in the ServerHello, but the RFC
>> doesn't say anything about the `Supported Elliptic Curves Extension`
>> being sent in a ServerHello, only in a ClientHello
>
> http://comments.gmane.org/gmane.comp.lang.erlang.bugs/3816

right, but as noted in that thread (though I haven't double-checked the 
specs)... "unknown hello extensions according to the protocol shall be 
ignored.", which would indicate that the clients are at fault here.

Anyway, looks like the OTP folks are going to remove the offending 
extension in a future version.

Matthias.

From simon at rabbitmq.com  Mon Nov  4 17:08:58 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 04 Nov 2013 17:08:58 +0000
Subject: [rabbitmq-discuss] consuming a message from exchange does not
 seem to work on java client (3.2.0 as well as 3.1.5)
In-Reply-To: <0492A90D-5F03-4182-969C-B61881572EFB@elementum.com>
References: <b48a420a-057b-4f1e-b0bc-590693564301@googlegroups.com>
	<262B0205-7F2B-4926-923A-89E362A410EA@rabbitmq.com>
	<AE35D907-76FF-409E-98E5-B888D0E9D963@elementum.com>
	<5277D2B9.3010701@rabbitmq.com>
	<0492A90D-5F03-4182-969C-B61881572EFB@elementum.com>
Message-ID: <5277D4AA.4070305@rabbitmq.com>

Exchanges don't hold messages; queues do.

Have you read the tutorials? If not I recommend them:

http://www.rabbitmq.com/getstarted.html

Cheers, Simon

On 04/11/2013 5:04PM, Murugesan Guruswamy wrote:
> Simon,
>
> But I am actually creating a durable exchange when publishing. Shouldn't it leave the messages in the exchange. Why should the messages be dropped?
>
> I am publishing first to the exchange which is durable.
>
> Thanks,
> Murugesan
> On Nov 4, 2013, at 9:00 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>
>> On 04/11/2013 4:41PM, Murugesan Guruswamy wrote:
>>> I am using "test.abc" as routing key for both Publish and consume. I had
>>> put the comments below on what values are used for queueName, routingKey
>>> and exchangeName. For basicPublish, I am not using any queue.bind since
>>> this is publishing to exchange.
>>
>> Your code overall looks like it should work.
>>
>> Are you publishing before the consumer app has ever been run (and thus at a point when the queue / binding does not exist?) If so, the message will be dropped.
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Mon Nov  4 17:09:54 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 4 Nov 2013 21:09:54 +0400
Subject: [rabbitmq-discuss] consuming a message from exchange does not
	seem to work on java client (3.2.0 as well as 3.1.5)
In-Reply-To: <0492A90D-5F03-4182-969C-B61881572EFB@elementum.com>
References: <b48a420a-057b-4f1e-b0bc-590693564301@googlegroups.com>
	<262B0205-7F2B-4926-923A-89E362A410EA@rabbitmq.com>
	<AE35D907-76FF-409E-98E5-B888D0E9D963@elementum.com>
	<5277D2B9.3010701@rabbitmq.com>
	<0492A90D-5F03-4182-969C-B61881572EFB@elementum.com>
Message-ID: <2855DFB3-60CD-4F67-9227-0F9D19ADF104@gopivotal.com>

On 4 Nov 2013, at 21:04, Murugesan Guruswamy <murugesan at elementum.com> wrote:

> But I am actually creating a durable exchange when publishing. Shouldn't it leave the messages in the exchange. Why should the messages be dropped?
> 
> I am publishing first to the exchange which is durable.

Standard exchange types are not message containers. They are routing tables and if there are no bindings,
one of the following will happen:

 * Messages published as mandatory will be returned to the client
 * Exchanges that have alternate exchange configured will republish the message there.
 * Message will be dropped.

Exchange durability controls whether it will exist after broker restart.
--
MK

Software Engineer, Pivotal/RabbitMQ


From jhalterman at gmail.com  Mon Nov  4 17:27:10 2013
From: jhalterman at gmail.com (Jonathan Halterman)
Date: Mon, 4 Nov 2013 09:27:10 -0800
Subject: [rabbitmq-discuss] [Java client] - Delay in releasing channel
	numbers
In-Reply-To: <5276245A.2010607@rabbitmq.com>
References: <CA+es_-xWtuT43+88ZQOTdAo0_wDG8FB_5FOoKz67aNoQpbo-rw@mail.gmail.com>
	<5276245A.2010607@rabbitmq.com>
Message-ID: <CA+es_-zNVHy6AiF1PA-TQEkYa4LCLEk6zx1ZBJXWVkeYyBnpVQ@mail.gmail.com>

On Sun, Nov 3, 2013 at 2:24 AM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> On 02/11/13 22:50, Jonathan Halterman wrote:
>
>> for the purpose of recovering a channel *with the same number*
>>
>
> why do you want to do that?
>

Since channel numbers can be specified by the user and may have some
application specific meaning, I'd like to recover channels with the same
number. Is that not a good idea?

Cheers,
Jonathan


>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/2d428ab9/attachment.htm>

From mklishin at gopivotal.com  Mon Nov  4 17:56:29 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 4 Nov 2013 21:56:29 +0400
Subject: [rabbitmq-discuss] [Java client] - Delay in releasing channel
	numbers
In-Reply-To: <CA+es_-zNVHy6AiF1PA-TQEkYa4LCLEk6zx1ZBJXWVkeYyBnpVQ@mail.gmail.com>
References: <CA+es_-xWtuT43+88ZQOTdAo0_wDG8FB_5FOoKz67aNoQpbo-rw@mail.gmail.com>
	<5276245A.2010607@rabbitmq.com>
	<CA+es_-zNVHy6AiF1PA-TQEkYa4LCLEk6zx1ZBJXWVkeYyBnpVQ@mail.gmail.com>
Message-ID: <1B4431E4-F6CE-44C7-A146-FBD08834DA3C@rabbitmq.com>

On 4 Nov 2013, at 21:27, Jonathan Halterman <jhalterman at gmail.com> wrote:

> Since channel numbers can be specified by the user and may have some application specific meaning, I'd like to recover channels with the same number. Is that not a good idea?

This is a very rarely used API element. I think the people who rely on it may as well choose to perform
recovery manually.

Bunny tries to keep channel ids the same but it never claims to guarantee that. Its shutdown
process is simpler (or more limited, depending on who you ask).

MK

Software Engineer, Pivotal/RabbitMQ



From graeme at sudo.ca  Mon Nov  4 19:00:37 2013
From: graeme at sudo.ca (Graeme N)
Date: Mon, 4 Nov 2013 11:00:37 -0800
Subject: [rabbitmq-discuss] Feature Req / Bug list
In-Reply-To: <5277A9A3.3060708@rabbitmq.com>
References: <CAJ4uuZZnWrC9tp9V+D021AvPDHDKzfXGChvG+OPgD8E8W-tYMw@mail.gmail.com>
	<526A49E0.3010707@rabbitmq.com>
	<CAJ4uuZbqiokizs4FoGLESS+PDra8JcTKW=6FrxTmpJeg_YumVA@mail.gmail.com>
	<61705EBA-366B-4B77-BBFE-D7B2E14F3E5A@rabbitmq.com>
	<CAJ4uuZb+bgZGRubJ9pAXH2ZMwyxagJ5mTnk3T8xhhEWm_W_L9w@mail.gmail.com>
	<AEADD6B5-832E-4BB0-9312-47EA927F9F0B@rabbitmq.com>
	<CAJ4uuZYpt5-7bd0SnsqNQCb+W0WAcj5WrH9OxWn6-VfGQoLK8w@mail.gmail.com>
	<92E1A6B8-E4D1-47C5-A108-9E254EC2EF9D@rabbitmq.com>
	<CAJ4uuZYNy3kyCtm1sWbRdaprWkOQ4O8KMhBNFwxafg6zbMSX3g@mail.gmail.com>
	<F573E81A-8BD2-4F9A-8643-ABB67E97773E@rabbitmq.com>
	<CAJ4uuZYUqGeBRVEbacpGPeyHxFP2S9F7PND8KPQakjMg9Whgrg@mail.gmail.com>
	<526ECAD9.2030703@rabbitmq.com>
	<CAJ4uuZYmom2AjYrsYOVxDNfkuK4VVhqoEyFqG5c7f+th-Xdx5w@mail.gmail.com>
	<526ED167.1010308@rabbitmq.com>
	<CAJ4uuZb1kd8dQ1c3=o-mzHvYzUNrHcwUxFU8VvEOurUG7EFtfQ@mail.gmail.com>
	<CAJ4uuZbc13rs9SCmU64K9ant630Z+1j1x-Ss2MRBh7fQnnEXdA@mail.gmail.com>
	<5277A9A3.3060708@rabbitmq.com>
Message-ID: <CAJ4uuZbAMR3LB4-sG517sLwb=bxzHNir4yx-9zr_+OnrorQ9qw@mail.gmail.com>

Hi Simon,

It does seem likely to me that fixing the initial issues I found would
resolve the other problems, so I'll definitely re-test within the next day
or so using the latest nightly build, and let you know how it goes.

Thanks!
Graeme


On Mon, Nov 4, 2013 at 6:05 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 29/10/2013 12:06AM, Graeme N wrote:
>
>> These errors are all really strange, and so I'm hoping you guys can
>> reproduce them, and best case scenario, find something that accounts for
>> these problems which we can then patch in our production environment.
>>
>
> We haven't been able to recreate your most recent issues - but it's
> possible that they're all copies of the same underlying problem as the
> first lot you reported (which are now fixed).
>
> So would you be able to have another go, with a recent nightly build?
>
> http://www.rabbitmq.com/nightly-builds.html
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/23865ed0/attachment.htm>

From Ron.Cordell at RelayHealth.com  Mon Nov  4 19:29:17 2013
From: Ron.Cordell at RelayHealth.com (Cordell, Ron)
Date: Mon, 4 Nov 2013 19:29:17 +0000
Subject: [rabbitmq-discuss] Rabbit Cluster "hangs" on consumer
 disconnects
In-Reply-To: <5277847C.4010205@rabbitmq.com>
References: <0B8CD6850421B745BE39BC5C76019232A683F5F6@DDCEP50016.na.corp.mckesson.com>,
	<5277847C.4010205@rabbitmq.com>
Message-ID: <0B8CD6850421B745BE39BC5C76019232A684354A@DDCEP50016.na.corp.mckesson.com>


>> What happens if you attempt to shut down the service by issuing
>> "rabbitmqctl stop" rather than stopping the Windows service?

Ah, sorry for the confusion. 
We don't actually try to stop the RabbitMQ windows service instances - those stay running. We are shutting down the application Windows Service instances that rely on Rabbit, however.

When we see this issue happen, issuing a rabbitmqctl stop_app command does indeed work, and issuing the start_app command brings the node back up in good shape.


>> Also, we fixed several bugs that could cause deadlocks during shutdown
>> in 3.2.0, so it might be worth trying an upgrade.

Thanks, Simon - we'll give it a go and see what happens.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal

From graeme at sudo.ca  Mon Nov  4 20:29:32 2013
From: graeme at sudo.ca (Graeme N)
Date: Mon, 4 Nov 2013 12:29:32 -0800
Subject: [rabbitmq-discuss] Feature Req / Bug list
In-Reply-To: <CAJ4uuZbAMR3LB4-sG517sLwb=bxzHNir4yx-9zr_+OnrorQ9qw@mail.gmail.com>
References: <CAJ4uuZZnWrC9tp9V+D021AvPDHDKzfXGChvG+OPgD8E8W-tYMw@mail.gmail.com>
	<526A49E0.3010707@rabbitmq.com>
	<CAJ4uuZbqiokizs4FoGLESS+PDra8JcTKW=6FrxTmpJeg_YumVA@mail.gmail.com>
	<61705EBA-366B-4B77-BBFE-D7B2E14F3E5A@rabbitmq.com>
	<CAJ4uuZb+bgZGRubJ9pAXH2ZMwyxagJ5mTnk3T8xhhEWm_W_L9w@mail.gmail.com>
	<AEADD6B5-832E-4BB0-9312-47EA927F9F0B@rabbitmq.com>
	<CAJ4uuZYpt5-7bd0SnsqNQCb+W0WAcj5WrH9OxWn6-VfGQoLK8w@mail.gmail.com>
	<92E1A6B8-E4D1-47C5-A108-9E254EC2EF9D@rabbitmq.com>
	<CAJ4uuZYNy3kyCtm1sWbRdaprWkOQ4O8KMhBNFwxafg6zbMSX3g@mail.gmail.com>
	<F573E81A-8BD2-4F9A-8643-ABB67E97773E@rabbitmq.com>
	<CAJ4uuZYUqGeBRVEbacpGPeyHxFP2S9F7PND8KPQakjMg9Whgrg@mail.gmail.com>
	<526ECAD9.2030703@rabbitmq.com>
	<CAJ4uuZYmom2AjYrsYOVxDNfkuK4VVhqoEyFqG5c7f+th-Xdx5w@mail.gmail.com>
	<526ED167.1010308@rabbitmq.com>
	<CAJ4uuZb1kd8dQ1c3=o-mzHvYzUNrHcwUxFU8VvEOurUG7EFtfQ@mail.gmail.com>
	<CAJ4uuZbc13rs9SCmU64K9ant630Z+1j1x-Ss2MRBh7fQnnEXdA@mail.gmail.com>
	<5277A9A3.3060708@rabbitmq.com>
	<CAJ4uuZbAMR3LB4-sG517sLwb=bxzHNir4yx-9zr_+OnrorQ9qw@mail.gmail.com>
Message-ID: <CAJ4uuZY0agfwfjChtes3LHsTmADhs2ZnTUR557=ir5-Lbk20sg@mail.gmail.com>

Ok, so here's the issues I'm still seeing with the latest nightly build
(rabbitmq-server-3.2.0.41104-1.noarch):

- multiple simultaneous API calls on the CLI from running rabbitmqctl and
amqp-delete-queue in parallel from bash still cause weird buggy responses
from RMQ. running my setup_queues.sh multiple times is enough to trigger
it. Seems to be primarily running the operations in the first loop that
have problems, the second loop (which creates the queues) seems to run fine
in parallel, which is good.
- this is also the case with my rebalance_cluster.sh script when run in
parallel, the API handler breaks and skips applying about half of the new
policies.
- bug where policies with > 2 replicas don't get properly auto-replicated
is still present. Running rebalance_cluster.sh multiple times causes many
queues to end up under-replicated after the first pass. however, there
seems to be a workaround: if I apply a global replication policy of
"exactly 3", and then delete the per-queue policies, this seems to force a
resync as it switches queues to the global policy, and so they end up fully
replicated to the 3 nodes I specified with the per-queue policies.
- still lots of replication problems related to pulling and re-adding
nodes. running the toggle_nodes.sh script in a loop with the global
"exactly 3" policy demonstrates that as nodes are removed, it doesn't
automatically replicate to a different node, just leaves queues with only 1
replica, and doesn't always re-replicate back to the node which was pulled
after it's been re-added. after a few iterations (3-5), this causes data
loss on queues, with queues that have sequentially lost all their replicas
ending up empty, even though the global policy says they should be ensuring
there's always 3 copies of the data.
- running toggle_nodes.sh in a loop will also still get to the point where
rabbitmq refuses to do any further node leave/join operations until the
cluster is fully killed and brought back up.
- this also eventually causes a few of the queues to enter the weird state
where they list unsyncronized mirrors, but aren't attempting to sync. at
this point, rebalance_cluster.sh will also fail, and the cluster will
reject all policy operation requests, until it's fully killed and restarted.

On the bright side:

- loading 10k messages per queue seems faster on my VM than with the 3.2.0
release, even when doing 3x local replication.
- bug where it was deleting queues as they approached 10k messages when
policies had been applied seems to be gone.
- cluster management functions run sequentially from scripts seems to be
safe now, haven't been able to generate any bad behaviour as long as I'm
not running more than one cluster command at a time, and as long as I'm not
removing and adding nodes.
- have a known good way to rebalance queues across cluster systems, even if
it is slow and requires a workaround to get fully synced.

I'm really hoping you guys can replicate the more severe errors around
polices and node management. I'm happy to provide thorough reproduction
steps, information, logs, etc for anything I've reported here, if you guys
are having issues reproducing internally.

Graeme



On Mon, Nov 4, 2013 at 11:00 AM, Graeme N <graeme at sudo.ca> wrote:

> Hi Simon,
>
> It does seem likely to me that fixing the initial issues I found would
> resolve the other problems, so I'll definitely re-test within the next day
> or so using the latest nightly build, and let you know how it goes.
>
> Thanks!
> Graeme
>
>
> On Mon, Nov 4, 2013 at 6:05 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 29/10/2013 12:06AM, Graeme N wrote:
>>
>>> These errors are all really strange, and so I'm hoping you guys can
>>> reproduce them, and best case scenario, find something that accounts for
>>> these problems which we can then patch in our production environment.
>>>
>>
>> We haven't been able to recreate your most recent issues - but it's
>> possible that they're all copies of the same underlying problem as the
>> first lot you reported (which are now fixed).
>>
>> So would you be able to have another go, with a recent nightly build?
>>
>> http://www.rabbitmq.com/nightly-builds.html
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/aac1cafa/attachment.htm>

From matthias at rabbitmq.com  Mon Nov  4 21:46:15 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Mon, 04 Nov 2013 21:46:15 +0000
Subject: [rabbitmq-discuss] Feature Req / Bug list
In-Reply-To: <CAJ4uuZY0agfwfjChtes3LHsTmADhs2ZnTUR557=ir5-Lbk20sg@mail.gmail.com>
References: <CAJ4uuZZnWrC9tp9V+D021AvPDHDKzfXGChvG+OPgD8E8W-tYMw@mail.gmail.com>	<CAJ4uuZb+bgZGRubJ9pAXH2ZMwyxagJ5mTnk3T8xhhEWm_W_L9w@mail.gmail.com>	<AEADD6B5-832E-4BB0-9312-47EA927F9F0B@rabbitmq.com>	<CAJ4uuZYpt5-7bd0SnsqNQCb+W0WAcj5WrH9OxWn6-VfGQoLK8w@mail.gmail.com>	<92E1A6B8-E4D1-47C5-A108-9E254EC2EF9D@rabbitmq.com>	<CAJ4uuZYNy3kyCtm1sWbRdaprWkOQ4O8KMhBNFwxafg6zbMSX3g@mail.gmail.com>	<F573E81A-8BD2-4F9A-8643-ABB67E97773E@rabbitmq.com>	<CAJ4uuZYUqGeBRVEbacpGPeyHxFP2S9F7PND8KPQakjMg9Whgrg@mail.gmail.com>	<526ECAD9.2030703@rabbitmq.com>	<CAJ4uuZYmom2AjYrsYOVxDNfkuK4VVhqoEyFqG5c7f+th-Xdx5w@mail.gmail.com>	<526ED167.1010308@rabbitmq.com>	<CAJ4uuZb1kd8dQ1c3=o-mzHvYzUNrHcwUxFU8VvEOurUG7EFtfQ@mail.gmail.com>	<CAJ4uuZbc13rs9SCmU64K9ant630Z+1j1x-Ss2MRBh7fQnnEXdA@mail.gmail.com>	<5277A9A3.3060708@rabbitmq.com>	<CAJ4uuZbAMR3LB4-sG517sLwb=bxzHNir4yx-9zr_+OnrorQ9qw@mail.gmail.com>
	<CAJ4uuZY0agfwfjChtes3LHsTmADhs2ZnTUR557=ir5-Lbk20sg@mail.gmail.com>
Message-ID: <527815A7.9060701@rabbitmq.com>

Graeme,

thanks for the follow-up. Just a quick question...

On 04/11/13 20:29, Graeme N wrote:
> - bug where it was deleting queues as they approached 10k messages when
> policies had been applied seems to be gone.

Is the "messages reappearing" issue gone too, i.e.

<quote>
if you have a bunch of persistent queues full of messages (~10k each in 
this case), and you delete them via the API and then recreate them 
immediately [...] they'll reappear with some subset of the messages that 
were present before queue deletion.
</quote>

?

Regards,

Matthias.

From graeme at sudo.ca  Mon Nov  4 22:08:48 2013
From: graeme at sudo.ca (Graeme N)
Date: Mon, 4 Nov 2013 14:08:48 -0800
Subject: [rabbitmq-discuss] Feature Req / Bug list
In-Reply-To: <527815A7.9060701@rabbitmq.com>
References: <CAJ4uuZZnWrC9tp9V+D021AvPDHDKzfXGChvG+OPgD8E8W-tYMw@mail.gmail.com>
	<CAJ4uuZb+bgZGRubJ9pAXH2ZMwyxagJ5mTnk3T8xhhEWm_W_L9w@mail.gmail.com>
	<AEADD6B5-832E-4BB0-9312-47EA927F9F0B@rabbitmq.com>
	<CAJ4uuZYpt5-7bd0SnsqNQCb+W0WAcj5WrH9OxWn6-VfGQoLK8w@mail.gmail.com>
	<92E1A6B8-E4D1-47C5-A108-9E254EC2EF9D@rabbitmq.com>
	<CAJ4uuZYNy3kyCtm1sWbRdaprWkOQ4O8KMhBNFwxafg6zbMSX3g@mail.gmail.com>
	<F573E81A-8BD2-4F9A-8643-ABB67E97773E@rabbitmq.com>
	<CAJ4uuZYUqGeBRVEbacpGPeyHxFP2S9F7PND8KPQakjMg9Whgrg@mail.gmail.com>
	<526ECAD9.2030703@rabbitmq.com>
	<CAJ4uuZYmom2AjYrsYOVxDNfkuK4VVhqoEyFqG5c7f+th-Xdx5w@mail.gmail.com>
	<526ED167.1010308@rabbitmq.com>
	<CAJ4uuZb1kd8dQ1c3=o-mzHvYzUNrHcwUxFU8VvEOurUG7EFtfQ@mail.gmail.com>
	<CAJ4uuZbc13rs9SCmU64K9ant630Z+1j1x-Ss2MRBh7fQnnEXdA@mail.gmail.com>
	<5277A9A3.3060708@rabbitmq.com>
	<CAJ4uuZbAMR3LB4-sG517sLwb=bxzHNir4yx-9zr_+OnrorQ9qw@mail.gmail.com>
	<CAJ4uuZY0agfwfjChtes3LHsTmADhs2ZnTUR557=ir5-Lbk20sg@mail.gmail.com>
	<527815A7.9060701@rabbitmq.com>
Message-ID: <CAJ4uuZYSHqN8BhsJE_4pi+gBJWewQ3Au+KiQrtbeKvPsz=UAPA@mail.gmail.com>

Yes, that issue also appears to be gone.

Graeme

On Mon, Nov 4, 2013 at 1:46 PM, Matthias Radestock <matthias at rabbitmq.com>wrote:

> Graeme,
>
> thanks for the follow-up. Just a quick question...
>
>
> On 04/11/13 20:29, Graeme N wrote:
>
>> - bug where it was deleting queues as they approached 10k messages when
>> policies had been applied seems to be gone.
>>
>
> Is the "messages reappearing" issue gone too, i.e.
>
> <quote>
> if you have a bunch of persistent queues full of messages (~10k each in
> this case), and you delete them via the API and then recreate them
> immediately [...] they'll reappear with some subset of the messages that
> were present before queue deletion.
> </quote>
>
> ?
>
> Regards,
>
>
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/6e8d394d/attachment.htm>

From bsellner at seegrid.com  Mon Nov  4 22:35:48 2013
From: bsellner at seegrid.com (Brennan Sellner)
Date: Mon, 4 Nov 2013 17:35:48 -0500
Subject: [rabbitmq-discuss] Stomp, subscriptions, and forward slashes
In-Reply-To: <5277752A.5000307@rabbitmq.com>
References: <527576F9.5040108@seegrid.com> <5277752A.5000307@rabbitmq.com>
Message-ID: <52782144.3090007@seegrid.com>

On 11/04/2013 05:21 AM, Emile Joubert wrote:
>
> On 02/11/13 22:04, Brennan Sellner wrote:
>
>> Is there any way to escape the slash in the exchange name when
>> subscribing via web-stomp?  I've blindly tried a few options (i.e. '\\/'
>> or '%47'),
>
>
> You can use %2F as an escaped forward-slash character in STOMP.
>

<facepalm> My bad: URL encoding, not HTML encoding.  Thanks!

One more STOMP / WebSockets-related question: The STOMP 1.1 spec states
that it's possible to transmit binary messages
(http://stomp.github.io/stomp-specification-1.1.html, 'Protocol Overview').

However, when I try to consume a binary protobuf from Javascript,
RabbitMQ drops my connection with the bad_utf8_character_code error
report quoted below.  Browser-side, I'm using SockJS and stomp.js
(http://www.jmesnil.net/stomp-websocket/doc/).

https://github.com/sockjs/sockjs-protocol/issues/74 makes it clear that
SockJS (at least) doesn't yet support binary payloads.  What's not clear
to me is whether rabbitmq_web_stomp does: is it worth fiddling around
with SockJS replacements, or should I just bite the bullet and add a
relay to re-encode everything going to and from the browser as base64?

Thanks,

-Brennan

=ERROR REPORT==== 4-Nov-2013::17:15:03 ===
** Handler sockjs_cowboy_handler terminating in websocket_info/3
    for the reason exit:{ucs,{bad_utf8_character_code}}
** Message was go
** Options were {service,"/stomp",#Fun<rabbit_ws_sockjs.1.120271989>,{},
                          "http://cdn.sockjs.org/sockjs-0.2.js",false,true,

5000,25000,131072,#Fun<rabbit_ws_sockjs.0.116551930>}
** Handler state was {websocket,<0.4058.0>}
** Request was {http_req,#Port<0.20033>,cowboy_tcp_transport,keepalive,
                    <0.4057.0>,'GET',
                    {1,1},
                    {{127,0,0,1},33666},
                    [<<"localhost">>],
                    undefined,<<"localhost">>,15674,
                    [<<"stomp">>,<<"615">>,<<"38_dv47k">>,<<"websocket">>],
                    [<<"615">>,<<"38_dv47k">>,<<"websocket">>],
                    <<"/stomp/615/38_dv47k/websocket">>,undefined,<<>>,[],
                    [{'Cookie',
                         <<"sessionid=600fbdc35df07db74bf4067b38702643;
csrftoken=ae2bc9d9535ef8f220a0eb467883ea4e">>},
                     {'User-Agent',
                         <<"Mozilla/5.0 (X11; Linux x86_64)
AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.110
Safari/537.36">>},
                     {<<"Sec-Websocket-Extensions">>,
                      <<"x-webkit-deflate-frame">>},
                     {<<"Sec-Websocket-Version">>,<<"13">>},

{<<"Sec-Websocket-Key">>,<<"dJr61dUXL0ilQiqpgALD3w==">>},
                     {'Cache-Control',<<"no-cache">>},
                     {'Pragma',<<"no-cache">>},
                     {<<"Origin">>,<<"http://localhost:8000">>},
                     {'Host',<<"localhost">>},
                     {'Connection',<<"Upgrade">>},
                     {'Upgrade',<<"websocket">>}],
                    [{'Upgrade',[<<"websocket">>]},
                     {'Connection',[<<"upgrade">>]}],
                    undefined,
                    [{websocket_version,13}],
                    waiting,<<>>,done,[],<<>>,
                    {#Fun<cowboy_http.urldecode.2>,crash}}
** Stacktrace: [{xmerl_ucs,from_utf8,1},
                 {mochijson2_fork,json_encode_string,2},
                 {mochijson2_fork,'-json_encode_array/2-fun-0-',3},
                 {lists,foldl,3},
                 {mochijson2_fork,json_encode_array,2},
                 {sockjs_util,encode_frame,1},
                 {sockjs_ws_handler,reply,2},
                 {sockjs_cowboy_handler,websocket_info,3}]



My apologies for the below:


Email Confidentiality Notice

The information contained in this transmission is confidential, proprietary or privileged and may be subject to protection under the law. This message is intended for the sole use of the individual or entity to whom it's addressed. If you are not the intended recipient, you are notified that any use, distribution or copying of the message is strictly prohibited and may subject you to criminal or civil penalties. If you received this transmission in error, please contact the sender immediately by replying to this email and delete the material from any computer.

From matt at nextdoor.com  Tue Nov  5 06:07:00 2013
From: matt at nextdoor.com (Matt Wise)
Date: Mon, 4 Nov 2013 22:07:00 -0800
Subject: [rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster...
Message-ID: <CAOHkZxNrh_f=z+JJ8FMk9BVgm02ZSQyk0jPv41AVRZTdAupj_Q@mail.gmail.com>

Hey... I had a pretty rough time today with a 3-node RabbitMQ 3.1.3 cluster
thats under pretty heavy use (6-7 million messages per day -- 100MB peak
bandwidth per node). I want to pose a few questions here. First off, here's
the basic configuration though.

Configuration:
  serverA, serverB and serverC are all configured with RabbitMQ 3.1.3. They
each are configured via Puppet ... and Puppet uses a dynamic node discovery
plugin (zookeeper) to find the nodes. The node lists are hard-coded into
the rabbitmq.config file. A dynamic server list generator supplies Puppet
with this list of servers (and is not really necessary to describe here in
this email).

Scenario:
  A momentary configuration blip caused serverA and serverB to begin
reconfiguring their rabbitmq.config files... when they did this, they also
both issued a 'service rabbitmq restart' command. This command took
40+minutes and ultimately failed. During this failure, RabbitMQ was
technically running and accepting connections to the TCP ports ... but it
would not actually answer any queries. Commands like list_queues would hang
indefinitely.

Questions:
  1. We only had ~2500 messages in the queues (they are HA'd and durable).
The policy is { 'ha-mode': 'all' }. When serverA and serverB restarted, why
did they never come up? Unfortunately in the restart process, they blew
away their log files as well which makes this really tough to troubleshoot.

  2. I know that restarting serverA and serverB at nearly the same time is
obviously a bad idea -- we'll be implementing some changes so this doesn't
happen again -- but could this have lead to data corruption? Once the
entire RabbitMQ farm was shut down, we actually were forced to move the
rabbitmq data directory out of the way and start up the farm completely
with blank databases. It seemed that RabbitMQ 3.1.3 really did not want to
recover from this failure. Any thoughts?

  3. Lastly .. in the event of future failures, what tools are there for
recovering our Mnesia databases? Is there any way we can dump out the data
into some raw form, and then import it back into a new fresh cluster?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/3db3da8d/attachment.htm>

From matt at nextdoor.com  Tue Nov  5 06:26:25 2013
From: matt at nextdoor.com (Matt Wise)
Date: Mon, 4 Nov 2013 22:26:25 -0800
Subject: [rabbitmq-discuss] Request for copies of internal bug reports...
Message-ID: <CAOHkZxMcoUC5htzmX6uY_tXyOf8R2CyKLvvs21xg64MPvwwQUg@mail.gmail.com>

RabbitMQ team ... would you mind posting the internal bug reports for the
following Bug IDs since you don't have a public bug tracker? We're digging
into some failures we had today, and trying to understand which one of
these (if any) bugs may have bit us:

25615 25670 fix race conditions in mirrored queues when different cluster
      nodes start and stop near-simultaneously (since 2.6.0)
25617 fix corrupt_cluster_status_files error after abrupt node shutdown
      (since 3.0.0)
25632 fix broken error handling in amqp_network_connection that could lead
      to a crash during broker shutdown (since 2.4.0)
25602 fix race condition that could cause mirrored queues to corrupt state
      during promotion (since 2.6.0)
25745 prevent HA queue from becoming masterless if multiple nodes shutdown
in
      quick succession (since 2.6.0)
25685 prevent race that leads to a masterless queue when a slave and
      previous master start simultaneously (since 2.6.0)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131104/b5ee9e8a/attachment.htm>

From 314992959 at qq.com  Tue Nov  5 08:29:05 2013
From: 314992959 at qq.com (3k4b251)
Date: Tue, 5 Nov 2013 00:29:05 -0800 (PST)
Subject: [rabbitmq-discuss]
	=?utf-8?q?rabbitmq-c=2C__how__to__use___x-mess?=
	=?utf-8?q?age-ttl___=EF=BC=9F?=
In-Reply-To: <52779864.9080403@rabbitmq.com>
References: <1383561678435-31127.post@n5.nabble.com>
	<CD33E61E-10B0-463B-A2A4-03EE0CBBB343@rabbitmq.com>
	<1383564871475-31131.post@n5.nabble.com>
	<35F67396-DCE8-4896-8675-EEFE1C21E73A@rabbitmq.com>
	<52779864.9080403@rabbitmq.com>
Message-ID: <1383640145988-31172.post@n5.nabble.com>

thank  you  so much.    Can  you  also  tell  me   what's   diffrent  
between   x-message-tll  and   x-dead-letter-exchange ?    



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-how-to-use-x-message-ttl-tp31127p31172.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue Nov  5 08:32:40 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 5 Nov 2013 12:32:40 +0400
Subject: [rabbitmq-discuss]
 =?utf-8?q?rabbitmq-c=2C__how__to__use___x-mess?=
 =?utf-8?q?age-ttl___=EF=BC=9F?=
In-Reply-To: <1383640145988-31172.post@n5.nabble.com>
References: <1383561678435-31127.post@n5.nabble.com>
	<CD33E61E-10B0-463B-A2A4-03EE0CBBB343@rabbitmq.com>
	<1383564871475-31131.post@n5.nabble.com>
	<35F67396-DCE8-4896-8675-EEFE1C21E73A@rabbitmq.com>
	<52779864.9080403@rabbitmq.com>
	<1383640145988-31172.post@n5.nabble.com>
Message-ID: <B32C6AE3-AA6E-4A8B-B55A-515AEED23414@rabbitmq.com>

On 5 Nov 2013, at 12:29, 3k4b251 <314992959 at qq.com> wrote:

> Can  you  also  tell  me   what's   diffrent  
> between   x-message-tll  and   x-dead-letter-exchange 

http://www.rabbitmq.com/ttl.html
http://www.rabbitmq.com/dlx.html

MK

Software Engineer, Pivotal/RabbitMQ



From emile at rabbitmq.com  Tue Nov  5 09:14:57 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 05 Nov 2013 09:14:57 +0000
Subject: [rabbitmq-discuss] Stomp, subscriptions, and forward slashes
In-Reply-To: <52782144.3090007@seegrid.com>
References: <527576F9.5040108@seegrid.com> <5277752A.5000307@rabbitmq.com>
	<52782144.3090007@seegrid.com>
Message-ID: <5278B711.4010101@rabbitmq.com>


Hi,

On 04/11/13 22:35, Brennan Sellner wrote:

> https://github.com/sockjs/sockjs-protocol/issues/74 makes it clear that
> SockJS (at least) doesn't yet support binary payloads.  What's not clear
> to me is whether rabbitmq_web_stomp does: is it worth fiddling around
> with SockJS replacements, or should I just bite the bullet and add a
> relay to re-encode everything going to and from the browser as base64?

The rabbitmq-stomp plugin can deal with arbitrary binary payloads as
required by the STOMP specification. rabbitmq-web-stomp is  thin layer
that passes arbitrary binary data back & forth without interpreting it,
so it should have no problem dealing with invalid UTF8.

I'm not sure whether base64-encoding is the best solution. It depends on
how much control you have over the browser and which SockJS transport is
selected.





-Emile




From simon at rabbitmq.com  Tue Nov  5 09:51:17 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 05 Nov 2013 09:51:17 +0000
Subject: [rabbitmq-discuss] Rabbit Cluster "hangs" on consumer
	disconnects
In-Reply-To: <0B8CD6850421B745BE39BC5C76019232A684354A@DDCEP50016.na.corp.mckesson.com>
References: <0B8CD6850421B745BE39BC5C76019232A683F5F6@DDCEP50016.na.corp.mckesson.com>,
	<5277847C.4010205@rabbitmq.com>
	<0B8CD6850421B745BE39BC5C76019232A684354A@DDCEP50016.na.corp.mckesson.com>
Message-ID: <5278BF95.6030102@rabbitmq.com>

On 04/11/2013 19:29, Cordell, Ron wrote:
>>> What happens if you attempt to shut down the service by issuing
>>> "rabbitmqctl stop" rather than stopping the Windows service?
>
> Ah, sorry for the confusion. We don't actually try to stop the
> RabbitMQ windows service instances - those stay running. We are
> shutting down the application Windows Service instances that rely on
> Rabbit, however.

And that alone causes RabbitMQ to become unresponsive? Is there anything 
in the regular or sasl logs from around this time (other than the 
connection_closed_abruptly things, which just indicate that the AMQP 
connection was closed before going through the AMQP close handshake)?

Cheers, Simon

From emile at rabbitmq.com  Tue Nov  5 10:12:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 05 Nov 2013 10:12:25 +0000
Subject: [rabbitmq-discuss] C# client connect using SSL
In-Reply-To: <OFB7820455.7EA078F2-ONC1257C19.004DD523-C1257C19.004F9031@schneider-electric.com>
References: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>
	<52779549.2070002@rabbitmq.com>
	<OFB7820455.7EA078F2-ONC1257C19.004DD523-C1257C19.004F9031@schneider-electric.com>
Message-ID: <5278C489.4010900@rabbitmq.com>


Hi,

On 04/11/13 14:29, michael.thorsoe at schneider-electric.com wrote:

> I just want to do the SSL connection and trust the server certificate
> without having to do any additional certificate installation on the
> clients side. Is that possible?


If you don't care about the server certificate then set the acceptable
policy errors appropriately, e.g.

 connectionFactory.Ssl.AcceptablePolicyErrors =
   System.Net.Security.SslPolicyErrors.RemoteCertificateChainErrors;





-Emile






From michael.thorsoe at schneider-electric.com  Tue Nov  5 12:26:34 2013
From: michael.thorsoe at schneider-electric.com (michael.thorsoe at schneider-electric.com)
Date: Tue, 5 Nov 2013 13:26:34 +0100
Subject: [rabbitmq-discuss] C# client connect using SSL
In-Reply-To: <5278C489.4010900@rabbitmq.com>
References: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>
	<52779549.2070002@rabbitmq.com>
	<OFB7820455.7EA078F2-ONC1257C19.004DD523-C1257C19.004F9031@schneider-electric.com>
	<5278C489.4010900@rabbitmq.com>
Message-ID: <OF50C8141A.44C35147-ONC1257C1A.0043FD78-C1257C1A.004459DC@schneider-electric.com>

I tried all possible combinations for the 
connectionFactory.Ssl.AcceptablePolicyErrors but same result.

It throws the "Authentication failed because the remote party has closed 
the transport stream." exception after calling
sslStream.AuthenticateAsClient()
in TcpUpgrade()

where the the sslOption.Certs is null since I don't have any.

I can not see the CertificateValidationCallback is beeing called

Br,
Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/7ab2ceae/attachment.htm>

From sekhar434145 at gmail.com  Tue Nov  5 13:10:33 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Tue, 5 Nov 2013 18:40:33 +0530
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
	RabbitMQ cluster?
Message-ID: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>

Hi Team,

We are using HAProxy as a load balancer in RabbitMQ cluster and we have
done the configuration and able to see the *stats, *where it will display
list of running nodes.
But, we want to know how to configure for connecting producer and consumers
and we working on Java client. Could anyone please share the sample
producer and consumer code which we can test via HAProxy load balancer.

Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/dba1b727/attachment.htm>

From mklishin at gopivotal.com  Tue Nov  5 13:14:40 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 5 Nov 2013 17:14:40 +0400
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
	RabbitMQ cluster?
In-Reply-To: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
Message-ID: <E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>


On 5 Nov 2013, at 17:10, Rajasekhar P <sekhar434145 at gmail.com> wrote:

> We are using HAProxy as a load balancer in RabbitMQ cluster and we have done the configuration and able to see the stats, where it will display list of running nodes.
> But, we want to know how to configure for connecting producer and consumers and we working on Java client. Could anyone please share the sample producer and consumer code which we can test via HAProxy load balancer.

The whole point of having a proxy is that clients don?t need to be aware of the cluster topology.

Your clients should connect to HAproxy. There is no difference to connecting to a Rabbit node directly.

MK

Software Engineer, Pivotal/RabbitMQ



From johanklijn1976 at gmail.com  Tue Nov  5 13:52:00 2013
From: johanklijn1976 at gmail.com (JohanKlijn)
Date: Tue, 5 Nov 2013 05:52:00 -0800 (PST)
Subject: [rabbitmq-discuss] Messages BasicReject-ed or BasicNack-ed are back
 in the queue after restarting RabbitMQ service
Message-ID: <1383659520778-31180.post@n5.nabble.com>

We are using RabbitMQ 2.8.1 using C#. We have a queue with durable messages.
When we Acknowledge a message, channel.BasicAck(deliveryTag, false), and
restart the RabbitMQ service the message acknowledge is will not appear any
more in the queue, as expected.

Now when we negative acknowledge a message, like this:

channel.BasicNack(deliveryTag, false, false);
or 
channel.BasicReject(deliveryTag, false);

and restart the service the messages negative acknowledged are back.
When I look at the status of the queue before the restart using:
rabbitmqctl list_queues name messages_ready messages_unacknowledged
There are no messages to be acknowledge and the NumberOfMessages =
NumberOfMessageBeforeNegAck ? NegAckMessages. And after the restart the
NumberOfMessages = NumberOfMessageBeforeNegAck.




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Messages-BasicReject-ed-or-BasicNack-ed-are-back-in-the-queue-after-restarting-RabbitMQ-service-tp31180.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue Nov  5 13:57:48 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 5 Nov 2013 17:57:48 +0400
Subject: [rabbitmq-discuss] rabbitmq nodedown - nodedown - Generic
	server rabbit_disk_monitor terminating
In-Reply-To: <CAFa8q3Z5GCEccmNzO4UwmXLwbXvdD7q8NxfKkhu8fkkrpe-T-g@mail.gmail.com>
References: <4e2b75de-0e07-4a4c-9ef2-e952fe2bea1a@googlegroups.com>
	<EC7BCDA6-DD12-4F7C-8491-8A5482432E69@rabbitmq.com>
	<CAFa8q3a89EB9bSzLqX1tGNATGYurJdcV4ZY82=fXP=iWTEhRtg@mail.gmail.com>
	<9ABF3D5F-69A4-4ED5-A7A8-B9EEB56DD699@gopivotal.com>
	<CAFa8q3Z5GCEccmNzO4UwmXLwbXvdD7q8NxfKkhu8fkkrpe-T-g@mail.gmail.com>
Message-ID: <2037F217-D5D7-43C4-85BF-77004D55E712@gopivotal.com>


On 31 Oct 2013, at 17:49, Michael Sander <mes65 at cornell.edu> wrote:

> Here is df:
> $ sudo /bin/df -kP /var/lib/rabbitmq/mnesia/
> Filesystem     1024-blocks    Used Available Capacity Mounted on
> /dev/root         10451916 6331368   3596312      64% /

Michael,

Can you please run rabbitmqctl eval 'rabbit_misc:os_cmd("/bin/df -kP
/var/lib/rabbitmq/mnesia/").? ?

Have you managed to su to rabbitmq and see if /bin/df output may be different?
Does the problem persist?

Thank you.
--
MK

Software Engineer, Pivotal/RabbitMQ


From matt at nextdoor.com  Tue Nov  5 17:06:08 2013
From: matt at nextdoor.com (Matt Wise)
Date: Tue, 5 Nov 2013 09:06:08 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Cluster - node hanging on
 join_cluster - mnesia reporting connection issues
In-Reply-To: <09127580-93c8-498f-a3ae-03897b99f571@googlegroups.com>
References: <972634e5-f3fd-48cd-a61f-d202e9329929@googlegroups.com>
	<09127580-93c8-498f-a3ae-03897b99f571@googlegroups.com>
Message-ID: <7c56a3c6-8dab-498f-9952-b6f98a242ad8@googlegroups.com>

I feel like I've seen similar behavior when multiple nodes in a RabbitMQ 
cluster are restarted at around the same time. I just posted last night 
about a similar outage we had with a 3 node cluster when two of the nodes 
were restarted at about the same time. Our post hasn't made it onto the 
list yet (moderated?) but hopefully it will today.

On Wednesday, October 9, 2013 1:43:19 PM UTC-7, Zach Austin wrote:
>
> The issue was resolved by restarting RabbitMQ on rabbit2.  Not sure why 
> this was required, especially after removing, resetting, and re-adding 
> rabbit1.
>
> On Wednesday, October 9, 2013 12:50:13 PM UTC-5, Zach Austin wrote:
>>
>> Hi All,
>>
>> We're having an issue getting one machine in our rabbit cluster back up 
>> and running after a reboot affected two of the 4 servers in the cluster.
>>
>> Here is the cluster layout:
>> rabbit1
>> rabbit2
>> rabbit3 (master)
>> rabbit4
>>
>> rabbit1 and rabbit2 were rebooted.  Rabbit2 successfully rejoined the 
>> cluster.  Rabbit1 did not.  Additionally, the rabbitMQ will no longer start 
>> on rabbit1.
>>
>> Reviewing the log on rabbit1, I find: Mnesia on 'rabbit1' could not 
>> connect to node(s) ['rabbit2']
>>
>> I can ping rabbit1 from rabbit2 and vice-versa.
>>
>> What I've done so far:
>> 1) Verified the erlang cookie values amongst all cluster nodes are 
>> identical
>> 2) Verified the windows firewall is disabled on all cluster nodes.
>> 2) Issued "rabbitmqctl forget_cluster_node rabbit1" on the rabbit3 master.
>> 2) Deleted the mnesia database on rabbit1.
>> 3) Successfully started RabbitMQ on rabbit1 (deleting mnesia DB did this).
>> 4) Issued "rabbitmqctl stop_app", followed by "rabbitmqctl join_cluster 
>> rabbit3".
>>
>> At this point, rabbitmqctl hangs after the "cluster node... with node... 
>> " line (I waited over 15 minutes).  Reviewing the log on rabbit1 again, I 
>> find the same issue logged: Mnesia on 'rabbit1' could not connect to 
>> node(s) ['rabbit2']
>>
>> Can anyone point me in the direction of what I should check next?
>>
>> Thank you.
>>
>> Zach
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/3139c99b/attachment.htm>

From matt at nextdoor.com  Tue Nov  5 17:06:08 2013
From: matt at nextdoor.com (Matt Wise)
Date: Tue, 5 Nov 2013 09:06:08 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Cluster - node hanging on
 join_cluster - mnesia reporting connection issues
In-Reply-To: <09127580-93c8-498f-a3ae-03897b99f571@googlegroups.com>
References: <972634e5-f3fd-48cd-a61f-d202e9329929@googlegroups.com>
	<09127580-93c8-498f-a3ae-03897b99f571@googlegroups.com>
Message-ID: <7c56a3c6-8dab-498f-9952-b6f98a242ad8@googlegroups.com>

I feel like I've seen similar behavior when multiple nodes in a RabbitMQ 
cluster are restarted at around the same time. I just posted last night 
about a similar outage we had with a 3 node cluster when two of the nodes 
were restarted at about the same time. Our post hasn't made it onto the 
list yet (moderated?) but hopefully it will today.

On Wednesday, October 9, 2013 1:43:19 PM UTC-7, Zach Austin wrote:
>
> The issue was resolved by restarting RabbitMQ on rabbit2.  Not sure why 
> this was required, especially after removing, resetting, and re-adding 
> rabbit1.
>
> On Wednesday, October 9, 2013 12:50:13 PM UTC-5, Zach Austin wrote:
>>
>> Hi All,
>>
>> We're having an issue getting one machine in our rabbit cluster back up 
>> and running after a reboot affected two of the 4 servers in the cluster.
>>
>> Here is the cluster layout:
>> rabbit1
>> rabbit2
>> rabbit3 (master)
>> rabbit4
>>
>> rabbit1 and rabbit2 were rebooted.  Rabbit2 successfully rejoined the 
>> cluster.  Rabbit1 did not.  Additionally, the rabbitMQ will no longer start 
>> on rabbit1.
>>
>> Reviewing the log on rabbit1, I find: Mnesia on 'rabbit1' could not 
>> connect to node(s) ['rabbit2']
>>
>> I can ping rabbit1 from rabbit2 and vice-versa.
>>
>> What I've done so far:
>> 1) Verified the erlang cookie values amongst all cluster nodes are 
>> identical
>> 2) Verified the windows firewall is disabled on all cluster nodes.
>> 2) Issued "rabbitmqctl forget_cluster_node rabbit1" on the rabbit3 master.
>> 2) Deleted the mnesia database on rabbit1.
>> 3) Successfully started RabbitMQ on rabbit1 (deleting mnesia DB did this).
>> 4) Issued "rabbitmqctl stop_app", followed by "rabbitmqctl join_cluster 
>> rabbit3".
>>
>> At this point, rabbitmqctl hangs after the "cluster node... with node... 
>> " line (I waited over 15 minutes).  Reviewing the log on rabbit1 again, I 
>> find the same issue logged: Mnesia on 'rabbit1' could not connect to 
>> node(s) ['rabbit2']
>>
>> Can anyone point me in the direction of what I should check next?
>>
>> Thank you.
>>
>> Zach
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/3139c99b/attachment-0001.htm>

From mklishin at gopivotal.com  Tue Nov  5 18:20:21 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 5 Nov 2013 22:20:21 +0400
Subject: [rabbitmq-discuss] RabbitMQ Cluster - node hanging on
	join_cluster - mnesia reporting connection issues
In-Reply-To: <7c56a3c6-8dab-498f-9952-b6f98a242ad8@googlegroups.com>
References: <972634e5-f3fd-48cd-a61f-d202e9329929@googlegroups.com>
	<09127580-93c8-498f-a3ae-03897b99f571@googlegroups.com>
	<7c56a3c6-8dab-498f-9952-b6f98a242ad8@googlegroups.com>
Message-ID: <46616A15-EAB1-49C2-9A1D-BC865778D98F@rabbitmq.com>


On 5 Nov 2013, at 21:06, Matt Wise <matt at nextdoor.com> wrote:

> Our post hasn't made it onto the list yet (moderated?) but hopefully it will today.

Matt,

If you post to rabbitmq-discussed directly, it should appear on the list nearly immediately
(or at least much faster). Google Groups is a mirror that may take up to a few days to sync.

MK

Software Engineer, Pivotal/RabbitMQ



From ahsin01 at gmail.com  Tue Nov  5 18:58:10 2013
From: ahsin01 at gmail.com (Alan Hsin)
Date: Tue, 5 Nov 2013 10:58:10 -0800 (PST)
Subject: [rabbitmq-discuss] Rabbitmq upgrade from 3.1.3 to 3.1.5/3.2.0
	Management issue
Message-ID: <9702e8cf-dd18-4fae-a644-2aa100e40130@googlegroups.com>

Hi there,
  We have encountered the issue when doing the upgrade.  Basically we will 
get internal server error from management site, therefore, we won't be able 
to see the queues/channels from <server>:15672.

  Here is the history, when I upgraded from 3.1.3 to 3.1.5 in RHEL, got the 
similar error and had to revert back to 3.1.3 in order work properly from 
management.  Now trying upgrading to 3.2.0, got the same error but this 
time when I reinstalled 3.1.3 back, rabbitmq server won't get started.




=ERROR REPORT==== 5-Nov-2013::12:34:59 ===
webmachine error: path="/api/definitions"
{error,{error,function_clause,
              [{orddict,find,
                        [vhost,
                         {dict,0,16,16,8,80,48,
                              
 {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                []},
                              
 {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
                                 []}}}]},
               {rabbit_mgmt_util,id0,2},
               {rabbit_mgmt_util,vhost,1},
               {rabbit_mgmt_util,all_or_one_vhost,2},
               {rabbit_mgmt_wm_exchanges,basic,1},
               {rabbit_mgmt_wm_definitions,to_json,2},
               {webmachine_resource,resource_call,3},
               {webmachine_resource,do,3}]}}


Need some hints or suggestions please.


RabbitMQ 3.2.0, Erlang R14B04
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/fb4b002f/attachment.htm>

From mklishin at gopivotal.com  Tue Nov  5 20:11:04 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 00:11:04 +0400
Subject: [rabbitmq-discuss] Rabbitmq upgrade from 3.1.3 to 3.1.5/3.2.0
	Management issue
In-Reply-To: <9702e8cf-dd18-4fae-a644-2aa100e40130@googlegroups.com>
References: <9702e8cf-dd18-4fae-a644-2aa100e40130@googlegroups.com>
Message-ID: <C63B037D-A1AA-4DB6-8C5F-80536E72C4F0@rabbitmq.com>

On 5 Nov 2013, at 22:58, Alan Hsin <ahsin01 at gmail.com> wrote:

> =ERROR REPORT==== 5-Nov-2013::12:34:59 ===
> webmachine error: path="/api/definitions"
> {error,{error,function_clause,
>               [{orddict,find,
>                         [vhost,
>                          {dict,0,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []}}}]},
>                {rabbit_mgmt_util,id0,2},
>                {rabbit_mgmt_util,vhost,1},
>                {rabbit_mgmt_util,all_or_one_vhost,2},
>                {rabbit_mgmt_wm_exchanges,basic,1},
>                {rabbit_mgmt_wm_definitions,to_json,2},
>                {webmachine_resource,resource_call,3},
>                {webmachine_resource,do,3}]}}
> 
> 
> Need some hints or suggestions please.

What HTTP API requests do you issue?

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Tue Nov  5 20:29:32 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 00:29:32 +0400
Subject: [rabbitmq-discuss] Rabbitmq upgrade from 3.1.3 to 3.1.5/3.2.0
	Management issue
In-Reply-To: <9702e8cf-dd18-4fae-a644-2aa100e40130@googlegroups.com>
References: <9702e8cf-dd18-4fae-a644-2aa100e40130@googlegroups.com>
Message-ID: <DE5B25F0-86AC-4C69-807E-E0103BED07F4@rabbitmq.com>

On 5 Nov 2013, at 22:58, Alan Hsin <ahsin01 at gmail.com> wrote:

> Need some hints or suggestions please.

If you access management UI via browser, try purging browser cache and try again (with 3.2.0).

Do you see the same exception if you GET /api/definitions with a different HTTP client,
e.g. curl -u guest:guest http://@[hostname]:15672/api/definitions?

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Tue Nov  5 20:42:35 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 00:42:35 +0400
Subject: [rabbitmq-discuss] Rabbitmq upgrade from 3.1.3 to 3.1.5/3.2.0
	Management issue
In-Reply-To: <9702e8cf-dd18-4fae-a644-2aa100e40130@googlegroups.com>
References: <9702e8cf-dd18-4fae-a644-2aa100e40130@googlegroups.com>
Message-ID: <01DA5FF4-7713-40E1-A102-6100B40BD52F@rabbitmq.com>

On 5 Nov 2013, at 22:58, Alan Hsin <ahsin01 at gmail.com> wrote:

> =ERROR REPORT==== 5-Nov-2013::12:34:59 ===
> webmachine error: path="/api/definitions"
> {error,{error,function_clause,
>               [{orddict,find,
>                         [vhost,
>                          {dict,0,16,16,8,80,48,
>                                {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                 []},
>                                {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
>                                  []}}}]},
>                {rabbit_mgmt_util,id0,2},
>                {rabbit_mgmt_util,vhost,1},
>                {rabbit_mgmt_util,all_or_one_vhost,2},
>                {rabbit_mgmt_wm_exchanges,basic,1},
>                {rabbit_mgmt_wm_definitions,to_json,2},
>                {webmachine_resource,resource_call,3},
>                {webmachine_resource,do,3}]}}

We traced it down to this Webmachine change:
https://github.com/basho/webmachine/commit/d7dbbddeb9e6a9a415f7a7f09261dfcd3c2bd001

RabbitMQ management plugin bundles its own version of Webmachine. Can it be that you
somehow have another copy on the global Erlang load path? (wrq.beam)

There were reports of similar issues earlier and uninstalling a system-wide package
that was included into Erlang code path helped, e.g.

http://markmail.org/thread/mdi4ga635gljvgws

MK

Software Engineer, Pivotal/RabbitMQ



From jcua at eventbrite.com  Tue Nov  5 21:24:11 2013
From: jcua at eventbrite.com (Jonathan Cua)
Date: Tue, 5 Nov 2013 13:24:11 -0800
Subject: [rabbitmq-discuss] Durable Queues Crash
Message-ID: <948F60AA-9750-4942-91A2-58FFB2330E16@eventbrite.com>

I am evaluating Rabbitmq 3.2.0 in Ubuntu 12.04. I have set up a 2 node cluster.

From time to time (around a couple of hours after the cluster has been set up), I would get this error in the sasl.log. Note: I am not able to reproduce this issue.

=CRASH REPORT==== 5-Nov-2013::12:34:51 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.6024.14>
    registered_name: []
    exception exit: {{badmatch,true},
                     [{rabbit_queue_index,init,2},
                      {rabbit_variable_queue,init,5},
                      {rabbit_mirror_queue_master,init,3},
                      {rabbit_amqqueue_process,declare,3},
                      {gen_server2,handle_msg,2},
                      {proc_lib,init_p_do_apply,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,<0.4763.12>]
    messages: []
    links: [<0.4951.12>]
    dictionary: [{{xtype_to_module,direct},rabbit_exchange_type_direct}]
    trap_exit: true
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 1198
  neighbours:

=SUPERVISOR REPORT==== 5-Nov-2013::12:34:51 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {{badmatch,true},
                  [{rabbit_queue_index,init,2},
                   {rabbit_variable_queue,init,5},
                   {rabbit_mirror_queue_master,init,3},
                   {rabbit_amqqueue_process,declare,3},
                   {gen_server2,handle_msg,2},
                   {proc_lib,init_p_do_apply,3}]}
     Offender:   [{pid,<0.6024.14>},
                  {name,rabbit_amqqueue},
                  {mfargs,{rabbit_amqqueue_process,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]

And in the web UI, the queue will show up like this.




Then if I click on the queue on the UI, I will get this error/warning.

TypeError: Cannot read property 'ram_msg_count' of undefined


And if I do this on the command-line and grab the queue in question, I will get this incomplete data (as opposed to the info of other queues).

$ curl http://guest:guest at localhost:15672/api/queues

    {
        "arguments": {
            "x-ha-policy": "all"
        },
        "auto_delete": false,
        "durable": true,
        "name": "test_queue",
        "node": "rabbit at localhost",
        "vhost": "/"
    },


Also, if I do this, the queue in question will not show up.

$ sudo rabbitmqctl list_queues


But if I try to declare a queue like this,

$ ./rabbitmqadmin declare queue name=test_queue

or 

$ ./rabbitmqadmin delete queue name=test_queue

Both commands will just hang.


So, I would like to know what the traceback mean and possible way to fix it.


Thanks,
Jonathan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/a4e45561/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screen Shot 2013-11-05 at 1.03.04 PM.png
Type: image/png
Size: 5624 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/a4e45561/attachment.png>

From matt at nextdoor.com  Tue Nov  5 22:05:28 2013
From: matt at nextdoor.com (Matt Wise)
Date: Tue, 5 Nov 2013 14:05:28 -0800
Subject: [rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster
Message-ID: <CAOHkZxOYjFQOB2xW0E921SJiag3oh0m6+R9qbu=gWxwa+YTXLg@mail.gmail.com>

(sorry if this gets posted twice.. first email never seemed to make it to
the list)

Hey... I had a pretty rough time today with a 3-node RabbitMQ 3.1.3 cluster
thats under pretty heavy use (6-7 million messages per day -- 100MB peak
bandwidth per node). I want to pose a few questions here. First off, here's
the basic configuration though.

Configuration:
  serverA, serverB and serverC are all configured with RabbitMQ 3.1.3. They
each are configured via Puppet ... and Puppet uses a dynamic node discovery
plugin (zookeeper) to find the nodes. The node lists are hard-coded into
the rabbitmq.config file. A dynamic server list generator supplies Puppet
with this list of servers (and is not really necessary to describe here in
this email).

Scenario:
  A momentary configuration blip caused serverA and serverB to begin
reconfiguring their rabbitmq.config files... when they did this, they also
both issued a 'service rabbitmq restart' command. This command took
40+minutes and ultimately failed. During this failure, RabbitMQ was
technically running and accepting connections to the TCP ports ... but it
would not actually answer any queries. Commands like list_queues would hang
indefinitely.

Questions:
  1. We only had ~2500 messages in the queues (they are HA'd and durable).
The policy is { 'ha-mode': 'all' }. When serverA and serverB restarted, why
did they never come up? Unfortunately in the restart process, they blew
away their log files as well which makes this really tough to troubleshoot.

  2. I know that restarting serverA and serverB at nearly the same time is
obviously a bad idea -- we'll be implementing some changes so this doesn't
happen again -- but could this have lead to data corruption? Once the
entire RabbitMQ farm was shut down, we actually were forced to move the
rabbitmq data directory out of the way and start up the farm completely
with blank databases. It seemed that RabbitMQ 3.1.3 really did not want to
recover from this failure. Any thoughts?

  3. Lastly .. in the event of future failures, what tools are there for
recovering our Mnesia databases? Is there any way we can dump out the data
into some raw form, and then import it back into a new fresh cluster?

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/f64c2f36/attachment.htm>

From matthias at rabbitmq.com  Tue Nov  5 23:33:01 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 05 Nov 2013 23:33:01 +0000
Subject: [rabbitmq-discuss] Durable Queues Crash
In-Reply-To: <948F60AA-9750-4942-91A2-58FFB2330E16@eventbrite.com>
References: <948F60AA-9750-4942-91A2-58FFB2330E16@eventbrite.com>
Message-ID: <5279802D.3010704@rabbitmq.com>

Jonathan,

On 05/11/13 21:24, Jonathan Cua wrote:
>  From time to time (around a couple of hours after the cluster has been
> set up), I would get this error in the sasl.log. [...]

Did either of the two nodes get restarted during those two hours?

Also, do you see any errors in the sasl logs prior to the ones you posted?

Matthias.

From jcua at eventbrite.com  Tue Nov  5 23:47:32 2013
From: jcua at eventbrite.com (Jonathan Cua)
Date: Tue, 5 Nov 2013 15:47:32 -0800
Subject: [rabbitmq-discuss] Durable Queues Crash
In-Reply-To: <5279802D.3010704@rabbitmq.com>
References: <948F60AA-9750-4942-91A2-58FFB2330E16@eventbrite.com>
	<5279802D.3010704@rabbitmq.com>
Message-ID: <13257F62-D1AE-44E0-93ED-2BFECFF8DB27@eventbrite.com>

No, the nodes did not get restarted.

There is nothing in the sasl logs prior to the ones that I posted.

Jonathan

On Nov 5, 2013, at 3:33 PM, Matthias Radestock wrote:

> Jonathan,
> 
> On 05/11/13 21:24, Jonathan Cua wrote:
>> From time to time (around a couple of hours after the cluster has been
>> set up), I would get this error in the sasl.log. [...]
> 
> Did either of the two nodes get restarted during those two hours?
> 
> Also, do you see any errors in the sasl logs prior to the ones you posted?
> 
> Matthias.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From jcua at eventbrite.com  Wed Nov  6 01:14:58 2013
From: jcua at eventbrite.com (Jonathan Cua)
Date: Tue, 5 Nov 2013 17:14:58 -0800
Subject: [rabbitmq-discuss] Durable Queues Crash
In-Reply-To: <13257F62-D1AE-44E0-93ED-2BFECFF8DB27@eventbrite.com>
References: <948F60AA-9750-4942-91A2-58FFB2330E16@eventbrite.com>
	<5279802D.3010704@rabbitmq.com>
	<13257F62-D1AE-44E0-93ED-2BFECFF8DB27@eventbrite.com>
Message-ID: <E6DE9F52-AB49-4234-AF62-EC56747C338D@eventbrite.com>

Just to clarify, these crashes happens over and over, but we can't figure out what causes it or when the next crash will happen, all we are doing is running Celery as the consumer like usual. In the past we are using Rabbitmq 2.8.7 (Ubuntu 10.04) and we do not see this issue at all.

Actually looking at the sasl.log again, I see this prior to the first crash.

=CRASH REPORT==== 5-Nov-2013::12:31:47 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.13824.12>
    registered_name: []
    exception exit: {{badmatch,{error,not_found}},
                     [{rabbit_mirror_queue_master,stop_all_slaves,2},
                      {rabbit_mirror_queue_master,delete_and_terminate,2},
                      {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6},
                      {rabbit_amqqueue_process,terminate_shutdown,2},
                      {gen_server2,terminate,3},
                      {proc_lib,wake_up,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,<0.4763.12>]
    messages: []
    links: [<0.4951.12>,<0.13825.12>,#Port<0.149843>]
    dictionary: [{{xtype_to_module,direct},rabbit_exchange_type_direct},
                  {delegate,delegate_1},
                  {{ch,<22460.3466.13>},
                   {cr,<22460.3466.13>,#Ref<0.0.8.129430>,
                       {[13247,13244],[13229,13232]},
                       1,
...

trap_exit: true
    status: running
    heap_size: 317811
    stack_size: 24
    reductions: 12808667
  neighbours:
    neighbour: [{pid,<0.13826.12>},
                  {registered_name,[]},
                  {initial_call,{gen,init_it,
                                     ['Argument__1','Argument__2',
                                      'Argument__3','Argument__4',
                                      'Argument__5','Argument__6']}},
                  {current_function,{gen_server2,process_next_msg,1}},
                  {ancestors,[<0.13825.12>,<0.13824.12>,rabbit_amqqueue_sup,
                              rabbit_sup,<0.4763.12>]},
                  {messages,[]},
                  {links,[<0.13825.12>]},
                  {dictionary,[{random_seed,{1383,15776,4002}}]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,610},
                  {stack_size,7},
                  {reductions,10939697}]
    neighbour: [{pid,<0.13825.12>},
                  {registered_name,[]},
                  {initial_call,{gen,init_it,
                                     ['Argument__1','Argument__2',
                                      'Argument__3','Argument__4',
                                      'Argument__5','Argument__6']}},
                  {current_function,{gen_server2,process_next_msg,1}},
                  {ancestors,[<0.13824.12>,rabbit_amqqueue_sup,rabbit_sup,
                              <0.4763.12>]},
                  {messages,[]},
                  {links,[<0.13824.12>,<0.13826.12>]},
                  {dictionary,[]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,610},
                  {stack_size,7},
                  {reductions,1868}]

=SUPERVISOR REPORT==== 5-Nov-2013::12:31:47 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {{badmatch,{error,not_found}},
                  [{rabbit_mirror_queue_master,stop_all_slaves,2},
                   {rabbit_mirror_queue_master,delete_and_terminate,2},
                   {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6},
                   {rabbit_amqqueue_process,terminate_shutdown,2},
                   {gen_server2,terminate,3},
                   {proc_lib,wake_up,3}]}
     Offender:   [{pid,<0.13824.12>},
                  {name,rabbit_amqqueue},
                  {mfargs,{rabbit_amqqueue_process,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]


And sometimes we would get this variation of another 'crash'...

=CRASH REPORT==== 5-Nov-2013::14:47:59 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.2803.0>
    registered_name: []
    exception exit: {function_clause,
                        [{rabbit_mirror_queue_slave,forget_sender,
                             [down_from_gm,down_from_gm]},
                         {rabbit_mirror_queue_slave,maybe_forget_sender,3},
                         {rabbit_mirror_queue_slave,process_instruction,2},
                         {rabbit_mirror_queue_slave,handle_cast,2},
                         {gen_server2,handle_msg,2},
                         {proc_lib,wake_up,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_mirror_queue_slave_sup,rabbit_sup,<0.99.0>]
    messages: [{'EXIT',<0.2804.0>,normal},
                  {'DOWN',
                      {delegate_9,<22460.25536.1>},
                      process,<22460.25536.1>,noproc},
                  {'$gen_cast',
                      {run_backing_queue,rabbit_variable_queue,
                          #Fun<rabbit_variable_queue.26.70600163>}},
                  {'$gen_cast',
                      {run_backing_queue,rabbit_variable_queue,
                          #Fun<rabbit_variable_queue.27.5764429>}}]
    links: [<0.297.0>]
    dictionary: [{credit_blocked,[]},
                  {{xtype_to_module,direct},rabbit_exchange_type_direct},
                  {delegate,delegate_9},
                  {fhc_age_tree,{0,nil}},
                  {{credit_from,<0.289.0>},1902},
                  {guid,{{1685981799,1034401634,624789925,1597815233},1}}]
    trap_exit: true
    status: running
    heap_size: 6765
    stack_size: 24
    reductions: 121868
  neighbours:

=SUPERVISOR REPORT==== 5-Nov-2013::14:47:59 ===
     Supervisor: {local,
                                           rabbit_mirror_queue_slave_sup}
     Context:    child_terminated
     Reason:     {function_clause,
                     [{rabbit_mirror_queue_slave,forget_sender,
                          [down_from_gm,down_from_gm]},
                      {rabbit_mirror_queue_slave,maybe_forget_sender,3},
                      {rabbit_mirror_queue_slave,process_instruction,2},
                      {rabbit_mirror_queue_slave,handle_cast,2},
                      {gen_server2,handle_msg,2},
                      {proc_lib,wake_up,3}]}
     Offender:   [{pid,<0.2803.0>},
                  {name,rabbit_mirror_queue_slave},
                  {mfargs,{rabbit_mirror_queue_slave,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]


Thanks,
Jonathan


On Nov 5, 2013, at 3:47 PM, Jonathan Cua wrote:

> No, the nodes did not get restarted.
> 
> There is nothing in the sasl logs prior to the ones that I posted.
> 
> Jonathan
> 
> On Nov 5, 2013, at 3:33 PM, Matthias Radestock wrote:
> 
>> Jonathan,
>> 
>> On 05/11/13 21:24, Jonathan Cua wrote:
>>> From time to time (around a couple of hours after the cluster has been
>>> set up), I would get this error in the sasl.log. [...]
>> 
>> Did either of the two nodes get restarted during those two hours?
>> 
>> Also, do you see any errors in the sasl logs prior to the ones you posted?
>> 
>> Matthias.
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/6d52297d/attachment.htm>

From sekhar434145 at gmail.com  Wed Nov  6 05:23:44 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Wed, 6 Nov 2013 10:53:44 +0530
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
 RabbitMQ cluster?
In-Reply-To: <E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
Message-ID: <CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>

Thanks for the response. We are new to using HAProxy and done the HAProxy
setup as per the Rabbit_In_Action.pdf documentation. Here, HAProxy is
installed in Linux and two RabbitMQ nodes are running in two different
windows machines in cluster.

If we are not making any changes related to HAProxy in producer and
consumer code, how does load balancing will work. could you please tell me?

Thank you.


On Tue, Nov 5, 2013 at 6:44 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

>
> On 5 Nov 2013, at 17:10, Rajasekhar P <sekhar434145 at gmail.com> wrote:
>
> > We are using HAProxy as a load balancer in RabbitMQ cluster and we have
> done the configuration and able to see the stats, where it will display
> list of running nodes.
> > But, we want to know how to configure for connecting producer and
> consumers and we working on Java client. Could anyone please share the
> sample producer and consumer code which we can test via HAProxy load
> balancer.
>
> The whole point of having a proxy is that clients don?t need to be aware
> of the cluster topology.
>
> Your clients should connect to HAproxy. There is no difference to
> connecting to a Rabbit node directly.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/d9acec36/attachment.htm>

From marutha.tech at gmail.com  Wed Nov  6 05:33:39 2013
From: marutha.tech at gmail.com (Maruthavanan Subbarayan)
Date: Wed, 6 Nov 2013 11:03:39 +0530
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
 RabbitMQ cluster?
In-Reply-To: <CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
Message-ID: <CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>

Hi

The load balancing should be taken care by HAproxy. Both producers and
consumers should point to HAproxy.

Thanks
Marutha
On Nov 6, 2013 10:55 AM, "Rajasekhar P" <sekhar434145 at gmail.com> wrote:

> Thanks for the response. We are new to using HAProxy and done the HAProxy
> setup as per the Rabbit_In_Action.pdf documentation. Here, HAProxy is
> installed in Linux and two RabbitMQ nodes are running in two different
> windows machines in cluster.
>
> If we are not making any changes related to HAProxy in producer and
> consumer code, how does load balancing will work. could you please tell me?
>
> Thank you.
>
>
> On Tue, Nov 5, 2013 at 6:44 PM, Michael Klishin <mklishin at gopivotal.com>wrote:
>
>>
>> On 5 Nov 2013, at 17:10, Rajasekhar P <sekhar434145 at gmail.com> wrote:
>>
>> > We are using HAProxy as a load balancer in RabbitMQ cluster and we have
>> done the configuration and able to see the stats, where it will display
>> list of running nodes.
>> > But, we want to know how to configure for connecting producer and
>> consumers and we working on Java client. Could anyone please share the
>> sample producer and consumer code which we can test via HAProxy load
>> balancer.
>>
>> The whole point of having a proxy is that clients don?t need to be aware
>> of the cluster topology.
>>
>> Your clients should connect to HAproxy. There is no difference to
>> connecting to a Rabbit node directly.
>>
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/3f497329/attachment.htm>

From michael.thorsoe at schneider-electric.com  Wed Nov  6 07:54:46 2013
From: michael.thorsoe at schneider-electric.com (michael.thorsoe at schneider-electric.com)
Date: Wed, 6 Nov 2013 08:54:46 +0100
Subject: [rabbitmq-discuss] C# client connect using SSL
In-Reply-To: <OF50C8141A.44C35147-ONC1257C1A.0043FD78-C1257C1A.004459DC@schneider-electric.com>
References: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>
	<52779549.2070002@rabbitmq.com>	<OFB7820455.7EA078F2-ONC1257C19.004DD523-C1257C19.004F9031@schneider-electric.com>
	<5278C489.4010900@rabbitmq.com>
	<OF50C8141A.44C35147-ONC1257C1A.0043FD78-C1257C1A.004459DC@schneider-electric.com>
Message-ID: <OF7D359624.AE7F964F-ONC1257C1B.002B355A-C1257C1B.002B776C@schneider-electric.com>

I modified the function TcpUpgrade() in the RabbitMQ.Client.dll and it's 
now happy to connect without any certificates installed on the client 
side.

Br,
Michael Thorsoe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/5b75e68a/attachment.htm>

From matthias at rabbitmq.com  Wed Nov  6 08:11:12 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 06 Nov 2013 08:11:12 +0000
Subject: [rabbitmq-discuss] C# client connect using SSL
In-Reply-To: <OF7D359624.AE7F964F-ONC1257C1B.002B355A-C1257C1B.002B776C@schneider-electric.com>
References: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>	<52779549.2070002@rabbitmq.com>	<OFB7820455.7EA078F2-ONC1257C19.004DD523-C1257C19.004F9031@schneider-electric.com>	<5278C489.4010900@rabbitmq.com>	<OF50C8141A.44C35147-ONC1257C1A.0043FD78-C1257C1A.004459DC@schneider-electric.com>
	<OF7D359624.AE7F964F-ONC1257C1B.002B355A-C1257C1B.002B776C@schneider-electric.com>
Message-ID: <5279F9A0.9080604@rabbitmq.com>

On 06/11/13 07:54, michael.thorsoe at schneider-electric.com wrote:
> I modified the function TcpUpgrade() in the RabbitMQ.Client.dll

What did you change?

Matthias.

From simon at rabbitmq.com  Wed Nov  6 08:22:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Nov 2013 08:22:45 +0000
Subject: [rabbitmq-discuss] Durable Queues Crash
In-Reply-To: <E6DE9F52-AB49-4234-AF62-EC56747C338D@eventbrite.com>
References: <948F60AA-9750-4942-91A2-58FFB2330E16@eventbrite.com>
	<5279802D.3010704@rabbitmq.com>
	<13257F62-D1AE-44E0-93ED-2BFECFF8DB27@eventbrite.com>
	<E6DE9F52-AB49-4234-AF62-EC56747C338D@eventbrite.com>
Message-ID: <5279FC55.50107@rabbitmq.com>

On 06/11/2013 01:14, Jonathan Cua wrote:
> Actually looking at the sasl.log again, I see this prior to the first crash.
>
> =CRASH REPORT==== 5-Nov-2013::12:31:47 ===
>    crasher:
>      initial call: gen:init_it/6
>      pid: <0.13824.12>
>      registered_name: []
>      exception exit: {{badmatch,{error,not_found}},
>                       [{rabbit_mirror_queue_master,stop_all_slaves,2},
>                        {rabbit_mirror_queue_master,delete_and_terminate,2},

<snip>

> And sometimes we would get this variation of another 'crash'...
>
> =CRASH REPORT==== 5-Nov-2013::14:47:59 ===
>    crasher:
>      initial call: gen:init_it/6
>      pid: <0.2803.0>
>      registered_name: []
>      exception exit: {function_clause,
>                          [{rabbit_mirror_queue_slave,forget_sender,
>                               [down_from_gm,down_from_gm]},
>                           {rabbit_mirror_queue_slave,maybe_forget_sender,3},
>                           {rabbit_mirror_queue_slave,process_instruction,2},
>                           {rabbit_mirror_queue_slave,handle_cast,2},
>                           {gen_server2,handle_msg,2},
>                           {proc_lib,wake_up,3}]}

These are both known issues, fixed in nightly builds (and will be fixed 
in 3.2.1).

Cheers, Simon


From michael.thorsoe at schneider-electric.com  Wed Nov  6 08:26:04 2013
From: michael.thorsoe at schneider-electric.com (michael.thorsoe at schneider-electric.com)
Date: Wed, 6 Nov 2013 09:26:04 +0100
Subject: [rabbitmq-discuss] C# client connect using SSL
In-Reply-To: <OF7D359624.AE7F964F-ONC1257C1B.002B355A-C1257C1B.002B776C@schneider-electric.com>
References: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>
	<52779549.2070002@rabbitmq.com>	<OFB7820455.7EA078F2-ONC1257C19.004DD523-C1257C19.004F9031@schneider-electric.com>
	<5278C489.4010900@rabbitmq.com>	<OF50C8141A.44C35147-ONC1257C1A.0043FD78-C1257C1A.004459DC@schneider-electric.com>
	<OF7D359624.AE7F964F-ONC1257C1B.002B355A-C1257C1B.002B776C@schneider-electric.com>
Message-ID: <OF627FBA8D.62B60BDF-ONC1257C1B.002E1829-C1257C1B.002E5511@schneider-electric.com>

I changed the TcpUpgrade() to call the 
sslStream.AuthenticateAsClient(sslOption.ServerName); if no 
sslOption.Certs present

Br,
Michael Thorsoe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/056acc7a/attachment.htm>

From mklishin at gopivotal.com  Wed Nov  6 08:26:32 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 12:26:32 +0400
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
	RabbitMQ cluster?
In-Reply-To: <CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
Message-ID: <6E017ABD-34A5-452C-9B7D-A05F6B21EE73@rabbitmq.com>


On 6 Nov 2013, at 09:23, Rajasekhar P <sekhar434145 at gmail.com> wrote:

> If we are not making any changes related to HAProxy in producer and consumer code, how does load balancing will work. could you please tell me? 

HAproxy has pretty solid documentation.

MK

Software Engineer, Pivotal/RabbitMQ



From sekhar434145 at gmail.com  Wed Nov  6 08:55:45 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Wed, 6 Nov 2013 14:25:45 +0530
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
 RabbitMQ cluster?
In-Reply-To: <CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
	<CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>
Message-ID: <CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>

Thanks Marutha for the reply. Here, HAProxy is running on xxx.xxx.xxx.xxx
machine and listening port is 5720 . While getting the connection at
producer and consumer end, do we need to use this ip address or IP
addresses where RabbitMQ nodes are running in cluster?

CachingConnectionFactory connectionFactory = new CachingConnectionFactory(
"xxx.xxx.xxx.xxx");

(OR)

CachingConnectionFactory connectionFactory = new CachingConnectionFactory();
connectionFactory.setAddresses("ip_addr2:5672,ip_addr2:5672");


Thanks in advance.


On Wed, Nov 6, 2013 at 11:03 AM, Maruthavanan Subbarayan <
marutha.tech at gmail.com> wrote:

> Hi
>
> The load balancing should be taken care by HAproxy. Both producers and
> consumers should point to HAproxy.
>
> Thanks
> Marutha
> On Nov 6, 2013 10:55 AM, "Rajasekhar P" <sekhar434145 at gmail.com> wrote:
>
>> Thanks for the response. We are new to using HAProxy and done the HAProxy
>> setup as per the Rabbit_In_Action.pdf documentation. Here, HAProxy is
>> installed in Linux and two RabbitMQ nodes are running in two different
>> windows machines in cluster.
>>
>> If we are not making any changes related to HAProxy in producer and
>> consumer code, how does load balancing will work. could you please tell me?
>>
>> Thank you.
>>
>>
>> On Tue, Nov 5, 2013 at 6:44 PM, Michael Klishin <mklishin at gopivotal.com>wrote:
>>
>>>
>>> On 5 Nov 2013, at 17:10, Rajasekhar P <sekhar434145 at gmail.com> wrote:
>>>
>>> > We are using HAProxy as a load balancer in RabbitMQ cluster and we
>>> have done the configuration and able to see the stats, where it will
>>> display list of running nodes.
>>> > But, we want to know how to configure for connecting producer and
>>> consumers and we working on Java client. Could anyone please share the
>>> sample producer and consumer code which we can test via HAProxy load
>>> balancer.
>>>
>>> The whole point of having a proxy is that clients don?t need to be aware
>>> of the cluster topology.
>>>
>>> Your clients should connect to HAproxy. There is no difference to
>>> connecting to a Rabbit node directly.
>>>
>>> MK
>>>
>>> Software Engineer, Pivotal/RabbitMQ
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/297bc9aa/attachment.htm>

From brett.r.cameron at gmail.com  Wed Nov  6 09:12:18 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Wed, 6 Nov 2013 22:12:18 +1300
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
 RabbitMQ cluster?
In-Reply-To: <CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
	<CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>
	<CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>
Message-ID: <CALPqkiofqiJTpSOGtr-iYHqJ5hTt5Huc0_vLENm_29k-OyYYnQ@mail.gmail.com>

As Michael says, connect your clients (producers and consumers) to HAProxy.


On Wed, Nov 6, 2013 at 9:55 PM, Rajasekhar P <sekhar434145 at gmail.com> wrote:

> Thanks Marutha for the reply. Here, HAProxy is running on xxx.xxx.xxx.xxx
> machine and listening port is 5720 . While getting the connection at
> producer and consumer end, do we need to use this ip address or IP
> addresses where RabbitMQ nodes are running in cluster?
>
> CachingConnectionFactory connectionFactory = new CachingConnectionFactory(
> "xxx.xxx.xxx.xxx");
>
> (OR)
>
> CachingConnectionFactory connectionFactory = new
> CachingConnectionFactory();
> connectionFactory.setAddresses("ip_addr2:5672,ip_addr2:5672");
>
>
> Thanks in advance.
>
>
> On Wed, Nov 6, 2013 at 11:03 AM, Maruthavanan Subbarayan <
> marutha.tech at gmail.com> wrote:
>
>> Hi
>>
>> The load balancing should be taken care by HAproxy. Both producers and
>> consumers should point to HAproxy.
>>
>> Thanks
>> Marutha
>> On Nov 6, 2013 10:55 AM, "Rajasekhar P" <sekhar434145 at gmail.com> wrote:
>>
>>> Thanks for the response. We are new to using HAProxy and done the
>>> HAProxy setup as per the Rabbit_In_Action.pdf documentation. Here, HAProxy
>>> is installed in Linux and two RabbitMQ nodes are running in two different
>>> windows machines in cluster.
>>>
>>> If we are not making any changes related to HAProxy in producer and
>>> consumer code, how does load balancing will work. could you please tell me?
>>>
>>> Thank you.
>>>
>>>
>>> On Tue, Nov 5, 2013 at 6:44 PM, Michael Klishin <mklishin at gopivotal.com>wrote:
>>>
>>>>
>>>> On 5 Nov 2013, at 17:10, Rajasekhar P <sekhar434145 at gmail.com> wrote:
>>>>
>>>> > We are using HAProxy as a load balancer in RabbitMQ cluster and we
>>>> have done the configuration and able to see the stats, where it will
>>>> display list of running nodes.
>>>> > But, we want to know how to configure for connecting producer and
>>>> consumers and we working on Java client. Could anyone please share the
>>>> sample producer and consumer code which we can test via HAProxy load
>>>> balancer.
>>>>
>>>> The whole point of having a proxy is that clients don?t need to be
>>>> aware of the cluster topology.
>>>>
>>>> Your clients should connect to HAproxy. There is no difference to
>>>> connecting to a Rabbit node directly.
>>>>
>>>> MK
>>>>
>>>> Software Engineer, Pivotal/RabbitMQ
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/91835a49/attachment.htm>

From marutha.tech at gmail.com  Wed Nov  6 09:34:21 2013
From: marutha.tech at gmail.com (Maruthavanan Subbarayan)
Date: Wed, 6 Nov 2013 15:04:21 +0530
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
 RabbitMQ cluster?
In-Reply-To: <CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
	<CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>
	<CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>
Message-ID: <CAN+AGk23+f3FMfp8S4iW-+uQX5SnMzcOWQn-iwGhVY3sqfFRVQ@mail.gmail.com>

Hi

You should be using xxx.xxx.xxx.xxx:5720 and haproxy will tkae care if
configured

Thanks
Marutha
On Nov 6, 2013 2:27 PM, "Rajasekhar P" <sekhar434145 at gmail.com> wrote:

> Thanks Marutha for the reply. Here, HAProxy is running on xxx.xxx.xxx.xxx
> machine and listening port is 5720 . While getting the connection at
> producer and consumer end, do we need to use this ip address or IP
> addresses where RabbitMQ nodes are running in cluster?
>
> CachingConnectionFactory connectionFactory = new CachingConnectionFactory(
> "xxx.xxx.xxx.xxx");
>
> (OR)
>
> CachingConnectionFactory connectionFactory = new
> CachingConnectionFactory();
> connectionFactory.setAddresses("ip_addr2:5672,ip_addr2:5672");
>
>
> Thanks in advance.
>
>
> On Wed, Nov 6, 2013 at 11:03 AM, Maruthavanan Subbarayan <
> marutha.tech at gmail.com> wrote:
>
>> Hi
>>
>> The load balancing should be taken care by HAproxy. Both producers and
>> consumers should point to HAproxy.
>>
>> Thanks
>> Marutha
>> On Nov 6, 2013 10:55 AM, "Rajasekhar P" <sekhar434145 at gmail.com> wrote:
>>
>>> Thanks for the response. We are new to using HAProxy and done the
>>> HAProxy setup as per the Rabbit_In_Action.pdf documentation. Here, HAProxy
>>> is installed in Linux and two RabbitMQ nodes are running in two different
>>> windows machines in cluster.
>>>
>>> If we are not making any changes related to HAProxy in producer and
>>> consumer code, how does load balancing will work. could you please tell me?
>>>
>>> Thank you.
>>>
>>>
>>> On Tue, Nov 5, 2013 at 6:44 PM, Michael Klishin <mklishin at gopivotal.com>wrote:
>>>
>>>>
>>>> On 5 Nov 2013, at 17:10, Rajasekhar P <sekhar434145 at gmail.com> wrote:
>>>>
>>>> > We are using HAProxy as a load balancer in RabbitMQ cluster and we
>>>> have done the configuration and able to see the stats, where it will
>>>> display list of running nodes.
>>>> > But, we want to know how to configure for connecting producer and
>>>> consumers and we working on Java client. Could anyone please share the
>>>> sample producer and consumer code which we can test via HAProxy load
>>>> balancer.
>>>>
>>>> The whole point of having a proxy is that clients don?t need to be
>>>> aware of the cluster topology.
>>>>
>>>> Your clients should connect to HAproxy. There is no difference to
>>>> connecting to a Rabbit node directly.
>>>>
>>>> MK
>>>>
>>>> Software Engineer, Pivotal/RabbitMQ
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/008017d6/attachment.htm>

From emile at rabbitmq.com  Wed Nov  6 09:47:26 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 06 Nov 2013 09:47:26 +0000
Subject: [rabbitmq-discuss] C# client connect using SSL
In-Reply-To: <OF627FBA8D.62B60BDF-ONC1257C1B.002E1829-C1257C1B.002E5511@schneider-electric.com>
References: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>
	<52779549.2070002@rabbitmq.com>	<OFB7820455.7EA078F2-ONC1257C19.004DD523-C1257C19.004F9031@schneider-electric.com>
	<5278C489.4010900@rabbitmq.com>	<OF50C8141A.44C35147-ONC1257C1A.0043FD78-C1257C1A.004459DC@schneider-electric.com>
	<OF7D359624.AE7F964F-ONC1257C1B.002B355A-C1257C1B.002B776C@schneider-electric.com>
	<OF627FBA8D.62B60BDF-ONC1257C1B.002E1829-C1257C1B.002E5511@schneider-electric.com>
Message-ID: <527A102E.2080608@rabbitmq.com>


Michael,

On 06/11/13 08:26, michael.thorsoe at schneider-electric.com wrote:
> I changed the TcpUpgrade() to call the
> sslStream.AuthenticateAsClient(sslOption.ServerName); if no
> sslOption.Certs present


Permitting RemoteCertificateChainErrors and disabling verification of
clients on the broker was all I needed to establish connections without
a client certificate. I'm not sure why you find it necessary to make any
other changes. If you send a patch of what you changed then I'll be
happy to investigate.




-Emile




From ahsin01 at gmail.com  Wed Nov  6 03:23:14 2013
From: ahsin01 at gmail.com (Alan Hsin)
Date: Tue, 5 Nov 2013 19:23:14 -0800
Subject: [rabbitmq-discuss] Rabbitmq upgrade from 3.1.3 to 3.1.5/3.2.0
 Management issue
In-Reply-To: <01DA5FF4-7713-40E1-A102-6100B40BD52F@rabbitmq.com>
References: <9702e8cf-dd18-4fae-a644-2aa100e40130@googlegroups.com>
	<01DA5FF4-7713-40E1-A102-6100B40BD52F@rabbitmq.com>
Message-ID: <CAFQ5WbUdQDfP1J2WJ+rHvun-VTzFaRWRToffhQdryQEe2nORMw@mail.gmail.com>

Thanks for your help.  Found out there were erlnag riak installed, Get rid
of it makes rmq working now.


On Tue, Nov 5, 2013 at 12:42 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 5 Nov 2013, at 22:58, Alan Hsin <ahsin01 at gmail.com> wrote:
>
> > =ERROR REPORT==== 5-Nov-2013::12:34:59 ===
> > webmachine error: path="/api/definitions"
> > {error,{error,function_clause,
> >               [{orddict,find,
> >                         [vhost,
> >                          {dict,0,16,16,8,80,48,
> >
>  {[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                 []},
> >
>  {{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],
> >                                  []}}}]},
> >                {rabbit_mgmt_util,id0,2},
> >                {rabbit_mgmt_util,vhost,1},
> >                {rabbit_mgmt_util,all_or_one_vhost,2},
> >                {rabbit_mgmt_wm_exchanges,basic,1},
> >                {rabbit_mgmt_wm_definitions,to_json,2},
> >                {webmachine_resource,resource_call,3},
> >                {webmachine_resource,do,3}]}}
>
> We traced it down to this Webmachine change:
>
> https://github.com/basho/webmachine/commit/d7dbbddeb9e6a9a415f7a7f09261dfcd3c2bd001
>
> RabbitMQ management plugin bundles its own version of Webmachine. Can it
> be that you
> somehow have another copy on the global Erlang load path? (wrq.beam)
>
> There were reports of similar issues earlier and uninstalling a
> system-wide package
> that was included into Erlang code path helped, e.g.
>
> http://markmail.org/thread/mdi4ga635gljvgws
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/82fb2f9f/attachment-0001.htm>

From wenjinchao0418 at gmail.com  Wed Nov  6 08:36:29 2013
From: wenjinchao0418 at gmail.com (=?UTF-8?B?5rip6YeR6LaF?=)
Date: Wed, 6 Nov 2013 00:36:29 -0800 (PST)
Subject: [rabbitmq-discuss] Failed to start rabbitmq, need help!
Message-ID: <0a17982d-86bb-4efc-bca4-5bace2ea732a@googlegroups.com>

env:
otp_src_R16B02
rabbitmq_server-3.1.5

rabbitmq log and erl_crash.dump are attached.

Thank you for any help!


jinchao
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/b3a3d74c/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump
Type: application/octet-stream
Size: 1571566 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/b3a3d74c/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at cq02-fc-eye01.log
Type: application/octet-stream
Size: 9716 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/b3a3d74c/attachment-0003.obj>

From hxuanji at gmail.com  Wed Nov  6 05:44:46 2013
From: hxuanji at gmail.com (HongXuan Ji)
Date: Tue, 5 Nov 2013 21:44:46 -0800 (PST)
Subject: [rabbitmq-discuss] How to backup the queues/messages data on the
	fly?
Message-ID: <dee0ebb8-d550-4e0b-b2dd-1735480a2233@googlegroups.com>

Hi all,

I am wondering the backup/restore plan for the RabbitMQ. I've surveyed 
related topics but seems there are not obvious solution for it.
My scenario is we want to a routine backup for our entire system, including 
MongoDB, RabbitMQ, .. at specific time.

And the backup routine is performed on the fly, which means the service is 
still running.
I've known the tool of http://qdb.io/api, it might fit my needs. But It's 
an another plugin. I try to make it simple. 
BTW, I know the management interface can export the definition itself. But 
it does not provide the message data.

So, does RabbitMQ itself provide such backup plan?  Do you have any idea 
about it?

Regards,

Ivan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/bfb07206/attachment.htm>

From hxuanji at gmail.com  Wed Nov  6 05:49:01 2013
From: hxuanji at gmail.com (HongXuan Ji)
Date: Tue, 5 Nov 2013 21:49:01 -0800 (PST)
Subject: [rabbitmq-discuss] How to backup the queues/messages data on
	the fly?
In-Reply-To: <dee0ebb8-d550-4e0b-b2dd-1735480a2233@googlegroups.com>
References: <dee0ebb8-d550-4e0b-b2dd-1735480a2233@googlegroups.com>
Message-ID: <bd32d82e-2f0c-4849-9d13-8e66e46f8beb@googlegroups.com>

BTW, even in an clustering environment, how about the backup plan?

Regards,

Ivan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131105/ca19d369/attachment.htm>

From matthias at rabbitmq.com  Wed Nov  6 09:54:51 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 06 Nov 2013 09:54:51 +0000
Subject: [rabbitmq-discuss] Failed to start rabbitmq, need help!
In-Reply-To: <0a17982d-86bb-4efc-bca4-5bace2ea732a@googlegroups.com>
References: <0a17982d-86bb-4efc-bca4-5bace2ea732a@googlegroups.com>
Message-ID: <527A11EB.4030203@rabbitmq.com>

On 06/11/13 08:36, ??? wrote:
> env:
> otp_src_R16B02
> rabbitmq_server-3.1.5
>
> rabbitmq log and erl_crash.dump are attached.

Please post the sasl log too.

Matthias.


From mklishin at gopivotal.com  Wed Nov  6 09:59:19 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 13:59:19 +0400
Subject: [rabbitmq-discuss] How to backup the queues/messages data on
	the fly?
In-Reply-To: <dee0ebb8-d550-4e0b-b2dd-1735480a2233@googlegroups.com>
References: <dee0ebb8-d550-4e0b-b2dd-1735480a2233@googlegroups.com>
Message-ID: <3C6B1AE4-0BD9-4D79-B68A-760E6DCCC9BB@rabbitmq.com>

On 6 Nov 2013, at 09:44, HongXuan Ji <hxuanji at gmail.com> wrote:

> BTW, I know the management interface can export the definition itself. But it does not provide the message data.
> 
> So, does RabbitMQ itself provide such backup plan?

You can replicate messages using Shovel and Federation plugins.

MK

Software Engineer, Pivotal/RabbitMQ



From michael.thorsoe at schneider-electric.com  Wed Nov  6 10:06:53 2013
From: michael.thorsoe at schneider-electric.com (michael.thorsoe at schneider-electric.com)
Date: Wed, 6 Nov 2013 11:06:53 +0100
Subject: [rabbitmq-discuss] C# client connect using SSL
In-Reply-To: <527A102E.2080608@rabbitmq.com>
References: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>
	<52779549.2070002@rabbitmq.com>
	<OFB7820455.7EA078F2-ONC1257C19.004DD523-C1257C19.004F9031@schneider-electric.com>
	<5278C489.4010900@rabbitmq.com>
	<OF50C8141A.44C35147-ONC1257C1A.0043FD78-C1257C1A.004459DC@schneider-electric.com>
	<OF7D359624.AE7F964F-ONC1257C1B.002B355A-C1257C1B.002B776C@schneider-electric.com>
	<OF627FBA8D.62B60BDF-ONC1257C1B.002E1829-C1257C1B.002E5511@schneider-electric.com>
	<527A102E.2080608@rabbitmq.com>
Message-ID: <OFE9A43A30.8BAAC17D-ONC1257C1B.003690F6-C1257C1B.0037901D@schneider-electric.com>

I changed from:
        public static Stream TcpUpgrade(Stream tcpStream, SslOption 
sslOption)
        {
            SslHelper helper = new SslHelper(sslOption);
            SslStream sslStream = new SslStream(tcpStream, false,
                                                new 
RemoteCertificateValidationCallback(helper.CertificateValidationCallback),
                                                new 
LocalCertificateSelectionCallback(helper.CertificateSelectionCallback));

            sslStream.AuthenticateAsClient(sslOption.ServerName,
                                           sslOption.Certs,
                                           sslOption.Version,
                                           false);

            return sslStream;
        }
to:
        public static Stream TcpUpgrade(Stream tcpStream, SslOption 
sslOption)
        {
            SslHelper helper = new SslHelper(sslOption);
            SslStream sslStream = new SslStream(tcpStream, false,
                                                new 
RemoteCertificateValidationCallback(helper.CertificateValidationCallback),
                                                new 
LocalCertificateSelectionCallback(helper.CertificateSelectionCallback));

            if (sslOption.Certs == null || sslOption.Certs.Count == 0)
            {
                sslStream.AuthenticateAsClient(sslOption.ServerName);
            }
            else
            {
                sslStream.AuthenticateAsClient(sslOption.ServerName,
                                               sslOption.Certs,
                                               sslOption.Version,
                                               false);
            }

            return sslStream;
        }

I don't know if this is the proper approach but this will allow the call 
to sslStream.AuthenticateAsClient() to NOT assert if no certs is present.

Br,
Michael 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/451a2e59/attachment.htm>

From mklishin at gopivotal.com  Wed Nov  6 10:14:50 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 14:14:50 +0400
Subject: [rabbitmq-discuss] C# client connect using SSL
In-Reply-To: <OFE9A43A30.8BAAC17D-ONC1257C1B.003690F6-C1257C1B.0037901D@schneider-electric.com>
References: <OF5FD77125.AD65C622-ONC1257C19.00416CA3-C1257C19.0041B964@schneider-electric.com>
	<52779549.2070002@rabbitmq.com>
	<OFB7820455.7EA078F2-ONC1257C19.004DD523-C1257C19.004F9031@schneider-electric.com>
	<5278C489.4010900@rabbitmq.com>
	<OF50C8141A.44C35147-ONC1257C1A.0043FD78-C1257C1A.004459DC@schneider-electric.com>
	<OF7D359624.AE7F964F-ONC1257C1B.002B355A-C1257C1B.002B776C@schneider-electric.com>
	<OF627FBA8D.62B60BDF-ONC1257C1B.002E1829-C1257C1B.002E5511@schneider-electric.com>
	<527A102E.2080608@rabbitmq.com>
	<OFE9A43A30.8BAAC17D-ONC1257C1B.003690F6-C1257C1B.0037901D@schneider-electric.com>
Message-ID: <E466802B-CBF2-4D83-99B7-4EF939C86380@rabbitmq.com>

On 6 Nov 2013, at 14:06, michael.thorsoe at schneider-electric.com wrote:

>         public static Stream TcpUpgrade(Stream tcpStream, SslOption sslOption) 
>         { 
>             SslHelper helper = new SslHelper(sslOption); 
>             SslStream sslStream = new SslStream(tcpStream, false, 
>                                                 new RemoteCertificateValidationCallback(helper.CertificateValidationCallback), 
>                                                 new LocalCertificateSelectionCallback(helper.CertificateSelectionCallback)); 
> 
>             sslStream.AuthenticateAsClient(sslOption.ServerName, 
>                                            sslOption.Certs, 
>                                            sslOption.Version, 
>                                            false); 
> 
>             return sslStream; 
>         } 
> to: 
>         public static Stream TcpUpgrade(Stream tcpStream, SslOption sslOption) 
>         { 
>             SslHelper helper = new SslHelper(sslOption); 
>             SslStream sslStream = new SslStream(tcpStream, false, 
>                                                 new RemoteCertificateValidationCallback(helper.CertificateValidationCallback), 
>                                                 new LocalCertificateSelectionCallback(helper.CertificateSelectionCallback)); 
> 
>             if (sslOption.Certs == null || sslOption.Certs.Count == 0) 
>             { 
>                 sslStream.AuthenticateAsClient(sslOption.ServerName); 
>             } 
>             else 
>             { 
>                 sslStream.AuthenticateAsClient(sslOption.ServerName, 
>                                                sslOption.Certs, 
>                                                sslOption.Version, 
>                                                false); 
>             } 
> 
>             return sslStream; 
>         } 

Diff: https://gist.github.com/michaelklishin/e553b909af90375f5082

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Wed Nov  6 10:23:26 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Nov 2013 10:23:26 +0000
Subject: [rabbitmq-discuss] Messages BasicReject-ed or BasicNack-ed are
 back in the queue after restarting RabbitMQ service
In-Reply-To: <1383659520778-31180.post@n5.nabble.com>
References: <1383659520778-31180.post@n5.nabble.com>
Message-ID: <527A189E.9070602@rabbitmq.com>

There was a bug fixed in 2.8.2 (bug 24863) described in the changelog as:

- memory leak on basic.reject{requeue = false}

However, looking at it again (just a skim-reading admittedly) I suspect 
it might conceivably permit persistent nacked messages to come back to 
life after a server restart.

So I think an upgrade is advised.

Cheers, Simon

On 05/11/13 13:52, JohanKlijn wrote:
> We are using RabbitMQ 2.8.1 using C#. We have a queue with durable messages.
> When we Acknowledge a message, channel.BasicAck(deliveryTag, false), and
> restart the RabbitMQ service the message acknowledge is will not appear any
> more in the queue, as expected.
>
> Now when we negative acknowledge a message, like this:
>
> channel.BasicNack(deliveryTag, false, false);
> or
> channel.BasicReject(deliveryTag, false);
>
> and restart the service the messages negative acknowledged are back.
> When I look at the status of the queue before the restart using:
> rabbitmqctl list_queues name messages_ready messages_unacknowledged
> There are no messages to be acknowledge and the NumberOfMessages =
> NumberOfMessageBeforeNegAck ? NegAckMessages. And after the restart the
> NumberOfMessages = NumberOfMessageBeforeNegAck.
>
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Messages-BasicReject-ed-or-BasicNack-ed-are-back-in-the-queue-after-restarting-RabbitMQ-service-tp31180.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From lijo at citrusinformatics.com  Wed Nov  6 10:25:38 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Wed, 6 Nov 2013 15:55:38 +0530
Subject: [rabbitmq-discuss] using RabbitMQ JSON RPC channel with C#
Message-ID: <E8D66CF3617C44009DFC54604A693EB8@Lijo>


Hi All, 
Your urgent help needed on the following query.
I have a requirement where messages should be published/subscribed over http, just like the sample chat application works with json_rpc_channel plugin.
Please guide me through!
Is there any sample available for the chat application works with c#?


Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/545663b5/attachment.htm>

From tim at rabbitmq.com  Wed Nov  6 10:37:41 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 6 Nov 2013 10:37:41 +0000
Subject: [rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster
In-Reply-To: <CAOHkZxOYjFQOB2xW0E921SJiag3oh0m6+R9qbu=gWxwa+YTXLg@mail.gmail.com>
References: <CAOHkZxOYjFQOB2xW0E921SJiag3oh0m6+R9qbu=gWxwa+YTXLg@mail.gmail.com>
Message-ID: <D7A91190-9DC6-4740-9658-DD39723FCF7C@rabbitmq.com>

Hi Matt,

Sorry to hear you've been running into problems.

On 5 Nov 2013, at 22:05, Matt Wise wrote:

> (sorry if this gets posted twice.. first email never seemed to make it to the list)
> 
> Hey... I had a pretty rough time today with a 3-node RabbitMQ 3.1.3 cluster thats under pretty heavy use (6-7 million messages per day -- 100MB peak bandwidth per node). I want to pose a few questions here. First off, here's the basic configuration though.
> 
> Configuration:
>   serverA, serverB and serverC are all configured with RabbitMQ 3.1.3. They each are configured via Puppet ... and Puppet uses a dynamic node discovery plugin (zookeeper) to find the nodes. The node lists are hard-coded into the rabbitmq.config file. A dynamic server list generator supplies Puppet with this list of servers (and is not really necessary to describe here in this email).
> 
> Scenario:
>   A momentary configuration blip caused serverA and serverB to begin reconfiguring their rabbitmq.config files... when they did this, they also both issued a 'service rabbitmq restart' command. This command took 40+minutes and ultimately failed. During this failure, RabbitMQ was technically running and accepting connections to the TCP ports ... but it would not actually answer any queries. Commands like list_queues would hang indefinitely.
> 

What ha recovery policy (if any) do you have set up? A and B might get a different "view of the world" set up in their respective rabbitmq.config files (either to each other and/or to C) and then get restarted, but this should affect their view of the cluster, because as per http://www.rabbitmq.com/clustering.html:

"Note that the cluster configuration is applied only to fresh nodes. A fresh nodes is a node which has just been reset or is being start for the first time. Thus, the automatic clustering won't take place after restarts of nodes. This means that any change to the clustering via rabbitmqctl will take precedence over the automatic clustering configuration."

> Questions:
>   1. We only had ~2500 messages in the queues (they are HA'd and durable). The policy is { 'ha-mode': 'all' }. When serverA and serverB restarted, why did they never come up? Unfortunately in the restart process, they blew away their log files as well which makes this really tough to troubleshoot.

It's nigh on impossible to guess what might've gone wrong without any log files to verify against. We could sit and stare at all the relevant code for weeks and not spot a bug that's been triggered here, since if it were obvious we would've fixed it already.

If you can give us a very precise set of steps (and timings) that led to this situation, I can try and replicate what you've seen, but I don't fancy my chances to be honest.

> 
>   2. I know that restarting serverA and serverB at nearly the same time is obviously a bad idea -- we'll be implementing some changes so this doesn't happen again -- but could this have lead to data corruption?

It's possible, though obviously that shouldn't really happen. How close were the restarts to one another? How many HA queues were mirrored across these nodes, and were they all very busy (as your previous comment about load seems to suggest)? We could try replicating that scenario in our tests, though it's not easy to get the timing right and obviously the existence of network infrastructure on which the nodes are running won't be the same (and that can make a surprisingly big difference IME). 

> Once the entire RabbitMQ farm was shut down, we actually were forced to move the rabbitmq data directory out of the way and start up the farm completely with blank databases. It seemed that RabbitMQ 3.1.3 really did not want to recover from this failure. Any thoughts?
> 
>   3. Lastly .. in the event of future failures, what tools are there for recovering our Mnesia databases? Is there any way we can dump out the data into some raw form, and then import it back into a new fresh cluster?
> 

I'm afraid there are not, at least not "off the shelf" ones anyway. If you are desperate to recover important production data however, I'm sure we could explore the possibility of trying to help with that somehow. Let me know and I'll make some enquiries at this end.

Cheers,
Tim



From mklishin at gopivotal.com  Wed Nov  6 10:42:06 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 14:42:06 +0400
Subject: [rabbitmq-discuss] using RabbitMQ JSON RPC channel with C#
In-Reply-To: <E8D66CF3617C44009DFC54604A693EB8@Lijo>
References: <E8D66CF3617C44009DFC54604A693EB8@Lijo>
Message-ID: <006526AD-54E7-4849-83CC-7789E0734D26@rabbitmq.com>

On 6 Nov 2013, at 14:25, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

> I have a requirement where messages should be published/subscribed over http, just like the sample chat application works with json_rpc_channel plugin.
> Please guide me through!

You can publish and consume using basic.get (polling) using HTTP API that ships
with the management plugin:

https://www.rabbitmq.com/management.html
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_0/priv/www/api/index.html

Also, see WebSTOMP and STOMP plugins, they may offer a viable alternative to your needs:

http://www.rabbitmq.com/web-stomp.html
https://www.rabbitmq.com/stomp.html

MK

Software Engineer, Pivotal/RabbitMQ



From tim at rabbitmq.com  Wed Nov  6 10:42:32 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 6 Nov 2013 10:42:32 +0000
Subject: [rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster
In-Reply-To: <D7A91190-9DC6-4740-9658-DD39723FCF7C@rabbitmq.com>
References: <CAOHkZxOYjFQOB2xW0E921SJiag3oh0m6+R9qbu=gWxwa+YTXLg@mail.gmail.com>
	<D7A91190-9DC6-4740-9658-DD39723FCF7C@rabbitmq.com>
Message-ID: <3746A77B-9154-4D31-AAE1-457E409FCA45@rabbitmq.com>

Oh and with regards blowing away the log files - it would be a really good idea if you change your setup so that doesn't happen again. As I said below, it's nigh on impossible to help debug a system failure after the cluster has been restarted if we have no logs to go on.

Cheers,
Tim

From sekhar434145 at gmail.com  Wed Nov  6 10:59:21 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Wed, 6 Nov 2013 16:29:21 +0530
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
 RabbitMQ cluster?
In-Reply-To: <CAN+AGk23+f3FMfp8S4iW-+uQX5SnMzcOWQn-iwGhVY3sqfFRVQ@mail.gmail.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
	<CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>
	<CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>
	<CAN+AGk23+f3FMfp8S4iW-+uQX5SnMzcOWQn-iwGhVY3sqfFRVQ@mail.gmail.com>
Message-ID: <CAH75Yb6Q=w04wQhSMiimB_nsM6azNBPQBnVn0NGhsGtO_QxBZQ@mail.gmail.com>

Hi Marutha,

Am getting amqp connection exception after using  xxx.xxx.xxx.xxx:5720
address - o*rg.springframework.amqp.AmqpConnectException:
java.net.ConnectException.*

Below is the connection factory code at producer and consumer end and these
running in window 7 local machine. ANd HAProxy is installed in other
machine in LAN and we have enabled 5720 port.

CachingConnectionFactory connectionFactory = new CachingConnectionFactory(
"xxx.xxx.xxx.xxx");
connectionFactory.setUsername("guest");
connectionFactory.setPassword("guest");
connectionFactory.setPort(5670);

Thanks in advance.



On Wed, Nov 6, 2013 at 3:04 PM, Maruthavanan Subbarayan <
marutha.tech at gmail.com> wrote:

> Hi
>
> You should be using xxx.xxx.xxx.xxx:5720 and haproxy will tkae care if
> configured
>
> Thanks
> Marutha
> On Nov 6, 2013 2:27 PM, "Rajasekhar P" <sekhar434145 at gmail.com> wrote:
>
>> Thanks Marutha for the reply. Here, HAProxy is running on xxx.xxx.xxx.xxx
>> machine and listening port is 5720 . While getting the connection at
>> producer and consumer end, do we need to use this ip address or IP
>> addresses where RabbitMQ nodes are running in cluster?
>>
>> CachingConnectionFactory connectionFactory = new CachingConnectionFactory(
>> "xxx.xxx.xxx.xxx");
>>
>> (OR)
>>
>> CachingConnectionFactory connectionFactory = new
>> CachingConnectionFactory();
>> connectionFactory.setAddresses("ip_addr2:5672,ip_addr2:5672");
>>
>>
>> Thanks in advance.
>>
>>
>> On Wed, Nov 6, 2013 at 11:03 AM, Maruthavanan Subbarayan <
>> marutha.tech at gmail.com> wrote:
>>
>>> Hi
>>>
>>> The load balancing should be taken care by HAproxy. Both producers and
>>> consumers should point to HAproxy.
>>>
>>> Thanks
>>> Marutha
>>> On Nov 6, 2013 10:55 AM, "Rajasekhar P" <sekhar434145 at gmail.com> wrote:
>>>
>>>> Thanks for the response. We are new to using HAProxy and done the
>>>> HAProxy setup as per the Rabbit_In_Action.pdf documentation. Here, HAProxy
>>>> is installed in Linux and two RabbitMQ nodes are running in two different
>>>> windows machines in cluster.
>>>>
>>>> If we are not making any changes related to HAProxy in producer and
>>>> consumer code, how does load balancing will work. could you please tell me?
>>>>
>>>> Thank you.
>>>>
>>>>
>>>> On Tue, Nov 5, 2013 at 6:44 PM, Michael Klishin <mklishin at gopivotal.com
>>>> > wrote:
>>>>
>>>>>
>>>>> On 5 Nov 2013, at 17:10, Rajasekhar P <sekhar434145 at gmail.com> wrote:
>>>>>
>>>>> > We are using HAProxy as a load balancer in RabbitMQ cluster and we
>>>>> have done the configuration and able to see the stats, where it will
>>>>> display list of running nodes.
>>>>> > But, we want to know how to configure for connecting producer and
>>>>> consumers and we working on Java client. Could anyone please share the
>>>>> sample producer and consumer code which we can test via HAProxy load
>>>>> balancer.
>>>>>
>>>>> The whole point of having a proxy is that clients don?t need to be
>>>>> aware of the cluster topology.
>>>>>
>>>>> Your clients should connect to HAproxy. There is no difference to
>>>>> connecting to a Rabbit node directly.
>>>>>
>>>>> MK
>>>>>
>>>>> Software Engineer, Pivotal/RabbitMQ
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> rabbitmq-discuss mailing list
>>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>>
>>>>
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/fe8d4665/attachment.htm>

From mklishin at gopivotal.com  Wed Nov  6 11:03:13 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 15:03:13 +0400
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
	RabbitMQ cluster?
In-Reply-To: <CAH75Yb6Q=w04wQhSMiimB_nsM6azNBPQBnVn0NGhsGtO_QxBZQ@mail.gmail.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
	<CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>
	<CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>
	<CAN+AGk23+f3FMfp8S4iW-+uQX5SnMzcOWQn-iwGhVY3sqfFRVQ@mail.gmail.com>
	<CAH75Yb6Q=w04wQhSMiimB_nsM6azNBPQBnVn0NGhsGtO_QxBZQ@mail.gmail.com>
Message-ID: <58C81D65-29DD-43B4-B170-133264FD0F0D@rabbitmq.com>


On 6 Nov 2013, at 14:59, Rajasekhar P <sekhar434145 at gmail.com> wrote:

> Below is the connection factory code at producer and consumer end and these running in window 7 local machine. ANd HAProxy is installed in other machine in LAN and we have enabled 5720 port.

You need to make sure that HAproxy has TCP backends that point to the machine[s] that run RabbitMQ nodes,
proxying to port 5672 (or 5671, if SSL is used).

Please read HAproxy documentation before you try to use it. RabbitMQ in Action also has almost an entire chapter
dedicated to using a proxy in front of multiple Rabbit nodes.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Wed Nov  6 11:04:42 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 15:04:42 +0400
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
	RabbitMQ cluster?
In-Reply-To: <CAH75Yb6Q=w04wQhSMiimB_nsM6azNBPQBnVn0NGhsGtO_QxBZQ@mail.gmail.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
	<CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>
	<CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>
	<CAN+AGk23+f3FMfp8S4iW-+uQX5SnMzcOWQn-iwGhVY3sqfFRVQ@mail.gmail.com>
	<CAH75Yb6Q=w04wQhSMiimB_nsM6azNBPQBnVn0NGhsGtO_QxBZQ@mail.gmail.com>
Message-ID: <0664A2D9-1B93-4034-BFF9-164A2357E4C1@rabbitmq.com>

On 6 Nov 2013, at 14:59, Rajasekhar P <sekhar434145 at gmail.com> wrote:

> Am getting amqp connection exception after using  xxx.xxx.xxx.xxx:5720 address - org.springframework.amqp.AmqpConnectException: java.net.ConnectException.

This is not sufficient. There can be a myriad of reasons why a network connection fails.
Make sure HAproxy node is reachable from all client machines, that there are no firewall rules
that may block connections, etc.

And at least post a longer stack trace and the exception message.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Wed Nov  6 11:05:34 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 15:05:34 +0400
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
	RabbitMQ cluster?
In-Reply-To: <CAH75Yb6Q=w04wQhSMiimB_nsM6azNBPQBnVn0NGhsGtO_QxBZQ@mail.gmail.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
	<CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>
	<CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>
	<CAN+AGk23+f3FMfp8S4iW-+uQX5SnMzcOWQn-iwGhVY3sqfFRVQ@mail.gmail.com>
	<CAH75Yb6Q=w04wQhSMiimB_nsM6azNBPQBnVn0NGhsGtO_QxBZQ@mail.gmail.com>
Message-ID: <B946EBA3-9F6C-40BD-8ACD-D786532B6D0F@rabbitmq.com>


On 6 Nov 2013, at 14:59, Rajasekhar P <sekhar434145 at gmail.com> wrote:

> connectionFactory.setPort(5670);

What is this port? Standard RabbitMQ ports are 5672 and 5671 (for SSL-enabled connections).

MK

Software Engineer, Pivotal/RabbitMQ



From tim at rabbitmq.com  Wed Nov  6 11:06:06 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 6 Nov 2013 11:06:06 +0000
Subject: [rabbitmq-discuss] Request for copies of internal bug reports...
In-Reply-To: <CAOHkZxMcoUC5htzmX6uY_tXyOf8R2CyKLvvs21xg64MPvwwQUg@mail.gmail.com>
References: <CAOHkZxMcoUC5htzmX6uY_tXyOf8R2CyKLvvs21xg64MPvwwQUg@mail.gmail.com>
Message-ID: <5883B4DF-4A45-4561-ABEC-FDB99FC7628C@rabbitmq.com>

Hi Matt,

How much detail exactly are you looking for? The internal bug tracker is private for a reason, but I'm sure we can dig out relevant info for you. If this question relates to your other post (about a cluster failure) then upgrading to the latest stable version is *always* recommended.

Please bear in mind that upgrading to a different major version can alter your database in ways that it is not possible to roll back from, so manually backing up your mnesia directories is recommended.

Cheers,
Tim

From mklishin at gopivotal.com  Wed Nov  6 11:08:03 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 15:08:03 +0400
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
	RabbitMQ cluster?
In-Reply-To: <CAH75Yb6Q=w04wQhSMiimB_nsM6azNBPQBnVn0NGhsGtO_QxBZQ@mail.gmail.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
	<CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>
	<CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>
	<CAN+AGk23+f3FMfp8S4iW-+uQX5SnMzcOWQn-iwGhVY3sqfFRVQ@mail.gmail.com>
	<CAH75Yb6Q=w04wQhSMiimB_nsM6azNBPQBnVn0NGhsGtO_QxBZQ@mail.gmail.com>
Message-ID: <2A6493C1-FCED-4A05-A3DE-C576F2E9B57E@rabbitmq.com>

On 6 Nov 2013, at 14:59, Rajasekhar P <sekhar434145 at gmail.com> wrote:

> connectionFactory.setPort(5670);

If you want to connect to the proxy, you should use the port HAproxy listens on.

From your earlier emails that port is 5720.

MK

Software Engineer, Pivotal/RabbitMQ



From sekhar434145 at gmail.com  Wed Nov  6 11:18:42 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Wed, 6 Nov 2013 16:48:42 +0530
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
 RabbitMQ cluster?
In-Reply-To: <2A6493C1-FCED-4A05-A3DE-C576F2E9B57E@rabbitmq.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
	<CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>
	<CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>
	<CAN+AGk23+f3FMfp8S4iW-+uQX5SnMzcOWQn-iwGhVY3sqfFRVQ@mail.gmail.com>
	<CAH75Yb6Q=w04wQhSMiimB_nsM6azNBPQBnVn0NGhsGtO_QxBZQ@mail.gmail.com>
	<2A6493C1-FCED-4A05-A3DE-C576F2E9B57E@rabbitmq.com>
Message-ID: <CAH75Yb4MSi++9tt=xZLcmfxR8teaRT7=WBdiS3W2DCbw4QMnGA@mail.gmail.com>

Hi MK,

am using 5670 port in HAProxy configuration as below in configuration file
(haproxy,cfg) and this port is enabled.
listen rabbitmq_local_cluster 127.0.0.1:5670
        mode tcp
        balance roundrobin
        server rabbit 192.168.xx.xx:5672 check inter 5000 rise 2 fall 3
        server rabbit2 192.168.xx.xx:5672 check inter 5000 rise 2 fall 3

Thanks


On Wed, Nov 6, 2013 at 4:38 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 6 Nov 2013, at 14:59, Rajasekhar P <sekhar434145 at gmail.com> wrote:
>
> > connectionFactory.setPort(5670);
>
> If you want to connect to the proxy, you should use the port HAproxy
> listens on.
>
> From your earlier emails that port is 5720.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/34f734cc/attachment.htm>

From mklishin at gopivotal.com  Wed Nov  6 11:22:12 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 15:22:12 +0400
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
	RabbitMQ cluster?
In-Reply-To: <CAH75Yb4MSi++9tt=xZLcmfxR8teaRT7=WBdiS3W2DCbw4QMnGA@mail.gmail.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
	<CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>
	<CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>
	<CAN+AGk23+f3FMfp8S4iW-+uQX5SnMzcOWQn-iwGhVY3sqfFRVQ@mail.gmail.com>
	<CAH75Yb6Q=w04wQhSMiimB_nsM6azNBPQBnVn0NGhsGtO_QxBZQ@mail.gmail.com>
	<2A6493C1-FCED-4A05-A3DE-C576F2E9B57E@rabbitmq.com>
	<CAH75Yb4MSi++9tt=xZLcmfxR8teaRT7=WBdiS3W2DCbw4QMnGA@mail.gmail.com>
Message-ID: <31A97C11-76A6-4606-AF62-9BB3914080A0@rabbitmq.com>

On 6 Nov 2013, at 15:18, Rajasekhar P <sekhar434145 at gmail.com> wrote:

> listen rabbitmq_local_cluster 127.0.0.1:5670

You configure HAproxy to listen on 127.0.0.1. Only machine-local processes will be able
to connect to it. If you are not sure about your network topology, make it listen
on 0.0.0.0 (all interfaces).

MK

Software Engineer, Pivotal/RabbitMQ



From lijo at citrusinformatics.com  Wed Nov  6 11:55:17 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Wed, 6 Nov 2013 17:25:17 +0530
Subject: [rabbitmq-discuss] using RabbitMQ JSON RPC channel with C#
In-Reply-To: <006526AD-54E7-4849-83CC-7789E0734D26@rabbitmq.com>
References: <E8D66CF3617C44009DFC54604A693EB8@Lijo>
	<006526AD-54E7-4849-83CC-7789E0734D26@rabbitmq.com>
Message-ID: <10944BC0CDC844A9942A4EE133E11F69@Lijo>

Can you show me a sample code explaining a basic.get method with a polling.

Else a sample publish command with http post.




Regards,
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.
-----Original Message----- 
From: Michael Klishin
Sent: Wednesday, November 06, 2013 4:12 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] using RabbitMQ JSON RPC channel with C#

On 6 Nov 2013, at 14:25, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

> I have a requirement where messages should be published/subscribed over 
> http, just like the sample chat application works with json_rpc_channel 
> plugin.
> Please guide me through!

You can publish and consume using basic.get (polling) using HTTP API that 
ships
with the management plugin:

https://www.rabbitmq.com/management.html
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_0/priv/www/api/index.html

Also, see WebSTOMP and STOMP plugins, they may offer a viable alternative to 
your needs:

http://www.rabbitmq.com/web-stomp.html
https://www.rabbitmq.com/stomp.html

MK

Software Engineer, Pivotal/RabbitMQ


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 


From videlalvaro at gmail.com  Wed Nov  6 12:02:49 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 6 Nov 2013 13:02:49 +0100
Subject: [rabbitmq-discuss] using RabbitMQ JSON RPC channel with C#
In-Reply-To: <10944BC0CDC844A9942A4EE133E11F69@Lijo>
References: <E8D66CF3617C44009DFC54604A693EB8@Lijo>
	<006526AD-54E7-4849-83CC-7789E0734D26@rabbitmq.com>
	<10944BC0CDC844A9942A4EE133E11F69@Lijo>
Message-ID: <CAMcAHLUHOEdDEE8-U8CM+cqXjHdGk6d19AFs54j3EbPVE-DDxg@mail.gmail.com>

Hi,

You can see a basic get example here:
https://github.com/videlalvaro/php-amqplib/blob/master/demo/basic_get.php#L43

In the case of the HTTP post, you can see the documentation here:
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_0/priv/www/api/index.html

Search for "/api/exchanges/*vhost*/*name*/publish". Based on the
information there you can build a POST request with your HTTP library of
choice.

Regards,

Alvaro

On Wed, Nov 6, 2013 at 12:55 PM, Lijo Sebastian
<lijo at citrusinformatics.com>wrote:

> Can you show me a sample code explaining a basic.get method with a polling.
>
> Else a sample publish command with http post.
>
>
>
>
>
> Regards,
> Lijo Sebastian
> Senior Software Engineer
> Citrus Informatics (India) Pvt Ltd.
> -----Original Message----- From: Michael Klishin
> Sent: Wednesday, November 06, 2013 4:12 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] using RabbitMQ JSON RPC channel with C#
>
>
> On 6 Nov 2013, at 14:25, Lijo Sebastian <lijo at citrusinformatics.com>
> wrote:
>
>  I have a requirement where messages should be published/subscribed over
>> http, just like the sample chat application works with json_rpc_channel
>> plugin.
>> Please guide me through!
>>
>
> You can publish and consume using basic.get (polling) using HTTP API that
> ships
> with the management plugin:
>
> https://www.rabbitmq.com/management.html
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/
> rabbitmq_v3_2_0/priv/www/api/index.html
>
> Also, see WebSTOMP and STOMP plugins, they may offer a viable alternative
> to your needs:
>
> http://www.rabbitmq.com/web-stomp.html
> https://www.rabbitmq.com/stomp.html
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/dca00ab5/attachment.htm>

From videlalvaro at gmail.com  Wed Nov  6 12:08:20 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 6 Nov 2013 13:08:20 +0100
Subject: [rabbitmq-discuss] using RabbitMQ JSON RPC channel with C#
In-Reply-To: <CAMcAHLUHOEdDEE8-U8CM+cqXjHdGk6d19AFs54j3EbPVE-DDxg@mail.gmail.com>
References: <E8D66CF3617C44009DFC54604A693EB8@Lijo>
	<006526AD-54E7-4849-83CC-7789E0734D26@rabbitmq.com>
	<10944BC0CDC844A9942A4EE133E11F69@Lijo>
	<CAMcAHLUHOEdDEE8-U8CM+cqXjHdGk6d19AFs54j3EbPVE-DDxg@mail.gmail.com>
Message-ID: <CAMcAHLXPmSOeCxDL90wUBbSx-K3UDq0ZYfsmERx1N_UO7Cemsg@mail.gmail.com>

Hi,

If you need to consume messages via HTTP then the management API offers the
following endpoint: "/api/queues/*vhost*/*name*/get". The page I linked
before explains how to use that API.

Regards,

Alvaro


On Wed, Nov 6, 2013 at 1:02 PM, Alvaro Videla <videlalvaro at gmail.com> wrote:

> Hi,
>
> You can see a basic get example here:
> https://github.com/videlalvaro/php-amqplib/blob/master/demo/basic_get.php#L43
>
> In the case of the HTTP post, you can see the documentation here:
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_0/priv/www/api/index.html
>
> Search for "/api/exchanges/*vhost*/*name*/publish". Based on the
> information there you can build a POST request with your HTTP library of
> choice.
>
> Regards,
>
> Alvaro
>
> On Wed, Nov 6, 2013 at 12:55 PM, Lijo Sebastian <
> lijo at citrusinformatics.com> wrote:
>
>> Can you show me a sample code explaining a basic.get method with a
>> polling.
>>
>> Else a sample publish command with http post.
>>
>>
>>
>>
>>
>> Regards,
>> Lijo Sebastian
>> Senior Software Engineer
>> Citrus Informatics (India) Pvt Ltd.
>> -----Original Message----- From: Michael Klishin
>> Sent: Wednesday, November 06, 2013 4:12 PM
>> To: Discussions about RabbitMQ
>> Subject: Re: [rabbitmq-discuss] using RabbitMQ JSON RPC channel with C#
>>
>>
>> On 6 Nov 2013, at 14:25, Lijo Sebastian <lijo at citrusinformatics.com>
>> wrote:
>>
>>  I have a requirement where messages should be published/subscribed over
>>> http, just like the sample chat application works with json_rpc_channel
>>> plugin.
>>> Please guide me through!
>>>
>>
>> You can publish and consume using basic.get (polling) using HTTP API that
>> ships
>> with the management plugin:
>>
>> https://www.rabbitmq.com/management.html
>> http://hg.rabbitmq.com/rabbitmq-management/raw-file/
>> rabbitmq_v3_2_0/priv/www/api/index.html
>>
>> Also, see WebSTOMP and STOMP plugins, they may offer a viable alternative
>> to your needs:
>>
>> http://www.rabbitmq.com/web-stomp.html
>> https://www.rabbitmq.com/stomp.html
>>
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/9425fa30/attachment.htm>

From sekhar434145 at gmail.com  Wed Nov  6 13:13:58 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Wed, 6 Nov 2013 18:43:58 +0530
Subject: [rabbitmq-discuss] How to use HAProxy as a load balancer in
 RabbitMQ cluster?
In-Reply-To: <31A97C11-76A6-4606-AF62-9BB3914080A0@rabbitmq.com>
References: <CAH75Yb4ZUXEDEb1FAESAev+AYc+b_T3CkDmU-k2UuEGagFr3DA@mail.gmail.com>
	<E66344A7-0919-4C23-A07E-3274AC388E1D@rabbitmq.com>
	<CAH75Yb6k+X=u5YRe+=Sn3eX-ABtqJM+ZrahLTkxB7JKxHbioZQ@mail.gmail.com>
	<CAN+AGk3yV_6HVoYwYmfryF4ntNk=ONiMNzRX3wRfZ_b=YDxHtQ@mail.gmail.com>
	<CAH75Yb4g=9MvgFX2P05R43ypep6vWuWPVgTL0LsHv-ObGqASyw@mail.gmail.com>
	<CAN+AGk23+f3FMfp8S4iW-+uQX5SnMzcOWQn-iwGhVY3sqfFRVQ@mail.gmail.com>
	<CAH75Yb6Q=w04wQhSMiimB_nsM6azNBPQBnVn0NGhsGtO_QxBZQ@mail.gmail.com>
	<2A6493C1-FCED-4A05-A3DE-C576F2E9B57E@rabbitmq.com>
	<CAH75Yb4MSi++9tt=xZLcmfxR8teaRT7=WBdiS3W2DCbw4QMnGA@mail.gmail.com>
	<31A97C11-76A6-4606-AF62-9BB3914080A0@rabbitmq.com>
Message-ID: <CAH75Yb7e7rJxPyVnHZ6=N-AL5aXqJ4-qjkxnyOZugszeYB_Gbg@mail.gmail.com>

Thanks a lot MK. I have changed listening ip from 127.0.0.1 to actual ip
address and able to produce and consume the messages. I will test the load
balancing behavior of HAProxy.


On Wed, Nov 6, 2013 at 4:52 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 6 Nov 2013, at 15:18, Rajasekhar P <sekhar434145 at gmail.com> wrote:
>
> > listen rabbitmq_local_cluster 127.0.0.1:5670
>
> You configure HAproxy to listen on 127.0.0.1. Only machine-local processes
> will be able
> to connect to it. If you are not sure about your network topology, make it
> listen
> on 0.0.0.0 (all interfaces).
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/86b49838/attachment.htm>

From Reshmi.Nair at emc.com  Wed Nov  6 10:39:09 2013
From: Reshmi.Nair at emc.com (Nair, Reshmi)
Date: Wed, 6 Nov 2013 05:39:09 -0500
Subject: [rabbitmq-discuss] Issue with VMWare vCloud Director notification
Message-ID: <FB0AE0368E15964BBBA5D494F519DD4E011C62E2@MX18A.corp.emc.com>

Hi,



I have configured VCD to send AMQP notifications for non-blocking tasks. I have created a new exchange and queue in RabbitMQ. I am not using vCO. Instead my web application picks up the notification from RabbitMQ and performs some action. But I notice couple of issues here:



1. A few messages are not received at the consumer

2. After some time, no message processing happens - not sure whether it is the problem with VCD or RabbitMQ or my program.



Has anyone faced this issue? Is there a solution? I am using RabbitMQ / Java2.3.1 and protocol is AMQP-0-9-1.



All our  servers are running in virtual machines. Would there be any firewall issues or any timeout?



Thanks,

Reshmi

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/efddbf43/attachment.htm>

From marcos.placona at gmail.com  Wed Nov  6 12:58:39 2013
From: marcos.placona at gmail.com (Marcos Placona)
Date: Wed, 6 Nov 2013 04:58:39 -0800 (PST)
Subject: [rabbitmq-discuss] Channel Name
Message-ID: <7d441d29-c505-434b-a377-5a329ce5cd3d@googlegroups.com>

Hi, this has been asked before<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-October/022763.html>, 
and I was just wondering if there's been any updates so far.

When I look at my queues from the RabbitMQ Management, I can only see 
channels as IP addresses with ports, such as 192.168.5.288:54859. This 
gives me no concept of what that actually is, so I was wondering if there's 
any way I can declare what the channel name is going to be, so I know 
exactly which consumer is doing what (I have multiple consumers per queue).

Is there any way I can make the channel names something a bit more readable?

Thanks in advance,

Marcos
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/180e30f5/attachment.htm>

From mklishin at gopivotal.com  Wed Nov  6 14:22:57 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 18:22:57 +0400
Subject: [rabbitmq-discuss] Channel Name
In-Reply-To: <7d441d29-c505-434b-a377-5a329ce5cd3d@googlegroups.com>
References: <7d441d29-c505-434b-a377-5a329ce5cd3d@googlegroups.com>
Message-ID: <2F19AE00-91AB-4C5B-B61D-E898E85583CB@rabbitmq.com>


On 6 Nov 2013, at 16:58, Marcos Placona <marcos.placona at gmail.com> wrote:

> When I look at my queues from the RabbitMQ Management, I can only see channels as IP addresses with ports, such as 192.168.5.288:54859. This gives me no concept of what that actually is, so I was wondering if there's any way I can declare what the channel name is going to be, so I know exactly which consumer is doing what (I have multiple consumers per queue).

Channels don?t have names, they have numeric ids. Management UI and HTTP API include connection
name in channel name to identify a channel across all connections.

You should not depend on that name for anything.

> Is there any way I can make the channel names something a bit more readable?

There is no way to modify what management UI displays. Can you define ?more readable??

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Wed Nov  6 14:24:09 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 18:24:09 +0400
Subject: [rabbitmq-discuss] Issue with VMWare vCloud Director
	notification
In-Reply-To: <FB0AE0368E15964BBBA5D494F519DD4E011C62E2@MX18A.corp.emc.com>
References: <FB0AE0368E15964BBBA5D494F519DD4E011C62E2@MX18A.corp.emc.com>
Message-ID: <60E61509-9785-4862-8276-EA5989E28B1C@rabbitmq.com>


On 6 Nov 2013, at 14:39, Nair, Reshmi <Reshmi.Nair at emc.com> wrote:

> 2. After some time, no message processing happens - not sure whether it is the problem with VCD or RabbitMQ or my program.

Likely network connection is lost and your application does not recover. See RabbitMQ log to find
out more.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Wed Nov  6 14:39:43 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 18:39:43 +0400
Subject: [rabbitmq-discuss] Channel Name
In-Reply-To: <7d441d29-c505-434b-a377-5a329ce5cd3d@googlegroups.com>
References: <7d441d29-c505-434b-a377-5a329ce5cd3d@googlegroups.com>
Message-ID: <09CD88F2-A244-4623-9EF4-49BAF7BB007F@rabbitmq.com>


On 6 Nov 2013, at 16:58, Marcos Placona <marcos.placona at gmail.com> wrote:

> so I know exactly which consumer is doing what (I have multiple consumers per queue)

Note that consumer tags can be explicitly provided to basic.consume,
instead of relying on clients or RabbitMQ to generate one.

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Wed Nov  6 14:43:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Nov 2013 14:43:43 +0000
Subject: [rabbitmq-discuss] Channel Name
In-Reply-To: <2F19AE00-91AB-4C5B-B61D-E898E85583CB@rabbitmq.com>
References: <7d441d29-c505-434b-a377-5a329ce5cd3d@googlegroups.com>
	<2F19AE00-91AB-4C5B-B61D-E898E85583CB@rabbitmq.com>
Message-ID: <527A559F.4080003@rabbitmq.com>

On 06/11/13 14:22, Michael Klishin wrote:
> There is no way to modify what management UI displays. Can you define ?more readable??

You can have RabbitMQ do reverse DNS lookups for connections / channels: 
http://www.rabbitmq.com/configure.html (and search for dns). That can 
make things more readable for all that it's not what the OP wanted.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Wed Nov  6 15:01:04 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Nov 2013 15:01:04 +0000
Subject: [rabbitmq-discuss] Channel Name
In-Reply-To: <09CD88F2-A244-4623-9EF4-49BAF7BB007F@rabbitmq.com>
References: <7d441d29-c505-434b-a377-5a329ce5cd3d@googlegroups.com>
	<09CD88F2-A244-4623-9EF4-49BAF7BB007F@rabbitmq.com>
Message-ID: <527A59B0.8060308@rabbitmq.com>

On 06/11/13 14:39, Michael Klishin wrote:
> Note that consumer tags can be explicitly provided to basic.consume,
> instead of relying on clients or RabbitMQ to generate one.

Other things the OP could do (without requiring any changes on the 
server side):

* Overload the user name - create a bunch of logically equivalent users, 
one for each role.

* Add something to the client properties. This wouldn't be visible in 
the web UI until you clicked down into an individual connection though.

* Override the "product", "version" or "platform" client properties - 
these get shown in the web UI listing for connections.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Wed Nov  6 15:08:37 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 19:08:37 +0400
Subject: [rabbitmq-discuss] Issue with VMWare vCloud Director
	notification
In-Reply-To: <FB0AE0368E15964BBBA5D494F519DD4E011C62E2@MX18A.corp.emc.com>
References: <FB0AE0368E15964BBBA5D494F519DD4E011C62E2@MX18A.corp.emc.com>
Message-ID: <564E4960-913F-443E-88C7-285982834046@rabbitmq.com>


On 6 Nov 2013, at 14:39, Nair, Reshmi <Reshmi.Nair at emc.com> wrote:

> Has anyone faced this issue? Is there a solution? I am using RabbitMQ / Java2.3.1 and protocol is AMQP-0-9-1.
> All our  servers are running in virtual machines. Would there be any firewall issues or any timeout?

My colleague suggests that heartbeats are not disabled by default in 2.3.x releases.
Some firewalls and router products close TCP connections without any activity on them in,
say, 5-15 minutes.

Consider upgrading to at least 2.8 (it won?t require upgrading RabbitMQ in lockstep)
and enabling heartbeats [1].

1. http://www.rabbitmq.com/javadoc/com/rabbitmq/client/ConnectionFactory.html#setRequestedHeartbeat%28int%29

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Wed Nov  6 15:12:57 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 19:12:57 +0400
Subject: [rabbitmq-discuss] Issue with VMWare vCloud Director
	notification
In-Reply-To: <564E4960-913F-443E-88C7-285982834046@rabbitmq.com>
References: <FB0AE0368E15964BBBA5D494F519DD4E011C62E2@MX18A.corp.emc.com>
	<564E4960-913F-443E-88C7-285982834046@rabbitmq.com>
Message-ID: <D3A86EE1-A6E7-4C6B-8F3B-BD13A5A5B081@gopivotal.com>

On 6 Nov 2013, at 19:08, Michael Klishin <mklishin at gopivotal.com> wrote:

> heartbeats are not disabled by default in 2.3.x releases

This should read ?not enabled by default?.
--
MK

Software Engineer, Pivotal/RabbitMQ


From matt at nextdoor.com  Wed Nov  6 15:34:24 2013
From: matt at nextdoor.com (Matt Wise)
Date: Wed, 6 Nov 2013 07:34:24 -0800
Subject: [rabbitmq-discuss] Request for copies of internal bug reports...
In-Reply-To: <5883B4DF-4A45-4561-ABEC-FDB99FC7628C@rabbitmq.com>
References: <CAOHkZxMcoUC5htzmX6uY_tXyOf8R2CyKLvvs21xg64MPvwwQUg@mail.gmail.com>
	<5883B4DF-4A45-4561-ABEC-FDB99FC7628C@rabbitmq.com>
Message-ID: <CAOHkZxOuCNtN0TUpiZ46kUfPs_3U5u3V7ka86=Dpm4+p-6Gn1g@mail.gmail.com>

Ideally as much detail as possible. We have a few things that we think
contributed to our RabbitMQ outage the other day, but the changelog entries
are short enough that its not entirely clear whether they were all related
to our issues or not.

We do plan to upgrade soon to 3.2.0, but we have some other work to get
done first. I expect we'll upgrade in the next 4-5 weeks. That being said,
we don't like to upgrade unless we *know* that it will fix things. Often we
get that by reading the actual issues in public bug trackers so that we can
really understand whats going on.

I'd be happy to take this offline too and discuss with you privately if
that would be easier.

Matt Wise
Sr. Systems Architect
Nextdoor.com


On Wed, Nov 6, 2013 at 3:06 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Matt,
>
> How much detail exactly are you looking for? The internal bug tracker is
> private for a reason, but I'm sure we can dig out relevant info for you. If
> this question relates to your other post (about a cluster failure) then
> upgrading to the latest stable version is *always* recommended.
>
> Please bear in mind that upgrading to a different major version can alter
> your database in ways that it is not possible to roll back from, so
> manually backing up your mnesia directories is recommended.
>
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/954406f6/attachment.htm>

From matt at nextdoor.com  Wed Nov  6 16:02:45 2013
From: matt at nextdoor.com (Matt Wise)
Date: Wed, 6 Nov 2013 08:02:45 -0800
Subject: [rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster
In-Reply-To: <D7A91190-9DC6-4740-9658-DD39723FCF7C@rabbitmq.com>
References: <CAOHkZxOYjFQOB2xW0E921SJiag3oh0m6+R9qbu=gWxwa+YTXLg@mail.gmail.com>
	<D7A91190-9DC6-4740-9658-DD39723FCF7C@rabbitmq.com>
Message-ID: <CAOHkZxPLAJqBZcYuV9cOFigiKk=9C5e1zEuZd5bP5j_jm0WSXA@mail.gmail.com>

See comments inline.


On Wed, Nov 6, 2013 at 2:37 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi Matt,
>
> Sorry to hear you've been running into problems.
>
> On 5 Nov 2013, at 22:05, Matt Wise wrote:
>
> > (sorry if this gets posted twice.. first email never seemed to make it
> to the list)
> >
> > Hey... I had a pretty rough time today with a 3-node RabbitMQ 3.1.3
> cluster thats under pretty heavy use (6-7 million messages per day -- 100MB
> peak bandwidth per node). I want to pose a few questions here. First off,
> here's the basic configuration though.
> >
> > Configuration:
> >   serverA, serverB and serverC are all configured with RabbitMQ 3.1.3.
> They each are configured via Puppet ... and Puppet uses a dynamic node
> discovery plugin (zookeeper) to find the nodes. The node lists are
> hard-coded into the rabbitmq.config file. A dynamic server list generator
> supplies Puppet with this list of servers (and is not really necessary to
> describe here in this email).
> >
> > Scenario:
> >   A momentary configuration blip caused serverA and serverB to begin
> reconfiguring their rabbitmq.config files... when they did this, they also
> both issued a 'service rabbitmq restart' command. This command took
> 40+minutes and ultimately failed. During this failure, RabbitMQ was
> technically running and accepting connections to the TCP ports ... but it
> would not actually answer any queries. Commands like list_queues would hang
> indefinitely.
> >
>
> What ha recovery policy (if any) do you have set up? A and B might get a
> different "view of the world" set up in their respective rabbitmq.config
> files (either to each other and/or to C) and then get restarted, but this
> should affect their view of the cluster, because as per
> http://www.rabbitmq.com/clustering.html:
>
> "Note that the cluster configuration is applied only to fresh nodes. A
> fresh nodes is a node which has just been reset or is being start for the
> first time. Thus, the automatic clustering won't take place after restarts
> of nodes. This means that any change to the clustering via rabbitmqctl will
> take precedence over the automatic clustering configuration."
>
>
So far we've taken the approach that clustering configuration should be
hard-coded into the rabbitmq.config files. This works well in explicitly
defining all of the hosts in a cluster on every machine, but it also means
that adding a 4th node to a 3-node cluster will cause the 3 running live
nodes to do a full service restart, which is bad. Our rabbitmq.config
though is identical on all of the machines (other than the server-list,
which may have been in-flux when Puppet was restarting these services)

[
>         {rabbit, [
>                 {log_levels, [{connection, warning}]},
>                 {cluster_partition_handling,pause_minority},
>                 {tcp_listeners, [ 5672 ] },
>                 {ssl_listeners, [ 5673 ] },
>                 {ssl_options, [{cacertfile,"/etc/rabbitmq/ssl/cacert.pem"},
>                         {certfile,"/etc/rabbitmq/ssl/cert.pem"},
>                         {keyfile,"/etc/rabbitmq/ssl/key.pem"},
>                         {verify,verify_peer},
>                         {fail_if_no_peer_cert,true}
>                 ]},
>                 {cluster_nodes,['rabbit at i-23cf477b', 'rabbit at i-07d8bc5f',
> 'rabbit at i-a3291cf8']}
>         ]}
> ].



> > Questions:
> >   1. We only had ~2500 messages in the queues (they are HA'd and
> durable). The policy is { 'ha-mode': 'all' }. When serverA and serverB
> restarted, why did they never come up? Unfortunately in the restart
> process, they blew away their log files as well which makes this really
> tough to troubleshoot.
>
> It's nigh on impossible to guess what might've gone wrong without any log
> files to verify against. We could sit and stare at all the relevant code
> for weeks and not spot a bug that's been triggered here, since if it were
> obvious we would've fixed it already.
>
> If you can give us a very precise set of steps (and timings) that led to
> this situation, I can try and replicate what you've seen, but I don't fancy
> my chances to be honest.
>

Its a tough one for us to reproduce.. but I think the closest steps would
be:

  1. Create a 3-node cluster... configured with similar config to the one I
pasted above.
  2. Create enough publishers and subscribers that you have a few hundred
messages/sec going through the three machines.
  3. On MachineA and MachineC, remove MachineB from the config file.
  4. Restart MachineA's rabbitmq daemon using init script
  5. Wait 3 minutes... theoretically #4 is still in process.. now issue the
same restart to MachineC.

  Fail.

Thats our best guess right now.. but agreed, the logs are a problem. Can we
configure RabbitMQ to log through syslog for the future?


> >
> >   2. I know that restarting serverA and serverB at nearly the same time
> is obviously a bad idea -- we'll be implementing some changes so this
> doesn't happen again -- but could this have lead to data corruption?
>
> It's possible, though obviously that shouldn't really happen. How close
> were the restarts to one another? How many HA queues were mirrored across
> these nodes, and were they all very busy (as your previous comment about
> load seems to suggest)? We could try replicating that scenario in our
> tests, though it's not easy to get the timing right and obviously the
> existence of network infrastructure on which the nodes are running won't be
> the same (and that can make a surprisingly big difference IME).
>

The restarts were within a few minutes of each other. There are 5 queues,
and all 5 queues are set to mirror to 'all' nodes in the cluster. They were
busy, but no more than maybe 100 messages/sec coming in/out.


>
> > Once the entire RabbitMQ farm was shut down, we actually were forced to
> move the rabbitmq data directory out of the way and start up the farm
> completely with blank databases. It seemed that RabbitMQ 3.1.3 really did
> not want to recover from this failure. Any thoughts?
> >
> >   3. Lastly .. in the event of future failures, what tools are there for
> recovering our Mnesia databases? Is there any way we can dump out the data
> into some raw form, and then import it back into a new fresh cluster?
> >
>
> I'm afraid there are not, at least not "off the shelf" ones anyway. If you
> are desperate to recover important production data however, I'm sure we
> could explore the possibility of trying to help with that somehow. Let me
> know and I'll make some enquiries at this end.
>

At this point we can move on from the data loss... but it does make for an
interesting issue. Having tools to analyze the Mnesia DB and get "most of"
the messages out in some format where they could be re-injected into a
fresh cluster would be an incredibly useful tool. I wonder how hard it is
to do?


> Cheers,
> Tim
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/c319f978/attachment.htm>

From frank.shearar at gmail.com  Wed Nov  6 16:18:29 2013
From: frank.shearar at gmail.com (Frank Shearar)
Date: Wed, 6 Nov 2013 16:18:29 +0000
Subject: [rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster
In-Reply-To: <CAOHkZxPLAJqBZcYuV9cOFigiKk=9C5e1zEuZd5bP5j_jm0WSXA@mail.gmail.com>
References: <CAOHkZxOYjFQOB2xW0E921SJiag3oh0m6+R9qbu=gWxwa+YTXLg@mail.gmail.com>
	<D7A91190-9DC6-4740-9658-DD39723FCF7C@rabbitmq.com>
	<CAOHkZxPLAJqBZcYuV9cOFigiKk=9C5e1zEuZd5bP5j_jm0WSXA@mail.gmail.com>
Message-ID: <CAJbhyRGxcOU8sKH_fJmg9oXhqLuvaJJtRNBa6sA2ZjZGjzo42g@mail.gmail.com>

On 6 November 2013 16:02, Matt Wise <matt at nextdoor.com> wrote:
> See comments inline.
>
>
> On Wed, Nov 6, 2013 at 2:37 AM, Tim Watson <tim at rabbitmq.com> wrote:
>>
>> Hi Matt,
>>
>> Sorry to hear you've been running into problems.
>>
>> On 5 Nov 2013, at 22:05, Matt Wise wrote:
>>
>> > (sorry if this gets posted twice.. first email never seemed to make it
>> > to the list)
>> >
>> > Hey... I had a pretty rough time today with a 3-node RabbitMQ 3.1.3
>> > cluster thats under pretty heavy use (6-7 million messages per day -- 100MB
>> > peak bandwidth per node). I want to pose a few questions here. First off,
>> > here's the basic configuration though.
>> >
>> > Configuration:
>> >   serverA, serverB and serverC are all configured with RabbitMQ 3.1.3.
>> > They each are configured via Puppet ... and Puppet uses a dynamic node
>> > discovery plugin (zookeeper) to find the nodes. The node lists are
>> > hard-coded into the rabbitmq.config file. A dynamic server list generator
>> > supplies Puppet with this list of servers (and is not really necessary to
>> > describe here in this email).
>> >
>> > Scenario:
>> >   A momentary configuration blip caused serverA and serverB to begin
>> > reconfiguring their rabbitmq.config files... when they did this, they also
>> > both issued a 'service rabbitmq restart' command. This command took
>> > 40+minutes and ultimately failed. During this failure, RabbitMQ was
>> > technically running and accepting connections to the TCP ports ... but it
>> > would not actually answer any queries. Commands like list_queues would hang
>> > indefinitely.
>> >
>>
>> What ha recovery policy (if any) do you have set up? A and B might get a
>> different "view of the world" set up in their respective rabbitmq.config
>> files (either to each other and/or to C) and then get restarted, but this
>> should affect their view of the cluster, because as per
>> http://www.rabbitmq.com/clustering.html:
>>
>> "Note that the cluster configuration is applied only to fresh nodes. A
>> fresh nodes is a node which has just been reset or is being start for the
>> first time. Thus, the automatic clustering won't take place after restarts
>> of nodes. This means that any change to the clustering via rabbitmqctl will
>> take precedence over the automatic clustering configuration."
>>
>
> So far we've taken the approach that clustering configuration should be
> hard-coded into the rabbitmq.config files. This works well in explicitly
> defining all of the hosts in a cluster on every machine, but it also means
> that adding a 4th node to a 3-node cluster will cause the 3 running live
> nodes to do a full service restart, which is bad. Our rabbitmq.config though
> is identical on all of the machines (other than the server-list, which may
> have been in-flux when Puppet was restarting these services)
>
>> [
>>         {rabbit, [
>>                 {log_levels, [{connection, warning}]},
>>                 {cluster_partition_handling,pause_minority},
>>                 {tcp_listeners, [ 5672 ] },
>>                 {ssl_listeners, [ 5673 ] },
>>                 {ssl_options,
>> [{cacertfile,"/etc/rabbitmq/ssl/cacert.pem"},
>>                         {certfile,"/etc/rabbitmq/ssl/cert.pem"},
>>                         {keyfile,"/etc/rabbitmq/ssl/key.pem"},
>>                         {verify,verify_peer},
>>                         {fail_if_no_peer_cert,true}
>>                 ]},
>>                 {cluster_nodes,['rabbit at i-23cf477b', 'rabbit at i-07d8bc5f',
>> 'rabbit at i-a3291cf8']}
>>         ]}
>> ].
>
>
>>
>> > Questions:
>> >   1. We only had ~2500 messages in the queues (they are HA'd and
>> > durable). The policy is { 'ha-mode': 'all' }. When serverA and serverB
>> > restarted, why did they never come up? Unfortunately in the restart process,
>> > they blew away their log files as well which makes this really tough to
>> > troubleshoot.
>>
>> It's nigh on impossible to guess what might've gone wrong without any log
>> files to verify against. We could sit and stare at all the relevant code for
>> weeks and not spot a bug that's been triggered here, since if it were
>> obvious we would've fixed it already.
>>
>> If you can give us a very precise set of steps (and timings) that led to
>> this situation, I can try and replicate what you've seen, but I don't fancy
>> my chances to be honest.
>
>
> Its a tough one for us to reproduce.. but I think the closest steps would
> be:
>
>   1. Create a 3-node cluster... configured with similar config to the one I
> pasted above.
>   2. Create enough publishers and subscribers that you have a few hundred
> messages/sec going through the three machines.
>   3. On MachineA and MachineC, remove MachineB from the config file.
>   4. Restart MachineA's rabbitmq daemon using init script
>   5. Wait 3 minutes... theoretically #4 is still in process.. now issue the
> same restart to MachineC.
>
>   Fail.
>
> Thats our best guess right now.. but agreed, the logs are a problem. Can we
> configure RabbitMQ to log through syslog for the future?

Syslog-ng can tail logs, dumping the logs in some arbitrary
destination (another file, Papertrail, etc.)

frank

>> >   2. I know that restarting serverA and serverB at nearly the same time
>> > is obviously a bad idea -- we'll be implementing some changes so this
>> > doesn't happen again -- but could this have lead to data corruption?
>>
>> It's possible, though obviously that shouldn't really happen. How close
>> were the restarts to one another? How many HA queues were mirrored across
>> these nodes, and were they all very busy (as your previous comment about
>> load seems to suggest)? We could try replicating that scenario in our tests,
>> though it's not easy to get the timing right and obviously the existence of
>> network infrastructure on which the nodes are running won't be the same (and
>> that can make a surprisingly big difference IME).
>
>
> The restarts were within a few minutes of each other. There are 5 queues,
> and all 5 queues are set to mirror to 'all' nodes in the cluster. They were
> busy, but no more than maybe 100 messages/sec coming in/out.
>
>>
>>
>> > Once the entire RabbitMQ farm was shut down, we actually were forced to
>> > move the rabbitmq data directory out of the way and start up the farm
>> > completely with blank databases. It seemed that RabbitMQ 3.1.3 really did
>> > not want to recover from this failure. Any thoughts?
>> >
>> >   3. Lastly .. in the event of future failures, what tools are there for
>> > recovering our Mnesia databases? Is there any way we can dump out the data
>> > into some raw form, and then import it back into a new fresh cluster?
>> >
>>
>> I'm afraid there are not, at least not "off the shelf" ones anyway. If you
>> are desperate to recover important production data however, I'm sure we
>> could explore the possibility of trying to help with that somehow. Let me
>> know and I'll make some enquiries at this end.
>
>
> At this point we can move on from the data loss... but it does make for an
> interesting issue. Having tools to analyze the Mnesia DB and get "most of"
> the messages out in some format where they could be re-injected into a fresh
> cluster would be an incredibly useful tool. I wonder how hard it is to do?
>
>>
>> Cheers,
>> Tim
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From matt at nextdoor.com  Wed Nov  6 16:23:16 2013
From: matt at nextdoor.com (Matt Wise)
Date: Wed, 6 Nov 2013 08:23:16 -0800
Subject: [rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster
In-Reply-To: <CAJbhyRGxcOU8sKH_fJmg9oXhqLuvaJJtRNBa6sA2ZjZGjzo42g@mail.gmail.com>
References: <CAOHkZxOYjFQOB2xW0E921SJiag3oh0m6+R9qbu=gWxwa+YTXLg@mail.gmail.com>
	<D7A91190-9DC6-4740-9658-DD39723FCF7C@rabbitmq.com>
	<CAOHkZxPLAJqBZcYuV9cOFigiKk=9C5e1zEuZd5bP5j_jm0WSXA@mail.gmail.com>
	<CAJbhyRGxcOU8sKH_fJmg9oXhqLuvaJJtRNBa6sA2ZjZGjzo42g@mail.gmail.com>
Message-ID: <CAOHkZxOPWG+VffH1sXruead0-DJw29b8hJOH4P-rxiLaPuTE1g@mail.gmail.com>

Sure .. but I'm wondering if there is native syslog support in RabbitMQ.
Its much cleaner that way.

Matt Wise
Sr. Systems Architect
Nextdoor.com


On Wed, Nov 6, 2013 at 8:18 AM, Frank Shearar <frank.shearar at gmail.com>wrote:

> On 6 November 2013 16:02, Matt Wise <matt at nextdoor.com> wrote:
> > See comments inline.
> >
> >
> > On Wed, Nov 6, 2013 at 2:37 AM, Tim Watson <tim at rabbitmq.com> wrote:
> >>
> >> Hi Matt,
> >>
> >> Sorry to hear you've been running into problems.
> >>
> >> On 5 Nov 2013, at 22:05, Matt Wise wrote:
> >>
> >> > (sorry if this gets posted twice.. first email never seemed to make it
> >> > to the list)
> >> >
> >> > Hey... I had a pretty rough time today with a 3-node RabbitMQ 3.1.3
> >> > cluster thats under pretty heavy use (6-7 million messages per day --
> 100MB
> >> > peak bandwidth per node). I want to pose a few questions here. First
> off,
> >> > here's the basic configuration though.
> >> >
> >> > Configuration:
> >> >   serverA, serverB and serverC are all configured with RabbitMQ 3.1.3.
> >> > They each are configured via Puppet ... and Puppet uses a dynamic node
> >> > discovery plugin (zookeeper) to find the nodes. The node lists are
> >> > hard-coded into the rabbitmq.config file. A dynamic server list
> generator
> >> > supplies Puppet with this list of servers (and is not really
> necessary to
> >> > describe here in this email).
> >> >
> >> > Scenario:
> >> >   A momentary configuration blip caused serverA and serverB to begin
> >> > reconfiguring their rabbitmq.config files... when they did this, they
> also
> >> > both issued a 'service rabbitmq restart' command. This command took
> >> > 40+minutes and ultimately failed. During this failure, RabbitMQ was
> >> > technically running and accepting connections to the TCP ports ...
> but it
> >> > would not actually answer any queries. Commands like list_queues
> would hang
> >> > indefinitely.
> >> >
> >>
> >> What ha recovery policy (if any) do you have set up? A and B might get a
> >> different "view of the world" set up in their respective rabbitmq.config
> >> files (either to each other and/or to C) and then get restarted, but
> this
> >> should affect their view of the cluster, because as per
> >> http://www.rabbitmq.com/clustering.html:
> >>
> >> "Note that the cluster configuration is applied only to fresh nodes. A
> >> fresh nodes is a node which has just been reset or is being start for
> the
> >> first time. Thus, the automatic clustering won't take place after
> restarts
> >> of nodes. This means that any change to the clustering via rabbitmqctl
> will
> >> take precedence over the automatic clustering configuration."
> >>
> >
> > So far we've taken the approach that clustering configuration should be
> > hard-coded into the rabbitmq.config files. This works well in explicitly
> > defining all of the hosts in a cluster on every machine, but it also
> means
> > that adding a 4th node to a 3-node cluster will cause the 3 running live
> > nodes to do a full service restart, which is bad. Our rabbitmq.config
> though
> > is identical on all of the machines (other than the server-list, which
> may
> > have been in-flux when Puppet was restarting these services)
> >
> >> [
> >>         {rabbit, [
> >>                 {log_levels, [{connection, warning}]},
> >>                 {cluster_partition_handling,pause_minority},
> >>                 {tcp_listeners, [ 5672 ] },
> >>                 {ssl_listeners, [ 5673 ] },
> >>                 {ssl_options,
> >> [{cacertfile,"/etc/rabbitmq/ssl/cacert.pem"},
> >>                         {certfile,"/etc/rabbitmq/ssl/cert.pem"},
> >>                         {keyfile,"/etc/rabbitmq/ssl/key.pem"},
> >>                         {verify,verify_peer},
> >>                         {fail_if_no_peer_cert,true}
> >>                 ]},
> >>                 {cluster_nodes,['rabbit at i-23cf477b', 'rabbit at i-07d8bc5f
> ',
> >> 'rabbit at i-a3291cf8']}
> >>         ]}
> >> ].
> >
> >
> >>
> >> > Questions:
> >> >   1. We only had ~2500 messages in the queues (they are HA'd and
> >> > durable). The policy is { 'ha-mode': 'all' }. When serverA and serverB
> >> > restarted, why did they never come up? Unfortunately in the restart
> process,
> >> > they blew away their log files as well which makes this really tough
> to
> >> > troubleshoot.
> >>
> >> It's nigh on impossible to guess what might've gone wrong without any
> log
> >> files to verify against. We could sit and stare at all the relevant
> code for
> >> weeks and not spot a bug that's been triggered here, since if it were
> >> obvious we would've fixed it already.
> >>
> >> If you can give us a very precise set of steps (and timings) that led to
> >> this situation, I can try and replicate what you've seen, but I don't
> fancy
> >> my chances to be honest.
> >
> >
> > Its a tough one for us to reproduce.. but I think the closest steps would
> > be:
> >
> >   1. Create a 3-node cluster... configured with similar config to the
> one I
> > pasted above.
> >   2. Create enough publishers and subscribers that you have a few hundred
> > messages/sec going through the three machines.
> >   3. On MachineA and MachineC, remove MachineB from the config file.
> >   4. Restart MachineA's rabbitmq daemon using init script
> >   5. Wait 3 minutes... theoretically #4 is still in process.. now issue
> the
> > same restart to MachineC.
> >
> >   Fail.
> >
> > Thats our best guess right now.. but agreed, the logs are a problem. Can
> we
> > configure RabbitMQ to log through syslog for the future?
>
> Syslog-ng can tail logs, dumping the logs in some arbitrary
> destination (another file, Papertrail, etc.)
>
> frank
>
> >> >   2. I know that restarting serverA and serverB at nearly the same
> time
> >> > is obviously a bad idea -- we'll be implementing some changes so this
> >> > doesn't happen again -- but could this have lead to data corruption?
> >>
> >> It's possible, though obviously that shouldn't really happen. How close
> >> were the restarts to one another? How many HA queues were mirrored
> across
> >> these nodes, and were they all very busy (as your previous comment about
> >> load seems to suggest)? We could try replicating that scenario in our
> tests,
> >> though it's not easy to get the timing right and obviously the
> existence of
> >> network infrastructure on which the nodes are running won't be the same
> (and
> >> that can make a surprisingly big difference IME).
> >
> >
> > The restarts were within a few minutes of each other. There are 5 queues,
> > and all 5 queues are set to mirror to 'all' nodes in the cluster. They
> were
> > busy, but no more than maybe 100 messages/sec coming in/out.
> >
> >>
> >>
> >> > Once the entire RabbitMQ farm was shut down, we actually were forced
> to
> >> > move the rabbitmq data directory out of the way and start up the farm
> >> > completely with blank databases. It seemed that RabbitMQ 3.1.3 really
> did
> >> > not want to recover from this failure. Any thoughts?
> >> >
> >> >   3. Lastly .. in the event of future failures, what tools are there
> for
> >> > recovering our Mnesia databases? Is there any way we can dump out the
> data
> >> > into some raw form, and then import it back into a new fresh cluster?
> >> >
> >>
> >> I'm afraid there are not, at least not "off the shelf" ones anyway. If
> you
> >> are desperate to recover important production data however, I'm sure we
> >> could explore the possibility of trying to help with that somehow. Let
> me
> >> know and I'll make some enquiries at this end.
> >
> >
> > At this point we can move on from the data loss... but it does make for
> an
> > interesting issue. Having tools to analyze the Mnesia DB and get "most
> of"
> > the messages out in some format where they could be re-injected into a
> fresh
> > cluster would be an incredibly useful tool. I wonder how hard it is to
> do?
> >
> >>
> >> Cheers,
> >> Tim
> >>
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/013bd6c0/attachment.htm>

From sergey at openbridge.com  Wed Nov  6 16:23:20 2013
From: sergey at openbridge.com (Sergey Dobrovolskiy)
Date: Wed, 6 Nov 2013 08:23:20 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Crashed!  HA queue disappeared,
 all messages with delivery_mode=2 are gone!
Message-ID: <8b2170a1-fa46-45a7-a256-a60a0ae18aa5@googlegroups.com>

Hi everybody,

I'm testing RabbitMQ and can't get it to work properly! 

So that's what I have: 

two c1.xlarge nodes running on EC2. One Ram node and one Disk node. 

I created a test queue. setted up it as a HA mirrored queue like this:

rabbitmqctl set_policy -p / HA "^ha.*" '{"ha-mode":"all", 
> "ha-sync-mode":"automatic"}'
>

Then ran this command to see if everything worked well:

[root at rabbita ~]$ rabbitmqctl list_queues name messages pid slave_pids 
synchronised_slave_pids
Listing queues ...
ha.api.postworker    0    <'rabbit at rabbit-master'.1.853.0>    
[<rabbit at rabbita.2.1122.0>]    [<rabbit at rabbita.2.1122.0>]


After this I was expecting that all the messages that will get to the queue 
will be automatically synchronised (mirrored) between all nodes. In my case 
there is only one additional node. So I would expect that even if one node 
goes down for some reason, another node would have this queue defined and 
all the messages will still be there. NOTE, I was sending messages with 
delivery_mode set to 2. Meaning they are durable and will be saved to 
disk!!!!

Than the actual test:

1 producer - was sending messages messages at a rate about 2000 msgs/s. 
Each message is about 1kB long. 

Saw that Rabbit setted "Flow control" periodically.

I tried to fill up the queue up to some point. So at the time when I added 
consumers, I had about 200 k msgs in the queue

had 6 consumers:

Each where using basic_consume() 
with prefetch count = 3000

There where about 4k unacknowledged messages  constantly.

THEN BOOM!

RAM node went down and ALL THE MESSAGES and even Queue where deleted, they 
just disappeared. 
here is the screenshot from UI:

You can see that there where 150K messages and then suddenly, 0. + all 
consumers are gone, because they can't connect to the Q.
Also NOTE that even that Disk node  (rabbita) is Red, it will be 
functioning after crash, but the node above, RAM node, will crash.

<https://lh6.googleusercontent.com/-z0jfOUTy5eA/UnpsY_34yHI/AAAAAAAAABA/EJQLb5ou7wA/s1600/rabbitmq.png>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/bcb240d2/attachment.htm>

From sergey at openbridge.com  Wed Nov  6 16:37:34 2013
From: sergey at openbridge.com (Sergey Dobrovolskiy)
Date: Wed, 6 Nov 2013 08:37:34 -0800 (PST)
Subject: [rabbitmq-discuss] Disappearing Durable Queues
In-Reply-To: <27ad551e-3983-4159-9330-30512c905da2@googlegroups.com>
References: <27ad551e-3983-4159-9330-30512c905da2@googlegroups.com>
Message-ID: <4bb0c0d8-0995-4fdb-8689-06779f1c8987@googlegroups.com>


I'm also interesting to hear some opinion about this question? We are 
having exactly the same issue. and exactly the same error dump. Here I 
asked similar question, it might have a little bit more information: 
https://groups.google.com/forum/#!topic/rabbitmq-discuss/BgFP3fAPkd8
On Thursday, October 10, 2013 12:46:30 PM UTC-4, Rafe Colton wrote:
>
> Hi All,
>
> We are having a serious issue with the frequent disappearance of durable 
> queues.  The queues are not marked as auto-delete, and the queues and all 
> of their messages are marked as durable.  We have an HA cluster of 3 nodes 
> with ha-mode: all and ha-sync-mode: automatic.
>
> Can anybody offer some advice or help?
>
> Other relevant information:
> Platform - SmartOS
> Erlang version - 15.1.3.1
> RabbitMQ version - 3.1.0
>
> And here is the error message from the sasl log:
>
>      Supervisor: {local,
>                                            rabbit_mirror_queue_slave_sup}
>      Context:    child_terminated
>      Reason:     {{badmatch,{error,not_found}},
>                   [{rabbit_amqqueue_process,i,2,
>                       
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,934}]},
>                    {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,
>                       
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,921}]},
>                    {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,
>                       
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,921}]},
>                    {rabbit_amqqueue_process,emit_stats,2,
>                       
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,994}]},
>                    {rabbit_event,if_enabled,3,
>                        [{file,"src/rabbit_event.erl"},{line,137}]},
>                    {rabbit_amqqueue_process,'-terminate/2-fun-3-',5,
>                       
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,164}]},
>                    {rabbit_amqqueue_process,terminate_shutdown,2,
>                       
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,272}]},
>                    {gen_server2,terminate,3,
>                        [{file,"src/gen_server2.erl"},{line,1031}]}]}
>      Offender:   [{pid,<0.317.0>},
>                   {name,rabbit_mirror_queue_slave},
>                   {mfa,
>                       {rabbit_mirror_queue_slave,start_link,
>                           [{amqqueue,
>                                {resource,<<"/">>,queue,<<"(queue name)">>},
>                                true,false,none,[],<7009.319.0>,
>                                [<7010.311.0>],
>                                [<7010.311.0>],
>                                [{vhost,<<"/">>},
>                                 {name,<<"ha-all">>},
>                                 {pattern,<<"^.*">>},
>                                 {definition,
>                                     [{<<"ha-mode">>,<<"all">>},
>                                     
>  {<<"ha-sync-mode">>,<<"automatic">>}]},
>                                 {priority,0}],
>                                [{<7010.312.0>,<7010.311.0>},
>                                 {<7009.320.0>,<7009.319.0>}]}]}},
>                   {restart_type,temporary},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/95d12f24/attachment.htm>

From sergey at openbridge.com  Wed Nov  6 16:37:34 2013
From: sergey at openbridge.com (Sergey Dobrovolskiy)
Date: Wed, 6 Nov 2013 08:37:34 -0800 (PST)
Subject: [rabbitmq-discuss] Disappearing Durable Queues
In-Reply-To: <27ad551e-3983-4159-9330-30512c905da2@googlegroups.com>
References: <27ad551e-3983-4159-9330-30512c905da2@googlegroups.com>
Message-ID: <4bb0c0d8-0995-4fdb-8689-06779f1c8987@googlegroups.com>


I'm also interesting to hear some opinion about this question? We are 
having exactly the same issue. and exactly the same error dump. Here I 
asked similar question, it might have a little bit more information: 
https://groups.google.com/forum/#!topic/rabbitmq-discuss/BgFP3fAPkd8
On Thursday, October 10, 2013 12:46:30 PM UTC-4, Rafe Colton wrote:
>
> Hi All,
>
> We are having a serious issue with the frequent disappearance of durable 
> queues.  The queues are not marked as auto-delete, and the queues and all 
> of their messages are marked as durable.  We have an HA cluster of 3 nodes 
> with ha-mode: all and ha-sync-mode: automatic.
>
> Can anybody offer some advice or help?
>
> Other relevant information:
> Platform - SmartOS
> Erlang version - 15.1.3.1
> RabbitMQ version - 3.1.0
>
> And here is the error message from the sasl log:
>
>      Supervisor: {local,
>                                            rabbit_mirror_queue_slave_sup}
>      Context:    child_terminated
>      Reason:     {{badmatch,{error,not_found}},
>                   [{rabbit_amqqueue_process,i,2,
>                       
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,934}]},
>                    {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,
>                       
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,921}]},
>                    {rabbit_amqqueue_process,'-infos/2-lc$^0/1-0-',2,
>                       
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,921}]},
>                    {rabbit_amqqueue_process,emit_stats,2,
>                       
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,994}]},
>                    {rabbit_event,if_enabled,3,
>                        [{file,"src/rabbit_event.erl"},{line,137}]},
>                    {rabbit_amqqueue_process,'-terminate/2-fun-3-',5,
>                       
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,164}]},
>                    {rabbit_amqqueue_process,terminate_shutdown,2,
>                       
>  [{file,"src/rabbit_amqqueue_process.erl"},{line,272}]},
>                    {gen_server2,terminate,3,
>                        [{file,"src/gen_server2.erl"},{line,1031}]}]}
>      Offender:   [{pid,<0.317.0>},
>                   {name,rabbit_mirror_queue_slave},
>                   {mfa,
>                       {rabbit_mirror_queue_slave,start_link,
>                           [{amqqueue,
>                                {resource,<<"/">>,queue,<<"(queue name)">>},
>                                true,false,none,[],<7009.319.0>,
>                                [<7010.311.0>],
>                                [<7010.311.0>],
>                                [{vhost,<<"/">>},
>                                 {name,<<"ha-all">>},
>                                 {pattern,<<"^.*">>},
>                                 {definition,
>                                     [{<<"ha-mode">>,<<"all">>},
>                                     
>  {<<"ha-sync-mode">>,<<"automatic">>}]},
>                                 {priority,0}],
>                                [{<7010.312.0>,<7010.311.0>},
>                                 {<7009.320.0>,<7009.319.0>}]}]}},
>                   {restart_type,temporary},
>                   {shutdown,4294967295},
>                   {child_type,worker}]
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/95d12f24/attachment-0001.htm>

From simon at rabbitmq.com  Wed Nov  6 16:42:02 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Nov 2013 16:42:02 +0000
Subject: [rabbitmq-discuss] RabbitMQ Crashed!  HA queue disappeared,
 all messages with delivery_mode=2 are gone!
In-Reply-To: <8b2170a1-fa46-45a7-a256-a60a0ae18aa5@googlegroups.com>
References: <8b2170a1-fa46-45a7-a256-a60a0ae18aa5@googlegroups.com>
Message-ID: <527A715A.9030908@rabbitmq.com>

Do you have any logs?

Cheers, Simon

On 06/11/13 16:23, Sergey Dobrovolskiy wrote:
> Hi everybody,
>
> I'm testing RabbitMQ and can't get it to work properly!
>
> So that's what I have:
>
> two c1.xlarge nodes running on EC2. One Ram node and one Disk node.
>
> I created a test queue. setted up it as a HA mirrored queue like this:
>
>     rabbitmqctl set_policy -p / HA "^ha.*" '{"ha-mode":"all",
>     "ha-sync-mode":"automatic"}'
>
>
> Then ran this command to see if everything worked well:
>
>     [root at rabbita ~]$ rabbitmqctl list_queues name messages pid
>     slave_pids synchronised_slave_pids
>     Listing queues ...
>     ha.api.postworker    0    <'rabbit at rabbit-master'.1.853.0>
>     [<rabbit at rabbita.2.1122.0>]    [<rabbit at rabbita.2.1122.0>]
>
>
> After this I was expecting that all the messages that will get to the
> queue will be automatically synchronised (mirrored) between all nodes.
> In my case there is only one additional node. So I would expect that
> even if one node goes down for some reason, another node would have this
> queue defined and all the messages will still be there. NOTE, I was
> sending messages with delivery_mode set to 2. Meaning they are durable
> and will be saved to disk!!!!
>
> Than the actual test:
>
> 1 producer - was sending messages messages at a rate about 2000 msgs/s.
> Each message is about 1kB long.
>
> Saw that Rabbit setted "Flow control" periodically.
>
> I tried to fill up the queue up to some point. So at the time when I
> added consumers, I had about 200 k msgs in the queue
>
> had 6 consumers:
>
> Each where using basic_consume()
> with prefetch count = 3000
>
> There where about 4k unacknowledged messages  constantly.
>
> THEN BOOM!
>
> RAM node went down and ALL THE MESSAGES and even Queue where deleted,
> they just disappeared.
> here is the screenshot from UI:
>
> You can see that there where 150K messages and then suddenly, 0. + all
> consumers are gone, because they can't connect to the Q.
> Also NOTE that even that Disk node  (rabbita) is Red, it will be
> functioning after crash, but the node above, RAM node, will crash.
>
> <https://lh6.googleusercontent.com/-z0jfOUTy5eA/UnpsY_34yHI/AAAAAAAAABA/EJQLb5ou7wA/s1600/rabbitmq.png>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From lijo at citrusinformatics.com  Wed Nov  6 10:17:55 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Wed, 6 Nov 2013 15:47:55 +0530
Subject: [rabbitmq-discuss] using RabbitMQ JSON RPC channel with C#
Message-ID: <C74203AFAFCA4EAC89BDEBA26FFC5970@Lijo>

Hi All, 
Your urgent help needed on the following query.
I have a requirement where messages should be published/subscribed over http, just like the sample chat application works with json_rpc_channel plugin.
Please guide me through!
Is there any sample available for the chat application works with c#?


Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/af7e23b0/attachment.htm>

From sid.young at gmail.com  Wed Nov  6 11:42:00 2013
From: sid.young at gmail.com (Sid Young)
Date: Wed, 6 Nov 2013 03:42:00 -0800 (PST)
Subject: [rabbitmq-discuss] Trigger Monitor functionality (like websphere MQ
	has)?
Message-ID: <2f150108-6eda-4d62-937f-67044412c756@googlegroups.com>

G'Day all,

I am trying to evaluate RabbitMQ functionality and in particular I need the 
ability to start applications when messages arrive in certain queues. In 
IBM websphere its called Triggered Apps and its performed by a "Trigger 
Monitor" that attaches to a selected "trigger message" queue and monitors 
the trigger queue for a message to fire the required application (a trigger 
monitor can fire a number of different apps, its just a generic tool).

Does this functionality exist in RabbitMQ in any form???

Thanks in advance for any replies.

Sid
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/cd10392a/attachment.htm>

From mklishin at gopivotal.com  Wed Nov  6 17:24:54 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 21:24:54 +0400
Subject: [rabbitmq-discuss] Trigger Monitor functionality (like
	websphere MQ has)?
In-Reply-To: <2f150108-6eda-4d62-937f-67044412c756@googlegroups.com>
References: <2f150108-6eda-4d62-937f-67044412c756@googlegroups.com>
Message-ID: <06F51E2C-B65C-4DC9-AD9A-81DFEEAC3B77@rabbitmq.com>

On 6 Nov 2013, at 15:42, Sid Young <sid.young at gmail.com> wrote:

> Does this functionality exist in RabbitMQ in any form???

Nothing like that is built in but a pretty trivial message consumer app can do that
(and will give you a lot of flexibility).

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Wed Nov  6 17:32:10 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 21:32:10 +0400
Subject: [rabbitmq-discuss] using RabbitMQ JSON RPC channel with C#
In-Reply-To: <C74203AFAFCA4EAC89BDEBA26FFC5970@Lijo>
References: <C74203AFAFCA4EAC89BDEBA26FFC5970@Lijo>
Message-ID: <B50BECFE-85A2-49BC-90A6-F1B5AE85F467@rabbitmq.com>

On 6 Nov 2013, at 14:17, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

> Hi All,
> Your urgent help needed on the following query.
> I have a requirement where messages should be published/subscribed over http, just like the sample chat application works with json_rpc_channel plugin.
> Please guide me through!
> Is there any sample available for the chat application works with c#?

Lijo,

There were 3 replies to your earlier posts:
http://markmail.org/thread/uam7kyj7bnfx6jyr

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Wed Nov  6 18:19:46 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 22:19:46 +0400
Subject: [rabbitmq-discuss] ANN Bunny 1.0.1 is released
Message-ID: <A53512E4-16C2-4882-AC91-17330EC175DF@rabbitmq.com>

Bunny 1.0.1 is released to rubygems.org [1].

This is a JRuby-specific bug fix release but all
users are encouraged to upgrade.

Change log:
http://blog.rubyrabbitmq.info/blog/2013/11/06/bunny-1-dot-0-1-is-released/

1. https://rubygems.org/gems/bunny/versions/1.0.1

MK

Software Engineer, Pivotal/RabbitMQ



From michael.s.klishin at gmail.com  Wed Nov  6 18:22:57 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 6 Nov 2013 22:22:57 +0400
Subject: [rabbitmq-discuss] ANN Langohr 1.6.0 is released
Message-ID: <CAE3HoVS2QXWdqVWUKds6Uet0P7cfECh1BDN6YFtcB6RzDRvCTw@mail.gmail.com>

Langohr is a small, feature complete Clojure client for RabbitMQ
that embraces AMQP 0-9-1 model [1].

1.6.0 is primarily a bug fix release.

Change log:
http://blog.clojurewerkz.org/blog/2013/11/05/langohr-1-dot-6-0-is-released/

1. http://clojurerabbitmq.info
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/bd1779d7/attachment.htm>

From mklishin at gopivotal.com  Wed Nov  6 18:53:39 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 6 Nov 2013 22:53:39 +0400
Subject: [rabbitmq-discuss] [ruby-amqp] ANN Bunny 1.0.1 is released
In-Reply-To: <A53512E4-16C2-4882-AC91-17330EC175DF@rabbitmq.com>
References: <A53512E4-16C2-4882-AC91-17330EC175DF@rabbitmq.com>
Message-ID: <A1A9A1AB-4CC5-4C0C-BD3B-04FAA80CF97C@gopivotal.com>

On 6 Nov 2013, at 22:19, Michael Klishin <mklishin at gopivotal.com> wrote:

> Bunny 1.0.1 is released to rubygems.org [1].

There was a silly mistake in 1.0.1 release process that excluded one of the fixes.
1.0.2 is out and should be used instead.
--
MK

Software Engineer, Pivotal/RabbitMQ



From jan.wedel at googlemail.com  Wed Nov  6 18:53:59 2013
From: jan.wedel at googlemail.com (Jan Wedel)
Date: Wed, 6 Nov 2013 19:53:59 +0100
Subject: [rabbitmq-discuss] Rabbitmq server at 100% CPU after sleep mode
Message-ID: <9071B92E-5929-4ED6-AC41-8A48F95C1187@gmail.com>

Hi,

I?m not sure if this has been discussed already or even solved, but here?s the problem:

I?m running rabbit 3.2 built with brew on OSX 10.9.

Everytime I return from sleep mode or hibernate, the beam.smp process is running at 100% CPU. Sometimes it returns back to normal, sometimes I have to kill the process (probably because I?m impatient).

If I try to run rabbitmqctl, also this process hangs:

$ rabbitmqctl report
Reporting server status on {{2013,11,6},{18,26,21}}

 ...
Status of node rabbit at localhost ...
^C
BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
       (v)ersion (k)ill (D)b-tables (d)istribution
a

$ rabbitmqctl status
Status of node rabbit at localhost ...
^C
BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
       (v)ersion (k)ill (D)b-tables (d)istribution
a

Any ideas how to solve the problem? Can I provide any information? The log files doesn?t have any entries today although the problem just occurred.

Thanks,

Jan

From jcua at eventbrite.com  Wed Nov  6 20:00:21 2013
From: jcua at eventbrite.com (Jonathan Cua)
Date: Wed, 6 Nov 2013 12:00:21 -0800
Subject: [rabbitmq-discuss] Durable Queues Crash
In-Reply-To: <5279FC55.50107@rabbitmq.com>
References: <948F60AA-9750-4942-91A2-58FFB2330E16@eventbrite.com>
	<5279802D.3010704@rabbitmq.com>
	<13257F62-D1AE-44E0-93ED-2BFECFF8DB27@eventbrite.com>
	<E6DE9F52-AB49-4234-AF62-EC56747C338D@eventbrite.com>
	<5279FC55.50107@rabbitmq.com>
Message-ID: <3EFE3F99-4A71-48F6-93C4-61D23CDE88BF@eventbrite.com>

Awesome! Do you have some idea when the new 3.2.1 will come out?

Jonathan

On Nov 6, 2013, at 12:22 AM, Simon MacMullen wrote:

> On 06/11/2013 01:14, Jonathan Cua wrote:
>> Actually looking at the sasl.log again, I see this prior to the first crash.
>> 
>> =CRASH REPORT==== 5-Nov-2013::12:31:47 ===
>>   crasher:
>>     initial call: gen:init_it/6
>>     pid: <0.13824.12>
>>     registered_name: []
>>     exception exit: {{badmatch,{error,not_found}},
>>                      [{rabbit_mirror_queue_master,stop_all_slaves,2},
>>                       {rabbit_mirror_queue_master,delete_and_terminate,2},
> 
> <snip>
> 
>> And sometimes we would get this variation of another 'crash'...
>> 
>> =CRASH REPORT==== 5-Nov-2013::14:47:59 ===
>>   crasher:
>>     initial call: gen:init_it/6
>>     pid: <0.2803.0>
>>     registered_name: []
>>     exception exit: {function_clause,
>>                         [{rabbit_mirror_queue_slave,forget_sender,
>>                              [down_from_gm,down_from_gm]},
>>                          {rabbit_mirror_queue_slave,maybe_forget_sender,3},
>>                          {rabbit_mirror_queue_slave,process_instruction,2},
>>                          {rabbit_mirror_queue_slave,handle_cast,2},
>>                          {gen_server2,handle_msg,2},
>>                          {proc_lib,wake_up,3}]}
> 
> These are both known issues, fixed in nightly builds (and will be fixed in 3.2.1).
> 
> Cheers, Simon
> 


From simon at rabbitmq.com  Wed Nov  6 20:35:45 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 06 Nov 2013 20:35:45 +0000
Subject: [rabbitmq-discuss] Durable Queues Crash
In-Reply-To: <3EFE3F99-4A71-48F6-93C4-61D23CDE88BF@eventbrite.com>
References: <948F60AA-9750-4942-91A2-58FFB2330E16@eventbrite.com>
	<5279802D.3010704@rabbitmq.com>
	<13257F62-D1AE-44E0-93ED-2BFECFF8DB27@eventbrite.com>
	<E6DE9F52-AB49-4234-AF62-EC56747C338D@eventbrite.com>
	<5279FC55.50107@rabbitmq.com>
	<3EFE3F99-4A71-48F6-93C4-61D23CDE88BF@eventbrite.com>
Message-ID: <527AA821.5070100@rabbitmq.com>

On 06/11/2013 20:00, Jonathan Cua wrote:
> Awesome! Do you have some idea when the new 3.2.1 will come out?

Soon, since a few people have run into this bug.

Cheers, Simon

From sid.young at gmail.com  Wed Nov  6 21:08:14 2013
From: sid.young at gmail.com (Sid Young)
Date: Thu, 7 Nov 2013 07:08:14 +1000
Subject: [rabbitmq-discuss] Trigger Monitor functionality (like
 websphere MQ has)?
In-Reply-To: <06F51E2C-B65C-4DC9-AD9A-81DFEEAC3B77@rabbitmq.com>
References: <2f150108-6eda-4d62-937f-67044412c756@googlegroups.com>
	<06F51E2C-B65C-4DC9-AD9A-81DFEEAC3B77@rabbitmq.com>
Message-ID: <CAEZ+gOwbSL3WEC2Spd6gSis+vRvp7pAu0syFFS_COKoQkqnJvw@mail.gmail.com>

OK - thanks for the prompt response Michel.

While the trigger monitor part looks easy, it will need to relly on the
exchange to generate the trigger msg using parameters tied to the apps msg
queue. That way the one trigger queue can be used by numerous queues to
trigger different apps. However with the way messages can be duplicated in
RabbitMQ it might be possible to use a second copy of the data in a second
queue to trigger the app.... food for thought. i better start coding a
trigger monitor daemon!


Sid


On Thu, Nov 7, 2013 at 3:24 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 6 Nov 2013, at 15:42, Sid Young <sid.young at gmail.com> wrote:
>
> > Does this functionality exist in RabbitMQ in any form???
>
> Nothing like that is built in but a pretty trivial message consumer app
> can do that
> (and will give you a lot of flexibility).
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/3a306d37/attachment.htm>

From brian.locke at datascan.com  Thu Nov  7 01:20:19 2013
From: brian.locke at datascan.com (Brian Locke)
Date: Wed, 6 Nov 2013 19:20:19 -0600
Subject: [rabbitmq-discuss] C# client w/ASP.NET Channels not going away
Message-ID: <CAGepFFgaqjnGjCT6Ow-+E6ZfbSWN+0dVGwNm1EXEkK7P4Q7kvg@mail.gmail.com>

I'm sure this is something that I've missed in all my googling and rabbitMq
doc reading. I have an .NET WebAPI that creates a new IModel from a static
Connection then publishes messages with Confirm.Select(). Before calling
publish I add the IModel to an objectCache so that the Ack/nack callbacks
will get executed. Inside the BasicAckEventHandler I remove the model from
the cache. (This all works)

The problem is that the connections never go away from the RabbitMQ server.
I cannot find anything that is holding onto a reference of the IModel
object.

What I am I doing wrong here?


Thanks!
Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131106/530eb4a0/attachment.htm>

From lijo at citrusinformatics.com  Thu Nov  7 04:41:26 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Thu, 7 Nov 2013 10:11:26 +0530
Subject: [rabbitmq-discuss] amqp over http bridge with c#
Message-ID: <18E046514176481DA57C1C28941A7F26@Lijo>

Hi,  
       i have a scenario where my c# application should send/receive messages from server.
       But an nginx server will proxy pass the connection with default port 80 in between.
       Can i achieve a publish/subscribe mechanism with this feature.
       I tried with the basic samples available with the installation, and was not working.
       Guide me with  a valid solution.


Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/6f4e5418/attachment.htm>

From mklishin at gopivotal.com  Thu Nov  7 08:29:18 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 7 Nov 2013 12:29:18 +0400
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <18E046514176481DA57C1C28941A7F26@Lijo>
References: <18E046514176481DA57C1C28941A7F26@Lijo>
Message-ID: <1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com>

On 7 Nov 2013, at 08:41, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

>  i have a scenario where my c# application should send/receive messages from server.
>        But an nginx server will proxy pass the connection with default port 80 in between.

Answered in
http://markmail.org/thread/uam7kyj7bnfx6jyr

You cannot use Nginx to proxy HTTP traffic to port 5672
because HTTP and AMQP 0-9-1 are very different protocols.

MK

Software Engineer, Pivotal/RabbitMQ



From lijo at citrusinformatics.com  Thu Nov  7 08:41:44 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Thu, 7 Nov 2013 14:11:44 +0530
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com>
References: <18E046514176481DA57C1C28941A7F26@Lijo>
	<1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com>
Message-ID: <045A0B3933804AB3BEB68B3144D99FF9@Lijo>


You saying i cannot have a nginx server in between a client machine and 
server?


Regards,
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.
-----Original Message----- 
From: Michael Klishin
Sent: Thursday, November 07, 2013 1:59 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] amqp over http bridge with c#

On 7 Nov 2013, at 08:41, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

>  i have a scenario where my c# application should send/receive messages 
> from server.
>        But an nginx server will proxy pass the connection with default 
> port 80 in between.

Answered in
http://markmail.org/thread/uam7kyj7bnfx6jyr

You cannot use Nginx to proxy HTTP traffic to port 5672
because HTTP and AMQP 0-9-1 are very different protocols.

MK

Software Engineer, Pivotal/RabbitMQ


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 


From videlalvaro at gmail.com  Thu Nov  7 08:51:46 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 7 Nov 2013 09:51:46 +0100
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <045A0B3933804AB3BEB68B3144D99FF9@Lijo>
References: <18E046514176481DA57C1C28941A7F26@Lijo>
	<1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com>
	<045A0B3933804AB3BEB68B3144D99FF9@Lijo>
Message-ID: <CAMcAHLW5m8hR8MCxRV8oOZwiraadV0gLsk164SHFhuFo6D+09w@mail.gmail.com>

Lijo,

Why do you need to have nginx in front of your RabbitMQ server?

Why do you need to publish messages over HTTP?

Also, may I ask. Have you read and followed the tutorials offered on the
website? http://www.rabbitmq.com/getstarted.html

The tutorials will give you a good understanding of what RabbitMQ and AMQP
can do.

Regards,

Alvaro



On Thu, Nov 7, 2013 at 9:41 AM, Lijo Sebastian
<lijo at citrusinformatics.com>wrote:

>
> You saying i cannot have a nginx server in between a client machine and
> server?
>
>
>
> Regards,
> Lijo Sebastian
> Senior Software Engineer
> Citrus Informatics (India) Pvt Ltd.
> -----Original Message----- From: Michael Klishin
> Sent: Thursday, November 07, 2013 1:59 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] amqp over http bridge with c#
>
>
> On 7 Nov 2013, at 08:41, Lijo Sebastian <lijo at citrusinformatics.com>
> wrote:
>
>   i have a scenario where my c# application should send/receive messages
>> from server.
>>        But an nginx server will proxy pass the connection with default
>> port 80 in between.
>>
>
> Answered in
> http://markmail.org/thread/uam7kyj7bnfx6jyr
>
> You cannot use Nginx to proxy HTTP traffic to port 5672
> because HTTP and AMQP 0-9-1 are very different protocols.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/f9557368/attachment.htm>

From mklishin at gopivotal.com  Thu Nov  7 08:54:50 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 7 Nov 2013 12:54:50 +0400
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <045A0B3933804AB3BEB68B3144D99FF9@Lijo>
References: <18E046514176481DA57C1C28941A7F26@Lijo>
	<1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com>
	<045A0B3933804AB3BEB68B3144D99FF9@Lijo>
Message-ID: <B0916EC8-B047-4C1D-9EE5-87D08944FF18@gopivotal.com>

On 7 Nov 2013, at 12:41, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

> You saying i cannot have a nginx server in between a client machine and server?

You cannot use Nginx to proxy HTTP to RabbitMQ on port 5672. You can use
Nginx to proxy HTTP to port 15672 (management UI, HTTP API).

Please use HTTP API documentation [1] to learn how to solve your problem.

1. http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_0/priv/www/api/index.html
--
MK

Software Engineer, Pivotal/RabbitMQ



From watson.timothy at gmail.com  Thu Nov  7 09:52:16 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 7 Nov 2013 09:52:16 +0000
Subject: [rabbitmq-discuss] C# client w/ASP.NET Channels not going away
In-Reply-To: <CAGepFFgaqjnGjCT6Ow-+E6ZfbSWN+0dVGwNm1EXEkK7P4Q7kvg@mail.gmail.com>
References: <CAGepFFgaqjnGjCT6Ow-+E6ZfbSWN+0dVGwNm1EXEkK7P4Q7kvg@mail.gmail.com>
Message-ID: <0B9C75F6-C1FC-4F70-859A-E972ADAD86AC@rabbitmq.com>

Do you explicitly close/dispose connections/channels when you're finished with them?

On 7 Nov 2013, at 01:20, Brian Locke <brian.locke at datascan.com> wrote:

> I'm sure this is something that I've missed in all my googling and rabbitMq doc reading. I have an .NET WebAPI that creates a new IModel from a static Connection then publishes messages with Confirm.Select(). Before calling publish I add the IModel to an objectCache so that the Ack/nack callbacks will get executed. Inside the BasicAckEventHandler I remove the model from the cache. (This all works)
> 
> The problem is that the connections never go away from the RabbitMQ server. I cannot find anything that is holding onto a reference of the IModel object.
> 
> What I am I doing wrong here?
> 
> 
> Thanks!
> Brian
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From lijo at citrusinformatics.com  Thu Nov  7 09:56:51 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Thu, 7 Nov 2013 15:26:51 +0530
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <CAMcAHLW5m8hR8MCxRV8oOZwiraadV0gLsk164SHFhuFo6D+09w@mail.gmail.com>
References: <18E046514176481DA57C1C28941A7F26@Lijo><1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com><045A0B3933804AB3BEB68B3144D99FF9@Lijo>
	<CAMcAHLW5m8hR8MCxRV8oOZwiraadV0gLsk164SHFhuFo6D+09w@mail.gmail.com>
Message-ID: <DC6DA8DCAAB74F2AB4F7919071029942@Lijo>

Videla,  

                 Our requirement is like that. For security purposes, we do all incoming requests like this. nginx will redirect to the specified api or a webpage or anything.
                What we need here is a messaging protocol that supports Publish/Subscribe mechanism, that connects to server through nginx proxy pass.
                ave tried mqtt, xmpp etc. but they does not supports this http bridging.H
                Please let me know if this is possible with RabbitMQ, or any other MQ protocols.

Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.

From: Alvaro Videla 
Sent: Thursday, November 07, 2013 2:21 PM
To: Discussions about RabbitMQ 
Subject: Re: [rabbitmq-discuss] amqp over http bridge with c#

Lijo,

Why do you need to have nginx in front of your RabbitMQ server? 

Why do you need to publish messages over HTTP?

Also, may I ask. Have you read and followed the tutorials offered on the website? http://www.rabbitmq.com/getstarted.html

The tutorials will give you a good understanding of what RabbitMQ and AMQP can do.

Regards,

Alvaro




On Thu, Nov 7, 2013 at 9:41 AM, Lijo Sebastian <lijo at citrusinformatics.com> wrote:


  You saying i cannot have a nginx server in between a client machine and server? 



  Regards,
  Lijo Sebastian
  Senior Software Engineer
  Citrus Informatics (India) Pvt Ltd.

  -----Original Message----- From: Michael Klishin
  Sent: Thursday, November 07, 2013 1:59 PM
  To: Discussions about RabbitMQ
  Subject: Re: [rabbitmq-discuss] amqp over http bridge with c# 


  On 7 Nov 2013, at 08:41, Lijo Sebastian <lijo at citrusinformatics.com> wrote:


    i have a scenario where my c# application should send/receive messages from server.
           But an nginx server will proxy pass the connection with default port 80 in between.


  Answered in
  http://markmail.org/thread/uam7kyj7bnfx6jyr

  You cannot use Nginx to proxy HTTP traffic to port 5672
  because HTTP and AMQP 0-9-1 are very different protocols.

  MK

  Software Engineer, Pivotal/RabbitMQ


  _______________________________________________
  rabbitmq-discuss mailing list
  rabbitmq-discuss at lists.rabbitmq.com
  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
  _______________________________________________
  rabbitmq-discuss mailing list
  rabbitmq-discuss at lists.rabbitmq.com
  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




--------------------------------------------------------------------------------
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/b2636801/attachment.htm>

From mklishin at gopivotal.com  Thu Nov  7 10:01:42 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 7 Nov 2013 14:01:42 +0400
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <DC6DA8DCAAB74F2AB4F7919071029942@Lijo>
References: <18E046514176481DA57C1C28941A7F26@Lijo><1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com><045A0B3933804AB3BEB68B3144D99FF9@Lijo>
	<CAMcAHLW5m8hR8MCxRV8oOZwiraadV0gLsk164SHFhuFo6D+09w@mail.gmail.com>
	<DC6DA8DCAAB74F2AB4F7919071029942@Lijo>
Message-ID: <CA4AF9DE-E72E-410F-AEDD-82D14BAFC6F8@rabbitmq.com>

On 7 Nov 2013, at 13:56, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

>                 Please let me know if this is possible with RabbitMQ, or any other MQ protocols.
> 
> Regards, 
> Lijo Sebastian

Answered in
http://markmail.org/thread/uam7kyj7bnfx6jyr

Lijo, you?ve been given enough information to discover how to publish
and consume (via polling) messages over HTTP API.

No need to ask the same question over and over.

MK

Software Engineer, Pivotal/RabbitMQ



From l_ulrich2002 at yahoo.fr  Thu Nov  7 10:23:21 2013
From: l_ulrich2002 at yahoo.fr (l_ulrich2002 at yahoo.fr)
Date: Thu, 7 Nov 2013 02:23:21 -0800 (PST)
Subject: [rabbitmq-discuss] Failed to start RabbitMq and crash OS booting
	(debian)
Message-ID: <b2f4eb62-e117-4826-8d1d-280cf5f15955@googlegroups.com>

Hello, 

I experienced something weird on my developpement server.
RabbitMQ don't start and block my OS booting process, 

I'm using Debian Sqeeze and deb paquet of RabbitMQ server, not Debian 
paquet.

I mount /var/log on tmpfs and directory is fresh each time I start my 
laptop.
This is the problem, rabbitmq starting script (in 
/etc/init.d/rabbitmq-server) assume that dir /var/log/rabbitmq exists but 
in my case it doesn't.

I added on top of the srcipt after variable declaration a test if dir 
exists and if not I create it.
With this patch, RabbitMQ don't failed anymore.

I guess this test could be added for everyone.

Thanks 
Ulrich
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/51c50bec/attachment.htm>

From aadaml84 at gmail.com  Thu Nov  7 10:49:29 2013
From: aadaml84 at gmail.com (adaml)
Date: Thu, 7 Nov 2013 02:49:29 -0800 (PST)
Subject: [rabbitmq-discuss] Non-ascii characters in user's profile path. OS:
	Windows 7.
Message-ID: <df913021-c354-4605-8411-8e1cdfc08384@googlegroups.com>

Hi,

Please consider user named "Dzia? techniczny" (Tech department).
It has an administrative privileges. So, I'm installing RabbitMQ under that 
user.
Here's the problem:
I'm unable to start the RabbitMQ service, when the path to the user's 
profile contains non-ascii characters.
Is there any way to avoid editing Registry (I can change startup paths in 
Args key) or installing RabbitMQ as different user in the future?

RabbitMQ version: 3.0.1
Erlang version: R15B03-1

Best Regards,
adaml
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/8e4da56b/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: erl_crash.dump
Type: application/octet-stream
Size: 437060 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/8e4da56b/attachment.obj>

From watson.timothy at gmail.com  Thu Nov  7 11:47:52 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Thu, 7 Nov 2013 11:47:52 +0000
Subject: [rabbitmq-discuss] Outage with 3-node RabbitMQ 3.1.3 Cluster
In-Reply-To: <CAOHkZxPLAJqBZcYuV9cOFigiKk=9C5e1zEuZd5bP5j_jm0WSXA@mail.gmail.com>
References: <CAOHkZxOYjFQOB2xW0E921SJiag3oh0m6+R9qbu=gWxwa+YTXLg@mail.gmail.com>
	<D7A91190-9DC6-4740-9658-DD39723FCF7C@rabbitmq.com>
	<CAOHkZxPLAJqBZcYuV9cOFigiKk=9C5e1zEuZd5bP5j_jm0WSXA@mail.gmail.com>
Message-ID: <144763A1-EDC3-4185-BCE1-01B67E0BB14F@rabbitmq.com>

Hi Matt,

On 6 Nov 2013, at 16:02, Matt Wise wrote:
> "Note that the cluster configuration is applied only to fresh nodes. A fresh nodes is a node which has just been reset or is being start for the first time. Thus, the automatic clustering won't take place after restarts of nodes. This means that any change to the clustering via rabbitmqctl will take precedence over the automatic clustering configuration."
> 
> 
> So far we've taken the approach that clustering configuration should be hard-coded into the rabbitmq.config files. This works well in explicitly defining all of the hosts in a cluster on every machine, but it also means that adding a 4th node to a 3-node cluster will cause the 3 running live nodes to do a full service restart, which is bad.

That's not strictly necessary - you can add nodes to a cluster without 

> Our rabbitmq.config though is identical on all of the machines (other than the server-list, which may have been in-flux when Puppet was restarting these services)
> 
> [
>         {rabbit, [
>                 {log_levels, [{connection, warning}]},
>                 {cluster_partition_handling,pause_minority},
>                 {tcp_listeners, [ 5672 ] },
>                 {ssl_listeners, [ 5673 ] },
>                 {ssl_options, [{cacertfile,"/etc/rabbitmq/ssl/cacert.pem"},
>                         {certfile,"/etc/rabbitmq/ssl/cert.pem"},
>                         {keyfile,"/etc/rabbitmq/ssl/key.pem"},
>                         {verify,verify_peer},
>                         {fail_if_no_peer_cert,true}
>                 ]},
>                 {cluster_nodes,['rabbit at i-23cf477b', 'rabbit at i-07d8bc5f', 'rabbit at i-a3291cf8']}
>         ]}
> ].
>  
> > Questions:
> >   1. We only had ~2500 messages in the queues (they are HA'd and durable). The policy is { 'ha-mode': 'all' }. When serverA and serverB restarted, why did they never come up? Unfortunately in the restart process, they blew away their log files as well which makes this really tough to troubleshoot.
> 
> It's nigh on impossible to guess what might've gone wrong without any log files to verify against. We could sit and stare at all the relevant code for weeks and not spot a bug that's been triggered here, since if it were obvious we would've fixed it already.
> 
> If you can give us a very precise set of steps (and timings) that led to this situation, I can try and replicate what you've seen, but I don't fancy my chances to be honest.
> 
> Its a tough one for us to reproduce.. but I think the closest steps would be:
> 
>   1. Create a 3-node cluster... configured with similar config to the one I pasted above.
>   2. Create enough publishers and subscribers that you have a few hundred messages/sec going through the three machines.
>   3. On MachineA and MachineC, remove MachineB from the config file.
>   4. Restart MachineA's rabbitmq daemon using init script
>   5. Wait 3 minutes... theoretically #4 is still in process.. now issue the same restart to MachineC.
> 
>   Fail.
> 

We will take a look at that.

> Thats our best guess right now.. but agreed, the logs are a problem. Can we configure RabbitMQ to log through syslog for the future?
> 

Yes, by replacing the standard OTP logging mechanism with lager, and open source logging framework from Basho Technologies. I have developed a simple plugin (see https://github.com/hyperthunk/rabbitmq-lager) that does this for you. See the README for that repository for further details, and README at https://github.com/basho/lager for information on routing to syslog. You can get a binary of the plugin, compiled against R14B03 from https://raw.github.com/hyperthunk/rabbitmq-lager/binary-dist/lager-2.0.0.ez, though you'll need to compile from source if you're running a newer erlang than that. 

> 
> >
> >   2. I know that restarting serverA and serverB at nearly the same time is obviously a bad idea -- we'll be implementing some changes so this doesn't happen again -- but could this have lead to data corruption?
> 
> It's possible, though obviously that shouldn't really happen. How close were the restarts to one another? How many HA queues were mirrored across these nodes, and were they all very busy (as your previous comment about load seems to suggest)? We could try replicating that scenario in our tests, though it's not easy to get the timing right and obviously the existence of network infrastructure on which the nodes are running won't be the same (and that can make a surprisingly big difference IME).
> 
> The restarts were within a few minutes of each other. There are 5 queues, and all 5 queues are set to mirror to 'all' nodes in the cluster. They were busy, but no more than maybe 100 messages/sec coming in/out. 
>  

I'll take that into account when trying to reproduce - thanks.

> 
> > Once the entire RabbitMQ farm was shut down, we actually were forced to move the rabbitmq data directory out of the way and start up the farm completely with blank databases. It seemed that RabbitMQ 3.1.3 really did not want to recover from this failure. Any thoughts?
> >
> >   3. Lastly .. in the event of future failures, what tools are there for recovering our Mnesia databases? Is there any way we can dump out the data into some raw form, and then import it back into a new fresh cluster?
> >
> 
> I'm afraid there are not, at least not "off the shelf" ones anyway. If you are desperate to recover important production data however, I'm sure we could explore the possibility of trying to help with that somehow. Let me know and I'll make some enquiries at this end.
> 
> At this point we can move on from the data loss... but it does make for an interesting issue. Having tools to analyze the Mnesia DB and get "most of" the messages out in some format where they could be re-injected into a fresh cluster would be an incredibly useful tool. I wonder how hard it is to do?

The messages are not stored in mnesia - we have a "proprietary" on-disk message store. There is a tool that can be used to interact with an offline message store, but it's bit-rotted now and was never fully supported anyway. If a customer does encounter message loss in production, we can offer commercial support to try and resolve the issue, though obviously we're trying very hard to ensure this never happens.

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/af51c695/attachment.htm>

From mklishin at gopivotal.com  Thu Nov  7 11:53:22 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 7 Nov 2013 15:53:22 +0400
Subject: [rabbitmq-discuss] Failed to start RabbitMq and crash OS
	booting (debian)
In-Reply-To: <b2f4eb62-e117-4826-8d1d-280cf5f15955@googlegroups.com>
References: <b2f4eb62-e117-4826-8d1d-280cf5f15955@googlegroups.com>
Message-ID: <2FC85BFB-E616-44C1-B71F-5892A2481B14@rabbitmq.com>

On 7 Nov 2013, at 14:23, l_ulrich2002 at yahoo.fr wrote:

> I added on top of the srcipt after variable declaration a test if dir exists and if not I create it.
> With this patch, RabbitMQ don't failed anymore.
> 
> I guess this test could be added for everyone.

Sounds reasonable. Can you please post the diff or the updated
script?

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Thu Nov  7 11:53:53 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Nov 2013 11:53:53 +0000
Subject: [rabbitmq-discuss] Rabbitmq server at 100% CPU after sleep mode
In-Reply-To: <9071B92E-5929-4ED6-AC41-8A48F95C1187@gmail.com>
References: <9071B92E-5929-4ED6-AC41-8A48F95C1187@gmail.com>
Message-ID: <527B7F51.3070405@rabbitmq.com>

Hi.

I'm afraid there's not a great deal we can do about this - as far as I 
am aware it's Mnesia which is using 100% CPU on resume, and it's not 
possible for us to fix that (basically it has internal timers which fire 
every so often and when it comes back all the missed timer events fire).

Cheers, Simon

On 06/11/13 18:53, Jan Wedel wrote:
> Hi,
>
> I?m not sure if this has been discussed already or even solved, but here?s the problem:
>
> I?m running rabbit 3.2 built with brew on OSX 10.9.
>
> Everytime I return from sleep mode or hibernate, the beam.smp process is running at 100% CPU. Sometimes it returns back to normal, sometimes I have to kill the process (probably because I?m impatient).
>
> If I try to run rabbitmqctl, also this process hangs:
>
> $ rabbitmqctl report
> Reporting server status on {{2013,11,6},{18,26,21}}
>
>   ...
> Status of node rabbit at localhost ...
> ^C
> BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
>         (v)ersion (k)ill (D)b-tables (d)istribution
> a
>
> $ rabbitmqctl status
> Status of node rabbit at localhost ...
> ^C
> BREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded
>         (v)ersion (k)ill (D)b-tables (d)istribution
> a
>
> Any ideas how to solve the problem? Can I provide any information? The log files doesn?t have any entries today although the problem just occurred.
>
> Thanks,
>
> Jan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From Petr.Gotthard at Honeywell.com  Thu Nov  7 13:59:27 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Thu, 7 Nov 2013 13:59:27 +0000
Subject: [rabbitmq-discuss] badmatch in rabbit_channel? (RabbitMQ 3.2.0)
Message-ID: <F9E85480F62349458DF67CE8BA000D8D34D453F3@FR44EX3005.global.ds.honeywell.com>

Hello,

I'm not sure if this is a bug, but I encountered a badmatch in RabbitMQ 3.2.0 when removing bindings shortly before closing connection (during application shutdown).

2013-11-07 14:14:16.583 [debug] <0.674.0> Supervisor {<0.674.0>,rabbit_channel_sup} started rabbit_channel:start_link(1, <0.669.0>, <0.675.0>, <0.669.0>, <<"192.168.80.1:17459 -> 192.168.80.128:5672">>, rabbit_framing_amqp_0_9_1, {user,<<"guest">>,[administrator],rabbit_auth_backend_internal,{internal_user,<<"guest">>,<<38,...>>,...}}, <<"/">>, [{<<"publisher_confirms">>,bool,true},{<<"consumer_cancel_notify">>,bool,true},{<<"basic.nack">>,...},...], <0.670.0>, <0.676.0>) at pid <0.677.0>

2013-11-07 14:14:21.798 [error] <0.677.0> CRASH REPORT Process <0.677.0> with 0 neighbours exited with reason: {error,{{badmatch,{error,[{root,none}],["turbulence"]}},[{rabbit_exchange_type_topic,follow_down_get_path,2,[]},{rabbit_exchange_type_topic,'-remove_bindings/3-lc$^1/1-1-',1,[]},{rabbit_exchange_type_topic,remove_bindings,3,[]},{rabbit_binding,x_callback,4,[]},{rabbit_binding,'-process_deletions/1-fun-0-',2,[]},{dict,map_bucket,2,[{file,"dict.erl"},{line,459}]},{dict,map_bkt_list,2,[{file,"dict.erl"},{line,455}]},{dict,map_bkt_list,2,[{file,"dict.erl"},{line,455}]}]}} in rabbit_misc:execute_mnesia_transaction/1 in gen_server2:terminate/3


If this is not desirable I can provide you with more details and/or help hunting the problem.


Petr

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/35105d5f/attachment.htm>

From aadaml84 at gmail.com  Thu Nov  7 13:03:13 2013
From: aadaml84 at gmail.com (adaml)
Date: Thu, 7 Nov 2013 05:03:13 -0800 (PST)
Subject: [rabbitmq-discuss] Non-ascii characters in user's profile path.
	OS: Windows 7.
In-Reply-To: <df913021-c354-4605-8411-8e1cdfc08384@googlegroups.com>
References: <df913021-c354-4605-8411-8e1cdfc08384@googlegroups.com>
Message-ID: <3be14c09-5f1b-4f71-af6c-1965b4cd6027@googlegroups.com>

In addition, the issue also occurs with the newest versions of RabbitMQ and 
Erlang (3.2.0 and R16B02 64bit respectively).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/e45e93a9/attachment.htm>

From simon at rabbitmq.com  Thu Nov  7 15:36:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Nov 2013 15:36:31 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.2.1 released
Message-ID: <527BB37F.5010704@rabbitmq.com>

The RabbitMQ team is pleased to announce the release of RabbitMQ 3.2.1

This release fixes a number of bugs in 3.2.1 and earlier versions. See 
the release notes at:

http://www.rabbitmq.com/release-notes/README-3.2.1.txt

for more information.

The new release can be downloaded from:

http://www.rabbitmq.com/download.html

As always, we welcome any questions, bug reports, and other feedback on
this release, as well as general suggestions for features and
enhancements in future releases. Mail us via the RabbitMQ discussion
list.

Regards,
                      The RabbitMQ Team
                      (http://www.rabbitmq.com)

From matt at nextdoor.com  Thu Nov  7 16:20:29 2013
From: matt at nextdoor.com (Matt Wise)
Date: Thu, 7 Nov 2013 08:20:29 -0800
Subject: [rabbitmq-discuss] RabbitMQ behind Amazon ELBs..
Message-ID: <CAOHkZxM23MWSS7X4ki7RpV+x87NTG0JxTp-a7+bKTLz8pn9Kig@mail.gmail.com>

The last time I looked into this, we had a hard time getting a valid
heartbeat to work that would keep our clients sending *some* packet back
and forth at least every 60 seconds (Amazon ELB timeout). I'm wondering
though, is anyone now using ELBs to load balance their RabbitMQ system?

(Obviously using TCP-level load balancing, and using SSL...)

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/c7c521f2/attachment.htm>

From simon at rabbitmq.com  Thu Nov  7 16:58:54 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 07 Nov 2013 16:58:54 +0000
Subject: [rabbitmq-discuss] badmatch in rabbit_channel? (RabbitMQ 3.2.0)
In-Reply-To: <F9E85480F62349458DF67CE8BA000D8D34D453F3@FR44EX3005.global.ds.honeywell.com>
References: <F9E85480F62349458DF67CE8BA000D8D34D453F3@FR44EX3005.global.ds.honeywell.com>
Message-ID: <527BC6CE.7020001@rabbitmq.com>

Huh. That's puzzling. The broker maintains some extra tables for 
bindings to topic exchanges which turned out not to contain any records 
for the binding when it was deleted.

So I'd like to get to the bottom of this. It's weird though because that 
code was written for RabbitMQ 2.4.0 and hasn't changed in a long time, 
and everybody who uses topic exchanges uses it - so I would not expect 
to be finding bugs now.

So are you able to replicate this? Could anything be messing with these 
tables?

Cheers, Simon

On 07/11/13 13:59, Gotthard, Petr wrote:
> Hello,
>
> I?m not sure if this is a bug, but I encountered a badmatch in RabbitMQ
> 3.2.0 when removing bindings shortly before closing connection (during
> application shutdown).
>
> 2013-11-07 14:14:16.583 [debug] <0.674.0> Supervisor
> {<0.674.0>,rabbit_channel_sup} started rabbit_channel:start_link(1,
> <0.669.0>, <0.675.0>, <0.669.0>, <<"192.168.80.1:17459 ->
> 192.168.80.128:5672">>, rabbit_framing_amqp_0_9_1,
> {user,<<"guest">>,[administrator],rabbit_auth_backend_internal,{internal_user,<<"guest">>,<<38,...>>,...}},
> <<"/">>,
> [{<<"publisher_confirms">>,bool,true},{<<"consumer_cancel_notify">>,bool,true},{<<"basic.nack">>,...},...],
> <0.670.0>, <0.676.0>) at pid <0.677.0>
>
> 2013-11-07 14:14:21.798 [error] <0.677.0> CRASH REPORT Process <0.677.0>
> with 0 neighbours exited with reason:
> {error,{{badmatch,{error,[{root,none}],["turbulence"]}},[{rabbit_exchange_type_topic,follow_down_get_path,2,[]},{rabbit_exchange_type_topic,'-remove_bindings/3-lc$^1/1-1-',1,[]},{rabbit_exchange_type_topic,remove_bindings,3,[]},{rabbit_binding,x_callback,4,[]},{rabbit_binding,'-process_deletions/1-fun-0-',2,[]},{dict,map_bucket,2,[{file,"dict.erl"},{line,459}]},{dict,map_bkt_list,2,[{file,"dict.erl"},{line,455}]},{dict,map_bkt_list,2,[{file,"dict.erl"},{line,455}]}]}}
> in rabbit_misc:execute_mnesia_transaction/1 in gen_server2:terminate/3
>
> If this is not desirable I can provide you with more details and/or help
> hunting the problem.
>
> Petr
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From mklishin at gopivotal.com  Thu Nov  7 17:34:26 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 7 Nov 2013 21:34:26 +0400
Subject: [rabbitmq-discuss] RabbitMQ behind Amazon ELBs..
In-Reply-To: <CAOHkZxM23MWSS7X4ki7RpV+x87NTG0JxTp-a7+bKTLz8pn9Kig@mail.gmail.com>
References: <CAOHkZxM23MWSS7X4ki7RpV+x87NTG0JxTp-a7+bKTLz8pn9Kig@mail.gmail.com>
Message-ID: <92AEF0E0-1C3F-4ABB-AF29-786F04CF5A61@rabbitmq.com>

On 7 Nov 2013, at 20:20, Matt Wise <matt at nextdoor.com> wrote:

> The last time I looked into this, we had a hard time getting a valid heartbeat to work that would keep our clients sending *some* packet back and forth at least every 60 seconds (Amazon ELB timeout).

Can you elaborate?

Setting heartbeat timeout to 100 would result in a heartbeat frame sent in both
directions roughly every 50 seconds with Java, .NET, Ruby and a few other clients.

What client do you use?

MK

Software Engineer, Pivotal/RabbitMQ



From dustink.ml at gmail.com  Thu Nov  7 17:47:40 2013
From: dustink.ml at gmail.com (Dustin)
Date: Thu, 7 Nov 2013 09:47:40 -0800
Subject: [rabbitmq-discuss] Design for global data ingestion
Message-ID: <CAArnGpa835TLd=tsXNEUqVDqdeiatV4+GFH-A9PVJP=KcujLXQ@mail.gmail.com>

Hello All!

I wanted to shoot this out to see if anyone has had any experience with
using RabbitMQ for a mass global data ingestion pipeline.  A small
disclaimer, I'm a total RMQ noob :)

We currently have a fan-in design, where we have a single downstream 2 node
HA cluster in the same data center as our data warehouse.  We have around
22 upstreams (also 2 node HA clusters) located in datacenters all over the
world.  The configuration is extremely simple.  We have a single direct
exchange, which everything publishes to. Each application uses a specified
routing key for that application.  We end up with queue per application
(currently around 10).  We are running 3.0.0 on the downstream cluster
(been waiting for a maintenance window to upgrade) and 3.1.5 on the
upstreams.

This design has held up well, and we are averaging around 20k/sec messages
a day.

We have ran into 2 problems which won't allow us to scale any further.  The
first is the max bandwidth for a single TCP connection across the globe
(specifically between the US and China).  The second is we have maxed out
the CPU for the federation clients on the downstream (SSL is enabled, I'm
not sure how much CPU overhead that adds).

For the CPU issue, I figured the newly added federated queues would be a
perfect solution to the problem.  I can setup additional Rabbits on the
downstream side, setup the federation links, and have everything load
balance nicely.  The only thing it doesn't address is the max bandwidth for
a single TCP connection.  Because of our initial design, we would run into
max bandwidth problems for each queue.

Our current objective is to be able to send 20k/sec messages from each
datacenter for a single application.  In China, the most we can do is
around 2.5k/sec (ends up being around 1.6MB/sec, this is on a good day).
Because this message load will be from a single application, with the
current design, it will be tied to a single routing key.  So for China, I
would need around 8 TCP connections to do this.

For this use case, message order doesn't matter.  Does anyone have any
ideas on how I can setup multiple federation links that will be load
balanced?  Here are some ideas I have, but they all feel hacky.

1) On the upstreams, use a consistent hash exchange, with exchange to
exchange bindings to 8 direct exchanges, which would be federated.
2) Run multiple instances of RMQ on the downstream machines, and use
federated queues.  Total number of instances across all machines should be
greater than 8.

My apologies in advance if I'm missing something obvious.  Please let me
know if I'm trying to fit a round peg in a square hole.  :)

Thanks!

-Dustin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/b6985951/attachment.htm>

From matt at nextdoor.com  Thu Nov  7 17:51:09 2013
From: matt at nextdoor.com (Matt Wise)
Date: Thu, 7 Nov 2013 09:51:09 -0800
Subject: [rabbitmq-discuss] RabbitMQ behind Amazon ELBs..
In-Reply-To: <92AEF0E0-1C3F-4ABB-AF29-786F04CF5A61@rabbitmq.com>
References: <CAOHkZxM23MWSS7X4ki7RpV+x87NTG0JxTp-a7+bKTLz8pn9Kig@mail.gmail.com>
	<92AEF0E0-1C3F-4ABB-AF29-786F04CF5A61@rabbitmq.com>
Message-ID: <CAOHkZxMJDM-FoJuP9NEDNx6itiA1pPaAYpL948ZpSv=tbzcBLQ@mail.gmail.com>

We're using Celery, which leverages Kombu, which then leverages one of a
number of Python-based brokers. Since we require SSL for our AMQP
connections, we're using:

https://pypi.python.org/pypi/amqp

Initially when we tried this (18 months ago), we ran into problems with the
ELB disconnecting our clients after their 60-second timeout. Now we may
have enough traffic that this doesn't even matter now ... but I'm curious
whether the heartbeats will solve this issue entirely now or not.

--Matt

Matt Wise
Sr. Systems Architect
Nextdoor.com


On Thu, Nov 7, 2013 at 9:34 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 7 Nov 2013, at 20:20, Matt Wise <matt at nextdoor.com> wrote:
>
> > The last time I looked into this, we had a hard time getting a valid
> heartbeat to work that would keep our clients sending *some* packet back
> and forth at least every 60 seconds (Amazon ELB timeout).
>
> Can you elaborate?
>
> Setting heartbeat timeout to 100 would result in a heartbeat frame sent in
> both
> directions roughly every 50 seconds with Java, .NET, Ruby and a few other
> clients.
>
> What client do you use?
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/25efd09f/attachment.htm>

From mahi.rabbitmq at gmail.com  Thu Nov  7 18:48:43 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Thu, 7 Nov 2013 10:48:43 -0800
Subject: [rabbitmq-discuss] webmachine error
Message-ID: <CAGOpLV7Ao9A52q0Nk5_cO-T02Xtisvd=53b90B0A2mpJUvrZdg@mail.gmail.com>

 After reaching UDP packet to RabbitMQ server when I did get message in
queue.

Got response code 500 with body
Internal Server ErrorThe server encountered an error while processing this
request:

{error,{exit,{ucs,{bad_utf8_character_code}},
             [{xmerl_ucs,from_utf8,1,[{file,"xmerl_ucs.erl"},{line,185}]},
              {mochijson2,json_encode_string,2,[]},
              {mochijson2,'-json_encode_proplist/2-fun-0-',3,[]},
              {lists,foldl,3,[{file,"lists.erl"},{line,1197}]},
              {mochijson2,json_encode_proplist,2,[]},
              {mochijson2,'-json_encode_array/2-fun-0-',3,[]},
              {lists,foldl,3,[{file,"lists.erl"},{line,1197}]},
              {mochijson2,json_encode_array,2,[]}]}}



Error message in log file


webmachine error: path="/api/queues/%2F/netqs.netflow.queue/get"
{error,{exit,{ucs,{bad_utf8_character_code}},
             [{xmerl_ucs,from_utf8,1,[{file,"xmerl_ucs.erl"},{line,185}]},
              {mochijson2,json_encode_string,2,[]},
              {mochijson2,'-json_encode_proplist/2-fun-0-',3,[]},
              {lists,foldl,3,[{file,"lists.erl"},{line,1197}]},
              {mochijson2,json_encode_proplist,2,[]},
              {mochijson2,'-json_encode_array/2-fun-0-',3,[]},
              {lists,foldl,3,[{file,"lists.erl"},{line,1197}]},
              {mochijson2,json_encode_array,2,[]}]}}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/de424abf/attachment.htm>

From brett.r.cameron at gmail.com  Thu Nov  7 19:51:22 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Fri, 8 Nov 2013 08:51:22 +1300
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <DC6DA8DCAAB74F2AB4F7919071029942@Lijo>
References: <18E046514176481DA57C1C28941A7F26@Lijo>
	<1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com>
	<045A0B3933804AB3BEB68B3144D99FF9@Lijo>
	<CAMcAHLW5m8hR8MCxRV8oOZwiraadV0gLsk164SHFhuFo6D+09w@mail.gmail.com>
	<DC6DA8DCAAB74F2AB4F7919071029942@Lijo>
Message-ID: <CALPqkiorRwpC32Urdh_XPs049=r7RtvGdyYEqAB+vG8FAZWUzA@mail.gmail.com>

Lijo,

Possibly RabbitHub (https://github.com/brc859844/rabbithub has been tested
up to RabbitMQ 3.1.5) might do part of what you want?

Brett



On Thu, Nov 7, 2013 at 10:56 PM, Lijo Sebastian
<lijo at citrusinformatics.com>wrote:

>   Videla,
>
>                  Our requirement is like that. For security purposes, we
> do all incoming requests like this. nginx will redirect to the specified
> api or a webpage or anything.
>                 What we need here is a messaging protocol that supports
> Publish/Subscribe mechanism, that connects to server through nginx proxy
> pass.
>                 ave tried mqtt, xmpp etc. but they does not supports this
> http bridging.H
>                 Please let me know if this is possible with RabbitMQ, or
> any other MQ protocols.
>
> Regards,
> Lijo Sebastian
> Senior Software Engineer
> Citrus Informatics (India) Pvt Ltd.
>
>  *From:* Alvaro Videla <videlalvaro at gmail.com>
> *Sent:* Thursday, November 07, 2013 2:21 PM
> *To:* Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> *Subject:* Re: [rabbitmq-discuss] amqp over http bridge with c#
>
>  Lijo,
>
> Why do you need to have nginx in front of your RabbitMQ server?
>
> Why do you need to publish messages over HTTP?
>
> Also, may I ask. Have you read and followed the tutorials offered on the
> website? http://www.rabbitmq.com/getstarted.html
>
> The tutorials will give you a good understanding of what RabbitMQ and AMQP
> can do.
>
> Regards,
>
> Alvaro
>
>
>
> On Thu, Nov 7, 2013 at 9:41 AM, Lijo Sebastian <lijo at citrusinformatics.com
> > wrote:
>
>>
>> You saying i cannot have a nginx server in between a client machine and
>> server?
>>
>>
>>
>> Regards,
>> Lijo Sebastian
>> Senior Software Engineer
>> Citrus Informatics (India) Pvt Ltd.
>> -----Original Message----- From: Michael Klishin
>> Sent: Thursday, November 07, 2013 1:59 PM
>> To: Discussions about RabbitMQ
>> Subject: Re: [rabbitmq-discuss] amqp over http bridge with c#
>>
>>
>> On 7 Nov 2013, at 08:41, Lijo Sebastian <lijo at citrusinformatics.com>
>> wrote:
>>
>> i have a scenario where my c# application should send/receive messages
>>> from server.
>>>        But an nginx server will proxy pass the connection with default
>>> port 80 in between.
>>>
>>
>> Answered in
>> http://markmail.org/thread/uam7kyj7bnfx6jyr
>>
>> You cannot use Nginx to proxy HTTP traffic to port 5672
>> because HTTP and AMQP 0-9-1 are very different protocols.
>>
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> ------------------------------
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/f7c6bf7f/attachment.htm>

From videlalvaro at gmail.com  Thu Nov  7 20:21:31 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 7 Nov 2013 21:21:31 +0100
Subject: [rabbitmq-discuss] ANN new release of rabbitmq reverse topic
	exchange
Message-ID: <CAMcAHLURtAN3cyyWCgdKi2MJaaVfW8UqeLpuwjQHuqp2o8zhmA@mail.gmail.com>

Hi,

I've just released a new version of the reverse topic exchange which
includes bug fixes and performance improvements when using '#' in routing
keys.

Also, the plugin now has a couple of binary releases:

https://github.com/videlalvaro/rabbitmq-rtopic-exchange/tree/master/binaries

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/1a2818d0/attachment.htm>

From mklishin at gopivotal.com  Thu Nov  7 21:07:53 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 8 Nov 2013 01:07:53 +0400
Subject: [rabbitmq-discuss] webmachine error
In-Reply-To: <CAGOpLV7Ao9A52q0Nk5_cO-T02Xtisvd=53b90B0A2mpJUvrZdg@mail.gmail.com>
References: <CAGOpLV7Ao9A52q0Nk5_cO-T02Xtisvd=53b90B0A2mpJUvrZdg@mail.gmail.com>
Message-ID: <F9B092F0-993B-4BCE-84DF-6CF65F8ECFE3@rabbitmq.com>

On 7 Nov 2013, at 22:48, mahi e <mahi.rabbitmq at gmail.com> wrote:

>  After reaching UDP packet to RabbitMQ server when I did get message in queue.
> 
> Got response code 500 with body
> 
> Internal Server Error
> 
> The server encountered an error while processing this request:
> {error,{exit,{ucs,{bad_utf8_character_code}},
>              [{xmerl_ucs,from_utf8,1,[{file,"xmerl_ucs.erl"},{line,185}]},
>               {mochijson2,json_encode_string,2,[]},
>               {mochijson2,'-json_encode_proplist/2-fun-0-',3,[]},
>               {lists,foldl,3,[{file,"lists.erl"},{line,1197}]},
>               {mochijson2,json_encode_proplist,2,[]},
>               {mochijson2,'-json_encode_array/2-fun-0-',3,[]},
>               {lists,foldl,3,[{file,"lists.erl"},{line,1197}]},
>               {mochijson2,json_encode_array,2,[]}]}}
> 
> 
> 
> Error message in log file 
> 
> webmachine error: path="/api/queues/%2F/netqs.netflow.queue/get"
> {error,{exit,{ucs,{bad_utf8_character_code}},

Are you sure you mean UDP?

Management UI provides HTTP API which assumes TCP.

MK

Software Engineer, Pivotal/RabbitMQ



From goyalk at vmware.com  Thu Nov  7 21:10:20 2013
From: goyalk at vmware.com (Kapil Goyal)
Date: Thu, 7 Nov 2013 13:10:20 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ crashed
In-Reply-To: <17A3B0E9-7223-4720-A184-8519439B25F8@gopivotal.com>
References: <71739893.000017e4.000000c6@KAPILPC.vmware.com>
	<54DFDE0F-CEA6-4941-9A26-49463198F442@rabbitmq.com>
	<5268E900.5070000@rabbitmq.com>
	<92f2a1f7.000017e4.000000d3@KAPILPC.vmware.com>
	<17A3B0E9-7223-4720-A184-8519439B25F8@gopivotal.com>
Message-ID: <9abe4fe6.000017e4.000000ec@KAPILPC.vmware.com>

Hi Michael,

Is this issue fixed in 3.2.1? I noted this:

25838 prevent crashes due to timeouts when calling into the limiter
      (since 3.1.0)

If not, is there a way to track the progress on the issue or a timeline
you could provide?

Thanks
Kapil

-----Original Message-----
From: Michael Klishin [mailto:mklishin at gopivotal.com] 
Sent: Thursday, October 24, 2013 2:39 PM
To: Kapil Goyal
Cc: Simon MacMullen; Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] RabbitMQ crashed

On 25 Oct 2013, at 01:29, Kapil Goyal <goyalk at vmware.com> wrote:

>> Is this the only error message in the logs?
> There are many errors like this before the crash:
> =ERROR REPORT==== 21-Oct-2013::20:01:09 === webmachine error: 
> path="/api/connections"
> "Unauthorized"

This is a warning from HTTP API. Something tries to access
/api/connections without having permissions to do so. So, it's a red
herring.

> 
>> I don't think it took down the entire node, I expect the queue crashed.

>> Still unacceptable though.
> Error message says "Generic server <0.764.0> terminating". Does this 
> not indicate that node crashed?

Server here means gen_server, an Erlang process behavior (think of it as a
class named *Server, if it helps). It should not bring down the node.

> 
>> Kapil, this will be fixed in the next release.
> This is good news. But, our product is already shipped with RabbitMQ 
> 3.1.5 and upgrade won't be easy. Nonetheless, is this totally a server 
> issue, being hit because of high load, or can we do anything at the 
> client end to avoid it?

This is a server issue. From time to time one process does not respond to
another process in < 5 seconds and the caller crashes without a timeout.
Presumably this is because of short hardware resources.

There is no client-side work around I'm afraid.

MK

Software Engineer, Pivotal/RabbitMQ

From michael.s.klishin at gmail.com  Thu Nov  7 21:14:35 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Nov 2013 01:14:35 +0400
Subject: [rabbitmq-discuss] RabbitMQ crashed
In-Reply-To: <9abe4fe6.000017e4.000000ec@KAPILPC.vmware.com>
References: <71739893.000017e4.000000c6@KAPILPC.vmware.com>
	<54DFDE0F-CEA6-4941-9A26-49463198F442@rabbitmq.com>
	<5268E900.5070000@rabbitmq.com>
	<92f2a1f7.000017e4.000000d3@KAPILPC.vmware.com>
	<17A3B0E9-7223-4720-A184-8519439B25F8@gopivotal.com>
	<9abe4fe6.000017e4.000000ec@KAPILPC.vmware.com>
Message-ID: <CAE3HoVSM-USgR=q9YYm=vASxDd72wa1yESBBqvfu7=8LKsnsDA@mail.gmail.com>

2013/11/8 Kapil Goyal <goyalk at vmware.com>

> Is this issue fixed in 3.2.1? I noted this:
>
> 25838 prevent crashes due to timeouts when calling into the limiter
>       (since 3.1.0)
>

Kapil,

Yes, that's the issue you've seen. Please give 3.2.1 a try.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/2ed23174/attachment.htm>

From frank.shearar at gmail.com  Thu Nov  7 21:38:06 2013
From: frank.shearar at gmail.com (Frank Shearar)
Date: Thu, 7 Nov 2013 21:38:06 +0000
Subject: [rabbitmq-discuss] webmachine error
In-Reply-To: <F9B092F0-993B-4BCE-84DF-6CF65F8ECFE3@rabbitmq.com>
References: <CAGOpLV7Ao9A52q0Nk5_cO-T02Xtisvd=53b90B0A2mpJUvrZdg@mail.gmail.com>
	<F9B092F0-993B-4BCE-84DF-6CF65F8ECFE3@rabbitmq.com>
Message-ID: <CAJbhyRFPTmStfvAWhL8RmzWfqD1-shVHv89Xy4=ZG+VP_6imTA@mail.gmail.com>

On 7 November 2013 21:07, Michael Klishin <mklishin at gopivotal.com> wrote:
> On 7 Nov 2013, at 22:48, mahi e <mahi.rabbitmq at gmail.com> wrote:
>
>>  After reaching UDP packet to RabbitMQ server when I did get message in queue.
>>
>> Got response code 500 with body
>>
>> Internal Server Error
>>
>> The server encountered an error while processing this request:
>> {error,{exit,{ucs,{bad_utf8_character_code}},
>>              [{xmerl_ucs,from_utf8,1,[{file,"xmerl_ucs.erl"},{line,185}]},
>>               {mochijson2,json_encode_string,2,[]},
>>               {mochijson2,'-json_encode_proplist/2-fun-0-',3,[]},
>>               {lists,foldl,3,[{file,"lists.erl"},{line,1197}]},
>>               {mochijson2,json_encode_proplist,2,[]},
>>               {mochijson2,'-json_encode_array/2-fun-0-',3,[]},
>>               {lists,foldl,3,[{file,"lists.erl"},{line,1197}]},
>>               {mochijson2,json_encode_array,2,[]}]}}
>>
>>
>>
>> Error message in log file
>>
>> webmachine error: path="/api/queues/%2F/netqs.netflow.queue/get"
>> {error,{exit,{ucs,{bad_utf8_character_code}},
>
> Are you sure you mean UDP?
>
> Management UI provides HTTP API which assumes TCP.

We already know that the HTTP API breaks for queues with malformed
names (i.e., names that are not UTF-8) -
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-October/031505.html.
This looks like the same bug or similar.

frank

From lijo at citrusinformatics.com  Fri Nov  8 04:35:08 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Fri, 8 Nov 2013 10:05:08 +0530
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <CALPqkiorRwpC32Urdh_XPs049=r7RtvGdyYEqAB+vG8FAZWUzA@mail.gmail.com>
References: <18E046514176481DA57C1C28941A7F26@Lijo><1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com><045A0B3933804AB3BEB68B3144D99FF9@Lijo><CAMcAHLW5m8hR8MCxRV8oOZwiraadV0gLsk164SHFhuFo6D+09w@mail.gmail.com><DC6DA8DCAAB74F2AB4F7919071029942@Lijo>
	<CALPqkiorRwpC32Urdh_XPs049=r7RtvGdyYEqAB+vG8FAZWUzA@mail.gmail.com>
Message-ID: <69F56FA8C56E43D5BA6F75F66069A297@Lijo>

Thanks Cameron, 
                              Seems my cup of tea.. Will check in detail and let you know the status


Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.

From: Brett Cameron 
Sent: Friday, November 08, 2013 1:21 AM
To: Discussions about RabbitMQ 
Subject: Re: [rabbitmq-discuss] amqp over http bridge with c#

Lijo,


Possibly RabbitHub (https://github.com/brc859844/rabbithub has been tested up to RabbitMQ 3.1.5) might do part of what you want?


Brett





On Thu, Nov 7, 2013 at 10:56 PM, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

  Videla,  

                   Our requirement is like that. For security purposes, we do all incoming requests like this. nginx will redirect to the specified api or a webpage or anything.
                  What we need here is a messaging protocol that supports Publish/Subscribe mechanism, that connects to server through nginx proxy pass.
                  ave tried mqtt, xmpp etc. but they does not supports this http bridging.H
                  Please let me know if this is possible with RabbitMQ, or any other MQ protocols.

  Regards, 
  Lijo Sebastian
  Senior Software Engineer
  Citrus Informatics (India) Pvt Ltd.

  From: Alvaro Videla 
  Sent: Thursday, November 07, 2013 2:21 PM
  To: Discussions about RabbitMQ 
  Subject: Re: [rabbitmq-discuss] amqp over http bridge with c#

  Lijo,

  Why do you need to have nginx in front of your RabbitMQ server? 

  Why do you need to publish messages over HTTP?

  Also, may I ask. Have you read and followed the tutorials offered on the website? http://www.rabbitmq.com/getstarted.html

  The tutorials will give you a good understanding of what RabbitMQ and AMQP can do.

  Regards,

  Alvaro




  On Thu, Nov 7, 2013 at 9:41 AM, Lijo Sebastian <lijo at citrusinformatics.com> wrote:


    You saying i cannot have a nginx server in between a client machine and server? 



    Regards,
    Lijo Sebastian
    Senior Software Engineer
    Citrus Informatics (India) Pvt Ltd.

    -----Original Message----- From: Michael Klishin
    Sent: Thursday, November 07, 2013 1:59 PM
    To: Discussions about RabbitMQ
    Subject: Re: [rabbitmq-discuss] amqp over http bridge with c# 


    On 7 Nov 2013, at 08:41, Lijo Sebastian <lijo at citrusinformatics.com> wrote:


      i have a scenario where my c# application should send/receive messages from server.
             But an nginx server will proxy pass the connection with default port 80 in between.


    Answered in
    http://markmail.org/thread/uam7kyj7bnfx6jyr

    You cannot use Nginx to proxy HTTP traffic to port 5672
    because HTTP and AMQP 0-9-1 are very different protocols.

    MK

    Software Engineer, Pivotal/RabbitMQ


    _______________________________________________
    rabbitmq-discuss mailing list
    rabbitmq-discuss at lists.rabbitmq.com
    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
    _______________________________________________
    rabbitmq-discuss mailing list
    rabbitmq-discuss at lists.rabbitmq.com
    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



------------------------------------------------------------------------------
  _______________________________________________
  rabbitmq-discuss mailing list
  rabbitmq-discuss at lists.rabbitmq.com
  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


  _______________________________________________
  rabbitmq-discuss mailing list
  rabbitmq-discuss at lists.rabbitmq.com
  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss





--------------------------------------------------------------------------------
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/7a02f425/attachment.htm>

From sekhar434145 at gmail.com  Fri Nov  8 05:36:01 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Fri, 8 Nov 2013 11:06:01 +0530
Subject: [rabbitmq-discuss] How to configure reply queue?
Message-ID: <CAH75Yb4usdX2RBM2pGRrmH8WNKF0Ov8p=+NfQeyC6BNRTJniGQ@mail.gmail.com>

Hi Team,

We are trying to make asynchronous call in RabbitMQ using Spring AMQP,
could any one please tell me how to configure *replyqueue, correlationId,
(properties) *using spring amqp?

 String corrId = java.util.UUID.randomUUID().toString();
 BasicProperties props = new BasicProperties
                                .Builder()
                                .correlationId(corrId)
                                .replyTo(replyQueueName)
                                .build();

 channel.basicPublish("", requestQueueName, props, message.getBytes());


Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/18f5b5ad/attachment.htm>

From kgk at dataverse.gr  Fri Nov  8 08:12:06 2013
From: kgk at dataverse.gr (Kostas)
Date: Fri, 8 Nov 2013 10:12:06 +0200
Subject: [rabbitmq-discuss] Portability
Message-ID: <000001cedc5a$3859f530$a90ddf90$@dataverse.gr>

Hi there!

 

I would like to know how easy is to use RabitMQ without installation
packages (as portable DLLs & files let's say).

I see that it also requires Erlang, which doesn't look so portable to me. L

Has anyone used this software in a portable manner successfully?

 

Thanks

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/c547e4c3/attachment.htm>

From videlalvaro at gmail.com  Fri Nov  8 08:12:29 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 8 Nov 2013 09:12:29 +0100
Subject: [rabbitmq-discuss] Portability
In-Reply-To: <000001cedc5a$3859f530$a90ddf90$@dataverse.gr>
References: <000001cedc5a$3859f530$a90ddf90$@dataverse.gr>
Message-ID: <CAMcAHLXEh24xee_FOqr1-FG=8+vQO6LS=8f+c9sD5YQYWyW-7g@mail.gmail.com>

Hi,

I don't know what you need to actually do, but Erlang support generating
releases that don't require having Erlang installed.

That's how the standalone release for mac works:
http://www.rabbitmq.com/install-standalone-mac.html

Regards,

Alvaro


On Fri, Nov 8, 2013 at 9:12 AM, Kostas <kgk at dataverse.gr> wrote:

> Hi there!
>
>
>
> I would like to know how easy is to use RabitMQ without installation
> packages (as portable DLLs & files let?s say).
>
> I see that it also requires Erlang, which doesn?t look so portable to me?
> L
>
> Has anyone used this software in a portable manner successfully?
>
>
>
> Thanks
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/48eeee30/attachment.htm>

From simon at rabbitmq.com  Fri Nov  8 08:27:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Nov 2013 08:27:13 +0000
Subject: [rabbitmq-discuss] webmachine error
In-Reply-To: <CAJbhyRFPTmStfvAWhL8RmzWfqD1-shVHv89Xy4=ZG+VP_6imTA@mail.gmail.com>
References: <CAGOpLV7Ao9A52q0Nk5_cO-T02Xtisvd=53b90B0A2mpJUvrZdg@mail.gmail.com>
	<F9B092F0-993B-4BCE-84DF-6CF65F8ECFE3@rabbitmq.com>
	<CAJbhyRFPTmStfvAWhL8RmzWfqD1-shVHv89Xy4=ZG+VP_6imTA@mail.gmail.com>
Message-ID: <527CA061.3040500@rabbitmq.com>

On 07/11/2013 9:38PM, Frank Shearar wrote:
> We already know that the HTTP API breaks for queues with malformed
> names (i.e., names that are not UTF-8) -
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-October/031505.html.
> This looks like the same bug or similar.

Yeah, looks like it.

The AMQP (and STOMP and MQTT) specs all say that names should be encoded 
in UTF-8 (and usually don't provide a way to specify an alternate 
encoding, so it's not obvious what an invalid UTF-8 byte sequence could 
be taken to mean).

Unfortunately the broker does not enforce this. A future version 
probably will.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Nov  8 08:34:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Nov 2013 08:34:08 +0000
Subject: [rabbitmq-discuss] Non-ascii characters in user's profile path.
 OS: Windows 7.
In-Reply-To: <df913021-c354-4605-8411-8e1cdfc08384@googlegroups.com>
References: <df913021-c354-4605-8411-8e1cdfc08384@googlegroups.com>
Message-ID: <527CA200.80601@rabbitmq.com>

 From what I recall when I last looked at this, it was more of an Erlang 
issue.

Erlang pretty much assumes that UTF-8 is the one true encoding. On Unix 
that's a fairly reasonable assumption. Unfortunately Windows still tends 
to use country-specific encodings for things like paths. I'm not sure 
there's a very good solution to this, certainly not from the RabbitMQ 
side; either Windows needs to start using UTF-8 everywhere (which I 
*think* is happening) or Erlang needs to start supporting lots of other 
encodings (which I doubt will every happen).

Cheers, Simon

On 07/11/2013 10:49AM, adaml wrote:
> Hi,
>
> Please consider user named "Dzia? techniczny" (Tech department).
> It has an administrative privileges. So, I'm installing RabbitMQ under
> that user.
> Here's the problem:
> I'm unable to start the RabbitMQ service, when the path to the user's
> profile contains non-ascii characters.
> Is there any way to avoid editing Registry (I can change startup paths
> in Args key) or installing RabbitMQ as different user in the future?
>
> RabbitMQ version: 3.0.1
> Erlang version: R15B03-1
>
> Best Regards,
> adaml
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From lijo at citrusinformatics.com  Fri Nov  8 09:09:43 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Fri, 8 Nov 2013 14:39:43 +0530
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <CALPqkiorRwpC32Urdh_XPs049=r7RtvGdyYEqAB+vG8FAZWUzA@mail.gmail.com>
References: <18E046514176481DA57C1C28941A7F26@Lijo><1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com><045A0B3933804AB3BEB68B3144D99FF9@Lijo><CAMcAHLW5m8hR8MCxRV8oOZwiraadV0gLsk164SHFhuFo6D+09w@mail.gmail.com><DC6DA8DCAAB74F2AB4F7919071029942@Lijo>
	<CALPqkiorRwpC32Urdh_XPs049=r7RtvGdyYEqAB+vG8FAZWUzA@mail.gmail.com>
Message-ID: <E34198E48C054BCCA3459B984D7162F4@Lijo>

Cameron, 
                    I tried with your option RabbitHub, and encountered with some issues.

System Specifications:
Erlang Version : RB16B02 (5.10.3)
RabbitMQ Server Version : 3.2.0

I downloaded rabbithub from github, added in Plugins folder, tried to enable but 
"The specified component was not found: rabbitmq_mochiweb" error occured.

I searched my plugins folder, found mochiweb-2.7.0-rmq3.2.0-git680dba8.ez. But, enabling that does not solved my issue.

Hence i searched for rabbitmq_mochiweb and found it from here. (https://github.com/simoneb/Roger/blob/master/RabbitMQServer/plugins/rabbitmq_mochiweb-2.7.1.ez)

Also from your posts in other sites, i took the latest released rabbithub-3.1.5 (https://region-a.geo-1.objects.hpcloudsvc.com/v1/66395568832599/RabbitHub/rabbithub-3.1.5.ez).

Everything works fine. I was able to enable these plugins.

but when i tried to create a queue using the followng curl command, 
$ curl -v -X PUT http://guest:guest at localhost:55670/endpoint/q/foo ,
I got the following error.


* timeout on name lookup is not supported
* About to connect() to localhost port 55670 (#0)
*   Trying 127.0.0.1...
* Connection refused
* couldn't connect to host
* Closing connection #0
curl: (7) couldn't connect to host

When i checked my server, it was stopped. I restarted and did the same. Same issue happens. 
RabbitMQ Server is getting crashed with these steps. 

What am i wrong here?
Could you please provide some information regarding this issue?


Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.

From: Brett Cameron 
Sent: Friday, November 08, 2013 1:21 AM
To: Discussions about RabbitMQ 
Subject: Re: [rabbitmq-discuss] amqp over http bridge with c#

Lijo,


Possibly RabbitHub (https://github.com/brc859844/rabbithub has been tested up to RabbitMQ 3.1.5) might do part of what you want?


Brett





On Thu, Nov 7, 2013 at 10:56 PM, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

  Videla,  

                   Our requirement is like that. For security purposes, we do all incoming requests like this. nginx will redirect to the specified api or a webpage or anything.
                  What we need here is a messaging protocol that supports Publish/Subscribe mechanism, that connects to server through nginx proxy pass.
                  ave tried mqtt, xmpp etc. but they does not supports this http bridging.H
                  Please let me know if this is possible with RabbitMQ, or any other MQ protocols.

  Regards, 
  Lijo Sebastian
  Senior Software Engineer
  Citrus Informatics (India) Pvt Ltd.

  From: Alvaro Videla 
  Sent: Thursday, November 07, 2013 2:21 PM
  To: Discussions about RabbitMQ 
  Subject: Re: [rabbitmq-discuss] amqp over http bridge with c#

  Lijo,

  Why do you need to have nginx in front of your RabbitMQ server? 

  Why do you need to publish messages over HTTP?

  Also, may I ask. Have you read and followed the tutorials offered on the website? http://www.rabbitmq.com/getstarted.html

  The tutorials will give you a good understanding of what RabbitMQ and AMQP can do.

  Regards,

  Alvaro




  On Thu, Nov 7, 2013 at 9:41 AM, Lijo Sebastian <lijo at citrusinformatics.com> wrote:


    You saying i cannot have a nginx server in between a client machine and server? 



    Regards,
    Lijo Sebastian
    Senior Software Engineer
    Citrus Informatics (India) Pvt Ltd.

    -----Original Message----- From: Michael Klishin
    Sent: Thursday, November 07, 2013 1:59 PM
    To: Discussions about RabbitMQ
    Subject: Re: [rabbitmq-discuss] amqp over http bridge with c# 


    On 7 Nov 2013, at 08:41, Lijo Sebastian <lijo at citrusinformatics.com> wrote:


      i have a scenario where my c# application should send/receive messages from server.
             But an nginx server will proxy pass the connection with default port 80 in between.


    Answered in
    http://markmail.org/thread/uam7kyj7bnfx6jyr

    You cannot use Nginx to proxy HTTP traffic to port 5672
    because HTTP and AMQP 0-9-1 are very different protocols.

    MK

    Software Engineer, Pivotal/RabbitMQ


    _______________________________________________
    rabbitmq-discuss mailing list
    rabbitmq-discuss at lists.rabbitmq.com
    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
    _______________________________________________
    rabbitmq-discuss mailing list
    rabbitmq-discuss at lists.rabbitmq.com
    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



------------------------------------------------------------------------------
  _______________________________________________
  rabbitmq-discuss mailing list
  rabbitmq-discuss at lists.rabbitmq.com
  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


  _______________________________________________
  rabbitmq-discuss mailing list
  rabbitmq-discuss at lists.rabbitmq.com
  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss





--------------------------------------------------------------------------------
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/7c1c3673/attachment.htm>

From brett.r.cameron at gmail.com  Fri Nov  8 09:53:46 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Fri, 8 Nov 2013 22:53:46 +1300
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <E34198E48C054BCCA3459B984D7162F4@Lijo>
References: <18E046514176481DA57C1C28941A7F26@Lijo>
	<1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com>
	<045A0B3933804AB3BEB68B3144D99FF9@Lijo>
	<CAMcAHLW5m8hR8MCxRV8oOZwiraadV0gLsk164SHFhuFo6D+09w@mail.gmail.com>
	<DC6DA8DCAAB74F2AB4F7919071029942@Lijo>
	<CALPqkiorRwpC32Urdh_XPs049=r7RtvGdyYEqAB+vG8FAZWUzA@mail.gmail.com>
	<E34198E48C054BCCA3459B984D7162F4@Lijo>
Message-ID: <CALPqkirP3NVAqB1cH0+d9Dku7RrPxTcGMmqK=CW1HcmCViY+_w@mail.gmail.com>

Lijo,

I suspect that the binary you downloaded was not the most up to date, and
there have been some additional refinements (fixes) that are probably
relevant. I have just uploaded a fresh build of rabbithub-3.1.5.ez  to the
same location (same link) which - based on a couple of quick tests -
appears to work with RabbitMQ 3.2.0/3.2.1. I'll give it a more thorough
test tomorrow and maybe see about creating a 3.2.0/3.2.1 release, but you
might like to give this new build a spin and see what happens... and if you
encounter errors, please post relevant sections of the RabbitMQ log file(s).

Brett


On Fri, Nov 8, 2013 at 10:09 PM, Lijo Sebastian
<lijo at citrusinformatics.com>wrote:

>   Cameron,
>                     I tried with your option RabbitHub, and encountered
> with some issues.
>
> System Specifications:
> Erlang Version : RB16B02 (5.10.3)
> RabbitMQ Server Version : 3.2.0
>
> I downloaded rabbithub from github, added in Plugins folder, tried to
> enable but
> *"The specified component was not found: rabbitmq_mochiweb"* error
> occured.
>
> I searched my plugins folder, found
> *mochiweb-2.7.0-rmq3.2.0-git680dba8.ez.* But, enabling that does not
> solved my issue.
>
> Hence i searched for rabbitmq_mochiweb and found it from here. (
> https://github.com/simoneb/Roger/blob/master/RabbitMQServer/plugins/rabbitmq_mochiweb-2.7.1.ez
> )
>
> Also from your posts in other sites, i took the latest released
> rabbithub-3.1.5 (
> https://region-a.geo-1.objects.hpcloudsvc.com/v1/66395568832599/RabbitHub/rabbithub-3.1.5.ez
> ).
>
> Everything works fine. I was able to enable these plugins.
>
> but when i tried to create a queue using the followng curl command,
> $ curl -v -X PUT http://guest:guest at localhost:55670/endpoint/q/foo ,
> I got the following error.
>
> * timeout on name lookup is not supported
> * About to connect() to localhost port 55670 (#0)
> *   Trying 127.0.0.1...
> * Connection refused
> * couldn't connect to host
> * Closing connection #0
> curl: (7) couldn't connect to host
>
> When i checked my server, it was stopped. I restarted and did the same.
> Same issue happens.
> RabbitMQ Server is getting crashed with these steps.
>
> What am i wrong here?
> Could you please provide some information regarding this issue?
>
>
> Regards,
> Lijo Sebastian
> Senior Software Engineer
> Citrus Informatics (India) Pvt Ltd.
>
>  *From:* Brett Cameron <brett.r.cameron at gmail.com>
> *Sent:* Friday, November 08, 2013 1:21 AM
> *To:* Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> *Subject:* Re: [rabbitmq-discuss] amqp over http bridge with c#
>
>   Lijo,
>
> Possibly RabbitHub (https://github.com/brc859844/rabbithub has been
> tested up to RabbitMQ 3.1.5) might do part of what you want?
>
> Brett
>
>
>
> On Thu, Nov 7, 2013 at 10:56 PM, Lijo Sebastian <
> lijo at citrusinformatics.com> wrote:
>
>>   Videla,
>>
>>                  Our requirement is like that. For security purposes, we
>> do all incoming requests like this. nginx will redirect to the specified
>> api or a webpage or anything.
>>                 What we need here is a messaging protocol that supports
>> Publish/Subscribe mechanism, that connects to server through nginx proxy
>> pass.
>>                 ave tried mqtt, xmpp etc. but they does not supports this
>> http bridging.H
>>                 Please let me know if this is possible with RabbitMQ, or
>> any other MQ protocols.
>>
>> Regards,
>> Lijo Sebastian
>> Senior Software Engineer
>> Citrus Informatics (India) Pvt Ltd.
>>
>>  *From:* Alvaro Videla <videlalvaro at gmail.com>
>> *Sent:* Thursday, November 07, 2013 2:21 PM
>> *To:* Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
>> *Subject:* Re: [rabbitmq-discuss] amqp over http bridge with c#
>>
>>  Lijo,
>>
>> Why do you need to have nginx in front of your RabbitMQ server?
>>
>> Why do you need to publish messages over HTTP?
>>
>> Also, may I ask. Have you read and followed the tutorials offered on the
>> website? http://www.rabbitmq.com/getstarted.html
>>
>> The tutorials will give you a good understanding of what RabbitMQ and
>> AMQP can do.
>>
>> Regards,
>>
>> Alvaro
>>
>>
>>
>> On Thu, Nov 7, 2013 at 9:41 AM, Lijo Sebastian <
>> lijo at citrusinformatics.com> wrote:
>>
>>>
>>> You saying i cannot have a nginx server in between a client machine and
>>> server?
>>>
>>>
>>>
>>> Regards,
>>> Lijo Sebastian
>>> Senior Software Engineer
>>> Citrus Informatics (India) Pvt Ltd.
>>> -----Original Message----- From: Michael Klishin
>>> Sent: Thursday, November 07, 2013 1:59 PM
>>> To: Discussions about RabbitMQ
>>> Subject: Re: [rabbitmq-discuss] amqp over http bridge with c#
>>>
>>>
>>> On 7 Nov 2013, at 08:41, Lijo Sebastian <lijo at citrusinformatics.com>
>>> wrote:
>>>
>>> i have a scenario where my c# application should send/receive messages
>>>> from server.
>>>>        But an nginx server will proxy pass the connection with default
>>>> port 80 in between.
>>>>
>>>
>>> Answered in
>>> http://markmail.org/thread/uam7kyj7bnfx6jyr
>>>
>>> You cannot use Nginx to proxy HTTP traffic to port 5672
>>> because HTTP and AMQP 0-9-1 are very different protocols.
>>>
>>> MK
>>>
>>> Software Engineer, Pivotal/RabbitMQ
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>> ------------------------------
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> ------------------------------
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/20a644fe/attachment.htm>

From ceri at lshift.net  Fri Nov  8 10:55:54 2013
From: ceri at lshift.net (Ceri Storey)
Date: Fri, 08 Nov 2013 10:55:54 +0000
Subject: [rabbitmq-discuss] webmachine error
In-Reply-To: <527CA061.3040500@rabbitmq.com>
References: <CAGOpLV7Ao9A52q0Nk5_cO-T02Xtisvd=53b90B0A2mpJUvrZdg@mail.gmail.com>	<F9B092F0-993B-4BCE-84DF-6CF65F8ECFE3@rabbitmq.com>	<CAJbhyRFPTmStfvAWhL8RmzWfqD1-shVHv89Xy4=ZG+VP_6imTA@mail.gmail.com>
	<527CA061.3040500@rabbitmq.com>
Message-ID: <527CC33A.8090105@lshift.net>

(08/11/13 08:27), Simon MacMullen wrote:
> On 07/11/2013 9:38PM, Frank Shearar wrote:
>> We already know that the HTTP API breaks for queues with malformed
>> names (i.e., names that are not UTF-8) -
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2013-October/031505.html.
>>
>> This looks like the same bug or similar.
>
> Yeah, looks like it.
>
> The AMQP (and STOMP and MQTT) specs all say that names should be
> encoded in UTF-8 (and usually don't provide a way to specify an
> alternate encoding, so it's not obvious what an invalid UTF-8 byte
> sequence could be taken to mean).
>
> Unfortunately the broker does not enforce this. A future version
> probably will.
If we submit a patch for this, could we it get folded into a minor
release in the 3.2.x series? For example, a partial workaround would be
to percent-encode non-utf-8 queue names (and percents) before passing
them to the JSON machinary. I'd guess you'd be wary of changing the name
validation in a minor release, though.
>
> Cheers, Simon
>


From simon at rabbitmq.com  Fri Nov  8 11:26:21 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Nov 2013 11:26:21 +0000
Subject: [rabbitmq-discuss] webmachine error
In-Reply-To: <527CC33A.8090105@lshift.net>
References: <CAGOpLV7Ao9A52q0Nk5_cO-T02Xtisvd=53b90B0A2mpJUvrZdg@mail.gmail.com>	<F9B092F0-993B-4BCE-84DF-6CF65F8ECFE3@rabbitmq.com>	<CAJbhyRFPTmStfvAWhL8RmzWfqD1-shVHv89Xy4=ZG+VP_6imTA@mail.gmail.com>
	<527CA061.3040500@rabbitmq.com> <527CC33A.8090105@lshift.net>
Message-ID: <527CCA5D.2000103@rabbitmq.com>

On 08/11/2013 10:55AM, Ceri Storey wrote:
> (08/11/13 08:27), Simon MacMullen wrote:
>> The AMQP (and STOMP and MQTT) specs all say that names should be
>> encoded in UTF-8 (and usually don't provide a way to specify an
>> alternate encoding, so it's not obvious what an invalid UTF-8 byte
>> sequence could be taken to mean).
>>
>> Unfortunately the broker does not enforce this. A future version
>> probably will.
> If we submit a patch for this, could we it get folded into a minor
> release in the 3.2.x series? For example, a partial workaround would be
> to percent-encode non-utf-8 queue names (and percents) before passing
> them to the JSON machinary. I'd guess you'd be wary of changing the name
> validation in a minor release, though.

So there are two ways to fix this. Ultimately I think we want to do both:

1) Prevent AMQP (and STOMP and...) clients from sending badly-formed 
strings.

2) Deal with such strings in mgmt if they are already there.

We need this belt-and-braces approach since there are quite a lot of 
ways badly-formed strings could get into the broker (indeed the OP was 
using the UDP exchange).

We currently have a work in progress for 1) (which would not get 
released until 3.3.0 since it could break weird clients). I was planning 
on working on 2) at some point and releasing it in a bugfix release.

But if you want to contribute 2) instead that would help it happen 
faster. I'm not convinced that percent-encoding is the right thing to do 
though; certainly I don't think it lets you get round-trip access to 
things with badly formed names. If you plan on un-encoding strings as 
they come in to let that happen then all clients need to know this is 
how we work, otherwise they could send a string which is malformed from 
the POV of percent-encoding. Suddenly we don't speak normal JSON / URLs 
any more (and URL bits get percent encoded twice!)

If it only goes one way then that's more workable - but you still have 
the double-percent-encoding thing, which is not very loveable. How do 
you distinguish "myqueue%80%80" which is the result of a badly-formed 
name from "myqueue%80%80" which just happens to be called that?

I would just swap in U+FFFD REPLACEMENT CHARACTER instead.

Also bear in mind that this doesn't just happen with object names, 
basic.properties, arguments and so on can all contain badly-formed strings.

Apologies if any of the above is grandmother-sucking-eggs territory.

Cheers, Simon

From lijo at citrusinformatics.com  Fri Nov  8 11:38:47 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Fri, 8 Nov 2013 17:08:47 +0530
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <CALPqkirP3NVAqB1cH0+d9Dku7RrPxTcGMmqK=CW1HcmCViY+_w@mail.gmail.com>
References: <18E046514176481DA57C1C28941A7F26@Lijo><1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com><045A0B3933804AB3BEB68B3144D99FF9@Lijo><CAMcAHLW5m8hR8MCxRV8oOZwiraadV0gLsk164SHFhuFo6D+09w@mail.gmail.com><DC6DA8DCAAB74F2AB4F7919071029942@Lijo><CALPqkiorRwpC32Urdh_XPs049=r7RtvGdyYEqAB+vG8FAZWUzA@mail.gmail.com><E34198E48C054BCCA3459B984D7162F4@Lijo>
	<CALPqkirP3NVAqB1cH0+d9Dku7RrPxTcGMmqK=CW1HcmCViY+_w@mail.gmail.com>
Message-ID: <B628891E180442B4BA586F9EA42CFDCC@Lijo>

Cameron, 
                  Thanks for your effort. 
I replaced rabbithub from the location you mentioned. 
Now, while enabling rabbithub, no issue raised. it enabled mochiweb plugin along with it.

But after that, when i tried to restart the rabbitmq-server to apply changes, it Failed to start. throws error.

attached is the complete log files archive as per request. 



Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.

From: Brett Cameron 
Sent: Friday, November 08, 2013 3:23 PM
To: Lijo Sebastian 
Cc: Discussions about RabbitMQ 
Subject: Re: [rabbitmq-discuss] amqp over http bridge with c#

Lijo,


I suspect that the binary you downloaded was not the most up to date, and there have been some additional refinements (fixes) that are probably relevant. I have just uploaded a fresh build of rabbithub-3.1.5.ez  to the same location (same link) which - based on a couple of quick tests - appears to work with RabbitMQ 3.2.0/3.2.1. I'll give it a more thorough test tomorrow and maybe see about creating a 3.2.0/3.2.1 release, but you might like to give this new build a spin and see what happens... and if you encounter errors, please post relevant sections of the RabbitMQ log file(s).


Brett



On Fri, Nov 8, 2013 at 10:09 PM, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

  Cameron, 
                      I tried with your option RabbitHub, and encountered with some issues.

  System Specifications:
  Erlang Version : RB16B02 (5.10.3)
  RabbitMQ Server Version : 3.2.0

  I downloaded rabbithub from github, added in Plugins folder, tried to enable but 
  "The specified component was not found: rabbitmq_mochiweb" error occured.

  I searched my plugins folder, found mochiweb-2.7.0-rmq3.2.0-git680dba8.ez. But, enabling that does not solved my issue.

  Hence i searched for rabbitmq_mochiweb and found it from here. (https://github.com/simoneb/Roger/blob/master/RabbitMQServer/plugins/rabbitmq_mochiweb-2.7.1.ez)

  Also from your posts in other sites, i took the latest released rabbithub-3.1.5 (https://region-a.geo-1.objects.hpcloudsvc.com/v1/66395568832599/RabbitHub/rabbithub-3.1.5.ez).

  Everything works fine. I was able to enable these plugins.

  but when i tried to create a queue using the followng curl command, 
  $ curl -v -X PUT http://guest:guest at localhost:55670/endpoint/q/foo ,
  I got the following error.


  * timeout on name lookup is not supported
  * About to connect() to localhost port 55670 (#0)
  *   Trying 127.0.0.1...
  * Connection refused
  * couldn't connect to host
  * Closing connection #0
  curl: (7) couldn't connect to host

  When i checked my server, it was stopped. I restarted and did the same. Same issue happens. 
  RabbitMQ Server is getting crashed with these steps. 

  What am i wrong here?
  Could you please provide some information regarding this issue?


  Regards, 
  Lijo Sebastian
  Senior Software Engineer
  Citrus Informatics (India) Pvt Ltd.

  From: Brett Cameron 
  Sent: Friday, November 08, 2013 1:21 AM
  To: Discussions about RabbitMQ 
  Subject: Re: [rabbitmq-discuss] amqp over http bridge with c#

  Lijo,


  Possibly RabbitHub (https://github.com/brc859844/rabbithub has been tested up to RabbitMQ 3.1.5) might do part of what you want?


  Brett





  On Thu, Nov 7, 2013 at 10:56 PM, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

    Videla,  

                     Our requirement is like that. For security purposes, we do all incoming requests like this. nginx will redirect to the specified api or a webpage or anything.
                    What we need here is a messaging protocol that supports Publish/Subscribe mechanism, that connects to server through nginx proxy pass.
                    ave tried mqtt, xmpp etc. but they does not supports this http bridging.H
                    Please let me know if this is possible with RabbitMQ, or any other MQ protocols.

    Regards, 
    Lijo Sebastian
    Senior Software Engineer
    Citrus Informatics (India) Pvt Ltd.

    From: Alvaro Videla 
    Sent: Thursday, November 07, 2013 2:21 PM
    To: Discussions about RabbitMQ 
    Subject: Re: [rabbitmq-discuss] amqp over http bridge with c#

    Lijo,

    Why do you need to have nginx in front of your RabbitMQ server? 

    Why do you need to publish messages over HTTP?

    Also, may I ask. Have you read and followed the tutorials offered on the website? http://www.rabbitmq.com/getstarted.html

    The tutorials will give you a good understanding of what RabbitMQ and AMQP can do.

    Regards,

    Alvaro




    On Thu, Nov 7, 2013 at 9:41 AM, Lijo Sebastian <lijo at citrusinformatics.com> wrote:


      You saying i cannot have a nginx server in between a client machine and server? 



      Regards,
      Lijo Sebastian
      Senior Software Engineer
      Citrus Informatics (India) Pvt Ltd.

      -----Original Message----- From: Michael Klishin
      Sent: Thursday, November 07, 2013 1:59 PM
      To: Discussions about RabbitMQ
      Subject: Re: [rabbitmq-discuss] amqp over http bridge with c# 


      On 7 Nov 2013, at 08:41, Lijo Sebastian <lijo at citrusinformatics.com> wrote:


        i have a scenario where my c# application should send/receive messages from server.
               But an nginx server will proxy pass the connection with default port 80 in between.


      Answered in
      http://markmail.org/thread/uam7kyj7bnfx6jyr

      You cannot use Nginx to proxy HTTP traffic to port 5672
      because HTTP and AMQP 0-9-1 are very different protocols.

      MK

      Software Engineer, Pivotal/RabbitMQ


      _______________________________________________
      rabbitmq-discuss mailing list
      rabbitmq-discuss at lists.rabbitmq.com
      https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
      _______________________________________________
      rabbitmq-discuss mailing list
      rabbitmq-discuss at lists.rabbitmq.com
      https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



----------------------------------------------------------------------------
    _______________________________________________
    rabbitmq-discuss mailing list
    rabbitmq-discuss at lists.rabbitmq.com
    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


    _______________________________________________
    rabbitmq-discuss mailing list
    rabbitmq-discuss at lists.rabbitmq.com
    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




------------------------------------------------------------------------------
  _______________________________________________
  rabbitmq-discuss mailing list
  rabbitmq-discuss at lists.rabbitmq.com
  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/a9969e11/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: RabbitMQlogs.zip
Type: application/octet-stream
Size: 2506 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/a9969e11/attachment.obj>

From ceri at lshift.net  Fri Nov  8 11:40:53 2013
From: ceri at lshift.net (Ceri Storey)
Date: Fri, 08 Nov 2013 11:40:53 +0000
Subject: [rabbitmq-discuss] webmachine error
In-Reply-To: <527CCA5D.2000103@rabbitmq.com>
References: <CAGOpLV7Ao9A52q0Nk5_cO-T02Xtisvd=53b90B0A2mpJUvrZdg@mail.gmail.com>	<F9B092F0-993B-4BCE-84DF-6CF65F8ECFE3@rabbitmq.com>	<CAJbhyRFPTmStfvAWhL8RmzWfqD1-shVHv89Xy4=ZG+VP_6imTA@mail.gmail.com>
	<527CA061.3040500@rabbitmq.com> <527CC33A.8090105@lshift.net>
	<527CCA5D.2000103@rabbitmq.com>
Message-ID: <527CCDC5.4090208@lshift.net>

(08/11/13 11:26), Simon MacMullen wrote:
> On 08/11/2013 10:55AM, Ceri Storey wrote:
>> (08/11/13 08:27), Simon MacMullen wrote:
>>> The AMQP (and STOMP and MQTT) specs all say that names should be
>>> encoded in UTF-8 (and usually don't provide a way to specify an
>>> alternate encoding, so it's not obvious what an invalid UTF-8 byte
>>> sequence could be taken to mean).
>>>
>>> Unfortunately the broker does not enforce this. A future version
>>> probably will.
>> If we submit a patch for this, could we it get folded into a minor
>> release in the 3.2.x series? For example, a partial workaround would be
>> to percent-encode non-utf-8 queue names (and percents) before passing
>> them to the JSON machinary. I'd guess you'd be wary of changing the name
>> validation in a minor release, though.
>
> So there are two ways to fix this. Ultimately I think we want to do both:
>
> 1) Prevent AMQP (and STOMP and...) clients from sending badly-formed
> strings.
>
> 2) Deal with such strings in mgmt if they are already there.
>
> We need this belt-and-braces approach since there are quite a lot of
> ways badly-formed strings could get into the broker (indeed the OP was
> using the UDP exchange).
>
> We currently have a work in progress for 1) (which would not get
> released until 3.3.0 since it could break weird clients). I was
> planning on working on 2) at some point and releasing it in a bugfix
> release.
>
> But if you want to contribute 2) instead that would help it happen
> faster. I'm not convinced that percent-encoding is the right thing to
> do though; certainly I don't think it lets you get round-trip access
> to things with badly formed names. If you plan on un-encoding strings
> as they come in to let that happen then all clients need to know this
> is how we work, otherwise they could send a string which is malformed
> from the POV of percent-encoding. Suddenly we don't speak normal JSON
> / URLs any more (and URL bits get percent encoded twice!)
I'd like to imagine that a client would just send back the string from
the JSON with appropriate encoding; but then again, my years of dealing
with the web tells me that is wildly optimistic.
>
> If it only goes one way then that's more workable - but you still have
> the double-percent-encoding thing, which is not very loveable. How do
> you distinguish "myqueue%80%80" which is the result of a badly-formed
> name from "myqueue%80%80" which just happens to be called that?
You'd need to include '%' in the set of things that are escaped, so you
end up with "myqueue%2580%2580", which looks pretty fugly. But you're
right that there's a big risk of breaking things unexpectedly. As for
clients that consume the Management API, I know of Michael Klishin's
Ruby code and of course the management UI javascript, on top of the
approach of using using a plain HTTP client with string interpolation to
construct URLs. Do you know of any others?
>
> I would just swap in U+FFFD REPLACEMENT CHARACTER instead.
>
> Also bear in mind that this doesn't just happen with object names,
> basic.properties, arguments and so on can all contain badly-formed
> strings.
You're right; it's potentially quite a rabbit hole.

> Apologies if any of the above is grandmother-sucking-eggs territory.
I honestly can't imagine that sucking eggs has anywhere as many wierd
corner cases as character encodings on the web :)
>
> Cheers, Simon


From mklishin at gopivotal.com  Fri Nov  8 11:42:32 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 8 Nov 2013 15:42:32 +0400
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <B628891E180442B4BA586F9EA42CFDCC@Lijo>
References: <18E046514176481DA57C1C28941A7F26@Lijo><1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com><045A0B3933804AB3BEB68B3144D99FF9@Lijo><CAMcAHLW5m8hR8MCxRV8oOZwiraadV0gLsk164SHFhuFo6D+09w@mail.gmail.com><DC6DA8DCAAB74F2AB4F7919071029942@Lijo><CALPqkiorRwpC32Urdh_XPs049=r7RtvGdyYEqAB+vG8FAZWUzA@mail.gmail.com><E34198E48C054BCCA3459B984D7162F4@Lijo>
	<CALPqkirP3NVAqB1cH0+d9Dku7RrPxTcGMmqK=CW1HcmCViY+_w@mail.gmail.com>
	<B628891E180442B4BA586F9EA42CFDCC@Lijo>
Message-ID: <BAD180A8-5C68-4626-AF3A-EB339179C133@rabbitmq.com>

On 8 Nov 2013, at 15:38, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

> attached is the complete log files archive as per request.

=ERROR REPORT==== 8-Nov-2013::16:55:03 ===
beam/beam_load.c(1365): Error loading module rabbithub:
  use of opcode 153; this emulator supports only up to 152

Your Erlang runtime is too old for rabbithub, which was compiled for
a more recent version.

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Fri Nov  8 11:51:01 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Nov 2013 11:51:01 +0000
Subject: [rabbitmq-discuss] webmachine error
In-Reply-To: <527CCDC5.4090208@lshift.net>
References: <CAGOpLV7Ao9A52q0Nk5_cO-T02Xtisvd=53b90B0A2mpJUvrZdg@mail.gmail.com>	<F9B092F0-993B-4BCE-84DF-6CF65F8ECFE3@rabbitmq.com>	<CAJbhyRFPTmStfvAWhL8RmzWfqD1-shVHv89Xy4=ZG+VP_6imTA@mail.gmail.com>
	<527CA061.3040500@rabbitmq.com> <527CC33A.8090105@lshift.net>
	<527CCA5D.2000103@rabbitmq.com> <527CCDC5.4090208@lshift.net>
Message-ID: <527CD025.1020900@rabbitmq.com>

On 08/11/2013 11:40AM, Ceri Storey wrote:
> (08/11/13 11:26), Simon MacMullen wrote:
>> If it only goes one way then that's more workable - but you still have
>> the double-percent-encoding thing, which is not very loveable. How do
>> you distinguish "myqueue%80%80" which is the result of a badly-formed
>> name from "myqueue%80%80" which just happens to be called that?
> You'd need to include '%' in the set of things that are escaped, so you
> end up with "myqueue%2580%2580", which looks pretty fugly. But you're
> right that there's a big risk of breaking things unexpectedly. As for
> clients that consume the Management API, I know of Michael Klishin's
> Ruby code and of course the management UI javascript, on top of the
> approach of using using a plain HTTP client with string interpolation to
> construct URLs. Do you know of any others?

You missed rabbitmqadmin :-) EasyNetQ and I think Spring-AMQP both have 
support for it too. There are quite a lot of things like nagios plugins. 
There are probably a ton of little unpublished bash-and-curl scripts out 
there too.

Telling all these people "Oh, hey, we just decided to speak a sui 
generis non-standard version of JSON. And URLs." is... not top of my 
list of things to do.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From grussell at gopivotal.com  Fri Nov  8 13:50:44 2013
From: grussell at gopivotal.com (Gary Russell)
Date: Fri, 8 Nov 2013 08:50:44 -0500
Subject: [rabbitmq-discuss] How to configure reply queue?
In-Reply-To: <CAH75Yb4usdX2RBM2pGRrmH8WNKF0Ov8p=+NfQeyC6BNRTJniGQ@mail.gmail.com>
References: <CAH75Yb4usdX2RBM2pGRrmH8WNKF0Ov8p=+NfQeyC6BNRTJniGQ@mail.gmail.com>
Message-ID: <CADtU9_t+3Hb2UTsXk2a5iP362fOrtXHnBTibHSoXr-rz96ReLQ@mail.gmail.com>

http://docs.spring.io/spring-amqp/reference/html/amqp.html#request-reply

The simplest is to configure the RabbitTemplate to use a fixed reply queue,
with a reply listener, and use one of it's convertSendAndReceive(...) (or
sendAndReceive) methods; the template will take care of the correlation.

If you want to do it asynchronously and do your own correlation (get the
reply asynchronously on another thread) just use one of the send() methods
and wire up a listener container to get the results.



On Fri, Nov 8, 2013 at 12:36 AM, Rajasekhar P <sekhar434145 at gmail.com>wrote:

> Hi Team,
>
> We are trying to make asynchronous call in RabbitMQ using Spring AMQP,
> could any one please tell me how to configure *replyqueue, correlationId,
> (properties) *using spring amqp?
>
>  String corrId = java.util.UUID.randomUUID().toString();
>  BasicProperties props = new BasicProperties
>                                 .Builder()
>                                 .correlationId(corrId)
>                                 .replyTo(replyQueueName)
>                                 .build();
>
>  channel.basicPublish("", requestQueueName, props, message.getBytes());
>
>
> Thanks in advance.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/cd4b42fc/attachment.htm>

From carl.hoerberg at gmail.com  Fri Nov  8 14:42:36 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Fri, 8 Nov 2013 06:42:36 -0800 (PST)
Subject: [rabbitmq-discuss] Can't delete vhost
Message-ID: <1383921756459-31303.post@n5.nabble.com>

On a 3.2.1 cluster (r16b2), deleting a certain vhost gives:

{exit,{noproc,{gen_server2,call,
                          
[<7149.32183.58>,{delete,false,false},infinity]}},
      [{gen_server2,call,3,[]},
       {delegate,safe_invoke,2,[]},
       {delegate,'-safe_invoke/2-lc$^0/1-0-',2,[]},
       {delegate,handle_call,3,[]},
       {gen_server2,handle_msg,2,[]},
       {proc_lib,wake_up,3,[{file,"proc_lib.erl"},{line,249}]}]}



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-vhost-tp31303.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From carl.hoerberg at gmail.com  Fri Nov  8 14:54:46 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Fri, 8 Nov 2013 06:54:46 -0800 (PST)
Subject: [rabbitmq-discuss] Can't delete vhost
In-Reply-To: <1383921756459-31303.post@n5.nabble.com>
References: <1383921756459-31303.post@n5.nabble.com>
Message-ID: <1383922486544-31304.post@n5.nabble.com>

The above error was given if deleting via the http api, deleting with
rabbitmqctl results in: 

$ sudo rabbitmqctl delete_vhost vhost1
Deleting vhost "vhost1" ...

=ERROR REPORT==== 8-Nov-2013::14:36:34 ===
Discarding message
{'$gen_call',{<0.10547.1>,#Ref<0.0.1.239371>},{delete,false,false}} from
<0.10547.1> to <0.20300.39> in an old incarnation (1) of this node (2)

Error: {noproc,{gen_server2,call,
                           
[<5057.20300.39>,{delete,false,false},infinity]}}



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-vhost-tp31303p31304.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From rtrlists at googlemail.com  Fri Nov  8 14:54:48 2013
From: rtrlists at googlemail.com (Robert Raschke)
Date: Fri, 8 Nov 2013 14:54:48 +0000
Subject: [rabbitmq-discuss] Question about mirroring vs blocked publishing
Message-ID: <CAH+xwdAOr4W_yvKriWHAVmZjstP+FWhrzhQOA3zRHNt-zPrxTg@mail.gmail.com>

Hi,

before I delve deeper trying to figure out a RMQ node crash I'm seeing, I
thought I'd ask quickly if something like the following is a possibility.
(I don't have the full details of the setup to hand just now, only the gist
of it, apologies.)

I have a three node cluster set up with a queue getting mirrored to all
nodes, the memory highwater mark is set pretty low everywhere (20%). When
publishing reasonably quickly (~1000msgs/s across all three nodes), the
memory limit gets triggered on some nodes and publishers get blocked.

But also, some nodes tend to crash (still trying to find the exact log
message for the crash).

So, my question: Is mirroring impacted directly by publisher blocking? That
is, can mirroring fail, if the node that a message is supposed to get
mirrored to, is blocking?

This is using 3.2.0.

Thanks for any feedback,
Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/92e24abf/attachment.htm>

From mklishin at gopivotal.com  Fri Nov  8 14:58:47 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 8 Nov 2013 18:58:47 +0400
Subject: [rabbitmq-discuss] Question about mirroring vs blocked
	publishing
In-Reply-To: <CAH+xwdAOr4W_yvKriWHAVmZjstP+FWhrzhQOA3zRHNt-zPrxTg@mail.gmail.com>
References: <CAH+xwdAOr4W_yvKriWHAVmZjstP+FWhrzhQOA3zRHNt-zPrxTg@mail.gmail.com>
Message-ID: <EC4EC441-7DA3-4C70-87D5-4B04F840B67B@rabbitmq.com>


On 8 Nov 2013, at 18:54, Robert Raschke <rtrlists at googlemail.com> wrote:

> This is using 3.2.0.

Robert,

You are likely seeing one of the commonly reported bugs fixed in 3.2.1:
http://www.rabbitmq.com/release-notes/README-3.2.1.txt

Please upgrade.

MK

Software Engineer, Pivotal/RabbitMQ



From carl.hoerberg at gmail.com  Fri Nov  8 14:59:19 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Fri, 8 Nov 2013 06:59:19 -0800 (PST)
Subject: [rabbitmq-discuss] Mgmt interface slow with many queues
Message-ID: <1383922759412-31305.post@n5.nabble.com>

Yes, the queues page takes a very long time to load if you have say 10000
queues. But what's worse is that even if a user only has the "management"
role and thus only can see his own queues, the queues-page gets equally slow
for him as for the one with 10000 queues. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Mgmt-interface-slow-with-many-queues-tp31305.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From rtrlists at googlemail.com  Fri Nov  8 15:17:30 2013
From: rtrlists at googlemail.com (Robert Raschke)
Date: Fri, 8 Nov 2013 15:17:30 +0000
Subject: [rabbitmq-discuss] Question about mirroring vs blocked
	publishing
In-Reply-To: <EC4EC441-7DA3-4C70-87D5-4B04F840B67B@rabbitmq.com>
References: <CAH+xwdAOr4W_yvKriWHAVmZjstP+FWhrzhQOA3zRHNt-zPrxTg@mail.gmail.com>
	<EC4EC441-7DA3-4C70-87D5-4B04F840B67B@rabbitmq.com>
Message-ID: <CAH+xwdATqg7e6+r4xy2NohHtFw1vryr2c-nRzyRP7_=ic0+7oQ@mail.gmail.com>

That made me find a relevant error message in the logs, thank you:

=ERROR REPORT==== 4-Nov-2013::15:23:15 ===
** Generic server <0.7692.0> terminating
** Last message in was {'$gen_cast',{gm,{sender_death,<6848.5586.0>}}}
** When Server state == {state,
                         {amqqueue,
                          {resource,<<"/">>,queue,<<"stress_test">>},
...
** Reason for termination ==
** {function_clause,
       [{rabbit_mirror_queue_slave,forget_sender,
*[down_from_gm,down_from_gm]*},
        {rabbit_mirror_queue_slave,maybe_forget_sender,3},
        {rabbit_mirror_queue_slave,process_instruction,2},
        {rabbit_mirror_queue_slave,handle_cast,2},
        {gen_server2,handle_msg,2},
        {proc_lib,wake_up,3}]}


Will try upgrading and report back once that's done.

Thanks again,
Robby


On Fri, Nov 8, 2013 at 2:58 PM, Michael Klishin <mklishin at gopivotal.com>wrote:

>
> On 8 Nov 2013, at 18:54, Robert Raschke <rtrlists at googlemail.com> wrote:
>
> > This is using 3.2.0.
>
> Robert,
>
> You are likely seeing one of the commonly reported bugs fixed in 3.2.1:
> http://www.rabbitmq.com/release-notes/README-3.2.1.txt
>
> Please upgrade.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/4db07fdf/attachment.htm>

From videlalvaro at gmail.com  Fri Nov  8 15:18:16 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 8 Nov 2013 16:18:16 +0100
Subject: [rabbitmq-discuss] Can't delete vhost
In-Reply-To: <1383922486544-31304.post@n5.nabble.com>
References: <1383921756459-31303.post@n5.nabble.com>
	<1383922486544-31304.post@n5.nabble.com>
Message-ID: <CAMcAHLU_5K-bxjr43TA=3PqaFX6O6+xm80XkXoNO0dKFFW-Bgw@mail.gmail.com>

I've just created a 3.2.1 cluster on my local machine, added a vhost and
deleted it successfully.

Did you have any queues on that vhost?

Regards,

Alvaro


On Fri, Nov 8, 2013 at 3:54 PM, carlhoerberg <carl.hoerberg at gmail.com>wrote:

> The above error was given if deleting via the http api, deleting with
> rabbitmqctl results in:
>
> $ sudo rabbitmqctl delete_vhost vhost1
> Deleting vhost "vhost1" ...
>
> =ERROR REPORT==== 8-Nov-2013::14:36:34 ===
> Discarding message
> {'$gen_call',{<0.10547.1>,#Ref<0.0.1.239371>},{delete,false,false}} from
> <0.10547.1> to <0.20300.39> in an old incarnation (1) of this node (2)
>
> Error: {noproc,{gen_server2,call,
>
> [<5057.20300.39>,{delete,false,false},infinity]}}
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-vhost-tp31303p31304.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/5225ae9a/attachment.htm>

From carl.hoerberg at gmail.com  Fri Nov  8 15:23:32 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Fri, 8 Nov 2013 07:23:32 -0800 (PST)
Subject: [rabbitmq-discuss] Can't delete vhost
In-Reply-To: <CAMcAHLU_5K-bxjr43TA=3PqaFX6O6+xm80XkXoNO0dKFFW-Bgw@mail.gmail.com>
References: <1383921756459-31303.post@n5.nabble.com>
	<1383922486544-31304.post@n5.nabble.com>
	<CAMcAHLU_5K-bxjr43TA=3PqaFX6O6+xm80XkXoNO0dKFFW-Bgw@mail.gmail.com>
Message-ID: <5D1E86ADD86746CE8581D39346203E15@gmail.com>

The vhost has about 16000 queues, but no connections. 



On Friday 8 November 2013 at 23:19, Alvaro Videla-2 [via RabbitMQ] wrote:

> I've just created a 3.2.1 cluster on my local machine, added a vhost and deleted it successfully. 
> 
> Did you have any queues on that vhost? 
> 
> Regards,
> 
> Alvaro
> 
> 
> On Fri, Nov 8, 2013 at 3:54 PM, carlhoerberg <[hidden email] (/user/SendEmail.jtp?type=node&node=31309&i=0)> wrote:
> > The above error was given if deleting via the http api, deleting with
> > rabbitmqctl results in:
> > 
> > $ sudo rabbitmqctl delete_vhost vhost1
> > Deleting vhost "vhost1" ...
> > 
> > =ERROR REPORT==== 8-Nov-2013::14:36:34 ===
> > Discarding message
> > {'$gen_call',{<0.10547.1>,#Ref<0.0.1.239371>},{delete,false,false}} from
> > <0.10547.1> to <0.20300.39> in an old incarnation (1) of this node (2)
> > 
> > Error: {noproc,{gen_server2,call,
> > 
> > [<5057.20300.39>,{delete,false,false},infinity]}}
> > 
> > 
> > 
> > --
> > View this message in context: http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-vhost-tp31303p31304.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com (http://Nabble.com).
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > [hidden email] (/user/SendEmail.jtp?type=node&node=31309&i=1)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=31309&i=2) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-vhost-tp31303p31309.html 
> To unsubscribe from Can't delete vhost, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=31303&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MzEzMDN8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-vhost-tp31303p31310.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/de985b16/attachment.htm>

From simon at rabbitmq.com  Fri Nov  8 15:23:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Nov 2013 15:23:31 +0000
Subject: [rabbitmq-discuss] Question about mirroring vs blocked
	publishing
In-Reply-To: <CAH+xwdATqg7e6+r4xy2NohHtFw1vryr2c-nRzyRP7_=ic0+7oQ@mail.gmail.com>
References: <CAH+xwdAOr4W_yvKriWHAVmZjstP+FWhrzhQOA3zRHNt-zPrxTg@mail.gmail.com>
	<EC4EC441-7DA3-4C70-87D5-4B04F840B67B@rabbitmq.com>
	<CAH+xwdATqg7e6+r4xy2NohHtFw1vryr2c-nRzyRP7_=ic0+7oQ@mail.gmail.com>
Message-ID: <527D01F3.4010408@rabbitmq.com>

On 08/11/2013 3:17PM, Robert Raschke wrote:
> [down_from_gm,down_from_gm]

Yep, that's the one. Fixed in 3.2.1.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From kam5fcc at gmail.com  Fri Nov  8 15:42:13 2013
From: kam5fcc at gmail.com (Kevin Meek)
Date: Fri, 8 Nov 2013 07:42:13 -0800 (PST)
Subject: [rabbitmq-discuss] Does Rabbit work with Jersey??
Message-ID: <829d609b-e683-493c-b9a9-35ac2c296151@googlegroups.com>

And is/are there any examples?

Thanks,
Kevin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/5a4bbe6b/attachment.htm>

From videlalvaro at gmail.com  Fri Nov  8 15:45:22 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 8 Nov 2013 16:45:22 +0100
Subject: [rabbitmq-discuss] Does Rabbit work with Jersey??
In-Reply-To: <829d609b-e683-493c-b9a9-35ac2c296151@googlegroups.com>
References: <829d609b-e683-493c-b9a9-35ac2c296151@googlegroups.com>
Message-ID: <CAMcAHLX-8P75rEm_L8BpcQpewJXO=yt7y0D6B_jVkOmnpnc3=w@mail.gmail.com>

What is Jersey?

-Alvaro


On Fri, Nov 8, 2013 at 4:42 PM, Kevin Meek <kam5fcc at gmail.com> wrote:

> And is/are there any examples?
>
> Thanks,
> Kevin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/dc713f17/attachment.htm>

From videlalvaro at gmail.com  Fri Nov  8 15:56:05 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 8 Nov 2013 16:56:05 +0100
Subject: [rabbitmq-discuss] Can't delete vhost
In-Reply-To: <5D1E86ADD86746CE8581D39346203E15@gmail.com>
References: <1383921756459-31303.post@n5.nabble.com>
	<1383922486544-31304.post@n5.nabble.com>
	<CAMcAHLU_5K-bxjr43TA=3PqaFX6O6+xm80XkXoNO0dKFFW-Bgw@mail.gmail.com>
	<5D1E86ADD86746CE8581D39346203E15@gmail.com>
Message-ID: <CAMcAHLVG2wSmBd8LudA-cg_mQ8q7p1UjKUEHzBbC9=VTfPYcow@mail.gmail.com>

I've just created a vhost in a 2 node cluster (albeit local cluster) and
then declared 16k queues. Then I proceeded to delete the vhost, no errors
and the vhost got deleted successfully.

So I don't know what to answer.

Regards,

Alvaro


On Fri, Nov 8, 2013 at 4:23 PM, carlhoerberg <carl.hoerberg at gmail.com>wrote:

> The vhost has about 16000 queues, but no connections.
>
>
>
> On Friday 8 November 2013 at 23:19, Alvaro Videla-2 [via RabbitMQ] wrote:
>
> > I've just created a 3.2.1 cluster on my local machine, added a vhost and
> deleted it successfully.
> >
> > Did you have any queues on that vhost?
> >
> > Regards,
> >
> > Alvaro
> >
> >
> > On Fri, Nov 8, 2013 at 3:54 PM, carlhoerberg <[hidden email]
> (/user/SendEmail.jtp?type=node&node=31309&i=0)> wrote:
> > > The above error was given if deleting via the http api, deleting with
> > > rabbitmqctl results in:
> > >
> > > $ sudo rabbitmqctl delete_vhost vhost1
> > > Deleting vhost "vhost1" ...
> > >
> > > =ERROR REPORT==== 8-Nov-2013::14:36:34 ===
> > > Discarding message
> > > {'$gen_call',{<0.10547.1>,#Ref<0.0.1.239371>},{delete,false,false}}
> from
> > > <0.10547.1> to <0.20300.39> in an old incarnation (1) of this node (2)
> > >
> > > Error: {noproc,{gen_server2,call,
> > >
> > > [<5057.20300.39>,{delete,false,false},infinity]}}
> > >
> > >
> > >
> > > --
> > > View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-vhost-tp31303p31304.html
> > > Sent from the RabbitMQ mailing list archive at Nabble.com (
> http://Nabble.com).
> > > _______________________________________________
> > > rabbitmq-discuss mailing list
> > > [hidden email] (/user/SendEmail.jtp?type=node&node=31309&i=1)
> > > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > [hidden email] (/user/SendEmail.jtp?type=node&node=31309&i=2)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> > If you reply to this email, your message will be added to the discussion
> below:
> http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-vhost-tp31303p31309.html
>
> > To unsubscribe from Can't delete vhost, click here (
> > NAML (
> http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml)
>
>
>
>
>
> ------------------------------
> View this message in context: Re: Can't delete vhost<http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-vhost-tp31303p31310.html>
>
> Sent from the RabbitMQ mailing list archive<http://rabbitmq.1065348.n5.nabble.com/>at Nabble.com.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/b5c240d6/attachment.htm>

From simon at rabbitmq.com  Fri Nov  8 15:59:54 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 08 Nov 2013 15:59:54 +0000
Subject: [rabbitmq-discuss] Can't delete vhost
In-Reply-To: <1383922486544-31304.post@n5.nabble.com>
References: <1383921756459-31303.post@n5.nabble.com>
	<1383922486544-31304.post@n5.nabble.com>
Message-ID: <527D0A7A.60406@rabbitmq.com>

On 08/11/2013 2:54PM, carlhoerberg wrote:
> =ERROR REPORT==== 8-Nov-2013::14:36:34 ===
> Discarding message
> {'$gen_call',{<0.10547.1>,#Ref<0.0.1.239371>},{delete,false,false}} from
> <0.10547.1> to <0.20300.39> in an old incarnation (1) of this node (2)

This is basically telling you that the pid we have in Mnesia for one of 
the queues that is to be deleted is out of date - it pertains to a 
previous boot of the server.

We've only ever seen this as a consequence of something else going 
wrong. Is there previous crash mentioning <0.20300.39> in the logs?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Fri Nov  8 16:32:15 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 8 Nov 2013 20:32:15 +0400
Subject: [rabbitmq-discuss] Does Rabbit work with Jersey??
In-Reply-To: <829d609b-e683-493c-b9a9-35ac2c296151@googlegroups.com>
References: <829d609b-e683-493c-b9a9-35ac2c296151@googlegroups.com>
Message-ID: <CAE3HoVRCuw_W_TtN6+jZPJ0ZsyZwpoB+p=YyS0-zmCjMSQJuDg@mail.gmail.com>

2013/11/8 Kevin Meek <kam5fcc at gmail.com>

> And is/are there any examples?


If you mean Jersey the RESTful services library in Java,
then RabbitMQ client can be used with it like any other Java library.

See http://www.rabbitmq.com/getstarted.html.

Note that it is not necessary to create a new connection for every request.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/e6ac6efd/attachment.htm>

From weojoew at gmail.com  Fri Nov  8 16:39:43 2013
From: weojoew at gmail.com (Joseph Weeks)
Date: Fri, 8 Nov 2013 11:39:43 -0500
Subject: [rabbitmq-discuss] [Feature Request/Patch] Regular expression
	support in management UI filter
Message-ID: <CA+5po3dVCNxLMA8KpeF-zZJVq2fttrNtR939R1Mbj3R=uHE6dA@mail.gmail.com>

Hello,

I tried to find this already answered on the mailing list but did not.

Our production support guys have made heavy use of the filter in the
management UI and I'd like to request that regular expression support be
added.

I took a stab at implementing it (with a checkbox to enable).  If it's
useful as a patch or reference (and not redundant to other efforts), please
feel free to use it.

patch:
https://github.com/joew/rabbitmq-management/commit/e624845a0252c0a5d731475222c66f325a1bc7ff.patch

screenshots:
https://dl.dropboxusercontent.com/s/6kg5satyhmu7y3j/rabbitmq_mgmt_regex_all_queues.png
https://dl.dropboxusercontent.com/s/71yjnr8qhd0icjj/rabbitmq_mgmt_regex_prioritized.png
https://dl.dropboxusercontent.com/sh/rpfkbpwktk30rbv/iPboki7KLF/rabbitmq_mgmt_regex_2_groups.png
https://dl.dropboxusercontent.com/s/1ftg4p1n07fv7y3/rabbitmq_mgmt_regex_all_groups.png

Thanks again for a great product.  We?re looking forward to upgrading to
3.2.x.

Joe
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/8bbd7b00/attachment.htm>

From jcua at eventbrite.com  Fri Nov  8 17:25:26 2013
From: jcua at eventbrite.com (Jonathan Cua)
Date: Fri, 8 Nov 2013 09:25:26 -0800
Subject: [rabbitmq-discuss] Queue Weird State in RMQ 3.2.1
Message-ID: <5329EC68-CB9A-4DE0-B1E0-AAC0BCBDB166@eventbrite.com>

I am using Rabbitmq 3.2.1 on Ubuntu 12.04. I have a 2-node cluster setup.

In the Queues tab, I see this in on one the queue.



But when I click on this queue, I would see this.



Then when I publish a message to this queue, it would get consumed and everything would go back to 0. There is nothing in the logs or sasl.log about this. So, I am wondering what this is. Also, this issue did not exist in RabbitMQ 2.8.7.

I was able to reproduce this issue. It looks like when the queue gets idle (eg. no message is sent/consumed) for exactly 1 hour, it changes from 0 to '?'.

Here is how to reproduce this.

1. Create a queue either through the UI or an ampq client (I used the pika python module).
2. Publish one message to the queue.
3. Wait for 1 hour then you will see the message go from 0 to '?'.
4. If you publish another message to this queue, it will go back to 0 again.


Thanks,
Jonathan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/27427295/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Screen Shot 2013-11-08 at 8.39.17 AM.png
Type: image/png
Size: 9414 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/27427295/attachment.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: weird_queue.jpg
Type: image/jpg
Size: 24503 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/27427295/attachment.jpg>

From pierpaolo at dropbox.com  Fri Nov  8 17:32:48 2013
From: pierpaolo at dropbox.com (Pierpaolo Baccichet)
Date: Fri, 8 Nov 2013 09:32:48 -0800
Subject: [rabbitmq-discuss] Stats node getting slow
Message-ID: <CAKZAfCWqEj2QvXobCA6zFY3tX9_W7jmkj8vFo-32UQqvrHejFg@mail.gmail.com>

Hello there,

I have been having some issues with the stats node recently getting slow in
a clustered environment, stopping to report stats and causing the whole
cluster to get extremely slow.

Our setup: we use rabbitMQ (recently updated to 3.2.0) with 10 nodes in a
cluster in the same DC and 3 disk nodes. We have a fairly high number of
connections in the tens of thousands but fairly low throughput of messages
(single digit thousands per second).

Things have been working great for almost a year but recently we see,
unfortunately quite frequently, the stats node all of a sudden starting
consuming considerable amount of memory munching to death. Last night we
had again one of these events and the stat node consumed more than 10GB of
RAM in a matter of 2 hours until I caught it and restart it, which brought
the cluster back into normal state. We started observing this issue a few
weeks back (not very frequently) while on 3.1.3 and we still see it on
3.2.0. If it helps narrowing down the problem, I don't think I ever saw
this problem with the 3.0.x series so I am considering to go back to those
versions but i would like to get an opinion first
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/9d27a359/attachment.htm>

From brett.r.cameron at gmail.com  Fri Nov  8 18:32:09 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Sat, 9 Nov 2013 07:32:09 +1300
Subject: [rabbitmq-discuss] amqp over http bridge with c#
In-Reply-To: <BAD180A8-5C68-4626-AF3A-EB339179C133@rabbitmq.com>
References: <18E046514176481DA57C1C28941A7F26@Lijo>
	<1BEE45F6-5EC1-48B3-97D9-39822B42BD3A@rabbitmq.com>
	<045A0B3933804AB3BEB68B3144D99FF9@Lijo>
	<CAMcAHLW5m8hR8MCxRV8oOZwiraadV0gLsk164SHFhuFo6D+09w@mail.gmail.com>
	<DC6DA8DCAAB74F2AB4F7919071029942@Lijo>
	<CALPqkiorRwpC32Urdh_XPs049=r7RtvGdyYEqAB+vG8FAZWUzA@mail.gmail.com>
	<E34198E48C054BCCA3459B984D7162F4@Lijo>
	<CALPqkirP3NVAqB1cH0+d9Dku7RrPxTcGMmqK=CW1HcmCViY+_w@mail.gmail.com>
	<B628891E180442B4BA586F9EA42CFDCC@Lijo>
	<BAD180A8-5C68-4626-AF3A-EB339179C133@rabbitmq.com>
Message-ID: <CALPqkiqwj699QCpWvVOSvwftFtqLT+W_Ow28FvfoCJ9WcA3hqQ@mail.gmail.com>

Lijo,

The plugin was compiled with R16B01. You had indicated previously that you
were using 16B02, but looking at the error I'd almost guess R14B(04) or
something of that vintage.

Brett


On Sat, Nov 9, 2013 at 12:42 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 8 Nov 2013, at 15:38, Lijo Sebastian <lijo at citrusinformatics.com>
> wrote:
>
> > attached is the complete log files archive as per request.
>
> =ERROR REPORT==== 8-Nov-2013::16:55:03 ===
> beam/beam_load.c(1365): Error loading module rabbithub:
>   use of opcode 153; this emulator supports only up to 152
>
> Your Erlang runtime is too old for rabbithub, which was compiled for
> a more recent version.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131109/4a1a7083/attachment.htm>

From kam5fcc at gmail.com  Fri Nov  8 20:28:58 2013
From: kam5fcc at gmail.com (Kevin Meek)
Date: Fri, 8 Nov 2013 12:28:58 -0800 (PST)
Subject: [rabbitmq-discuss] Does Rabbit work with Jersey??
In-Reply-To: <CAMcAHLX-8P75rEm_L8BpcQpewJXO=yt7y0D6B_jVkOmnpnc3=w@mail.gmail.com>
References: <829d609b-e683-493c-b9a9-35ac2c296151@googlegroups.com>
	<CAMcAHLX-8P75rEm_L8BpcQpewJXO=yt7y0D6B_jVkOmnpnc3=w@mail.gmail.com>
Message-ID: <ba0b964c-e5b1-4a84-89ec-05fa215275ab@googlegroups.com>

Ooppps.  Sorry

Jersey - Oracle's RESTful Web Service
https://jersey.java.net/

Want to see if Rabbit can help 1 PC connect over the Internet to a Remote 
PC's Rabbit Queue then to a REST Web Service.

THx,
Kevin

On Friday, November 8, 2013 10:45:22 AM UTC-5, Alvaro Videla wrote:
>
> What is Jersey?
>
> -Alvaro
>
>
> On Fri, Nov 8, 2013 at 4:42 PM, Kevin Meek <kam... at gmail.com <javascript:>
> > wrote:
>
>> And is/are there any examples?
>>
>> Thanks,
>> Kevin
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq... at lists.rabbitmq.com <javascript:>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/0e275276/attachment.htm>

From carl.hoerberg at gmail.com  Sat Nov  9 02:59:29 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Fri, 8 Nov 2013 18:59:29 -0800 (PST)
Subject: [rabbitmq-discuss] Can't delete vhost
In-Reply-To: <527D0A7A.60406@rabbitmq.com>
References: <1383921756459-31303.post@n5.nabble.com>
	<1383922486544-31304.post@n5.nabble.com>
	<527D0A7A.60406@rabbitmq.com>
Message-ID: <3589C2B5AB5D457DAB045020F544255B@gmail.com>

Thanks Simon. A full cluster restart solved it..



On Saturday 9 November 2013 at 00:01, Simon MacMullen-2 [via RabbitMQ] wrote:

> On 08/11/2013 2:54PM, carlhoerberg wrote: 
> > =ERROR REPORT==== 8-Nov-2013::14:36:34 === 
> > Discarding message 
> > {'$gen_call',{<0.10547.1>,#Ref<0.0.1.239371>},{delete,false,false}} from 
> > <0.10547.1> to <0.20300.39> in an old incarnation (1) of this node (2) 
> 
> 
> This is basically telling you that the pid we have in Mnesia for one of 
> the queues that is to be deleted is out of date - it pertains to a 
> previous boot of the server. 
> 
> We've only ever seen this as a consequence of something else going 
> wrong. Is there previous crash mentioning <0.20300.39> in the logs? 
> 
> Cheers, Simon 
> 
> -- 
> Simon MacMullen 
> RabbitMQ, Pivotal 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=31315&i=0) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-vhost-tp31303p31315.html 
> To unsubscribe from Can't delete vhost, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=31303&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MzEzMDN8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Can-t-delete-vhost-tp31303p31322.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/3da8f837/attachment.htm>

From blake.copenhaver at gmail.com  Fri Nov  8 16:31:41 2013
From: blake.copenhaver at gmail.com (blake.copenhaver at gmail.com)
Date: Fri, 8 Nov 2013 08:31:41 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Consumer/Producer Proxy Support
Message-ID: <7552ddbc-309f-4c0f-aa73-600a486e287f@googlegroups.com>

Is it possible for the RabbitMQ producer/consumer to establish a connection 
to the broker (RabbitMQ server) from behind an authenticated proxy? I'm 
currently leveraging the AMQP 0-9-1 message protocol. 

Use Case:
Consumer 1 is running on a machine that sits behind a proxy. Consumer 1 
would like to authenticate to the proxy so a socket connection can be 
established with the broker (RabbitMQ server)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131108/751356fa/attachment.htm>

From l_ulrich2002 at yahoo.fr  Thu Nov  7 22:36:25 2013
From: l_ulrich2002 at yahoo.fr (l_ulrich2002 at yahoo.fr)
Date: Thu, 7 Nov 2013 14:36:25 -0800 (PST)
Subject: [rabbitmq-discuss] Failed to start RabbitMq and crash OS
	booting (debian)
In-Reply-To: <b2f4eb62-e117-4826-8d1d-280cf5f15955@googlegroups.com>
References: <b2f4eb62-e117-4826-8d1d-280cf5f15955@googlegroups.com>
Message-ID: <15b00c55-787d-4b84-9b18-928e0202b33b@googlegroups.com>

This is code I added to the script:

if [ ! -d ${INIT_LOG_DIR} ] ; then
        mkdir -p ${INIT_LOG_DIR}
        chown -R ${USER}:${USER} ${INIT_LOG_DIR}
        chmod 755 ${INIT_LOG_DIR}
fi

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131107/37b3b2a6/attachment.htm>

From Petr.Gotthard at Honeywell.com  Sat Nov  9 10:09:03 2013
From: Petr.Gotthard at Honeywell.com (Gotthard, Petr)
Date: Sat, 9 Nov 2013 10:09:03 +0000
Subject: [rabbitmq-discuss] RabbitMQ Consumer/Producer Proxy Support
Message-ID: <F9E85480F62349458DF67CE8BA000D8D34D4601E@FR44EX3005.global.ds.honeywell.com>

Blake,
Which proxy is it? HTTP proxy? SOCKS proxy?

Petr


From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of blake.copenhaver at gmail.com
Sent: 8. listopadu 2013 17:32
To: rabbitmq-discuss at googlegroups.com
Subject: [rabbitmq-discuss] RabbitMQ Consumer/Producer Proxy Support

Is it possible for the RabbitMQ producer/consumer to establish a connection to the broker (RabbitMQ server) from behind an authenticated proxy? I'm currently leveraging the AMQP 0-9-1 message protocol.

Use Case:
Consumer 1 is running on a machine that sits behind a proxy. Consumer 1 would like to authenticate to the proxy so a socket connection can be established with the broker (RabbitMQ server)


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131109/7e6adf65/attachment.htm>

From michael.s.klishin at gmail.com  Sat Nov  9 17:05:36 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 9 Nov 2013 21:05:36 +0400
Subject: [rabbitmq-discuss] ANN Rabbit Hole,
	a RabbitMQ HTTP API client for Go
Message-ID: <CAE3HoVR_tUs1=+aMvZJsFFfcmNeuAEYwYYZyXVecKV=e0GxaTw@mail.gmail.com>

I'm happy to announce Rabbit Hole [1], a RabbitMQ HTTP API [2] client for
Go.

It's about 90% complete (including documentation). TLS support and the last
10%
will be added as time permits. To get started, see

https://github.com/michaelklishin/rabbit-hole/#documentation

The library is BSD licensed and developed entirely on GitHub, so please
file issues
and submit pull requests there.

I'd like to thank Max Riveiro for contributing.

Plase give Rabbit Hole a go ;)


1. http://github.com/michaelklishin/rabbit-hole/
2.
http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_1/priv/www/api/index.html
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131109/ac8d2b5b/attachment.htm>

From carl.hoerberg at gmail.com  Sun Nov 10 07:57:44 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sat, 9 Nov 2013 23:57:44 -0800 (PST)
Subject: [rabbitmq-discuss] durable queue is down or inaccessible
Message-ID: <1384070264658-31329.post@n5.nabble.com>

Hi, 

With mirror all queues, but often when nodes crashes we see:

=ERROR REPORT==== 10-Nov-2013::04:40:14 ===
connection <0.26611.6>, channel 2 - soft error:
{amqp_error,not_found,
            "home node 'rabbit at wombat-48510-01' of durable queue
'images.processed' in vhost 'nwdwgqag' is down or inaccessible",
            'queue.declare'}

in the logs. Why doesn't the queues failover properly? 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/durable-queue-is-down-or-inaccessible-tp31329.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From aryan02130 at gmail.com  Sun Nov 10 15:05:35 2013
From: aryan02130 at gmail.com (Aryan S)
Date: Sun, 10 Nov 2013 20:35:35 +0530
Subject: [rabbitmq-discuss] SASL authentication HTTP (management console /
	REST API)
Message-ID: <CAEfxVOO5GNDfDusgXhSt5pQ9XSKCCLEegK2dRdwnrpZqJdbzwA@mail.gmail.com>

Hi,

I am trying to get the HTTP API (REST calls ) and the management console to
work without prompting for user name and password.

1.) Now first thing I am trying is accessing :-
https://10.31.52.204:15672from my browser ( I have imported the
certificates in the browser.)

I get a prompt to select the certificate and after that it takes me to the
username/password page. Can you help me in understanding what I am missing
? Shouldnt' it authenticate based on the client certificate and take me in
or fail (since I have fail_if_no_peer_cert, true & verify, verify_peer)

2.) Even for the REST API calls , say for example -
https://10.31.52.204:15672/api/users, I still get a prompt for username and
password. How do I prevent this ?

(Basically I am trying the last part in
http://www.rabbitmq.com/mochiweb.html)

The following is my rabbitmq.config file : -

  {rabbit, [
    {heartbeat, 30},
    {auth_mechanisms,     ['EXTERNAL']},
    {ssl_listeners,       [15671]},
    {ssl_cert_login_from, common_name},
    {ssl_options, [{cacertfile,
"/home/test/certificates/cert/testca/cacert.pem"},
                    {certfile,
"/home/test/certificates/cert/server/cert.pem"},
                    {keyfile,
"/home/test/certificates/cert/server/key.pem"},
                    {verify, verify_peer},
                    {fail_if_no_peer_cert, true}]}
           ]
  },
{rabbitmq_management,
  [{listener, [{port, 15672},
               {ssl,  true},
               {ssl_opts, [{cacertfile,
"/home/test/certificates/cert/testca/cacert.pem"},
                           {certfile,
"/home/test/certificates/cert/server/cert.pem"},
                           {keyfile,
 "/home/test/certificates/cert/server/key.pem"},
                           {verify, verify_peer},
                           {fail_if_no_peer_cert, true}]}
              ]}
  ]}
].

Regards,
Aryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131110/3d56fd4d/attachment.htm>

From ranganathan.s at gmail.com  Mon Nov 11 07:23:58 2013
From: ranganathan.s at gmail.com (Ranganathan Srinivasan)
Date: Mon, 11 Nov 2013 12:53:58 +0530
Subject: [rabbitmq-discuss] sasl authentication
Message-ID: <CAEwvUCXQ7Y2nuG2zOWCLemX+ZOR4aBCnH-K6ibYdL=SoTiLkwQ@mail.gmail.com>

Hi,

Does the SASL authentication mechanism work for Management console and the
REST API as well or is it limited only to AMQP ?

Regards,
Rang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/5ef5b950/attachment.htm>

From simon at rabbitmq.com  Mon Nov 11 09:16:49 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Nov 2013 09:16:49 +0000
Subject: [rabbitmq-discuss] sasl authentication
In-Reply-To: <CAEwvUCXQ7Y2nuG2zOWCLemX+ZOR4aBCnH-K6ibYdL=SoTiLkwQ@mail.gmail.com>
References: <CAEwvUCXQ7Y2nuG2zOWCLemX+ZOR4aBCnH-K6ibYdL=SoTiLkwQ@mail.gmail.com>
Message-ID: <5280A081.7090709@rabbitmq.com>

On 11/11/2013 7:23AM, Ranganathan Srinivasan wrote:
> Does the SASL authentication mechanism work for Management console and
> the REST API as well or is it limited only to AMQP ?

I assume you mean SSL certificate based auth. Yes, that's AMQP (and 
STOMP) only, the HTTP API does not support it (yet?)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From ranganathan.s at gmail.com  Mon Nov 11 09:21:44 2013
From: ranganathan.s at gmail.com (Ranganathan Srinivasan)
Date: Mon, 11 Nov 2013 14:51:44 +0530
Subject: [rabbitmq-discuss] sasl authentication
In-Reply-To: <5280A081.7090709@rabbitmq.com>
References: <CAEwvUCXQ7Y2nuG2zOWCLemX+ZOR4aBCnH-K6ibYdL=SoTiLkwQ@mail.gmail.com>
	<5280A081.7090709@rabbitmq.com>
Message-ID: <CAEwvUCWBkzv9Hrh-kjVjbYD=QX+fKK7=GFTRp+Anz9+AYS1dNg@mail.gmail.com>

Thanks Simon for the reply.

Yes, I meant SSL certificate based auth, I was trying to get this working
with the HTTP API but from your response I understand this is not supported.

Regards,
Rang


On Mon, Nov 11, 2013 at 2:46 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 11/11/2013 7:23AM, Ranganathan Srinivasan wrote:
>
>> Does the SASL authentication mechanism work for Management console and
>> the REST API as well or is it limited only to AMQP ?
>>
>
> I assume you mean SSL certificate based auth. Yes, that's AMQP (and STOMP)
> only, the HTTP API does not support it (yet?)
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/86dc6008/attachment.htm>

From emile at rabbitmq.com  Mon Nov 11 09:29:01 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 11 Nov 2013 09:29:01 +0000
Subject: [rabbitmq-discuss] Non-ascii characters in user's profile path.
 OS: Windows 7.
In-Reply-To: <df913021-c354-4605-8411-8e1cdfc08384@googlegroups.com>
References: <df913021-c354-4605-8411-8e1cdfc08384@googlegroups.com>
Message-ID: <5280A35D.8090206@rabbitmq.com>



Hi,

On 07/11/13 10:49, adaml wrote:

> Is there any way to avoid editing Registry (I can change startup paths
> in Args key) or installing RabbitMQ as different user in the future?


It is sometimes possible to around the issue by using the ASCII 8.3
version of the path. You can get this with "dir /x", or see
http://www.rabbitmq.com/windows-quirks.html



-Emile



From simon at rabbitmq.com  Mon Nov 11 09:45:00 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Nov 2013 09:45:00 +0000
Subject: [rabbitmq-discuss] Stats node getting slow
In-Reply-To: <CAKZAfCWqEj2QvXobCA6zFY3tX9_W7jmkj8vFo-32UQqvrHejFg@mail.gmail.com>
References: <CAKZAfCWqEj2QvXobCA6zFY3tX9_W7jmkj8vFo-32UQqvrHejFg@mail.gmail.com>
Message-ID: <5280A71C.5050102@rabbitmq.com>

On 08/11/2013 5:32PM, Pierpaolo Baccichet wrote:
> Things have been working great for almost a year but recently we see,
> unfortunately quite frequently, the stats node all of a sudden starting
> consuming considerable amount of memory munching to death. Last night we
> had again one of these events and the stat node consumed more than 10GB
> of RAM in a matter of 2 hours until I caught it and restart it, which
> brought the cluster back into normal state. We started observing this
> issue a few weeks back (not very frequently) while on 3.1.3 and we still
> see it on 3.2.0. If it helps narrowing down the problem, I don't think I
> ever saw this problem with the 3.0.x series so I am considering to go
> back to those versions but i would like to get an opinion first

Hmm, the stats DB was more or less rewritten between 3.0.x and 3.1.0 (to 
keep stats histories). If there's a memory leak in there I'd very much 
like to get to the bottom of it.

So to get started, would you be able to send me the output of

$ rabbitmqctl eval '[{T, [KV || KV = {K, _} <- I, lists:member(K, [size, 
memory])]} || T <- ets:all(), I <- [ets:info(T)], 
proplists:get_value(name, I) =:= rabbit_mgmt_db].'

along with

$ rabbitmqctl report

when in this state?

In terms of mitigating this problem:

$ rabbitmqctl eval 'exit(global:whereis_name(rabbit_mgmt_db), die).'

will kill / restart the mgmt DB, so you don't need to restart the entire 
stats node.

It might also be worth setting the force_fine_statistics configuration 
item to false for the rabbitmq_management_agent application (would need 
to be done on every node). This will disable calculation / display of 
message rates, which stands a good chance of disabling whatever code is 
causing the problem.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Nov 11 09:52:38 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Nov 2013 09:52:38 +0000
Subject: [rabbitmq-discuss] Stats node getting slow
In-Reply-To: <5280A71C.5050102@rabbitmq.com>
References: <CAKZAfCWqEj2QvXobCA6zFY3tX9_W7jmkj8vFo-32UQqvrHejFg@mail.gmail.com>
	<5280A71C.5050102@rabbitmq.com>
Message-ID: <5280A8E6.6010506@rabbitmq.com>

On 11/11/2013 9:45AM, Simon MacMullen wrote:
> Hmm, the stats DB was more or less rewritten between 3.0.x and 3.1.0 (to
> keep stats histories). If there's a memory leak in there I'd very much
> like to get to the bottom of it.

Of course the other possibility is that the stats DB is simply 
overwhelmed with work and unable to keep up. It's supposed to start 
dropping incoming stats messages in this situation, but maybe it isn't. 
To determine if this is the case, look at:

rabbitmqctl eval 'process_info(global:whereis_name(rabbit_mgmt_db), 
memory).'

- and if the number that comes back looks like it would account for most 
of the memory used, then that is likely to be the problem. In that case 
you can slow down stats event emission by changing 
collect_statistics_interval (see http://www.rabbitmq.com/configure.html) 
and / or disable fine-grained stats as I mentioned in the previous message.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From Punit.Jain at emc.com  Mon Nov 11 10:46:46 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Mon, 11 Nov 2013 05:46:46 -0500
Subject: [rabbitmq-discuss] Errors during SSL configuration
Message-ID: <DB14E94115BBC84E8960C12C176D067601779CA899@MX25A.corp.emc.com>

Hi All,
I was trying to configure SSL as instructed in the http://www.rabbitmq.com/ssl.html. My configuration file is:
[
        {rabbit, [
                {auth_mechanisms,     ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
                {heartbeat,           30},
                {tcp_listeners,       [5672]},
                {ssl_listeners, [5671]},
                {ssl_cert_login_from, common_name},
                {ssl_options, [{cacertfile, "/home/service/ssl/testca/cacert.pem"},
                    {certfile, "/home/service/ssl/server/cert.pem"},
                    {keyfile, "/home/service/ssl/server/key.pem"},
                    {verify, verify_peer},
                    {fail_if_no_peer_cert, false}]}
        ]}
].


But when I try to establish an SSL connection using Pika, I get following error:
=INFO REPORT==== 11-Nov-2013::09:56:42 ===
accepting AMQP connection <0.557.0> ([::1]:10538 -> [::1]:5671)

=ERROR REPORT==== 11-Nov-2013::09:56:42 ===
SSL: 1089: error:{error,{badmatch,{error,eacces}}} /home/service/ssl/testca/cacert.pem
  [{ssl_connection,init_certificates,2,
                   [{file,"ssl_connection.erl"},{line,1086}]},
   {ssl_connection,ssl_init,2,[{file,"ssl_connection.erl"},{line,1062}]},
   {ssl_connection,init,1,[{file,"ssl_connection.erl"},{line,316}]},
   {gen_fsm,init_it,6,[{file,"gen_fsm.erl"},{line,361}]},
   {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]


=INFO REPORT==== 11-Nov-2013::09:56:42 ===
accepting AMQP connection <0.561.0> (127.0.0.1:11194 -> 127.0.0.1:5671)

=ERROR REPORT==== 11-Nov-2013::09:56:42 ===
SSL: 1089: error:{error,{badmatch,{error,eacces}}} /home/service/ssl/testca/cacert.pem
  [{ssl_connection,init_certificates,2,
                   [{file,"ssl_connection.erl"},{line,1086}]},
   {ssl_connection,ssl_init,2,[{file,"ssl_connection.erl"},{line,1062}]},
   {ssl_connection,init,1,[{file,"ssl_connection.erl"},{line,316}]},
   {gen_fsm,init_it,6,[{file,"gen_fsm.erl"},{line,361}]},
   {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]


=INFO REPORT==== 11-Nov-2013::09:56:44 ===
accepting AMQP connection <0.568.0> (127.0.0.1:28830 -> 127.0.0.1:5672)

=ERROR REPORT==== 11-Nov-2013::09:56:47 ===
error on AMQP connection <0.557.0>: {ssl_upgrade_error,ecacertfile} (unknown POSIX error)

=ERROR REPORT==== 11-Nov-2013::09:56:47 ===
error on AMQP connection <0.561.0>: {ssl_upgrade_error,ecacertfile} (unknown POSIX error)

The certificate files have permissions as below:

-rw-r--r-- 1 service users 1070 Nov 11 07:58 client/cert.pem
-rw-r--r-- 1 service users 2349 Nov 11 07:58 client/keycert.p12
-rw-r--r-- 1 service users 1675 Nov 11 07:57 client/key.pem
-rw-r--r-- 1 service users  924 Nov 11 07:58 client/req.pem
-rw-r--r-- 1 service users 1070 Nov 11 07:57 server/cert.pem
-rw-r--r-- 1 service users 2349 Nov 11 07:57 server/keycert.p12
-rw-r--r-- 1 service users 1675 Nov 11 07:56 server/key.pem
-rw-r--r-- 1 service users  924 Nov 11 07:56 server/req.pem
-rw-r--r-- 1 service users  714 Nov 11 07:55 testca/cacert.cer
-rw-r--r-- 1 service users 1021 Nov 11 07:55 testca/cacert.pem
-rw-r--r-- 1 service users  116 Nov 11 07:58 testca/index.txt
-rw-r--r-- 1 service users   21 Nov 11 07:58 testca/index.txt.attr
-rw-r--r-- 1 service users   21 Nov 11 07:57 testca/index.txt.attr.old
-rw-r--r-- 1 service users   58 Nov 11 07:57 testca/index.txt.old
-rw-r--r-- 1 service users 2567 Nov 11 07:55 testca/openssl.cnf
-rw-r--r-- 1 service users    3 Nov 11 07:58 testca/serial
-rw-r--r-- 1 service users    3 Nov 11 07:57 testca/serial.old

testca/certs:
total 8
-rw-r--r-- 1 service users 1070 Nov 11 07:57 01.pem
-rw-r--r-- 1 service users 1070 Nov 11 07:58 02.pem

testca/private:
total 4
-rw-r--r-- 1 service users 1679 Nov 11 07:55 cakey.pem

I googled it and found out that the issue is related to permissions. I gave everyone full access, but still it doesn't solve the issue. Can you please help me in fixing this?

Thanks in Advance!
-Punit
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/0d43a133/attachment.htm>

From mklishin at gopivotal.com  Mon Nov 11 10:57:36 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 11 Nov 2013 14:57:36 +0400
Subject: [rabbitmq-discuss] Errors during SSL configuration
In-Reply-To: <DB14E94115BBC84E8960C12C176D067601779CA899@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D067601779CA899@MX25A.corp.emc.com>
Message-ID: <277B760F-FB5D-4667-8213-02F54C3EC821@rabbitmq.com>

On 11 Nov 2013, at 14:46, Jain, Punit <Punit.Jain at emc.com> wrote:

> SSL: 1089: error:{error,{badmatch,{error,eacces}}} /home/service/ssl/testca/cacert.pem

This means RabbitMQ?s active user cannot read CA certificate at /home/service/ssl/testca/cacert.pem.

The user depends on how you install RabbitMQ but likely it is `rabbitmq`.

MK

Software Engineer, Pivotal/RabbitMQ



From rocknrollarmy at googlemail.com  Mon Nov 11 10:52:04 2013
From: rocknrollarmy at googlemail.com (RocknrollArmy)
Date: Mon, 11 Nov 2013 02:52:04 -0800 (PST)
Subject: [rabbitmq-discuss] Read all, ack later?
Message-ID: <91df9e32-5699-4e48-8052-ac97e0c03482@googlegroups.com>

Hello,

is it a valid scenario for RabbitMQ to have a queue with persisted 
messages, where a consumer first wants to read all messages from the queue,
but do the ack for all or none of them later on? 

It's about keeping messages in a queue until some consumer criteria decides 
that all messages needed are received. If the criteria fails,
the connection just dies and the messages would remain in the queue until a 
new message arrives and a new consumer connects and does the check again.

Not sure if this is generally a good/bad idea or a use case where a queue 
is the right tool.

Any thoughts on this?

Best regards,

Daniel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/60111056/attachment.htm>

From mklishin at gopivotal.com  Mon Nov 11 11:04:59 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 11 Nov 2013 15:04:59 +0400
Subject: [rabbitmq-discuss] Read all, ack later?
In-Reply-To: <91df9e32-5699-4e48-8052-ac97e0c03482@googlegroups.com>
References: <91df9e32-5699-4e48-8052-ac97e0c03482@googlegroups.com>
Message-ID: <2434847D-9774-4944-AE8D-E32EE02C1208@rabbitmq.com>

On 11 Nov 2013, at 14:52, RocknrollArmy <rocknrollarmy at googlemail.com> wrote:

> is it a valid scenario for RabbitMQ to have a queue with persisted messages, where a consumer first wants to read all messages from the queue,
> but do the ack for all or none of them later on? 

basic.ack and basic.nack support acknowledgements of multiple deliveries at once.

Note that that will acknowledge (or reject) all *outstanding* deliveries. You?ll need to know
when it?s time to do so because there may be more messages coming.

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Mon Nov 11 11:09:08 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Nov 2013 11:09:08 +0000
Subject: [rabbitmq-discuss] Read all, ack later?
In-Reply-To: <91df9e32-5699-4e48-8052-ac97e0c03482@googlegroups.com>
References: <91df9e32-5699-4e48-8052-ac97e0c03482@googlegroups.com>
Message-ID: <5280BAD4.9060601@rabbitmq.com>

It's not an awful thing to do. The cost of an unacked message varies 
(depending on whether it's paged out etc) but is always somewhat higher 
than that of a "ready" message. And requeuing a ton of unacked messages 
can be expensive (particularly if a lot of them are paged out). Finally, 
the delivery tags of unacked messages are always held in memory and 
can't be paged out.

So it depends a bit. I would be wary of doing it (at least I would want 
to do my own performance tests) if the queue was not expected to fit in 
memory. Of course, doing your own performance tests is always a good 
idea :-)

Cheers, Simon

On 11/11/2013 10:52AM, RocknrollArmy wrote:
> Hello,
>
> is it a valid scenario for RabbitMQ to have a queue with persisted
> messages, where a consumer first wants to read all messages from the queue,
> but do the ack for all or none of them later on?
>
> It's about keeping messages in a queue until some consumer criteria
> decides that all messages needed are received. If the criteria fails,
> the connection just dies and the messages would remain in the queue
> until a new message arrives and a new consumer connects and does the
> check again.
>
> Not sure if this is generally a good/bad idea or a use case where a
> queue is the right tool.
>
> Any thoughts on this?
>
> Best regards,
>
> Daniel
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Mon Nov 11 11:26:56 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Nov 2013 11:26:56 +0000
Subject: [rabbitmq-discuss] Queue Weird State in RMQ 3.2.1
In-Reply-To: <5329EC68-CB9A-4DE0-B1E0-AAC0BCBDB166@eventbrite.com>
References: <5329EC68-CB9A-4DE0-B1E0-AAC0BCBDB166@eventbrite.com>
Message-ID: <5280BF00.50709@rabbitmq.com>

Thanks for the report. Replicated.

As a workaround you can invoke "rabbitmqctl list_queues" - this will 
wake all idle queues up and get them appearing correctly in mgmt again 
(for another hour).

Cheers, Simon

On 08/11/2013 5:25PM, Jonathan Cua wrote:
> I am using Rabbitmq 3.2.1 on Ubuntu 12.04. I have a 2-node cluster setup.
>
> In the Queues tab, I see this in on one the queue.
>
>
> But when I click on this queue, I would see this.
>
>
> Then when I publish a message to this queue, it would get consumed and
> everything would go back to 0. There is nothing in the logs or sasl.log
> about this. So, I am wondering what this is. Also, this issue did not
> exist in RabbitMQ 2.8.7.
>
> I was able to reproduce this issue. It looks like when the queue gets
> idle (eg. no message is sent/consumed) for exactly 1 hour, it changes
> from 0 to '?'.
>
> Here is how to reproduce this.
>
> 1. Create a queue either through the UI or an ampq client (I used the
> pika python module).
> 2. Publish one message to the queue.
> 3. Wait for 1 hour then you will see the message go from 0 to '?'.
> 4. If you publish another message to this queue, it will go back to 0 again.
>
>
> Thanks,
> Jonathan
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.laing at nytimes.com  Mon Nov 11 11:35:37 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Mon, 11 Nov 2013 06:35:37 -0500
Subject: [rabbitmq-discuss] Exchange Feature request: Drop Duplicates
Message-ID: <CAKgmDnEWqf=pwN-X=GdLYqRQnAWbsMpwF1s91xBmUH5RynvDyQ@mail.gmail.com>

In our scenarios, messages are ultimately delivered to a 'retail' rabbitmq
instance to be delivered to a client. The pipelines that process and
deliver messages are purposefully redundant, hence there may be multiple
replicas of each message 'racing' to the endpoint.

Usually, the replicas are resolved before getting to the retail rabbit.
When components fail, however, duplicates can leak through during a small
window of time. We eliminate those duplicates at the retail layer by
looking at each message_id. Ultimately, our client contract allows
duplicates as well in case one slips by.

It seems to me that this is a generic issue.

What would be useful in our case, and hopefully for many others, would be a
'Duplicate Message ID Window' in milliseconds, as an exchange attribute.

If non-zero, the exchange would drop any message with a duplicate
message_id that appeared within the specified window of time, possibly
routing it to the alternate exchange, if set.

In our case, a window of a few seconds, perhaps up to a minute would
suffice.

Thanks,

Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/3b1b6434/attachment.htm>

From fercascue at gmail.com  Mon Nov 11 11:36:01 2013
From: fercascue at gmail.com (fercascue)
Date: Mon, 11 Nov 2013 03:36:01 -0800 (PST)
Subject: [rabbitmq-discuss] C++ Consumer Example into While Loop
Message-ID: <1384169761540-31343.post@n5.nabble.com>

Hi, 

Could anybody provide me an example of c++ consumer only using a while loop?
I mean, a while loop to read messages from Rabbitmq server without a
addEvent function. 

I'm using alanxz/rabbitmq-c library for it and I dont want to use another
library like boost in order to read messages from server. 

Thanks.
Best Regards.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/C-Consumer-Example-into-While-Loop-tp31343.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Punit.Jain at emc.com  Mon Nov 11 11:42:28 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Mon, 11 Nov 2013 06:42:28 -0500
Subject: [rabbitmq-discuss] Errors during SSL configuration
In-Reply-To: <277B760F-FB5D-4667-8213-02F54C3EC821@rabbitmq.com>
References: <DB14E94115BBC84E8960C12C176D067601779CA899@MX25A.corp.emc.com>
	<277B760F-FB5D-4667-8213-02F54C3EC821@rabbitmq.com>
Message-ID: <DB14E94115BBC84E8960C12C176D067601779CA89E@MX25A.corp.emc.com>

Hi Michael,
The current permission for cacert.pem is:
-rw-r--r-- 1 service users 1021 Nov 11 07:55 cacert.pem

That means everyone has read permission to this file. What else could be the problem then?

Thanks!

> -----Original Message-----
> From: Michael Klishin [mailto:mklishin at gopivotal.com]
> Sent: Monday, November 11, 2013 4:28 PM
> To: Discussions about RabbitMQ
> Cc: Jain, Punit
> Subject: Re: [rabbitmq-discuss] Errors during SSL configuration
> 
> On 11 Nov 2013, at 14:46, Jain, Punit <Punit.Jain at emc.com> wrote:
> 
> > SSL: 1089: error:{error,{badmatch,{error,eacces}}}
> /home/service/ssl/testca/cacert.pem
> 
> This means RabbitMQ's active user cannot read CA certificate at
> /home/service/ssl/testca/cacert.pem.
> 
> The user depends on how you install RabbitMQ but likely it is `rabbitmq`.
> 
> MK
> 
> Software Engineer, Pivotal/RabbitMQ
> 
> 


From mklishin at gopivotal.com  Mon Nov 11 11:59:29 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 11 Nov 2013 15:59:29 +0400
Subject: [rabbitmq-discuss] Errors during SSL configuration
In-Reply-To: <DB14E94115BBC84E8960C12C176D067601779CA89E@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D067601779CA899@MX25A.corp.emc.com>
	<277B760F-FB5D-4667-8213-02F54C3EC821@rabbitmq.com>
	<DB14E94115BBC84E8960C12C176D067601779CA89E@MX25A.corp.emc.com>
Message-ID: <9B061D07-4BD4-46D7-A7DC-DCD0843214A1@gopivotal.com>

On 11 Nov 2013, at 15:42, Jain, Punit <Punit.Jain at emc.com> wrote:

> That means everyone has read permission to this file. What else could be the problem then?

If the file is world readable, check if you may have SELinux controls in place.

I?ve noticed that the module in question is no longer available in Erlang 16B01+.
init_certificates/2 catches all errors and assumes they are file system
errors:

https://github.com/erlang/otp/blob/OTP_R15B03/lib/ssl/src/ssl_connection.erl#L1109-1113

which is not the case.

R16B01 introduces support for chained certificates:
http://www.erlang.org/download/otp_src_R16B01.readme
http://www.erlang.org/doc/apps/ssl/notes.html

So it may be that your certificate is chained. Give R16B02 a try (R16B01 has its own issues
and we generally recommend avoiding it if you can).
--
MK

Software Engineer, Pivotal/RabbitMQ



From diachenko.s.a at gmail.com  Mon Nov 11 11:18:04 2013
From: diachenko.s.a at gmail.com (=?UTF-8?B?0KHQtdGA0LPQtdC5INCU0YzRj9GH0LXQvdC60L4=?=)
Date: Mon, 11 Nov 2013 03:18:04 -0800 (PST)
Subject: [rabbitmq-discuss] Non-ascii characters in user's profile path.
	OS: Windows 7.
In-Reply-To: <df913021-c354-4605-8411-8e1cdfc08384@googlegroups.com>
References: <df913021-c354-4605-8411-8e1cdfc08384@googlegroups.com>
Message-ID: <c0a9e118-e893-4c1a-99bf-f7c09ee71f90@googlegroups.com>

It might help you: http://www.rabbitmq.com/windows-quirks.html

???????, 7 ?????? 2013 ?., 14:49:29 UTC+4 ???????????? adaml ???????:
>
> Hi,
>
> Please consider user named "Dzia? techniczny" (Tech department).
> It has an administrative privileges. So, I'm installing RabbitMQ under 
> that user.
> Here's the problem:
> I'm unable to start the RabbitMQ service, when the path to the user's 
> profile contains non-ascii characters.
> Is there any way to avoid editing Registry (I can change startup paths in 
> Args key) or installing RabbitMQ as different user in the future?
>
> RabbitMQ version: 3.0.1
> Erlang version: R15B03-1
>
> Best Regards,
> adaml
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/f95ca1ec/attachment.htm>

From diachenko.s.a at gmail.com  Mon Nov 11 11:32:53 2013
From: diachenko.s.a at gmail.com (=?UTF-8?B?0KHQtdGA0LPQtdC5INCU0YzRj9GH0LXQvdC60L4=?=)
Date: Mon, 11 Nov 2013 03:32:53 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Consumer/Producer Proxy Support
In-Reply-To: <7552ddbc-309f-4c0f-aa73-600a486e287f@googlegroups.com>
References: <7552ddbc-309f-4c0f-aa73-600a486e287f@googlegroups.com>
Message-ID: <85f69ca9-89f7-48ba-8066-d4fe96b5cdd5@googlegroups.com>

Rabbitmq has user's access control mechanism. You can use it.

???????, 8 ?????? 2013 ?., 20:31:41 UTC+4 ???????????? 
blake.co... at gmail.com ???????:
>
> Is it possible for the RabbitMQ producer/consumer to establish a 
> connection to the broker (RabbitMQ server) from behind an authenticated 
> proxy? I'm currently leveraging the AMQP 0-9-1 message protocol. 
>
> Use Case:
> Consumer 1 is running on a machine that sits behind a proxy. Consumer 1 
> would like to authenticate to the proxy so a socket connection can be 
> established with the broker (RabbitMQ server)
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/d5a41691/attachment.htm>

From pierpaolo at dropbox.com  Mon Nov 11 14:24:45 2013
From: pierpaolo at dropbox.com (Pierpaolo Baccichet)
Date: Mon, 11 Nov 2013 06:24:45 -0800
Subject: [rabbitmq-discuss] Stats node getting slow
In-Reply-To: <5280A8E6.6010506@rabbitmq.com>
References: <CAKZAfCWqEj2QvXobCA6zFY3tX9_W7jmkj8vFo-32UQqvrHejFg@mail.gmail.com>
	<5280A71C.5050102@rabbitmq.com> <5280A8E6.6010506@rabbitmq.com>
Message-ID: <CAKZAfCUo4Sd7TsheQHSao47ar_yducpeAg98bADACjJmq_BJPA@mail.gmail.com>

Hello Simon,

Thanks for the response and yeah, my gut feeling went as well toward a leak
in that rewrite because in fact this issue started showing up when we
upgraded to 3.1.x. We ended up disabling the fine-grained stats last friday
as you mentioned in your last suggestion because people were getting paged
a bit too often :) The current config is below

[
    {rabbit, [
        {vm_memory_high_watermark, 0.75},
        {cluster_nodes, [
            'rabbit at xyz1',
            'rabbit at xyz2',
            'rabbit at xyz3'
        ]},
        {collect_statistics, coarse},
        {collect_statistics_interval, 10000}
    ]},
    {rabbitmq_management_agent, [
        {force_fine_statistics, false}
    ]}
].

I will give it a few more days with this config and then maybe revert to
help you figure this issue. A related question, is there a way to
programmatically figure which one is the stats node in the cluster? I could
not find the config in the HTTP API


On Mon, Nov 11, 2013 at 1:52 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 11/11/2013 9:45AM, Simon MacMullen wrote:
>
>> Hmm, the stats DB was more or less rewritten between 3.0.x and 3.1.0 (to
>> keep stats histories). If there's a memory leak in there I'd very much
>> like to get to the bottom of it.
>>
>
> Of course the other possibility is that the stats DB is simply overwhelmed
> with work and unable to keep up. It's supposed to start dropping incoming
> stats messages in this situation, but maybe it isn't. To determine if this
> is the case, look at:
>
> rabbitmqctl eval 'process_info(global:whereis_name(rabbit_mgmt_db),
> memory).'
>
> - and if the number that comes back looks like it would account for most
> of the memory used, then that is likely to be the problem. In that case you
> can slow down stats event emission by changing collect_statistics_interval
> (see http://www.rabbitmq.com/configure.html) and / or disable
> fine-grained stats as I mentioned in the previous message.
>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/1e4ecc4d/attachment.htm>

From mklishin at gopivotal.com  Mon Nov 11 14:28:57 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 11 Nov 2013 18:28:57 +0400
Subject: [rabbitmq-discuss] Stats node getting slow
In-Reply-To: <CAKZAfCUo4Sd7TsheQHSao47ar_yducpeAg98bADACjJmq_BJPA@mail.gmail.com>
References: <CAKZAfCWqEj2QvXobCA6zFY3tX9_W7jmkj8vFo-32UQqvrHejFg@mail.gmail.com>
	<5280A71C.5050102@rabbitmq.com> <5280A8E6.6010506@rabbitmq.com>
	<CAKZAfCUo4Sd7TsheQHSao47ar_yducpeAg98bADACjJmq_BJPA@mail.gmail.com>
Message-ID: <3FDCF51A-833E-4EA2-AC22-2D5F30D225AA@rabbitmq.com>

On 11 Nov 2013, at 18:24, Pierpaolo Baccichet <pierpaolo at dropbox.com> wrote:

>  A related question, is there a way to programmatically figure which one is the stats node in the cluster? I could not find the config in the HTTP API

GET /api/overview and see "statistics_db_node"

MK

Software Engineer, Pivotal/RabbitMQ



From pierpaolo at dropbox.com  Mon Nov 11 14:51:30 2013
From: pierpaolo at dropbox.com (Pierpaolo Baccichet)
Date: Mon, 11 Nov 2013 06:51:30 -0800
Subject: [rabbitmq-discuss] Stats node getting slow
In-Reply-To: <3FDCF51A-833E-4EA2-AC22-2D5F30D225AA@rabbitmq.com>
References: <CAKZAfCWqEj2QvXobCA6zFY3tX9_W7jmkj8vFo-32UQqvrHejFg@mail.gmail.com>
	<5280A71C.5050102@rabbitmq.com> <5280A8E6.6010506@rabbitmq.com>
	<CAKZAfCUo4Sd7TsheQHSao47ar_yducpeAg98bADACjJmq_BJPA@mail.gmail.com>
	<3FDCF51A-833E-4EA2-AC22-2D5F30D225AA@rabbitmq.com>
Message-ID: <CAKZAfCVDBrWHhJPkiVGP+XzS6=7MeNuUOXeXCxf9VdtHcVbXTQ@mail.gmail.com>

Doh, thanks Michael!

This gives me the ability to script everything up so yeah, I am going to
let the dust settle this week and then try to convince the oncall (the
pages for this module go to somebody else at this point so it's not really
my call :) ) to revert to the old config over the weekend and help you guys
out narrowing the issue.

BTW, it could be related or not but since I am at it I thought to report
it: I did some throughput benchmarks a year ago on 3.0.x series trying to
figure what sustained message rates we could get in different replication
configurations. I repeated the experiments recently on 3.1.x and noticed
that the numbers dropped quite a bit. It's difficult to say exactly by how
much because we are serving also live traffic now on the same cluster so
there is less isolation but I would say the throughput dropped by 20/30%. I
wonder if this can also be related to the stats node messing up. Not super
important right now because we ended up using redis for the component that
was generating that high volume since anyway they just needed a lightweight
pub/sub and not really the queueing features that much.

Thanks again for the help and hopefully I'll get back to you with some data
soon.

Best, Pier


On Mon, Nov 11, 2013 at 6:28 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 11 Nov 2013, at 18:24, Pierpaolo Baccichet <pierpaolo at dropbox.com>
> wrote:
>
> >  A related question, is there a way to programmatically figure which one
> is the stats node in the cluster? I could not find the config in the HTTP
> API
>
> GET /api/overview and see "statistics_db_node"
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/e06953cf/attachment.htm>

From sekhar434145 at gmail.com  Mon Nov 11 14:56:30 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Mon, 11 Nov 2013 20:26:30 +0530
Subject: [rabbitmq-discuss] How to configure reply queue?
In-Reply-To: <CADtU9_t+3Hb2UTsXk2a5iP362fOrtXHnBTibHSoXr-rz96ReLQ@mail.gmail.com>
References: <CAH75Yb4usdX2RBM2pGRrmH8WNKF0Ov8p=+NfQeyC6BNRTJniGQ@mail.gmail.com>
	<CADtU9_t+3Hb2UTsXk2a5iP362fOrtXHnBTibHSoXr-rz96ReLQ@mail.gmail.com>
Message-ID: <CAH75Yb7Ff40yF3ZQ0iu3ycUexH0xvhs5=-SZuH28nYhsnmMg1g@mail.gmail.com>

Thank you Russell for the response. Still am stuck with achieving above
program, could please tell where am failing while doing above code. Below
is the code at producer end.



CONFIGURATION -

public RabbitTemplate rabbitTemplate() {
RabbitTemplate template = new RabbitTemplate(connectionFactory());
template.setRoutingKey(this.queueName);
template.setQueue(this.queueName);
template.setMessageConverter(new JsonMessageConverter());
return template;
}

public ConnectionFactory connectionFactory() {
CachingConnectionFactory connectionFactory = new CachingConnectionFactory(
"localhost");
connectionFactory.setUsername("guest");
connectionFactory.setPassword("guest");
return connectionFactory;
}


PRODUCER CODE -


String corrId = UUID.randomUUID().toString();
String replyQueueName = *channel*.queueDeclare().getQueue();
 MessageProperties prop = new MessageProperties();
prop.setCorrelationId(corrId.getBytes());
prop.setReplyTo(replyQueueName);
Message message = new Message(query.getBytes(), prop);
Message msg = rabbitTemplate.sendAndReceive(message);


Is this correct at producer end? Here how to Channel to retrieve
reqplyQueueName? Could you please correct me on this and please tell me how
to write consumer code to send the result(List of Objects) in JSON format
back to that particular request in replyqueue? Thanks in advance.


On Fri, Nov 8, 2013 at 7:20 PM, Gary Russell <grussell at gopivotal.com> wrote:

> http://docs.spring.io/spring-amqp/reference/html/amqp.html#request-reply
>
> The simplest is to configure the RabbitTemplate to use a fixed reply
> queue, with a reply listener, and use one of it's
> convertSendAndReceive(...) (or sendAndReceive) methods; the template will
> take care of the correlation.
>
> If you want to do it asynchronously and do your own correlation (get the
> reply asynchronously on another thread) just use one of the send() methods
> and wire up a listener container to get the results.
>
>
>
> On Fri, Nov 8, 2013 at 12:36 AM, Rajasekhar P <sekhar434145 at gmail.com>wrote:
>
>> Hi Team,
>>
>> We are trying to make asynchronous call in RabbitMQ using Spring AMQP,
>> could any one please tell me how to configure *replyqueue,
>> correlationId, (properties) *using spring amqp?
>>
>>  String corrId = java.util.UUID.randomUUID().toString();
>>  BasicProperties props = new BasicProperties
>>                                 .Builder()
>>                                 .correlationId(corrId)
>>                                 .replyTo(replyQueueName)
>>                                 .build();
>>
>>  channel.basicPublish("", requestQueueName, props, message.getBytes());
>>
>>
>> Thanks in advance.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/42fb0ee1/attachment.htm>

From mikeb at squaremobius.net  Mon Nov 11 15:25:30 2013
From: mikeb at squaremobius.net (Michael Bridgen)
Date: Mon, 11 Nov 2013 15:25:30 +0000
Subject: [rabbitmq-discuss] Erlang client rabbit_channel:wait_for_confirms
	and nacks
Message-ID: <CAMZ8XCioPWdGWjY-b7q_4hrWOjnPNmviJW+E80zDakjWpnVppw@mail.gmail.com>

rabbit_channel:wait_for_confirms_or_die/1 and /2 block the process
until either all messages sent since the last wait_* call have been
acked, or a nack is received in which case exit is called. Is there
any way to determine which message or messages were nacked? That might
be important.

Similarly, rabbit_channel:wait_for_confirms/1 and /2 block the process
until acks or nacks for all messages published since the last wait_*
was called. I wonder what use are they, if they don't discriminate
between acks and nacks?

Cheers,
Michael

From grussell at gopivotal.com  Mon Nov 11 15:27:01 2013
From: grussell at gopivotal.com (Gary Russell)
Date: Mon, 11 Nov 2013 10:27:01 -0500
Subject: [rabbitmq-discuss] How to configure reply queue?
In-Reply-To: <CAH75Yb7Ff40yF3ZQ0iu3ycUexH0xvhs5=-SZuH28nYhsnmMg1g@mail.gmail.com>
References: <CAH75Yb4usdX2RBM2pGRrmH8WNKF0Ov8p=+NfQeyC6BNRTJniGQ@mail.gmail.com>
	<CADtU9_t+3Hb2UTsXk2a5iP362fOrtXHnBTibHSoXr-rz96ReLQ@mail.gmail.com>
	<CAH75Yb7Ff40yF3ZQ0iu3ycUexH0xvhs5=-SZuH28nYhsnmMg1g@mail.gmail.com>
Message-ID: <CADtU9_stR7a4ctuO-AR5x09nOwkYJvuQUM5zvQ=dJHo=b+CZmA@mail.gmail.com>

Please read the documentation...
http://docs.spring.io/spring-amqp/reference/html/amqp.html#d4e460

It explains that, when you use a fixed reply queue, and roll your own
configuration like this, you have to wire up a listener container for the
replies (with the rabbitTemplate as the listener).

If you use a listener-container on the consumer side (with a
MessageListenerAdapter), it will automatically send the result to the
replyTo. Your consumer can be a simple POJO method that returns a list of
Objects. Use a JsonMessageConverter in the adapter to convert them to JSON.




On Mon, Nov 11, 2013 at 9:56 AM, Rajasekhar P <sekhar434145 at gmail.com>wrote:

> Thank you Russell for the response. Still am stuck with achieving above
> program, could please tell where am failing while doing above code. Below
> is the code at producer end.
>
>
>
> CONFIGURATION -
>
> public RabbitTemplate rabbitTemplate() {
> RabbitTemplate template = new RabbitTemplate(connectionFactory());
>  template.setRoutingKey(this.queueName);
> template.setQueue(this.queueName);
> template.setMessageConverter(new JsonMessageConverter());
>  return template;
> }
>
> public ConnectionFactory connectionFactory() {
>  CachingConnectionFactory connectionFactory = new
> CachingConnectionFactory(
> "localhost");
>  connectionFactory.setUsername("guest");
> connectionFactory.setPassword("guest");
> return connectionFactory;
>  }
>
>
> PRODUCER CODE -
>
>
> String corrId = UUID.randomUUID().toString();
>  String replyQueueName = *channel*.queueDeclare().getQueue();
>  MessageProperties prop = new MessageProperties();
>  prop.setCorrelationId(corrId.getBytes());
> prop.setReplyTo(replyQueueName);
> Message message = new Message(query.getBytes(), prop);
>  Message msg = rabbitTemplate.sendAndReceive(message);
>
>
> Is this correct at producer end? Here how to Channel to retrieve
> reqplyQueueName? Could you please correct me on this and please tell me how
> to write consumer code to send the result(List of Objects) in JSON format
> back to that particular request in replyqueue? Thanks in advance.
>
>
> On Fri, Nov 8, 2013 at 7:20 PM, Gary Russell <grussell at gopivotal.com>wrote:
>
>> http://docs.spring.io/spring-amqp/reference/html/amqp.html#request-reply
>>
>> The simplest is to configure the RabbitTemplate to use a fixed reply
>> queue, with a reply listener, and use one of it's
>> convertSendAndReceive(...) (or sendAndReceive) methods; the template will
>> take care of the correlation.
>>
>> If you want to do it asynchronously and do your own correlation (get the
>> reply asynchronously on another thread) just use one of the send() methods
>> and wire up a listener container to get the results.
>>
>>
>>
>> On Fri, Nov 8, 2013 at 12:36 AM, Rajasekhar P <sekhar434145 at gmail.com>wrote:
>>
>>> Hi Team,
>>>
>>> We are trying to make asynchronous call in RabbitMQ using Spring AMQP,
>>> could any one please tell me how to configure *replyqueue,
>>> correlationId, (properties) *using spring amqp?
>>>
>>>  String corrId = java.util.UUID.randomUUID().toString();
>>>  BasicProperties props = new BasicProperties
>>>                                 .Builder()
>>>                                 .correlationId(corrId)
>>>                                 .replyTo(replyQueueName)
>>>                                 .build();
>>>
>>>  channel.basicPublish("", requestQueueName, props, message.getBytes());
>>>
>>>
>>> Thanks in advance.
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/4dc8b993/attachment.htm>

From simon at rabbitmq.com  Mon Nov 11 15:43:24 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Nov 2013 15:43:24 +0000
Subject: [rabbitmq-discuss] Erlang client
 rabbit_channel:wait_for_confirms and nacks
In-Reply-To: <CAMZ8XCioPWdGWjY-b7q_4hrWOjnPNmviJW+E80zDakjWpnVppw@mail.gmail.com>
References: <CAMZ8XCioPWdGWjY-b7q_4hrWOjnPNmviJW+E80zDakjWpnVppw@mail.gmail.com>
Message-ID: <5280FB1C.4070305@rabbitmq.com>

The expectation is that nacks will be vanishingly rare. To be honest I 
think we never should have added the possibility of sending a nack in 
confirm mode; it can only happen if there is an internal error in the 
queue. I would rather just have the publishing channel die with 
internal_error at that point too.

But if you do want to handle nacks separately you'll need to register a 
confirm handler instead. You could still use wait_for_confirms() to 
handle acks, and then in your confirm handler drop acks and handle nacks.

Cheers, Simon

On 11/11/2013 3:25PM, Michael Bridgen wrote:
> rabbit_channel:wait_for_confirms_or_die/1 and /2 block the process
> until either all messages sent since the last wait_* call have been
> acked, or a nack is received in which case exit is called. Is there
> any way to determine which message or messages were nacked? That might
> be important.
>
> Similarly, rabbit_channel:wait_for_confirms/1 and /2 block the process
> until acks or nacks for all messages published since the last wait_*
> was called. I wonder what use are they, if they don't discriminate
> between acks and nacks?
>
> Cheers,
> Michael
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From armen.michaeli at gmail.com  Mon Nov 11 14:33:24 2013
From: armen.michaeli at gmail.com (Armen Michaeli)
Date: Mon, 11 Nov 2013 15:33:24 +0100
Subject: [rabbitmq-discuss] Downloaded binary distribution (generic unix),
	can't start it...
Message-ID: <CAHKDcOQ3Pab6qawB939Dk5D80F+q_zPb-NFKsTwJczFwVR8rgg@mail.gmail.com>

Hello good folks,

I have unpacked the tar archive and copied files in sbin to /../sbin and
manpages as well. I now know that ebin contains erlang compiled code, and
after inspecting the rabbitmq-server script I see that it invokes erl,
which I now know is erlang. I do not have erlang installed, do I need it to
run the server?

Currently, upon launching rabbitmq-server, it gives me access denied,
attempting to write files in most definitely wrong path like:

mkdir: cannot create directory ?/usr/local/sbin/../var?: Permission denied
/usr/local/sbin/rabbitmq-server: line 80:
/usr/local/sbin/../var/lib/rabbitmq/mnesia/rabbit at full-of-stars.pid: No
such file or directory
/usr/local/sbin/rabbitmq-server: line 85: erl: command not found

I see two errors here - how do i fix the first one? I assume the solution
to second one is to install an Erlang compiler/interpreter?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/943c288b/attachment.htm>

From simon at rabbitmq.com  Mon Nov 11 15:59:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Nov 2013 15:59:18 +0000
Subject: [rabbitmq-discuss] Downloaded binary distribution (generic
 unix), can't start it...
In-Reply-To: <CAHKDcOQ3Pab6qawB939Dk5D80F+q_zPb-NFKsTwJczFwVR8rgg@mail.gmail.com>
References: <CAHKDcOQ3Pab6qawB939Dk5D80F+q_zPb-NFKsTwJczFwVR8rgg@mail.gmail.com>
Message-ID: <5280FED6.80606@rabbitmq.com>

On 11/11/2013 2:33PM, Armen Michaeli wrote:
> Currently, upon launching rabbitmq-server, it gives me access denied,
> attempting to write files in most definitely wrong path like:
> mkdir: cannot create directory ?/usr/local/sbin/../var?: Permission denied
> /usr/local/sbin/rabbitmq-server: line 80:
> /usr/local/sbin/../var/lib/rabbitmq/mnesia/rabbit at full-of-stars.pid: No
> such file or directory
> /usr/local/sbin/rabbitmq-server: line 85: erl: command not found
> I see two errors here - how do i fix the first one?

The generic unix distribution is designed to run directly from the 
unpacked tarball. It determines where to put databases and log files 
relative to the launch scripts.

If you want to relocate those things, see 
http://www.rabbitmq.com/relocate.html and 
http://www.rabbitmq.com/man/rabbitmq-env.conf.5.man.html

I would not suggest you start by unpacking bits of the tarball and 
moving them around though, you're likely to spend quite a while fixing 
file-not-found errors.

> I assume the
> solution to second one is to install an Erlang compiler/interpreter?

Yes.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Mon Nov 11 16:01:02 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 11 Nov 2013 16:01:02 +0000
Subject: [rabbitmq-discuss] Downloaded binary distribution (generic
 unix), can't start it...
In-Reply-To: <CAHKDcOQ3Pab6qawB939Dk5D80F+q_zPb-NFKsTwJczFwVR8rgg@mail.gmail.com>
References: <CAHKDcOQ3Pab6qawB939Dk5D80F+q_zPb-NFKsTwJczFwVR8rgg@mail.gmail.com>
Message-ID: <5280FF3E.1080304@rabbitmq.com>


Hi,

On 11/11/13 14:33, Armen Michaeli wrote:

> I see two errors here - how do i fix the first one? I assume the
> solution to second one is to install an Erlang compiler/interpreter?



You will need to install Erlang. The minimum version depends on the
features you need, but the latest version is recommended:
http://www.rabbitmq.com/which-erlang.html

This page should answer your other questions and help you to get started
with the Generic Unix installation:
http://www.rabbitmq.com/install-generic-unix.html




-Emile




From videlalvaro at gmail.com  Mon Nov 11 16:03:13 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 11 Nov 2013 17:03:13 +0100
Subject: [rabbitmq-discuss] Downloaded binary distribution (generic
 unix), can't start it...
In-Reply-To: <5280FF3E.1080304@rabbitmq.com>
References: <CAHKDcOQ3Pab6qawB939Dk5D80F+q_zPb-NFKsTwJczFwVR8rgg@mail.gmail.com>
	<5280FF3E.1080304@rabbitmq.com>
Message-ID: <CAMcAHLUXZQmdtxQTY1nbAbdZ65ojQT4o69V3vpUSWzYsgb8p0A@mail.gmail.com>

In case you are on a Mac you can use this version that doesn't require
Erlang: http://www.rabbitmq.com/install-standalone-mac.html


On Mon, Nov 11, 2013 at 5:01 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 11/11/13 14:33, Armen Michaeli wrote:
>
> > I see two errors here - how do i fix the first one? I assume the
> > solution to second one is to install an Erlang compiler/interpreter?
>
>
>
> You will need to install Erlang. The minimum version depends on the
> features you need, but the latest version is recommended:
> http://www.rabbitmq.com/which-erlang.html
>
> This page should answer your other questions and help you to get started
> with the Generic Unix installation:
> http://www.rabbitmq.com/install-generic-unix.html
>
>
>
>
> -Emile
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/28847d8a/attachment.htm>

From mail at dekies.de  Mon Nov 11 16:01:38 2013
From: mail at dekies.de (Dennis Kieselhorst)
Date: Mon, 11 Nov 2013 08:01:38 -0800 (PST)
Subject: [rabbitmq-discuss] Thread naming (java client)
Message-ID: <5be16c8f-5437-49a3-9ca8-5451ebb7fc0b@googlegroups.com>

Hi,

proper thread naming is useful for thread dump analysis. It's possible to 
pass an own ExecutorService to the ConnectionFactory. This way I can 
influence the naming of threads created by the ConsumerWorkService. 

Unfortunately it's not possible to customize the naming for the heartbeats, 
so these threads are named like "pool-20-thread-1".

Could you modify 
com.rabbitmq.client.impl.HeartbeatSender.createExecutorIfNecessary() and 
pass a ThreadFactory with a proper name format (like 
"HeartbeatSenderThread" or something similar)?

Thanks in advance
Dennis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/086aa13f/attachment.htm>

From mikeb at squaremobius.net  Mon Nov 11 16:24:21 2013
From: mikeb at squaremobius.net (Michael Bridgen)
Date: Mon, 11 Nov 2013 16:24:21 +0000
Subject: [rabbitmq-discuss] Erlang client
 rabbit_channel:wait_for_confirms and nacks
In-Reply-To: <5280FB1C.4070305@rabbitmq.com>
References: <CAMZ8XCioPWdGWjY-b7q_4hrWOjnPNmviJW+E80zDakjWpnVppw@mail.gmail.com>
	<5280FB1C.4070305@rabbitmq.com>
Message-ID: <CAMZ8XChWxuwxxom0rSbe6C-v-_mZrGkryB6d5DyJCv4YcZhSAA@mail.gmail.com>

On 11 November 2013 15:43, Simon MacMullen <simon at rabbitmq.com> wrote:
> The expectation is that nacks will be vanishingly rare. To be honest I think
> we never should have added the possibility of sending a nack in confirm
> mode; it can only happen if there is an internal error in the queue. I would
> rather just have the publishing channel die with internal_error at that
> point too.

It makes some sense to have non-fatal nacks if you are relaying; you
can in principle resend or nack upstream. But probably not if the nack
is an indication of something more catastrophic than a message going
astray. (I can imagine it being used for fined-grained flow control,
on some other worldline)

> But if you do want to handle nacks separately you'll need to register a
> confirm handler instead. You could still use wait_for_confirms() to handle
> acks, and then in your confirm handler drop acks and handle nacks.

In the presence of wait_for_confirms_or_die, it seems not only
redundant, but dangerous since it masks errors. Unless you don't care
whether your messages arrive or not, in which case, why use
confirmations ..

> On 11/11/2013 3:25PM, Michael Bridgen wrote:
>>
>> rabbit_channel:wait_for_confirms_or_die/1 and /2 block the process
>> until either all messages sent since the last wait_* call have been
>> acked, or a nack is received in which case exit is called. Is there
>> any way to determine which message or messages were nacked? That might
>> be important.
>>
>> Similarly, rabbit_channel:wait_for_confirms/1 and /2 block the process
>> until acks or nacks for all messages published since the last wait_*
>> was called. I wonder what use are they, if they don't discriminate
>> between acks and nacks?
>>
>> Cheers,
>> Michael
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal

From emile at rabbitmq.com  Mon Nov 11 17:06:19 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 11 Nov 2013 17:06:19 +0000
Subject: [rabbitmq-discuss] C++ Consumer Example into While Loop
In-Reply-To: <1384169761540-31343.post@n5.nabble.com>
References: <1384169761540-31343.post@n5.nabble.com>
Message-ID: <52810E8B.90603@rabbitmq.com>


Hi,

On 11/11/13 11:36, fercascue wrote:

> Could anybody provide me an example of c++ consumer only using a while loop?
> I mean, a while loop to read messages from Rabbitmq server without a
> addEvent function. 

The tools/get.c example that performs a synchronous basic.get using
amqp_basic_get() could be used as a starting point.



-Emile




From jcua at eventbrite.com  Mon Nov 11 18:43:23 2013
From: jcua at eventbrite.com (Jonathan Cua)
Date: Mon, 11 Nov 2013 10:43:23 -0800
Subject: [rabbitmq-discuss] Queue Weird State in RMQ 3.2.1
In-Reply-To: <5280BF00.50709@rabbitmq.com>
References: <5329EC68-CB9A-4DE0-B1E0-AAC0BCBDB166@eventbrite.com>
	<5280BF00.50709@rabbitmq.com>
Message-ID: <CAAG5MPGH=dZSp=Gwb7KpMv1HoMqJSX--5mVNEevVx6nTkEqLbw@mail.gmail.com>

Thanks for the workaround. But do you think this is something that I should
be concerned or is this something that I can safely ignore for now?

Jonathan


On Mon, Nov 11, 2013 at 3:26 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Thanks for the report. Replicated.
>
> As a workaround you can invoke "rabbitmqctl list_queues" - this will wake
> all idle queues up and get them appearing correctly in mgmt again (for
> another hour).
>
> Cheers, Simon
>
>
> On 08/11/2013 5:25PM, Jonathan Cua wrote:
>
>> I am using Rabbitmq 3.2.1 on Ubuntu 12.04. I have a 2-node cluster setup.
>>
>> In the Queues tab, I see this in on one the queue.
>>
>>
>> But when I click on this queue, I would see this.
>>
>>
>> Then when I publish a message to this queue, it would get consumed and
>> everything would go back to 0. There is nothing in the logs or sasl.log
>> about this. So, I am wondering what this is. Also, this issue did not
>> exist in RabbitMQ 2.8.7.
>>
>> I was able to reproduce this issue. It looks like when the queue gets
>> idle (eg. no message is sent/consumed) for exactly 1 hour, it changes
>> from 0 to '?'.
>>
>> Here is how to reproduce this.
>>
>> 1. Create a queue either through the UI or an ampq client (I used the
>> pika python module).
>> 2. Publish one message to the queue.
>> 3. Wait for 1 hour then you will see the message go from 0 to '?'.
>> 4. If you publish another message to this queue, it will go back to 0
>> again.
>>
>>
>> Thanks,
>> Jonathan
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/d4c876c0/attachment.htm>

From maze at reik.se  Mon Nov 11 19:22:57 2013
From: maze at reik.se (Matthias Reik)
Date: Mon, 11 Nov 2013 20:22:57 +0100
Subject: [rabbitmq-discuss] Exchange Feature request: Drop Duplicates
In-Reply-To: <CAKgmDnEWqf=pwN-X=GdLYqRQnAWbsMpwF1s91xBmUH5RynvDyQ@mail.gmail.com>
References: <CAKgmDnEWqf=pwN-X=GdLYqRQnAWbsMpwF1s91xBmUH5RynvDyQ@mail.gmail.com>
Message-ID: <52812E91.2020806@reik.se>

Even though it sounds like a nice feature, it is probably difficult to 
really implement, if not done on the client side. The duplicates might 
happen when delivering to the client side. but on the client side it 
should be quite easy to do the filtering:
* get a message from the queue,
* check against memcached (couchbase, or some other cache technology) 
whether the messageID exists.
* Add the new message to memcached (can be done with the previous step)
* Set the timeout in memcached to your window size.

This should be straight forward, would scale up to quite a lot of 
messages) and should remove (depending on your window size) all duplicates.

Is there a good reason why you wouldn't want to do this on the client 
side as described?

Cheers
Matthias

PS: as a caching technology you could of course do your own 
in-memory-solution but that's probably more work than to use an 
out-of-the-box solution.

On 2013-11-11 12:35 , Laing, Michael wrote:
> In our scenarios, messages are ultimately delivered to a 'retail' 
> rabbitmq instance to be delivered to a client. The pipelines that 
> process and deliver messages are purposefully redundant, hence there 
> may be multiple replicas of each message 'racing' to the endpoint.
>
> Usually, the replicas are resolved before getting to the retail 
> rabbit. When components fail, however, duplicates can leak through 
> during a small window of time. We eliminate those duplicates at the 
> retail layer by looking at each message_id. Ultimately, our client 
> contract allows duplicates as well in case one slips by.
>
> It seems to me that this is a generic issue.
>
> What would be useful in our case, and hopefully for many others, would 
> be a 'Duplicate Message ID Window' in milliseconds, as an exchange 
> attribute.
>
> If non-zero, the exchange would drop any message with a duplicate 
> message_id that appeared within the specified window of time, possibly 
> routing it to the alternate exchange, if set.
>
> In our case, a window of a few seconds, perhaps up to a minute would 
> suffice.
>
> Thanks,
>
> Michael
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/7fd1f05c/attachment.htm>

From michael.laing at nytimes.com  Mon Nov 11 19:28:20 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Mon, 11 Nov 2013 14:28:20 -0500
Subject: [rabbitmq-discuss] Exchange Feature request: Drop Duplicates
In-Reply-To: <52812E91.2020806@reik.se>
References: <CAKgmDnEWqf=pwN-X=GdLYqRQnAWbsMpwF1s91xBmUH5RynvDyQ@mail.gmail.com>
	<52812E91.2020806@reik.se>
Message-ID: <CAKgmDnG2qx6LQa2Sjk8XdtYvQyuop5NZiR3HmdfZsFxwwJfftw@mail.gmail.com>

Yes - that's actually what we do currently, using Cassandra, and it scales
well.

And we also do it in memory, at the retail level, and it is very fast as
well.

I am just trying to shave a millisecond off at the retail level.

Cheers,

Michael


On Mon, Nov 11, 2013 at 2:22 PM, Matthias Reik <maze at reik.se> wrote:

>  Even though it sounds like a nice feature, it is probably difficult to
> really implement, if not done on the client side. The duplicates might
> happen when delivering to the client side. but on the client side it should
> be quite easy to do the filtering:
> * get a message from the queue,
> * check against memcached (couchbase, or some other cache technology)
> whether the messageID exists.
> * Add the new message to memcached (can be done with the previous step)
> * Set the timeout in memcached to your window size.
>
> This should be straight forward, would scale up to quite a lot of
> messages) and should remove (depending on your window size) all duplicates.
>
> Is there a good reason why you wouldn't want to do this on the client side
> as described?
>
> Cheers
> Matthias
>
> PS: as a caching technology you could of course do your own
> in-memory-solution but that's probably more work than to use an
> out-of-the-box solution.
>
>
> On 2013-11-11 12:35 , Laing, Michael wrote:
>
> In our scenarios, messages are ultimately delivered to a 'retail' rabbitmq
> instance to be delivered to a client. The pipelines that process and
> deliver messages are purposefully redundant, hence there may be multiple
> replicas of each message 'racing' to the endpoint.
>
>  Usually, the replicas are resolved before getting to the retail rabbit.
> When components fail, however, duplicates can leak through during a small
> window of time. We eliminate those duplicates at the retail layer by
> looking at each message_id. Ultimately, our client contract allows
> duplicates as well in case one slips by.
>
>  It seems to me that this is a generic issue.
>
>  What would be useful in our case, and hopefully for many others, would
> be a 'Duplicate Message ID Window' in milliseconds, as an exchange
> attribute.
>
>  If non-zero, the exchange would drop any message with a duplicate
> message_id that appeared within the specified window of time, possibly
> routing it to the alternate exchange, if set.
>
>  In our case, a window of a few seconds, perhaps up to a minute would
> suffice.
>
>  Thanks,
>
>  Michael
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing listrabbitmq-discuss at lists.rabbitmq.comhttps://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131111/c04f6cb0/attachment.htm>

From simon at rabbitmq.com  Mon Nov 11 21:38:25 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 11 Nov 2013 21:38:25 +0000
Subject: [rabbitmq-discuss] Queue Weird State in RMQ 3.2.1
In-Reply-To: <CAAG5MPGH=dZSp=Gwb7KpMv1HoMqJSX--5mVNEevVx6nTkEqLbw@mail.gmail.com>
References: <5329EC68-CB9A-4DE0-B1E0-AAC0BCBDB166@eventbrite.com>
	<5280BF00.50709@rabbitmq.com>
	<CAAG5MPGH=dZSp=Gwb7KpMv1HoMqJSX--5mVNEevVx6nTkEqLbw@mail.gmail.com>
Message-ID: <52814E51.6090902@rabbitmq.com>

Oh, you can ignore it, it's entirely cosmetic.

In fact, it only occurs when the number that should be reported is 0 - 
so you could just make a mental note to read '?' as '0'...

Cheers, Simon

On 11/11/2013 18:43, Jonathan Cua wrote:
> Thanks for the workaround. But do you think this is something that I
> should be concerned or is this something that I can safely ignore for now?
>
> Jonathan
>
>
> On Mon, Nov 11, 2013 at 3:26 AM, Simon MacMullen <simon at rabbitmq.com
> <mailto:simon at rabbitmq.com>> wrote:
>
>     Thanks for the report. Replicated.
>
>     As a workaround you can invoke "rabbitmqctl list_queues" - this will
>     wake all idle queues up and get them appearing correctly in mgmt
>     again (for another hour).
>
>     Cheers, Simon
>
>
>     On 08/11/2013 5:25PM, Jonathan Cua wrote:
>
>         I am using Rabbitmq 3.2.1 on Ubuntu 12.04. I have a 2-node
>         cluster setup.
>
>         In the Queues tab, I see this in on one the queue.
>
>
>         But when I click on this queue, I would see this.
>
>
>         Then when I publish a message to this queue, it would get
>         consumed and
>         everything would go back to 0. There is nothing in the logs or
>         sasl.log
>         about this. So, I am wondering what this is. Also, this issue
>         did not
>         exist in RabbitMQ 2.8.7.
>
>         I was able to reproduce this issue. It looks like when the queue
>         gets
>         idle (eg. no message is sent/consumed) for exactly 1 hour, it
>         changes
>         from 0 to '?'.
>
>         Here is how to reproduce this.
>
>         1. Create a queue either through the UI or an ampq client (I
>         used the
>         pika python module).
>         2. Publish one message to the queue.
>         3. Wait for 1 hour then you will see the message go from 0 to '?'.
>         4. If you publish another message to this queue, it will go back
>         to 0 again.
>
>
>         Thanks,
>         Jonathan
>
>
>         _________________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.__rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         https://lists.rabbitmq.com/__cgi-bin/mailman/listinfo/__rabbitmq-discuss
>         <https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss>
>
>
>     --
>     Simon MacMullen
>     RabbitMQ, Pivotal
>
>


From sekhar434145 at gmail.com  Tue Nov 12 08:17:55 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Tue, 12 Nov 2013 13:47:55 +0530
Subject: [rabbitmq-discuss] How to configure reply queue?
In-Reply-To: <CADtU9_stR7a4ctuO-AR5x09nOwkYJvuQUM5zvQ=dJHo=b+CZmA@mail.gmail.com>
References: <CAH75Yb4usdX2RBM2pGRrmH8WNKF0Ov8p=+NfQeyC6BNRTJniGQ@mail.gmail.com>
	<CADtU9_t+3Hb2UTsXk2a5iP362fOrtXHnBTibHSoXr-rz96ReLQ@mail.gmail.com>
	<CAH75Yb7Ff40yF3ZQ0iu3ycUexH0xvhs5=-SZuH28nYhsnmMg1g@mail.gmail.com>
	<CADtU9_stR7a4ctuO-AR5x09nOwkYJvuQUM5zvQ=dJHo=b+CZmA@mail.gmail.com>
Message-ID: <CAH75Yb7thW8NsQAxZ0JE=Vg_C7-ERQW91mKA3d20mK_GTdQB7w@mail.gmail.com>

Hi Russell,

Thanks for the support. I have followed the documentation am getting
response as null. Below is the producer and consumer code.

PRODUCER -

// rabbittemplate
public RabbitTemplate rabbitTemplate() {
RabbitTemplate template = new RabbitTemplate(connectionFactory());
template.setRoutingKey(this.queueName);
template.setQueue(this.queueName);
template.setMessageConverter(new JsonMessageConverter());
return template;
}

String msg = "CUSTOMER1";
Object res = this.rabbitTemplate.convertSendAndReceive(msg);
System.out.println("Message sent :" +msg);
System.out.println("Response : " + res.toString());

CONSUMER -

SimpleMessageListenerContainer container = new
SimpleMessageListenerContainer();
container.setConnectionFactory(this.connectionFactory);
container.setQueueNames(this.queueName);
container.setMessageListener(new *MessageListenerAdapter*(new
TestMessageHandler(this.queueName), new JsonMessageConverter()));
container.start();


       // receive messages
public void handleMessage(String msg) {
System.out.println("Received  :" + msg);
}

*Result - *
Message sent :CUSTOMER1
java.lang.NullPointerException


Here, inside handleMessage based on message I want get the results from DB
and need to send back. Am confusing how set the response to that
client(Producer)?


On Mon, Nov 11, 2013 at 8:57 PM, Gary Russell <grussell at gopivotal.com>wrote:

> Please read the documentation...
> http://docs.spring.io/spring-amqp/reference/html/amqp.html#d4e460
>
> It explains that, when you use a fixed reply queue, and roll your own
> configuration like this, you have to wire up a listener container for the
> replies (with the rabbitTemplate as the listener).
>
> If you use a listener-container on the consumer side (with a
> MessageListenerAdapter), it will automatically send the result to the
> replyTo. Your consumer can be a simple POJO method that returns a list of
> Objects. Use a JsonMessageConverter in the adapter to convert them to JSON.
>
>
>
>
> On Mon, Nov 11, 2013 at 9:56 AM, Rajasekhar P <sekhar434145 at gmail.com>wrote:
>
>> Thank you Russell for the response. Still am stuck with achieving above
>> program, could please tell where am failing while doing above code. Below
>> is the code at producer end.
>>
>>
>>
>> CONFIGURATION -
>>
>> public RabbitTemplate rabbitTemplate() {
>> RabbitTemplate template = new RabbitTemplate(connectionFactory());
>>  template.setRoutingKey(this.queueName);
>> template.setQueue(this.queueName);
>> template.setMessageConverter(new JsonMessageConverter());
>>  return template;
>> }
>>
>> public ConnectionFactory connectionFactory() {
>>  CachingConnectionFactory connectionFactory = new
>> CachingConnectionFactory(
>> "localhost");
>>  connectionFactory.setUsername("guest");
>> connectionFactory.setPassword("guest");
>> return connectionFactory;
>>  }
>>
>>
>> PRODUCER CODE -
>>
>>
>> String corrId = UUID.randomUUID().toString();
>>  String replyQueueName = *channel*.queueDeclare().getQueue();
>>  MessageProperties prop = new MessageProperties();
>>  prop.setCorrelationId(corrId.getBytes());
>> prop.setReplyTo(replyQueueName);
>> Message message = new Message(query.getBytes(), prop);
>>  Message msg = rabbitTemplate.sendAndReceive(message);
>>
>>
>> Is this correct at producer end? Here how to Channel to retrieve
>> reqplyQueueName? Could you please correct me on this and please tell me how
>> to write consumer code to send the result(List of Objects) in JSON format
>> back to that particular request in replyqueue? Thanks in advance.
>>
>>
>> On Fri, Nov 8, 2013 at 7:20 PM, Gary Russell <grussell at gopivotal.com>wrote:
>>
>>> http://docs.spring.io/spring-amqp/reference/html/amqp.html#request-reply
>>>
>>> The simplest is to configure the RabbitTemplate to use a fixed reply
>>> queue, with a reply listener, and use one of it's
>>> convertSendAndReceive(...) (or sendAndReceive) methods; the template will
>>> take care of the correlation.
>>>
>>> If you want to do it asynchronously and do your own correlation (get the
>>> reply asynchronously on another thread) just use one of the send() methods
>>> and wire up a listener container to get the results.
>>>
>>>
>>>
>>> On Fri, Nov 8, 2013 at 12:36 AM, Rajasekhar P <sekhar434145 at gmail.com>wrote:
>>>
>>>> Hi Team,
>>>>
>>>> We are trying to make asynchronous call in RabbitMQ using Spring AMQP,
>>>> could any one please tell me how to configure *replyqueue,
>>>> correlationId, (properties) *using spring amqp?
>>>>
>>>>  String corrId = java.util.UUID.randomUUID().toString();
>>>>  BasicProperties props = new BasicProperties
>>>>                                 .Builder()
>>>>                                 .correlationId(corrId)
>>>>                                 .replyTo(replyQueueName)
>>>>                                 .build();
>>>>
>>>>  channel.basicPublish("", requestQueueName, props, message.getBytes());
>>>>
>>>>
>>>> Thanks in advance.
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-discuss at lists.rabbitmq.com
>>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/bc95591c/attachment.htm>

From fercascue at gmail.com  Tue Nov 12 08:43:01 2013
From: fercascue at gmail.com (fercascue)
Date: Tue, 12 Nov 2013 00:43:01 -0800 (PST)
Subject: [rabbitmq-discuss] C++ Consumer Example into While Loop
In-Reply-To: <52810E8B.90603@rabbitmq.com>
References: <1384169761540-31343.post@n5.nabble.com>
	<52810E8B.90603@rabbitmq.com>
Message-ID: <1384245781285-31368.post@n5.nabble.com>

Thanks Emile!

I will check this file as starting point.
Best Regards



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/C-Consumer-Example-into-While-Loop-tp31343p31368.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From ranganathan.s at gmail.com  Tue Nov 12 09:01:07 2013
From: ranganathan.s at gmail.com (Ranganathan Srinivasan)
Date: Tue, 12 Nov 2013 14:31:07 +0530
Subject: [rabbitmq-discuss] RabbitMQ: Authentication through certificates
Message-ID: <CAEwvUCWy5BA4AAgYWU+0zLDUSs+G=RJE+JnB-maQ1fCRd7mTYw@mail.gmail.com>

Hi,

I have enabled the SASL configuration in rabbitmq.config with auth
mechanism as EXTERNAL and also enabled the plugin
- rabbitmq-auth-mechanism-ssl .

I have the following too in the rabbitmq.config :-

{verify, verify_peer}, {fail_if_no_peer_cert, true}

When I connect a java client, I get the following :-

Exception in thread "main" java.io.IOException: No compatible
authentication mechanism found - server offered [EXTERNAL]
 at com.rabbitmq.client.impl.AMQConnection.start(AMQConnection.java:330)

I use Example2.java form http://www.rabbitmq.com/ssl.html .

Could you give me any pointers on what the problem could be ? I use version
3.1.3.

Regards,
Rang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/709a13a8/attachment.htm>

From mklishin at gopivotal.com  Tue Nov 12 09:09:18 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 12 Nov 2013 13:09:18 +0400
Subject: [rabbitmq-discuss] RabbitMQ: Authentication through certificates
In-Reply-To: <CAEwvUCWy5BA4AAgYWU+0zLDUSs+G=RJE+JnB-maQ1fCRd7mTYw@mail.gmail.com>
References: <CAEwvUCWy5BA4AAgYWU+0zLDUSs+G=RJE+JnB-maQ1fCRd7mTYw@mail.gmail.com>
Message-ID: <09236B20-6FBE-4D11-ACAC-BB191F70764E@rabbitmq.com>

On 12 Nov 2013, at 13:01, Ranganathan Srinivasan <ranganathan.s at gmail.com> wrote:

> Could you give me any pointers on what the problem could be ?

You need to configure ConnectionFactory to use the SASL config you want:

http://www.rabbitmq.com/authentication.html
http://docs.oracle.com/javase/7/docs/api/javax/security/sasl/package-summary.html

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Tue Nov 12 09:41:36 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Nov 2013 09:41:36 +0000
Subject: [rabbitmq-discuss] Thread naming (java client)
In-Reply-To: <5be16c8f-5437-49a3-9ca8-5451ebb7fc0b@googlegroups.com>
References: <5be16c8f-5437-49a3-9ca8-5451ebb7fc0b@googlegroups.com>
Message-ID: <5281F7D0.8080007@rabbitmq.com>

On 11/11/2013 16:01, Dennis Kieselhorst wrote:
> Unfortunately it's not possible to customize the naming for the
> heartbeats, so these threads are named like "pool-20-thread-1".

I've filed a bug for this. Should be easy...

Cheers, Simon


From fercascue at gmail.com  Tue Nov 12 09:45:41 2013
From: fercascue at gmail.com (fercascue)
Date: Tue, 12 Nov 2013 01:45:41 -0800 (PST)
Subject: [rabbitmq-discuss] Strange behaviour in example_get
Message-ID: <1384249541561-31371.post@n5.nabble.com>

Hi,
I'm experimenting a strange behaviour (or not) using this example. I have
the following code:

int main () {
  try {
	  AMQP amqp("password:admin at localhost:5672");
	  AMQPQueue * qu2 = amqp.createQueue("q2");
	  qu2->Declare();
	  while (1) {
	   qu2->Get(AMQP_NOACK);
 	   AMQPMessage * m=qu2->getMessage();
	   cout << "count: "<<  m->getMessageCount() << endl;
	   cout << "message\n"<< m->getMessage() << "\nmessage key: "<< 
m->getRoutingKey() << endl;
	   cout << "exchange: "<<  m->getExchange() << endl;
	   cout << "Content-type: "<< m->getHeader("Content-type") << endl;
	   cout << "Content-encoding: "<< m->getHeader("Content-encoding") << endl;
  }
} catch (AMQPException e) {
   std::cout << e.getMessage() << std::endl;
}

I explain my behaviour:
1.- When I start this consumer, all the messages in queue are consumed.
2.- Now, when a new message arrives (and the consumer is still running), the
consumer "seems" to consume it, but nothing is printed in the output.  I say
"seems" because the queue doesn't keep the message anymore and "seems" to be
consumed.

I dont know if this is the right behaviour in this case. I tried to use
->Consume instead of Get but I get the same result. 

Any ideas about it?
Best Regards.

- Fercascue





--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Strange-behaviour-in-example-get-tp31371.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From simon at rabbitmq.com  Tue Nov 12 09:48:37 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 12 Nov 2013 09:48:37 +0000
Subject: [rabbitmq-discuss] Exchange Feature request: Drop Duplicates
In-Reply-To: <CAKgmDnG2qx6LQa2Sjk8XdtYvQyuop5NZiR3HmdfZsFxwwJfftw@mail.gmail.com>
References: <CAKgmDnEWqf=pwN-X=GdLYqRQnAWbsMpwF1s91xBmUH5RynvDyQ@mail.gmail.com>	<52812E91.2020806@reik.se>
	<CAKgmDnG2qx6LQa2Sjk8XdtYvQyuop5NZiR3HmdfZsFxwwJfftw@mail.gmail.com>
Message-ID: <5281F975.3030107@rabbitmq.com>

The trouble is, exchanges are meant to be stateless. So it's possible to 
introduce some state into an exchange, but we have to choose between 
having per-node state (in which case dedup only works per-node), or 
having cluster-global state (where we either funnel all messages through 
one node in the cluster before they get routed to queues, or distribute 
the state around the cluster, making updates into expensive 2PC).

So this is doable but it's not obvious where compromises should be made. 
And as Matthias sort of pointed out, duplication can still happen due to 
redelivery, so this has to be an optimisation rather than something that 
guarantees duplicates won't happen.

Having said all that, it wouldn't be hideously difficult to implement, 
so I might give it a go. Depends on whether anybody else would find such 
a feature useful...

Cheers, Simon

On 11/11/2013 19:28, Laing, Michael wrote:
> Yes - that's actually what we do currently, using Cassandra, and it
> scales well.
>
> And we also do it in memory, at the retail level, and it is very fast as
> well.
>
> I am just trying to shave a millisecond off at the retail level.
>
> Cheers,
>
> Michael
>
>
> On Mon, Nov 11, 2013 at 2:22 PM, Matthias Reik <maze at reik.se
> <mailto:maze at reik.se>> wrote:
>
>     Even though it sounds like a nice feature, it is probably difficult
>     to really implement, if not done on the client side. The duplicates
>     might happen when delivering to the client side. but on the client
>     side it should be quite easy to do the filtering:
>     * get a message from the queue,
>     * check against memcached (couchbase, or some other cache
>     technology) whether the messageID exists.
>     * Add the new message to memcached (can be done with the previous step)
>     * Set the timeout in memcached to your window size.
>
>     This should be straight forward, would scale up to quite a lot of
>     messages) and should remove (depending on your window size) all
>     duplicates.
>
>     Is there a good reason why you wouldn't want to do this on the
>     client side as described?
>
>     Cheers
>     Matthias
>
>     PS: as a caching technology you could of course do your own
>     in-memory-solution but that's probably more work than to use an
>     out-of-the-box solution.
>
>
>     On 2013-11-11 12:35 , Laing, Michael wrote:
>>     In our scenarios, messages are ultimately delivered to a 'retail'
>>     rabbitmq instance to be delivered to a client. The pipelines that
>>     process and deliver messages are purposefully redundant, hence
>>     there may be multiple replicas of each message 'racing' to the
>>     endpoint.
>>
>>     Usually, the replicas are resolved before getting to the retail
>>     rabbit. When components fail, however, duplicates can leak through
>>     during a small window of time. We eliminate those duplicates at
>>     the retail layer by looking at each message_id. Ultimately, our
>>     client contract allows duplicates as well in case one slips by.
>>
>>     It seems to me that this is a generic issue.
>>
>>     What would be useful in our case, and hopefully for many others,
>>     would be a 'Duplicate Message ID Window' in milliseconds, as an
>>     exchange attribute.
>>
>>     If non-zero, the exchange would drop any message with a duplicate
>>     message_id that appeared within the specified window of time,
>>     possibly routing it to the alternate exchange, if set.
>>
>>     In our case, a window of a few seconds, perhaps up to a minute
>>     would suffice.
>>
>>     Thanks,
>>
>>     Michael
>>
>>
>>
>>     _______________________________________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.rabbitmq.com  <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com
>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From tim at rabbitmq.com  Tue Nov 12 10:00:31 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Tue, 12 Nov 2013 10:00:31 +0000
Subject: [rabbitmq-discuss] SASL authentication HTTP (management console
	/ REST API)
In-Reply-To: <CAEfxVOO5GNDfDusgXhSt5pQ9XSKCCLEegK2dRdwnrpZqJdbzwA@mail.gmail.com>
References: <CAEfxVOO5GNDfDusgXhSt5pQ9XSKCCLEegK2dRdwnrpZqJdbzwA@mail.gmail.com>
Message-ID: <3AFCEA05-ED0F-4676-8B1F-64D4A549E10B@rabbitmq.com>

See http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_1/priv/www/api/index.html, specifically this part:

    "all URIs will serve only resources of type application/json, and will require HTTP basic authentication"

So you've got the TLS layer (i.e., SSL) is using a cert, and that's what the configuration in the rabbitmq_management section is for. Plus, you've also got HTTP (application) layer authentication, which requires basic auth. The cert is only used for fire traffic, not AAA. Hope that makes sense.

Cheers,
Tim

On 10 Nov 2013, at 15:05, Aryan S wrote:

> Hi,
> 
> I am trying to get the HTTP API (REST calls ) and the management console to work without prompting for user name and password.
> 
> 1.) Now first thing I am trying is accessing :- https://10.31.52.204:15672 from my browser ( I have imported the certificates in the browser.)
> 
> I get a prompt to select the certificate and after that it takes me to the username/password page. Can you help me in understanding what I am missing ? Shouldnt' it authenticate based on the client certificate and take me in or fail (since I have fail_if_no_peer_cert, true & verify, verify_peer)
> 
> 2.) Even for the REST API calls , say for example -  https://10.31.52.204:15672/api/users, I still get a prompt for username and password. How do I prevent this ?
> 
> (Basically I am trying the last part in http://www.rabbitmq.com/mochiweb.html)
> 
> The following is my rabbitmq.config file : -
> 
>   {rabbit, [
>     {heartbeat, 30},
>     {auth_mechanisms,     ['EXTERNAL']},
>     {ssl_listeners,       [15671]},
>     {ssl_cert_login_from, common_name},
>     {ssl_options, [{cacertfile, "/home/test/certificates/cert/testca/cacert.pem"},
>                     {certfile, "/home/test/certificates/cert/server/cert.pem"},
>                     {keyfile, "/home/test/certificates/cert/server/key.pem"},
>                     {verify, verify_peer},
>                     {fail_if_no_peer_cert, true}]}
>            ]
>   },
> {rabbitmq_management,
>   [{listener, [{port, 15672},
>                {ssl,  true},
>                {ssl_opts, [{cacertfile, "/home/test/certificates/cert/testca/cacert.pem"},
>                            {certfile,   "/home/test/certificates/cert/server/cert.pem"},
>                            {keyfile,    "/home/test/certificates/cert/server/key.pem"},
>                            {verify, verify_peer},
>                            {fail_if_no_peer_cert, true}]}
>               ]}
>   ]}
> ].
> 
> Regards,
> Aryan
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/17bda1db/attachment.htm>

From michael.laing at nytimes.com  Tue Nov 12 10:54:15 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 12 Nov 2013 05:54:15 -0500
Subject: [rabbitmq-discuss] Exchange Feature request: Drop Duplicates
In-Reply-To: <5281F975.3030107@rabbitmq.com>
References: <CAKgmDnEWqf=pwN-X=GdLYqRQnAWbsMpwF1s91xBmUH5RynvDyQ@mail.gmail.com>
	<52812E91.2020806@reik.se>
	<CAKgmDnG2qx6LQa2Sjk8XdtYvQyuop5NZiR3HmdfZsFxwwJfftw@mail.gmail.com>
	<5281F975.3030107@rabbitmq.com>
Message-ID: <CAKgmDnGJmLzOs6AaKo5dke9OJQ6001ox6h16=6kzmMqQnq_ceg@mail.gmail.com>

Yes I can see the point about statelessness.

It seems to me that in a messaging fabric, it is generally useful to have
ways of dampening duplicates.

It occurred to me this morning that federation uses hop counts - in some
topologies, esp. with planned redundancy, this does not work so well, and
perhaps a feature like this would help.

Michael






On Tue, Nov 12, 2013 at 4:48 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> The trouble is, exchanges are meant to be stateless. So it's possible to
> introduce some state into an exchange, but we have to choose between having
> per-node state (in which case dedup only works per-node), or having
> cluster-global state (where we either funnel all messages through one node
> in the cluster before they get routed to queues, or distribute the state
> around the cluster, making updates into expensive 2PC).
>
> So this is doable but it's not obvious where compromises should be made.
> And as Matthias sort of pointed out, duplication can still happen due to
> redelivery, so this has to be an optimisation rather than something that
> guarantees duplicates won't happen.
>
> Having said all that, it wouldn't be hideously difficult to implement, so
> I might give it a go. Depends on whether anybody else would find such a
> feature useful...
>
> Cheers, Simon
>
>
> On 11/11/2013 19:28, Laing, Michael wrote:
>
>> Yes - that's actually what we do currently, using Cassandra, and it
>> scales well.
>>
>> And we also do it in memory, at the retail level, and it is very fast as
>> well.
>>
>> I am just trying to shave a millisecond off at the retail level.
>>
>> Cheers,
>>
>> Michael
>>
>>
>> On Mon, Nov 11, 2013 at 2:22 PM, Matthias Reik <maze at reik.se
>> <mailto:maze at reik.se>> wrote:
>>
>>     Even though it sounds like a nice feature, it is probably difficult
>>     to really implement, if not done on the client side. The duplicates
>>     might happen when delivering to the client side. but on the client
>>     side it should be quite easy to do the filtering:
>>     * get a message from the queue,
>>     * check against memcached (couchbase, or some other cache
>>     technology) whether the messageID exists.
>>     * Add the new message to memcached (can be done with the previous
>> step)
>>     * Set the timeout in memcached to your window size.
>>
>>     This should be straight forward, would scale up to quite a lot of
>>     messages) and should remove (depending on your window size) all
>>     duplicates.
>>
>>     Is there a good reason why you wouldn't want to do this on the
>>     client side as described?
>>
>>     Cheers
>>     Matthias
>>
>>     PS: as a caching technology you could of course do your own
>>     in-memory-solution but that's probably more work than to use an
>>     out-of-the-box solution.
>>
>>
>>     On 2013-11-11 12:35 , Laing, Michael wrote:
>>
>>>     In our scenarios, messages are ultimately delivered to a 'retail'
>>>     rabbitmq instance to be delivered to a client. The pipelines that
>>>     process and deliver messages are purposefully redundant, hence
>>>     there may be multiple replicas of each message 'racing' to the
>>>     endpoint.
>>>
>>>     Usually, the replicas are resolved before getting to the retail
>>>     rabbit. When components fail, however, duplicates can leak through
>>>     during a small window of time. We eliminate those duplicates at
>>>     the retail layer by looking at each message_id. Ultimately, our
>>>     client contract allows duplicates as well in case one slips by.
>>>
>>>     It seems to me that this is a generic issue.
>>>
>>>     What would be useful in our case, and hopefully for many others,
>>>     would be a 'Duplicate Message ID Window' in milliseconds, as an
>>>     exchange attribute.
>>>
>>>     If non-zero, the exchange would drop any message with a duplicate
>>>     message_id that appeared within the specified window of time,
>>>     possibly routing it to the alternate exchange, if set.
>>>
>>>     In our case, a window of a few seconds, perhaps up to a minute
>>>     would suffice.
>>>
>>>     Thanks,
>>>
>>>     Michael
>>>
>>>
>>>
>>>     _______________________________________________
>>>     rabbitmq-discuss mailing list
>>>     rabbitmq-discuss at lists.rabbitmq.com  <mailto:rabbitmq-discuss@
>>> lists.rabbitmq.com>
>>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>>
>>     _______________________________________________
>>     rabbitmq-discuss mailing list
>>     rabbitmq-discuss at lists.rabbitmq.com
>>     <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>>
>>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/e1335401/attachment.htm>

From spicoflorin at gmail.com  Tue Nov 12 10:51:32 2013
From: spicoflorin at gmail.com (Spico Florin)
Date: Tue, 12 Nov 2013 12:51:32 +0200
Subject: [rabbitmq-discuss] Consume messages sent from Java application in
	web browser
Message-ID: <CAOy42CuOm0XTdry_OMbUEGzq5e_00+y2eqvOetUosn05HQyKqQ@mail.gmail.com>

Hello!
   I would like to build the following scenario:
1. Java client sends a message to a topic (say /topic/methane)
2. A web browser client that subscribed to the topic should receive the
message and displayed.

I have tried the above scenario with the provided  "'echo"' example where
in the provided topic
/topic/test I was sending messages from the Java client. Unfortunately, it
didn't work.
I'm using RabbitMQ 3.1.5 on Windows 7 (64bit).

 Can you please instruct me on how to implement such a scenario?

I look forward for your answers.
  Regards,
 Florin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/d30eed83/attachment.htm>

From mklishin at gopivotal.com  Tue Nov 12 11:16:01 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 12 Nov 2013 15:16:01 +0400
Subject: [rabbitmq-discuss] Consume messages sent from Java application
	in web browser
In-Reply-To: <CAOy42CuOm0XTdry_OMbUEGzq5e_00+y2eqvOetUosn05HQyKqQ@mail.gmail.com>
References: <CAOy42CuOm0XTdry_OMbUEGzq5e_00+y2eqvOetUosn05HQyKqQ@mail.gmail.com>
Message-ID: <65D07541-092B-45E6-9FF0-BA839BAC5466@rabbitmq.com>

On 12 Nov 2013, at 14:51, Spico Florin <spicoflorin at gmail.com> wrote:

> I have tried the above scenario with the provided  "'echo"' example where in the provided topic
> /topic/test I was sending messages from the Java client. Unfortunately, it didn't work.
> I'm using RabbitMQ 3.1.5 on Windows 7 (64bit). 
> 
>  Can you please instruct me on how to implement such a scenario?

Were you using SocksJS, WebSTOMP, JSON-RPC or something else? Can you post your code?

MK

Software Engineer, Pivotal/RabbitMQ



From lijo at citrusinformatics.com  Tue Nov 12 12:43:49 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Tue, 12 Nov 2013 18:13:49 +0530
Subject: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub
Message-ID: <22E9B0E63BB749C5A0E33927450196C7@Lijo>

Hi,
        Please guide me through. 
            I am using RabbitHub plugin for RESTish way of publishing messages.
            Creating and Deleting Exchanges or Queues are working fine. 
            Also able to publish message with http post method to queues subscribed through amqp. 

But how to achieve subscribe with RabbitHub.

I tried the example available with RabbitHub tutorial.  Added my call back  url . Got Error.

What could be the possibilities of the below shown error?

Thanks in Advance!!!

Error : 

Request verification failed: challenge_mismatch* Connection #0 to host rabbitmq
citrus.com left intact
* Closing connection #0


Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/4db4f7e7/attachment.htm>

From grussell at gopivotal.com  Tue Nov 12 13:35:59 2013
From: grussell at gopivotal.com (Gary Russell)
Date: Tue, 12 Nov 2013 08:35:59 -0500
Subject: [rabbitmq-discuss] How to configure reply queue?
In-Reply-To: <CAH75Yb7thW8NsQAxZ0JE=Vg_C7-ERQW91mKA3d20mK_GTdQB7w@mail.gmail.com>
References: <CAH75Yb4usdX2RBM2pGRrmH8WNKF0Ov8p=+NfQeyC6BNRTJniGQ@mail.gmail.com>
	<CADtU9_t+3Hb2UTsXk2a5iP362fOrtXHnBTibHSoXr-rz96ReLQ@mail.gmail.com>
	<CAH75Yb7Ff40yF3ZQ0iu3ycUexH0xvhs5=-SZuH28nYhsnmMg1g@mail.gmail.com>
	<CADtU9_stR7a4ctuO-AR5x09nOwkYJvuQUM5zvQ=dJHo=b+CZmA@mail.gmail.com>
	<CAH75Yb7thW8NsQAxZ0JE=Vg_C7-ERQW91mKA3d20mK_GTdQB7w@mail.gmail.com>
Message-ID: <CADtU9_sVJXKrtPKjo1KVA6mrvH_BXjvSffQsaPx5PzDRX0CXRg@mail.gmail.com>

You need to return a result from your listener pojo

public Object handleMessage(String msg)

or

public List<Object> handleMessage(String msg)

etc.


On Tue, Nov 12, 2013 at 3:17 AM, Rajasekhar P <sekhar434145 at gmail.com>wrote:

> Hi Russell,
>
> Thanks for the support. I have followed the documentation am getting
> response as null. Below is the producer and consumer code.
>
> PRODUCER -
>
> // rabbittemplate
> public RabbitTemplate rabbitTemplate() {
> RabbitTemplate template = new RabbitTemplate(connectionFactory());
>  template.setRoutingKey(this.queueName);
> template.setQueue(this.queueName);
> template.setMessageConverter(new JsonMessageConverter());
>  return template;
> }
>
> String msg = "CUSTOMER1";
> Object res = this.rabbitTemplate.convertSendAndReceive(msg);
> System.out.println("Message sent :" +msg);
> System.out.println("Response : " + res.toString());
>
> CONSUMER -
>
> SimpleMessageListenerContainer container = new
> SimpleMessageListenerContainer();
>  container.setConnectionFactory(this.connectionFactory);
> container.setQueueNames(this.queueName);
> container.setMessageListener(new *MessageListenerAdapter*(new
> TestMessageHandler(this.queueName), new JsonMessageConverter()));
>  container.start();
>
>
>        // receive messages
> public void handleMessage(String msg) {
>  System.out.println("Received  :" + msg);
> }
>
> *Result - *
> Message sent :CUSTOMER1
> java.lang.NullPointerException
>
>
> Here, inside handleMessage based on message I want get the results from DB
> and need to send back. Am confusing how set the response to that
> client(Producer)?
>
>
> <<snip>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/7622ed25/attachment.htm>

From sekhar434145 at gmail.com  Tue Nov 12 16:23:25 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Tue, 12 Nov 2013 21:53:25 +0530
Subject: [rabbitmq-discuss] How to configure reply queue?
In-Reply-To: <CADtU9_sVJXKrtPKjo1KVA6mrvH_BXjvSffQsaPx5PzDRX0CXRg@mail.gmail.com>
References: <CAH75Yb4usdX2RBM2pGRrmH8WNKF0Ov8p=+NfQeyC6BNRTJniGQ@mail.gmail.com>
	<CADtU9_t+3Hb2UTsXk2a5iP362fOrtXHnBTibHSoXr-rz96ReLQ@mail.gmail.com>
	<CAH75Yb7Ff40yF3ZQ0iu3ycUexH0xvhs5=-SZuH28nYhsnmMg1g@mail.gmail.com>
	<CADtU9_stR7a4ctuO-AR5x09nOwkYJvuQUM5zvQ=dJHo=b+CZmA@mail.gmail.com>
	<CAH75Yb7thW8NsQAxZ0JE=Vg_C7-ERQW91mKA3d20mK_GTdQB7w@mail.gmail.com>
	<CADtU9_sVJXKrtPKjo1KVA6mrvH_BXjvSffQsaPx5PzDRX0CXRg@mail.gmail.com>
Message-ID: <CAH75Yb4kA0tn+BCVYNUHhxd7OGNAxLcOE25oDwyy58yuWksvFw@mail.gmail.com>

Hi Russell,

Here is the my listerner POJO , still am getting null response. I didnt do
any reply queue/corrID configuration.

      // receive messages
public Object handleMessage(String query) {
Test test = new Test("Pandit", "Pillai");
return test;
}

Producer -

Test response = (Test)this.rabbitTemplate.convertSendAndReceive(msg);
System.out.println("Response : " + response);

Result -
*Response : null*


Could you please help me . Thanks in advance.


On Tue, Nov 12, 2013 at 7:05 PM, Gary Russell <grussell at gopivotal.com>wrote:

> You need to return a result from your listener pojo
>
> public Object handleMessage(String msg)
>
> or
>
> public List<Object> handleMessage(String msg)
>
> etc.
>
>
> On Tue, Nov 12, 2013 at 3:17 AM, Rajasekhar P <sekhar434145 at gmail.com>wrote:
>
>> Hi Russell,
>>
>> Thanks for the support. I have followed the documentation am getting
>> response as null. Below is the producer and consumer code.
>>
>> PRODUCER -
>>
>> // rabbittemplate
>> public RabbitTemplate rabbitTemplate() {
>> RabbitTemplate template = new RabbitTemplate(connectionFactory());
>>  template.setRoutingKey(this.queueName);
>> template.setQueue(this.queueName);
>> template.setMessageConverter(new JsonMessageConverter());
>>  return template;
>> }
>>
>> String msg = "CUSTOMER1";
>> Object res = this.rabbitTemplate.convertSendAndReceive(msg);
>> System.out.println("Message sent :" +msg);
>> System.out.println("Response : " + res.toString());
>>
>> CONSUMER -
>>
>> SimpleMessageListenerContainer container = new
>> SimpleMessageListenerContainer();
>>  container.setConnectionFactory(this.connectionFactory);
>> container.setQueueNames(this.queueName);
>> container.setMessageListener(new *MessageListenerAdapter*(new
>> TestMessageHandler(this.queueName), new JsonMessageConverter()));
>>  container.start();
>>
>>
>>        // receive messages
>> public void handleMessage(String msg) {
>>  System.out.println("Received  :" + msg);
>> }
>>
>> *Result - *
>> Message sent :CUSTOMER1
>> java.lang.NullPointerException
>>
>>
>> Here, inside handleMessage based on message I want get the results from
>> DB and need to send back. Am confusing how set the response to that
>> client(Producer)?
>>
>>
>> <<snip>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/6647bb9b/attachment.htm>

From demesg at gmail.com  Tue Nov 12 17:01:34 2013
From: demesg at gmail.com (ku3ia)
Date: Tue, 12 Nov 2013 09:01:34 -0800 (PST)
Subject: [rabbitmq-discuss] PRECONDITION_FAILED question
Message-ID: <1384275694237-31381.post@n5.nabble.com>

Hi!
I'm writing unit tests for my C# RabbitMq component over RabbitMq client
library.
My code like this:

public void RemoveExchange(string name)
{
  _channel.ExchangeDelete(name, true);
}

When I'm using it in my units, like

try
{
  RemoveExchange("x-declared-before-exchange-and-binded-to-any-queue");
}
catch (Exception e)
{
  /* here I get:
The AMQP operation was interrupted: AMQP close-reason, initiated by Peer,
code=406, text="PRECONDITION_FAILED - exchange 'exchange-name' in vhost '/'
in use", classId=40, methodId=20, cause=
  */
}

It is ok, because my exchange is in use. But when I tried later to use
_channel.QueueUnbind command I get the same exception.

Please advise, how to avoid this. Thanks.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/PRECONDITION-FAILED-question-tp31381.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From matthias at rabbitmq.com  Tue Nov 12 17:07:57 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 12 Nov 2013 17:07:57 +0000
Subject: [rabbitmq-discuss] Mgmt interface slow with many queues
In-Reply-To: <1383922759412-31305.post@n5.nabble.com>
References: <1383922759412-31305.post@n5.nabble.com>
Message-ID: <5282606D.7050507@rabbitmq.com>

Carl,

On 08/11/13 14:59, carlhoerberg wrote:
> Yes, the queues page takes a very long time to load if you have say 10000
> queues. But what's worse is that even if a user only has the "management"
> role and thus only can see his own queues, the queues-page gets equally slow
> for him as for the one with 10000 queues.

That doesn't sound right, and is not something we have seen in our 
testing. In fact I've just tried it - created 10000 queues and then 
looked at the queues page as an admin and as a user with the 
'management' tag that doesn't have access to the vhost with the queues. 
Page load time for the first: 2.4 seconds, for the second: 62 milliseconds.

Matthias.

From matthias at rabbitmq.com  Tue Nov 12 17:20:20 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Tue, 12 Nov 2013 17:20:20 +0000
Subject: [rabbitmq-discuss] durable queue is down or inaccessible
In-Reply-To: <1384070264658-31329.post@n5.nabble.com>
References: <1384070264658-31329.post@n5.nabble.com>
Message-ID: <52826354.7010406@rabbitmq.com>

On 10/11/13 07:57, carlhoerberg wrote:
> With mirror all queues, but often when nodes crashes we see:
>
> =ERROR REPORT==== 10-Nov-2013::04:40:14 ===
> connection <0.26611.6>, channel 2 - soft error:
> {amqp_error,not_found,
>              "home node 'rabbit at wombat-48510-01' of durable queue
> 'images.processed' in vhost 'nwdwgqag' is down or inaccessible",
>              'queue.declare'}
>
> in the logs. Why doesn't the queues failover properly?

Make sure you are running the latest version of RabbitMQ.

Make 100% sure that the aforementioned queue is in fact mirrored - 
check the policy in management / ctl (when the queue is alive, obviously).

Matthias.

From mklishin at gopivotal.com  Tue Nov 12 17:24:03 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 12 Nov 2013 21:24:03 +0400
Subject: [rabbitmq-discuss] PRECONDITION_FAILED question
In-Reply-To: <1384275694237-31381.post@n5.nabble.com>
References: <1384275694237-31381.post@n5.nabble.com>
Message-ID: <A9F85DAF-24A0-4A9F-B558-95BB5CF21B82@rabbitmq.com>

On 12 Nov 2013, at 21:01, ku3ia <demesg at gmail.com> wrote:

> It is ok, because my exchange is in use. But when I tried later to use
> _channel.QueueUnbind command I get the same exception.

Please post that exception. Also, are you sure that cause is blank? It shouldn?t be.
Please post what?s in RabbitMQ log.

The error means that you are trying to declare an existing entity with attributes different
from those it has.

MK

Software Engineer, Pivotal/RabbitMQ



From demesg at gmail.com  Tue Nov 12 18:11:16 2013
From: demesg at gmail.com (ku3ia)
Date: Tue, 12 Nov 2013 10:11:16 -0800 (PST)
Subject: [rabbitmq-discuss] PRECONDITION_FAILED question
In-Reply-To: <A9F85DAF-24A0-4A9F-B558-95BB5CF21B82@rabbitmq.com>
References: <1384275694237-31381.post@n5.nabble.com>
	<A9F85DAF-24A0-4A9F-B558-95BB5CF21B82@rabbitmq.com>
Message-ID: <1384279876084-31385.post@n5.nabble.com>

Hi, MK! Thanks for your post.
I wrote a code without my library, here is:

    public void TestCode()
    {
      const string exchange = "x-nunit";
      const string key = "key";
      const string queue = "nunit-queue";

      ConnectionFactory factory = new ConnectionFactory {Uri =
"amqp://guest:guest at 127.0.0.1:5672/%2F"};
      IConnection connection = factory.CreateConnection();
      IModel channel = connection.CreateModel();

      channel.ExchangeDeclare(exchange, ExchangeType.Direct);
      channel.QueueDeclare(queue, true, false, false, null);
      channel.QueueBind(queue, exchange, key);

      try
      {
        channel.ExchangeDelete(exchange, true);
      }
      catch (Exception e)
      {
        System.IO.File.AppendAllText(@"F:\error.log", e.Message);
      }

      try
      {
        channel.QueueUnbind(queue, exchange, key, null);
      }
      catch (Exception e)
      {
        System.IO.File.AppendAllText(@"F:\error.log", e.Message);
      }

      channel.Close();
      connection.Close();
    }

F:\error.log:
The AMQP operation was interrupted: AMQP close-reason, initiated by Peer,
code=406, text="PRECONDITION_FAILED - exchange 'x-nunit' in vhost '/' in
use", classId=40, methodId=20, cause=
The AMQP operation was interrupted: AMQP close-reason, initiated by Peer,
code=406, text="PRECONDITION_FAILED - exchange 'x-nunit' in vhost '/' in
use", classId=40, methodId=20, cause=

RabbitMQ log:
=INFO REPORT==== 12-Nov-2013::19:58:26 ===
accepting AMQP connection <0.30470.9> (xxx:9421 -> yyy:5672)

=ERROR REPORT==== 12-Nov-2013::19:58:27 ===
connection <0.30470.9>, channel 1 - soft error:
{amqp_error,precondition_failed,"exchange 'x-nunit' in vhost '/' in use",
            'exchange.delete'}

=INFO REPORT==== 12-Nov-2013::19:58:28 ===
closing AMQP connection <0.30470.9> (xxx:9421 -> yyy:5672)

But when I'm changing 'try/catch' vice-versa everything looks fine.



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/PRECONDITION-FAILED-question-tp31381p31385.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Tue Nov 12 19:06:53 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 12 Nov 2013 23:06:53 +0400
Subject: [rabbitmq-discuss] PRECONDITION_FAILED question
In-Reply-To: <1384279876084-31385.post@n5.nabble.com>
References: <1384275694237-31381.post@n5.nabble.com>
	<A9F85DAF-24A0-4A9F-B558-95BB5CF21B82@rabbitmq.com>
	<1384279876084-31385.post@n5.nabble.com>
Message-ID: <5FB1D926-9B97-402C-8CB8-A9E4C6A00270@rabbitmq.com>


On 12 Nov 2013, at 22:11, ku3ia <demesg at gmail.com> wrote:

> =ERROR REPORT==== 12-Nov-2013::19:58:27 ===
> connection <0.30470.9>, channel 1 - soft error:
> {amqp_error,precondition_failed,"exchange 'x-nunit' in vhost '/' in use",
>            'exchange.delete'}

This means the exchange ?x-nunit? is in use and thus cannot be deleted.

IModel#QueueUnbind simply rethrows the same exception, because after a channel
exception closes the channel (it can no longer be used).

MK

Software Engineer, Pivotal/RabbitMQ



From demesg at gmail.com  Tue Nov 12 20:14:47 2013
From: demesg at gmail.com (ku3ia)
Date: Tue, 12 Nov 2013 12:14:47 -0800 (PST)
Subject: [rabbitmq-discuss] PRECONDITION_FAILED question
In-Reply-To: <5FB1D926-9B97-402C-8CB8-A9E4C6A00270@rabbitmq.com>
References: <1384275694237-31381.post@n5.nabble.com>
	<A9F85DAF-24A0-4A9F-B558-95BB5CF21B82@rabbitmq.com>
	<1384279876084-31385.post@n5.nabble.com>
	<5FB1D926-9B97-402C-8CB8-A9E4C6A00270@rabbitmq.com>
Message-ID: <1384287287910-31387.post@n5.nabble.com>

Ok, I understand. Many thanks, MK!



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/PRECONDITION-FAILED-question-tp31381p31387.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From brett.r.cameron at gmail.com  Tue Nov 12 20:35:47 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Wed, 13 Nov 2013 09:35:47 +1300
Subject: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub
In-Reply-To: <22E9B0E63BB749C5A0E33927450196C7@Lijo>
References: <22E9B0E63BB749C5A0E33927450196C7@Lijo>
Message-ID: <CALPqkioW6TesccMUzWLOCpkcmX_JbrJeEqYUs5tYKutfRrokRw@mail.gmail.com>

Lijo,

The error indicates that your web server at rabbitmq.citrus.com did not
respond correctly to the initial challenge request. When a subscription is
requested, RabbitHub sends a challenge request (HTTP GET) to the specified
URL. The challenge request sends a token and the web server is expected to
respond to the challenge request by sending back the same token in the
response body. Assuming this process completes successfully the
subscription will be activated. Once the subscription has been activated,
RabbitHub will send to the subscription URL any messages matching the
subscription (note that messages are sent using HTTP POST, not GET).

Brett



On Wed, Nov 13, 2013 at 1:43 AM, Lijo Sebastian
<lijo at citrusinformatics.com>wrote:

>   Hi,
>         Please guide me through.
>             I am using RabbitHub plugin for RESTish way of publishing
> messages.
>             Creating and Deleting Exchanges or Queues are working fine.
>             Also able to publish message with http post method to queues
> subscribed through amqp.
>
> But how to achieve subscribe with RabbitHub.
>
> I tried the example available with RabbitHub tutorial.  Added my call
> back  url . Got Error.
>
> What could be the possibilities of the below shown error?
>
> Thanks in Advance!!!
>
> Error :
>
> Request verification failed: challenge_mismatch* Connection #0 to host
> rabbitmq
> citrus.com left intact
> * Closing connection #0
>
>
> Regards,
> Lijo Sebastian
> Senior Software Engineer
> Citrus Informatics (India) Pvt Ltd.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/acfd7ebe/attachment.htm>

From dustink.ml at gmail.com  Tue Nov 12 22:15:42 2013
From: dustink.ml at gmail.com (Dustin)
Date: Tue, 12 Nov 2013 14:15:42 -0800
Subject: [rabbitmq-discuss] Feature Request: Heartbeat for federation
	upstreams
Message-ID: <CAArnGpZ56UNbNsZFZYNacCTRUDdTewFqQcNPxVRjcR90=F5+ug@mail.gmail.com>

Hey All,

Sorry if this already exists somewhere and I'm missing it.  Would it be
possible to be able to specify the heartbeat for federation upstreams?  I
realize that I can set this globally on the server, but I would like to
keep the default server value, and tune down certain upstreams if possible.

Thanks in advance!!

-Dustin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/e0195484/attachment.htm>

From emmet at onekingslane.com  Tue Nov 12 23:30:33 2013
From: emmet at onekingslane.com (Emmet Murphy)
Date: Tue, 12 Nov 2013 15:30:33 -0800
Subject: [rabbitmq-discuss] federation set_policy --apply-to queues
Message-ID: <CAO3Eqe9GEdWvvrHGVMaBGgfqEef=Gwt3TfZQ4_qy_Xb7uoK8ZQ@mail.gmail.com>

The federation plugin documentation says that the set_policy command takes
an apply-to argument that can be "exchanges" or "queues" or "all" (
http://www.rabbitmq.com/parameters.html#policies). But the rabbitmqctl
command line does not include --apply-to in its help documentation and
errors when invoked with that argument. When including "apply-to: queues"
in the HTTP API it has no effect, and the variable does not appear in the
rabbitmqctl list_policies output. Is the documentation incorrect? We are
using version 3.1.5.

Emmet
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/2d16fc62/attachment.htm>

From lijo at citrusinformatics.com  Wed Nov 13 04:29:32 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Wed, 13 Nov 2013 09:59:32 +0530
Subject: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub
In-Reply-To: <CALPqkioW6TesccMUzWLOCpkcmX_JbrJeEqYUs5tYKutfRrokRw@mail.gmail.com>
References: <22E9B0E63BB749C5A0E33927450196C7@Lijo>
	<CALPqkioW6TesccMUzWLOCpkcmX_JbrJeEqYUs5tYKutfRrokRw@mail.gmail.com>
Message-ID: <4D9E5836E5A442279389EA5E93983312@Lijo>

Oh, so can i specify any url as a callback url and satisfy request verification.
any client url that can do verification on this request right?



Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.

From: Brett Cameron 
Sent: Wednesday, November 13, 2013 2:05 AM
To: Discussions about RabbitMQ 
Subject: Re: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub

Lijo,


The error indicates that your web server at rabbitmq.citrus.com did not respond correctly to the initial challenge request. When a subscription is requested, RabbitHub sends a challenge request (HTTP GET) to the specified URL. The challenge request sends a token and the web server is expected to respond to the challenge request by sending back the same token in the response body. Assuming this process completes successfully the subscription will be activated. Once the subscription has been activated, RabbitHub will send to the subscription URL any messages matching the subscription (note that messages are sent using HTTP POST, not GET).


Brett





On Wed, Nov 13, 2013 at 1:43 AM, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

  Hi,
          Please guide me through. 
              I am using RabbitHub plugin for RESTish way of publishing messages.
              Creating and Deleting Exchanges or Queues are working fine. 
              Also able to publish message with http post method to queues subscribed through amqp. 

  But how to achieve subscribe with RabbitHub.

  I tried the example available with RabbitHub tutorial.  Added my call back  url . Got Error.

  What could be the possibilities of the below shown error?

  Thanks in Advance!!!

  Error : 

  Request verification failed: challenge_mismatch* Connection #0 to host rabbitmq
  citrus.com left intact
  * Closing connection #0


  Regards, 
  Lijo Sebastian
  Senior Software Engineer
  Citrus Informatics (India) Pvt Ltd.

  _______________________________________________
  rabbitmq-discuss mailing list
  rabbitmq-discuss at lists.rabbitmq.com
  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss





--------------------------------------------------------------------------------
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/38ef96b2/attachment.htm>

From brett.r.cameron at gmail.com  Wed Nov 13 04:37:17 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Wed, 13 Nov 2013 17:37:17 +1300
Subject: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub
In-Reply-To: <4D9E5836E5A442279389EA5E93983312@Lijo>
References: <22E9B0E63BB749C5A0E33927450196C7@Lijo>
	<CALPqkioW6TesccMUzWLOCpkcmX_JbrJeEqYUs5tYKutfRrokRw@mail.gmail.com>
	<4D9E5836E5A442279389EA5E93983312@Lijo>
Message-ID: <CALPqkirHV3jgRnkvPUgqNyXeZdZuG+PrOqRnn+R0drKHJEPfQQ@mail.gmail.com>

That's correct. As per the documentation you can also specify a duration
for the subscription (after which it will be expired), etc.

Just be sure to note that the initial challenge is a GET; messages are then
forwarded to the URL using POST.
On 13/11/2013 5:31 PM, "Lijo Sebastian" <lijo at citrusinformatics.com> wrote:

>   Oh, so can i specify any url as a callback url and satisfy request
> verification.
> any client url that can do verification on this request right?
>
>
>
> Regards,
> Lijo Sebastian
> Senior Software Engineer
> Citrus Informatics (India) Pvt Ltd.
>
>  *From:* Brett Cameron <brett.r.cameron at gmail.com>
> *Sent:* Wednesday, November 13, 2013 2:05 AM
> *To:* Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> *Subject:* Re: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub
>
>   Lijo,
>
> The error indicates that your web server at rabbitmq.citrus.com did not
> respond correctly to the initial challenge request. When a subscription is
> requested, RabbitHub sends a challenge request (HTTP GET) to the specified
> URL. The challenge request sends a token and the web server is expected to
> respond to the challenge request by sending back the same token in the
> response body. Assuming this process completes successfully the
> subscription will be activated. Once the subscription has been activated,
> RabbitHub will send to the subscription URL any messages matching the
> subscription (note that messages are sent using HTTP POST, not GET).
>
> Brett
>
>
>
> On Wed, Nov 13, 2013 at 1:43 AM, Lijo Sebastian <
> lijo at citrusinformatics.com> wrote:
>
>>   Hi,
>>         Please guide me through.
>>             I am using RabbitHub plugin for RESTish way of publishing
>> messages.
>>             Creating and Deleting Exchanges or Queues are working fine.
>>             Also able to publish message with http post method to queues
>> subscribed through amqp.
>>
>> But how to achieve subscribe with RabbitHub.
>>
>> I tried the example available with RabbitHub tutorial.  Added my call
>> back  url . Got Error.
>>
>> What could be the possibilities of the below shown error?
>>
>> Thanks in Advance!!!
>>
>> Error :
>>
>> Request verification failed: challenge_mismatch* Connection #0 to host
>> rabbitmq
>> citrus.com left intact
>> * Closing connection #0
>>
>>
>> Regards,
>> Lijo Sebastian
>> Senior Software Engineer
>> Citrus Informatics (India) Pvt Ltd.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> ------------------------------
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/87b50cbd/attachment.htm>

From lijo at citrusinformatics.com  Wed Nov 13 05:20:30 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Wed, 13 Nov 2013 10:50:30 +0530
Subject: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub
In-Reply-To: <CALPqkirHV3jgRnkvPUgqNyXeZdZuG+PrOqRnn+R0drKHJEPfQQ@mail.gmail.com>
References: <22E9B0E63BB749C5A0E33927450196C7@Lijo><CALPqkioW6TesccMUzWLOCpkcmX_JbrJeEqYUs5tYKutfRrokRw@mail.gmail.com><4D9E5836E5A442279389EA5E93983312@Lijo>
	<CALPqkirHV3jgRnkvPUgqNyXeZdZuG+PrOqRnn+R0drKHJEPfQQ@mail.gmail.com>
Message-ID: <F055D40FD2884BECA79AD36B023A4F1E@Lijo>

Okai. I got the url with hub.challenge=<token> as a querystring.
How should i return this challenge token back to webserver?


Currently i tried with

// Retrieves challengetoken 
string challenge = request.QueryString["hub.challenge"];

// Converting the text to byteArray
byte[] challengeBuffer = Encoding.UTF8.GetBytes(challenge);

// Writes buffer into the response body.
Response.Body.Write(challengeBuffer, 0, challengeBuffer.Length);

But this is the result i got..

* upload completely sent off: 117 out of 117 bytes
< HTTP/1.1 500 Internal Server Error
< Server: nginx/1.1.19
< Date: Wed, 13 Nov 2013 05:15:09 GMT
< Content-Length: 0
< Connection: keep-alive
<
* Connection #0 to host xxxx.yyyy.com left intact
* Closing connection #0

What could be the possible error here?



Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.

From: Brett Cameron 
Sent: Wednesday, November 13, 2013 10:07 AM
To: rabbitmq-discuss 
Subject: Re: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub

That's correct. As per the documentation you can also specify a duration for the subscription (after which it will be expired), etc.

Just be sure to note that the initial challenge is a GET; messages are then forwarded to the URL using POST.

On 13/11/2013 5:31 PM, "Lijo Sebastian" <lijo at citrusinformatics.com> wrote:

  Oh, so can i specify any url as a callback url and satisfy request verification.
  any client url that can do verification on this request right?



  Regards, 
  Lijo Sebastian
  Senior Software Engineer
  Citrus Informatics (India) Pvt Ltd.

  From: Brett Cameron 
  Sent: Wednesday, November 13, 2013 2:05 AM
  To: Discussions about RabbitMQ 
  Subject: Re: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub

  Lijo,


  The error indicates that your web server at rabbitmq.citrus.com did not respond correctly to the initial challenge request. When a subscription is requested, RabbitHub sends a challenge request (HTTP GET) to the specified URL. The challenge request sends a token and the web server is expected to respond to the challenge request by sending back the same token in the response body. Assuming this process completes successfully the subscription will be activated. Once the subscription has been activated, RabbitHub will send to the subscription URL any messages matching the subscription (note that messages are sent using HTTP POST, not GET).


  Brett





  On Wed, Nov 13, 2013 at 1:43 AM, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

    Hi,
            Please guide me through. 
                I am using RabbitHub plugin for RESTish way of publishing messages.
                Creating and Deleting Exchanges or Queues are working fine. 
                Also able to publish message with http post method to queues subscribed through amqp. 

    But how to achieve subscribe with RabbitHub.

    I tried the example available with RabbitHub tutorial.  Added my call back  url . Got Error.

    What could be the possibilities of the below shown error?

    Thanks in Advance!!!

    Error : 

    Request verification failed: challenge_mismatch* Connection #0 to host rabbitmq
    citrus.com left intact
    * Closing connection #0


    Regards, 
    Lijo Sebastian
    Senior Software Engineer
    Citrus Informatics (India) Pvt Ltd.

    _______________________________________________
    rabbitmq-discuss mailing list
    rabbitmq-discuss at lists.rabbitmq.com
    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss





------------------------------------------------------------------------------
  _______________________________________________
  rabbitmq-discuss mailing list
  rabbitmq-discuss at lists.rabbitmq.com
  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


  _______________________________________________
  rabbitmq-discuss mailing list
  rabbitmq-discuss at lists.rabbitmq.com
  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




--------------------------------------------------------------------------------
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/7928bda2/attachment.htm>

From mark at wolfe.id.au  Tue Nov 12 23:08:41 2013
From: mark at wolfe.id.au (Mark Wolfe)
Date: Tue, 12 Nov 2013 15:08:41 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ MQTT plugin and x509 client certificate
	authentication
Message-ID: <40b9bb60-b64d-4c2f-b9f8-107bf7f96648@googlegroups.com>

Gday all

I am working on a project to use MQTT with RabbitMQ to a bunch of devices 
and I am looking to use x509 client certificate authentication.

I found a note from when the initial cut of the plugin was developed with a 
TODO for this.

My basic requirements are to verify some attributes (configurable matches 
for example OU=blah or O=blah ) in the certificate then extract the Subject 
DN and inject that into the MQTT username field.

Has anyone implemented x509 authentication with the other transports 
available for RabbitMQ? 

Thanks to advice from helpful people on twitter I will probably start with 
a simple tcp server based example to ensure my certificates will work with 
Erlang then take a shot at integrating it into the RabbitMQ MQTT plugin.

If anyone has any tips or links other projects or code which does this sort 
of thing it would be much appreciated.

In addition to client certificate authentication I am also interesting in 
implementing some of the bridge related enhancements currently being 
trailed in mosquitto but that is not high on my agenda at the moment. Note 
I know these are NOT in the standard yet however they are useful.

Thanks.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131112/a2248a29/attachment.htm>

From armen.michaeli at gmail.com  Wed Nov 13 09:03:52 2013
From: armen.michaeli at gmail.com (Armen Michaeli)
Date: Wed, 13 Nov 2013 10:03:52 +0100
Subject: [rabbitmq-discuss] Downloaded binary distribution (generic
 unix), can't start it...
In-Reply-To: <5280FED6.80606@rabbitmq.com>
References: <CAHKDcOQ3Pab6qawB939Dk5D80F+q_zPb-NFKsTwJczFwVR8rgg@mail.gmail.com>
	<5280FED6.80606@rabbitmq.com>
Message-ID: <CAHKDcOTZ+41w9wSLs_51y1h2tMj6mwC4T22Mxsh1tereOqCL2g@mail.gmail.com>

It says in the http://www.rabbitmq.com/install-generic-unix.html:

> You should extract this into somewhere appropriate for application
binaries on your system. The sbin directory will be found in this directory.

P.S. Simon, sorry for replying directly to you and SPAMming your mailbox.
This is now resent to the list.


On Mon, Nov 11, 2013 at 4:59 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 11/11/2013 2:33PM, Armen Michaeli wrote:
>
>> Currently, upon launching rabbitmq-server, it gives me access denied,
>> attempting to write files in most definitely wrong path like:
>> mkdir: cannot create directory ?/usr/local/sbin/../var?: Permission denied
>> /usr/local/sbin/rabbitmq-server: line 80:
>> /usr/local/sbin/../var/lib/rabbitmq/mnesia/rabbit at full-of-stars.pid: No
>> such file or directory
>> /usr/local/sbin/rabbitmq-server: line 85: erl: command not found
>> I see two errors here - how do i fix the first one?
>>
>
> The generic unix distribution is designed to run directly from the
> unpacked tarball. It determines where to put databases and log files
> relative to the launch scripts.
>
> If you want to relocate those things, see http://www.rabbitmq.com/
> relocate.html and http://www.rabbitmq.com/man/rabbitmq-env.conf.5.man.html
>
> I would not suggest you start by unpacking bits of the tarball and moving
> them around though, you're likely to spend quite a while fixing
> file-not-found errors.
>
>
>  I assume the
>> solution to second one is to install an Erlang compiler/interpreter?
>>
>
> Yes.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/fcbff09e/attachment.htm>

From simon at rabbitmq.com  Wed Nov 13 09:28:26 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Nov 2013 09:28:26 +0000
Subject: [rabbitmq-discuss] federation set_policy --apply-to queues
In-Reply-To: <CAO3Eqe9GEdWvvrHGVMaBGgfqEef=Gwt3TfZQ4_qy_Xb7uoK8ZQ@mail.gmail.com>
References: <CAO3Eqe9GEdWvvrHGVMaBGgfqEef=Gwt3TfZQ4_qy_Xb7uoK8ZQ@mail.gmail.com>
Message-ID: <5283463A.7030906@rabbitmq.com>

--apply-to was added in 3.2.0 - as was the ability to federate queues.

You can read the documentation for previous releases at 
http://www.rabbitmq.com/previous.html

Cheers, Simon

On 12/11/2013 23:30, Emmet Murphy wrote:
> The federation plugin documentation says that the set_policy command
> takes an apply-to argument that can be "exchanges" or "queues" or "all"
> (http://www.rabbitmq.com/parameters.html#policies). But the rabbitmqctl
> command line does not include --apply-to in its help documentation and
> errors when invoked with that argument. When including "apply-to:
> queues" in the HTTP API it has no effect, and the variable does not
> appear in the rabbitmqctl list_policies output. Is the documentation
> incorrect? We are using version 3.1.5.
>
> Emmet
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Wed Nov 13 09:30:03 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Nov 2013 09:30:03 +0000
Subject: [rabbitmq-discuss] Feature Request: Heartbeat for federation
 upstreams
In-Reply-To: <CAArnGpZ56UNbNsZFZYNacCTRUDdTewFqQcNPxVRjcR90=F5+ug@mail.gmail.com>
References: <CAArnGpZ56UNbNsZFZYNacCTRUDdTewFqQcNPxVRjcR90=F5+ug@mail.gmail.com>
Message-ID: <5283469B.9010800@rabbitmq.com>

It already does exist :-) You can specify the heartbeat in the URI, 
documented here:

http://www.rabbitmq.com/uri-query-parameters.html

Cheers, Simon

On 12/11/2013 22:15, Dustin wrote:
> Hey All,
>
> Sorry if this already exists somewhere and I'm missing it.  Would it be
> possible to be able to specify the heartbeat for federation upstreams?
>   I realize that I can set this globally on the server, but I would like
> to keep the default server value, and tune down certain upstreams if
> possible.
>
> Thanks in advance!!
>
> -Dustin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From emile at rabbitmq.com  Wed Nov 13 09:58:31 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 13 Nov 2013 09:58:31 +0000
Subject: [rabbitmq-discuss] RabbitMQ MQTT plugin and x509 client
 certificate authentication
In-Reply-To: <40b9bb60-b64d-4c2f-b9f8-107bf7f96648@googlegroups.com>
References: <40b9bb60-b64d-4c2f-b9f8-107bf7f96648@googlegroups.com>
Message-ID: <52834D47.10402@rabbitmq.com>


Hi Mark,

On 12/11/13 23:08, Mark Wolfe wrote:

> I am working on a project to use MQTT with RabbitMQ to a bunch of
> devices and I am looking to use x509 client certificate authentication.


I have filed a ticket for this enhancement. This repository has some
relevance: http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/


> In addition to client certificate authentication I am also interesting
> in implementing some of the bridge related enhancements currently being
> trailed in mosquitto but that is not high on my agenda at the moment.
> Note I know these are NOT in the standard yet however they are useful.

As you say, bridging is not part of the specification. You can use
RabbitMQ federation to obtain equivalent benefits, but using AMQP as the
federation protocol.



-Emile

From Michal.Skorepa at Honeywell.com  Wed Nov 13 10:07:03 2013
From: Michal.Skorepa at Honeywell.com (Skorepa, Michal)
Date: Wed, 13 Nov 2013 10:07:03 +0000
Subject: [rabbitmq-discuss] SSL connection - ASN1 error
In-Reply-To: <BE8B2303-7B48-4EEE-B758-D679EFB8C999@rabbitmq.com>
References: <ABBDC9D7002EB54AB98BA60DA16D269333FF7171@FR44EX3003.global.ds.honeywell.com>
	<524A9911.6040603@rabbitmq.com>
	<ABBDC9D7002EB54AB98BA60DA16D269333FF71E1@FR44EX3003.global.ds.honeywell.com>
	<BE8B2303-7B48-4EEE-B758-D679EFB8C999@rabbitmq.com>
Message-ID: <ABBDC9D7002EB54AB98BA60DA16D26934295B432@FR44EX3003.global.ds.honeywell.com>

Hi Tim,

So the new release did not fix the issue. I am still getting the same error.

What I am trying to do is a broker-to-broker communication. One broker (a "server") is a standard RabbitMQ. The other broker (a "client") is a RabbitMQ running a plugin application, which based on some events connects to the "server" broker using erlang AMQP client. We have been using this concept without SSL for a long time without any problems (several erlang and RabbitMQ versions). We have also tested it with SSL having RabbitMQ 3.1.3 and Erlang R15B01 on the "server" side and RabbitMQ 3.0.4 and Erlang R15B01 on the "client" side. This also worked.
But having the same "server" broker (RabbitMQ 3.1.3 and Erlang 15B01) and using the "client" broker with RabbitMQ 3.2.1 and Erlang 16B01 throws the exception mentioned below when calling amqp_connection:start(Params).
It seems the error came with the Erlang upgrade.

The log files follow..

The relevant lines form the plugin application log:

2013-11-12 14:35:00.168 [debug] <0.309.0>@swim_cm_connector:handle_info:65 Connection parameters: {amqp_params_network,<<"aaa">>,<<"aaa">>,<<"demo">>,{192,168,0,21},5677,0,0,60,infinity,[{cacertfile,"/etc/ssl/swim/swim-ca_cert.pem"},{certfile,"/etc/ssl/swim/cert.pem"},{keyfile,"/etc/ssl/swim/key.pem"},{verify,verify_peer},{fail_if_no_peer_cert,true}],[#Fun<amqp_auth_mechanisms.plain.3>,#Fun<amqp_auth_mechanisms.amqplain.3>],[],[{tos,64}]}.
2013-11-12 14:35:00.171 [debug] <0.316.0> Supervisor {<0.316.0>,amqp_connection_sup} started amqp_gen_connection:start_link(<0.318.0>, {amqp_params_direct,<<"swim">>,none,<<"/">>,rabbit at overoB7,none,[]}) at pid <0.319.0>
2013-11-12 14:35:00.178 [debug] <0.318.0> Supervisor {<0.318.0>,amqp_connection_type_sup} started amqp_channel_sup_sup:start_link(direct, <0.319.0>) at pid <0.321.0>
2013-11-12 14:35:00.185 [debug] <0.320.0> Supervisor {<0.320.0>,amqp_connection_sup} started amqp_connection_type_sup:start_link() at pid <0.322.0>
2013-11-12 14:35:00.187 [debug] <0.318.0> Supervisor {<0.318.0>,amqp_connection_type_sup} started amqp_channels_manager:start_link(<0.319.0>, <0.321.0>) at pid <0.323.0>
2013-11-12 14:35:00.193 [debug] <0.320.0> Supervisor {<0.320.0>,amqp_connection_sup} started amqp_gen_connection:start_link(<0.322.0>, {amqp_params_network,<<"aaa">>,<<"aaa">>,<<"demo">>,{192,168,0,21},5677,0,0,60,infinity,[{cacertfile,...},...],...}) at pid <0.324.0>
2013-11-12 14:35:00.194 [debug] <0.318.0> Supervisor {<0.318.0>,amqp_connection_type_sup} started rabbit_queue_collector:start_link() at pid <0.325.0>
2013-11-12 14:35:00.577 [info] <0.7.0> Application asn1 started on node rabbit at overoB7
2013-11-12 14:35:00.882 [info] <0.7.0> Application webmachine started on node rabbit at overoB7
2013-11-12 14:35:00.926 [debug] <0.358.0> Supervisor crypto_sup started crypto_server:start_link() at pid <0.368.0>
2013-11-12 14:35:00.928 [info] <0.7.0> Application crypto started on node rabbit at overoB7
2013-11-12 14:35:01.037 [info] <0.7.0> Application public_key started on node rabbit at overoB7
2013-11-12 14:35:01.672 [debug] <0.375.0> Supervisor ssl_sup started ssl_manager:start_link([]) at pid <0.376.0>
2013-11-12 14:35:01.722 [debug] <0.375.0> Supervisor ssl_sup started ssl_connection_sup:start_link() at pid <0.377.0>
2013-11-12 14:35:01.724 [info] <0.7.0> Application ssl started on node rabbit at overoB7
2013-11-12 14:35:02.389 [debug] <0.396.0> Supervisor rabbit_mgmt_sup started supervisor2:start_link(mirrored_supervisor, {delegate,{one_for_one,10,10}}) at pid <0.397.0>
2013-11-12 14:35:02.392 [debug] <0.396.0> Supervisor rabbit_mgmt_sup started mirrored_supervisor:start_internal(rabbit_mgmt_sup, [{rabbit_mgmt_db,{rabbit_mgmt_db,start_link,[]},permanent,4294967295,worker,[rabbit_mgmt_db]}]) at pid <0.398.0>
2013-11-12 14:35:02.394 [debug] <0.32.0> Supervisor kernel_safe_sup started pg2_fixed:start_link() at pid <0.399.0>
2013-11-12 14:35:02.421 [info] <0.177.0> Statistics database started.
2013-11-12 14:35:02.472 [error] <0.309.0>@swim_cm_connector:handle_info:84 Exception caught in connection setup for CoS 1.
 Exception: exit
 Reason: {{function_clause,[{amqp_gen_connection,terminate,[{{{badmatch,error},[{tls_connection,dh_master_secret,5,[{file,"tls_connection.erl"},{line,2093}]},{tls_connection,certify,2,[{file,"tls_connection.erl"},{line,544}]},{tls_connection,next_state,4,[{file,"tls_connection.erl"},{line,2537}]},{gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,505}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},{gen_fsm,sync_send_all_state_event,[<0.378.0>,{start,infinity},infinity]}},{<0.322.0>,{amqp_params_network,<<"aaa">>,<<"aaa">>,<<"demo">>,{192,168,0,21},5677,0,0,60,infinity,[{cacertfile,"/etc/ssl/swim/swim-ca_cert.pem"},{certfile,"/etc/ssl/swim/cert.pem"},{keyfile,"/etc/ssl/swim/key.pem"},{verify,verify_peer},{fail_if_no_peer_cert,true}],[#Fun<amqp_auth_mechanisms.plain.3>,#Fun<amqp_auth_mechanisms.amqplain.3>],[],[{tos,64}]}}],[{file,"src/amqp_gen_connection.erl"},{line,229}]},{gen_server,terminate,6,[{file,"gen_server.erl"},{line,719}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},{gen_server,call,[<0.324.0>,connect,infinity]}}

------------------------------

And the "server" broker log:

=INFO REPORT==== 12-Nov-2013::14:34:29 ===
accepting AMQP connection <0.26684.61> (10.10.10.52:41980 -> 192.168.0.21:5677)

=INFO REPORT==== 12-Nov-2013::14:34:30 ===
accepting AMQP connection <0.26688.61> (10.10.10.52:33288 -> 192.168.0.21:5677)

=INFO REPORT==== 12-Nov-2013::14:34:30 ===
accepting AMQP connection <0.26692.61> (10.10.10.52:36058 -> 192.168.0.21:5677)

=INFO REPORT==== 12-Nov-2013::14:34:31 ===
accepting AMQP connection <0.26696.61> (10.10.10.52:33409 -> 192.168.0.21:5677)

=INFO REPORT==== 12-Nov-2013::14:34:31 ===
accepting AMQP connection <0.26700.61> (10.10.10.52:34012 -> 192.168.0.21:5677)

=INFO REPORT==== 12-Nov-2013::14:34:31 ===
accepting AMQP connection <0.26704.61> (10.10.10.52:33157 -> 192.168.0.21:5677)

=ERROR REPORT==== 12-Nov-2013::14:34:39 ===
error on AMQP connection <0.26684.61>: {ssl_upgrade_error,closed} (unknown POSIX error)

=ERROR REPORT==== 12-Nov-2013::14:34:40 ===
error on AMQP connection <0.26688.61>: {ssl_upgrade_error,closed} (unknown POSIX error)

=ERROR REPORT==== 12-Nov-2013::14:34:40 ===
error on AMQP connection <0.26692.61>: {ssl_upgrade_error,closed} (unknown POSIX error)

=ERROR REPORT==== 12-Nov-2013::14:34:41 ===
error on AMQP connection <0.26696.61>: {ssl_upgrade_error,closed} (unknown POSIX error)

=ERROR REPORT==== 12-Nov-2013::14:34:41 ===
error on AMQP connection <0.26700.61>: {ssl_upgrade_error,closed} (unknown POSIX error)

=ERROR REPORT==== 12-Nov-2013::14:34:41 ===
error on AMQP connection <0.26704.61>: {ssl_upgrade_error,closed} (unknown POSIX error)

--------------------------------


Thank you for any ideas!

Cheers,
Michal





-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: 16. ??jna 2013 13:38
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] SSL connection - ASN1 error

Hi Michal,

On 1 Oct 2013, at 13:06, Skorepa, Michal wrote:
> Thank you, Simon. But unfortunately neither of the proposed workarounds worked for me. Both produced the same error:
> 
> {{{{badmatch,error},[{tls_connection,dh_master_secret,5,[{file,"tls_co
> nnection.erl"},{line,2093}]},{tls_connection,certify,2,[{file,"tls_con
> nection.erl"},{line,544}]},{tls_connection,next_state,4,[{file,"tls_co
> nnection.erl"},{line,2537}]},{gen_fsm,handle_msg,7,[{file,"gen_fsm.erl
> "},{line,505}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{li
> ne,239}]}]},{gen_fsm,sync_send_all_state_event,[<0.324.0>,{start,infin
> ity},infinity]}},{gen_server,call,[<0.292.0>,connect,infinity]}}
> 

That looks like a very different error from the one you'd see due to the asn1 application not being started.

> Do you have any other suggestions?
[snip]
>> I am getting an exception in SSL connection establishment by AMQP 
>> Erlang client (used by an application which is running as a RMQ plugin):
> 

Can you explain a bit more about what you're doing here? The stack trace above indicates a failure during cryptographic key generation, which seems odd under the circumstances. Is there any more information available in the logs? In particular, it would be useful to have some more context for the error, e.g., an INFO report from the process in which this crash occured.

> 
> Also, when do you plan to release a new version of AMQP Erlang client?
> 

AFAIK a new release should be imminent. Although we cannot make any guarantees about release timescales, I'd expect to see one either this week or early next.

Cheers,
Tim
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Wed Nov 13 10:43:41 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 13 Nov 2013 10:43:41 +0000
Subject: [rabbitmq-discuss] Strange behaviour in example_get
In-Reply-To: <1384249541561-31371.post@n5.nabble.com>
References: <1384249541561-31371.post@n5.nabble.com>
Message-ID: <528357DD.9030205@rabbitmq.com>

On 12/11/13 09:45, fercascue wrote:

> 	  while (1) {
> 	   qu2->Get(AMQP_NOACK);
>  	   AMQPMessage * m=qu2->getMessage();
> 	   cout << "count: "<<  m->getMessageCount() << endl;
> 	   cout << "message\n"<< m->getMessage() 


The original version of the example had a condition to guard against an
empty queue:

   if (m->getMessageCount() > -1)

That condition is absent from your code which is why it fails.




-Emile





From emile at rabbitmq.com  Wed Nov 13 11:01:33 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 13 Nov 2013 11:01:33 +0000
Subject: [rabbitmq-discuss] Consume messages sent from Java application
 in web browser
In-Reply-To: <CAOy42CuOm0XTdry_OMbUEGzq5e_00+y2eqvOetUosn05HQyKqQ@mail.gmail.com>
References: <CAOy42CuOm0XTdry_OMbUEGzq5e_00+y2eqvOetUosn05HQyKqQ@mail.gmail.com>
Message-ID: <52835C0D.8040207@rabbitmq.com>



Hi,

On 12/11/13 10:51, Spico Florin wrote:

> 2. A web browser client that subscribed to the topic should receive the
> message and displayed.

You will need to make a choice about how the browser connects to the
broker, as per the options suggested by Michael.

> I have tried the above scenario with the provided  "'echo"' example 
> where in the provided topic /topic/test I was sending messages from 
> the Java client. Unfortunately, it didn't work.


Did you see an error message? Which part didn't work and how did it fail?



-Emile




From mark at wolfe.id.au  Wed Nov 13 11:18:44 2013
From: mark at wolfe.id.au (Mark Wolfe)
Date: Wed, 13 Nov 2013 22:18:44 +1100
Subject: [rabbitmq-discuss] RabbitMQ MQTT plugin and x509 client
 certificate authentication
In-Reply-To: <52834D47.10402@rabbitmq.com>
References: <40b9bb60-b64d-4c2f-b9f8-107bf7f96648@googlegroups.com>
	<52834D47.10402@rabbitmq.com>
Message-ID: <CAPwMmOAKgOYgFqjbfm6n2gpNWPrcZdLTGnC+LMsYO5pMYaidFA@mail.gmail.com>

Thanks a lot for the pointers I will take a look at that repo and see what
i can pull together.

On the second point I am actually using AMQP quite a bit between internal
components at the moment, with a view to using the federation plugin in the
future.

That said the bridges I am talking about are from very small gateway
devices on very unreliable wireless networks connected up to 400 ms away
from the central brokers. From what I have observed in the past MQTT is
designed to work more effectively in these sorts of scenarios.

Cheers


On Wed, Nov 13, 2013 at 8:58 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi Mark,
>
> On 12/11/13 23:08, Mark Wolfe wrote:
>
> > I am working on a project to use MQTT with RabbitMQ to a bunch of
> > devices and I am looking to use x509 client certificate authentication.
>
>
> I have filed a ticket for this enhancement. This repository has some
> relevance: http://hg.rabbitmq.com/rabbitmq-auth-mechanism-ssl/
>
>
> > In addition to client certificate authentication I am also interesting
> > in implementing some of the bridge related enhancements currently being
> > trailed in mosquitto but that is not high on my agenda at the moment.
> > Note I know these are NOT in the standard yet however they are useful.
>
> As you say, bridging is not part of the specification. You can use
> RabbitMQ federation to obtain equivalent benefits, but using AMQP as the
> federation protocol.
>
>
>
> -Emile
>



-- 
Regards,

Mark Wolfe

--
I am not young enough to know everything.
--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/2619107b/attachment.htm>

From tim at rabbitmq.com  Wed Nov 13 11:22:26 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 13 Nov 2013 11:22:26 +0000
Subject: [rabbitmq-discuss] SSL connection - ASN1 error
In-Reply-To: <ABBDC9D7002EB54AB98BA60DA16D26934295B432@FR44EX3003.global.ds.honeywell.com>
References: <ABBDC9D7002EB54AB98BA60DA16D269333FF7171@FR44EX3003.global.ds.honeywell.com>
	<524A9911.6040603@rabbitmq.com>
	<ABBDC9D7002EB54AB98BA60DA16D269333FF71E1@FR44EX3003.global.ds.honeywell.com>
	<BE8B2303-7B48-4EEE-B758-D679EFB8C999@rabbitmq.com>
	<ABBDC9D7002EB54AB98BA60DA16D26934295B432@FR44EX3003.global.ds.honeywell.com>
Message-ID: <F0867114-7F45-40BB-AF6A-7A6860D05256@rabbitmq.com>

Hi Michal,

> So the new release did not fix the issue. I am still getting the same error.

The fix Simon and I spoke with you about previously was related to the startup error, which was fixed in 3.2.0 - see http://www.rabbitmq.com/release-notes/README-3.2.0.txt:

"25794 prevent startup error when using SSL on versions of Erlang from R16B01"

These other issues appear to be to do with your SSL setup, and that's hard/impossible to diagnose without more information. If I follow the instructions in www.rabbitmq.com/ssl.html for setting up testing certificates for the client and server, then I can successfully establish and close an SSL connection to the broker using the Erlang client, based on the latest RabbitMQ release and using Erlang R16B02 for both client and server. Can you please test that you can do the same, at which point we'll at least have a baseline to work to whilst trying to identify what the real issue you're running into is.

Cheers,
Tim 

On 13 Nov 2013, at 10:07, Skorepa, Michal wrote:

> Hi Tim,
> 
> So the new release did not fix the issue. I am still getting the same error.
> 
> What I am trying to do is a broker-to-broker communication. One broker (a "server") is a standard RabbitMQ. The other broker (a "client") is a RabbitMQ running a plugin application, which based on some events connects to the "server" broker using erlang AMQP client. We have been using this concept without SSL for a long time without any problems (several erlang and RabbitMQ versions). We have also tested it with SSL having RabbitMQ 3.1.3 and Erlang R15B01 on the "server" side and RabbitMQ 3.0.4 and Erlang R15B01 on the "client" side. This also worked.
> But having the same "server" broker (RabbitMQ 3.1.3 and Erlang 15B01) and using the "client" broker with RabbitMQ 3.2.1 and Erlang 16B01 throws the exception mentioned below when calling amqp_connection:start(Params).
> It seems the error came with the Erlang upgrade.
> 
> The log files follow..
> 
> The relevant lines form the plugin application log:
> 
> 2013-11-12 14:35:00.168 [debug] <0.309.0>@swim_cm_connector:handle_info:65 Connection parameters: {amqp_params_network,<<"aaa">>,<<"aaa">>,<<"demo">>,{192,168,0,21},5677,0,0,60,infinity,[{cacertfile,"/etc/ssl/swim/swim-ca_cert.pem"},{certfile,"/etc/ssl/swim/cert.pem"},{keyfile,"/etc/ssl/swim/key.pem"},{verify,verify_peer},{fail_if_no_peer_cert,true}],[#Fun<amqp_auth_mechanisms.plain.3>,#Fun<amqp_auth_mechanisms.amqplain.3>],[],[{tos,64}]}.
> 2013-11-12 14:35:00.171 [debug] <0.316.0> Supervisor {<0.316.0>,amqp_connection_sup} started amqp_gen_connection:start_link(<0.318.0>, {amqp_params_direct,<<"swim">>,none,<<"/">>,rabbit at overoB7,none,[]}) at pid <0.319.0>
> 2013-11-12 14:35:00.178 [debug] <0.318.0> Supervisor {<0.318.0>,amqp_connection_type_sup} started amqp_channel_sup_sup:start_link(direct, <0.319.0>) at pid <0.321.0>
> 2013-11-12 14:35:00.185 [debug] <0.320.0> Supervisor {<0.320.0>,amqp_connection_sup} started amqp_connection_type_sup:start_link() at pid <0.322.0>
> 2013-11-12 14:35:00.187 [debug] <0.318.0> Supervisor {<0.318.0>,amqp_connection_type_sup} started amqp_channels_manager:start_link(<0.319.0>, <0.321.0>) at pid <0.323.0>
> 2013-11-12 14:35:00.193 [debug] <0.320.0> Supervisor {<0.320.0>,amqp_connection_sup} started amqp_gen_connection:start_link(<0.322.0>, {amqp_params_network,<<"aaa">>,<<"aaa">>,<<"demo">>,{192,168,0,21},5677,0,0,60,infinity,[{cacertfile,...},...],...}) at pid <0.324.0>
> 2013-11-12 14:35:00.194 [debug] <0.318.0> Supervisor {<0.318.0>,amqp_connection_type_sup} started rabbit_queue_collector:start_link() at pid <0.325.0>
> 2013-11-12 14:35:00.577 [info] <0.7.0> Application asn1 started on node rabbit at overoB7
> 2013-11-12 14:35:00.882 [info] <0.7.0> Application webmachine started on node rabbit at overoB7
> 2013-11-12 14:35:00.926 [debug] <0.358.0> Supervisor crypto_sup started crypto_server:start_link() at pid <0.368.0>
> 2013-11-12 14:35:00.928 [info] <0.7.0> Application crypto started on node rabbit at overoB7
> 2013-11-12 14:35:01.037 [info] <0.7.0> Application public_key started on node rabbit at overoB7
> 2013-11-12 14:35:01.672 [debug] <0.375.0> Supervisor ssl_sup started ssl_manager:start_link([]) at pid <0.376.0>
> 2013-11-12 14:35:01.722 [debug] <0.375.0> Supervisor ssl_sup started ssl_connection_sup:start_link() at pid <0.377.0>
> 2013-11-12 14:35:01.724 [info] <0.7.0> Application ssl started on node rabbit at overoB7
> 2013-11-12 14:35:02.389 [debug] <0.396.0> Supervisor rabbit_mgmt_sup started supervisor2:start_link(mirrored_supervisor, {delegate,{one_for_one,10,10}}) at pid <0.397.0>
> 2013-11-12 14:35:02.392 [debug] <0.396.0> Supervisor rabbit_mgmt_sup started mirrored_supervisor:start_internal(rabbit_mgmt_sup, [{rabbit_mgmt_db,{rabbit_mgmt_db,start_link,[]},permanent,4294967295,worker,[rabbit_mgmt_db]}]) at pid <0.398.0>
> 2013-11-12 14:35:02.394 [debug] <0.32.0> Supervisor kernel_safe_sup started pg2_fixed:start_link() at pid <0.399.0>
> 2013-11-12 14:35:02.421 [info] <0.177.0> Statistics database started.
> 2013-11-12 14:35:02.472 [error] <0.309.0>@swim_cm_connector:handle_info:84 Exception caught in connection setup for CoS 1.
> Exception: exit
> Reason: {{function_clause,[{amqp_gen_connection,terminate,[{{{badmatch,error},[{tls_connection,dh_master_secret,5,[{file,"tls_connection.erl"},{line,2093}]},{tls_connection,certify,2,[{file,"tls_connection.erl"},{line,544}]},{tls_connection,next_state,4,[{file,"tls_connection.erl"},{line,2537}]},{gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,505}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},{gen_fsm,sync_send_all_state_event,[<0.378.0>,{start,infinity},infinity]}},{<0.322.0>,{amqp_params_network,<<"aaa">>,<<"aaa">>,<<"demo">>,{192,168,0,21},5677,0,0,60,infinity,[{cacertfile,"/etc/ssl/swim/swim-ca_cert.pem"},{certfile,"/etc/ssl/swim/cert.pem"},{keyfile,"/etc/ssl/swim/key.pem"},{verify,verify_peer},{fail_if_no_peer_cert,true}],[#Fun<amqp_auth_mechanisms.plain.3>,#Fun<amqp_auth_mechanisms.amqplain.3>],[],[{tos,64}]}}],[{file,"src/amqp_gen_connection.erl"},{line,229}]},{gen_server,terminate,6,[{file,"gen_server.erl"},{line,719}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},{gen_server,call,[<0.324.0>,connect,infinity]}}
> 
> ------------------------------
> 
> And the "server" broker log:
> 
> =INFO REPORT==== 12-Nov-2013::14:34:29 ===
> accepting AMQP connection <0.26684.61> (10.10.10.52:41980 -> 192.168.0.21:5677)
> 
> =INFO REPORT==== 12-Nov-2013::14:34:30 ===
> accepting AMQP connection <0.26688.61> (10.10.10.52:33288 -> 192.168.0.21:5677)
> 
> =INFO REPORT==== 12-Nov-2013::14:34:30 ===
> accepting AMQP connection <0.26692.61> (10.10.10.52:36058 -> 192.168.0.21:5677)
> 
> =INFO REPORT==== 12-Nov-2013::14:34:31 ===
> accepting AMQP connection <0.26696.61> (10.10.10.52:33409 -> 192.168.0.21:5677)
> 
> =INFO REPORT==== 12-Nov-2013::14:34:31 ===
> accepting AMQP connection <0.26700.61> (10.10.10.52:34012 -> 192.168.0.21:5677)
> 
> =INFO REPORT==== 12-Nov-2013::14:34:31 ===
> accepting AMQP connection <0.26704.61> (10.10.10.52:33157 -> 192.168.0.21:5677)
> 
> =ERROR REPORT==== 12-Nov-2013::14:34:39 ===
> error on AMQP connection <0.26684.61>: {ssl_upgrade_error,closed} (unknown POSIX error)
> 
> =ERROR REPORT==== 12-Nov-2013::14:34:40 ===
> error on AMQP connection <0.26688.61>: {ssl_upgrade_error,closed} (unknown POSIX error)
> 
> =ERROR REPORT==== 12-Nov-2013::14:34:40 ===
> error on AMQP connection <0.26692.61>: {ssl_upgrade_error,closed} (unknown POSIX error)
> 
> =ERROR REPORT==== 12-Nov-2013::14:34:41 ===
> error on AMQP connection <0.26696.61>: {ssl_upgrade_error,closed} (unknown POSIX error)
> 
> =ERROR REPORT==== 12-Nov-2013::14:34:41 ===
> error on AMQP connection <0.26700.61>: {ssl_upgrade_error,closed} (unknown POSIX error)
> 
> =ERROR REPORT==== 12-Nov-2013::14:34:41 ===
> error on AMQP connection <0.26704.61>: {ssl_upgrade_error,closed} (unknown POSIX error)
> 
> --------------------------------
> 
> 
> Thank you for any ideas!
> 
> Cheers,
> Michal
> 
> 
> 
> 
> 
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
> Sent: 16. ??jna 2013 13:38
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] SSL connection - ASN1 error
> 
> Hi Michal,
> 
> On 1 Oct 2013, at 13:06, Skorepa, Michal wrote:
>> Thank you, Simon. But unfortunately neither of the proposed workarounds worked for me. Both produced the same error:
>> 
>> {{{{badmatch,error},[{tls_connection,dh_master_secret,5,[{file,"tls_co
>> nnection.erl"},{line,2093}]},{tls_connection,certify,2,[{file,"tls_con
>> nection.erl"},{line,544}]},{tls_connection,next_state,4,[{file,"tls_co
>> nnection.erl"},{line,2537}]},{gen_fsm,handle_msg,7,[{file,"gen_fsm.erl
>> "},{line,505}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{li
>> ne,239}]}]},{gen_fsm,sync_send_all_state_event,[<0.324.0>,{start,infin
>> ity},infinity]}},{gen_server,call,[<0.292.0>,connect,infinity]}}
>> 
> 
> That looks like a very different error from the one you'd see due to the asn1 application not being started.
> 
>> Do you have any other suggestions?
> [snip]
>>> I am getting an exception in SSL connection establishment by AMQP 
>>> Erlang client (used by an application which is running as a RMQ plugin):
>> 
> 
> Can you explain a bit more about what you're doing here? The stack trace above indicates a failure during cryptographic key generation, which seems odd under the circumstances. Is there any more information available in the logs? In particular, it would be useful to have some more context for the error, e.g., an INFO report from the process in which this crash occured.
> 
>> 
>> Also, when do you plan to release a new version of AMQP Erlang client?
>> 
> 
> AFAIK a new release should be imminent. Although we cannot make any guarantees about release timescales, I'd expect to see one either this week or early next.
> 
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From fercascue at gmail.com  Wed Nov 13 11:37:06 2013
From: fercascue at gmail.com (fercascue)
Date: Wed, 13 Nov 2013 03:37:06 -0800 (PST)
Subject: [rabbitmq-discuss] Strange behaviour in example_get
In-Reply-To: <528357DD.9030205@rabbitmq.com>
References: <1384249541561-31371.post@n5.nabble.com>
	<528357DD.9030205@rabbitmq.com>
Message-ID: <1384342626092-31404.post@n5.nabble.com>

Dear Emile,
First of all thanks for your reply. 
You are right! I deleted this condition because of when the message count is
< -1 the break statement finish the program. 
By the way, if all of messages are consumed by the cliente, when the count
hits -1, the program finish and if another message arrives to queue, my
client don't consume it.

I want the client keeps running and waiting for incoming messages even when
the queue is empy.

Thanks in advance.
Best regards  



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Strange-behaviour-in-example-get-tp31371p31404.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From lijo at citrusinformatics.com  Wed Nov 13 11:46:13 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Wed, 13 Nov 2013 17:16:13 +0530
Subject: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub
In-Reply-To: <CALPqkiqwD7wPenEopiLoaucpMKZAcd56QFs0K_df_zk6rCbCkA@mail.gmail.com>
References: <22E9B0E63BB749C5A0E33927450196C7@Lijo><CALPqkioW6TesccMUzWLOCpkcmX_JbrJeEqYUs5tYKutfRrokRw@mail.gmail.com><4D9E5836E5A442279389EA5E93983312@Lijo><CALPqkirHV3jgRnkvPUgqNyXeZdZuG+PrOqRnn+R0drKHJEPfQQ@mail.gmail.com><F055D40FD2884BECA79AD36B023A4F1E@Lijo><CALPqkir=srkBkrBgBVc4E_9dC_hoJyoAUo9w4f7TvKd7XP6A5A@mail.gmail.com><73D406862832471AB53C9BBE84555493@Lijo>
	<CALPqkiqwD7wPenEopiLoaucpMKZAcd56QFs0K_df_zk6rCbCkA@mail.gmail.com>
Message-ID: <3470F6D0EFD14CB1AE230C22DD5477CE@Lijo>

See the Info report and Crash report below:


=INFO REPORT==== 13-Nov-2013::16:34:26 ===
RabbitHub register subscription (startup); ok
rabbithub_pseudo_queue
{rabbithub_lease,
{rabbithub_subscription,
{resource,<<"/">>,exchange,<<"junk">>},
"foo","http://192.168.1.37:8086/hubsub"},
1384427066480905}
=CRASH REPORT==== 13-Nov-2013::16:34:26 ===
crasher:
initial call: rabbithub_pseudo_queue:init/1
pid: <0.15753.0>
registered_name: []
exception exit: {{badmatch,
{amqqueue,
{resource,<<"/">>,queue,
<<"amq.http.pseudoqueue-Xbp6m5myR_Z21g8Igw-AdA">>},
false,false,none,[],<0.15753.0>,[],undefined,
undefined,undefined,[]}},
[{rabbithub_pseudo_queue,really_init,1,
[{file,"src/rabbithub_pseudo_queue.erl"},{line,28}]},
{gen_server,init_it,6,
[{file,"gen_server.erl"},{line,304}]},
{proc_lib,init_p_do_apply,3,
[{file,"proc_lib.erl"},{line,239}]}]}
in function gen_server:init_it/6 (gen_server.erl, line 328)
ancestors: [rabbithub_subscription_sup,rabbithub_sup,<0.252.0>]
messages: []
links: [<0.265.0>]
dictionary: [{{xtype_to_module,direct},rabbit_exchange_type_direct},
{guid,{{1572502171,2578597878,1993740040,2198831220},0}}]
trap_exit: true
status: running
heap_size: 987
stack_size: 27
reductions: 624
neighbours:


Any guess?


Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.

From: Brett Cameron 
Sent: Wednesday, November 13, 2013 11:40 AM
To: Lijo Sebastian 
Subject: Re: Fwd: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub

The response to the challenge request needs to go back to RabbitHub, which is what you appear to be doing; there should be something in the RabbitMQ log that provides more information as to why this is failing. Possibly your UTF-8 encoding is changing the value, so the sent and received tokens do not match, although an HTTP 500 tends too imply something a bit more serious... possibly the 3.1.5 version of the plugin is not 100% compatible with RabbitMQ 3.2.1... but anything liek this will be evident from the RabbitMQ log.


For my testing I just tend to use the following trivial piece of Ruby Sinatra code, which starts up a web server on port 4567. As you can see, the GET just responds by sending back the challenge token. The POST method just displays the received message and will return an empty response body.

require 'sinatra'

get '/sub2' do
   puts "Received #{params}"
   puts "Responding to challenge request..."
   params[:"hub.challenge"]
end

post '/sub2' do
   puts "Received message: #{params} "
end






On Wed, Nov 13, 2013 at 7:00 PM, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

  Yeah Brett, i received the token with ?hub.challenge? parameter.

  But issue here is i think, i need to send response to my server, right? 

  As now i am trying subscribe part in command prompt with  curl commands, and my c# application listening for a callback url,  how could i send a response to server from the listening localhost is the issue here i think!


  Regards, 
  Lijo Sebastian
  Senior Software Engineer
  Citrus Informatics (India) Pvt Ltd.

  From: Brett Cameron 
  Sent: Wednesday, November 13, 2013 11:19 AM
  To: Lijo Sebastian 
  Subject: Fwd: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub

  I probably would have just returned it as a string without doing the UTF-8 encoding, but the the HTTP 500 error is interesting. Check the RabbitMQ log for additional information.


  Additionally, can you confirm that your C# code received the token?


  ---------- Forwarded message ----------
  From: Lijo Sebastian <lijo at citrusinformatics.com>
  Date: Wed, Nov 13, 2013 at 6:20 PM
  Subject: Re: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub
  To: Discussions about RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>



  Okai. I got the url with hub.challenge=<token> as a querystring.
  How should i return this challenge token back to webserver?


  Currently i tried with

  // Retrieves challengetoken 
  string challenge = request.QueryString["hub.challenge"];

  // Converting the text to byteArray
  byte[] challengeBuffer = Encoding.UTF8.GetBytes(challenge);

  // Writes buffer into the response body.
  Response.Body.Write(challengeBuffer, 0, challengeBuffer.Length);

  But this is the result i got..

  * upload completely sent off: 117 out of 117 bytes
  < HTTP/1.1 500 Internal Server Error
  < Server: nginx/1.1.19
  < Date: Wed, 13 Nov 2013 05:15:09 GMT
  < Content-Length: 0
  < Connection: keep-alive
  <
  * Connection #0 to host xxxx.yyyy.com left intact
  * Closing connection #0

  What could be the possible error here?



  Regards, 
  Lijo Sebastian
  Senior Software Engineer
  Citrus Informatics (India) Pvt Ltd.

  From: Brett Cameron 
  Sent: Wednesday, November 13, 2013 10:07 AM
  To: rabbitmq-discuss 
  Subject: Re: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub

  That's correct. As per the documentation you can also specify a duration for the subscription (after which it will be expired), etc.

  Just be sure to note that the initial challenge is a GET; messages are then forwarded to the URL using POST.

  On 13/11/2013 5:31 PM, "Lijo Sebastian" <lijo at citrusinformatics.com> wrote:

    Oh, so can i specify any url as a callback url and satisfy request verification.
    any client url that can do verification on this request right?



    Regards, 
    Lijo Sebastian
    Senior Software Engineer
    Citrus Informatics (India) Pvt Ltd.

    From: Brett Cameron 
    Sent: Wednesday, November 13, 2013 2:05 AM
    To: Discussions about RabbitMQ 
    Subject: Re: [rabbitmq-discuss] Subscribing an Exchange with RabbitHub

    Lijo,


    The error indicates that your web server at rabbitmq.citrus.com did not respond correctly to the initial challenge request. When a subscription is requested, RabbitHub sends a challenge request (HTTP GET) to the specified URL. The challenge request sends a token and the web server is expected to respond to the challenge request by sending back the same token in the response body. Assuming this process completes successfully the subscription will be activated. Once the subscription has been activated, RabbitHub will send to the subscription URL any messages matching the subscription (note that messages are sent using HTTP POST, not GET).


    Brett





    On Wed, Nov 13, 2013 at 1:43 AM, Lijo Sebastian <lijo at citrusinformatics.com> wrote:

      Hi,
              Please guide me through. 
                  I am using RabbitHub plugin for RESTish way of publishing messages.
                  Creating and Deleting Exchanges or Queues are working fine. 
                  Also able to publish message with http post method to queues subscribed through amqp. 

      But how to achieve subscribe with RabbitHub.

      I tried the example available with RabbitHub tutorial.  Added my call back  url . Got Error.

      What could be the possibilities of the below shown error?

      Thanks in Advance!!!

      Error : 

      Request verification failed: challenge_mismatch* Connection #0 to host rabbitmq
      citrus.com left intact
      * Closing connection #0


      Regards, 
      Lijo Sebastian
      Senior Software Engineer
      Citrus Informatics (India) Pvt Ltd.

      _______________________________________________
      rabbitmq-discuss mailing list
      rabbitmq-discuss at lists.rabbitmq.com
      https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




----------------------------------------------------------------------------
    _______________________________________________
    rabbitmq-discuss mailing list
    rabbitmq-discuss at lists.rabbitmq.com
    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


    _______________________________________________
    rabbitmq-discuss mailing list
    rabbitmq-discuss at lists.rabbitmq.com
    https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



------------------------------------------------------------------------------
  _______________________________________________
  rabbitmq-discuss mailing list
  rabbitmq-discuss at lists.rabbitmq.com
  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


  _______________________________________________
  rabbitmq-discuss mailing list
  rabbitmq-discuss at lists.rabbitmq.com
  https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/78633487/attachment.htm>

From emile at rabbitmq.com  Wed Nov 13 11:48:43 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 13 Nov 2013 11:48:43 +0000
Subject: [rabbitmq-discuss] Strange behaviour in example_get
In-Reply-To: <1384342626092-31404.post@n5.nabble.com>
References: <1384249541561-31371.post@n5.nabble.com>
	<528357DD.9030205@rabbitmq.com>
	<1384342626092-31404.post@n5.nabble.com>
Message-ID: <5283671B.7000209@rabbitmq.com>


Hi,

On 13/11/13 11:37, fercascue wrote:

> I want the client keeps running and waiting for incoming messages even when
> the queue is empy.

Treating an empty queue as if it contained messages will not achieve
that effect. Consider consuming messages asynchronously or polling with
a pause when the queue is empty.



-Emile




From tim at rabbitmq.com  Wed Nov 13 11:54:33 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 13 Nov 2013 11:54:33 +0000
Subject: [rabbitmq-discuss] [Feature Request/Patch] Regular expression
	support in management UI filter
In-Reply-To: <CA+5po3dVCNxLMA8KpeF-zZJVq2fttrNtR939R1Mbj3R=uHE6dA@mail.gmail.com>
References: <CA+5po3dVCNxLMA8KpeF-zZJVq2fttrNtR939R1Mbj3R=uHE6dA@mail.gmail.com>
Message-ID: <2A10FF48-D051-4E14-95BF-2A8AA177999C@rabbitmq.com>

Hi Joseph!

First of all, thanks for that patch and sorry for the delayed response - your post seems to have slipped between the proverbial cracks. I haven't actually looked at the changes you've made, but in order to include any community contribution, we need you to sign a contributor agreement. If that's something you're willing to do, then I'll forward you a copy offline. Once signed, we can take a look at integrating your patch.

Kind regards,
Tim

On 8 Nov 2013, at 16:39, Joseph Weeks wrote:

> Hello,
>  
> I tried to find this already answered on the mailing list but did not.
> 
> Our production support guys have made heavy use of the filter in the management UI and I'd like to request that regular expression support be added.
>  
> I took a stab at implementing it (with a checkbox to enable).  If it's useful as a patch or reference (and not redundant to other efforts), please feel free to use it.
>  
> patch:
> https://github.com/joew/rabbitmq-management/commit/e624845a0252c0a5d731475222c66f325a1bc7ff.patch
>  
> screenshots:
> https://dl.dropboxusercontent.com/s/6kg5satyhmu7y3j/rabbitmq_mgmt_regex_all_queues.png
> https://dl.dropboxusercontent.com/s/71yjnr8qhd0icjj/rabbitmq_mgmt_regex_prioritized.png
> https://dl.dropboxusercontent.com/sh/rpfkbpwktk30rbv/iPboki7KLF/rabbitmq_mgmt_regex_2_groups.png
> https://dl.dropboxusercontent.com/s/1ftg4p1n07fv7y3/rabbitmq_mgmt_regex_all_groups.png
>  
> Thanks again for a great product.  We?re looking forward to upgrading to 3.2.x.
>  
> Joe
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/233d7c1b/attachment.htm>

From kjnilsson at gmail.com  Wed Nov 13 11:55:17 2013
From: kjnilsson at gmail.com (Karl Nilsson)
Date: Wed, 13 Nov 2013 11:55:17 +0000
Subject: [rabbitmq-discuss] Delivery / Redelivery counter plugin
Message-ID: <CAHC35TCW18TK601HZyJPhQScWxNMHij_LZUFJbZV0bvR-Xrgiw@mail.gmail.com>

Hi,

(I originally posted this to rabbitmq-discuss at googlegroups but it apperas
not to have replicated to the 'proper' list so apologies for any
duplication of this message)

Would it be possible to write a rabbitmq plugin to intercept delivery to a
queue to add/increment a delivery counter header value? I can't see an
appropriate behaviour to implement in the source but my understanding of
the rabbitmq code base isn't good enough to properly see what can and can't
be done.

After spending a fair bit of time thinking about a generic poison message
strategy it feels a broker based counter (rather than the existing
redelivered flag) would be the most appropriate for the kind of system we
are currently writing (integrations / dirty data) and if we could at least
get some kind of delivery counter working (100% would not be required) we
could handle rejection strategies better at the consumer.

I know there is a planned feature for this (basic / deliver / 01) but I
checked with Alvaro who has confirmed it isn't a priority at this time so
we could do with some kind of half-way house in the meantime.

I'd appreciate any suggestions / advice you may have on this topic.

Many thanks
Karl

-- 
*Karl Nilsson*
twitter: @kjnilsson
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/fe6dabd9/attachment.htm>

From tim at rabbitmq.com  Wed Nov 13 11:56:07 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 13 Nov 2013 11:56:07 +0000
Subject: [rabbitmq-discuss] [Feature Request/Patch] Regular expression
	support in management UI filter
In-Reply-To: <2A10FF48-D051-4E14-95BF-2A8AA177999C@rabbitmq.com>
References: <CA+5po3dVCNxLMA8KpeF-zZJVq2fttrNtR939R1Mbj3R=uHE6dA@mail.gmail.com>
	<2A10FF48-D051-4E14-95BF-2A8AA177999C@rabbitmq.com>
Message-ID: <6B0524E0-81BB-4640-90AE-D72A041E8DA5@rabbitmq.com>

Whoa - scratch that, I see that you've already signed one! I should've cleared my inbox before sending that - sorry for the confusion!!!

Cheers,
Tim

On 13 Nov 2013, at 11:54, Tim Watson wrote:

> Hi Joseph!
> 
> First of all, thanks for that patch and sorry for the delayed response - your post seems to have slipped between the proverbial cracks. I haven't actually looked at the changes you've made, but in order to include any community contribution, we need you to sign a contributor agreement. If that's something you're willing to do, then I'll forward you a copy offline. Once signed, we can take a look at integrating your patch.
> 
> Kind regards,
> Tim
> 
> On 8 Nov 2013, at 16:39, Joseph Weeks wrote:
> 
>> Hello,
>>  
>> I tried to find this already answered on the mailing list but did not.
>> 
>> Our production support guys have made heavy use of the filter in the management UI and I'd like to request that regular expression support be added.
>>  
>> I took a stab at implementing it (with a checkbox to enable).  If it's useful as a patch or reference (and not redundant to other efforts), please feel free to use it.
>>  
>> patch:
>> https://github.com/joew/rabbitmq-management/commit/e624845a0252c0a5d731475222c66f325a1bc7ff.patch
>>  
>> screenshots:
>> https://dl.dropboxusercontent.com/s/6kg5satyhmu7y3j/rabbitmq_mgmt_regex_all_queues.png
>> https://dl.dropboxusercontent.com/s/71yjnr8qhd0icjj/rabbitmq_mgmt_regex_prioritized.png
>> https://dl.dropboxusercontent.com/sh/rpfkbpwktk30rbv/iPboki7KLF/rabbitmq_mgmt_regex_2_groups.png
>> https://dl.dropboxusercontent.com/s/1ftg4p1n07fv7y3/rabbitmq_mgmt_regex_all_groups.png
>>  
>> Thanks again for a great product.  We?re looking forward to upgrading to 3.2.x.
>>  
>> Joe
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/406b199a/attachment.htm>

From emile at rabbitmq.com  Wed Nov 13 12:18:51 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 13 Nov 2013 12:18:51 +0000
Subject: [rabbitmq-discuss] Delivery / Redelivery counter plugin
In-Reply-To: <CAHC35TCW18TK601HZyJPhQScWxNMHij_LZUFJbZV0bvR-Xrgiw@mail.gmail.com>
References: <CAHC35TCW18TK601HZyJPhQScWxNMHij_LZUFJbZV0bvR-Xrgiw@mail.gmail.com>
Message-ID: <52836E2B.1020601@rabbitmq.com>


Hi,


On 13/11/13 11:55, Karl Nilsson wrote:

> I know there is a planned feature for this (basic / deliver / 01) but I
> checked with Alvaro who has confirmed it isn't a priority at this time
> so we could do with some kind of half-way house in the meantime.


The priority of this feature has just raised because it is determined in
part by demand.

The complete implementation of toxic message handling is complicated by
the need for on-disk representations to change in order to accommodate
the counter information. Maintaining the counter in RAM is not an option
since the redelivery information could be unbounded.

This feature would need to modify and interact with multiple broker
subsystems, so not the ideal for a plugin.

The best alternative at present is to use the redelivery flag as an
indicator that a message may be suspect. It is possible to extend the
utility of the redelivery flag slightly by republishing redelivered
messages to a separate queue for high-risk messages. If messages from
the high-disk queue again have the redelivery flag set then the message
is probably toxic and should be handled as an exception.



-Emile











From fercascue at gmail.com  Wed Nov 13 12:22:14 2013
From: fercascue at gmail.com (fercascue)
Date: Wed, 13 Nov 2013 04:22:14 -0800 (PST)
Subject: [rabbitmq-discuss] Strange behaviour in example_get
In-Reply-To: <5283671B.7000209@rabbitmq.com>
References: <1384249541561-31371.post@n5.nabble.com>
	<528357DD.9030205@rabbitmq.com>
	<1384342626092-31404.post@n5.nabble.com>
	<5283671B.7000209@rabbitmq.com>
Message-ID: <1384345334058-31411.post@n5.nabble.com>

Hi, 

Related to consume messages asynchronously, any example?
Maybe example_consume could be a starting point?

Thanks in advance. 
B.R

Fercascue



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Strange-behaviour-in-example-get-tp31371p31411.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From lars.ellebo at schneider-electric.com  Wed Nov 13 12:34:38 2013
From: lars.ellebo at schneider-electric.com (Lars Ellebo)
Date: Wed, 13 Nov 2013 04:34:38 -0800 (PST)
Subject: [rabbitmq-discuss] Connect/Disconnect Queue
Message-ID: <1384346078486-31412.post@n5.nabble.com>

Hello there

Is there a way to configure a Queue that will generate a message every time
a user Connects or Disconnects ?

The message shall contain at least the UserId and whether the Used did
Connect or Disconnect.

/Lars




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Connect-Disconnect-Queue-tp31412.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From kjnilsson at gmail.com  Wed Nov 13 12:49:59 2013
From: kjnilsson at gmail.com (Karl Nilsson)
Date: Wed, 13 Nov 2013 12:49:59 +0000
Subject: [rabbitmq-discuss] Delivery / Redelivery counter plugin
In-Reply-To: <52836E2B.1020601@rabbitmq.com>
References: <CAHC35TCW18TK601HZyJPhQScWxNMHij_LZUFJbZV0bvR-Xrgiw@mail.gmail.com>
	<52836E2B.1020601@rabbitmq.com>
Message-ID: <CAHC35TB65ntf5-79HZfhTRp9fSh6n-ptSTfxeMGvVkq6-+oneg@mail.gmail.com>

Hi Emile,

Firstly, thanks for the reply and for raising the priority of this feature.
I am sure it won't only be us that will appreciate this. :)

I totally understand that doing a 'proper' implementation of toxic message
handling is a complex task and would not be suitable for a plugin. What I
am after is something that would satisfy our system specific requirements
in the meantime. The idea I had was to simply plug something into the
channel deliver/redeliver function to add / increment a custom header value
that we could later inspect in the consumers. This value doesn't even have
to be very accurate (e.g. taking replication / failover into account). All
we want to achieve is to have some indication of a message being one that
has been redelivered multiple times and then take some action based on
that.

Is it technically possible to do this using the plugin architecture? If so,
I'd appreciate any pointers of as to how.

Using multiple queues is an additional complexity that I'd like to try to
avoid as long as possible.

Karl


On 13 November 2013 12:18, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
>
> On 13/11/13 11:55, Karl Nilsson wrote:
>
> > I know there is a planned feature for this (basic / deliver / 01) but I
> > checked with Alvaro who has confirmed it isn't a priority at this time
> > so we could do with some kind of half-way house in the meantime.
>
>
> The priority of this feature has just raised because it is determined in
> part by demand.
>
> The complete implementation of toxic message handling is complicated by
> the need for on-disk representations to change in order to accommodate
> the counter information. Maintaining the counter in RAM is not an option
> since the redelivery information could be unbounded.
>
> This feature would need to modify and interact with multiple broker
> subsystems, so not the ideal for a plugin.
>
> The best alternative at present is to use the redelivery flag as an
> indicator that a message may be suspect. It is possible to extend the
> utility of the redelivery flag slightly by republishing redelivered
> messages to a separate queue for high-risk messages. If messages from
> the high-disk queue again have the redelivery flag set then the message
> is probably toxic and should be handled as an exception.
>
>
>
> -Emile
>
>
>
>
>
>
>
>
>
>
>


-- 
*Karl Nilsson*
twitter: @kjnilsson
blog: coderkarl.wordpress.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/f6ca9f49/attachment.htm>

From tim at rabbitmq.com  Wed Nov 13 12:49:56 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 13 Nov 2013 12:49:56 +0000
Subject: [rabbitmq-discuss] Connect/Disconnect Queue
In-Reply-To: <1384346078486-31412.post@n5.nabble.com>
References: <1384346078486-31412.post@n5.nabble.com>
Message-ID: <63603C3D-7CB7-4890-92F6-1997DA991FFF@rabbitmq.com>

Hi,

On 13 Nov 2013, at 12:34, Lars Ellebo wrote:
> Is there a way to configure a Queue that will generate a message every time
> a user Connects or Disconnects ?
> 
> The message shall contain at least the UserId and whether the Used did
> Connect or Disconnect.
> 

Apart from the fact that this would violate a number of security principles, it's possible but not without writing a custom plugin. I have considered writing a plugin that listens for management events describing "schema changes" (i.e., CRUD operations on users, vhosts, queues, exchanges, etc) that publishes this information to an exchange and binds a queue to it. The user (installing the plugin) would need to ensure this is "locked down" to prevent security holes from appearing as a result. I hadn't considered adding connect+disconnect events though, because (a) these could be extremely frequent and could harm performance, plus (b) I can't quite see why such information would be useful. One of the primary reasons for using messaging oriented middleware is to de-couple producers from consumers, whereas providing a stream of schema-oriented information seems quite useful if you're working with dynamically changing topologies. Perhaps from a statistics monitoring point of view the connect/disconnect information is useful, but you can get that by polling the management HTTP API already, and I'm not sure whether adding a queue based feed would be the best way to present an alternative interface to such information. Simon may well have more/better points to add on this.

Cheers,
Tim


From videlalvaro at gmail.com  Wed Nov 13 12:52:12 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 13 Nov 2013 13:52:12 +0100
Subject: [rabbitmq-discuss] Connect/Disconnect Queue
In-Reply-To: <1384346078486-31412.post@n5.nabble.com>
References: <1384346078486-31412.post@n5.nabble.com>
Message-ID: <CAMcAHLUyBYoWg6-TCaqV7T2SUW-9q=zpWz_Qi2uAnjRr-PoVEA@mail.gmail.com>

Hi,

Are you looking into implementing some sort of presence?

If yes, this might be useful: https://github.com/tonyg/presence-exchange

Regards,

Alvaro



On Wed, Nov 13, 2013 at 1:34 PM, Lars Ellebo <
lars.ellebo at schneider-electric.com> wrote:

> Hello there
>
> Is there a way to configure a Queue that will generate a message every time
> a user Connects or Disconnects ?
>
> The message shall contain at least the UserId and whether the Used did
> Connect or Disconnect.
>
> /Lars
>
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/Connect-Disconnect-Queue-tp31412.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/ebcac4cb/attachment.htm>

From matthias at rabbitmq.com  Wed Nov 13 12:58:36 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 13 Nov 2013 12:58:36 +0000
Subject: [rabbitmq-discuss] Connect/Disconnect Queue
In-Reply-To: <1384346078486-31412.post@n5.nabble.com>
References: <1384346078486-31412.post@n5.nabble.com>
Message-ID: <5283777C.5040504@rabbitmq.com>

On 13/11/13 12:34, Lars Ellebo wrote:
> Is there a way to configure a Queue that will generate a message every time
> a user Connects or Disconnects ?
>
> The message shall contain at least the UserId and whether the Used did
> Connect or Disconnect.

You can do this with MQTT (http://www.rabbitmq.com/mqtt.html):

1) get apps to send a "user <id> is connecting" message just after 
connecting, and

2) get apps to set the Last Will and Testament message to "user <id> is 
disconnecting" message.

That does require the apps to play nicely though.

Matthias.

From videlalvaro at gmail.com  Wed Nov 13 13:33:51 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 13 Nov 2013 14:33:51 +0100
Subject: [rabbitmq-discuss] Design for global data ingestion
Message-ID: <CAMcAHLV5M3X485+Qogk2FkgwXVsy9rio-Bv4juXjwX84qARnwQ@mail.gmail.com>

Hi,

I've been trying to setup something like this, more like an
experiment/research to see how far federation could be taken across AWS
availability zones, but I have to admit that I've been sidetracked by
various projects and conferences.

When I was living in China I remember that a company there used to have a
similar problem as you, when sending data to the US.

Considering that you have upstreams at various locations in the world,
could it be the case that you have better TCP bandwidth from China to
another non US location, say HK, Japan, Singapore, or Korea?

If that's the case you could perhaps try to form a different federation
graph that would allow you to achieve some max flow routing. Say publishing
from China to a country that has better bandwidth than from China to the
US, and then from that country to the US, or to a third country and so on.
I know this might sound nice theoretically but I haven't tried it. I throw
this out nonetheless, in case it might lead you to a solution.

Regards,

Alvaro

On Thu, Nov 7, 2013 at 6:47 PM, Dustin <dustink.ml at gmail.com> wrote:

> Hello All!
>
> I wanted to shoot this out to see if anyone has had any experience with
> using RabbitMQ for a mass global data ingestion pipeline.  A small
> disclaimer, I'm a total RMQ noob :)
>
> We currently have a fan-in design, where we have a single downstream 2
> node HA cluster in the same data center as our data warehouse.  We have
> around 22 upstreams (also 2 node HA clusters) located in datacenters all
> over the world.  The configuration is extremely simple.  We have a single
> direct exchange, which everything publishes to. Each application uses a
> specified routing key for that application.  We end up with queue per
> application (currently around 10).  We are running 3.0.0 on the downstream
> cluster (been waiting for a maintenance window to upgrade) and 3.1.5 on the
> upstreams.
>
> This design has held up well, and we are averaging around 20k/sec messages
> a day.
>
> We have ran into 2 problems which won't allow us to scale any further.
>  The first is the max bandwidth for a single TCP connection across the
> globe (specifically between the US and China).  The second is we have maxed
> out the CPU for the federation clients on the downstream (SSL is enabled,
> I'm not sure how much CPU overhead that adds).
>
> For the CPU issue, I figured the newly added federated queues would be a
> perfect solution to the problem.  I can setup additional Rabbits on the
> downstream side, setup the federation links, and have everything load
> balance nicely.  The only thing it doesn't address is the max bandwidth for
> a single TCP connection.  Because of our initial design, we would run into
> max bandwidth problems for each queue.
>
> Our current objective is to be able to send 20k/sec messages from each
> datacenter for a single application.  In China, the most we can do is
> around 2.5k/sec (ends up being around 1.6MB/sec, this is on a good day).
> Because this message load will be from a single application, with the
> current design, it will be tied to a single routing key.  So for China, I
> would need around 8 TCP connections to do this.
>
> For this use case, message order doesn't matter.  Does anyone have any
> ideas on how I can setup multiple federation links that will be load
> balanced?  Here are some ideas I have, but they all feel hacky.
>
> 1) On the upstreams, use a consistent hash exchange, with exchange to
> exchange bindings to 8 direct exchanges, which would be federated.
> 2) Run multiple instances of RMQ on the downstream machines, and use
> federated queues.  Total number of instances across all machines should be
> greater than 8.
>
> My apologies in advance if I'm missing something obvious.  Please let me
> know if I'm trying to fit a round peg in a square hole.  :)
>
> Thanks!
>
> -Dustin
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/7b1cab1e/attachment.htm>

From ming.li.swiss at gmail.com  Wed Nov 13 12:45:49 2013
From: ming.li.swiss at gmail.com (beon2013)
Date: Wed, 13 Nov 2013 04:45:49 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ broker with JMS Client
Message-ID: <ecfc990f-0302-4127-b026-c9598c7d76b0@googlegroups.com>

Hi all, 

I'm interested in talking to a RabbitMQ broker through a JMS client. 

I've tried using Qpid's JMS client without much success. Does anyone have 
Qpid (or any other JMS client) working with Rabbit? 

Thanks! 
-Leon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/66d95b2d/attachment.htm>

From simon at rabbitmq.com  Wed Nov 13 13:57:34 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 13 Nov 2013 13:57:34 +0000
Subject: [rabbitmq-discuss] Design for global data ingestion
In-Reply-To: <CAArnGpa835TLd=tsXNEUqVDqdeiatV4+GFH-A9PVJP=KcujLXQ@mail.gmail.com>
References: <CAArnGpa835TLd=tsXNEUqVDqdeiatV4+GFH-A9PVJP=KcujLXQ@mail.gmail.com>
Message-ID: <5283854E.8000808@rabbitmq.com>

On 07/11/13 17:47, Dustin wrote:
> We have ran into 2 problems which won't allow us to scale any further.
>   The first is the max bandwidth for a single TCP connection across the
> globe (specifically between the US and China).  The second is we have
> maxed out the CPU for the federation clients on the downstream (SSL is
> enabled, I'm not sure how much CPU overhead that adds).

First of all: federation has seen some optimisations going in to 3.2.x 
so hopefully your CPU use should drop somewhat just from an upgrade 
(I've seen throughput increase by 50% to 100%).

> For the CPU issue, I figured the newly added federated queues would be a
> perfect solution to the problem.  I can setup additional Rabbits on the
> downstream side, setup the federation links, and have everything load
> balance nicely.  The only thing it doesn't address is the max bandwidth
> for a single TCP connection.  Because of our initial design, we would
> run into max bandwidth problems for each queue.

Federated queues in the downstream might not be necessary to get more 
TCP connections in use. You should be able to get away with just 
defining multiple upstreams per real upstream each with the same URI. 
The only slight downside to that is that each upstream will think it 
"owns" the upstream internal exchange and will rewire it when it starts 
up. But in practice having that happen more than once should not be a 
problem.

Oh, and it will (obviously) break ordering, but you said you don't care 
about that.

However, I suspect the next bottleneck you might find would be the 
downstream queue(s) - each queue can only utilise a single CPU. So 
federating together multiple queues on your downstream is likely to be 
useful there.

> Our current objective is to be able to send 20k/sec messages from each
> datacenter for a single application.  In China, the most we can do is
> around 2.5k/sec (ends up being around 1.6MB/sec, this is on a good day).
> Because this message load will be from a single application, with the
> current design, it will be tied to a single routing key.  So for China,
> I would need around 8 TCP connections to do this.
>
> For this use case, message order doesn't matter.  Does anyone have any
> ideas on how I can setup multiple federation links that will be load
> balanced?  Here are some ideas I have, but they all feel hacky.
>
> 1) On the upstreams, use a consistent hash exchange, with exchange to
> exchange bindings to 8 direct exchanges, which would be federated.
> 2) Run multiple instances of RMQ on the downstream machines, and use
> federated queues.  Total number of instances across all machines should
> be greater than 8.

So as discussed above, I don't think this is needed. But if you do start 
needing federated queues in the downstream cluster then that does not 
mean you need to run multiple copies of RabbitMQ - you can federate 
queues with each other within the same cluster.

Just use a URI of "amqp://" and specify the "queue" key in the upstream 
to specify a different queue name (otherwise you federate the queue with 
itself, which is harmless but not exactly useful).

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.laing at nytimes.com  Wed Nov 13 14:12:05 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Wed, 13 Nov 2013 09:12:05 -0500
Subject: [rabbitmq-discuss] Design for global data ingestion
In-Reply-To: <CAMcAHLV5M3X485+Qogk2FkgwXVsy9rio-Bv4juXjwX84qARnwQ@mail.gmail.com>
References: <CAMcAHLV5M3X485+Qogk2FkgwXVsy9rio-Bv4juXjwX84qARnwQ@mail.gmail.com>
Message-ID: <CAKgmDnEtpgAX-=L+LOL7nAB8u6LvLNQj5iJGh18AsR+uk9rS3g@mail.gmail.com>

We found the AWS Tokyo region to be the best transit point to/from China,
although that was a while ago.

Tokyo has 3 zones which now is the primary reason we base clusters there.

Singapore should be good to.

ml


On Wed, Nov 13, 2013 at 8:33 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Hi,
>
> I've been trying to setup something like this, more like an
> experiment/research to see how far federation could be taken across AWS
> availability zones, but I have to admit that I've been sidetracked by
> various projects and conferences.
>
> When I was living in China I remember that a company there used to have a
> similar problem as you, when sending data to the US.
>
> Considering that you have upstreams at various locations in the world,
> could it be the case that you have better TCP bandwidth from China to
> another non US location, say HK, Japan, Singapore, or Korea?
>
> If that's the case you could perhaps try to form a different federation
> graph that would allow you to achieve some max flow routing. Say publishing
> from China to a country that has better bandwidth than from China to the
> US, and then from that country to the US, or to a third country and so on.
> I know this might sound nice theoretically but I haven't tried it. I throw
> this out nonetheless, in case it might lead you to a solution.
>
> Regards,
>
> Alvaro
>
> On Thu, Nov 7, 2013 at 6:47 PM, Dustin <dustink.ml at gmail.com> wrote:
>
>> Hello All!
>>
>> I wanted to shoot this out to see if anyone has had any experience with
>> using RabbitMQ for a mass global data ingestion pipeline.  A small
>> disclaimer, I'm a total RMQ noob :)
>>
>> We currently have a fan-in design, where we have a single downstream 2
>> node HA cluster in the same data center as our data warehouse.  We have
>> around 22 upstreams (also 2 node HA clusters) located in datacenters all
>> over the world.  The configuration is extremely simple.  We have a single
>> direct exchange, which everything publishes to. Each application uses a
>> specified routing key for that application.  We end up with queue per
>> application (currently around 10).  We are running 3.0.0 on the downstream
>> cluster (been waiting for a maintenance window to upgrade) and 3.1.5 on the
>> upstreams.
>>
>> This design has held up well, and we are averaging around 20k/sec
>> messages a day.
>>
>> We have ran into 2 problems which won't allow us to scale any further.
>>  The first is the max bandwidth for a single TCP connection across the
>> globe (specifically between the US and China).  The second is we have maxed
>> out the CPU for the federation clients on the downstream (SSL is enabled,
>> I'm not sure how much CPU overhead that adds).
>>
>> For the CPU issue, I figured the newly added federated queues would be a
>> perfect solution to the problem.  I can setup additional Rabbits on the
>> downstream side, setup the federation links, and have everything load
>> balance nicely.  The only thing it doesn't address is the max bandwidth for
>> a single TCP connection.  Because of our initial design, we would run into
>> max bandwidth problems for each queue.
>>
>> Our current objective is to be able to send 20k/sec messages from each
>> datacenter for a single application.  In China, the most we can do is
>> around 2.5k/sec (ends up being around 1.6MB/sec, this is on a good day).
>> Because this message load will be from a single application, with the
>> current design, it will be tied to a single routing key.  So for China, I
>> would need around 8 TCP connections to do this.
>>
>> For this use case, message order doesn't matter.  Does anyone have any
>> ideas on how I can setup multiple federation links that will be load
>> balanced?  Here are some ideas I have, but they all feel hacky.
>>
>> 1) On the upstreams, use a consistent hash exchange, with exchange to
>> exchange bindings to 8 direct exchanges, which would be federated.
>> 2) Run multiple instances of RMQ on the downstream machines, and use
>> federated queues.  Total number of instances across all machines should be
>> greater than 8.
>>
>> My apologies in advance if I'm missing something obvious.  Please let me
>> know if I'm trying to fit a round peg in a square hole.  :)
>>
>> Thanks!
>>
>> -Dustin
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/68a0a3c0/attachment.htm>

From mklishin at gopivotal.com  Wed Nov 13 14:24:52 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 13 Nov 2013 18:24:52 +0400
Subject: [rabbitmq-discuss] RabbitMQ broker with JMS Client
In-Reply-To: <ecfc990f-0302-4127-b026-c9598c7d76b0@googlegroups.com>
References: <ecfc990f-0302-4127-b026-c9598c7d76b0@googlegroups.com>
Message-ID: <3527449B-5F8A-4414-8F08-CB94C7746C65@rabbitmq.com>

On 13 Nov 2013, at 16:45, beon2013 <ming.li.swiss at gmail.com> wrote:

> Does anyone have Qpid (or any other JMS client) working with Rabbit?

There is an official JMS client that?s part of vFabric suite:
http://pubs.vmware.com/vfabric53/index.jsp?topic=/com.vmware.vfabric.rabbitmq.3.1/jms-client/overview.html

MK

Software Engineer, Pivotal/RabbitMQ



From dustink.ml at gmail.com  Wed Nov 13 15:26:22 2013
From: dustink.ml at gmail.com (Dustin)
Date: Wed, 13 Nov 2013 07:26:22 -0800
Subject: [rabbitmq-discuss] Feature Request: Heartbeat for federation
	upstreams
In-Reply-To: <5283469B.9010800@rabbitmq.com>
References: <CAArnGpZ56UNbNsZFZYNacCTRUDdTewFqQcNPxVRjcR90=F5+ug@mail.gmail.com>
	<5283469B.9010800@rabbitmq.com>
Message-ID: <CAArnGpbFO41HvQgDEWu29kUnLLNjaruYSZYPGK1JorjAKdi5EA@mail.gmail.com>

Gah, I can't believe I missed that.  Thanks a ton Simon!


On Wed, Nov 13, 2013 at 1:30 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> It already does exist :-) You can specify the heartbeat in the URI,
> documented here:
>
> http://www.rabbitmq.com/uri-query-parameters.html
>
> Cheers, Simon
>
>
> On 12/11/2013 22:15, Dustin wrote:
>
>> Hey All,
>>
>> Sorry if this already exists somewhere and I'm missing it.  Would it be
>> possible to be able to specify the heartbeat for federation upstreams?
>>   I realize that I can set this globally on the server, but I would like
>> to keep the default server value, and tune down certain upstreams if
>> possible.
>>
>> Thanks in advance!!
>>
>> -Dustin
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/32064d73/attachment.htm>

From tim at rabbitmq.com  Wed Nov 13 15:29:04 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Wed, 13 Nov 2013 15:29:04 +0000
Subject: [rabbitmq-discuss] Connect/Disconnect Queue
In-Reply-To: <1384346078486-31412.post@n5.nabble.com>
References: <1384346078486-31412.post@n5.nabble.com>
Message-ID: <C44AA94B-5EBB-4891-84AA-EF847E32106E@rabbitmq.com>

Hi,

On 13 Nov 2013, at 12:34, Lars Ellebo wrote:
> Is there a way to configure a Queue that will generate a message every time
> a user Connects or Disconnects ?
> 
> The message shall contain at least the UserId and whether the Used did
> Connect or Disconnect.
> 

Apart from the fact that this would violate a number of security principles, it's possible but not without writing a custom plugin. I have considered writing a plugin that listens for management events describing "schema changes" (i.e., CRUD operations on users, vhosts, queues, exchanges, etc) that publishes this information to an exchange and binds a queue to it. The user (installing the plugin) would need to ensure this is "locked down" to prevent security holes from appearing as a result. I hadn't considered adding connect+disconnect events though, because (a) these could be extremely frequent and could harm performance, plus (b) I can't quite see why such information would be useful. One of the primary reasons for using messaging oriented middleware is to de-couple producers from consumers, whereas providing a stream of schema-oriented information seems quite useful if you're working with dynamically changing topologies. Perhaps from a statistics monitoring point of view the connect/disconnect information is useful, but you can get that by polling the management HTTP API already, and I'm not sure whether adding a queue based feed would be the best way to present an alternative interface to such information. Simon may well have more/better points to add on this.

Cheers,
Tim


From cwstorm at gmail.com  Wed Nov 13 15:40:21 2013
From: cwstorm at gmail.com (cw storm)
Date: Wed, 13 Nov 2013 10:40:21 -0500
Subject: [rabbitmq-discuss] RabbitMQ broker with JMS Client
In-Reply-To: <3527449B-5F8A-4414-8F08-CB94C7746C65@rabbitmq.com>
References: <ecfc990f-0302-4127-b026-c9598c7d76b0@googlegroups.com>
	<3527449B-5F8A-4414-8F08-CB94C7746C65@rabbitmq.com>
Message-ID: <CAETr1H_RfP0Vz8fx19sAM-dhr56_FVRFbK=ihX8iAWEOT1KBew@mail.gmail.com>

MK,

Since it's label as commercial, does that mean it require payment or can be
fully use but without support from them.  Also, I'm assuming it doesn't
require customer to download the vFabric version of RMQ server, does it?


On Wed, Nov 13, 2013 at 9:24 AM, Michael Klishin <mklishin at gopivotal.com>wrote:

> On 13 Nov 2013, at 16:45, beon2013 <ming.li.swiss at gmail.com> wrote:
>
> > Does anyone have Qpid (or any other JMS client) working with Rabbit?
>
> There is an official JMS client that?s part of vFabric suite:
>
> http://pubs.vmware.com/vfabric53/index.jsp?topic=/com.vmware.vfabric.rabbitmq.3.1/jms-client/overview.html
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/4517caa2/attachment.htm>

From japperly at gopivotal.com  Wed Nov 13 15:46:32 2013
From: japperly at gopivotal.com (Jim Apperly)
Date: Wed, 13 Nov 2013 15:46:32 +0000
Subject: [rabbitmq-discuss] RabbitMQ broker with JMS Client
In-Reply-To: <CAETr1H_RfP0Vz8fx19sAM-dhr56_FVRFbK=ihX8iAWEOT1KBew@mail.gmail.com>
References: <ecfc990f-0302-4127-b026-c9598c7d76b0@googlegroups.com>
	<3527449B-5F8A-4414-8F08-CB94C7746C65@rabbitmq.com>
	<CAETr1H_RfP0Vz8fx19sAM-dhr56_FVRFbK=ihX8iAWEOT1KBew@mail.gmail.com>
Message-ID: <CAJ7Q73-g4hNbXfqGphWFa0UUSusB5YbAb0D2ybjON6eU-StrNQ@mail.gmail.com>

You need a commercial license - either for vFabric Suite or standalone
vFabric RabbitMQ - to download the JMS client.

I believe the client would work with the open source broker. You need to
ensure you use the JMS package that was built against the version of the
server that you are using.

http://www.vmware.com/support/vfabric-rabbitmq/doc/vfabric-rabbitmq-jms-client-compatibility.html

Jim



On 13 November 2013 15:40, cw storm <cwstorm at gmail.com> wrote:

> MK,
>
> Since it's label as commercial, does that mean it require payment or can
> be fully use but without support from them.  Also, I'm assuming it doesn't
> require customer to download the vFabric version of RMQ server, does it?
>
>
> On Wed, Nov 13, 2013 at 9:24 AM, Michael Klishin <mklishin at gopivotal.com>wrote:
>
>> On 13 Nov 2013, at 16:45, beon2013 <ming.li.swiss at gmail.com> wrote:
>>
>> > Does anyone have Qpid (or any other JMS client) working with Rabbit?
>>
>> There is an official JMS client that?s part of vFabric suite:
>>
>> http://pubs.vmware.com/vfabric53/index.jsp?topic=/com.vmware.vfabric.rabbitmq.3.1/jms-client/overview.html
>>
>> MK
>>
>> Software Engineer, Pivotal/RabbitMQ
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/c60a5905/attachment.htm>

From dustink.ml at gmail.com  Wed Nov 13 19:40:13 2013
From: dustink.ml at gmail.com (Dustin)
Date: Wed, 13 Nov 2013 11:40:13 -0800
Subject: [rabbitmq-discuss] Design for global data ingestion
In-Reply-To: <CAKgmDnEtpgAX-=L+LOL7nAB8u6LvLNQj5iJGh18AsR+uk9rS3g@mail.gmail.com>
References: <CAMcAHLV5M3X485+Qogk2FkgwXVsy9rio-Bv4juXjwX84qARnwQ@mail.gmail.com>
	<CAKgmDnEtpgAX-=L+LOL7nAB8u6LvLNQj5iJGh18AsR+uk9rS3g@mail.gmail.com>
Message-ID: <CAArnGpZd8nDpvsp_BpB6JfJ1PqpmbNO7ExRNQWFM5isKie-3Fg@mail.gmail.com>

Thanks a ton everyone for the feedback and suggestions.  Unfortunately our
data warehouse is in the US, so I wouldn't be able to use one of our other
datacenters.

This really helps clear a lot of things up Simon. Now that I know a queue
can only use 1 CPU, I was able to quadruple my throughput in my load
testing by using the random exchange bound with 4 queues.  Unfortunately I
can't use the consistent hash exchange, as the routing keys aren't very
random, and our developers don't have time currently to write a random
value into a header that I can hash off of.  I wanted to use the consistent
hash exchange as it's included in the base install.

I didn't know I could define multiple upstreams with the same URI.  This
should solve the problem at hand.

Thanks again!

-Dustin


On Wed, Nov 13, 2013 at 6:12 AM, Laing, Michael
<michael.laing at nytimes.com>wrote:

> We found the AWS Tokyo region to be the best transit point to/from China,
> although that was a while ago.
>
> Tokyo has 3 zones which now is the primary reason we base clusters there.
>
> Singapore should be good to.
>
> ml
>
>
> On Wed, Nov 13, 2013 at 8:33 AM, Alvaro Videla <videlalvaro at gmail.com>wrote:
>
>> Hi,
>>
>> I've been trying to setup something like this, more like an
>> experiment/research to see how far federation could be taken across AWS
>> availability zones, but I have to admit that I've been sidetracked by
>> various projects and conferences.
>>
>> When I was living in China I remember that a company there used to have a
>> similar problem as you, when sending data to the US.
>>
>> Considering that you have upstreams at various locations in the world,
>> could it be the case that you have better TCP bandwidth from China to
>> another non US location, say HK, Japan, Singapore, or Korea?
>>
>> If that's the case you could perhaps try to form a different federation
>> graph that would allow you to achieve some max flow routing. Say publishing
>> from China to a country that has better bandwidth than from China to the
>> US, and then from that country to the US, or to a third country and so on.
>> I know this might sound nice theoretically but I haven't tried it. I throw
>> this out nonetheless, in case it might lead you to a solution.
>>
>> Regards,
>>
>> Alvaro
>>
>> On Thu, Nov 7, 2013 at 6:47 PM, Dustin <dustink.ml at gmail.com> wrote:
>>
>>> Hello All!
>>>
>>> I wanted to shoot this out to see if anyone has had any experience with
>>> using RabbitMQ for a mass global data ingestion pipeline.  A small
>>> disclaimer, I'm a total RMQ noob :)
>>>
>>> We currently have a fan-in design, where we have a single downstream 2
>>> node HA cluster in the same data center as our data warehouse.  We have
>>> around 22 upstreams (also 2 node HA clusters) located in datacenters all
>>> over the world.  The configuration is extremely simple.  We have a single
>>> direct exchange, which everything publishes to. Each application uses a
>>> specified routing key for that application.  We end up with queue per
>>> application (currently around 10).  We are running 3.0.0 on the downstream
>>> cluster (been waiting for a maintenance window to upgrade) and 3.1.5 on the
>>> upstreams.
>>>
>>> This design has held up well, and we are averaging around 20k/sec
>>> messages a day.
>>>
>>> We have ran into 2 problems which won't allow us to scale any further.
>>>  The first is the max bandwidth for a single TCP connection across the
>>> globe (specifically between the US and China).  The second is we have maxed
>>> out the CPU for the federation clients on the downstream (SSL is enabled,
>>> I'm not sure how much CPU overhead that adds).
>>>
>>> For the CPU issue, I figured the newly added federated queues would be a
>>> perfect solution to the problem.  I can setup additional Rabbits on the
>>> downstream side, setup the federation links, and have everything load
>>> balance nicely.  The only thing it doesn't address is the max bandwidth for
>>> a single TCP connection.  Because of our initial design, we would run into
>>> max bandwidth problems for each queue.
>>>
>>> Our current objective is to be able to send 20k/sec messages from each
>>> datacenter for a single application.  In China, the most we can do is
>>> around 2.5k/sec (ends up being around 1.6MB/sec, this is on a good day).
>>> Because this message load will be from a single application, with the
>>> current design, it will be tied to a single routing key.  So for China, I
>>> would need around 8 TCP connections to do this.
>>>
>>> For this use case, message order doesn't matter.  Does anyone have any
>>> ideas on how I can setup multiple federation links that will be load
>>> balanced?  Here are some ideas I have, but they all feel hacky.
>>>
>>> 1) On the upstreams, use a consistent hash exchange, with exchange to
>>> exchange bindings to 8 direct exchanges, which would be federated.
>>> 2) Run multiple instances of RMQ on the downstream machines, and use
>>> federated queues.  Total number of instances across all machines should be
>>> greater than 8.
>>>
>>> My apologies in advance if I'm missing something obvious.  Please let me
>>> know if I'm trying to fit a round peg in a square hole.  :)
>>>
>>> Thanks!
>>>
>>> -Dustin
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/b6db824b/attachment.htm>

From zheng.bangyou at gmail.com  Wed Nov 13 20:59:23 2013
From: zheng.bangyou at gmail.com (Zheng Bangyou)
Date: Wed, 13 Nov 2013 12:59:23 -0800 (PST)
Subject: [rabbitmq-discuss] Replot messages rates and system performance
Message-ID: <b3618240-2978-49f4-8ccc-706a6ef594a5@googlegroups.com>

Hi All,

I want to replot the messages rates and system performance. How could I get 
these information? e.g. Ready, Total, Publish, Conform, Deliver, Acknowledge, 
Connection, Channels, etc.

Best regards,
Bangyou
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/f9c7bbe3/attachment.htm>

From videlalvaro at gmail.com  Thu Nov 14 00:15:31 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 14 Nov 2013 01:15:31 +0100
Subject: [rabbitmq-discuss] Design for global data ingestion
In-Reply-To: <CAArnGpZd8nDpvsp_BpB6JfJ1PqpmbNO7ExRNQWFM5isKie-3Fg@mail.gmail.com>
References: <CAMcAHLV5M3X485+Qogk2FkgwXVsy9rio-Bv4juXjwX84qARnwQ@mail.gmail.com>
	<CAKgmDnEtpgAX-=L+LOL7nAB8u6LvLNQj5iJGh18AsR+uk9rS3g@mail.gmail.com>
	<CAArnGpZd8nDpvsp_BpB6JfJ1PqpmbNO7ExRNQWFM5isKie-3Fg@mail.gmail.com>
Message-ID: <CAMcAHLUhxffSSHrbsAh-+RdPzDxhpO6C_UgGAA5DxZ31rjoWow@mail.gmail.com>

Hi,

On Wed, Nov 13, 2013 at 8:40 PM, Dustin <dustink.ml at gmail.com> wrote:

> Thanks a ton everyone for the feedback and suggestions.  Unfortunately our
> data warehouse is in the US, so I wouldn't be able to use one of our other
> datacenters.
>

I'm not suggesting to move data processing to Japan for example. What I'm
saying is that it might be faster to move data from China to Japan and then
to the US.

Regards,

Alvaro
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131114/1150a3ce/attachment.htm>

From kgoess at bepress.com  Thu Nov 14 01:57:49 2013
From: kgoess at bepress.com (kgoess at bepress.com)
Date: Wed, 13 Nov 2013 17:57:49 -0800 (PST)
Subject: [rabbitmq-discuss] "Processing error", how to get additional info?
Message-ID: <ac1ccf98-9731-4595-bbb1-a5e3f581ef6c@googlegroups.com>

We're seeing this error in the rabbitmq logs from one of our worker 
processes (we have a half-dozen) running on some new worker boxes we're 
putting up.  Only the presence of this one worker causes them.  And they 
don't happen on our old worker hosts.  The error frames are going from the 
local rabbitmq on the same host (we're using shovels) to the worker 
process, but I'm not seeing any indication that the worker process is 
otherwise having problems outside of receiving this error frame.

=ERROR REPORT==== 13-Nov-2013::17:16:36 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error"
Server private detail: {noproc,
                           {gen_server,call,
                               [<0.27356.0>,next_publish_seqno,infinity]}}


Does "next_publish_seqno,infinity" mean anything to anybody here?  Or is 
there any way to get more information about the error besides the rabbitmq 
logs?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/45828273/attachment.htm>

From antonymayi at yahoo.com  Thu Nov 14 02:28:36 2013
From: antonymayi at yahoo.com (Antony Mayi)
Date: Thu, 14 Nov 2013 02:28:36 +0000 (GMT)
Subject: [rabbitmq-discuss] rabbit_stomp_reader ssl_upgrade_error
Message-ID: <1384396116.15819.YahooMailNeo@web133103.mail.ir2.yahoo.com>

Hi,

Trying to setup rabbit stomp with SSL using existing certificate but keep getting errors. I am using Erlang?R14B and RabbitMQ?3.1.5.

My rabbit config is following:
[
? {rabbitmq_stomp, [
? ? ?{ssl_listeners, [61614]},
? ? ?{ssl_options, [{cacertfile,"/tmp/ssl/certs/ca.pem"},
? ? ? ? ? ? ? ? ? ? {certfile,"/tmp/ssl/certs/hostA.pem"},
? ? ? ? ? ? ? ? ? ? {keyfile,"/tmp/ssl/private_keys/hostA.pem"},
? ? ? ? ? ? ? ? ? ? {verify,verify_peer},

? ? ? ? ? ? ? ? ? ? {fail_if_no_peer_cert,false}]}
? ]}
].

When doing basic connection test using openssl s_client I get following:
openssl s_client -connect localhost:61614 -cert /tmp/ssl/certs/hostA.pem -key /tmp/ssl/private_keys/hostA.pem -CAfile /tmp/ssl/certs/ca.pem


CONNECTED(00000003)
139852982814536:error:14094438:SSL routines:SSL3_READ_BYTES:tlsv1 alert internal error:s3_pkt.c:1197:SSL alert number 80
139852982814536:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake failure:s23_lib.c:184:
---
no peer certificate available
---
No client certificate CA names sent

Rabbit log shows following error:
=CRASH REPORT==== 14-Nov-2013::02:09:18 ===
? crasher:
? ? initial call: rabbit_stomp_reader:init/2
? ? pid: <0.328.0>
? ? registered_name: []
? ? exception error: no match of right hand side value?
? ? ? ? ? ? ? ? ? ? ?{error,{ssl_upgrade_error,"internal error"}}
? ? ? in function ?rabbit_stomp_reader:init/2
? ? ancestors: [<0.327.0>,rabbit_stomp_client_sup_sup,rabbit_stomp_sup,
? ? ? ? ? ? ? ? ? <0.287.0>]
? ? messages: []
? ? links: [<0.327.0>]
? ? dictionary: []
? ? trap_exit: false
? ? status: running
? ? heap_size: 377
? ? stack_size: 24
? ? reductions: 852
? neighbours:


Note the certificates are correct/valid and I am perfectly able to establish SSL connection with them using openssl s_server + s_client.

Any idea what's wrong?

Thanks,
Antony.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131114/6d3c3f26/attachment.htm>

From antonymayi at yahoo.com  Thu Nov 14 03:09:13 2013
From: antonymayi at yahoo.com (Antony Mayi)
Date: Thu, 14 Nov 2013 03:09:13 +0000 (GMT)
Subject: [rabbitmq-discuss] rabbit_stomp_reader ssl_upgrade_error
In-Reply-To: <1384396116.15819.YahooMailNeo@web133103.mail.ir2.yahoo.com>
References: <1384396116.15819.YahooMailNeo@web133103.mail.ir2.yahoo.com>
Message-ID: <1384398553.68368.YahooMailNeo@web133106.mail.ir2.yahoo.com>

btw. just upgraded to erlang?R16B02 and rabbitmq?3.2.1 but still getting the same error...
A.



On Thursday, 14 November 2013, 3:28, Antony Mayi <antonymayi at yahoo.com> wrote:
 
Hi,
>
>
>Trying to setup rabbit stomp with SSL using existing certificate but keep getting errors. I am using Erlang?R14B and RabbitMQ?3.1.5.
>
>
>My rabbit config is following:
>[
>? {rabbitmq_stomp, [
>? ? ?{ssl_listeners, [61614]},
>? ? ?{ssl_options, [{cacertfile,"/tmp/ssl/certs/ca.pem"},
>? ? ? ? ? ? ? ? ? ? {certfile,"/tmp/ssl/certs/hostA.pem"},
>? ? ? ? ? ? ? ? ? ? {keyfile,"/tmp/ssl/private_keys/hostA.pem"},
>? ? ? ? ? ? ? ? ? ? {verify,verify_peer},
>
>? ? ? ? ? ? ? ? ? ? {fail_if_no_peer_cert,false}]}
>? ]}
>].
>
>
>When doing basic connection test using openssl s_client I get following:
>openssl s_client -connect localhost:61614 -cert /tmp/ssl/certs/hostA.pem -key /tmp/ssl/private_keys/hostA.pem -CAfile /tmp/ssl/certs/ca.pem
>
>
>
>CONNECTED(00000003)
>139852982814536:error:14094438:SSL routines:SSL3_READ_BYTES:tlsv1 alert internal error:s3_pkt.c:1197:SSL alert number 80
>139852982814536:error:140790E5:SSL routines:SSL23_WRITE:ssl handshake failure:s23_lib.c:184:
>---
>no peer certificate available
>---
>No client certificate CA names sent
>
>
>Rabbit log shows following error:
>=CRASH REPORT==== 14-Nov-2013::02:09:18 ===
>? crasher:
>? ? initial call: rabbit_stomp_reader:init/2
>? ? pid: <0.328.0>
>? ? registered_name: []
>? ? exception error: no match of right hand side value?
>? ? ? ? ? ? ? ? ? ? ?{error,{ssl_upgrade_error,"internal error"}}
>? ? ? in function ?rabbit_stomp_reader:init/2
>? ? ancestors: [<0.327.0>,rabbit_stomp_client_sup_sup,rabbit_stomp_sup,
>? ? ? ? ? ? ? ? ? <0.287.0>]
>? ? messages: []
>? ? links: [<0.327.0>]
>? ? dictionary: []
>? ? trap_exit: false
>? ? status: running
>? ? heap_size: 377
>? ? stack_size: 24
>? ? reductions: 852
>? neighbours:
>
>
>
>
>Note the certificates are correct/valid and I am perfectly able to establish SSL connection with them using openssl s_server + s_client.
>
>
>Any idea what's wrong?
>
>
>Thanks,
>Antony.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131114/5d9f99cb/attachment.htm>

From Shashank.Lothe at techmahindra.com  Thu Nov 14 05:54:05 2013
From: Shashank.Lothe at techmahindra.com (Lothe Shashank)
Date: Thu, 14 Nov 2013 05:54:05 +0000
Subject: [rabbitmq-discuss] Queries regarding rabbitmq-C APIs
Message-ID: <DD7729D61B083D48A2CDCB66A27AD4C98CAB09@BSDMSATMBX001.mahindrasatyam.ad>

Alan,

For the following query I tried testing the network cable pull out scenario again. However I noticed that the listner API amqp_simple_wait_frame_noblock returns AMQP_STATUS_SSL_ERROR or AMQP_STATUS_TIMEOUT and not the AMQP_STATUS_SOCKET_CLOSED or AMQP_STATUS_SOCKET_ERROR as mentioned by you. I am using 0.3.0 of rabbitmq-c library and AMQP_STATUS_SOCKET_CLOSED macro is not present in amqp.h.

Could you kindly confirm the return code of amqp_simple_wait_frame_noblock when network cable is pulled out? How can I handle network cable pull out scenario in my listner program?

I have also noticed that if two listner threads with different amqp connections are running and network cable is pulled out one listner is receiving AMQP_STATUS_SSL_ERROR and another is receiving AMQP_STATUS_TIMEOUT as a return value.

Older post for your reference:

[Shashank Query] Is there is a way to check from rabbitmq-c library function, if the network cable is pulled out?


[Alan Reply] As far as I know, there isn't a portable socket API for detecting a network cable from being pulled. The best we can do is to detect when the TCP connection has been closed. All rabbitmq-c functions that cause a read or write to the socket check the return from these functions to detect the socket being closed unexpectedly. If the socket is closed the client will receive an AMQP_STATUS_SOCKET_CLOSED or AMQP_STATUS_SOCKET_ERROR as a return value.

Thanks and regards,
Shashank

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131114/f1815f8d/attachment.htm>

From mklishin at gopivotal.com  Thu Nov 14 08:11:43 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 14 Nov 2013 12:11:43 +0400
Subject: [rabbitmq-discuss] Replot messages rates and system performance
In-Reply-To: <b3618240-2978-49f4-8ccc-706a6ef594a5@googlegroups.com>
References: <b3618240-2978-49f4-8ccc-706a6ef594a5@googlegroups.com>
Message-ID: <43424EF1-275C-4E9E-B438-19D398BB7414@rabbitmq.com>

On 14 Nov 2013, at 00:59, Zheng Bangyou <zheng.bangyou at gmail.com> wrote:

> I want to replot the messages rates and system performance. How could I get these information? e.g. Ready, Total, Publish, Conform, Deliver, Acknowledge, Connection, Channels, etc.

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_1/priv/www/api/index.html

In particular GET /api/overview, GET /api/connections, GET /api/queues

MK

Software Engineer, Pivotal/RabbitMQ



From bkvtin at gmail.com  Thu Nov 14 03:20:37 2013
From: bkvtin at gmail.com (tin)
Date: Wed, 13 Nov 2013 19:20:37 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ 3.0.3 overload memory watermark
Message-ID: <006921e0-d96a-418c-8824-ef41d177cbd9@googlegroups.com>

hello, I'm using rabbitmq with version 3.0.3 and last 2 days having problem 
with rabbit. Memory watermark is overload, great than 0.5 memory and i 
increased to 0.7, still problem
I using command rabbitmqctl list_queues name memory. All current queues 
only take 2.6GB but memory is show in rabbitmq ui is overload. And when 
queues re purged, rabbitmq still keeps memory

Do you have any ideas about this problem? 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131113/9d0b6ab1/attachment.htm>

From emile at rabbitmq.com  Thu Nov 14 09:16:36 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 14 Nov 2013 09:16:36 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.3 overload memory watermark
In-Reply-To: <006921e0-d96a-418c-8824-ef41d177cbd9@googlegroups.com>
References: <006921e0-d96a-418c-8824-ef41d177cbd9@googlegroups.com>
Message-ID: <528494F4.80208@rabbitmq.com>


Hi,


On 14/11/13 03:20, tin wrote:

> Do you have any ideas about this problem? 

If you'd like us to investigate the causes of memory consumption then
please provide the output of "rabbitmqctl report".

If you upgrade to the latest version then you get greater control over
when the broker starts paging messages to disk. See the
vm_memory_high_watermark_paging_ratio setting in
https://www.rabbitmq.com/configure.html





-Emile




From emile at rabbitmq.com  Thu Nov 14 09:43:17 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 14 Nov 2013 09:43:17 +0000
Subject: [rabbitmq-discuss] Delivery / Redelivery counter plugin
In-Reply-To: <CAHC35TB65ntf5-79HZfhTRp9fSh6n-ptSTfxeMGvVkq6-+oneg@mail.gmail.com>
References: <CAHC35TCW18TK601HZyJPhQScWxNMHij_LZUFJbZV0bvR-Xrgiw@mail.gmail.com>
	<52836E2B.1020601@rabbitmq.com>
	<CAHC35TB65ntf5-79HZfhTRp9fSh6n-ptSTfxeMGvVkq6-+oneg@mail.gmail.com>
Message-ID: <52849B35.4020707@rabbitmq.com>


Hi,


On 13/11/13 12:49, Karl Nilsson wrote:

> Is it technically possible to do this using the plugin architecture? If
> so, I'd appreciate any pointers of as to how. 


Possibly. If the queue is modified to maintain a mapping of message IDs
to redelivery count then you could provide your own queue
implementation. The "backing_queue_module" key currently selects the
"rabbit_variable_queue" queue implementation. Messages that are fetched
from the queue can then have information from the mapping added to a header.

There are several reasons to avoid doing this:
It is a violation of the protocol to modify messages.
It will become difficult to obtain support for a broker with this
enhancement.
You will need to limit the size of the message ID to count mapping (if
it is not persisted), making the results approximate at best.





-Emile







From emile at rabbitmq.com  Thu Nov 14 09:51:35 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 14 Nov 2013 09:51:35 +0000
Subject: [rabbitmq-discuss] "Processing error",
 how to get additional info?
In-Reply-To: <ac1ccf98-9731-4595-bbb1-a5e3f581ef6c@googlegroups.com>
References: <ac1ccf98-9731-4595-bbb1-a5e3f581ef6c@googlegroups.com>
Message-ID: <52849D27.9060407@rabbitmq.com>


Hi,


On 14/11/13 01:57, kgoess at bepress.com wrote:

> Does "next_publish_seqno,infinity" mean anything to anybody here?  Or is
> there any way to get more information about the error besides the
> rabbitmq logs?

This looks like the result of an earlier error. Was anything logged to
the sasl log? Were there any earlier errors in the main logfile?




-Emile




From emile at rabbitmq.com  Thu Nov 14 09:52:24 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 14 Nov 2013 09:52:24 +0000
Subject: [rabbitmq-discuss] Strange behaviour in example_get
In-Reply-To: <1384345334058-31411.post@n5.nabble.com>
References: <1384249541561-31371.post@n5.nabble.com>
	<528357DD.9030205@rabbitmq.com>
	<1384342626092-31404.post@n5.nabble.com>
	<5283671B.7000209@rabbitmq.com>
	<1384345334058-31411.post@n5.nabble.com>
Message-ID: <52849D58.1000407@rabbitmq.com>

On 13/11/13 12:22, fercascue wrote:

> Maybe example_consume could be a starting point?


Yes.




From emile at rabbitmq.com  Thu Nov 14 10:00:22 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 14 Nov 2013 10:00:22 +0000
Subject: [rabbitmq-discuss] RabbitMQ MQTT plugin and x509 client
 certificate authentication
In-Reply-To: <CAPwMmOAKgOYgFqjbfm6n2gpNWPrcZdLTGnC+LMsYO5pMYaidFA@mail.gmail.com>
References: <40b9bb60-b64d-4c2f-b9f8-107bf7f96648@googlegroups.com>
	<52834D47.10402@rabbitmq.com>
	<CAPwMmOAKgOYgFqjbfm6n2gpNWPrcZdLTGnC+LMsYO5pMYaidFA@mail.gmail.com>
Message-ID: <52849F36.6090500@rabbitmq.com>


Hi,


On 13/11/13 11:18, Mark Wolfe wrote:

> That said the bridges I am talking about are from very small gateway
> devices on very unreliable wireless networks connected up to 400 ms away
> from the central brokers. From what I have observed in the past MQTT is
> designed to work more effectively in these sorts of scenarios. 

That is true, MQTT is very compact. But this could work with federation
over AMQP as well as long as the messages are small and the network is
sufficiently reliable to get at least one message delivered with
reasonably high probability while connected. AMQP can provide delivery
guarantees even if the network is unreliable, so you won't risk losing
messages if you choose to use reliable transfer.



-Emile






From simon at rabbitmq.com  Thu Nov 14 10:39:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 14 Nov 2013 10:39:12 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.3 overload memory watermark
In-Reply-To: <528494F4.80208@rabbitmq.com>
References: <006921e0-d96a-418c-8824-ef41d177cbd9@googlegroups.com>
	<528494F4.80208@rabbitmq.com>
Message-ID: <5284A850.9090200@rabbitmq.com>

On 14/11/13 09:16, Emile Joubert wrote:
> On 14/11/13 03:20, tin wrote:
>> Do you have any ideas about this problem?
>
> If you upgrade to the latest version then you get greater control over
> when the broker starts paging messages to disk.

It's also worth bearing in mind that we've fixed several memory leak 
bugs around HA since 3.0.3.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From bkvtin at gmail.com  Thu Nov 14 11:29:58 2013
From: bkvtin at gmail.com (Tran Huu Trung Tin)
Date: Thu, 14 Nov 2013 18:29:58 +0700
Subject: [rabbitmq-discuss] RabbitMQ 3.0.3 overload memory watermark
In-Reply-To: <5284A850.9090200@rabbitmq.com>
References: <006921e0-d96a-418c-8824-ef41d177cbd9@googlegroups.com>
	<528494F4.80208@rabbitmq.com> <5284A850.9090200@rabbitmq.com>
Message-ID: <CABafTr=8ChVv_e7uPSFM0toy6C6mn1Y43aOwrqUfY9mGbOuUQA@mail.gmail.com>

Having one weird point. my system has 2 rabbitmq run ha-mode. If
- turn off rabbitmq machine 2, machine 1 run smoothly
- turn off rabbitmq machine 1, machine 2 run smoothly too

But run machine 1 and 2 same time, run very slow and overload watermark.
This situation has happened since 2 days ago. Before they run with good
performance.

If i upgrade to version 3.1.1, will be fixed issue overload watermark and
process queue with better speed? I have checked everything (logs, network
tcp, ...)

Thank you for your help


2013/11/14 Simon MacMullen <simon at rabbitmq.com>

> On 14/11/13 09:16, Emile Joubert wrote:
>
>> On 14/11/13 03:20, tin wrote:
>>
>>> Do you have any ideas about this problem?
>>>
>>
>> If you upgrade to the latest version then you get greater control over
>> when the broker starts paging messages to disk.
>>
>
> It's also worth bearing in mind that we've fixed several memory leak bugs
> around HA since 3.0.3.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>



-- 
pinging bkvtin...[ptr *+84 984 890 768*] with 32 bytes of data:
   Reply from *+84 984 890 768*: sometimes yes
   Reply from *+84 984 890 768*: sometimes no
   Reply from *+84 984 890 768*: sometimes ever
   Reply from *+84 984 890 768*: sometimes never
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131114/399a425b/attachment.htm>

From david.sjoen at westcon.no  Thu Nov 14 13:51:09 2013
From: david.sjoen at westcon.no (=?iso-8859-1?Q?Sj=F8en=2C_David_A=2E?=)
Date: Thu, 14 Nov 2013 13:51:09 +0000
Subject: [rabbitmq-discuss] Invalid bytecode when joining Linux node to
	Windows cluster
Message-ID: <FBE48D007BB4A04F8B480F6016725AAF7CF4A01A@Exchange.westcon.int>

Hi!

I've recently been trying to join a Linux node to a cluster consisting of Windows nodes. The Windows cluster was auto-configured using rabbitmq.config. For some reason, the Linux nodes never joined the cluster.

The first suspect was that I was running different versions of Erlang and RabbitMQ on the nodes, so I made sure everyone was running RabbitMQ 3.1.5 and Erlang R16B02, to no avail.

I then tried to set up a test cluster with one Windows 7 VM and one openSUSE 12.3 VM, without auto-configureing the cluster. When I now try to join the Linux node to the cluster, I get the following:

rabbitmqctl join_cluster --ram rabbit at ROSC21
Clustering node rabbit at pdsp with rabbit at ROSC21 ...
Error: {incompatible_bytecode,"Incompatible Erlang bytecode found on nodes"}

I can't seem to get past this. I even tried recompiling the Erlang RPM with --disable-hipe as a shot in the dark, but no luck.

Is having a cluster of Linux and Windows nodes supposed to be possible at all?

Thanks in advance for any help,

David A. Sj?en
Senior Engineer (Software Development)
Westcon Power & Automation AS




From mklishin at gopivotal.com  Thu Nov 14 14:06:19 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 14 Nov 2013 18:06:19 +0400
Subject: [rabbitmq-discuss] Invalid bytecode when joining Linux node to
	Windows cluster
In-Reply-To: <FBE48D007BB4A04F8B480F6016725AAF7CF4A01A@Exchange.westcon.int>
References: <FBE48D007BB4A04F8B480F6016725AAF7CF4A01A@Exchange.westcon.int>
Message-ID: <4F906236-4873-4B92-88E5-D8C111D4DA65@rabbitmq.com>


On 14 Nov 2013, at 17:51, Sj?en, David A. <david.sjoen at westcon.no> wrote:

> Error: {incompatible_bytecode,"Incompatible Erlang bytecode found on nodes"}

Make sure you have the same Erlang version on both nodes and that
RabbitMQ uses the Erlang version you expect.

See http://rabbitmq.1065348.n5.nabble.com/Incompatible-Erlang-bytecode-found-on-nodes-td29756.html

MK

Software Engineer, Pivotal/RabbitMQ



From 406656983 at 163.com  Thu Nov 14 13:39:44 2013
From: 406656983 at 163.com (406656983 at 163.com)
Date: Thu, 14 Nov 2013 05:39:44 -0800 (PST)
Subject: [rabbitmq-discuss] How should the client react if there are no
	servers running?
Message-ID: <708ee0ce-db8a-45f4-adc0-fad36abc7b9b@googlegroups.com>

Hello, in RPC tutorial(Java) ,the first question: How should the client 
react if there are no servers running?    
Do you have any ideas about this problem?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131114/74aa4f51/attachment.htm>

From david.sjoen at westcon.no  Thu Nov 14 14:12:00 2013
From: david.sjoen at westcon.no (=?iso-8859-1?Q?Sj=F8en=2C_David_A=2E?=)
Date: Thu, 14 Nov 2013 14:12:00 +0000
Subject: [rabbitmq-discuss] Invalid bytecode when joining Linux node
	to	Windows cluster
In-Reply-To: <4F906236-4873-4B92-88E5-D8C111D4DA65@rabbitmq.com>
References: <FBE48D007BB4A04F8B480F6016725AAF7CF4A01A@Exchange.westcon.int>
	<4F906236-4873-4B92-88E5-D8C111D4DA65@rabbitmq.com>
Message-ID: <FBE48D007BB4A04F8B480F6016725AAF7CF4A03F@Exchange.westcon.int>

Hi,

As far as I can see, I'm running the same version on both nodes:

openSUSE:
{erlang_version,"Erlang R16B02 (erts-5.10.3) [source] [64-bit] [async-threads:30] [kernel-poll:true]\n"},

Windows:
{erlang_version,"Erlang R16B02 (erts-5.10.3) [64-bit] [async-threads:30]\n"},

Can there still be differences, causing this not to work?

David

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: 14. november 2013 15:06
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Invalid bytecode when joining Linux node to Windows cluster


On 14 Nov 2013, at 17:51, Sj?en, David A. <david.sjoen at westcon.no> wrote:

> Error: {incompatible_bytecode,"Incompatible Erlang bytecode found on 
> nodes"}

Make sure you have the same Erlang version on both nodes and that RabbitMQ uses the Erlang version you expect.

See http://rabbitmq.1065348.n5.nabble.com/Incompatible-Erlang-bytecode-found-on-nodes-td29756.html

MK

Software Engineer, Pivotal/RabbitMQ


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From mklishin at gopivotal.com  Thu Nov 14 14:15:11 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 14 Nov 2013 18:15:11 +0400
Subject: [rabbitmq-discuss] How should the client react if there are no
	servers running?
In-Reply-To: <708ee0ce-db8a-45f4-adc0-fad36abc7b9b@googlegroups.com>
References: <708ee0ce-db8a-45f4-adc0-fad36abc7b9b@googlegroups.com>
Message-ID: <FB6C30BE-1EB5-4188-8567-DEE991887622@rabbitmq.com>


On 14 Nov 2013, at 17:39, 406656983 at 163.com wrote:

> Hello, in RPC tutorial(Java) ,the first question: How should the client react if there are no servers running?    
> Do you have any ideas about this problem?

Raise an exception so that applications can decide what to do (retry, wait, abort, etc).

MK

Software Engineer, Pivotal/RabbitMQ



From emile at rabbitmq.com  Thu Nov 14 14:19:40 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 14 Nov 2013 14:19:40 +0000
Subject: [rabbitmq-discuss] How should the client react if there are no
 servers running?
In-Reply-To: <708ee0ce-db8a-45f4-adc0-fad36abc7b9b@googlegroups.com>
References: <708ee0ce-db8a-45f4-adc0-fad36abc7b9b@googlegroups.com>
Message-ID: <5284DBFC.10105@rabbitmq.com>


Hi,

On 14/11/13 13:39, 406656983 at 163.com wrote:
> Hello, in RPC tutorial(Java) ,the first question: How should the client
> react if there are no servers running?    

Clients could give up after a timeout or wait until servers come online.





-Emile





From simon at rabbitmq.com  Thu Nov 14 14:25:53 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 14 Nov 2013 14:25:53 +0000
Subject: [rabbitmq-discuss] Invalid bytecode when joining Linux node to
 Windows cluster
In-Reply-To: <FBE48D007BB4A04F8B480F6016725AAF7CF4A01A@Exchange.westcon.int>
References: <FBE48D007BB4A04F8B480F6016725AAF7CF4A01A@Exchange.westcon.int>
Message-ID: <5284DD71.1060605@rabbitmq.com>

On 14/11/13 13:51, Sj?en, David A. wrote:
> Is having a cluster of Linux and Windows nodes supposed to be possible at all?

I just tested this and it does not work in 3.1.x. The test for 
incompatible bytecode was a bit too enthusiastic.

However, we removed that test in 3.2.x (the thing it's testing for is no 
longer needed) and you can now build a mixed Windows-Unix cluster.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From david.sjoen at westcon.no  Thu Nov 14 14:27:48 2013
From: david.sjoen at westcon.no (=?iso-8859-1?Q?Sj=F8en=2C_David_A=2E?=)
Date: Thu, 14 Nov 2013 14:27:48 +0000
Subject: [rabbitmq-discuss] Invalid bytecode when joining Linux node to
 Windows cluster
In-Reply-To: <5284DD71.1060605@rabbitmq.com>
References: <FBE48D007BB4A04F8B480F6016725AAF7CF4A01A@Exchange.westcon.int>
	<5284DD71.1060605@rabbitmq.com>
Message-ID: <FBE48D007BB4A04F8B480F6016725AAF7CF4A2D8@Exchange.westcon.int>

Wonderful, thanks a lot! Now I'll just have to find a 3.2.x RPM for openSUSE... :-)

David

-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: 14. november 2013 15:26
To: Discussions about RabbitMQ
Cc: Sj?en, David A.
Subject: Re: [rabbitmq-discuss] Invalid bytecode when joining Linux node to Windows cluster

On 14/11/13 13:51, Sj?en, David A. wrote:
> Is having a cluster of Linux and Windows nodes supposed to be possible at all?

I just tested this and it does not work in 3.1.x. The test for incompatible bytecode was a bit too enthusiastic.

However, we removed that test in 3.2.x (the thing it's testing for is no longer needed) and you can now build a mixed Windows-Unix cluster.

Cheers, Simon

--
Simon MacMullen
RabbitMQ, Pivotal



From simon at rabbitmq.com  Thu Nov 14 14:52:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 14 Nov 2013 14:52:18 +0000
Subject: [rabbitmq-discuss] Invalid bytecode when joining Linux node to
 Windows cluster
In-Reply-To: <FBE48D007BB4A04F8B480F6016725AAF7CF4A2D8@Exchange.westcon.int>
References: <FBE48D007BB4A04F8B480F6016725AAF7CF4A01A@Exchange.westcon.int>
	<5284DD71.1060605@rabbitmq.com>
	<FBE48D007BB4A04F8B480F6016725AAF7CF4A2D8@Exchange.westcon.int>
Message-ID: <5284E3A2.9060205@rabbitmq.com>

On 14/11/13 14:27, Sj?en, David A. wrote:
> Wonderful, thanks a lot! Now I'll just have to find a 3.2.x RPM for openSUSE...

http://www.rabbitmq.com/install-rpm.html :-)

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From randall at trellisapp.com  Thu Nov 14 15:04:43 2013
From: randall at trellisapp.com (Randall Richard)
Date: Thu, 14 Nov 2013 10:04:43 -0500
Subject: [rabbitmq-discuss] Connect/Disconnect Queue
In-Reply-To: <C44AA94B-5EBB-4891-84AA-EF847E32106E@rabbitmq.com>
References: <1384346078486-31412.post@n5.nabble.com>
	<C44AA94B-5EBB-4891-84AA-EF847E32106E@rabbitmq.com>
Message-ID: <CADCLBRhEx=GqOKB2zp999Y6avJS35zUpM_gfvt9uGGTr1PzdSg@mail.gmail.com>

FWIW, thought it's worth referring to this somewhat related thread from
last year:
https://groups.google.com/forum/#!msg/rabbitmq-discuss/XDgTCiPGcfM/dREUwL0ZxD8J

Not sure it still works as before, but I did subscribe to the messages sent
to in amq.rabbitmq.log and you can get some string based info on connect /
disconnects.

-Randall



On Wed, Nov 13, 2013 at 10:29 AM, Tim Watson <tim at rabbitmq.com> wrote:

> Hi,
>
> On 13 Nov 2013, at 12:34, Lars Ellebo wrote:
> > Is there a way to configure a Queue that will generate a message every
> time
> > a user Connects or Disconnects ?
> >
> > The message shall contain at least the UserId and whether the Used did
> > Connect or Disconnect.
> >
>
> Apart from the fact that this would violate a number of security
> principles, it's possible but not without writing a custom plugin. I have
> considered writing a plugin that listens for management events describing
> "schema changes" (i.e., CRUD operations on users, vhosts, queues,
> exchanges, etc) that publishes this information to an exchange and binds a
> queue to it. The user (installing the plugin) would need to ensure this is
> "locked down" to prevent security holes from appearing as a result. I
> hadn't considered adding connect+disconnect events though, because (a)
> these could be extremely frequent and could harm performance, plus (b) I
> can't quite see why such information would be useful. One of the primary
> reasons for using messaging oriented middleware is to de-couple producers
> from consumers, whereas providing a stream of schema-oriented information
> seems quite useful if you're working with dynamically changing topologies.
> Perhaps from a statistics monitoring point of view
>  the connect/disconnect information is useful, but you can get that by
> polling the management HTTP API already, and I'm not sure whether adding a
> queue based feed would be the best way to present an alternative interface
> to such information. Simon may well have more/better points to add on this.
>
> Cheers,
> Tim
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131114/88c84c0c/attachment.htm>

From zheng.bangyou at gmail.com  Thu Nov 14 23:01:45 2013
From: zheng.bangyou at gmail.com (Zheng, Bangyou)
Date: Fri, 15 Nov 2013 09:01:45 +1000
Subject: [rabbitmq-discuss] Replot messages rates and system performance
In-Reply-To: <43424EF1-275C-4E9E-B438-19D398BB7414@rabbitmq.com>
References: <b3618240-2978-49f4-8ccc-706a6ef594a5@googlegroups.com>
	<43424EF1-275C-4E9E-B438-19D398BB7414@rabbitmq.com>
Message-ID: <CAADHwAZq1K9eRDzcqkhJy-Dsyq5X6vXyELUsdV_5UqdOGXyPyA@mail.gmail.com>

HI Michael,

Thanks for your reply.

I can use /api/overview to get the current status. Is there some way to get
the historical records like the plots in RabbitMQ management? Or I have to
write a script to get the current status at interval 1 min.

Cheers,
Bangyou


On 14 November 2013 18:11, Michael Klishin <mklishin at gopivotal.com> wrote:

> On 14 Nov 2013, at 00:59, Zheng Bangyou <zheng.bangyou at gmail.com> wrote:
>
> > I want to replot the messages rates and system performance. How could I
> get these information? e.g. Ready, Total, Publish, Conform, Deliver,
> Acknowledge, Connection, Channels, etc.
>
>
> http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_1/priv/www/api/index.html
>
> In particular GET /api/overview, GET /api/connections, GET /api/queues
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/7279875d/attachment.htm>

From michael.s.klishin at gmail.com  Thu Nov 14 23:37:35 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 15 Nov 2013 03:37:35 +0400
Subject: [rabbitmq-discuss] Replot messages rates and system performance
In-Reply-To: <CAADHwAZq1K9eRDzcqkhJy-Dsyq5X6vXyELUsdV_5UqdOGXyPyA@mail.gmail.com>
References: <b3618240-2978-49f4-8ccc-706a6ef594a5@googlegroups.com>
	<43424EF1-275C-4E9E-B438-19D398BB7414@rabbitmq.com>
	<CAADHwAZq1K9eRDzcqkhJy-Dsyq5X6vXyELUsdV_5UqdOGXyPyA@mail.gmail.com>
Message-ID: <CAE3HoVSzg1F2ROWOkJX28yjiY7RQmTd8a3=Y5-4oLhak0nVXhg@mail.gmail.com>

2013/11/15 Zheng, Bangyou <zheng.bangyou at gmail.com>

> I can use /api/overview to get the current status. Is there some way to
> get the historical records like the plots in RabbitMQ management? Or I have
> to write a script to get the current status at interval 1 min.


RabbitMQ statistics database does not collect data for extended periods of
time, you need to
fetch the data periodically and plot it yourself.

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/aff10de3/attachment.htm>

From tlhuang at 800best.com  Fri Nov 15 02:15:40 2013
From: tlhuang at 800best.com (Huang Tonglang)
Date: Fri, 15 Nov 2013 10:15:40 +0800
Subject: [rabbitmq-discuss] Dead letter message don't show up
In-Reply-To: <CAE3HoVSzg1F2ROWOkJX28yjiY7RQmTd8a3=Y5-4oLhak0nVXhg@mail.gmail.com>
References: <b3618240-2978-49f4-8ccc-706a6ef594a5@googlegroups.com>
	<43424EF1-275C-4E9E-B438-19D398BB7414@rabbitmq.com>
	<CAADHwAZq1K9eRDzcqkhJy-Dsyq5X6vXyELUsdV_5UqdOGXyPyA@mail.gmail.com>
	<CAE3HoVSzg1F2ROWOkJX28yjiY7RQmTd8a3=Y5-4oLhak0nVXhg@mail.gmail.com>
Message-ID: <023CBAD52AC91842B08759362DE8396C0FD5801ACE@bestex3.800best.net>

Help please.

I declare the dead letter in producer side as following:

channel.exchangeDeclare("dead-exchange", "direct");

            Map<String, Object> args = new HashMap<String, Object>();
            args.put("x-dead-letter-exchange", "dead-exchange1");
            args.put("x-dead-letter-routing-key", "dead-exchange-routing-key");

            channel.queueDeclare(?myqueue?, false, false, false, args);

            channel.queueDeclare("dead-exchange-routing-key", false, false, false, null);
            String message = "Hello World!?;
            channel.basicPublish("",?myqueue?, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());

and in conumser side:

        QueueingConsumer consumer = new QueueingConsumer(channel);
        channel.basicConsume(QUEUE_NAME, false, consumer);

        while (true) {
          QueueingConsumer.Delivery delivery = consumer.nextDelivery();
          String message = new String(delivery.getBody());
          channel.basicReject(delivery.getEnvelope().getDeliveryTag(), false);
        }

However, the dead letter message don?t show up in Rabbitmq Management page. Can some help me?


Thank you

Tonglang Huang
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/c217fac8/attachment.htm>

From zerthurd at gmail.com  Fri Nov 15 04:11:27 2013
From: zerthurd at gmail.com (Maxim Treskin)
Date: Fri, 15 Nov 2013 11:11:27 +0700
Subject: [rabbitmq-discuss] Leak of diagnostic notification
Message-ID: <CA+Km4sdPt+-d=s5NTjaA+g8g0z-JMh+mrt7T5Kn2oRf_kfOhnw@mail.gmail.com>

Hello

Tomorrow I have spent huge amount of time to find why my RabbitMQ stopped
deliver the messages. There is absolutely no any bad things in the log
files, but everything still not works. Only when I have logged in into web
interface I found that disk_free_limit has been exceeded. Why this
information is absent in the log file? Could you add this information in
the logs please?

Thank you

-- 
Max Treskin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/1a6f6687/attachment.htm>

From jkuch at gopivotal.com  Fri Nov 15 04:19:02 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Thu, 14 Nov 2013 20:19:02 -0800
Subject: [rabbitmq-discuss] Leak of diagnostic notification
In-Reply-To: <CA+Km4sdPt+-d=s5NTjaA+g8g0z-JMh+mrt7T5Kn2oRf_kfOhnw@mail.gmail.com>
References: <CA+Km4sdPt+-d=s5NTjaA+g8g0z-JMh+mrt7T5Kn2oRf_kfOhnw@mail.gmail.com>
Message-ID: <C4BB5867-D9A8-4660-84FD-CC123CC49B78@gopivotal.com>

What version are you running? You should have seen disk space alarms in the log...

Sent from my iPhone (Brevity and typos are hopefully the result of 1-fingered typing rather than rudeness or illiteracy).


> On Nov 14, 2013, at 8:11 PM, Maxim Treskin <zerthurd at gmail.com> wrote:
> 
> Hello
> 
> Tomorrow I have spent huge amount of time to find why my RabbitMQ stopped deliver the messages. There is absolutely no any bad things in the log files, but everything still not works. Only when I have logged in into web interface I found that disk_free_limit has been exceeded. Why this information is absent in the log file? Could you add this information in the logs please?
> 
> Thank you
> 
> -- 
> Max Treskin
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From alan.antonuk at gmail.com  Fri Nov 15 05:27:14 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Thu, 14 Nov 2013 21:27:14 -0800
Subject: [rabbitmq-discuss] Queries regarding rabbitmq-C APIs
In-Reply-To: <DD7729D61B083D48A2CDCB66A27AD4C98CAB09@BSDMSATMBX001.mahindrasatyam.ad>
References: <DD7729D61B083D48A2CDCB66A27AD4C98CAB09@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAAt2poKhRX_2VXHDMur7XRCR38eV7nRxi-3OrmjBbGVmjoeNag@mail.gmail.com>

The status codes were introduced in v0.4.0 of the library. Given you're
also using SSL which was also introduced in v0.4.0, I'm guessing you're
using that version of the library.  I would highly encourage you to upgrade
to v0.4.1 as there are some potentially serious bugs that are fixed as of
that version.

If you're using an SSL connection, then yes, if you pull the network cable,
it is possible to get an AMQP_STATUS_SSL_ERROR.  As for the
AMQP_STATUS_TIMEOUT, a possibility is that the socket times out before the
OS informs rabbitmq-c that the socket has been closed because the network
is no longer available. If you were to re-try the same call after getting
an AMQP_STATUS_TIMEOUT what error-code is returned?

-Alan


On Wed, Nov 13, 2013 at 9:54 PM, Lothe Shashank <
Shashank.Lothe at techmahindra.com> wrote:

>  Alan,
>
> For the following query I tried testing the network cable pull out
> scenario again. However I noticed that the listner API
> amqp_simple_wait_frame_noblock returns AMQP_STATUS_SSL_ERROR or
> AMQP_STATUS_TIMEOUT and not the AMQP_STATUS_SOCKET_CLOSED or
> AMQP_STATUS_SOCKET_ERROR as mentioned by you. I am using 0.3.0 of
> rabbitmq-c library and AMQP_STATUS_SOCKET_CLOSED macro is not present in
> amqp.h.
>
> Could you kindly confirm the return code of amqp_simple_wait_frame_noblock
> when network cable is pulled out? How can I handle network cable pull out
> scenario in my listner program?
>
> I have also noticed that if two listner threads with different amqp
> connections are running and network cable is pulled out one listner is
> receiving AMQP_STATUS_SSL_ERROR and another is receiving AMQP_STATUS_TIMEOUT
> as a return value.
>
> *Older post for your reference:*
>
> [Shashank Query] Is there is a way to check from rabbitmq-c library
> function, if the network cable is pulled out?
>
>
>  [Alan Reply] As far as I know, there isn't a portable socket API for
> detecting a network cable from being pulled. The best we can do is to
> detect when the TCP connection has been closed. All rabbitmq-c functions
> that cause a read or write to the socket check the return from these
> functions to detect the socket being closed unexpectedly. If the socket is
> closed the client will receive an AMQP_STATUS_SOCKET_CLOSED or
> AMQP_STATUS_SOCKET_ERROR as a return value.
>
> Thanks and regards,
> Shashank
>
> ------------------------------
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of the
> intended recipient/s and may contain material that is CONFIDENTIAL AND
> PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or
> distribution or forwarding of any or all of the contents in this message is
> STRICTLY PROHIBITED. If you are not the intended recipient, please contact
> the sender by email and delete all copies; your cooperation in this regard
> is appreciated.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131114/252dc122/attachment.htm>

From Punit.Jain at emc.com  Fri Nov 15 05:32:29 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Fri, 15 Nov 2013 00:32:29 -0500
Subject: [rabbitmq-discuss] SSL: error on AMQP connection
Message-ID: <DB14E94115BBC84E8960C12C176D067601779CABB9@MX25A.corp.emc.com>

Hi All,
We have existing tomcat server certificates, and I want to use them for RabbitMQ server certificates. I got following error while trying to use them:
=INFO REPORT==== 15-Nov-2013::04:39:51 ===
accepting AMQP connection <0.547.0> (127.0.0.1:4511 -> 127.0.0.1:5671)

=ERROR REPORT==== 15-Nov-2013::04:39:51 ===
SSL: 1130: error:{error,{asn1,{-4,71},
                                                                <<126,41,137,36,177,124,89,72,229,70,26,240,
                                                                228,51,215,203,103,255, ...
                                                                19,218,198,115>>}} /etc/ipsec.d/private/webServerHostkeyFile.pem
  [{public_key,der_decode,2,[{file,"public_key.erl"},{line,170}]},
   {ssl_connection,init_private_key,5,
                   [{file,"ssl_connection.erl"},{line,1127}]},
   {ssl_connection,ssl_init,2,[{file,"ssl_connection.erl"},{line,1064}]},
   {ssl_connection,init,1,[{file,"ssl_connection.erl"},{line,316}]},
   {gen_fsm,init_it,6,[{file,"gen_fsm.erl"},{line,361}]},
   {proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,227}]}]

=ERROR REPORT==== 15-Nov-2013::04:39:56 ===
error on AMQP connection <0.547.0>: {ssl_upgrade_error,ekeyfile} (unknown POSIX error)

My config file is:
[{rabbit, [
        {auth_mechanisms, ['PLAIN', 'AMQPLAIN', 'EXTERNAL']},
        {heartbeat, 30},
        {tcp_listeners, [5672]},
        {ssl_listeners, [5671]},
        {ssl_cert_login_from, common_name},
        {ssl_options, [{cacertfile, "/etc/ipsec.d/cacerts/strongswanCert.pem"},
                {certfile, "/etc/ipsec.d/certs/webServerHostCertFile.pem"},
                {keyfile, "/etc/ipsec.d/private/webServerHostkeyFile.pem"},
                {verify, verify_peer},
                {fail_if_no_peer_cert, false}]}
        ]}
].

The keyfile is as below:

-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: DES-EDE3-CBC,9A1AE0009DF93364
CMYIoAKEhKXZK0dvsTnhAIIT8EQJtWSr/HlxTUAzZavi....
-----END RSA PRIVATE KEY-----

This seems to be encrypted. Could this be the cause of above error? How can I resolve this?

Thanks in Advance!
-Punit
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/7b403556/attachment.htm>

From lijo at citrusinformatics.com  Fri Nov 15 06:04:07 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Fri, 15 Nov 2013 11:34:07 +0530
Subject: [rabbitmq-discuss] AMQP Reliability
Message-ID: <B29BB415221649E99D2BC19886444747@Lijo>

Hi, 
       What will happen if a client is not connected to server, and server publishes a message to a client in AMQP?

Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/3bf8d054/attachment.htm>

From crmckenzie at gmail.com  Thu Nov 14 21:46:55 2013
From: crmckenzie at gmail.com (Chris McKenzie)
Date: Thu, 14 Nov 2013 13:46:55 -0800 (PST)
Subject: [rabbitmq-discuss] Logging all messages all the time
Message-ID: <0d871e26-8963-425f-9862-907d1ddf23b8@googlegroups.com>

We're using a RabbitMQ server for messaging between applications. We have a 
need to create a central log for all amqp messages coming into the Rabbit 
server. Our purpose is not temporary debugging, but rather auditability. 
Ideally, I'd be able to log to a specified file to begin with, and later 
log to an external system such as Logly or Splunk.

I've explored turning on Firehose and using the tracing plugin, but the 
queues in question are not durable. I'm also not sure if these solutions 
will work if new queues and exchanges are added to the virtual host after 
logging hast started. These tools seem designed more for temporary 
debugging than what I need.

I'd love to hear your ideas. At this point I'm worried I'll have to setup a 
network monitor to intercept and log the messages before they reach Rabbit.

I asked this question on stackoverflow here: 

http://stackoverflow.com/questions/19937345/how-to-log-all-rabbit-mq-messages?noredirect=1#comment29682873_19937345

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131114/1a2a9c29/attachment.htm>

From william.weens at gmail.com  Thu Nov 14 20:14:04 2013
From: william.weens at gmail.com (William Weens)
Date: Thu, 14 Nov 2013 12:14:04 -0800 (PST)
Subject: [rabbitmq-discuss] Difference between get and consume.
In-Reply-To: <CAAt2po+uxvdj_9m7D_0fcAVTWmzuL8kNEKbk9bpfMnn1dBV3rQ@mail.gmail.com>
References: <CA+-VnXCftEngnSqEtx3FPj18n-B00q0C_SHkwWWgqvS4=bn+fw@mail.gmail.com>
	<CAAt2po+uxvdj_9m7D_0fcAVTWmzuL8kNEKbk9bpfMnn1dBV3rQ@mail.gmail.com>
Message-ID: <f2d256e8-b7df-4c06-8f11-cb8cd0c60419@googlegroups.com>

Thank you very much for your answer. I need some complementary information 
to deal with my problem.
Here is the problem:
Suppose you start to consume (amqp_basic_consume) and loop over the frames 
when a exception is thrown and you exit the loop.

Remaining messages in the queue are consumed but not examined anymore :

- is there a way to find these "lost" messages ?

Won't it be safer to get one, handle it, catch exceptions if any and then 
move to the other one ?

- if yes, does "get" method consume the message as well ?

Thank you all for your help,

William



Le mardi 13 mars 2012 18:44:38 UTC+1, Alan Antonuk a ?crit :
>
> basic.get is synchronous call which the client asks the broker: "are there 
> any messages in this queue, if so please give me one".
>
> basic.consume is a synchronous call that starts an asynchronous behavior: 
> it tells the broker, "please deliver to me the messages in this queue until 
> I say stop".  The messages can then arrive from the broker at any point in 
> the future.
>
> The rabbitmq-c library does have a function to do basic.get 
> (amqp_basic_get).  The rabbitmq-c also has a function to start and stop a 
> consumer (amqp_basic_consume and amqp_basic_cancel).  However it does not 
> have an API to deal with consuming messages. You will need to loop 
> examining amqp frames as they come in and decide how to piece them together 
> as their delivered (check the amqp_consumer.c example for details). 
>
> -Alan
>
> On Tue, Mar 13, 2012 at 12:40 PM, Jacques du Rand <jacq... at gmail.com<javascript:>
> > wrote:
>
>> Hi guys. 
>> I recently  learnd that the c library when using basic get is also 
>> blocking. In php its non blocking. What then is the difference  between 
>> basicget and consume?  At a c lib level?  
>> Regards
>> Jacques
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq... at lists.rabbitmq.com <javascript:>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131114/6920b534/attachment.htm>

From sekhar434145 at gmail.com  Fri Nov 15 08:57:38 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Fri, 15 Nov 2013 14:27:38 +0530
Subject: [rabbitmq-discuss] How to configure reply queue?
In-Reply-To: <CAH75Yb4kA0tn+BCVYNUHhxd7OGNAxLcOE25oDwyy58yuWksvFw@mail.gmail.com>
References: <CAH75Yb4usdX2RBM2pGRrmH8WNKF0Ov8p=+NfQeyC6BNRTJniGQ@mail.gmail.com>
	<CADtU9_t+3Hb2UTsXk2a5iP362fOrtXHnBTibHSoXr-rz96ReLQ@mail.gmail.com>
	<CAH75Yb7Ff40yF3ZQ0iu3ycUexH0xvhs5=-SZuH28nYhsnmMg1g@mail.gmail.com>
	<CADtU9_stR7a4ctuO-AR5x09nOwkYJvuQUM5zvQ=dJHo=b+CZmA@mail.gmail.com>
	<CAH75Yb7thW8NsQAxZ0JE=Vg_C7-ERQW91mKA3d20mK_GTdQB7w@mail.gmail.com>
	<CADtU9_sVJXKrtPKjo1KVA6mrvH_BXjvSffQsaPx5PzDRX0CXRg@mail.gmail.com>
	<CAH75Yb4kA0tn+BCVYNUHhxd7OGNAxLcOE25oDwyy58yuWksvFw@mail.gmail.com>
Message-ID: <CAH75Yb7+5V8hAqW_1FGVNqaNKBU_CV=U3CaCWn6EKsudOJ74-g@mail.gmail.com>

Thank you Russell. I could able to resolve after making change in
replyQueue manually in configuration for the request.


On Tue, Nov 12, 2013 at 9:53 PM, Rajasekhar P <sekhar434145 at gmail.com>wrote:

> Hi Russell,
>
> Here is the my listerner POJO , still am getting null response. I didnt do
> any reply queue/corrID configuration.
>
>       // receive messages
> public Object handleMessage(String query) {
>  Test test = new Test("Pandit", "Pillai");
> return test;
> }
>
> Producer -
>
> Test response = (Test)this.rabbitTemplate.convertSendAndReceive(msg);
> System.out.println("Response : " + response);
>
> Result -
> *Response : null*
>
>
> Could you please help me . Thanks in advance.
>
>
> On Tue, Nov 12, 2013 at 7:05 PM, Gary Russell <grussell at gopivotal.com>wrote:
>
>> You need to return a result from your listener pojo
>>
>> public Object handleMessage(String msg)
>>
>> or
>>
>> public List<Object> handleMessage(String msg)
>>
>> etc.
>>
>>
>> On Tue, Nov 12, 2013 at 3:17 AM, Rajasekhar P <sekhar434145 at gmail.com>wrote:
>>
>>> Hi Russell,
>>>
>>> Thanks for the support. I have followed the documentation am getting
>>> response as null. Below is the producer and consumer code.
>>>
>>> PRODUCER -
>>>
>>> // rabbittemplate
>>> public RabbitTemplate rabbitTemplate() {
>>> RabbitTemplate template = new RabbitTemplate(connectionFactory());
>>>  template.setRoutingKey(this.queueName);
>>> template.setQueue(this.queueName);
>>> template.setMessageConverter(new JsonMessageConverter());
>>>  return template;
>>> }
>>>
>>> String msg = "CUSTOMER1";
>>> Object res = this.rabbitTemplate.convertSendAndReceive(msg);
>>> System.out.println("Message sent :" +msg);
>>> System.out.println("Response : " + res.toString());
>>>
>>> CONSUMER -
>>>
>>> SimpleMessageListenerContainer container = new
>>> SimpleMessageListenerContainer();
>>>  container.setConnectionFactory(this.connectionFactory);
>>> container.setQueueNames(this.queueName);
>>> container.setMessageListener(new *MessageListenerAdapter*(new
>>> TestMessageHandler(this.queueName), new JsonMessageConverter()));
>>>  container.start();
>>>
>>>
>>>        // receive messages
>>> public void handleMessage(String msg) {
>>>  System.out.println("Received  :" + msg);
>>> }
>>>
>>> *Result - *
>>> Message sent :CUSTOMER1
>>> java.lang.NullPointerException
>>>
>>>
>>> Here, inside handleMessage based on message I want get the results from
>>> DB and need to send back. Am confusing how set the response to that
>>> client(Producer)?
>>>
>>>
>>> <<snip>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/1a76ee3c/attachment.htm>

From tim at rabbitmq.com  Fri Nov 15 09:17:45 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 15 Nov 2013 09:17:45 +0000
Subject: [rabbitmq-discuss] Connect/Disconnect Queue
In-Reply-To: <CADCLBRhEx=GqOKB2zp999Y6avJS35zUpM_gfvt9uGGTr1PzdSg@mail.gmail.com>
References: <1384346078486-31412.post@n5.nabble.com>
	<C44AA94B-5EBB-4891-84AA-EF847E32106E@rabbitmq.com>
	<CADCLBRhEx=GqOKB2zp999Y6avJS35zUpM_gfvt9uGGTr1PzdSg@mail.gmail.com>
Message-ID: <DBC6315E-D1A0-4F88-B3CE-F6ED47E975EF@rabbitmq.com>

On 14 Nov 2013, at 15:04, Randall Richard wrote:
> FWIW, thought it's worth referring to this somewhat related thread from last year: https://groups.google.com/forum/#!msg/rabbitmq-discuss/XDgTCiPGcfM/dREUwL0ZxD8J
> 
> Not sure it still works as before, but I did subscribe to the messages sent to in amq.rabbitmq.log and you can get some string based info on connect / disconnects.
> 

Yes, that's the canonical way to get information such as that at the moment. Whether or not it's worth providing different views on amq.rabbitmq.log or a different/separate feed is another matter.

Cheers,
Tim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/e917dbed/attachment.htm>

From tim at rabbitmq.com  Fri Nov 15 09:21:25 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 15 Nov 2013 09:21:25 +0000
Subject: [rabbitmq-discuss] Dead letter message don't show up
In-Reply-To: <023CBAD52AC91842B08759362DE8396C0FD5801ACE@bestex3.800best.net>
References: <b3618240-2978-49f4-8ccc-706a6ef594a5@googlegroups.com>
	<43424EF1-275C-4E9E-B438-19D398BB7414@rabbitmq.com>
	<CAADHwAZq1K9eRDzcqkhJy-Dsyq5X6vXyELUsdV_5UqdOGXyPyA@mail.gmail.com>
	<CAE3HoVSzg1F2ROWOkJX28yjiY7RQmTd8a3=Y5-4oLhak0nVXhg@mail.gmail.com>
	<023CBAD52AC91842B08759362DE8396C0FD5801ACE@bestex3.800best.net>
Message-ID: <B0B7ACD0-B44C-4AF4-A12D-6B5450FED446@rabbitmq.com>

Hi,

On 15 Nov 2013, at 02:15, Huang Tonglang wrote:
> I declare the dead letter in producer side as following:
>  
> channel.exchangeDeclare("dead-exchange", "direct");

Ok.

>  
>             Map<String, Object> args = new HashMap<String, Object>();
>             args.put("x-dead-letter-exchange", "dead-exchange1");
>             args.put("x-dead-letter-routing-key", "dead-exchange-routing-key");
>  

That's pointing to 'dead-exchange1' instead of 'dead-exchange' - did you mean to do that?

>             channel.queueDeclare(?myqueue?, false, false, false, args);
>           
>             channel.queueDeclare("dead-exchange-routing-key", false, false, false, null);
>             String message = "Hello World!?;
>             channel.basicPublish("",?myqueue?, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());

You probably also want to bind the 'dead-exchange-routing-key' to 'dead-exchange' as well. With a direct exchange, messages go to the queues whose `binding key' exactly matches the routing key of the message. Only the default exchange (called "") will "magically" route messages whose routing key matches a queue's name.

Cheers,
Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/4ac1d6c6/attachment.htm>

From tim at rabbitmq.com  Fri Nov 15 09:23:20 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 15 Nov 2013 09:23:20 +0000
Subject: [rabbitmq-discuss] AMQP Reliability
In-Reply-To: <B29BB415221649E99D2BC19886444747@Lijo>
References: <B29BB415221649E99D2BC19886444747@Lijo>
Message-ID: <C8865F51-19AC-47E1-A26E-FF2BFE460B26@rabbitmq.com>

Hi,

On 15 Nov 2013, at 06:04, Lijo Sebastian wrote:
> Hi,
>        What will happen if a client is not connected to server, and server publishes a message to a client in AMQP?
> 

The server will not attempt to publish to a client which is not connected. Messages will sit in the queue until a client connects, at which point they will be delivered. If multiple clients connect, messages will be delivered to them in round-robin fashion.

Cheers,
Tim


From simon at rabbitmq.com  Fri Nov 15 09:33:32 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 15 Nov 2013 09:33:32 +0000
Subject: [rabbitmq-discuss] Logging all messages all the time
In-Reply-To: <0d871e26-8963-425f-9862-907d1ddf23b8@googlegroups.com>
References: <0d871e26-8963-425f-9862-907d1ddf23b8@googlegroups.com>
Message-ID: <5285EA6C.2060600@rabbitmq.com>

On 14/11/2013 9:46PM, Chris McKenzie wrote:
> I've explored turning on Firehose and using the tracing plugin, but
> the queues in question are not durable.

Huh?

The firehose logs to an exchange. You can connect any queue you like to
that; durable or transient.

And the tracing plugin uses a queue internally but pulls messages off
that and into a log file - which is durable, honest :-)

> I'm also not sure if these solutions will work if new queues and
> exchanges are added to the virtual host after logging hast started.

They will.

> These tools seem designed more for temporary debugging than what I
> need.

Possibly, yes. But they should still do what you are asking.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Fri Nov 15 09:38:48 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 15 Nov 2013 09:38:48 +0000
Subject: [rabbitmq-discuss] Replot messages rates and system performance
In-Reply-To: <CAE3HoVSzg1F2ROWOkJX28yjiY7RQmTd8a3=Y5-4oLhak0nVXhg@mail.gmail.com>
References: <b3618240-2978-49f4-8ccc-706a6ef594a5@googlegroups.com>
	<43424EF1-275C-4E9E-B438-19D398BB7414@rabbitmq.com>
	<CAADHwAZq1K9eRDzcqkhJy-Dsyq5X6vXyELUsdV_5UqdOGXyPyA@mail.gmail.com>
	<CAE3HoVSzg1F2ROWOkJX28yjiY7RQmTd8a3=Y5-4oLhak0nVXhg@mail.gmail.com>
Message-ID: <5285EBA8.5000007@rabbitmq.com>

On 14/11/2013 11:37PM, Michael Klishin wrote:
>
> 2013/11/15 Zheng, Bangyou <zheng.bangyou at gmail.com
> <mailto:zheng.bangyou at gmail.com>>
>
>     I can use /api/overview to get the current status. Is there some way
>     to get the historical records like the plots in RabbitMQ management?
>     Or I have to write a script to get the current status at interval 1 min.
>
>
> RabbitMQ statistics database does not collect data for extended periods
> of time, you need to
> fetch the data periodically and plot it yourself.

Well, it maintains the overview data for one day by default. That might 
be enough, or it can be extended: 
http://www.rabbitmq.com/management.html#sample-retention

Zheng, to get historical samples, use msg_rates_age, msg_rates_incr, 
data_rates_age, data_rates_incr, lengths_age and lengths_incr query 
string parameters as documented in the last paragraph of the 
introduction here:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_1/priv/www/api/index.html

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Fri Nov 15 10:03:04 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 15 Nov 2013 10:03:04 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.0.3 overload memory watermark
In-Reply-To: <CABafTr=8ChVv_e7uPSFM0toy6C6mn1Y43aOwrqUfY9mGbOuUQA@mail.gmail.com>
References: <006921e0-d96a-418c-8824-ef41d177cbd9@googlegroups.com>
	<528494F4.80208@rabbitmq.com> <5284A850.9090200@rabbitmq.com>
	<CABafTr=8ChVv_e7uPSFM0toy6C6mn1Y43aOwrqUfY9mGbOuUQA@mail.gmail.com>
Message-ID: <5285F158.9030505@rabbitmq.com>


Hi,

On 14/11/13 11:29, Tran Huu Trung Tin wrote:
> Having one weird point. my system has 2 rabbitmq run ha-mode. If 
> - turn off rabbitmq machine 2, machine 1 run smoothly 
> - turn off rabbitmq machine 1, machine 2 run smoothly too
> 
> But run machine 1 and 2 same time, run very slow and overload watermark.
> This situation has happened since 2 days ago. Before they run with good
> performance.

That is because an mirrored queue works much harder than a non-mirrored
queue. You need better servers for HA queues than you do for non-HA
queues to get the same performance.

> If i upgrade to version 3.1.1, will be fixed issue overload watermark
> and process queue with better speed? I have checked everything (logs,
> network tcp, ...)

I would not expect a speed improvement, but you will have greater
control over when messages are paged to disk if you upgrade to the
latest version.




-Emile






From mklishin at gopivotal.com  Fri Nov 15 11:11:40 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 15 Nov 2013 15:11:40 +0400
Subject: [rabbitmq-discuss] Leak of diagnostic notification
In-Reply-To: <CA+Km4sdPt+-d=s5NTjaA+g8g0z-JMh+mrt7T5Kn2oRf_kfOhnw@mail.gmail.com>
References: <CA+Km4sdPt+-d=s5NTjaA+g8g0z-JMh+mrt7T5Kn2oRf_kfOhnw@mail.gmail.com>
Message-ID: <BE058C95-7976-4612-B8F3-89433D7F34FD@rabbitmq.com>


On 15 Nov 2013, at 08:11, Maxim Treskin <zerthurd at gmail.com> wrote:

> Why this information is absent in the log file? Could you add this information in the logs please?

Alarms are logged (until you?ve run out of space to the point Rabbit cannot even append anything
to the log, but that?s unlikely).

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Fri Nov 15 11:14:59 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 15 Nov 2013 15:14:59 +0400
Subject: [rabbitmq-discuss] SSL: error on AMQP connection
In-Reply-To: <DB14E94115BBC84E8960C12C176D067601779CABB9@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D067601779CABB9@MX25A.corp.emc.com>
Message-ID: <6796F7EA-29B0-456A-B245-8369B0030A0A@rabbitmq.com>

On 15 Nov 2013, at 09:32, Jain, Punit <Punit.Jain at emc.com> wrote:

> error on AMQP connection <0.547.0>: {ssl_upgrade_error,ekeyfile} (unknown POSIX error)

Erlang?s SSL module rejects the private key.

MK

Software Engineer, Pivotal/RabbitMQ



From Shashank.Lothe at techmahindra.com  Fri Nov 15 12:58:09 2013
From: Shashank.Lothe at techmahindra.com (Lothe Shashank)
Date: Fri, 15 Nov 2013 12:58:09 +0000
Subject: [rabbitmq-discuss] Queries regarding rabbitmq-C APIs
Message-ID: <DD7729D61B083D48A2CDCB66A27AD4C98CAC6A@BSDMSATMBX001.mahindrasatyam.ad>

Hi Alan,

For the network cable pull out amqp_simple_wait_frame_noblock returns AMQP_STATUS_TIMEOUT. If you were to re-try the same call after getting an AMQP_STATUS_TIMEOUT still we get AMQP_STATUS_TIMEOUT return code.

regards,
Shashank

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/1188646d/attachment.htm>

From sp345s at att.com  Fri Nov 15 13:09:12 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Fri, 15 Nov 2013 13:09:12 +0000
Subject: [rabbitmq-discuss] no error or exception
Message-ID: <59BF56992750434F89F8EBE141E64B1D018358D7@GAALPA1MSGUSR9C.ITServices.sbc.com>


I am working on the access control  features and have the below configuration

Demo user has access to read and write on '^demo\.*$
Account user has access to read and write on '^account\.*$

When I try to use user "demo" to read on "account.topic" it throws exception .... But when we try to post a message it doesn't throw any exception but don't see any message going through the exchange or in the queue ..BUT don't get any exception either ..  How will the client know if his message is getting delivered to the right exchange ?? is there any configuration we can enable the exceptions in these scenarios..

Appreciate all the help ..



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/25602371/attachment.htm>

From simon at rabbitmq.com  Fri Nov 15 13:37:17 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 15 Nov 2013 13:37:17 +0000
Subject: [rabbitmq-discuss] no error or exception
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D018358D7@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D018358D7@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <5286238D.4010806@rabbitmq.com>

On 15/11/2013 13:09, PATAR, SAGAR wrote:
> But when we try to post a message it doesn?t throw any exception

That's because publishing is asynchronous. The channel will have closed 
due to the permission error but if you just publish and do nothing else 
your app won't notice.

Ways you could notice:

* Publish in confirm mode and await a basic.ack
* Publish in mandatory mode and await a basic.return
* Publish in a transaction

These all have performance costs (in approximately increasing order).

Cheers, Simon

From Michal.Skorepa at Honeywell.com  Fri Nov 15 14:18:36 2013
From: Michal.Skorepa at Honeywell.com (Skorepa, Michal)
Date: Fri, 15 Nov 2013 14:18:36 +0000
Subject: [rabbitmq-discuss] SSL connection - ASN1 error
In-Reply-To: <F0867114-7F45-40BB-AF6A-7A6860D05256@rabbitmq.com>
References: <ABBDC9D7002EB54AB98BA60DA16D269333FF7171@FR44EX3003.global.ds.honeywell.com>
	<524A9911.6040603@rabbitmq.com>
	<ABBDC9D7002EB54AB98BA60DA16D269333FF71E1@FR44EX3003.global.ds.honeywell.com>
	<BE8B2303-7B48-4EEE-B758-D679EFB8C999@rabbitmq.com>
	<ABBDC9D7002EB54AB98BA60DA16D26934295B432@FR44EX3003.global.ds.honeywell.com>
	<F0867114-7F45-40BB-AF6A-7A6860D05256@rabbitmq.com>
Message-ID: <ABBDC9D7002EB54AB98BA60DA16D26934295BCA3@FR44EX3003.global.ds.honeywell.com>

Hi Tim,

So, I did what you suggested. I followed the procedure on www.rabbitmq.com/ssl.html and generated brand new certificates. Now I am getting a different error. It is not an exception as before, now it is an error result from amqp_connection:start(Args). 

The log on the client side says:

2013-11-15 13:02:56.384 [error] <0.412.0> SSL: certify: tls_handshake.erl:1331:Fatal error: handshake failure
2013-11-15 13:02:56.386 [error] <0.309.0>@swim_cm_connector:handle_info:73 Connection setup error: {tls_alert,"handshake failure"}
---------------

On the server side it is:

=INFO REPORT==== 15-Nov-2013::15:05:39 ===
accepting AMQP connection <0.4914.0> (10.10.10.52:37826 -> 192.168.0.21:5671)

=ERROR REPORT==== 15-Nov-2013::15:05:40 ===
SSL: certify: ssl_connection.erl:1678:Fatal error: handshake failure

=INFO REPORT==== 15-Nov-2013::15:05:46 ===
accepting AMQP connection <0.4923.0> (10.10.10.52:42106 -> 192.168.0.21:5671)

=ERROR REPORT==== 15-Nov-2013::15:05:46 ===
SSL: certify: ssl_connection.erl:1678:Fatal error: handshake failure

=ERROR REPORT==== 15-Nov-2013::15:05:50 ===
error on AMQP connection <0.4914.0>: {ssl_upgrade_error,esslaccept} (unknown POSIX error)

=ERROR REPORT==== 15-Nov-2013::15:05:56 ===
error on AMQP connection <0.4923.0>: {ssl_upgrade_error,esslaccept} (unknown POSIX error)
---------------------

I really do not understand why this is happening.

Also, I follow the troubleshooting procedure on http://www.rabbitmq.com/troubleshooting-ssl.html and everything worked fine except for the last exercise - the stunnel test. When performing this test, I got an exception on the client side saying:

12:51:02.154 [error] swim_cm_connector: Exception caught in connection setup.
 Exception: exit
 Reason: {{function_clause,[{amqp_gen_connection,terminate,[{{badarg,[{crypto,ec_key_generate,[secp256r1],[]},{crypto,generate_key,3,[{file,"crypto.erl"},{line,560}]},{public_key,ec_generate_key,1,[{file,"public_key.erl"},{line,869}]},{tls_connection,server_master_secret,2,[{file,"tls_connection.erl"},{line,2053}]},{tls_connection,certify,2,[{file,"tls_connection.erl"},{line,544}]},{tls_connection,next_state,4,[{file,"tls_connection.erl"},{line,2537}]},{gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,505}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},{gen_fsm,sync_send_all_state_event,[<0.425.0>,{start,infinity},infinity]}},{<0.421.0>,{amqp_params_network,<<"xxx">>,<<"xxx">>,<<"demo">>,{192,168,0,21},5677,0,0,60,infinity,[{cacertfile,"/home/root/new_certificates/testca/cacert.pem"},{certfile,"/home/root/new_certificates/client/cert.pem"},{keyfile,"/home/root/new_certificates/client/key.pem"},{verify,verify_peer},{fail_if_no_peer_cert,false}],[#Fun<amqp_auth_mechanisms.plain.3>,#Fun<amqp_auth_mechanisms.amqplain.3>],[],[{tos,64}]}}],[{file,"src/amqp_gen_connection.erl"},{line,229}]},{gen_server,terminate,6,[{file,"gen_server.erl"},{line,719}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},{gen_server,call,[<0.422.0>,connect,infinity]}}
-----------------------

The stunnel log says:

2013.11.15 13:48:50 LOG7[23085:139972456994560]: Service [stunnel3] accepted (FD=4) from 10.10.10.52:33027
2013.11.15 13:48:50 LOG7[23085:139972456986368]: Service [stunnel3] started
2013.11.15 13:48:50 LOG7[23085:139972456986368]: Waiting for a libwrap process
2013.11.15 13:48:50 LOG7[23085:139972456986368]: Acquired libwrap process #0
2013.11.15 13:48:50 LOG7[23085:139972456986368]: Releasing libwrap process #0
2013.11.15 13:48:50 LOG7[23085:139972456986368]: Released libwrap process #0
2013.11.15 13:48:50 LOG7[23085:139972456986368]: Service [stunnel3] permitted by libwrap from 10.10.10.52:33027
2013.11.15 13:48:50 LOG5[23085:139972456986368]: Service [stunnel3] accepted connection from 10.10.10.52:33027
2013.11.15 13:48:50 LOG3[23085:139972456986368]: SSL_accept: Peer suddenly disconnected
2013.11.15 13:48:50 LOG5[23085:139972456986368]: Connection reset: 0 byte(s) sent to SSL, 0 byte(s) sent to socket
2013.11.15 13:48:50 LOG7[23085:139972456986368]: Local socket (FD=4) closed
2013.11.15 13:48:50 LOG7[23085:139972456986368]: Service [stunnel3] finished (0 left)
----------------------

Does this make any sense to you?

Thank you!
Michal




-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: 13. listopadu 2013 12:22
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] SSL connection - ASN1 error

Hi Michal,

> So the new release did not fix the issue. I am still getting the same error.

The fix Simon and I spoke with you about previously was related to the startup error, which was fixed in 3.2.0 - see http://www.rabbitmq.com/release-notes/README-3.2.0.txt:

"25794 prevent startup error when using SSL on versions of Erlang from R16B01"

These other issues appear to be to do with your SSL setup, and that's hard/impossible to diagnose without more information. If I follow the instructions in www.rabbitmq.com/ssl.html for setting up testing certificates for the client and server, then I can successfully establish and close an SSL connection to the broker using the Erlang client, based on the latest RabbitMQ release and using Erlang R16B02 for both client and server. Can you please test that you can do the same, at which point we'll at least have a baseline to work to whilst trying to identify what the real issue you're running into is.

Cheers,
Tim 

On 13 Nov 2013, at 10:07, Skorepa, Michal wrote:

> Hi Tim,
> 
> So the new release did not fix the issue. I am still getting the same error.
> 
> What I am trying to do is a broker-to-broker communication. One broker (a "server") is a standard RabbitMQ. The other broker (a "client") is a RabbitMQ running a plugin application, which based on some events connects to the "server" broker using erlang AMQP client. We have been using this concept without SSL for a long time without any problems (several erlang and RabbitMQ versions). We have also tested it with SSL having RabbitMQ 3.1.3 and Erlang R15B01 on the "server" side and RabbitMQ 3.0.4 and Erlang R15B01 on the "client" side. This also worked.
> But having the same "server" broker (RabbitMQ 3.1.3 and Erlang 15B01) and using the "client" broker with RabbitMQ 3.2.1 and Erlang 16B01 throws the exception mentioned below when calling amqp_connection:start(Params).
> It seems the error came with the Erlang upgrade.
> 
> The log files follow..
> 
> The relevant lines form the plugin application log:
> 
> 2013-11-12 14:35:00.168 [debug] <0.309.0>@swim_cm_connector:handle_info:65 Connection parameters: {amqp_params_network,<<"aaa">>,<<"aaa">>,<<"demo">>,{192,168,0,21},5677,0,0,60,infinity,[{cacertfile,"/etc/ssl/swim/swim-ca_cert.pem"},{certfile,"/etc/ssl/swim/cert.pem"},{keyfile,"/etc/ssl/swim/key.pem"},{verify,verify_peer},{fail_if_no_peer_cert,true}],[#Fun<amqp_auth_mechanisms.plain.3>,#Fun<amqp_auth_mechanisms.amqplain.3>],[],[{tos,64}]}.
> 2013-11-12 14:35:00.171 [debug] <0.316.0> Supervisor 
> {<0.316.0>,amqp_connection_sup} started 
> amqp_gen_connection:start_link(<0.318.0>, 
> {amqp_params_direct,<<"swim">>,none,<<"/">>,rabbit at overoB7,none,[]}) 
> at pid <0.319.0>
> 2013-11-12 14:35:00.178 [debug] <0.318.0> Supervisor 
> {<0.318.0>,amqp_connection_type_sup} started 
> amqp_channel_sup_sup:start_link(direct, <0.319.0>) at pid <0.321.0>
> 2013-11-12 14:35:00.185 [debug] <0.320.0> Supervisor 
> {<0.320.0>,amqp_connection_sup} started 
> amqp_connection_type_sup:start_link() at pid <0.322.0>
> 2013-11-12 14:35:00.187 [debug] <0.318.0> Supervisor 
> {<0.318.0>,amqp_connection_type_sup} started 
> amqp_channels_manager:start_link(<0.319.0>, <0.321.0>) at pid 
> <0.323.0>
> 2013-11-12 14:35:00.193 [debug] <0.320.0> Supervisor 
> {<0.320.0>,amqp_connection_sup} started 
> amqp_gen_connection:start_link(<0.322.0>, 
> {amqp_params_network,<<"aaa">>,<<"aaa">>,<<"demo">>,{192,168,0,21},567
> 7,0,0,60,infinity,[{cacertfile,...},...],...}) at pid <0.324.0>
> 2013-11-12 14:35:00.194 [debug] <0.318.0> Supervisor 
> {<0.318.0>,amqp_connection_type_sup} started 
> rabbit_queue_collector:start_link() at pid <0.325.0>
> 2013-11-12 14:35:00.577 [info] <0.7.0> Application asn1 started on 
> node rabbit at overoB7
> 2013-11-12 14:35:00.882 [info] <0.7.0> Application webmachine started 
> on node rabbit at overoB7
> 2013-11-12 14:35:00.926 [debug] <0.358.0> Supervisor crypto_sup 
> started crypto_server:start_link() at pid <0.368.0>
> 2013-11-12 14:35:00.928 [info] <0.7.0> Application crypto started on 
> node rabbit at overoB7
> 2013-11-12 14:35:01.037 [info] <0.7.0> Application public_key started 
> on node rabbit at overoB7
> 2013-11-12 14:35:01.672 [debug] <0.375.0> Supervisor ssl_sup started 
> ssl_manager:start_link([]) at pid <0.376.0>
> 2013-11-12 14:35:01.722 [debug] <0.375.0> Supervisor ssl_sup started 
> ssl_connection_sup:start_link() at pid <0.377.0>
> 2013-11-12 14:35:01.724 [info] <0.7.0> Application ssl started on node 
> rabbit at overoB7
> 2013-11-12 14:35:02.389 [debug] <0.396.0> Supervisor rabbit_mgmt_sup 
> started supervisor2:start_link(mirrored_supervisor, 
> {delegate,{one_for_one,10,10}}) at pid <0.397.0>
> 2013-11-12 14:35:02.392 [debug] <0.396.0> Supervisor rabbit_mgmt_sup 
> started mirrored_supervisor:start_internal(rabbit_mgmt_sup, 
> [{rabbit_mgmt_db,{rabbit_mgmt_db,start_link,[]},permanent,4294967295,w
> orker,[rabbit_mgmt_db]}]) at pid <0.398.0>
> 2013-11-12 14:35:02.394 [debug] <0.32.0> Supervisor kernel_safe_sup 
> started pg2_fixed:start_link() at pid <0.399.0>
> 2013-11-12 14:35:02.421 [info] <0.177.0> Statistics database started.
> 2013-11-12 14:35:02.472 [error] <0.309.0>@swim_cm_connector:handle_info:84 Exception caught in connection setup for CoS 1.
> Exception: exit
> Reason: 
> {{function_clause,[{amqp_gen_connection,terminate,[{{{badmatch,error},
> [{tls_connection,dh_master_secret,5,[{file,"tls_connection.erl"},{line
> ,2093}]},{tls_connection,certify,2,[{file,"tls_connection.erl"},{line,
> 544}]},{tls_connection,next_state,4,[{file,"tls_connection.erl"},{line
> ,2537}]},{gen_fsm,handle_msg,7,[{file,"gen_fsm.erl"},{line,505}]},{pro
> c_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{line,239}]}]},{gen_fsm
> ,sync_send_all_state_event,[<0.378.0>,{start,infinity},infinity]}},{<0
> .322.0>,{amqp_params_network,<<"aaa">>,<<"aaa">>,<<"demo">>,{192,168,0
> ,21},5677,0,0,60,infinity,[{cacertfile,"/etc/ssl/swim/swim-ca_cert.pem
> "},{certfile,"/etc/ssl/swim/cert.pem"},{keyfile,"/etc/ssl/swim/key.pem
> "},{verify,verify_peer},{fail_if_no_peer_cert,true}],[#Fun<amqp_auth_m
> echanisms.plain.3>,#Fun<amqp_auth_mechanisms.amqplain.3>],[],[{tos,64}
> ]}}],[{file,"src/amqp_gen_connection.erl"},{line,229}]},{gen_server,te
> rminate,6,[{file,"gen_server.erl"},{line,719}]},{proc_lib,init_p_do_ap
> ply,3,[{file,"proc_lib.erl"},{line,239}]}]},{gen_server,call,[<0.324.0
> >,connect,infinity]}}
> 
> ------------------------------
> 
> And the "server" broker log:
> 
> =INFO REPORT==== 12-Nov-2013::14:34:29 === accepting AMQP connection 
> <0.26684.61> (10.10.10.52:41980 -> 192.168.0.21:5677)
> 
> =INFO REPORT==== 12-Nov-2013::14:34:30 === accepting AMQP connection 
> <0.26688.61> (10.10.10.52:33288 -> 192.168.0.21:5677)
> 
> =INFO REPORT==== 12-Nov-2013::14:34:30 === accepting AMQP connection 
> <0.26692.61> (10.10.10.52:36058 -> 192.168.0.21:5677)
> 
> =INFO REPORT==== 12-Nov-2013::14:34:31 === accepting AMQP connection 
> <0.26696.61> (10.10.10.52:33409 -> 192.168.0.21:5677)
> 
> =INFO REPORT==== 12-Nov-2013::14:34:31 === accepting AMQP connection 
> <0.26700.61> (10.10.10.52:34012 -> 192.168.0.21:5677)
> 
> =INFO REPORT==== 12-Nov-2013::14:34:31 === accepting AMQP connection 
> <0.26704.61> (10.10.10.52:33157 -> 192.168.0.21:5677)
> 
> =ERROR REPORT==== 12-Nov-2013::14:34:39 === error on AMQP connection 
> <0.26684.61>: {ssl_upgrade_error,closed} (unknown POSIX error)
> 
> =ERROR REPORT==== 12-Nov-2013::14:34:40 === error on AMQP connection 
> <0.26688.61>: {ssl_upgrade_error,closed} (unknown POSIX error)
> 
> =ERROR REPORT==== 12-Nov-2013::14:34:40 === error on AMQP connection 
> <0.26692.61>: {ssl_upgrade_error,closed} (unknown POSIX error)
> 
> =ERROR REPORT==== 12-Nov-2013::14:34:41 === error on AMQP connection 
> <0.26696.61>: {ssl_upgrade_error,closed} (unknown POSIX error)
> 
> =ERROR REPORT==== 12-Nov-2013::14:34:41 === error on AMQP connection 
> <0.26700.61>: {ssl_upgrade_error,closed} (unknown POSIX error)
> 
> =ERROR REPORT==== 12-Nov-2013::14:34:41 === error on AMQP connection 
> <0.26704.61>: {ssl_upgrade_error,closed} (unknown POSIX error)
> 
> --------------------------------
> 
> 
> Thank you for any ideas!
> 
> Cheers,
> Michal
> 
> 
> 
> 
> 
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com 
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim 
> Watson
> Sent: 16. ??jna 2013 13:38
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] SSL connection - ASN1 error
> 
> Hi Michal,
> 
> On 1 Oct 2013, at 13:06, Skorepa, Michal wrote:
>> Thank you, Simon. But unfortunately neither of the proposed workarounds worked for me. Both produced the same error:
>> 
>> {{{{badmatch,error},[{tls_connection,dh_master_secret,5,[{file,"tls_c
>> o 
>> nnection.erl"},{line,2093}]},{tls_connection,certify,2,[{file,"tls_co
>> n 
>> nection.erl"},{line,544}]},{tls_connection,next_state,4,[{file,"tls_c
>> o 
>> nnection.erl"},{line,2537}]},{gen_fsm,handle_msg,7,[{file,"gen_fsm.er
>> l 
>> "},{line,505}]},{proc_lib,init_p_do_apply,3,[{file,"proc_lib.erl"},{l
>> i 
>> ne,239}]}]},{gen_fsm,sync_send_all_state_event,[<0.324.0>,{start,infi
>> n ity},infinity]}},{gen_server,call,[<0.292.0>,connect,infinity]}}
>> 
> 
> That looks like a very different error from the one you'd see due to the asn1 application not being started.
> 
>> Do you have any other suggestions?
> [snip]
>>> I am getting an exception in SSL connection establishment by AMQP 
>>> Erlang client (used by an application which is running as a RMQ plugin):
>> 
> 
> Can you explain a bit more about what you're doing here? The stack trace above indicates a failure during cryptographic key generation, which seems odd under the circumstances. Is there any more information available in the logs? In particular, it would be useful to have some more context for the error, e.g., an INFO report from the process in which this crash occured.
> 
>> 
>> Also, when do you plan to release a new version of AMQP Erlang client?
>> 
> 
> AFAIK a new release should be imminent. Although we cannot make any guarantees about release timescales, I'd expect to see one either this week or early next.
> 
> Cheers,
> Tim
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From john.c.cartwright at noaa.gov  Fri Nov 15 17:31:48 2013
From: john.c.cartwright at noaa.gov (John Cartwright - NOAA Federal)
Date: Fri, 15 Nov 2013 10:31:48 -0700
Subject: [rabbitmq-discuss] migrate configuration during upgrade
Message-ID: <CAKH7ZWxVsne--oikPx+3R0SKgpvU0x04f8g1bDT7_US7C1NL8w@mail.gmail.com>

Hello All,

we're upgrading from 3.0.2 to 3.2.1 and I'm looking for a recommendation on
migrating the configuration from the older version to the new one.  Can I
simply copy the $RABBITMQ_MNESIA_DIR to the new install area? Am I better
off to re-create the users, exchanges, virtual hosts, queues, etc.?

Thanks!

--john
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/0959ae62/attachment.htm>

From simon at rabbitmq.com  Fri Nov 15 17:41:03 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 15 Nov 2013 17:41:03 +0000
Subject: [rabbitmq-discuss] migrate configuration during upgrade
In-Reply-To: <CAKH7ZWxVsne--oikPx+3R0SKgpvU0x04f8g1bDT7_US7C1NL8w@mail.gmail.com>
References: <CAKH7ZWxVsne--oikPx+3R0SKgpvU0x04f8g1bDT7_US7C1NL8w@mail.gmail.com>
Message-ID: <52865CAF.9040101@rabbitmq.com>

On 15/11/2013 17:31, John Cartwright - NOAA Federal wrote:
> we're upgrading from 3.0.2 to 3.2.1 and I'm looking for a recommendation
> on migrating the configuration from the older version to the new one.
>   Can I simply copy the $RABBITMQ_MNESIA_DIR to the new install area? Am
> I better off to re-create the users, exchanges, virtual hosts, queues, etc.?

Normally RABBITMQ_MNESIA_DIR doesn't change across upgrades, so I assume 
you're installing manually and to a different location.

But yes, the data dir will be upgraded automatically the first time 
3.2.1 starts up. There are a couple of provisos:

1) You can't go back
2) There are some provisos with clusters, see 
http://www.rabbitmq.com/clustering.html#upgrading

Cheers, Simon

From alan.antonuk at gmail.com  Fri Nov 15 17:46:17 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Fri, 15 Nov 2013 09:46:17 -0800
Subject: [rabbitmq-discuss] Queries regarding rabbitmq-C APIs
In-Reply-To: <DD7729D61B083D48A2CDCB66A27AD4C98CAC6A@BSDMSATMBX001.mahindrasatyam.ad>
References: <DD7729D61B083D48A2CDCB66A27AD4C98CAC6A@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAAt2poJV9R9sVKJZGJZ47+=q77iTv724kF0-iU6FL-v+QTh4rg@mail.gmail.com>

This might be a bug.  Could you provide a short example that I could use to
try and reproduce this behavior?


On Fri, Nov 15, 2013 at 4:58 AM, Lothe Shashank <
Shashank.Lothe at techmahindra.com> wrote:

>  Hi Alan,
>
> For the network cable pull out amqp_simple_wait_frame_noblock returns AMQP_STATUS_TIMEOUT.
> If you were to re-try the same call after getting an AMQP_STATUS_TIMEOUT
> still we get AMQP_STATUS_TIMEOUT return code.
>
> regards,
> Shashank
>
> ------------------------------
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of the
> intended recipient/s and may contain material that is CONFIDENTIAL AND
> PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or
> distribution or forwarding of any or all of the contents in this message is
> STRICTLY PROHIBITED. If you are not the intended recipient, please contact
> the sender by email and delete all copies; your cooperation in this regard
> is appreciated.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/b64b7fc0/attachment.htm>

From mklishin at gopivotal.com  Fri Nov 15 18:08:06 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 15 Nov 2013 22:08:06 +0400
Subject: [rabbitmq-discuss] migrate configuration during upgrade
In-Reply-To: <52865CAF.9040101@rabbitmq.com>
References: <CAKH7ZWxVsne--oikPx+3R0SKgpvU0x04f8g1bDT7_US7C1NL8w@mail.gmail.com>
	<52865CAF.9040101@rabbitmq.com>
Message-ID: <D1A0C626-F8F9-476D-A944-0A8F2AC5CDAF@rabbitmq.com>

On 15 Nov 2013, at 21:41, Simon MacMullen <simon at rabbitmq.com> wrote:

> 1) You can't go back

But it is possible to back up RABBITMQ_MNESIA_DIR before you upgrade.

MK

Software Engineer, Pivotal/RabbitMQ



From sp345s at att.com  Fri Nov 15 19:04:19 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Fri, 15 Nov 2013 19:04:19 +0000
Subject: [rabbitmq-discuss] no error or exception
In-Reply-To: <5286238D.4010806@rabbitmq.com>
References: <59BF56992750434F89F8EBE141E64B1D018358D7@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<5286238D.4010806@rabbitmq.com>
Message-ID: <59BF56992750434F89F8EBE141E64B1D0183594F@GAALPA1MSGUSR9C.ITServices.sbc.com>

Thanks Simon ..

I am using spring rabbit template .. not sure how to implement the basic.ack (option 1) with the configuration ..
Can you pl. provide some sample examples I can refer ..


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com] 
Sent: Friday, November 15, 2013 8:37 AM
To: Discussions about RabbitMQ
Cc: PATAR, SAGAR
Subject: Re: [rabbitmq-discuss] no error or exception

On 15/11/2013 13:09, PATAR, SAGAR wrote:
> But when we try to post a message it doesn't throw any exception

That's because publishing is asynchronous. The channel will have closed 
due to the permission error but if you just publish and do nothing else 
your app won't notice.

Ways you could notice:

* Publish in confirm mode and await a basic.ack
* Publish in mandatory mode and await a basic.return
* Publish in a transaction

These all have performance costs (in approximately increasing order).

Cheers, Simon

From grussell at gopivotal.com  Fri Nov 15 19:33:00 2013
From: grussell at gopivotal.com (Gary Russell)
Date: Fri, 15 Nov 2013 14:33:00 -0500
Subject: [rabbitmq-discuss] no error or exception
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0183594F@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D018358D7@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<5286238D.4010806@rabbitmq.com>
	<59BF56992750434F89F8EBE141E64B1D0183594F@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <CADtU9_u7Mc2Uyk2r4wne3eLXRO=QbAepm4yeMiz9KHoVtiT4LA@mail.gmail.com>

See the various spring-amqp reference documentation sections about how to
configure the template (and connection factory) for 'publisher confirms'
http://docs.spring.io/spring-amqp/reference/html/amqp.html#d4e209

Essentially, when you send a message, you provide some correlation data;
when the ack is received, you get a callback with the result (ack/nack)
together with the correlation data (so you know which message the ack is
for).


On Fri, Nov 15, 2013 at 2:04 PM, PATAR, SAGAR <sp345s at att.com> wrote:

> Thanks Simon ..
>
> I am using spring rabbit template .. not sure how to implement the
> basic.ack (option 1) with the configuration ..
> Can you pl. provide some sample examples I can refer ..
>
>
> -----Original Message-----
> From: Simon MacMullen [mailto:simon at rabbitmq.com]
> Sent: Friday, November 15, 2013 8:37 AM
> To: Discussions about RabbitMQ
> Cc: PATAR, SAGAR
> Subject: Re: [rabbitmq-discuss] no error or exception
>
> On 15/11/2013 13:09, PATAR, SAGAR wrote:
> > But when we try to post a message it doesn't throw any exception
>
> That's because publishing is asynchronous. The channel will have closed
> due to the permission error but if you just publish and do nothing else
> your app won't notice.
>
> Ways you could notice:
>
> * Publish in confirm mode and await a basic.ack
> * Publish in mandatory mode and await a basic.return
> * Publish in a transaction
>
> These all have performance costs (in approximately increasing order).
>
> Cheers, Simon
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/25704c4a/attachment.htm>

From sp345s at att.com  Fri Nov 15 20:00:03 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Fri, 15 Nov 2013 20:00:03 +0000
Subject: [rabbitmq-discuss] no error or exception
In-Reply-To: <CADtU9_u7Mc2Uyk2r4wne3eLXRO=QbAepm4yeMiz9KHoVtiT4LA@mail.gmail.com>
References: <59BF56992750434F89F8EBE141E64B1D018358D7@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<5286238D.4010806@rabbitmq.com>
	<59BF56992750434F89F8EBE141E64B1D0183594F@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<CADtU9_u7Mc2Uyk2r4wne3eLXRO=QbAepm4yeMiz9KHoVtiT4LA@mail.gmail.com>
Message-ID: <59BF56992750434F89F8EBE141E64B1D01835971@GAALPA1MSGUSR9C.ITServices.sbc.com>

Thanks..
I was dot using 1.2.0.RELEASE vesion of spring-rabbit and spring-amqp  libraries and so was not able to see those options ..
Now I was able to configure  the confirm-callback .. BUT for some reason
The spring-rabbit (http://docs.spring.io/spring-amqp/api/org/springframework/amqp/rabbit/core/RabbitTemplate.html)
Supports send<http://docs.spring.io/spring-amqp/api/org/springframework/amqp/rabbit/core/RabbitTemplate.html#send(java.lang.String,%20java.lang.String,%20org.springframework.amqp.core.Message,%20org.springframework.amqp.rabbit.support.CorrelationData)>(String<http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true> exchange, String<http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true> routingKey, Message<http://docs.spring.io/spring-amqp/api/org/springframework/amqp/core/Message.html> message, CorrelationData<http://docs.spring.io/spring-amqp/api/org/springframework/amqp/rabbit/support/CorrelationData.html> correlationData)

But the spring-amqp jar's doesn't  has this method call ..

Below is my context file configuration .. not sure what's missing ...

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:rabbit="http://www.springframework.org/schema/rabbit"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-3.1.xsd http://www.springframework.org/schema/rabbit
       http://www.springframework.org/schema/rabbit/spring-rabbit-1.2.xsd">

       <import resource="classpath*:jmsclient-context.xml" />

       <rabbit:connection-factory id="connectionFactory" channel-cache-size="${channel.cache}"
              publisher-confirms="true"
       host="${hostname}" port="${port}"
       username="${username}"
              password="${password}" />

       <rabbit:admin connection-factory="connectionFactory" />

       <rabbit:template id="amqpTemplate" connection-factory="connectionFactory" confirm-callback="dlCallBack"/>

       <bean id="dlCallBack" class="com.att.dlife.dlcore.mbus.client.DLCallBack">
       </bean>

</beans>

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gary Russell
Sent: Friday, November 15, 2013 2:33 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] no error or exception

See the various spring-amqp reference documentation sections about how to configure the template (and connection factory) for 'publisher confirms' http://docs.spring.io/spring-amqp/reference/html/amqp.html#d4e209

Essentially, when you send a message, you provide some correlation data; when the ack is received, you get a callback with the result (ack/nack) together with the correlation data (so you know which message the ack is for).

On Fri, Nov 15, 2013 at 2:04 PM, PATAR, SAGAR <sp345s at att.com<mailto:sp345s at att.com>> wrote:
Thanks Simon ..

I am using spring rabbit template .. not sure how to implement the basic.ack (option 1) with the configuration ..
Can you pl. provide some sample examples I can refer ..


-----Original Message-----
From: Simon MacMullen [mailto:simon at rabbitmq.com<mailto:simon at rabbitmq.com>]
Sent: Friday, November 15, 2013 8:37 AM
To: Discussions about RabbitMQ
Cc: PATAR, SAGAR
Subject: Re: [rabbitmq-discuss] no error or exception

On 15/11/2013 13:09, PATAR, SAGAR wrote:
> But when we try to post a message it doesn't throw any exception

That's because publishing is asynchronous. The channel will have closed
due to the permission error but if you just publish and do nothing else
your app won't notice.

Ways you could notice:

* Publish in confirm mode and await a basic.ack
* Publish in mandatory mode and await a basic.return
* Publish in a transaction

These all have performance costs (in approximately increasing order).

Cheers, Simon
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/aa1d5d3d/attachment.htm>

From Thomas.Yarborough at echostar.com  Fri Nov 15 17:52:13 2013
From: Thomas.Yarborough at echostar.com (Yarborough, Allan)
Date: Fri, 15 Nov 2013 17:52:13 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.2.1 fails to start with management
	plugin enabled
Message-ID: <50E35C892351D542B755E41103C9367F5BE9FB26@INWPIEXC02.SATS.CORP>

Hello,

I'm encountering an issue when attempting to use the rabbitmq_management plug-in with 3.2.1.  When enabled, RabbitMQ won't start.  When disabled RabbitMQ will start.

Using Debian Wheezy (7.2) and Erlang R15b, I recently upgraded RabbitMQ from 3.1.0 to 3.2.1 and RabbitMQ failed to start.  In troubleshooting the problem, I can perform 
a fresh installation of rabbitmq-server (ie, apt-get purge rabbitmq-server ; apt-get install rabbitmq-server) and RabbitMQ will start as expected.

However, if I attempt to enable the rabbitmq_management plug-in (ex:, rabbitmq-plugins enable rabbitmq_management) and restart RabbitMQ, it will fail to start with the following error messages:

-- startup.log


BOOT FAILED
===========

Error description:
   {could_not_start,amqp_client,
       {{supervisor_data,{invalid_strategy,simple_one_for_one_terminate}},
        {amqp_client,start,[normal,[]]}}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at che-sasscb01.log
   /var/log/rabbitmq/rabbit at che-sasscb01-sasl.log

{"init terminating in do_boot",{rabbit,failure_during_boot,{could_not_start,amqp_client,{{supervisor_data,{invalid_strategy,simple_one_for_one_terminate}},{amqp_client,start,[normal,[]]}}}}}



-- rabbit@<hostname>.log


=INFO REPORT==== 15-Nov-2013::10:43:15 ===
Error description:
   {could_not_start,amqp_client,
       {{supervisor_data,{invalid_strategy,simple_one_for_one_terminate}},
        {amqp_client,start,[normal,[]]}}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at che-sasscb01.log
   /var/log/rabbitmq/rabbit at che-sasscb01-sasl.log


-- From the rabbit@<hostname>-sasl.log


=CRASH REPORT==== 15-Nov-2013::10:24:28 ===
  crasher:
    initial call: application_master:init/4
    pid: <0.49.0>
    registered_name: []
    exception exit: {{supervisor_data,
                         {invalid_strategy,simple_one_for_one_terminate}},
                     {amqp_client,start,[normal,[]]}}
      in function  application_master:init/4 (application_master.erl, line 138)
    ancestors: [<0.48.0>]
    messages: [{'EXIT',<0.50.0>,normal}]
    links: [<0.48.0>,<0.7.0>]
    dictionary: []
    trap_exit: true
    status: running
    heap_size: 377
    stack_size: 24
    reductions: 115
  neighbours:


rabbitmq-plugins list

[ ] amqp_client                       3.2.1
[ ] cowboy                            0.5.0-rmq3.2.1-git4b93c2d
[ ] eldap                             3.2.1-gite309de4
[e] mochiweb                          2.7.0-rmq3.2.1-git680dba8
[ ] rabbitmq_amqp1_0                  3.2.1
[ ] rabbitmq_auth_backend_ldap        3.2.1
[ ] rabbitmq_auth_mechanism_ssl       3.2.1
[ ] rabbitmq_consistent_hash_exchange 3.2.1
[ ] rabbitmq_federation               3.2.1
[ ] rabbitmq_federation_management    3.2.1
[ ] rabbitmq_jsonrpc                  3.2.1
[ ] rabbitmq_jsonrpc_channel          3.2.1
[ ] rabbitmq_jsonrpc_channel_examples 3.2.1
[E] rabbitmq_management               3.2.1
[e] rabbitmq_management_agent         3.2.1
[ ] rabbitmq_management_visualiser    3.2.1
[ ] rabbitmq_mqtt                     3.2.1
[ ] rabbitmq_shovel                   3.2.1
[ ] rabbitmq_shovel_management        3.2.1
[ ] rabbitmq_stomp                    3.2.1
[ ] rabbitmq_tracing                  3.2.1
[e] rabbitmq_web_dispatch             3.2.1
[ ] rabbitmq_web_stomp                3.2.1
[ ] rabbitmq_web_stomp_examples       3.2.1
[ ] rfc4627_jsonrpc                   3.2.1-git5e67120
[ ] sockjs                            0.3.4-rmq3.2.1-git3132eb9
[e] webmachine                        1.10.3-rmq3.2.1-gite9359c7


From grussell at gopivotal.com  Fri Nov 15 20:42:08 2013
From: grussell at gopivotal.com (Gary Russell)
Date: Fri, 15 Nov 2013 15:42:08 -0500
Subject: [rabbitmq-discuss] no error or exception
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D01835971@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D018358D7@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<5286238D.4010806@rabbitmq.com>
	<59BF56992750434F89F8EBE141E64B1D0183594F@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<CADtU9_u7Mc2Uyk2r4wne3eLXRO=QbAepm4yeMiz9KHoVtiT4LA@mail.gmail.com>
	<59BF56992750434F89F8EBE141E64B1D01835971@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <CADtU9_vbwTz3WT8HD-z7N9OFYyhbiazkhZUpJL-XLwuty5qmyA@mail.gmail.com>

Which version were you using? This was added in 1.1.0, released in May 2012.

You must still have an incorrect spring-rabbit jar on the classpath - I am
looking at the code in the 1.2.0 jar and it's clearly there.


On Fri, Nov 15, 2013 at 3:00 PM, PATAR, SAGAR <sp345s at att.com> wrote:

>  Thanks..
>
> I was dot using 1.2.0.RELEASE vesion of spring-rabbit and spring-amqp
> libraries and so was not able to see those options ..
>
> Now I was able to configure  the confirm-callback .. BUT for some reason
>
> The spring-rabbit (
> http://docs.spring.io/spring-amqp/api/org/springframework/amqp/rabbit/core/RabbitTemplate.html
> )
>
> Supports *send
> <http://docs.spring.io/spring-amqp/api/org/springframework/amqp/rabbit/core/RabbitTemplate.html#send(java.lang.String,%20java.lang.String,%20org.springframework.amqp.core.Message,%20org.springframework.amqp.rabbit.support.CorrelationData)>*
> (String<http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true>
>  exchange, String<http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true>
>  routingKey, Message<http://docs.spring.io/spring-amqp/api/org/springframework/amqp/core/Message.html>
>  message, CorrelationData<http://docs.spring.io/spring-amqp/api/org/springframework/amqp/rabbit/support/CorrelationData.html>
>  correlationData)
>
>
>
> But the spring-amqp jar?s doesn?t  has this method call ..
>
>
>
>
> <<SNIP>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/2510b7f6/attachment.htm>

From pierpaolo at dropbox.com  Sat Nov 16 04:24:03 2013
From: pierpaolo at dropbox.com (Pierpaolo Baccichet)
Date: Fri, 15 Nov 2013 20:24:03 -0800
Subject: [rabbitmq-discuss] Stats node getting slow
In-Reply-To: <CAKZAfCUo4Sd7TsheQHSao47ar_yducpeAg98bADACjJmq_BJPA@mail.gmail.com>
References: <CAKZAfCWqEj2QvXobCA6zFY3tX9_W7jmkj8vFo-32UQqvrHejFg@mail.gmail.com>
	<5280A71C.5050102@rabbitmq.com> <5280A8E6.6010506@rabbitmq.com>
	<CAKZAfCUo4Sd7TsheQHSao47ar_yducpeAg98bADACjJmq_BJPA@mail.gmail.com>
Message-ID: <CAKZAfCVPT5QHB1BY-tLcNmJGk-wJU__OdLUVOx1pSiDHayTwSA@mail.gmail.com>

Hello Simon, as promised we did an experiment today reverting to the old
config that enables fine grained stats and got the slowdown reproduced very
quickly. I dumped the output of the commands you asked us to run in the
attached files:

log_rabbit_1.txt: rabbitmqctl eval '[{T, [KV || KV = {K, _} <- I,
lists:member(K, [size, memory])]} || T <- ets:all(), I <- [ets:info(T)],
proplists:get_value(name, I) =:= rabbit_mgmt_db].'

log_rabbit2.txt: rabbitmqctl eval
'process_info(global:whereis_name(rabbit_mgmt_db),
memory).'

I have also the output of the rabbitmqctl report command but it contains a
lot of information that is leaking internal stuff so I can't really forward
it as a whole. Is there something specific you'd like to see from it?


On Mon, Nov 11, 2013 at 6:24 AM, Pierpaolo Baccichet
<pierpaolo at dropbox.com>wrote:

> Hello Simon,
>
> Thanks for the response and yeah, my gut feeling went as well toward a
> leak in that rewrite because in fact this issue started showing up when we
> upgraded to 3.1.x. We ended up disabling the fine-grained stats last friday
> as you mentioned in your last suggestion because people were getting paged
> a bit too often :) The current config is below
>
> [
>     {rabbit, [
>         {vm_memory_high_watermark, 0.75},
>         {cluster_nodes, [
>             'rabbit at xyz1',
>             'rabbit at xyz2',
>             'rabbit at xyz3'
>         ]},
>         {collect_statistics, coarse},
>         {collect_statistics_interval, 10000}
>     ]},
>     {rabbitmq_management_agent, [
>         {force_fine_statistics, false}
>     ]}
> ].
>
> I will give it a few more days with this config and then maybe revert to
> help you figure this issue. A related question, is there a way to
> programmatically figure which one is the stats node in the cluster? I could
> not find the config in the HTTP API
>
>
> On Mon, Nov 11, 2013 at 1:52 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> On 11/11/2013 9:45AM, Simon MacMullen wrote:
>>
>>> Hmm, the stats DB was more or less rewritten between 3.0.x and 3.1.0 (to
>>> keep stats histories). If there's a memory leak in there I'd very much
>>> like to get to the bottom of it.
>>>
>>
>> Of course the other possibility is that the stats DB is simply
>> overwhelmed with work and unable to keep up. It's supposed to start
>> dropping incoming stats messages in this situation, but maybe it isn't. To
>> determine if this is the case, look at:
>>
>> rabbitmqctl eval 'process_info(global:whereis_name(rabbit_mgmt_db),
>> memory).'
>>
>> - and if the number that comes back looks like it would account for most
>> of the memory used, then that is likely to be the problem. In that case you
>> can slow down stats event emission by changing collect_statistics_interval
>> (see http://www.rabbitmq.com/configure.html) and / or disable
>> fine-grained stats as I mentioned in the previous message.
>>
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131115/c915c4b9/attachment.htm>
-------------- next part --------------
[{1122389,[{memory,15013779},{size,173767}]},
 {1118292,[{memory,2224189},{size,80306}]},
 {1114195,[{memory,9766146},{size,111877}]},
 {1110098,[{memory,7419},{size,10}]},
 {1106001,[{memory,47570},{size,531}]},
 {1101904,[{memory,47570},{size,531}]},
 {1097807,[{memory,1153628},{size,15446}]},
 {1093710,[{memory,2441124},{size,15493}]},
 {1089558,[{memory,9378},{size,52}]}]
...done.
-------------- next part --------------
{memory,601162240}
...done.

From ryan at finnesey.com  Sat Nov 16 08:24:33 2013
From: ryan at finnesey.com (Ryan Finnesey)
Date: Sat, 16 Nov 2013 08:24:33 +0000
Subject: [rabbitmq-discuss] AMQP list?
Message-ID: <c23007dfc2f044e99e0b400d6839c547@BY2PR05MB079.namprd05.prod.outlook.com>

Is anyone aware of a list focused on AMQP?

Cheers
Ryan


From wmharshana at gmail.com  Sat Nov 16 11:19:38 2013
From: wmharshana at gmail.com (Harshana Weerasinghe)
Date: Sat, 16 Nov 2013 03:19:38 -0800 (PST)
Subject: [rabbitmq-discuss] Help for Add Subscription using RabbitHub
Message-ID: <f22855ab-f72f-47a9-9629-0c4bae4d2f75@googlegroups.com>

Hi All,

I'm new to RabbitMQ and RabbitHub and configured server and it's running 
good. I created Exchange using 

curl -X PUT http://localhost:15670/endpoint/x/NodeJsDemo 

when I create Subscription for that I'm getting error "Request verification 
failed: {request_status,404}"

I'm using 

curl -vd 
"hub.mode=subscribe&hub.callback=http://someServer.com:8182/Publish&hub.topic=NodeJsDemo&hub.verify=sync&hub.verify=async&hub.lease_seconds=600" 
http://localhost:15670/subscribe/x/NodeJsDemo

create to subscription. 

what I wanted to do is all the messages comes to the Exchange NodeJsDemo 
needs to be delivered to web API http://someServer.com:8182/Publish


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131116/33438325/attachment.htm>

From crohling88 at gmail.com  Sat Nov 16 14:54:33 2013
From: crohling88 at gmail.com (Christian Rohling)
Date: Sat, 16 Nov 2013 09:54:33 -0500
Subject: [rabbitmq-discuss] AMQP list?
In-Reply-To: <c23007dfc2f044e99e0b400d6839c547@BY2PR05MB079.namprd05.prod.outlook.com>
References: <c23007dfc2f044e99e0b400d6839c547@BY2PR05MB079.namprd05.prod.outlook.com>
Message-ID: <CALsYvrzbdgoyiC_JQjiDWkYLkToqjmWvaE8h39DMtDm2b1EkjA@mail.gmail.com>

https://www.oasis-open.org/committees/comments/index.php?wg_abbrev=amqp
http://lists.oasis-open.org/archives/amqp-comment/

Seems to be one, just based on googling


On Sat, Nov 16, 2013 at 3:24 AM, Ryan Finnesey <ryan at finnesey.com> wrote:

> Is anyone aware of a list focused on AMQP?
>
> Cheers
> Ryan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131116/8516a4c5/attachment.htm>

From michael.s.klishin at gmail.com  Sat Nov 16 16:43:09 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 16 Nov 2013 20:43:09 +0400
Subject: [rabbitmq-discuss] AMQP list?
In-Reply-To: <c23007dfc2f044e99e0b400d6839c547@BY2PR05MB079.namprd05.prod.outlook.com>
References: <c23007dfc2f044e99e0b400d6839c547@BY2PR05MB079.namprd05.prod.outlook.com>
Message-ID: <CAE3HoVR9j2-qgBR=95MmRm20U06aOfO7bkw6V_g=OaU4=PqGaw@mail.gmail.com>

2013/11/16 Ryan Finnesey <ryan at finnesey.com>

> Is anyone aware of a list focused on AMQP?


A good dozen of people who have implemented
AMQP 0-8, 0-9-0, 0-9-1, 1.0 and a range of client libraries for them are on
this list.

If your question is technical in nature, feel free to ask here.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131116/35ade152/attachment.htm>

From wmharshana at gmail.com  Sat Nov 16 16:57:09 2013
From: wmharshana at gmail.com (Harshana Weerasinghe)
Date: Sat, 16 Nov 2013 08:57:09 -0800 (PST)
Subject: [rabbitmq-discuss] Help for Add Subscription using RabbitHub
In-Reply-To: <f22855ab-f72f-47a9-9629-0c4bae4d2f75@googlegroups.com>
References: <f22855ab-f72f-47a9-9629-0c4bae4d2f75@googlegroups.com>
Message-ID: <e7778e0e-9ba6-4a33-aff2-ae723bcafb95@googlegroups.com>

I fixed the issue returning hub.challenge value in the query string in the 
GET request.

On Saturday, November 16, 2013 4:49:38 PM UTC+5:30, Harshana Weerasinghe 
wrote:
>
> Hi All,
>
> I'm new to RabbitMQ and RabbitHub and configured server and it's running 
> good. I created Exchange using 
>
> curl -X PUT http://localhost:15670/endpoint/x/NodeJsDemo 
>
> when I create Subscription for that I'm getting error "Request 
> verification failed: {request_status,404}"
>
> I'm using 
>
> curl -vd "hub.mode=subscribe&hub.callback=
> http://someServer.com:8182/Publish&hub.topic=NodeJsDemo&hub.verify=sync&hub.verify=async&hub.lease_seconds=600" 
> http://localhost:15670/subscribe/x/NodeJsDemo
>
> create to subscription. 
>
> what I wanted to do is all the messages comes to the Exchange NodeJsDemo 
> needs to be delivered to web API http://someServer.com:8182/Publish
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131116/29f86436/attachment.htm>

From ryan at finnesey.com  Sat Nov 16 18:11:48 2013
From: ryan at finnesey.com (Ryan Finnesey)
Date: Sat, 16 Nov 2013 18:11:48 +0000
Subject: [rabbitmq-discuss] AMQP list?
In-Reply-To: <CALsYvrzbdgoyiC_JQjiDWkYLkToqjmWvaE8h39DMtDm2b1EkjA@mail.gmail.com>
References: <c23007dfc2f044e99e0b400d6839c547@BY2PR05MB079.namprd05.prod.outlook.com>
	<CALsYvrzbdgoyiC_JQjiDWkYLkToqjmWvaE8h39DMtDm2b1EkjA@mail.gmail.com>
Message-ID: <de240008dcc34914bb38c455f7acb8cd@BY2PR05MB079.namprd05.prod.outlook.com>

I did find that list as well via Google but when I read the list description I did not feel it was dissection based more to provide feedback to the  OASIS/AMOP Committee.

Cheers
Ryan


From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Christian Rohling
Sent: Saturday, November 16, 2013 9:55 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] AMQP list?

https://www.oasis-open.org/committees/comments/index.php?wg_abbrev=amqp
http://lists.oasis-open.org/archives/amqp-comment/

Seems to be one, just based on googling

On Sat, Nov 16, 2013 at 3:24 AM, Ryan Finnesey <ryan at finnesey.com<mailto:ryan at finnesey.com>> wrote:
Is anyone aware of a list focused on AMQP?

Cheers
Ryan

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131116/a60d09dc/attachment.htm>

From ryan at finnesey.com  Sat Nov 16 19:16:39 2013
From: ryan at finnesey.com (Ryan Finnesey)
Date: Sat, 16 Nov 2013 19:16:39 +0000
Subject: [rabbitmq-discuss] AMQP list?
In-Reply-To: <CAE3HoVR9j2-qgBR=95MmRm20U06aOfO7bkw6V_g=OaU4=PqGaw@mail.gmail.com>
References: <c23007dfc2f044e99e0b400d6839c547@BY2PR05MB079.namprd05.prod.outlook.com>
	<CAE3HoVR9j2-qgBR=95MmRm20U06aOfO7bkw6V_g=OaU4=PqGaw@mail.gmail.com>
Message-ID: <6bebfb2cdbd14285abaa536a71b00f31@BY2PR05MB079.namprd05.prod.outlook.com>

Great?? I am trying to confirm if there is a AMQP client library for Windows Phone 7/8 and or Windows Mobile 6.5.

Cheers
Ryan


From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: Saturday, November 16, 2013 11:43 AM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] AMQP list?

2013/11/16 Ryan Finnesey <ryan at finnesey.com<mailto:ryan at finnesey.com>>
Is anyone aware of a list focused on AMQP?

A good dozen of people who have implemented
AMQP 0-8, 0-9-0, 0-9-1, 1.0 and a range of client libraries for them are on this list.

If your question is technical in nature, feel free to ask here.
--
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131116/cd3ecff5/attachment.htm>

From nolandubeau at gmail.com  Sat Nov 16 13:54:48 2013
From: nolandubeau at gmail.com (Nolan Dubeau)
Date: Sat, 16 Nov 2013 05:54:48 -0800 (PST)
Subject: [rabbitmq-discuss] Logging all messages all the time
In-Reply-To: <0d871e26-8963-425f-9862-907d1ddf23b8@googlegroups.com>
References: <0d871e26-8963-425f-9862-907d1ddf23b8@googlegroups.com>
Message-ID: <ab1d4e98-e27f-4f37-86e7-5809fcace9fc@googlegroups.com>

Hi Chris,

I'm new to RabbitMQ, but came across this recently which seems to fit your 
use case - https://github.com/jbrisbin/riak-exchange.  Once the data is 
logged to Riak, there may be a way to do a post-commit hook from Riak to 
Logly or Splunk, or run some sort of schedule to do the transfer.  

Nolan

On Thursday, 14 November 2013 17:46:55 UTC-4, Chris McKenzie wrote:
>
> We're using a RabbitMQ server for messaging between applications. We have 
> a need to create a central log for all amqp messages coming into the Rabbit 
> server. Our purpose is not temporary debugging, but rather auditability. 
> Ideally, I'd be able to log to a specified file to begin with, and later 
> log to an external system such as Logly or Splunk.
>
> I've explored turning on Firehose and using the tracing plugin, but the 
> queues in question are not durable. I'm also not sure if these solutions 
> will work if new queues and exchanges are added to the virtual host after 
> logging hast started. These tools seem designed more for temporary 
> debugging than what I need.
>
> I'd love to hear your ideas. At this point I'm worried I'll have to setup 
> a network monitor to intercept and log the messages before they reach 
> Rabbit.
>
> I asked this question on stackoverflow here: 
>
>
> http://stackoverflow.com/questions/19937345/how-to-log-all-rabbit-mq-messages?noredirect=1#comment29682873_19937345
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131116/72742e0b/attachment.htm>

From Punit.Jain at emc.com  Mon Nov 18 06:16:02 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Mon, 18 Nov 2013 01:16:02 -0500
Subject: [rabbitmq-discuss] SSL: error on AMQP connection
In-Reply-To: <6796F7EA-29B0-456A-B245-8369B0030A0A@rabbitmq.com>
References: <DB14E94115BBC84E8960C12C176D067601779CABB9@MX25A.corp.emc.com>
	<6796F7EA-29B0-456A-B245-8369B0030A0A@rabbitmq.com>
Message-ID: <DB14E94115BBC84E8960C12C176D067601779CAC98@MX25A.corp.emc.com>

Hi Michael,
I was able to fix it, but I had to add {password, "XXXXX"} in the config file. The password is used for key, probably for decryption. But putting the password in config file is not advisable. Is there any other way I can get this working?

Thanks,
Punit 

> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-
> bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
> Sent: Friday, November 15, 2013 4:45 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] SSL: error on AMQP connection
> 
> On 15 Nov 2013, at 09:32, Jain, Punit <Punit.Jain at emc.com> wrote:
> 
> > error on AMQP connection <0.547.0>: {ssl_upgrade_error,ekeyfile} (unknown
> POSIX error)
> 
> Erlang's SSL module rejects the private key.
> 
> MK
> 
> Software Engineer, Pivotal/RabbitMQ
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From emile at rabbitmq.com  Mon Nov 18 09:19:20 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 18 Nov 2013 09:19:20 +0000
Subject: [rabbitmq-discuss] SSL: error on AMQP connection
In-Reply-To: <DB14E94115BBC84E8960C12C176D067601779CAC98@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D067601779CABB9@MX25A.corp.emc.com>
	<6796F7EA-29B0-456A-B245-8369B0030A0A@rabbitmq.com>
	<DB14E94115BBC84E8960C12C176D067601779CAC98@MX25A.corp.emc.com>
Message-ID: <5289DB98.9070006@rabbitmq.com>

Hi,

On 18/11/13 06:16, Jain, Punit wrote:

> I was able to fix it, but I had to add {password, "XXXXX"} in the
> config file. The password is used for key, probably for decryption.
> But putting the password in config file is not advisable. Is there
> any other way I can get this working?


The alternative is to use a key that does not require a password.



-Emile



From simon at rabbitmq.com  Mon Nov 18 09:26:57 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 18 Nov 2013 09:26:57 +0000
Subject: [rabbitmq-discuss] RabbitMQ 3.2.1 fails to start with
 management plugin enabled
In-Reply-To: <50E35C892351D542B755E41103C9367F5BE9FB26@INWPIEXC02.SATS.CORP>
References: <50E35C892351D542B755E41103C9367F5BE9FB26@INWPIEXC02.SATS.CORP>
Message-ID: <5289DD61.9040208@rabbitmq.com>

On 15/11/2013 17:52, Yarborough, Allan wrote:
>     {could_not_start,amqp_client,
>         {{supervisor_data,{invalid_strategy,simple_one_for_one_terminate}},
>          {amqp_client,start,[normal,[]]}}}

Somehow your Erlang path contains an old version of the RabbitMQ Erlang 
Client. This is built into the server and used by many plugins 
(including management).

We've seen this before on some RPM-based distro, they had "helpfully" 
packaged the Erlang client separately (but installed it in 
/usr/lib/erlang/lib/ where it was loaded for all Erlang applications). I 
hope this hasn't happened in Debian too.

Cheers, Simon


From emile at rabbitmq.com  Mon Nov 18 09:36:57 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 18 Nov 2013 09:36:57 +0000
Subject: [rabbitmq-discuss] AMQP list?
In-Reply-To: <6bebfb2cdbd14285abaa536a71b00f31@BY2PR05MB079.namprd05.prod.outlook.com>
References: <c23007dfc2f044e99e0b400d6839c547@BY2PR05MB079.namprd05.prod.outlook.com>
	<CAE3HoVR9j2-qgBR=95MmRm20U06aOfO7bkw6V_g=OaU4=PqGaw@mail.gmail.com>
	<6bebfb2cdbd14285abaa536a71b00f31@BY2PR05MB079.namprd05.prod.outlook.com>
Message-ID: <5289DFB9.7050907@rabbitmq.com>

On 16/11/13 19:16, Ryan Finnesey wrote:
> Great?? I am trying to confirm if there is a AMQP client library for
> Windows Phone 7/8 and or Windows Mobile 6.5. 

I can confirm that the RabbitMQ .net client won't work with the Compact
Framework: http://markmail.org/message/q7kgadi25a72dhkd
You should be able to compile the AMQP C client for those platforms.

You should consider whether you require the full generality of AMQP on
the client side. A simpler protocol such as STOMP is better suited to a
mobile platform.




-Emile




From tim at rabbitmq.com  Mon Nov 18 10:32:39 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Mon, 18 Nov 2013 10:32:39 +0000
Subject: [rabbitmq-discuss] SSL connection - ASN1 error
In-Reply-To: <ABBDC9D7002EB54AB98BA60DA16D26934295BCA3@FR44EX3003.global.ds.honeywell.com>
References: <ABBDC9D7002EB54AB98BA60DA16D269333FF7171@FR44EX3003.global.ds.honeywell.com>
	<524A9911.6040603@rabbitmq.com>
	<ABBDC9D7002EB54AB98BA60DA16D269333FF71E1@FR44EX3003.global.ds.honeywell.com>
	<BE8B2303-7B48-4EEE-B758-D679EFB8C999@rabbitmq.com>
	<ABBDC9D7002EB54AB98BA60DA16D26934295B432@FR44EX3003.global.ds.honeywell.com>
	<F0867114-7F45-40BB-AF6A-7A6860D05256@rabbitmq.com>
	<ABBDC9D7002EB54AB98BA60DA16D26934295BCA3@FR44EX3003.global.ds.honeywell.com>
Message-ID: <531212E8-5EEC-40AD-B837-5DFE655F77BE@rabbitmq.com>

Hi Michal,

What does this swim_cm_connector module look like? Are you sure it's pointing to the correct certificates when establishing the connection?

Cheers,
Tim

From simon at rabbitmq.com  Mon Nov 18 11:23:31 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 18 Nov 2013 11:23:31 +0000
Subject: [rabbitmq-discuss] Stats node getting slow
In-Reply-To: <CAKZAfCVPT5QHB1BY-tLcNmJGk-wJU__OdLUVOx1pSiDHayTwSA@mail.gmail.com>
References: <CAKZAfCWqEj2QvXobCA6zFY3tX9_W7jmkj8vFo-32UQqvrHejFg@mail.gmail.com>
	<5280A71C.5050102@rabbitmq.com> <5280A8E6.6010506@rabbitmq.com>
	<CAKZAfCUo4Sd7TsheQHSao47ar_yducpeAg98bADACjJmq_BJPA@mail.gmail.com>
	<CAKZAfCVPT5QHB1BY-tLcNmJGk-wJU__OdLUVOx1pSiDHayTwSA@mail.gmail.com>
Message-ID: <5289F8B3.5040004@rabbitmq.com>

Hi Pierpaulo, thanks for that. So we can see from those outputs that the 
vast majority of memory used is process memory rather than ETS. So it 
looks like the management database is simply failing to keep up with 
inbound messages. This is slightly disappointing because it contains an 
emergency mechanism that is supposed to drop messages when it's getting 
overwhelmed. So I'd like to find out more about your workload.

That's what I was hoping to get from "rabbitmqctl report". If you can't 
send that to me direct then I'd like to know how many connections, 
channels and queues you have, as well as the approximate churn rate for 
each of those, and the degree of fanout (i.e. for each channel, how many 
queues does it publish to / consume from?)

Also: have you tried increasing collect_statistics_interval? I suspect 
that would improve things for you.

Cheers, Simon

On 16/11/2013 04:24, Pierpaolo Baccichet wrote:
> Hello Simon, as promised we did an experiment today reverting to the old
> config that enables fine grained stats and got the slowdown reproduced
> very quickly. I dumped the output of the commands you asked us to run in
> the attached files:
>
> log_rabbit_1.txt: rabbitmqctl eval '[{T, [KV || KV = {K, _} <- I,
> lists:member(K, [size, memory])]} || T <- ets:all(), I <- [ets:info(T)],
> proplists:get_value(name, I) =:= rabbit_mgmt_db].'
>
> log_rabbit2.txt: rabbitmqctl eval
> 'process_info(global:whereis___name(rabbit_mgmt_db), memory).'
>
> I have also the output of the rabbitmqctl report command but it contains
> a lot of information that is leaking internal stuff so I can't really
> forward it as a whole. Is there something specific you'd like to see
> from it?
>
>
> On Mon, Nov 11, 2013 at 6:24 AM, Pierpaolo Baccichet
> <pierpaolo at dropbox.com <mailto:pierpaolo at dropbox.com>> wrote:
>
>     Hello Simon,
>
>     Thanks for the response and yeah, my gut feeling went as well toward
>     a leak in that rewrite because in fact this issue started showing up
>     when we upgraded to 3.1.x. We ended up disabling the fine-grained
>     stats last friday as you mentioned in your last suggestion because
>     people were getting paged a bit too often :) The current config is below
>
>     [
>          {rabbit, [
>              {vm_memory_high_watermark, 0.75},
>              {cluster_nodes, [
>                  'rabbit at xyz1',
>                  'rabbit at xyz2',
>                  'rabbit at xyz3'
>              ]},
>              {collect_statistics, coarse},
>              {collect_statistics_interval, 10000}
>          ]},
>          {rabbitmq_management_agent, [
>              {force_fine_statistics, false}
>          ]}
>     ].
>
>     I will give it a few more days with this config and then mayberevert
>     to help you figure this issue. A related question, is there a way to
>     programmatically figure which one is the stats node in the cluster?
>     I could not find the config in the HTTP API
>
>
>     On Mon, Nov 11, 2013 at 1:52 AM, Simon MacMullen <simon at rabbitmq.com
>     <mailto:simon at rabbitmq.com>> wrote:
>
>         On 11/11/2013 9:45AM, Simon MacMullen wrote:
>
>             Hmm, the stats DB was more or less rewritten between 3.0.x
>             and 3.1.0 (to
>             keep stats histories). If there's a memory leak in there I'd
>             very much
>             like to get to the bottom of it.
>
>
>         Of course the other possibility is that the stats DB is simply
>         overwhelmed with work and unable to keep up. It's supposed to
>         start dropping incoming stats messages in this situation, but
>         maybe it isn't. To determine if this is the case, look at:
>
>         rabbitmqctl eval
>         'process_info(global:whereis___name(rabbit_mgmt_db), memory).'
>
>         - and if the number that comes back looks like it would account
>         for most of the memory used, then that is likely to be the
>         problem. In that case you can slow down stats event emission by
>         changing collect_statistics_interval (see
>         http://www.rabbitmq.com/__configure.html
>         <http://www.rabbitmq.com/configure.html>) and / or disable
>         fine-grained stats as I mentioned in the previous message.
>
>
>         Cheers, Simon
>
>         --
>         Simon MacMullen
>         RabbitMQ, Pivotal
>
>
>


From mklishin at gopivotal.com  Mon Nov 18 12:15:05 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 18 Nov 2013 16:15:05 +0400
Subject: [rabbitmq-discuss] Failed to start RabbitMq and crash OS
	booting (debian)
In-Reply-To: <b2f4eb62-e117-4826-8d1d-280cf5f15955@googlegroups.com>
References: <b2f4eb62-e117-4826-8d1d-280cf5f15955@googlegroups.com>
Message-ID: <EB47F7B5-250E-4FD5-A0F9-1619D019A1FA@rabbitmq.com>

On 7 Nov 2013, at 14:23, l_ulrich2002 at yahoo.fr wrote:

> I experienced something weird on my developpement server.
> RabbitMQ don't start and block my OS booting process, 
> 
> I'm using Debian Sqeeze and deb paquet of RabbitMQ server, not Debian paquet.
> 
> I mount /var/log on tmpfs and directory is fresh each time I start my laptop.
> This is the problem, rabbitmq starting script (in /etc/init.d/rabbitmq-server) assume that dir /var/log/rabbitmq exists but in my case it doesn't.
> 
> I added on top of the srcipt after variable declaration a test if dir exists and if not I create it.
> With this patch, RabbitMQ don't failed anymore.

Interesting. RabbitMQ will try to create parent directories but perhaps its user doesn?t have
sufficient permissions.

Can you please post what is logged when RabbitMQ fails to start?

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Mon Nov 18 12:23:50 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 18 Nov 2013 16:23:50 +0400
Subject: [rabbitmq-discuss] Failed to start RabbitMq and crash OS
	booting (debian)
In-Reply-To: <EB47F7B5-250E-4FD5-A0F9-1619D019A1FA@rabbitmq.com>
References: <b2f4eb62-e117-4826-8d1d-280cf5f15955@googlegroups.com>
	<EB47F7B5-250E-4FD5-A0F9-1619D019A1FA@rabbitmq.com>
Message-ID: <1DB12494-E36A-4EB9-BD80-8572CBE6AAA2@gopivotal.com>


On 18 Nov 2013, at 16:15, Michael Klishin <mklishin at gopivotal.com> wrote:

> Can you please post what is logged when RabbitMQ fails to start?

Also, it would be helpful to know how you mount /var/log in order to reproduce the problem
more closely.
--
MK

Software Engineer, Pivotal/RabbitMQ


From mklishin at gopivotal.com  Mon Nov 18 12:49:00 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 18 Nov 2013 16:49:00 +0400
Subject: [rabbitmq-discuss] ANN Bunny 1.0.4 is released
Message-ID: <F1A8B6BF-E068-4B24-9457-18D141757638@rabbitmq.com>

Bunny 1.0.4 is released [1] to rubygems.org.

This is a bug fix release. Release notes:
http://blog.rubyrabbitmq.info/blog/2013/11/18/bunny-1-dot-0-4-is-released/

1. https://rubygems.org/gems/bunny/versions/1.0.4

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Mon Nov 18 12:51:16 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Mon, 18 Nov 2013 16:51:16 +0400
Subject: [rabbitmq-discuss] ANN March Hare 2.0.0.rc5 is released
Message-ID: <4CF530B0-9676-4C9A-B183-4FB132869F4E@rabbitmq.com>

March Hare (formerly Hot Bunnies) 2.0.0.rc5 is released [1] to rubygems.org.

This RC fixes several issues with automatic connection recovery.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/11/16/march-hare-2-dot-0-0-dot-rc5-is-released/

This is hopefully the last RC. Please give it a try and report any issues you find!

1. https://rubygems.org/gems/march_hare/versions/2.0.0.rc5-java

MK

Software Engineer, Pivotal/RabbitMQ



From Antaflex at xen.chassiswippien.com  Mon Nov 18 14:16:14 2013
From: Antaflex at xen.chassiswippien.com (Anataflex)
Date: Mon, 18 Nov 2013 09:16:14 -0500
Subject: [rabbitmq-discuss] Joints Hurt? Try This (RE:
	rabbitmq-discuss@lists.rabbitmq.com)
Message-ID: <0.0.0.9C5.1CEE468BD6C1D28.6A5E31@xen.chassiswippien.com>


,
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131118/7872d20f/attachment.htm>

From sp345s at att.com  Mon Nov 18 15:36:43 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Mon, 18 Nov 2013 15:36:43 +0000
Subject: [rabbitmq-discuss] no error or exception
In-Reply-To: <CADtU9_vbwTz3WT8HD-z7N9OFYyhbiazkhZUpJL-XLwuty5qmyA@mail.gmail.com>
References: <59BF56992750434F89F8EBE141E64B1D018358D7@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<5286238D.4010806@rabbitmq.com>
	<59BF56992750434F89F8EBE141E64B1D0183594F@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<CADtU9_u7Mc2Uyk2r4wne3eLXRO=QbAepm4yeMiz9KHoVtiT4LA@mail.gmail.com>
	<59BF56992750434F89F8EBE141E64B1D01835971@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<CADtU9_vbwTz3WT8HD-z7N9OFYyhbiazkhZUpJL-XLwuty5qmyA@mail.gmail.com>
Message-ID: <59BF56992750434F89F8EBE141E64B1D01835C7D@GAALPA1MSGUSR9C.ITServices.sbc.com>

Below are the jar's I am using .. the version is 1.2.0.RELEASE ..

spring-amqp-1.2.0.RELEASE.jar
spring-rabbit-1.2.0.RELEASE.jar

org.springframework.amqp.core. AmqpTemplate  .. doesn't seems to have a send() method which takes CorrelationData  ..
but the RabbitTemplate has the method ..

From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Gary Russell
Sent: Friday, November 15, 2013 3:42 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] no error or exception

Which version were you using? This was added in 1.1.0, released in May 2012.

You must still have an incorrect spring-rabbit jar on the classpath - I am looking at the code in the 1.2.0 jar and it's clearly there.

On Fri, Nov 15, 2013 at 3:00 PM, PATAR, SAGAR <sp345s at att.com<mailto:sp345s at att.com>> wrote:
Thanks..
I was dot using 1.2.0.RELEASE vesion of spring-rabbit and spring-amqp  libraries and so was not able to see those options ..
Now I was able to configure  the confirm-callback .. BUT for some reason
The spring-rabbit (http://docs.spring.io/spring-amqp/api/org/springframework/amqp/rabbit/core/RabbitTemplate.html)
Supports send<http://docs.spring.io/spring-amqp/api/org/springframework/amqp/rabbit/core/RabbitTemplate.html#send(java.lang.String,%20java.lang.String,%20org.springframework.amqp.core.Message,%20org.springframework.amqp.rabbit.support.CorrelationData)>(String<http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true> exchange, String<http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true> routingKey, Message<http://docs.spring.io/spring-amqp/api/org/springframework/amqp/core/Message.html> message, CorrelationData<http://docs.spring.io/spring-amqp/api/org/springframework/amqp/rabbit/support/CorrelationData.html> correlationData)

But the spring-amqp jar's doesn't  has this method call ..


<<SNIP>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131118/565546fe/attachment.htm>

From emile at rabbitmq.com  Mon Nov 18 16:16:08 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 18 Nov 2013 16:16:08 +0000
Subject: [rabbitmq-discuss] rabbit_stomp_reader ssl_upgrade_error
In-Reply-To: <1384398553.68368.YahooMailNeo@web133106.mail.ir2.yahoo.com>
References: <1384396116.15819.YahooMailNeo@web133103.mail.ir2.yahoo.com>
	<1384398553.68368.YahooMailNeo@web133106.mail.ir2.yahoo.com>
Message-ID: <528A3D48.4070506@rabbitmq.com>

On 14/11/13 03:09, Antony Mayi wrote:
> btw. just upgraded to erlang R16B02 and rabbitmq 3.2.1 but still getting
> the same error...

>     CONNECTED(00000003)
>     139852982814536:error:14094438:SSL routines:SSL3_READ_BYTES:tlsv1
>     alert internal error:s3_pkt.c:1197:SSL alert number 80
>     139852982814536:error:140790E5:SSL routines:SSL23_WRITE:ssl
>     handshake failure:s23_lib.c:184:

I'm afraid that is a pretty nondescript error, making it very difficult
to provide an accurate diagnosis. I would suggest temporarily turning
off peer verification to see if that helps and comparing the certificate
with a known-to-work certificate. Also try using a separate client
certificate.



-Emile





From grussell at gopivotal.com  Mon Nov 18 16:44:53 2013
From: grussell at gopivotal.com (Gary Russell)
Date: Mon, 18 Nov 2013 11:44:53 -0500
Subject: [rabbitmq-discuss] no error or exception
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D01835C7D@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D018358D7@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<5286238D.4010806@rabbitmq.com>
	<59BF56992750434F89F8EBE141E64B1D0183594F@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<CADtU9_u7Mc2Uyk2r4wne3eLXRO=QbAepm4yeMiz9KHoVtiT4LA@mail.gmail.com>
	<59BF56992750434F89F8EBE141E64B1D01835971@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<CADtU9_vbwTz3WT8HD-z7N9OFYyhbiazkhZUpJL-XLwuty5qmyA@mail.gmail.com>
	<59BF56992750434F89F8EBE141E64B1D01835C7D@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <CADtU9_svfYxcumJ04bYyCNt8nnYkvSquZ+t12HHxDuDwALogrg@mail.gmail.com>

Right - confirms are provided by an extension to AMQP

http://www.rabbitmq.com/extensions.html

So the method is not available on the general abstraction, you have to use
a RabbitTemplate (which is a Rabbit-specific implementation of the
AmqpTemplate interface).


On Mon, Nov 18, 2013 at 10:36 AM, PATAR, SAGAR <sp345s at att.com> wrote:

>  Below are the jar?s I am using .. the version is 1.2.0.RELEASE ..
>
>
>
> spring-amqp-1.2.0.RELEASE.jar
>
> spring-rabbit-1.2.0.RELEASE.jar
>
>
>
> org.springframework.amqp.core. AmqpTemplate  .. doesn?t seems to have a
> send() method which takes CorrelationData  ..
>
> but the RabbitTemplate has the method ..
>
>
>
> *From:* rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:
> rabbitmq-discuss-bounces at lists.rabbitmq.com] *On Behalf Of *Gary Russell
> *Sent:* Friday, November 15, 2013 3:42 PM
> *To:* Discussions about RabbitMQ
> *Subject:* Re: [rabbitmq-discuss] no error or exception
>
>
>
> Which version were you using? This was added in 1.1.0, released in May
> 2012.
>
>
>
> You must still have an incorrect spring-rabbit jar on the classpath - I am
> looking at the code in the 1.2.0 jar and it's clearly there.
>
>
>
> On Fri, Nov 15, 2013 at 3:00 PM, PATAR, SAGAR <sp345s at att.com> wrote:
>
> Thanks..
>
> I was dot using 1.2.0.RELEASE vesion of spring-rabbit and spring-amqp
> libraries and so was not able to see those options ..
>
> Now I was able to configure  the confirm-callback .. BUT for some reason
>
> The spring-rabbit (
> http://docs.spring.io/spring-amqp/api/org/springframework/amqp/rabbit/core/RabbitTemplate.html
> )
>
> Supports *send
> <http://docs.spring.io/spring-amqp/api/org/springframework/amqp/rabbit/core/RabbitTemplate.html#send(java.lang.String,%20java.lang.String,%20org.springframework.amqp.core.Message,%20org.springframework.amqp.rabbit.support.CorrelationData)>*
> (String<http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true>
>  exchange, String<http://docs.oracle.com/javase/6/docs/api/java/lang/String.html?is-external=true>
>  routingKey, Message<http://docs.spring.io/spring-amqp/api/org/springframework/amqp/core/Message.html>
>  message, CorrelationData<http://docs.spring.io/spring-amqp/api/org/springframework/amqp/rabbit/support/CorrelationData.html>
>  correlationData)
>
>
>
> But the spring-amqp jar?s doesn?t  has this method call ..
>
>
>
>
>
> <<SNIP>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131118/c80e87c0/attachment.htm>

From sp345s at att.com  Mon Nov 18 17:16:49 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Mon, 18 Nov 2013 17:16:49 +0000
Subject: [rabbitmq-discuss] access control
Message-ID: <59BF56992750434F89F8EBE141E64B1D01835CBF@GAALPA1MSGUSR9C.ITServices.sbc.com>


I have a topic "demo.account.topic" and 2 users "demo" and "test".. configured on rabbitMQ 3.1.5

For "demo" user the permission expression for configure, read, write - "demo.*"

For "test" user the permission expression for configure, read, write - "test.*"

I have a ConfirmCallback configured.. When sending messages using user "demo" on "demo.account.topic" exchange I see confirm method being called back and also see the spike on message rate in the management console ...GOOD ...
but when I use "test" user .. I don't see any exception and it just hangs there .. no spike on the console and no confirm method was called back  ... NOT sure but I was expecting an exception when "test" user was trying to send a message as he doesn't have access too ..

When read the messages ..using "demo" user on "demo.account.topic" exchange ..I see a channel exception and on console the channel count is "0" with permission expression for configure, read, write - "demo.*"

channel error; reason: {#method<channel.close>(reply-code=404, reply-text=NOT_FOUND - no queue '8c39360e-0d72-436a-9de2-c06f6a5cec58' in vhost '/', class-id=50, method-id=10), null, ""}

When I change the configure permission to ".*" and leave the read and write to "demo.*" .. Below is exception but was able to see a new dynamic queue created in the console with no binding .. channel count is "1" on console ..

channel error; reason: {#method<channel.close>(reply-code=403, reply-text=ACCESS_REFUSED - access to queue 'bb771ff2-67ea-452e-a98f-163467469af9' in vhost '/' refused for user 'dlcore', class-id=60, method-id=20), null, ""}

When I change the configure, write permission to ".*" and leave the read to "demo.*" ..  Below is the exception but was able to see a new dynamic queue created in the console with binding and messages were flowing through this queue ..but the consumer was not able to consume them ..

channel error; reason: {#method<channel.close>(reply-code=403, reply-text=ACCESS_REFUSED - access to queue '65eda6e4-1ec0-482e-93e5-fd0d247412b4' in vhost '/' refused for user 'dlcore', class-id=60, method-id=20), null, ""}

My requirement is to be able to configure new queues dynamically and consume the message based on the permissions.. I am using the management console to set Permissions ..

Appreciate all the help ..

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131118/465499b0/attachment.htm>

From wmharshana at gmail.com  Mon Nov 18 18:48:18 2013
From: wmharshana at gmail.com (Harshana Weerasinghe)
Date: Mon, 18 Nov 2013 10:48:18 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitHub Help
Message-ID: <86c667c7-c27f-42d3-a246-adfe43543c42@googlegroups.com>

Hi,

I've created 1 Exchange and Subscribe to that for one URL and I created 2 
queues as per http://www.cloudamqp.com/docs-delayed-messages.html for 
delayed messages. and subscribed to another URL in same server.
after that I deleted the both queues created for delayed messages through 
DELETE HTTP request. but the subscription I created 1st also getting 
deleted. 

appreciate if you can help to resolve this issue. I've attached log file 
herewith.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131118/ba18648d/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit at s27RabbitMQsc.log
Type: application/octet-stream
Size: 37504 bytes
Desc: not available
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131118/ba18648d/attachment.obj>

From brett.r.cameron at gmail.com  Mon Nov 18 21:46:07 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Tue, 19 Nov 2013 10:46:07 +1300
Subject: [rabbitmq-discuss] RabbitHub Help
In-Reply-To: <86c667c7-c27f-42d3-a246-adfe43543c42@googlegroups.com>
References: <86c667c7-c27f-42d3-a246-adfe43543c42@googlegroups.com>
Message-ID: <CALPqkip9uj2dsMETiu6w_pq_9O9THtf97CPNKGqoe+XjTKi1nA@mail.gmail.com>

It is a little hard to say for sure just from the information in the log;
however it looks like that first subscription (on the exchange
"NodeJsNotification") is getting deleted for legitimate reasons. The
subscription could get deleted as a consequence of the endpoint becoming
unavailable, or due to the lease expiring, or it could have been explicitly
deleted via an unsubscribe request. I do not believe that the lease has
expired, but there's not really enough information to say which of the
other two options might have caused the subscription to get deleted.

There is also some funny stuff in the log (which may or may not be relevant
to tracking down the problem). It looks like you register to the exchange
"NodeJsNotification" several times using the same callback URL, which
causes RabbitHub to report "duplicates". This is not a problem. I can then
see your initial subscription to a queue with a nice long name, and not
long afterwards I see the subscription to the queue get terminated, most
likely because you have deleted the queue (as per your email). There are
then a whole pile of errors indicating that you are trying to subscribe to
the queue that has just been deleted (queue_not_found errors). As I say,
these details are not related to the "NodeJsNotification" subscription
getting deleted, but these observations may help to narrow down what is
going on.

Brett




On Tue, Nov 19, 2013 at 7:48 AM, Harshana Weerasinghe
<wmharshana at gmail.com>wrote:

> Hi,
>
> I've created 1 Exchange and Subscribe to that for one URL and I created 2
> queues as per http://www.cloudamqp.com/docs-delayed-messages.html for
> delayed messages. and subscribed to another URL in same server.
> after that I deleted the both queues created for delayed messages through
> DELETE HTTP request. but the subscription I created 1st also getting
> deleted.
>
> appreciate if you can help to resolve this issue. I've attached log file
> herewith.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/a4ab2158/attachment.htm>

From kirankumar.pnm at gmail.com  Mon Nov 18 21:50:17 2013
From: kirankumar.pnm at gmail.com (Kiran Kumar)
Date: Mon, 18 Nov 2013 13:50:17 -0800 (PST)
Subject: [rabbitmq-discuss] Issue in sending binary data using
	amqp_basic_publish API.
Message-ID: <e00d150b-0d40-4a9b-ba72-e26939ae7298@googlegroups.com>

I have a rabbitmq server running on my debian linux machine. I have a BGP 
process running and it prepared a Route Message using google protocol 
buffers. The protocol buffer returns a binary data buffer.

Then I have below code to send this data to rabbitmq server. When I execute 
this, the process crashes on amqp_basic_publish call. 

Any thoughts on this ? Am I missing some thing here ?


int bgp_mq_send(char const* rt_msg, int size)
{
    static int init_done = 0;
    int status;
    amqp_socket_t *socket = NULL;
    amqp_connection_state_t conn = NULL;
    amqp_rpc_reply_t reply;

    if (init_done == 0) {
        conn = amqp_new_connection();

        socket = amqp_tcp_socket_new(conn);
        if (!socket) {
            printf("\n socket creation failed\n");
            return 1;
        }

        status = amqp_socket_open(socket, "localhost", 5672);
        if (status) {
            printf("\n socket open failed\n");
            return 1;
        }

        reply = amqp_login(conn, "/", 0, 131072, 0, AMQP_SASL_METHOD_PLAIN, 
"guest", "guest");
        if (reply.reply_type) {
            printf("\n Login is failed\n");
        }

        amqp_channel_open(conn, 1);
        reply = amqp_get_rpc_reply(conn);
        if (reply.reply_type) {
            printf("\n get_reply failed\n");
        }
        init_done = 1;
    }


    {
        amqp_basic_properties_t props;
        props._flags = AMQP_BASIC_CONTENT_TYPE_FLAG |    
AMQP_BASIC_DELIVERY_MODE_FLAG;
        props.content_type = amqp_cstring_bytes("gpb");
        props.content_encoding = amqp_cstring_bytes("binary");
        props.delivery_mode = 2; /* persistent delivery mode */

        amqp_bytes_t str2;
        str2.len = size;
        str2.bytes = rt_msg;

        status = amqp_basic_publish(conn, 1, 
amqp_cstring_bytes("amq.fanout"),
                        amqp_cstring_bytes("#"), 0, 0,
                        &props, str2);  *<<<----------- It crashes right 
here.*   

        if (status < 0) {
            printf("\n publish failed\n");
        }
        printf("\n Publish success\n");
    }
    reply = amqp_channel_close(conn, 1, AMQP_REPLY_SUCCESS);
    if (reply.reply_type) {
        printf("\n chan close failed\n");
    }
    reply = amqp_connection_close(conn, AMQP_REPLY_SUCCESS);
    if (reply.reply_type) {
        printf("\n conn close failed\n");
    }
    status = amqp_destroy_connection(conn);
    if (status < 0) {
        printf("\n Destroy failed\n");
    }
    printf("\n All Done\n");
    return 0;
}

any help in moving forward would be great.

Thanks,
Kiran.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131118/c571a539/attachment.htm>

From lauri.fjallstrom at gmail.com  Tue Nov 19 05:31:01 2013
From: lauri.fjallstrom at gmail.com (=?ISO-8859-1?Q?Lauri_Fj=E4llstr=F6m?=)
Date: Tue, 19 Nov 2013 07:31:01 +0200
Subject: [rabbitmq-discuss] RabbitMQ 3.2.0 keeps crashing
Message-ID: <CA+MBRY+UzhWWe8Bvq3Fuj1pEwztjdwAp9aB5_JWU9C+f+mpzGQ@mail.gmail.com>

Hi,

I'm running two RabbitMQ nodes in a cluster on Ubuntu 12.04. I have a
virtual host there and a ha policy for a queue. Both nodes are disc nodes.
During the last 24 hours RabbitMQ crashed twice. Producers are able to
continue publishing messages but they don't end up routed or something.
rabbitmqctl list_queues does not list the queue. In the HTTP management
console the queue is listed but the page only shows:

TypeError: Cannot read property 'ram_msg_count' of undefined
TypeError: Cannot read property 'ram_msg_count' of undefined

There should not anything special going on on the servers. Also, they are
not under heavy load or something.

After the last crash the log file on both nodes were empty. Unfortunately I
didn't backup the logs after the first crashes. I was able to find the
following information in xxx-sasl.log:

=CRASH REPORT==== 19-Nov-2013::04:17:22 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.259.0>
    registered_name: []
    exception exit: {{badmatch,{error,not_found}},
                     [{rabbit_mirror_queue_master,stop_all_slaves,2},
                      {rabbit_mirror_queue_master,delete_and_terminate,2},

{rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6},
                      {rabbit_amqqueue_process,terminate_shutdown,2},
                      {gen_server2,terminate,3},
                      {proc_lib,wake_up,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,<0.192.0>]
    messages: []
    links: [<0.257.0>,<0.452.0>,#Port<0.13309>]
    dictionary: [{delegate,delegate_15},
                  {{credit_to,<0.788.0>},20},
                  {{#Ref<0.0.0.1271>,fhc_handle},
                   {handle,{file_descriptor,prim_file,{#Port<0.13309>,20}},
                           774680,false,0,infinity,[],true,
                           "/var/lib/rabbitmq/mnesia/rabbit at mq1-api-test
/queues/B1433I2VYA7YIS4WJY5I6NO4R/journal.jif",
                           [write,binary,raw,read],
                           [{write_buffer,infinity}],
                           true,true,
                           {1384,827437,174496}}},
                  {{credit_to,<0.563.0>},1},
                  {fhc_age_tree,{1,
                                 {{1384,827437,174496},
                                  #Ref<0.0.0.1271>,nil,nil}}},
                  {{"/var/lib/rabbitmq/mnesia/rabbit at mq1-api-test
/queues/B1433I2VYA7YIS4WJY5I6NO4R/journal.jif",
                    fhc_file},
                   {file,1,true}},
                  {credit_blocked,[]},
                  {{ch,<0.8244.0>},
                   {cr,<0.8244.0>,#Ref<0.0.10.78984>,
                       {[],[]},
                       1,
                       {queue,[],[],0},
                       {qstate,<0.8243.0>,active,{0,nil}},
                       25}},
                  {{ch,<0.8274.0>},
                   {cr,<0.8274.0>,#Ref<0.0.10.91831>,
                       {[],[]},
                       1,
                       {queue,[],[],0},
                       {qstate,<0.8273.0>,active,{0,nil}},
                       49}},
                  {{credit_to,<0.13668.0>},41},
                  {guid,{{1330803274,3383937130,2004047782,2434038047},1}},
                  {{credit_from,<0.251.0>},1826}]
    trap_exit: true
    status: running
    heap_size: 10946
    stack_size: 24
    reductions: 1514324983
  neighbours:
    neighbour: [{pid,<0.453.0>},
                  {registered_name,[]},
                  {initial_call,{gen,init_it,
                                     ['Argument__1','Argument__2',
                                      'Argument__3','Argument__4',
                                      'Argument__5','Argument__6']}},
                  {current_function,{gen_server2,process_next_msg,1}},
                  {ancestors,[<0.452.0>,<0.259.0>,rabbit_amqqueue_sup,
                              rabbit_sup,<0.192.0>]},
                  {messages,[]},
                  {links,[<0.452.0>]},
                  {dictionary,[{random_seed,{24781,9822,29460}}]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,610},
                  {stack_size,7},
                  {reductions,660407699}]
    neighbour: [{pid,<0.452.0>},
                  {registered_name,[]},
                  {initial_call,{gen,init_it,
                                     ['Argument__1','Argument__2',
                                      'Argument__3','Argument__4',
                                      'Argument__5','Argument__6']}},
                  {current_function,{gen_server2,process_next_msg,1}},
                  {ancestors,[<0.259.0>,rabbit_amqqueue_sup,rabbit_sup,
                              <0.192.0>]},
                  {messages,[]},
                  {links,[<0.259.0>,<0.453.0>]},
                  {dictionary,[]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,2584},
                  {stack_size,7},
                  {reductions,59821}]

=SUPERVISOR REPORT==== 19-Nov-2013::04:17:22 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {{badmatch,{error,not_found}},
                  [{rabbit_mirror_queue_master,stop_all_slaves,2},
                   {rabbit_mirror_queue_master,delete_and_terminate,2},
                   {rabbit_amqqueue_process,'-terminate_delete/3-fun-1-',6},
                   {rabbit_amqqueue_process,terminate_shutdown,2},
                   {gen_server2,terminate,3},
                   {proc_lib,wake_up,3}]}
     Offender:   [{pid,<0.259.0>},
                  {name,rabbit_amqqueue},
                  {mfargs,{rabbit_amqqueue_process,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 19-Nov-2013::04:30:20 ===
  crasher:
    initial call: gen:init_it/6
    pid: <0.13842.0>
    registered_name: []
    exception exit: {{badmatch,true},
                     [{rabbit_queue_index,init,2},
                      {rabbit_variable_queue,init,5},
                      {rabbit_mirror_queue_master,init,3},
                      {rabbit_amqqueue_process,declare,3},
                      {gen_server2,handle_msg,2},
                      {proc_lib,init_p_do_apply,3}]}
      in function  gen_server2:terminate/3
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,<0.192.0>]
    messages: []
    links: [<0.257.0>]
    dictionary: [{{xtype_to_module,direct},rabbit_exchange_type_direct}]
    trap_exit: true
    status: running
    heap_size: 1597
    stack_size: 24
    reductions: 1224
  neighbours:

=SUPERVISOR REPORT==== 19-Nov-2013::04:30:20 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {{badmatch,true},
                  [{rabbit_queue_index,init,2},
                   {rabbit_variable_queue,init,5},
                   {rabbit_mirror_queue_master,init,3},
                   {rabbit_amqqueue_process,declare,3},
                   {gen_server2,handle_msg,2},
                   {proc_lib,init_p_do_apply,3}]}
     Offender:   [{pid,<0.13842.0>},
                  {name,rabbit_amqqueue},
                  {mfargs,{rabbit_amqqueue_process,start_link,undefined}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]



I have no clue what's going on here. Can anyone give me a hint?

Best Regards,
Lauri
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/f581acb0/attachment.htm>

From alan.antonuk at gmail.com  Tue Nov 19 05:49:36 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 18 Nov 2013 21:49:36 -0800
Subject: [rabbitmq-discuss] Issue in sending binary data using
 amqp_basic_publish API.
In-Reply-To: <e00d150b-0d40-4a9b-ba72-e26939ae7298@googlegroups.com>
References: <e00d150b-0d40-4a9b-ba72-e26939ae7298@googlegroups.com>
Message-ID: <CAAt2poLGD-jgBO9j_Qsp-0Ju2+xBorbXRi2fi-H=GuC9CxB+XA@mail.gmail.com>

Nothing obvious stands out.

What kind of crash are you getting? Run it under a debugger and see where
it crashes?

-Alan




On Mon, Nov 18, 2013 at 1:50 PM, Kiran Kumar <kirankumar.pnm at gmail.com>wrote:

> I have a rabbitmq server running on my debian linux machine. I have a BGP
> process running and it prepared a Route Message using google protocol
> buffers. The protocol buffer returns a binary data buffer.
>
> Then I have below code to send this data to rabbitmq server. When I
> execute this, the process crashes on amqp_basic_publish call.
>
> Any thoughts on this ? Am I missing some thing here ?
>
>
> int bgp_mq_send(char const* rt_msg, int size)
> {
>     static int init_done = 0;
>     int status;
>     amqp_socket_t *socket = NULL;
>     amqp_connection_state_t conn = NULL;
>     amqp_rpc_reply_t reply;
>
>     if (init_done == 0) {
>         conn = amqp_new_connection();
>
>         socket = amqp_tcp_socket_new(conn);
>         if (!socket) {
>             printf("\n socket creation failed\n");
>             return 1;
>         }
>
>         status = amqp_socket_open(socket, "localhost", 5672);
>         if (status) {
>             printf("\n socket open failed\n");
>             return 1;
>         }
>
>         reply = amqp_login(conn, "/", 0, 131072, 0, AMQP_SASL_METHOD_PLAIN,
> "guest", "guest");
>         if (reply.reply_type) {
>             printf("\n Login is failed\n");
>         }
>
>         amqp_channel_open(conn, 1);
>         reply = amqp_get_rpc_reply(conn);
>         if (reply.reply_type) {
>             printf("\n get_reply failed\n");
>         }
>         init_done = 1;
>     }
>
>
>     {
>         amqp_basic_properties_t props;
>         props._flags = AMQP_BASIC_CONTENT_TYPE_FLAG |
> AMQP_BASIC_DELIVERY_MODE_FLAG;
>         props.content_type = amqp_cstring_bytes("gpb");
>         props.content_encoding = amqp_cstring_bytes("binary");
>         props.delivery_mode = 2; /* persistent delivery mode */
>
>         amqp_bytes_t str2;
>         str2.len = size;
>         str2.bytes = rt_msg;
>
>         status = amqp_basic_publish(conn, 1,
> amqp_cstring_bytes("amq.fanout"),
>                         amqp_cstring_bytes("#"), 0, 0,
>                         &props, str2);  *<<<----------- It crashes right
> here.*
>
>         if (status < 0) {
>             printf("\n publish failed\n");
>         }
>         printf("\n Publish success\n");
>     }
>     reply = amqp_channel_close(conn, 1, AMQP_REPLY_SUCCESS);
>     if (reply.reply_type) {
>         printf("\n chan close failed\n");
>     }
>     reply = amqp_connection_close(conn, AMQP_REPLY_SUCCESS);
>     if (reply.reply_type) {
>         printf("\n conn close failed\n");
>     }
>     status = amqp_destroy_connection(conn);
>     if (status < 0) {
>         printf("\n Destroy failed\n");
>     }
>     printf("\n All Done\n");
>     return 0;
> }
>
> any help in moving forward would be great.
>
> Thanks,
> Kiran.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131118/0c78209c/attachment.htm>

From alan.antonuk at gmail.com  Tue Nov 19 05:57:41 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 18 Nov 2013 21:57:41 -0800
Subject: [rabbitmq-discuss] Difference between get and consume.
In-Reply-To: <f2d256e8-b7df-4c06-8f11-cb8cd0c60419@googlegroups.com>
References: <CA+-VnXCftEngnSqEtx3FPj18n-B00q0C_SHkwWWgqvS4=bn+fw@mail.gmail.com>
	<CAAt2po+uxvdj_9m7D_0fcAVTWmzuL8kNEKbk9bpfMnn1dBV3rQ@mail.gmail.com>
	<f2d256e8-b7df-4c06-8f11-cb8cd0c60419@googlegroups.com>
Message-ID: <CAAt2poJZUNj1dzcNZbZVAOGBDi4PpdESMoJUAQW1aXhqkrgKBg@mail.gmail.com>

William;


On Thu, Nov 14, 2013 at 12:14 PM, William Weens <william.weens at gmail.com>wrote:
>
> Suppose you start to consume (amqp_basic_consume) and loop over the frames
> when a exception is thrown and you exit the loop.
>
> Remaining messages in the queue are consumed but not examined anymore :
>
> - is there a way to find these "lost" messages ?
>

Yes. Any messages that are delivered, but not acked by the client will be
redelivered by the broker in the event an exception is returned to the
client. (assuming you didn't specify no_ack when setting up your consumer).
Depending on the type of exception (channel or connection) you will need to
open a new channel, and create a new consumer to get these messages
redelivered.


>
> Won't it be safer to get one, handle it, catch exceptions if any and then
> move to the other one ?
>

You should handle exceptions as they're received by the client. Attempting
to use a channel after it has thrown an exception will result in a
connection exception being thrown (which means you'd need to close and
re-open the entire connection).

- if yes, does "get" method consume the message as well ?
>
Get synchronously polls the broker for new messages. It does have the same
effect of removing a message from the front of the queue in question on the
broker.

-Alan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131118/22559c45/attachment.htm>

From hxuanji at gmail.com  Tue Nov 19 06:57:28 2013
From: hxuanji at gmail.com (HongXuan Ji)
Date: Mon, 18 Nov 2013 22:57:28 -0800 (PST)
Subject: [rabbitmq-discuss] How to declare mirrored queue using pika?
Message-ID: <e3a65540-28c4-472a-bc9e-834ad0b5674f@googlegroups.com>

Hi all,

I am wondering how to declare a mirrored queue through the code level. I 
use the following code to declare the queue.


queue_args = {"x-ha-policy" : "all" } #/(hwcmq.4) Set queue mirroring policy
> channel.queue_declare(queue="hello-queue", arguments=queue_args) #/(hwcmq.5) 
> Declare the queue


 which is referenced from 
the https://github.com/rabbitinaction/sourcecode/blob/master/python/chapter-5/hello_world_mirrored_queue_consumer.py.

And after the operation, the "hello-queue" on the management interface 
shows :

<https://lh6.googleusercontent.com/-3l9fEvEOwlk/UosKOZEthyI/AAAAAAAAAfY/b99UIQhIrPI/s1600/Untitled.png>


I am not sure I succeed or not. Because I try the different way to delcare 
mirrored queue by the command:

rabbitmqctl set_policy ha-all "^ha\." '{"ha-mode":"all"}'

which is reference from the official page. And the result is more convinced 
which shows "ha-all" in the Policy field when I declare some queue whose 
name is prefixed by "ha.". And I also do some tests on it. it seems work.

So I am wondering the simply adding parameter in the python command: *queue_declare 
*like the first paragraph is effective or not?

Any idea?

Regards,

Ivan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131118/629991f8/attachment.htm>

From tlhuang at 800best.com  Tue Nov 19 07:09:14 2013
From: tlhuang at 800best.com (Huang Tonglang)
Date: Tue, 19 Nov 2013 15:09:14 +0800
Subject: [rabbitmq-discuss] =?gb2312?b?tPC4tDogIFJhYmJpdE1RIDMuMi4xIGZh?=
 =?gb2312?b?aWxzIHRvIHN0YXJ0IHdpdGggbWFuYWdlbWVudCBwbHVnaW4gZW5hYmxlZA==?=
In-Reply-To: <5289DD61.9040208@rabbitmq.com>
References: <50E35C892351D542B755E41103C9367F5BE9FB26@INWPIEXC02.SATS.CORP>
	<5289DD61.9040208@rabbitmq.com>
Message-ID: <023CBAD52AC91842B08759362DE8396C0FD5801AE2@bestex3.800best.net>

I get the same problem when upgrade rabbitmq from 3.1.5 to 3.2.1. However, it works all fine when I install 3.2.1 in a new machine. 

I install erlang and rabbitmq from source files, and my OS is redhat 6.

Thank you 
Tonglang Huang

-----????-----
???: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] ?? Simon MacMullen
????: 2013?11?18? 17:27
???: Discussions about RabbitMQ
??: Yarborough, Allan
??: Re: [rabbitmq-discuss] RabbitMQ 3.2.1 fails to start with management plugin enabled

On 15/11/2013 17:52, Yarborough, Allan wrote:
>     {could_not_start,amqp_client,
>         {{supervisor_data,{invalid_strategy,simple_one_for_one_terminate}},
>          {amqp_client,start,[normal,[]]}}}

Somehow your Erlang path contains an old version of the RabbitMQ Erlang 
Client. This is built into the server and used by many plugins 
(including management).

We've seen this before on some RPM-based distro, they had "helpfully" 
packaged the Erlang client separately (but installed it in 
/usr/lib/erlang/lib/ where it was loaded for all Erlang applications). I 
hope this hasn't happened in Debian too.

Cheers, Simon

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From Rohit.Patel2 at techmahindra.com  Tue Nov 19 07:46:01 2013
From: Rohit.Patel2 at techmahindra.com (Rohit Patle)
Date: Tue, 19 Nov 2013 07:46:01 +0000
Subject: [rabbitmq-discuss] amqp_simple_wait_frame_noblock() timing issue
Message-ID: <27E054594442884E9A46DBCF9AE7408161090E@BSDMSATMBX001.mahindrasatyam.ad>

Hi Team,

I am using amqp_simple_wait_frame_noblock() instead of amqp_simple_wait_frame() in amqps_listen.c. But I am getting the timeout(AMQP_STATUS_TIMEOUT) in around 1-2seconds instead of specified time( i.e t.tv_sec=10).

FYI I am using rabbitmq-c client library v0.3.0.

Please suggest.

Thanks you,
ROhit


________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/9d310a04/attachment.htm>

From mklishin at gopivotal.com  Tue Nov 19 08:44:33 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 19 Nov 2013 12:44:33 +0400
Subject: [rabbitmq-discuss] RabbitMQ 3.2.0 keeps crashing
In-Reply-To: <CA+MBRY+UzhWWe8Bvq3Fuj1pEwztjdwAp9aB5_JWU9C+f+mpzGQ@mail.gmail.com>
References: <CA+MBRY+UzhWWe8Bvq3Fuj1pEwztjdwAp9aB5_JWU9C+f+mpzGQ@mail.gmail.com>
Message-ID: <5EB25B16-352F-4306-BFDA-74537633C7D9@rabbitmq.com>


On 19 Nov 2013, at 09:31, Lauri Fj?llstr?m <lauri.fjallstrom at gmail.com> wrote:

> I have no clue what's going on here. Can anyone give me a hint?

You are likely observing one of two bugs fixed in 3.2.1:
http://www.rabbitmq.com/release-notes/README-3.2.1.txt

MK

Software Engineer, Pivotal/RabbitMQ



From zmstone at gmail.com  Tue Nov 19 09:27:06 2013
From: zmstone at gmail.com (Stone Shi)
Date: Tue, 19 Nov 2013 10:27:06 +0100
Subject: [rabbitmq-discuss] does topic exchange route messages to different
 queues in the same order ?
Message-ID: <CAPNZrFW4iSKMT+7Svnbm2qd2yTAf1FT3gnoRZqs7+BQWeZRhkw@mail.gmail.com>

Hi guys.

If I have e.g. a topic exchange, two publishers, and two queues bind to the
exchange.
lets say we have 4 messages published "at the same time",
{a,1}, {a,2} from publisher A
{b,1}, {b,2} from publisher B
if it's ended up with {b,1},{a,1},{a,2},{b,2} in one queue, can I assume
the same order in the other queue?

Regards
-Stone
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/04383e00/attachment.htm>

From simon at rabbitmq.com  Tue Nov 19 09:37:25 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Nov 2013 09:37:25 +0000
Subject: [rabbitmq-discuss] How to declare mirrored queue using pika?
In-Reply-To: <e3a65540-28c4-472a-bc9e-834ad0b5674f@googlegroups.com>
References: <e3a65540-28c4-472a-bc9e-834ad0b5674f@googlegroups.com>
Message-ID: <528B3155.5060304@rabbitmq.com>

Hi Ivan.

The use of queue arguments to declare a queue as HA dates from RabbitMQ 
2.x. In 3.x we changed this to use policies as you've already seen - 
since applications should not have to know about whether their queues 
are HA.

So use rabbitmqctl set_policy (or the management plugin).

Cheers, Simon

On 19/11/2013 06:57, HongXuan Ji wrote:
> Hi all,
>
> I am wondering how to declare a mirrored queue through the code level. I
> use the following code to declare the queue.
>
>
>         queue_args = {"x-ha-policy" : "all" } #/(hwcmq.4) Set queue
>         mirroring policy
>         channel.queue_declare(queue="hello-queue", arguments=queue_args)
>         #/(hwcmq.5) Declare the queue
>
>
>   which is referenced from
> the https://github.com/rabbitinaction/sourcecode/blob/master/python/chapter-5/hello_world_mirrored_queue_consumer.py.
>
> And after the operation, the "hello-queue" on the management interface
> shows :
>
> <https://lh6.googleusercontent.com/-3l9fEvEOwlk/UosKOZEthyI/AAAAAAAAAfY/b99UIQhIrPI/s1600/Untitled.png>
>
>
>
> I am not sure I succeed or not. Because I try the different way to
> delcare mirrored queue by the command:
>
> rabbitmqctl set_policy ha-all "^ha\." '{"ha-mode":"all"}'
>
> which is reference from the official page. And the result is more
> convinced which shows "ha-all" in the Policy field when I declare some
> queue whose name is prefixed by "ha.". And I also do some tests on it.
> it seems work.
>
> So I am wondering the simply adding parameter in the python command:
> *queue_declare *like the first paragraph is effective or not?
>
> Any idea?
>
> Regards,
>
> Ivan
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Tue Nov 19 09:38:24 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Nov 2013 09:38:24 +0000
Subject: [rabbitmq-discuss] =?gb2312?b?tPC4tDogIFJhYmJpdE1RIDMuMi4xIGZh?=
 =?gb2312?b?aWxzIHRvIHN0YXJ0IHdpdGggbWFuYWdlbWVudCBwbHVnaW4gZW5hYmxlZA==?=
In-Reply-To: <023CBAD52AC91842B08759362DE8396C0FD5801AE2@bestex3.800best.net>
References: <50E35C892351D542B755E41103C9367F5BE9FB26@INWPIEXC02.SATS.CORP>
	<5289DD61.9040208@rabbitmq.com>
	<023CBAD52AC91842B08759362DE8396C0FD5801AE2@bestex3.800best.net>
Message-ID: <528B3190.9030507@rabbitmq.com>

I suspect you have the same problem then. Make sure you do not have any
old versions of plugins lying around.

Cheers, Simon

On 19/11/2013 07:09, Huang Tonglang wrote:
> I get the same problem when upgrade rabbitmq from 3.1.5 to 3.2.1. However, it works all fine when I install 3.2.1 in a new machine.
> 
> I install erlang and rabbitmq from source files, and my OS is redhat 6.
> 
> Thank you
> Tonglang Huang
> 
> -----????-----
> ???: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] ?? Simon MacMullen
> ????: 2013?11?18? 17:27
> ???: Discussions about RabbitMQ
> ??: Yarborough, Allan
> ??: Re: [rabbitmq-discuss] RabbitMQ 3.2.1 fails to start with management plugin enabled
> 
> On 15/11/2013 17:52, Yarborough, Allan wrote:
>>      {could_not_start,amqp_client,
>>          {{supervisor_data,{invalid_strategy,simple_one_for_one_terminate}},
>>           {amqp_client,start,[normal,[]]}}}
> 
> Somehow your Erlang path contains an old version of the RabbitMQ Erlang
> Client. This is built into the server and used by many plugins
> (including management).
> 
> We've seen this before on some RPM-based distro, they had "helpfully"
> packaged the Erlang client separately (but installed it in
> /usr/lib/erlang/lib/ where it was loaded for all Erlang applications). I
> hope this hasn't happened in Debian too.
> 
> Cheers, Simon
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


From simon at rabbitmq.com  Tue Nov 19 09:40:21 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 19 Nov 2013 09:40:21 +0000
Subject: [rabbitmq-discuss] does topic exchange route messages to
 different queues in the same order ?
In-Reply-To: <CAPNZrFW4iSKMT+7Svnbm2qd2yTAf1FT3gnoRZqs7+BQWeZRhkw@mail.gmail.com>
References: <CAPNZrFW4iSKMT+7Svnbm2qd2yTAf1FT3gnoRZqs7+BQWeZRhkw@mail.gmail.com>
Message-ID: <528B3205.9030306@rabbitmq.com>

No. You can assume that order is maintained *per publisher* - you will 
never see {a,2},{a,1} - but the interleaving between publishers is not 
guaranteed to be the same.

Cheers, Simon

On 19/11/2013 09:27, Stone Shi wrote:
> Hi guys.
>
> If I have e.g. a topic exchange, two publishers, and two queues bind to
> the exchange.
> lets say we have 4 messages published "at the same time",
> {a,1}, {a,2} from publisher A
> {b,1}, {b,2} from publisher B
> if it's ended up with {b,1},{a,1},{a,2},{b,2} in one queue, can I assume
> the same order in the other queue?
>
> Regards
> -Stone
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From zmstone at gmail.com  Tue Nov 19 09:59:47 2013
From: zmstone at gmail.com (Stone Shi)
Date: Tue, 19 Nov 2013 10:59:47 +0100
Subject: [rabbitmq-discuss] does topic exchange route messages to
 different queues in the same order ?
In-Reply-To: <528B3205.9030306@rabbitmq.com>
References: <CAPNZrFW4iSKMT+7Svnbm2qd2yTAf1FT3gnoRZqs7+BQWeZRhkw@mail.gmail.com>
	<528B3205.9030306@rabbitmq.com>
Message-ID: <CAPNZrFWUmkVf1egM372oW_jGWW3mbCfDKiogtJh4=z-QLgiqiw@mail.gmail.com>

Thanks for the quick answer !


On Tue, Nov 19, 2013 at 10:40 AM, Simon MacMullen <simon at rabbitmq.com>wrote:

> No. You can assume that order is maintained *per publisher* - you will
> never see {a,2},{a,1} - but the interleaving between publishers is not
> guaranteed to be the same.
>
> Cheers, Simon
>
>
> On 19/11/2013 09:27, Stone Shi wrote:
>
>> Hi guys.
>>
>> If I have e.g. a topic exchange, two publishers, and two queues bind to
>> the exchange.
>> lets say we have 4 messages published "at the same time",
>> {a,1}, {a,2} from publisher A
>> {b,1}, {b,2} from publisher B
>> if it's ended up with {b,1},{a,1},{a,2},{b,2} in one queue, can I assume
>> the same order in the other queue?
>>
>> Regards
>> -Stone
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/5ddc1d09/attachment.htm>

From Punit.Jain at emc.com  Tue Nov 19 10:10:05 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Tue, 19 Nov 2013 05:10:05 -0500
Subject: [rabbitmq-discuss] SSL: error on AMQP connection
In-Reply-To: <5289DB98.9070006@rabbitmq.com>
References: <DB14E94115BBC84E8960C12C176D067601779CABB9@MX25A.corp.emc.com>
	<6796F7EA-29B0-456A-B245-8369B0030A0A@rabbitmq.com>
	<DB14E94115BBC84E8960C12C176D067601779CAC98@MX25A.corp.emc.com>
	<5289DB98.9070006@rabbitmq.com>
Message-ID: <DB14E94115BBC84E8960C12C176D067601779CADB8@MX25A.corp.emc.com>

Thanks Emile. We also use keystore to save keys and certificates. Is there a way RabbitMQ can retrieve key from there? Are there other ways to configure SSL?

Thanks,
Punit

> -----Original Message-----
> From: Emile Joubert [mailto:emile at rabbitmq.com]
> Sent: Monday, November 18, 2013 2:49 PM
> To: Discussions about RabbitMQ
> Cc: Jain, Punit; Michael Klishin
> Subject: Re: [rabbitmq-discuss] SSL: error on AMQP connection
> 
> Hi,
> 
> On 18/11/13 06:16, Jain, Punit wrote:
> 
> > I was able to fix it, but I had to add {password, "XXXXX"} in the
> > config file. The password is used for key, probably for decryption.
> > But putting the password in config file is not advisable. Is there any
> > other way I can get this working?
> 
> 
> The alternative is to use a key that does not require a password.
> 
> 
> 
> -Emile
> 
> 


From emile at rabbitmq.com  Tue Nov 19 10:35:52 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 19 Nov 2013 10:35:52 +0000
Subject: [rabbitmq-discuss] SSL: error on AMQP connection
In-Reply-To: <DB14E94115BBC84E8960C12C176D067601779CADB8@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D067601779CABB9@MX25A.corp.emc.com>
	<6796F7EA-29B0-456A-B245-8369B0030A0A@rabbitmq.com>
	<DB14E94115BBC84E8960C12C176D067601779CAC98@MX25A.corp.emc.com>
	<5289DB98.9070006@rabbitmq.com>
	<DB14E94115BBC84E8960C12C176D067601779CADB8@MX25A.corp.emc.com>
Message-ID: <528B3F08.4090204@rabbitmq.com>


Hi,

On 19/11/13 10:10, Jain, Punit wrote:
> Thanks Emile. We also use keystore to save keys and certificates. Is
> there a way RabbitMQ can retrieve key from there? Are there other
> ways to configure SSL?

No, cryptographic material must be provided in PEM format, as described
here: http://www.rabbitmq.com/ssl.html



-Emile




From emile at rabbitmq.com  Tue Nov 19 10:55:15 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Tue, 19 Nov 2013 10:55:15 +0000
Subject: [rabbitmq-discuss] access control
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D01835CBF@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D01835CBF@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <528B4393.10100@rabbitmq.com>


Hi,

On 18/11/13 17:16, PATAR, SAGAR wrote:

> channel error; reason: {#method<channel.close>(reply-code=404,
> *reply-text=NOT_FOUND* - no queue '8c39360e-0d72-436a-9de2-c06f6a5cec58'
> in vhost '/', class-id=50, method-id=10), null, ""}

A passive declare of a queue failed because the queue was absent.

> channel error; reason: {#method<channel.close>(reply-code=403,
> *reply-text=ACCESS_REFUSED* - access to queue
> 'bb771ff2-67ea-452e-a98f-163467469af9' in vhost '/' refused for user
> 'dlcore', class-id=60, method-id=20), null, ""}

This means you tried to consume from a queue without read permission.

> channel error; reason: {#method<channel.close>(reply-code=403,
> reply-text=ACCESS_REFUSED - access to queue
> '65eda6e4-1ec0-482e-93e5-fd0d247412b4' in vhost '/' refused for user
> 'dlcore', class-id=60, method-id=20), null, ""}
As before, you lack read access on the queue and therefore cannot consume.

See the access control matrix to make sure you grant sufficient permissions:

http://www.rabbitmq.com/access-control.html




-Emile




From ian.forrest.adams at gmail.com  Tue Nov 19 18:12:19 2013
From: ian.forrest.adams at gmail.com (Ian Adams)
Date: Tue, 19 Nov 2013 10:12:19 -0800 (PST)
Subject: [rabbitmq-discuss] Very slow basic_publish
Message-ID: <f438e0f9-340b-436a-ad60-f2405f47c4cc@googlegroups.com>

Hi All,

Im pretty new to RMQ, been messing about with it and noticed that 
publishing messages via pika seems quite slow.

Im using a default configuration of the broker, all produces and consumers 
running on the same machine as the broker.

What I'm noticing is that its (relatively) extremely slow to publish 
messages to the broker, but the once the broker has them, it goes blazingly 
fast in getting them to various consumers.

For example, the below code (ripped off from then RMQ tutorials) can 
publish messages at around 250-300 messages per second, this is both in an 
ubuntu vm and on a 'bare metal' Mac running OS X 10.8 ( I can provide more 
detailed hardware info if needed)

http://pastebin.com/JNXwmYx7

The consumer, on the other hand (which doesn't do anything with them 
really, this is just testing), can receive them at up to 20k messages a 
second if I let the queue build up. 

When I profiled my message producer, it seems to be spending the vast 
majority of its time polling. cProf sees:

ncalls  tottime  percall  cumtime  percall filename:lineno(function)
----
308    3.202    0.010    3.202    0.010 {built-in method poll}
----

Is there some configuration I'm missing? Or am I abusing some 
functionality? Im making sure that there is no acks, and no durability so 
it should be the disk at least.

Thanks guys!


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/6061ca13/attachment.htm>

From nick at editd.com  Tue Nov 19 18:29:58 2013
From: nick at editd.com (Nick Barrett)
Date: Tue, 19 Nov 2013 18:29:58 +0000
Subject: [rabbitmq-discuss] Clustering Problem
Message-ID: <etPan.528bae26.6b8b4567.2bab@Nicks-iMac.local>

Hi!

We?re currently trying to migrate our RabbitMQ setup, and to do it I?m trying to setup a cluster (and later apply ha-mode ?all? & ha-sync-mode ?automatic? to all queues). I ran a test setup with two Rabbit installs with 2 queues with ~5 messages in each with no problem. However when I try to add the new server to our existing install (which has ~120k messages stored in it) it dies. Not only this but it kills the existing server (status reports back alive, but the management interface is gone and no queues are listed via rabbitmqctl), which caused a short panic attack in the office!

The error I?m seeing:

	root at rabbit-01:/var/log/rabbitmq# rabbitmqctl join_cluster rabbit at hare
	Clustering node 'rabbit at rabbit-01' with rabbit at hare ...
?
	Error: {{badmatch,{aborted,{badarg,rabbit_user,majority}}},
	        [{rabbit_table,create_local_copy,2},
	         {rabbit_table,'-create_local_copies/1-fun-0-',2},
	         {lists,foreach,2},
	         {rabbit_table,create_local_copies,1},
	         {rabbit_mnesia,init_db,3},
	         {rabbit_mnesia,init_db_and_upgrade,3},
	         {rabbit_mnesia,init_db_with_mnesia,4},
	         {rabbit_mnesia,join_cluster,2}]}
	root at rabbit-01:/var/log/rabbitmq#  
	root at rabbit-01:/var/log/rabbitmq# rabbitmqctl start_app                
	Starting node 'rabbit at rabbit-01' ...


Any help would be greatly appreciated!

?
Nick Barrett
EDITD
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/bf126399/attachment.htm>

From michael.s.klishin at gmail.com  Tue Nov 19 21:11:34 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 20 Nov 2013 01:11:34 +0400
Subject: [rabbitmq-discuss] Clustering Problem
In-Reply-To: <etPan.528bae26.6b8b4567.2bab@Nicks-iMac.local>
References: <etPan.528bae26.6b8b4567.2bab@Nicks-iMac.local>
Message-ID: <CAE3HoVSckbOSJNSKvHCzMV+Od3EFUOJ0O95B_Dvt95aVk05Dzw@mail.gmail.com>

2013/11/19 Nick Barrett <nick at editd.com>

> Any help would be greatly appreciated!


Nick,

What version do you run?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/4230df28/attachment.htm>

From michael.s.klishin at gmail.com  Tue Nov 19 21:14:36 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 20 Nov 2013 01:14:36 +0400
Subject: [rabbitmq-discuss] Very slow basic_publish
In-Reply-To: <f438e0f9-340b-436a-ad60-f2405f47c4cc@googlegroups.com>
References: <f438e0f9-340b-436a-ad60-f2405f47c4cc@googlegroups.com>
Message-ID: <CAE3HoVSzL=0Osv4HiCJ40oeFZJR9YAR8bzoMx13XmHymhaHs+g@mail.gmail.com>

2013/11/19 Ian Adams <ian.forrest.adams at gmail.com>

> For example, the below code (ripped off from then RMQ tutorials) can
> publish messages at around 250-300 messages per second, this is both in an
> ubuntu vm and on a 'bare metal' Mac running OS X 10.8 ( I can provide more
> detailed hardware info if needed)
>
> http://pastebin.com/JNXwmYx7
>

Try Tornado or Asyncore adapters:
https://pika.readthedocs.org/en/latest/modules/adapters/index.html

-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/f4efaf00/attachment.htm>

From stuff at moesel.net  Tue Nov 19 22:06:39 2013
From: stuff at moesel.net (Chris)
Date: Tue, 19 Nov 2013 17:06:39 -0500
Subject: [rabbitmq-discuss] Renaming upstream queues using a pattern
Message-ID: <CAHEpgBBzFFe-GKc7Gywk8UMVC6PGXx-ku7xxM_Owkvxu35xaCA@mail.gmail.com>

Hello All,

I would like to federate queues, but I want the upstream queues to have
different names than the federated queues.  I know it is possible to
configure this in the federation-upstream with the 'queue' property.

But... I want the federation-upstream to be used in a policy that applies
to multiple queues (so multiple different queues will be federated).  In
this case, what happens if I set the 'queue' property on the
federation-upstream?

What I'd really like to do is federate a queue and have the upstream be the
same name with something appended at the end.  For example, federate
"myqueue" and have the upstream queue be called "myqueue.upstream".  Is
this possible without having to define a different federation-upstream and
policy for every single federated queue?

Thanks,
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/74d039e6/attachment.htm>

From michael.s.klishin at gmail.com  Tue Nov 19 22:30:20 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 20 Nov 2013 02:30:20 +0400
Subject: [rabbitmq-discuss] Renaming upstream queues using a pattern
In-Reply-To: <CAHEpgBBzFFe-GKc7Gywk8UMVC6PGXx-ku7xxM_Owkvxu35xaCA@mail.gmail.com>
References: <CAHEpgBBzFFe-GKc7Gywk8UMVC6PGXx-ku7xxM_Owkvxu35xaCA@mail.gmail.com>
Message-ID: <CAE3HoVQFZrgevPsT-SCbroLbrLzq=jWihmQGWY9-3dxQF81f7w@mail.gmail.com>

2013/11/20 Chris <stuff at moesel.net>

> Is this possible without having to define a different federation-upstream
> and policy for every single federated queue?


No but you can do what you want via HTTP API and a little bit of custom
code:

http://www.rabbitmq.com/management.html#http-api
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/014f7bcb/attachment.htm>

From tlhuang at 800best.com  Wed Nov 20 01:31:56 2013
From: tlhuang at 800best.com (Huang Tonglang)
Date: Wed, 20 Nov 2013 09:31:56 +0800
Subject: [rabbitmq-discuss] =?gb2312?b?tPC4tDogILTwuLQ6ICBSYWJiaXRNUSAz?=
 =?gb2312?b?LjIuMSBmYWlscyB0byBzdGFydCB3aXRoIG1hbmFnZW1lbnQgcGx1Z2luIGVu?=
 =?gb2312?b?YWJsZWQ=?=
In-Reply-To: <528B3190.9030507@rabbitmq.com>
References: <50E35C892351D542B755E41103C9367F5BE9FB26@INWPIEXC02.SATS.CORP>
	<5289DD61.9040208@rabbitmq.com>
	<023CBAD52AC91842B08759362DE8396C0FD5801AE2@bestex3.800best.net>
	<528B3190.9030507@rabbitmq.com>
Message-ID: <023CBAD52AC91842B08759362DE8396C0FD5801AE8@bestex3.800best.net>

The problem was resolved when I removed "/usr/local/plugins", and reinstalled rabbitmq again. 

Thank you for your instructions.

Tonglang Huang.


-----????-----
???: Simon MacMullen [mailto:simon at rabbitmq.com] 
????: 2013?11?19? 17:38
???: Discussions about RabbitMQ
??: Huang Tonglang
??: Re: [rabbitmq-discuss] ??: RabbitMQ 3.2.1 fails to start with management plugin enabled

I suspect you have the same problem then. Make sure you do not have any
old versions of plugins lying around.

Cheers, Simon

On 19/11/2013 07:09, Huang Tonglang wrote:
> I get the same problem when upgrade rabbitmq from 3.1.5 to 3.2.1. However, it works all fine when I install 3.2.1 in a new machine.
> 
> I install erlang and rabbitmq from source files, and my OS is redhat 6.
> 
> Thank you
> Tonglang Huang
> 
> -----????-----
> ???: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] ?? Simon MacMullen
> ????: 2013?11?18? 17:27
> ???: Discussions about RabbitMQ
> ??: Yarborough, Allan
> ??: Re: [rabbitmq-discuss] RabbitMQ 3.2.1 fails to start with management plugin enabled
> 
> On 15/11/2013 17:52, Yarborough, Allan wrote:
>>      {could_not_start,amqp_client,
>>          {{supervisor_data,{invalid_strategy,simple_one_for_one_terminate}},
>>           {amqp_client,start,[normal,[]]}}}
> 
> Somehow your Erlang path contains an old version of the RabbitMQ Erlang
> Client. This is built into the server and used by many plugins
> (including management).
> 
> We've seen this before on some RPM-based distro, they had "helpfully"
> packaged the Erlang client separately (but installed it in
> /usr/lib/erlang/lib/ where it was loaded for all Erlang applications). I
> hope this hasn't happened in Debian too.
> 
> Cheers, Simon
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


From tlhuang at 800best.com  Wed Nov 20 03:34:28 2013
From: tlhuang at 800best.com (Huang Tonglang)
Date: Wed, 20 Nov 2013 11:34:28 +0800
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
Message-ID: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>

I use SAS disk right now. However, there will be more messages come in. Should I replace SAS with SSD to improve Rabbitmq's performance?

Thank you

Tonglang Huang

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/3f327516/attachment.htm>

From mcintoshj at gmail.com  Wed Nov 20 04:10:41 2013
From: mcintoshj at gmail.com (McIntosh Jason)
Date: Tue, 19 Nov 2013 22:10:41 -0600
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>
Message-ID: <EAFBD5F6-98E9-4915-83A5-F21EA5E3E5A8@gmail.com>

When I did testing I noticed ssds made a big improvement, but test it out if you can.  It does impact if you're doing persistent messages only from what I saw
Jason

Sent from my iPhone

> On Nov 19, 2013, at 9:34 PM, Huang Tonglang <tlhuang at 800best.com> wrote:
> 
> I use SAS disk right now. However, there will be more messages come in. Should I replace SAS with SSD to improve Rabbitmq?s performance?
>  
> Thank you
>  
> Tonglang Huang
>  
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/51459de1/attachment.htm>

From daniel.bason at telogis.com  Wed Nov 20 04:15:38 2013
From: daniel.bason at telogis.com (Daniel Bason)
Date: Wed, 20 Nov 2013 17:15:38 +1300
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <EAFBD5F6-98E9-4915-83A5-F21EA5E3E5A8@gmail.com>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>
	<EAFBD5F6-98E9-4915-83A5-F21EA5E3E5A8@gmail.com>
Message-ID: <CAHdxdCdyBowPCGmk103RVf3AvrAf2nvHPT2kmHmn_pEWnhO+cA@mail.gmail.com>

It depends on whether you are IO constrained.  In terms of consuming I
believe all messages are held in RAM so it shouldn't affect that but it may
improve publish rates if you hit IO contention.


On Wed, Nov 20, 2013 at 5:10 PM, McIntosh Jason <mcintoshj at gmail.com> wrote:

> When I did testing I noticed ssds made a big improvement, but test it out
> if you can.  It does impact if you're doing persistent messages only from
> what I saw
> Jason
>
> Sent from my iPhone
>
> On Nov 19, 2013, at 9:34 PM, Huang Tonglang <tlhuang at 800best.com> wrote:
>
>  I use SAS disk right now. However, there will be more messages come in.
> Should I replace SAS with SSD to improve Rabbitmq?s performance?
>
>
>
> Thank you
>
>
>
> Tonglang Huang
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
*Dan Bason *
Infrastructure Engineer ? Telogis
www.telogis.com  www.telogis.co.nz
+1 201 477-1448 (USA)  +64 3 281-8065 (NZ)

<http://www.google.com/url?q=http%3A%2F%2Fwww.telogis.com%2F&sa=D&sntz=1&usg=AFrqEze6z4qIWKcAMjgXqM25xkuw9JMysQ>

*One Platform for Location Intelligence*

-- 


This e-mail, and any attachments, is intended only for use by the 
addressee(s) named herein and may contain legally privileged and/or 
confidential information.  It is the property of Telogis.  If you are not 
the intended recipient of this e-mail, you are hereby notified that any 
dissemination, distribution or copying of this e-mail, any attachments 
thereto, and use of the information contained, is strictly prohibited.  If 
you have received this e-mail in error, please notify the sender and 
permanently delete the original and any copy thereof.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/17afede1/attachment.htm>

From graeme at sudo.ca  Wed Nov 20 04:38:03 2013
From: graeme at sudo.ca (Graeme N)
Date: Tue, 19 Nov 2013 20:38:03 -0800
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>
Message-ID: <CAJ4uuZYsnCeS0BBybKbmJyeM_xqjg4is8MkQkDOtHhHjwrorAA@mail.gmail.com>

We've found that for our workloads (hundreds of persistent queues spread
across multiple systems in the cluster) that SSDs are able to handle a much
higher sustained workload than SAS disks. Rabbit at the moment doesn't make
much effort into making its workload append only and contiguous by default,
and so the high random IO performance of SSDs seems to be a big helper when
publishing many messages.

That being said, RabbitMQ is able to handle a pretty decent workload even
on a single node with SATA disks, so I'd highly recommend doing some
workload benchmarking with your systems to ascertain peak sustained
throughput before shelling out for a bunch of expensive new disks.

Graeme



On Tue, Nov 19, 2013 at 7:34 PM, Huang Tonglang <tlhuang at 800best.com> wrote:

>  I use SAS disk right now. However, there will be more messages come in.
> Should I replace SAS with SSD to improve Rabbitmq?s performance?
>
>
>
> Thank you
>
>
>
> Tonglang Huang
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131119/b15d49c2/attachment.htm>

From matthias at rabbitmq.com  Wed Nov 20 08:11:54 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 20 Nov 2013 08:11:54 +0000
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <CAJ4uuZYsnCeS0BBybKbmJyeM_xqjg4is8MkQkDOtHhHjwrorAA@mail.gmail.com>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>
	<CAJ4uuZYsnCeS0BBybKbmJyeM_xqjg4is8MkQkDOtHhHjwrorAA@mail.gmail.com>
Message-ID: <528C6ECA.80003@rabbitmq.com>

On 20/11/13 04:38, Graeme N wrote:
> Rabbit at the moment doesn't make much effort into making its
> workload append only and contiguous by default

Actually all disk writes in rabbit *are* append-only (plus the 
occasional truncate). But when dealing with multiple disk-bound queues, 
there is inevitably a fair bit of seeking going on. And SSDs are much 
quicker at that.

Matthias.

From simon at rabbitmq.com  Wed Nov 20 10:37:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 20 Nov 2013 10:37:18 +0000
Subject: [rabbitmq-discuss] Clustering Problem
In-Reply-To: <etPan.528bae26.6b8b4567.2bab@Nicks-iMac.local>
References: <etPan.528bae26.6b8b4567.2bab@Nicks-iMac.local>
Message-ID: <528C90DE.1080703@rabbitmq.com>

On 19/11/13 18:29, Nick Barrett wrote:
> Error: {{badmatch,{aborted,{badarg,rabbit_user,majority}}},

That's... very very weird. That looks like your rabbit_user table has 
the 'majority' flag set on one node, and another node is objecting to it.

What's weird is that we've never set the 'majority' flag under any 
circumstances. Have you somehow patched RabbitMQ? What version are you 
running, and where did you get it from?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From stuff at moesel.net  Wed Nov 20 16:23:03 2013
From: stuff at moesel.net (Chris)
Date: Wed, 20 Nov 2013 11:23:03 -0500
Subject: [rabbitmq-discuss] Renaming upstream queues using a pattern
In-Reply-To: <CAE3HoVQFZrgevPsT-SCbroLbrLzq=jWihmQGWY9-3dxQF81f7w@mail.gmail.com>
References: <CAHEpgBBzFFe-GKc7Gywk8UMVC6PGXx-ku7xxM_Owkvxu35xaCA@mail.gmail.com>
	<CAE3HoVQFZrgevPsT-SCbroLbrLzq=jWihmQGWY9-3dxQF81f7w@mail.gmail.com>
Message-ID: <CAHEpgBAc6KB6XXUViChnhNO1vejyO8MrEz8tXrWti5+-AQ7EAQ@mail.gmail.com>

While I could configure the upstreams using HTTP API, I don't think this
would be very desirable.  It might be good in a scenario where things are
very well-defined and you only have a few federated queues, but this is not
my case.

For each queue I would have to:
* define a new upstream with desired upstream queue name
* repeat above for each upstream broker
* define an upstream set containing the queue-specific upstreams I just
created
* define a new policy applying the upstream set to the specific federated
queue

So... on a broker that has 5 upstream brokers, each federated queue would
require 5 new upstreams, 1 new upstream set, and 1 new policy.  I might
have hundreds of federated queues, so this could get rather unwieldy.

To complicate matters, if I ever wanted to add another upstream broker (and
I might!), I would then need to detect all of the federated queues somehow,
loop through them all creating new queue-specific upstreams, and modify all
the upstream sets to add the new upstreams.

On the other hand, if an upstream had a property for applying a regular
expression substitution pattern, that would be awesome.  Then I could just
define the upstream queue as something like "s/(.+)/\1.upstream", and
that's it!

I guess this is a feature request then. ;-)

-Chris


On Tue, Nov 19, 2013 at 5:30 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2013/11/20 Chris <stuff at moesel.net>
>
>> Is this possible without having to define a different federation-upstream
>> and policy for every single federated queue?
>
>
> No but you can do what you want via HTTP API and a little bit of custom
> code:
>
> http://www.rabbitmq.com/management.html#http-api
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/c05b19ae/attachment.htm>

From graeme at sudo.ca  Wed Nov 20 19:10:22 2013
From: graeme at sudo.ca (Graeme N)
Date: Wed, 20 Nov 2013 11:10:22 -0800
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <528C6ECA.80003@rabbitmq.com>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>
	<CAJ4uuZYsnCeS0BBybKbmJyeM_xqjg4is8MkQkDOtHhHjwrorAA@mail.gmail.com>
	<528C6ECA.80003@rabbitmq.com>
Message-ID: <CAJ4uuZbN6MAv7F_qiaGfA+huaa5t6bZorRDyDn2NOgw9iU8tig@mail.gmail.com>

On Wed, Nov 20, 2013 at 12:11 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 20/11/13 04:38, Graeme N wrote:
>
>> Rabbit at the moment doesn't make much effort into making its
>> workload append only and contiguous by default
>>
>
> Actually all disk writes in rabbit *are* append-only (plus the occasional
> truncate). But when dealing with multiple disk-bound queues, there is
> inevitably a fair bit of seeking going on. And SSDs are much quicker at
> that.
>


Well, I guess that multiple small files, even if they are individually
written as append only, doesn't really qualify as an append-only workload
in the sense I'd normally think of it. The reason to use an append-only
workload is to ensure it performs well on spinning disks by avoiding seeks.
Looking at the files under
/var/lib/rabbitmq/mnesia/rabbit at hostname/msg_store_persistent
on our busiest host, and we see ~390 files, all <= 17 MiB. Compare to MySQL
or Riak, where we split the InnoDB or Bitcask append-only logs at 500 MiB,
which is chosen so it fits inside of our hardware RAID controllers' BBU
caches.

Our big messages in RabbitMQ are 500kiB to 4MiB, so each of these 16 MiB
chunks only stores ~10 of these messages, which is far smaller than our
typical batch size of ~100 messages. Relatively speaking, this is a ton
more overhead in many small files than we typically see in other datastores
that bill themselves as spinning disk friendly / append only. When you
consider that those other data stores use a single set of append-only logs
for all queues/tables/buckets in the system, and rabbit seems to be
segmenting them based on queue, it means that rabbit's workload contains at
least an order of magnitude more seeks when busy than these other storage
engines.

So, while rabbit's workload at the file chunk level may technically be
append only, it doesn't actually seem to avoid seeks in its workload, and
we tend to see pretty massive persistent queue performance improvements by
using SSDs. Thus, I wouldn't really consider its workload in the same class
as most append-only storage systems.

Graeme
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/f9fa1982/attachment.htm>

From matthias at rabbitmq.com  Wed Nov 20 19:41:16 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 20 Nov 2013 19:41:16 +0000
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <CAJ4uuZbN6MAv7F_qiaGfA+huaa5t6bZorRDyDn2NOgw9iU8tig@mail.gmail.com>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>	<CAJ4uuZYsnCeS0BBybKbmJyeM_xqjg4is8MkQkDOtHhHjwrorAA@mail.gmail.com>	<528C6ECA.80003@rabbitmq.com>
	<CAJ4uuZbN6MAv7F_qiaGfA+huaa5t6bZorRDyDn2NOgw9iU8tig@mail.gmail.com>
Message-ID: <528D105C.50305@rabbitmq.com>

Graeme,

On 20/11/13 19:10, Graeme N wrote:
> Looking at the files under
> /var/lib/rabbitmq/mnesia/rabbit at hostname/msg_store_persistent on our
> busiest host, and we see ~390 files, all <= 17 MiB. Compare to MySQL or
> Riak, where we split the InnoDB or Bitcask append-only logs at 500 MiB,
> which is chosen so it fits inside of our hardware RAID controllers' BBU
> caches.

The msg_store file size is configurable. See msg_store_file_size_limit 
at http://www.rabbitmq.com/configure.html#config-items. If you want to 
set that to 500MiB, go for it.

Regards,

Matthias.

From brett.r.cameron at gmail.com  Wed Nov 20 19:41:45 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Thu, 21 Nov 2013 08:41:45 +1300
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <CAJ4uuZbN6MAv7F_qiaGfA+huaa5t6bZorRDyDn2NOgw9iU8tig@mail.gmail.com>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>
	<CAJ4uuZYsnCeS0BBybKbmJyeM_xqjg4is8MkQkDOtHhHjwrorAA@mail.gmail.com>
	<528C6ECA.80003@rabbitmq.com>
	<CAJ4uuZbN6MAv7F_qiaGfA+huaa5t6bZorRDyDn2NOgw9iU8tig@mail.gmail.com>
Message-ID: <CALPqkioBBBJVrMm7xpX_Q5hgrCFZbbGz923bpzXdCJM8C=fEUQ@mail.gmail.com>

Graeme,

Note that it is possible to change the file size via the
msg_store_file_size_limit
parameter (see http://www.rabbitmq.com/configure.html). While I've not
encountered any issues when changing this parameter I would suggest that
appropriate care needs to be exhibited (i.e. thorough testing).

Brett



On Thu, Nov 21, 2013 at 8:10 AM, Graeme N <graeme at sudo.ca> wrote:

> On Wed, Nov 20, 2013 at 12:11 AM, Matthias Radestock <
> matthias at rabbitmq.com> wrote:
>
>> On 20/11/13 04:38, Graeme N wrote:
>>
>>> Rabbit at the moment doesn't make much effort into making its
>>> workload append only and contiguous by default
>>>
>>
>> Actually all disk writes in rabbit *are* append-only (plus the occasional
>> truncate). But when dealing with multiple disk-bound queues, there is
>> inevitably a fair bit of seeking going on. And SSDs are much quicker at
>> that.
>>
>
>
> Well, I guess that multiple small files, even if they are individually
> written as append only, doesn't really qualify as an append-only workload
> in the sense I'd normally think of it. The reason to use an append-only
> workload is to ensure it performs well on spinning disks by avoiding seeks.
> Looking at the files under /var/lib/rabbitmq/mnesia/rabbit at hostname/msg_store_persistent
> on our busiest host, and we see ~390 files, all <= 17 MiB. Compare to MySQL
> or Riak, where we split the InnoDB or Bitcask append-only logs at 500 MiB,
> which is chosen so it fits inside of our hardware RAID controllers' BBU
> caches.
>
> Our big messages in RabbitMQ are 500kiB to 4MiB, so each of these 16 MiB
> chunks only stores ~10 of these messages, which is far smaller than our
> typical batch size of ~100 messages. Relatively speaking, this is a ton
> more overhead in many small files than we typically see in other datastores
> that bill themselves as spinning disk friendly / append only. When you
> consider that those other data stores use a single set of append-only logs
> for all queues/tables/buckets in the system, and rabbit seems to be
> segmenting them based on queue, it means that rabbit's workload contains at
> least an order of magnitude more seeks when busy than these other storage
> engines.
>
> So, while rabbit's workload at the file chunk level may technically be
> append only, it doesn't actually seem to avoid seeks in its workload, and
> we tend to see pretty massive persistent queue performance improvements by
> using SSDs. Thus, I wouldn't really consider its workload in the same class
> as most append-only storage systems.
>
> Graeme
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/0e02bcca/attachment.htm>

From graeme at sudo.ca  Wed Nov 20 19:50:30 2013
From: graeme at sudo.ca (Graeme N)
Date: Wed, 20 Nov 2013 11:50:30 -0800
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <528D105C.50305@rabbitmq.com>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>
	<CAJ4uuZYsnCeS0BBybKbmJyeM_xqjg4is8MkQkDOtHhHjwrorAA@mail.gmail.com>
	<528C6ECA.80003@rabbitmq.com>
	<CAJ4uuZbN6MAv7F_qiaGfA+huaa5t6bZorRDyDn2NOgw9iU8tig@mail.gmail.com>
	<528D105C.50305@rabbitmq.com>
Message-ID: <CAJ4uuZZVp51tfJXMQtTmNY=Sh9g0t7hKk+K7qNfgK030ZN3Etg@mail.gmail.com>

On Wed, Nov 20, 2013 at 11:41 AM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> On 20/11/13 19:10, Graeme N wrote:
>
>> Looking at the files under
>> /var/lib/rabbitmq/mnesia/rabbit at hostname/msg_store_persistent on our
>> busiest host, and we see ~390 files, all <= 17 MiB. Compare to MySQL or
>> Riak, where we split the InnoDB or Bitcask append-only logs at 500 MiB,
>> which is chosen so it fits inside of our hardware RAID controllers' BBU
>> caches.
>>
>
> The msg_store file size is configurable. See msg_store_file_size_limit at
> http://www.rabbitmq.com/configure.html#config-items. If you want to set
> that to 500MiB, go for it.
>

Well, the docs do explicitly say "You almost certainly should not change
this." Given the lack of stability we've seen with persistent queues so
far, we've definitely shied away from touching anything the docs say not
to, for fear of increasing stability problems. Do you have further guidance
on this option that's not present in the docs about why you would/wouldn't
change this option? For instance, is this safe to increase on active
clusters which already have a lot of data in existing files?

Graeme
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/d1326985/attachment.htm>

From matthias at rabbitmq.com  Wed Nov 20 20:04:09 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 20 Nov 2013 20:04:09 +0000
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <CAJ4uuZZVp51tfJXMQtTmNY=Sh9g0t7hKk+K7qNfgK030ZN3Etg@mail.gmail.com>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>	<CAJ4uuZYsnCeS0BBybKbmJyeM_xqjg4is8MkQkDOtHhHjwrorAA@mail.gmail.com>	<528C6ECA.80003@rabbitmq.com>	<CAJ4uuZbN6MAv7F_qiaGfA+huaa5t6bZorRDyDn2NOgw9iU8tig@mail.gmail.com>	<528D105C.50305@rabbitmq.com>
	<CAJ4uuZZVp51tfJXMQtTmNY=Sh9g0t7hKk+K7qNfgK030ZN3Etg@mail.gmail.com>
Message-ID: <528D15B9.20502@rabbitmq.com>

Graeme,

On 20/11/13 19:50, Graeme N wrote:
> Well, the docs do explicitly say "You almost certainly should not
> change this." Given the lack of stability we've seen with persistent
> queues so far, we've definitely shied away from touching anything the
> docs say not to, for fear of increasing stability problems.

Fair enough, though note that your problems were with mirrored queues,
not the persistence mechanisms. Very few bugs have been found in the
persister in the last few years.

> Do you have further guidance on this option that's not present in the
> docs about why you would/wouldn't change this option?

The main reason for the disclaimer is the difficulty in explaining when 
one would want to change that value and what impact doing so might have.

But if you believe that the default msg_store file size is hurting
performance significantly, then experimenting with different values is
definitely worthwhile. Let us know what you find. Perhaps then we can
give some better guidance to our users than "don't touch this".

> is this safe to increase on active clusters which already have a lot
> of data in existing files?

That should be safe.

Matthias.

From graeme at sudo.ca  Wed Nov 20 20:21:33 2013
From: graeme at sudo.ca (Graeme N)
Date: Wed, 20 Nov 2013 12:21:33 -0800
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <528D15B9.20502@rabbitmq.com>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>
	<CAJ4uuZYsnCeS0BBybKbmJyeM_xqjg4is8MkQkDOtHhHjwrorAA@mail.gmail.com>
	<528C6ECA.80003@rabbitmq.com>
	<CAJ4uuZbN6MAv7F_qiaGfA+huaa5t6bZorRDyDn2NOgw9iU8tig@mail.gmail.com>
	<528D105C.50305@rabbitmq.com>
	<CAJ4uuZZVp51tfJXMQtTmNY=Sh9g0t7hKk+K7qNfgK030ZN3Etg@mail.gmail.com>
	<528D15B9.20502@rabbitmq.com>
Message-ID: <CAJ4uuZZiuKOLY8Gsow1VtkA55dDo5fyWY04D+-zVeDpR6zg8Bg@mail.gmail.com>

On Wed, Nov 20, 2013 at 12:04 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> Fair enough, though note that your problems were with mirrored queues,
> not the persistence mechanisms. Very few bugs have been found in the
> persister in the last few years.


Gotcha. I can't really imagine a situation where you'd actually want single
machine persistence (ie persistent queues without HA), but I guess I'm
fairly risk averse.

The main reason for the disclaimer is the difficulty in explaining when one
> would want to change that value and what impact doing so might have.
>
> But if you believe that the default msg_store file size is hurting
> performance significantly, then experimenting with different values is
> definitely worthwhile. Let us know what you find. Perhaps then we can
> give some better guidance to our users than "don't touch this".


Sounds good. I'll try to generate a synthetic workload on disk based
systems and graph the change in rabbitmq delivery performance. Certainly we
know that apps like Riak, with its universal append-only datastore, see a
much smaller margin of advantage with SSDs over spinning disks compared to
what we're seeing with RabbitMQ on our disk vs SSD nodes. However, I
understand what its data store is doing a lot better than I understand what
RabbitMQ is doing.

For instance:

- Does RabbitMQ have a compaction step like bitcask or innodb, where after
writing a certain amount of append-only work, it coalesces this to a more
efficient on disk format?
- How are deletes handled on queues that don't fully drain? If I increase
the message store size to 500 MiB, but the queues they represent are never
fully emptied, will they just grow to max queue size and stay there like
InnoDB on disk files?

Graeme
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/a601e344/attachment.htm>

From matthias at rabbitmq.com  Wed Nov 20 20:56:51 2013
From: matthias at rabbitmq.com (Matthias Radestock)
Date: Wed, 20 Nov 2013 20:56:51 +0000
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <CAJ4uuZZiuKOLY8Gsow1VtkA55dDo5fyWY04D+-zVeDpR6zg8Bg@mail.gmail.com>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>	<CAJ4uuZYsnCeS0BBybKbmJyeM_xqjg4is8MkQkDOtHhHjwrorAA@mail.gmail.com>	<528C6ECA.80003@rabbitmq.com>	<CAJ4uuZbN6MAv7F_qiaGfA+huaa5t6bZorRDyDn2NOgw9iU8tig@mail.gmail.com>	<528D105C.50305@rabbitmq.com>	<CAJ4uuZZVp51tfJXMQtTmNY=Sh9g0t7hKk+K7qNfgK030ZN3Etg@mail.gmail.com>	<528D15B9.20502@rabbitmq.com>
	<CAJ4uuZZiuKOLY8Gsow1VtkA55dDo5fyWY04D+-zVeDpR6zg8Bg@mail.gmail.com>
Message-ID: <528D2213.4090301@rabbitmq.com>

Graeme,

On 20/11/13 20:21, Graeme N wrote:
> I'll try to generate a synthetic workload on disk based systems and
> graph the change in rabbitmq delivery performance. Certainly we know
> that apps like Riak, with its universal append-only datastore, see a
> much smaller margin of advantage with SSDs over spinning disks
> compared to what we're seeing with RabbitMQ on our disk vs SSD
> nodes. However, I understand what its data store is doing a lot
> better than I understand what RabbitMQ is doing.

There is quite a difference in the nature of the workload for a queue vs
cache vs general store. See
http://www.rabbitmq.com/blog/2011/01/20/rabbitmq-backing-stores-databases-and-disks/ 
for a discussion on that subject.

> - Does RabbitMQ have a compaction step like bitcask or innodb, where
> after writing a certain amount of append-only work, it coalesces this
> to a more efficient on disk format?

Yes, the per-queue persistent storage - which only stores index
information (i.e. what messages are in what in position in a given
queue) has an append-only journal which gets compacted to so-called
segment files. See the essay near the beginning of
http://hg.rabbitmq.com/rabbitmq-server/file/default/src/rabbit_queue_index.erl 
for the gory details.

The main msg_store (where the actual messages are stored) doesn't have 
anything compactable, beyond what's done by the gc (see below).

> - How are deletes handled on queues that don't fully drain? If I
> increase the message store size to 500 MiB, but the queues they
> represent are never fully emptied, will they just grow to max queue
> size and stay there like InnoDB on disk files?

The msg_store has a gc hat has a hard upper bound on the amount of
garbage left around. See the essay near the beginning of
http://hg.rabbitmq.com/rabbitmq-server/file/default/src/rabbit_msg_store.erl 
for the gory details.

Matthias.

From graeme at sudo.ca  Wed Nov 20 22:01:39 2013
From: graeme at sudo.ca (Graeme N)
Date: Wed, 20 Nov 2013 14:01:39 -0800
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <528D2213.4090301@rabbitmq.com>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>
	<CAJ4uuZYsnCeS0BBybKbmJyeM_xqjg4is8MkQkDOtHhHjwrorAA@mail.gmail.com>
	<528C6ECA.80003@rabbitmq.com>
	<CAJ4uuZbN6MAv7F_qiaGfA+huaa5t6bZorRDyDn2NOgw9iU8tig@mail.gmail.com>
	<528D105C.50305@rabbitmq.com>
	<CAJ4uuZZVp51tfJXMQtTmNY=Sh9g0t7hKk+K7qNfgK030ZN3Etg@mail.gmail.com>
	<528D15B9.20502@rabbitmq.com>
	<CAJ4uuZZiuKOLY8Gsow1VtkA55dDo5fyWY04D+-zVeDpR6zg8Bg@mail.gmail.com>
	<528D2213.4090301@rabbitmq.com>
Message-ID: <CAJ4uuZYjr7pkWo=q3BRinBHXDPovbcGf03YNvoJJssa5vr5whw@mail.gmail.com>

On Wed, Nov 20, 2013 at 12:56 PM, Matthias Radestock
<matthias at rabbitmq.com>wrote:

> The msg_store has a gc hat has a hard upper bound on the amount of
> garbage left around. See the essay near the beginning of
>
> http://hg.rabbitmq.com/rabbitmq-server/file/default/src/rabbit_msg_store.erlfor the gory details.
>

This is extremely informative. Definitely helping me get a better
understanding of what Rabbit's IO patterns are. Thanks!

Graeme
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/9db6cdfc/attachment.htm>

From blake.copenhaver at gmail.com  Wed Nov 20 23:24:46 2013
From: blake.copenhaver at gmail.com (blake.copenhaver at gmail.com)
Date: Wed, 20 Nov 2013 15:24:46 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMQ Consumer/Producer Proxy Support
In-Reply-To: <85f69ca9-89f7-48ba-8066-d4fe96b5cdd5@googlegroups.com>
References: <7552ddbc-309f-4c0f-aa73-600a486e287f@googlegroups.com>
	<85f69ca9-89f7-48ba-8066-d4fe96b5cdd5@googlegroups.com>
Message-ID: <5bde35b7-bad8-44ba-9812-209d6db26ea6@googlegroups.com>

Do you happen to have a link where this is documented? I'm not sure that I 
understand how the access control will allow the producer/consumer to 
authenticate behind a proxy. Thank you for your help.

On Monday, November 11, 2013 6:32:53 AM UTC-5, ?????? ???????? wrote:
>
> Rabbitmq has user's access control mechanism. You can use it.
>
> ???????, 8 ?????? 2013 ?., 20:31:41 UTC+4 ???????????? 
> blake.co... at gmail.com ???????:
>>
>> Is it possible for the RabbitMQ producer/consumer to establish a 
>> connection to the broker (RabbitMQ server) from behind an authenticated 
>> proxy? I'm currently leveraging the AMQP 0-9-1 message protocol. 
>>
>> Use Case:
>> Consumer 1 is running on a machine that sits behind a proxy. Consumer 1 
>> would like to authenticate to the proxy so a socket connection can be 
>> established with the broker (RabbitMQ server)
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/a30beb18/attachment.htm>

From mpietrek at skytap.com  Thu Nov 21 02:47:25 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Wed, 20 Nov 2013 18:47:25 -0800
Subject: [rabbitmq-discuss] Excessive RabbitMQ memory consumption
Message-ID: <CACLE7ixT-ECtXxq8uOeDbuK9L_0Cw2A=fpeae1S1ZqJWUsv+0w@mail.gmail.com>

We have a RabbitMQ cluster in production that seems to be using an
excessive amount of memory. I'm trying to figure out what sort of
diagnostics are available to us.

Background: RabbitMQ 3.0.2, Erlang R15B01 on Ubuntu 10.04 (64-bit).

Yes, we'd love to upgrade to 3.2.1 and the latest Erlang, but this is in
production, and we can't just throw something untested (by us, in our
scenario) into production. So we need to understand what's wrong now, and
then we can test on newer releases to validate things are better.

We've now upped our VM to 8GB, and RabbitMQ/Erlang seem more than happy to
just eat up more memory and keep going. Earlier today a node crashed when
the VM had 4GB, and Rabbit tried to allocate 2.2GB (this was the last entry
in our logs). Nothing else of consequence is running on this VM.

Currently the story looks like this:

Roughly 300 queues. Traffic is about 50 messages/second, although at peak
times it goes to 400/second. However, message rates and memory consumption
seem unrelated. Messages are at most 1KB in size. Connections are steady at
600, with 800 channels. We use message acks. Most messages are unacked for
a few milliseconds before they're acked.

Currently Rabbit is consuming in the neighborhood of 1.8GB (via the web ui)
on average. Here's a breakdown of the node reported memory usage details
from the UI:

Connections 154.9MB
Queues 16.2MB
Plugins 89.6kB
Other process memory 14.2MB
Mnesia 2.6MB
Message store index 2.2MB
Management database  1.3GB
Other ETS tables 6.9MB
Binaries 115.9MB
Code 17.5MB
Atoms 654.9kB
Other system 36.1MB

The management database at 1.3GB seems excessive.

Watching the memory consumption over time, it might drop down to 1 GB, then
peak at 2.4GB. It seems to randomly wander between those values over time.
We have our watermark set at 60%, so 4.7GB there.

Needless to say, this is baffling and concerning.

Are their known issues with this configuration? How can we pin down what's
happening?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131120/d6b5caf1/attachment.htm>

From mklishin at gopivotal.com  Thu Nov 21 03:10:44 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 21 Nov 2013 07:10:44 +0400
Subject: [rabbitmq-discuss] RabbitMQ Consumer/Producer Proxy Support
In-Reply-To: <5bde35b7-bad8-44ba-9812-209d6db26ea6@googlegroups.com>
References: <7552ddbc-309f-4c0f-aa73-600a486e287f@googlegroups.com>
	<85f69ca9-89f7-48ba-8066-d4fe96b5cdd5@googlegroups.com>
	<5bde35b7-bad8-44ba-9812-209d6db26ea6@googlegroups.com>
Message-ID: <8260C646-F233-4F6E-9F2A-C3EF0CB710E5@rabbitmq.com>

On 21 Nov 2013, at 03:24, blake.copenhaver at gmail.com wrote:

> I'm not sure that I understand how the access control will allow the producer/consumer to authenticate behind a proxy.

It won?t.

If you need a generic (TCP) proxy with authentication, consider SSH port forwarding [1].

1. http://www.openssh.org/faq.html#2.11

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Thu Nov 21 03:18:10 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 21 Nov 2013 07:18:10 +0400
Subject: [rabbitmq-discuss] Excessive RabbitMQ memory consumption
In-Reply-To: <CACLE7ixT-ECtXxq8uOeDbuK9L_0Cw2A=fpeae1S1ZqJWUsv+0w@mail.gmail.com>
References: <CACLE7ixT-ECtXxq8uOeDbuK9L_0Cw2A=fpeae1S1ZqJWUsv+0w@mail.gmail.com>
Message-ID: <07F9A5A2-0A39-4BA4-99FF-1B1964ECCEC6@rabbitmq.com>

On 21 Nov 2013, at 06:47, Matt Pietrek <mpietrek at skytap.com> wrote:

> The management database at 1.3GB seems excessive.

There were memory leak bug fixes in the management plugin in 3.1.x [1] [2].
Also, you can configure the plugin to use a lower statistics collection interval [3]
but that would simply delay the inevitable.

If you can?t upgrade in the short term, disabling the plugin may help.

1. http://www.rabbitmq.com/release-notes/README-3.1.0.txt
2. http://www.rabbitmq.com/release-notes/README-3.1.2.txt
3. http://www.rabbitmq.com/management.html#configuration

MK

Software Engineer, Pivotal/RabbitMQ



From Shashank.Lothe at techmahindra.com  Thu Nov 21 07:32:57 2013
From: Shashank.Lothe at techmahindra.com (Lothe Shashank)
Date: Thu, 21 Nov 2013 07:32:57 +0000
Subject: [rabbitmq-discuss] Queries regarding rabbitmq-C APIs
Message-ID: <DD7729D61B083D48A2CDCB66A27AD4C98CB7CB@BSDMSATMBX001.mahindrasatyam.ad>

Hi Alan,

Apologies for the late response. For the network cable pull outyou may try the amqp_listen example from v0.3.0. I have added
amqp_simple_wait_frame_noblock AP instead of amqp_simple_wait_frame.

regards,
Shahsank

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/afdf1e06/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: amqps_listen.c
Type: text/x-csrc
Size: 6900 bytes
Desc: amqps_listen.c
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/afdf1e06/attachment.c>

From cbananth at gmail.com  Thu Nov 21 09:45:56 2013
From: cbananth at gmail.com (Ananth)
Date: Thu, 21 Nov 2013 15:15:56 +0530
Subject: [rabbitmq-discuss] Benchmarking rabbitmq
Message-ID: <CAKxuw_e2O8gaDSj6SKWe5Vkr69EuCSDP-o=psMhAuJY18K0dXQ@mail.gmail.com>

Hi,
I am looking to measure the performance of Rabbitmq on Openstack by varying
the load on the control machine that is running rabbitmq.

Are there any tools which i can use, to measure the performance of
rabbitmq? Is it possible to measure the time taken by the rabbitmq server
to send / receive messages by varying the message size and number of
consumers and producers..?

Thank you for the help.

-- 
Regards
Ananth
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/6f1b682b/attachment.htm>

From Punit.Jain at emc.com  Thu Nov 21 09:57:58 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Thu, 21 Nov 2013 04:57:58 -0500
Subject: [rabbitmq-discuss] RabbitMQ couldn't start
Message-ID: <DB14E94115BBC84E8960C12C176D067601779CAF2F@MX25A.corp.emc.com>

We are running RabbitMQ 3.1.3 on Erlang R15B01. The RabbitMQ server couldn't start and threw the following error:





=INFO REPORT==== 25-Oct-2013::10:13:37 ===

Error description:

   {badmatch,{error,{no_such_vhost,<<"/">>}}}



Log files (may contain more information):

   /var/log/rabbitmq/rabbit at ManagementServer.log

   /var/log/rabbitmq/rabbit at ManagementServer-sasl.log



Stack trace:

   [{rabbit_error_logger,boot,0,[]},

    {rabbit,'-run_boot_step/1-lc$^1/1-1-',1,[]},

    {rabbit,run_boot_step,1,[]},

    {rabbit,'-start/2-lc$^0/1-0-',1,[]},

    {rabbit,start,2,[]},

    {application_master,start_it_old,4,

                        [{file,"application_master.erl"},{line,274}]}]





=INFO REPORT==== 25-Oct-2013::10:13:38 ===

Error description:

   {could_not_start,rabbit,

       {bad_return,

           {{rabbit,start,[normal,[]]},

            {'EXIT',

                {rabbit,failure_during_boot,

                    {badmatch,{error,{no_such_vhost,<<"/">>}}}}}}}}


I don't know what exactly caused this error. It just happened once, and to resolve it I had to delete /var/lib/rabbitmq/mnesia and restart the broker. I have attached log file.


Thanks,
Punit
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/972fa3a4/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbit_ManagementServer.log
Type: application/octet-stream
Size: 46613 bytes
Desc: rabbit_ManagementServer.log
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/972fa3a4/attachment.obj>

From emile at rabbitmq.com  Thu Nov 21 10:34:23 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Thu, 21 Nov 2013 10:34:23 +0000
Subject: [rabbitmq-discuss] Benchmarking rabbitmq
In-Reply-To: <CAKxuw_e2O8gaDSj6SKWe5Vkr69EuCSDP-o=psMhAuJY18K0dXQ@mail.gmail.com>
References: <CAKxuw_e2O8gaDSj6SKWe5Vkr69EuCSDP-o=psMhAuJY18K0dXQ@mail.gmail.com>
Message-ID: <528DE1AF.7070004@rabbitmq.com>


Hi,

On 21/11/13 09:45, Ananth wrote:

> Are there any tools which i can use, to measure the performance of
> rabbitmq? Is it possible to measure the time taken by the rabbitmq
> server to send / receive messages by varying the message size and number
> of consumers and producers..?

The tool formerly known as MulticastMain might be of interest:
http://www.rabbitmq.com/java-tools.html#perftest



-Emile





From mklishin at gopivotal.com  Thu Nov 21 10:38:08 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 21 Nov 2013 14:38:08 +0400
Subject: [rabbitmq-discuss] RabbitMQ couldn't start
In-Reply-To: <DB14E94115BBC84E8960C12C176D067601779CAF2F@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D067601779CAF2F@MX25A.corp.emc.com>
Message-ID: <1335D3E5-D72E-4934-AE8C-40BA697879B5@rabbitmq.com>


On 21 Nov 2013, at 13:57, Jain, Punit <Punit.Jain at emc.com> wrote:

> I don?t know what exactly caused this error.

Default vhost (?/?) was removed.

MK

Software Engineer, Pivotal/RabbitMQ



From cbananth at gmail.com  Thu Nov 21 10:44:37 2013
From: cbananth at gmail.com (Ananth)
Date: Thu, 21 Nov 2013 16:14:37 +0530
Subject: [rabbitmq-discuss] Benchmarking rabbitmq
In-Reply-To: <528DE1AF.7070004@rabbitmq.com>
References: <CAKxuw_e2O8gaDSj6SKWe5Vkr69EuCSDP-o=psMhAuJY18K0dXQ@mail.gmail.com>
	<528DE1AF.7070004@rabbitmq.com>
Message-ID: <CAKxuw_cdAk_MZKVGA84xmf47VtLFSDzTXCUJ8+26M8yK0=sywQ@mail.gmail.com>

Thank you very much. I will give it a try. I'll probably have to tweak it a
little to make it work with Openstack.

Regards
Ananth


On Thu, Nov 21, 2013 at 4:04 PM, Emile Joubert <emile at rabbitmq.com> wrote:

>
> Hi,
>
> On 21/11/13 09:45, Ananth wrote:
>
> > Are there any tools which i can use, to measure the performance of
> > rabbitmq? Is it possible to measure the time taken by the rabbitmq
> > server to send / receive messages by varying the message size and number
> > of consumers and producers..?
>
> The tool formerly known as MulticastMain might be of interest:
> http://www.rabbitmq.com/java-tools.html#perftest
>
>
>
> -Emile
>
>
>
>
>


-- 
Regards
Ananth
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/554dddc2/attachment.htm>

From Punit.Jain at emc.com  Thu Nov 21 11:02:54 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Thu, 21 Nov 2013 06:02:54 -0500
Subject: [rabbitmq-discuss] RabbitMQ couldn't start
In-Reply-To: <1335D3E5-D72E-4934-AE8C-40BA697879B5@rabbitmq.com>
References: <DB14E94115BBC84E8960C12C176D067601779CAF2F@MX25A.corp.emc.com>
	<1335D3E5-D72E-4934-AE8C-40BA697879B5@rabbitmq.com>
Message-ID: <DB14E94115BBC84E8960C12C176D067601779CAF3A@MX25A.corp.emc.com>

Hi Michael,
We didn't remove the vhost "/". It was a freshly installed system and nothing was changed in vhost configuration. Could it be a RabbitMQ issue?

Thanks,
-Punit

> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-
> bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
> Sent: Thursday, November 21, 2013 4:08 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] RabbitMQ couldn't start
> 
> 
> On 21 Nov 2013, at 13:57, Jain, Punit <Punit.Jain at emc.com> wrote:
> 
> > I don't know what exactly caused this error.
> 
> Default vhost ("/") was removed.
> 
> MK
> 
> Software Engineer, Pivotal/RabbitMQ
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From mklishin at gopivotal.com  Thu Nov 21 11:07:20 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 21 Nov 2013 15:07:20 +0400
Subject: [rabbitmq-discuss] RabbitMQ couldn't start
In-Reply-To: <DB14E94115BBC84E8960C12C176D067601779CAF3A@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D067601779CAF2F@MX25A.corp.emc.com>
	<1335D3E5-D72E-4934-AE8C-40BA697879B5@rabbitmq.com>
	<DB14E94115BBC84E8960C12C176D067601779CAF3A@MX25A.corp.emc.com>
Message-ID: <6F4A7B04-49F5-44F2-A51E-09A9B0C397AF@rabbitmq.com>


On 21 Nov 2013, at 15:02, Jain, Punit <Punit.Jain at emc.com> wrote:

> We didn't remove the vhost "/". It was a freshly installed system and nothing was changed in vhost configuration.

If so, did you move Mnesia directory to a non-standard location? Do you have log files you can send
(privately to me if there?s sensitive information in them)?

MK

Software Engineer, Pivotal/RabbitMQ



From simon at rabbitmq.com  Thu Nov 21 12:11:22 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 21 Nov 2013 12:11:22 +0000
Subject: [rabbitmq-discuss] Excessive RabbitMQ memory consumption
In-Reply-To: <CACLE7ixT-ECtXxq8uOeDbuK9L_0Cw2A=fpeae1S1ZqJWUsv+0w@mail.gmail.com>
References: <CACLE7ixT-ECtXxq8uOeDbuK9L_0Cw2A=fpeae1S1ZqJWUsv+0w@mail.gmail.com>
Message-ID: <528DF86A.70601@rabbitmq.com>

On 21/11/13 02:47, Matt Pietrek wrote:
> The management database at 1.3GB seems excessive.

To add to what Michael said: yes, this is excessive. Almost certainly 
one of the leaks we've fixed since 3.0.2.

As a rule of thumb I would expect the management DB to take about as 
much memory as Mnesia. Certainly within an order of magnitude anyway.

I'm reluctant to get into tracking down exactly which old bug you are 
seeing :-) but there were definitely leaks in 3.0.2 such that:

* Connection and channel data was never cleaned up for nodes that crashed

* Consumer records might not be cleaned up

* Fine stats were issued for queue slaves and never cleaned up even when 
the queue was deleted

If you can't upgrade, in addition to the suggestions Michael made 
(increase the stats interval or disable the management plugin) there's a 
halfway house: disable fine stats collection 
(http://previous.rabbitmq.com/v3_0_x/management.html#fine-stats). This 
will stop you seeing message rates but will prevent some of those leaks.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From henrifourie1 at gmail.com  Thu Nov 21 13:29:27 2013
From: henrifourie1 at gmail.com (Henri Fourie)
Date: Thu, 21 Nov 2013 05:29:27 -0800 (PST)
Subject: [rabbitmq-discuss] Queued messages chart History
Message-ID: <5546970e-fc81-4206-b810-e09422ec0db0@googlegroups.com>

Hi

I am running a four node RabbitMQ cluster version 3.1.0-1 on CentOS 6.3. 

While monitoring RabbitMQ on the overview tab, looking at the charts, our 
queued messages averages out at about 50 on a normal day. In the evenings 
when we have more load on our applications, that queues starts to increase, 
as we would expect - It will go up to about 150 000 queued messages.

So we have about eleven different queues in this cluster, and if I would 
look at the individual queues in the evening on higher load, I can see 
which queue it is that is getting bigger, if I select that queue and look 
at its graph, I can see how it gets bigger over time.

However if I check out the queues the next morning, there is no more 
history of those high queues anymore, the chart just displays normal queued 
messages of 50 for the history of "Last Day"

Anyone else experiencing this? I am fairly new to the rabbit world, so 
please bare with me.

*Your help is much appreciated.*
*Henri*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/6ef70d76/attachment.htm>

From sp345s at att.com  Thu Nov 21 16:03:46 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Thu, 21 Nov 2013 16:03:46 +0000
Subject: [rabbitmq-discuss] vHost
Message-ID: <59BF56992750434F89F8EBE141E64B1D0183612D@GAALPA1MSGUSR9C.ITServices.sbc.com>


I have configured 3 virtual host's main, client1, client2.. I have 2 exchanges created on all there vhost's - inboundExchange and outBoundExchange  ..

Is it possible that I can bind from main(vHost)-inboundExchange(Exchange)  to client1(Vhost)-inboundExchange(Exchange)  if routing key is client.# and do the same for client2 and client3 from main..

Binding across the vhost's resources... I don't see this possible through management console ..

Appreciate your help ..
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/a7ce7404/attachment.htm>

From mklishin at gopivotal.com  Thu Nov 21 18:25:52 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Thu, 21 Nov 2013 22:25:52 +0400
Subject: [rabbitmq-discuss] vHost
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D0183612D@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D0183612D@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <D1E92D58-0879-4BE9-8182-BC8C66673D0E@rabbitmq.com>


On 21 Nov 2013, at 20:03, PATAR, SAGAR <sp345s at att.com> wrote:

> Is it possible that I can bind from main(vHost)-inboundExchange(Exchange)  to client1(Vhost)-inboundExchange(Exchange)  if routing key is client.# and do the same for client2 and client3 from main..
>  
> Binding across the vhost?s resources? I don?t see this possible through management console ..

No, it?s not possible.

The whole point of vhosts is to completely isolate resources (exchanges, queues, bindings, user permissions, etc)
between groups.

MK

Software Engineer, Pivotal/RabbitMQ



From sp345s at att.com  Thu Nov 21 18:36:07 2013
From: sp345s at att.com (PATAR, SAGAR)
Date: Thu, 21 Nov 2013 18:36:07 +0000
Subject: [rabbitmq-discuss] vHost
In-Reply-To: <D1E92D58-0879-4BE9-8182-BC8C66673D0E@rabbitmq.com>
References: <59BF56992750434F89F8EBE141E64B1D0183612D@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<D1E92D58-0879-4BE9-8182-BC8C66673D0E@rabbitmq.com>
Message-ID: <59BF56992750434F89F8EBE141E64B1D01836163@GAALPA1MSGUSR9C.ITServices.sbc.com>

Thanks ...

I have a requirement where clients should be able to consume messages from a topic ...

Topic1.xxx --- should be consumed by client 1, client 2, client 3
Topic2.xxx --- should be consumed by client 4, client 5

I created 2 user's topic1User and topic2User...

I was not able to restrict any user from accessing the other topic (exchange) .. 
Setting permissions seems to be working at Queue level.. Not sure how to get this working ..

Appreciate all your help .. 

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Michael Klishin
Sent: Thursday, November 21, 2013 1:26 PM
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] vHost


On 21 Nov 2013, at 20:03, PATAR, SAGAR <sp345s at att.com> wrote:

> Is it possible that I can bind from main(vHost)-inboundExchange(Exchange)  to client1(Vhost)-inboundExchange(Exchange)  if routing key is client.# and do the same for client2 and client3 from main..
>  
> Binding across the vhost's resources... I don't see this possible through management console ..

No, it's not possible.

The whole point of vhosts is to completely isolate resources (exchanges, queues, bindings, user permissions, etc)
between groups.

MK

Software Engineer, Pivotal/RabbitMQ


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From mpietrek at skytap.com  Thu Nov 21 19:24:49 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 21 Nov 2013 11:24:49 -0800
Subject: [rabbitmq-discuss] Excessive RabbitMQ memory consumption
In-Reply-To: <528DF86A.70601@rabbitmq.com>
References: <CACLE7ixT-ECtXxq8uOeDbuK9L_0Cw2A=fpeae1S1ZqJWUsv+0w@mail.gmail.com>
	<528DF86A.70601@rabbitmq.com>
Message-ID: <CACLE7izXkKsg5v=rAkZGUiBY=bJHm1G0x3-698v9S51VrK-RuQ@mail.gmail.com>

Thanks Michael and Simon - This is immensely helpful. Just knowing some
place to focus on is great. Given the nature of the issues, it appears
consistent with what we've observed in our various test scenarios.

I've got 3.2.1 running in a different cluster for testing. Hopefully it
will validate quickly and we can move to it sooner rather than later.

One more question - Without restarting the broker, is there any way to
restart just the management agent and/or force a GC so as to clean up
memory? This might buy us some time until we can upgrade.

Thanks again,

Matt


On Thu, Nov 21, 2013 at 4:11 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 21/11/13 02:47, Matt Pietrek wrote:
>
>> The management database at 1.3GB seems excessive.
>>
>
> To add to what Michael said: yes, this is excessive. Almost certainly one
> of the leaks we've fixed since 3.0.2.
>
> As a rule of thumb I would expect the management DB to take about as much
> memory as Mnesia. Certainly within an order of magnitude anyway.
>
> I'm reluctant to get into tracking down exactly which old bug you are
> seeing :-) but there were definitely leaks in 3.0.2 such that:
>
> * Connection and channel data was never cleaned up for nodes that crashed
>
> * Consumer records might not be cleaned up
>
> * Fine stats were issued for queue slaves and never cleaned up even when
> the queue was deleted
>
> If you can't upgrade, in addition to the suggestions Michael made
> (increase the stats interval or disable the management plugin) there's a
> halfway house: disable fine stats collection (
> http://previous.rabbitmq.com/v3_0_x/management.html#fine-stats). This
> will stop you seeing message rates but will prevent some of those leaks.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/e416bbe3/attachment.htm>

From s.sciarrati at gmail.com  Thu Nov 21 19:54:39 2013
From: s.sciarrati at gmail.com (Simone Sciarrati)
Date: Thu, 21 Nov 2013 20:54:39 +0100
Subject: [rabbitmq-discuss] Excessive RabbitMQ memory consumption
In-Reply-To: <CACLE7izXkKsg5v=rAkZGUiBY=bJHm1G0x3-698v9S51VrK-RuQ@mail.gmail.com>
References: <CACLE7ixT-ECtXxq8uOeDbuK9L_0Cw2A=fpeae1S1ZqJWUsv+0w@mail.gmail.com>
	<528DF86A.70601@rabbitmq.com>
	<CACLE7izXkKsg5v=rAkZGUiBY=bJHm1G0x3-698v9S51VrK-RuQ@mail.gmail.com>
Message-ID: <CAOQTPw5ZpSaYVV4Zmhs7Hgw86xAsU7RvPbbPktNnQHVptt0wbw@mail.gmail.com>

Hi,

As reported in this message
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-April/019446.html
you should be able to do:

rabbitmqctl eval 'application:stop(rabbitmq_management).'
rabbitmqctl eval 'application:start(rabbitmq_management).'

to just restart the management plugin. I have had the same issue and
stopping/starting the management app dropped the memory usage, in my
case it took 2/3 minutes to complete the command but the node remained
functional during the operation (if I remember correctly we had a
similar amount of memory held by the management db).

Test before you run :)

Simone

On Thu, Nov 21, 2013 at 8:24 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
> Thanks Michael and Simon - This is immensely helpful. Just knowing some
> place to focus on is great. Given the nature of the issues, it appears
> consistent with what we've observed in our various test scenarios.
>
> I've got 3.2.1 running in a different cluster for testing. Hopefully it will
> validate quickly and we can move to it sooner rather than later.
>
> One more question - Without restarting the broker, is there any way to
> restart just the management agent and/or force a GC so as to clean up
> memory? This might buy us some time until we can upgrade.
>
> Thanks again,
>
> Matt
>
>
> On Thu, Nov 21, 2013 at 4:11 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
>>
>> On 21/11/13 02:47, Matt Pietrek wrote:
>>>
>>> The management database at 1.3GB seems excessive.
>>
>>
>> To add to what Michael said: yes, this is excessive. Almost certainly one
>> of the leaks we've fixed since 3.0.2.
>>
>> As a rule of thumb I would expect the management DB to take about as much
>> memory as Mnesia. Certainly within an order of magnitude anyway.
>>
>> I'm reluctant to get into tracking down exactly which old bug you are
>> seeing :-) but there were definitely leaks in 3.0.2 such that:
>>
>> * Connection and channel data was never cleaned up for nodes that crashed
>>
>> * Consumer records might not be cleaned up
>>
>> * Fine stats were issued for queue slaves and never cleaned up even when
>> the queue was deleted
>>
>> If you can't upgrade, in addition to the suggestions Michael made
>> (increase the stats interval or disable the management plugin) there's a
>> halfway house: disable fine stats collection
>> (http://previous.rabbitmq.com/v3_0_x/management.html#fine-stats). This will
>> stop you seeing message rates but will prevent some of those leaks.
>>
>> Cheers, Simon
>>
>> --
>> Simon MacMullen
>> RabbitMQ, Pivotal
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From mklishin at gopivotal.com  Thu Nov 21 20:00:49 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 22 Nov 2013 00:00:49 +0400
Subject: [rabbitmq-discuss] ANN amq-protocol 1.9.0 is released
Message-ID: <AFD4BAB2-32F4-46F5-8283-70658DCC091C@rabbitmq.com>

amq-protocol 1.9.0 is released [1] to rubygems.org.

This release includes bug fixes and major (about 589 times [2]) throughput
increase in channel id allocator.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/11/21/amq-protocol-1-dot-9-0-is-released/

1. https://rubygems.org/gems/amq-protocol/versions/1.9.0
2. https://github.com/ruby-amqp/amq-protocol/pull/35

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Thu Nov 21 20:02:28 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 22 Nov 2013 00:02:28 +0400
Subject: [rabbitmq-discuss] ANN amqp gem 1.1.2 is released
Message-ID: <73075F82-C3FB-4434-99A0-C47E44D61981@rabbitmq.com>

amqp gem 1.1.2 is released [1] to rubygems.org.

This release includes bug fixes and a major (about 589 times [2]) throughput
increase in channel id allocator (via amq-protocol 1.9.0).

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/11/21/amqp-gem-1-dot-1-2-is-released/

1. https://rubygems.org/gems/amqp/versions/1.1.2
2. https://github.com/ruby-amqp/amq-protocol/pull/35

MK

Software Engineer, Pivotal/RabbitMQ



From demesg at gmail.com  Thu Nov 21 22:29:32 2013
From: demesg at gmail.com (ku3ia)
Date: Thu, 21 Nov 2013 14:29:32 -0800 (PST)
Subject: [rabbitmq-discuss] Channel performance question
Message-ID: <1385072972141-31569.post@n5.nabble.com>

Hi all!
I'm developing a c# application. It uses multi-threads, please, advise what
will be faster by performance:
1. Open one connection and for each thread in application open a channel and
keep it alive during thread is live, or
2. Open one connection and for each operation in threads, for example,
publish or message consuming open and close a channel.

Many thanks!




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Channel-performance-question-tp31569.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mpietrek at skytap.com  Fri Nov 22 00:05:43 2013
From: mpietrek at skytap.com (Matt Pietrek)
Date: Thu, 21 Nov 2013 16:05:43 -0800
Subject: [rabbitmq-discuss] Excessive RabbitMQ memory consumption
In-Reply-To: <CAOQTPw5ZpSaYVV4Zmhs7Hgw86xAsU7RvPbbPktNnQHVptt0wbw@mail.gmail.com>
References: <CACLE7ixT-ECtXxq8uOeDbuK9L_0Cw2A=fpeae1S1ZqJWUsv+0w@mail.gmail.com>
	<528DF86A.70601@rabbitmq.com>
	<CACLE7izXkKsg5v=rAkZGUiBY=bJHm1G0x3-698v9S51VrK-RuQ@mail.gmail.com>
	<CAOQTPw5ZpSaYVV4Zmhs7Hgw86xAsU7RvPbbPktNnQHVptt0wbw@mail.gmail.com>
Message-ID: <CACLE7iw99EwD0UdTr-s_KxG5kC-eZh0yav_-WWEdDA1pM11N3w@mail.gmail.com>

Thanks Simone! I figured there was something like this. And the discussion
you referenced is also very helpful.

Matt


On Thu, Nov 21, 2013 at 11:54 AM, Simone Sciarrati <s.sciarrati at gmail.com>wrote:

> Hi,
>
> As reported in this message
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2012-April/019446.html
> you should be able to do:
>
> rabbitmqctl eval 'application:stop(rabbitmq_management).'
> rabbitmqctl eval 'application:start(rabbitmq_management).'
>
> to just restart the management plugin. I have had the same issue and
> stopping/starting the management app dropped the memory usage, in my
> case it took 2/3 minutes to complete the command but the node remained
> functional during the operation (if I remember correctly we had a
> similar amount of memory held by the management db).
>
> Test before you run :)
>
> Simone
>
> On Thu, Nov 21, 2013 at 8:24 PM, Matt Pietrek <mpietrek at skytap.com> wrote:
> > Thanks Michael and Simon - This is immensely helpful. Just knowing some
> > place to focus on is great. Given the nature of the issues, it appears
> > consistent with what we've observed in our various test scenarios.
> >
> > I've got 3.2.1 running in a different cluster for testing. Hopefully it
> will
> > validate quickly and we can move to it sooner rather than later.
> >
> > One more question - Without restarting the broker, is there any way to
> > restart just the management agent and/or force a GC so as to clean up
> > memory? This might buy us some time until we can upgrade.
> >
> > Thanks again,
> >
> > Matt
> >
> >
> > On Thu, Nov 21, 2013 at 4:11 AM, Simon MacMullen <simon at rabbitmq.com>
> wrote:
> >>
> >> On 21/11/13 02:47, Matt Pietrek wrote:
> >>>
> >>> The management database at 1.3GB seems excessive.
> >>
> >>
> >> To add to what Michael said: yes, this is excessive. Almost certainly
> one
> >> of the leaks we've fixed since 3.0.2.
> >>
> >> As a rule of thumb I would expect the management DB to take about as
> much
> >> memory as Mnesia. Certainly within an order of magnitude anyway.
> >>
> >> I'm reluctant to get into tracking down exactly which old bug you are
> >> seeing :-) but there were definitely leaks in 3.0.2 such that:
> >>
> >> * Connection and channel data was never cleaned up for nodes that
> crashed
> >>
> >> * Consumer records might not be cleaned up
> >>
> >> * Fine stats were issued for queue slaves and never cleaned up even when
> >> the queue was deleted
> >>
> >> If you can't upgrade, in addition to the suggestions Michael made
> >> (increase the stats interval or disable the management plugin) there's a
> >> halfway house: disable fine stats collection
> >> (http://previous.rabbitmq.com/v3_0_x/management.html#fine-stats). This
> will
> >> stop you seeing message rates but will prevent some of those leaks.
> >>
> >> Cheers, Simon
> >>
> >> --
> >> Simon MacMullen
> >> RabbitMQ, Pivotal
> >
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/c93d75da/attachment.htm>

From graeme at sudo.ca  Fri Nov 22 00:50:20 2013
From: graeme at sudo.ca (Graeme N)
Date: Thu, 21 Nov 2013 16:50:20 -0800
Subject: [rabbitmq-discuss] Does SSD improve rabbitmq's performance
In-Reply-To: <CAJ4uuZYjr7pkWo=q3BRinBHXDPovbcGf03YNvoJJssa5vr5whw@mail.gmail.com>
References: <023CBAD52AC91842B08759362DE8396C0FD5801AEA@bestex3.800best.net>
	<CAJ4uuZYsnCeS0BBybKbmJyeM_xqjg4is8MkQkDOtHhHjwrorAA@mail.gmail.com>
	<528C6ECA.80003@rabbitmq.com>
	<CAJ4uuZbN6MAv7F_qiaGfA+huaa5t6bZorRDyDn2NOgw9iU8tig@mail.gmail.com>
	<528D105C.50305@rabbitmq.com>
	<CAJ4uuZZVp51tfJXMQtTmNY=Sh9g0t7hKk+K7qNfgK030ZN3Etg@mail.gmail.com>
	<528D15B9.20502@rabbitmq.com>
	<CAJ4uuZZiuKOLY8Gsow1VtkA55dDo5fyWY04D+-zVeDpR6zg8Bg@mail.gmail.com>
	<528D2213.4090301@rabbitmq.com>
	<CAJ4uuZYjr7pkWo=q3BRinBHXDPovbcGf03YNvoJJssa5vr5whw@mail.gmail.com>
Message-ID: <CAJ4uuZYRdgLMTXFXCYonPPX8SvqVmvs6n-FrPhjBfzqxFgQivA@mail.gmail.com>

Quick update for this, I've got some initial numbers on a box with 8x10k
RPM SAS disks in RAID5, with 128GiB of RAM:

 msg_store_file_size_limit (MiB) queues msgs / queue msg size (MB) total
msgs total msg size (MB) runtime (s) runtime (s) avg throughput MB/s 161001500
1 150000150000 449458 330.76 32100 15001 150000150000 425418 355.87 641001500
1 150000150000 401400 374.53 128100 15001 150000150000 385390 387.10 2561001500
1 150000150000 383385 390.63
I get some reasonable gains by bumping msg_store_file_size_limit up to 128
MiB, 256 MiB seems to be only marginal returns. This may simply be because
it can't batch up more data than that in RAM prior to writing, given the
RAM in my test system. Note that the underlying FS itself is capable of
delivering 780MB/s in block writes, so this is still less than I expected
to see, but demonstrates there's some minor advantages to be had by using
larger store sizes.

My next theory was that 100 queues would mean a minimum of 100 on disk
persistent files, and that I'd see better block throughput with less queues
and more messages. However, testing with lower numbers of queues and higher
messages per queue (to keep total messages delivered constant) revealed
some weird behaviour:

msg_store_file_size_limit (MiB)queuesmsgs / queuemsg size (MB)total msgstotal
msg size (MB)runtime (s)runtime (s)avg throughput MB/s12810015001150000
150000385390387.101285030001150000150000373376400.531282560001150000150000
409413364.9612810150001150000150000463442331.491285300001150000150000465448
328.59
Looks like queue contention becomes a bigger bottleneck than IO throughput
once you get below 50 queues, which is a result I didn't expect. In any
case, looks like max storage size ~= RAM hits some sort of
buffering/contention sweet spot, at least with larger messages, so that's
something which should be easy enough to automate.

Graeme




On Wed, Nov 20, 2013 at 2:01 PM, Graeme N <graeme at sudo.ca> wrote:

> On Wed, Nov 20, 2013 at 12:56 PM, Matthias Radestock <
> matthias at rabbitmq.com> wrote:
>
>> The msg_store has a gc hat has a hard upper bound on the amount of
>> garbage left around. See the essay near the beginning of
>>
>> http://hg.rabbitmq.com/rabbitmq-server/file/default/src/rabbit_msg_store.erlfor the gory details.
>>
>
> This is extremely informative. Definitely helping me get a better
> understanding of what Rabbit's IO patterns are. Thanks!
>
> Graeme
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/d5fd57cb/attachment.htm>

From carl.hoerberg at gmail.com  Fri Nov 22 03:13:42 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Thu, 21 Nov 2013 19:13:42 -0800 (PST)
Subject: [rabbitmq-discuss] channel_max
Message-ID: <1385090022896-31572.post@n5.nabble.com>

We would love to be able to define channel_max, for us the default 65536 is
way too high. Some clients are creating thousands of channels, often due to
bugs, and is consuming all available memory. 



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/channel-max-tp31572.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From mklishin at gopivotal.com  Fri Nov 22 09:17:50 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 22 Nov 2013 13:17:50 +0400
Subject: [rabbitmq-discuss] Channel performance question
In-Reply-To: <1385072972141-31569.post@n5.nabble.com>
References: <1385072972141-31569.post@n5.nabble.com>
Message-ID: <4E631BD7-3076-4934-911B-6449B89B6A96@rabbitmq.com>


On 22 Nov 2013, at 02:29, ku3ia <demesg at gmail.com> wrote:

> 1. Open one connection and for each thread in application open a channel and
> keep it alive during thread is live, or
> 2. Open one connection and for each operation in threads, for example,
> publish or message consuming open and close a channel.

#1 will be faster because you avoid a network roundtrip (channel.open, channel.open-ok) per
operation.

Keep in mind that channels are also units of error handling (for soft/recoverable errors)
in the protocol, so performance should not be your only consideration.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Fri Nov 22 09:20:47 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 22 Nov 2013 13:20:47 +0400
Subject: [rabbitmq-discuss] channel_max
In-Reply-To: <1385090022896-31572.post@n5.nabble.com>
References: <1385090022896-31572.post@n5.nabble.com>
Message-ID: <21AF4D92-9E7D-4AA8-96CC-788060ECBDAB@rabbitmq.com>


On 22 Nov 2013, at 07:13, carlhoerberg <carl.hoerberg at gmail.com> wrote:

> We would love to be able to define channel_max, for us the default 65536 is
> way too high. Some clients are creating thousands of channels, often due to
> bugs, and is consuming all available memory. 

Carl,

I did some research and there appears to be at least 3 bugs in our tracker
relevant to your request (22844, 22525, 21384).

The conclusion seems to be that global channel limit would likely be insufficient. What you
really want is per-user limits and/or extra statistics collected by the management plugin to
assist you with rogue user detection.

Making channel_max default configurable is not hard to do and it may even be possible to
get this into a point 3.2.x release. Will this be sufficient for your needs?

MK

Software Engineer, Pivotal/RabbitMQ



From Michal.Skorepa at Honeywell.com  Fri Nov 22 09:53:39 2013
From: Michal.Skorepa at Honeywell.com (Skorepa, Michal)
Date: Fri, 22 Nov 2013 09:53:39 +0000
Subject: [rabbitmq-discuss] SSL connection - ASN1 error
In-Reply-To: <531212E8-5EEC-40AD-B837-5DFE655F77BE@rabbitmq.com>
References: <ABBDC9D7002EB54AB98BA60DA16D269333FF7171@FR44EX3003.global.ds.honeywell.com>
	<524A9911.6040603@rabbitmq.com>
	<ABBDC9D7002EB54AB98BA60DA16D269333FF71E1@FR44EX3003.global.ds.honeywell.com>
	<BE8B2303-7B48-4EEE-B758-D679EFB8C999@rabbitmq.com>
	<ABBDC9D7002EB54AB98BA60DA16D26934295B432@FR44EX3003.global.ds.honeywell.com>
	<F0867114-7F45-40BB-AF6A-7A6860D05256@rabbitmq.com>
	<ABBDC9D7002EB54AB98BA60DA16D26934295BCA3@FR44EX3003.global.ds.honeywell.com>
	<531212E8-5EEC-40AD-B837-5DFE655F77BE@rabbitmq.com>
Message-ID: <ABBDC9D7002EB54AB98BA60DA16D26934295CDB0@FR44EX3003.global.ds.honeywell.com>

Hello Tim,

Yes, I am sure it is pointing to the correct certificates. The swim_cm_connector module is really simple.
Here is a relevant fragment of the code:

------------------------------------------------------------------------------------------------------------------
-module(swim_cm_connector).
-include_lib("amqp_client/include/amqp_client.hrl").
-compile([{parse_transform, lager_transform}]).
-behaviour(gen_server).

.
.
.

handle_info({connect, CoS}, State) ->
	lager:notice("Connector connecting on CoS ~p.  Connector PID: ~p", [CoS, self()]),
	ConnectionParamsBasic = #amqp_params_network{host = swim_cm_tools:set_broker(),
												port = swim_cm_tools:set_port(),
												virtual_host = swim_cm_tools:set_vhost(),
												username = swim_cm_tools:set_username(),
												password = swim_cm_tools:set_password(),
												heartbeat = swim_cm_tools:set_heartbeat(),
												socket_options = [{tos, swim_cm_tools:set_tos(CoS)}]},
	lager:notice("SSL: ~p", [application:get_env(ssl)]),
	case application:get_env(ssl) of
		{ok, true} ->
			lager:notice("SSL enabled. Setting SSL parameters."),
			ConnectionParams = ConnectionParamsBasic#amqp_params_network{ssl_options = [{cacertfile, swim_cm_tools:set_cacertfile()},
																						{certfile, swim_cm_tools:set_certfile()},
																						{keyfile, swim_cm_tools:set_key()},
																						{verify, swim_cm_tools:set_verify()},
																						{fail_if_no_peer_cert, swim_cm_tools:set_no_peer_cert()}]};
		_ ->
			lager:notice("SSL disabled. Setting basic parameters."),
			ConnectionParams = ConnectionParamsBasic
	end,
	lager:debug("Connection parameters: ~p.", [ConnectionParams]),
	try amqp_connection:start(ConnectionParams) of
		{ok, Conn_ID} ->
			lager:notice("Connection setup for CoS ~p successful. Target broker: ~p", [CoS, ConnectionParams#amqp_params_network.host]),
			gen_server:cast({global, swim_conn_serv}, {connected, CoS, Conn_ID}),
			lager:info("Work is done, shutting down the connector for CoS ~p.", [CoS]),
			{stop, normal, State};
		{error, Error} ->
			lager:error("Connection setup error: ~p", [Error]),
			case application:get_env(reconnect_interval) of
				{ok, Timeout} ->
					ok;
				undefined ->
					Timeout = 5000
			end,
			lager:info("Connection setup ERROR. Repeating connection setup after: ~p seconds...", [Timeout / 1000]),
			{noreply, {connect, CoS}, Timeout}
	catch
		Exception:Reason -> 
			lager:error("Exception caught in connection setup for CoS ~p.~n Exception: ~p~n Reason: ~p", [CoS, Exception, Reason]),
			{stop, exception, State}
	end;

------------------------------------------------------------------------------------------------------------------


I am sure the code is correct. It runs perfectly fine on Debian systems. But is throws the error when I run it on a custom built Openembedded system (Yocto/Poky project) which is hosted on a Gumstix platform. There might be maybe something missing in the system or something might not be cross-compiled correctly but I have no idea what it might be or how to test it.

Thank you for any help!

Michal








-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Tim Watson
Sent: 18. listopadu 2013 11:33
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] SSL connection - ASN1 error

Hi Michal,

What does this swim_cm_connector module look like? Are you sure it's pointing to the correct certificates when establishing the connection?

Cheers,
Tim
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From emile at rabbitmq.com  Fri Nov 22 10:02:14 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 22 Nov 2013 10:02:14 +0000
Subject: [rabbitmq-discuss] vHost
In-Reply-To: <59BF56992750434F89F8EBE141E64B1D01836163@GAALPA1MSGUSR9C.ITServices.sbc.com>
References: <59BF56992750434F89F8EBE141E64B1D0183612D@GAALPA1MSGUSR9C.ITServices.sbc.com>
	<D1E92D58-0879-4BE9-8182-BC8C66673D0E@rabbitmq.com>
	<59BF56992750434F89F8EBE141E64B1D01836163@GAALPA1MSGUSR9C.ITServices.sbc.com>
Message-ID: <528F2BA6.80807@rabbitmq.com>


Hi,

On 21/11/13 18:36, PATAR, SAGAR wrote:

> I have a requirement where clients should be able to consume messages from a topic ...
> 
> Topic1.xxx --- should be consumed by client 1, client 2, client 3
> Topic2.xxx --- should be consumed by client 4, client 5
> 
> I created 2 user's topic1User and topic2User...
> 
> I was not able to restrict any user from accessing the other topic (exchange) .. 
> Setting permissions seems to be working at Queue level.. Not sure how to get this working ..

Consuming from a queue requires read access, so grant topic1User read
access only on Topic1.* and topic2User read access only on Topic2.*

If clients publish to a named (rather than the default) exchange then
you can assign write access in a similar way to prevent them from
publishing to each others exchanges.

See the access control documentation for more details:
http://www.rabbitmq.com/access-control.html


-Emile




From ayip at recondynamics.com  Fri Nov 22 02:19:29 2013
From: ayip at recondynamics.com (Adrian Yip)
Date: Thu, 21 Nov 2013 18:19:29 -0800
Subject: [rabbitmq-discuss] Posting MQTT to RabbitMQ QOS=1
Message-ID: <8d289f0142c2ca19ceb10823391e161e@mail.gmail.com>

Hi,



I have a receiver that is waiting on an topic exchange and I can publish
MQTT messages with Mosquitto with QOS=0 just fine from multiple clients,
1000s of messages.



When I publish with QOS=1 however, the client appears successful in
publishing, but the receiver always stops at 20 messages.  I can kick off
another client without stopping the receiver and it will also do the same
thing, the receiver will show 20 messages and nothing more.



Ideas?



Adrian









Receive_json.py

------------------



#!/usr/bin/env python

import pika, traceback

import json



prev_id = 0



def callback(ch, method, properties, body):

    global prev_id



    ch.basic_ack(delivery_tag=method.delivery_tag)

    msgBody = json.loads(body)

    print " [x] %r:%r" % (method.routing_key,msgBody,)

    if prev_id + 1 != int(msgBody['id']):

        print "Missing %d" % (prev_id + 1)

    prev_id = msgBody['id']

    return





while True:

    try:



        connection = pika.BlockingConnection(pika.ConnectionParameters(

                host='localhost'))

        channel = connection.channel()



        channel.exchange_declare(exchange='mqtt.topic',

                                 type='topic')



        result = channel.queue_declare("mqtt-json-queue")

        queue_name = result.method.queue



        # topic here is what the mqtt plugin posts to

        channel.queue_bind(exchange='mqtt.topic',

                           queue=queue_name,

                           routing_key="json_routing_key")



        print ' [*] Waiting for logs. To exit press CTRL+C'



        channel.basic_consume(callback,

                              queue=queue_name

                              )



        channel.start_consuming()



    except Exception, e:

        traceback.print_exc()





Client

------



import mosquitto

import sys

import time

import random

import json



def on_connect(self, mosq, obj, rc):

    if rc == 0:

        print("Connected successfully.")



if len(sys.argv) != 4:

    print "Usage: cnt sleep_s qos"

    exit(-1)

cnt = int(sys.argv[1])

sleep_s = float(sys.argv[2])

qos = int(sys.argv[3])



client = mosquitto.Mosquitto("test-client%d" % random.randint(1,100))

print client._client_id



client.connect("localhost",port=1884)



i = 1

while i <=  cnt:

    print "Sending JSON msg %d via MQTT" % i

    msg = {}

    msg["id"] = i



    try :

        client.publish("json_routing_key",json.dumps(msg),qos=qos)

    except :

        print "Unexpected publish error: ",sys.exc_info()[0]

    i = i + 1



    time.sleep(sleep_s)



time.sleep(2)

try:

    client.disconnect()

except:

    print "Unexpected disconnect error: ",sys.exc_info()[0]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/dc80cfb6/attachment.htm>

From barshow at dropbox.com  Fri Nov 22 04:06:40 2013
From: barshow at dropbox.com (barshow at dropbox.com)
Date: Thu, 21 Nov 2013 20:06:40 -0800 (PST)
Subject: [rabbitmq-discuss] High load average on mirrored nodes
Message-ID: <1f4b2536-5b4a-4e5b-adea-2d0a5b7b907e@googlegroups.com>

I am running a three node cluster all on the same type of hardware.  All of 
my consumers and publisher connect to one node we have assigned as the 
master node lets call it rabbit-1.  This is also the master node for all of 
our queues.  All nodes are disc nodes and all queues are HA to all nodes. 
 And all messages are published with deliveryMode 2.  The load average, all 
the metrics and performance of rabbit-1 are what I would expect.  But the 
load average of the other boxes, that have no connections (publishers or 
consumers) and are not master nodes to anything have a load average that is 
higher than rabbit-1.  At first I blamed the hardware or configuration or 
something, but it seems pretty consistent across all our clusters.

So my question is do nodes that have durable queues mirrored to them but 
are not the master nodes have any characteristics that could cause this? 
 Or should I keep digging?

Running Ubuntu 12.04.2 with raid0 xfs disk.  Rabbit is the only thing on 
these boxes.  Rabbit 3.1.5.


Thanks for your time!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131121/47f0c143/attachment.htm>

From simon at rabbitmq.com  Fri Nov 22 10:38:27 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 22 Nov 2013 10:38:27 +0000
Subject: [rabbitmq-discuss] Queued messages chart History
In-Reply-To: <5546970e-fc81-4206-b810-e09422ec0db0@googlegroups.com>
References: <5546970e-fc81-4206-b810-e09422ec0db0@googlegroups.com>
Message-ID: <528F3423.5090005@rabbitmq.com>

On 21/11/2013 13:29, Henri Fourie wrote:
> However if I check out the queues the next morning, there is no more
> history of those high queues anymore, the chart just displays normal
> queued messages of 50 for the history of "Last Day"
>
> Anyone else experiencing this? I am fairly new to the rabbit world, so
> please bare with me.

You should see http://www.rabbitmq.com/management.html#sample-retention. 
By default the management plugin retains global history for one day and 
per-queue history for one hour. You probably want to increase these numbers.

Cheers, Simon



From simon at rabbitmq.com  Fri Nov 22 10:43:37 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 22 Nov 2013 10:43:37 +0000
Subject: [rabbitmq-discuss] High load average on mirrored nodes
In-Reply-To: <1f4b2536-5b4a-4e5b-adea-2d0a5b7b907e@googlegroups.com>
References: <1f4b2536-5b4a-4e5b-adea-2d0a5b7b907e@googlegroups.com>
Message-ID: <528F3559.2060704@rabbitmq.com>

Depending on how much higher "higher" means, this could be normal. Slave 
queues in fact do slightly more work than master queues (they still need 
to accept every publish and (almost) deliver every delivery and keep 
track of every ack (sure, they don't actually send the message to the 
client, but that's quite cheap).

But they also need to do some additional book keeping on publish to 
ensure messages aren't lost when the master dies.

So how much higher is higher?

Cheers, Simon

On 22/11/2013 04:06, barshow at dropbox.com wrote:
> I am running a three node cluster all on the same type of hardware.  All
> of my consumers and publisher connect to one node we have assigned as
> the master node lets call it rabbit-1.  This is also the master node for
> all of our queues.  All nodes are disc nodes and all queues are HA to
> all nodes.  And all messages are published with deliveryMode 2.  The
> load average, all the metrics and performance of rabbit-1 are what I
> would expect.  But the load average of the other boxes, that have no
> connections (publishers or consumers) and are not master nodes to
> anything have a load average that is higher than rabbit-1.  At first I
> blamed the hardware or configuration or something, but it seems pretty
> consistent across all our clusters.
>
> So my question is do nodes that have durable queues mirrored to them but
> are not the master nodes have any characteristics that could cause this?
>   Or should I keep digging?
>
> Running Ubuntu 12.04.2 with raid0 xfs disk.  Rabbit is the only thing on
> these boxes.  Rabbit 3.1.5.
>
>
> Thanks for your time!
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From carl.hoerberg at gmail.com  Fri Nov 22 11:07:24 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Fri, 22 Nov 2013 03:07:24 -0800 (PST)
Subject: [rabbitmq-discuss] channel_max
In-Reply-To: <21AF4D92-9E7D-4AA8-96CC-788060ECBDAB@rabbitmq.com>
References: <1385090022896-31572.post@n5.nabble.com>
	<21AF4D92-9E7D-4AA8-96CC-788060ECBDAB@rabbitmq.com>
Message-ID: <8C0F82EDC6934FCEB15046AA1C2ABB8D@gmail.com>

A configurable default channel_max would help a lot! the overwhelming majority of all uses-cases we see use only a handfull of channels anyway. 



On Friday 22 November 2013 at 16:27, Michael Klishin-2 [via RabbitMQ] wrote:

> 
> On 22 Nov 2013, at 07:13, carlhoerberg <[hidden email] (/user/SendEmail.jtp?type=node&node=31574&i=0)> wrote: 
> 
> > We would love to be able to define channel_max, for us the default 65536 is 
> > way too high. Some clients are creating thousands of channels, often due to 
> > bugs, and is consuming all available memory. 
> 
> 
> Carl, 
> 
> I did some research and there appears to be at least 3 bugs in our tracker 
> relevant to your request (22844, 22525, 21384). 
> 
> The conclusion seems to be that global channel limit would likely be insufficient. What you 
> really want is per-user limits and/or extra statistics collected by the management plugin to 
> assist you with rogue user detection. 
> 
> Making channel_max default configurable is not hard to do and it may even be possible to 
> get this into a point 3.2.x release. Will this be sufficient for your needs? 
> 
> MK 
> 
> Software Engineer, Pivotal/RabbitMQ 
> 
> 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=31574&i=1) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/channel-max-tp31572p31574.html 
> To unsubscribe from channel_max, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=31572&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MzE1NzJ8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/channel-max-tp31572p31581.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131122/54e652ef/attachment.htm>

From mklishin at gopivotal.com  Fri Nov 22 13:06:40 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Fri, 22 Nov 2013 17:06:40 +0400
Subject: [rabbitmq-discuss] channel_max
In-Reply-To: <8C0F82EDC6934FCEB15046AA1C2ABB8D@gmail.com>
References: <1385090022896-31572.post@n5.nabble.com>
	<21AF4D92-9E7D-4AA8-96CC-788060ECBDAB@rabbitmq.com>
	<8C0F82EDC6934FCEB15046AA1C2ABB8D@gmail.com>
Message-ID: <57235940-E60E-4D90-B238-E5458E7E3DC2@rabbitmq.com>


On 22 Nov 2013, at 15:07, carlhoerberg <carl.hoerberg at gmail.com> wrote:

> A configurable default channel_max would help a lot! the overwhelming majority of all uses-cases we see use only a handfull of channels anyway. 

More research suggests that many clients (including the most popular Java and Ruby ones) will need updating
to pick a lower configuration value than the server. So this is not something that can be fixed quickly.

MK

Software Engineer, Pivotal/RabbitMQ



From videlalvaro at gmail.com  Fri Nov 22 13:37:25 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Fri, 22 Nov 2013 14:37:25 +0100
Subject: [rabbitmq-discuss] channel_max
In-Reply-To: <57235940-E60E-4D90-B238-E5458E7E3DC2@rabbitmq.com>
References: <1385090022896-31572.post@n5.nabble.com>
	<21AF4D92-9E7D-4AA8-96CC-788060ECBDAB@rabbitmq.com>
	<8C0F82EDC6934FCEB15046AA1C2ABB8D@gmail.com>
	<57235940-E60E-4D90-B238-E5458E7E3DC2@rabbitmq.com>
Message-ID: <CAMcAHLVyREqCCbO0CVbpAJqo+xXR=cdcyvF4FV4zgw6Xdru_SA@mail.gmail.com>

What about a policy, which could be applied to users on a vhost, and
that would tell home many channels a particular user can open? If the
user is over the limit, then throw a channel exception?

I'd guess then that users from a hosted RabbitMQ will know that they
can open say 10 channels, or else get an exception.

-Alvaro

On Fri, Nov 22, 2013 at 2:06 PM, Michael Klishin <mklishin at gopivotal.com> wrote:
>
> On 22 Nov 2013, at 15:07, carlhoerberg <carl.hoerberg at gmail.com> wrote:
>
>> A configurable default channel_max would help a lot! the overwhelming majority of all uses-cases we see use only a handfull of channels anyway.
>
> More research suggests that many clients (including the most popular Java and Ruby ones) will need updating
> to pick a lower configuration value than the server. So this is not something that can be fixed quickly.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From carl.hoerberg at gmail.com  Fri Nov 22 13:15:51 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Fri, 22 Nov 2013 05:15:51 -0800 (PST)
Subject: [rabbitmq-discuss] channel_max
In-Reply-To: <57235940-E60E-4D90-B238-E5458E7E3DC2@rabbitmq.com>
References: <1385090022896-31572.post@n5.nabble.com>
	<21AF4D92-9E7D-4AA8-96CC-788060ECBDAB@rabbitmq.com>
	<8C0F82EDC6934FCEB15046AA1C2ABB8D@gmail.com>
	<57235940-E60E-4D90-B238-E5458E7E3DC2@rabbitmq.com>
Message-ID: <CAFPidkN-MMKpRjMe0jCEzZB7hF9d34mEhhv1g78pj37FggoaiA@mail.gmail.com>

Ok, was afraid of that..
On Nov 22, 2013 8:09 PM, "Michael Klishin-2 [via RabbitMQ]" <
ml-node+s1065348n31582h63 at n5.nabble.com> wrote:

>
> On 22 Nov 2013, at 15:07, carlhoerberg <[hidden email]<http://user/SendEmail.jtp?type=node&node=31582&i=0>>
> wrote:
>
> > A configurable default channel_max would help a lot! the overwhelming
> majority of all uses-cases we see use only a handfull of channels anyway.
>
> More research suggests that many clients (including the most popular Java
> and Ruby ones) will need updating
> to pick a lower configuration value than the server. So this is not
> something that can be fixed quickly.
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> [hidden email] <http://user/SendEmail.jtp?type=node&node=31582&i=1>
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> ------------------------------
>  If you reply to this email, your message will be added to the discussion
> below:
> http://rabbitmq.1065348.n5.nabble.com/channel-max-tp31572p31582.html
>  To unsubscribe from channel_max, click here<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=31572&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MzE1NzJ8LTEyNDcxMDc4NjM=>
> .
> NAML<http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml>
>




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/channel-max-tp31572p31583.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131122/bcbdec3b/attachment.htm>

From michael.laing at nytimes.com  Fri Nov 22 16:09:03 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Fri, 22 Nov 2013 11:09:03 -0500
Subject: [rabbitmq-discuss] mgt ui filter is not a regex
Message-ID: <CAKgmDnHb1qVWkvrSfKejU4+iBKAiddvt1DaBxwkFXBiHGteHCA@mail.gmail.com>

I don't find the filter very useful in the management ui because it is not
a regular expression.

But maybe I am the only one with lots of patterns in my names for things...

Cheers,

ml
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131122/47b4a678/attachment.htm>

From emile at rabbitmq.com  Fri Nov 22 16:13:00 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 22 Nov 2013 16:13:00 +0000
Subject: [rabbitmq-discuss] Posting MQTT to RabbitMQ QOS=1
In-Reply-To: <8d289f0142c2ca19ceb10823391e161e@mail.gmail.com>
References: <8d289f0142c2ca19ceb10823391e161e@mail.gmail.com>
Message-ID: <528F828C.5020206@rabbitmq.com>


Hi Andrian,


On 22/11/13 02:19, Adrian Yip wrote:

> When I publish with QOS=1 however, the client appears successful in
> publishing, but the receiver always stops at 20 messages.  I can kick
> off another client without stopping the receiver and it will also do the
> same thing, the receiver will show 20 messages and nothing more.

The default mosquitto max_inflight_messages is 20. Set this to a higher
number or unlimited, and do the same for the broker prefetch configuration.




-Emile

From simon at rabbitmq.com  Fri Nov 22 16:15:15 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 22 Nov 2013 16:15:15 +0000
Subject: [rabbitmq-discuss] mgt ui filter is not a regex
In-Reply-To: <CAKgmDnHb1qVWkvrSfKejU4+iBKAiddvt1DaBxwkFXBiHGteHCA@mail.gmail.com>
References: <CAKgmDnHb1qVWkvrSfKejU4+iBKAiddvt1DaBxwkFXBiHGteHCA@mail.gmail.com>
Message-ID: <528F8313.2080402@rabbitmq.com>

On 22/11/2013 16:09, Laing, Michael wrote:
> I don't find the filter very useful in the management ui because it is
> not a regular expression.

Check the nightly builds :-)

(With thanks to Joseph Weeks who contributed the first version of the patch)

Cheers, Simon

From kansalneha28 at yahoo.com  Fri Nov 22 17:47:02 2013
From: kansalneha28 at yahoo.com (Neha Kansal)
Date: Fri, 22 Nov 2013 09:47:02 -0800 (PST)
Subject: [rabbitmq-discuss] Where is list of users stored?
Message-ID: <1385142422.48796.YahooMailNeo@web141706.mail.bf1.yahoo.com>

Hi,

I would like to know where is the list of users stored by RabbitMQ. The reason being, we created a new server by taking an entire snapshot of an old one, but a user that was created on the old one did not get copied over. 

I looked in the rabbitmq directory and wasnt able to figure out if the users were stored somewhere in there.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131122/32e4778e/attachment.htm>

From emile at rabbitmq.com  Fri Nov 22 19:02:18 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 22 Nov 2013 19:02:18 +0000
Subject: [rabbitmq-discuss] Where is list of users stored?
In-Reply-To: <1385142422.48796.YahooMailNeo@web141706.mail.bf1.yahoo.com>
References: <1385142422.48796.YahooMailNeo@web141706.mail.bf1.yahoo.com>
Message-ID: <528FAA3A.7070504@rabbitmq.com>


Hi,

On 22/11/13 17:47, Neha Kansal wrote:

> I would like to know where is the list of users stored by RabbitMQ.


Users are stored in the Mnesia database, in the rabbit_user table.  You
can find the list of users by running "rabbitmqctl list_users". Make
sure the broker is shutdown cleanly before making copies of the database
folder.


-Emile



From jhalterman at gmail.com  Fri Nov 22 21:43:47 2013
From: jhalterman at gmail.com (Jonathan Halterman)
Date: Fri, 22 Nov 2013 13:43:47 -0800
Subject: [rabbitmq-discuss] ANN Lyra 0.3.2 - High Availability RabbitMQ
	Client
Message-ID: <CA+es_-wEWfwhx9MdwD6sssGWE9itQXMFP57Rho5xU6dQFsKbTg@mail.gmail.com>

I'm happy to announce that version 0.3.2 of Lyra, a high availability
RabbitMQ client for the JVM, is released!

This version includes several improvements and bug fixes, as well as a few
minor API changes. See the changelog and release milestone for more details:

https://github.com/jhalterman/lyra/blob/master/CHANGES.txt
https://github.com/jhalterman/lyra/issues?milestone=1&page=1&state=closed

Cheers,
Jonathan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131122/863f28ac/attachment.htm>

From jhalterman at gmail.com  Fri Nov 22 22:12:08 2013
From: jhalterman at gmail.com (Jonathan Halterman)
Date: Fri, 22 Nov 2013 14:12:08 -0800
Subject: [rabbitmq-discuss] ANN Lyra 0.3.2 - High Availability RabbitMQ
	Client
In-Reply-To: <CA+es_-wEWfwhx9MdwD6sssGWE9itQXMFP57Rho5xU6dQFsKbTg@mail.gmail.com>
References: <CA+es_-wEWfwhx9MdwD6sssGWE9itQXMFP57Rho5xU6dQFsKbTg@mail.gmail.com>
Message-ID: <CA+es_-yfqEVkMii2RzacwM6d5M4Zmm8GLz20ArceNSQteRw_Vw@mail.gmail.com>

Forgot a link to the Lyra project page:

https://github.com/jhalterman/lyra<https://github.com/jhalterman/lyra/blob/master/CHANGES.txt>


On Fri, Nov 22, 2013 at 1:43 PM, Jonathan Halterman <jhalterman at gmail.com>wrote:

> I'm happy to announce that version 0.3.2 of Lyra, a high availability
> RabbitMQ client for the JVM, is released!
>
> This version includes several improvements and bug fixes, as well as a few
> minor API changes. See the changelog and release milestone for more details:
>
> https://github.com/jhalterman/lyra/blob/master/CHANGES.txt
> https://github.com/jhalterman/lyra/issues?milestone=1&page=1&state=closed
>
> Cheers,
> Jonathan
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131122/06c20568/attachment.htm>

From kansalneha28 at yahoo.com  Fri Nov 22 22:25:40 2013
From: kansalneha28 at yahoo.com (Neha Kansal)
Date: Fri, 22 Nov 2013 14:25:40 -0800 (PST)
Subject: [rabbitmq-discuss] Where is list of users stored?
In-Reply-To: <528FAA3A.7070504@rabbitmq.com>
References: <1385142422.48796.YahooMailNeo@web141706.mail.bf1.yahoo.com>
	<528FAA3A.7070504@rabbitmq.com>
Message-ID: <1385159140.56714.YahooMailNeo@web141703.mail.bf1.yahoo.com>

Thanks, Emile. That's very helpful. I tried to scan a lot of folders in the Rabbit directory, but somehow missed these.





On Friday, November 22, 2013 11:02 AM, Emile Joubert <emile at rabbitmq.com> wrote:
 

Hi,

On 22/11/13 17:47, Neha Kansal wrote:

> I would like to know where is the list of users stored by RabbitMQ.


Users are stored in the Mnesia database, in the rabbit_user table.? You
can find the list of users by running "rabbitmqctl list_users". Make
sure the broker is shutdown cleanly before making copies of the database
folder.


-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131122/b8b0a856/attachment.htm>

From kansalneha28 at yahoo.com  Fri Nov 22 22:41:32 2013
From: kansalneha28 at yahoo.com (Neha Kansal)
Date: Fri, 22 Nov 2013 14:41:32 -0800 (PST)
Subject: [rabbitmq-discuss] Where is list of users stored?
In-Reply-To: <528FAA3A.7070504@rabbitmq.com>
References: <1385142422.48796.YahooMailNeo@web141706.mail.bf1.yahoo.com>
	<528FAA3A.7070504@rabbitmq.com>
Message-ID: <1385160092.77027.YahooMailNeo@web141703.mail.bf1.yahoo.com>

If anyone has any other suggestions of why the created user could be missing from the server snapshot, besides RabbitMQ still running at the time of taking snapshot, that will be helpful. Thanks.
??? 




On Friday, November 22, 2013 11:02 AM, Emile Joubert <emile at rabbitmq.com> wrote:
 

Hi,

On 22/11/13 17:47, Neha Kansal wrote:

> I would like to know where is the list of users stored by RabbitMQ.


Users are stored in the Mnesia database, in the rabbit_user table.? You
can find the list of users by running "rabbitmqctl list_users". Make
sure the broker is shutdown cleanly before making copies of the database
folder.


-Emile
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131122/79abb471/attachment.htm>

From shridharan.m at gmail.com  Fri Nov 22 23:56:12 2013
From: shridharan.m at gmail.com (shridharan muthu)
Date: Fri, 22 Nov 2013 15:56:12 -0800
Subject: [rabbitmq-discuss] High cpu usage on CentOS boxes
Message-ID: <CAPK6OevH6WFnnWXf6Dc9H_81vtBnKn+6na-_qbNi1-0mHAE2Wg@mail.gmail.com>

Hi There,

    I am experiencing high cpu usage (above 400%) on Cent OS rabbit mq
cluster (with 2 nodes). We have a similar setup in Ubuntu and cpu usage
seems fine. Pls fine the report, status and top below.

OS: *CentOS release 6.4*

Report:
*{pid,2148},*
* {running_applications,*
*     [{rabbitmq_management,"RabbitMQ Management Console","3.0.2"},*
*      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.2"},*
*      {rabbit,"RabbitMQ","3.0.2"},*
*      {os_mon,"CPO  CXC 138 46","2.2.7"},*
*      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.2"},*
*      {webmachine,"webmachine","1.9.1-rmq3.0.2-git52e62bc"},*
*      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.2-gitd541e9a"},*
*      {xmerl,"XML parser","1.2.10"},*
*      {inets,"INETS  CXC 138 49","5.7.1"},*
*      {mnesia,"MNESIA  CXC 138 12","4.5"},*
*      {amqp_client,"RabbitMQ AMQP Client","3.0.2"},*
*      {sasl,"SASL  CXC 138 11","2.1.10"},*
*      {stdlib,"ERTS  CXC 138 10","1.17.5"},*
*      {kernel,"ERTS  CXC 138 10","2.14.5"}]},*
* {os,{unix,linux}},*
* {erlang_version,*
*     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:12:12] [rq:12]
[async-threads:30] [kernel-poll:true]\n"},*
* {memory,*
*     [{total,285898072},*
*      {connection_procs,16592856},*
*      {queue_procs,1064888},*
*      {plugins,269872},*
*      {other_proc,13173224},*
*      {mnesia,100632},*
*      {mgmt_db,2167672},*
*      {msg_index,35352},*
*      {other_ets,72058416},*
*      {binary,7326576},*
*      {code,17434264},*
*      {atom,3356065},*
*      {other_system,152318255}]},*
* {vm_memory_high_watermark,0.4},*
* {vm_memory_limit,4991811584},*
* {disk_free_limit,1000000000},*
* {disk_free,17927184384},*
* {file_descriptors,*
*     [{total_limit,199900},*
*      {total_used,314},*
*      {sockets_limit,179908},*
*      {sockets_used,312}]},*
* {processes,[{limit,1048576},{used,2703}]},*
* {run_queue,0},*
* {uptime,3207797}]*


From carl.hoerberg at gmail.com  Sat Nov 23 07:21:42 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Fri, 22 Nov 2013 23:21:42 -0800 (PST)
Subject: [rabbitmq-discuss] channel_max
In-Reply-To: <CAMcAHLVyREqCCbO0CVbpAJqo+xXR=cdcyvF4FV4zgw6Xdru_SA@mail.gmail.com>
References: <1385090022896-31572.post@n5.nabble.com>
	<21AF4D92-9E7D-4AA8-96CC-788060ECBDAB@rabbitmq.com>
	<8C0F82EDC6934FCEB15046AA1C2ABB8D@gmail.com>
	<57235940-E60E-4D90-B238-E5458E7E3DC2@rabbitmq.com>
	<CAMcAHLVyREqCCbO0CVbpAJqo+xXR=cdcyvF4FV4zgw6Xdru_SA@mail.gmail.com>
Message-ID: <E855E262D810426D8E30A14B314C9B9F@gmail.com>

Sure, that would be ideal, but that would require even more client side support, right? 



On Friday 22 November 2013 at 20:40, Alvaro Videla-2 [via RabbitMQ] wrote:

> What about a policy, which could be applied to users on a vhost, and 
> that would tell home many channels a particular user can open? If the 
> user is over the limit, then throw a channel exception? 
> 
> I'd guess then that users from a hosted RabbitMQ will know that they 
> can open say 10 channels, or else get an exception. 
> 
> -Alvaro 
> 
> On Fri, Nov 22, 2013 at 2:06 PM, Michael Klishin <[hidden email] (/user/SendEmail.jtp?type=node&node=31584&i=0)> wrote: 
> 
> > 
> > On 22 Nov 2013, at 15:07, carlhoerberg <[hidden email] (/user/SendEmail.jtp?type=node&node=31584&i=1)> wrote: 
> > 
> > > A configurable default channel_max would help a lot! the overwhelming majority of all uses-cases we see use only a handfull of channels anyway. 
> > 
> > More research suggests that many clients (including the most popular Java and Ruby ones) will need updating 
> > to pick a lower configuration value than the server. So this is not something that can be fixed quickly. 
> > 
> > MK 
> > 
> > Software Engineer, Pivotal/RabbitMQ 
> > 
> > 
> > _______________________________________________ 
> > rabbitmq-discuss mailing list 
> > [hidden email] (/user/SendEmail.jtp?type=node&node=31584&i=2) 
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss_______________________________________________ 
> 
> rabbitmq-discuss mailing list 
> [hidden email] (/user/SendEmail.jtp?type=node&node=31584&i=3) 
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/channel-max-tp31572p31584.html 
> To unsubscribe from channel_max, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=31572&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MzE1NzJ8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml) 







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/channel-max-tp31572p31597.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131122/3c2a12e4/attachment.htm>

From carl.hoerberg at gmail.com  Sat Nov 23 07:32:00 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Fri, 22 Nov 2013 23:32:00 -0800 (PST)
Subject: [rabbitmq-discuss] channel_max
In-Reply-To: <57235940-E60E-4D90-B238-E5458E7E3DC2@rabbitmq.com>
References: <1385090022896-31572.post@n5.nabble.com>
	<21AF4D92-9E7D-4AA8-96CC-788060ECBDAB@rabbitmq.com>
	<8C0F82EDC6934FCEB15046AA1C2ABB8D@gmail.com>
	<57235940-E60E-4D90-B238-E5458E7E3DC2@rabbitmq.com>
Message-ID: <1385191920837-31598.post@n5.nabble.com>

Actually, we would still prefer to have it configurable, even though clients
doesn't implement it right now, because: 

1. client side support will come eventually 
2. we rather have clients crash and burn than our servers, if they use many
channels. (but i guess the problem is that even though you haven't many
channels open concurrently, if they open and close channels the channel id
will increment to 65k, and then wrap around, which will be wrong if the
server has a lower channel_max) (point 1. is still valid though)




--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/channel-max-tp31572p31598.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From hitendra.mahida at slscorp.com  Sat Nov 23 09:32:23 2013
From: hitendra.mahida at slscorp.com (Hitendrasinh Mahida)
Date: Sat, 23 Nov 2013 15:02:23 +0530
Subject: [rabbitmq-discuss] HTTP subscriber for Windows
Message-ID: <52907627.30009@slscorp.com>

Hi,
I am using RabbitMQ with AMQP on Windows Server. I need to make 
Subscriber call back over HTTP.

Searching online I found that I can User RabbitHUB / XMPP / PUBSUBHUBBUB.

I have no idea which one to chose and How to implement it.

Please, Help me / Guide me related to this.

Thanks,
Mahida


From moisesgallego at gmail.com  Sat Nov 23 00:52:48 2013
From: moisesgallego at gmail.com (Moises Gallego)
Date: Fri, 22 Nov 2013 16:52:48 -0800 (PST)
Subject: [rabbitmq-discuss] Error starting Rabbitmq-server Segmentation Fault
Message-ID: <4854cf03-4c2b-495a-9dbc-18600fec2a5a@googlegroups.com>

Hi,

I'm try to install rabbitmq in a Ubuntu 12.04 Server 64bits, but fails when 
try to start the server.

This is the installation output:

Selecting previously unselected package rabbitmq-server.
(Leyendo la base de datos ... 37850 ficheros o directorios instalados 
actualmente.)
Desempaquetando rabbitmq-server (de .../rabbitmq-server_3.2.1-1_all.deb) ...
Procesando disparadores para man-db ...
Procesando disparadores para ureadahead ...
Configurando rabbitmq-server (3.2.1-1) ...
 * Starting message broker rabbitmq-server
 * FAILED - check /var/log/rabbitmq/startup_\{log, _err\}
   ...fail!
invoke-rc.d: initscript rabbitmq-server, action "start" failed.
dpkg: error al procesar rabbitmq-server (--configure):
 el subproceso instalado el script post-installation devolvi? el c?digo de 
salida de error 1
Se encontraron errores al procesar:
 rabbitmq-server
E: Sub-process /usr/bin/dpkg returned an error code (1)


And this is the error log output:

/usr/lib/rabbitmq/bin/rabbitmq-server: line 94: 15497 Segmentation fault   
   ${ERL_DIR}erl -pa "$RABBITMQ_EBIN_ROOT" -boot "${CLEAN_BOOT_FILE}" 
-noinput -hidden -s rabbit_prelaunch -sname rabbitmqprelaunch$$ -ex
tra "${RABBITMQ_NODENAME}"


I installed following this instructions; 
http://www.rabbitmq.com/install-debian.html

Anybody can help me please?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131122/29b844cb/attachment.htm>

From alan.antonuk at gmail.com  Sat Nov 23 16:41:35 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sat, 23 Nov 2013 08:41:35 -0800
Subject: [rabbitmq-discuss] amqp_simple_wait_frame_noblock() timing issue
In-Reply-To: <27E054594442884E9A46DBCF9AE7408161090E@BSDMSATMBX001.mahindrasatyam.ad>
References: <27E054594442884E9A46DBCF9AE7408161090E@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAAt2po+4Ns_Y=eNB3M8K5BosJ3zvMO56gtmw1kMXFiMV_5b8Ew@mail.gmail.com>

Rohit;

The amqp_simple_wait_frame_noblock() API wasn't added until v0.4.0, so I'm
not really sure what you're using. My first suggestion is to upgrade to the
latest released version of rabbitmq-c (v0.4.1).

Also you're not the first person to say they're using
amqp_simple_wait_frame_noblock() on v0.3.0, could you tell me where you got
this package from?

-Alan


On Mon, Nov 18, 2013 at 11:46 PM, Rohit Patle <Rohit.Patel2 at techmahindra.com
> wrote:

>  Hi Team,
>
> I am using amqp_simple_wait_frame_noblock() instead of
> amqp_simple_wait_frame() in amqps_listen.c. But I am getting the
> timeout(AMQP_STATUS_TIMEOUT) in around 1-2seconds instead of specified
> time( i.e t.tv_sec=10).
>
> FYI I am using rabbitmq-c client library v0.3.0.
>
> Please suggest.
>
> Thanks you,
> ROhit
>
>
> ------------------------------
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of the
> intended recipient/s and may contain material that is CONFIDENTIAL AND
> PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or
> distribution or forwarding of any or all of the contents in this message is
> STRICTLY PROHIBITED. If you are not the intended recipient, please contact
> the sender by email and delete all copies; your cooperation in this regard
> is appreciated.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131123/49006e02/attachment.htm>

From alan.antonuk at gmail.com  Sat Nov 23 16:35:57 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Sat, 23 Nov 2013 08:35:57 -0800
Subject: [rabbitmq-discuss] Queries regarding rabbitmq-C APIs
In-Reply-To: <DD7729D61B083D48A2CDCB66A27AD4C98CB7CB@BSDMSATMBX001.mahindrasatyam.ad>
References: <DD7729D61B083D48A2CDCB66A27AD4C98CB7CB@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAAt2poKhf0M5PeQi4OSFg=gyfX0o=cnd_CrGY=Yh4nSOhB6jJQ@mail.gmail.com>

I've created a bug to track this:
https://github.com/alanxz/rabbitmq-c/issues/152

Could you tell me what platform (Win32?, Linux?, Mac OS X?) you're seeing
this behavior on?

-Alan


On Wed, Nov 20, 2013 at 11:32 PM, Lothe Shashank <
Shashank.Lothe at techmahindra.com> wrote:

>  Hi Alan,
>
> Apologies for the late response. For the network cable pull outyou may
> try the amqp_listen example from v0.3.0. I have added
> amqp_simple_wait_frame_noblock AP instead of amqp_simple_wait_frame.
>
> regards,
> Shahsank
>
> ------------------------------
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of the
> intended recipient/s and may contain material that is CONFIDENTIAL AND
> PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or
> distribution or forwarding of any or all of the contents in this message is
> STRICTLY PROHIBITED. If you are not the intended recipient, please contact
> the sender by email and delete all copies; your cooperation in this regard
> is appreciated.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131123/d9391fa8/attachment.htm>

From arachweb at gmail.com  Sat Nov 23 20:54:51 2013
From: arachweb at gmail.com (Paul)
Date: Sat, 23 Nov 2013 15:54:51 -0500
Subject: [rabbitmq-discuss] Cluster capability?
Message-ID: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>

Hi All,

I've been away from RabbitMQ and from this list for about two years. I'm a bit rusty. And having lately begun to think about a distributed architecture, and knowing that RabbitMQ is *good* for this kind of thing, I realized that I need to ask some questions. 

My initial requirement is simple to state: if a client on computer A publishes to an exchange on computer A, can that message be auto-magically propagated to other brokers on other computers?

The reading I've done suggests that clustering (as opposed to federation or Shovel) might be the way to go.  But then I read something about HA queues and was uncertain as to what is required.

A use case here looks something like this:

1. Client on computer A publishes message X to local exchange on computer A
2. Client on computer B consumes message X from its local exchange on computer B

The intent here is that each client should need to know only its local broker. Clients should not need to know anything about another computer or broker.

How is this best done using RabbitMQ?

Thanks!

-Paul



From michael.s.klishin at gmail.com  Sat Nov 23 22:04:46 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 24 Nov 2013 02:04:46 +0400
Subject: [rabbitmq-discuss] Error starting Rabbitmq-server Segmentation
	Fault
In-Reply-To: <4854cf03-4c2b-495a-9dbc-18600fec2a5a@googlegroups.com>
References: <4854cf03-4c2b-495a-9dbc-18600fec2a5a@googlegroups.com>
Message-ID: <CAE3HoVQtyppAnmWJ62KOgYEXbuyJu97E+A9=6wTc6whxLrfHQg@mail.gmail.com>

2013/11/23 Moises Gallego <moisesgallego at gmail.com>

> And this is the error log output:
>
> /usr/lib/rabbitmq/bin/rabbitmq-server: line 94: 15497 Segmentation fault
>    ${ERL_DIR}erl -pa "$RABBITMQ_EBIN_ROOT" -boot "${CLEAN_BOOT_FILE}"
> -noinput -hidden -s rabbit_prelaunch -sname rabbitmqprelaunch$$ -ex
> tra "${RABBITMQ_NODENAME}"
>

Segfaults is ultimately an Erlang runtime issue. Try a different version
from backports or
Erlang Solutions [1]. Also, make sure you have Erlang for the right
architecture.

1. https://www.erlang-solutions.com/downloads/download-erlang-otp
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131124/15d10c70/attachment.htm>

From michael.s.klishin at gmail.com  Sat Nov 23 22:06:08 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sun, 24 Nov 2013 02:06:08 +0400
Subject: [rabbitmq-discuss] HTTP subscriber for Windows
In-Reply-To: <52907627.30009@slscorp.com>
References: <52907627.30009@slscorp.com>
Message-ID: <CAE3HoVQwBsn-OvHYew8=XiB-KS1REsB2eA8o5vv=0k2AwXfr_A@mail.gmail.com>

2013/11/23 Hitendrasinh Mahida <hitendra.mahida at slscorp.com>

> Searching online I found that I can User RabbitHUB / XMPP / PUBSUBHUBBUB.
>
> I have no idea which one to chose and How to implement it.
>
> Please, Help me / Guide me related to this.
>

XMPP has nothing to do with RabbitMQ or HTTP.

RabbitHub should have some docs but simply fetching messages is possible
over
RabbitMQ HTTP API that ships with the management plugin:

http://www.rabbitmq.com/management.html#http-api
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131124/0a4c1b10/attachment.htm>

From mklishin at gopivotal.com  Sun Nov 24 11:08:18 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 24 Nov 2013 15:08:18 +0400
Subject: [rabbitmq-discuss] ANN Ruby RabbitMQ HTTP API client 0.9.0
Message-ID: <DD35ED0B-30E3-435F-AB81-CA43B2D4B05D@rabbitmq.com>

Ruby client for RabbitMQ HTTP API has a new release: 0.9.0 [1].

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/11/22/rabbitmq-http-api-client-0-dot-9-dot-0-is-released/

1. http://rubygems.org/gems/rabbitmq_http_api_client

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Sun Nov 24 11:10:54 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Sun, 24 Nov 2013 15:10:54 +0400
Subject: [rabbitmq-discuss] channel_max
In-Reply-To: <57235940-E60E-4D90-B238-E5458E7E3DC2@rabbitmq.com>
References: <1385090022896-31572.post@n5.nabble.com>
	<21AF4D92-9E7D-4AA8-96CC-788060ECBDAB@rabbitmq.com>
	<8C0F82EDC6934FCEB15046AA1C2ABB8D@gmail.com>
	<57235940-E60E-4D90-B238-E5458E7E3DC2@rabbitmq.com>
Message-ID: <DF241A26-C717-4EAF-949A-6639E5D6797B@gopivotal.com>

On 22 Nov 2013, at 17:06, Michael Klishin <mklishin at gopivotal.com> wrote:

> More research suggests that many clients (including the most popular Java and Ruby ones) will need updating
> to pick a lower configuration value than the server. So this is not something that can be fixed quickly.

Actually, I think I?ve misread some code and is wrong about this.

It may not be necessary to modify reasonable clients.
--
MK

Software Engineer, Pivotal/RabbitMQ



From yby538 at 163.com  Mon Nov 25 03:14:09 2013
From: yby538 at 163.com (yby538 at 163.com)
Date: Mon, 25 Nov 2013 11:14:09 +0800
Subject: [rabbitmq-discuss] a question about checking a queue contains a
	specific message or not
Message-ID: <2013112511140887923612@163.com>

hi ,all

suppose that i have a queue named "fruit" and i send some different messages to it like this

basicPublish ("orange");
basicPublish ("banana");

now the queue contains two messages, "orange" and "banana".

now,i want to know is there an interface in rabbitmq like this for me to check whether my queue, fruit,  contains a specific message or not 

queue_fruit.contains("banana");  //return true

queue_fruit.contains("orange");  //return true

queue_fruit.contains("apple");  //return false

if there not,how to get it?

thanks a lot for you all




?????????????????????
?????????????????
?????????????????????
?????????????????
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/f0a43dee/attachment.htm>

From hitendra.mahida at slscorp.com  Mon Nov 25 04:22:15 2013
From: hitendra.mahida at slscorp.com (Hitendrasinh Mahida)
Date: Mon, 25 Nov 2013 09:52:15 +0530
Subject: [rabbitmq-discuss] HTTP subscriber for Windows
In-Reply-To: <CAE3HoVQwBsn-OvHYew8=XiB-KS1REsB2eA8o5vv=0k2AwXfr_A@mail.gmail.com>
References: <52907627.30009@slscorp.com>
	<CAE3HoVQwBsn-OvHYew8=XiB-KS1REsB2eA8o5vv=0k2AwXfr_A@mail.gmail.com>
Message-ID: <5292D077.4020800@slscorp.com>

Hi Michael,

Thanks for your time. Yes, I have checked RabbitMQ HTTP API and it will 
be useful to me.
But my concern is about Subscriber over HTTP. I would like to do 
something, where Subscriber gets a Call back for its GET request with 
HTTP to server.

I hope that I am clear enough to understand.

Thanks,
Mahida

On 11/24/2013 3:36 AM, Michael Klishin wrote:
>
> 2013/11/23 Hitendrasinh Mahida <hitendra.mahida at slscorp.com 
> <mailto:hitendra.mahida at slscorp.com>>
>
>     Searching online I found that I can User RabbitHUB / XMPP /
>     PUBSUBHUBBUB.
>
>     I have no idea which one to chose and How to implement it.
>
>     Please, Help me / Guide me related to this.
>
>
> XMPP has nothing to do with RabbitMQ or HTTP.
>
> RabbitHub should have some docs but simply fetching messages is 
> possible over
> RabbitMQ HTTP API that ships with the management plugin:
>
> http://www.rabbitmq.com/management.html#http-api
> -- 
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/5358ac68/attachment.htm>

From lijo at citrusinformatics.com  Mon Nov 25 06:24:05 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Mon, 25 Nov 2013 11:54:05 +0530
Subject: [rabbitmq-discuss] HTTP subscriber for Windows
In-Reply-To: <5292D077.4020800@slscorp.com>
References: <52907627.30009@slscorp.com><CAE3HoVQwBsn-OvHYew8=XiB-KS1REsB2eA8o5vv=0k2AwXfr_A@mail.gmail.com>
	<5292D077.4020800@slscorp.com>
Message-ID: <F8D73D72A0884C1F8A29C2DFF91BDA93@Lijo>

Mahida,  
             You should give RabbitHub a try. 

https://github.com/tonyg/rabbithub


Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.

From: Hitendrasinh Mahida 
Sent: Monday, November 25, 2013 9:52 AM
To: Michael Klishin ; Discussions about RabbitMQ 
Subject: Re: [rabbitmq-discuss] HTTP subscriber for Windows

Hi Michael,

Thanks for your time. Yes, I have checked RabbitMQ HTTP API and it will be useful to me.
But my concern is about Subscriber over HTTP. I would like to do something, where Subscriber gets a Call back for its GET request with HTTP to server.

I hope that I am clear enough to understand.

Thanks,
Mahida
 

On 11/24/2013 3:36 AM, Michael Klishin wrote:


  2013/11/23 Hitendrasinh Mahida <hitendra.mahida at slscorp.com>

    Searching online I found that I can User RabbitHUB / XMPP / PUBSUBHUBBUB.

    I have no idea which one to chose and How to implement it.

    Please, Help me / Guide me related to this.

  XMPP has nothing to do with RabbitMQ or HTTP.


  RabbitHub should have some docs but simply fetching messages is possible over
  RabbitMQ HTTP API that ships with the management plugin:

  http://www.rabbitmq.com/management.html#http-api

  -- 
  MK

  http://github.com/michaelklishin
  http://twitter.com/michaelklishin





--------------------------------------------------------------------------------
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/f2ca99f6/attachment.htm>

From brett.r.cameron at gmail.com  Mon Nov 25 07:20:18 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Mon, 25 Nov 2013 20:20:18 +1300
Subject: [rabbitmq-discuss] HTTP subscriber for Windows
In-Reply-To: <F8D73D72A0884C1F8A29C2DFF91BDA93@Lijo>
References: <52907627.30009@slscorp.com>
	<CAE3HoVQwBsn-OvHYew8=XiB-KS1REsB2eA8o5vv=0k2AwXfr_A@mail.gmail.com>
	<5292D077.4020800@slscorp.com>
	<F8D73D72A0884C1F8A29C2DFF91BDA93@Lijo>
Message-ID: <CALPqkioh=3Hk2OfXFdyTe7VxecZQAtVa_nPgUSfhpRSRWLaVVg@mail.gmail.com>

Mahida,

https://github.com/brc859844/rabbithub includes pointers to RabbitHub
binary distributions for RabbitMQ 3.2.1 and 3.1.5. Note that these have
been built with Erlang 16B.

Brett





On Mon, Nov 25, 2013 at 7:24 PM, Lijo Sebastian
<lijo at citrusinformatics.com>wrote:

>   Mahida,
>              You should give RabbitHub a try.
>
> https://github.com/tonyg/rabbithub
>
>
> Regards,
> Lijo Sebastian
> Senior Software Engineer
> Citrus Informatics (India) Pvt Ltd.
>
>  *From:* Hitendrasinh Mahida <hitendra.mahida at slscorp.com>
> *Sent:* Monday, November 25, 2013 9:52 AM
> *To:* Michael Klishin <michael.s.klishin at gmail.com> ; Discussions about
> RabbitMQ <rabbitmq-discuss at lists.rabbitmq.com>
> *Subject:* Re: [rabbitmq-discuss] HTTP subscriber for Windows
>
> Hi Michael,
>
> Thanks for your time. Yes, I have checked RabbitMQ HTTP API and it will be
> useful to me.
> But my concern is about Subscriber over HTTP. I would like to do
> something, where Subscriber gets a Call back for its GET request with HTTP
> to server.
>
> I hope that I am clear enough to understand.
>
> Thanks,
> Mahida
>
> On 11/24/2013 3:36 AM, Michael Klishin wrote:
>
>
> 2013/11/23 Hitendrasinh Mahida <hitendra.mahida at slscorp.com>
>
>> Searching online I found that I can User RabbitHUB / XMPP / PUBSUBHUBBUB.
>>
>> I have no idea which one to chose and How to implement it.
>>
>> Please, Help me / Guide me related to this.
>>
>
> XMPP has nothing to do with RabbitMQ or HTTP.
>
> RabbitHub should have some docs but simply fetching messages is possible
> over
> RabbitMQ HTTP API that ships with the management plugin:
>
> http://www.rabbitmq.com/management.html#http-api
> --
> MK
>
> http://github.com/michaelklishin
> http://twitter.com/michaelklishin
>
>
>  ------------------------------
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/91b2b78c/attachment.htm>

From michael.s.klishin at gmail.com  Mon Nov 25 07:27:06 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 25 Nov 2013 11:27:06 +0400
Subject: [rabbitmq-discuss] HTTP subscriber for Windows
In-Reply-To: <5292D077.4020800@slscorp.com>
References: <52907627.30009@slscorp.com>
	<CAE3HoVQwBsn-OvHYew8=XiB-KS1REsB2eA8o5vv=0k2AwXfr_A@mail.gmail.com>
	<5292D077.4020800@slscorp.com>
Message-ID: <CAE3HoVSGX+T5R1cg7Bs23V6LOQTUGJixK9qZqSAMngL-hygKGQ@mail.gmail.com>

2013/11/25 Hitendrasinh Mahida <hitendra.mahida at slscorp.com>

> I would like to do something, where Subscriber gets a Call back for its
> GET request with HTTP to server.


HTTP API only supports for fetching messages on demand (think basic.get in
AMQP 0-9-1) via GET
requests.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/c05bb4ab/attachment.htm>

From Shashank.Lothe at techmahindra.com  Mon Nov 25 04:47:30 2013
From: Shashank.Lothe at techmahindra.com (Lothe Shashank)
Date: Mon, 25 Nov 2013 04:47:30 +0000
Subject: [rabbitmq-discuss] Queries regarding rabbitmq-C APIs
Message-ID: <DD7729D61B083D48A2CDCB66A27AD4C98CBB11@BSDMSATMBX001.mahindrasatyam.ad>

Hi Alan,

I am using Linux (Ubuntu Flavour) platform for my testing. Could you kindly try it to reproduce?

Thanks and regards,
Shashank

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/89b90d76/attachment.htm>

From emile at rabbitmq.com  Mon Nov 25 09:26:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 25 Nov 2013 09:26:25 +0000
Subject: [rabbitmq-discuss] a question about checking a queue contains a
 specific message or not
In-Reply-To: <2013112511140887923612@163.com>
References: <2013112511140887923612@163.com>
Message-ID: <529317C1.4050600@rabbitmq.com>


Hi,

On 25/11/13 03:14, yby538 at 163.com wrote:

> now,i want to know is there an interface in rabbitmq like this for me to
> check whether my queue, fruit,  contains a specific message or not

The name of this feature is "queue browsing". RabbitMQ does not support
this directly. The workaround of consuming all messages in a queue and
requeuing non-matching messages is a messaging anti-pattern and discouraged.

In your analogy the solution is to route messages about different fruits
to different queues and check their queue lengths.




-Emile




From 13126682369 at 163.com  Sat Nov 23 07:39:56 2013
From: 13126682369 at 163.com (=?GBK?B?wO4gzrA=?=)
Date: Sat, 23 Nov 2013 15:39:56 +0800 (CST)
Subject: [rabbitmq-discuss] rabbitmq questions
Message-ID: <33622acc.40e8.14283e69768.Coremail.13126682369@163.com>

hello 


If I need to get all of the routes from the queue?How to get to the?I searched all official documents, did not find this approach?
I use the. Net language development?


Thank you?
        
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131123/7271dee1/attachment.htm>

From videlalvaro at gmail.com  Mon Nov 25 09:33:31 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 25 Nov 2013 10:33:31 +0100
Subject: [rabbitmq-discuss] rabbitmq questions
In-Reply-To: <33622acc.40e8.14283e69768.Coremail.13126682369@163.com>
References: <33622acc.40e8.14283e69768.Coremail.13126682369@163.com>
Message-ID: <CAMcAHLXZ5u=gN53cD3_9VBtzRBAv2E9qSMoix2vi5Fy8RZnUOg@mail.gmail.com>

Hi,

If you mean to get all the bindings of a queue, then you can do it
either via the management API or the command "rabbitmqctl
list_bindings"

Cheers,

Alvaro

On Sat, Nov 23, 2013 at 8:39 AM, ? ? <13126682369 at 163.com> wrote:
> hello
>
> If I need to get all of the routes from the queue?How to get to the?I
> searched all official documents, did not find this approach?
> I use the. Net language development?
>
> Thank you?
>
>
>
> ??????????????
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From michael.s.klishin at gmail.com  Mon Nov 25 09:35:05 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 25 Nov 2013 13:35:05 +0400
Subject: [rabbitmq-discuss] rabbitmq questions
In-Reply-To: <33622acc.40e8.14283e69768.Coremail.13126682369@163.com>
References: <33622acc.40e8.14283e69768.Coremail.13126682369@163.com>
Message-ID: <CAE3HoVR66HHJbcTh2NMBpKcFfZekN0bm24jkZOZOSAAbpJ53Tg@mail.gmail.com>

2013/11/23 ? ? <13126682369 at 163.com>

> If I need to get all of the routes from the queue?How to get to the?I
> searched all official documents, did not find this approach?


HTTP API can list bindings in a vhost.

http://www.rabbitmq.com/management.html#http-api
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/c8e9db0b/attachment.htm>

From doubaokun at gmail.com  Mon Nov 25 09:36:05 2013
From: doubaokun at gmail.com (Bruce Dou)
Date: Mon, 25 Nov 2013 17:36:05 +0800
Subject: [rabbitmq-discuss] ANN Tracing for MongoDB is released
Message-ID: <CAPWhD4di2yfWywRfQ=V8X4TM4gd8px2o9tF_Nd6s+RvFofNDvQ@mail.gmail.com>

Plugin for saving tracing data into MongoDB:
https://github.com/doubaokun/rabbitmq-tracing-mongo
This plugin also require the emongo-wrapper plugin:
https://github.com/doubaokun/emongo-wrapper

Regards,
Bruce

-- 
A decathlon Developer & programmer
http://blog.eood.cn/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/e1ff0b61/attachment.htm>

From 314992959 at qq.com  Mon Nov 25 09:21:19 2013
From: 314992959 at qq.com (3k4b251)
Date: Mon, 25 Nov 2013 01:21:19 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c     can't   send  message to queue
Message-ID: <1385371279244-31614.post@n5.nabble.com>

once  I  made  a  mistake,    I   send  message  to   a   exchange  that   I 
was  not  create   before.  But It seems   all  right.  So  I  then  send
message   to  queues,  But  I  find  that   I can't  send any  messages  to
queues.   what's  the problem ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-can-t-send-message-to-queue-tp31614.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From videlalvaro at gmail.com  Mon Nov 25 09:42:44 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Mon, 25 Nov 2013 10:42:44 +0100
Subject: [rabbitmq-discuss] rabbitmq-c can't send message to queue
In-Reply-To: <1385371279244-31614.post@n5.nabble.com>
References: <1385371279244-31614.post@n5.nabble.com>
Message-ID: <CAMcAHLUeYYKxGoRXookEuEusxjOWWErCgRuGCsNGTfENVWTnuQ@mail.gmail.com>

Hi,

I'm not sure I understand your question right, but you can't send
messages directly to queues. You first need to bind the queue to the
exchange and then publish your messages to that particular exchange.

-Alvaro

On Mon, Nov 25, 2013 at 10:21 AM, 3k4b251 <314992959 at qq.com> wrote:
> once  I  made  a  mistake,    I   send  message  to   a   exchange  that   I
> was  not  create   before.  But It seems   all  right.  So  I  then  send
> message   to  queues,  But  I  find  that   I can't  send any  messages  to
> queues.   what's  the problem ?
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-can-t-send-message-to-queue-tp31614.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From michael.s.klishin at gmail.com  Mon Nov 25 09:46:00 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 25 Nov 2013 13:46:00 +0400
Subject: [rabbitmq-discuss] rabbitmq-c can't send message to queue
In-Reply-To: <1385371279244-31614.post@n5.nabble.com>
References: <1385371279244-31614.post@n5.nabble.com>
Message-ID: <CAE3HoVTO3VMpk6=NqCjzqdVvDRmF2fhAWi6TVE+_spmyZTfsGw@mail.gmail.com>

2013/11/25 3k4b251 <314992959 at qq.com>

> So  I  then  send
> message   to  queues,  But  I  find  that   I can't  send any  messages  to
> queues.   what's  the problem ?
>

Messages are not sent to queues, only exchanges. Can you explain what your
routing
looks like and what exactly you expect to happen?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/faa7e288/attachment.htm>

From emile at rabbitmq.com  Mon Nov 25 09:55:31 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 25 Nov 2013 09:55:31 +0000
Subject: [rabbitmq-discuss] rabbitmq-c can't send message to queue
In-Reply-To: <1385371279244-31614.post@n5.nabble.com>
References: <1385371279244-31614.post@n5.nabble.com>
Message-ID: <52931E93.7080108@rabbitmq.com>



Hi,

On 25/11/13 09:21, 3k4b251 wrote:
> once  I  made  a  mistake,    I   send  message  to   a   exchange  that   I 
> was  not  create   before.  

Publishing to a  non-existent exchange is a channel  error.  The channel
will disappear when  you do this.

See the  requirement around "not-found"  here:
http://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.publish

> But It seems   all  right.

Publishing  is an asynchronous operation, so  errors will  not  be
reported immediately.

The  solution is to make sure that exchanges  exist before publishing.
For this reason  it is common for exchanges to be treated as static
features of  the messaging  configuration.



-Emile












From thilo at ginkel.com  Mon Nov 25 10:37:53 2013
From: thilo at ginkel.com (Thilo-Alexander Ginkel)
Date: Mon, 25 Nov 2013 11:37:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ second-time message delivery after
	service restart
Message-ID: <CANvSZQ-QOzFGGTpZjs-8BCBKNCSTJ+Yp9uS6z+AAZeTGfepL8A@mail.gmail.com>

Hello everyone,

over the weekend we encountered a strange RabbitMQ issue, for which we are
still trying to figure out what happened and why it happened. Our setup
uses a single RabbitMQ instance (version 2.8.1), which serves a bunch of
queues, most of which are persistent.

The RabbitMQ instance was running since May 2013 during which it processed
> 250.000 messages without any issues. Over the weekend we had to restart
our servers. After the server hosting the RabbitMQ instance came back up,
RabbitMQ all of a sudden started re-delivering all messages that were
processed in one of our persistent queues since May.

AFAIK, all messages had been properly ACKed before, so effectively RabbitMQ
delivered these messages twice. They seem to be sitting
in /var/lib/rabbitmq/mnesia/rabbit@<server>/msg_store_persistent, though,
which is around 0.5 GB in size on the affected server.

Any idea what may have happened?

Thanks,
Thilo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/bef5d82c/attachment.htm>

From michael.s.klishin at gmail.com  Mon Nov 25 11:05:16 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 25 Nov 2013 15:05:16 +0400
Subject: [rabbitmq-discuss] RabbitMQ second-time message delivery after
 service restart
In-Reply-To: <CANvSZQ-QOzFGGTpZjs-8BCBKNCSTJ+Yp9uS6z+AAZeTGfepL8A@mail.gmail.com>
References: <CANvSZQ-QOzFGGTpZjs-8BCBKNCSTJ+Yp9uS6z+AAZeTGfepL8A@mail.gmail.com>
Message-ID: <CAE3HoVQ4x2o9rT-kBq3hQ0wsjaihH2B57qxu-MgxO23tSPWG2Q@mail.gmail.com>

2013/11/25 Thilo-Alexander Ginkel <thilo at ginkel.com>

> AFAIK, all messages had been properly ACKed before


Does management UI or rabbitmqctl confirm this?


-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/dd33a3d3/attachment.htm>

From thilo at ginkel.com  Mon Nov 25 11:46:58 2013
From: thilo at ginkel.com (Thilo-Alexander Ginkel)
Date: Mon, 25 Nov 2013 12:46:58 +0100
Subject: [rabbitmq-discuss] RabbitMQ second-time message delivery after
 service restart
In-Reply-To: <CAE3HoVQ4x2o9rT-kBq3hQ0wsjaihH2B57qxu-MgxO23tSPWG2Q@mail.gmail.com>
References: <CANvSZQ-QOzFGGTpZjs-8BCBKNCSTJ+Yp9uS6z+AAZeTGfepL8A@mail.gmail.com>
	<CAE3HoVQ4x2o9rT-kBq3hQ0wsjaihH2B57qxu-MgxO23tSPWG2Q@mail.gmail.com>
Message-ID: <CANvSZQ_=vPgtk=fB_kVMTfL0Nw664XFmoRHc7+kojnsAvQSiTg@mail.gmail.com>

On Mon, Nov 25, 2013 at 12:05 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2013/11/25 Thilo-Alexander Ginkel <thilo at ginkel.com>
>
>> AFAIK, all messages had been properly ACKed before
>
>
> Does management UI or rabbitmqctl confirm this?
>

I don't know the exact situation during the weekend, but when restoring a
(one-week-old) backup [1] into a different VM (and tweaking the hostnames
so that RabbitMQ starts up), I see zero unACKed messages (and that the
queue actually contained > 500.000 re-surrected messages, not 250.000 as I
originally stated):

# rabbitmqctl list_queues name messages_ready messages_unacknowledged
Listing queues ...
[...]
psm_subscriber_api_production   520111  0
[...]

BTW, the same issue also happens with RabbitMQ 3.2.1 when using the backed
up data (just to rule out we are hitting a bug that has been fixed a long
time ago).

Thanks,
Thilo

[1] restoring a newer version is underway
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/829487cc/attachment.htm>

From michael.s.klishin at gmail.com  Mon Nov 25 11:49:57 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Mon, 25 Nov 2013 15:49:57 +0400
Subject: [rabbitmq-discuss] RabbitMQ second-time message delivery after
 service restart
In-Reply-To: <CAE3HoVQ4x2o9rT-kBq3hQ0wsjaihH2B57qxu-MgxO23tSPWG2Q@mail.gmail.com>
References: <CANvSZQ-QOzFGGTpZjs-8BCBKNCSTJ+Yp9uS6z+AAZeTGfepL8A@mail.gmail.com>
	<CAE3HoVQ4x2o9rT-kBq3hQ0wsjaihH2B57qxu-MgxO23tSPWG2Q@mail.gmail.com>
Message-ID: <CAE3HoVR+Vz8Y0nSeODcs4gPTuiTaHSAZBZG9Y9kU9oL5LeV-uQ@mail.gmail.com>

2013/11/25 Michael Klishin <michael.s.klishin at gmail.com>

> Does management UI or rabbitmqctl confirm this?


There was a bug (24558) that was fixed right before 2.8.0 that addresses
something closely
related to what you're seeing in cases when RabbitMQ was not shut down
cleanly.

How did you shut down RabbitMQ?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/991d3314/attachment.htm>

From thilo at ginkel.com  Mon Nov 25 12:09:39 2013
From: thilo at ginkel.com (Thilo-Alexander Ginkel)
Date: Mon, 25 Nov 2013 13:09:39 +0100
Subject: [rabbitmq-discuss] RabbitMQ second-time message delivery after
 service restart
In-Reply-To: <CAE3HoVR+Vz8Y0nSeODcs4gPTuiTaHSAZBZG9Y9kU9oL5LeV-uQ@mail.gmail.com>
References: <CANvSZQ-QOzFGGTpZjs-8BCBKNCSTJ+Yp9uS6z+AAZeTGfepL8A@mail.gmail.com>
	<CAE3HoVQ4x2o9rT-kBq3hQ0wsjaihH2B57qxu-MgxO23tSPWG2Q@mail.gmail.com>
	<CAE3HoVR+Vz8Y0nSeODcs4gPTuiTaHSAZBZG9Y9kU9oL5LeV-uQ@mail.gmail.com>
Message-ID: <CANvSZQ-Ladt7Xicvht0TM8tr5i+cjH2dsuG7DzNJoMxNatG0gQ@mail.gmail.com>

On Mon, Nov 25, 2013 at 12:49 PM, Michael Klishin <
michael.s.klishin at gmail.com> wrote:

> 2013/11/25 Michael Klishin <michael.s.klishin at gmail.com>
>
>> Does management UI or rabbitmqctl confirm this?
>
>
> There was a bug (24558) that was fixed right before 2.8.0 that addresses
> something closely
> related to what you're seeing in cases when RabbitMQ was not shut down
> cleanly.
>
> How did you shut down RabbitMQ?
>

AFAICS the shutdown was clean (i.e., triggered by the rabbitmq init script):

-- 8< --
=INFO REPORT==== 23-Nov-2013::18:27:34 ===
Stopping Rabbit

=INFO REPORT==== 23-Nov-2013::18:27:34 ===
stopped TCP Listener on [::]:5672

=INFO REPORT==== 23-Nov-2013::18:27:38 ===
    application: rabbit
    exited: stopped
    type: permanent

=INFO REPORT==== 23-Nov-2013::18:27:38 ===
    application: mnesia
    exited: stopped
    type: permanent

=INFO REPORT==== 23-Nov-2013::18:27:38 ===
    application: os_mon
    exited: stopped
    type: permanent

=INFO REPORT==== 23-Nov-2013::18:27:38 ===
Halting Erlang VM
-- 8< --

Before that the last regular restart was on May 26th, 2013 and the last
irregular one (probably caused by a STONITH) on May 5th (where I do not see
any shutdown messages in the log prior to the startup messages). I am not
aware of any replay problems during those restarts, though.

Thanks,
Thilo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/a2bc3db8/attachment.htm>

From sekhar434145 at gmail.com  Mon Nov 25 12:25:10 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Mon, 25 Nov 2013 17:55:10 +0530
Subject: [rabbitmq-discuss] Is it possible to set concurrent consumers at
	runtime?
Message-ID: <CAH75Yb7PBH8vfPETsW8jyh5EgCeAdTuOt6+89gpfzu2SVJbeNA@mail.gmail.com>

Hi Team,

    I have the requirement where I have set the concurrent consumers size
at run-time without restarting the RabbitMQ server based on the load. Is
that possible? Am using Spring-AMQP API for setting concurrent consumers.
Could you please help me on this.

SimpleMessageListenerContainer container = new
SimpleMessageListenerContainer();
container.setConcurrentConsumers(2);


Thanks in advance!!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/550e75b3/attachment.htm>

From emile at rabbitmq.com  Mon Nov 25 13:17:10 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 25 Nov 2013 13:17:10 +0000
Subject: [rabbitmq-discuss] Posting MQTT to RabbitMQ QOS=1
In-Reply-To: <528F828C.5020206@rabbitmq.com>
References: <8d289f0142c2ca19ceb10823391e161e@mail.gmail.com>
	<528F828C.5020206@rabbitmq.com>
Message-ID: <52934DD6.7040503@rabbitmq.com>

On 22/11/13 16:13, Emile Joubert wrote:

> On 22/11/13 02:19, Adrian Yip wrote:

>> When I publish with QOS=1 however, the client appears successful in
>> publishing, but the receiver always stops at 20 messages.  I can kick
>> off another client without stopping the receiver and it will also do the
>> same thing, the receiver will show 20 messages and nothing more.
> 
> The default mosquitto max_inflight_messages is 20. Set this to a higher
> number or unlimited, and do the same for the broker prefetch configuration.

It looks like the problem might be in the MQTT python client library.
The broker immediately acknowledges the publish messages, so I don't see
why the client library stops sending messages after the first 20. My
earlier suggestion works, but it should not be necessary.



-Emile







From grussell at gopivotal.com  Mon Nov 25 13:40:13 2013
From: grussell at gopivotal.com (Gary Russell)
Date: Mon, 25 Nov 2013 08:40:13 -0500
Subject: [rabbitmq-discuss] Is it possible to set concurrent consumers
	at runtime?
In-Reply-To: <CAH75Yb7PBH8vfPETsW8jyh5EgCeAdTuOt6+89gpfzu2SVJbeNA@mail.gmail.com>
References: <CAH75Yb7PBH8vfPETsW8jyh5EgCeAdTuOt6+89gpfzu2SVJbeNA@mail.gmail.com>
Message-ID: <CADtU9_uDbeDxjx9_ZZvE=KegxfCr9YTa-XjwdutZoCezbBC3jQ@mail.gmail.com>

You cannot currently change the listener container's concurrent consumers
at runtime. We have an open JIRA issue [1] for that; vote it up!

You can, however, stop the container, change the setting and restart the
container (stop(), setConcurrentConsumers(int), start()).

You do not have to restart the RabbitMQ server.

[1]: https://jira.springsource.org/browse/AMQP-306


On Mon, Nov 25, 2013 at 7:25 AM, Rajasekhar P <sekhar434145 at gmail.com>wrote:

> Hi Team,
>
>     I have the requirement where I have set the concurrent consumers size
> at run-time without restarting the RabbitMQ server based on the load. Is
> that possible? Am using Spring-AMQP API for setting concurrent consumers.
> Could you please help me on this.
>
> SimpleMessageListenerContainer container = new
> SimpleMessageListenerContainer();
> container.setConcurrentConsumers(2);
>
>
> Thanks in advance!!!
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/7053cc2c/attachment.htm>

From sekhar434145 at gmail.com  Mon Nov 25 13:55:48 2013
From: sekhar434145 at gmail.com (Rajasekhar P)
Date: Mon, 25 Nov 2013 19:25:48 +0530
Subject: [rabbitmq-discuss] Is it possible to set concurrent consumers
	at runtime?
In-Reply-To: <CADtU9_uDbeDxjx9_ZZvE=KegxfCr9YTa-XjwdutZoCezbBC3jQ@mail.gmail.com>
References: <CAH75Yb7PBH8vfPETsW8jyh5EgCeAdTuOt6+89gpfzu2SVJbeNA@mail.gmail.com>
	<CADtU9_uDbeDxjx9_ZZvE=KegxfCr9YTa-XjwdutZoCezbBC3jQ@mail.gmail.com>
Message-ID: <CAH75Yb6azoo8ojQaHPOhWUjnnZffjvJ6aofxCrjTwWj4G0ntDA@mail.gmail.com>

Thank you Russell for the clarification and Voted in JIRA tracker as well.


On Mon, Nov 25, 2013 at 7:10 PM, Gary Russell <grussell at gopivotal.com>wrote:

> You cannot currently change the listener container's concurrent consumers
> at runtime. We have an open JIRA issue [1] for that; vote it up!
>
> You can, however, stop the container, change the setting and restart the
> container (stop(), setConcurrentConsumers(int), start()).
>
> You do not have to restart the RabbitMQ server.
>
> [1]: https://jira.springsource.org/browse/AMQP-306
>
>
> On Mon, Nov 25, 2013 at 7:25 AM, Rajasekhar P <sekhar434145 at gmail.com>wrote:
>
>> Hi Team,
>>
>>     I have the requirement where I have set the concurrent consumers size
>> at run-time without restarting the RabbitMQ server based on the load. Is
>> that possible? Am using Spring-AMQP API for setting concurrent consumers.
>> Could you please help me on this.
>>
>> SimpleMessageListenerContainer container = new
>> SimpleMessageListenerContainer();
>> container.setConcurrentConsumers(2);
>>
>>
>> Thanks in advance!!!
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/c5d04570/attachment.htm>

From emile at rabbitmq.com  Mon Nov 25 14:58:57 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 25 Nov 2013 14:58:57 +0000
Subject: [rabbitmq-discuss] Deprecating WCF library
In-Reply-To: <507E9712.1020405@rabbitmq.com>
References: <507E9712.1020405@rabbitmq.com>
Message-ID: <529365B1.8020104@rabbitmq.com>



No objections were raised in response to this message below, so the
retirement process for the Java and .net message patterns libraries will
move forward.

In addition to the messagepatterns libraries, we are also considering
deprecating the RabbitMQ WCF binding. Evidence similarly suggests that
it is not being used much. Using the regular RabbitMQ .net client
library would be the suggested alternative. The .net library does not
suffer from the same limitations and is maintained more regularly.

To help us assess the impact, please let us know if you have any
objections to the WCF binding being deprecated.



-Emile



On 17/10/12 12:31, Emile Joubert wrote:

> We are considering deprecating the RabbitMQ Java and .NET
> messagepatterns libraries, as part of a cleanup exercise:
> 
> http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/
> http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/
> 
> These libraries were meant to provide some higher-level abstractions on
> top of the regular Java and .NET libraries, but evidence suggests that
> they are not being used much. And they haven't had any updates for years.
> 
> Please let us know if you have any objections to both of these being
> deprecated.

From marcos.torres at gmail.com  Mon Nov 25 15:31:23 2013
From: marcos.torres at gmail.com (Marcos Torres)
Date: Mon, 25 Nov 2013 13:31:23 -0200
Subject: [rabbitmq-discuss] Deprecating WCF library
In-Reply-To: <529365B1.8020104@rabbitmq.com>
References: <507E9712.1020405@rabbitmq.com>
	<529365B1.8020104@rabbitmq.com>
Message-ID: <CAP4Ah2D=s=vm+2NdJUWpHQhJ=Bzd-T7kEhbtgt4PrpbmjmGPTg@mail.gmail.com>

Sorry, I haven't read this before.

I deprecating you mean remove them or simply provide no further
improvements? I'm on my very first RabbitMQ project using .NET libraries
and while I'm not using any of the message patterns, It was really helpful.
This is not the same for WCF which I consider a dead end.

Thanks!



On Mon, Nov 25, 2013 at 11:58 AM, Emile Joubert <emile at rabbitmq.com> wrote:

>
>
> No objections were raised in response to this message below, so the
> retirement process for the Java and .net message patterns libraries will
> move forward.
>
> In addition to the messagepatterns libraries, we are also considering
> deprecating the RabbitMQ WCF binding. Evidence similarly suggests that
> it is not being used much. Using the regular RabbitMQ .net client
> library would be the suggested alternative. The .net library does not
> suffer from the same limitations and is maintained more regularly.
>
> To help us assess the impact, please let us know if you have any
> objections to the WCF binding being deprecated.
>
>
>
> -Emile
>
>
>
> On 17/10/12 12:31, Emile Joubert wrote:
>
> > We are considering deprecating the RabbitMQ Java and .NET
> > messagepatterns libraries, as part of a cleanup exercise:
> >
> > http://hg.rabbitmq.com/rabbitmq-java-messagepatterns/
> > http://hg.rabbitmq.com/rabbitmq-dotnet-messagepatterns/
> >
> > These libraries were meant to provide some higher-level abstractions on
> > top of the regular Java and .NET libraries, but evidence suggests that
> > they are not being used much. And they haven't had any updates for years.
> >
> > Please let us know if you have any objections to both of these being
> > deprecated.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/d01515be/attachment.htm>

From yjfhfei at gmail.com  Mon Nov 25 13:12:50 2013
From: yjfhfei at gmail.com (Wang Jingfei)
Date: Mon, 25 Nov 2013 05:12:50 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq question
Message-ID: <29f33e28-b05f-4d14-86ca-4f68d2f3d61b@googlegroups.com>

bug:java client cannot get message
resolve:rabbitmq restart

rabbitmq 3.1.3,, Erlang R14B04

why reason?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/b418461c/attachment.htm>

From emile at rabbitmq.com  Mon Nov 25 16:37:47 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Mon, 25 Nov 2013 16:37:47 +0000
Subject: [rabbitmq-discuss] rabbitmq question
In-Reply-To: <29f33e28-b05f-4d14-86ca-4f68d2f3d61b@googlegroups.com>
References: <29f33e28-b05f-4d14-86ca-4f68d2f3d61b@googlegroups.com>
Message-ID: <52937CDB.3060904@rabbitmq.com>

On 25/11/13 13:12, Wang Jingfei wrote:
> bug:java client cannot get message
> resolve:rabbitmq restart
> 
> rabbitmq 3.1.3,, Erlang R14B04
> 
> why reason?


It is extremely challenging to diagnose issues on the basis of so little
information. Please explain what you did, what you expected and what
happened. And what was logged in the broker logfile.



-Emile




From shridharan.m at gmail.com  Mon Nov 25 16:53:04 2013
From: shridharan.m at gmail.com (shridharan muthu)
Date: Mon, 25 Nov 2013 08:53:04 -0800
Subject: [rabbitmq-discuss] High cpu usage on CentOS boxes
In-Reply-To: <CAPK6OevH6WFnnWXf6Dc9H_81vtBnKn+6na-_qbNi1-0mHAE2Wg@mail.gmail.com>
References: <CAPK6OevH6WFnnWXf6Dc9H_81vtBnKn+6na-_qbNi1-0mHAE2Wg@mail.gmail.com>
Message-ID: <CAPK6Oeub2UC=WXZ4qtJ3DpZEOcauOyag=Ld=bu_ZpG7TYebsBQ@mail.gmail.com>

Hello There,

   Reg my previous message, is there anyway to dig into the high cpu usage
issue? With similar configs in Ubuntu & Cent OS, Cent OS takes lot more cpu
for beam.smp process. I switched log level to "info" but noticed nothing
unusual.

Any help would be appreciated.

Thanks,
Shri


On Fri, Nov 22, 2013 at 3:56 PM, shridharan muthu <shridharan.m at gmail.com>wrote:

> Hi There,
>
>     I am experiencing high cpu usage (above 400%) on Cent OS rabbit mq
> cluster (with 2 nodes). We have a similar setup in Ubuntu and cpu usage
> seems fine. Pls fine the report, status and top below.
>
> OS: *CentOS release 6.4*
>
> Report:
> *{pid,2148},*
> * {running_applications,*
> *     [{rabbitmq_management,"RabbitMQ Management Console","3.0.2"},*
> *      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.2"},*
> *      {rabbit,"RabbitMQ","3.0.2"},*
> *      {os_mon,"CPO  CXC 138 46","2.2.7"},*
> *      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.2"},*
> *      {webmachine,"webmachine","1.9.1-rmq3.0.2-git52e62bc"},*
> *      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.2-gitd541e9a"},*
> *      {xmerl,"XML parser","1.2.10"},*
> *      {inets,"INETS  CXC 138 49","5.7.1"},*
> *      {mnesia,"MNESIA  CXC 138 12","4.5"},*
> *      {amqp_client,"RabbitMQ AMQP Client","3.0.2"},*
> *      {sasl,"SASL  CXC 138 11","2.1.10"},*
> *      {stdlib,"ERTS  CXC 138 10","1.17.5"},*
> *      {kernel,"ERTS  CXC 138 10","2.14.5"}]},*
> * {os,{unix,linux}},*
> * {erlang_version,*
> *     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:12:12] [rq:12]
> [async-threads:30] [kernel-poll:true]\n"},*
> * {memory,*
> *     [{total,285898072},*
> *      {connection_procs,16592856},*
> *      {queue_procs,1064888},*
> *      {plugins,269872},*
> *      {other_proc,13173224},*
> *      {mnesia,100632},*
> *      {mgmt_db,2167672},*
> *      {msg_index,35352},*
> *      {other_ets,72058416},*
> *      {binary,7326576},*
> *      {code,17434264},*
> *      {atom,3356065},*
> *      {other_system,152318255}]},*
> * {vm_memory_high_watermark,0.4},*
> * {vm_memory_limit,4991811584},*
> * {disk_free_limit,1000000000},*
> * {disk_free,17927184384},*
> * {file_descriptors,*
> *     [{total_limit,199900},*
> *      {total_used,314},*
> *      {sockets_limit,179908},*
> *      {sockets_used,312}]},*
> * {processes,[{limit,1048576},{used,2703}]},*
> * {run_queue,0},*
> * {uptime,3207797}]*
>
> From Top:
> *   2249 rabbitmq  20   0 2989m 319m 2540 S 371.5  2.7  25109:43 beam.smp
>
>                          *
>
>
>  Pls advise me how to proceed further.
>
> Thanks,
> Shri
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/1d27c431/attachment.htm>

From alan.antonuk at gmail.com  Mon Nov 25 17:03:42 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 25 Nov 2013 09:03:42 -0800
Subject: [rabbitmq-discuss] Queries regarding rabbitmq-C APIs
In-Reply-To: <DD7729D61B083D48A2CDCB66A27AD4C98CBB11@BSDMSATMBX001.mahindrasatyam.ad>
References: <DD7729D61B083D48A2CDCB66A27AD4C98CBB11@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAAt2poJ2PDy_Gda2fnhQA6OodkZfOsxyPJP5AUGh3iY=azVH7g@mail.gmail.com>

Which version of Ubuntu?

On Sunday, November 24, 2013, Lothe Shashank wrote:

>  Hi Alan,
>
> I am using Linux (Ubuntu Flavour) platform for my testing. Could you
> kindly try it to reproduce?
>
> Thanks and regards,
> Shashank
>
> ------------------------------
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of the
> intended recipient/s and may contain material that is CONFIDENTIAL AND
> PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or
> distribution or forwarding of any or all of the contents in this message is
> STRICTLY PROHIBITED. If you are not the intended recipient, please contact
> the sender by email and delete all copies; your cooperation in this regard
> is appreciated.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/be76655e/attachment.htm>

From simon at rabbitmq.com  Mon Nov 25 17:28:38 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 25 Nov 2013 17:28:38 +0000
Subject: [rabbitmq-discuss] High cpu usage on CentOS boxes
In-Reply-To: <CAPK6Oeub2UC=WXZ4qtJ3DpZEOcauOyag=Ld=bu_ZpG7TYebsBQ@mail.gmail.com>
References: <CAPK6OevH6WFnnWXf6Dc9H_81vtBnKn+6na-_qbNi1-0mHAE2Wg@mail.gmail.com>
	<CAPK6Oeub2UC=WXZ4qtJ3DpZEOcauOyag=Ld=bu_ZpG7TYebsBQ@mail.gmail.com>
Message-ID: <529388C6.6000808@rabbitmq.com>

I'm afraid there isn't a good way to see which parts of the broker are 
busy at the moment (we hope to add something along these lines in a 
future release).

I'm suspicious of the idea that it's distro-related though. Is the 
CentOS server really performing the same workload as the Ubuntu server?

To get to the bottom of this you'd have to gradually take bits away 
until you see the CPU usage drop - stop connections, disable plugins and 
so on.

Cheers, Simon

On 25/11/2013 16:53, shridharan muthu wrote:
> Hello There,
>
>     Reg my previous message, is there anyway to dig into the high cpu
> usage issue? With similar configs in Ubuntu & Cent OS, Cent OS takes lot
> more cpu for beam.smp process. I switched log level to "info" but
> noticed nothing unusual.
>
> Any help would be appreciated.
>
> Thanks,
> Shri
>
>
> On Fri, Nov 22, 2013 at 3:56 PM, shridharan muthu
> <shridharan.m at gmail.com <mailto:shridharan.m at gmail.com>> wrote:
>
>     Hi There,
>          I am experiencing high cpu usage (above 400%) on Cent OS rabbit
>     mq cluster (with 2 nodes). We have a similar setup in Ubuntu and cpu
>     usage seems fine. Pls fine the report, status and top below.
>
>     OS: /CentOS release 6.4/
>
>     Report:
>     /{pid,2148},/
>     / {running_applications,/
>     /     [{rabbitmq_management,"RabbitMQ Management Console","3.0.2"},/
>     /      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.2"},/
>     /      {rabbit,"RabbitMQ","3.0.2"},/
>     /      {os_mon,"CPO  CXC 138 46","2.2.7"},/
>     /      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.2"},/
>     /      {webmachine,"webmachine","1.9.1-rmq3.0.2-git52e62bc"},/
>     /      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.2-gitd541e9a"},/
>     /      {xmerl,"XML parser","1.2.10"},/
>     /      {inets,"INETS  CXC 138 49","5.7.1"},/
>     /      {mnesia,"MNESIA  CXC 138 12","4.5"},/
>     /      {amqp_client,"RabbitMQ AMQP Client","3.0.2"},/
>     /      {sasl,"SASL  CXC 138 11","2.1.10"},/
>     /      {stdlib,"ERTS  CXC 138 10","1.17.5"},/
>     /      {kernel,"ERTS  CXC 138 10","2.14.5"}]},/
>     / {os,{unix,linux}},/
>     / {erlang_version,/
>     /     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:12:12]
>     [rq:12] [async-threads:30] [kernel-poll:true]\n"},/
>     / {memory,/
>     /     [{total,285898072},/
>     /      {connection_procs,16592856},/
>     /      {queue_procs,1064888},/
>     /      {plugins,269872},/
>     /      {other_proc,13173224},/
>     /      {mnesia,100632},/
>     /      {mgmt_db,2167672},/
>     /      {msg_index,35352},/
>     /      {other_ets,72058416},/
>     /      {binary,7326576},/
>     /      {code,17434264},/
>     /      {atom,3356065},/
>     /      {other_system,152318255}]},/
>     / {vm_memory_high_watermark,0.4},/
>     / {vm_memory_limit,4991811584},/
>     / {disk_free_limit,1000000000},/
>     / {disk_free,17927184384},/
>     / {file_descriptors,/
>     /     [{total_limit,199900},/
>     /      {total_used,314},/
>     /      {sockets_limit,179908},/
>     /      {sockets_used,312}]},/
>     / {processes,[{limit,1048576},{used,2703}]},/
>     / {run_queue,0},/
>     / {uptime,3207797}]/
>
>      From Top:
>     /   2249 rabbitmq  20   0 2989m 319m 2540 S 371.5  2.7  25109:43
>     beam.smp /
>
>
>       Pls advise me how to proceed further.
>
>     Thanks,
>     Shri
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Mon Nov 25 17:34:23 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 25 Nov 2013 17:34:23 +0000
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
Message-ID: <52938A1F.4010307@rabbitmq.com>

On 23/11/2013 20:54, Paul wrote:
> A use case here looks something like this:
>
> 1. Client on computer A publishes message X to local exchange on computer A
> 2. Client on computer B consumes message X from its local exchange on computer B
>
> The intent here is that each client should need to know only its local broker. Clients should not need to know anything about another computer or broker.
>
> How is this best done using RabbitMQ?

Depends what exactly you're trying to do (of course). The use case you 
describe is quite broad, you could achieve that with clustering *or* 
federation *or* the shovel. Each have pros and cons.

Have you looked at http://www.rabbitmq.com/distributed.html ?

Cheers, Simon

From simon at rabbitmq.com  Mon Nov 25 17:39:37 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Mon, 25 Nov 2013 17:39:37 +0000
Subject: [rabbitmq-discuss] Feature Req / Bug list
In-Reply-To: <CAJ4uuZY0agfwfjChtes3LHsTmADhs2ZnTUR557=ir5-Lbk20sg@mail.gmail.com>
References: <CAJ4uuZZnWrC9tp9V+D021AvPDHDKzfXGChvG+OPgD8E8W-tYMw@mail.gmail.com>
	<CAJ4uuZb+bgZGRubJ9pAXH2ZMwyxagJ5mTnk3T8xhhEWm_W_L9w@mail.gmail.com>
	<AEADD6B5-832E-4BB0-9312-47EA927F9F0B@rabbitmq.com>
	<CAJ4uuZYpt5-7bd0SnsqNQCb+W0WAcj5WrH9OxWn6-VfGQoLK8w@mail.gmail.com>
	<92E1A6B8-E4D1-47C5-A108-9E254EC2EF9D@rabbitmq.com>
	<CAJ4uuZYNy3kyCtm1sWbRdaprWkOQ4O8KMhBNFwxafg6zbMSX3g@mail.gmail.com>
	<F573E81A-8BD2-4F9A-8643-ABB67E97773E@rabbitmq.com>
	<CAJ4uuZYUqGeBRVEbacpGPeyHxFP2S9F7PND8KPQakjMg9Whgrg@mail.gmail.com>
	<526ECAD9.2030703@rabbitmq.com>
	<CAJ4uuZYmom2AjYrsYOVxDNfkuK4VVhqoEyFqG5c7f+th-Xdx5w@mail.gmail.com>
	<526ED167.1010308@rabbitmq.com>
	<CAJ4uuZb1kd8dQ1c3=o-mzHvYzUNrHcwUxFU8VvEOurUG7EFtfQ@mail.gmail.com>
	<CAJ4uuZbc13rs9SCmU64K9ant630Z+1j1x-Ss2MRBh7fQnnEXdA@mail.gmail.com>
	<5277A9A3.3060708@rabbitmq.com>
	<CAJ4uuZbAMR3LB4-sG517sLwb=bxzHNir4yx-9zr_+OnrorQ9qw@mail.gmail.com>
	<CAJ4uuZY0agfwfjChtes3LHsTmADhs2ZnTUR557=ir5-Lbk20sg@mail.gmail.com>
Message-ID: <52938B59.8060004@rabbitmq.com>

On 04/11/2013 20:29, Graeme N wrote:
> I'm really hoping you guys can replicate the more severe errors around
> polices and node management. I'm happy to provide thorough reproduction
> steps, information, logs, etc for anything I've reported here, if you
> guys are having issues reproducing internally.

Graeme: we recently merged a few fixes to bugs that we found as a result 
of running your test scripts; these can be picked up in the latest 
nightlies. I am now able to run rebalance_cluster.sh and toggle_nodes.sh 
indefinitely without anything breaking.

Thanks for producing these scripts!

Cheers, Simon

From arachweb at gmail.com  Mon Nov 25 18:10:59 2013
From: arachweb at gmail.com (Paul Bell)
Date: Mon, 25 Nov 2013 13:10:59 -0500
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <52938A1F.4010307@rabbitmq.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
	<52938A1F.4010307@rabbitmq.com>
Message-ID: <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>

Hi Simon,

Thanks for the reply.

Yup, I sure did look at the distributed.html page you reference. In fact,
it was that page that pushed me in the direction of a cluster rather than
federation or Shovel. I reasoned that my use case has reliable networking
and didn't need the WAN-friendly capabilities of a federation, i.e.,
"machines in a single location."

The page you referenced includes this remark:

"Virtual hosts, exchanges, users, and permissions are automatically
mirrored across all nodes in a cluster. Queues may be located on a single
node, or mirrored across multiple nodes <http://www.rabbitmq.com/ha.html>.
A client connecting to any node in a cluster can see all queues in the
cluster, even if they are not located on that node."

Question: does the last sentence apply to both queues located on a single
node and to mirrored (HA) queues? The last clause of that sentence, e.g.,
"..even if they are not located on that node" suggests that whether or not
the queues are mirrored shouldn't matter, i.e., client will see the queues
regardless of the cluster it connects to.

The cluster approach "feels" complex to me but that is, at least in part,
due to the fact that my once modest Rabbit skills have atrophied over the
last couple of year. So, here's some thinking out loud with attendant
questions:

1. Let's see, so, the several computers on which my (Java) RabbitMQ
component runs will be joined together in a cluster.
2. What happens if Computer A creates some exchanges and then computer B,
either before or after joining the cluster, creates the same exchanges?
Maybe the usual Rabbit idempotency holds here; i.e., if exchange exists
within the cluster, it's not going to be re-created...?
3. And if the component publishes to an exchange that message should (I
think) be visible on the mirrored exchanges on all of the other nodes in
the cluster, right?
4. And, moreover, once a consumer on any cluster node reads that message,
no other consumer will be able to read it. I sure hope this is true.

Can you address the concerns expressed in this stream of consciousness?

Thanks again, Simon.

Cordially,

-Paul


On Mon, Nov 25, 2013 at 12:34 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 23/11/2013 20:54, Paul wrote:
>
>> A use case here looks something like this:
>>
>> 1. Client on computer A publishes message X to local exchange on computer
>> A
>> 2. Client on computer B consumes message X from its local exchange on
>> computer B
>>
>> The intent here is that each client should need to know only its local
>> broker. Clients should not need to know anything about another computer or
>> broker.
>>
>> How is this best done using RabbitMQ?
>>
>
> Depends what exactly you're trying to do (of course). The use case you
> describe is quite broad, you could achieve that with clustering *or*
> federation *or* the shovel. Each have pros and cons.
>
> Have you looked at http://www.rabbitmq.com/distributed.html ?
>
> Cheers, Simon
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/31a949f5/attachment.htm>

From ayip at recondynamics.com  Mon Nov 25 20:53:03 2013
From: ayip at recondynamics.com (Adrian Yip)
Date: Mon, 25 Nov 2013 12:53:03 -0800
Subject: [rabbitmq-discuss] Posting MQTT to RabbitMQ QOS=1
In-Reply-To: <52934DD6.7040503@rabbitmq.com>
References: <8d289f0142c2ca19ceb10823391e161e@mail.gmail.com>
	<528F828C.5020206@rabbitmq.com> <52934DD6.7040503@rabbitmq.com>
Message-ID: <4968ffaaac8d297f5007db69cf8584f2@mail.gmail.com>

Yes it was a client issue, I reviewed the Mosquito code and documentation
and now understand that with QoS>0, the client publisher needs to either
be calling client.loop() or trigger the Mosquito thread to run via
client.loop_start() so that the publish acks are processed.

Thanks for following up.

Adrian

-----Original Message-----
From: Emile Joubert [mailto:emile at rabbitmq.com]
Sent: Monday, November 25, 2013 5:17 AM
To: Discussions about RabbitMQ
Cc: Adrian Yip
Subject: Re: [rabbitmq-discuss] Posting MQTT to RabbitMQ QOS=1

On 22/11/13 16:13, Emile Joubert wrote:

> On 22/11/13 02:19, Adrian Yip wrote:

>> When I publish with QOS=1 however, the client appears successful in
>> publishing, but the receiver always stops at 20 messages.  I can kick
>> off another client without stopping the receiver and it will also do
>> the same thing, the receiver will show 20 messages and nothing more.
>
> The default mosquitto max_inflight_messages is 20. Set this to a
> higher number or unlimited, and do the same for the broker prefetch
configuration.

It looks like the problem might be in the MQTT python client library.
The broker immediately acknowledges the publish messages, so I don't see
why the client library stops sending messages after the first 20. My
earlier suggestion works, but it should not be necessary.



-Emile

From mahi.rabbitmq at gmail.com  Mon Nov 25 22:27:04 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Mon, 25 Nov 2013 14:27:04 -0800
Subject: [rabbitmq-discuss] queue properties
Message-ID: <CAGOpLV4-AnfDjO0d9R8Y+kC6XM0WSKgTM0dtpshXsJSZrca5wQ@mail.gmail.com>

Hi

I executed following command in cli

./rabbitmqadmin -f long -d 3 list queues.

Could you please explain briefly some of the properties

1.backing_queue_status.avg_ack_egress_rate:
2.backing_queue_status.avg_ack_ingress_rate:
3.backing_queue_status.avg_egress_rate:
4.backing_queue_status.avg_ingress_rate:
5.backing_queue_status.delta:
6.backing_queue_status.len:
7.backing_queue_status.next_seq_id:
8.backing_queue_status.pending_acks:
9.backing_queue_status.persistent_count:
10.backing_queue_status.q1:
11.backing_queue_status.q2:
12.backing_queue_status.q3:
13.backing_queue_status.q4:
14.backing_queue_status.ram_ack_count:
15.backing_queue_status.ram_msg_count:
16.backing_queue_status.target_ram_count: infinity
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/1a841802/attachment.htm>

From mahi.rabbitmq at gmail.com  Mon Nov 25 22:38:26 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Mon, 25 Nov 2013 14:38:26 -0800
Subject: [rabbitmq-discuss] queue properties
In-Reply-To: <CAGOpLV4-AnfDjO0d9R8Y+kC6XM0WSKgTM0dtpshXsJSZrca5wQ@mail.gmail.com>
References: <CAGOpLV4-AnfDjO0d9R8Y+kC6XM0WSKgTM0dtpshXsJSZrca5wQ@mail.gmail.com>
Message-ID: <CAGOpLV5q-vo+5R=sAmxZY=Cb8J-0UdxMwfnLDVdf3Xg5KoTvcw@mail.gmail.com>

including messages_details.rate

Thanks


On Mon, Nov 25, 2013 at 2:27 PM, mahi e <mahi.rabbitmq at gmail.com> wrote:

> Hi
>
> I executed following command in cli
>
> ./rabbitmqadmin -f long -d 3 list queues.
>
> Could you please explain briefly some of the properties
>
> 1.backing_queue_status.avg_ack_egress_rate:
> 2.backing_queue_status.avg_ack_ingress_rate:
> 3.backing_queue_status.avg_egress_rate:
> 4.backing_queue_status.avg_ingress_rate:
> 5.backing_queue_status.delta:
> 6.backing_queue_status.len:
> 7.backing_queue_status.next_seq_id:
> 8.backing_queue_status.pending_acks:
> 9.backing_queue_status.persistent_count:
> 10.backing_queue_status.q1:
> 11.backing_queue_status.q2:
> 12.backing_queue_status.q3:
> 13.backing_queue_status.q4:
> 14.backing_queue_status.ram_ack_count:
> 15.backing_queue_status.ram_msg_count:
> 16.backing_queue_status.target_ram_count: infinity
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/ad35a84e/attachment.htm>

From 314992959 at qq.com  Tue Nov 26 01:31:03 2013
From: 314992959 at qq.com (3k4b251)
Date: Mon, 25 Nov 2013 17:31:03 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq-c can't send message to queue
In-Reply-To: <52931E93.7080108@rabbitmq.com>
References: <1385371279244-31614.post@n5.nabble.com>
	<52931E93.7080108@rabbitmq.com>
Message-ID: <1385429463626-31645.post@n5.nabble.com>

thank you  all  of you . 
    When  I  send message to  the   exchange  which  not exist.   then  I  
use  the code :   amqp_rpc_reply_t  Result = amqp_get_rpc_reply
(m_connSend);    

   It's  result    AMQP_RESPONSE_NORMAL .....  how  can  I   know  the 
channel  exception  happened ?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-can-t-send-message-to-queue-tp31614p31645.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From shridharan.m at gmail.com  Tue Nov 26 05:24:20 2013
From: shridharan.m at gmail.com (shridharan muthu)
Date: Mon, 25 Nov 2013 21:24:20 -0800
Subject: [rabbitmq-discuss] High cpu usage on CentOS boxes
In-Reply-To: <529388C6.6000808@rabbitmq.com>
References: <CAPK6OevH6WFnnWXf6Dc9H_81vtBnKn+6na-_qbNi1-0mHAE2Wg@mail.gmail.com>
	<CAPK6Oeub2UC=WXZ4qtJ3DpZEOcauOyag=Ld=bu_ZpG7TYebsBQ@mail.gmail.com>
	<529388C6.6000808@rabbitmq.com>
Message-ID: <CAPK6OeuCg_R8dtHtaSjENt19ACUDJ3NpAH+SNoqvveZrRAHpbw@mail.gmail.com>

Hello Simon,
   Cent OS takes much lesser traffic than I have on Ubuntu. I migrated 5%
cpu traffic from ubuntu and It caused 15% cpu increase in Cent OS. I
goggled and noticed quite similar questions but didn't find any solutions.
If there are a few knobs that I can tune,  I would be happy to test it out.

    BTW, I don't use Mandatory/Immediate flags or Acks. All my publisher &
consumer calls are asynchronous.

Thanks,
Shri


On Mon, Nov 25, 2013 at 9:28 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> I'm afraid there isn't a good way to see which parts of the broker are
> busy at the moment (we hope to add something along these lines in a future
> release).
>
> I'm suspicious of the idea that it's distro-related though. Is the CentOS
> server really performing the same workload as the Ubuntu server?
>
> To get to the bottom of this you'd have to gradually take bits away until
> you see the CPU usage drop - stop connections, disable plugins and so on.
>
> Cheers, Simon
>
>
> On 25/11/2013 16:53, shridharan muthu wrote:
>
>> Hello There,
>>
>>     Reg my previous message, is there anyway to dig into the high cpu
>> usage issue? With similar configs in Ubuntu & Cent OS, Cent OS takes lot
>> more cpu for beam.smp process. I switched log level to "info" but
>> noticed nothing unusual.
>>
>> Any help would be appreciated.
>>
>> Thanks,
>> Shri
>>
>>
>> On Fri, Nov 22, 2013 at 3:56 PM, shridharan muthu
>> <shridharan.m at gmail.com <mailto:shridharan.m at gmail.com>> wrote:
>>
>>     Hi There,
>>          I am experiencing high cpu usage (above 400%) on Cent OS rabbit
>>     mq cluster (with 2 nodes). We have a similar setup in Ubuntu and cpu
>>     usage seems fine. Pls fine the report, status and top below.
>>
>>     OS: /CentOS release 6.4/
>>
>>     Report:
>>     /{pid,2148},/
>>     / {running_applications,/
>>     /     [{rabbitmq_management,"RabbitMQ Management Console","3.0.2"},/
>>     /      {rabbitmq_management_agent,"RabbitMQ Management
>> Agent","3.0.2"},/
>>     /      {rabbit,"RabbitMQ","3.0.2"},/
>>     /      {os_mon,"CPO  CXC 138 46","2.2.7"},/
>>     /      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.2"},/
>>     /      {webmachine,"webmachine","1.9.1-rmq3.0.2-git52e62bc"},/
>>     /      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.2-
>> gitd541e9a"},/
>>     /      {xmerl,"XML parser","1.2.10"},/
>>     /      {inets,"INETS  CXC 138 49","5.7.1"},/
>>     /      {mnesia,"MNESIA  CXC 138 12","4.5"},/
>>     /      {amqp_client,"RabbitMQ AMQP Client","3.0.2"},/
>>     /      {sasl,"SASL  CXC 138 11","2.1.10"},/
>>     /      {stdlib,"ERTS  CXC 138 10","1.17.5"},/
>>     /      {kernel,"ERTS  CXC 138 10","2.14.5"}]},/
>>     / {os,{unix,linux}},/
>>     / {erlang_version,/
>>     /     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:12:12]
>>     [rq:12] [async-threads:30] [kernel-poll:true]\n"},/
>>     / {memory,/
>>     /     [{total,285898072},/
>>     /      {connection_procs,16592856},/
>>     /      {queue_procs,1064888},/
>>     /      {plugins,269872},/
>>     /      {other_proc,13173224},/
>>     /      {mnesia,100632},/
>>     /      {mgmt_db,2167672},/
>>     /      {msg_index,35352},/
>>     /      {other_ets,72058416},/
>>     /      {binary,7326576},/
>>     /      {code,17434264},/
>>     /      {atom,3356065},/
>>     /      {other_system,152318255}]},/
>>     / {vm_memory_high_watermark,0.4},/
>>     / {vm_memory_limit,4991811584},/
>>     / {disk_free_limit,1000000000},/
>>     / {disk_free,17927184384},/
>>     / {file_descriptors,/
>>     /     [{total_limit,199900},/
>>     /      {total_used,314},/
>>     /      {sockets_limit,179908},/
>>     /      {sockets_used,312}]},/
>>     / {processes,[{limit,1048576},{used,2703}]},/
>>     / {run_queue,0},/
>>     / {uptime,3207797}]/
>>
>>      From Top:
>>     /   2249 rabbitmq  20   0 2989m 319m 2540 S 371.5  2.7  25109:43
>>     beam.smp /
>>
>>
>>
>>       Pls advise me how to proceed further.
>>
>>     Thanks,
>>     Shri
>>
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/d74b32f3/attachment.htm>

From Shashank.Lothe at techmahindra.com  Tue Nov 26 05:29:52 2013
From: Shashank.Lothe at techmahindra.com (Lothe Shashank)
Date: Tue, 26 Nov 2013 05:29:52 +0000
Subject: [rabbitmq-discuss] [Rabbitmq-c] Alias for hostname
Message-ID: <DD7729D61B083D48A2CDCB66A27AD4C98CBD7B@BSDMSATMBX001.mahindrasatyam.ad>

Hi Alan,

When from example program I am using hostname (fully qualified domain name) to connect to Rabbitmq server (broker) I am able connect properly. However if I use Alias for the rabbitmq server hostname I am not able to connect. I am using Linux platform and version 0.3 for this testing.

The same testing I did for php program it is working fine with Alias. PhP package was taken from  https://github.com/braveSirRobin/amqphp or  https://github.com/videlalvaro/php-amqplib
Kindly suggest.

Thanks and regards,
Shashank

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/505001f5/attachment.htm>

From alan.antonuk at gmail.com  Tue Nov 26 05:48:36 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 25 Nov 2013 21:48:36 -0800
Subject: [rabbitmq-discuss] [Rabbitmq-c] Alias for hostname
In-Reply-To: <DD7729D61B083D48A2CDCB66A27AD4C98CBD7B@BSDMSATMBX001.mahindrasatyam.ad>
References: <DD7729D61B083D48A2CDCB66A27AD4C98CBD7B@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAAt2poJCj8OiLKxrygWqrkimKNSjKgFSeNnONrXDuKeuXDnLag@mail.gmail.com>

What do mean by "alias for rabbitmq hostname"?

-Alan


On Mon, Nov 25, 2013 at 9:29 PM, Lothe Shashank <
Shashank.Lothe at techmahindra.com> wrote:

>  Hi Alan,
>
> When from example program I am using hostname (fully qualified domain
> name) to connect to Rabbitmq server (broker) I am able connect properly.
> However if I use Alias for the rabbitmq server hostname I am not able to
> connect. I am using Linux platform and version 0.3 for this testing.
>
> The same testing I did for php program it is working fine with Alias. PhP
> package was taken from  https://github.com/braveSirRobin/amqphp or
> https://github.com/videlalvaro/php-amqplib
> Kindly suggest.
>
> Thanks and regards,
> Shashank
>
> ------------------------------
>
> DISCLAIMER:
> This email (including any attachments) is intended for the sole use of the
> intended recipient/s and may contain material that is CONFIDENTIAL AND
> PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or
> distribution or forwarding of any or all of the contents in this message is
> STRICTLY PROHIBITED. If you are not the intended recipient, please contact
> the sender by email and delete all copies; your cooperation in this regard
> is appreciated.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/d8161914/attachment.htm>

From alan.antonuk at gmail.com  Tue Nov 26 05:57:41 2013
From: alan.antonuk at gmail.com (Alan Antonuk)
Date: Mon, 25 Nov 2013 21:57:41 -0800
Subject: [rabbitmq-discuss] rabbitmq-c can't send message to queue
In-Reply-To: <1385429463626-31645.post@n5.nabble.com>
References: <1385371279244-31614.post@n5.nabble.com>
	<52931E93.7080108@rabbitmq.com>
	<1385429463626-31645.post@n5.nabble.com>
Message-ID: <CAAt2poJH+RXXbnXoKQLMm3RU_-_zuxmn6vFiMuve1CiAhgGezw@mail.gmail.com>

amqp_basic_publish() is not an RPC (its asynchronous), so
amqp_get_rpc_reply() will not give you the answer you're looking for.

Because rabbitmq-c doesn't deal with async events very well there isn't a
good API to check for channel exceptions that occur as a result of an async
operation. Your best bet would be to call amqp_simple_wait_frame_noblock()
with a short timeout, if a channel exception occurs you will get a
AMQP_CHANNEL_CLOSE_METHOD frame from the broker.

-Alan


On Mon, Nov 25, 2013 at 5:31 PM, 3k4b251 <314992959 at qq.com> wrote:

> thank you  all  of you .
>     When  I  send message to  the   exchange  which  not exist.   then  I
> use  the code :   amqp_rpc_reply_t  Result = amqp_get_rpc_reply
> (m_connSend);
>
>    It's  result    AMQP_RESPONSE_NORMAL .....  how  can  I   know  the
> channel  exception  happened ?
>
>
>
> --
> View this message in context:
> http://rabbitmq.1065348.n5.nabble.com/rabbitmq-c-can-t-send-message-to-queue-tp31614p31645.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/da2c6dca/attachment.htm>

From 314992959 at qq.com  Tue Nov 26 06:15:17 2013
From: 314992959 at qq.com (3k4b251)
Date: Mon, 25 Nov 2013 22:15:17 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMq Server how to make master-slave and
	master-backup ?
Message-ID: <1385446517809-31650.post@n5.nabble.com>

I'd  like  to  create   two  RABBITMQ_MNESIA_BASE.    rabbitmq  server  use 
one,  and  copy  data  to  the other database  at the same time   or  a 
time later .



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/RabbitMq-Server-how-to-make-master-slave-and-master-backup-tp31650.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From Rohit.Patel2 at techmahindra.com  Tue Nov 26 06:18:07 2013
From: Rohit.Patel2 at techmahindra.com (Rohit Patle)
Date: Tue, 26 Nov 2013 06:18:07 +0000
Subject: [rabbitmq-discuss] amqp_simple_wait_frame_noblock() timing
	issue.
Message-ID: <27E054594442884E9A46DBCF9AE74081610E9B@BSDMSATMBX001.mahindrasatyam.ad>

Hi Alan,

I have downloaded this package from https://github.com/alanxz/rabbitmq-c/tree/master/librabbitmq, in which at amqp.h file I can see the declaration for amqp_simple_wait_frame_noblock API. After installing the package, librabbitmq.pc file contains like as:

$ cat /usr/local/lib/pkgconfig/librabbitmq.pc
prefix=/usr/local
exec_prefix=${prefix}
libdir=${exec_prefix}/lib
includedir=${prefix}/include

Name: Librabbitmq
Description: An AMQP 0-9-1 client library
Version: 0.3.0
Requires:
Requires.private:
Libs: -L${libdir} -lrabbitmq
CFlags: -I${includedir}

I am also attaching the package which I got from the site along with this mail. Kindly suggest.

Thanks & Regards,
Rohit

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/10eb26e0/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq-c-master.zip
Type: application/zip
Size: 208297 bytes
Desc: rabbitmq-c-master.zip
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/10eb26e0/attachment.zip>

From maitreya_vvm at yahoo.co.in  Tue Nov 26 06:25:09 2013
From: maitreya_vvm at yahoo.co.in (vadlamani maitreya)
Date: Tue, 26 Nov 2013 14:25:09 +0800 (SGT)
Subject: [rabbitmq-discuss] Pika Client starts consuming before calling
	start_consuming
Message-ID: <1385447109.17717.YahooMailNeo@web192503.mail.sg3.yahoo.com>

Hello Everyone,

I have a small problem with RMQ and pika client and would like to ask guyz here for some help. The situation is as below,

I am using RabbitMQ with the pika clients in a scalable solution. The solution requires messaging with two priorities. So every worker (through pika client) gets messages from the HighPriority Queue first and then goes to the Low Priority queue if there are no messages left in the HP Queue. I decide to scale the number of workers according to the number of ready messages and the number of consumers attached to the queue. So the following is the workflow i follow to achieve the above.

1) Register using? basic_consume on the queue.
2) Do basic_get from HP Queue
3)If no messages in HP Queue do a basic_get from LP Queue.

I donot execute start_consuming() so the basic_consume is just for the number of consumers count in the RMQ server.

This logic works perfectly fine with the standard Java Client. But when i try to do the same with the Pika Client, the moment the basic_consume is called the data events are processed and the callback function is executed on the incoming message, eventhough the start_consuming() function is not called.

So, a couple of questions here,

1. Is there a way to register as a consumer to a queue without actually starting to consume from the queue (even a hack into the code is fine)
2. Is it bug that basic_consume() starts consuming without actually calling start_consuming() (the actual blocking function), and should i raise an issue in github regarding this ?

Last but not the least, the version of the rabbitMQ server is 3.1.2 and the pika client, i have tried both 0.9.6 and 0.9.13 with the above scenario.

Thankyou everyone,
Maitreya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/f0b6e64c/attachment.htm>

From lijo at citrusinformatics.com  Tue Nov 26 06:48:52 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Tue, 26 Nov 2013 12:18:52 +0530
Subject: [rabbitmq-discuss] Exchange details are not set while creating with
	Put Method in c#
Message-ID: <F99B4B8998AC4CDE97CA917FC65D0FEB@Lijo>


Hi, 
       I am trying to create an exchange of type Topic. 
    
        Using PUT method to rabbitmq server, i was able to create one,  but the type is always fanout.

Below is the code i used.

Please tell what i am wrong here?

Code: 


var httpWebRequest = (HttpWebRequest)WebRequest.Create("http://guest:guest at rabbitmqserver/endpoint/x/exchangeName");
httpWebRequest.ContentType = "application/json";
httpWebRequest.Method = "PUT";
var data= new Dictionary<string, string>();
data.Add("type", "topic");
data.Add("auto_delete", false.ToString().ToLower());
data.Add("durable", true.ToString().ToLower());

using (var streamWriter = new StreamWriter(httpWebRequest.GetRequestStream()))
{

    string json = JsonConvert.SerializeObject(data);

    streamWriter.Write(json);
    streamWriter.Flush();
    streamWriter.Close();

    var httpResponse = (HttpWebResponse)httpWebRequest.GetResponse();
    using (var streamReader = new StreamReader(httpResponse.GetResponseStream()))
    {
        var result = streamReader.ReadToEnd();
    }
}

Regards, 
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/abfa09ff/attachment.htm>

From mklishin at gopivotal.com  Tue Nov 26 07:16:03 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 26 Nov 2013 11:16:03 +0400
Subject: [rabbitmq-discuss] channel_max
In-Reply-To: <DF241A26-C717-4EAF-949A-6639E5D6797B@gopivotal.com>
References: <1385090022896-31572.post@n5.nabble.com>
	<21AF4D92-9E7D-4AA8-96CC-788060ECBDAB@rabbitmq.com>
	<8C0F82EDC6934FCEB15046AA1C2ABB8D@gmail.com>
	<57235940-E60E-4D90-B238-E5458E7E3DC2@rabbitmq.com>
	<DF241A26-C717-4EAF-949A-6639E5D6797B@gopivotal.com>
Message-ID: <971B068F-D951-4379-B333-25963709D38D@gopivotal.com>

On 24 Nov 2013, at 15:10, Michael Klishin <mklishin at gopivotal.com> wrote:

> It may not be necessary to modify reasonable clients.

Some early results look promising. You can follow progress on this branch

https://github.com/rabbitmq/rabbitmq-server/commits/bug22525

(there will be changes on the same branch in other repos)
--
MK

Software Engineer, Pivotal/RabbitMQ


From mklishin at gopivotal.com  Tue Nov 26 07:21:33 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 26 Nov 2013 11:21:33 +0400
Subject: [rabbitmq-discuss] queue properties
In-Reply-To: <CAGOpLV4-AnfDjO0d9R8Y+kC6XM0WSKgTM0dtpshXsJSZrca5wQ@mail.gmail.com>
References: <CAGOpLV4-AnfDjO0d9R8Y+kC6XM0WSKgTM0dtpshXsJSZrca5wQ@mail.gmail.com>
Message-ID: <838F5DE4-2822-436C-80AB-96F5472005CF@rabbitmq.com>


On 26 Nov 2013, at 02:27, mahi e <mahi.rabbitmq at gmail.com> wrote:

> Could you please explain briefly some of the properties  
> 
> 1.backing_queue_status.avg_ack_egress_rate:
> 2.backing_queue_status.avg_ack_ingress_rate:
> 3.backing_queue_status.avg_egress_rate: 
> 4.backing_queue_status.avg_ingress_rate:
> 5.backing_queue_status.delta:
> 6.backing_queue_status.len: 
> 7.backing_queue_status.next_seq_id:
> 8.backing_queue_status.pending_acks: 
> 9.backing_queue_status.persistent_count: 
> 10.backing_queue_status.q1: 
> 11.backing_queue_status.q2: 
> 12.backing_queue_status.q3: 
> 13.backing_queue_status.q4: 
> 14.backing_queue_status.ram_ack_count: 
> 15.backing_queue_status.ram_msg_count: 
> 16.backing_queue_status.target_ram_count: infinity

See the comments in
https://github.com/michaelklishin/rabbit-hole/blob/master/queues.go#L10

Don?t worry about q1-q4 and next_seq_id, they are message store implementation details.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Tue Nov 26 07:25:43 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 26 Nov 2013 11:25:43 +0400
Subject: [rabbitmq-discuss] RabbitMq Server how to make master-slave and
	master-backup ?
In-Reply-To: <1385446517809-31650.post@n5.nabble.com>
References: <1385446517809-31650.post@n5.nabble.com>
Message-ID: <3C13ED25-9218-4A1E-ABF7-EBC7EA993E19@rabbitmq.com>

On 26 Nov 2013, at 10:15, 3k4b251 <314992959 at qq.com> wrote:

> rabbitmq  server  use 
> one,  and  copy  data  to  the other database  at the same time   or  a 
> time later .

It?s only safe to copy Mnesia directory when RabbitMQ node that uses it is not running.

If you want a hot standby, use Shovel or federated exchanges to replicate messages.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Tue Nov 26 07:26:52 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 26 Nov 2013 11:26:52 +0400
Subject: [rabbitmq-discuss] amqp_simple_wait_frame_noblock() timing
	issue.
In-Reply-To: <27E054594442884E9A46DBCF9AE74081610E9B@BSDMSATMBX001.mahindrasatyam.ad>
References: <27E054594442884E9A46DBCF9AE74081610E9B@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <393FFF0C-A75C-45F8-A148-72EC31EEFE09@rabbitmq.com>


On 26 Nov 2013, at 10:18, Rohit Patle <Rohit.Patel2 at techmahindra.com> wrote:

> Kindly suggest.

It?s not clear what your question is. Please be more specific.

MK

Software Engineer, Pivotal/RabbitMQ



From carl.hoerberg at gmail.com  Tue Nov 26 07:30:13 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Mon, 25 Nov 2013 23:30:13 -0800 (PST)
Subject: [rabbitmq-discuss] channel_max
In-Reply-To: <971B068F-D951-4379-B333-25963709D38D@gopivotal.com>
References: <1385090022896-31572.post@n5.nabble.com>
	<21AF4D92-9E7D-4AA8-96CC-788060ECBDAB@rabbitmq.com>
	<8C0F82EDC6934FCEB15046AA1C2ABB8D@gmail.com>
	<57235940-E60E-4D90-B238-E5458E7E3DC2@rabbitmq.com>
	<DF241A26-C717-4EAF-949A-6639E5D6797B@gopivotal.com>
	<971B068F-D951-4379-B333-25963709D38D@gopivotal.com>
Message-ID: <A948BC2F1BC549B78520A465D3258A68@gmail.com>

That?s great news! Thank you!  



On Tuesday 26 November 2013 at 14:17, Michael Klishin-2 [via RabbitMQ] wrote:

> On 24 Nov 2013, at 15:10, Michael Klishin <[hidden email] (/user/SendEmail.jtp?type=node&node=31654&i=0)> wrote:  
>  
> > It may not be necessary to modify reasonable clients.  
>  
> Some early results look promising. You can follow progress on this branch  
>  
> https://github.com/rabbitmq/rabbitmq-server/commits/bug22525
>  
> (there will be changes on the same branch in other repos)  
> --  
> MK  
>  
> Software Engineer, Pivotal/RabbitMQ  
>  
> _______________________________________________  
> rabbitmq-discuss mailing list  
> [hidden email] (/user/SendEmail.jtp?type=node&node=31654&i=1)  
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>  
>  
> If you reply to this email, your message will be added to the discussion below: http://rabbitmq.1065348.n5.nabble.com/channel-max-tp31572p31654.html  
> To unsubscribe from channel_max, click here (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=unsubscribe_by_code&node=31572&code=Y2FybC5ob2VyYmVyZ0BnbWFpbC5jb218MzE1NzJ8LTEyNDcxMDc4NjM=).
> NAML (http://rabbitmq.1065348.n5.nabble.com/template/NamlServlet.jtp?macro=macro_viewer&id=instant_html%21nabble%3Aemail.naml&base=nabble.naml.namespaces.BasicNamespace-nabble.view.web.template.NabbleNamespace-nabble.view.web.template.NodeNamespace&breadcrumbs=notify_subscribers%21nabble%3Aemail.naml-instant_emails%21nabble%3Aemail.naml-send_instant_email%21nabble%3Aemail.naml)  







--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/channel-max-tp31572p31658.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131125/b6e254c1/attachment.htm>

From mklishin at gopivotal.com  Tue Nov 26 07:29:50 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 26 Nov 2013 11:29:50 +0400
Subject: [rabbitmq-discuss] Pika Client starts consuming before calling
	start_consuming
In-Reply-To: <1385447109.17717.YahooMailNeo@web192503.mail.sg3.yahoo.com>
References: <1385447109.17717.YahooMailNeo@web192503.mail.sg3.yahoo.com>
Message-ID: <034FA243-1A1B-4623-9736-9C4759971C18@rabbitmq.com>


On 26 Nov 2013, at 10:25, vadlamani maitreya <maitreya_vvm at yahoo.co.in> wrote:

> So the following is the workflow i follow to achieve the above.
> 
> 1) Register using  basic_consume on the queue.
> 2) Do basic_get from HP Queue
> 3)If no messages in HP Queue do a basic_get from LP Queue.
> 
> I donot execute start_consuming() so the basic_consume is just for the number of consumers count in the RMQ server.
> 
> This logic works perfectly fine with the standard Java Client.

Can you post some code that demonstrates this? With the Java client, if you use basicConsume
and there are messages in the queue, you will start getting deliveries immediately (basic.qos and other
consumers on the same channel may affect this, though).

Using basic.get after basic.consume makes no sense. If you want to use basic.get, there is no need to
use basic.consume.

MK

Software Engineer, Pivotal/RabbitMQ



From mklishin at gopivotal.com  Tue Nov 26 08:45:29 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Tue, 26 Nov 2013 12:45:29 +0400
Subject: [rabbitmq-discuss] ANN Bunny 1.0.5 is released
Message-ID: <F9FB8F22-C4C4-4DBD-B20C-564C6C98A668@gopivotal.com>

Bunny 1.0.5 is released [1] with a bunch of bug fixes.

Release notes:
http://blog.rubyrabbitmq.info/blog/2013/11/26/bunny-1-dot-0-5-is-released/

All users are highly recommended to upgrade.

1. https://rubygems.org/gems/bunny/versions/1.0.5
--
MK

Software Engineer, Pivotal/RabbitMQ

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/10d0153a/attachment.pgp>

From simon at rabbitmq.com  Tue Nov 26 09:45:12 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Nov 2013 09:45:12 +0000
Subject: [rabbitmq-discuss] Exchange details are not set while creating
 with Put Method in c#
In-Reply-To: <F99B4B8998AC4CDE97CA917FC65D0FEB@Lijo>
References: <F99B4B8998AC4CDE97CA917FC65D0FEB@Lijo>
Message-ID: <52946DA8.9080408@rabbitmq.com>

If you don't specify the exchange type (somehow) then the default is 
direct, not fanout. And your code looks right as a non-C# expert. So I 
suspect that someone previously declared a fanout exchange with the same 
name. The server should be responding with 400 Bad Request and an error 
message - are you checking the response?

Cheers, Simon

On 26/11/2013 06:48, Lijo Sebastian wrote:
> Hi,
>         I am trying to create an exchange of type *Topic*.
>          Using PUT method to rabbitmq server, i was able to create one,
> but the type is always *fanout*.
> Below is the code i used.
> Please tell what i am wrong here?
> Code:
> var httpWebRequest =
> (HttpWebRequest)WebRequest.Create("http://guest:guest at rabbitmqserver/endpoint/x/exchangeName");
> httpWebRequest.ContentType = "application/json";
> httpWebRequest.Method = "PUT";
> var data= new Dictionary<string, string>();
> data.Add("type", "topic");
> data.Add("auto_delete", false.ToString().ToLower());
> data.Add("durable", true.ToString().ToLower());
> using (var streamWriter = new
> StreamWriter(httpWebRequest.GetRequestStream()))
> {
>      string json = JsonConvert.SerializeObject(data);
>      streamWriter.Write(json);
>      streamWriter.Flush();
>      streamWriter.Close();
>      var httpResponse = (HttpWebResponse)httpWebRequest.GetResponse();
>      using (var streamReader = new
> StreamReader(httpResponse.GetResponseStream()))
>      {
>          var result = streamReader.ReadToEnd();
>      }
> }
>
> Regards,
> Lijo Sebastian
> Senior Software Engineer
> Citrus Informatics (India) Pvt Ltd.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Tue Nov 26 09:55:19 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Nov 2013 09:55:19 +0000
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
	<52938A1F.4010307@rabbitmq.com>
	<CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
Message-ID: <52947007.9060903@rabbitmq.com>

On 25/11/2013 18:10, Paul Bell wrote:
> "Virtual hosts, exchanges, users, and permissions are automatically
> mirrored across all nodes in a cluster. Queues may be located on a
> single node, or mirrored across multiple nodes
> <http://www.rabbitmq.com/ha.html>. A client connecting to any node in a
> cluster can see all queues in the cluster, even if they are not located
> on that node."
>
> Question: does the last sentence apply to both queues located on a
> single node and to mirrored (HA) queues?

Yes.

> The last clause of that
> sentence, e.g., "..even if they are not located on that node" suggests
> that whether or not the queues are mirrored shouldn't matter, i.e.,
> client will see the queues regardless of the cluster it connects to.

Yes. And of course just because a queue is mirrored doesn't mean it has 
to be on *every* node in the cluster - you don't have to use ha-mode: all.

> The cluster approach "feels" complex to me but that is, at least in
> part, due to the fact that my once modest Rabbit skills have atrophied
> over the last couple of year. So, here's some thinking out loud with
> attendant questions:
>
> 1. Let's see, so, the several computers on which my (Java) RabbitMQ
> component runs will be joined together in a cluster.
> 2. What happens if Computer A creates some exchanges and then computer
> B, either before or after joining the cluster, creates the same
> exchanges? Maybe the usual Rabbit idempotency holds here; i.e., if
> exchange exists within the cluster, it's not going to be re-created...?

Yes, the exchange (along with other metadata) is held in a distributed 
database and created atomically.

> 3. And if the component publishes to an exchange that message should (I
> think) be visible on the mirrored exchanges on all of the other nodes in
> the cluster, right?

Yes. We don't normally talk about "mirrored exchanges" since all 
exchanges are inherently mirrored.

> 4. And, moreover, once a consumer on any cluster node reads that
> message, no other consumer will be able to read it. I sure hope this is
> true.

If it only got routed to one queue. Obviously if it was routed to two 
queues it can be read twice, and so on.

Also the message can be seen by two consumers if one consumer is 
consuming in ack mode, then sees the message and either rejects it or 
crashes before acknowledging it. That's true on a single node though, 
nothing to do with clustering.

Cheers, Simon


From simon at rabbitmq.com  Tue Nov 26 10:01:13 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Nov 2013 10:01:13 +0000
Subject: [rabbitmq-discuss] queue properties
In-Reply-To: <838F5DE4-2822-436C-80AB-96F5472005CF@rabbitmq.com>
References: <CAGOpLV4-AnfDjO0d9R8Y+kC6XM0WSKgTM0dtpshXsJSZrca5wQ@mail.gmail.com>
	<838F5DE4-2822-436C-80AB-96F5472005CF@rabbitmq.com>
Message-ID: <52947169.8080808@rabbitmq.com>

On 26/11/2013 07:21, Michael Klishin wrote:
> On 26 Nov 2013, at 02:27, mahi e <mahi.rabbitmq at gmail.com> wrote:
> See the comments in
> https://github.com/michaelklishin/rabbit-hole/blob/master/queues.go#L10
>
> Don?t worry about q1-q4 and next_seq_id, they are message store implementation details.

Note that all of backing_queue_status is somewhat unofficial and subject 
to change (in theory, although it hasn't changed since it was 
introduced). But it's a fairly arbitrary set of values.

Cheers, Simon


From lijo at citrusinformatics.com  Tue Nov 26 10:12:17 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Tue, 26 Nov 2013 15:42:17 +0530
Subject: [rabbitmq-discuss] Exchange details are not set while creating
	with Put Method in c#
In-Reply-To: <52946DA8.9080408@rabbitmq.com>
References: <F99B4B8998AC4CDE97CA917FC65D0FEB@Lijo>
	<52946DA8.9080408@rabbitmq.com>
Message-ID: <2F2447B1D873419C9726E209B2DD2671@Lijo>

Simon,
              Yes i do read the response.
    The response says with StatusDescription Created.

Also i can see from management console that which exchanges are present and 
not. So there is no chance of someone came and create any.

Regarding the coding, i may or may not be a non-c# expert, but this is the 
basic format of creating a HttpWebRequest in c#.

I tried without specifying any of the type of exchange, it is still creating 
the same fanout type.


Regards,
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.

-----Original Message----- 
From: Simon MacMullen
Sent: Tuesday, November 26, 2013 3:15 PM
To: Discussions about RabbitMQ
Cc: Lijo Sebastian
Subject: Re: [rabbitmq-discuss] Exchange details are not set while creating 
with Put Method in c#

If you don't specify the exchange type (somehow) then the default is
direct, not fanout. And your code looks right as a non-C# expert. So I
suspect that someone previously declared a fanout exchange with the same
name. The server should be responding with 400 Bad Request and an error
message - are you checking the response?

Cheers, Simon

On 26/11/2013 06:48, Lijo Sebastian wrote:
> Hi,
>         I am trying to create an exchange of type *Topic*.
>          Using PUT method to rabbitmq server, i was able to create one,
> but the type is always *fanout*.
> Below is the code i used.
> Please tell what i am wrong here?
> Code:
> var httpWebRequest =
> (HttpWebRequest)WebRequest.Create("http://guest:guest at rabbitmqserver/endpoint/x/exchangeName");
> httpWebRequest.ContentType = "application/json";
> httpWebRequest.Method = "PUT";
> var data= new Dictionary<string, string>();
> data.Add("type", "topic");
> data.Add("auto_delete", false.ToString().ToLower());
> data.Add("durable", true.ToString().ToLower());
> using (var streamWriter = new
> StreamWriter(httpWebRequest.GetRequestStream()))
> {
>      string json = JsonConvert.SerializeObject(data);
>      streamWriter.Write(json);
>      streamWriter.Flush();
>      streamWriter.Close();
>      var httpResponse = (HttpWebResponse)httpWebRequest.GetResponse();
>      using (var streamReader = new
> StreamReader(httpResponse.GetResponseStream()))
>      {
>          var result = streamReader.ReadToEnd();
>      }
> }
>
> Regards,
> Lijo Sebastian
> Senior Software Engineer
> Citrus Informatics (India) Pvt Ltd.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 


From spicoflorin at gmail.com  Tue Nov 26 10:36:38 2013
From: spicoflorin at gmail.com (Spico Florin)
Date: Tue, 26 Nov 2013 12:36:38 +0200
Subject: [rabbitmq-discuss] Heroku RabbitMQ addon offer supporting MQTT and
	STOMP
Message-ID: <CAOy42Cu3E3w9iy9Kbue0C_Ge+2hRD295vW5F-80ZiOegfz8zmw@mail.gmail.com>

Hello!
I have question regarding the offer that is included in Heroku.
Do you have any knowledge if the provided version is supporting MQTT and
STOMP?
  We have a application that is using this protocols and we would like
to deploy them on Heroku.
  I look forward for hearing from you.
  Thank you.
  Kind regards,
 Florin

From simon at rabbitmq.com  Tue Nov 26 10:37:47 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Nov 2013 10:37:47 +0000
Subject: [rabbitmq-discuss] Exchange details are not set while creating
 with Put Method in c#
In-Reply-To: <2F2447B1D873419C9726E209B2DD2671@Lijo>
References: <F99B4B8998AC4CDE97CA917FC65D0FEB@Lijo>
	<52946DA8.9080408@rabbitmq.com>
	<2F2447B1D873419C9726E209B2DD2671@Lijo>
Message-ID: <529479FB.9010401@rabbitmq.com>

On 26/11/2013 10:12, Lijo Sebastian wrote:
>               Yes i do read the response.
>     The response says with StatusDescription Created.

Hmm. We only reply with 201 Created to POST requests - a successful PUT 
returns a 204 No Content. So I wonder what's going on.

Can you reproduce the problem with curl or similar?

> Regarding the coding, i may or may not be a non-c# expert, but this is
> the basic format of creating a HttpWebRequest in c#.

Sorry, I meant *I* was not a C# expert!

Cheers, Simon


From michael.s.klishin at gmail.com  Tue Nov 26 10:40:16 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 26 Nov 2013 14:40:16 +0400
Subject: [rabbitmq-discuss] Heroku RabbitMQ addon offer supporting MQTT
 and STOMP
In-Reply-To: <CAOy42Cu3E3w9iy9Kbue0C_Ge+2hRD295vW5F-80ZiOegfz8zmw@mail.gmail.com>
References: <CAOy42Cu3E3w9iy9Kbue0C_Ge+2hRD295vW5F-80ZiOegfz8zmw@mail.gmail.com>
Message-ID: <CAE3HoVS3fRLmw5Pz4+p0fjz1UKX436OOMiyCPegP=1w5Oi8W9g@mail.gmail.com>

2013/11/26 Spico Florin <spicoflorin at gmail.com>

> I have question regarding the offer that is included in Heroku.
> Do you have any knowledge if the provided version is supporting MQTT and
> STOMP?
>   We have a application that is using this protocols and we would like
> to deploy them on Heroku.
>

See
http://stackoverflow.com/questions/20197764/rabbitmq-heroku-add-on-mqtt-and-stomp-support
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/37d632a7/attachment.htm>

From simon at rabbitmq.com  Tue Nov 26 11:30:18 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Nov 2013 11:30:18 +0000
Subject: [rabbitmq-discuss] Server move: this list will be inaccessible
	Wednesday morning GMT
Message-ID: <5294864A.9020002@rabbitmq.com>

Hi all. We're migrating all our servers since RabbitMQ's home has moved 
from VMware to Pivotal. Mostly this should be transparent 
(www.rabbitmq.com has already moved, for example), but we'll need some 
downtime of an hour or two to move the mailing list server.

I intend to do that tomorrow morning UK time. Downtime should be an hour 
or so. Mail will probably get queued up in most cases but might bounce 
if you're unlucky. And the web archive at http://lists.rabbitmq.com/ 
will not work.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.laing at nytimes.com  Tue Nov 26 12:32:40 2013
From: michael.laing at nytimes.com (Laing, Michael)
Date: Tue, 26 Nov 2013 07:32:40 -0500
Subject: [rabbitmq-discuss] Pika Client starts consuming before calling
	start_consuming
In-Reply-To: <1385447109.17717.YahooMailNeo@web192503.mail.sg3.yahoo.com>
References: <1385447109.17717.YahooMailNeo@web192503.mail.sg3.yahoo.com>
Message-ID: <CAKgmDnFgnz6bRfm+1=K+NHj39e4BHmW5JsX4FEU-wM6Sc1NO1A@mail.gmail.com>

You say you want a scalable solution. Therefore with pika you should use a
high-performance asynch connector, i.e. tornado in pika 9.13. So start
there and follow the examples of using asynch connections - forget the
blocking connection.

Then you could try this:

To do a simple priority queue I set up 2 queues and bind to both. Usually I
have one queue that gets big bursts of messages and another, the priority
one that only gets a few at a time. In this case I just set prefetch_count
to 1 for both queues and let them interleave. I use acks always.

To give more 'preference' to the priority queue in the above case you can
increase its prefetch_count, increasing the likelihood that a priority
message will be ready when the event loop rolls around.

For even more preference you can 'rate limit' the non-priority queue. I do
this by registering a short timeout after processing each non-priority
message which does the ack in its callback.

There are much more complicated ways to do this. I prefer simple.

Good luck,

Michael

P.S. You can subscribe to a queue that is not currently bound to anything.
Once subscribed, you can bind the queue one or more times and catch each
bind_ok callback to know you are consuming. I'm not sure this is actually
useful in your case.


On Tue, Nov 26, 2013 at 1:25 AM, vadlamani maitreya <
maitreya_vvm at yahoo.co.in> wrote:

> Hello Everyone,
>
> I have a small problem with RMQ and pika client and would like to ask guyz
> here for some help. The situation is as below,
>
> I am using RabbitMQ with the pika clients in a scalable solution. The
> solution requires messaging with two priorities. So every worker (through
> pika client) gets messages from the HighPriority Queue first and then goes
> to the Low Priority queue if there are no messages left in the HP Queue. I
> decide to scale the number of workers according to the number of ready
> messages and the number of consumers attached to the queue. So the
> following is the workflow i follow to achieve the above.
>
> 1) Register using  basic_consume on the queue.
> 2) Do basic_get from HP Queue
> 3)If no messages in HP Queue do a basic_get from LP Queue.
>
> I donot execute start_consuming() so the basic_consume is just for the
> number of consumers count in the RMQ server.
>
> This logic works perfectly fine with the standard Java Client. But when i
> try to do the same with the Pika Client, the moment the basic_consume is
> called the data events are processed and the callback function is executed
> on the incoming message, eventhough the start_consuming() function is not
> called.
>
> So, a couple of questions here,
>
> 1. Is there a way to register as a consumer to a queue without actually
> starting to consume from the queue (even a hack into the code is fine)
> 2. Is it bug that basic_consume() starts consuming without actually
> calling start_consuming() (the actual blocking function), and should i
> raise an issue in github regarding this ?
>
> Last but not the least, the version of the rabbitMQ server is 3.1.2 and
> the pika client, i have tried both 0.9.6 and 0.9.13 with the above scenario.
>
> Thankyou everyone,
> Maitreya
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/baf1318e/attachment.htm>

From lijo at citrusinformatics.com  Tue Nov 26 11:58:26 2013
From: lijo at citrusinformatics.com (Lijo Sebastian)
Date: Tue, 26 Nov 2013 17:28:26 +0530
Subject: [rabbitmq-discuss] Exchange details are not set while creating
	with Put Method in c#
In-Reply-To: <529479FB.9010401@rabbitmq.com>
References: <F99B4B8998AC4CDE97CA917FC65D0FEB@Lijo>
	<52946DA8.9080408@rabbitmq.com>
	<2F2447B1D873419C9726E209B2DD2671@Lijo>
	<529479FB.9010401@rabbitmq.com>
Message-ID: <749F830C47024045A88152D3B1FAF7DB@Lijo>

Simon,

I tried with the curl  (RabbitHub Way)

:
curl -v -X PUT -H "content-type:application/json" -d '{"type":"direct", 
"durable":true}' http://guest:guest at servername:15670/endpoint/x/foo1231

and Got the same result: Created but of fanout type.

curl: (3) [globbing] unmatched close brace/bracket at pos 13
* timeout on name lookup is not supported
* About to connect() to servername port 15670 (#0)
*   Trying 192.168.1.74...
* connected
* Connected to servername  (192.168.1.74) port 15670 (#0)
* Server auth using Basic with user 'guest'
> PUT /endpoint/x/foo1231 HTTP/1.1
> Authorization: Basic Z3Vlc3Q6Z3Vlc3Q=
> User-Agent: curl/7.26.0
> Host: servername:15670
> Accept: */*
> content-type:application/json
> Content-Length: 14
>
* upload completely sent off: 14 out of 14 bytes
< HTTP/1.1 201 Created
< Server: MochiWeb/1.0 (Any of you quaids got a smint?)
< Location: http://servername:15670/endpoint/x/foo1231
< Date: Tue, 26 Nov 2013 11:48:41 GMT
< Content-Length: 0
<
* Connection #0 to host rabbitmq.citrus.com left intact
* Closing connection #0


When Tried RabbitMQ API Way :

curl -i -u guest:guest -H "content-type:application/json"  -X PUT -d 
'{"type":"direct","durable":true}' 
http://serverName:15672/api/exchanges/%2f/my-new-exchange

Result :
HTTP/1.1 400 Bad Request
Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)
Date: Tue, 26 Nov 2013 11:56:28 GMT
Content-Type: application/json
Content-Length: 43

{"error":"bad_request","reason":"not_json"}



Regards,
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.
-----Original Message----- 
From: Simon MacMullen
Sent: Tuesday, November 26, 2013 4:07 PM
To: Lijo Sebastian
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Exchange details are not set while creating
with Put Method in c#

On 26/11/2013 10:12, Lijo Sebastian wrote:
>               Yes i do read the response.
>     The response says with StatusDescription Created.

Hmm. We only reply with 201 Created to POST requests - a successful PUT
returns a 204 No Content. So I wonder what's going on.

Can you reproduce the problem with curl or similar?

> Regarding the coding, i may or may not be a non-c# expert, but this is
> the basic format of creating a HttpWebRequest in c#.

Sorry, I meant *I* was not a C# expert!

Cheers, Simon 


From Shashank.Lothe at techmahindra.com  Tue Nov 26 13:12:26 2013
From: Shashank.Lothe at techmahindra.com (Lothe Shashank)
Date: Tue, 26 Nov 2013 13:12:26 +0000
Subject: [rabbitmq-discuss] Queries regarding rabbitmq-C APIs
Message-ID: <DD7729D61B083D48A2CDCB66A27AD4C98CBE24@BSDMSATMBX001.mahindrasatyam.ad>

I am using Ubuntu 12.04.3 LTS version. Please let me know if you need any more information.

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/82eecf23/attachment.htm>

From Shashank.Lothe at techmahindra.com  Tue Nov 26 13:37:26 2013
From: Shashank.Lothe at techmahindra.com (Lothe Shashank)
Date: Tue, 26 Nov 2013 13:37:26 +0000
Subject: [rabbitmq-discuss] [Rabbitmq-c] Alias for hostname
Message-ID: <DD7729D61B083D48A2CDCB66A27AD4C98CBE2E@BSDMSATMBX001.mahindrasatyam.ad>

Hi Alan,

Let me try to explain you the problem I are facing. I am having Rabbitmq server/broker having a hostname hus0006 defined in /etc/hostname. I am using DNS server to resolve my Rabbitmq server hostname. I have added an alias for hus0006 called gs001. The ssl certificates present under /etc/rabbitmq/ssl also carries the alias gs001. Now I run my listner program to connect to this broker. amqp_socket_open API fails with a return code of 1 (which is surprising as it is not a listed error code in amqp_status_enum under amqp.h). This problem comes only when I try to connect using SSL. If I try to connect without ssl (on ssl disabled port with the same hostname) it connects.

What could be the problem?

regards,
Shashank

________________________________

DISCLAIMER:
This email (including any attachments) is intended for the sole use of the intended recipient/s and may contain material that is CONFIDENTIAL AND PRIVATE COMPANY INFORMATION. Any review or reliance by others or copying or distribution or forwarding of any or all of the contents in this message is STRICTLY PROHIBITED. If you are not the intended recipient, please contact the sender by email and delete all copies; your cooperation in this regard is appreciated.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/082694ae/attachment.htm>

From michael.s.klishin at gmail.com  Tue Nov 26 13:44:06 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Tue, 26 Nov 2013 17:44:06 +0400
Subject: [rabbitmq-discuss] [Rabbitmq-c] Alias for hostname
In-Reply-To: <DD7729D61B083D48A2CDCB66A27AD4C98CBE2E@BSDMSATMBX001.mahindrasatyam.ad>
References: <DD7729D61B083D48A2CDCB66A27AD4C98CBE2E@BSDMSATMBX001.mahindrasatyam.ad>
Message-ID: <CAE3HoVSeKxyQFg4L25WG7bGVxLwz963ZWO7=6BE4nPGGV+TWzA@mail.gmail.com>

2013/11/26 Lothe Shashank <Shashank.Lothe at techmahindra.com>

> What could be the problem?


Hostname in the certificate and hostname as it resolves locally (likely
using gethostname(2) [1]) must be the same.

Run `hostname` w/o arguments to see what gethostname(2) returns.

1. http://linux.die.net/man/2/gethostname
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/2f8e1eed/attachment.htm>

From Tobias.Gutzmann at ist.com  Tue Nov 26 13:37:01 2013
From: Tobias.Gutzmann at ist.com (Tobias Gutzmann)
Date: Tue, 26 Nov 2013 13:37:01 +0000
Subject: [rabbitmq-discuss] Exchange details are not set while
	creating	with Put Method in c#
In-Reply-To: <749F830C47024045A88152D3B1FAF7DB@Lijo>
References: <F99B4B8998AC4CDE97CA917FC65D0FEB@Lijo>
	<52946DA8.9080408@rabbitmq.com>	<2F2447B1D873419C9726E209B2DD2671@Lijo>
	<529479FB.9010401@rabbitmq.com> <749F830C47024045A88152D3B1FAF7DB@Lijo>
Message-ID: <3CE1D10F927704449D41EF6BCB35373D47D7D7@hermes>

Hi,

You're probably using Windows? If so, you must encode the command line arguments to curl differently to get rid of the "400 Bad Request" error message, see https://www.rabbitmq.com/ha.html (far down on the page) and http://rabbitmq.1065348.n5.nabble.com/Http-API-new-user-td29013.html#message29088

Regards,
Tobias

-----Ursprungligt meddelande-----
Fr?n: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] F?r Lijo Sebastian
Skickat: den 26 november 2013 12:58
Till: Simon MacMullen
Kopia: Discussions about RabbitMQ
?mne: Re: [rabbitmq-discuss] Exchange details are not set while creating with Put Method in c#

Simon,

I tried with the curl  (RabbitHub Way)

:
curl -v -X PUT -H "content-type:application/json" -d '{"type":"direct", "durable":true}' http://guest:guest at servername:15670/endpoint/x/foo1231

and Got the same result: Created but of fanout type.

curl: (3) [globbing] unmatched close brace/bracket at pos 13
* timeout on name lookup is not supported
* About to connect() to servername port 15670 (#0)
*   Trying 192.168.1.74...
* connected
* Connected to servername  (192.168.1.74) port 15670 (#0)
* Server auth using Basic with user 'guest'
> PUT /endpoint/x/foo1231 HTTP/1.1
> Authorization: Basic Z3Vlc3Q6Z3Vlc3Q=
> User-Agent: curl/7.26.0
> Host: servername:15670
> Accept: */*
> content-type:application/json
> Content-Length: 14
>
* upload completely sent off: 14 out of 14 bytes < HTTP/1.1 201 Created < Server: MochiWeb/1.0 (Any of you quaids got a smint?) < Location: http://servername:15670/endpoint/x/foo1231
< Date: Tue, 26 Nov 2013 11:48:41 GMT
< Content-Length: 0
<
* Connection #0 to host rabbitmq.citrus.com left intact
* Closing connection #0


When Tried RabbitMQ API Way :

curl -i -u guest:guest -H "content-type:application/json"  -X PUT -d '{"type":"direct","durable":true}' 
http://serverName:15672/api/exchanges/%2f/my-new-exchange

Result :
HTTP/1.1 400 Bad Request
Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)
Date: Tue, 26 Nov 2013 11:56:28 GMT
Content-Type: application/json
Content-Length: 43

{"error":"bad_request","reason":"not_json"}



Regards,
Lijo Sebastian
Senior Software Engineer
Citrus Informatics (India) Pvt Ltd.
-----Original Message-----
From: Simon MacMullen
Sent: Tuesday, November 26, 2013 4:07 PM
To: Lijo Sebastian
Cc: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Exchange details are not set while creating with Put Method in c#

On 26/11/2013 10:12, Lijo Sebastian wrote:
>               Yes i do read the response.
>     The response says with StatusDescription Created.

Hmm. We only reply with 201 Created to POST requests - a successful PUT returns a 204 No Content. So I wonder what's going on.

Can you reproduce the problem with curl or similar?

> Regarding the coding, i may or may not be a non-c# expert, but this is 
> the basic format of creating a HttpWebRequest in c#.

Sorry, I meant *I* was not a C# expert!

Cheers, Simon 

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From simon at rabbitmq.com  Tue Nov 26 14:57:26 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Nov 2013 14:57:26 +0000
Subject: [rabbitmq-discuss] Exchange details are not set while creating
 with Put Method in c#
In-Reply-To: <3CE1D10F927704449D41EF6BCB35373D47D7D7@hermes>
References: <F99B4B8998AC4CDE97CA917FC65D0FEB@Lijo>
	<52946DA8.9080408@rabbitmq.com>	<2F2447B1D873419C9726E209B2DD2671@Lijo>
	<529479FB.9010401@rabbitmq.com>
	<749F830C47024045A88152D3B1FAF7DB@Lijo>
	<3CE1D10F927704449D41EF6BCB35373D47D7D7@hermes>
Message-ID: <5294B6D6.7070605@rabbitmq.com>

On 26/11/13 13:37, Tobias Gutzmann wrote:

> You're probably using Windows? If so, you must encode the command
> line arguments to curl differently to get rid of the "400 Bad
> Request" error message, see https://www.rabbitmq.com/ha.html (far
> down on the page) and
> http://rabbitmq.1065348.n5.nabble.com/Http-API-new-user-td29013.html#message29088

Oh, good spot!

Note that we now document the Windows convention in the HTTP API 
documentation too:

http://hg.rabbitmq.com/rabbitmq-management/raw-file/rabbitmq_v3_2_1/priv/www/api/index.html

Cheers, Simon

>  Regards, Tobias
>
> -----Ursprungligt meddelande----- Fr?n:
> rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] F?r Lijo
> Sebastian Skickat: den 26 november 2013 12:58 Till: Simon MacMullen
> Kopia: Discussions about RabbitMQ ?mne: Re: [rabbitmq-discuss]
> Exchange details are not set while creating with Put Method in c#
>
> Simon,
>
> I tried with the curl  (RabbitHub Way)
>
> : curl -v -X PUT -H "content-type:application/json" -d
> '{"type":"direct", "durable":true}'
> http://guest:guest at servername:15670/endpoint/x/foo1231
>
> and Got the same result: Created but of fanout type.
>
> curl: (3) [globbing] unmatched close brace/bracket at pos 13 *
> timeout on name lookup is not supported * About to connect() to
> servername port 15670 (#0) *   Trying 192.168.1.74... * connected *
> Connected to servername  (192.168.1.74) port 15670 (#0) * Server auth
> using Basic with user 'guest'
>> PUT /endpoint/x/foo1231 HTTP/1.1 Authorization: Basic
>> Z3Vlc3Q6Z3Vlc3Q= User-Agent: curl/7.26.0 Host: servername:15670
>> Accept: */* content-type:application/json Content-Length: 14
>>
> * upload completely sent off: 14 out of 14 bytes < HTTP/1.1 201
> Created < Server: MochiWeb/1.0 (Any of you quaids got a smint?) <
> Location: http://servername:15670/endpoint/x/foo1231 < Date: Tue, 26
> Nov 2013 11:48:41 GMT < Content-Length: 0 < * Connection #0 to host
> rabbitmq.citrus.com left intact * Closing connection #0
>
>
> When Tried RabbitMQ API Way :
>
> curl -i -u guest:guest -H "content-type:application/json"  -X PUT -d
> '{"type":"direct","durable":true}'
> http://serverName:15672/api/exchanges/%2f/my-new-exchange
>
> Result : HTTP/1.1 400 Bad Request Server: MochiWeb/1.1
> WebMachine/1.10.0 (never breaks eye contact) Date: Tue, 26 Nov 2013
> 11:56:28 GMT Content-Type: application/json Content-Length: 43
>
> {"error":"bad_request","reason":"not_json"}
>
>
>
> Regards, Lijo Sebastian Senior Software Engineer Citrus Informatics
> (India) Pvt Ltd. -----Original Message----- From: Simon MacMullen
> Sent: Tuesday, November 26, 2013 4:07 PM To: Lijo Sebastian Cc:
> Discussions about RabbitMQ Subject: Re: [rabbitmq-discuss] Exchange
> details are not set while creating with Put Method in c#
>
> On 26/11/2013 10:12, Lijo Sebastian wrote:
>> Yes i do read the response. The response says with
>> StatusDescription Created.
>
> Hmm. We only reply with 201 Created to POST requests - a successful
> PUT returns a 204 No Content. So I wonder what's going on.
>
> Can you reproduce the problem with curl or similar?
>
>> Regarding the coding, i may or may not be a non-c# expert, but this
>> is the basic format of creating a HttpWebRequest in c#.
>
> Sorry, I meant *I* was not a C# expert!
>
> Cheers, Simon
>
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________ rabbitmq-discuss
> mailing list rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Tue Nov 26 14:58:41 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Tue, 26 Nov 2013 14:58:41 +0000
Subject: [rabbitmq-discuss] Exchange details are not set while creating
 with Put Method in c#
In-Reply-To: <749F830C47024045A88152D3B1FAF7DB@Lijo>
References: <F99B4B8998AC4CDE97CA917FC65D0FEB@Lijo>
	<52946DA8.9080408@rabbitmq.com>
	<2F2447B1D873419C9726E209B2DD2671@Lijo>
	<529479FB.9010401@rabbitmq.com>
	<749F830C47024045A88152D3B1FAF7DB@Lijo>
Message-ID: <5294B721.5010906@rabbitmq.com>

On 26/11/13 11:58, Lijo Sebastian wrote:
> I tried with the curl  (RabbitHub Way)

Ah, you were talking about RabbitHub? I don't know what that does; it 
may default to fanout. I thought we were talking about the management 
HTTP API - see Tobias' mail for how to get that working.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From graeme at sudo.ca  Tue Nov 26 21:13:48 2013
From: graeme at sudo.ca (Graeme N)
Date: Tue, 26 Nov 2013 13:13:48 -0800
Subject: [rabbitmq-discuss] Feature Req / Bug list
In-Reply-To: <52938B59.8060004@rabbitmq.com>
References: <CAJ4uuZZnWrC9tp9V+D021AvPDHDKzfXGChvG+OPgD8E8W-tYMw@mail.gmail.com>
	<CAJ4uuZb+bgZGRubJ9pAXH2ZMwyxagJ5mTnk3T8xhhEWm_W_L9w@mail.gmail.com>
	<AEADD6B5-832E-4BB0-9312-47EA927F9F0B@rabbitmq.com>
	<CAJ4uuZYpt5-7bd0SnsqNQCb+W0WAcj5WrH9OxWn6-VfGQoLK8w@mail.gmail.com>
	<92E1A6B8-E4D1-47C5-A108-9E254EC2EF9D@rabbitmq.com>
	<CAJ4uuZYNy3kyCtm1sWbRdaprWkOQ4O8KMhBNFwxafg6zbMSX3g@mail.gmail.com>
	<F573E81A-8BD2-4F9A-8643-ABB67E97773E@rabbitmq.com>
	<CAJ4uuZYUqGeBRVEbacpGPeyHxFP2S9F7PND8KPQakjMg9Whgrg@mail.gmail.com>
	<526ECAD9.2030703@rabbitmq.com>
	<CAJ4uuZYmom2AjYrsYOVxDNfkuK4VVhqoEyFqG5c7f+th-Xdx5w@mail.gmail.com>
	<526ED167.1010308@rabbitmq.com>
	<CAJ4uuZb1kd8dQ1c3=o-mzHvYzUNrHcwUxFU8VvEOurUG7EFtfQ@mail.gmail.com>
	<CAJ4uuZbc13rs9SCmU64K9ant630Z+1j1x-Ss2MRBh7fQnnEXdA@mail.gmail.com>
	<5277A9A3.3060708@rabbitmq.com>
	<CAJ4uuZbAMR3LB4-sG517sLwb=bxzHNir4yx-9zr_+OnrorQ9qw@mail.gmail.com>
	<CAJ4uuZY0agfwfjChtes3LHsTmADhs2ZnTUR557=ir5-Lbk20sg@mail.gmail.com>
	<52938B59.8060004@rabbitmq.com>
Message-ID: <CAJ4uuZYzuwgdw7++XOtGJWe5Sgoc7k-Ae9daH683OyLhxskvvA@mail.gmail.com>

On Mon, Nov 25, 2013 at 9:39 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> Graeme: we recently merged a few fixes to bugs that we found as a result
> of running your test scripts; these can be picked up in the latest
> nightlies. I am now able to run rebalance_cluster.sh and toggle_nodes.sh
> indefinitely without anything breaking.
>

> Thanks for producing these scripts!
>

No problem!

However, when I retested with the latest nightly build (3.2.1.41125-1), I
ran into issues. I used my scripts to setup a 5 node local cluster, made
100 queues, and populated them with 1000 1MB messages each. Then ran the
rebalance script, and every node promptly crashed once it started applying
the balancing policies. When I brought them back up, the cluster thrashed
the disks for a bit applying the policies, but when it finished, only
53,949 / 100,000 messages were actually present.

I suspected this was because I wasn't using confirmed message delivery in
my Go queue populator, so I changed it to do message confirmations and
re-tried. This didn't result in a crash and all the policies get created,
but none of them auto apply, even though they're all set to "automatic".
The cluster just sits there, and never actually applies any of the polices
or distributes any data, even if I run through every queue and run
sync_queue.

So it appears there's still bugs with actually applying policies and
syncing data, as I actually can't get any policies to properly replicate
without using unconfirmed messages and crashing the cluster. I've uploaded
the current version of the scripts I'm using to Mega:

https://mega.co.nz/#!jsBH2JSR!fP1zVwsi1ScQrnwzNOBlH05HJN0z9IofYRzy4WvjBjU

The steps I used to create the situation where there are policies that
refuse to apply or sync should be easy to replicate by doing the following:

./create_cluster.sh
./setup_queues.sh
./populate_queues.sh
./rebalance_cluster.sh

Graeme
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/5284f0a8/attachment.htm>

From graeme at sudo.ca  Tue Nov 26 21:28:17 2013
From: graeme at sudo.ca (Graeme N)
Date: Tue, 26 Nov 2013 13:28:17 -0800
Subject: [rabbitmq-discuss] Feature Req / Bug list
In-Reply-To: <CAJ4uuZYzuwgdw7++XOtGJWe5Sgoc7k-Ae9daH683OyLhxskvvA@mail.gmail.com>
References: <CAJ4uuZZnWrC9tp9V+D021AvPDHDKzfXGChvG+OPgD8E8W-tYMw@mail.gmail.com>
	<CAJ4uuZb+bgZGRubJ9pAXH2ZMwyxagJ5mTnk3T8xhhEWm_W_L9w@mail.gmail.com>
	<AEADD6B5-832E-4BB0-9312-47EA927F9F0B@rabbitmq.com>
	<CAJ4uuZYpt5-7bd0SnsqNQCb+W0WAcj5WrH9OxWn6-VfGQoLK8w@mail.gmail.com>
	<92E1A6B8-E4D1-47C5-A108-9E254EC2EF9D@rabbitmq.com>
	<CAJ4uuZYNy3kyCtm1sWbRdaprWkOQ4O8KMhBNFwxafg6zbMSX3g@mail.gmail.com>
	<F573E81A-8BD2-4F9A-8643-ABB67E97773E@rabbitmq.com>
	<CAJ4uuZYUqGeBRVEbacpGPeyHxFP2S9F7PND8KPQakjMg9Whgrg@mail.gmail.com>
	<526ECAD9.2030703@rabbitmq.com>
	<CAJ4uuZYmom2AjYrsYOVxDNfkuK4VVhqoEyFqG5c7f+th-Xdx5w@mail.gmail.com>
	<526ED167.1010308@rabbitmq.com>
	<CAJ4uuZb1kd8dQ1c3=o-mzHvYzUNrHcwUxFU8VvEOurUG7EFtfQ@mail.gmail.com>
	<CAJ4uuZbc13rs9SCmU64K9ant630Z+1j1x-Ss2MRBh7fQnnEXdA@mail.gmail.com>
	<5277A9A3.3060708@rabbitmq.com>
	<CAJ4uuZbAMR3LB4-sG517sLwb=bxzHNir4yx-9zr_+OnrorQ9qw@mail.gmail.com>
	<CAJ4uuZY0agfwfjChtes3LHsTmADhs2ZnTUR557=ir5-Lbk20sg@mail.gmail.com>
	<52938B59.8060004@rabbitmq.com>
	<CAJ4uuZYzuwgdw7++XOtGJWe5Sgoc7k-Ae9daH683OyLhxskvvA@mail.gmail.com>
Message-ID: <CAJ4uuZYfrLmTxegc1exoH7UXiba6teO1gOgToGz9poDz5fmPhw@mail.gmail.com>

Ahhh, disregard that. Hit send, then discovered someone had modified the
scripts on my test box to generate rebalancing commands for our prod
cluster, so there's no wonder it wasn't rebalancing on these test
instances. *sigh*

Fixed my rebalance script to correctly inject the right rabbit instance
names, and the queues seem to be balancing correctly. The web interface
does still seem to stall when the cluster is busy doing other things, but
it's not crashing or breaking the admin API. I'll test the host toggling
stuff shortly as well and let you know if I see any issues, but this is
definitely looking better.

Thanks so much!
Graeme

On Tue, Nov 26, 2013 at 1:13 PM, Graeme N <graeme at sudo.ca> wrote:

>
> On Mon, Nov 25, 2013 at 9:39 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>
>> Graeme: we recently merged a few fixes to bugs that we found as a result
>> of running your test scripts; these can be picked up in the latest
>> nightlies. I am now able to run rebalance_cluster.sh and toggle_nodes.sh
>> indefinitely without anything breaking.
>>
>
>> Thanks for producing these scripts!
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/2e4ce970/attachment.htm>

From alfonso.alvz at gmail.com  Tue Nov 26 19:35:57 2013
From: alfonso.alvz at gmail.com (Alfonso Alvz)
Date: Tue, 26 Nov 2013 11:35:57 -0800 (PST)
Subject: [rabbitmq-discuss] How to assure response even if rpc server goes
	down.
Message-ID: <e94d1a6d-bf4d-4b36-993d-24422af7e8e1@googlegroups.com>

I was wondering if there's is a way to *make the messages persistent in 
case the server fails?.* If the client sends a message with no server 
running, it stays there awaiting for the response and it doesn't get 
anything once the server goes up again.. 

Having a configuration like this: 
If the server disappears, *is there a way to resume the process whenever 
the server is up again?* A retry of the client or that the server gets the 
client request once is up again...  How could I do this? (the 
"durable=True" parameter doesn't accomplish this...)

<http://www.rabbitmq.com/img/tutorials/python-six.png>

The complete example is in this rpc tutorial<http://www.rabbitmq.com/tutorials/tutorial-six-python.html>
:


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/d8ca576a/attachment.htm>

From mklishin at gopivotal.com  Tue Nov 26 22:14:06 2013
From: mklishin at gopivotal.com (Michael Klishin)
Date: Wed, 27 Nov 2013 02:14:06 +0400
Subject: [rabbitmq-discuss] How to assure response even if rpc server
	goes down.
In-Reply-To: <e94d1a6d-bf4d-4b36-993d-24422af7e8e1@googlegroups.com>
References: <e94d1a6d-bf4d-4b36-993d-24422af7e8e1@googlegroups.com>
Message-ID: <D1CCD8B6-82A7-48C1-951B-FCAEE9F38487@rabbitmq.com>


On 26 Nov 2013, at 23:35, Alfonso Alvz <alfonso.alvz at gmail.com> wrote:

> I was wondering if there's is a way to make the messages persistent in case the server fails?. If the client sends a message with no server running, it stays there awaiting for the response and it doesn't get anything once the server goes up again.. 

Accumulate messages in the client and re-publish them when a new connection is up. Note that to really
make this work you?ll need to have a WAL (write-ahead log) of messages on disk to significantly reduce
message loss probability when your publisher crashes, runs out of memory, etc.

> 
> Having a configuration like this: 
> If the server disappears, is there a way to resume the process whenever the server is up again?

Some clients support automatic recovery but currently don?t provide WAL?s. 3rd party projects built on top
of clients (e.g. Hutch, Celery or EasyNetQ) may choose to provide WAL and more advanced features
but it is currently out of scope for the protocol clients.

Message durability controls whether the message will be stored on disk by RabbitMQ. It has no effect
on what happens when you publish messages on a closed connection.


MK

Software Engineer, Pivotal/RabbitMQ



From videlalvaro at gmail.com  Tue Nov 26 22:18:45 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Tue, 26 Nov 2013 23:18:45 +0100
Subject: [rabbitmq-discuss] How to assure response even if rpc server
	goes down.
In-Reply-To: <D1CCD8B6-82A7-48C1-951B-FCAEE9F38487@rabbitmq.com>
References: <e94d1a6d-bf4d-4b36-993d-24422af7e8e1@googlegroups.com>
	<D1CCD8B6-82A7-48C1-951B-FCAEE9F38487@rabbitmq.com>
Message-ID: <CAMcAHLWDXRB8Y46N9MOfnyMi_isQUMhqNDRcTkSgBcSUWfzz0A@mail.gmail.com>

Also I think it might be worth mentioning the "Publisher Confirms"
feature of RabbitMQ: http://www.rabbitmq.com/confirms.html in case you
need to be sure a message was taking care by the server.

-Alvaro

On Tue, Nov 26, 2013 at 11:14 PM, Michael Klishin
<mklishin at gopivotal.com> wrote:
>
> On 26 Nov 2013, at 23:35, Alfonso Alvz <alfonso.alvz at gmail.com> wrote:
>
>> I was wondering if there's is a way to make the messages persistent in case the server fails?. If the client sends a message with no server running, it stays there awaiting for the response and it doesn't get anything once the server goes up again..
>
> Accumulate messages in the client and re-publish them when a new connection is up. Note that to really
> make this work you?ll need to have a WAL (write-ahead log) of messages on disk to significantly reduce
> message loss probability when your publisher crashes, runs out of memory, etc.
>
>>
>> Having a configuration like this:
>> If the server disappears, is there a way to resume the process whenever the server is up again?
>
> Some clients support automatic recovery but currently don?t provide WAL?s. 3rd party projects built on top
> of clients (e.g. Hutch, Celery or EasyNetQ) may choose to provide WAL and more advanced features
> but it is currently out of scope for the protocol clients.
>
> Message durability controls whether the message will be stored on disk by RabbitMQ. It has no effect
> on what happens when you publish messages on a closed connection.
>
>
> MK
>
> Software Engineer, Pivotal/RabbitMQ
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From graeme at sudo.ca  Tue Nov 26 22:23:31 2013
From: graeme at sudo.ca (Graeme N)
Date: Tue, 26 Nov 2013 14:23:31 -0800
Subject: [rabbitmq-discuss] Feature Req / Bug list
In-Reply-To: <CAJ4uuZYfrLmTxegc1exoH7UXiba6teO1gOgToGz9poDz5fmPhw@mail.gmail.com>
References: <CAJ4uuZZnWrC9tp9V+D021AvPDHDKzfXGChvG+OPgD8E8W-tYMw@mail.gmail.com>
	<CAJ4uuZb+bgZGRubJ9pAXH2ZMwyxagJ5mTnk3T8xhhEWm_W_L9w@mail.gmail.com>
	<AEADD6B5-832E-4BB0-9312-47EA927F9F0B@rabbitmq.com>
	<CAJ4uuZYpt5-7bd0SnsqNQCb+W0WAcj5WrH9OxWn6-VfGQoLK8w@mail.gmail.com>
	<92E1A6B8-E4D1-47C5-A108-9E254EC2EF9D@rabbitmq.com>
	<CAJ4uuZYNy3kyCtm1sWbRdaprWkOQ4O8KMhBNFwxafg6zbMSX3g@mail.gmail.com>
	<F573E81A-8BD2-4F9A-8643-ABB67E97773E@rabbitmq.com>
	<CAJ4uuZYUqGeBRVEbacpGPeyHxFP2S9F7PND8KPQakjMg9Whgrg@mail.gmail.com>
	<526ECAD9.2030703@rabbitmq.com>
	<CAJ4uuZYmom2AjYrsYOVxDNfkuK4VVhqoEyFqG5c7f+th-Xdx5w@mail.gmail.com>
	<526ED167.1010308@rabbitmq.com>
	<CAJ4uuZb1kd8dQ1c3=o-mzHvYzUNrHcwUxFU8VvEOurUG7EFtfQ@mail.gmail.com>
	<CAJ4uuZbc13rs9SCmU64K9ant630Z+1j1x-Ss2MRBh7fQnnEXdA@mail.gmail.com>
	<5277A9A3.3060708@rabbitmq.com>
	<CAJ4uuZbAMR3LB4-sG517sLwb=bxzHNir4yx-9zr_+OnrorQ9qw@mail.gmail.com>
	<CAJ4uuZY0agfwfjChtes3LHsTmADhs2ZnTUR557=ir5-Lbk20sg@mail.gmail.com>
	<52938B59.8060004@rabbitmq.com>
	<CAJ4uuZYzuwgdw7++XOtGJWe5Sgoc7k-Ae9daH683OyLhxskvvA@mail.gmail.com>
	<CAJ4uuZYfrLmTxegc1exoH7UXiba6teO1gOgToGz9poDz5fmPhw@mail.gmail.com>
Message-ID: <CAJ4uuZbYqXov-uPYT2evAq8rcCZhRX5wYM7Fmb6OSCMgcyMDoQ@mail.gmail.com>

Hmmm... So, about 1/4 of the queues were approaching being balanced, and
then all of the hosts dropped out of the test cluster.

Looking at the system, only the second instance is even listening on any
network ports, but the beam.smp processes for all instances are still
running:

# netstat -tlpn | grep beam
tcp        0      0 0.0.0.0:44442               0.0.0.0:*
LISTEN      20303/beam.smp
tcp        0      0 0.0.0.0:16639               0.0.0.0:*
LISTEN      20303/beam.smp
tcp        0      0 :::5672                     :::*
LISTEN      20303/beam.smp

# ps axf
12449 ?        S      0:08 /usr/lib64/erlang/erts-5.8.5/bin/epmd -daemon
20183 ?        Sl    13:50 /usr/lib64/erlang/erts-5.8.5/bin/beam.smp -W w
-K true -A30 -P 1048576 -- -root /usr/lib64/erlang -progname erl -- -home
/var/lib/rabbitmq -- -p
20303 ?        Sl    21:31 /usr/lib64/erlang/erts-5.8.5/bin/beam.smp -W w
-K true -A30 -P 1048576 -- -root /usr/lib64/erlang -progname erl -- -home
/var/lib/rabbitmq -- -p
20739 ?        Ss     0:04  \_ inet_gethost 4
20740 ?        S      0:04      \_ inet_gethost 4
20423 ?        Sl    11:24 /usr/lib64/erlang/erts-5.8.5/bin/beam.smp -W w
-K true -A30 -P 1048576 -- -root /usr/lib64/erlang -progname erl -- -home
/var/lib/rabbitmq -- -p
20543 ?        Sl    11:41 /usr/lib64/erlang/erts-5.8.5/bin/beam.smp -W w
-K true -A30 -P 1048576 -- -root /usr/lib64/erlang -progname erl -- -home
/var/lib/rabbitmq -- -p
20663 ?        Sl    10:18 /usr/lib64/erlang/erts-5.8.5/bin/beam.smp -W w
-K true -A30 -P 1048576 -- -root /usr/lib64/erlang -progname erl -- -home
/var/lib/rabbitmq -- -p

I killed them all and started them back up again, the spent a long time
rescanning all their queues, and when the main node (which the queues were
created on) re-entered the cluster, they all crashed again. I blew away the
test cluster, and re-ran the following steps, and had the main node where
all the queues were created and the data loaded stop listening on all its
ports and disconnect from the rest of the cluster. Killing it and
restarting it caused it to reread all its queues, and then drop all its
network listeners and connections to the cluster again.

./create_cluster.sh && ./setup_queues.sh && ./populate_queues.sh
./rebalance_cluster.sh

Looking at the logs for instances which drop their network connections
shows some pretty big erlang stack dumps, so I've compressed and uploaded a
sample log file here for you:
https://mega.co.nz/#!31JCGSxa!LdxuhXeX_HN_px8lnQcp63RkFcRY_dW9Z_x9C7qv2aE

Here's my latest set of scripts for reproduction at your end:
https://mega.co.nz/#!Th5UCBZS!eQe9_SmOS5qdv0tP8nUZmnjj7h1QhtOG1i4GrtoYeMU

Graeme

On Tue, Nov 26, 2013 at 1:28 PM, Graeme N <graeme at sudo.ca> wrote:

> On Tue, Nov 26, 2013 at 1:13 PM, Graeme N <graeme at sudo.ca> wrote:
>
>>
>> On Mon, Nov 25, 2013 at 9:39 AM, Simon MacMullen <simon at rabbitmq.com>wrote:
>>
>>> Graeme: we recently merged a few fixes to bugs that we found as a result
>>> of running your test scripts; these can be picked up in the latest
>>> nightlies. I am now able to run rebalance_cluster.sh and toggle_nodes.sh
>>> indefinitely without anything breaking.
>>>
>>
>>> Thanks for producing these scripts!
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131126/e2ccbe88/attachment.htm>

From yby538 at 163.com  Wed Nov 27 01:03:33 2013
From: yby538 at 163.com (yby538 at 163.com)
Date: Wed, 27 Nov 2013 09:03:33 +0800
Subject: [rabbitmq-discuss] a question about pushing the message to the
	queue , thank you all a lot
Message-ID: <201311270903336591073@163.com>


hi,all

I have a sender and i have a receiver. Sender pushes the messages,  apple ,orange ,banana to queue which is named "fruit"

 once the receiver gets the message "banana" and send the ack.  i want the sender to be noticed so it can  send the message "banana" to the queue
  
 you know, i mean, i want to ensure that the queue does always contains banana ,apple and orange and if one message was got by the receiver ,the sender will push it to the queue
 
 how to implement it, please?

Does it make sense? i am very sorry since my English is very poor

 thanks a lot




?????????????????????
?????????????????
?????????????????????
?????????????????
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/f5355b10/attachment.htm>

From videlalvaro at gmail.com  Wed Nov 27 06:50:58 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 27 Nov 2013 07:50:58 +0100
Subject: [rabbitmq-discuss] a question about pushing the message to the
 queue , thank you all a lot
In-Reply-To: <201311270903336591073@163.com>
References: <201311270903336591073@163.com>
Message-ID: <CAMcAHLWtZvPZhgx5G4_7VsDLSE7mf0GQ6tn6srf8Gt1vD1U1pQ@mail.gmail.com>

Hi,

I think the easiest would be to implement some kind of RPC logic so when
the consumer gets the "banana" message, it can publish a message back to
the sender so the sender can restart the sequence.

You could also try something with basic.nack and a bascic.qos of the number
of messages that you want to cycle through. So in your case you can set a
prefetch count of 3 and whenever you get the banana message you basick.nack
all three. See http://www.rabbitmq.com/nack.html

The first approach could be more flexible.

Regards,

Alvaro

On Wednesday, November 27, 2013, yby538 at 163.com wrote:

>
> hi,all
>
> I have a sender and i have a receiver. Sender pushes the messages,  apple
> ,orange ,banana to queue which is named "fruit"
>
>  once the receiver gets the message "banana" and send the ack.  i want the
> sender to be noticed so it can  send the message "banana" to the queue
>
>  you know, i mean, i want to ensure that the queue does always contains
> banana ,apple and orange and if one message was got by the receiver ,the
> sender will push it to the queue
>
>  how to implement it, please?
>
> Does it make sense? i am very sorry since my English is very poor
>
>  thanks a lot
>
> ------------------------------
>  ?????????????????????
> ?????????????????
> ?????????????????????
> ?????????????????
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/1e17b025/attachment.htm>

From watson.timothy at gmail.com  Wed Nov 27 10:21:10 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Wed, 27 Nov 2013 10:21:10 +0000
Subject: [rabbitmq-discuss] High cpu usage on CentOS boxes
In-Reply-To: <CAPK6OeuCg_R8dtHtaSjENt19ACUDJ3NpAH+SNoqvveZrRAHpbw@mail.gmail.com>
References: <CAPK6OevH6WFnnWXf6Dc9H_81vtBnKn+6na-_qbNi1-0mHAE2Wg@mail.gmail.com>
	<CAPK6Oeub2UC=WXZ4qtJ3DpZEOcauOyag=Ld=bu_ZpG7TYebsBQ@mail.gmail.com>
	<529388C6.6000808@rabbitmq.com>
	<CAPK6OeuCg_R8dtHtaSjENt19ACUDJ3NpAH+SNoqvveZrRAHpbw@mail.gmail.com>
Message-ID: <E9D9362E-71DC-4481-B646-D4031E1A735C@rabbitmq.com>

As Simon said, this is highly unlikely o be anything to do with the OS distro, however it could be due to differences in the Linux kernel version the two distro run over and/different versions of erlang/OTP. Are both the servers runnin the same Linux kernel and the same erlang version? Are both 64/32bit architectures and is the erlang runtime they're both running compiled for the same?

Cheers,
Tim

On 26 Nov 2013, at 05:24, shridharan muthu <shridharan.m at gmail.com> wrote:

> Hello Simon,
>    Cent OS takes much lesser traffic than I have on Ubuntu. I migrated 5% cpu traffic from ubuntu and It caused 15% cpu increase in Cent OS. I goggled and noticed quite similar questions but didn't find any solutions. If there are a few knobs that I can tune,  I would be happy to test it out. 
>  
>     BTW, I don't use Mandatory/Immediate flags or Acks. All my publisher & consumer calls are asynchronous. 
> 
> Thanks,
> Shri
> 
> 
> On Mon, Nov 25, 2013 at 9:28 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> I'm afraid there isn't a good way to see which parts of the broker are busy at the moment (we hope to add something along these lines in a future release).
> 
> I'm suspicious of the idea that it's distro-related though. Is the CentOS server really performing the same workload as the Ubuntu server?
> 
> To get to the bottom of this you'd have to gradually take bits away until you see the CPU usage drop - stop connections, disable plugins and so on.
> 
> Cheers, Simon
> 
> 
> On 25/11/2013 16:53, shridharan muthu wrote:
> Hello There,
> 
>     Reg my previous message, is there anyway to dig into the high cpu
> usage issue? With similar configs in Ubuntu & Cent OS, Cent OS takes lot
> more cpu for beam.smp process. I switched log level to "info" but
> noticed nothing unusual.
> 
> Any help would be appreciated.
> 
> Thanks,
> Shri
> 
> 
> On Fri, Nov 22, 2013 at 3:56 PM, shridharan muthu
> <shridharan.m at gmail.com <mailto:shridharan.m at gmail.com>> wrote:
> 
>     Hi There,
>          I am experiencing high cpu usage (above 400%) on Cent OS rabbit
>     mq cluster (with 2 nodes). We have a similar setup in Ubuntu and cpu
>     usage seems fine. Pls fine the report, status and top below.
> 
>     OS: /CentOS release 6.4/
> 
>     Report:
>     /{pid,2148},/
>     / {running_applications,/
>     /     [{rabbitmq_management,"RabbitMQ Management Console","3.0.2"},/
>     /      {rabbitmq_management_agent,"RabbitMQ Management Agent","3.0.2"},/
>     /      {rabbit,"RabbitMQ","3.0.2"},/
>     /      {os_mon,"CPO  CXC 138 46","2.2.7"},/
>     /      {rabbitmq_mochiweb,"RabbitMQ Mochiweb Embedding","3.0.2"},/
>     /      {webmachine,"webmachine","1.9.1-rmq3.0.2-git52e62bc"},/
>     /      {mochiweb,"MochiMedia Web Server","2.3.1-rmq3.0.2-gitd541e9a"},/
>     /      {xmerl,"XML parser","1.2.10"},/
>     /      {inets,"INETS  CXC 138 49","5.7.1"},/
>     /      {mnesia,"MNESIA  CXC 138 12","4.5"},/
>     /      {amqp_client,"RabbitMQ AMQP Client","3.0.2"},/
>     /      {sasl,"SASL  CXC 138 11","2.1.10"},/
>     /      {stdlib,"ERTS  CXC 138 10","1.17.5"},/
>     /      {kernel,"ERTS  CXC 138 10","2.14.5"}]},/
>     / {os,{unix,linux}},/
>     / {erlang_version,/
>     /     "Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:12:12]
>     [rq:12] [async-threads:30] [kernel-poll:true]\n"},/
>     / {memory,/
>     /     [{total,285898072},/
>     /      {connection_procs,16592856},/
>     /      {queue_procs,1064888},/
>     /      {plugins,269872},/
>     /      {other_proc,13173224},/
>     /      {mnesia,100632},/
>     /      {mgmt_db,2167672},/
>     /      {msg_index,35352},/
>     /      {other_ets,72058416},/
>     /      {binary,7326576},/
>     /      {code,17434264},/
>     /      {atom,3356065},/
>     /      {other_system,152318255}]},/
>     / {vm_memory_high_watermark,0.4},/
>     / {vm_memory_limit,4991811584},/
>     / {disk_free_limit,1000000000},/
>     / {disk_free,17927184384},/
>     / {file_descriptors,/
>     /     [{total_limit,199900},/
>     /      {total_used,314},/
>     /      {sockets_limit,179908},/
>     /      {sockets_used,312}]},/
>     / {processes,[{limit,1048576},{used,2703}]},/
>     / {run_queue,0},/
>     / {uptime,3207797}]/
> 
>      From Top:
>     /   2249 rabbitmq  20   0 2989m 319m 2540 S 371.5  2.7  25109:43
>     beam.smp /
> 
> 
> 
>       Pls advise me how to proceed further.
> 
>     Thanks,
>     Shri
> 
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/f15b71ff/attachment.htm>

From michael.justin at gmx.net  Wed Nov 27 10:23:35 2013
From: michael.justin at gmx.net (Michael Justin)
Date: Wed, 27 Nov 2013 11:23:35 +0100
Subject: [rabbitmq-discuss] Missing content-type:text/plain in RabbitMQ web
	stomp echo messages
Message-ID: <l74h6u$bia$1@ger.gmane.org>

Hello,

the default stomp web example "Simple Echo Server" in the RabbitMQ 
broker plug-in at http://127.0.0.1:15670/web-stomp-examples/echo.html 
does not set the content-type header to text/plain. This confuses 
clients which detect text messages based on this header. Example

MESSAGE
subscription:{1CFF6D7D-7424-4386-8023-7CA5744F62E4}
destination:/topic/test
message-id:...
content-length:4

test

As a workaround, STOMP client code can be adjusted so a missing 
content-type header will indicate a text message.

I suggest to add the header to the outgoing message in the echo example 
HTML/JavaScript code.

Regards
-- 
Michael Justin


From simon at rabbitmq.com  Wed Nov 27 10:26:43 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Wed, 27 Nov 2013 10:26:43 +0000
Subject: [rabbitmq-discuss] RabbitMq Server how to make master-slave and
 master-backup ?
In-Reply-To: <3C13ED25-9218-4A1E-ABF7-EBC7EA993E19@rabbitmq.com>
References: <1385446517809-31650.post@n5.nabble.com>
	<3C13ED25-9218-4A1E-ABF7-EBC7EA993E19@rabbitmq.com>
Message-ID: <5295C8E3.4080105@rabbitmq.com>

On 26/11/13 07:25, Michael Klishin wrote:
> On 26 Nov 2013, at 10:15, 3k4b251 <314992959 at qq.com> wrote:
>
>> rabbitmq  server  use
>> one,  and  copy  data  to  the other database  at the same time   or  a
>> time later .
>
> It?s only safe to copy Mnesia directory when RabbitMQ node that uses it is not running.

Depends how safe you want to be. It *is* possible to do active/passive 
failover by having two brokers share one data directory; we documented 
one such approach here:

http://www.rabbitmq.com/pacemaker.html

There are multiple disadvantages though:

* Setting it up is a PITA.

* At failover the "spare" broker will need to rebuild indexes from 
scratch (possibly taking a long time).

* The safety of (confirmed) messages is less guaranteed than with 
mirrored queues. In practice you tend not to lose much if anything. But 
in theory everything could vanish.

* As with all active / passive systems failover is such a big deal that 
you never tend to test it.

So that's why we recommend mirrored queues instead. Or...

> If you want a hot standby, use Shovel or federated exchanges to replicate messages.

...these are also good options.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From jesper.louis.andersen at gmail.com  Wed Nov 27 10:29:47 2013
From: jesper.louis.andersen at gmail.com (Jesper Louis Andersen)
Date: Wed, 27 Nov 2013 11:29:47 +0100
Subject: [rabbitmq-discuss] How to assure response even if rpc server
	goes down.
In-Reply-To: <CAMcAHLWDXRB8Y46N9MOfnyMi_isQUMhqNDRcTkSgBcSUWfzz0A@mail.gmail.com>
References: <e94d1a6d-bf4d-4b36-993d-24422af7e8e1@googlegroups.com>
	<D1CCD8B6-82A7-48C1-951B-FCAEE9F38487@rabbitmq.com>
	<CAMcAHLWDXRB8Y46N9MOfnyMi_isQUMhqNDRcTkSgBcSUWfzz0A@mail.gmail.com>
Message-ID: <CAGrdgiW04be00GxmFjEHSqJnYCO1ns5n1Gk8ZV16n+ucp1AgPg@mail.gmail.com>

A trick is to make your messages idempotent. Then you can reissue the same
request again after a timeout, should you have had no response yet. It is a
protocol design trick that often helps because it circumvents the problem
of keeping state entirely. Also look at "best effort" delivery.


On Tue, Nov 26, 2013 at 11:18 PM, Alvaro Videla <videlalvaro at gmail.com>wrote:

> Also I think it might be worth mentioning the "Publisher Confirms"
> feature of RabbitMQ: http://www.rabbitmq.com/confirms.html in case you
> need to be sure a message was taking care by the server.
>
> -Alvaro
>
> On Tue, Nov 26, 2013 at 11:14 PM, Michael Klishin
> <mklishin at gopivotal.com> wrote:
> >
> > On 26 Nov 2013, at 23:35, Alfonso Alvz <alfonso.alvz at gmail.com> wrote:
> >
> >> I was wondering if there's is a way to make the messages persistent in
> case the server fails?. If the client sends a message with no server
> running, it stays there awaiting for the response and it doesn't get
> anything once the server goes up again..
> >
> > Accumulate messages in the client and re-publish them when a new
> connection is up. Note that to really
> > make this work you?ll need to have a WAL (write-ahead log) of messages
> on disk to significantly reduce
> > message loss probability when your publisher crashes, runs out of
> memory, etc.
> >
> >>
> >> Having a configuration like this:
> >> If the server disappears, is there a way to resume the process whenever
> the server is up again?
> >
> > Some clients support automatic recovery but currently don?t provide
> WAL?s. 3rd party projects built on top
> > of clients (e.g. Hutch, Celery or EasyNetQ) may choose to provide WAL
> and more advanced features
> > but it is currently out of scope for the protocol clients.
> >
> > Message durability controls whether the message will be stored on disk
> by RabbitMQ. It has no effect
> > on what happens when you publish messages on a closed connection.
> >
> >
> > MK
> >
> > Software Engineer, Pivotal/RabbitMQ
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
J.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/a32e70fa/attachment.htm>

From emile at rabbitmq.com  Wed Nov 27 11:41:25 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Wed, 27 Nov 2013 11:41:25 +0000
Subject: [rabbitmq-discuss] Missing content-type:text/plain in RabbitMQ
 web stomp echo messages
In-Reply-To: <l74h6u$bia$1@ger.gmane.org>
References: <l74h6u$bia$1@ger.gmane.org>
Message-ID: <5295DA65.3000306@rabbitmq.com>


Hi,

On 27/11/13 10:23, Michael Justin wrote:

> As a workaround, STOMP client code can be adjusted so a missing 
> content-type header will indicate a text message.

The specification requires a missing content-type to be treated as a
binary blob, though in this case text/plain would be better.


> I suggest to add the header to the outgoing message in the echo example 
> HTML/JavaScript code.

Thanks for pointing this out. The change has been made and will be
released in due course.




-Emile





From andres.ventura at itv.com  Wed Nov 27 12:15:23 2013
From: andres.ventura at itv.com (andres.ventura at itv.com)
Date: Wed, 27 Nov 2013 04:15:23 -0800 (PST)
Subject: [rabbitmq-discuss] Make messages persistent by default
Message-ID: <2fbf740a-b397-41f0-ac50-1d3a9ecaf44c@googlegroups.com>

Hi All,

I've been looking into making RabbitMQ messages persistent. I've read that, 
when publishing messages, they can be marked as persistent by setting the 
deliveryMode property value to 2.

Is there a way to configure RabbitMQ in order to set the default 
deliveryMode as persistent?

Thank you,
Andres. 

</PRE><a href="http://www.itv.com"><img src="https://lh5.googleusercontent.com/-YJsNOaY5C2A/UPOvkVzskII/AAAAAAAAAKU/3VqcYfUYzOo/s90/ITV-Logo%2520Footer.png"/></a>
<br><br>

</PRE><a href="http://www.itv.com"><img src="https://lh5.googleusercontent.com/-jry69XRAzXQ/UjL2Ymeg7nI/AAAAAAAAAj0/3x0MI2xh4hc/s161/Channel%252Bof%252Bthe%252BYear.png"/></a>
<br><br>



<div style="font-size: x-small">ITV plc (Registration No. 4967001) (ITV) is incorporated in England and Wales with its registered office at The London Television Centre, Upper Ground, London SE1 9LT. Please visit the official ITV website at www.itv.com for the latest company news.
 
The contents of this email and any attachments are confidential, may be privileged, may be subject to copyright and are intended solely for the use of the individual to whom they are addressed. If you have received this email and you are not the intended recipient please notifypostmaster at itv.com and delete this email and you are notified that disclosing, copying, distributing or taking any action in reliance on the contents of this email are strictly prohibited.
 
Although ITV routinely screens for viruses, recipients should scan this email and any attachments for viruses. ITV makes no representation or warranty that this email or any of its attachments is free of viruses or defects and does not accept any responsibility for any damage caused by any virus or defect transmitted by this email. ITV reserves the right to monitor all e mails and the systems upon which such e mails are stored or circulated.
 
This email does not conclude a binding agreement. Any views or opinions presented in this email are solely those of the author and do not necessarily represent those of ITV.
 
Thank You
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/fb5ccc82/attachment.html>

From videlalvaro at gmail.com  Wed Nov 27 13:17:11 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Wed, 27 Nov 2013 14:17:11 +0100
Subject: [rabbitmq-discuss] Make messages persistent by default
In-Reply-To: <2fbf740a-b397-41f0-ac50-1d3a9ecaf44c@googlegroups.com>
References: <2fbf740a-b397-41f0-ac50-1d3a9ecaf44c@googlegroups.com>
Message-ID: <CAMcAHLXHivG9UHvHFho1DQUAhyZsvEYcn+i0k4QKh06w9WEZ+w@mail.gmail.com>

Hi,

No. This is not possible. You need to do that every time you publish a
message.

Regards,

Alvaro


On Wed, Nov 27, 2013 at 1:15 PM, <andres.ventura at itv.com> wrote:

> Hi All,
>
> I've been looking into making RabbitMQ messages persistent. I've read
> that, when publishing messages, they can be marked as persistent by setting
> the deliveryMode property value to 2.
>
> Is there a way to configure RabbitMQ in order to set the default
> deliveryMode as persistent?
>
> Thank you,
> Andres.
>
> <http://www.itv.com>
>
>  <http://www.itv.com>
>
> ITV plc (Registration No. 4967001) (ITV) is incorporated in England and
> Wales with its registered office at The London Television Centre, Upper
> Ground, London SE1 9LT. Please visit the official ITV website at
> www.itv.com for the latest company news. The contents of this email and
> any attachments are confidential, may be privileged, may be subject to
> copyright and are intended solely for the use of the individual to whom
> they are addressed. If you have received this email and you are not the
> intended recipient please notifypostmaster at itv.com and delete this email
> and you are notified that disclosing, copying, distributing or taking any
> action in reliance on the contents of this email are strictly prohibited.
> Although ITV routinely screens for viruses, recipients should scan this
> email and any attachments for viruses. ITV makes no representation or
> warranty that this email or any of its attachments is free of viruses or
> defects and does not accept any responsibility for any damage caused by any
> virus or defect transmitted by this email. ITV reserves the right to
> monitor all e mails and the systems upon which such e mails are stored or
> circulated. This email does not conclude a binding agreement. Any views or
> opinions presented in this email are solely those of the author and do not
> necessarily represent those of ITV. Thank You
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/fbbe1482/attachment.html>

From michael.s.klishin at gmail.com  Wed Nov 27 13:28:48 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Wed, 27 Nov 2013 17:28:48 +0400
Subject: [rabbitmq-discuss] Make messages persistent by default
In-Reply-To: <2fbf740a-b397-41f0-ac50-1d3a9ecaf44c@googlegroups.com>
References: <2fbf740a-b397-41f0-ac50-1d3a9ecaf44c@googlegroups.com>
Message-ID: <CAE3HoVQEO41av_nKQgBUEccgb_Mx6oABYQnNs-6Q_uGUA09K8g@mail.gmail.com>

2013/11/27 <andres.ventura at itv.com>

> Is there a way to configure RabbitMQ in order to set the default
> deliveryMode as persistent?


Some clients (e.g. amqp gem) allow overriding default properties but this
is not possible
to configure on the broker end.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/6ac480c7/attachment.html>

From andres.ventura at itv.com  Wed Nov 27 13:36:04 2013
From: andres.ventura at itv.com (andres.ventura at itv.com)
Date: Wed, 27 Nov 2013 05:36:04 -0800 (PST)
Subject: [rabbitmq-discuss] Make messages persistent by default
In-Reply-To: <CAMcAHLXHivG9UHvHFho1DQUAhyZsvEYcn+i0k4QKh06w9WEZ+w@mail.gmail.com>
References: <2fbf740a-b397-41f0-ac50-1d3a9ecaf44c@googlegroups.com>
 <CAMcAHLXHivG9UHvHFho1DQUAhyZsvEYcn+i0k4QKh06w9WEZ+w@mail.gmail.com>
Message-ID: <44610f7c-f679-4e85-ae65-9a03b9600c1c@googlegroups.com>

Hi Alvaro,

Thanks for your response. 

Regards,
Andres.

On Wednesday, 27 November 2013 13:17:11 UTC, Alvaro Videla wrote:
>
> Hi,
>
> No. This is not possible. You need to do that every time you publish a 
> message.
>
> Regards,
>
> Alvaro
>
>
> On Wed, Nov 27, 2013 at 1:15 PM, <andres.... at itv.com <javascript:>> wrote:
>
>> Hi All,
>>
>> I've been looking into making RabbitMQ messages persistent. I've read 
>> that, when publishing messages, they can be marked as persistent by setting 
>> the deliveryMode property value to 2.
>>
>> Is there a way to configure RabbitMQ in order to set the default 
>> deliveryMode as persistent?
>>
>> Thank you,
>> Andres. 
>>
>> <http://www.itv.com> 
>>
>>  <http://www.itv.com> 
>>
>> ITV plc (Registration No. 4967001) (ITV) is incorporated in England and 
>> Wales with its registered office at The London Television Centre, Upper 
>> Ground, London SE1 9LT. Please visit the official ITV website at 
>> www.itv.com for the latest company news. The contents of this email and 
>> any attachments are confidential, may be privileged, may be subject to 
>> copyright and are intended solely for the use of the individual to whom 
>> they are addressed. If you have received this email and you are not the 
>> intended recipient please notifypo... at itv.com <javascript:> and delete 
>> this email and you are notified that disclosing, copying, distributing or 
>> taking any action in reliance on the contents of this email are strictly 
>> prohibited. Although ITV routinely screens for viruses, recipients should 
>> scan this email and any attachments for viruses. ITV makes no 
>> representation or warranty that this email or any of its attachments is 
>> free of viruses or defects and does not accept any responsibility for any 
>> damage caused by any virus or defect transmitted by this email. ITV 
>> reserves the right to monitor all e mails and the systems upon which such e 
>> mails are stored or circulated. This email does not conclude a binding 
>> agreement. Any views or opinions presented in this email are solely those 
>> of the author and do not necessarily represent those of ITV. Thank You 
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq... at lists.rabbitmq.com <javascript:>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
</PRE><a href="http://www.itv.com"><img src="https://lh5.googleusercontent.com/-YJsNOaY5C2A/UPOvkVzskII/AAAAAAAAAKU/3VqcYfUYzOo/s90/ITV-Logo%2520Footer.png"/></a>
<br><br>

</PRE><a href="http://www.itv.com"><img src="https://lh5.googleusercontent.com/-jry69XRAzXQ/UjL2Ymeg7nI/AAAAAAAAAj0/3x0MI2xh4hc/s161/Channel%252Bof%252Bthe%252BYear.png"/></a>
<br><br>



<div style="font-size: x-small">ITV plc (Registration No. 4967001) (ITV) is incorporated in England and Wales with its registered office at The London Television Centre, Upper Ground, London SE1 9LT. Please visit the official ITV website at www.itv.com for the latest company news.
 
The contents of this email and any attachments are confidential, may be privileged, may be subject to copyright and are intended solely for the use of the individual to whom they are addressed. If you have received this email and you are not the intended recipient please notifypostmaster at itv.com and delete this email and you are notified that disclosing, copying, distributing or taking any action in reliance on the contents of this email are strictly prohibited.
 
Although ITV routinely screens for viruses, recipients should scan this email and any attachments for viruses. ITV makes no representation or warranty that this email or any of its attachments is free of viruses or defects and does not accept any responsibility for any damage caused by any virus or defect transmitted by this email. ITV reserves the right to monitor all e mails and the systems upon which such e mails are stored or circulated.
 
This email does not conclude a binding agreement. Any views or opinions presented in this email are solely those of the author and do not necessarily represent those of ITV.
 
Thank You
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/15c36e9d/attachment.html>

From andres.ventura at itv.com  Wed Nov 27 13:36:04 2013
From: andres.ventura at itv.com (andres.ventura at itv.com)
Date: Wed, 27 Nov 2013 05:36:04 -0800 (PST)
Subject: [rabbitmq-discuss] Make messages persistent by default
In-Reply-To: <CAMcAHLXHivG9UHvHFho1DQUAhyZsvEYcn+i0k4QKh06w9WEZ+w@mail.gmail.com>
References: <2fbf740a-b397-41f0-ac50-1d3a9ecaf44c@googlegroups.com>
 <CAMcAHLXHivG9UHvHFho1DQUAhyZsvEYcn+i0k4QKh06w9WEZ+w@mail.gmail.com>
Message-ID: <44610f7c-f679-4e85-ae65-9a03b9600c1c@googlegroups.com>

Hi Alvaro,

Thanks for your response. 

Regards,
Andres.

On Wednesday, 27 November 2013 13:17:11 UTC, Alvaro Videla wrote:
>
> Hi,
>
> No. This is not possible. You need to do that every time you publish a 
> message.
>
> Regards,
>
> Alvaro
>
>
> On Wed, Nov 27, 2013 at 1:15 PM, <andres.... at itv.com <javascript:>> wrote:
>
>> Hi All,
>>
>> I've been looking into making RabbitMQ messages persistent. I've read 
>> that, when publishing messages, they can be marked as persistent by setting 
>> the deliveryMode property value to 2.
>>
>> Is there a way to configure RabbitMQ in order to set the default 
>> deliveryMode as persistent?
>>
>> Thank you,
>> Andres. 
>>
>> <http://www.itv.com> 
>>
>>  <http://www.itv.com> 
>>
>> ITV plc (Registration No. 4967001) (ITV) is incorporated in England and 
>> Wales with its registered office at The London Television Centre, Upper 
>> Ground, London SE1 9LT. Please visit the official ITV website at 
>> www.itv.com for the latest company news. The contents of this email and 
>> any attachments are confidential, may be privileged, may be subject to 
>> copyright and are intended solely for the use of the individual to whom 
>> they are addressed. If you have received this email and you are not the 
>> intended recipient please notifypo... at itv.com <javascript:> and delete 
>> this email and you are notified that disclosing, copying, distributing or 
>> taking any action in reliance on the contents of this email are strictly 
>> prohibited. Although ITV routinely screens for viruses, recipients should 
>> scan this email and any attachments for viruses. ITV makes no 
>> representation or warranty that this email or any of its attachments is 
>> free of viruses or defects and does not accept any responsibility for any 
>> damage caused by any virus or defect transmitted by this email. ITV 
>> reserves the right to monitor all e mails and the systems upon which such e 
>> mails are stored or circulated. This email does not conclude a binding 
>> agreement. Any views or opinions presented in this email are solely those 
>> of the author and do not necessarily represent those of ITV. Thank You 
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq... at lists.rabbitmq.com <javascript:>
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
</PRE><a href="http://www.itv.com"><img src="https://lh5.googleusercontent.com/-YJsNOaY5C2A/UPOvkVzskII/AAAAAAAAAKU/3VqcYfUYzOo/s90/ITV-Logo%2520Footer.png"/></a>
<br><br>

</PRE><a href="http://www.itv.com"><img src="https://lh5.googleusercontent.com/-jry69XRAzXQ/UjL2Ymeg7nI/AAAAAAAAAj0/3x0MI2xh4hc/s161/Channel%252Bof%252Bthe%252BYear.png"/></a>
<br><br>



<div style="font-size: x-small">ITV plc (Registration No. 4967001) (ITV) is incorporated in England and Wales with its registered office at The London Television Centre, Upper Ground, London SE1 9LT. Please visit the official ITV website at www.itv.com for the latest company news.
 
The contents of this email and any attachments are confidential, may be privileged, may be subject to copyright and are intended solely for the use of the individual to whom they are addressed. If you have received this email and you are not the intended recipient please notifypostmaster at itv.com and delete this email and you are notified that disclosing, copying, distributing or taking any action in reliance on the contents of this email are strictly prohibited.
 
Although ITV routinely screens for viruses, recipients should scan this email and any attachments for viruses. ITV makes no representation or warranty that this email or any of its attachments is free of viruses or defects and does not accept any responsibility for any damage caused by any virus or defect transmitted by this email. ITV reserves the right to monitor all e mails and the systems upon which such e mails are stored or circulated.
 
This email does not conclude a binding agreement. Any views or opinions presented in this email are solely those of the author and do not necessarily represent those of ITV.
 
Thank You
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/15c36e9d/attachment-0001.html>

From rtrlists at googlemail.com  Wed Nov 27 14:53:39 2013
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 27 Nov 2013 14:53:39 +0000
Subject: [rabbitmq-discuss] Question about mirroring vs blocked
	publishing
In-Reply-To: <527D01F3.4010408@rabbitmq.com>
References: <CAH+xwdAOr4W_yvKriWHAVmZjstP+FWhrzhQOA3zRHNt-zPrxTg@mail.gmail.com>
 <EC4EC441-7DA3-4C70-87D5-4B04F840B67B@rabbitmq.com>
 <CAH+xwdATqg7e6+r4xy2NohHtFw1vryr2c-nRzyRP7_=ic0+7oQ@mail.gmail.com>
 <527D01F3.4010408@rabbitmq.com>
Message-ID: <CAH+xwdA5rtvvW-jvvFZ0mNCEz6KqBdB10dYhU8ZEqprmFToiMQ@mail.gmail.com>

Hi Simon,

and after a loooong time (sorry 'bout that, took a while), we can confirm
that 3.2.1 fixes the issues that we were seeing with mirroring and blocking.

Thank you again for pointing us in the right direction.

Regards,
Robby



On Fri, Nov 8, 2013 at 3:23 PM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 08/11/2013 3:17PM, Robert Raschke wrote:
>
>> [down_from_gm,down_from_gm]
>>
>
> Yep, that's the one. Fixed in 3.2.1.
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/e9e6594c/attachment.html>

From mahi.rabbitmq at gmail.com  Wed Nov 27 19:14:18 2013
From: mahi.rabbitmq at gmail.com (mahi e)
Date: Wed, 27 Nov 2013 11:14:18 -0800
Subject: [rabbitmq-discuss] queue properties
In-Reply-To: <52947169.8080808@rabbitmq.com>
References: <CAGOpLV4-AnfDjO0d9R8Y+kC6XM0WSKgTM0dtpshXsJSZrca5wQ@mail.gmail.com>
 <838F5DE4-2822-436C-80AB-96F5472005CF@rabbitmq.com>
 <52947169.8080808@rabbitmq.com>
Message-ID: <CAGOpLV52oa1eT3FhVw-WOmsH8h_KA8kr2HF06ar9Y8QNVivz3Q@mail.gmail.com>

HI

how can we get messages rates in queues

Thanks


On Tue, Nov 26, 2013 at 2:01 AM, Simon MacMullen <simon at rabbitmq.com> wrote:

> On 26/11/2013 07:21, Michael Klishin wrote:
>
>> On 26 Nov 2013, at 02:27, mahi e <mahi.rabbitmq at gmail.com> wrote:
>> See the comments in
>> https://github.com/michaelklishin/rabbit-hole/blob/master/queues.go#L10
>>
>> Don?t worry about q1-q4 and next_seq_id, they are message store
>> implementation details.
>>
>
> Note that all of backing_queue_status is somewhat unofficial and subject
> to change (in theory, although it hasn't changed since it was introduced).
> But it's a fairly arbitrary set of values.
>
> Cheers, Simon
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/b823962c/attachment.html>

From nicholasastuart at gmail.com  Wed Nov 27 15:25:57 2013
From: nicholasastuart at gmail.com (Nicholas Stuart)
Date: Wed, 27 Nov 2013 07:25:57 -0800 (PST)
Subject: [rabbitmq-discuss] Policy for dead letter exchange routing back to
	queue
Message-ID: <db9961bb-e832-4a77-a42b-d3cd400a2362@googlegroups.com>

I've successfully set up a dead letter exchange policy where the 
dead-letter-exchange is blank, which will return the message to the 
original queue. However this only happens if the message was published to 
the default exchange, or with a routing key of the queue name.

If I set up a fanout or topic exchange, my message is dropped(rightfully 
so). Is there any way, in the RabbitMQ policy, that I can specify a routing 
key policy that will always point back to the queue the message was 
consumed off of?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/7299f957/attachment.html>

From zsolt.erl at gmail.com  Wed Nov 27 20:23:02 2013
From: zsolt.erl at gmail.com (zsolt.erl at gmail.com)
Date: Wed, 27 Nov 2013 12:23:02 -0800 (PST)
Subject: [rabbitmq-discuss] RabbitMq on ESXi
Message-ID: <98ab0559-0b72-45ac-975e-77a160a0c94d@googlegroups.com>

Hi,

I'm trying to find out if there are any recommendations for running 
RabbitMq on VMWare ESXi? (eg. clustering, queue mirroring)

I have several 4 node clusters running on ESXi4/5 guests. The guests are 
Ubuntu 10.04 VMs.
Erlang version: R15B. RabbitMq versions: 2.8.2 and 3.0.1 .

The clusters seem to randomly crash every once in a while (about once every 
2 months).
Sometimes the whole cluster crashes, sometimes only a couple nodes and the 
others either work or become unreachable.
Logs only show that the nodes lost connection.
I'm running 4 node clusters with 1 disk node and about 100 queues mirrored 
across 2-3 nodes.
The same thing was happening when I was running a cluster with 4 disk 
nodes. 

Are there any recommended best practices in regards to Virtual Machine 
settings, VMWare network settings or OS settings that could
prevent these random crashes?
Would federation be a better solution then clustering in a virtual 
environment? Or should I just run them on physical hardware?


I realize there's not enough data here to find out what is happening 
exactly but I'm just trying to see if anybody came across similar problems 
and were able to handle it?



Thanks,

Zsolt


 


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/62bb31bf/attachment.html>

From monsti at gmail.com  Wed Nov 27 21:41:53 2013
From: monsti at gmail.com (Adrien Brault)
Date: Wed, 27 Nov 2013 13:41:53 -0800 (PST)
Subject: [rabbitmq-discuss] Configuration strategy
Message-ID: <32ad3a77-a339-4055-8a00-8089de403ef1@googlegroups.com>

Hey,

I've read the getting started tutorials and am bothered with one aspect: 
publishers and consumers configures rabbitmq. I understand that those 
configuration requests are idempotent, however it seems weird to let the 
application(s) configure rabbitmq.

I don't think a publisher should be aware of the exchange type, and a 
consumer should not be aware of bindings. Though I understand that some 
pattern requires the application to create exchanges/queues/binding (like 
RPC).

Is there a tool to have some configuration file for the server ?
My goal would be that publishers only know what kind of message to send to 
a specific exchange, and consumer know what kind of message to get from a 
specific queue.

What do you think ? How do you handle the queue/exchange creation and 
binding logic in big application(s) ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131127/d458c21e/attachment.html>

From brett.r.cameron at gmail.com  Thu Nov 28 00:23:40 2013
From: brett.r.cameron at gmail.com (Brett Cameron)
Date: Thu, 28 Nov 2013 13:23:40 +1300
Subject: [rabbitmq-discuss] Configuration strategy
In-Reply-To: <32ad3a77-a339-4055-8a00-8089de403ef1@googlegroups.com>
References: <32ad3a77-a339-4055-8a00-8089de403ef1@googlegroups.com>
Message-ID: <CALPqkio+9Oz1XZyc55AvNH+Ya6zokGfw4A5+Vhd8cA3eD5V1tg@mail.gmail.com>

Adrien,

While AMQP allows suitably privileged clients (producers, consumers) to
perform some configuration functions, you certainly do not have to design
things to work in this way. For example, you could use a facility such as
the RabbitMQ management plugin to create queues, exchanges, and bindings,
and give your producers and consumers just the permissions they need in
order to publish and consume messages - it's entirely up to you and your
particular needs/requirements.

Brett



On Thu, Nov 28, 2013 at 10:41 AM, Adrien Brault <monsti at gmail.com> wrote:

> Hey,
>
> I've read the getting started tutorials and am bothered with one aspect:
> publishers and consumers configures rabbitmq. I understand that those
> configuration requests are idempotent, however it seems weird to let the
> application(s) configure rabbitmq.
>
> I don't think a publisher should be aware of the exchange type, and a
> consumer should not be aware of bindings. Though I understand that some
> pattern requires the application to create exchanges/queues/binding (like
> RPC).
>
> Is there a tool to have some configuration file for the server ?
> My goal would be that publishers only know what kind of message to send to
> a specific exchange, and consumer know what kind of message to get from a
> specific queue.
>
> What do you think ? How do you handle the queue/exchange creation and
> binding logic in big application(s) ?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131128/7a7f90b4/attachment.html>

From rashim.anand at hds.com  Thu Nov 28 01:27:18 2013
From: rashim.anand at hds.com (Rashim Anand)
Date: Thu, 28 Nov 2013 01:27:18 +0000
Subject: [rabbitmq-discuss] Periodic SSL connection timeouts
Message-ID: <B72607244032BD4489DBA663C1FD87EF7F703D45@USINDEM103.corp.hds.com>

Hi,

We are facing periodic SSL connection timeout issues. Every 20-30 minutes we see Rabbit MQ SSL connection errors. Here are the sample logs:

=INFO REPORT==== 27-Nov-2013::20:22:13 ===
accepting AMQP connection <0.12604.35> (127.0.0.1:54924 -> 127.0.0.1:5671)

...

=INFO REPORT==== 27-Nov-2013::20:22:13 ===
accepting AMQP connection <0.12608.35> (127.0.0.1:54925 -> 127.0.0.1:5671)

...

=ERROR REPORT==== 27-Nov-2013::20:22:18 ===
error on AMQP connection <0.12604.35>: {ssl_upgrade_error,timeout} (unknown POSIX error)

=ERROR REPORT==== 27-Nov-2013::20:22:18 ===
error on AMQP connection <0.12608.35>: {ssl_upgrade_error,timeout} (unknown POSIX error)

Other than these periodic errors, everything works fine - the Rabbit MQ server accepts connections successfully most of the times.

Could you please help us figure out the root cause of this problem and any workarounds if any?

We are using the .NET client library to talk to the Rabbit MQ server and have enabled SSLs on the connections. We are using version 3.1.3 for the Rabbit MQ server as well as the client library. These connections were initiated from the same server hosting the Rabbit MQ server and use a built in Rabbit MQ account.

Regards,
Rashim Anand


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131128/3ed859bc/attachment.html>

From michael.s.klishin at gmail.com  Thu Nov 28 09:16:44 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 28 Nov 2013 13:16:44 +0400
Subject: [rabbitmq-discuss] Periodic SSL connection timeouts
In-Reply-To: <B72607244032BD4489DBA663C1FD87EF7F703D45@USINDEM103.corp.hds.com>
References: <B72607244032BD4489DBA663C1FD87EF7F703D45@USINDEM103.corp.hds.com>
Message-ID: <CAE3HoVSk=xfPSjDttpirqCyYHdQ31YocR8X_s3-p6zi7deyemg@mail.gmail.com>

2013/11/28 Rashim Anand <rashim.anand at hds.com>

> Other than these periodic errors, everything works fine - the Rabbit MQ
> server accepts connections successfully most of the times.
>
>
>
> Could you please help us figure out the root cause of this problem and any
> workarounds if any?
>

One reason may be that the client is not configured to use SSL.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131128/d09556b2/attachment.html>

From simon at rabbitmq.com  Thu Nov 28 10:05:46 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 28 Nov 2013 10:05:46 +0000
Subject: [rabbitmq-discuss] Policy for dead letter exchange routing back
 to queue
In-Reply-To: <db9961bb-e832-4a77-a42b-d3cd400a2362@googlegroups.com>
References: <db9961bb-e832-4a77-a42b-d3cd400a2362@googlegroups.com>
Message-ID: <5297157A.9080901@rabbitmq.com>

On 27/11/13 15:25, Nicholas Stuart wrote:
> I've successfully set up a dead letter exchange policy where
> the|dead-letter-exchange|is blank, which will return the message to the
> original queue. However this only happens if the message was published
> to the default exchange, or with a routing key of the queue name.
>
> If I set up a fanout or topic exchange, my message is dropped(rightfully
> so). Is there any way, in the RabbitMQ policy, that I can specify a
> routing key policy that will always point back to the queue the message
> was consumed off of?

No, there isn't. Unless you want to create one policy per queue in which 
case you can set dead-letter-routing-key of course.

Why do you want to dead-letter back to the original queue?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From simon at rabbitmq.com  Thu Nov 28 10:10:56 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 28 Nov 2013 10:10:56 +0000
Subject: [rabbitmq-discuss] queue properties
In-Reply-To: <CAGOpLV52oa1eT3FhVw-WOmsH8h_KA8kr2HF06ar9Y8QNVivz3Q@mail.gmail.com>
References: <CAGOpLV4-AnfDjO0d9R8Y+kC6XM0WSKgTM0dtpshXsJSZrca5wQ@mail.gmail.com>
 <838F5DE4-2822-436C-80AB-96F5472005CF@rabbitmq.com>
 <52947169.8080808@rabbitmq.com>
 <CAGOpLV52oa1eT3FhVw-WOmsH8h_KA8kr2HF06ar9Y8QNVivz3Q@mail.gmail.com>
Message-ID: <529716B0.30108@rabbitmq.com>

On 27/11/13 19:14, mahi e wrote:
> how can we get messages rates in queues

Look in message_stats.publish_details.rate, 
message_stats.deliver_details.rate, etc.

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From arachweb at gmail.com  Thu Nov 28 13:36:31 2013
From: arachweb at gmail.com (Paul)
Date: Thu, 28 Nov 2013 08:36:31 -0500
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <52947007.9060903@rabbitmq.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
 <52938A1F.4010307@rabbitmq.com>
 <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
 <52947007.9060903@rabbitmq.com>
Message-ID: <919BB847-9102-4616-8F4B-C1152B8037CE@gmail.com>

Hi Simon,

Before I get too much deeper into this, let me do two things: ask a fundamental question, and then try to explain some of the project design.

The question: I seem to recall that a queue can be construed as an outbound route from an exchange. In RabbitMQ we publish to an exchange and we consume from a queue. If a message arrives at an exchange and there is no outbound route for it, then the broker discards the message (I think). But what if there is no component that reads from the queue? A queue can come to be by static configuration or programmatically. It can be mirrored to other nodes via HA queues; but if it's mirrored from computer A to computer B and yet there is no consuming software on B, then what happens to messages sent to the (queue owning) exchange?

As to the design of this project: I like the cluster idea because it seems to offer a way for "control" components on every node to share a unified view of their world. Computers and my services thereon can join (and leave) the cluster, and by publishing to their LOCAL broker keep each other informed about themselves and the services they offer. 

But some of the applications (as opposed to the control components) in this architecture need to share what I'll call a "task queue." The applications write to this queue (to its exchange), messages that represent work that needs to be done. The same applications, in a kind of recursive decomposition, read from the same queue and execute the work indicated by these messages. Now, with many such applications spread over several computers, the workload is nicely parallelized. 

My concern is that in an HA Queue implementation, a given message could be consumed more than once, i.e., once on computer A and once on B. Consequently, the same unit of work will be executed twice, and that's no good.

I'm not sure if I've fully conveyed why I find this aspect troublesome. But please give me your thoughts on it, and we can always dig deeper.

Thank you.

Cordially,

Paul

> On Nov 26, 2013, at 4:55 AM, Simon MacMullen <simon at rabbitmq.com> wrote:
> 
>> On 25/11/2013 18:10, Paul Bell wrote:
>> "Virtual hosts, exchanges, users, and permissions are automatically
>> mirrored across all nodes in a cluster. Queues may be located on a
>> single node, or mirrored across multiple nodes
>> <http://www.rabbitmq.com/ha.html>. A client connecting to any node in a
>> cluster can see all queues in the cluster, even if they are not located
>> on that node."
>> 
>> Question: does the last sentence apply to both queues located on a
>> single node and to mirrored (HA) queues?
> 
> Yes.
> 
>> The last clause of that
>> sentence, e.g., "..even if they are not located on that node" suggests
>> that whether or not the queues are mirrored shouldn't matter, i.e.,
>> client will see the queues regardless of the cluster it connects to.
> 
> Yes. And of course just because a queue is mirrored doesn't mean it has to be on *every* node in the cluster - you don't have to use ha-mode: all.
> 
>> The cluster approach "feels" complex to me but that is, at least in
>> part, due to the fact that my once modest Rabbit skills have atrophied
>> over the last couple of year. So, here's some thinking out loud with
>> attendant questions:
>> 
>> 1. Let's see, so, the several computers on which my (Java) RabbitMQ
>> component runs will be joined together in a cluster.
>> 2. What happens if Computer A creates some exchanges and then computer
>> B, either before or after joining the cluster, creates the same
>> exchanges? Maybe the usual Rabbit idempotency holds here; i.e., if
>> exchange exists within the cluster, it's not going to be re-created...?
> 
> Yes, the exchange (along with other metadata) is held in a distributed database and created atomically.
> 
>> 3. And if the component publishes to an exchange that message should (I
>> think) be visible on the mirrored exchanges on all of the other nodes in
>> the cluster, right?
> 
> Yes. We don't normally talk about "mirrored exchanges" since all exchanges are inherently mirrored.
> 
>> 4. And, moreover, once a consumer on any cluster node reads that
>> message, no other consumer will be able to read it. I sure hope this is
>> true.
> 
> If it only got routed to one queue. Obviously if it was routed to two queues it can be read twice, and so on.
> 
> Also the message can be seen by two consumers if one consumer is consuming in ack mode, then sees the message and either rejects it or crashes before acknowledging it. That's true on a single node though, nothing to do with clustering.
> 
> Cheers, Simon
> 

From marcos.torres at gmail.com  Thu Nov 28 14:56:48 2013
From: marcos.torres at gmail.com (Marcos Torres)
Date: Thu, 28 Nov 2013 12:56:48 -0200
Subject: [rabbitmq-discuss] Messages does not survive a RabbitMQ service
	restart
Message-ID: <CAP4Ah2CU-VNOeb=RojVtx8+XGxDBvyiBoPcLYA3H548FUdi=jw@mail.gmail.com>

Hi there.

The messages stored in a durable queue doesn't survive a service restart
(I'm using windows version of Rabbit).
I'm using message confirmation, but clearly I need to do something else.

This is how I'm publishing the messages :

                using (var channel =
rabbitConnection.Connection.CreateModel())
                {
                    channel.ConfirmSelect(); //enable confirms on channel
                    foreach (var message in messages)
                    {
                        var serialization = _serializer.Serialize(message ,
Encoding.UTF8);
                        channel.BasicPublish(rabbitAddress.Name,
string.Empty, null, serialization);
                    }
                    channel.WaitForConfirms();
                }


In the RabbitMQ Management I see the confirmation throughput and the
messages stored in ready state, but once the messages are there and then I
stop the RabbitMQ service, when I start the service again everything is
gone.

For reference I'm using this:
http://www.rabbitmq.com/blog/2011/02/10/introducing-publisher-confirms/and
http://hg.rabbitmq.com/rabbitmq-java-client/file/default/test/src/com/rabbitmq/examples/ConfirmDontLoseMessages.javaalthough
I use C# . I would like to know what I'm doing wrong.

I?m using RabbitMQ 3.1.5, Erlang R16B01

>From my understanding the consumer has nothing to do with persistance. Is
this correct?

Thanks a lot in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131128/22926da5/attachment.html>

From simon at rabbitmq.com  Thu Nov 28 15:07:14 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Thu, 28 Nov 2013 15:07:14 +0000
Subject: [rabbitmq-discuss] Messages does not survive a RabbitMQ service
 restart
In-Reply-To: <CAP4Ah2CU-VNOeb=RojVtx8+XGxDBvyiBoPcLYA3H548FUdi=jw@mail.gmail.com>
References: <CAP4Ah2CU-VNOeb=RojVtx8+XGxDBvyiBoPcLYA3H548FUdi=jw@mail.gmail.com>
Message-ID: <52975C22.9060004@rabbitmq.com>

On 28/11/13 14:56, Marcos Torres wrote:
> Hi there.
>
> The messages stored in a durable queue doesn't survive a service restart
> (I'm using windows version of Rabbit).
> I'm using message confirmation, but clearly I need to do something else.

You are not marking messages as persistent. I am no .NET expert but I 
think you need something like:

> This is how I'm publishing the messages :
>
>                  using (var channel =
> rabbitConnection.Connection.CreateModel())
>                  {
>                      channel.ConfirmSelect(); //enable confirms on channel

IBasicProperties props = channel.CreateBasicProperties();
props.DeliveryMode = 2; // Persistent

>                      foreach (var message in messages)
>                      {
>                          var serialization =
> _serializer.Serialize(message , Encoding.UTF8);

                            channel.BasicPublish(rabbitAddress.Name,
string.Empty, props, serialization);

>                      }
>                      channel.WaitForConfirms();
>                  }

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From michael.s.klishin at gmail.com  Thu Nov 28 15:10:57 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Thu, 28 Nov 2013 19:10:57 +0400
Subject: [rabbitmq-discuss] ANN Langohr 1.7.0 is released
Message-ID: <CAE3HoVRhegBVgsN_QitQV707ahQWqOA9-d0-+DuxX4e4e=snGg@mail.gmail.com>

Langohr [1] is a Clojure RabbitMQ client.

1.7.0 is primarily a bug fix release.

Release notes:
http://blog.clojurewerkz.org/blog/2013/11/28/langohr-1-dot-7-0-is-released/

1. http://clojurerabbitmq.info
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131128/8dac0b80/attachment.html>

From videlalvaro at gmail.com  Thu Nov 28 15:12:13 2013
From: videlalvaro at gmail.com (Alvaro Videla)
Date: Thu, 28 Nov 2013 16:12:13 +0100
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <919BB847-9102-4616-8F4B-C1152B8037CE@gmail.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
 <52938A1F.4010307@rabbitmq.com>
 <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
 <52947007.9060903@rabbitmq.com>
 <919BB847-9102-4616-8F4B-C1152B8037CE@gmail.com>
Message-ID: <CAMcAHLW90xnfTLf7_R9XN_1Y11C0SP3nBDmVAeWavUyzCQmeNg@mail.gmail.com>

Hi,

On Thu, Nov 28, 2013 at 2:36 PM, Paul <arachweb at gmail.com> wrote:

> My concern is that in an HA Queue implementation, a given message could be consumed more than once, i.e., once on computer A and once on B. Consequently, the same unit of work will be executed twice, and that's no good.

No. RabbitMQ will ensure that a message will be seen by just one
consumer. If a message arrived to queue Q, which is mirrored on node A
and node B, the message will be replicated across those nodes, but
still RabbitMQ will send the message to just one consumer. HA queues
have a master node and it will synchronise work with the slave queues.

Of course what Simon says above also applies. If a message got routed
to more than one queue, then that particular message could be seen by
more than one consumer, but that doesn't seem to be what you are
asking here.

For a particular queue (whether HA or not) messages are delivered just
once. If the consumer is in ack mode and it crashes before acking,
then yes, that message will be requeued and delivered again.

Also one recommendation, although not easy to achieve, is to have
idempotent consumers.

Regards,

Alvaro

From marcos.torres at gmail.com  Thu Nov 28 15:19:22 2013
From: marcos.torres at gmail.com (Marcos Torres)
Date: Thu, 28 Nov 2013 13:19:22 -0200
Subject: [rabbitmq-discuss] Messages does not survive a RabbitMQ service
	restart
In-Reply-To: <52975C22.9060004@rabbitmq.com>
References: <CAP4Ah2CU-VNOeb=RojVtx8+XGxDBvyiBoPcLYA3H548FUdi=jw@mail.gmail.com>
 <52975C22.9060004@rabbitmq.com>
Message-ID: <CAP4Ah2DD715w7hF5QXEcKbrdKymna1qSiA4KXV63CMNhaUOLHQ@mail.gmail.com>

Thank you sir, works great.

Cheers.


On Thu, Nov 28, 2013 at 12:07 PM, Simon MacMullen <simon at rabbitmq.com>wrote:

> On 28/11/13 14:56, Marcos Torres wrote:
>
>> Hi there.
>>
>> The messages stored in a durable queue doesn't survive a service restart
>> (I'm using windows version of Rabbit).
>> I'm using message confirmation, but clearly I need to do something else.
>>
>
> You are not marking messages as persistent. I am no .NET expert but I
> think you need something like:
>
>
>  This is how I'm publishing the messages :
>>
>>                  using (var channel =
>> rabbitConnection.Connection.CreateModel())
>>                  {
>>                      channel.ConfirmSelect(); //enable confirms on channel
>>
>
> IBasicProperties props = channel.CreateBasicProperties();
> props.DeliveryMode = 2; // Persistent
>
>
>                       foreach (var message in messages)
>>                      {
>>                          var serialization =
>> _serializer.Serialize(message , Encoding.UTF8);
>>
>
>                            channel.BasicPublish(rabbitAddress.Name,
> string.Empty, props, serialization);
>
>                       }
>>                      channel.WaitForConfirms();
>>                  }
>>
>
> Cheers, Simon
>
> --
> Simon MacMullen
> RabbitMQ, Pivotal
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131128/ca8a7fff/attachment.html>

From darren at ontrenet.com  Thu Nov 28 15:45:35 2013
From: darren at ontrenet.com (Darren Govoni)
Date: Thu, 28 Nov 2013 10:45:35 -0500
Subject: [rabbitmq-discuss] Cluster capability?
In-Reply-To: <CAMcAHLW90xnfTLf7_R9XN_1Y11C0SP3nBDmVAeWavUyzCQmeNg@mail.gmail.com>
References: <F8DC160B-0789-4D7B-86AE-ECC39B1D2B39@gmail.com>
 <52938A1F.4010307@rabbitmq.com>
 <CA+ttMd-KUQu+x1_T6=s3BQSVS0sc4cct-Q49qLSf0RR1zw3P-w@mail.gmail.com>
 <52947007.9060903@rabbitmq.com>
 <919BB847-9102-4616-8F4B-C1152B8037CE@gmail.com>
 <CAMcAHLW90xnfTLf7_R9XN_1Y11C0SP3nBDmVAeWavUyzCQmeNg@mail.gmail.com>
Message-ID: <5297651F.7010801@ontrenet.com>

It should also be noted that if the "master" node for an HA queue 
becomes inactive a new one is elected.

On 11/28/2013 10:12 AM, Alvaro Videla wrote:
> Hi,
>
> On Thu, Nov 28, 2013 at 2:36 PM, Paul <arachweb at gmail.com> wrote:
>
>> My concern is that in an HA Queue implementation, a given message could be consumed more than once, i.e., once on computer A and once on B. Consequently, the same unit of work will be executed twice, and that's no good.
> No. RabbitMQ will ensure that a message will be seen by just one
> consumer. If a message arrived to queue Q, which is mirrored on node A
> and node B, the message will be replicated across those nodes, but
> still RabbitMQ will send the message to just one consumer. HA queues
> have a master node and it will synchronise work with the slave queues.
>
> Of course what Simon says above also applies. If a message got routed
> to more than one queue, then that particular message could be seen by
> more than one consumer, but that doesn't seem to be what you are
> asking here.
>
> For a particular queue (whether HA or not) messages are delivered just
> once. If the consumer is in ack mode and it crashes before acking,
> then yes, that message will be requeued and delivered again.
>
> Also one recommendation, although not easy to achieve, is to have
> idempotent consumers.
>
> Regards,
>
> Alvaro
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From khamenya at gmail.com  Thu Nov 28 12:38:55 2013
From: khamenya at gmail.com (Valery Khamenya)
Date: Thu, 28 Nov 2013 04:38:55 -0800 (PST)
Subject: [rabbitmq-discuss] messages over 22kbytes cause basic_publish() to
	hang
Message-ID: <f6702437-8b6d-4ca6-af46-5d174c049297@googlegroups.com>

Hi all,

as subject says, messages over 22kbytes cause basic_publish() to hang 
somewhere in its inner _rpc call.

I'd be thankful for any hints on how to get rid of this issue.

Producer details:
  messages are sent using Python 2.7.3
  pika 0.9.13
  ubuntu 12.04.3

RabbitMQ server details: 
  ubuntu 12.04.3
  rabbitmq-server 3.2.1-1

both producer peer and the RabbitMQ server have enough RAM, so it is not a 
RAM-issue mentioned around.
Also, this is a single message shot, so, it is not a performance issue (not 
a "message flooding" case)

kind regards,
Valery
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131128/1f4987d5/attachment.html>

From frank.shearar at gmail.com  Thu Nov 28 16:26:57 2013
From: frank.shearar at gmail.com (Frank Shearar)
Date: Thu, 28 Nov 2013 16:26:57 +0000
Subject: [rabbitmq-discuss] Messages does not survive a RabbitMQ service
	restart
In-Reply-To: <CAP4Ah2CU-VNOeb=RojVtx8+XGxDBvyiBoPcLYA3H548FUdi=jw@mail.gmail.com>
References: <CAP4Ah2CU-VNOeb=RojVtx8+XGxDBvyiBoPcLYA3H548FUdi=jw@mail.gmail.com>
Message-ID: <CAJbhyRGcPg6wK5OSkBmomnSCxNKmY7MRkSSaixiO3BVRJRYyzw@mail.gmail.com>

On 28 November 2013 14:56, Marcos Torres <marcos.torres at gmail.com> wrote:
> Hi there.
>
> The messages stored in a durable queue doesn't survive a service restart
> (I'm using windows version of Rabbit).
> I'm using message confirmation, but clearly I need to do something else.

A durable _queue_ means that the queue definition survives a reboot. A
_persistent message_ is stored on disk, and will still be there after
a reboot.

frank

From marcos.torres at gmail.com  Thu Nov 28 17:36:10 2013
From: marcos.torres at gmail.com (Marcos Torres)
Date: Thu, 28 Nov 2013 15:36:10 -0200
Subject: [rabbitmq-discuss] Messages does not survive a RabbitMQ service
	restart
In-Reply-To: <CAJbhyRGcPg6wK5OSkBmomnSCxNKmY7MRkSSaixiO3BVRJRYyzw@mail.gmail.com>
References: <CAP4Ah2CU-VNOeb=RojVtx8+XGxDBvyiBoPcLYA3H548FUdi=jw@mail.gmail.com>
 <CAJbhyRGcPg6wK5OSkBmomnSCxNKmY7MRkSSaixiO3BVRJRYyzw@mail.gmail.com>
Message-ID: <CAP4Ah2D3OYR9r=SQL_Bjr=83PFDDbJ2qrd70qDuN4GLMp0iTaA@mail.gmail.com>

Yep, i missed that part. I though initially that a message confirmation was
enough to persists a message. Once I set the message properties as Simon
suggested started working.




On Thu, Nov 28, 2013 at 1:26 PM, Frank Shearar <frank.shearar at gmail.com>wrote:

> On 28 November 2013 14:56, Marcos Torres <marcos.torres at gmail.com> wrote:
> > Hi there.
> >
> > The messages stored in a durable queue doesn't survive a service restart
> > (I'm using windows version of Rabbit).
> > I'm using message confirmation, but clearly I need to do something else.
>
> A durable _queue_ means that the queue definition survives a reboot. A
> _persistent message_ is stored on disk, and will still be there after
> a reboot.
>
> frank
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131128/6e74c6bb/attachment.html>

From jkuch at gopivotal.com  Thu Nov 28 18:06:08 2013
From: jkuch at gopivotal.com (Jerry Kuch)
Date: Thu, 28 Nov 2013 10:06:08 -0800
Subject: [rabbitmq-discuss] Messages does not survive a RabbitMQ service
	restart
In-Reply-To: <CAP4Ah2D3OYR9r=SQL_Bjr=83PFDDbJ2qrd70qDuN4GLMp0iTaA@mail.gmail.com>
References: <CAP4Ah2CU-VNOeb=RojVtx8+XGxDBvyiBoPcLYA3H548FUdi=jw@mail.gmail.com>
 <CAJbhyRGcPg6wK5OSkBmomnSCxNKmY7MRkSSaixiO3BVRJRYyzw@mail.gmail.com>
 <CAP4Ah2D3OYR9r=SQL_Bjr=83PFDDbJ2qrd70qDuN4GLMp0iTaA@mail.gmail.com>
Message-ID: <CANOx8N=05rJi+d5Gn3J24BL3t_joHUTcVnw7KS_U2+cQZS5owg@mail.gmail.com>

A key thing to remember, and an easy thing to forget, is that a publisher
confirm is only confirming that what you ASKED FOR has been done by the
broker and the scope of what's being knowledge depends on what you
demanded...

Also the "durable" and "persistent" verbiage, given that those sound like
near synonyms to most ears in most contexts, trips folks up all the time...




On Thu, Nov 28, 2013 at 9:36 AM, Marcos Torres <marcos.torres at gmail.com>wrote:

> Yep, i missed that part. I though initially that a message confirmation
> was enough to persists a message. Once I set the message properties as
> Simon suggested started working.
>
>
>
>
> On Thu, Nov 28, 2013 at 1:26 PM, Frank Shearar <frank.shearar at gmail.com>wrote:
>
>> On 28 November 2013 14:56, Marcos Torres <marcos.torres at gmail.com> wrote:
>> > Hi there.
>> >
>> > The messages stored in a durable queue doesn't survive a service restart
>> > (I'm using windows version of Rabbit).
>> > I'm using message confirmation, but clearly I need to do something else.
>>
>> A durable _queue_ means that the queue definition survives a reboot. A
>> _persistent message_ is stored on disk, and will still be there after
>> a reboot.
>>
>> frank
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131128/0d5b151b/attachment.html>

From normand.bedard at gmail.com  Thu Nov 28 19:46:28 2013
From: normand.bedard at gmail.com (=?UTF-8?Q?Normand_B=C3=A9dard?=)
Date: Thu, 28 Nov 2013 11:46:28 -0800 (PST)
Subject: [rabbitmq-discuss] HA Clustering fails to keep message when node
	turn down.
Message-ID: <3c64d0ff-4d09-480e-924b-b00fc2ce8d6e@googlegroups.com>

I am using RabbitMQ 3.1.5 Erlang R15B03. I have two nodes (Node1 and 
Node2). Both are Disc Type. Also, there is a ha-all policy on my virtual 
host.

When I manually create a queue via the Node1 Web Console, I see the "+1" 
label indicating that my queue is mirrored on the two nodes (Node: Node 1, 
Mirrors: Node 2).

Via the Node 1 Web Console, I manually created a message on the queue. 
After that, from both web consoles, I can access my message from the queue. 

When I reboot the server where Node 2 is hosted, the Node 2 Web Console is 
unreachable, and from the Node 1 Web Console, I can confirm the node is 
down. Still from the Node 1 Web Console, I can access my message from the 
mirrored queue. When the Node 2 server is back online, I see that the nodes 
are not synchronized, meaning that new messages arrived on Node 1 during 
the Node 2 shutdown won't be replicated on Node 2. This is the normal 
behavior. Also from the Node 2 Web Console, I can still access my initial 
message. Everything is fine!

Here is my problem...

When I reboot the Node 1 server, I observe all the same behaviors as in my 
previous test where I shutdown Node 2 server, but during the time the Node 
1 is down, there is no messages available from the Node Web Console (but 
the queue is still accessible). 

Why this is happening? The message is not supposed to be persisted on each 
nodes when they are mirrored?





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131128/ddc292ff/attachment.html>

From Punit.Jain at emc.com  Thu Nov 28 20:20:52 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Thu, 28 Nov 2013 15:20:52 -0500
Subject: [rabbitmq-discuss] RabbitMQ error
Message-ID: <DB14E94115BBC84E8960C12C176D06760177C6B4DD@MX25A.corp.emc.com>

Hi,
I see following error in the logs file. What could be the reason for this?

=WARNING REPORT==== 28-Nov-2013::13:34:55 ===
closing AMQP connection <0.377.0> (127.0.0.1:5458 -> 127.0.0.1:5672):
connection_closed_abruptly

=WARNING REPORT==== 28-Nov-2013::13:34:55 ===
closing AMQP connection <0.389.0> (127.0.0.1:5459 -> 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 28-Nov-2013::13:35:01 ===
Stopping RabbitMQ

=WARNING REPORT==== 28-Nov-2013::13:35:01 ===
Connection (<0.2316.0>) closing: internal error in channel (<0.2323.0>): shutdown

=INFO REPORT==== 28-Nov-2013::13:35:01 ===
stopped TCP Listener on [::]:5672

=INFO REPORT==== 28-Nov-2013::13:35:36 ===
Halting Erlang VM

=INFO REPORT==== 28-Nov-2013::13:35:41 ===
Error description:
   {error,
       {cannot_delete_plugins_expand_dir,
           ["/var/lib/rabbitmq/mnesia/rabbit at localhost-plugins-expand",
            {cannot_delete,
                "/var/lib/rabbitmq/mnesia/rabbit at localhost-plugins-expand/mochiweb-2.3.1-rmq3.1.3-gitd541e9a/ebin",
                enoent}]}}

Log files (may contain more information):
   /var/log/rabbitmq/rabbit at localhost.log
   /var/log/rabbitmq/rabbit at localhost-sasl.log

Stack trace:
   [{rabbit_plugins,prepare_plugins,3,[]},
    {rabbit,'-boot/0-fun-1-',0,[]},
    {rabbit,start_it,1,[]},
    {init,start_it,1,[]},
    {init,start_em,1,[]}]


Thanks,
Punit
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131128/222cb869/attachment.html>

From 314992959 at qq.com  Fri Nov 29 02:47:39 2013
From: 314992959 at qq.com (3k4b251)
Date: Thu, 28 Nov 2013 18:47:39 -0800 (PST)
Subject: [rabbitmq-discuss] rabbitmq cluster error: join_cluster Error:
 mnesia_unexpectedly_running
Message-ID: <1385693259173-31719.post@n5.nabble.com>

I  try  to  make   cluster   on  one   pc.   I  create   two  node  
rabbit at localhost   and  rabbit2 at localhost .  then   I  try   rabbitmqctl.bat  
join_cluster   --ram  rabbit2 at localhost   But   I  get  the  error notify: 

 join_cluster Error: mnesia_unexpectedly_running

So  I  try  to  see  http://www.rabbitmq.com/clustering.html#creating  . 
then  I  get  the  information  I  need  to  make  erlang.coockie  same
value.  But   I  only  cluster   on   one   pc.  So  I  still  have the
proble m?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-cluster-error-join-cluster-Error-mnesia-unexpectedly-running-tp31719.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From woodslee at 126.com  Fri Nov 29 03:00:41 2013
From: woodslee at 126.com (woodslee)
Date: Fri, 29 Nov 2013 11:00:41 +0800
Subject: [rabbitmq-discuss] rabbitmq cluster error: join_cluster
	Error:mnesia_unexpectedly_running
References: <1385693259173-31719.post@n5.nabble.com>
Message-ID: <DM__131129105338_68858850423@smtp.feinno.com>

hi 3k4b251:

You can try to do this:

1?rabbitmqctl.bat -n rabbit at localhost stop_app
2?rabbitmqctl.bat -n rabbit at localhost reset
3?rabbitmqctl.bat -n rabbit at localhost join_cluster rabbit2 at localhost

PS. I remenber i had read in some document that in rabbitmq3, step 2 is not needed, but some time it is effective in my experience.

woodslee?woodslee at 126.com
2013-11-29 
----- Original Message ----- 
From: 3k4b251 
To: rabbitmq-discuss 
Sent: 2013-11-29, 10:47:39
Subject: [rabbitmq-discuss] rabbitmq cluster error: join_cluster Error:mnesia_unexpectedly_running


I try to make cluster on one pc. I create two node 
rabbit at localhost and rabbit2 at localhost . then I try rabbitmqctl.bat 
join_cluster --ram rabbit2 at localhost But I get the error notify: 

 join_cluster Error: mnesia_unexpectedly_running

So I try to see http://www.rabbitmq.com/clustering.html#creating . 
then I get the information I need to make erlang.coockie same
value. But I only cluster on one pc. So I still have the
proble m?



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/rabbitmq-cluster-error-join-cluster-Error-mnesia-unexpectedly-running-tp31719.html
Sent from the RabbitMQ mailing list archive at Nabble.com.
_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131129/0a269496/attachment.html>

From michael.s.klishin at gmail.com  Fri Nov 29 09:13:43 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Fri, 29 Nov 2013 13:13:43 +0400
Subject: [rabbitmq-discuss] messages over 22kbytes cause basic_publish()
 to hang
In-Reply-To: <f6702437-8b6d-4ca6-af46-5d174c049297@googlegroups.com>
References: <f6702437-8b6d-4ca6-af46-5d174c049297@googlegroups.com>
Message-ID: <CAE3HoVRwy4rNMuSRB9ELoHQeVP4z2_9a+NNTyEGWsvG4vZb6YQ@mail.gmail.com>

2013/11/28 Valery Khamenya <khamenya at gmail.com>

> both producer peer and the RabbitMQ server have enough RAM, so it is not a
> RAM-issue mentioned around.
> Also, this is a single message shot, so, it is not a performance issue
> (not a "message flooding" case)
>

Is there anything in the Rabbit log?
Can you provide a script that reproduces the problem?
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131129/527d5db6/attachment.html>

From nicholasastuart at gmail.com  Fri Nov 29 05:20:48 2013
From: nicholasastuart at gmail.com (Nicholas A. Stuart)
Date: Thu, 28 Nov 2013 23:20:48 -0600 (CST)
Subject: [rabbitmq-discuss] Policy for dead letter exchange routing back
 to queue
In-Reply-To: <5297157A.9080901@rabbitmq.com>
Message-ID: <29073725.23.1385702444578.JavaMail.Nicholas@Behemoth>

I'm trying to mimic the retry policy of ActiveMQ, where I can requeue a message if it fails a certain criteria(reject with requeue), but I want to only requeue it 5 times. I know that using a DLX/DLQ and rejecting a message without requeue will create an x-death header that will provide a count for the number of times failed. 

To give you an example, we're consuming messages from a queue in order to send them to web services(old architecture, cannot change). There are times where the web service may be down, so if it is, we'd like to requeue the message, but if the message has been tried 5 times, we'd like to just put it into another queue for later. We like the reject ability as it guarantees that it fails or succeeds for us atomically, but RabbitMQ/AMQP doesn't provide any type of retry/requeue count, except with the x-death property which provides us some insight into the failure of the message. 

----- Original Message -----
From: "Simon MacMullen" <simon at rabbitmq.com>
To: "Discussions about RabbitMQ" <rabbitmq-discuss at lists.rabbitmq.com>
Cc: "Nicholas Stuart" <nicholasastuart at gmail.com>
Sent: Thursday, November 28, 2013 4:05:46 AM
Subject: Re: [rabbitmq-discuss] Policy for dead letter exchange routing back to queue

On 27/11/13 15:25, Nicholas Stuart wrote:
> I've successfully set up a dead letter exchange policy where
> the|dead-letter-exchange|is blank, which will return the message to the
> original queue. However this only happens if the message was published
> to the default exchange, or with a routing key of the queue name.
>
> If I set up a fanout or topic exchange, my message is dropped(rightfully
> so). Is there any way, in the RabbitMQ policy, that I can specify a
> routing key policy that will always point back to the queue the message
> was consumed off of?

No, there isn't. Unless you want to create one policy per queue in which 
case you can set dead-letter-routing-key of course.

Why do you want to dead-letter back to the original queue?

Cheers, Simon

-- 
Simon MacMullen
RabbitMQ, Pivotal

From emile at rabbitmq.com  Fri Nov 29 09:26:29 2013
From: emile at rabbitmq.com (Emile Joubert)
Date: Fri, 29 Nov 2013 09:26:29 +0000
Subject: [rabbitmq-discuss] Configuration strategy
In-Reply-To: <CALPqkio+9Oz1XZyc55AvNH+Ya6zokGfw4A5+Vhd8cA3eD5V1tg@mail.gmail.com>
References: <32ad3a77-a339-4055-8a00-8089de403ef1@googlegroups.com>
 <CALPqkio+9Oz1XZyc55AvNH+Ya6zokGfw4A5+Vhd8cA3eD5V1tg@mail.gmail.com>
Message-ID: <52985DC5.4080301@rabbitmq.com>


To add to what Brett said, you can withhold permissions to prevent
clients from managing broker resources. Durable resources that are
defined by an administrator will remain in place. You can also set
resources up using the management plugin:

http://www.rabbitmq.com/management.html#load-definitions




-Emile


On 28/11/13 00:23, Brett Cameron wrote:
> Adrien,
> 
> While AMQP allows suitably privileged clients (producers, consumers) to
> perform some configuration functions, you certainly do not have to
> design things to work in this way. For example, you could use a facility
> such as the RabbitMQ management plugin to create queues, exchanges, and
> bindings, and give your producers and consumers just the permissions
> they need in order to publish and consume messages - it's entirely up to
> you and your particular needs/requirements.
> 
> Brett
> 
> 
> 
> On Thu, Nov 28, 2013 at 10:41 AM, Adrien Brault <monsti at gmail.com
> <mailto:monsti at gmail.com>> wrote:
> 
>     Hey,
> 
>     I've read the getting started tutorials and am bothered with one
>     aspect: publishers and consumers configures rabbitmq. I understand
>     that those configuration requests are idempotent, however it seems
>     weird to let the application(s) configure rabbitmq.
> 
>     I don't think a publisher should be aware of the exchange type, and
>     a consumer should not be aware of bindings. Though I understand that
>     some pattern requires the application to create
>     exchanges/queues/binding (like RPC).
> 
>     Is there a tool to have some configuration file for the server ?
>     My goal would be that publishers only know what kind of message to
>     send to a specific exchange, and consumer know what kind of message
>     to get from a specific queue.
> 
>     What do you think ? How do you handle the queue/exchange creation
>     and binding logic in big application(s) ?

From watson.timothy at gmail.com  Fri Nov 29 09:58:45 2013
From: watson.timothy at gmail.com (Tim Watson)
Date: Fri, 29 Nov 2013 09:58:45 +0000
Subject: [rabbitmq-discuss] RabbitMQ error
In-Reply-To: <DB14E94115BBC84E8960C12C176D06760177C6B4DD@MX25A.corp.emc.com>
References: <DB14E94115BBC84E8960C12C176D06760177C6B4DD@MX25A.corp.emc.com>
Message-ID: <BCA20A6B-AB9E-400A-A0FE-22F6A10C9D82@rabbitmq.com>

It indicates that a client severed it's connection without going through the proper disconnect sequence outlined by the protocol. It is an informational log message rather than a serious error.

On 28 Nov 2013, at 20:20, "Jain, Punit" <Punit.Jain at emc.com> wrote:

> Hi,
> I see following error in the logs file. What could be the reason for this?
>  
> =WARNING REPORT==== 28-Nov-2013::13:34:55 ===
> closing AMQP connection <0.377.0> (127.0.0.1:5458 -> 127.0.0.1:5672):
> connection_closed_abruptly
>  
> =WARNING REPORT==== 28-Nov-2013::13:34:55 ===
> closing AMQP connection <0.389.0> (127.0.0.1:5459 -> 127.0.0.1:5672):
> connection_closed_abruptly
>  
> =INFO REPORT==== 28-Nov-2013::13:35:01 ===
> Stopping RabbitMQ
>  
> =WARNING REPORT==== 28-Nov-2013::13:35:01 ===
> Connection (<0.2316.0>) closing: internal error in channel (<0.2323.0>): shutdown
>  
> =INFO REPORT==== 28-Nov-2013::13:35:01 ===
> stopped TCP Listener on [::]:5672
>  
> =INFO REPORT==== 28-Nov-2013::13:35:36 ===
> Halting Erlang VM
>  
> =INFO REPORT==== 28-Nov-2013::13:35:41 ===
> Error description:
>    {error,
>        {cannot_delete_plugins_expand_dir,
>            ["/var/lib/rabbitmq/mnesia/rabbit at localhost-plugins-expand",
>             {cannot_delete,
>                 "/var/lib/rabbitmq/mnesia/rabbit at localhost-plugins-expand/mochiweb-2.3.1-rmq3.1.3-gitd541e9a/ebin",
>                 enoent}]}}
>  
> Log files (may contain more information):
>    /var/log/rabbitmq/rabbit at localhost.log
>    /var/log/rabbitmq/rabbit at localhost-sasl.log
>  
> Stack trace:
>    [{rabbit_plugins,prepare_plugins,3,[]},
>     {rabbit,'-boot/0-fun-1-',0,[]},
>     {rabbit,start_it,1,[]},
>     {init,start_it,1,[]},
>     {init,start_em,1,[]}]
>  
>  
> Thanks,
> Punit
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131129/8e8b1ced/attachment.html>

From frank.shearar at gmail.com  Fri Nov 29 11:56:47 2013
From: frank.shearar at gmail.com (Frank Shearar)
Date: Fri, 29 Nov 2013 11:56:47 +0000
Subject: [rabbitmq-discuss] RabbitMQ error
In-Reply-To: <BCA20A6B-AB9E-400A-A0FE-22F6A10C9D82@rabbitmq.com>
References: <DB14E94115BBC84E8960C12C176D06760177C6B4DD@MX25A.corp.emc.com>
 <BCA20A6B-AB9E-400A-A0FE-22F6A10C9D82@rabbitmq.com>
Message-ID: <CAJbhyRF7XFqC4j8jWHUHCL+N6DbW1BPXSKc9yuT1AE-E7BMSPQ@mail.gmail.com>

Er, I suspect the OP's talking about the cannot_delete_plugins_expand_dir error?

frank

On 29 November 2013 09:58, Tim Watson <watson.timothy at gmail.com> wrote:
> It indicates that a client severed it's connection without going through the
> proper disconnect sequence outlined by the protocol. It is an informational
> log message rather than a serious error.
>
> On 28 Nov 2013, at 20:20, "Jain, Punit" <Punit.Jain at emc.com> wrote:
>
> Hi,
>
> I see following error in the logs file. What could be the reason for this?
>
>
>
> =WARNING REPORT==== 28-Nov-2013::13:34:55 ===
>
> closing AMQP connection <0.377.0> (127.0.0.1:5458 -> 127.0.0.1:5672):
>
> connection_closed_abruptly
>
>
>
> =WARNING REPORT==== 28-Nov-2013::13:34:55 ===
>
> closing AMQP connection <0.389.0> (127.0.0.1:5459 -> 127.0.0.1:5672):
>
> connection_closed_abruptly
>
>
>
> =INFO REPORT==== 28-Nov-2013::13:35:01 ===
>
> Stopping RabbitMQ
>
>
>
> =WARNING REPORT==== 28-Nov-2013::13:35:01 ===
>
> Connection (<0.2316.0>) closing: internal error in channel (<0.2323.0>):
> shutdown
>
>
>
> =INFO REPORT==== 28-Nov-2013::13:35:01 ===
>
> stopped TCP Listener on [::]:5672
>
>
>
> =INFO REPORT==== 28-Nov-2013::13:35:36 ===
>
> Halting Erlang VM
>
>
>
> =INFO REPORT==== 28-Nov-2013::13:35:41 ===
>
> Error description:
>
>    {error,
>
>        {cannot_delete_plugins_expand_dir,
>
>            ["/var/lib/rabbitmq/mnesia/rabbit at localhost-plugins-expand",
>
>             {cannot_delete,
>
>
> "/var/lib/rabbitmq/mnesia/rabbit at localhost-plugins-expand/mochiweb-2.3.1-rmq3.1.3-gitd541e9a/ebin",
>
>                 enoent}]}}
>
>
>
> Log files (may contain more information):
>
>    /var/log/rabbitmq/rabbit at localhost.log
>
>    /var/log/rabbitmq/rabbit at localhost-sasl.log
>
>
>
> Stack trace:
>
>    [{rabbit_plugins,prepare_plugins,3,[]},
>
>     {rabbit,'-boot/0-fun-1-',0,[]},
>
>     {rabbit,start_it,1,[]},
>
>     {init,start_it,1,[]},
>
>     {init,start_em,1,[]}]
>
>
>
>
>
> Thanks,
>
> Punit
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

From simon at rabbitmq.com  Fri Nov 29 09:42:15 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 29 Nov 2013 09:42:15 +0000
Subject: [rabbitmq-discuss] HA Clustering fails to keep message when
 node turn down.
In-Reply-To: <3c64d0ff-4d09-480e-924b-b00fc2ce8d6e@googlegroups.com>
References: <3c64d0ff-4d09-480e-924b-b00fc2ce8d6e@googlegroups.com>
Message-ID: <52986177.5060704@rabbitmq.com>

On 28/11/2013 19:46, Normand B?dard wrote:
> When the Node 2 server is back online, I see that
> the nodes are not synchronized, meaning that new messages arrived on
> Node 1 during the Node 2 shutdown won't be replicated on Node 2.

*And* that any messages that were on node 2 before it shut down have 
been lost (since node 2 has no way of knowing what node 1 has done with 
them while it was down, it can't just keep all of them).

> When I reboot the Node 1 server, I observe all the same behaviors as in
> my previous test where I shutdown Node 2 server, but during the time the
> Node 1 is down, there is no messages available from the Node Web Console
> (but the queue is still accessible).

...so now the messages are lost on node 2 and node 1.

See http://www.rabbitmq.com/ha.html#unsynchronised-slaves and 
http://www.rabbitmq.com/ha.html#eager-synchronisation

Cheers, Simon

From tim at rabbitmq.com  Fri Nov 29 12:05:36 2013
From: tim at rabbitmq.com (Tim Watson)
Date: Fri, 29 Nov 2013 12:05:36 +0000
Subject: [rabbitmq-discuss] RabbitMQ error
In-Reply-To: <CAJbhyRF7XFqC4j8jWHUHCL+N6DbW1BPXSKc9yuT1AE-E7BMSPQ@mail.gmail.com>
References: <DB14E94115BBC84E8960C12C176D06760177C6B4DD@MX25A.corp.emc.com>
 <BCA20A6B-AB9E-400A-A0FE-22F6A10C9D82@rabbitmq.com>
 <CAJbhyRF7XFqC4j8jWHUHCL+N6DbW1BPXSKc9yuT1AE-E7BMSPQ@mail.gmail.com>
Message-ID: <AF09CB45-F1E9-4EC0-AEEE-7EBEFF206209@rabbitmq.com>

Erm yes, sorry about that everyone - trying to read email in emacs and the bottom of the email didn't display properly.

To the OP - that error indicates that something (in this case, a missing directory) went wrong whilst trying to recursively delete the plugins-expand directory (into which plugins are unpacked when enabled). If you're getting stuck with this, you can manually remove (i.e., `rm -rf`) /var/lib/rabbitmq/mnesia/rabbit at localhost-plugins-expand and everything should be fine.

Sorry for the confusion!

Tim

On 29 Nov 2013, at 11:56, Frank Shearar wrote:

> Er, I suspect the OP's talking about the cannot_delete_plugins_expand_dir error?
> 
> frank
> 
> On 29 November 2013 09:58, Tim Watson <watson.timothy at gmail.com> wrote:
>> It indicates that a client severed it's connection without going through the
>> proper disconnect sequence outlined by the protocol. It is an informational
>> log message rather than a serious error.
>> 
>> On 28 Nov 2013, at 20:20, "Jain, Punit" <Punit.Jain at emc.com> wrote:
>> 
>> Hi,
>> 
>> I see following error in the logs file. What could be the reason for this?
>> 
>> 
>> 
>> =WARNING REPORT==== 28-Nov-2013::13:34:55 ===
>> 
>> closing AMQP connection <0.377.0> (127.0.0.1:5458 -> 127.0.0.1:5672):
>> 
>> connection_closed_abruptly
>> 
>> 
>> 
>> =WARNING REPORT==== 28-Nov-2013::13:34:55 ===
>> 
>> closing AMQP connection <0.389.0> (127.0.0.1:5459 -> 127.0.0.1:5672):
>> 
>> connection_closed_abruptly
>> 
>> 
>> 
>> =INFO REPORT==== 28-Nov-2013::13:35:01 ===
>> 
>> Stopping RabbitMQ
>> 
>> 
>> 
>> =WARNING REPORT==== 28-Nov-2013::13:35:01 ===
>> 
>> Connection (<0.2316.0>) closing: internal error in channel (<0.2323.0>):
>> shutdown
>> 
>> 
>> 
>> =INFO REPORT==== 28-Nov-2013::13:35:01 ===
>> 
>> stopped TCP Listener on [::]:5672
>> 
>> 
>> 
>> =INFO REPORT==== 28-Nov-2013::13:35:36 ===
>> 
>> Halting Erlang VM
>> 
>> 
>> 
>> =INFO REPORT==== 28-Nov-2013::13:35:41 ===
>> 
>> Error description:
>> 
>>   {error,
>> 
>>       {cannot_delete_plugins_expand_dir,
>> 
>>           ["/var/lib/rabbitmq/mnesia/rabbit at localhost-plugins-expand",
>> 
>>            {cannot_delete,
>> 
>> 
>> "/var/lib/rabbitmq/mnesia/rabbit at localhost-plugins-expand/mochiweb-2.3.1-rmq3.1.3-gitd541e9a/ebin",
>> 
>>                enoent}]}}
>> 
>> 
>> 
>> Log files (may contain more information):
>> 
>>   /var/log/rabbitmq/rabbit at localhost.log
>> 
>>   /var/log/rabbitmq/rabbit at localhost-sasl.log
>> 
>> 
>> 
>> Stack trace:
>> 
>>   [{rabbit_plugins,prepare_plugins,3,[]},
>> 
>>    {rabbit,'-boot/0-fun-1-',0,[]},
>> 
>>    {rabbit,start_it,1,[]},
>> 
>>    {init,start_it,1,[]},
>> 
>>    {init,start_em,1,[]}]
>> 
>> 
>> 
>> 
>> 
>> Thanks,
>> 
>> Punit
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon at rabbitmq.com  Fri Nov 29 11:55:05 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 29 Nov 2013 11:55:05 +0000
Subject: [rabbitmq-discuss] rabbitmq cluster error: join_cluster
	Error:mnesia_unexpectedly_running
In-Reply-To: <DM__131129105338_68858850423@smtp.feinno.com>
References: <1385693259173-31719.post@n5.nabble.com>
 <DM__131129105338_68858850423@smtp.feinno.com>
Message-ID: <52988099.1020801@rabbitmq.com>

Well, reset really should not be necessary. But the stop_app absolutely 
is (and start_app again afterwards); that's what 
mnesia_unexpectedly_running is saying.

Cheers, Simon

On 29/11/2013 03:00, woodslee wrote:
> hi 3k4b251:
> You can try to do this:
> 1?rabbitmqctl.bat -n rabbit at localhost <mailto:rabbit at localhost> stop_app
> 2?rabbitmqctl.bat -n rabbit at localhost <mailto:rabbit at localhost> reset
> 3?rabbitmqctl.bat -n rabbit at localhost <mailto:rabbit at localhost>
> join_cluster rabbit2 at localhost <mailto:rabbit2 at localhost>
> PS. I remenber i had read in some document that in rabbitmq3, step 2 is
> not needed, but some time it is effective in my experience.
> woodslee?woodslee at 126.com <mailto:woodslee at 126.com>
> 2013-11-29
>
>     ----- Original Message -----
>     *From: *3k4b251 <mailto:314992959 at qq.com>
>     *To: *rabbitmq-discuss <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>     *Sent: *2013-11-29, 10:47:39
>     *Subject: *[rabbitmq-discuss] rabbitmq cluster error: join_cluster
>     Error:mnesia_unexpectedly_running
>
>     I try to make cluster on one pc. I create two node
>     rabbit at localhost and rabbit2 at localhost . then I try rabbitmqctl.bat
>     join_cluster --ram rabbit2 at localhost But I get the error notify:
>
>       join_cluster Error: mnesia_unexpectedly_running
>
>     So I try to see http://www.rabbitmq.com/clustering.html#creating .
>     then I get the information I need to make erlang.coockie same
>     value. But I only cluster on one pc. So I still have the
>     proble m?
>
>
>
>     --
>     View this message in context:
>     http://rabbitmq.1065348.n5.nabble.com/rabbitmq-cluster-error-join-cluster-Error-mnesia-unexpectedly-running-tp31719.html
>     Sent from the RabbitMQ mailing list archive at Nabble.com.
>     _______________________________________________
>     rabbitmq-discuss mailing list
>     rabbitmq-discuss at lists.rabbitmq.com <mailto:
>     rabbitmq-discuss at lists.rabbitmq.com>
>     https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Fri Nov 29 11:46:40 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 29 Nov 2013 11:46:40 +0000
Subject: [rabbitmq-discuss] Feature Req / Bug list
In-Reply-To: <CAJ4uuZbYqXov-uPYT2evAq8rcCZhRX5wYM7Fmb6OSCMgcyMDoQ@mail.gmail.com>
References: <CAJ4uuZZnWrC9tp9V+D021AvPDHDKzfXGChvG+OPgD8E8W-tYMw@mail.gmail.com>
 <CAJ4uuZYNy3kyCtm1sWbRdaprWkOQ4O8KMhBNFwxafg6zbMSX3g@mail.gmail.com>
 <F573E81A-8BD2-4F9A-8643-ABB67E97773E@rabbitmq.com>
 <CAJ4uuZYUqGeBRVEbacpGPeyHxFP2S9F7PND8KPQakjMg9Whgrg@mail.gmail.com>
 <526ECAD9.2030703@rabbitmq.com>
 <CAJ4uuZYmom2AjYrsYOVxDNfkuK4VVhqoEyFqG5c7f+th-Xdx5w@mail.gmail.com>
 <526ED167.1010308@rabbitmq.com>
 <CAJ4uuZb1kd8dQ1c3=o-mzHvYzUNrHcwUxFU8VvEOurUG7EFtfQ@mail.gmail.com>
 <CAJ4uuZbc13rs9SCmU64K9ant630Z+1j1x-Ss2MRBh7fQnnEXdA@mail.gmail.com>
 <5277A9A3.3060708@rabbitmq.com>
 <CAJ4uuZbAMR3LB4-sG517sLwb=bxzHNir4yx-9zr_+OnrorQ9qw@mail.gmail.com>
 <CAJ4uuZY0agfwfjChtes3LHsTmADhs2ZnTUR557=ir5-Lbk20sg@mail.gmail.com>
 <52938B59.8060004@rabbitmq.com>
 <CAJ4uuZYzuwgdw7++XOtGJWe5Sgoc7k-Ae9daH683OyLhxskvvA@mail.gmail.com>
 <CAJ4uuZYfrLmTxegc1exoH7UXiba6teO1gOgToGz9poDz5fmPhw@mail.gmail.com>
 <CAJ4uuZbYqXov-uPYT2evAq8rcCZhRX5wYM7Fmb6OSCMgcyMDoQ@mail.gmail.com>
Message-ID: <52987EA0.70609@rabbitmq.com>

On 26/11/2013 22:23, Graeme N wrote:
> Looking at the logs for instances which drop their network connections
> shows some pretty big erlang stack dumps, so I've compressed and
> uploaded a sample log file here for you:
> https://mega.co.nz/#!31JCGSxa!LdxuhXeX_HN_px8lnQcp63RkFcRY_dW9Z_x9C7qv2aE <https://mega.co.nz/#%2131JCGSxa%21LdxuhXeX_HN_px8lnQcp63RkFcRY_dW9Z_x9C7qv2aE>

The fundamental problem I see in that log is:

=ERROR REPORT==== 26-Nov-2013::22:20:19 ===
failed to start SSL Listener on [::]:5671 - eaddrinuse (address already 
in use)

Now that should just cause the server to stop - in fact it sounds like 
it stays up when synchronisation was occurring at the point it tried to 
open network listeners. So I'll look at that.

The big stacktraces that occur after that point are not ideal, but they 
are essentially noise; they all look like they're caused by 
synchronisation processes that are still running when most of the rest 
of the broker has stopped.

Cheers, Simon

From simon at rabbitmq.com  Fri Nov 29 10:41:32 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 29 Nov 2013 10:41:32 +0000
Subject: [rabbitmq-discuss] RabbitMq on ESXi
In-Reply-To: <98ab0559-0b72-45ac-975e-77a160a0c94d@googlegroups.com>
References: <98ab0559-0b72-45ac-975e-77a160a0c94d@googlegroups.com>
Message-ID: <52986F5C.8050404@rabbitmq.com>

Well, first of all lots of people are running clusters on virtual 
machines perfectly happily, so it should be possible!

If you are seeing running_partitioned_network events on your cluster, 
that's quite alarming, that would imply (assuming your network is 
reliable) that nodes are being suspended by the hypervisor for at least 
a minute or so - which sounds excessive. Unless you are suspending the 
nodes yourself (in which case I suggest you don't do that). But I've not 
seen ESX do that in my limited experience with it.

You could increase net_ticktime (http://www.rabbitmq.com/nettick.html) 
to cover this up, but it feels like a band aid at this point.

You should probably read http://www.rabbitmq.com/partitions.html if you 
haven't already done so.

Finally, you mention mirrored queues. Note that we have fixed a large 
number of bugs in the mirrored queue implementation since 2.8.2 (and 
quite a few since 3.0.1) so upgrading is likely to be a good idea.

Cheers, Simon

On 27/11/2013 20:23, zsolt.erl at gmail.com wrote:
> Hi,
>
> I'm trying to find out if there are any recommendations for running
> RabbitMq on VMWare ESXi? (eg. clustering, queue mirroring)
>
> I have several 4 node clusters running on ESXi4/5 guests. The guests are
> Ubuntu 10.04 VMs.
> Erlang version: R15B. RabbitMq versions: 2.8.2 and 3.0.1 .
>
> The clusters seem to randomly crash every once in a while (about once
> every 2 months).
> Sometimes the whole cluster crashes, sometimes only a couple nodes and
> the others either work or become unreachable.
> Logs only show that the nodes lost connection.
> I'm running 4 node clusters with 1 disk node and about 100 queues
> mirrored across 2-3 nodes.
> The same thing was happening when I was running a cluster with 4 disk
> nodes.
>
> Are there any recommended best practices in regards to Virtual Machine
> settings, VMWare network settings or OS settings that could
> prevent these random crashes?
> Would federation be a better solution then clustering in a virtual
> environment? Or should I just run them on physical hardware?
>
>
> I realize there's not enough data here to find out what is happening
> exactly but I'm just trying to see if anybody came across similar
> problems and were able to handle it?
>
>
>
> Thanks,
>
> Zsolt
>
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From Punit.Jain at emc.com  Fri Nov 29 12:20:01 2013
From: Punit.Jain at emc.com (Jain, Punit)
Date: Fri, 29 Nov 2013 07:20:01 -0500
Subject: [rabbitmq-discuss] RabbitMQ error
In-Reply-To: <CAJbhyRF7XFqC4j8jWHUHCL+N6DbW1BPXSKc9yuT1AE-E7BMSPQ@mail.gmail.com>
References: <DB14E94115BBC84E8960C12C176D06760177C6B4DD@MX25A.corp.emc.com>
 <BCA20A6B-AB9E-400A-A0FE-22F6A10C9D82@rabbitmq.com>
 <CAJbhyRF7XFqC4j8jWHUHCL+N6DbW1BPXSKc9yuT1AE-E7BMSPQ@mail.gmail.com>
Message-ID: <DB14E94115BBC84E8960C12C176D06760177C6B596@MX25A.corp.emc.com>

Yes, Frank, I was concerned about this particular error only.

Thanks!

> -----Original Message-----
> From: rabbitmq-discuss [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com]
> On Behalf Of Frank Shearar
> Sent: Friday, November 29, 2013 5:27 PM
> To: Discussions about RabbitMQ
> Subject: Re: [rabbitmq-discuss] RabbitMQ error
> 
> Er, I suspect the OP's talking about the cannot_delete_plugins_expand_dir
> error?
> 
> frank
> 
> On 29 November 2013 09:58, Tim Watson <watson.timothy at gmail.com>
> wrote:
> > It indicates that a client severed it's connection without going
> > through the proper disconnect sequence outlined by the protocol. It is
> > an informational log message rather than a serious error.
> >
> > On 28 Nov 2013, at 20:20, "Jain, Punit" <Punit.Jain at emc.com> wrote:
> >
> > Hi,
> >
> > I see following error in the logs file. What could be the reason for this?
> >
> >
> >
> > =WARNING REPORT==== 28-Nov-2013::13:34:55 ===
> >
> > closing AMQP connection <0.377.0> (127.0.0.1:5458 -> 127.0.0.1:5672):
> >
> > connection_closed_abruptly
> >
> >
> >
> > =WARNING REPORT==== 28-Nov-2013::13:34:55 ===
> >
> > closing AMQP connection <0.389.0> (127.0.0.1:5459 -> 127.0.0.1:5672):
> >
> > connection_closed_abruptly
> >
> >
> >
> > =INFO REPORT==== 28-Nov-2013::13:35:01 ===
> >
> > Stopping RabbitMQ
> >
> >
> >
> > =WARNING REPORT==== 28-Nov-2013::13:35:01 ===
> >
> > Connection (<0.2316.0>) closing: internal error in channel (<0.2323.0>):
> > shutdown
> >
> >
> >
> > =INFO REPORT==== 28-Nov-2013::13:35:01 ===
> >
> > stopped TCP Listener on [::]:5672
> >
> >
> >
> > =INFO REPORT==== 28-Nov-2013::13:35:36 ===
> >
> > Halting Erlang VM
> >
> >
> >
> > =INFO REPORT==== 28-Nov-2013::13:35:41 ===
> >
> > Error description:
> >
> >    {error,
> >
> >        {cannot_delete_plugins_expand_dir,
> >
> >
> > ["/var/lib/rabbitmq/mnesia/rabbit at localhost-plugins-expand",
> >
> >             {cannot_delete,
> >
> >
> > "/var/lib/rabbitmq/mnesia/rabbit at localhost-plugins-expand/mochiweb-2.3
> > .1-rmq3.1.3-gitd541e9a/ebin",
> >
> >                 enoent}]}}
> >
> >
> >
> > Log files (may contain more information):
> >
> >    /var/log/rabbitmq/rabbit at localhost.log
> >
> >    /var/log/rabbitmq/rabbit at localhost-sasl.log
> >
> >
> >
> > Stack trace:
> >
> >    [{rabbit_plugins,prepare_plugins,3,[]},
> >
> >     {rabbit,'-boot/0-fun-1-',0,[]},
> >
> >     {rabbit,start_it,1,[]},
> >
> >     {init,start_it,1,[]},
> >
> >     {init,start_em,1,[]}]
> >
> >
> >
> >
> >
> > Thanks,
> >
> > Punit
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


From simon.holness at red-gate.com  Fri Nov 29 12:49:48 2013
From: simon.holness at red-gate.com (Simon Holness)
Date: Fri, 29 Nov 2013 12:49:48 +0000
Subject: [rabbitmq-discuss] Queue federation modifying routing keys in
	transit
Message-ID: <BBC92C35DD51C740AFAFAA3BDD385240C35A6374@RG-EXCHMBC01-N1.red-gate.com>

Hi all,

We're just trying out Queue Federation (using 3.2.1) and seeing what appears, to us, to be an odd behaviour. I wonder if someone could tell us if it's expected behaviour, a misconfiguration on our part or a bug?

We typically have queues named after the services which connect to them, e.g. "my.download.service"

Messages typically have somewhat unrelated routing keys, e.g. "download.started"

When we post a "download.started" message to the upstream exchange, the message received by the downstream consumer has type "my.download.service" (which is promptly rejected because we care about message types).

FWIW we tested with exchange federation instead and that all works fine.

Any enlightenment welcome.

Thanks,
Simon Holness

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131129/d2b5ff7e/attachment.html>

From drinkycatcher at gmail.com  Fri Nov 29 13:51:50 2013
From: drinkycatcher at gmail.com (boldcat11 .)
Date: Fri, 29 Nov 2013 05:51:50 -0800 (PST)
Subject: [rabbitmq-discuss] Web-Stomp connections are not visible with
 "rabbitmqctl list_connections"
Message-ID: <c5ef1407-e10f-4684-bbe8-867fb15db78c@googlegroups.com>

I am using RabbitMQ v3.1.3 + Stomp Plugin(3.1.3) + WebStomp Plugin. 

For some reason I need to close forcely some web-stomp connections. 
I tried to use ">rabbitmqctl list_connections" and ">rabbitmqctl 
close_connection <pid> <reason>", but I get only "AMQP 0-9-1" protocol 
connections, not "web-stomp too".

Is it possible to access in some way "web-stomp" connections from command 
line?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131129/eaf3a8df/attachment.html>

From simon at rabbitmq.com  Fri Nov 29 14:22:44 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 29 Nov 2013 14:22:44 +0000
Subject: [rabbitmq-discuss] Queue federation modifying routing keys in
 transit
In-Reply-To: <BBC92C35DD51C740AFAFAA3BDD385240C35A6374@RG-EXCHMBC01-N1.red-gate.com>
References: <BBC92C35DD51C740AFAFAA3BDD385240C35A6374@RG-EXCHMBC01-N1.red-gate.com>
Message-ID: <5298A334.4040709@rabbitmq.com>

Hi. It's expected behaviour - the messages are republished by the 
federation mechanism, which means they need to be published to the 
default exchange with the queue name as routing key.

I see how this is unhelpful though, but I'm not sure of a good way round 
it. We could maybe use http://www.rabbitmq.com/sender-selected.html 
somehow but then we'd need a way to make sure the original routing key 
wasn't used for routing. Hmm.

This doesn't constitute a problem in the exchange federation case 
because we republish with the original routing key since we don't need 
to route to a particular queue.

Cheers, Simon

On 29/11/2013 12:49, Simon Holness wrote:
> Hi all,
>
> We?re just trying out Queue Federation (using 3.2.1) and seeing what
> appears, to us, to be an odd behaviour. I wonder if someone could tell
> us if it?s expected behaviour, a misconfiguration on our part or a bug?
>
> We typically have queues named after the services which connect to them,
> e.g. ?my.download.service?
>
> Messages typically have somewhat unrelated routing keys, e.g.
> ?download.started?
>
> When we post a ?download.started? message to the upstream exchange, the
> message received by the downstream consumer has type
> ?my.download.service? (which is promptly rejected because we care about
> message types).
>
> FWIW we tested with exchange federation instead and that all works fine.
>
> Any enlightenment welcome.
>
> Thanks,
>
> Simon Holness
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>


From simon at rabbitmq.com  Fri Nov 29 14:24:11 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Fri, 29 Nov 2013 14:24:11 +0000
Subject: [rabbitmq-discuss] Web-Stomp connections are not visible with
 "rabbitmqctl list_connections"
In-Reply-To: <c5ef1407-e10f-4684-bbe8-867fb15db78c@googlegroups.com>
References: <c5ef1407-e10f-4684-bbe8-867fb15db78c@googlegroups.com>
Message-ID: <5298A38B.7010403@rabbitmq.com>

On 29/11/2013 13:51, boldcat11 . wrote:
> Is it possible to access in some way "web-stomp" connections from
> command line?

Yes, at the moment rabbitmqctl list_connections only shows AMQP 0-9-1 / 
0-8 connections. You can get all connections from the mgmt API - this 
can be accessed from the command line with rabbitmqadmin: 
http://www.rabbitmq.com/management-cli.html

Cheers, Simon

From drinkycatcher at gmail.com  Fri Nov 29 14:25:59 2013
From: drinkycatcher at gmail.com (Sam Collier)
Date: Fri, 29 Nov 2013 16:25:59 +0200
Subject: [rabbitmq-discuss] Question: Web-Stomp connections are not visible
	with "rabbitmqctl list_connections"
Message-ID: <CADB2yhBHbvBv7vEpW0VMkgQs0HWtzqPc+kzxWGvjgTKjA7L07w@mail.gmail.com>

I am using RabbitMQ v3.1.3 + Stomp Plugin(3.1.3) + WebStomp Plugin.

For some reason I need to close forcely some web-stomp connections.
I tried to use ">rabbitmqctl list_connections" and ">rabbitmqctl
close_connection <pid> <reason>", but I get only "AMQP 0-9-1" protocol
connections, not "web-stomp too".

Is it possible to access in some way "web-stomp" connections from command
line?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131129/e1502ff8/attachment.html>

From graeme at sudo.ca  Fri Nov 29 18:35:39 2013
From: graeme at sudo.ca (Graeme N)
Date: Fri, 29 Nov 2013 10:35:39 -0800
Subject: [rabbitmq-discuss] Feature Req / Bug list
In-Reply-To: <52987EA0.70609@rabbitmq.com>
References: <CAJ4uuZZnWrC9tp9V+D021AvPDHDKzfXGChvG+OPgD8E8W-tYMw@mail.gmail.com>
 <CAJ4uuZYNy3kyCtm1sWbRdaprWkOQ4O8KMhBNFwxafg6zbMSX3g@mail.gmail.com>
 <F573E81A-8BD2-4F9A-8643-ABB67E97773E@rabbitmq.com>
 <CAJ4uuZYUqGeBRVEbacpGPeyHxFP2S9F7PND8KPQakjMg9Whgrg@mail.gmail.com>
 <526ECAD9.2030703@rabbitmq.com>
 <CAJ4uuZYmom2AjYrsYOVxDNfkuK4VVhqoEyFqG5c7f+th-Xdx5w@mail.gmail.com>
 <526ED167.1010308@rabbitmq.com>
 <CAJ4uuZb1kd8dQ1c3=o-mzHvYzUNrHcwUxFU8VvEOurUG7EFtfQ@mail.gmail.com>
 <CAJ4uuZbc13rs9SCmU64K9ant630Z+1j1x-Ss2MRBh7fQnnEXdA@mail.gmail.com>
 <5277A9A3.3060708@rabbitmq.com>
 <CAJ4uuZbAMR3LB4-sG517sLwb=bxzHNir4yx-9zr_+OnrorQ9qw@mail.gmail.com>
 <CAJ4uuZY0agfwfjChtes3LHsTmADhs2ZnTUR557=ir5-Lbk20sg@mail.gmail.com>
 <52938B59.8060004@rabbitmq.com>
 <CAJ4uuZYzuwgdw7++XOtGJWe5Sgoc7k-Ae9daH683OyLhxskvvA@mail.gmail.com>
 <CAJ4uuZYfrLmTxegc1exoH7UXiba6teO1gOgToGz9poDz5fmPhw@mail.gmail.com>
 <CAJ4uuZbYqXov-uPYT2evAq8rcCZhRX5wYM7Fmb6OSCMgcyMDoQ@mail.gmail.com>
 <52987EA0.70609@rabbitmq.com>
Message-ID: <CAJ4uuZZWd71ftZVLo1X7Bp4bzjbOQuOJBZHfuX1L9YAcASpeWw@mail.gmail.com>

> The fundamental problem I see in that log is:
>
> =ERROR REPORT==== 26-Nov-2013::22:20:19 ===
> failed to start SSL Listener on [::]:5671 - eaddrinuse (address already in
> use)
>
> Now that should just cause the server to stop - in fact it sounds like it
> stays up when synchronisation was occurring at the point it tried to open
> network listeners. So I'll look at that.
>

This is interesting to me too, since it looks like this is occurring after
I've fully killed off that beam.smp, verified it's no longer listening on
any ports, and tried to start it up again. So the only thing that should be
listening on that port is itself.


> The big stacktraces that occur after that point are not ideal, but they
> are essentially noise; they all look like they're caused by synchronisation
> processes that are still running when most of the rest of the broker has
> stopped.
>

Makes sense.

Graeme
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131129/4e5eda6c/attachment.html>

From carl.hoerberg at gmail.com  Sat Nov 30 09:19:02 2013
From: carl.hoerberg at gmail.com (carlhoerberg)
Date: Sat, 30 Nov 2013 01:19:02 -0800 (PST)
Subject: [rabbitmq-discuss] Access www.rabbitmq.com from GCE europe-west1
Message-ID: <1385803142304-31738.post@n5.nabble.com>

Can't access www.rabbitmq.com (to download rabbitmq) from Google Compute
Engines instances provisioned in the eu-west1 region (both zone a and b).
Works fine from GCE us-central1 though. The http (and https) connection
times out. Do you do some kind of ip range blocking? Example IPs: 
23.251.128.15
23.251.128.129
23.251.128.43



--
View this message in context: http://rabbitmq.1065348.n5.nabble.com/Access-www-rabbitmq-com-from-GCE-europe-west1-tp31738.html
Sent from the RabbitMQ mailing list archive at Nabble.com.

From michael.s.klishin at gmail.com  Sat Nov 30 10:37:33 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 30 Nov 2013 14:37:33 +0400
Subject: [rabbitmq-discuss] Access www.rabbitmq.com from GCE europe-west1
In-Reply-To: <1385803142304-31738.post@n5.nabble.com>
References: <1385803142304-31738.post@n5.nabble.com>
Message-ID: <CAE3HoVR8tsZW9EfUW_BC0xREg8JEgYT4T72Otvti-D5WxnDJXg@mail.gmail.com>

2013/11/30 carlhoerberg <carl.hoerberg at gmail.com>

> Can't access www.rabbitmq.com (to download rabbitmq) from Google Compute
> Engines instances provisioned in the eu-west1 region (both zone a and b).
> Works fine from GCE us-central1 though. The http (and https) connection
> times out. Do you do some kind of ip range blocking? Example IPs:
> 23.251.128.15
> 23.251.128.129
> 23.251.128.43
>

Carl,

rabbitmq.com has recently moved to a new home, as did many other parts of
infrastructure RabbitMQ
uses. This has started a couple of days ago and coincided with a public
holiday [in US] then a weekend.
Things may be in flux till early next week.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131130/4c5c3b80/attachment.html>

From simon at rabbitmq.com  Sat Nov 30 16:25:58 2013
From: simon at rabbitmq.com (Simon MacMullen)
Date: Sat, 30 Nov 2013 16:25:58 +0000
Subject: [rabbitmq-discuss] Access www.rabbitmq.com from GCE europe-west1
In-Reply-To: <1385803142304-31738.post@n5.nabble.com>
References: <1385803142304-31738.post@n5.nabble.com>
Message-ID: <529A1196.6050300@rabbitmq.com>

We don't do any range blocking. But the machine has recently moved as 
Michael said. Are you picking up the correct IP address? (192.240.153.117)

If so I will have a word with our new hosting provider...

Cheers, Simon

On 30/11/2013 9:19AM, carlhoerberg wrote:
> Can't access www.rabbitmq.com (to download rabbitmq) from Google Compute
> Engines instances provisioned in the eu-west1 region (both zone a and b).
> Works fine from GCE us-central1 though. The http (and https) connection
> times out. Do you do some kind of ip range blocking? Example IPs:
> 23.251.128.15
> 23.251.128.129
> 23.251.128.43
>
>
>
> --
> View this message in context: http://rabbitmq.1065348.n5.nabble.com/Access-www-rabbitmq-com-from-GCE-europe-west1-tp31738.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

-- 
Simon MacMullen
RabbitMQ, Pivotal

From carl.hoerberg at gmail.com  Sat Nov 30 16:27:09 2013
From: carl.hoerberg at gmail.com (=?utf-8?Q?Carl_H=C3=B6rberg?=)
Date: Sat, 30 Nov 2013 23:27:09 +0700
Subject: [rabbitmq-discuss] Access www.rabbitmq.com from GCE europe-west1
In-Reply-To: <529A1196.6050300@rabbitmq.com>
References: <1385803142304-31738.post@n5.nabble.com>
 <529A1196.6050300@rabbitmq.com>
Message-ID: <851AAE32BA144D1DB8902B271B355D6D@gmail.com>

yes, it resolves correctly



On Saturday 30 November 2013 at 23:25, Simon MacMullen wrote:

> We don't do any range blocking. But the machine has recently moved as 
> Michael said. Are you picking up the correct IP address? (192.240.153.117)
> 
> If so I will have a word with our new hosting provider...
> 
> Cheers, Simon
> 
> On 30/11/2013 9:19AM, carlhoerberg wrote:
> > Can't access www.rabbitmq.com (http://www.rabbitmq.com) (to download rabbitmq) from Google Compute
> > Engines instances provisioned in the eu-west1 region (both zone a and b).
> > Works fine from GCE us-central1 though. The http (and https) connection
> > times out. Do you do some kind of ip range blocking? Example IPs:
> > 23.251.128.15
> > 23.251.128.129
> > 23.251.128.43
> > 
> > 
> > 
> > --
> > View this message in context: http://rabbitmq.1065348.n5.nabble.com/Access-www-rabbitmq-com-from-GCE-europe-west1-tp31738.html
> > Sent from the RabbitMQ mailing list archive at Nabble.com (http://Nabble.com).
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com (mailto:rabbitmq-discuss at lists.rabbitmq.com)
> > https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 
> 
> -- 
> Simon MacMullen
> RabbitMQ, Pivotal




From stormracer at jacsen.de  Fri Nov 29 21:59:34 2013
From: stormracer at jacsen.de (Christian Jacobsen)
Date: Fri, 29 Nov 2013 13:59:34 -0800 (PST)
Subject: [rabbitmq-discuss] Rabbitmq client embedded device
Message-ID: <8692e993-0dd9-40a8-9af0-8144372eb272@googlegroups.com>

Hello,

this are my first steps with AMQP. I'm running the rabbitmq broker on a pc. 
My first test with another pc as client are successful. In my final 
application the client should run on an microcontroller.

The microcontroller is a STM32F407, a 32 Bit ARM-Coretx M4. I'm running 
ChibiOS as operating system, so i'm able to to run threads or using LWIP as 
ethernet stack (including sockets).

I have a look at the rabbitmq-c lib but it's not easy to port this for 
microcontroller, because i'm not able to use dynamic memory allocation.

Are there ideas or solutions for using rabbitmq on such embedded devices.

An alternative way is the udp plugin for rabbitmq, but i want to try a tcp 
connection.

Thanks,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131129/40589ef1/attachment.html>

From ravinderka9 at gmail.com  Sat Nov 30 06:21:43 2013
From: ravinderka9 at gmail.com (Ravinder Kasarla)
Date: Sat, 30 Nov 2013 11:51:43 +0530
Subject: [rabbitmq-discuss] can I use 15 connections to rabbitmq broker
	across 15 programs?
Message-ID: <CAK3WytN=RJfXk+y5UNgZc2gQ7sj=vxkBsfPrSC3+DxFVwuo3dQ@mail.gmail.com>

I have 15 programs each one acts as producer and consumer. So can I
create 15+ broker connections across all these programs. Is there any
other better way to do this. Can I use only 2connections(one to
publish and one to consume) across all these programs? Thanks in
advance.

From michael.s.klishin at gmail.com  Sat Nov 30 18:15:18 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 30 Nov 2013 22:15:18 +0400
Subject: [rabbitmq-discuss] Rabbitmq client embedded device
In-Reply-To: <8692e993-0dd9-40a8-9af0-8144372eb272@googlegroups.com>
References: <8692e993-0dd9-40a8-9af0-8144372eb272@googlegroups.com>
Message-ID: <CAE3HoVT0M-u_7gETnN7HZhQpv82np7f=VOxu-+tCiwGj653a_Q@mail.gmail.com>

2013/11/30 Christian Jacobsen <stormracer at jacsen.de>

> Are there ideas or solutions for using rabbitmq on such embedded devices.
>
> An alternative way is the udp plugin for rabbitmq, but i want to try a tcp
> connection.
>

If there are STOMP or MQTT clients for the microcontroller,
you can use those with RabbitMQ.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131130/fd396d9e/attachment.html>

From michael.s.klishin at gmail.com  Sat Nov 30 19:27:54 2013
From: michael.s.klishin at gmail.com (Michael Klishin)
Date: Sat, 30 Nov 2013 23:27:54 +0400
Subject: [rabbitmq-discuss] can I use 15 connections to rabbitmq broker
 across 15 programs?
In-Reply-To: <CAK3WytN=RJfXk+y5UNgZc2gQ7sj=vxkBsfPrSC3+DxFVwuo3dQ@mail.gmail.com>
References: <CAK3WytN=RJfXk+y5UNgZc2gQ7sj=vxkBsfPrSC3+DxFVwuo3dQ@mail.gmail.com>
Message-ID: <CAE3HoVR+Q8dyNFz2GUpQOHnuH8Aph26xJH5ZQeX4a_0TULOO6g@mail.gmail.com>

2013/11/30 Ravinder Kasarla <ravinderka9 at gmail.com>

> I have 15 programs each one acts as producer and consumer. So can I
> create 15+ broker connections across all these programs. Is there any
> other better way to do this. Can I use only 2connections(one to
> publish and one to consume) across all these programs? Thanks in
> advance.
>

No, you cannot share connections between OS processes.

You can share a connection between threads (if applicable), but 15 or even
30 connections
is not a large number.
-- 
MK

http://github.com/michaelklishin
http://twitter.com/michaelklishin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20131130/7585e479/attachment.html>

