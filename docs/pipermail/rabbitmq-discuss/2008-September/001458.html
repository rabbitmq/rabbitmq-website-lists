<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Newer version of the erlang emulator and	RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Newer%20version%20of%20the%20erlang%20emulator%20and%0A%09RabbitMQ&In-Reply-To=5D10DF73-5427-4D54-860A-C6DF650FCFFB%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001457.html">
   <LINK REL="Next"  HREF="001460.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Newer version of the erlang emulator and	RabbitMQ</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Newer%20version%20of%20the%20erlang%20emulator%20and%0A%09RabbitMQ&In-Reply-To=5D10DF73-5427-4D54-860A-C6DF650FCFFB%40gmail.com"
       TITLE="[rabbitmq-discuss] Newer version of the erlang emulator and	RabbitMQ">0x6e6562 at gmail.com
       </A><BR>
    <I>Thu Sep 11 17:56:58 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001457.html">[rabbitmq-discuss] Newer version of the erlang emulator and	RabbitMQ
</A></li>
        <LI>Next message: <A HREF="001460.html">[rabbitmq-discuss] RabbitMQ memory management
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1458">[ date ]</a>
              <a href="thread.html#1458">[ thread ]</a>
              <a href="subject.html#1458">[ subject ]</a>
              <a href="author.html#1458">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Peter,

On Thu, Sep 11, 2008 at 5:34 PM, Peter Kieltyka
&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">peter.kieltyka at gmail.com</A>&gt; wrote:
&gt;<i> Gotcha. So presently its in the form of a patch but going to be
</I>&gt;<i> included into the next release of Erlang?
</I>
God only knows, I'm not on the OTP team, but this is what Bj&#246;rn-Egil
posted to me a while back:

---snip---

It seems to be an error in cpu_sup for darwin and locales, it should
probably use LC_ALL=C uptime instead of LANG=C uptime.

This should resolve it (not fully tested though). diff follows:

------------------------------------------------------------

diff -Naur otp_src_R12B-2/lib/os_mon/src/cpu_sup.erl
otp_src_R12B-2_cpu_sup_fix/lib/os_mon/src/cpu_sup.erl
--- otp_src_R12B-2/lib/os_mon/src/cpu_sup.erl   2008-05-09
15:08:52.228457000 +0200
+++ otp_src_R12B-2_cpu_sup_fix/lib/os_mon/src/cpu_sup.erl
2008-05-09 15:08:43.138456000 +0200
@@ -264,7 +264,7 @@
    end;
 get_uint32_measurement(Request, #internal{os_type = {unix, darwin}}) -&gt;
    %% Get the load average using uptime, overriding Locale setting.
-    D = os:cmd(&quot;LANG=C uptime&quot;) -- &quot;\n&quot;,
+    D = os:cmd(&quot;LANG=C LC_ALL=C uptime&quot;) -- &quot;\n&quot;,
    %% Here is a sample uptime string from Mac OS 10.3.8 (C Locale):
    %%    &quot;11:17  up 12 days, 20:39, 2 users, load averages: 1.07 0.95 0.66&quot;
    %% The safest way to extract the load averages seems to be grab everything


------------------------------------------------------------

I agree, it is sad that output like this is modified by locale
settings which makes it a little difficult to parse. A more robust way
should be implemented then parsing human readables. No such
implementation is on the horizon nor seriously contemplated at the
moment.

---snip---

&gt;<i> The Erlang website shows that Erlang/OTP R12B-4 was released on
</I>&gt;<i> September 3rd, 2008. But that patch is dated for May 19th. Am I
</I>&gt;<i> missing something here?
</I>
I don't really know. The only reason why I even asked was because we
use that call in Rabbit and a user reported an issue with OSX and a
German locale, so I began an enquiry. It didn't seem that the issue
had too high a priority with the OTP team, and neither with me,
because the person that reported the bug disappeared and hence I
didn't much point in wasting energy on it (especially seeing as it
works fine for me on OSX).

As for R12B-4, I'm using it, and it seems fine.

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001457.html">[rabbitmq-discuss] Newer version of the erlang emulator and	RabbitMQ
</A></li>
	<LI>Next message: <A HREF="001460.html">[rabbitmq-discuss] RabbitMQ memory management
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1458">[ date ]</a>
              <a href="thread.html#1458">[ thread ]</a>
              <a href="subject.html#1458">[ subject ]</a>
              <a href="author.html#1458">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
