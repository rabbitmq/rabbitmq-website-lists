<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%5BMinimum%20Air%20Induction%5D%20Introducing%20Shovel%3A%0A%09An%20AMQP%20Relay&In-Reply-To=1AF03629-BA1E-4878-86BC-0E78DDA0BC01%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001555.html">
   <LINK REL="Next"  HREF="001560.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%5BMinimum%20Air%20Induction%5D%20Introducing%20Shovel%3A%0A%09An%20AMQP%20Relay&In-Reply-To=1AF03629-BA1E-4878-86BC-0E78DDA0BC01%40gmail.com"
       TITLE="[rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay">0x6e6562 at gmail.com
       </A><BR>
    <I>Sat Sep 20 19:17:52 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001555.html">[rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay
</A></li>
        <LI>Next message: <A HREF="001560.html">[rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1557">[ date ]</a>
              <a href="thread.html#1557">[ thread ]</a>
              <a href="subject.html#1557">[ subject ]</a>
              <a href="author.html#1557">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Valentino,

On Sat, Sep 20, 2008 at 5:45 PM, Valentino Volonghi &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">dialtone at gmail.com</A>&gt; wrote:
&gt;<i> A transaction per message is indeed to expensive, I've tried this and it's
</I>&gt;<i> indeed
</I>&gt;<i> too slow.
</I>
What difference does it make when you do multiple publishes within the same TX?

&gt;<i>One thing that I wasn't able to understand is what does a
</I>&gt;<i> transaction
</I>&gt;<i> give me in rabbitmq?
</I>
It provides an atomic barrier for sending messages - when you get the
commit.ok back from the broker, you know that the messages you have
sent have been routed to the queues that the routing key matches on.

&gt;<i> In the event of rabbitmq crashing I would like the whole thing to crash so
</I>&gt;<i> that
</I>&gt;<i> I'm sure that there won't be lines generated without being also handled.
</I>&gt;<i> This
</I>&gt;<i> is the embedded rabbitmq of course.
</I>
IIRC you can have the OTP application do this for you, provided
Mochiweb is packaged as an OTP application. Rabbit and Shovel are both
OTP apps themselves.

&gt;&gt;<i> And if you're using an embedded RabbitMQ instance, how is the Shovel
</I>&gt;&gt;<i> application supposed to failover to other Rabbit nodes?
</I>&gt;<i>
</I>&gt;<i> What do you mean? I suppose shovel would have a list of backup rabbitmq
</I>&gt;<i> nodes
</I>&gt;<i> and would use them in the event the main one dies.
</I>
AFIAK we haven't looked into a clustered scenario using the direct
driver for the Erlang client - I suppose that it is quite possible
though.

&gt;&gt;<i> Maybe you also want to compress stuff if you're sending it over a WAN.
</I>&gt;<i>
</I>&gt;<i> Yes, one thing that I was thinking is to just gzip the body of the message
</I>&gt;<i> myself before sending it, but I haven't looked into rabbitmq to see if it
</I>&gt;<i> already
</I>&gt;<i> supports this feature.
</I>
Not really. Rabbit treats the payload as an opaque object.

&gt;<i> I suppose a solution to this would be to avoid part of this problem is to
</I>&gt;<i> remove the middleman rabbitmq. There is one question I have about AMQP
</I>&gt;<i> though: a durable queue and exchange don't persist messages by themselves
</I>&gt;<i> right? What happens if a persistent messages enters a durable exchange
</I>&gt;<i> without
</I>&gt;<i> queues?
</I>
Rabbit will nuke it. Logging the message to disk is done by the queue
process, so if nothing gets routed, nothing gets persisted.

&gt;<i> I suppose my tests weren't too accurate then now... is a persistent message
</I>&gt;<i> much
</I>&gt;<i> slower than a non persistent one?
</I>
Yep. Don't know what the exact factor is though.

&gt;<i> Because I obtained wonderful numbers from
</I>&gt;<i> messages not explicitly marked as being persistent, like 8000 messages per
</I>&gt;<i> second,
</I>&gt;<i> with the bottleneck being in the saturated network, on the write side of the
</I>&gt;<i> connection
</I>&gt;<i> and about 3-4K messages per second on the read side with the bottleneck
</I>&gt;<i> being the
</I>&gt;<i> python client most probably. So would these numbers confirm themselves
</I>&gt;<i> pretty much
</I>&gt;<i> or are they simply completely wrong?
</I>
It really depends how you set things up, but those numbers do look OK.

I think that you need to work out what ingress requirements you have
(this will be determined by the capacity of the http server) and what
egress you need (so as to avoid stuff queuing up too much).

Remember that ATM Rabbit does not implement QoS, so your egress will
be bound by the slowest consumer.

&gt;<i> At least I need about 2500-3000
</I>&gt;<i> requests per
</I>&gt;<i> second because, given the constraint with memory bound queues, the component
</I>&gt;<i> should
</I>&gt;<i> be as fast as the webserver otherwise the messages start to pile up.
</I>
Sounds sensible. At some stage we will get around to landing QoS and
queue overflowing.

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001555.html">[rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay
</A></li>
	<LI>Next message: <A HREF="001560.html">[rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1557">[ date ]</a>
              <a href="thread.html#1557">[ thread ]</a>
              <a href="subject.html#1557">[ subject ]</a>
              <a href="author.html#1557">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
