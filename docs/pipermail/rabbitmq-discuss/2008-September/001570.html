<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%5BMinimum%20Air%20Induction%5D%20Introducing%20Shovel%3A%0A%09An%20AMQP%20Relay&In-Reply-To=269388e30809211158re2dc58fv925d8c2e5aff406b%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001567.html">
   <LINK REL="Next"  HREF="001566.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20%5BMinimum%20Air%20Induction%5D%20Introducing%20Shovel%3A%0A%09An%20AMQP%20Relay&In-Reply-To=269388e30809211158re2dc58fv925d8c2e5aff406b%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay">0x6e6562 at gmail.com
       </A><BR>
    <I>Mon Sep 22 20:54:18 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001567.html">[rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay
</A></li>
        <LI>Next message: <A HREF="001566.html">[rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1570">[ date ]</a>
              <a href="thread.html#1570">[ thread ]</a>
              <a href="subject.html#1570">[ subject ]</a>
              <a href="author.html#1570">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Valentino,

On Sun, Sep 21, 2008 at 7:58 PM, Ben Hood &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">0x6e6562 at gmail.com</A>&gt; wrote:
&gt;<i> On Sun, Sep 21, 2008 at 7:26 PM, Matthias Radestock &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at lshift.net</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> No, because the current queue delivery mechanism takes a
</I>&gt;&gt;&gt;<i> robin-robin-ish approach, so the overall throughput is rate limited by
</I>&gt;&gt;&gt;<i> the slowest consumer subscribed to a queue.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Not true. When messages due for delivery to a particular consumer back up at
</I>&gt;&gt;<i> the TCP/IP level the broker will skip that consumer in its round-robin
</I>&gt;&gt;<i> delivery.
</I>&gt;<i>
</I>&gt;<i> Sure, but only when you hit the limit on a per-queue basis. So, yes,
</I>&gt;<i> you could load balance by saturating the whole thing :-)
</I>
After speaking with Matthias today it transpired that he had looked at
a different angle of your question than I did.

Specifically, if you add more consumers to a queue, you will increase
your processing capacity and also be able to scale by doing so.

This will work fine if the consumers are relatively homogeneous wrt
the processing time per job. Under normal circumstances, identical
code should execute in around about the same amount of time on an
identically spec'ed machine, if the respective scheduler allows each
worker to execute in an unthrottled fashion. However when the
processing time becomes heterogeneous across consumers, what you see
is that the overall rate of consumption will be bound by the slowest
consumer, even if processing resources are actually available to the
other workers.

In this situation, the workers are not fully utilizing the available CPU cycles.

The source of this heterogeneity could be resource contention on
specific objects with the execution scope of the worker or something
like the fact that tasks may themselves be heterogeneous in the amount
of resources that are required to complete them.

So the point that Matthias made about the current load balancing is
entirely correct, if a consumer doesn't drain their TCP receive
buffer, they will be skipped.

But this is a coincidental load balancing strategy and only really
works when you have back pressure over the network (which
co-incidentally *may* not kick in if you are using the Erlang clint in
direct mode).

The solution to providing more fine grained control over the flow of
messages across multiple consumers in the QoS feature that I outlined
before. But there is no ETA on this.

HTH,

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001567.html">[rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay
</A></li>
	<LI>Next message: <A HREF="001566.html">[rabbitmq-discuss] [Minimum Air Induction] Introducing Shovel:	An AMQP Relay
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1570">[ date ]</a>
              <a href="thread.html#1570">[ thread ]</a>
              <a href="subject.html#1570">[ subject ]</a>
              <a href="author.html#1570">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
