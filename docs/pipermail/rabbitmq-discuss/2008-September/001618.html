<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20problem&In-Reply-To=C85BA382-FDAA-4A5D-B440-D293CDFE02C1%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001617.html">
   <LINK REL="Next"  HREF="001621.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ problem</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20problem&In-Reply-To=C85BA382-FDAA-4A5D-B440-D293CDFE02C1%40gmail.com"
       TITLE="[rabbitmq-discuss] RabbitMQ problem">matthias at lshift.net
       </A><BR>
    <I>Fri Sep 26 09:35:36 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001617.html">[rabbitmq-discuss] RabbitMQ problem
</A></li>
        <LI>Next message: <A HREF="001621.html">[rabbitmq-discuss]  Huge latency in Linux, compared with Leopard
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1618">[ date ]</a>
              <a href="thread.html#1618">[ thread ]</a>
              <a href="subject.html#1618">[ subject ]</a>
              <a href="author.html#1618">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Valentino,

Valentino Volonghi wrote:
&gt;&gt;<i> That would be because the connection has been closed.
</I>&gt;<i> 
</I>&gt;<i> Why? This is completely unexpected to me... Also I don't think this
</I>&gt;<i> is true because I don't see the connection dropped error on the
</I>&gt;<i> client side that I usually see when I stop rabbitmq server.
</I>
There are only two ways to report an error to the client in AMQP - the 
server needs to send either a channel.close or connection.close method. 
The client is then expected to respond with a close-ok and at that point 
(or after a timeout) the channel/connection is closed.

Because we do not know the exact reasons for why the commit failed we 
assume the worst, an INTERNAL_ERROR, which, like all severe errors, is a 
connection error, i.e. it will force the connection to close.

&gt;<i> Sure, it's just that dropping the connection because a transaction failed
</I>&gt;<i> makes the commit_failed message completely useless. Just use the
</I>&gt;<i> connection dropped error to mean the same thing, I'm not sure this is the
</I>&gt;<i> right behavior (from a logic point of view).
</I>
The server doesn't just drop the connection. It follows the connection 
closure protocol, and as part of that the client is told about the 
closure reasons.

&gt;<i> If a database dropped the connection every time a transaction failed
</I>&gt;<i> they would spend more time off rather than doing anything. That's why
</I>&gt;<i> I think it's an error, after all transactions are isolated and a
</I>&gt;<i> rollback is there exactly to be able to go back to the beginning 
</I>&gt;<i> without any consequences.
</I>
I see your point, alas there is nothing in the AMQP protocol, such as a 
tx.commit-fail method, that would allow us to inform the client of the 
tx failure without closing the channel or connection.

This has come up in discussions in the Working Group, so I would expect 
an improvement in this area at some point.

&gt;&gt;&gt;<i> but apparently I don't even receive the failed commit message.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That is strange. What client are you using?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> erlang client and rabbitmq server.
</I>
In the Java and C# clients the channel and connection closure reasons 
are propagated to the initiators of all pending request-response 
interactions. I am not sure whether that is happening in the Erlang 
client. We will look into it.


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001617.html">[rabbitmq-discuss] RabbitMQ problem
</A></li>
	<LI>Next message: <A HREF="001621.html">[rabbitmq-discuss]  Huge latency in Linux, compared with Leopard
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1618">[ date ]</a>
              <a href="thread.html#1618">[ thread ]</a>
              <a href="subject.html#1618">[ subject ]</a>
              <a href="author.html#1618">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
