<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Publish won't work without transaction?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Publish%20won%27t%20work%20without%20transaction%3F&In-Reply-To=84fb38e30809231228y3d0d6c0an4ba7ef158a0c0f63%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001588.html">
   <LINK REL="Next"  HREF="001598.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Publish won't work without transaction?</H1>
    <B>Ben Hood</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Publish%20won%27t%20work%20without%20transaction%3F&In-Reply-To=84fb38e30809231228y3d0d6c0an4ba7ef158a0c0f63%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Publish won't work without transaction?">0x6e6562 at gmail.com
       </A><BR>
    <I>Wed Sep 24 01:18:01 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001588.html">[rabbitmq-discuss] Publish won't work without transaction?
</A></li>
        <LI>Next message: <A HREF="001598.html">[rabbitmq-discuss] Publish won't work without transaction?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1596">[ date ]</a>
              <a href="thread.html#1596">[ thread ]</a>
              <a href="subject.html#1596">[ subject ]</a>
              <a href="author.html#1596">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Tsuraan.

On Tue, Sep 23, 2008 at 8:28 PM, tsuraan &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tsuraan at gmail.com</A>&gt; wrote:
&gt;<i> The response from the passive declaration gives how many messages are
</I>&gt;<i> in the queue.  That's how I'm checking the number of messages that
</I>&gt;<i> exist.  There isn't a consumer yet; I've just been trying to make
</I>&gt;<i> message insertion work, or at least understand how it's supposed to
</I>&gt;<i> work.  Maybe I'm not making sense here - see below.
</I>
This is the definition of the message-count field from the spec:

&quot;This field reports the number of messages pending on the queue,
excluding the message being delivered.
Note that this figure is indicative, not reliable, and can change
arbitrarily as messages are added to the
queue and removed by other clients.&quot;

As much as anything it depends on the point of time that you poll the queue.

BTW, you will most likely get better results with a consumer as
opposed to polling the queue.

&gt;<i> Ok, I'm definitely having terminology issues, and I can't find the
</I>&gt;<i> definitions in the AMQP-0.8 spec.  A producer publishes a message to
</I>&gt;<i> an exchange.  An exchange routes a message into a queue (or many
</I>&gt;<i> queues).  A consumer gets a message from a queue, and once it has
</I>&gt;<i> acknowledged that message, then the message is delivered.  Is that
</I>&gt;<i> right?
</I>
Almost. The queue process will try to deliver the message to a waiting
consumer before it decides to buffer it in a message queue.

This is why it is cooler to have consumers rather than polling the queue.

&gt;<i>
</I>&gt;<i> If all consumers are using basic_get instead of basic_consume, will
</I>&gt;<i> immediate delivery always fail?  In other words, if a queue has no
</I>&gt;<i> &quot;consumer&quot; on it, will all messages marked for immediate delivery be
</I>&gt;<i> dropped?
</I>
Pretty much, although I don't know what the exact semantics are from
the protocol perspective.

For all intents and purposes though, a get will dequeue a buffered
message and report the resulting length of the queue at the time that
that one particular message was read.

&gt;<i> Yeah, the backlog is exactly what I need to manage though, because my
</I>&gt;<i> backlog management isn't the best.  That's essentially the problem I
</I>&gt;<i> was hoping that RabbitMQ would solve; apparently it doesn't do that
</I>&gt;<i> yet, but it's still much better designed than my way, and I'm guessing
</I>&gt;<i> it's probably higher performance.  I have a bit of Erlang experience;
</I>&gt;<i> how difficult do you think it would be to implement a custom queue
</I>&gt;<i> that allows for ludicrous backlogs, once the upcoming RabbitMQ version
</I>&gt;<i> with pluggable queues is done?
</I>
Well it does deal with backlogs and it won't accept responsibility for
a message it can't deliver (if you ask it behave in this way).

I just said that it is currently memory bound and doesn't overflow to disk yet.

But what do you do when you disk or SAN fills up?

Every resource is finite.

&gt;<i> I can probably hack my way around this, but the tasks my system gets
</I>&gt;<i> aren't requested; it just gets tasks as they are generated.  Often, a
</I>&gt;<i> system will get a lot of work during the day, and then just process it
</I>&gt;<i> all night.
</I>
Why not process it during the day as well?

&gt;<i> Sometimes, a system will just get too much data, and never
</I>&gt;<i> be able to process it all.  Then, the customer calls tech support, but
</I>&gt;<i> no data is lost.  The pluggable queues would probably be the right
</I>&gt;<i> answer for this, I guess.
</I>
Pluggable queues will allow you implement custom queue behaviour
without having to hack on the server.

&gt;<i>
</I>&gt;&gt;<i> There is a roadmap item to address this - but no ETA.
</I>&gt;<i>
</I>&gt;<i> Is that item the pluggable queues, or an actual implementation of
</I>&gt;<i> queues that can grow indefinitely?
</I>
Both :-)

We want pluggable queues for a variety of use cases, and one
particular one is to be able to cleanly implement disk overflow
without hacking too much on the core of Rabbit. We try to reduce the
server codebase to a minimum.

If somebody shouts loud enough, we might shift it up the list of
things to do, but remember, this is open source software. Either wait,
ask very nicely, fix it yourself or pay somebody to implement it for
you :-)

HTH,

Ben


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001588.html">[rabbitmq-discuss] Publish won't work without transaction?
</A></li>
	<LI>Next message: <A HREF="001598.html">[rabbitmq-discuss] Publish won't work without transaction?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1596">[ date ]</a>
              <a href="thread.html#1596">[ thread ]</a>
              <a href="subject.html#1596">[ subject ]</a>
              <a href="author.html#1596">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
