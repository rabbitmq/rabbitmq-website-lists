<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Abrupt Termination
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Abrupt%20Termination&In-Reply-To=84fb38e30809032014k1bd7be0bw4fb46a9436143c33%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001333.html">
   <LINK REL="Next"  HREF="001338.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Abrupt Termination</H1>
    <B>Alexis Richardson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Abrupt%20Termination&In-Reply-To=84fb38e30809032014k1bd7be0bw4fb46a9436143c33%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] Abrupt Termination">alexis.richardson at cohesiveft.com
       </A><BR>
    <I>Thu Sep  4 12:28:21 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001333.html">[rabbitmq-discuss] Abrupt Termination
</A></li>
        <LI>Next message: <A HREF="001338.html">[rabbitmq-discuss] Abrupt Termination
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1337">[ date ]</a>
              <a href="thread.html#1337">[ thread ]</a>
              <a href="subject.html#1337">[ subject ]</a>
              <a href="author.html#1337">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Tsuraan

On Thu, Sep 4, 2008 at 4:14 AM, tsuraan &lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">tsuraan at gmail.com</A>&gt; wrote:
&gt;<i> Second post, but I figure this is probably more polite than having a
</I>&gt;<i> multi-topic thread...
</I>&gt;<i>
</I>&gt;<i> How well do RabbitMQ persistent queues handle abrupt termination, such
</I>&gt;<i> as from a power loss?
</I>
Well, &quot;how well&quot; is subjective.  We think it does a good job and is
properly architected for reliability, scale and speed.


&gt;<i> Will entire queues be corrupted, or just a
</I>&gt;<i> possible loss of messages that were inserted but not yet written to
</I>&gt;<i> disk?
</I>
RabbitMQ does not notify observers outside the transaction of work
that is completed until that work is properly committed.  For
persistent messages this means nothing and nobody can see them until
the transaction completes any in memory work, and any subsequent
logging has been flushed to disk from the buffer.  This is correct
behaviour.

I.e.: for an external observer, the broker losing work that has not
been committed to disk, should be no different than losing it on the
network before it got to the broker.

To answer your qn, this means
* Queues will not be corrupted
* Messages not committed to disk may be lost
* But nobody will believe a message has been committed to disk when in
fact it has not been
* Everything committed to disk is recoverable properly
* Operations complete correcty, or fail correctly

Two years ago we found a bug in the windows (but not any *nix) version
of OTP where sync() did not flush correctly which was then fixed.  As
far as we can tell this is all now as it should be.  DO PLEASE tell us
immediately if you see any other behaviour.



&gt;<i> If multiple messages were accepted and dispatched in a
</I>&gt;<i> transaction, is the entire transaction guaranteed to be fully
</I>&gt;<i> committed or fully lost in the event of system failure?
</I>
This is as above, for RabbitMQ, and correctly implemented.  A detailed
reading of the 0-8/0-9 specs reveals the interaction between TX and
mandatory/immediate to have been poorly expressed in your 'multiple
messages' case, at least with many queues.  But RabbitMQ does the
right thing.

Comments, thoughts, questions are welcomed on this subtle area!

alexis


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001333.html">[rabbitmq-discuss] Abrupt Termination
</A></li>
	<LI>Next message: <A HREF="001338.html">[rabbitmq-discuss] Abrupt Termination
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1337">[ date ]</a>
              <a href="thread.html#1337">[ thread ]</a>
              <a href="subject.html#1337">[ subject ]</a>
              <a href="author.html#1337">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
