<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] durable exclusive queues
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20durable%20exclusive%20queues&In-Reply-To=e1c05edd0809041142m5bd889b1kc76709f359f29269%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001347.html">
   <LINK REL="Next"  HREF="001384.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] durable exclusive queues</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20durable%20exclusive%20queues&In-Reply-To=e1c05edd0809041142m5bd889b1kc76709f359f29269%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] durable exclusive queues">matthias at lshift.net
       </A><BR>
    <I>Sun Sep  7 04:57:36 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001347.html">[rabbitmq-discuss] durable exclusive queues
</A></li>
        <LI>Next message: <A HREF="001384.html">[rabbitmq-discuss] durable exclusive queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1357">[ date ]</a>
              <a href="thread.html#1357">[ thread ]</a>
              <a href="subject.html#1357">[ subject ]</a>
              <a href="author.html#1357">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Aman,

Aman Gupta wrote:
&gt;<i> According to the spec, a durable queue cannot be exclusive, as exclusive 
</I>&gt;<i> implies auto-delete:
</I>&gt;<i> 
</I>&gt;<i>     request an exclusive queue
</I>&gt;<i>       Exclusive queues may only be consumed from by the current connection.
</I>&gt;<i>       Setting the 'exclusive' flag always implies 'auto-delete'.
</I>
IIRC the spec does not prohibit the declaration of durable exclusive 
queues. However, such queues will not survive restarts since they are 
&quot;owned&quot; by the connection that created them - that is the essence of 
exclusivity - and since that connection will get dropped on a restart so 
will the queue. So, in a way, they durable exclusive queues are nonsensical.

&gt;<i> Is it possible to simulate this exclusive behavior?  I can do a passive
</I>&gt;<i> declare and look at the consumer count in the declare-ok, but that will 
</I>&gt;<i> introduce race conditions without a central lock.
</I>
It is not clear from the above what exactly you are trying to simulate. 
Durable exclusive queues? As I explained, that doesn't make sense.

 From your description though it appears that perhaps you want queues 
that are exclusive to one connection *at a time*, i.e. they can be 
&quot;acquired&quot; by different connections over their lifetime. And such queues 
could of course then sensibly be made durable.

If so, then one way to implement that is to have a secondary queue that 
holds a token. Connections that want to use the &quot;shared exclusive queue&quot; 
subscribe to the token queue. When they receive the token they know they 
have exclusive access. To relinquish access they publish the token back 
to the token queue, where it can be consumed by another connection.

Obviously that requires collaboration between the connections - it won't 
stop a malicious connection from just accessing the &quot;shared exclusive 
queue&quot; without getting the token first. Also, you may need to find a way 
to recover tokens that are &quot;lost&quot; when a connection gets dropped.


I hope that answers your question. If not, please explain your use case 
in more detail.


Regards,

Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001347.html">[rabbitmq-discuss] durable exclusive queues
</A></li>
	<LI>Next message: <A HREF="001384.html">[rabbitmq-discuss] durable exclusive queues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1357">[ date ]</a>
              <a href="thread.html#1357">[ thread ]</a>
              <a href="subject.html#1357">[ subject ]</a>
              <a href="author.html#1357">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
