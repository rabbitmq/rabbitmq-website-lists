<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Stomp frame not terminated with null	character
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Stomp%20frame%20not%20terminated%20with%20null%0A%09character&In-Reply-To=48D2890D.3060305%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001521.html">
   <LINK REL="Next"  HREF="001525.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Stomp frame not terminated with null	character</H1>
    <B>Jonatan Kallus</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Stomp%20frame%20not%20terminated%20with%20null%0A%09character&In-Reply-To=48D2890D.3060305%40lshift.net"
       TITLE="[rabbitmq-discuss] Stomp frame not terminated with null	character">jonatan at heysan.com
       </A><BR>
    <I>Thu Sep 18 18:36:58 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001521.html">[rabbitmq-discuss] Stomp frame not terminated with null	character
</A></li>
        <LI>Next message: <A HREF="001525.html">[rabbitmq-discuss] Stomp frame not terminated with null	character
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1523">[ date ]</a>
              <a href="thread.html#1523">[ thread ]</a>
              <a href="subject.html#1523">[ subject ]</a>
              <a href="author.html#1523">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for your answer!

Jonatan Kallus wrote:
&gt;<i>
</I>&gt;&gt;<i> Problem is that the frames sent back from rabbitmq does not seem to be
</I>&gt;&gt;<i> terminated with a null character. The 'CONNECTED' frame ends with an
</I>&gt;&gt;<i> empty line and the 'MESSAGE' frame just ends.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> That's strange. How have you determined this? The code in stomp_frame.erl
</I>&gt;<i> always generates a NUL byte for transmission, and other STOMP clients seem
</I>&gt;<i> to have no trouble.
</I>&gt;<i>
</I>
The read loop in the php stomp client keeps reading until it finds a null
character, and it does not stop until a time out is reached. I tried to
tweak this in a few different ways without any positive results. There might
be something I am missing in the way php handles socket connections and/or
null characters in strings. Either way, the php stomp client doesn't work
with the stomp gateway 'out of the box' but it seems like people are using
it successfully with ActiveMQ or JMS.

I am only going to use the php/stomp connection to send messages into the
queue, so I hardcoded recognition of CONNECTED and RECEIPT for now, that is
propably the only two I will need. (Failing on anything else.)

Below is a copy of a conversation I had on the mailinglist for php stomp. It
suggests that the problem might be that the client is looking for an
ActiveMQ specific ending sequence of 'NULL-NEWLINE', but I tried to correct
that and I am pretty sure that is not the cause:

Michael Caplan wrote:
As an aside, on re-reading the protocol, I'm wondering if our scan for
end of frame is incorrect (or specific to ActiveMQ's implementation).  A
frame is terminated by a \x00, and not \x00 + \n according to the spec:

&quot;...the null indicates the end of the frame.&quot;

Mike

Jonatan Kallus wrote:
&gt;<i> Yes, the space between 'login:' and '&lt;username&gt;' was interpreted as
</I>&gt;<i> part of the username.
</I>&gt;<i>
</I>
Michael Caplan wrote:
Huh.  That's a tricky one.  The protocol does not specify a space
between the header key:value combinations, but the protocol examples do
use a space.  I'm hesitant to call this a protocol implementation bug on
the client.  I think you should push back on the MQ developers on this
one to.

Best,

Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080918/ee78e1f8/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20080918/ee78e1f8/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001521.html">[rabbitmq-discuss] Stomp frame not terminated with null	character
</A></li>
	<LI>Next message: <A HREF="001525.html">[rabbitmq-discuss] Stomp frame not terminated with null	character
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1523">[ date ]</a>
              <a href="thread.html#1523">[ thread ]</a>
              <a href="subject.html#1523">[ subject ]</a>
              <a href="author.html#1523">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
