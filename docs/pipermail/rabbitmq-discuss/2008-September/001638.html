<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Huge latency in Linux, compared with Leopard
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Huge%20latency%20in%20Linux%2C%20compared%20with%20Leopard&In-Reply-To=48DE88E5.1080207%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001637.html">
   <LINK REL="Next"  HREF="001639.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Huge latency in Linux, compared with Leopard</H1>
    <B>Holger Hoffst&#228;tte</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20Huge%20latency%20in%20Linux%2C%20compared%20with%20Leopard&In-Reply-To=48DE88E5.1080207%40lshift.net"
       TITLE="[rabbitmq-discuss] Huge latency in Linux, compared with Leopard">holger at wizards.de
       </A><BR>
    <I>Sat Sep 27 21:24:57 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001637.html">[rabbitmq-discuss] Huge latency in Linux, compared with Leopard
</A></li>
        <LI>Next message: <A HREF="001639.html">[rabbitmq-discuss] Huge latency in Linux, compared with Leopard
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1638">[ date ]</a>
              <a href="thread.html#1638">[ thread ]</a>
              <a href="subject.html#1638">[ subject ]</a>
              <a href="author.html#1638">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias Radestock wrote:
&gt;<i> Adding the line
</I>&gt;<i> 
</I>&gt;<i>     -kernel inet_default_listen_options '[{nodelay, true}]' \
</I>&gt;<i> 
</I>&gt;<i> to the options in the rabbitmq-server script does improve the results
</I>&gt;<i> significantly.
</I>
Yay! Glad it helped.

&gt;<i> So should we make TCP_NODELAY the default?
</I>
That's difficult to decide, though IMHO it is probably the right thing to
do for most common scenarios today. Ironically after I had found the
problem I remembered that I had read something related on the Linux kernel
list, where someone from RedHat was complaining about 40ms latency. :)

Find the juicy details here:
<A HREF="http://marc.info/?l=linux-netdev&amp;m=122091100407930&amp;w=2">http://marc.info/?l=linux-netdev&amp;m=122091100407930&amp;w=2</A>

Other treads of interest may be:
<A HREF="http://www.nabble.com/slow-tcp-acks-on-loopback-device-td464386.html">http://www.nabble.com/slow-tcp-acks-on-loopback-device-td464386.html</A>
<A HREF="http://www.nabble.com/What-happened-to-CONFIG_TCP_NAGLE_OFF--td7588964.html">http://www.nabble.com/What-happened-to-CONFIG_TCP_NAGLE_OFF--td7588964.html</A>

I also found that the Windows stack automatically turns Nagle off for
loopback connections, and I assume other BSD-based OS (OS X) do as well.
This would explain the platform-specific observations.

Nagle makes sense in order to maximize bandwidth and prevent wasting
packets for small payloads (~couple bytes, as for telnet) that can be
packed together into one MTU. This may or may not make sense for Rabbit
but is dependent on the network link and the payloads. So turning it off
may be the right thing for localhost/LAN messaging where the cost of a
single packet is low, but not at all for large(r) payloads and high
bandwidth or slower tranports. I doubt that there are any people left who
want to run over modem or carrier pidgeon..

I am really looking forward to SCTP (as the lkml thread mentions) since so
many of the underlying assumptions behind TCP have changed these days that
no matter what the stacks try to do, it's always kind of wrong. Now it
only needs to become stable..

Holger


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001637.html">[rabbitmq-discuss] Huge latency in Linux, compared with Leopard
</A></li>
	<LI>Next message: <A HREF="001639.html">[rabbitmq-discuss] Huge latency in Linux, compared with Leopard
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1638">[ date ]</a>
              <a href="thread.html#1638">[ thread ]</a>
              <a href="subject.html#1638">[ subject ]</a>
              <a href="author.html#1638">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
