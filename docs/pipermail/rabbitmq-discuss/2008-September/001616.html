<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20problem&In-Reply-To=F6DB6521-2340-46E1-88A6-4928C0440C35%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001615.html">
   <LINK REL="Next"  HREF="001617.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ problem</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20problem&In-Reply-To=F6DB6521-2340-46E1-88A6-4928C0440C35%40gmail.com"
       TITLE="[rabbitmq-discuss] RabbitMQ problem">matthias at lshift.net
       </A><BR>
    <I>Fri Sep 26 05:48:11 BST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001615.html">[rabbitmq-discuss] RabbitMQ problem
</A></li>
        <LI>Next message: <A HREF="001617.html">[rabbitmq-discuss] RabbitMQ problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1616">[ date ]</a>
              <a href="thread.html#1616">[ thread ]</a>
              <a href="subject.html#1616">[ subject ]</a>
              <a href="author.html#1616">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Valentino,

Valentino Volonghi wrote:
&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i> 
</I>&gt;<i> Hi, I think I've found another bug in RabbitMQ.
</I>&gt;<i> 
</I>&gt;<i> Basically:
</I>&gt;<i> * create durable exchange and durable queue
</I>&gt;<i> * start a transaction
</I>&gt;<i> * send a couple of messages
</I>&gt;<i> * with the transaction still open delete the queue that was matching
</I>&gt;<i> * commit the transaction
</I>&gt;<i> * send some other messages
</I>&gt;<i> 
</I>&gt;<i> - -&gt; rabbitmq will fail (but this is not the problem) with the following  
</I>&gt;<i> error:
</I>&gt;<i> 
</I>&gt;<i> =ERROR REPORT==== 25-Sep-2008::17:32:28 ===
</I>&gt;<i> connection &lt;0.155.0&gt; (running), channel 1 - error:
</I>&gt;<i> {commit_failed,
</I>&gt;<i>      [{exit,
</I>&gt;<i>           {noproc,{gen_server,call,[&lt;0.169.0&gt;,{commit,{{2,&lt;0.161.0&gt;}, 
</I>&gt;<i> 36}}]}}}]}
</I>&gt;<i> 
</I>&gt;<i> =ERROR REPORT==== 25-Sep-2008::17:32:28 ===
</I>&gt;<i> Non-AMQP exit reason '{commit_failed,
</I>&gt;<i>                            [{exit,
</I>&gt;<i>                                 {noproc,
</I>&gt;<i>                                     {gen_server,call,
</I>&gt;<i>                                         [&lt;0.169.0&gt;,
</I>&gt;<i>                                          {commit,{{2,&lt;0.161.0&gt;}, 
</I>&gt;<i> 36}}]}}}]}'
</I>&gt;<i> 
</I>
This behaviour is intentional. IMO it would be wrong for the tx commit 
to succeed when a participating queue has been deleted. The AMQP spec 
doesn't specify what should happen in this case though, so we simply 
throw an exception which in turn will cause the connection to be closed 
with an INTERNAL_ERROR.

&gt;<i> ====&gt; Here's the error then: rabbitmq simply stops delivering messages  
</I>&gt;<i> and I think
</I>&gt;<i> it actually loses all the messages that it receives after the failing  
</I>&gt;<i> commit.
</I>
That would be because the connection has been closed.

&gt;<i> I tried adding code that in case of a failed commit runs the rollback  
</I>
Since the connection will have been closed there is no point in doing that.

&gt;<i> but apparently I don't even receive the failed commit message.
</I>
That is strange. What client are you using?


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001615.html">[rabbitmq-discuss] RabbitMQ problem
</A></li>
	<LI>Next message: <A HREF="001617.html">[rabbitmq-discuss] RabbitMQ problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1616">[ date ]</a>
              <a href="thread.html#1616">[ thread ]</a>
              <a href="subject.html#1616">[ subject ]</a>
              <a href="author.html#1616">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
