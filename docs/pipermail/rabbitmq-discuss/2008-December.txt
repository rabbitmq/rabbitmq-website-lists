From brian.noguchi at gmail.com  Mon Dec  1 00:54:56 2008
From: brian.noguchi at gmail.com (Brian Noguchi)
Date: Sun, 30 Nov 2008 16:54:56 -0800
Subject: [rabbitmq-discuss] Name of particular mercurial branch for
	basic.qos feature?
In-Reply-To: <49331823.3060204@lshift.net>
References: <efc1839e0811301333m2d61e5c5mebb4b0f3808c727a@mail.gmail.com>
	<493312CD.7020709@lshift.net>
	<efc1839e0811301431t27d03ee5n29703e2321f0dcbd@mail.gmail.com>
	<49331823.3060204@lshift.net>
Message-ID: <efc1839e0811301654j255ca5b7m685d58d1145d3a87@mail.gmail.com>

Hi Matthias,

To answer your questions:

Is the number of consumers constant?
No, I am trying to adjust the number of consumers to accommodate increases
in the rate of publishing.

Can you arrange for all consumers to subscribe before messages are being
published?
Before I publish any messages, I make sure the consumers are subscribed.
However, I cannot do this for new consumers I want to add when I am trying
to match the publishing rate.

Are all your consumers operating at approximately the same rate?
Each consumer is identical, so they should all be operating at approximately
the same rate

Is the total rate of consumption greater than the rate of publication? (It
better be, or you will run out of memory eventually)
My goal is to increase the consumers to match the queue length (and
therefore the rate of publication).

What are your suggestions?

Thanks,
--Brian

On Sun, Nov 30, 2008 at 2:48 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Brian,
>
> Brian Noguchi wrote:
>
>> If I don't use the branch, what strategy would you suggest in order to
>> make sure that several consumers of a queue are consuming an equal number of
>> messages without all the messages piling up into the local buffer of a
>> consumer?  Any other alternatives than just doing a Basic.get periodically?
>>
>
> That depends on the use case.
>
> Is the number of consumers constant?
>
> Can you arrange for all consumers to subscribe before messages are being
> published?
>
> Are all your consumers operating at approximately the same rate?
>
> Is the total rate of consumption greater than the rate of publication? (It
> better be, or you will run out of memory eventually)
>
>
> Depending on the answers to the above, the normal round-robin distribution
> mechanisms employed by queues may suffice.
>
>
> Matthias
> PS: please keep the list cc'ed.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081130/7644bbfc/attachment.htm 

From matthias at lshift.net  Mon Dec  1 07:35:31 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 01 Dec 2008 07:35:31 +0000
Subject: [rabbitmq-discuss] Name of particular mercurial branch
 for	basic.qos feature?
In-Reply-To: <efc1839e0811301654j255ca5b7m685d58d1145d3a87@mail.gmail.com>
References: <efc1839e0811301333m2d61e5c5mebb4b0f3808c727a@mail.gmail.com>	<493312CD.7020709@lshift.net>	<efc1839e0811301431t27d03ee5n29703e2321f0dcbd@mail.gmail.com>	<49331823.3060204@lshift.net>
	<efc1839e0811301654j255ca5b7m685d58d1145d3a87@mail.gmail.com>
Message-ID: <493393C3.9050400@lshift.net>

Brian,

Brian Noguchi wrote:
> No, I am trying to adjust the number of consumers to accommodate
> increases in the rate of publishing.
> [...]
> My goal is to increase the consumers to match the queue length (and 
> therefore the rate of publication).

basic.get should work quite well in this scenario.

You could have one process monitoring the queue length and creating 
consumers, and consumers could shut down when basic.get returns empty, 
or after some suitable number of retries.


Matthias.



From toby.o.h.white at googlemail.com  Mon Dec  1 11:33:05 2008
From: toby.o.h.white at googlemail.com (Toby White)
Date: Mon, 1 Dec 2008 11:33:05 +0000
Subject: [rabbitmq-discuss] Rabbitmq falling over & losing messages
In-Reply-To: <269388e30811281606v68eddbddxd8cf6821ac3c417b@mail.gmail.com>
References: <0CCF395F-1E6A-4F7F-A167-E41F824F9076@gmail.com>
	<269388e30811270833s34f2e442r2fb219092e4ff35a@mail.gmail.com>
	<C24403B9-3526-4FC9-80EE-19CF181F2DE7@gmail.com>
	<269388e30811281606v68eddbddxd8cf6821ac3c417b@mail.gmail.com>
Message-ID: <8E98F3D7-4904-4159-81E5-0E8D2FC0D71B@uszla.me.uk>


On 29 Nov 2008, at 00:06, Ben Hood wrote:

> So are you saying that with the latest version of Rabbit you are still
> losing messages that are marked as persistent (as you indicated in
> your first post)?

Yes.

> Ok, this looks normal for a case when Rabbit runs out of memory
> because you have flooded it with messages.
>
> Currently the only preventative action against this is the
> channel.flow command - see this article for the background :
> http://hopper.squarespace.com/blog/2008/11/9/flow-control-in-rabbitmq.html
>
> ATM producer throttling requires a well behaved client, i.e. one that
> obeys the channel.flow command - the Python client currently isn't
> well behaved in this respect.

Thanks - I'd seen that blog post, but was hoping I wouldn't be running  
into flooding issues quite yet!

>> even though, as best I can tell from watching the output of top,  
>> the erlang
>> process never took more than about 10% of available memory.
>
> Do you not see anything in the log about an alarm handler for  
> memory, e.g.
>
> =INFO REPORT==== 9-Nov-2008::15:13:31 ===
>    alarm_handler: {set,{system_memory_high_watermark,[]}}

No alarm handlers of any sort, nor anything obviously to do with memory.

root at domU-12-31-39-02-61-F6:/tmp# grep -i alarm rabbit.log
root at domU-12-31-39-02-61-F6:/tmp# grep -i memory rabbit.log
root at domU-12-31-39-02-61-F6:/tmp#

 From the start of message sending to the crash, the server log looks  
like:

=INFO REPORT==== 1-Dec-2008::11:25:46 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:45049

=INFO REPORT==== 1-Dec-2008::11:25:46 ===
starting TCP connection <0.216.0> from 127.0.0.1:45049

=INFO REPORT==== 1-Dec-2008::11:25:53 ===
Rolling persister log to "/tmp/rabbitmq-rabbit-mnesia/ 
rabbit_persister.LOG.previous"

=INFO REPORT==== 1-Dec-2008::11:25:59 ===
Rolling persister log to "/tmp/rabbitmq-rabbit-mnesia/ 
rabbit_persister.LOG.previous"

=INFO REPORT==== 1-Dec-2008::11:26:06 ===
Rolling persister log to "/tmp/rabbitmq-rabbit-mnesia/ 
rabbit_persister.LOG.previous"

=INFO REPORT==== 1-Dec-2008::11:26:13 ===
Rolling persister log to "/tmp/rabbitmq-rabbit-mnesia/ 
rabbit_persister.LOG.previous"

=INFO REPORT==== 1-Dec-2008::11:26:21 ===
Rolling persister log to "/tmp/rabbitmq-rabbit-mnesia/ 
rabbit_persister.LOG.previous"

=INFO REPORT==== 1-Dec-2008::11:26:30 ===
Rolling persister log to "/tmp/rabbitmq-rabbit-mnesia/ 
rabbit_persister.LOG.previous"

=INFO REPORT==== 1-Dec-2008::11:26:38 ===
Rolling persister log to "/tmp/rabbitmq-rabbit-mnesia/ 
rabbit_persister.LOG.previous"

=INFO REPORT==== 1-Dec-2008::11:26:58 ===
Rolling persister log to "/tmp/rabbitmq-rabbit-mnesia/ 
rabbit_persister.LOG.previous"

=INFO REPORT==== 1-Dec-2008::11:27:18 ===
Rolling persister log to "/tmp/rabbitmq-rabbit-mnesia/ 
rabbit_persister.LOG.previous"

=ERROR REPORT==== 1-Dec-2008::11:27:23 ===
connection <0.216.0> (running), channel 1 - error:
{amqp,internal_error,
       "commit failed: [{exit,{timeout,{gen_server,call,[<0.212.0>, 
{commit,{{1,<0.221.0>},93093}},5000]}}}]",
       'tx.commit'}

=INFO REPORT==== 1-Dec-2008::11:27:23 ===
closing TCP connection <0.216.0> from 127.0.0.1:45049

[followed by a dump of the whole queue]

> I find the memory statistic a bit strange - the alarm handler kicks in
> by default at 95%.
>
> Simon is currently looking into a issue with the way Erlang reports on
> memory consumption on Linux - maybe he can can shed some light on what
> may be going on with your installation.
>
> Also, can you give some more details about your environment? Are you
> running Xen?

Yes; this is on an Amazon EC2 instance. Currently, I'm using just a  
small instance: (1.7 GB of memory, 160 GB of instance storage, 32-bit  
platform) - eventually I'll be running on a larger instance, but I'm  
still working my way up to that; I was trying to calibrate my resource  
usage when I ran into this issue. It's running mostly Ubuntu Hardy,  
but is now using Erlang R12b-3 from Intrepid. Nothing else running on  
the instance except essential services (sshd, cron, etc)

The crash occurs consistently at about 10% memory usage. Memory usage  
actually increases shortly after the crash, up to about 30-40% or so;  
I'm guessing this is erlang formatting the queue object for output to  
the log.

Toby



From daniel.jeem at gmail.com  Mon Dec  1 14:14:46 2008
From: daniel.jeem at gmail.com (daniel jeem)
Date: Mon, 1 Dec 2008 14:14:46 +0000
Subject: [rabbitmq-discuss] help to begin with amqp
Message-ID: <984d3d830812010614q42e48f70m63c1995d0b3840e2@mail.gmail.com>

Hello all,

I want to use amqp with python,
<http://jira.amqp.org/confluence/display/AMQP/Advanced+Message+Queuing+Protocol>I
have install it well.
Please, there is examples from begining?

Please I want to know the difference between qpid, amqplib, amqp?
Thanks in advance.

Daniel.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081201/cd957764/attachment.htm 

From daniel.jeem at gmail.com  Mon Dec  1 14:21:00 2008
From: daniel.jeem at gmail.com (daniel jeem)
Date: Mon, 1 Dec 2008 14:21:00 +0000
Subject: [rabbitmq-discuss] help to begin with amqp
In-Reply-To: <984d3d830812010614q42e48f70m63c1995d0b3840e2@mail.gmail.com>
References: <984d3d830812010614q42e48f70m63c1995d0b3840e2@mail.gmail.com>
Message-ID: <984d3d830812010621y6f106e9ek16e71bc8b21c6c1e@mail.gmail.com>

I have found  this document and I want to follow it:
http://www.redhat.com/docs/en-US/Red_Hat_Enterprise_MRG/1.0/pdf/Messaging_Tutorial/Messaging_Tutorial.pdf

but I have a problm whith this basic exapmle:

import qpid
import sys
import os
from qpid.util import connect
from qpid.connection import Connection
from qpid.datatypes import Message, RangedSet, uuid4
from qpid.queue import Empty
# additional imports for a given example go here
#----- Functions and Classes ----------------------------
# Any functions and classes needed for a given example
# go here.
#----- Initialization -----------------------------------
#  Set parameters for login
host="127.0.0.1"
port=5672

user="guest"
password="guest"
# Create a connection and a session. The constructor for a session
# requires a UUID to uniquely identify the session.
socket = connect(host, port)
connection = Connection (sock=socket)
connection.start()
session = connection.session(str(uuid4()))
#----- Main Body of Program --------------------------------
#   Main body of each example goes here
#----- Cleanup ---------------------------------------------
# Close the session before exiting so there are no open threads.
session.close(timeout=10)



When I run it, that is what I see:
connection = Connection (sock=socket)
  File "/usr/lib/python2.5/site-packages/qpid/connection.py", line 52, in
__init__
    spec = load(default())
  File "/usr/lib/python2.5/site-packages/qpid/spec.py", line 43, in default
    raise Exception("unable to locate the amqp specification, please set "
Exception: unable to locate the amqp specification, please set the AMQP_SPEC
environment variable or supply qpid_config.py on the PYTHONPATH


I haven't understand were is the problem, may be in the version of my qpid.
I tried diff?rent version.

Thanks a lot.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081201/35740709/attachment.htm 

From 0x6e6562 at gmail.com  Mon Dec  1 16:40:48 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 1 Dec 2008 16:40:48 +0000
Subject: [rabbitmq-discuss] help to begin with amqp
In-Reply-To: <984d3d830812010614q42e48f70m63c1995d0b3840e2@mail.gmail.com>
References: <984d3d830812010614q42e48f70m63c1995d0b3840e2@mail.gmail.com>
Message-ID: <269388e30812010840r24a74801va86f7bf6eb5696a@mail.gmail.com>

Daniel,

On Mon, Dec 1, 2008 at 2:14 PM, daniel jeem <daniel.jeem at gmail.com> wrote:
> I want to use amqp with python,
> I have install it well.
> Please, there is examples from begining?

IIRC Dmitriy has a Python AMQP category on his blog:
http://somic.org/category/rabbitmq/

> Please I want to know the difference between qpid, amqplib, amqp?

To run QPid's Python library with Rabbit, you need to supply the path
to the 0-8 version of the AMQP XML specification using the -s flag.

Barry's python client (http://barryp.org/software/py-amqplib/) does
not require you to supply this because the codec has been generated at
build time.

Hence a lot people *seem* to prefer this variant because it may be
easier to use.

However, there are heaps of Python people on this list, maybe they add
their experience to this question.

HTH,

Ben



From 0x6e6562 at gmail.com  Mon Dec  1 17:00:35 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 1 Dec 2008 17:00:35 +0000
Subject: [rabbitmq-discuss] Rabbitmq falling over & losing messages
In-Reply-To: <8E98F3D7-4904-4159-81E5-0E8D2FC0D71B@uszla.me.uk>
References: <0CCF395F-1E6A-4F7F-A167-E41F824F9076@gmail.com>
	<269388e30811270833s34f2e442r2fb219092e4ff35a@mail.gmail.com>
	<C24403B9-3526-4FC9-80EE-19CF181F2DE7@gmail.com>
	<269388e30811281606v68eddbddxd8cf6821ac3c417b@mail.gmail.com>
	<8E98F3D7-4904-4159-81E5-0E8D2FC0D71B@uszla.me.uk>
Message-ID: <269388e30812010900w291daf6k7fe05c6c67738be2@mail.gmail.com>

Toby,

On Mon, Dec 1, 2008 at 11:33 AM, Toby White
<toby.o.h.white at googlemail.com> wrote:
>> Do you not see anything in the log about an alarm handler for memory, e.g.
>>
>> =INFO REPORT==== 9-Nov-2008::15:13:31 ===
>>   alarm_handler: {set,{system_memory_high_watermark,[]}}

I've tried to simulate your test locally and get the same results,
albeit with different figures. The issue is that even with persistent
messaging, you are still bound by memory because Rabbit basically
copies the in-memory copy of the message to the journal. You can see
this by the fact that Erlang tries to allocate ~700MB of memory in one
hit:

> Crash dump was written to: erl_crash.dump
> eheap_alloc: Cannot allocate 729810240 bytes of memory (of type "heap").
> Aborted

Because the increment is so big, the memory supervisor does not get a
chance to set the high watermark and let producer flow control
throttle the rate of production because the interpreter has already
died.

This is caused by the fact that you have nothing consuming messages
and hence the persister log is growing continuously. Because of the
way that the snapshot mechanism currently works, an increasing amount
of memory is required to create snapshots of a growing journal.

A solution to this may be to refactor the persister so that it can
handle large surges in persistent message volumes without having to
rely on something draining it.

However, we are looking into the whole disk based queue paging area in
general and it may be more appropriate to incorporate a solution for
the symptom you are seeing into that work.

Another reason to not just *optimize* the persister is also holistic -
even if you can write stuff down to disk in a smooth fashion, you are
still going to run into the issue that all messages are still kept in
memory.

HTH,

Ben



From gsim at redhat.com  Mon Dec  1 17:26:02 2008
From: gsim at redhat.com (Gordon Sim)
Date: Mon, 01 Dec 2008 17:26:02 +0000
Subject: [rabbitmq-discuss] help to begin with amqp
In-Reply-To: <984d3d830812010621y6f106e9ek16e71bc8b21c6c1e@mail.gmail.com>
References: <984d3d830812010614q42e48f70m63c1995d0b3840e2@mail.gmail.com>
	<984d3d830812010621y6f106e9ek16e71bc8b21c6c1e@mail.gmail.com>
Message-ID: <49341E2A.8080109@redhat.com>

daniel jeem wrote:
> 
> 
> I have found  this document and I want to follow it:
> 
> http://www.redhat.com/docs/en-US/Red_Hat_Enterprise_MRG/1.0/pdf/Messaging_Tutorial/Messaging_Tutorial.pdf

That tutorial is based on the latest AMQP spec (0-10) and the examples 
in it will only work against a broker that supports that version. Either 
  qpid-users at incubator.apache.org or rhemrg-users-list at redhat.com are 
more appropriate lists for discussing it.



From 0x6e6562 at gmail.com  Mon Dec  1 19:25:44 2008
From: 0x6e6562 at gmail.com (0x6e6562 at gmail.com)
Date: Mon, 1 Dec 2008 19:25:44 +0000
Subject: [rabbitmq-discuss] Fwd:  Rabbitmq falling over & losing messages
In-Reply-To: <8B1CAAA2-F11E-4707-985D-376327B3D39C@gmail.com>
References: <0CCF395F-1E6A-4F7F-A167-E41F824F9076@gmail.com>
	<269388e30811270833s34f2e442r2fb219092e4ff35a@mail.gmail.com>
	<C24403B9-3526-4FC9-80EE-19CF181F2DE7@gmail.com>
	<269388e30811281606v68eddbddxd8cf6821ac3c417b@mail.gmail.com>
	<8E98F3D7-4904-4159-81E5-0E8D2FC0D71B@uszla.me.uk>
	<269388e30812010900w291daf6k7fe05c6c67738be2@mail.gmail.com>
	<8B1CAAA2-F11E-4707-985D-376327B3D39C@gmail.com>
Message-ID: <269388e30812011125x2be6c9ffn478acde3bc5061ee@mail.gmail.com>

---------- Forwarded message ----------
From: Toby White <toby.o.h.white at googlemail.com>
Date: Mon, 1 Dec 2008 18:11:38 +0000
Subject: Re: [rabbitmq-discuss] Rabbitmq falling over & losing messages
To: Ben Hood <0x6e6562 at gmail.com>

Thanks for the explanation; that makes sense.

Am I right in thinking that the rate of message arrival is unimportant
- ie that if I fed the messages in more slowly (still without
consumers) I'd still see the same behaviour, of Erlang aggressively
trying to grab too much memory, failing, and crashing?

I should clarify, I don't intend that there not be any consumers - but
the intended workflow was that large numbers of messages are
periodically dumped to a queue, while workers constantly consume at a
much lower instantaneous rate (though obviously the long-term ingress
and egress rates will be equal). I'd hoped to be able to dump more
messages, but for the moment I can get round this by sending fewer,
larger, messages.

I think you're probably right that it makes most sense to solve this
issue as part of the more general issue of paging queues to disk -
this is certainly not blocking me now.

Toby

On 1 Dec 2008, at 17:00, Ben Hood wrote:

> Toby,
>
> On Mon, Dec 1, 2008 at 11:33 AM, Toby White
> <toby.o.h.white at googlemail.com> wrote:
>>> Do you not see anything in the log about an alarm handler for
>>> memory, e.g.
>>>
>>> =INFO REPORT==== 9-Nov-2008::15:13:31 ===
>>>  alarm_handler: {set,{system_memory_high_watermark,[]}}
>
> I've tried to simulate your test locally and get the same results,
> albeit with different figures. The issue is that even with persistent
> messaging, you are still bound by memory because Rabbit basically
> copies the in-memory copy of the message to the journal. You can see
> this by the fact that Erlang tries to allocate ~700MB of memory in one
> hit:
>
>> Crash dump was written to: erl_crash.dump
>> eheap_alloc: Cannot allocate 729810240 bytes of memory (of type
>> "heap").
>> Aborted
>
> Because the increment is so big, the memory supervisor does not get a
> chance to set the high watermark and let producer flow control
> throttle the rate of production because the interpreter has already
> died.
>
> This is caused by the fact that you have nothing consuming messages
> and hence the persister log is growing continuously. Because of the
> way that the snapshot mechanism currently works, an increasing amount
> of memory is required to create snapshots of a growing journal.
>
> A solution to this may be to refactor the persister so that it can
> handle large surges in persistent message volumes without having to
> rely on something draining it.
>
> However, we are looking into the whole disk based queue paging area in
> general and it may be more appropriate to incorporate a solution for
> the symptom you are seeing into that work.
>
> Another reason to not just *optimize* the persister is also holistic -
> even if you can write stuff down to disk in a smooth fashion, you are
> still going to run into the issue that all messages are still kept in
> memory.
>
> HTH,
>
> Ben



From bp at barryp.org  Mon Dec  1 21:36:08 2008
From: bp at barryp.org (Barry Pederson)
Date: Mon, 01 Dec 2008 15:36:08 -0600
Subject: [rabbitmq-discuss] py-amqplib being reworked
Message-ID: <493458C8.2010303@barryp.org>

I've had some time to work on py-amqplib over the holiday, and
have done some serious rearranging of code.  The biggest
thing has been to breakup the monstrosity that was there before to 
better reflect how the protocol is layered.

I've also started working on features people have been having problems 
with or needs for, like non-blocking waits, flow-control, and handling 
of returned messages.

It's still got a ways to go, needs lots of testing, and I still may make 
some large changes, but for anyone interested I've started a new 
Mercurial repository at:

    http://hg.barryp.org/py-amqplib-devel/

The API is essentially unchanged so old users of amqplib
*should* still work.

The Connection() initializer has a "use_threading" option
that defaults to False, giving the old single-threaded behavior,
but with True it creates a helper thread that allows for
timeouts and flow control.

I'm not happy with some of the details about waiting and handling
flow-control and returned messages, and error handling needs work, so 
it's definitely a work-in-progress (actually, it always has been, but 
it's even more so for the near future).

	Barry




From chime at mu.dk  Mon Dec  1 22:45:07 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Mon, 1 Dec 2008 23:45:07 +0100
Subject: [rabbitmq-discuss] py-amqplib being reworked
In-Reply-To: <493458C8.2010303@barryp.org>
References: <493458C8.2010303@barryp.org>
Message-ID: <02FD53A4-E17C-4355-94C8-D3FE1B4E2EA5@mu.dk>

Hi Barry,

This is interesting work. We are currently using the Qpid M1 python  
client and aren't entirely satisfied, especially with error handling.  
As we're about to decide on a new client library py-amqplib has been  
considered. Until now it hasn't really been an option due to the lack  
of support for timeout, basic.reject etc. However with this latest  
message I want to consider it again.

The other candidate we have considered is naturally the Qpid M2.1 or  
M3 pythin lib. Do you have any idea about the difference? If not then  
maybe you can tell me what let you to write py-amqplib instead of  
using the Qpid client? I remember in the beginning something about  
specifically going for a unthreaded library, but it seems you have  
given that up (which incidentally makes very much sense in my book  
considering the AMQP protocol).

Regards,

Michael Arnoldus

On Dec 1, 2008, at 22:36 , Barry Pederson wrote:

> I've had some time to work on py-amqplib over the holiday, and
> have done some serious rearranging of code.  The biggest
> thing has been to breakup the monstrosity that was there before to
> better reflect how the protocol is layered.
>
> I've also started working on features people have been having problems
> with or needs for, like non-blocking waits, flow-control, and handling
> of returned messages.
>
> It's still got a ways to go, needs lots of testing, and I still may  
> make
> some large changes, but for anyone interested I've started a new
> Mercurial repository at:
>
>    http://hg.barryp.org/py-amqplib-devel/
>
> The API is essentially unchanged so old users of amqplib
> *should* still work.
>
> The Connection() initializer has a "use_threading" option
> that defaults to False, giving the old single-threaded behavior,
> but with True it creates a helper thread that allows for
> timeouts and flow control.
>
> I'm not happy with some of the details about waiting and handling
> flow-control and returned messages, and error handling needs work, so
> it's definitely a work-in-progress (actually, it always has been, but
> it's even more so for the near future).
>
> 	Barry
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081201/c8fbbc16/attachment.bin 

From 0x6e6562 at gmail.com  Tue Dec  2 01:16:50 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 2 Dec 2008 01:16:50 +0000
Subject: [rabbitmq-discuss] py-amqplib being reworked
In-Reply-To: <02FD53A4-E17C-4355-94C8-D3FE1B4E2EA5@mu.dk>
References: <493458C8.2010303@barryp.org>
	<02FD53A4-E17C-4355-94C8-D3FE1B4E2EA5@mu.dk>
Message-ID: <269388e30812011716p1ab2baf4ld6acc25e2f8de8dc@mail.gmail.com>

Michael,

On Mon, Dec 1, 2008 at 10:45 PM, Michael Arnoldus <chime at mu.dk> wrote:
> Until now it hasn't really been an option due to the lack of support for
> timeout, basic.reject etc.

ATM Rabbit does not support rejections, this is currently on the todo list.

> I remember in the beginning something about specifically going for a
> unthreaded library, but it seems you have given that up (which incidentally
> makes very much sense in my book considering the AMQP protocol).

When using the current implementation (i.e. using a thread per channel
and multiplexing across a single socket connection), this does seem
the way to go.

However, there is some discussion as to whether one should multiplex
within a single socket connection or whether one should use multiple
sockets to send independent streams of data.

Having said this, it still remains in the remit of the client library
as to whether you assign a thread per channel, a thread per connection
or a process per connection, so you might have a point with the
threading aspect.

Ben



From bp at barryp.org  Tue Dec  2 01:31:43 2008
From: bp at barryp.org (Barry Pederson)
Date: Mon, 01 Dec 2008 19:31:43 -0600
Subject: [rabbitmq-discuss] py-amqplib being reworked
In-Reply-To: <02FD53A4-E17C-4355-94C8-D3FE1B4E2EA5@mu.dk>
References: <493458C8.2010303@barryp.org>
	<02FD53A4-E17C-4355-94C8-D3FE1B4E2EA5@mu.dk>
Message-ID: <49348FFF.3000008@barryp.org>

Michael Arnoldus wrote:
> Hi Barry,
> 
> This is interesting work. We are currently using the Qpid M1 python 
> client and aren't entirely satisfied, especially with error handling. As 
> we're about to decide on a new client library py-amqplib has been 
> considered. Until now it hasn't really been an option due to the lack of 
> support for timeout, basic.reject etc. However with this latest message 
> I want to consider it again.
> 
> The other candidate we have considered is naturally the Qpid M2.1 or M3 
> pythin lib. Do you have any idea about the difference? If not then maybe 
> you can tell me what let you to write py-amqplib instead of using the 
> Qpid client? I remember in the beginning something about specifically 
> going for a unthreaded library, but it seems you have given that up 
> (which incidentally makes very much sense in my book considering the 
> AMQP protocol).
> 
> Regards,
> 
> Michael Arnoldus

Hi Michael..

Sorry, haven't looked at Qpid in a long time, so can't say anything
about differences between various versions.

I started py-amqplib instead of using Qpid because of a few things I
didn't like (keep in mind these criticisms are from what I saw over a
year ago) ....

	The documentation and examples were non-existent or unhelpful,
	or flat-out wrong/broken.

	I thought having to parse an XML spec file took too much time.
	I wanted something that could quickly start and fire off just a
	message or two.

	I thought the code was basically un-Pythonic, seemed like
	something some Java writers had slapped together so they
	could test their Java code.  I wanted something with a
	friendlier API.

	I didn't want something that *had* to use threads, because I 	
	wanted to use it with Python embedded in an SMTP server, and
	figured that would just make things less reliable when things
	*really* needed to be reliable.

I haven't given up on single-threadedness, the new code just has an
option to use a helper thread.  Without that option enabled the code
still runs much like the old version - which works well for simple needs.

If you're looking for *good* error handling, I don't think I have
anything like that yet.  The exceptions that are thrown aren't well
planned out or consistent.

The timeouts and handling of returned messages also need much polishing,
I haven't quite worked out how the API for that should work.  What's
there now seems to function but is a bit clumsy to use.

	Barry




From daniel.jeem at gmail.com  Tue Dec  2 11:06:35 2008
From: daniel.jeem at gmail.com (daniel jeem)
Date: Tue, 2 Dec 2008 11:06:35 +0000
Subject: [rabbitmq-discuss] help to begin with amqp
In-Reply-To: <49341E2A.8080109@redhat.com>
References: <984d3d830812010614q42e48f70m63c1995d0b3840e2@mail.gmail.com>
	<984d3d830812010621y6f106e9ek16e71bc8b21c6c1e@mail.gmail.com>
	<49341E2A.8080109@redhat.com>
Message-ID: <984d3d830812020306q5ac42102v97f6fde10b15d2ce@mail.gmail.com>

Thanks all for assistance :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081202/7a75d83e/attachment.htm 

From 0x6e6562 at gmail.com  Tue Dec  2 21:56:16 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 2 Dec 2008 21:56:16 +0000
Subject: [rabbitmq-discuss] py-amqplib being reworked
In-Reply-To: <61883C30-47D1-4CB5-A59E-B738A74023B0@mu.dk>
References: <493458C8.2010303@barryp.org>
	<02FD53A4-E17C-4355-94C8-D3FE1B4E2EA5@mu.dk>
	<269388e30812011716p1ab2baf4ld6acc25e2f8de8dc@mail.gmail.com>
	<61883C30-47D1-4CB5-A59E-B738A74023B0@mu.dk>
Message-ID: <269388e30812021356p567d7e98l3979cc540ab1ddc0@mail.gmail.com>

Michael,

On Tue, Dec 2, 2008 at 7:43 AM, Michael Arnoldus <chime at mu.dk> wrote:
>> ATM Rabbit does not support rejections, this is currently on the todo
>> list.
>
> My bad - I meant basic.return.
>
>> When using the current implementation (i.e. using a thread per channel
>> and multiplexing across a single socket connection), this does seem
>> the way to go.
>>
>> However, there is some discussion as to whether one should multiplex
>> within a single socket connection or whether one should use multiple
>> sockets to send independent streams of data.
>
> Well that makes sense - still I can't see how you can accept basic.return
> while consuming a queue without using threads - or have I missed something?
> Also, when waiting on a single thread how can I stop basic.consume?

Good question, I don't think that it's very expressive without using
some kind of thread model - although obviously from a kernel
perspective, everything is just a state machine :-)

Having said that, I think you *may* have taken what I said out of
perspective - just because you get rid of channels does not mean that
that you have to get rid of client side threads. The main motivation
behind command multiplexing within a single TCP connection *seems* to
be to allow multiple clients threads to use a single connection.
However, it is conceivable that each client side thread could have
it's own transport layer connection (or not-connection in the case of
UDP). So a client could thread as much as it likes, and the server
could remain oblivious of this.

The reason why command multiplexing has been questioned is because it
*apparently* re-invents flow control mechanisms that are already
available in TCP and SCTP.

I think that the question about threading is more of a client design
issue than a general protocol discussion.

HTH,

Ben



From 0x6e6562 at gmail.com  Wed Dec  3 22:59:35 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 3 Dec 2008 22:59:35 +0000
Subject: [rabbitmq-discuss] py-amqplib being reworked
In-Reply-To: <269388e30812021356p567d7e98l3979cc540ab1ddc0@mail.gmail.com>
References: <493458C8.2010303@barryp.org>
	<02FD53A4-E17C-4355-94C8-D3FE1B4E2EA5@mu.dk>
	<269388e30812011716p1ab2baf4ld6acc25e2f8de8dc@mail.gmail.com>
	<61883C30-47D1-4CB5-A59E-B738A74023B0@mu.dk>
	<269388e30812021356p567d7e98l3979cc540ab1ddc0@mail.gmail.com>
Message-ID: <269388e30812031459w3dddd4a8u9f4f1bcb394a337c@mail.gmail.com>

On Tue, Dec 2, 2008 at 9:56 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> Michael,
>
> On Tue, Dec 2, 2008 at 7:43 AM, Michael Arnoldus <chime at mu.dk> wrote:
>>> ATM Rabbit does not support rejections, this is currently on the todo
>>> list.
>>
>> My bad - I meant basic.return.

Ok, understood.

Ben



From dialtone at gmail.com  Thu Dec  4 02:21:45 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Wed, 3 Dec 2008 18:21:45 -0800
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <269388e30811201556s30cb097as5108829c416c639f@mail.gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
	<269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>
	<83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
	<269388e30810150108s5819c474pc1f96748763d1a5c@mail.gmail.com>
	<6CCA7377-6E1F-4D40-896C-7721AB3133DF@gmail.com>
	<269388e30810150315x2d0715d4jeb63cea17e20d530@mail.gmail.com>
	<8E6122DB-EEB8-40CE-9E89-247C2EC80028@gmail.com>
	<269388e30810150909h5f992ad5i2626d8988e7a992b@mail.gmail.com>
	<269388e30811201556s30cb097as5108829c416c639f@mail.gmail.com>
Message-ID: <652D161F-EC09-45F6-B617-60101FD8C022@gmail.com>


On Nov 20, 2008, at 3:56 PM, Ben Hood wrote:

> In the run up to the Erlang client release, there are still a few
> patches pending QA on the Erlang client, hopefully these will be
> accepted into the main tree sometime soon.


Is there still time to add the small patches attached to the QA?

The patches do the following:

  * basic_properties.diff: allows changing some parameters in the  
properties header
  * connection_api.diff: allows differentiating direct and remote  
connections and
                                         specify a username in the  
meantime
  * delivery_mode.diff: allows the publish call to set the  
delivery_mode for the messages
  * durable_exchange.diff: allows creation of durable exchanges from  
the api
  * durable_queues.diff: allows creation of durable queues from the api

All of these patches are against the main branch tip revision as of  
today.

Our current test system uses all of them to work properly.

Sidenote: hg record is a wonderfully useful extension for hg :)

-- 
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/10c47740/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: basic_properties_patch.diff
Type: application/octet-stream
Size: 1310 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/10c47740/attachment.obj 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/10c47740/attachment-0001.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: connection_api.diff
Type: application/octet-stream
Size: 958 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/10c47740/attachment-0001.obj 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/10c47740/attachment-0002.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: delivery_mode.diff
Type: application/octet-stream
Size: 1477 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/10c47740/attachment-0002.obj 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/10c47740/attachment-0003.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: durable_exchange.diff
Type: application/octet-stream
Size: 1081 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/10c47740/attachment-0003.obj 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/10c47740/attachment-0004.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: durable_queues.diff
Type: application/octet-stream
Size: 937 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/10c47740/attachment-0004.obj 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/10c47740/attachment-0005.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/10c47740/attachment.pgp 

From dialtone at gmail.com  Thu Dec  4 02:24:30 2008
From: dialtone at gmail.com (Valentino Volonghi)
Date: Wed, 3 Dec 2008 18:24:30 -0800
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <652D161F-EC09-45F6-B617-60101FD8C022@gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
	<269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>
	<83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
	<269388e30810150108s5819c474pc1f96748763d1a5c@mail.gmail.com>
	<6CCA7377-6E1F-4D40-896C-7721AB3133DF@gmail.com>
	<269388e30810150315x2d0715d4jeb63cea17e20d530@mail.gmail.com>
	<8E6122DB-EEB8-40CE-9E89-247C2EC80028@gmail.com>
	<269388e30810150909h5f992ad5i2626d8988e7a992b@mail.gmail.com>
	<269388e30811201556s30cb097as5108829c416c639f@mail.gmail.com>
	<652D161F-EC09-45F6-B617-60101FD8C022@gmail.com>
Message-ID: <91882226-7979-4E0B-8A7E-EAD5995B8FB5@gmail.com>


On Dec 3, 2008, at 6:21 PM, Valentino Volonghi wrote:

> * basic_properties.diff: allows changing some parameters in the  
> properties header
> * connection_api.diff: allows differentiating direct and remote  
> connections and
>                                        specify a username in the  
> meantime
> * delivery_mode.diff: allows the publish call to set the  
> delivery_mode for the messages
> * durable_exchange.diff: allows creation of durable exchanges from  
> the api
> * durable_queues.diff: allows creation of durable queues from the api


Agh... they seem to have been filtered in the mail that went to the  
list.
You should have received them in your mailbox though Ben.

Otherwise tell me a way I can share each of them that suites you.

-- 
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/56188fe0/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081203/56188fe0/attachment.pgp 

From 0x6e6562 at gmail.com  Thu Dec  4 10:55:49 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 4 Dec 2008 10:55:49 +0000
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <652D161F-EC09-45F6-B617-60101FD8C022@gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
	<269388e30810141554n74aa1360h58e6be51a7c6145b@mail.gmail.com>
	<83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
	<269388e30810150108s5819c474pc1f96748763d1a5c@mail.gmail.com>
	<6CCA7377-6E1F-4D40-896C-7721AB3133DF@gmail.com>
	<269388e30810150315x2d0715d4jeb63cea17e20d530@mail.gmail.com>
	<8E6122DB-EEB8-40CE-9E89-247C2EC80028@gmail.com>
	<269388e30810150909h5f992ad5i2626d8988e7a992b@mail.gmail.com>
	<269388e30811201556s30cb097as5108829c416c639f@mail.gmail.com>
	<652D161F-EC09-45F6-B617-60101FD8C022@gmail.com>
Message-ID: <269388e30812040255y2068328foc9c49fa8c20b29c@mail.gmail.com>

Valentino,

On Thu, Dec 4, 2008 at 2:21 AM, Valentino Volonghi <dialtone at gmail.com> wrote:
> Is there still time to add the small patches attached to the QA?

There's always time for a patch, this is open source code after all :-)

The Erlang client won't go 1.0 until after Rabbit 1.5.0 has been
released and until a number of issues and tasks have been completed on
the client itself.

> The patches do the following:
>  * basic_properties.diff: allows changing some parameters in the properties
> header
>  * connection_api.diff: allows differentiating direct and remote connections
> and
>                                         specify a username in the meantime
>  * delivery_mode.diff: allows the publish call to set the delivery_mode for
> the messages
>  * durable_exchange.diff: allows creation of durable exchanges from the api
>  * durable_queues.diff: allows creation of durable queues from the api
> All of these patches are against the main branch tip revision as of today.
> Our current test system uses all of them to work properly.

OK, I'll have a look through these (hopefully during this week, but
we're quite busy doing QA for the 1.5.0 release).

> Sidenote: hg record is a wonderfully useful extension for hg :)

Yes, it's good that cool features from other DVCS flow into hg (in
this case it is darcs), I just wish they would take a leaf out of
git's book when it comes to history rewriting.

Ben



From 0x6e6562 at gmail.com  Thu Dec  4 10:57:49 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 4 Dec 2008 10:57:49 +0000
Subject: [rabbitmq-discuss] Catching channel disconnect
In-Reply-To: <91882226-7979-4E0B-8A7E-EAD5995B8FB5@gmail.com>
References: <FC677D6A-0C6E-47BE-ABD0-346C42FF2E13@gmail.com>
	<83A9E39B-2CBE-4BF2-A085-502321291597@gmail.com>
	<269388e30810150108s5819c474pc1f96748763d1a5c@mail.gmail.com>
	<6CCA7377-6E1F-4D40-896C-7721AB3133DF@gmail.com>
	<269388e30810150315x2d0715d4jeb63cea17e20d530@mail.gmail.com>
	<8E6122DB-EEB8-40CE-9E89-247C2EC80028@gmail.com>
	<269388e30810150909h5f992ad5i2626d8988e7a992b@mail.gmail.com>
	<269388e30811201556s30cb097as5108829c416c639f@mail.gmail.com>
	<652D161F-EC09-45F6-B617-60101FD8C022@gmail.com>
	<91882226-7979-4E0B-8A7E-EAD5995B8FB5@gmail.com>
Message-ID: <269388e30812040257w6d87ca69l12aa67900060bd2b@mail.gmail.com>

Valentino,

On Thu, Dec 4, 2008 at 2:24 AM, Valentino Volonghi <dialtone at gmail.com> wrote:
> Agh... they seem to have been filtered in the mail that went to the list.
> You should have received them in your mailbox though Ben.
> Otherwise tell me a way I can share each of them that suites you.

No worries, I did receive them in my inbox.

BTW an easy option for you to manage this and share it with others is
to fork from the Rabbit mirror on bitbucket.

Ben



From 0x6e6562 at gmail.com  Thu Dec  4 11:12:42 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 4 Dec 2008 11:12:42 +0000
Subject: [rabbitmq-discuss] [dmitriy.kargapolov@gmail.com: RabbitMQ
	Erlang Client]
In-Reply-To: <20081204095415.GN29692@silentbob.lshift.net>
References: <20081204095415.GN29692@silentbob.lshift.net>
Message-ID: <269388e30812040312m47bc4302p723be80c5cf84aed@mail.gmail.com>

Dmitriy,

BTW there is a mailing list where these kinds of things are discussed :-)

> ----- Forwarded message from Dmitriy Kargapolov <dmitriy.kargapolov at gmail.com> ----
> I've just downloaded and tried to compile Subj.
> Compilation failed because record 'queue.unbind' undefined.
> There is no definition of this record in rabbitmq_server-1.4.0 since
> server implements 0.8.
> Wondering if some extra headers missing from tip.zip...

The queue.unbind command is not available in Rabbit 1.4.0.

It is available in the current source tree of Rabbit ATM and will be
part of the next release.

Hence the easiest thing to do is to check out the latest version of
Rabbit from the repo.

The reason why the Erlang client is dependent on a particular version
of the server is twofold:

1. The Erlang client has not released as a formally supported client,
yet. This will happen after the next release of Rabbit.

2. The client re-uses a lot of the code base of the server (because
you can transparently embed the client in the address space of the
server). This coupling will be a lot more explicit when the client is
made into a formal release, though.

HTH,

Ben



From 0x6e6562 at gmail.com  Thu Dec  4 11:29:09 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 4 Dec 2008 11:29:09 +0000
Subject: [rabbitmq-discuss] py-amqplib being reworked
In-Reply-To: <30E710B6-9822-4BFD-B1FA-92ACB16EB4A1@mu.dk>
References: <493458C8.2010303@barryp.org>
	<02FD53A4-E17C-4355-94C8-D3FE1B4E2EA5@mu.dk>
	<269388e30812011716p1ab2baf4ld6acc25e2f8de8dc@mail.gmail.com>
	<61883C30-47D1-4CB5-A59E-B738A74023B0@mu.dk>
	<269388e30812021356p567d7e98l3979cc540ab1ddc0@mail.gmail.com>
	<30E710B6-9822-4BFD-B1FA-92ACB16EB4A1@mu.dk>
Message-ID: <269388e30812040329t5ace6a02nf1e79fc821b43cec@mail.gmail.com>

Michael,

On Thu, Dec 4, 2008 at 10:08 AM, Michael Arnoldus <chime at mu.dk> wrote:
>> Good question, I don't think that it's very expressive without using
>> some kind of thread model - although obviously from a kernel
>> perspective, everything is just a state machine :-)
>
> Obvoiusly :-)
>
> And of course it's possible without threads using poll/select or some
> similar mechanism.

True. Threads only present parallelism to the programmer in a easy to
understand fashion.

>> Having said that, I think you *may* have taken what I said out of
>> perspective - just because you get rid of channels does not mean that
>> that you have to get rid of client side threads. The main motivation
>> behind command multiplexing within a single TCP connection *seems* to
>> be to allow multiple clients threads to use a single connection.
>> However, it is conceivable that each client side thread could have
>> it's own transport layer connection (or not-connection in the case of
>> UDP). So a client could thread as much as it likes, and the server
>> could remain oblivious of this.
>>
>> The reason why command multiplexing has been questioned is because it
>> *apparently* re-invents flow control mechanisms that are already
>> available in TCP and SCTP.
>
> I see what you mean. Also, when we tested the OpenAMQ C client we discovered
> that it can't handle channels (don't now if this is still the case). Do you
> have any idea if channels are about to be removed?

Yes, Pieter doesn't think the channels are good idea and hence the
OpenAMQ client limits the amount of channels within a connection to
one. In order to get parallelism you need to start a separate AMQP/TCP
connection.

Personally I think this approach has its merits, because I don't think
there is any real proven benefit of re-inventing flow control, but I
may be wrong.

As to whether they will be removed, I can't say anything about the
actual spec. There is a low volume dev list at amqp.org, maybe you can
ask your question there.

HTH,

Ben



From elliot at canonical.com  Thu Dec  4 14:52:18 2008
From: elliot at canonical.com (Elliot Murphy)
Date: Thu, 04 Dec 2008 09:52:18 -0500
Subject: [rabbitmq-discuss] Is there a public RabbitMQ bug tracker?
Message-ID: <4937EEA2.20700@canonical.com>

Hi!

I'm interested in RabbitMQ personally, I think the work you are doing
with it is really neat. I'm also contemplating using Rabbit
professionally, and so am looking into what it would take to get
RabbitMQ into Ubuntu (in the universe repository). It's great that you
already provide .debs!

Going through the checklist for a new Ubuntu package here:
https://wiki.ubuntu.com/UbuntuDevelopment/CodeReviews#NewPackage

one of the requirements is "Upstream should be responsive, and maintain
a bug tracker". I've been on this list for a while, and you are
certainly responsive! This is a very healthy community. However, I
haven't been able to find a public bug tracker. Is there one?

You would be welcome to use launchpad.net for your bug tracker, if you
need one - it looks like someone already "reserved" the rabbitmq project
name for you: https://edge.launchpad.net/rabbitmq
(Launchpad allows anyone to register a project, this is often used to
get source code imported into bazaar branches automatically for the
convenience of developers). I'm sure we could get the project area on
launchpad turned over to you right away if you wanted to use it.

I've enjoyed reading through the FAQ you started here:
http://lettuce.squarespace.com/ . Just so you are aware of it,
launchpad.net has an "Answers" feature that allows people in a community
to ask questions (in a variety of languages), and then awards karma to
people for answering the questions. You can also turn questions into
FAQs, and there is a workflow for converting a question into a bug
report. https://help.launchpad.net/Answers

I'll write more to the list as time permits me to look more at reviewing
the packaging, particularly if I find anything that needs fixing.

p.s. (don't read too much into my canonical.com email address, I'm not
speaking on behalf of canonical, just as an interested user)
-- 
Elliot Murphy | https://launchpad.net/~statik/



From 0x6e6562 at gmail.com  Thu Dec  4 15:14:56 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 4 Dec 2008 15:14:56 +0000
Subject: [rabbitmq-discuss] Is there a public RabbitMQ bug tracker?
In-Reply-To: <4937EEA2.20700@canonical.com>
References: <4937EEA2.20700@canonical.com>
Message-ID: <269388e30812040714w28f1f541qf090037e9cec9396@mail.gmail.com>

Elliot,

On Thu, Dec 4, 2008 at 2:52 PM, Elliot Murphy <elliot at canonical.com> wrote:
> I'm interested in RabbitMQ personally, I think the work you are doing
> with it is really neat. I'm also contemplating using Rabbit
> professionally, and so am looking into what it would take to get
> RabbitMQ into Ubuntu (in the universe repository). It's great that you
> already provide .debs!

In the past we've spoken to the guys at Canonical to discuss this.
Basically our strategy is to get into Debian and hence get into Ubuntu
via the back door (or is that a front door?). Hubert tells me that
we're pretty close to this, but if you need to know more, I'm sure he
can give more information.

> Going through the checklist for a new Ubuntu package here:
> https://wiki.ubuntu.com/UbuntuDevelopment/CodeReviews#NewPackage
>
> one of the requirements is "Upstream should be responsive, and maintain
> a bug tracker". I've been on this list for a while, and you are
> certainly responsive! This is a very healthy community. However, I
> haven't been able to find a public bug tracker. Is there one?

We use bugzilla internally but do not expose it externally.
Essentially the mailing list is our public bug database. There have
been some discussion threads about this on the list recently.

> You would be welcome to use launchpad.net for your bug tracker, if you
> need one - it looks like someone already "reserved" the rabbitmq project
> name for you: https://edge.launchpad.net/rabbitmq

Cool, thanks for the heads up :-)

> I've enjoyed reading through the FAQ you started here:
> http://lettuce.squarespace.com/ . Just so you are aware of it,
> launchpad.net has an "Answers" feature that allows people in a community
> to ask questions (in a variety of languages), and then awards karma to
> people for answering the questions. You can also turn questions into
> FAQs, and there is a workflow for converting a question into a bug
> report. https://help.launchpad.net/Answers

Good to know, I'll check it out.

Ben



From 0x6e6562 at gmail.com  Thu Dec  4 15:33:33 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 4 Dec 2008 15:33:33 +0000
Subject: [rabbitmq-discuss] Adding users programatically
In-Reply-To: <20081204150509.GR29692@silentbob.lshift.net>
References: <20081204150509.GR29692@silentbob.lshift.net>
Message-ID: <269388e30812040733y147b57a4n883dd6da6847c495@mail.gmail.com>

Johnny,

> ----- Forwarded message from Johnny Lo <jlo at cs.up.ac.za> -----
> I am new to AMQP and RabbitMQ. I have managed to get some examples
> going, but cannot find ways to do user management programmatically. Is
> it possible to do this from a Java client or do I have to do this via
> the rabbitmqctl.bat provided? I did try to look at your document and API
> but couldn't find anything and I am sorry if I overlooked.

The only official way to do user management ATM is to use the
rabbitmqctl tool as described here:

http://www.rabbitmq.com/admin-guide.html#user-management

The other undocumented way to do this programmtically would be to use
the underlying Erlang API (rabbitmqctl is just a wrapper for this).

Remoting this API via the Java client is not possible ATM. We have had
a few ideas to extend the command set that you could send from any
client, but this is just talk
ATM.

Another alternative that you could use right now would be to devise
some kind of message format (e.g. JSON encoded) that you can send to
an embedded Erlang client that would execute against the Rabbit API.
There is a server side RPC handler component which could function as a
building block for this.

> Btw, I tested your latest version (1.4.0-beta) against the latest
> version of Erlang (5.5.6) and it didn't work but it works for version
> 5.5.5. If its working with 5.5.6, please let me know.

Yes, this is a known issue. When 1.4.0 was released, the latest Erlang
version was R12B-4 (5.5.5). Subsequently Ericsson has released R12B-5
(5.5.6) which works with the latest version from source control.

HTH,

Ben



From elliot at canonical.com  Thu Dec  4 15:41:30 2008
From: elliot at canonical.com (Elliot Murphy)
Date: Thu, 04 Dec 2008 10:41:30 -0500
Subject: [rabbitmq-discuss] Is there a public RabbitMQ bug tracker?
In-Reply-To: <269388e30812040714w28f1f541qf090037e9cec9396@mail.gmail.com>
References: <4937EEA2.20700@canonical.com>
	<269388e30812040714w28f1f541qf090037e9cec9396@mail.gmail.com>
Message-ID: <4937FA2A.5080608@canonical.com>

Ben Hood wrote:
> In the past we've spoken to the guys at Canonical to discuss this.
> Basically our strategy is to get into Debian and hence get into Ubuntu
> via the back door (or is that a front door?). Hubert tells me that
> we're pretty close to this, but if you need to know more, I'm sure he
> can give more information.

That is great to hear, I'll be very pleased to see rabbit in both debian
and ubuntu. I didn't see rabbit listed here though:
http://www.debian.org/devel/wnpp/being_packaged
http://www.debian.org/devel/wnpp/requested

Should it be?

Do you need any testing, or help with setting up a PPA (personal package
archive) for test building in the Ubuntu builders?
https://help.launchpad.net/Packaging/PPA

-- 
Elliot Murphy | https://launchpad.net/~statik/



From dmitriy.kargapolov at gmail.com  Thu Dec  4 17:25:42 2008
From: dmitriy.kargapolov at gmail.com (Dmitriy Kargapolov)
Date: Thu, 4 Dec 2008 12:25:42 -0500
Subject: [rabbitmq-discuss] [dmitriy.kargapolov@gmail.com: RabbitMQ
	Erlang Client]
In-Reply-To: <269388e30812040312m47bc4302p723be80c5cf84aed@mail.gmail.com>
References: <20081204095415.GN29692@silentbob.lshift.net>
	<269388e30812040312m47bc4302p723be80c5cf84aed@mail.gmail.com>
Message-ID: <63caf42f0812040925j7d7f6486yb3a9fe3bd20a272b@mail.gmail.com>

On Thu, Dec 4, 2008 at 6:12 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
>
> The queue.unbind command is not available in Rabbit 1.4.0.
>
> It is available in the current source tree of Rabbit ATM and will be
> part of the next release.

what is Rabbit ATM ?

>
> Hence the easiest thing to do is to check out the latest version of
> Rabbit from the repo.

I have fetched all the client/server repos and so far didn't catch
queue.unbind definition.
Could you please help me find it?

> HTH,
>
> Ben
>

Thanks.
-dk-



From 0x6e6562 at gmail.com  Thu Dec  4 17:50:20 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 4 Dec 2008 17:50:20 +0000
Subject: [rabbitmq-discuss] [dmitriy.kargapolov@gmail.com: RabbitMQ
	Erlang Client]
In-Reply-To: <63caf42f0812040915k8816df4h54c1563642cc4aba@mail.gmail.com>
References: <20081204095415.GN29692@silentbob.lshift.net>
	<269388e30812040312m47bc4302p723be80c5cf84aed@mail.gmail.com>
	<63caf42f0812040915k8816df4h54c1563642cc4aba@mail.gmail.com>
Message-ID: <269388e30812040950l69be4497ob9cc2578f4f6b28f@mail.gmail.com>

Dmitriy,

On Thu, Dec 4, 2008 at 5:15 PM, Dmitriy Kargapolov
<dmitriy.kargapolov at gmail.com> wrote:
> On Thu, Dec 4, 2008 at 6:12 AM, Ben Hood <0x6e6562 at gmail.com> wrote:
> what is Rabbit ATM ?

ATM = at the moment

> I have fetched all the client/server repos and so far didn't catch
> queue.unbind definition.
> Could you please help me find it?

Have you checked out the rabbitmq-codegen repo as sibling to the
rabbitmq-server directory?

Ben



From mdolian at engineyard.com  Thu Dec  4 22:56:57 2008
From: mdolian at engineyard.com (Matthew Dolian)
Date: Thu, 4 Dec 2008 17:56:57 -0500
Subject: [rabbitmq-discuss] RabbitMQ auto clustering issue
Message-ID: <0C3BB930-72C6-43DC-8E77-4F2A538B095A@engineyard.com>

Hello,

I'm trying to cluster 2 nodes.  When I configured /etc/default/ 
rabbitmq_cluster.config as follows:
[rabbit at host1, rabbit at host2].
I got erlang errors:  https://gist.github.com/4f1148e77bc70b02b349

So I added single quotes and am now getting this error:
https://gist.github.com/ed1647385d45c107167b

Does anyone know what could be causing this?

Thanks
Matt




From 0x6e6562 at gmail.com  Thu Dec  4 23:55:22 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 4 Dec 2008 23:55:22 +0000
Subject: [rabbitmq-discuss]  RabbitMQ auto clustering issue
In-Reply-To: <269388e30812041554wf2ea2fdhf01677e6075a1f7f@mail.gmail.com>
References: <0C3BB930-72C6-43DC-8E77-4F2A538B095A@engineyard.com>
	<269388e30812041554wf2ea2fdhf01677e6075a1f7f@mail.gmail.com>
Message-ID: <269388e30812041555p7ecd7926t2e30e1f7c7fd67c0@mail.gmail.com>

Matt,

On Thu, Dec 4, 2008 at 10:56 PM, Matthew Dolian <mdolian at engineyard.com> wrote:
> I'm trying to cluster 2 nodes.  When I configured /etc/default/
> rabbitmq_cluster.config as follows:
> [rabbit at host1, rabbit at host2].
> I got erlang errors:  https://gist.github.com/4f1148e77bc70b02b349
>
> So I added single quotes and am now getting this error:
> https://gist.github.com/ed1647385d45c107167b

So just to get the background info, your hosts are called host1 and
host2, but the log files reference ey04-s0040{5,6}. Is this correct?

Ben



From matthias at lshift.net  Fri Dec  5 00:43:14 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 05 Dec 2008 00:43:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ auto clustering issue
In-Reply-To: <0C3BB930-72C6-43DC-8E77-4F2A538B095A@engineyard.com>
References: <0C3BB930-72C6-43DC-8E77-4F2A538B095A@engineyard.com>
Message-ID: <49387922.4080309@lshift.net>

Matthew,

Matthew Dolian wrote:
> Hello,
> 
> I'm trying to cluster 2 nodes.  When I configured /etc/default/ 
> rabbitmq_cluster.config as follows:
> [rabbit at host1, rabbit at host2].
> I got erlang errors:  https://gist.github.com/4f1148e77bc70b02b349
> So I added single quotes

Well, if your hosts were *actually* called host1 and host2 then the 
quotes would have been unnecessary. But since they are called 
ey04-s00405 and ey04-s00406 the quotes are needed due to the '-' in the 
node name.

> and am now getting this error: 
>  https://gist.github.com/ed1647385d45c107167b
> Does anyone know what could be causing this?

It looks like your two nodes were once independent rabbit nodes. Please 
reset them, as documented in
   http://www.rabbitmq.com/clustering.html#auto-config


Matthias.



From mdolian at engineyard.com  Fri Dec  5 01:22:43 2008
From: mdolian at engineyard.com (Matthew Dolian)
Date: Thu, 4 Dec 2008 20:22:43 -0500
Subject: [rabbitmq-discuss] RabbitMQ auto clustering issue
In-Reply-To: <49387922.4080309@lshift.net>
References: <0C3BB930-72C6-43DC-8E77-4F2A538B095A@engineyard.com>
	<49387922.4080309@lshift.net>
Message-ID: <E515D6A7-590E-42F9-99DB-DEF26E96E4EC@engineyard.com>

Awesome.  I had to do a force_reset, but it's work now.  I wasn't  
using host1 and host2 as the host names, sorry for the ambiguous  
post.  The hosts listed in the gist were being used.  Thanks for the  
help!

On Dec 4, 2008, at 7:43 PM, Matthias Radestock wrote:

> Matthew,
>
> Matthew Dolian wrote:
>> Hello,
>> I'm trying to cluster 2 nodes.  When I configured /etc/default/  
>> rabbitmq_cluster.config as follows:
>> [rabbit at host1, rabbit at host2].
>> I got erlang errors:  https://gist.github.com/4f1148e77bc70b02b349
>> So I added single quotes
>
> Well, if your hosts were *actually* called host1 and host2 then the  
> quotes would have been unnecessary. But since they are called ey04- 
> s00405 and ey04-s00406 the quotes are needed due to the '-' in the  
> node name.
>
>> and am now getting this error:  https://gist.github.com/ed1647385d45c107167b
>> Does anyone know what could be causing this?
>
> It looks like your two nodes were once independent rabbit nodes.  
> Please reset them, as documented in
>  http://www.rabbitmq.com/clustering.html#auto-config
>
>
> Matthias.




From Andrius.Norkaitis at oryo.lt  Fri Dec  5 07:44:42 2008
From: Andrius.Norkaitis at oryo.lt (Andrius Norkaitis)
Date: Fri, 5 Dec 2008 09:44:42 +0200
Subject: [rabbitmq-discuss] user access permmisions
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAACsrStJfvhpCiJTR001Adn8BAAAAAA==@oryo.lt>

Hello,

 

Could you provide link or information what user permissions flags means.

 

There are:

passive, active, write, read or all.

 

 

I understood that it means:

"write" to exchange, "read" from query and what passive/active do? 

 

I want to allow user ("subscriber") to create named query, bind it to
exchange to read messages only.

 

 

Best regards,

Andrius 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081205/0143ec27/attachment.htm 

From digz6666 at gmail.com  Fri Dec  5 08:13:17 2008
From: digz6666 at gmail.com (aznmedia)
Date: Fri, 5 Dec 2008 00:13:17 -0800 (PST)
Subject: [rabbitmq-discuss]  Polling message from RabbitMQ by servicemix.
Message-ID: <20849425.post@talk.nabble.com>


Hello there.
I'd like to poll message from RabbitMQ queue by servicemix.

Here's xbean.xml file for the servicemix-jms binding component SU consume
(poll) messages from ibm websphere message queue.
[code]

<beans xmlns:jms="http://servicemix.apache.org/jms/1.0"
       xmlns:foo="http://mycompany.com/foo"
       xmlns:util="http://www.springframework.org/schema/util">

  <jms:endpoint service="foo:MyMQService"
    endpoint="mq"
    targetService="foo:TARGET_SERVICE_NAME_GOES_HERE"
    targetEndpoint="TARGET_ENDPOINT_GOES_HERE"
    role="consumer"
    destinationStyle="queue"
    jmsProviderDestinationName="QUEUE_NAME_GOES_HERE"
    connectionFactory="#mqConnectionFactory"
    defaultMep="http://www.w3.org/2004/08/wsdl/in-only" />


  <bean id="mqConnectionFactory"
class="com.ibm.mq.jms.MQQueueConnectionFactory">
    <property name="transportType">
      <util:constant
static-field="com.ibm.mq.jms.JMSC.MQJMS_TP_CLIENT_MQ_TCPIP" />
    </property>
    <property name="queueManager" value="QMGR_NAME_GOES_HERE" />
    <property name="hostName" value="HOST_ADDRESS_GOES_HERE" />
    <property name="channel" value="QMGR_CHANNEL_NAME_GOES_HERE" />
    <property name="port" value="PORT_NUMBER_GOES_HERE" />
  </bean>
</beans>

[/code]

I'm writing my xbean.xml file for the RabbitMQ message queue like following
but I don't know how to write.
So following xbean.xml file is a draft:

[code]
<beans xmlns:jee="http://www.springframework.org/schema/jee"
       xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://servicemix.apache.org/jms/1.0
http://servicemix.apache.org/schema/servicemix-jms-3.2.2.xsd
       http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

       <!---DEFINE ENDPOINT HERE--->

	<bean id="connectionFactory" class="com.rabbitmq.client.ConnectionFactory">
		<property name="hostName" value="localhost" />
		<property name="portNumber" value="AMQP.PROTOCOL.PORT" />
	</bean>
</beans>
[/code]

What should I write following:
1. xmlns:foo="http://mycompany.com/foo"
2. MyMQService
3. TARGET_SERVICE_NAME_GOES_HERE
4. TARGET_ENDPOINT_GOES_HERE
Maybe some of them are not required or not exists for rabbitMQ.

I've got many questions:
1. Is there any channel name in rabbitMQ?
2. Is there any queue manager in rabbitMQ?
3. What is a realm in rabbitMQ? (r_ticket =
r_channel.accessRequest(r_realm))
4. What is a ticket in rabbitMQ? (r_channel.queueDeclare(r_ticket,
r_queueName))
5. What is a exchange in rabbitMQ? (r_channel.basicPublish(r_ticket,
r_exchange, r_queueName, r_basicProperties, r_msg.getBytes()))
-- 
View this message in context: http://www.nabble.com/Polling-message-from-RabbitMQ-by-servicemix.-tp20849425p20849425.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From 0x6e6562 at gmail.com  Fri Dec  5 08:47:44 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 5 Dec 2008 08:47:44 +0000
Subject: [rabbitmq-discuss] user access permmisions
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAACsrStJfvhpCiJTR001Adn8BAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAACsrStJfvhpCiJTR001Adn8BAAAAAA==@oryo.lt>
Message-ID: <269388e30812050047v2bb503c5n554edebc26a9a060@mail.gmail.com>

Andrius,

On Fri, Dec 5, 2008 at 7:44 AM, Andrius Norkaitis
<Andrius.Norkaitis at oryo.lt> wrote:
> Could you provide link or information what user permissions flags means.

These were access flags you can set with realms, but realms have
subsequently been removed from AMQP.

There are quite a few threads on this topic, e.g.:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-September/001896.html

If you search for realms, access control or ACL on this list, you will
find a lot of information.

> I want to allow user (?subscriber") to create named query, bind it to
> exchange to read messages only.

This is not possible because vhost access control, the only access
restriction available ATM, is too coarse grained.

Again, there are many discussions on how to improve this :-)

HTH,

Ben



From 0x6e6562 at gmail.com  Fri Dec  5 08:58:32 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 5 Dec 2008 08:58:32 +0000
Subject: [rabbitmq-discuss] Polling message from RabbitMQ by servicemix.
In-Reply-To: <20849425.post@talk.nabble.com>
References: <20849425.post@talk.nabble.com>
Message-ID: <269388e30812050058k79eeba9fv8c3080786e25993d@mail.gmail.com>

Aznmedia,

On Fri, Dec 5, 2008 at 8:13 AM, aznmedia <digz6666 at gmail.com> wrote:
> What should I write following:
> 1. xmlns:foo="http://mycompany.com/foo"
> 2. MyMQService
> 3. TARGET_SERVICE_NAME_GOES_HERE
> 4. TARGET_ENDPOINT_GOES_HERE
> Maybe some of them are not required or not exists for rabbitMQ.

What I would do is to start with the plain jane Java API and gradually
work backwards to your bean definitions. There is class in the API
called ConnectionParameters which may contain all of things that you
need.

> 1. Is there any channel name in rabbitMQ?

Channels are numbered, this can be set by the client or the server.

> 2. Is there any queue manager in rabbitMQ?

Not in the MQ series sense. Or did you mean something else?

> 3. What is a realm in rabbitMQ? (r_ticket =
> r_channel.accessRequest(r_realm))
> 4. What is a ticket in rabbitMQ? (r_channel.queueDeclare(r_ticket,
> r_queueName))

Tickets and realms are deprecated and have been nuked from the current
version- please see last message I posted.

> 5. What is a exchange in rabbitMQ? (r_channel.basicPublish(r_ticket,
> r_exchange, r_queueName, r_basicProperties, r_msg.getBytes()))

Exchanges are fundamental to AMQP, you should understand this concept
before doing anything.

There are plenty of FAQs on exchanges on
http://lettuce.squarespace.com/ or just read this article for some
background:

http://hopper.squarespace.com/blog/2008/10/7/consumer-driven-messaging.html

Ben



From Andrius.Norkaitis at oryo.lt  Fri Dec  5 09:48:21 2008
From: Andrius.Norkaitis at oryo.lt (Andrius Norkaitis)
Date: Fri, 5 Dec 2008 11:48:21 +0200
Subject: [rabbitmq-discuss] user access permmisions
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAAGmMct5eGIVLlCKwKAbYjswBAAAAAA==@oryo.lt>

Thank you, Ben.

So there is just a simple access or deny on the vhost.

In my situation (insecure communication in internet cloud) I would need to
sign every message, so subscriber would know if content is tampered and who
is original sender.
I wish to have more grained security control provided by rabbit or event
ability to plug own security provider in the future releases.

Best regards,
Andrius


-----Original Message-----
From: Ben Hood [mailto:0x6e6562 at gmail.com] 
Sent: 2008.12.05 10:48
To: Andrius Norkaitis
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] user access permmisions

Andrius,

On Fri, Dec 5, 2008 at 7:44 AM, Andrius Norkaitis
<Andrius.Norkaitis at oryo.lt> wrote:
> Could you provide link or information what user permissions flags means.

These were access flags you can set with realms, but realms have
subsequently been removed from AMQP.

There are quite a few threads on this topic, e.g.:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-September/001896.h
tml

If you search for realms, access control or ACL on this list, you will
find a lot of information.

> I want to allow user ("subscriber") to create named query, bind it to
> exchange to read messages only.

This is not possible because vhost access control, the only access
restriction available ATM, is too coarse grained.

Again, there are many discussions on how to improve this :-)

HTH,

Ben




From digz6666 at gmail.com  Fri Dec  5 10:08:23 2008
From: digz6666 at gmail.com (aznmedia)
Date: Fri, 5 Dec 2008 02:08:23 -0800 (PST)
Subject: [rabbitmq-discuss] Polling message from RabbitMQ by servicemix.
In-Reply-To: <269388e30812050058k79eeba9fv8c3080786e25993d@mail.gmail.com>
References: <20849425.post@talk.nabble.com>
	<269388e30812050058k79eeba9fv8c3080786e25993d@mail.gmail.com>
Message-ID: <20850938.post@talk.nabble.com>




Ben Hood wrote:
> 
> Aznmedia,
> 
> On Fri, Dec 5, 2008 at 8:13 AM, aznmedia <digz6666 at gmail.com> wrote:
>> What should I write following:
>> 1. xmlns:foo="http://mycompany.com/foo"
>> 2. MyMQService
>> 3. TARGET_SERVICE_NAME_GOES_HERE
>> 4. TARGET_ENDPOINT_GOES_HERE
>> Maybe some of them are not required or not exists for rabbitMQ.
> 
> What I would do is to start with the plain jane Java API and gradually
> work backwards to your bean definitions. There is class in the API
> called ConnectionParameters which may contain all of things that you
> need.
> 
>> 1. Is there any channel name in rabbitMQ?
> 
> Channels are numbered, this can be set by the client or the server.
> 
>> 2. Is there any queue manager in rabbitMQ?
> 
> Not in the MQ series sense. Or did you mean something else?
> 
>> 3. What is a realm in rabbitMQ? (r_ticket =
>> r_channel.accessRequest(r_realm))
>> 4. What is a ticket in rabbitMQ? (r_channel.queueDeclare(r_ticket,
>> r_queueName))
> 
> Tickets and realms are deprecated and have been nuked from the current
> version- please see last message I posted.
> 
>> 5. What is a exchange in rabbitMQ? (r_channel.basicPublish(r_ticket,
>> r_exchange, r_queueName, r_basicProperties, r_msg.getBytes()))
> 
> Exchanges are fundamental to AMQP, you should understand this concept
> before doing anything.
> 
> There are plenty of FAQs on exchanges on
> http://lettuce.squarespace.com/ or just read this article for some
> background:
> 
> http://hopper.squarespace.com/blog/2008/10/7/consumer-driven-messaging.html
> 
> Ben
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

You said that tickets and realms are deprecated and have been nuked from the
current
version- please see last message you posted. So what version should I use?
And how should I work with rabbitMQ message queue instead using realms and
tickets?

I'm thinking of providing following to the connectionFactory in bean
definition.
virtual host
username
password
-- 
View this message in context: http://www.nabble.com/Polling-message-from-RabbitMQ-by-servicemix.-tp20849425p20850938.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From 0x6e6562 at gmail.com  Fri Dec  5 12:51:23 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 5 Dec 2008 12:51:23 +0000
Subject: [rabbitmq-discuss] Polling message from RabbitMQ by servicemix.
In-Reply-To: <20850938.post@talk.nabble.com>
References: <20849425.post@talk.nabble.com>
	<269388e30812050058k79eeba9fv8c3080786e25993d@mail.gmail.com>
	<20850938.post@talk.nabble.com>
Message-ID: <269388e30812050451n6a578623kf643adda61e612ee@mail.gmail.com>

Aznmedia

On Fri, Dec 5, 2008 at 10:08 AM, aznmedia <digz6666 at gmail.com> wrote:
> You said that tickets and realms are deprecated and have been nuked from the
> current
> version- please see last message you posted. So what version should I use?

In 1.4.0 you can still use realms and tickets but the latest source
tree doesn't have them. Also, 1.5.0 is very nearly there, so I
wouldn't bother with tickets/realms at all.

> And how should I work with rabbitMQ message queue instead using realms and
> tickets?

You can check out the latest version from the source tree.

> I'm thinking of providing following to the connectionFactory in bean
> definition.
> virtual host
> username
> password

That seems fine.

Ben



From Andrius.Norkaitis at oryo.lt  Fri Dec  5 13:51:56 2008
From: Andrius.Norkaitis at oryo.lt (Andrius Norkaitis)
Date: Fri, 5 Dec 2008 15:51:56 +0200
Subject: [rabbitmq-discuss] Polling message from RabbitMQ by servicemix.
In-Reply-To: <269388e30812050451n6a578623kf643adda61e612ee@mail.gmail.com>
References: <20849425.post@talk.nabble.com>	<269388e30812050058k79eeba9fv8c3080786e25993d@mail.gmail.com>	<20850938.post@talk.nabble.com>
	<269388e30812050451n6a578623kf643adda61e612ee@mail.gmail.com>
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAALnJvd42GzVKrw8GtkNUv88BAAAAAA==@oryo.lt>

"Also, 1.5.0 is very nearly there<..>"

Is there approximate date for 1.5 release?


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Ben Hood
Sent: 2008.12.05 14:51
To: aznmedia
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Polling message from RabbitMQ by servicemix.

Aznmedia

On Fri, Dec 5, 2008 at 10:08 AM, aznmedia <digz6666 at gmail.com> wrote:
> You said that tickets and realms are deprecated and have been nuked from
the
> current
> version- please see last message you posted. So what version should I use?

In 1.4.0 you can still use realms and tickets but the latest source
tree doesn't have them. Also, 1.5.0 is very nearly there, so I
wouldn't bother with tickets/realms at all.

> And how should I work with rabbitMQ message queue instead using realms and
> tickets?

You can check out the latest version from the source tree.

> I'm thinking of providing following to the connectionFactory in bean
> definition.
> virtual host
> username
> password

That seems fine.

Ben

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From tonyg at lshift.net  Fri Dec  5 16:55:14 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 05 Dec 2008 16:55:14 +0000
Subject: [rabbitmq-discuss] RabbitMQ ejabberd gateway
In-Reply-To: <d272f0690811201727v6c6e2f9cgfd3ca23a79de496c@mail.gmail.com>
References: <d272f0690811201727v6c6e2f9cgfd3ca23a79de496c@mail.gmail.com>
Message-ID: <49395CF2.5060508@lshift.net>

Hi Alex,

Sorry for the delay in addressing this. I hope it's still relevant.

Alex Clemesha wrote:
> 1) I can *only* use the exchange 'amq.topic' to perform the above
> example where I send messages from XMPP to AMQP and vice-versa.
> There *are* other exchanges in my AMQP network, because all
> my AMQP producers and consumers use them at the same time I'm
> trying the XMPP gateway, it just seems as though I can't make them
> XMPP buddies.

That's strange. Given a RabbitMQ/XMPP node running at 
rabbit.my.host.edu, try communicating with the JID "rabbit.my.host.edu" 
(i.e. without a node or resource part, a bare domain JID). Send it a 
message with just the word "list" in it, and it should send back a list 
of the exchanges it knows about. "list exchangename" should give you a 
list of bindings. Also, when adding a buddy to your buddy-list, if you 
become friends with "exchange at host/binding.pattern.#", the resource part 
is used in the queue.bind command. Similarly, when messages are 
delivered to you, the resource part of the from address is the 
routing-key from the message's publication.

> my question
> is this: what would the password be for the JID
> "amq.topic at rabbitmq.my.host.edu" that comes
> into existence via the RabbitMQ gateway module for ejabberd?

You can't log in as those JIDs. They're virtual, owned and controlled by 
the gateway code. Think of them as relay bots that are distant from you 
in the network. Your applications (endpoints) will have to have their 
own local JIDs, which when bound to remote exchange-JIDs will have 
proxy/relay queues created for them.

Cheers,
   Tony



From clemesha at ucsd.edu  Fri Dec  5 19:48:21 2008
From: clemesha at ucsd.edu (Alex Clemesha)
Date: Fri, 5 Dec 2008 11:48:21 -0800
Subject: [rabbitmq-discuss] RabbitMQ ejabberd gateway
In-Reply-To: <49395CF2.5060508@lshift.net>
References: <d272f0690811201727v6c6e2f9cgfd3ca23a79de496c@mail.gmail.com>
	<49395CF2.5060508@lshift.net>
Message-ID: <d272f0690812051148k692887c0r99eb3ee9955d1236@mail.gmail.com>

Tony,

On Fri, Dec 5, 2008 at 8:55 AM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Hi Alex,
>
> Sorry for the delay in addressing this. I hope it's still relevant.
Thanks for the response!  In fact, over the last two days, I was able to
solve all remaining issues that I had with this.

>
> Alex Clemesha wrote:
>>
>> 1) I can *only* use the exchange 'amq.topic' to perform the above
>> example where I send messages from XMPP to AMQP and vice-versa.
>> There *are* other exchanges in my AMQP network, because all
>> my AMQP producers and consumers use them at the same time I'm
>> trying the XMPP gateway, it just seems as though I can't make them
>> XMPP buddies.
>
> That's strange. Given a RabbitMQ/XMPP node running at rabbit.my.host.edu,
> try communicating with the JID "rabbit.my.host.edu" (i.e. without a node or
> resource part, a bare domain JID). Send it a message with just the word
> "list" in it, and it should send back a list of the exchanges it knows
> about. "list exchangename" should give you a list of bindings. Also, when
> adding a buddy to your buddy-list, if you become friends with
> "exchange at host/binding.pattern.#", the resource part is used in the
> queue.bind command. Similarly, when messages are delivered to you, the
> resource part of the from address is the routing-key from the message's
> publication.

Yes, communicating with the *bare* JID "rabbit.my.host.edu" was a crucial
piece that I was missing - for whatever reason I did not get this
*exact* requirement
from the documentation - I assume it is just a naive mistake on my part.



>
>> my question
>> is this: what would the password be for the JID
>> "amq.topic at rabbitmq.my.host.edu" that comes
>> into existence via the RabbitMQ gateway module for ejabberd?
>
> You can't log in as those JIDs. They're virtual, owned and controlled by the
> gateway code. Think of them as relay bots that are distant from you in the
> network. Your applications (endpoints) will have to have their own local
> JIDs, which when bound to remote exchange-JIDs will have proxy/relay queues
> created for them.

Yep, it is clear to me now ... got over the understanding learning curve
and now things are going great!


thanks,
Alex


> Cheers,
>  Tony
>



-- 
Alex Clemesha
clemesha.org



From lord at crocodile.org  Fri Dec  5 20:47:26 2008
From: lord at crocodile.org (Vadim Zaliva)
Date: Fri, 5 Dec 2008 12:47:26 -0800
Subject: [rabbitmq-discuss] PHP AMQP library
Message-ID: <34C73605-359C-4CE9-B12B-367BBA518D6E@crocodile.org>

Hi!

I have put together simple PHP AMQP library which I am using to
access RabbitMQ. This is a "naive" port of py-ampqlib code,
pretty much line by line.

The code is pretty fresh. I have been able to publish some messages
with it, but it needs more debugging. I am not a PHP expert,
and I am hoping for help from the open source community with testing,  
debugging
and further improvements of this code.

The project home page, where you can check out source code is hosted
at: http://code.google.com/p/php-amqplib/

For discussion, please join the group:
http://groups.google.com/group/php-amqplib-devel

For bug reports, please use bug tracking system at the project page.

Sincerely,
Vadim

--
"Hated by fools, and fools to hate, be this my motto and my fate"
(Jonathan Swift)





-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2442 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081205/a9cfd22e/attachment.bin 

From drew.smathers at gmail.com  Fri Dec  5 22:43:07 2008
From: drew.smathers at gmail.com (Drew Smathers)
Date: Fri, 5 Dec 2008 17:43:07 -0500
Subject: [rabbitmq-discuss] problems reconnecting via known_hosts
Message-ID: <368574aa0812051443h6ef0856du7547b1486787e0e0@mail.gmail.com>

Currently I am using rabbitmq 1.4.0 (and py-amqplib client) for an
application and wanted to implement reconnecting logic but have
recently run into some problems.  First some background on my
"solution":

>From my understanding, the OPEN_OK method specifies the parameter
known_hosts should be a comma-separated list of hosts known by the
current broker.  I decided to piggy back on this to implement
reconnecting logic (essentially round-robin testing of cached
hostnames).  This was been working fine ... until recently my unit
tests for reconnecting started timing out.  I noticed from the logs
that the server has stopped returning the usual list of known hosts on
OPEN_OK:

 Open OK! known_hosts []

Where [] usually contains the lists of known hosts from the server.
Is it expected that the server might not return a listing of
known_hosts to the client?  If so, are there known conditions for
this?  Or might this be a bug?

Thanks,
Drew



From matthias at lshift.net  Sat Dec  6 08:50:45 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 06 Dec 2008 08:50:45 +0000
Subject: [rabbitmq-discuss] problems reconnecting via known_hosts
In-Reply-To: <368574aa0812051443h6ef0856du7547b1486787e0e0@mail.gmail.com>
References: <368574aa0812051443h6ef0856du7547b1486787e0e0@mail.gmail.com>
Message-ID: <493A3CE5.6080307@lshift.net>

Drew,

Drew Smathers wrote:
> I noticed from the logs
> that the server has stopped returning the usual list of known hosts on
> OPEN_OK:
> 
>  Open OK! known_hosts []
> 
> Where [] usually contains the lists of known hosts from the server.
> Is it expected that the server might not return a listing of
> known_hosts to the client?  If so, are there known conditions for
> this?  Or might this be a bug?

known_hosts should contain a comma-separated list of host:port entries, 
including the host:port you are connecting to.

I am not aware if any problems in that area, so if you have a test case 
to reproduce the problem please send it to us. Also, please try running 
the tests through the tracer 
(http://www.rabbitmq.com/examples.html#tracer), to check that the server 
really isn't returning the correct information.

Note that known_hosts has been removed from AMQP in version 0-9-1, so 
you may not want to spend too much time implementing a solution based on 
it. I'd recommend using an out-of-band mechanism instead.


Matthias.



From holger at wizards.de  Sat Dec  6 09:19:59 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Sat, 06 Dec 2008 10:19:59 +0100
Subject: [rabbitmq-discuss] problems reconnecting via known_hosts
In-Reply-To: <493A3CE5.6080307@lshift.net>
References: <368574aa0812051443h6ef0856du7547b1486787e0e0@mail.gmail.com>
	<493A3CE5.6080307@lshift.net>
Message-ID: <493A43BF.404@wizards.de>

Drew,

there is a bit more discussion about known_hosts here:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-September/001900.html

Essentially it's a good idea gone wrong and hard to fix from the server's
point of view. IMHO it's unfortunate that this feature was simply removed
instead of fixed properly, but Dmitriy' points really show that the
problem should be solved differently, with lookups initiated by the client
and maybe with the help of a third party.

Holger



From drew.smathers at gmail.com  Sat Dec  6 16:25:12 2008
From: drew.smathers at gmail.com (Drew Smathers)
Date: Sat, 6 Dec 2008 11:25:12 -0500
Subject: [rabbitmq-discuss] problems reconnecting via known_hosts
In-Reply-To: <493A43BF.404@wizards.de>
References: <368574aa0812051443h6ef0856du7547b1486787e0e0@mail.gmail.com>
	<493A3CE5.6080307@lshift.net> <493A43BF.404@wizards.de>
Message-ID: <368574aa0812060825n7b810e74h282f46e71cd473b4@mail.gmail.com>

On Sat, Dec 6, 2008 at 4:19 AM, Holger Hoffst?tte <holger at wizards.de> wrote:
> Drew,
>
> there is a bit more discussion about known_hosts here:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-September/001900.html
>
> Essentially it's a good idea gone wrong and hard to fix from the server's
> point of view. IMHO it's unfortunate that this feature was simply removed
> instead of fixed properly, but Dmitriy' points really show that the
> problem should be solved differently, with lookups initiated by the client
> and maybe with the help of a third party.
>

Yes, I think I'll abandon the original known_hosts solution and
implement reconnect based on static configuration on client side.
Thanks again for the pointers.

-Drew

From bp at barryp.org  Sat Dec  6 22:14:36 2008
From: bp at barryp.org (Barry Pederson)
Date: Sat, 06 Dec 2008 16:14:36 -0600
Subject: [rabbitmq-discuss] PHP AMQP library
In-Reply-To: <34C73605-359C-4CE9-B12B-367BBA518D6E@crocodile.org>
References: <34C73605-359C-4CE9-B12B-367BBA518D6E@crocodile.org>
Message-ID: <493AF94C.3050602@barryp.org>

Vadim Zaliva wrote:
> Hi!
> 
> I have put together simple PHP AMQP library which I am using to
> access RabbitMQ. This is a "naive" port of py-ampqlib code,
> pretty much line by line.
> 
> The code is pretty fresh. I have been able to publish some messages
> with it, but it needs more debugging. I am not a PHP expert,
> and I am hoping for help from the open source community with testing, 
> debugging
> and further improvements of this code.
> 
> The project home page, where you can check out source code is hosted
> at: http://code.google.com/p/php-amqplib/
> 
> For discussion, please join the group:
> http://groups.google.com/group/php-amqplib-devel
> 
> For bug reports, please use bug tracking system at the project page.
> 
> Sincerely,
> Vadim

Wow, that looks interesting.  I don't usually do any PHP programming, 
but do have to support some PHP apps at work, so I probably can make use 
of this.

In case you missed it, I've been reorganizing the py-amqplib code and 
have a repository at http://hg.barryp.org/py-amqplib-devel/  that I 
think is in *much* better shape than the older versions.  There are 
about 10 lines relating to threading in method_framing.py, but you could 
skip those pretty easily.  If you'd like to do any similar 
reorganization of the PHP code, I can maybe help.

	Barry



From 0x6e6562 at gmail.com  Sat Dec  6 23:16:23 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 6 Dec 2008 23:16:23 +0000
Subject: [rabbitmq-discuss] PHP AMQP library
In-Reply-To: <34C73605-359C-4CE9-B12B-367BBA518D6E@crocodile.org>
References: <34C73605-359C-4CE9-B12B-367BBA518D6E@crocodile.org>
Message-ID: <269388e30812061516k746843b6hb24d6ce34ce51b8@mail.gmail.com>

Vadim,

On Fri, Dec 5, 2008 at 8:47 PM, Vadim Zaliva <lord at crocodile.org> wrote:
> I have put together simple PHP AMQP library which I am using to
> access RabbitMQ.

People have asked for a PHP client in the past so it's great to see
the community mobilize itself :-)

> This is a "naive" port of py-ampqlib code,
> pretty much line by line.

Looks pretty concise on face value :-)

> The code is pretty fresh. I have been able to publish some messages
> with it, but it needs more debugging. I am not a PHP expert,
> and I am hoping for help from the open source community with testing,
> debugging
> and further improvements of this code.

Without wanting to get too pedantic, just porting py-amqplib line for
line may have consequences for your library.

For starters, I don't know how you wrote the codec handling - in
general this is generated from the spec (see
extras/generate_skeleton_0_8.py in Barry's tree). If you've got an
automatic way to rebase PHP from the python code, that's cool, but if
not, please be aware that the spec does change periodically (e.g. the
0.9.1 spec is going to be implemented soon).

Secondly, you may want to consider how you want to handle parallelism.
The initial version of py-amqplib took a single threaded approach,
which was cool, but in some circumstances you could run into
difficulties - but I'm sure that Barry can advise.

Thirdly, I don't know whether you've read this article:
http://hopper.squarespace.com/blog/2008/6/21/build-your-own-amqp-client.html

Lastly, you might also gain some insights by looking at Aman's Ruby
library: http://github.com/tmm1/amqp/tree/master and asking questions
on the ruby amqp list.

HTH,

Ben



From tonyg at lshift.net  Sun Dec  7 11:01:16 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 07 Dec 2008 11:01:16 +0000
Subject: [rabbitmq-discuss] RabbitMQ ejabberd gateway
In-Reply-To: <d272f0690812051148k692887c0r99eb3ee9955d1236@mail.gmail.com>
References: <d272f0690811201727v6c6e2f9cgfd3ca23a79de496c@mail.gmail.com>	
	<49395CF2.5060508@lshift.net>
	<d272f0690812051148k692887c0r99eb3ee9955d1236@mail.gmail.com>
Message-ID: <493BACFC.2040105@lshift.net>

Hi Alex,

Alex Clemesha wrote:
> Thanks for the response!  In fact, over the last two days, I was able to
> solve all remaining issues that I had with this.

That's good to hear.

> Yes, communicating with the *bare* JID "rabbit.my.host.edu" was a crucial
> piece that I was missing - for whatever reason I did not get this
> *exact* requirement
> from the documentation - I assume it is just a naive mistake on my part.

Sorry about that. I guess I was still too close to the code when I wrote 
the documentation. I've just made a couple of changes to the text 
describing the bot and its address to try to fix the problem. Hopefully 
it's clearer now! (Do let me know if it isn't.)

Regards,
   Tony



From 0x6e6562 at gmail.com  Sun Dec  7 16:58:36 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 7 Dec 2008 16:58:36 +0000
Subject: [rabbitmq-discuss] [BUG] Erlang RabbitMQ client requires
	installed server code
In-Reply-To: <269388e30809101554p3697ef87q7ce452702333a63@mail.gmail.com>
References: <6c2563b20809062356k1f492631m4b62e4a7e72ca9f9@mail.gmail.com>
	<6c2563b20809071647j64bb910cp340f48bbd9b67a1b@mail.gmail.com>
	<269388e30809071653i11aec850ya78b97a5ffb65e69@mail.gmail.com>
	<6c2563b20809071706ofd4d34bh4f889c77cd26475d@mail.gmail.com>
	<6c2563b20809071713m535c5844g60e66c32075d9dbb@mail.gmail.com>
	<6c2563b20809071740r2ab07d50p5420b506ac058909@mail.gmail.com>
	<6c2563b20809071749u2ed3c633lc1488dafedaf8a6f@mail.gmail.com>
	<6c2563b20809071928r262db585vfd131641dde3a361@mail.gmail.com>
	<269388e30809080019w298a8f79l97429550c38e66d8@mail.gmail.com>
	<269388e30809101554p3697ef87q7ce452702333a63@mail.gmail.com>
Message-ID: <269388e30812070858w5119bedat7b488ede0ca3180f@mail.gmail.com>

Ed,

On Wed, Sep 10, 2008 at 10:54 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> I've started a branch for this in hg, it's called bug19373.

I've revived this bug from a black hole and have merged the current
mainline into it. I've cleaned it up a fair bit and have proposed it's
acceptance into the mainline. So whilst it's still a dev branch and
may still get rejected, you might like to see what was made out of
your contribution.

This work ties in with the Makefile refactoring that has taken place,
which is a step along the way of having separate client and server
packages.

I was just thinking how neat it could be if the Forest extension in hg
was stable and we could something simple like svn externals or git
submodules to quickly solve this issue.

HTH,

Ben



From rabbitmq-discuss_efine at usa.net  Sun Dec  7 17:13:55 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Sun, 7 Dec 2008 12:13:55 -0500
Subject: [rabbitmq-discuss] [BUG] Erlang RabbitMQ client requires
	installed server code
In-Reply-To: <269388e30812070858w5119bedat7b488ede0ca3180f@mail.gmail.com>
References: <6c2563b20809062356k1f492631m4b62e4a7e72ca9f9@mail.gmail.com>
	<269388e30809071653i11aec850ya78b97a5ffb65e69@mail.gmail.com>
	<6c2563b20809071706ofd4d34bh4f889c77cd26475d@mail.gmail.com>
	<6c2563b20809071713m535c5844g60e66c32075d9dbb@mail.gmail.com>
	<6c2563b20809071740r2ab07d50p5420b506ac058909@mail.gmail.com>
	<6c2563b20809071749u2ed3c633lc1488dafedaf8a6f@mail.gmail.com>
	<6c2563b20809071928r262db585vfd131641dde3a361@mail.gmail.com>
	<269388e30809080019w298a8f79l97429550c38e66d8@mail.gmail.com>
	<269388e30809101554p3697ef87q7ce452702333a63@mail.gmail.com>
	<269388e30812070858w5119bedat7b488ede0ca3180f@mail.gmail.com>
Message-ID: <6c2563b20812070913o7f9b0872l2ff79ad7fd8bc45b@mail.gmail.com>

On Sun, Dec 7, 2008 at 11:58 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Ed,
>
> On Wed, Sep 10, 2008 at 10:54 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> > I've started a branch for this in hg, it's called bug19373.
>
> I've revived this bug from a black hole and have merged the current
> mainline into it. I've cleaned it up a fair bit and have proposed it's
> acceptance into the mainline. So whilst it's still a dev branch and
> may still get rejected, you might like to see what was made out of
> your contribution.


Thanks, Ben, I would indeed like to see how it's done. Thanks!


> This work ties in with the Makefile refactoring that has taken place,
> which is a step along the way of having separate client and server
> packages.


Hmm, I wonder how badly the changes you have all made are going to break my
rbmq_admin module...


> I was just thinking how neat it could be if the Forest extension in hg
> was stable and we could something simple like svn externals or git
> submodules to quickly solve this issue.
>

I found my choice to make a common Erlang application worked very well for
me.


> HTH,
>
> Ben
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081207/b8eec5e9/attachment.htm 

From rabbitmq-discuss_efine at usa.net  Sun Dec  7 17:29:12 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Sun, 7 Dec 2008 12:29:12 -0500
Subject: [rabbitmq-discuss] [BUG] Erlang RabbitMQ client requires
	installed server code
In-Reply-To: <269388e30812070858w5119bedat7b488ede0ca3180f@mail.gmail.com>
References: <6c2563b20809062356k1f492631m4b62e4a7e72ca9f9@mail.gmail.com>
	<269388e30809071653i11aec850ya78b97a5ffb65e69@mail.gmail.com>
	<6c2563b20809071706ofd4d34bh4f889c77cd26475d@mail.gmail.com>
	<6c2563b20809071713m535c5844g60e66c32075d9dbb@mail.gmail.com>
	<6c2563b20809071740r2ab07d50p5420b506ac058909@mail.gmail.com>
	<6c2563b20809071749u2ed3c633lc1488dafedaf8a6f@mail.gmail.com>
	<6c2563b20809071928r262db585vfd131641dde3a361@mail.gmail.com>
	<269388e30809080019w298a8f79l97429550c38e66d8@mail.gmail.com>
	<269388e30809101554p3697ef87q7ce452702333a63@mail.gmail.com>
	<269388e30812070858w5119bedat7b488ede0ca3180f@mail.gmail.com>
Message-ID: <6c2563b20812070929u335ae920k129034b176d52b17@mail.gmail.com>

Ben

BTW, I looked at the http://lettuce.squarespace.com/donate/ page and was
disappointed by the results. I can't help but feel a little bemused about
the willingness (or apparent lack thereof) of Rabbit users to give small
donations to help get useful features implemented more quickly. Some people
may support OSS by contributing bugfixes, forum support, code, and
documentation, while others may support it by making small donations. It
appears that many are content to benefit from RabbitMQ without contributing
in any way. I mean, how hard is it to Paypal $10 (about two Starbucks'
worth)? On the other hand, maybe they just don't see a benefit for disk
paging/queue overflow. Or maybe the economy is even worse than I thought.

Ed


> Ben
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081207/105b2e91/attachment.htm 

From 0x6e6562 at gmail.com  Sun Dec  7 17:53:05 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 7 Dec 2008 17:53:05 +0000
Subject: [rabbitmq-discuss] [BUG] Erlang RabbitMQ client requires
	installed server code
In-Reply-To: <6c2563b20812070913o7f9b0872l2ff79ad7fd8bc45b@mail.gmail.com>
References: <6c2563b20809062356k1f492631m4b62e4a7e72ca9f9@mail.gmail.com>
	<6c2563b20809071706ofd4d34bh4f889c77cd26475d@mail.gmail.com>
	<6c2563b20809071713m535c5844g60e66c32075d9dbb@mail.gmail.com>
	<6c2563b20809071740r2ab07d50p5420b506ac058909@mail.gmail.com>
	<6c2563b20809071749u2ed3c633lc1488dafedaf8a6f@mail.gmail.com>
	<6c2563b20809071928r262db585vfd131641dde3a361@mail.gmail.com>
	<269388e30809080019w298a8f79l97429550c38e66d8@mail.gmail.com>
	<269388e30809101554p3697ef87q7ce452702333a63@mail.gmail.com>
	<269388e30812070858w5119bedat7b488ede0ca3180f@mail.gmail.com>
	<6c2563b20812070913o7f9b0872l2ff79ad7fd8bc45b@mail.gmail.com>
Message-ID: <269388e30812070953w73c29e0ax243dbed7e850209@mail.gmail.com>

Ed,

On Sun, Dec 7, 2008 at 5:13 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
>> This work ties in with the Makefile refactoring that has taken place,
>> which is a step along the way of having separate client and server
>> packages.
>
>
> Hmm, I wonder how badly the changes you have all made are going to break my
> rbmq_admin module...

Don't worry, she'll be right :-)

> I found my choice to make a common Erlang application worked very well for
> me.

I know, but we've got a Debian-esque packaging system, so going down
the OTP route may be a bit difficult ATM.

Ben



From 0x6e6562 at gmail.com  Sun Dec  7 17:56:57 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 7 Dec 2008 17:56:57 +0000
Subject: [rabbitmq-discuss] [BUG] Erlang RabbitMQ client requires
	installed server code
In-Reply-To: <6c2563b20812070929u335ae920k129034b176d52b17@mail.gmail.com>
References: <6c2563b20809062356k1f492631m4b62e4a7e72ca9f9@mail.gmail.com>
	<6c2563b20809071706ofd4d34bh4f889c77cd26475d@mail.gmail.com>
	<6c2563b20809071713m535c5844g60e66c32075d9dbb@mail.gmail.com>
	<6c2563b20809071740r2ab07d50p5420b506ac058909@mail.gmail.com>
	<6c2563b20809071749u2ed3c633lc1488dafedaf8a6f@mail.gmail.com>
	<6c2563b20809071928r262db585vfd131641dde3a361@mail.gmail.com>
	<269388e30809080019w298a8f79l97429550c38e66d8@mail.gmail.com>
	<269388e30809101554p3697ef87q7ce452702333a63@mail.gmail.com>
	<269388e30812070858w5119bedat7b488ede0ca3180f@mail.gmail.com>
	<6c2563b20812070929u335ae920k129034b176d52b17@mail.gmail.com>
Message-ID: <269388e30812070956x5249e23en754b62e68445799@mail.gmail.com>

Ed,

On Sun, Dec 7, 2008 at 5:29 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
> BTW, I looked at the http://lettuce.squarespace.com/donate/ page and was
> disappointed by the results. I can't help but feel a little bemused about
> the willingness (or apparent lack thereof) of Rabbit users to give small
> donations to help get useful features implemented more quickly. Some people
> may support OSS by contributing bugfixes, forum support, code, and
> documentation, while others may support it by making small donations. It
> appears that many are content to benefit from RabbitMQ without contributing
> in any way. I mean, how hard is it to Paypal $10 (about two Starbucks'
> worth)? On the other hand, maybe they just don't see a benefit for disk
> paging/queue overflow. Or maybe the economy is even worse than I thought.

FTR I've had other people approach me personally and ask if they can
send cheques instead of using Paypal and that has been bogged down in
the quagmire of international payments. Also I need to get to a few
other people about this - I've been quite busy doing release stuff and
I've been working overseas last week.

Ben



From lord at crocodile.org  Mon Dec  8 04:11:08 2008
From: lord at crocodile.org (Vadim Zaliva)
Date: Sun, 7 Dec 2008 20:11:08 -0800
Subject: [rabbitmq-discuss] PHP AMQP library
In-Reply-To: <269388e30812061516k746843b6hb24d6ce34ce51b8@mail.gmail.com>
References: <34C73605-359C-4CE9-B12B-367BBA518D6E@crocodile.org>
	<269388e30812061516k746843b6hb24d6ce34ce51b8@mail.gmail.com>
Message-ID: <E5E2368D-DB9C-4423-AD61-929D4D38B252@crocodile.org>

On Dec 6, 2008, at 15:16 , Ben Hood wrote:

> For starters, I don't know how you wrote the codec handling - in
> general this is generated from the spec (see
> extras/generate_skeleton_0_8.py in Barry's tree). If you've got an
> automatic way to rebase PHP from the python code, that's cool, but if
> not, please be aware that the spec does change periodically (e.g. the
> 0.9.1 spec is going to be implemented soon).

the is no automatic way in current PHP implementation.

> Secondly, you may want to consider how you want to handle parallelism.
> The initial version of py-amqplib took a single threaded approach,
> which was cool, but in some circumstances you could run into
> difficulties - but I'm sure that Barry can advise.

I guess it is not a problem since PHP world is single-threaded.

> Thirdly, I don't know whether you've read this article:
> http://hopper.squarespace.com/blog/2008/6/21/build-your-own-amqp-client.html
>
> Lastly, you might also gain some insights by looking at Aman's Ruby
> library: http://github.com/tmm1/amqp/tree/master and asking questions
> on the ruby amqp list.


Thanks! These links are quite interesting. I must make it clear that  
developing PHP AMQP library is not in my long term plans. I just  
needed to send some messages to RabbitMQ from PHP code and I ported  
this code. In general I am trying to avoid PHP. I would rather spend  
my time working on improving the Python library.

I hope some people will find my PHP code useful and take over from me  
and turn it into good PHP library, perhaps packaged as PEAR module. I  
will be glad to grant SVN access rights to anybody interested.  
Eventually I will be glad to cease project admin rights, once the  
right person emerges. Maybe it is a good idea to maintain it in sync  
with the Python library (as Barry mentions in the previous message),  
so some coordination may be required.

Sincerely,
Vadim

--
"Hated by fools, and fools to hate, be this my motto and my fate"
(Jonathan Swift)





-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2442 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081207/290a24e2/attachment.bin 

From alexis.richardson at cohesiveft.com  Mon Dec  8 10:44:54 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Mon, 8 Dec 2008 10:44:54 +0000
Subject: [rabbitmq-discuss] RabbitMQ plus Spring
Message-ID: <167204d20812080244u5dc039a1oe139a5b26c41cbb6@mail.gmail.com>

Hi,

I have been getting more interest from people who want to see RabbitMQ
working with Spring, from off-list.  Either via Qpid M2.1, or using
the RabbitMQ Java client natively.  I'd like to ping the list to see
where people are 'at' on this please.

Joern, did you manage to make any progress with using your initial set
of Spring tools?  http://github.com/yawn/rabbitmq-spring-tools

Best wishes

alexis



From alexis.richardson at cohesiveft.com  Mon Dec  8 11:07:54 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Mon, 8 Dec 2008 11:07:54 +0000
Subject: [rabbitmq-discuss] Is there a public RabbitMQ bug tracker?
In-Reply-To: <4937FA2A.5080608@canonical.com>
References: <4937EEA2.20700@canonical.com>
	<269388e30812040714w28f1f541qf090037e9cec9396@mail.gmail.com>
	<4937FA2A.5080608@canonical.com>
Message-ID: <167204d20812080307u1905188al4fe08e4d36253f06@mail.gmail.com>

Elliot, all,

On Thu, Dec 4, 2008 at 3:41 PM, Elliot Murphy <elliot at canonical.com> wrote:
>
> That is great to hear, I'll be very pleased to see rabbit in both debian
> and ubuntu. I didn't see rabbit listed here though:
> http://www.debian.org/devel/wnpp/being_packaged
> http://www.debian.org/devel/wnpp/requested
>
> Should it be?
>
> Do you need any testing, or help with setting up a PPA (personal package
> archive) for test building in the Ubuntu builders?
> https://help.launchpad.net/Packaging/PPA

We would welcome assistance from the community in dealing with this.
Please could anyone interested in helping out let us know.

Cheers,

alexis



From chime at mu.dk  Mon Dec  8 14:32:40 2008
From: chime at mu.dk (Michael Arnoldus)
Date: Mon, 8 Dec 2008 15:32:40 +0100
Subject: [rabbitmq-discuss] AMQP 0-9-1 released
In-Reply-To: <167204d20811200315y5509aac7k3be80eb12384b9ea@mail.gmail.com>
References: <167204d20811200315y5509aac7k3be80eb12384b9ea@mail.gmail.com>
Message-ID: <8380B79C-25DD-4C69-8AB9-64923EF6ECAC@mu.dk>

Hi Alexis,

A bit late but I think this very good news. Now let's hope all  
implementers will implement 0.9.1 :-)

Enjoy,

Michael

On Nov 20, 2008, at 12:15 , Alexis Richardson wrote:

> Hi,
>
> The RabbitMQ team is very pleased to announce that the AMQP 0-9-1
> specification was approved by the AMQP Working Group in a vote
> yesterday.
>
> The need for AMQP 0-9-1 arose from the AMQP community and AMQP
> customers.  The community wants interoperability - indeed this is a
> major goal of AMQP.  People frequently try to download a broker from
> one implementor, and use it with a client from another implementor.
> Even when both sets of code implement the same specification, this has
> not always worked 'out of the box'.
>
> Frequently asked questions have included "how to I do I .."
>
> * get OpenAMQ's C client working with RabbitMQ,
> * or get RabbitMQ's Java client to work with OpenAMQ
> * use QPid's M2.1 JMS-style Java client with RabbitMQ
>
> This has all been possible and people have done it, but in each case
> it has been a few hours of coding to get it working, without the
> assurance you want from a fully QAd or regression-tested and certified
> package.
>
> So I think we all want interop to work out of the box and many people
> have said they expect this too.  Interop would also remove cost from
> "business to business" integration projects.
>
> AMQP 0-9-1 was created to meet that need.  It is a simplified 'interop
> release' that starts from the 0-9 specification and then fixes interop
> bugs and removes a lot of unused material.  For reasons of backwards
> compatibility with certain existing deployments, the 0-9-1 spec will
> work with 0-9 wire frames.  This means that the community can expect
> to get what it demands: a set of brokers and clients that work
> together.
>
> The work to achieve this clean up was a collective effort and
> represents 18 months of 'lessons learnt in production' by all the
> major AMQP implementations in the 0-8/0-9 family.  Documents should
> appear on http://www.amqp.org imminently.  Thank-you to all those
> involved on behalf of the RabbitMQ team.
>
> I should also explain what AMQP 0-9-1 is *not*.  It does not
> interoperate with AMQP 0-10.  AMQP 0-10 introduces technology for
> transactional 'once and only once' delivery within the protocol.
> Similar features are planned for AMQP 1.0 which is currently under
> development by the Working Group.  So please see 0-9-1 as a
> stabilisation of earlier spec work, based on hard experience in
> production with the 0-8 and 0-9 protocols.  Current and future
> protocol work concerns the step up to the 1.0 business requirements as
> published on http://www.amqp.org.
>
> What does this mean for RabbitMQ users?
>
> Interop is good news for RabbitMQ because we think messaging should
> 'just work'.  RabbitMQ will implement AMQP 0-9-1 on the 1.x tree.
> AMQP 0-9-1 is absurdly similar to 0-8 and 0-9, which is one reason we
> found the 'interop delta' so frustrating.
>
> For RabbitMQ users this means a migration path not much more complex
> than (say) moving from RabbitMQ 1.3 to 1.4.  Existing deployments will
> continue to work but some methods - eg. access tickets - are now
> formally deprecated.  For implementors of clients, the cost of
> upgrading to 0-9-1 should not be more than a day's coding in most
> cases.  RabbitMQ will provide updated client codegen tools when an
> 0-9-1 broker is released.
>
> In terms of timing and details of the RabbitMQ 1.x broker roadmap, I
> refer you to the development team.  For discussions on this as well as
> packaging dependencies, and client release plans, we strongly urge the
> community to come forward with comments, questions and offers of
> assistance.
>
> We hope the RabbitMQ community places a high value on 0-9-1 interop -
> as high as we do as providers of the product.  I cannot speak here for
> the other implementations but we have good reason to believe that
> their respective communities will value 0-9-1 interop equally highly.
> But if you see gaps - please jump in and help with some code or
> requirements.  Or - even better - provide some test harnesses.  And if
> you see any errata then you can also list them here.
>
> What about 2009?
>
> With interest growing in AMQP around the community, and the Working
> Group being joined by Microsoft, we think AMQP is in good shape for
> the future.
>
> Members of the RabbitMQ community who wish to contribute to the
> development of the protocol as we move towards 1.0, should not be shy
> of speaking up on this list.  We aim to track this spec and invite
> implementation ideas for RabbitMQ 2.0.  We don't want to rush things -
> RabbitMQ's existing implementations set a high bar.  Stability at
> scale, and ease of use, are of the utmost importance.
>
> So - finally - I think this is a very good time to say a big thank-you
> to everyone who has made RabbitMQ successful so far.   Thank-you!
>
> Best wishes,
>
> alexis
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 1912 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081208/3659e95b/attachment.bin 

From mdarling at veodia.com  Mon Dec  8 17:26:33 2008
From: mdarling at veodia.com (Matt Darling)
Date: Mon, 08 Dec 2008 09:26:33 -0800
Subject: [rabbitmq-discuss] RabbitMQ plus Spring
In-Reply-To: <167204d20812080244u5dc039a1oe139a5b26c41cbb6@mail.gmail.com>
Message-ID: <C56298C9.1E6A%mdarling@veodia.com>

A few months back, I started to take a good look at this and wanted to take
the RabbitMQ Java client and extend it to work under some form of the JMS
implementation via spring.  Additionally, I was using Joern's implementation
as a starting point.

It shouldn't be that difficult, just a little bit of time - which is one
thing I don't have much of these days.  Has anyone else done anything that
might be usable/extendable?

-matt

On 12/8/08 12/8/08 - 2:44 AM, "Alexis Richardson"
<alexis.richardson at cohesiveft.com> wrote:

> Hi,
> 
> I have been getting more interest from people who want to see RabbitMQ
> working with Spring, from off-list.  Either via Qpid M2.1, or using
> the RabbitMQ Java client natively.  I'd like to ping the list to see
> where people are 'at' on this please.
> 
> Joern, did you manage to make any progress with using your initial set
> of Spring tools?  http://github.com/yawn/rabbitmq-spring-tools
> 
> Best wishes
> 
> alexis
> 
> 

-matt

Matt Darling
Systems Architect, Business Services
Veodia
1825 S. Grant, #500
San Mateo, CA  94402
(w) 650.349.2100 x3119
(m) 415.505.4623




From sysop at mindspring.com  Tue Dec  9 06:37:50 2008
From: sysop at mindspring.com (Matt Stancliff)
Date: Mon, 8 Dec 2008 22:37:50 -0800
Subject: [rabbitmq-discuss] erlang-client problem on OS X
	(empty_rpc_bottom_half)
Message-ID: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>

Rabbits,

I've spent the past two days attempting to track down why the erlang- 
client doesn't work for me on OS X.
Everything works fine on my Linux box.
The Linux and OS X (10.5.5) installs of everything are performed by  
the same automated scripts.

I'm running erlang (R12B-5), rabbitmq-server (tip: cedf2c7e873d) and  
the erlang-client (tip: a9695aaf5083).

The error is reproducible with a one-line  
"lib_amqp:start_channel(lib_amqp:start_connection())" (the same error  
occurs with direct or network clients).

Running through the debugger, the bottom half gets called once  
(correctly) then it gets called again but this time RequestQueue is  
empty.  I haven't been able to track down what is sending messages  
causing handle_method/2 (therefore rpc_bottom_half/2) to get called  
incorrectly.

My OS X rabbitmq install works properly with the http2 client (the  
tests run successfully and the demo apps work).

Any ideas?


The crash and error reports I've been fighting for two days are:
=====
=CRASH REPORT==== 8-Dec-2008::22:14:21 ===
   crasher:
     pid: <0.238.0>
     registered_name: []
     exception exit: empty_rpc_bottom_half
       in function  gen_server:terminate/6
     initial call: amqp_channel:init/1
     ancestors: [<0.237.0>,<0.236.0>]
     messages: []
     links: [<0.239.0>,<0.240.0>,<0.237.0>]
     dictionary: []
     trap_exit: true
     status: running
     heap_size: 610
     stack_size: 23
     reductions: 247
   neighbours:
===
=ERROR REPORT==== 8-Dec-2008::22:14:21 ===
** Generic server <0.242.0> terminating
** Last message in was {send_command,{'channel.flow',false}}
** When Server state == {channel_state,1,<0.241.0>,undefined,<0.243.0>,
                             #Fun<amqp_direct_driver.do.2>,
                             #Fun<amqp_direct_driver.do.3>,
                             #Fun<amqp_direct_driver.close_channel.1>,
                             {[],[]},
                             {[],[]},
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                  []},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[], 
[],[],
                                   [],[]}}},
                             false,undefined,
                             {dict,0,16,16,8,80,48,
                                 {[],[],[],[],[],[],[],[],[],[],[],[], 
[],[],[],
                                  []},
                                 {{[],[],[],[],[],[],[],[],[],[],[],[], 
[],[],
                                   [],[]}}}}
** Reason for termination ==
** empty_rpc_bottom_half
=====


Any pointers in the right direction will be greatly appreciated.

Sincerely,

-Matt
-- 
Matt Stancliff                    San Jose, CA
AIM: seijimr              iPhone: 678-591-9337
"The best way to predict the future is to invent it." --Alan Kay




From 0x6e6562 at gmail.com  Tue Dec  9 09:16:19 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 9 Dec 2008 09:16:19 +0000
Subject: [rabbitmq-discuss] erlang-client problem on OS X
	(empty_rpc_bottom_half)
In-Reply-To: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>
Message-ID: <269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>

Matt,

On Tue, Dec 9, 2008 at 6:37 AM, Matt Stancliff <sysop at mindspring.com> wrote:
> Rabbits,
>
> I've spent the past two days attempting to track down why the erlang-
> client doesn't work for me on OS X.
> Everything works fine on my Linux box.
> The Linux and OS X (10.5.5) installs of everything are performed by
> the same automated scripts.
>
> I'm running erlang (R12B-5), rabbitmq-server (tip: cedf2c7e873d) and
> the erlang-client (tip: a9695aaf5083).

Interesting. I've just tried these revisions (runnning R12B-5 on OS X
10.5.5) and I am unable to reproduce that error.

> =ERROR REPORT==== 8-Dec-2008::22:14:21 ===
> ** Generic server <0.242.0> terminating
> ** Last message in was {send_command,{'channel.flow',false}}
> ** When Server state == {channel_state,1,<0.241.0>,undefined,<0.243.0>,
>                             #Fun<amqp_direct_driver.do.2>,
>                             #Fun<amqp_direct_driver.do.3>,
>                             #Fun<amqp_direct_driver.close_channel.1>,
>                             {[],[]},
>                             {[],[]},
>                             {dict,0,16,16,8,80,48,
>                                 {[],[],[],[],[],[],[],[],[],[],[],[],
> [],[],[],
>                                  []},
>                                 {{[],[],[],[],[],[],[],[],[],[],[],[],
> [],[],
>                                   [],[]}}},
>                             false,undefined,
>                             {dict,0,16,16,8,80,48,
>                                 {[],[],[],[],[],[],[],[],[],[],[],[],
> [],[],[],
>                                  []},
>                                 {{[],[],[],[],[],[],[],[],[],[],[],[],
> [],[],
>                                   [],[]}}}}
> ** Reason for termination ==
> ** empty_rpc_bottom_half
> =====

Can you have a look in the rabbit log to see if there is anything like
this in it:

=INFO REPORT==== 9-Dec-2008::08:54:49 ===
    alarm_handler: {set,{system_memory_high_watermark,[]}}

My first thought is that the client may be receiving a
channel.flow{active=false} notification that it is not able to handle,
but if the client revision is a9695aaf5083 then you are on the 19963
branch which handles that command.

I've tried to channel.flow on before testing this but I still can't
reproduce this symptom.

Furthermore, I can't see how this can occur with that branch, because
the error that you are seeing, empty_rpc_bottom_half, means that the
client has received an RPC response from the server for which it has
no original request, i.e. a phantom RPC repsonse. The channel.flow
command is a reverse RPC, i.e. the server sends the client the RPC and
the client responds with a channel.flow_ok. However, the channel.flow
command has special handling in the client which does not use the
client's RPC queue. So I'm a bit baffled as to how this can happen.

So I think we need to approach this one systematically firstly using
the default branch of the server and the default branch of the client.

Can you first do a make clean run on the server and check the logs for
the alarm handler.

Then do a make clean test_network on the client and report what happens.

Ben



From opendev at gmail.com  Tue Dec  9 16:44:16 2008
From: opendev at gmail.com (Joern)
Date: Tue, 9 Dec 2008 17:44:16 +0100
Subject: [rabbitmq-discuss] RabbitMQ plus Spring
In-Reply-To: <C56298C9.1E6A%mdarling@veodia.com>
References: <167204d20812080244u5dc039a1oe139a5b26c41cbb6@mail.gmail.com>
	<C56298C9.1E6A%mdarling@veodia.com>
Message-ID: <9e009ad0812090844s45aac799g69f56e8fdebcd1d9@mail.gmail.com>

Hi Matt, hi Alexis,

2008/12/8 Matt Darling <mdarling at veodia.com>:

> A few months back, I started to take a good look at this and wanted to take
> the RabbitMQ Java client and extend it to work under some form of the JMS
> implementation via spring.  Additionally, I was using Joern's implementation
> as a starting point.
>
> It shouldn't be that difficult, just a little bit of time - which is one
> thing I don't have much of these days.  Has anyone else done anything that
> might be usable/extendable?

Sorry but I did not spent time to improve the present code. The MQ
integration in the current project was stalled byond belief and my
current time schedule is too tight to improve the situation.

The lack of practical experience with AMQP has prevented me from
writing any reasonable sane extension or better abstractions. Maybe in
2009 ... :-)

Best regards,


Joern
--



From alexis.richardson at cohesiveft.com  Tue Dec  9 23:17:35 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 9 Dec 2008 23:17:35 +0000
Subject: [rabbitmq-discuss] patch to 1.4.0 rabbitmqctl to watch rabbitmq
Message-ID: <167204d20812091517s1ec9cffbi6e508bd317d20b39@mail.gmail.com>

Hi guys,

This is from Blake at Heroku.  The ML is misbehaving so I am posting
this patch for him:

> I've patched 1.4.0's rabbitmqctl to add `snoop` which
> shows all requests being delivered as they happen.

Link: http://gist.github.com/34116

Blake, we should be able to get you on the list shortly :-)

alexis



From michael at heysan.com  Wed Dec 10 03:06:34 2008
From: michael at heysan.com (Michael Ossareh)
Date: Tue, 9 Dec 2008 19:06:34 -0800
Subject: [rabbitmq-discuss] log file management
Message-ID: <b6567e540812091906r379cd02by295885f70fb180c4@mail.gmail.com>

Hi,

Today I just restarted our rabbitmq server due to what seems to be a
memory leak somwhere in rabbitmq. We'll investigate that more; however
I noticed

rabbitmq-server/scripts/rabbitmq-server

has two bad lines in it;

[ -f  "${LOGS}" ] && cat "${LOGS}" >> "${LOGS}${BACKUP_EXTENSION}"
[ -f  "${SASL_LOGS}" ] && cat "${SASL_LOGS}" >>
"${SASL_LOGS}${BACKUP_EXTENSION}"

in our case we have many gb log files (7gb after a few days)  and the
server spends a long time putting them into cat.

I suggest changing it to

[ -f  "${LOGS}" ] && mv "${LOGS}" >> "${LOGS}${BACKUP_EXTENSION}" &&
touch "${LOGS}" && chown ${RMQUSER}.${RMQGRP} "${LOGS}"
[ -f  "${SASL_LOGS}" ] && mv "${SASL_LOGS}" >>
"${SASL_LOGS}${BACKUP_EXTENSION}" && touch "${SASL_LOGS}" && chown
${RMQUSER}.${RMQGRP} "${SASL_LOGS}"

or something like that.

Overall, however, surely log rotation is the task of logrotated? I'm
not sure how well this maps to any erlang best practices though.

More than happy to help make whatever changes are needed, but will
need some guidance.

Thanks,

mike
-- 
god loves atheists, Fact: http://www.mrwiggleslovesyou.com/comics/rehab477.jpg



From subdragon at gmail.com  Wed Dec 10 04:06:51 2008
From: subdragon at gmail.com (Yin Chen)
Date: Wed, 10 Dec 2008 12:06:51 +0800
Subject: [rabbitmq-discuss] No set_permissions any more?
Message-ID: <d1306e840812092006x7345814j1e6ff8db5280bdc0@mail.gmail.com>

Hi:
    I compile a rabbitmq from one branches of the latest source code in
hg.But I found there is no set_permissions command when I want to use
rabbitmqctl to set the permission of the new created vhost. How to set the
permission for a vhost now?

-- 
Yin Chen
http://www.douban.com/people/subdragon/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081210/01245845/attachment.htm 

From sysop at mindspring.com  Wed Dec 10 08:21:17 2008
From: sysop at mindspring.com (Matt Stancliff)
Date: Wed, 10 Dec 2008 00:21:17 -0800
Subject: [rabbitmq-discuss] erlang-client problem on OS X
	(empty_rpc_bottom_half)
In-Reply-To: <269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>
	<269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>
Message-ID: <80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>


On Dec 9, 2008, at 1:16 AM, Ben Hood wrote:

> Can you have a look in the rabbit log to see if there is anything like
> this in it:
>
> =INFO REPORT==== 9-Dec-2008::08:54:49 ===
>    alarm_handler: {set,{system_memory_high_watermark,[]}}

   Yes, that shows up on startup.

> My first thought is that the client may be receiving a
> channel.flow{active=false} notification that it is not able to handle,

   You are correct, sir.  Traces of amqp_channel show the first  
rpc_bottom_half handles channel.open_ok.  Then a {channel.flow, false}  
is sent directly to the bottom half without being enqueued anywhere.

> but if the client revision is a9695aaf5083 then you are on the 19963
> branch which handles that command.

   I ran tests in tip and some previous client and server releases to  
no avail.

> The channel.flow
> command is a reverse RPC, i.e. the server sends the client the RPC and
> the client responds with a channel.flow_ok.

   Thanks for clearing up where the channel.flow is coming from.

> However, the channel.flow
> command has special handling in the client which does not use the
> client's RPC queue. So I'm a bit baffled as to how this can happen.

   I don't see special handling of channel.flow in the client  
anywhere.  channel.flow gets passed through handle_info->handle_method- 
 >rpc_bottom_half:
(<0.74.0>) call amqp_channel:handle_info({method, 
{'channel.flow',false},none},{channel_state, 
1,<0.70.0>,<0.72.0>,<0.75.0>,#Fun<amqp_network_driver.do.2>, ...
(<0.74.0>) call amqp_channel:handle_method({'channel.flow',false}, 
{channel_state, 
1,<0.70.0>,<0.72.0>,<0.75.0>,#Fun<amqp_network_driver.do.2>, ...
(<0.74.0>) call amqp_channel:rpc_bottom_half({'channel.flow',false}, 
{channel_state, 
1,<0.70.0>,<0.72.0>,<0.75.0>,#Fun<amqp_network_driver.do.2>, ...

> Can you first do a make clean run on the server and check the logs for
> the alarm handler.

   The alarm handler is present.

> Then do a make clean test_network on the client and report what  
> happens.

   Lots of:
** Reason for termination ==
** empty_rpc_bottom_half

   If I remove the exit(empty_rpc_bottom_half) and replace it with an  
empty queue, the tests pass.  But I have no explanation why the errors  
are only happening on my OS X machine.


-Matt
-- 
Matt Stancliff                    San Jose, CA
AIM: seijimr              iPhone: 678-591-9337
"The best way to predict the future is to invent it." --Alan Kay




From 0x6e6562 at gmail.com  Wed Dec 10 08:49:50 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 10 Dec 2008 08:49:50 +0000
Subject: [rabbitmq-discuss] erlang-client problem on OS X
	(empty_rpc_bottom_half)
In-Reply-To: <80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>
	<269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>
	<80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>
Message-ID: <269388e30812100049t1ee74553w4e68eed6747e2be4@mail.gmail.com>

Matt,

On Wed, Dec 10, 2008 at 8:21 AM, Matt Stancliff <sysop at mindspring.com> wrote:
>  I don't see special handling of channel.flow in the client anywhere.
>  channel.flow gets passed through
> handle_info->handle_method->rpc_bottom_half:

This is how the current version handles the channel.flow command:

%% This handles the flow control flag that the broker initiates.
%% If defined, it informs the flow control handler to suspend submitting
%% any content bearing methods
handle_method(Flow = #'channel.flow'{active = Active},
              State = #channel_state{writer_pid = Writer, do2 = Do2,
                                     flow_handler_pid = FlowHandler}) ->
    case FlowHandler of
        undefined -> ok;
        _ -> FlowHandler ! Flow
    end,
    Do2(Writer, #'channel.flow_ok'{active = Active}),
    {noreply, State#channel_state{flow_control = not(Active)}};

Hence why I am baffled as to how the command is being processed as a
rpc_bottom_half.

>  If I remove the exit(empty_rpc_bottom_half) and replace it with an empty
> queue, the tests pass.  But I have no explanation why the errors are only
> happening on my OS X machine.

Neither do I at this stage, I will have to ponder this.

Ben



From sysop at mindspring.com  Wed Dec 10 09:25:07 2008
From: sysop at mindspring.com (Matt Stancliff)
Date: Wed, 10 Dec 2008 01:25:07 -0800
Subject: [rabbitmq-discuss] erlang-client problem on OS X
	(empty_rpc_bottom_half)
In-Reply-To: <269388e30812100049t1ee74553w4e68eed6747e2be4@mail.gmail.com>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>
	<269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>
	<80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>
	<269388e30812100049t1ee74553w4e68eed6747e2be4@mail.gmail.com>
Message-ID: <47E93AF3-7336-4AA2-9EA3-870270202117@mindspring.com>

Ben,

On Dec 10, 2008, at 12:49 AM, Ben Hood wrote:

> This is how the current version handles the channel.flow command:
>
> handle_method(Flow = #'channel.flow'{active = Active},
>
> Hence why I am baffled as to how the command is being processed as a
> rpc_bottom_half.

   Actually, that clears everything up.

My hg clone was cloning tip but checking out default (23 commits  
behind).  It works now with the correct version.  Sorry for the  
confusion.

Strangely, the current default for the client (12e791935a5d) works on  
my Linux box.


It works great now:
(rabbitmq at silicon)7>  
[lib_amqp:start_channel(lib_amqp:start_connection()) || _ <-  
lists:seq(1,4000)].
[<0.1874.0>,<0.1878.0>,<0.1882.0>,<0.1886.0>,<0.1890.0>,
  <0.1894.0>,<0.1898.0>,<0.1902.0>,<0.1906.0>,<0.1910.0>,
  <0.1914.0>,<0.1918.0>,<0.1922.0>,<0.1926.0>,<0.1930.0>,
  <0.1934.0>,<0.1938.0>,<0.1942.0>,<0.1946.0>,<0.1950.0>,
  <0.1954.0>,<0.1958.0>,<0.1962.0>,<0.1966.0>,<0.1970.0>,
  <0.1974.0>,<0.1978.0>,<0.1982.0>,<0.1986.0>|...]


Thanks again,

-Matt
-- 
Matt Stancliff                    San Jose, CA
AIM: seijimr              iPhone: 678-591-9337
"The best way to predict the future is to invent it." --Alan Kay




From 0x6e6562 at gmail.com  Wed Dec 10 11:05:54 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 10 Dec 2008 11:05:54 +0000
Subject: [rabbitmq-discuss] erlang-client problem on OS X
	(empty_rpc_bottom_half)
In-Reply-To: <47E93AF3-7336-4AA2-9EA3-870270202117@mindspring.com>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>
	<269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>
	<80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>
	<269388e30812100049t1ee74553w4e68eed6747e2be4@mail.gmail.com>
	<47E93AF3-7336-4AA2-9EA3-870270202117@mindspring.com>
Message-ID: <269388e30812100305t51a03f02l1e2346731bbb9935@mail.gmail.com>

Matt,

On Wed, Dec 10, 2008 at 9:25 AM, Matt Stancliff <sysop at mindspring.com> wrote:
>  Actually, that clears everything up.
>
> My hg clone was cloning tip but checking out default (23 commits behind).
>  It works now with the correct version.  Sorry for the confusion.

Cool, no worries, glad we could clear that up.

In it helps at all, you can read about the branch per bug process here:

http://lettuce.squarespace.com/faq/development-process/how-do-i-get-the-code-for-the-lastest-bleeding-edge-feature.html

> Strangely, the current default for the client (12e791935a5d) works on my
> Linux box.

This version (the default branch) does not handle the channel.flow
command. Are you running both clients (i.e. client on Linux, client on
OSX) against the same broker?

Ben



From 0x6e6562 at gmail.com  Wed Dec 10 11:14:36 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 10 Dec 2008 11:14:36 +0000
Subject: [rabbitmq-discuss] No set_permissions any more?
In-Reply-To: <d1306e840812092006x7345814j1e6ff8db5280bdc0@mail.gmail.com>
References: <d1306e840812092006x7345814j1e6ff8db5280bdc0@mail.gmail.com>
Message-ID: <269388e30812100314q46fc5468lbd82f823f9f9f775@mail.gmail.com>

Yen,

On Wed, Dec 10, 2008 at 4:06 AM, Yin Chen <subdragon at gmail.com> wrote:
>     I compile a rabbitmq from one branches of the latest source code in
> hg.But I found there is no set_permissions command when I want to use
> rabbitmqctl to set the permission of the new created vhost. How to set the
> permission for a vhost now?

This is an old command to set realm permissions, but realms have been
nuked from Rabbit and will disappear in 1.5.0 - please search this
list for realms, there are ample threads that discuss this.

You can only assign vhost based ACLs in the lastest version.

To see what the current options are, look at the usage documentation
of the rabbitmqctl script.

HTH,

Ben



From 0x6e6562 at gmail.com  Wed Dec 10 11:38:02 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 10 Dec 2008 11:38:02 +0000
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <269388e30810270930y584d4ea4k967772af1197951c@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
	<269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
	<6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
	<269388e30810270824y62820129k16d2c3074a64c947@mail.gmail.com>
	<6c2563b20810270833h1888430cj929cc568b4acf364@mail.gmail.com>
	<269388e30810270930y584d4ea4k967772af1197951c@mail.gmail.com>
Message-ID: <269388e30812100338rf3e13fetf2f3be75d5e275d2@mail.gmail.com>

Ed,

On Mon, Oct 27, 2008 at 4:30 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> On Mon, Oct 27, 2008 at 3:33 PM, Edwin Fine
> <rabbitmq-discuss_efine at usa.net> wrote:
>> Music to my ears. I would really, really appreciate something like that.
>
> Ok, I've roadmapped it for consideration in the 1.0 release of the
> Erlang client (when a patch transpires 19630 will refer).

I forgot to mention the other day that the handling for this has been
updated with the latest mainline.

It is known as 19625 and basically handles a forced connection more gracefully.

It still doesn't contain a shutdown handler, which will be in a
seperate branch (19630) when something gets done on this.

Ben



From rabbitmq-discuss_efine at usa.net  Wed Dec 10 12:30:28 2008
From: rabbitmq-discuss_efine at usa.net (Edwin Fine)
Date: Wed, 10 Dec 2008 07:30:28 -0500
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <269388e30812100338rf3e13fetf2f3be75d5e275d2@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
	<269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
	<6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
	<269388e30810270824y62820129k16d2c3074a64c947@mail.gmail.com>
	<6c2563b20810270833h1888430cj929cc568b4acf364@mail.gmail.com>
	<269388e30810270930y584d4ea4k967772af1197951c@mail.gmail.com>
	<269388e30812100338rf3e13fetf2f3be75d5e275d2@mail.gmail.com>
Message-ID: <6c2563b20812100430j7e6d61b0n19e3944c2221e747@mail.gmail.com>

Thanks for the info, Ben.

One more question: Without using transactions, is there a way to
basic.publish using a call (and getting either a positive or negative
response from the server), rather than just doing a "blind" cast? I think we
talked about this but I can't fully  recall the conclusion. IIRC, you said
you would add a call for it?

Regards,
Ed

On Wed, Dec 10, 2008 at 6:38 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Ed,
>
> On Mon, Oct 27, 2008 at 4:30 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> > On Mon, Oct 27, 2008 at 3:33 PM, Edwin Fine
> > <rabbitmq-discuss_efine at usa.net> wrote:
> >> Music to my ears. I would really, really appreciate something like that.
> >
> > Ok, I've roadmapped it for consideration in the 1.0 release of the
> > Erlang client (when a patch transpires 19630 will refer).
>
> I forgot to mention the other day that the handling for this has been
> updated with the latest mainline.
>
> It is known as 19625 and basically handles a forced connection more
> gracefully.
>
> It still doesn't contain a shutdown handler, which will be in a
> seperate branch (19630) when something gets done on this.
>
> Ben
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081210/d46d9fb9/attachment.htm 

From 0x6e6562 at gmail.com  Wed Dec 10 12:42:15 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 10 Dec 2008 12:42:15 +0000
Subject: [rabbitmq-discuss] Erlang client: function_clause error
In-Reply-To: <6c2563b20812100430j7e6d61b0n19e3944c2221e747@mail.gmail.com>
References: <6c2563b20810261055h43e3d626x473bea349ddb40ad@mail.gmail.com>
	<269388e30810270504v7db69f97k5e20c5bf1bea940f@mail.gmail.com>
	<6c2563b20810270706o15a1051fo3ddb7ad0eaee8020@mail.gmail.com>
	<269388e30810270806w6d86de04t6edcce46bb435c9a@mail.gmail.com>
	<6c2563b20810270808r7fbb5409vc1229370a890229c@mail.gmail.com>
	<269388e30810270824y62820129k16d2c3074a64c947@mail.gmail.com>
	<6c2563b20810270833h1888430cj929cc568b4acf364@mail.gmail.com>
	<269388e30810270930y584d4ea4k967772af1197951c@mail.gmail.com>
	<269388e30812100338rf3e13fetf2f3be75d5e275d2@mail.gmail.com>
	<6c2563b20812100430j7e6d61b0n19e3944c2221e747@mail.gmail.com>
Message-ID: <269388e30812100442h4f5df8a2od18d6b6bd1ce7e5b@mail.gmail.com>

Ed,

On Wed, Dec 10, 2008 at 12:30 PM, Edwin Fine
<rabbitmq-discuss_efine at usa.net> wrote:
> One more question: Without using transactions, is there a way to
> basic.publish using a call (and getting either a positive or negative
> response from the server), rather than just doing a "blind" cast? I think we
> talked about this but I can't fully  recall the conclusion. IIRC, you said
> you would add a call for it?

Yep, I've added this in 19560 (which also has some descendents as well
e.g. 19334, 19625, 19373).

HTH,

Ben



From subdragon at gmail.com  Wed Dec 10 14:55:04 2008
From: subdragon at gmail.com (Yin Chen)
Date: Wed, 10 Dec 2008 22:55:04 +0800
Subject: [rabbitmq-discuss] No set_permissions any more?
In-Reply-To: <269388e30812100314q46fc5468lbd82f823f9f9f775@mail.gmail.com>
References: <d1306e840812092006x7345814j1e6ff8db5280bdc0@mail.gmail.com>
	<269388e30812100314q46fc5468lbd82f823f9f9f775@mail.gmail.com>
Message-ID: <d1306e840812100655u4691f4daqf39ce66a472bad24@mail.gmail.com>

thanks very much!
Another problem. When I use the /etc/default/rabbitmq_cluster.config to
start two rabbit broker on two machines as a cluster.
One starts successfully but the other starts with the following error
message:
starting database             ...Erlang has closed
{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{unable_to_join_cluster,['rabbit at e
','rabbit at t'],{merge_schema_failed,"Bad cookie in table definition listener:
rabbit at t= {cstruct,listener,bag,[rabbit at t
],[],[],0,read_write,[],[],false,listener,[node,protocol,host,port],[],[],{{1228,896861,507965},rabbit at t},{{2,0},[]}},
rabbit at e= {cstruct,listener,bag,[rabbit at e
],[],[],0,read_write,[],[],false,listener,[node,protocol,host,port],[],[],{{1228,896444,879148},rabbit at e
},{{2,0},[]}}\n"}},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}
What is the problem?

On Wed, Dec 10, 2008 at 7:14 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Yen,
>
> On Wed, Dec 10, 2008 at 4:06 AM, Yin Chen <subdragon at gmail.com> wrote:
> >     I compile a rabbitmq from one branches of the latest source code in
> > hg.But I found there is no set_permissions command when I want to use
> > rabbitmqctl to set the permission of the new created vhost. How to set
> the
> > permission for a vhost now?
>
> This is an old command to set realm permissions, but realms have been
> nuked from Rabbit and will disappear in 1.5.0 - please search this
> list for realms, there are ample threads that discuss this.
>
> You can only assign vhost based ACLs in the lastest version.
>
> To see what the current options are, look at the usage documentation
> of the rabbitmqctl script.
>
> HTH,
>
> Ben
>



-- 
Yin Chen
http://www.douban.com/people/subdragon/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081210/d75e36f9/attachment.htm 

From 0x6e6562 at gmail.com  Wed Dec 10 15:09:10 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 10 Dec 2008 15:09:10 +0000
Subject: [rabbitmq-discuss] No set_permissions any more?
In-Reply-To: <d1306e840812100655u4691f4daqf39ce66a472bad24@mail.gmail.com>
References: <d1306e840812092006x7345814j1e6ff8db5280bdc0@mail.gmail.com>
	<269388e30812100314q46fc5468lbd82f823f9f9f775@mail.gmail.com>
	<d1306e840812100655u4691f4daqf39ce66a472bad24@mail.gmail.com>
Message-ID: <269388e30812100709h5505e39bg951cf9b1288c58e0@mail.gmail.com>

Yin,

On Wed, Dec 10, 2008 at 2:55 PM, Yin Chen <subdragon at gmail.com> wrote:
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{unable_to_join_cluster,['rabbit at e','rabbit at t'],{merge_schema_failed,"Bad
> cookie in table definition listener: rabbit at t=

This symptom was discussed in this thread:

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-December/002594.html

Ben



From subdragon at gmail.com  Wed Dec 10 15:21:09 2008
From: subdragon at gmail.com (Yin Chen)
Date: Wed, 10 Dec 2008 23:21:09 +0800
Subject: [rabbitmq-discuss] No set_permissions any more?
In-Reply-To: <269388e30812100709h5505e39bg951cf9b1288c58e0@mail.gmail.com>
References: <d1306e840812092006x7345814j1e6ff8db5280bdc0@mail.gmail.com>
	<269388e30812100314q46fc5468lbd82f823f9f9f775@mail.gmail.com>
	<d1306e840812100655u4691f4daqf39ce66a472bad24@mail.gmail.com>
	<269388e30812100709h5505e39bg951cf9b1288c58e0@mail.gmail.com>
Message-ID: <d1306e840812100721m338adeaaj3d18475426e77439@mail.gmail.com>

It works and thanks.
It seemed that google would not crawl the rabbitmq newsgroup.:p

On Wed, Dec 10, 2008 at 11:09 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> Yin,
>
> On Wed, Dec 10, 2008 at 2:55 PM, Yin Chen <subdragon at gmail.com> wrote:
> >
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{unable_to_join_cluster,['rabbit at e
> ','rabbit at t'],{merge_schema_failed,"Bad
> > cookie in table definition listener: rabbit at t=
>
> This symptom was discussed in this thread:
>
>
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-December/002594.html
>
> Ben
>



-- 
Yin Chen
http://www.douban.com/people/subdragon/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081210/b5a81b3c/attachment.htm 

From 0x6e6562 at gmail.com  Wed Dec 10 15:32:20 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 10 Dec 2008 15:32:20 +0000
Subject: [rabbitmq-discuss] No set_permissions any more?
In-Reply-To: <d1306e840812100721m338adeaaj3d18475426e77439@mail.gmail.com>
References: <d1306e840812092006x7345814j1e6ff8db5280bdc0@mail.gmail.com>
	<269388e30812100314q46fc5468lbd82f823f9f9f775@mail.gmail.com>
	<d1306e840812100655u4691f4daqf39ce66a472bad24@mail.gmail.com>
	<269388e30812100709h5505e39bg951cf9b1288c58e0@mail.gmail.com>
	<d1306e840812100721m338adeaaj3d18475426e77439@mail.gmail.com>
Message-ID: <269388e30812100732u78ffeb2dv6b0ada0e0d4bdb2c@mail.gmail.com>

Yin,

On Wed, Dec 10, 2008 at 3:21 PM, Yin Chen <subdragon at gmail.com> wrote:
> It works and thanks.
> It seemed that google would not crawl the rabbitmq newsgroup.:p

Yes, I had the same problem when I tried to search in my gmal account.

The reason was because the error trace was pasted into github and
linked into the post.

Ben



From tonyg at lshift.net  Wed Dec 10 17:58:28 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 10 Dec 2008 17:58:28 +0000
Subject: [rabbitmq-discuss] Polling message from RabbitMQ by servicemix.
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAALnJvd42GzVKrw8GtkNUv88BAAAAAA==@oryo.lt>
References: <20849425.post@talk.nabble.com>	<269388e30812050058k79eeba9fv8c3080786e25993d@mail.gmail.com>	<20850938.post@talk.nabble.com>	<269388e30812050451n6a578623kf643adda61e612ee@mail.gmail.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAALnJvd42GzVKrw8GtkNUv88BAAAAAA==@oryo.lt>
Message-ID: <49400344.9090206@lshift.net>

Andrius Norkaitis wrote:
> "Also, 1.5.0 is very nearly there<..>"
> Is there approximate date for 1.5 release?

We're in the final throes of the preparation and testing. Most of our
most recent few workdays have been spent on nothing but. No promises,
but if we don't get it released soon, I will go insane :-)

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Wed Dec 10 18:03:22 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 10 Dec 2008 18:03:22 +0000
Subject: [rabbitmq-discuss] log file management
In-Reply-To: <b6567e540812091906r379cd02by295885f70fb180c4@mail.gmail.com>
References: <b6567e540812091906r379cd02by295885f70fb180c4@mail.gmail.com>
Message-ID: <4940046A.9010508@lshift.net>

Hi Michael,

Michael Ossareh wrote:
> in our case we have many gb log files (7gb after a few days)  and the
> server spends a long time putting them into cat.

That's an excellent point. We've recently improved the way we do logging
to the point where it's a short step to avoiding doing any log rotation
in the startup scripts at all. The system's log-rotation tools will do
everything.

However, the impending release will likely *not* see these changes --
it's at least one release away.

> Overall, however, surely log rotation is the task of logrotated? I'm
> not sure how well this maps to any erlang best practices though.

Absolutely, the more we can delegate to the normal operating system
services, the better. The next release, 1.5.0, *will* use logrotate in a
standard way. (It will still do the thing in the startup scripts, though.)

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From weaveinator at gmail.com  Wed Dec 10 18:44:18 2008
From: weaveinator at gmail.com (Steve Weaver)
Date: Wed, 10 Dec 2008 10:44:18 -0800
Subject: [rabbitmq-discuss] New installation failing on start
Message-ID: <c05e896e0812101044o2b47866flec0e66e31b28eace@mail.gmail.com>

Hi -
I just created a new installation of RabbitMQ v1.4 on RHE and all seemed to
go well with Erlang install.  Placed RabbitMQ in default dir
(/usr/lib/erlang/lib) and when I go to start it I get:

{"init terminating in
do_boot",{undef,[{rabbit,start,[]},{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

Looks like the /var/logs/rabbitmq and /var/lib/rabbitmq dirs were not
created.  I originally tried to start it as a user but then restarted RH
server and tried to start it as root and still got the exact same error as
above (doh).  Am I missing something?

Any help is greatly appreciated!!
Steve
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081210/69abb450/attachment.htm 

From 0x6e6562 at gmail.com  Wed Dec 10 18:59:18 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 10 Dec 2008 18:59:18 +0000
Subject: [rabbitmq-discuss] New installation failing on start
In-Reply-To: <c05e896e0812101044o2b47866flec0e66e31b28eace@mail.gmail.com>
References: <c05e896e0812101044o2b47866flec0e66e31b28eace@mail.gmail.com>
Message-ID: <269388e30812101059s59c2e1fbi912633a40a23a11e@mail.gmail.com>

Steve,

On Wed, Dec 10, 2008 at 6:44 PM, Steve Weaver <weaveinator at gmail.com> wrote:
> Hi -
> I just created a new installation of RabbitMQ v1.4 on RHE and all seemed to
> go well with Erlang install.  Placed RabbitMQ in default dir
> (/usr/lib/erlang/lib) and when I go to start it I get:

Did you use a RPM?

> {"init terminating in
> do_boot",{undef,[{rabbit,start,[]},{init,start_it,1},{init,start_em,1}]}}

This indicates that the binaries for Rabbit are not on the load path
of this Erlang process. See question above.

Ben



From alexis.richardson at cohesiveft.com  Wed Dec 10 19:57:13 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Wed, 10 Dec 2008 19:57:13 +0000
Subject: [rabbitmq-discuss] RabbitMQ plus Spring
In-Reply-To: <9e009ad0812090844s45aac799g69f56e8fdebcd1d9@mail.gmail.com>
References: <167204d20812080244u5dc039a1oe139a5b26c41cbb6@mail.gmail.com>
	<C56298C9.1E6A%mdarling@veodia.com>
	<9e009ad0812090844s45aac799g69f56e8fdebcd1d9@mail.gmail.com>
Message-ID: <167204d20812101157q580746f3s1540b751cd578e95@mail.gmail.com>

OK....

So it looks like:

1. People want this.
2. Nobody quite has the time

What is the MINIMAL coding that we can do in order to get people
enough code to get their teeth into?  So, for example, to get Mark
Pollack enough for Spring Extensions?

alexis



On Tue, Dec 9, 2008 at 4:44 PM, Joern <opendev at gmail.com> wrote:
> Hi Matt, hi Alexis,
>
> 2008/12/8 Matt Darling <mdarling at veodia.com>:
>
>> A few months back, I started to take a good look at this and wanted to take
>> the RabbitMQ Java client and extend it to work under some form of the JMS
>> implementation via spring.  Additionally, I was using Joern's implementation
>> as a starting point.
>>
>> It shouldn't be that difficult, just a little bit of time - which is one
>> thing I don't have much of these days.  Has anyone else done anything that
>> might be usable/extendable?
>
> Sorry but I did not spent time to improve the present code. The MQ
> integration in the current project was stalled byond belief and my
> current time schedule is too tight to improve the situation.
>
> The lack of practical experience with AMQP has prevented me from
> writing any reasonable sane extension or better abstractions. Maybe in
> 2009 ... :-)
>
> Best regards,
>
>
> Joern
> --
>



From jonatan at heysan.com  Wed Dec 10 23:42:09 2008
From: jonatan at heysan.com (Jonatan Kallus)
Date: Wed, 10 Dec 2008 15:42:09 -0800
Subject: [rabbitmq-discuss] Java API methods don't return nor throw
	exceptions
Message-ID: <4cc167ca0812101542t2ddbb18fj864c9faf9d87c1a8@mail.gmail.com>

I am trying to write a java application that can handle the rabbitmq server
going down and coming back up (or losing the connection to the server and
getting it back).

When my application is running and I stop the rabbitmq server, the
ShutdownListener gets called (and some of the disconnection methods may
throw some exceptions). So far all good.

When the server comes back up the application connects to the server: (It
keeps trying to connect while the server is down until it successes.)

ConnectionFactory factory = new ConnectionFactory(params);
connection = factory.newConnection(host, AMQP.PROTOCOL.PORT);
channel = connection.createChannel();
channel.accessRequest(this.realm);

Code above gets run through without any exceptions. But, when reconnecting,
the execution stops at this line, the method seems to never return:

connection.addShutdownListener(shutdownListener);

At first time connection the same code is executed without any problems.

In some cases, when the connection is terminated from within my application,
execution also stops at these lines:

channel.basicCancel(consumerTag);
channel.basicCancel(commandConsumerTag);

I have once seen addShutdownListener throw a
ConcurrentModificationException, but the rabbitmq connection is not running
in a multithreaded environment.

Is it possible to set a general timeout for all API method? Am I missing
anything else wrt this problem? I understand that it may be impossible to
find the cause of this with this little information unless anyone has seen
anything similar. I am ready to supply more information that can help find
the cause of this.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081210/8e55990d/attachment.htm 

From sysop at mindspring.com  Thu Dec 11 08:29:32 2008
From: sysop at mindspring.com (Matt Stancliff)
Date: Thu, 11 Dec 2008 00:29:32 -0800
Subject: [rabbitmq-discuss] erlang-client problem on OS X
	(empty_rpc_bottom_half)
In-Reply-To: <269388e30812100305t51a03f02l1e2346731bbb9935@mail.gmail.com>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>
	<269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>
	<80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>
	<269388e30812100049t1ee74553w4e68eed6747e2be4@mail.gmail.com>
	<47E93AF3-7336-4AA2-9EA3-870270202117@mindspring.com>
	<269388e30812100305t51a03f02l1e2346731bbb9935@mail.gmail.com>
Message-ID: <B3E4AFEE-95F7-4768-B152-5EACEA92C014@mindspring.com>

Ben,

On Dec 10, 2008, at 3:05 AM, Ben Hood wrote:
> This version (the default branch) does not handle the channel.flow
> command. Are you running both clients (i.e. client on Linux, client on
> OSX) against the same broker?

   I just spent a while testing brokers to make sure I'm not going  
crazy.

   With the same revision (ba92db335a3e) running on two systems I'm  
seeing different behavior during start_channel.

With broker ba92db335a3e and erlang client a055acaa2a13 I see the  
following:
   - Linux: channel.open_ok -> done.
   - OS X:  channel.open_ok -> {channel.flow, false} -> done.

Everything works, but the inconsistent behavior is curious.


-Matt
-- 
Matt Stancliff                    San Jose, CA
AIM: seijimr              iPhone: 678-591-9337
"The best way to predict the future is to invent it." --Alan Kay




From 0x6e6562 at gmail.com  Thu Dec 11 08:35:21 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 11 Dec 2008 08:35:21 +0000
Subject: [rabbitmq-discuss] erlang-client problem on OS X
	(empty_rpc_bottom_half)
In-Reply-To: <B3E4AFEE-95F7-4768-B152-5EACEA92C014@mindspring.com>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>
	<269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>
	<80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>
	<269388e30812100049t1ee74553w4e68eed6747e2be4@mail.gmail.com>
	<47E93AF3-7336-4AA2-9EA3-870270202117@mindspring.com>
	<269388e30812100305t51a03f02l1e2346731bbb9935@mail.gmail.com>
	<B3E4AFEE-95F7-4768-B152-5EACEA92C014@mindspring.com>
Message-ID: <269388e30812110035g3f9895acp92ca751fad00e5d3@mail.gmail.com>

Matt,

On Thu, Dec 11, 2008 at 8:29 AM, Matt Stancliff <sysop at mindspring.com> wrote:
>  With the same revision (ba92db335a3e) running on two systems I'm seeing
> different behavior during start_channel.
>
> With broker ba92db335a3e and erlang client a055acaa2a13 I see the following:
>  - Linux: channel.open_ok -> done.
>  - OS X:  channel.open_ok -> {channel.flow, false} -> done.

Are you running the clients against the same broker instance, or are
you running a broker instance on each OS?

Ben



From sysop at mindspring.com  Thu Dec 11 08:41:46 2008
From: sysop at mindspring.com (Matt Stancliff)
Date: Thu, 11 Dec 2008 00:41:46 -0800
Subject: [rabbitmq-discuss] erlang-client problem on OS X
	(empty_rpc_bottom_half)
In-Reply-To: <269388e30812110035g3f9895acp92ca751fad00e5d3@mail.gmail.com>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>
	<269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>
	<80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>
	<269388e30812100049t1ee74553w4e68eed6747e2be4@mail.gmail.com>
	<47E93AF3-7336-4AA2-9EA3-870270202117@mindspring.com>
	<269388e30812100305t51a03f02l1e2346731bbb9935@mail.gmail.com>
	<B3E4AFEE-95F7-4768-B152-5EACEA92C014@mindspring.com>
	<269388e30812110035g3f9895acp92ca751fad00e5d3@mail.gmail.com>
Message-ID: <2C74A96A-755E-401F-9086-BCF4AB64194B@mindspring.com>

Ben,

On Dec 11, 2008, at 12:35 AM, Ben Hood wrote:
>> With the same revision (ba92db335a3e) running on two systems I'm  
>> seeing
>> different behavior during start_channel.
>>
>> With broker ba92db335a3e and erlang client a055acaa2a13 I see the  
>> following:
>> - Linux: channel.open_ok -> done.
>> - OS X:  channel.open_ok -> {channel.flow, false} -> done.
>
> Are you running the clients against the same broker instance, or are
> you running a broker instance on each OS?

   A {broker,client} pair runs on one machine and the nodes are not  
aware of one another.
   Everything is running in R12B-5.

On each server I've been doing:
   - NODE_ONLY rabbitmq-server to start an erlang shell (with -pz to  
the erlang client ebin)
   - load the dbg tracing specs
   - rabbit:start()
   - lib_amqp:start_channel(lib_amqp:start_connection())
     - the same results happen with a network connection


-Matt
-- 
Matt Stancliff                    San Jose, CA
AIM: seijimr              iPhone: 678-591-9337
"The best way to predict the future is to invent it." --Alan Kay




From opendev at gmail.com  Thu Dec 11 10:08:05 2008
From: opendev at gmail.com (Joern)
Date: Thu, 11 Dec 2008 11:08:05 +0100
Subject: [rabbitmq-discuss] RabbitMQ plus Spring
In-Reply-To: <167204d20812101157q580746f3s1540b751cd578e95@mail.gmail.com>
References: <167204d20812080244u5dc039a1oe139a5b26c41cbb6@mail.gmail.com>
	<C56298C9.1E6A%mdarling@veodia.com>
	<9e009ad0812090844s45aac799g69f56e8fdebcd1d9@mail.gmail.com>
	<167204d20812101157q580746f3s1540b751cd578e95@mail.gmail.com>
Message-ID: <9e009ad0812110208k27e17d10o5b3b3ced33905290@mail.gmail.com>

Hi Alexis,

2008/12/10 Alexis Richardson <alexis.richardson at cohesiveft.com>:

> What is the MINIMAL coding that we can do in order to get people
> enough code to get their teeth into?  So, for example, to get Mark
> Pollack enough for Spring Extensions?

I think a template hierarchy for the common use cases (which I do not
know in all the details - maybe things like assert a certain
exchange/queue combination AND subscribe to that AND publish to that
via an interface) is a must have. The basic connection abstraction is
quite easy, especially when using Tiger features.

Best regards,


Joern
--



From alexis.richardson at cohesiveft.com  Thu Dec 11 10:56:00 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 11 Dec 2008 10:56:00 +0000
Subject: [rabbitmq-discuss] RabbitMQ plus Spring
In-Reply-To: <9e009ad0812110208k27e17d10o5b3b3ced33905290@mail.gmail.com>
References: <167204d20812080244u5dc039a1oe139a5b26c41cbb6@mail.gmail.com>
	<C56298C9.1E6A%mdarling@veodia.com>
	<9e009ad0812090844s45aac799g69f56e8fdebcd1d9@mail.gmail.com>
	<167204d20812101157q580746f3s1540b751cd578e95@mail.gmail.com>
	<9e009ad0812110208k27e17d10o5b3b3ced33905290@mail.gmail.com>
Message-ID: <167204d20812110256me322403v309313ae2b164eb2@mail.gmail.com>

Joern,

On Thu, Dec 11, 2008 at 10:08 AM, Joern <opendev at gmail.com> wrote:
> Hi Alexis,
>
> 2008/12/10 Alexis Richardson <alexis.richardson at cohesiveft.com>:
>
>> What is the MINIMAL coding that we can do in order to get people
>> enough code to get their teeth into?  So, for example, to get Mark
>> Pollack enough for Spring Extensions?
>
> I think a template hierarchy for the common use cases

I see.  When you say common use cases - how should we define these:

* to mean 'as expected by the Spring user'?
* how about 'following Spring JMS templates'?
* or - as naturally suggested by AMQP?

Perhaps there is little difference between the above, though I would
imagine following JMS patterns would be sensible.

A list of patterns and use cases is provided in the third section of
this guide: http://www.rabbitmq.com/releases/rabbitmq-dotnet-client/v1.4.0/rabbitmq-dotnet-client-1.4.0-user-guide.pdf

Ignore the .NET aspects since these all transfer to Java too.


> (which I do not
> know in all the details - maybe things like assert a certain
> exchange/queue combination AND subscribe to that AND publish to that
> via an interface) is a must have.

Great - could you create that as a guide for others?




> The basic connection abstraction is
> quite easy, especially when using Tiger features.

Cool.

alexis



> Best regards,
>
>
> Joern
> --
>



From holger at wizards.de  Thu Dec 11 18:06:20 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Thu, 11 Dec 2008 19:06:20 +0100
Subject: [rabbitmq-discuss] Java API methods don't return nor
	throw	exceptions
In-Reply-To: <4cc167ca0812101542t2ddbb18fj864c9faf9d87c1a8@mail.gmail.com>
References: <4cc167ca0812101542t2ddbb18fj864c9faf9d87c1a8@mail.gmail.com>
Message-ID: <4941569C.2080700@wizards.de>

Jonatan Kallus wrote:
> I am trying to write a java application that can handle the rabbitmq
> server going down and coming back up (or losing the connection to the
> server and getting it back).
[..]
> ConnectionFactory factory = new ConnectionFactory(params);
> connection = factory.newConnection(host, AMQP.PROTOCOL.PORT);
> channel = connection.createChannel();
> channel.accessRequest(this.realm);
> 
> Code above gets run through without any exceptions. But, when
> reconnecting, the execution stops at this line, the method seems to
> never return:
> 
> connection.addShutdownListener(shutdownListener);

Try to dump a stack trace so we can see who's calling what.
Easiest to do with jconsole or visualvm, or with the magic key combo that
I cannot remember right now..

> I have once seen addShutdownListener throw a
> ConcurrentModificationException, but the rabbitmq connection is not
> running in a multithreaded environment.

CME has nothing to do with threading and can also occur e.g. in recursive
code that improperly modifies the iterated collection.

-h



From sysop at mindspring.com  Fri Dec 12 05:26:22 2008
From: sysop at mindspring.com (Matt Stancliff)
Date: Thu, 11 Dec 2008 21:26:22 -0800
Subject: [rabbitmq-discuss] erlang-client problem on OS X
	(empty_rpc_bottom_half)
In-Reply-To: <269388e30812110035g3f9895acp92ca751fad00e5d3@mail.gmail.com>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>
	<269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>
	<80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>
	<269388e30812100049t1ee74553w4e68eed6747e2be4@mail.gmail.com>
	<47E93AF3-7336-4AA2-9EA3-870270202117@mindspring.com>
	<269388e30812100305t51a03f02l1e2346731bbb9935@mail.gmail.com>
	<B3E4AFEE-95F7-4768-B152-5EACEA92C014@mindspring.com>
	<269388e30812110035g3f9895acp92ca751fad00e5d3@mail.gmail.com>
Message-ID: <FE9EBC7A-4EFB-41A5-957D-066BE471567E@mindspring.com>

Ben,

On Dec 11, 2008, at 12:35 AM, Ben Hood wrote:
> On Thu, Dec 11, 2008 at 8:29 AM, Matt Stancliff  
> <sysop at mindspring.com> wrote:
>> With broker ba92db335a3e and erlang client a055acaa2a13 I see the  
>> following:
>> - Linux: channel.open_ok -> done.
>> - OS X:  channel.open_ok -> {channel.flow, false} -> done.


   Your extremely useful write-up about flow control [1] found its way  
to me today.  I didn't realize {channel.flow, false} was being  
triggered by me having less than 5% memory free.  I ended up writing a  
rabbit_memsup_darwin.erl to take into account cache and buffers, but  
it looks like memsup reports correctly enough.

Lesson learned.  When developing with unpredictable memory usage*,  
manually increase the memory threshold:  
memsup:set_sysmem_high_watermark(0.99).

[1]: http://hopper.squarespace.com/blog/2008/11/9/flow-control-in-rabbitmq.html
* I'm staring at you, Firefox, Camino, and Safari.


Thanks again,

-Matt
-- 
Matt Stancliff                    San Jose, CA
AIM: seijimr              iPhone: 678-591-9337
"The best way to predict the future is to invent it." --Alan Kay




From alexis.richardson at cohesiveft.com  Fri Dec 12 08:36:24 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Fri, 12 Dec 2008 08:36:24 +0000
Subject: [rabbitmq-discuss] intro video - francesco on erlang
Message-ID: <167204d20812120036u44106e4dxaedc1cebc4234aae@mail.gmail.com>

Hi,

FYI.....

Another intro video on erlang surfaced on the webs recently:
http://fora.tv/2008/11/19/Erlang_Concurrency_Whats_the_Fuss

This is by Francesco Cesarini from ET&C.  He also instigated summer
2008's successful Erlang Exchange in London.

Cheers,

alexis



From matthias at lshift.net  Fri Dec 12 08:49:30 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 12 Dec 2008 08:49:30 +0000
Subject: [rabbitmq-discuss] erlang-client problem on OS
	X	(empty_rpc_bottom_half)
In-Reply-To: <FE9EBC7A-4EFB-41A5-957D-066BE471567E@mindspring.com>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>	<269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>	<80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>	<269388e30812100049t1ee74553w4e68eed6747e2be4@mail.gmail.com>	<47E93AF3-7336-4AA2-9EA3-870270202117@mindspring.com>	<269388e30812100305t51a03f02l1e2346731bbb9935@mail.gmail.com>	<B3E4AFEE-95F7-4768-B152-5EACEA92C014@mindspring.com>	<269388e30812110035g3f9895acp92ca751fad00e5d3@mail.gmail.com>
	<FE9EBC7A-4EFB-41A5-957D-066BE471567E@mindspring.com>
Message-ID: <4942259A.3090502@lshift.net>

Matt,

Matt Stancliff wrote:
> I ended up writing a  
> rabbit_memsup_darwin.erl to take into account cache and buffers,   

We contemplated doing exactly that two days ago. How did you go about 
it? AFAIK there is no /proc/meminfo on OS X :(

> but it looks like memsup reports correctly enough.

Are you saying that Erlang's standard memsup takes into account cache 
and buffers already on OS X? That would be a pleasant surprise.

> Lesson learned.  When developing with unpredictable memory usage*,  
> manually increase the memory threshold:  
> memsup:set_sysmem_high_watermark(0.99).

In the upcoming 1.5.0 release there will also be a flag to disable 
memsup completely.


Matthias.



From Alister.Morton at tradition.com  Fri Dec 12 13:19:09 2008
From: Alister.Morton at tradition.com (Alister Morton)
Date: Fri, 12 Dec 2008 13:19:09 +0000
Subject: [rabbitmq-discuss] Exceptions in c# client library
Message-ID: <5A46D132C446C04B9EFE8AD14E7891065C489059F9@SVR-2K3-BH-EMC.tradition.int>

I've got a client retrieving messages quite happily as an Excel add in. I've attached event handlers to the CallBackException event handlers on both the IModel and IConnection objects, but I'm seeing uncaught exceptions in the rabbit client dll e.g.

A first chance exception of type 'RabbitMQ.Client.Exceptions.AlreadyClosedException' occurred in RabbitMQ.Client.dll

Obviously I'd like to catch these exceptions and take recovery action, but they're not being passed to me, I'm simply seeing them reported in the debugger. How can I trap these conditions and take recovery action?


alister

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consist of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicate prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From hubert at lshift.net  Fri Dec 12 17:19:38 2008
From: hubert at lshift.net (Hubert Plociniczak)
Date: Fri, 12 Dec 2008 17:19:38 +0000
Subject: [rabbitmq-discuss] Exceptions in c# client library
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891065C489059F9@SVR-2K3-BH-EMC.tradition.int>
References: <5A46D132C446C04B9EFE8AD14E7891065C489059F9@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <49429D2A.3070305@lshift.net>

Hi Alister,

it is very probable that this is a bug related to something that was 
reported before,
see 
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-August/001545.html 
for details.
You can try to build the client from the latest repository state which 
contains the fix for the above problem (see 
http://www.rabbitmq.com/build-dotnet-client.html) for instructions on 
how to build the c# client.
There is also a coming 1.5.0 release (we do our best to make it as soon 
as possible) which will also involve the RabbitMQ C# client.

Let me know if that helps,
Hubert Plociniczak


Alister Morton wrote:
> I've got a client retrieving messages quite happily as an Excel add in. I've attached event handlers to the CallBackException event handlers on both the IModel and IConnection objects, but I'm seeing uncaught exceptions in the rabbit client dll e.g.
>
> A first chance exception of type 'RabbitMQ.Client.Exceptions.AlreadyClosedException' occurred in RabbitMQ.Client.dll
>
> Obviously I'd like to catch these exceptions and take recovery action, but they're not being passed to me, I'm simply seeing them reported in the debugger. How can I trap these conditions and take recovery action?
>
>
> alister
>
> The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consist of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicate prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   


-- 
 [][][] Hubert Plociniczak
   [][] LShift Ltd
 []  [] www.lshift.net





From jon at arithum.com  Fri Dec 12 21:06:20 2008
From: jon at arithum.com (Jonathan McGee)
Date: Fri, 12 Dec 2008 16:06:20 -0500
Subject: [rabbitmq-discuss] Java client: channel synchronization deadlock?
Message-ID: <31D51DC1-69B6-47E6-A1D0-68996132A3E2@arithum.com>


Hi,

This is my first post to the list.  Thanks for creating this  
incredible software!

I've been following the Java API guide here http://www.rabbitmq.com/ 
api-guide.html

In the guide it recommends "If more than one thread needs to access a  
particular Channel instance, the application should enforce mutual  
exclusion itself, for example by synchronising on the Channel."

I did exactly this, however the following code causes a deadlock:

synchronized(channel) {
	channel.queueDeclare("foo");
}

It appears this is because the RabbitMQ client does its own locking  
on "this" internally.

I'm wondering if the RabbitMQ client was updated to become thread- 
safe, and the guide is simply out of date?  When I remove the  
synchronization, things work fine.  Is the API actually 100% thread- 
safe now, or would you still recommend synchronizing on a separate  
object other than the Channel itself?

(As a side note, the guide also indicates that you must obtain a  
ticket to access a Channel, but this doesn't seem to be required  
anymore.)

Cheers,
Jon




From jonatan at heysan.com  Sat Dec 13 00:01:27 2008
From: jonatan at heysan.com (Jonatan Kallus)
Date: Fri, 12 Dec 2008 16:01:27 -0800
Subject: [rabbitmq-discuss] Java API methods don't return nor throw
	exceptions
In-Reply-To: <4cc167ca0812121500j91e5cc9r3b0eeef8b02a3674@mail.gmail.com>
References: <4cc167ca0812101542t2ddbb18fj864c9faf9d87c1a8@mail.gmail.com>
	<4941569C.2080700@wizards.de>
	<4cc167ca0812121500j91e5cc9r3b0eeef8b02a3674@mail.gmail.com>
Message-ID: <4cc167ca0812121601g6385251cq92a3bde120c50fc1@mail.gmail.com>

Thank you!, the key combo is ctrl+\ and this is what I get. I do not really
understand this, so I am very thankful for anything that makes me understand
it a little further. I few other threads are running in the application, but
they have no interaction with rabbitmq so I wont paste them here, unless
they are needed.

This is when execution stops at basicCancel:

"Thread-1" prio=10 tid=0x00002aaad8001c00 nid=0x7e62 in Object.wait()
[0x0000000041017000..0x0000000041017a90]
   java.lang.Thread.State: WAITING (on object monitor)
    at java.lang.Object.wait(Native Method)
    - waiting on <0x00002aaac931de50> (a
com.rabbitmq.utility.BlockingValueOrException)
    at java.lang.Object.wait(Object.java:485)
    at com.rabbitmq.utility.BlockingCell.get(BlockingCell.java:58)
    - locked <0x00002aaac931de50> (a
com.rabbitmq.utility.BlockingValueOrException)
    at
com.rabbitmq.utility.BlockingCell.uninterruptibleGet(BlockingCell.java:95)
    - locked <0x00002aaac931de50> (a
com.rabbitmq.utility.BlockingValueOrException)
    at
com.rabbitmq.utility.BlockingValueOrException.uninterruptibleGetValue(BlockingValueOrException.java:41)
    at
com.rabbitmq.client.impl.AMQChannel$BlockingRpcContinuation.getReply(AMQChannel.java:274)
    at com.rabbitmq.client.impl.ChannelN.basicCancel(ChannelN.java:697)
    at com.heysan.analyticsproxy_mq.Consumer.disconnect(Consumer.java:81)
    at com.heysan.analyticsproxy_mq.Controller.exit(Controller.java:109)
    at com.heysan.analyticsproxy_mq.Controller.update(Controller.java:57)
    at java.util.Observable.notifyObservers(Observable.java:142)
    at java.util.Observable.notifyObservers(Observable.java:98)
    at com.heysan.analyticsproxy_mq.Consumer.setExitFlag(Consumer.java:101)
    at com.heysan.analyticsproxy_mq.Consumer.access$200(Consumer.java:18)
    at
com.heysan.analyticsproxy_mq.Consumer$2.handleDelivery(Consumer.java:137)
    at com.rabbitmq.client.impl.ChannelN.processAsync(ChannelN.java:188)
    at
com.rabbitmq.client.impl.AMQChannel.handleCompleteInboundCommand(AMQChannel.java:143)
    at com.rabbitmq.client.impl.AMQChannel.handleFrame(AMQChannel.java:94)
    at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:445)

This is when execution stops at addShutdownListener:

"Thread-4" prio=10 tid=0x000000005cbdf000 nid=0x7f36 runnable
[0x0000000040f16000..0x0000000040f16d10]
   java.lang.Thread.State: RUNNABLE
    at java.net.SocketInputStream.socketRead0(Native Method)
    at java.net.SocketInputStream.read(SocketInputStream.java:129)
    at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)
    at java.io.BufferedInputStream.read(BufferedInputStream.java:237)
    - locked <0x00002aaac93076a8> (a java.io.BufferedInputStream)
    at java.io.DataInputStream.readUnsignedByte(DataInputStream.java:271)
    at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:111)
    at
com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:143)
    - locked <0x00002aaac9307670> (a java.io.DataInputStream)
    at
com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:284)
    at
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:427)


On Thu, Dec 11, 2008 at 10:06 AM, Holger Hoffst?tte <holger at wizards.de>wrote:

> Jonatan Kallus wrote:
> > I am trying to write a java application that can handle the rabbitmq
> > server going down and coming back up (or losing the connection to the
> > server and getting it back).
> [..]
> > ConnectionFactory factory = new ConnectionFactory(params);
> > connection = factory.newConnection(host, AMQP.PROTOCOL.PORT);
> > channel = connection.createChannel();
> > channel.accessRequest(this.realm);
> >
> > Code above gets run through without any exceptions. But, when
> > reconnecting, the execution stops at this line, the method seems to
> > never return:
> >
> > connection.addShutdownListener(shutdownListener);
>
> Try to dump a stack trace so we can see who's calling what.
> Easiest to do with jconsole or visualvm, or with the magic key combo that
> I cannot remember right now..
>
> > I have once seen addShutdownListener throw a
> > ConcurrentModificationException, but the rabbitmq connection is not
> > running in a multithreaded environment.
>
> CME has nothing to do with threading and can also occur e.g. in recursive
> code that improperly modifies the iterated collection.
>
> -h
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081212/445f48b9/attachment.htm 

From matthias at lshift.net  Sat Dec 13 03:28:25 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sat, 13 Dec 2008 03:28:25 +0000
Subject: [rabbitmq-discuss] Java API methods don't return nor throw
	exceptions
In-Reply-To: <4cc167ca0812121601g6385251cq92a3bde120c50fc1@mail.gmail.com>
References: <4cc167ca0812101542t2ddbb18fj864c9faf9d87c1a8@mail.gmail.com>	<4941569C.2080700@wizards.de>	<4cc167ca0812121500j91e5cc9r3b0eeef8b02a3674@mail.gmail.com>
	<4cc167ca0812121601g6385251cq92a3bde120c50fc1@mail.gmail.com>
Message-ID: <49432BD9.5090105@lshift.net>

Jonatan,

Jonatan Kallus wrote:
> Thank you!, the key combo is ctrl+\ and this is what I get. I do not 
> really understand this, so I am very thankful for anything that makes me 
> understand it a little further. I few other threads are running in the 
> application, but they have no interaction with rabbitmq so I wont paste 
> them here, unless they are needed.
> 
> This is when execution stops at basicCancel:

The code is calling basicCancel from inside a handleDelivery method. The 
latter is called in the context of the Connection's receive loop thread. 
Since basicCancel is synchronous the code thus ends up blocking the 
receive loop.

Only asynchronous methods are safe to call inside handleDelivery. To 
call a synchronous method you'd have to signal another thread and make 
the call from there (and taking care to not use the channel from more 
than one thread simultaneously).


Matthias.



From sysop at mindspring.com  Sat Dec 13 03:39:46 2008
From: sysop at mindspring.com (Matt Stancliff)
Date: Fri, 12 Dec 2008 19:39:46 -0800
Subject: [rabbitmq-discuss] erlang-client problem on OS
	X	(empty_rpc_bottom_half)
In-Reply-To: <4942259A.3090502@lshift.net>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>	<269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>	<80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>	<269388e30812100049t1ee74553w4e68eed6747e2be4@mail.gmail.com>	<47E93AF3-7336-4AA2-9EA3-870270202117@mindspring.com>	<269388e30812100305t51a03f02l1e2346731bbb9935@mail.gmail.com>	<B3E4AFEE-95F7-4768-B152-5EACEA92C014@mindspring.com>	<269388e30812110035g3f9895acp92ca751fad00e5d3@mail.gmail.com>
	<FE9EBC7A-4EFB-41A5-957D-066BE471567E@mindspring.com>
	<4942259A.3090502@lshift.net>
Message-ID: <2B02D4FC-4EB8-4F5D-870D-ADC80FD15B0A@mindspring.com>

Matthias,


>> I ended up writing a  rabbit_memsup_darwin.erl to take into account  
>> cache and buffers,
> We contemplated doing exactly that two days ago. How did you go  
> about it? AFAIK there is no /proc/meminfo on OS X :(

   My attempt (attached) involved:
     - scrape vm_stat output
     - use total = free + active + inactive + wired
     - use total free = free + inactive
     - run broker with rabbit_memsup_darwin
     - launch MulticastMain (on Linux) against the broker (on OS X).
     - watching the OS X machine reach 8M free (reported) memory and  
start swapping madly.

   After testing and further investigation, it turns out FreeBSD and  
Darwin use a unified buffer cache not kind enough to expose usage  
statistics[1].

>> but it looks like memsup reports correctly enough.
> Are you saying that Erlang's standard memsup takes into account  
> cache and buffers already on OS X? That would be a pleasant surprise.

   Nothing currently includes buffer/page cache statistics.  They are  
opaque, hidden, out of reach, verboten.  The value of free memory is  
the best we have.

>> Lesson learned.  When developing with unpredictable memory usage*,   
>> manually increase the memory threshold:   
>> memsup:set_sysmem_high_watermark(0.99).
> In the upcoming 1.5.0 release there will also be a flag to disable  
> memsup completely.

   Good idea.

[1]: http://www.wagerlabs.com/blog/2008/03/hacking-the-uni.html and http://black-chair.livejournal.com/11395.html


-Matt
-- 
Matt Stancliff                    San Jose, CA
AIM: seijimr              iPhone: 678-591-9337
"The best way to predict the future is to invent it." --Alan Kay
-------------- next part --------------
A non-text attachment was scrubbed...
Name: osx_memsup_attempt.patch.gz
Type: application/x-gzip
Size: 2319 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081212/d705562f/attachment.bin 

From digz6666 at gmail.com  Sun Dec 14 06:32:43 2008
From: digz6666 at gmail.com (aznmedia)
Date: Sat, 13 Dec 2008 22:32:43 -0800 (PST)
Subject: [rabbitmq-discuss] Polling message from RabbitMQ by servicemix.
In-Reply-To: <49400344.9090206@lshift.net>
References: <20849425.post@talk.nabble.com>
	<269388e30812050058k79eeba9fv8c3080786e25993d@mail.gmail.com>
	<20850938.post@talk.nabble.com>
	<269388e30812050451n6a578623kf643adda61e612ee@mail.gmail.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAALnJvd42GzVKrw8GtkNUv88BAAAAAA==@oryo.lt>
	<49400344.9090206@lshift.net>
Message-ID: <20997760.post@talk.nabble.com>




Tony Garnock-Jones-2 wrote:
> 
> Andrius Norkaitis wrote:
>> "Also, 1.5.0 is very nearly there<..>"
>> Is there approximate date for 1.5 release?
> 
> We're in the final throes of the preparation and testing. Most of our
> most recent few workdays have been spent on nothing but. No promises,
> but if we don't get it released soon, I will go insane :-)
> 
> Tony
> -- 
>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>    [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

I'm writing my xbean.xml file like following:
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:jee="http://www.springframework.org/schema/jee"
      xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://servicemix.apache.org/jms/1.0
http://servicemix.apache.org/schema/servicemix-jms-3.2.2.xsd
      http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

       <jms:consumer service="my:ConsumerService"
               endpoint="mq"
               destinationName="rabbit-queue"
               connectionFactory="#connectionFactory"
               concurrentConsumers="8" />


       <bean id="connectionFactory"
class="com.rabbitmq.client.ConnectionFactory">
               <constructor-arg>
                       <bean id="params"
class="com.rabbitmq.client.ConnectionParameters" >
                               <property name="_userName">guest</property>
                               <property name="_password">guest</property>
                               <property name="_virtualHost">/</property>
                       </bean>
               </constructor-arg>
               <property name="hostName" value="localhost" />
               <property name="portNumber">
                       <util:constant static-field="AMQP.PROTOCOL.PORT" />
       </property>
       </bean>
</beans>

And I don't understand highlighted statement.

What is my:ConsumerService?
What should I write there?

Is there any xsd or dtd files for rabbitmq like ibm websphere mq?
-- 
View this message in context: http://www.nabble.com/Polling-message-from-RabbitMQ-by-servicemix.-tp20849425p20997760.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From holger at wizards.de  Sun Dec 14 09:37:28 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Sun, 14 Dec 2008 10:37:28 +0100
Subject: [rabbitmq-discuss] Polling message from RabbitMQ by servicemix.
In-Reply-To: <20997760.post@talk.nabble.com>
References: <20849425.post@talk.nabble.com>	<269388e30812050058k79eeba9fv8c3080786e25993d@mail.gmail.com>	<20850938.post@talk.nabble.com>	<269388e30812050451n6a578623kf643adda61e612ee@mail.gmail.com>	<!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAALnJvd42GzVKrw8GtkNUv88BAAAAAA==@oryo.lt>	<49400344.9090206@lshift.net>
	<20997760.post@talk.nabble.com>
Message-ID: <4944D3D8.6080602@wizards.de>

aznmedia wrote:
> 
> I'm writing my xbean.xml file like following:
> <?xml version="1.0" encoding="UTF-8"?>
> <beans xmlns:jee="http://www.springframework.org/schema/jee"
>       xmlns="http://www.springframework.org/schema/beans"
>       xmlns:xsi="http://http://www.w3.org/2001/XMLSchema-instance"
>       xsi:schemaLocation="http://servicemix.apache.org/jms/1.0
> http://servicemix.apache.org/schema/servicemix-jms-3.2.2.xsd
>       http://www.springframework.org/schema/beans
> http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
> 
>        <jms:consumer service="my:ConsumerService"
>                endpoint="mq"
>                destinationName="rabbit-queue"
>                connectionFactory="#connectionFactory"
>                concurrentConsumers="8" />
> 
> 
>        <bean id="connectionFactory"
> class="com.rabbitmq.client.ConnectionFactory">
[..]

I think there is some general confusion going on here. The ServiceMix
consumer bean expects a *JMS* ConnectionFactory, but that will not work
with the RabbitMQ connection factory, since it plays the same role
(connection management) but does *not* implement the necessary JMS
functionality. You will either have to wait until AMQP (or in this case
the RabbitMQ library) implements JMS, or write your own AMQP/Rabbit
transport for ServiceMix. Alternatively you might try a Qpid client
library which is reported to work against a Rabbit broker (though I cannot
say how well).

-h



From digz6666 at gmail.com  Sun Dec 14 14:06:57 2008
From: digz6666 at gmail.com (aznmedia)
Date: Sun, 14 Dec 2008 06:06:57 -0800 (PST)
Subject: [rabbitmq-discuss] Polling message from RabbitMQ by servicemix.
In-Reply-To: <4944D3D8.6080602@wizards.de>
References: <20849425.post@talk.nabble.com>
	<269388e30812050058k79eeba9fv8c3080786e25993d@mail.gmail.com>
	<20850938.post@talk.nabble.com>
	<269388e30812050451n6a578623kf643adda61e612ee@mail.gmail.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAALnJvd42GzVKrw8GtkNUv88BAAAAAA==@oryo.lt>
	<49400344.9090206@lshift.net> <20997760.post@talk.nabble.com>
	<4944D3D8.6080602@wizards.de>
Message-ID: <21000664.post@talk.nabble.com>




Holger Hoffst?tte-2 wrote:
> 
> aznmedia wrote:
>> 
>> I'm writing my xbean.xml file like following:
>> <?xml version="1.0" encoding="UTF-8"?>
>> <beans xmlns:jee="http://www.springframework.org/schema/jee"
>>       xmlns="http://www.springframework.org/schema/beans"
>>       xmlns:xsi="http://http://www.w3.org/2001/XMLSchema-instance"
>>       xsi:schemaLocation="http://servicemix.apache.org/jms/1.0
>> http://servicemix.apache.org/schema/servicemix-jms-3.2.2.xsd
>>       http://www.springframework.org/schema/beans
>> http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
>> 
>>        <jms:consumer service="my:ConsumerService"
>>                endpoint="mq"
>>                destinationName="rabbit-queue"
>>                connectionFactory="#connectionFactory"
>>                concurrentConsumers="8" />
>> 
>> 
>>        <bean id="connectionFactory"
>> class="com.rabbitmq.client.ConnectionFactory">
> [..]
> 
> I think there is some general confusion going on here. The ServiceMix
> consumer bean expects a *JMS* ConnectionFactory, but that will not work
> with the RabbitMQ connection factory, since it plays the same role
> (connection management) but does *not* implement the necessary JMS
> functionality. You will either have to wait until AMQP (or in this case
> the RabbitMQ library) implements JMS, or write your own AMQP/Rabbit
> transport for ServiceMix. Alternatively you might try a Qpid client
> library which is reported to work against a Rabbit broker (though I cannot
> say how well).
> 
> -h
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

JMS service unit deployed with exceptions. It shows following exception:
java.lang.Exception: <?xml version="1.0" encoding="UTF-8"?>
<jbi-task xmlns="http://java.sun.com/xml/ns/jbi/management-message"
version="1.0
">
<jbi-task-result>
<frmwk-task-result>
<frmwk-task-result-details>
<task-result-details>
<task-id>start</task-id>
<task-result>FAILED</task-result>
<message-type>ERROR</message-type>
</task-result-details>
</frmwk-task-result-details>
</frmwk-task-result>
<component-task-result
xmlns="http://java.sun.com/xml/ns/jbi/management-message"
>
        <component-name>servicemix-xmpp</component-name>
        <component-task-result-details>
                <task-result-details>
                        <task-id>start</task-id>
                        <task-result>FAILED</task-result>
                        <message-type>ERROR</message-type>
                        <task-status-msg>
<msg-loc-info>
<loc-token/>
<loc-message>Unable to start service unit</loc-message>
</msg-loc-info>
</task-status-msg>
                        <exception-info>
                                <nesting-level>1</nesting-level>
                                <msg-loc-info>
                                        <loc-token/>
                                        <loc-message>XMPPError connecting to
eon
-developer:5222.</loc-message>
                                        <stack-trace><![CDATA[XMPPError
connecti
ng to eon-developer:5222.: (502)
  -- caused by: java.net.ConnectException: Connection refused: connect
        at
org.jivesoftware.smack.XMPPConnection.connectUsingConfiguration(XMPPC
onnection.java:281)
        at
org.jivesoftware.smack.XMPPConnection.<init>(XMPPConnection.java:171)

        at
org.apache.servicemix.xmpp.XMPPEndpoint.start(XMPPEndpoint.java:77)
        at
org.apache.servicemix.xmpp.GroupChatEndpoint.start(GroupChatEndpoint.
java:51)
        at
org.apache.servicemix.common.DefaultServiceUnit.start(DefaultServiceU
nit.java:78)
        at
org.apache.servicemix.common.BaseServiceUnitManager.start(BaseService
UnitManager.java:155)
        at
org.apache.servicemix.jbi.framework.ServiceUnitLifeCycle.start(Servic
eUnitLifeCycle.java:103)
        at
org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.start(Se
rviceAssemblyLifeCycle.java:132)
        at
org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.restore(
ServiceAssemblyLifeCycle.java:330)
        at
org.apache.servicemix.jbi.framework.DeploymentService.start(Deploymen
tService.java:100)
        at
org.apache.servicemix.jbi.container.JBIContainer.start(JBIContainer.j
ava:670)
        at
org.apache.servicemix.jbi.container.SpringJBIContainer.afterPropertie
sSet(SpringJBIContainer.java:115)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1368)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.initializeBean(AbstractAutowireCapableBeanFactory.java:1334)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory$1.run(AbstractAutowireCapableBeanFactory.java:409)
        at java.security.AccessController.doPrivileged(Native Method)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.createBean(AbstractAutowireCapableBeanFactory.java:380)
        at
org.springframework.beans.factory.support.AbstractBeanFactory$1.getOb
ject(AbstractBeanFactory.java:264)
        at
org.springframework.beans.factory.support.DefaultSingletonBeanRegistr
y.getSingleton(DefaultSingletonBeanRegistry.java:221)
        at
org.springframework.beans.factory.support.AbstractBeanFactory.doGetBe
an(AbstractBeanFactory.java:261)
        at
org.springframework.beans.factory.support.AbstractBeanFactory.getBean
(AbstractBeanFactory.java:185)
        at
org.springframework.beans.factory.support.AbstractBeanFactory.getBean
(AbstractBeanFactory.java:164)
        at
org.springframework.beans.factory.support.DefaultListableBeanFactory.
preInstantiateSingletons(DefaultListableBeanFactory.java:429)
        at
org.springframework.context.support.AbstractApplicationContext.finish
BeanFactoryInitialization(AbstractApplicationContext.java:729)
        at
org.springframework.context.support.AbstractApplicationContext.refres
h(AbstractApplicationContext.java:381)
        at
org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>
(ClassPathXmlApplicationContext.java:161)
        at
org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>
(ClassPathXmlApplicationContext.java:51)
        at org.apache.servicemix.Main.main(Main.java:53)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at
org.codehaus.classworlds.Launcher.launchStandard(Launcher.java:410)
        at org.codehaus.classworlds.Launcher.launch(Launcher.java:344)
        at org.codehaus.classworlds.Launcher.main(Launcher.java:461)
Nested Exception:
java.net.ConnectException: Connection refused: connect
        at java.net.PlainSocketImpl.socketConnect(Native Method)
        at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)
        at
java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)
        at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)
        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
        at java.net.Socket.connect(Socket.java:519)
        at java.net.Socket.connect(Socket.java:469)
        at java.net.Socket.<init>(Socket.java:366)
        at java.net.Socket.<init>(Socket.java:180)
        at
org.jivesoftware.smack.XMPPConnection.connectUsingConfiguration(XMPPC
onnection.java:268)
        at
org.jivesoftware.smack.XMPPConnection.<init>(XMPPConnection.java:171)

        at
org.apache.servicemix.xmpp.XMPPEndpoint.start(XMPPEndpoint.java:77)
        at
org.apache.servicemix.xmpp.GroupChatEndpoint.start(GroupChatEndpoint.
java:51)
        at
org.apache.servicemix.common.DefaultServiceUnit.start(DefaultServiceU
nit.java:78)
        at
org.apache.servicemix.common.BaseServiceUnitManager.start(BaseService
UnitManager.java:155)
        at
org.apache.servicemix.jbi.framework.ServiceUnitLifeCycle.start(Servic
eUnitLifeCycle.java:103)
        at
org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.start(Se
rviceAssemblyLifeCycle.java:132)
        at
org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.restore(
ServiceAssemblyLifeCycle.java:330)
        at
org.apache.servicemix.jbi.framework.DeploymentService.start(Deploymen
tService.java:100)
        at
org.apache.servicemix.jbi.container.JBIContainer.start(JBIContainer.j
ava:670)
        at
org.apache.servicemix.jbi.container.SpringJBIContainer.afterPropertie
sSet(SpringJBIContainer.java:115)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1368)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.initializeBean(AbstractAutowireCapableBeanFactory.java:1334)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory$1.run(AbstractAutowireCapableBeanFactory.java:409)
        at java.security.AccessController.doPrivileged(Native Method)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.createBean(AbstractAutowireCapableBeanFactory.java:380)
        at
org.springframework.beans.factory.support.AbstractBeanFactory$1.getOb
ject(AbstractBeanFactory.java:264)
        at
org.springframework.beans.factory.support.DefaultSingletonBeanRegistr
y.getSingleton(DefaultSingletonBeanRegistry.java:221)
        at
org.springframework.beans.factory.support.AbstractBeanFactory.doGetBe
an(AbstractBeanFactory.java:261)
        at
org.springframework.beans.factory.support.AbstractBeanFactory.getBean
(AbstractBeanFactory.java:185)
        at
org.springframework.beans.factory.support.AbstractBeanFactory.getBean
(AbstractBeanFactory.java:164)
        at
org.springframework.beans.factory.support.DefaultListableBeanFactory.
preInstantiateSingletons(DefaultListableBeanFactory.java:429)
        at
org.springframework.context.support.AbstractApplicationContext.finish
BeanFactoryInitialization(AbstractApplicationContext.java:729)
        at
org.springframework.context.support.AbstractApplicationContext.refres
h(AbstractApplicationContext.java:381)
        at
org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>
(ClassPathXmlApplicationContext.java:161)
        at
org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>
(ClassPathXmlApplicationContext.java:51)
        at org.apache.servicemix.Main.main(Main.java:53)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at
org.codehaus.classworlds.Launcher.launchStandard(Launcher.java:410)
        at org.codehaus.classworlds.Launcher.launch(Launcher.java:344)
        at org.codehaus.classworlds.Launcher.main(Launcher.java:461)
]]></stack-trace>
                                </msg-loc-info>
                        </exception-info>
                </task-result-details>
        </component-task-result-details>
</component-task-result>
</jbi-task-result>
</jbi-task>

        at
org.apache.servicemix.jbi.framework.ManagementSupport.failure(Managem
entSupport.java:125)
        at
org.apache.servicemix.jbi.framework.ManagementSupport.failure(Managem
entSupport.java:111)
        at
org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.start(Se
rviceAssemblyLifeCycle.java:146)
        at
org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.restore(
ServiceAssemblyLifeCycle.java:330)
        at
org.apache.servicemix.jbi.framework.DeploymentService.start(Deploymen
tService.java:100)
        at
org.apache.servicemix.jbi.container.JBIContainer.start(JBIContainer.j
ava:670)
        at
org.apache.servicemix.jbi.container.SpringJBIContainer.afterPropertie
sSet(SpringJBIContainer.java:115)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1368)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.initializeBean(AbstractAutowireCapableBeanFactory.java:1334)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory$1.run(AbstractAutowireCapableBeanFactory.java:409)
        at java.security.AccessController.doPrivileged(Native Method)
        at
org.springframework.beans.factory.support.AbstractAutowireCapableBean
Factory.createBean(AbstractAutowireCapableBeanFactory.java:380)
        at
org.springframework.beans.factory.support.AbstractBeanFactory$1.getOb
ject(AbstractBeanFactory.java:264)
        at
org.springframework.beans.factory.support.DefaultSingletonBeanRegistr
y.getSingleton(DefaultSingletonBeanRegistry.java:221)
        at
org.springframework.beans.factory.support.AbstractBeanFactory.doGetBe
an(AbstractBeanFactory.java:261)
        at
org.springframework.beans.factory.support.AbstractBeanFactory.getBean
(AbstractBeanFactory.java:185)
        at
org.springframework.beans.factory.support.AbstractBeanFactory.getBean
(AbstractBeanFactory.java:164)
        at
org.springframework.beans.factory.support.DefaultListableBeanFactory.
preInstantiateSingletons(DefaultListableBeanFactory.java:429)
        at
org.springframework.context.support.AbstractApplicationContext.finish
BeanFactoryInitialization(AbstractApplicationContext.java:729)
        at
org.springframework.context.support.AbstractApplicationContext.refres
h(AbstractApplicationContext.java:381)
        at
org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>
(ClassPathXmlApplicationContext.java:161)
        at
org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>
(ClassPathXmlApplicationContext.java:51)
        at org.apache.servicemix.Main.main(Main.java:53)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:39)
        at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at
org.codehaus.classworlds.Launcher.launchStandard(Launcher.java:410)
        at org.codehaus.classworlds.Launcher.launch(Launcher.java:344)
        at org.codehaus.classworlds.Launcher.main(Launcher.java:461)

How can I write AMQP/Rabbittransport for ServiceMix? Is there any
documentation, specification, guides or examples?
-- 
View this message in context: http://www.nabble.com/Polling-message-from-RabbitMQ-by-servicemix.-tp20849425p21000664.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From digz6666 at gmail.com  Sun Dec 14 14:11:11 2008
From: digz6666 at gmail.com (aznmedia)
Date: Sun, 14 Dec 2008 06:11:11 -0800 (PST)
Subject: [rabbitmq-discuss] Polling message from RabbitMQ by servicemix.
In-Reply-To: <21000664.post@talk.nabble.com>
References: <20849425.post@talk.nabble.com>
	<269388e30812050058k79eeba9fv8c3080786e25993d@mail.gmail.com>
	<20850938.post@talk.nabble.com>
	<269388e30812050451n6a578623kf643adda61e612ee@mail.gmail.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAALnJvd42GzVKrw8GtkNUv88BAAAAAA==@oryo.lt>
	<49400344.9090206@lshift.net> <20997760.post@talk.nabble.com>
	<4944D3D8.6080602@wizards.de> <21000664.post@talk.nabble.com>
Message-ID: <21000693.post@talk.nabble.com>




aznmedia wrote:
> 
> 
> 
> Holger Hoffst?tte-2 wrote:
>> 
>> aznmedia wrote:
>>> 
>>> I'm writing my xbean.xml file like following:
>>> <?xml version="1.0" encoding="UTF-8"?>
>>> <beans xmlns:jee="http://www.springframework.org/schema/jee"
>>>       xmlns="http://www.springframework.org/schema/beans"
>>>       xmlns:xsi="http://http://www.w3.org/2001/XMLSchema-instance"
>>>       xsi:schemaLocation="http://servicemix.apache.org/jms/1.0
>>> http://servicemix.apache.org/schema/servicemix-jms-3.2.2.xsd
>>>       http://www.springframework.org/schema/beans
>>> http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
>>> 
>>>        <jms:consumer service="my:ConsumerService"
>>>                endpoint="mq"
>>>                destinationName="rabbit-queue"
>>>                connectionFactory="#connectionFactory"
>>>                concurrentConsumers="8" />
>>> 
>>> 
>>>        <bean id="connectionFactory"
>>> class="com.rabbitmq.client.ConnectionFactory">
>> [..]
>> 
>> I think there is some general confusion going on here. The ServiceMix
>> consumer bean expects a *JMS* ConnectionFactory, but that will not work
>> with the RabbitMQ connection factory, since it plays the same role
>> (connection management) but does *not* implement the necessary JMS
>> functionality. You will either have to wait until AMQP (or in this case
>> the RabbitMQ library) implements JMS, or write your own AMQP/Rabbit
>> transport for ServiceMix. Alternatively you might try a Qpid client
>> library which is reported to work against a Rabbit broker (though I
>> cannot
>> say how well).
>> 
>> -h
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> JMS service unit deployed with exceptions. It shows following exception:
> java.lang.Exception: <?xml version="1.0" encoding="UTF-8"?>
> <jbi-task xmlns="http://java.sun.com/xml/ns/jbi/management-message"
> version="1.0
> ">
> <jbi-task-result>
> <frmwk-task-result>
> <frmwk-task-result-details>
> <task-result-details>
> <task-id>start</task-id>
> <task-result>FAILED</task-result>
> <message-type>ERROR</message-type>
> </task-result-details>
> </frmwk-task-result-details>
> </frmwk-task-result>
> <component-task-result
> xmlns="http://java.sun.com/xml/ns/jbi/management-message"
>>
>         <component-name>servicemix-xmpp</component-name>
>         <component-task-result-details>
>                 <task-result-details>
>                         <task-id>start</task-id>
>                         <task-result>FAILED</task-result>
>                         <message-type>ERROR</message-type>
>                         <task-status-msg>
> <msg-loc-info>
> <loc-token/>
> <loc-message>Unable to start service unit</loc-message>
> </msg-loc-info>
> </task-status-msg>
>                         <exception-info>
>                                 <nesting-level>1</nesting-level>
>                                 <msg-loc-info>
>                                         <loc-token/>
>                                         <loc-message>XMPPError connecting
> to eon
> -developer:5222.</loc-message>
>                                         <stack-trace><![CDATA[XMPPError
> connecti
> ng to eon-developer:5222.: (502)
>   -- caused by: java.net.ConnectException: Connection refused: connect
>         at
> org.jivesoftware.smack.XMPPConnection.connectUsingConfiguration(XMPPC
> onnection.java:281)
>         at
> org.jivesoftware.smack.XMPPConnection.<init>(XMPPConnection.java:171)
> 
>         at
> org.apache.servicemix.xmpp.XMPPEndpoint.start(XMPPEndpoint.java:77)
>         at
> org.apache.servicemix.xmpp.GroupChatEndpoint.start(GroupChatEndpoint.
> java:51)
>         at
> org.apache.servicemix.common.DefaultServiceUnit.start(DefaultServiceU
> nit.java:78)
>         at
> org.apache.servicemix.common.BaseServiceUnitManager.start(BaseService
> UnitManager.java:155)
>         at
> org.apache.servicemix.jbi.framework.ServiceUnitLifeCycle.start(Servic
> eUnitLifeCycle.java:103)
>         at
> org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.start(Se
> rviceAssemblyLifeCycle.java:132)
>         at
> org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.restore(
> ServiceAssemblyLifeCycle.java:330)
>         at
> org.apache.servicemix.jbi.framework.DeploymentService.start(Deploymen
> tService.java:100)
>         at
> org.apache.servicemix.jbi.container.JBIContainer.start(JBIContainer.j
> ava:670)
>         at
> org.apache.servicemix.jbi.container.SpringJBIContainer.afterPropertie
> sSet(SpringJBIContainer.java:115)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1368)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory.initializeBean(AbstractAutowireCapableBeanFactory.java:1334)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory$1.run(AbstractAutowireCapableBeanFactory.java:409)
>         at java.security.AccessController.doPrivileged(Native Method)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory.createBean(AbstractAutowireCapableBeanFactory.java:380)
>         at
> org.springframework.beans.factory.support.AbstractBeanFactory$1.getOb
> ject(AbstractBeanFactory.java:264)
>         at
> org.springframework.beans.factory.support.DefaultSingletonBeanRegistr
> y.getSingleton(DefaultSingletonBeanRegistry.java:221)
>         at
> org.springframework.beans.factory.support.AbstractBeanFactory.doGetBe
> an(AbstractBeanFactory.java:261)
>         at
> org.springframework.beans.factory.support.AbstractBeanFactory.getBean
> (AbstractBeanFactory.java:185)
>         at
> org.springframework.beans.factory.support.AbstractBeanFactory.getBean
> (AbstractBeanFactory.java:164)
>         at
> org.springframework.beans.factory.support.DefaultListableBeanFactory.
> preInstantiateSingletons(DefaultListableBeanFactory.java:429)
>         at
> org.springframework.context.support.AbstractApplicationContext.finish
> BeanFactoryInitialization(AbstractApplicationContext.java:729)
>         at
> org.springframework.context.support.AbstractApplicationContext.refres
> h(AbstractApplicationContext.java:381)
>         at
> org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>
> (ClassPathXmlApplicationContext.java:161)
>         at
> org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>
> (ClassPathXmlApplicationContext.java:51)
>         at org.apache.servicemix.Main.main(Main.java:53)
>         at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
>         at
> sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
> java:39)
>         at
> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
> sorImpl.java:25)
>         at java.lang.reflect.Method.invoke(Method.java:597)
>         at
> org.codehaus.classworlds.Launcher.launchStandard(Launcher.java:410)
>         at org.codehaus.classworlds.Launcher.launch(Launcher.java:344)
>         at org.codehaus.classworlds.Launcher.main(Launcher.java:461)
> Nested Exception:
> java.net.ConnectException: Connection refused: connect
>         at java.net.PlainSocketImpl.socketConnect(Native Method)
>         at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)
>         at
> java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)
>         at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)
>         at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
>         at java.net.Socket.connect(Socket.java:519)
>         at java.net.Socket.connect(Socket.java:469)
>         at java.net.Socket.<init>(Socket.java:366)
>         at java.net.Socket.<init>(Socket.java:180)
>         at
> org.jivesoftware.smack.XMPPConnection.connectUsingConfiguration(XMPPC
> onnection.java:268)
>         at
> org.jivesoftware.smack.XMPPConnection.<init>(XMPPConnection.java:171)
> 
>         at
> org.apache.servicemix.xmpp.XMPPEndpoint.start(XMPPEndpoint.java:77)
>         at
> org.apache.servicemix.xmpp.GroupChatEndpoint.start(GroupChatEndpoint.
> java:51)
>         at
> org.apache.servicemix.common.DefaultServiceUnit.start(DefaultServiceU
> nit.java:78)
>         at
> org.apache.servicemix.common.BaseServiceUnitManager.start(BaseService
> UnitManager.java:155)
>         at
> org.apache.servicemix.jbi.framework.ServiceUnitLifeCycle.start(Servic
> eUnitLifeCycle.java:103)
>         at
> org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.start(Se
> rviceAssemblyLifeCycle.java:132)
>         at
> org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.restore(
> ServiceAssemblyLifeCycle.java:330)
>         at
> org.apache.servicemix.jbi.framework.DeploymentService.start(Deploymen
> tService.java:100)
>         at
> org.apache.servicemix.jbi.container.JBIContainer.start(JBIContainer.j
> ava:670)
>         at
> org.apache.servicemix.jbi.container.SpringJBIContainer.afterPropertie
> sSet(SpringJBIContainer.java:115)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1368)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory.initializeBean(AbstractAutowireCapableBeanFactory.java:1334)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory$1.run(AbstractAutowireCapableBeanFactory.java:409)
>         at java.security.AccessController.doPrivileged(Native Method)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory.createBean(AbstractAutowireCapableBeanFactory.java:380)
>         at
> org.springframework.beans.factory.support.AbstractBeanFactory$1.getOb
> ject(AbstractBeanFactory.java:264)
>         at
> org.springframework.beans.factory.support.DefaultSingletonBeanRegistr
> y.getSingleton(DefaultSingletonBeanRegistry.java:221)
>         at
> org.springframework.beans.factory.support.AbstractBeanFactory.doGetBe
> an(AbstractBeanFactory.java:261)
>         at
> org.springframework.beans.factory.support.AbstractBeanFactory.getBean
> (AbstractBeanFactory.java:185)
>         at
> org.springframework.beans.factory.support.AbstractBeanFactory.getBean
> (AbstractBeanFactory.java:164)
>         at
> org.springframework.beans.factory.support.DefaultListableBeanFactory.
> preInstantiateSingletons(DefaultListableBeanFactory.java:429)
>         at
> org.springframework.context.support.AbstractApplicationContext.finish
> BeanFactoryInitialization(AbstractApplicationContext.java:729)
>         at
> org.springframework.context.support.AbstractApplicationContext.refres
> h(AbstractApplicationContext.java:381)
>         at
> org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>
> (ClassPathXmlApplicationContext.java:161)
>         at
> org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>
> (ClassPathXmlApplicationContext.java:51)
>         at org.apache.servicemix.Main.main(Main.java:53)
>         at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
>         at
> sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
> java:39)
>         at
> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
> sorImpl.java:25)
>         at java.lang.reflect.Method.invoke(Method.java:597)
>         at
> org.codehaus.classworlds.Launcher.launchStandard(Launcher.java:410)
>         at org.codehaus.classworlds.Launcher.launch(Launcher.java:344)
>         at org.codehaus.classworlds.Launcher.main(Launcher.java:461)
> ]]></stack-trace>
>                                 </msg-loc-info>
>                         </exception-info>
>                 </task-result-details>
>         </component-task-result-details>
> </component-task-result>
> </jbi-task-result>
> </jbi-task>
> 
>         at
> org.apache.servicemix.jbi.framework.ManagementSupport.failure(Managem
> entSupport.java:125)
>         at
> org.apache.servicemix.jbi.framework.ManagementSupport.failure(Managem
> entSupport.java:111)
>         at
> org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.start(Se
> rviceAssemblyLifeCycle.java:146)
>         at
> org.apache.servicemix.jbi.framework.ServiceAssemblyLifeCycle.restore(
> ServiceAssemblyLifeCycle.java:330)
>         at
> org.apache.servicemix.jbi.framework.DeploymentService.start(Deploymen
> tService.java:100)
>         at
> org.apache.servicemix.jbi.container.JBIContainer.start(JBIContainer.j
> ava:670)
>         at
> org.apache.servicemix.jbi.container.SpringJBIContainer.afterPropertie
> sSet(SpringJBIContainer.java:115)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1368)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory.initializeBean(AbstractAutowireCapableBeanFactory.java:1334)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory.doCreateBean(AbstractAutowireCapableBeanFactory.java:473)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory$1.run(AbstractAutowireCapableBeanFactory.java:409)
>         at java.security.AccessController.doPrivileged(Native Method)
>         at
> org.springframework.beans.factory.support.AbstractAutowireCapableBean
> Factory.createBean(AbstractAutowireCapableBeanFactory.java:380)
>         at
> org.springframework.beans.factory.support.AbstractBeanFactory$1.getOb
> ject(AbstractBeanFactory.java:264)
>         at
> org.springframework.beans.factory.support.DefaultSingletonBeanRegistr
> y.getSingleton(DefaultSingletonBeanRegistry.java:221)
>         at
> org.springframework.beans.factory.support.AbstractBeanFactory.doGetBe
> an(AbstractBeanFactory.java:261)
>         at
> org.springframework.beans.factory.support.AbstractBeanFactory.getBean
> (AbstractBeanFactory.java:185)
>         at
> org.springframework.beans.factory.support.AbstractBeanFactory.getBean
> (AbstractBeanFactory.java:164)
>         at
> org.springframework.beans.factory.support.DefaultListableBeanFactory.
> preInstantiateSingletons(DefaultListableBeanFactory.java:429)
>         at
> org.springframework.context.support.AbstractApplicationContext.finish
> BeanFactoryInitialization(AbstractApplicationContext.java:729)
>         at
> org.springframework.context.support.AbstractApplicationContext.refres
> h(AbstractApplicationContext.java:381)
>         at
> org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>
> (ClassPathXmlApplicationContext.java:161)
>         at
> org.apache.xbean.spring.context.ClassPathXmlApplicationContext.<init>
> (ClassPathXmlApplicationContext.java:51)
>         at org.apache.servicemix.Main.main(Main.java:53)
>         at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
>         at
> sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
> java:39)
>         at
> sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
> sorImpl.java:25)
>         at java.lang.reflect.Method.invoke(Method.java:597)
>         at
> org.codehaus.classworlds.Launcher.launchStandard(Launcher.java:410)
>         at org.codehaus.classworlds.Launcher.launch(Launcher.java:344)
>         at org.codehaus.classworlds.Launcher.main(Launcher.java:461)
> 
> How can I write AMQP/Rabbittransport for ServiceMix? Is there any
> documentation, specification, guides or examples?
> 

It also throws following exception:

ERROR - Service                        - Async error occurred:
javax.jms.JMSExce
ption: Invalid acknowledgment: MessageAck {commandId = 8, responseRequired =
fal
se, ackType = 3, consumerId = ID:eon-developer-1374-1229263521218-2:3:-1:2,
firs
tMessageId = ID:eon-developer-1374-1229263521218-1:0:0:0:441, lastMessageId
= ID
:eon-developer-1374-1229263521218-1:0:0:0:441, destination =
topic://ActiveMQ.Ad
visory.Consumer.Topic.org.apache.servicemix.JCAFlow, transactionId = null,
messa
geCount = 1}
javax.jms.JMSException: Invalid acknowledgment: MessageAck {commandId = 8,
respo
nseRequired = false, ackType = 3, consumerId =
ID:eon-developer-1374-12292635212
18-2:3:-1:2, firstMessageId =
ID:eon-developer-1374-1229263521218-1:0:0:0:441, l
astMessageId = ID:eon-developer-1374-1229263521218-1:0:0:0:441, destination
= to
pic://ActiveMQ.Advisory.Consumer.Topic.org.apache.servicemix.JCAFlow,
transactio
nId = null, messageCount = 1}
        at
org.apache.activemq.broker.region.TopicSubscription.acknowledge(Topic
Subscription.java:216)
        at
org.apache.activemq.broker.region.AbstractRegion.acknowledge(Abstract
Region.java:364)
        at
org.apache.activemq.broker.region.RegionBroker.acknowledge(RegionBrok
er.java:470)
        at
org.apache.activemq.broker.TransactionBroker.acknowledge(TransactionB
roker.java:194)
        at
org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java
:73)
        at
org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java
:73)
        at
org.apache.activemq.broker.MutableBrokerFilter.acknowledge(MutableBro
kerFilter.java:84)
        at
org.apache.activemq.broker.TransportConnection.processMessageAck(Tran
sportConnection.java:443)
        at org.apache.activemq.command.MessageAck.visit(MessageAck.java:196)
        at
org.apache.activemq.broker.TransportConnection.service(TransportConne
ction.java:292)
        at
org.apache.activemq.broker.TransportConnection$1.onCommand(TransportC
onnection.java:180)
        at
org.apache.activemq.transport.TransportFilter.onCommand(TransportFilt
er.java:68)
        at
org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireForm
atNegotiator.java:143)
        at
org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityM
onitor.java:206)
        at
org.apache.activemq.transport.TransportSupport.doConsume(TransportSup
port.java:84)
        at
org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.jav
a:196)
        at
org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:
183)
        at java.lang.Thread.run(Thread.java:619)
-- 
View this message in context: http://www.nabble.com/Polling-message-from-RabbitMQ-by-servicemix.-tp20849425p21000693.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From holger at wizards.de  Sun Dec 14 14:22:02 2008
From: holger at wizards.de (=?UTF-8?B?SG9sZ2VyIEhvZmZzdMOkdHRl?=)
Date: Sun, 14 Dec 2008 15:22:02 +0100
Subject: [rabbitmq-discuss] Polling message from RabbitMQ by servicemix.
In-Reply-To: <21000664.post@talk.nabble.com>
References: <20849425.post@talk.nabble.com>	<269388e30812050058k79eeba9fv8c3080786e25993d@mail.gmail.com>	<20850938.post@talk.nabble.com>	<269388e30812050451n6a578623kf643adda61e612ee@mail.gmail.com>	<!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAALnJvd42GzVKrw8GtkNUv88BAAAAAA==@oryo.lt>	<49400344.9090206@lshift.net>
	<20997760.post@talk.nabble.com>	<4944D3D8.6080602@wizards.de>
	<21000664.post@talk.nabble.com>
Message-ID: <4945168A.2060601@wizards.de>

aznmedia wrote:
> JMS service unit deployed with exceptions. It shows following exception:

There is nothing regarding JMS or RabbitMQ in that stack trace..

> How can I write AMQP/Rabbittransport for ServiceMix? Is there any
> documentation, specification, guides or examples?

That would be a question for a ServiceMix group. You already asked a
similar question on servicemix-users and got a response from Guillaume
Nodet (in
http://www.mail-archive.com/users at servicemix.apache.org/msg06699.html).
So I recommend you look into the JBI spec and hoiw to create ServiceMix
bindings.

That is all I know, I stopped following SM and JBI a long time ago.

-h



From tonyg at lshift.net  Sun Dec 14 16:45:38 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sun, 14 Dec 2008 16:45:38 +0000
Subject: [rabbitmq-discuss] Java API methods don't return nor
	throw	exceptions
In-Reply-To: <49432BD9.5090105@lshift.net>
References: <4cc167ca0812101542t2ddbb18fj864c9faf9d87c1a8@mail.gmail.com>	<4941569C.2080700@wizards.de>	<4cc167ca0812121500j91e5cc9r3b0eeef8b02a3674@mail.gmail.com>	<4cc167ca0812121601g6385251cq92a3bde120c50fc1@mail.gmail.com>
	<49432BD9.5090105@lshift.net>
Message-ID: <49453832.9000902@lshift.net>

Matthias Radestock wrote:
> Only asynchronous methods are safe to call inside handleDelivery. To 
> call a synchronous method you'd have to signal another thread and make 
> the call from there (and taking care to not use the channel from more 
> than one thread simultaneously).

For example, class QueueingConsumer encapsulates just such
functionality:
http://www.rabbitmq.com/releases/rabbitmq-java-client/v1.4.0/rabbitmq-java-client-javadoc-1.4.0/com/rabbitmq/client/QueueingConsumer.html

For an example of its usage (we should put one in the API as well),
please see class LogTail in the examples bundled with the client.

Regards,
  Tony




From alexis.richardson at cohesiveft.com  Sun Dec 14 18:54:28 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Sun, 14 Dec 2008 18:54:28 +0000
Subject: [rabbitmq-discuss] Polling message from RabbitMQ by servicemix.
In-Reply-To: <4945168A.2060601@wizards.de>
References: <20849425.post@talk.nabble.com>
	<269388e30812050058k79eeba9fv8c3080786e25993d@mail.gmail.com>
	<20850938.post@talk.nabble.com>
	<269388e30812050451n6a578623kf643adda61e612ee@mail.gmail.com>
	<!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAALnJvd42GzVKrw8GtkNUv88BAAAAAA==@oryo.lt>
	<49400344.9090206@lshift.net> <20997760.post@talk.nabble.com>
	<4944D3D8.6080602@wizards.de> <21000664.post@talk.nabble.com>
	<4945168A.2060601@wizards.de>
Message-ID: <167204d20812141054l1a52fd7p6ed4aa8046363478@mail.gmail.com>

On Sun, Dec 14, 2008 at 2:22 PM, Holger Hoffst?tte <holger at wizards.de> wrote:
> aznmedia wrote:
>> How can I write AMQP/Rabbittransport for ServiceMix? Is there any
>> documentation, specification, guides or examples?
>
> That would be a question for a ServiceMix group.

You could also take a look at the Mule client which is very simple but
works.  It's on Mule Forge.  It does not use JMS.  It uses the
RabbitMQ Java client.

alexis


On Sun, Dec 14, 2008 at 2:22 PM, Holger Hoffst?tte <holger at wizards.de> wrote:
> aznmedia wrote:
>> JMS service unit deployed with exceptions. It shows following exception:
>
> There is nothing regarding JMS or RabbitMQ in that stack trace..
>
>> How can I write AMQP/Rabbittransport for ServiceMix? Is there any
>> documentation, specification, guides or examples?
>
> That would be a question for a ServiceMix group. You already asked a
> similar question on servicemix-users and got a response from Guillaume
> Nodet (in
> http://www.mail-archive.com/users at servicemix.apache.org/msg06699.html).
> So I recommend you look into the JBI spec and hoiw to create ServiceMix
> bindings.
>
> That is all I know, I stopped following SM and JBI a long time ago.
>
> -h
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From Alister.Morton at tradition.com  Mon Dec 15 09:20:37 2008
From: Alister.Morton at tradition.com (Alister Morton)
Date: Mon, 15 Dec 2008 09:20:37 +0000
Subject: [rabbitmq-discuss] Exceptions in c# client library
In-Reply-To: <49429D2A.3070305@lshift.net>
References: <5A46D132C446C04B9EFE8AD14E7891065C489059F9@SVR-2K3-BH-EMC.tradition.int>
	<49429D2A.3070305@lshift.net>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891065C48905AA4@SVR-2K3-BH-EMC.tradition.int>

> it is very probable that this is a bug related to something
> that was reported before, see
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-Augu
> st/001545.html
> for details.

I'm not sure it's the same thing. What I'm seeing is the expected exceptions being thrown when, for example, the network connection is lost. The problem is, I can't see how I can easily catch these exceptions and react to them, for example, if the network connection is lost I'd like to be able tear down the model and connection, and then attempt to reconnect. Currently I can't see how I can catch these events. Maybe I'm missing something.

In our internal middle tier system, when the connection is lost the middle tier itself takes care of remaking the connection, as network faults can be transient this is what you want. At the same time, the client is called back to indicate that the connection has been lost, and is called back when the connection is remade.

AFAICT there aren't any hooks on the IConnection or IModel to enable the client process to handle these sort of exceptions. If I add a handler with

              conn.CallbackException += new RabbitMQ.Client.Events.CallbackExceptionEventHandler(conn_CallbackException);
   or
                model.CallbackException += new RabbitMQ.Client.Events.CallbackExceptionEventHandler(model_CallbackException);

they don't get called when these sort of errors occur.

al.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consist of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicate prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From tonyg at lshift.net  Mon Dec 15 12:21:57 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 15 Dec 2008 12:21:57 +0000
Subject: [rabbitmq-discuss] Java client: channel synchronization
	deadlock?
In-Reply-To: <31D51DC1-69B6-47E6-A1D0-68996132A3E2@arithum.com>
References: <31D51DC1-69B6-47E6-A1D0-68996132A3E2@arithum.com>
Message-ID: <49464BE5.9020804@lshift.net>

Hi Jonathan,

Jonathan McGee wrote:
> [...] the following code causes a deadlock:
> synchronized(channel) { channel.queueDeclare("foo"); }
> It appears this is because the RabbitMQ client does its own locking  
> on "this" internally.

*facepalm*

Excellent observation. Thanks for pointing this out. We're fixing it now
-- the fix will (modulo unforeseen problems) be in the 1.5.0 release.

> (As a side note, the guide also indicates that you must obtain a  
> ticket to access a Channel, but this doesn't seem to be required  
> anymore.)

That'll be changed with this upcoming release.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From matthias at lshift.net  Mon Dec 15 13:48:48 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 15 Dec 2008 13:48:48 +0000
Subject: [rabbitmq-discuss] erlang-client problem on OS X
	(empty_rpc_bottom_half)
In-Reply-To: <2B02D4FC-4EB8-4F5D-870D-ADC80FD15B0A@mindspring.com>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>	<269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>	<80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>	<269388e30812100049t1ee74553w4e68eed6747e2be4@mail.gmail.com>	<47E93AF3-7336-4AA2-9EA3-870270202117@mindspring.com>	<269388e30812100305t51a03f02l1e2346731bbb9935@mail.gmail.com>	<B3E4AFEE-95F7-4768-B152-5EACEA92C014@mindspring.com>	<269388e30812110035g3f9895acp92ca751fad00e5d3@mail.gmail.com>	<FE9EBC7A-4EFB-41A5-957D-066BE471567E@mindspring.com>	<4942259A.3090502@lshift.net>
	<2B02D4FC-4EB8-4F5D-870D-ADC80FD15B0A@mindspring.com>
Message-ID: <49466040.3030005@lshift.net>

Matt,

Matt Stancliff wrote:
>   My attempt (attached) involved:
>     - scrape vm_stat output
>     - use total = free + active + inactive + wired
>     - use total free = free + inactive
> [...]
>   Nothing currently includes buffer/page cache statistics.  They are 
> opaque, hidden, out of reach, verboten.  The value of free memory is the 
> best we have.

Is that really the case? While there may not be any info about UBC's 
memory usage, surely any memory it does use is included in vm_stat's 
inactive page count, isn't it?


Matthias



From tonyg at lshift.net  Mon Dec 15 14:02:42 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 15 Dec 2008 14:02:42 +0000
Subject: [rabbitmq-discuss] Java client: channel
	synchronization	deadlock?
In-Reply-To: <49464BE5.9020804@lshift.net>
References: <31D51DC1-69B6-47E6-A1D0-68996132A3E2@arithum.com>
	<49464BE5.9020804@lshift.net>
Message-ID: <49466382.8020804@lshift.net>

Tony Garnock-Jones wrote:
> We're fixing it now -- the fix will (modulo unforeseen problems) be
> in the 1.5.0 release.

The fix has been merged into our "default" hg branch, and so will be
included in the 1.5.0 release.

Please let us know if you have any more deadlock-type (or other!) issues.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From holger at wizards.de  Mon Dec 15 14:28:15 2008
From: holger at wizards.de (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Mon, 15 Dec 2008 15:28:15 +0100
Subject: [rabbitmq-discuss] How many Channels do you use?
Message-ID: <4946697F.1020600@wizards.de>

Group,

Tony and I were just wondering how many channels people use in their
applications and would love to hear some approximate numbers. As a logical
abstraction over the connection they make a lot of sense (IMHO and
regardless of the flow control duplication), yet at the same time letting
(for example) every channel have its own new connection might have
benefits as well in certain scenarios.

Obviously the number of channels would be much higher for users of, say,
multithreaded/big-box container-like technologies or cases where a huge
number of concurrent/slow/low-traffic consumers are running at the same
time, however we'd really like to hear how you are using the client libs.

So, show of hands please? :)

cheerz
Holger





From sysop at mindspring.com  Mon Dec 15 16:34:41 2008
From: sysop at mindspring.com (Matt Stancliff)
Date: Mon, 15 Dec 2008 08:34:41 -0800
Subject: [rabbitmq-discuss] erlang-client problem on OS X
	(empty_rpc_bottom_half)
In-Reply-To: <49466040.3030005@lshift.net>
References: <F4F8CD7F-1816-4FF6-B1CB-9F29AB29B82C@mindspring.com>	<269388e30812090116t6a4af96elbee6c591ccbe4743@mail.gmail.com>	<80B5F74B-65BE-4890-83A7-25961C006181@mindspring.com>	<269388e30812100049t1ee74553w4e68eed6747e2be4@mail.gmail.com>	<47E93AF3-7336-4AA2-9EA3-870270202117@mindspring.com>	<269388e30812100305t51a03f02l1e2346731bbb9935@mail.gmail.com>	<B3E4AFEE-95F7-4768-B152-5EACEA92C014@mindspring.com>	<269388e30812110035g3f9895acp92ca751fad00e5d3@mail.gmail.com>	<FE9EBC7A-4EFB-41A5-957D-066BE471567E@mindspring.com>	<4942259A.3090502@lshift.net>
	<2B02D4FC-4EB8-4F5D-870D-ADC80FD15B0A@mindspring.com>
	<49466040.3030005@lshift.net>
Message-ID: <E8D89764-F48B-4C77-A3DC-588F618D0EDF@mindspring.com>

Matthias,

On Dec 15, 2008, at 5:48 AM, Matthias Radestock wrote:

> Matt Stancliff wrote:
>>  Nothing currently includes buffer/page cache statistics.  They are  
>> opaque, hidden, out of reach, verboten.  The value of free memory  
>> is the best we have.
>
> Is that really the case? While there may not be any info about UBC's  
> memory usage, surely any memory it does use is included in vm_stat's  
> inactive page count, isn't it?


   By "includes" I meant "directly exposes."  The inactive list  
includes any pages not accessed recently inclusive of of cache,  
buffers, or process pages:
"The inactive list contains pages that are currently resident in  
physical memory but have not been accessed recently. These pages  
contain valid data but may be released from memory at any time." from http://developer.apple.com/DOCUMENTATION/Performance/Conceptual/ManagingMemory/Articles/AboutMemory.html

   We don't have a view into the amount of cache capable of being  
quickly discarded versus entering into paging out pieces of processes.


-Matt
-- 
Matt Stancliff                    San Jose, CA
AIM: seijimr              iPhone: 678-591-9337
"The best way to predict the future is to invent it." --Alan Kay




From alexis.richardson at cohesiveft.com  Tue Dec 16 17:19:57 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 16 Dec 2008 17:19:57 +0000
Subject: [rabbitmq-discuss] good post on using Ruby with RabbitMQ
Message-ID: <167204d20812160919x2943b842l8d01ab5671acde99@mail.gmail.com>

Hi,

I liked this post about using RabbitMQ with Ruby:
http://everburning.com/news/ridding-the-rabbit/

alexis



From preston at synergy-solutions.biz  Tue Dec 16 17:37:25 2008
From: preston at synergy-solutions.biz (Preston Marshall)
Date: Tue, 16 Dec 2008 11:37:25 -0600
Subject: [rabbitmq-discuss] good post on using Ruby with RabbitMQ
In-Reply-To: <167204d20812160919x2943b842l8d01ab5671acde99@mail.gmail.com>
References: <167204d20812160919x2943b842l8d01ab5671acde99@mail.gmail.com>
Message-ID: <84A4606C-A828-4A59-9E74-461896166931@synergy-solutions.biz>

pretty cool, i wasn't aware that there was a fork.
On Dec 16, 2008, at 11:19 AM, Alexis Richardson wrote:

> Hi,
>
> I liked this post about using RabbitMQ with Ruby:
> http://everburning.com/news/ridding-the-rabbit/
>
> alexis
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2441 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081216/05cab6e5/attachment.bin 

From alexis.richardson at cohesiveft.com  Tue Dec 16 17:46:06 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Tue, 16 Dec 2008 17:46:06 +0000
Subject: [rabbitmq-discuss] good post on using Ruby with RabbitMQ
In-Reply-To: <84A4606C-A828-4A59-9E74-461896166931@synergy-solutions.biz>
References: <167204d20812160919x2943b842l8d01ab5671acde99@mail.gmail.com>
	<84A4606C-A828-4A59-9E74-461896166931@synergy-solutions.biz>
Message-ID: <167204d20812160946h4ff17ca3gae1e0c164fe60061@mail.gmail.com>

On Tue, Dec 16, 2008 at 5:37 PM, Preston Marshall
<preston at synergy-solutions.biz> wrote:
> pretty cool, i wasn't aware that there was a fork.

It is in the nature of Git that forks occur as a precursor to certain
sorts of patch.

alexis



> On Dec 16, 2008, at 11:19 AM, Alexis Richardson wrote:
>
>> Hi,
>>
>> I liked this post about using RabbitMQ with Ruby:
>> http://everburning.com/news/ridding-the-rabbit/
>>
>> alexis
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthias at lshift.net  Tue Dec 16 21:40:31 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 16 Dec 2008 21:40:31 +0000
Subject: [rabbitmq-discuss] Exceptions in c# client library
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891065C48905AA4@SVR-2K3-BH-EMC.tradition.int>
References: <5A46D132C446C04B9EFE8AD14E7891065C489059F9@SVR-2K3-BH-EMC.tradition.int>	<49429D2A.3070305@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891065C48905AA4@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <4948204F.9090002@lshift.net>

Alister,

Alister Morton wrote:
> AFAICT there aren't any hooks on the IConnection or IModel to enable
the client process to handle these sort of exceptions. If I add a
handler with
> 
> conn.CallbackException += new
RabbitMQ.Client.Events.CallbackExceptionEventHandler(conn_CallbackException);
> or model.CallbackException += new
RabbitMQ.Client.Events.CallbackExceptionEventHandler(model_CallbackException);
> 
> they don't get called when these sort of errors occur.

CallBackException events are "signalled when an exception occurs in a 
callback invoked by the connection/model.".

What you want is an event that is raised when the connection or 
model/channel is destroyed. These are IConnection.ConnectionShutdown and 
IModel.ModelShutdown, respectively.


Regards,

Matthias.



From Alister.Morton at tradition.com  Wed Dec 17 08:51:07 2008
From: Alister.Morton at tradition.com (Alister Morton)
Date: Wed, 17 Dec 2008 08:51:07 +0000
Subject: [rabbitmq-discuss] Exceptions in c# client library
In-Reply-To: <4948204F.9090002@lshift.net>
References: <5A46D132C446C04B9EFE8AD14E7891065C489059F9@SVR-2K3-BH-EMC.tradition.int>
	<49429D2A.3070305@lshift.net>
	<5A46D132C446C04B9EFE8AD14E7891065C48905AA4@SVR-2K3-BH-EMC.tradition.int>
	<4948204F.9090002@lshift.net>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891065C48905CAF@SVR-2K3-BH-EMC.tradition.int>

> What you want is an event that is raised when the connection
> or model/channel is destroyed. These are
> IConnection.ConnectionShutdown and IModel.ModelShutdown, respectively.

Ah - thanks, I'll investigate those. I hadn't realised these were called under error conditions.


al.

The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consist of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicate prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.



From tonyg at lshift.net  Wed Dec 17 10:04:24 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 17 Dec 2008 10:04:24 +0000
Subject: [rabbitmq-discuss] RabbitMQ 1.4 stomp plugin support?
In-Reply-To: <890230.58774.qm@web30902.mail.mud.yahoo.com>
References: <890230.58774.qm@web30902.mail.mud.yahoo.com>
Message-ID: <e6d6858d0812170204o2763182bs1ceb15fc21d82975@mail.gmail.com>

Hi Adam,

(I've taken the liberty of CCing the rabbitmq-discuss mailing list, as
I'm going to be out of the country for a few weeks and will not be
constantly connected.)

2008/12/16 Adam Chase <ac5p at yahoo.com>:
> I was wondering if this is compatible with version 1.4.
> If not, do you know where I can download 1.3 of rabbitmq?
> I tried it and it all compiles fine, but no message and nothing listening on
> port 61613

It runs fine with version 1.4 of RabbitMQ. I have been running it over
the last few days mainly against the tip of the default branch of our
Mercurial repository, but having just tried the 1.4 version, it works
OK too.

Both of the following result for me in running, functioning
STOMP-enabled RabbitMQ servers:

1. Tip of default branch (i.e. very close to 1.5.0)

hg clone http://hg.rabbitmq.com/rabbitmq-codegen
hg clone http://hg.rabbitmq.com/rabbitmq-server
hg clone http://hg.rabbitmq.com/rabbitmq-stomp
make -C rabbitmq-server
make -C rabbitmq-stomp run

2. Version 1.4.0 (retrieved from mercurial)

hg clone -r rabbitmq_v1_4_0 http://hg.rabbitmq.com/rabbitmq-codegen
hg clone -r rabbitmq_v1_4_0 http://hg.rabbitmq.com/rabbitmq-server
hg clone -r rabbitmq_v1_4_0 http://hg.rabbitmq.com/rabbitmq-stomp
make -C rabbitmq-server
make -C rabbitmq-stomp run

If these don't work, you could try sending us a transcript of a
session in which you download and build the components, so we can see
what's going wrong. (If you haven't used it before, try script(1) (man
script).)

Regards,
  Tony



From matthias at lshift.net  Thu Dec 18 11:44:07 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 18 Dec 2008 11:44:07 +0000
Subject: [rabbitmq-discuss] RabbitMQ 1.5.0 released
Message-ID: <494A3787.30700@lshift.net>

The RabbitMQ team is pleased to announce the release of RabbitMQ 1.5.0.

This release has beta status and focuses on the following areas:

- removal of tickets and realms
- implementation of 'queue.unbind'
- producer throttling when running low on memory
- improved scalability of queue and binding creation and deletion
- disabled Nagle for more consistent latency
- added several management/info commands to rabbitmqctl
- bug fixes in the area of connection and channel closure
- support the latest Erlang/OTP release (R12B-5)
- improved configurability via environment variables

For details see the attached release notes.

Binary and source distributions of the new release can be found in the 
usual place, at http://www.rabbitmq.com/download.html

We recommend that all users of earlier versions of RabbitMQ upgrade to 
this latest release.

As always, we welcome any questions, bug reports, and other feedback on 
this release, as well as general suggestions for features and 
enhancements in future releases. Mail us via the RabbitMQ discussion 
list at rabbitmq-discuss at lists.rabbitmq.com, or directly at 
info at rabbitmq.com.


Regards,

The RabbitMQ Team

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: README-1.5.0.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081218/35c6c574/attachment.txt 

From dmitriy.samovskiy at cohesiveft.com  Thu Dec 18 14:58:50 2008
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Thu, 18 Dec 2008 08:58:50 -0600
Subject: [rabbitmq-discuss] Introducing Rabbitbal
Message-ID: <494A652A.3090605@cohesiveft.com>


Hi all,

In case anybody is interested in a rabbitmq-based reverse proxy for rails, I put one 
together at http://github.com/somic/rabbitbal. The README file explains possible benefits 
of using AMQP instead of raw HTTP in proxy scenarios as I see them. This is proof of 
concept, not thoroughly tested under load.

Other Ruby web frameworks can be trivially plugged in if they have support for Rack. 
Frameworks in other languages can be used with this approach as well, but somewhat more 
effort might be required - it's still very doable.

Rabbitbal is in large part based on Nanite, a project that was mentioned on this list 
before (see http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-October/002100.html)

- Dmitriy



From 0x6e6562 at gmail.com  Thu Dec 18 15:18:40 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 18 Dec 2008 15:18:40 +0000
Subject: [rabbitmq-discuss] Introducing Rabbitbal
In-Reply-To: <494A652A.3090605@cohesiveft.com>
References: <494A652A.3090605@cohesiveft.com>
Message-ID: <269388e30812180718h5d66953du9debb60b4099f302@mail.gmail.com>

Dmitriy,

On Thu, Dec 18, 2008 at 2:58 PM, Dmitriy Samovskiy
<dmitriy.samovskiy at cohesiveft.com> wrote:
> In case anybody is interested in a rabbitmq-based reverse proxy for rails, I put one
> together at http://github.com/somic/rabbitbal. The README file explains possible benefits
> of using AMQP instead of raw HTTP in proxy scenarios as I see them. This is proof of
> concept, not thoroughly tested under load.

Interesting. Just out of interest's sake, what effect does the latency
of delivery have in comparison to using a plain jane reverse proxy?

Also, would this not be a use case for the qos command -  do you have
a real scenario where the processing time differs across requests or
just across each backend?

Ben



From alexis.richardson at cohesiveft.com  Thu Dec 18 15:24:02 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Thu, 18 Dec 2008 15:24:02 +0000
Subject: [rabbitmq-discuss] Introducing Rabbitbal
In-Reply-To: <494A652A.3090605@cohesiveft.com>
References: <494A652A.3090605@cohesiveft.com>
Message-ID: <167204d20812180724o69984b1dj573ee780b443ff79@mail.gmail.com>

Hi guys,

Another cool project would be to apply this technology to the PHP case
- now that there is a PHP client for RabbitMQ.

Any takers?

alexis


On Thu, Dec 18, 2008 at 2:58 PM, Dmitriy Samovskiy
<dmitriy.samovskiy at cohesiveft.com> wrote:
>
> Hi all,
>
> In case anybody is interested in a rabbitmq-based reverse proxy for rails, I put one
> together at http://github.com/somic/rabbitbal. The README file explains possible benefits
> of using AMQP instead of raw HTTP in proxy scenarios as I see them. This is proof of
> concept, not thoroughly tested under load.
>
> Other Ruby web frameworks can be trivially plugged in if they have support for Rack.
> Frameworks in other languages can be used with this approach as well, but somewhat more
> effort might be required - it's still very doable.
>
> Rabbitbal is in large part based on Nanite, a project that was mentioned on this list
> before (see http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-October/002100.html)
>
> - Dmitriy
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From dmitriy.samovskiy at cohesiveft.com  Thu Dec 18 16:02:57 2008
From: dmitriy.samovskiy at cohesiveft.com (Dmitriy Samovskiy)
Date: Thu, 18 Dec 2008 10:02:57 -0600
Subject: [rabbitmq-discuss] Introducing Rabbitbal
In-Reply-To: <269388e30812180718h5d66953du9debb60b4099f302@mail.gmail.com>
References: <494A652A.3090605@cohesiveft.com>
	<269388e30812180718h5d66953du9debb60b4099f302@mail.gmail.com>
Message-ID: <494A7431.5090505@cohesiveft.com>

Hi Ben,

>> In case anybody is interested in a rabbitmq-based reverse proxy for rails, I put one
>> together at http://github.com/somic/rabbitbal. The README file explains possible benefits
>> of using AMQP instead of raw HTTP in proxy scenarios as I see them. This is proof of
>> concept, not thoroughly tested under load.
> 
> Interesting. Just out of interest's sake, what effect does the latency
> of delivery have in comparison to using a plain jane reverse proxy?
To be honest, I don't know if latency of delivery in rabbitbal will be better or worse 
than in regular proxy. I think it will be pretty much the same. Also, note that latency of 
delivery is relatively small part of entire request-response cycle in HTTP these days, 
esp. in reverse proxy scenarios where proxies are usually close to servers.

Latency imho is not a driver for rabbitbal. More efficient load balancing is.


> Also, would this not be a use case for the qos command -  do you have
> a real scenario where the processing time differs across requests or
> just across each backend?
Once we take a request from "HTTP wire" and put it on "AMQP wire", we can definitely use 
all sorts of load balancing facilities provided by RabbitMQ. There is no reason why 
basic.qos won't help at least on some workloads.

Different hardware (for example) can lead to processing time differing between backends; 
if one request leads to a single simple SQL and another has tons of difficult ones, this 
would obviously lead to different processing times across requests.

- Dmitriy



From eran.sandler at gmail.com  Fri Dec 19 03:06:03 2008
From: eran.sandler at gmail.com (Eran Sandler)
Date: Fri, 19 Dec 2008 05:06:03 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.5.0 released
In-Reply-To: <494A3787.30700@lshift.net>
References: <494A3787.30700@lshift.net>
Message-ID: <5f884b720812181906r56d056a6n31511e06e4323802@mail.gmail.com>

Congrads on getting a new release out! :-)
Now the only thing missing for me is the flow-to-disk scenario and I'm all
good :-D

I have 2 questions:
1) Have you managed to test the memory based flow control feature on Windows
prior to the release? (it wasn't mention in the documentation like the
MacOSX issue)

2) What would be the right way of upgrading rabbitmq on a running server
without shutting it down? (I know erlang supports this feature but I failed
to find something about it in the documentation).

3) Can you elaborate more on the memory based flow throttling and what is
the behavior of clients when they get the channel.flow command?

Thanks,
Eran


On Thu, Dec 18, 2008 at 1:44 PM, Matthias Radestock <matthias at lshift.net>wrote:

> The RabbitMQ team is pleased to announce the release of RabbitMQ 1.5.0.
>
> This release has beta status and focuses on the following areas:
>
> - removal of tickets and realms
> - implementation of 'queue.unbind'
> - producer throttling when running low on memory
> - improved scalability of queue and binding creation and deletion
> - disabled Nagle for more consistent latency
> - added several management/info commands to rabbitmqctl
> - bug fixes in the area of connection and channel closure
> - support the latest Erlang/OTP release (R12B-5)
> - improved configurability via environment variables
>
> For details see the attached release notes.
>
> Binary and source distributions of the new release can be found in the
> usual place, at http://www.rabbitmq.com/download.html
>
> We recommend that all users of earlier versions of RabbitMQ upgrade to this
> latest release.
>
> As always, we welcome any questions, bug reports, and other feedback on
> this release, as well as general suggestions for features and enhancements
> in future releases. Mail us via the RabbitMQ discussion list at
> rabbitmq-discuss at lists.rabbitmq.com, or directly at info at rabbitmq.com.
>
>
> Regards,
>
> The RabbitMQ Team
>
>
> Release: RabbitMQ 1.5.0
> Status : beta
>
> Release Highlights
> ==================
>
> server
> ------
> bug fixes
> - support running on top of the latest Erlang/OTP release (R12B-5)
> - maintain effect visibility guarantees in cross-node routing
> - reduce likelihood of timeouts when channels interact with a large
>  number of queues
> - graceful handling of some corner cases in abrupt client disconnect
>
> enhancements
> - remove tickets and realms
> - improve scalability of queue and binding creation and deletion
> - add 'queue.unbind' command to protocol
> - disable Nagle for more consistent latency
> - throttle producers with 'channel.flow' when running low on memory
>  Note that this feature is disabled by default; please see
>  http://www.rabbitmq.com/admin-guide.html#memsup for details.
> - remove a few spurious errors in the logs
> - show the actual listening IP & port in logs
> - improve rabbitmqctl:
>  - add a few useful info commands
>  - add a 'reopen_logs' command to assist in log management
>  - add a '-q' flag to suppress informational messages and thus
>    facilitate post-processing of the output
>  - write errors to stderr instead of stdout
>
> Java client
> -----------
> bug fixes
> - eliminate several race condition in connection and channel closure
>  that could result in deadlock
> - always respond to a server's 'connection.close' and 'channel.close'
> - prevent interference between interal locking on channels and
>  application-level locking
>
> enhancements
> - remove tickets and realms
> - support 'queue.unbind'
> - disable Nagle for more consistent latency
> - react to server-issued 'channel.flow' by (un)blocking producers
> - add channel.abort method to unconditionally and idempotently close a
>  channel
> - complete the set of channel and connection close and abort methods
>
> .net client
> -----------
> bug fixes
> - eliminate "Cannot access a disposed object" exception in connection
>  closure and disposal
> - correct heartbeat logic to prevent spurious timeouts when not idling
>
> enhancements
> - remove tickets and realms
> - support 'queue.unbind'
> - disable Nagle for more consistent latency
> - react to server-issued 'channel.flow' by (un)blocking producers
> - add IModel.abort method to unconditionally and idempotently close a
>  channel
> - complete the set of channel and connection close and abort methods
>
> building & packaging
> --------------------
> bug fixes
> - correct locations of libraries et al on 64bit rpm systems
>
> enhancements
> - detect upgrade from pre-1.5.0 and warn/ask user (under debian & rpm)
> - comply with debian and rpm packaging policies and guidelines
> - prevent accidental executing of scripts as non-root user under
>  debian & rpm
> - read /etc/default/rabbitmq in scripts on Unix-y systems, with env
>  vars taking precedence over vars set in that file and the defaults
>  used by the scripts
> - prefix env vars with 'RABBITMQ_'
> - allow script execution from anywhere (not just the scripts' dir)
> - add script & instructions to start RabbitMQ as a Windows service
> - add 'status' command to init.d script under debian & rpm
> - automatic log rotation under debian & rpm
> - use simplejson.py instead of json.py in code generation, thus
>  allowing use of Python 2.6
>
>
> Upgrading
> =========
>
> The database schema has changed between RabbitMQ-1.4.0 and this
> release. When the RabbitMQ server detects the presence of an old
> database, it moves it to a backup location, creates a fresh, empty
> database, and logs a warning.
>
> If your RabbitMQ installation contains important data, such as user
> accounts, durable exchanges and queues, or persistent messages, then
> we recommend you contact support at rabbitmq.com for assistance with the
> upgrade.
>
>
> Credits
> =======
>
> We would like to thank the following individuals for submitting bug
> reports and feedback that we incorporated into this release:
>
> Alister Morton
> Aman Gupta
> Andrius Norkaitis
> Barry Pedersen
> Benjamin Black
> Benjamin Polidore
> Brian Sullivan
> David Corcoran
> Dmitriy Samovskiy
> Edwin Fine
> Eran Sandler
> Esteve Fernandez
> Ezra Zygmuntowicz
> Ferret
> Gavin Bong
> Geoffrey Anderson
> Holger Hoffst?tte
> Jacek Korycki
> John Leuner
> Jonatan Kallus
> Jonathan McGee
> Kyle Sampson
> Leo Martins
> Maarten Engelen
> Nathan Woodhull
> Nigel Verdon
> Paul Jones
> Pete Kay
> Peter Kieltyka
> Sarah Jelinek
> Sean Treadway
> Steve Jenson
> Terry Jones
> Vadim Zaliva
> Valentino Volonghi
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081219/00537992/attachment.htm 

From 0x6e6562 at gmail.com  Fri Dec 19 06:11:25 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 19 Dec 2008 06:11:25 +0000
Subject: [rabbitmq-discuss] RabbitMQ 1.5.0 released
In-Reply-To: <5f884b720812181906r56d056a6n31511e06e4323802@mail.gmail.com>
References: <494A3787.30700@lshift.net>
	<5f884b720812181906r56d056a6n31511e06e4323802@mail.gmail.com>
Message-ID: <269388e30812182211u3f6ad5afl6b040d1e80bb0e3f@mail.gmail.com>

Eran,

On Fri, Dec 19, 2008 at 3:06 AM, Eran Sandler <eran.sandler at gmail.com> wrote:
> 1) Have you managed to test the memory based flow control feature on Windows
> prior to the release?

I'm not aware of any Windows specific testing of this feature -
Matthias may have done though - but if you'd like to test this, we'd
be very interested in your mileage.

> (it wasn't mention in the documentation like the
> MacOSX issue)

Personally I don't think there is an OS X issue per se (yet). The
reason why there is an official cautiousness about how this is handled
on OS X (and any other non-Linux OS) is because of the problems that
we ran into when running this on Linux. When we originally tested this
feature, everything was fine. However, we tested this on a server that
coincidentally was not doing much disk IO at the time. Since Linux
uses free memory to cache disk IO, the amount of free memory reported
by the standard Erlang tools was misleading and the alarm was being
sounded too easily. So we wrote a Linux specific memory supervisor to
get a more accurate reading from /proc/meminfo. We also turned this
feature off by default, because we felt that it would confuse people
in a dev scenario but still want to allow this to be turned on in a
prod scenario (which is where you need it most).

The length that we had to go to get this to work properly on Linux
indicates that there may be some other memory specific idiosyncrasies
on other OSs, which we have not analyzed in full detail.

Matt Stancliff started a discussion thread recently about his
experiences on OS X and the specifics of memory reporting on that
platform, so essentially we are waiting to hear back from similar
experiences from users on different platforms.

> 2) What would be the right way of upgrading rabbitmq on a running server
> without shutting it down? (I know erlang supports this feature but I failed
> to find something about it in the documentation).

This is supported in Erlang and I use it a lot myself when hacking on
Rabbit but we are not yet making use of it from a release perspective.
One of the issues that you would run into (which is not necessarily
Erlang specific) is dealing with schema upgrades in mnesia, i.e. you
would have to migrate the database (which changed considerably between
1.4 and 1.5). I should imagine that as Rabbit matures more, we could
make more use of this feature.

Having said that, I know that Edwin is using OTP release handling with
Rabbit, whereas the official Rabbit release management is more OS
package manager centric, so he may be able to comment on this.

> 3) Can you elaborate more on the memory based flow throttling and what is
> the behavior of clients when they get the channel.flow command?

Have you read this article?

http://hopper.squarespace.com/blog/2008/11/9/flow-control-in-rabbitmq.html

"From a protocol perspective, when the broker decides that it is
running out of resources to buffer an imbalance, it sends a
channel.flow command out to every channel. This command contains a
flag to indicate to a client whether content bearing AMQP methods can
be sent or not. So if a client receives this command with the flag set
to false, then the client should suspend sending any further content
bearing methods (e.g. basic.publish), until such a time that the
broker notifies the client that it is safe to resume. The notification
of resumption is the opposite of the pause - the broker sends a
channel.flow command with the flag set to true."

HTH,

Ben



From eran.sandler at gmail.com  Fri Dec 19 10:51:45 2008
From: eran.sandler at gmail.com (Eran Sandler)
Date: Fri, 19 Dec 2008 12:51:45 +0200
Subject: [rabbitmq-discuss] RabbitMQ 1.5.0 released
In-Reply-To: <269388e30812182211u3f6ad5afl6b040d1e80bb0e3f@mail.gmail.com>
References: <494A3787.30700@lshift.net>
	<5f884b720812181906r56d056a6n31511e06e4323802@mail.gmail.com>
	<269388e30812182211u3f6ad5afl6b040d1e80bb0e3f@mail.gmail.com>
Message-ID: <5f884b720812190251w32f55d58wd96ccd76c329bc66@mail.gmail.com>

On Fri, Dec 19, 2008 at 8:11 AM, Ben Hood <0x6e6562 at gmail.com> wrote:

> > 2) What would be the right way of upgrading rabbitmq on a running server
> > without shutting it down? (I know erlang supports this feature but I
> failed
> > to find something about it in the documentation).
>
> This is supported in Erlang and I use it a lot myself when hacking on
> Rabbit but we are not yet making use of it from a release perspective.
> One of the issues that you would run into (which is not necessarily
> Erlang specific) is dealing with schema upgrades in mnesia, i.e. you
> would have to migrate the database (which changed considerably between
> 1.4 and 1.5). I should imagine that as Rabbit matures more, we could
> make more use of this feature.
>
> Having said that, I know that Edwin is using OTP release handling with
> Rabbit, whereas the official Rabbit release management is more OS
> package manager centric, so he may be able to comment on this.


So, what would be my course of upgrade in a running server? Stop rabbit,
upgrade and start it again and it should upgrade the mnesia-db?


>
>
> http://hopper.squarespace.com/blog/2008/11/9/flow-control-in-rabbitmq.html
>


>
> "From a protocol perspective, when the broker decides that it is
> running out of resources to buffer an imbalance, it sends a
> channel.flow command out to every channel. This command contains a
> flag to indicate to a client whether content bearing AMQP methods can
> be sent or not. So if a client receives this command with the flag set
> to false, then the client should suspend sending any further content
> bearing methods (e.g. basic.publish), until such a time that the
> broker notifies the client that it is safe to resume. The notification
> of resumption is the opposite of the pause - the broker sends a
> channel.flow command with the flag set to true."
>
>
Thanks for the info and the link. I'll read more about it.

Eran
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081219/2b291b0a/attachment.htm 

From 0x6e6562 at gmail.com  Fri Dec 19 11:38:57 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 19 Dec 2008 11:38:57 +0000
Subject: [rabbitmq-discuss] RabbitMQ 1.5.0 released
In-Reply-To: <5f884b720812190251w32f55d58wd96ccd76c329bc66@mail.gmail.com>
References: <494A3787.30700@lshift.net>
	<5f884b720812181906r56d056a6n31511e06e4323802@mail.gmail.com>
	<269388e30812182211u3f6ad5afl6b040d1e80bb0e3f@mail.gmail.com>
	<5f884b720812190251w32f55d58wd96ccd76c329bc66@mail.gmail.com>
Message-ID: <269388e30812190338r51720231r4f1dbcb5d2bc9d3a@mail.gmail.com>

Eran,

On Fri, Dec 19, 2008 at 10:51 AM, Eran Sandler <eran.sandler at gmail.com> wrote:
> So, what would be my course of upgrade in a running server? Stop rabbit,
> upgrade and start it again and it should upgrade the mnesia-db?

I think this is covered in the section in the release notes called "Upgrading".

HTH,

Ben



From aymerick at fotonauts.com  Fri Dec 19 15:17:17 2008
From: aymerick at fotonauts.com (=?ISO-8859-1?Q?Aymerick_J=E9hanne?=)
Date: Fri, 19 Dec 2008 16:17:17 +0100
Subject: [rabbitmq-discuss] "badarg ram_copies route binding" error since
	1.5.0
Message-ID: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>

Hi all,

I have just upgraded to rabbitmq 1.5.0 and I now have the following  
error while publishing an event.

I reseted rabbitmq, then uninstallled/reinstalled it, cleaning  
everything, but I still have this issue.

Seems like a mnesia issue, right ? If someone understand, then thanks  
for the help :-)


=ERROR REPORT==== 19-Dec-2008::15:03:04 ===
connection <0.248.0> (running), channel 1 - error:
{aborted,
     {badarg,
         [ram_copies,
          {route,
              {binding,
                  {resource,<<"/bibi">>,exchange,<<"artic.events">>},
                  <<"artic.*.events.#.owner.psp">>,
                  {resource,<<"/ 
bibi">>,queue,<<"user.psp.news.artics">>},
                  []},
              {binding,'$1','$3','$2','_'},
              100,
              <<>>,
              [],
              0,
              0},
          [{{route,{binding,'$1','$3','$2','_'},'_'},
            [{'==',
                 '$1',
                 {const,{resource,<<"/ 
bibi">>,exchange,<<"artic.events">>}}}],
            ['$_']}]]}}

=WARNING REPORT==== 19-Dec-2008::15:03:04 ===
Non-AMQP exit reason '{aborted,
                        {badarg,
                         [ram_copies,
                          {route,
                           {binding,
                            {resource,<<"/ 
bibi">>,exchange,<<"artic.events">>},
                            <<"artic.*.events.#.owner.psp">>,
                            {resource,
                             <<"/bibi">>,
                             queue,
                             <<"user.psp.news.artics">>},
                            []},
                           {binding,'$1','$3','$2','_'},
                           100,
                           <<>>,
                           [],
                           0,
                           0},
                          [{{route,{binding,'$1','$3','$2','_'},'_'},
                            [{'==',
                              '$1',
                              {const,
                               {resource,
                                <<"/bibi">>,
                                exchange,
                                <<"artic.events">>}}}],
                            ['$_']}]]}}'




From 0x6e6562 at gmail.com  Fri Dec 19 15:29:00 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 19 Dec 2008 15:29:00 +0000
Subject: [rabbitmq-discuss] "badarg ram_copies route binding" error
	since 1.5.0
In-Reply-To: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>
Message-ID: <269388e30812190729j256882b5ydfc6b5fd684eda66@mail.gmail.com>

Aymerick,

On Fri, Dec 19, 2008 at 3:17 PM, Aymerick J?hanne
<aymerick at fotonauts.com> wrote:
> I have just upgraded to rabbitmq 1.5.0 and I now have the following
> error while publishing an event.

I haven't seent this error before. Can you give us some more
information like OS, version of Erlang, how you installed Rabbit, and
maybe a cut down version of the code that causes this issue?

Ben



From aymerick at fotonauts.com  Fri Dec 19 16:13:27 2008
From: aymerick at fotonauts.com (=?ISO-8859-1?Q?Aymerick_J=E9hanne?=)
Date: Fri, 19 Dec 2008 17:13:27 +0100
Subject: [rabbitmq-discuss] "badarg ram_copies route binding" error
	since 1.5.0
In-Reply-To: <269388e30812190729j256882b5ydfc6b5fd684eda66@mail.gmail.com>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>
	<269388e30812190729j256882b5ydfc6b5fd684eda66@mail.gmail.com>
Message-ID: <F7516D82-A2FC-42FF-8BDC-BE88C1CFBB5B@fotonauts.com>

Hi Ben,

I am on Ubuntu 8.04.1, and I have installed rabbitmq through the apt  
repository as explained here: http://www.rabbitmq.com/debian.html#apt

[{release,"OTP  APN 181 01",
           "R11B",
           "5.5.5",
           [{kernel,"2.11.5","/usr/lib/erlang/lib/kernel-2.11.5"},
            {stdlib,"1.14.5","/usr/lib/erlang/lib/stdlib-1.14.5"},
            {sasl,"2.1.5.1","/usr/lib/erlang/lib/sasl-2.1.5.1"}],
           permanent}].

I don't think the code will help.

Actually, things work well when testing on my dev box (same OS /  
Erlang version) with a restricted data set. But the bug appears while  
testing with a larger data set on a staging server: I create hundreds  
of persistent queues with 2 or 4 bindings on each queue (but only a  
few exchanges), in a row, then I publish to an exchange ... and  
strangely the crash trace shows a queue that must not receive the  
published message, so it seems to be an issue while 'iterating' on  
bindings.

It's time for me to learn a bit more Erlang, I really need the  
queue.unbind feature of rabbitmq 1.5.0 :-)

I will too try to upgrade Erlang, as R11B seems to be a rather old  
version.

Aymerick

On Dec 19, 2008, at 4:29 PM, Ben Hood wrote:

> Aymerick,
>
> On Fri, Dec 19, 2008 at 3:17 PM, Aymerick J?hanne
> <aymerick at fotonauts.com> wrote:
>> I have just upgraded to rabbitmq 1.5.0 and I now have the following
>> error while publishing an event.
>
> I haven't seent this error before. Can you give us some more
> information like OS, version of Erlang, how you installed Rabbit, and
> maybe a cut down version of the code that causes this issue?
>
> Ben




From 0x6e6562 at gmail.com  Fri Dec 19 16:25:03 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 19 Dec 2008 16:25:03 +0000
Subject: [rabbitmq-discuss] "badarg ram_copies route binding" error
	since 1.5.0
In-Reply-To: <F7516D82-A2FC-42FF-8BDC-BE88C1CFBB5B@fotonauts.com>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>
	<269388e30812190729j256882b5ydfc6b5fd684eda66@mail.gmail.com>
	<F7516D82-A2FC-42FF-8BDC-BE88C1CFBB5B@fotonauts.com>
Message-ID: <269388e30812190825q57d58e2fl62be335b77bcffb8@mail.gmail.com>

Aymerick,

On Fri, Dec 19, 2008 at 4:13 PM, Aymerick J?hanne
<aymerick at fotonauts.com> wrote:
> I am on Ubuntu 8.04.1, and I have installed rabbitmq through the apt
> repository as explained here: http://www.rabbitmq.com/debian.html#apt
> [{release,"OTP  APN 181 01",
>           "R11B",
>           "5.5.5",
>           [{kernel,"2.11.5","/usr/lib/erlang/lib/kernel-2.11.5"},
>            {stdlib,"1.14.5","/usr/lib/erlang/lib/stdlib-1.14.5"},
>            {sasl,"2.1.5.1","/usr/lib/erlang/lib/sasl-2.1.5.1"}],
>           permanent}].
>
> I don't think the code will help.
>
> Actually, things work well when testing on my dev box (same OS /
> Erlang version) with a restricted data set. But the bug appears while
> testing with a larger data set on a staging server: I create hundreds
> of persistent queues with 2 or 4 bindings on each queue (but only a
> few exchanges), in a row, then I publish to an exchange ... and
> strangely the crash trace shows a queue that must not receive the
> published message, so it seems to be an issue while 'iterating' on
> bindings.
>
> It's time for me to learn a bit more Erlang, I really need the
> queue.unbind feature of rabbitmq 1.5.0 :-)
>
> I will too try to upgrade Erlang, as R11B seems to be a rather old
> version.

Interesting.

If you are running R11B-5 you may be running into the OTP-7025 issue
which was fixed in R12B-1.

However, I don't see how you could have this code because the mnesia
select statement that provokes this was not present in the 1.4.0 tree
and we patched this with a workaround before 1.5.0 was released. Hence
I think you may have a version of Rabbit that is post 1.4 and pre 1.5.

Is there any way this is at all possible (i.e. have you checked
anything out from hg)?

HTH,

Ben



From aymerick at fotonauts.com  Fri Dec 19 17:10:17 2008
From: aymerick at fotonauts.com (=?ISO-8859-1?Q?Aymerick_J=E9hanne?=)
Date: Fri, 19 Dec 2008 18:10:17 +0100
Subject: [rabbitmq-discuss] "badarg ram_copies route binding" error
	since 1.5.0
In-Reply-To: <269388e30812190825q57d58e2fl62be335b77bcffb8@mail.gmail.com>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>
	<269388e30812190729j256882b5ydfc6b5fd684eda66@mail.gmail.com>
	<F7516D82-A2FC-42FF-8BDC-BE88C1CFBB5B@fotonauts.com>
	<269388e30812190825q57d58e2fl62be335b77bcffb8@mail.gmail.com>
Message-ID: <A2C24711-5195-4FD2-9D39-DAF46E67DF35@fotonauts.com>

> Interesting.
>
> If you are running R11B-5 you may be running into the OTP-7025 issue
> which was fixed in R12B-1.
>
> However, I don't see how you could have this code because the mnesia
> select statement that provokes this was not present in the 1.4.0 tree
> and we patched this with a workaround before 1.5.0 was released. Hence
> I think you may have a version of Rabbit that is post 1.4 and pre 1.5.
>
> Is there any way this is at all possible (i.e. have you checked
> anything out from hg)?

Actually I was using 1.4.0 before trying 1.5.0.

I switched back to 1.4.0 for now, and I confirm I don't have this  
issue anymore.

And no, I didn't installed anything from hg, I only used the deb  
packages.

Aymerick



From 0x6e6562 at gmail.com  Fri Dec 19 17:28:05 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 19 Dec 2008 17:28:05 +0000
Subject: [rabbitmq-discuss] "badarg ram_copies route binding" error
	since 1.5.0
In-Reply-To: <A2C24711-5195-4FD2-9D39-DAF46E67DF35@fotonauts.com>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>
	<269388e30812190729j256882b5ydfc6b5fd684eda66@mail.gmail.com>
	<F7516D82-A2FC-42FF-8BDC-BE88C1CFBB5B@fotonauts.com>
	<269388e30812190825q57d58e2fl62be335b77bcffb8@mail.gmail.com>
	<A2C24711-5195-4FD2-9D39-DAF46E67DF35@fotonauts.com>
Message-ID: <269388e30812190928y52cbbcbbj765c2c0a407c5ca6@mail.gmail.com>

Aymerick,

On Fri, Dec 19, 2008 at 5:10 PM, Aymerick J?hanne
<aymerick at fotonauts.com> wrote:
> I switched back to 1.4.0 for now, and I confirm I don't have this
> issue anymore.
>
> And no, I didn't installed anything from hg, I only used the deb
> packages.

OK, I'll have a look into this to see if I can reproduce this under
the conditions that you were talking about.

It would be interesting to see if you got the same results with your
code on 1.5.0 using a later version of Erlang.

Ben



From tsuraan at gmail.com  Fri Dec 19 17:32:59 2008
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 19 Dec 2008 11:32:59 -0600
Subject: [rabbitmq-discuss] List (public) queues?
Message-ID: <84fb38e30812190932t5014f414wb50106aed2c68ce@mail.gmail.com>

Is there any way to get a list of all the (public, durable, etc)
queues in a given vhost in rabbit?



From matthias at lshift.net  Fri Dec 19 17:50:06 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 19 Dec 2008 17:50:06 +0000
Subject: [rabbitmq-discuss] List (public) queues?
In-Reply-To: <84fb38e30812190932t5014f414wb50106aed2c68ce@mail.gmail.com>
References: <84fb38e30812190932t5014f414wb50106aed2c68ce@mail.gmail.com>
Message-ID: <494BDECE.2000802@lshift.net>

Tsuraan,

tsuraan wrote:
> Is there any way to get a list of all the (public, durable, etc)
> queues in a given vhost in rabbit?

Does
   http://www.rabbitmq.com/admin-guide.html#list_queues
do what you want?


Matthias.



From matthias at lshift.net  Fri Dec 19 18:33:43 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 19 Dec 2008 18:33:43 +0000
Subject: [rabbitmq-discuss] "badarg ram_copies route binding"
 error	since 1.5.0
In-Reply-To: <A2C24711-5195-4FD2-9D39-DAF46E67DF35@fotonauts.com>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>	<269388e30812190729j256882b5ydfc6b5fd684eda66@mail.gmail.com>	<F7516D82-A2FC-42FF-8BDC-BE88C1CFBB5B@fotonauts.com>	<269388e30812190825q57d58e2fl62be335b77bcffb8@mail.gmail.com>
	<A2C24711-5195-4FD2-9D39-DAF46E67DF35@fotonauts.com>
Message-ID: <494BE907.10900@lshift.net>

Aymerick,

Aymerick J?hanne wrote:
> And no, I didn't installed anything from hg, I only used the deb  
> packages.

That's really strange. As Ben mentioned we encountered the error you 
reported during development a while ago and put a fix in place prior to 
the release. The tests of that bug fix definitely pass for me using 
R11B-5 and RabbitMQ 1.5.0.

So I'd really like to figure out what the problem is with your original 
setup, in case there is some other bug lurking in the code.

In an Erlang shell, please run:
   erlang:system_info(version).
   code:which(rabbit_exchange).
and report the results.

Then take the output from the last command - a path to the 
rabbit_exchange.beam file - and run
   shasum <path-to-file>


Regards,

Matthias.



From jarnold at sydrom.com  Fri Dec 19 20:01:52 2008
From: jarnold at sydrom.com (John Arnold)
Date: Fri, 19 Dec 2008 15:01:52 -0500
Subject: [rabbitmq-discuss] Rabbitmq 1.5 Mnesia warning
Message-ID: <845634110812191201h692eff5dx6ee48befa30cea15@mail.gmail.com>

I have just installed Rabbitmq 1.5.0 on Windows XP. It was a vanilla install
(no configuration changes) but uses erlang R12B (since that was already
there).

After testing Rabbitmq with a single produce and consume of a message, ie 12
bytes in and 12 bytes out, I got the following message on the log:

=WARNING REPORT==== 19-Dec-2008::14:06:18 ===
Mnesia('rabbit at XXXXXXXXX'): ** WARNING ** Mnesia is overloaded: {dump_log,

time_threshold}


Suggestions?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081219/7e98b6c1/attachment.htm 

From aymerick at fotonauts.com  Fri Dec 19 20:32:14 2008
From: aymerick at fotonauts.com (=?ISO-8859-1?Q?Aymerick_J=E9hanne?=)
Date: Fri, 19 Dec 2008 21:32:14 +0100
Subject: [rabbitmq-discuss] "badarg ram_copies route binding"
	error	since 1.5.0
In-Reply-To: <494BE907.10900@lshift.net>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>	<269388e30812190729j256882b5ydfc6b5fd684eda66@mail.gmail.com>	<F7516D82-A2FC-42FF-8BDC-BE88C1CFBB5B@fotonauts.com>	<269388e30812190825q57d58e2fl62be335b77bcffb8@mail.gmail.com>
	<A2C24711-5195-4FD2-9D39-DAF46E67DF35@fotonauts.com>
	<494BE907.10900@lshift.net>
Message-ID: <51E68DC0-EBA7-42DF-AE6E-B70A07D74BED@fotonauts.com>

Hi Matthias,

Here is the output:

Erlang (BEAM) emulator version 5.5.5 [source] [async-threads:0]  
[kernel-poll:false]

Eshell V5.5.5  (abort with ^G)
1> erlang:system_info(version).
"5.5.5"
2> code:which(rabbit_exchange).
"/usr/lib/erlang/lib/rabbitmq_server-1.5.0/ebin/rabbit_exchange.beam"
3>


Then:

$ shasum /usr/lib/erlang/lib/rabbitmq_server-1.5.0/ebin/ 
rabbit_exchange.beam
7075bb336092d94aa8a5a8efe19b7b35c0061a0e  /usr/lib/erlang/lib/ 
rabbitmq_server-1.5.0/ebin/rabbit_exchange.beam


I reproduced the same issue on my dev box (same OS / Erlang version  
and Rabbitmq 1.5.0), so I will try to do some more tests to figure out  
what happen.

Aymerick

On Dec 19, 2008, at 7:33 PM, Matthias Radestock wrote:

> Aymerick,
>
> Aymerick J?hanne wrote:
>> And no, I didn't installed anything from hg, I only used the deb   
>> packages.
>
> That's really strange. As Ben mentioned we encountered the error you  
> reported during development a while ago and put a fix in place prior  
> to the release. The tests of that bug fix definitely pass for me  
> using R11B-5 and RabbitMQ 1.5.0.
>
> So I'd really like to figure out what the problem is with your  
> original setup, in case there is some other bug lurking in the code.
>
> In an Erlang shell, please run:
>  erlang:system_info(version).
>  code:which(rabbit_exchange).
> and report the results.
>
> Then take the output from the last command - a path to the  
> rabbit_exchange.beam file - and run
>  shasum <path-to-file>
>
>
> Regards,
>
> Matthias.




From rabbitmq at tmm1.net  Fri Dec 19 20:35:13 2008
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Fri, 19 Dec 2008 12:35:13 -0800
Subject: [rabbitmq-discuss] Rabbitmq 1.5 Mnesia warning
In-Reply-To: <845634110812191201h692eff5dx6ee48befa30cea15@mail.gmail.com>
References: <845634110812191201h692eff5dx6ee48befa30cea15@mail.gmail.com>
Message-ID: <e1c05edd0812191235l3c01a880o95f8cec0da1e4b34@mail.gmail.com>

http://www.metabrew.com/article/a-million-user-comet-application-with-mochiweb-part-3/
references this issue and provides some vm options that might help:

$ erl -name router at minifeeds4.gs2 +K true +A 128 -setcookie
secretcookie -mnesia dump_log_write_threshold 50000 -mnesia
dc_dump_limit 40
erl> c(readfriends), c(subsmanager).
erl> subsmanager:first_run().
erl> subsmanager:start_link().
erl> subsmanager:add_subscriptions( readfriends:load("fakefriends.txt") ).

Note the additional mnesia parameters - these are to avoid the **
WARNING ** Mnesia is overloaded messages you would (probably)
otherwise see. Refer to my previous post: On bulk loading data into
Mnesia for alternative ways to load in lots of data
[http://www.metabrew.com/article/on-bulk-loading-data-into-mnesia/].
The best solution seems to be (as pointed out in the comments, thanks
Jacob!) to set those options. The Mnesia reference manual contains
many other settings under Configuration Parameters, and is worth a
look.

  Aman

On Fri, Dec 19, 2008 at 12:01 PM, John Arnold <jarnold at sydrom.com> wrote:
> I have just installed Rabbitmq 1.5.0 on Windows XP. It was a vanilla install
> (no configuration changes) but uses erlang R12B (since that was already
> there).
>
> After testing Rabbitmq with a single produce and consume of a message, ie 12
> bytes in and 12 bytes out, I got the following message on the log:
>
> =WARNING REPORT==== 19-Dec-2008::14:06:18 ===
> Mnesia('rabbit at XXXXXXXXX'): ** WARNING ** Mnesia is overloaded: {dump_log,
>
> time_threshold}
>
>
> Suggestions?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From tonyg at lshift.net  Fri Dec 19 21:47:29 2008
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sat, 20 Dec 2008 10:47:29 +1300
Subject: [rabbitmq-discuss] "badarg ram_copies route binding" error
 since 1.5.0
In-Reply-To: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>
Message-ID: <494C1671.3000408@lshift.net>

Hi Aymerick,

Aymerick J?hanne wrote:
> [... a log snippet ...]

Would it be possible for you to send us the full logs from a run where 
the problem manifests, please? My hope in asking this is that there are 
informative stanzas earlier in the output than the channel close error 
reports you've sent us.

Regards,
   Tony




From matthias at lshift.net  Fri Dec 19 22:30:51 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 19 Dec 2008 22:30:51 +0000
Subject: [rabbitmq-discuss] Rabbitmq 1.5 Mnesia warning
In-Reply-To: <e1c05edd0812191235l3c01a880o95f8cec0da1e4b34@mail.gmail.com>
References: <845634110812191201h692eff5dx6ee48befa30cea15@mail.gmail.com>
	<e1c05edd0812191235l3c01a880o95f8cec0da1e4b34@mail.gmail.com>
Message-ID: <494C209B.1070508@lshift.net>

Aman, John,

Aman Gupta wrote:
> http://www.metabrew.com/article/a-million-user-comet-application-with-mochiweb-part-3/
> references this issue and provides some vm options that might help:

We have never run into this issue with RabbitMQ. Rabbit doesn't do many 
mnesia writes during normal operation. You'd have to be 
creating/deleting lots of exchanges/queues/bindings for that to happen.

John, are you perhaps doing that? If you can send us the code to 
reproduce the problem that would be great. Also, what exact version of 
R12B are you running?


Regards,

Matthias.



From aymerick at fotonauts.com  Fri Dec 19 22:59:49 2008
From: aymerick at fotonauts.com (=?ISO-8859-1?Q?Aymerick_J=E9hanne?=)
Date: Fri, 19 Dec 2008 23:59:49 +0100
Subject: [rabbitmq-discuss] "badarg ram_copies route binding" error
	since 1.5.0
In-Reply-To: <494C1671.3000408@lshift.net>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>
	<494C1671.3000408@lshift.net>
Message-ID: <1C8AF825-7BC0-465B-8137-AB007E026894@fotonauts.com>

> Would it be possible for you to send us the full logs from a run  
> where the problem manifests, please? My hope in asking this is that  
> there are informative stanzas earlier in the output than the channel  
> close error reports you've sent us.
>
> Regards,
>  Tony

Hi Tony,

Better than that, I have attached a ruby script to reproduce the  
issue... and the associated log.

To be more precise:
1. First I launched "rabbitmq_issue.rb" script, but didn't reproduced  
the issue
2. So I launched "rabbitmq_issue_2.rb" (durable queues / exchange with  
a persistant message), and this time I reproduced the issue
=> The result is in "rabbitmq_issue_log.txt"

I will try tomorrow to upgrade Erlang (actually it takes hours to  
compile, and I'm tired).

Hope this helps,
Aymerick

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081219/25b6998e/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq_issue.rb
Type: text/x-ruby-script
Size: 817 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081219/25b6998e/attachment.bin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081219/25b6998e/attachment-0001.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq_issue_2.rb
Type: text/x-ruby-script
Size: 900 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081219/25b6998e/attachment-0001.bin 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081219/25b6998e/attachment-0002.htm 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: rabbitmq_issue_log.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081219/25b6998e/attachment.txt 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081219/25b6998e/attachment-0003.htm 

From matthias at lshift.net  Fri Dec 19 23:14:40 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 19 Dec 2008 23:14:40 +0000
Subject: [rabbitmq-discuss] "badarg ram_copies route binding"
 error	since 1.5.0
In-Reply-To: <1C8AF825-7BC0-465B-8137-AB007E026894@fotonauts.com>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>	<494C1671.3000408@lshift.net>
	<1C8AF825-7BC0-465B-8137-AB007E026894@fotonauts.com>
Message-ID: <494C2AE0.4090706@lshift.net>

Aymerick,

Aymerick J?hanne wrote:
> Better than that, I have attached a ruby script to reproduce the 
> issue... and the associated log.

Thanks. Very useful.

> To be more precise:
> 1. First I launched "rabbitmq_issue.rb" script, but didn't reproduced 
> the issue
> 2. So I launched "rabbitmq_issue_2.rb" (durable queues / exchange with a 
> persistant message), and this time I reproduced the issue
> => The result is in "rabbitmq_issue_log.txt"

The one difference that stands out between the two versions is that the 
type of exchange changes from 'fanout' to 'topic'. Do you encounter the 
problem with that change alone? Also, are there any errors in the 
rabbit-sasl.log?


Matthias.



From aymerick at fotonauts.com  Sat Dec 20 10:35:58 2008
From: aymerick at fotonauts.com (=?ISO-8859-1?Q?Aymerick_J=E9hanne?=)
Date: Sat, 20 Dec 2008 11:35:58 +0100
Subject: [rabbitmq-discuss] "badarg ram_copies route binding"
	error	since 1.5.0
In-Reply-To: <494C2AE0.4090706@lshift.net>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>	<494C1671.3000408@lshift.net>
	<1C8AF825-7BC0-465B-8137-AB007E026894@fotonauts.com>
	<494C2AE0.4090706@lshift.net>
Message-ID: <345DFDB2-5138-4327-B655-F33275C310DD@fotonauts.com>

> The one difference that stands out between the two versions is that  
> the type of exchange changes from 'fanout' to 'topic'. Do you  
> encounter the problem with that change alone? Also, are there any  
> errors in the rabbit-sasl.log?

I have nothing in rabbit-sasl.log.

Now look at the attached script, that creates 100 queues an bind them  
to a topic... it causes the issue. But:
- If I change the exchange from topic to fanout, there is no issue
- If I only setup 99 queues, there is no issue... it always appears  
with 100 queues and more... 100% reproductible, tried several times  
with 99 queues without any problem

Aymerick

-------------- next part --------------
A non-text attachment was scrubbed...
Name: rabbitmq_issue_6.rb
Type: text/x-ruby-script
Size: 830 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081220/7de653dc/attachment.bin 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: rabbitmq_issue_log_6.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081220/7de653dc/attachment.txt 

From 0x6e6562 at gmail.com  Sat Dec 20 21:05:08 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 20 Dec 2008 21:05:08 +0000
Subject: [rabbitmq-discuss] "badarg ram_copies route binding" error
	since 1.5.0
In-Reply-To: <345DFDB2-5138-4327-B655-F33275C310DD@fotonauts.com>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>
	<494C1671.3000408@lshift.net>
	<1C8AF825-7BC0-465B-8137-AB007E026894@fotonauts.com>
	<494C2AE0.4090706@lshift.net>
	<345DFDB2-5138-4327-B655-F33275C310DD@fotonauts.com>
Message-ID: <269388e30812201305g59a1b625wa7db934936abf86e@mail.gmail.com>

Aymerick,

On Sat, Dec 20, 2008 at 10:35 AM, Aymerick J?hanne
<aymerick at fotonauts.com> wrote:
> Now look at the attached script, that creates 100 queues an bind them to a
> topic... it causes the issue. But:
> - If I change the exchange from topic to fanout, there is no issue
> - If I only setup 99 queues, there is no issue... it always appears with 100
> queues and more... 100% reproductible, tried several times with 99 queues
> without any problem

Unfortunately I can concur.

I set up a fresh 8.04 Ubuntu and installed Rabbit 1.5.0 using apt-get.

Setting up 99 queues works fine but as soon as you create 100, you get
the ram_copies error.

And I have no solution yet either :-(

Ben



From matthias at lshift.net  Sun Dec 21 19:54:10 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Sun, 21 Dec 2008 19:54:10 +0000
Subject: [rabbitmq-discuss] "badarg ram_copies route binding" error
 since 1.5.0
In-Reply-To: <345DFDB2-5138-4327-B655-F33275C310DD@fotonauts.com>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>	<494C1671.3000408@lshift.net>	<1C8AF825-7BC0-465B-8137-AB007E026894@fotonauts.com>	<494C2AE0.4090706@lshift.net>
	<345DFDB2-5138-4327-B655-F33275C310DD@fotonauts.com>
Message-ID: <494E9EE2.6020603@lshift.net>

Aymerick,

Aymerick J?hanne wrote:
> Now look at the attached script, that creates 100 queues an bind them to 
> a topic... it causes the issue.

I've got a fix for this, which will be in the next release.

The problem is caused by a bug in Erlang/OTP that was fixed in R12B-1. 
So it only arises when

- running RabbitMQ 1.5.0
- on Erlang/OTP older than R12B-1
- using topic exchanges
- with 100 or more bindings

Hopefully that combination is sufficiently rare that not may people are 
affected by the bug.

Thanks for reporting this issue and helping us track down the cause.


Matthias.




From aymerick at fotonauts.com  Mon Dec 22 13:18:32 2008
From: aymerick at fotonauts.com (=?ISO-8859-1?Q?Aymerick_J=E9hanne?=)
Date: Mon, 22 Dec 2008 14:18:32 +0100
Subject: [rabbitmq-discuss] "badarg ram_copies route binding" error
	since 1.5.0
In-Reply-To: <494E9EE2.6020603@lshift.net>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>	<494C1671.3000408@lshift.net>	<1C8AF825-7BC0-465B-8137-AB007E026894@fotonauts.com>	<494C2AE0.4090706@lshift.net>
	<345DFDB2-5138-4327-B655-F33275C310DD@fotonauts.com>
	<494E9EE2.6020603@lshift.net>
Message-ID: <BD1E7BDC-7B87-42E3-81B2-A417527B1E4D@fotonauts.com>

> I've got a fix for this, which will be in the next release.
>
> The problem is caused by a bug in Erlang/OTP that was fixed in  
> R12B-1. So it only arises when
>
> - running RabbitMQ 1.5.0
> - on Erlang/OTP older than R12B-1
> - using topic exchanges
> - with 100 or more bindings
>
> Hopefully that combination is sufficiently rare that not may people  
> are affected by the bug.
>
> Thanks for reporting this issue and helping us track down the cause.

Your welcome :)

So I have 3 solutions:
- update Erlang
- install the mercurial's version of rabbitmq
- wait for next release :)

Aymerick



From 0x6e6562 at gmail.com  Mon Dec 22 16:00:18 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 22 Dec 2008 16:00:18 +0000
Subject: [rabbitmq-discuss] "badarg ram_copies route binding" error
	since 1.5.0
In-Reply-To: <BD1E7BDC-7B87-42E3-81B2-A417527B1E4D@fotonauts.com>
References: <1132CD39-0CF9-480D-AD72-21122DD9AF2B@fotonauts.com>
	<494C1671.3000408@lshift.net>
	<1C8AF825-7BC0-465B-8137-AB007E026894@fotonauts.com>
	<494C2AE0.4090706@lshift.net>
	<345DFDB2-5138-4327-B655-F33275C310DD@fotonauts.com>
	<494E9EE2.6020603@lshift.net>
	<BD1E7BDC-7B87-42E3-81B2-A417527B1E4D@fotonauts.com>
Message-ID: <269388e30812220800p637a99abl7097b5d62cee95ad@mail.gmail.com>

Aymerick,

On Mon, Dec 22, 2008 at 1:18 PM, Aymerick J?hanne
<aymerick at fotonauts.com> wrote:
> So I have 3 solutions:
> - update Erlang
> - install the mercurial's version of rabbitmq
> - wait for next release :)

This has just been qa'ed and merged into the mainline branch, so if
you want to stay with R11B-5, you can get the latest version from hg.

A new release will be made at some stage soon, we'd like to see if any
further compatibility issues with 1.5.0 arise.

Ben



From dougbarth at gmail.com  Mon Dec 22 19:21:51 2008
From: dougbarth at gmail.com (Doug Barth)
Date: Mon, 22 Dec 2008 11:21:51 -0800 (PST)
Subject: [rabbitmq-discuss] [New project] amqp-utils,
	CLI utilities for AMQP queues
Message-ID: <6b035c9a-a126-4d6e-a810-b517ddac91bd@a29g2000pra.googlegroups.com>

Hey all,

Alexis Richardson thought the project that I started might be of
interest to the list.

Our company (Interactive Mediums) is currently working on replacing
our current queue solution (ap4r) with RabbitMQ. The main drivers for
the change are reducing database connections, better stability, and
better utilization of our resources by publishing and subscribing to a
shared queue.

As part of that effort, I started writing some command line utilities
for interacting with the queue. I tools are based on the tmm1-amqp
library, with some changes that we implemented. We use the tools to
check the status and contents of the queues. We also intended to build
them out to support simple administrative tasks like draining a
queue's contents into a file for later enqueueing.

The project is still in it's infancy, but the code is up on Github
(http://github.com/dougbarth/amqp-utils). It also depends on my forked
version of the amqp library. I'm hoping to add a few more enhancements
and package it up as a gem for easier installation.

--
Doug Barth




From tsuraan at gmail.com  Mon Dec 22 21:02:53 2008
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 22 Dec 2008 15:02:53 -0600
Subject: [rabbitmq-discuss] List (public) queues?
In-Reply-To: <494BDECE.2000802@lshift.net>
References: <84fb38e30812190932t5014f414wb50106aed2c68ce@mail.gmail.com>
	<494BDECE.2000802@lshift.net>
Message-ID: <84fb38e30812221302r66779d03lf38360a6770ff5b3@mail.gmail.com>

> Does
>    http://www.rabbitmq.com/admin-guide.html#list_queues
> do what you want?

That would do it, if it still existed.  I'm using rabbit from hg tip,
and rabbitmqctl doesn't understand list_queues.  Is there any reason
that command seems to have disappeared?

rabbitmqctl --help gives:
Invalid command ["--help"]
Usage: rabbitmqctl [-n <node>] <command> [<arg> ...]

Available commands:

  stop      - stops the RabbitMQ application and halts the node
  stop_app  - stops the RabbitMQ application, leaving the node running
  start_app - starts the RabbitMQ application on an already-running node
  reset     - resets node to default configuration, deleting all data
  force_reset
  cluster <ClusterNode> ...
  status
  rotate_logs [Suffix]

  add_user        <UserName> <Password>
  delete_user     <UserName>
  change_password <UserName> <NewPassword>
  list_users

  add_vhost    <VHostPath>
  delete_vhost <VHostPath>
  list_vhosts

  map_user_vhost   <UserName> <VHostPath>
  unmap_user_vhost <UserName> <VHostPath>
  list_user_vhosts <UserName>
  list_vhost_users <VHostPath>
...



From matthias at lshift.net  Mon Dec 22 21:14:24 2008
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 22 Dec 2008 21:14:24 +0000
Subject: [rabbitmq-discuss] List (public) queues?
In-Reply-To: <84fb38e30812221302r66779d03lf38360a6770ff5b3@mail.gmail.com>
References: <84fb38e30812190932t5014f414wb50106aed2c68ce@mail.gmail.com>	<494BDECE.2000802@lshift.net>
	<84fb38e30812221302r66779d03lf38360a6770ff5b3@mail.gmail.com>
Message-ID: <49500330.7030502@lshift.net>

Tsuraan,

tsuraan wrote:
>> Does
>>    http://www.rabbitmq.com/admin-guide.html#list_queues
>> do what you want?
> 
> That would do it, if it still existed.  I'm using rabbit from hg tip,
> and rabbitmqctl doesn't understand list_queues.

You should never use the hg 'tip' since it can be some random branch. 
Use the head of the 'default' branch instead.


Matthias.



From cremes.devlist at mac.com  Sun Dec 28 21:57:48 2008
From: cremes.devlist at mac.com (Chuck Remes)
Date: Sun, 28 Dec 2008 15:57:48 -0600
Subject: [rabbitmq-discuss] [A] compiling java client lib fails on OSX
Message-ID: <6C6B5570-56E5-428B-BA26-EC1C0AFAD53E@mac.com>

I'm trying to learn my way around the java client libraries for  
rabbitmq. It's pretty handy to poke around a new system by modifying  
example programs to see how their behavior changes.

However, I had trouble compiling the java libraries. Whenever I ran  
'ant' it blew up on the third step (amqp-generate). I *could*  
successfully run the tests from the binary download of the client libs.

Here's a pastie with the output of the failed compilation attempt:

http://pastie.org/347962

The solution was actually pretty simple. Note that the pastie says:

Directory /Volumes/spiff/cremes/Downloads/rabbitmq-java-client-1.5.0/ 
build/gensrc/com/rabbitmq/client creation was not successful for an  
unknown reason

This is because in the source directory there is a file called BUILD  
with the build instructions inside. By default the OSX filesystem is  
case insensitive, so the BUILD file blocks the creation of the  
lowercase build directory.

I recommend the BUILD file be renamed to README or somesuch.

cr




From 0x6e6562 at gmail.com  Sun Dec 28 23:47:49 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 28 Dec 2008 23:47:49 +0000
Subject: [rabbitmq-discuss] [A] compiling java client lib fails on OSX
In-Reply-To: <6C6B5570-56E5-428B-BA26-EC1C0AFAD53E@mac.com>
References: <6C6B5570-56E5-428B-BA26-EC1C0AFAD53E@mac.com>
Message-ID: <269388e30812281547i714f3c79j1ee9be83543bc16b@mail.gmail.com>

Chuck,

On Sun, Dec 28, 2008 at 9:57 PM, Chuck Remes <cremes.devlist at mac.com> wrote:
> This is because in the source directory there is a file called BUILD
> with the build instructions inside. By default the OSX filesystem is
> case insensitive, so the BUILD file blocks the creation of the
> lowercase build directory.
>
> I recommend the BUILD file be renamed to README or somesuch.

Thanks for spotting this.

I guess this has slipped through until now because when you are
working of the pristine tree, the artifact is called BUILD.in, hence
there is no collision. Only when the download package is generated
does the BUILD.in get processed with the installation instructions to
become BUILD.

I'll file a bug to change this.

Ben



From cremes.devlist at mac.com  Mon Dec 29 14:04:21 2008
From: cremes.devlist at mac.com (Chuck Remes)
Date: Mon, 29 Dec 2008 08:04:21 -0600
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
Message-ID: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>

In my application I would like to stamp each message on the bus with a  
sequence number. Doing so allows me to replay events in order (amongst  
other benefits). Some services will be publishing latency-sensitive  
information.

Each service connecting to the broker will publish to a topic  
exchange. One to N other services may subscribe to the published data.  
I foresee a topic hierarchy like so:

out.topic1 (passive, durable)
out.topic2 (passive, non-durable)
out.topic3.subtopic1 (passive, non-durable)
out.topic3.subtopic2 (passive, durable)
etc.

These exchanges are named with dot notation for simplicity of parsing  
for regular expressions. I realize the exchange name doesn't need the  
dot notation whereas that is a requirement for routing keys.

All of my data is serialized as a JSON object prior to publishing. The  
object (hash) contains a key called :sequence which is set to 0 by the  
publisher. The sequencer service will subscribe to all out.# topics  
(with '#' as the routing key so it gets everything), read the content  
body as a Map, and set the map :sequence value to i++ where 'i' is a  
32-bit (or 64-bit) integer. It will then republish the JSON object to  
a new topic of the form "in.topicX" and pass through the original  
routing key. It's routing between, for example, out.topic1 and  
in.topic1 and adding a sequence number as a side effect.

I played around with the examples SimpleTopicPublisher and  
SimpleTopicConsumer as a basis for a new class. I was able to add a  
JSONReader and JSONWriter to the new java class I call Sequencer. It  
successfully performs the work as described in the prior paragraph.  
RIght now I statically declare the in & out exchanges, but I see how I  
could declare the "in" exchange based on the contents of the "out"  
exchange name received in the envelope.

I have a few outstanding questions that I'm hoping some more  
experienced folks can help answer.

1. This code will likely start before other services, so it will  
declare the exchanges and block on them while waiting for traffic. The  
topic Consumer/Producer examples all illustrate how to do this with a  
single exchange. How do I accomplish this task with multiple  
exchanges? Do I need a separate thread and channel for each exchange?

2. Is there a better way to accomplish this task? I've read some notes  
about future releases of rabbitmq allowing for "internal" clients that  
run inside the rabbitmq memory space. I think this is an ideal use of  
that capability. Am I right or barking up the wrong tree? And does  
that internal client need to be written in erlang or can it be java/c/ 
whatever?

3. Is there a way to make this more dynamic so I do not have to  
declare all the exchanges up-front in this sequencer code? Ideally  
this service could detect that new exchanges were declared by other  
services and automatically subscribe to them to do the sequence  
stamping and routing.

Thanks for any feedback.

cr




From preston at synergy-solutions.biz  Mon Dec 29 14:24:53 2008
From: preston at synergy-solutions.biz (Preston Marshall)
Date: Mon, 29 Dec 2008 08:24:53 -0600
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
Message-ID: <79ECC81C-CE27-49A6-A154-66FD511BA9FC@synergy-solutions.biz>

It sounds like you want something like EventMachine for Ruby, which I  
believe is based on Java's reactor pattern.  They have a Java  
implementation, but it is meant for JRuby so I don't know what your  
mileage will be on it.  It is here: http://rubyeventmachine.com/browser/trunk/java
On Dec 29, 2008, at 8:04 AM, Chuck Remes wrote:

> In my application I would like to stamp each message on the bus with a
> sequence number. Doing so allows me to replay events in order (amongst
> other benefits). Some services will be publishing latency-sensitive
> information.
>
> Each service connecting to the broker will publish to a topic
> exchange. One to N other services may subscribe to the published data.
> I foresee a topic hierarchy like so:
>
> out.topic1 (passive, durable)
> out.topic2 (passive, non-durable)
> out.topic3.subtopic1 (passive, non-durable)
> out.topic3.subtopic2 (passive, durable)
> etc.
>
> These exchanges are named with dot notation for simplicity of parsing
> for regular expressions. I realize the exchange name doesn't need the
> dot notation whereas that is a requirement for routing keys.
>
> All of my data is serialized as a JSON object prior to publishing. The
> object (hash) contains a key called :sequence which is set to 0 by the
> publisher. The sequencer service will subscribe to all out.# topics
> (with '#' as the routing key so it gets everything), read the content
> body as a Map, and set the map :sequence value to i++ where 'i' is a
> 32-bit (or 64-bit) integer. It will then republish the JSON object to
> a new topic of the form "in.topicX" and pass through the original
> routing key. It's routing between, for example, out.topic1 and
> in.topic1 and adding a sequence number as a side effect.
>
> I played around with the examples SimpleTopicPublisher and
> SimpleTopicConsumer as a basis for a new class. I was able to add a
> JSONReader and JSONWriter to the new java class I call Sequencer. It
> successfully performs the work as described in the prior paragraph.
> RIght now I statically declare the in & out exchanges, but I see how I
> could declare the "in" exchange based on the contents of the "out"
> exchange name received in the envelope.
>
> I have a few outstanding questions that I'm hoping some more
> experienced folks can help answer.
>
> 1. This code will likely start before other services, so it will
> declare the exchanges and block on them while waiting for traffic. The
> topic Consumer/Producer examples all illustrate how to do this with a
> single exchange. How do I accomplish this task with multiple
> exchanges? Do I need a separate thread and channel for each exchange?
>
> 2. Is there a better way to accomplish this task? I've read some notes
> about future releases of rabbitmq allowing for "internal" clients that
> run inside the rabbitmq memory space. I think this is an ideal use of
> that capability. Am I right or barking up the wrong tree? And does
> that internal client need to be written in erlang or can it be java/c/
> whatever?
>
> 3. Is there a way to make this more dynamic so I do not have to
> declare all the exchanges up-front in this sequencer code? Ideally
> this service could detect that new exchanges were declared by other
> services and automatically subscribe to them to do the sequence
> stamping and routing.
>
> Thanks for any feedback.
>
> cr
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2441 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081229/bafbbc3a/attachment.bin 

From Andrius.Norkaitis at oryo.lt  Mon Dec 29 15:00:26 2008
From: Andrius.Norkaitis at oryo.lt (Andrius Norkaitis)
Date: Mon, 29 Dec 2008 17:00:26 +0200
Subject: [rabbitmq-discuss] rabbitmqctl remotely posibble?
Message-ID: <!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAAD7N5XUCF9lJlsI8QMdC5t8BAAAAAA==@oryo.lt>

Does rabbitmqctl or .net client support remote server administration or is
it available only when connecting through terminal services and running
commands locally?

Thanks for any feedback.

 

Andrius

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20081229/982b97d5/attachment.htm 

From cctrieloff at redhat.com  Mon Dec 29 15:11:03 2008
From: cctrieloff at redhat.com (Carl Trieloff)
Date: Mon, 29 Dec 2008 10:11:03 -0500
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
Message-ID: <4958E887.6060307@redhat.com>


Qpid broker c++ already has this if you want to copy the way we do it. 
If you do
I can point you to the information.

Carl.


Chuck Remes wrote:
> In my application I would like to stamp each message on the bus with a  
> sequence number. Doing so allows me to replay events in order (amongst  
> other benefits). Some services will be publishing latency-sensitive  
> information.
>
> Each service connecting to the broker will publish to a topic  
> exchange. One to N other services may subscribe to the published data.  
> I foresee a topic hierarchy like so:
>
> out.topic1 (passive, durable)
> out.topic2 (passive, non-durable)
> out.topic3.subtopic1 (passive, non-durable)
> out.topic3.subtopic2 (passive, durable)
> etc.
>
> These exchanges are named with dot notation for simplicity of parsing  
> for regular expressions. I realize the exchange name doesn't need the  
> dot notation whereas that is a requirement for routing keys.
>
> All of my data is serialized as a JSON object prior to publishing. The  
> object (hash) contains a key called :sequence which is set to 0 by the  
> publisher. The sequencer service will subscribe to all out.# topics  
> (with '#' as the routing key so it gets everything), read the content  
> body as a Map, and set the map :sequence value to i++ where 'i' is a  
> 32-bit (or 64-bit) integer. It will then republish the JSON object to  
> a new topic of the form "in.topicX" and pass through the original  
> routing key. It's routing between, for example, out.topic1 and  
> in.topic1 and adding a sequence number as a side effect.
>
> I played around with the examples SimpleTopicPublisher and  
> SimpleTopicConsumer as a basis for a new class. I was able to add a  
> JSONReader and JSONWriter to the new java class I call Sequencer. It  
> successfully performs the work as described in the prior paragraph.  
> RIght now I statically declare the in & out exchanges, but I see how I  
> could declare the "in" exchange based on the contents of the "out"  
> exchange name received in the envelope.
>
> I have a few outstanding questions that I'm hoping some more  
> experienced folks can help answer.
>
> 1. This code will likely start before other services, so it will  
> declare the exchanges and block on them while waiting for traffic. The  
> topic Consumer/Producer examples all illustrate how to do this with a  
> single exchange. How do I accomplish this task with multiple  
> exchanges? Do I need a separate thread and channel for each exchange?
>
> 2. Is there a better way to accomplish this task? I've read some notes  
> about future releases of rabbitmq allowing for "internal" clients that  
> run inside the rabbitmq memory space. I think this is an ideal use of  
> that capability. Am I right or barking up the wrong tree? And does  
> that internal client need to be written in erlang or can it be java/c/ 
> whatever?
>
> 3. Is there a way to make this more dynamic so I do not have to  
> declare all the exchanges up-front in this sequencer code? Ideally  
> this service could detect that new exchanges were declared by other  
> services and automatically subscribe to them to do the sequence  
> stamping and routing.
>
> Thanks for any feedback.
>
> cr
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>   




From 0x6e6562 at gmail.com  Mon Dec 29 15:30:09 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 29 Dec 2008 15:30:09 +0000
Subject: [rabbitmq-discuss] [erlang-questions] cheap low-power boards
In-Reply-To: <4958D05A.2020209@diskware.net>
References: <33CFEAE2-CDB6-41BA-9AB6-ED48E38EDFA6@gmail.com>
	<269388e30812290342v1cc8aa01y8e9c16624a5d64a3@mail.gmail.com>
	<4958BD11.3020809@diskware.net>
	<269388e30812290459l48d38a41p8e3a6b69a3e66d47@mail.gmail.com>
	<4958D05A.2020209@diskware.net>
Message-ID: <269388e30812290730i1d8c1db6xb9dbb9dce49e92ef@mail.gmail.com>

Martin,

On Mon, Dec 29, 2008 at 1:27 PM, Martin Scholl <ms at diskware.net> wrote:
> Ben Hood wrote:
> [snip]
>> Obviously there are some standard benchmarks such as throughput and
>> latency, but these are generally used to compare different releases
>> against each other.
> I think, latency is more interesting than throughput. I am not really
> familiar with RabbitMQ and its distributed capabilities -- imho it would
> be particularly interesting to see how RabbitMQ scales on these kind of
> embedded stuff (comparing performance/watt with standard hardware).

Sure, but if I was really worried about latency, I don't know if would
go down the embedded route.

> Our results are quite promising:
>
>>
>> Defining what constitutes a benchmark is to an extent a subjective
>> task and hence will depend on what your use case is.
> I am interested in "green computing" and especially results of
> performance / watt ratios of real world scenarios. This is my motivation
> behind all this.

Maybe you could look at an application that does not constantly stress
the middleware - hence having something light weight would not cost
much when it's not doing anything and hence been *greener*. Having
said this, I think this may be a question of how long is a piece of
string -  for example, you could also compare bang for for energy buck
by running virtualized machines.

>> There are not same types of well defined independent benchmarks for
>> messaging systems as there are for SQL databases, for example.
>>
>> Having said this, our benchmarks are part of our standard client
>> library and you could easily install a Rabbit cluster on both sets of
>> hardware and run them yourself.
> Sadly, I do not have the money to buy a NSLU2 just to do the
> benchmarking - therefore I asked you if you have some results at hand.
> I can access e.g. an ATOM board and will happily benchmark and share the
> results, if you could tell me more details on the benchmarking
> methodology you propose.

This is getting a bit more rabbitty (maybe this question should
migrate to the rabbit discussion list? I've cross-posted just in
case).

In the Rabbit client library there is a utility called MulticastMain,
which, if you run it the --help flag, will tell you about all of the
configuration options you have to test latency and throughput from a
client perspective.

HTH,

Ben



From 0x6e6562 at gmail.com  Mon Dec 29 16:18:35 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 29 Dec 2008 16:18:35 +0000
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
Message-ID: <269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>

Hi Chuck,

On Mon, Dec 29, 2008 at 2:04 PM, Chuck Remes <cremes.devlist at mac.com> wrote:
> 1. This code will likely start before other services, so it will
> declare the exchanges and block on them while waiting for traffic. The
> topic Consumer/Producer examples all illustrate how to do this with a
> single exchange. How do I accomplish this task with multiple
> exchanges? Do I need a separate thread and channel for each exchange?

In general, one should avoid sharing channels across threads - for
background, see here:
http://hopper.squarespace.com/blog/2008/10/6/multithreading-amqp-clients.html

> 2. Is there a better way to accomplish this task?

I'm not quite sure I fully understand the actual use case. AFAICT you
want each message to have it's own sequence number that you want to
set yourself but have some kind of intermediary increment this number.
But because this is stateless operation (because you are just
incrementing a context free number), I must conclude that I don't
really understand what you are really trying to achieve (although I've
read through your post twice - maybe I'm just being stupid). Or is
that the publisher always sets this sequence number to 0 and you want
to stamp it with a globally incremented number?

BTW I don't whether the delivery tag that is sent in the header of the
message to the consumer is of any use to you for sequencing.

> I've read some notes
> about future releases of rabbitmq allowing for "internal" clients that
> run inside the rabbitmq memory space. I think this is an ideal use of
> that capability. Am I right or barking up the wrong tree? And does
> that internal client need to be written in erlang or can it be java/c/
> whatever?

The Erlang AMQP library can run transparently in the address space of
the broker. The interface is exactly the same as the client library
that uses TCP, the only difference is that the TCP stack and the
message serialization/deserialization is avoided. This basically takes
advantage of the fact that Erlang messages natively and hence you can
unobtrusively abstract out the AMQP wire format.

The types of things that this is useful for is processing messages in
a custom fashion without a network hop and you can stick to the AMQP
model rather than having to write something that is Rabbit specific.
This also takes advantage of the fact that Erlang processes are
isolated from each other and so it is ok to run "foreign code" in the
same memory space as the broker.

But I don't know if this solves your problem, because as I stated
above, I didn't really understand it.

> 3. Is there a way to make this more dynamic so I do not have to
> declare all the exchanges up-front in this sequencer code? Ideally
> this service could detect that new exchanges were declared by other
> services and automatically subscribe to them to do the sequence
> stamping and routing.

I don't know if the terminology is right here, because you generally
don't subscribe to an exchange, rather to a queue.

In general, it doesn't matter who declares an exchange - the operation
is idempotent - see this FAQ:
http://lettuce.squarespace.com/faq/exchanges/im-interested-in-creating-an-exchange-which-entity-should-de.html

HTH,

Ben



From 0x6e6562 at gmail.com  Mon Dec 29 16:32:28 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 29 Dec 2008 16:32:28 +0000
Subject: [rabbitmq-discuss] rabbitmqctl remotely posibble?
In-Reply-To: <!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAAD7N5XUCF9lJlsI8QMdC5t8BAAAAAA==@oryo.lt>
References: <!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAAD7N5XUCF9lJlsI8QMdC5t8BAAAAAA==@oryo.lt>
Message-ID: <269388e30812290832l7dc01606qcd1514021b1819dd@mail.gmail.com>

Andrius,

On Mon, Dec 29, 2008 at 3:00 PM, Andrius Norkaitis
<Andrius.Norkaitis at oryo.lt> wrote:
> Does rabbitmqctl or .net client support remote server administration or is
> it available only when connecting through terminal services and running
> commands locally?

The rabbitmqctl script is a wrapper that starts an Erlang instance to
speak to a Rabbit instance that is running in a different VM, so by
default, it is remoting out of the box, albeit most people run it on
it the same machine as the server is running, so you don't notice
intra-VM communication. To get this to work over a real network, it is
a case of setting the correct cookies on both ends so that each VM is
friends with each other.

The .NET client OTOH is just a plain jane AMQP wire client, so it can
only do what AMQP can do.

Furthermore, there are many threads on this list that surround
(remote) management - there might be something of interest to you
there.

HTH,

Ben



From 0x6e6562 at gmail.com  Mon Dec 29 16:38:10 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 29 Dec 2008 16:38:10 +0000
Subject: [rabbitmq-discuss] [erlang-questions] cheap low-power boards
In-Reply-To: <4958F3FA.4000403@diskware.net>
References: <33CFEAE2-CDB6-41BA-9AB6-ED48E38EDFA6@gmail.com>
	<269388e30812290342v1cc8aa01y8e9c16624a5d64a3@mail.gmail.com>
	<4958BD11.3020809@diskware.net>
	<269388e30812290459l48d38a41p8e3a6b69a3e66d47@mail.gmail.com>
	<4958D05A.2020209@diskware.net>
	<269388e30812290730i1d8c1db6xb9dbb9dce49e92ef@mail.gmail.com>
	<4958F3FA.4000403@diskware.net>
Message-ID: <269388e30812290838t4a988a8bx17c896e599a75c0@mail.gmail.com>

Martin,

On Mon, Dec 29, 2008 at 3:59 PM, Martin Scholl <ms at diskware.net> wrote:
> [I am not an eco activist and I don't want to evangelize, and no, I am
> not paid by Intel for doing this:]

Sure, I didn't take you as such :-)

> For the stuff we have tested, I can say: there are not many applications
> which definitely demand a non-atom processor. I am clearly not an expert
> in all things RabbitMq. I guess, RabbitMq's performance is dominated by
> the network technology used and not the hosts' cpus. Therefore, RabbitMq
> is a candidate for atom-based systems.

Yes, maybe, but I think that disk IO may also play a part (when
journalling messages, for example).

>> In the Rabbit client library there is a utility called MulticastMain,
>> which, if you run it the --help flag, will tell you about all of the
>> configuration options you have to test latency and throughput from a
>> client perspective.
> Ok, will post some numbers soon.

Cool!

Ben



From cremes.devlist at mac.com  Mon Dec 29 17:26:18 2008
From: cremes.devlist at mac.com (Chuck Remes)
Date: Mon, 29 Dec 2008 11:26:18 -0600
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <4958E887.6060307@redhat.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<4958E887.6060307@redhat.com>
Message-ID: <069A7954-793E-4F19-9170-874BFED65142@mac.com>


On Dec 29, 2008, at 9:11 AM, Carl Trieloff wrote:

>
> Qpid broker c++ already has this if you want to copy the way we do  
> it. If you do
> I can point you to the information.
>
> Carl.

Yes, please point me to it. Thanks!

cr




From cremes.devlist at mac.com  Mon Dec 29 17:43:16 2008
From: cremes.devlist at mac.com (Chuck Remes)
Date: Mon, 29 Dec 2008 11:43:16 -0600
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
Message-ID: <0626524F-5125-4060-811A-78AC4497DF3A@mac.com>


On Dec 29, 2008, at 10:18 AM, Ben Hood wrote:

>> 2. Is there a better way to accomplish this task?
>
> I'm not quite sure I fully understand the actual use case. AFAICT you
> want each message to have it's own sequence number that you want to
> set yourself but have some kind of intermediary increment this number.
> But because this is stateless operation (because you are just
> incrementing a context free number), I must conclude that I don't
> really understand what you are really trying to achieve (although I've
> read through your post twice - maybe I'm just being stupid). Or is
> that the publisher always sets this sequence number to 0 and you want
> to stamp it with a globally incremented number?

Sorry it was still unclear; I rewrote the email twice before hitting  
the send button. :)

Your last sentence quoted above gets it exactly. Each publisher will  
set the sequence number to 0 so that the republisher/sequencer service  
can add the global number stamp to it. I guess the publishers could  
also set it to nil; the initial value is irrelevant since the  
Sequencer will overwrite it.

The use case is to stamp a global order on all messages through the  
broker for the purposes of replay, debugging and async logging. I  
realize that during normal operation the services will be publishing  
messages in an arbitrary order; it doesn't matter to me. I need to  
recreate that arbitrary order *exactly* for a replay.

Think of the sequencer as the software equivalent of a hardware bus  
clock. Alternately, think of the sequencer as the equivalent of adding  
an identity column to a database table (this column contains a  
monotonically increasing integer assigned by the server).

> BTW I don't whether the delivery tag that is sent in the header of the
> message to the consumer is of any use to you for sequencing.

I don't plan to use the delivery tag at all. When I republish, I need  
to pass through the routing key from the original message's header.

>> I've read some notes
>> about future releases of rabbitmq allowing for "internal" clients  
>> that
>> run inside the rabbitmq memory space. I think this is an ideal use of
>> that capability. Am I right or barking up the wrong tree? And does
>> that internal client need to be written in erlang or can it be java/ 
>> c/
>> whatever?
>
> The Erlang AMQP library can run transparently in the address space of
> the broker. The interface is exactly the same as the client library
> that uses TCP, the only difference is that the TCP stack and the
> message serialization/deserialization is avoided. This basically takes
> advantage of the fact that Erlang messages natively and hence you can
> unobtrusively abstract out the AMQP wire format.
>
> The types of things that this is useful for is processing messages in
> a custom fashion without a network hop and you can stick to the AMQP
> model rather than having to write something that is Rabbit specific.
> This also takes advantage of the fact that Erlang processes are
> isolated from each other and so it is ok to run "foreign code" in the
> same memory space as the broker.
>
> But I don't know if this solves your problem, because as I stated
> above, I didn't really understand it.

I think this does solve the issue. I don't know Erlang yet so I'll  
probably keep the Sequencer as an external Java client for the short- 
term, but it's nice to know I can get a performance win with a rewrite  
in Erlang. Avoiding the TCP overhead, even if it is short circuited on  
a localhost, is a good thing.

>> 3. Is there a way to make this more dynamic so I do not have to
>> declare all the exchanges up-front in this sequencer code? Ideally
>> this service could detect that new exchanges were declared by other
>> services and automatically subscribe to them to do the sequence
>> stamping and routing.
>
> I don't know if the terminology is right here, because you generally
> don't subscribe to an exchange, rather to a queue.

You are right. I was confusing the terminology. Let me try again.

As other services declare exchanges and publish to them, I would like  
my Sequencer to dynamically detect the existence of a new Exchange so  
it can create a queue, bind the new queue to the Exchange and receive  
messages from it for processing and republishing.

cr




From cremes.devlist at mac.com  Mon Dec 29 17:51:18 2008
From: cremes.devlist at mac.com (Chuck Remes)
Date: Mon, 29 Dec 2008 11:51:18 -0600
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
	<0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
Message-ID: <A2AE2DA0-D34B-4923-930A-BC4D938878EC@mac.com>


On Dec 29, 2008, at 11:43 AM, Chuck Remes wrote:

>
> On Dec 29, 2008, at 10:18 AM, Ben Hood wrote:
>>> 3. Is there a way to make this more dynamic so I do not have to
>>> declare all the exchanges up-front in this sequencer code? Ideally
>>> this service could detect that new exchanges were declared by other
>>> services and automatically subscribe to them to do the sequence
>>> stamping and routing.
>>
>> I don't know if the terminology is right here, because you generally
>> don't subscribe to an exchange, rather to a queue.
>
> You are right. I was confusing the terminology. Let me try again.
>
> As other services declare exchanges and publish to them, I would like
> my Sequencer to dynamically detect the existence of a new Exchange so
> it can create a queue, bind the new queue to the Exchange and receive
> messages from it for processing and republishing.


Let me provide more reasoning for why I would like to do this  
dynamically.

PublisherA may create a durable topic Exchange called out.topic1.  
PublisherB may create a non-durable Exchange called out.topic2.

The Sequencer has to republish all messages from both Exchanges to two  
new Exchanges that share the same semantics (durable vs non-durable,  
immediate, mandatory, etc). The Sequencer would need to declare a new  
durable Exchange called in.topic1 for republishing those messages.  
Likewise, it would declare a non-durable Exchange for publishing to  
in.topic2. (I hope I am not mixing up my durable/immediate/mandatory  
terminology with Exchanges when they apply to Queues or something.)

A naive way of creating the Sequencer would be to hardcode all of  
these things but that could rapidly become a maintenance nightmare as  
the distributed application grows.

cr




From alexis.richardson at cohesiveft.com  Mon Dec 29 18:17:39 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Mon, 29 Dec 2008 18:17:39 +0000
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <A2AE2DA0-D34B-4923-930A-BC4D938878EC@mac.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
	<0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
	<A2AE2DA0-D34B-4923-930A-BC4D938878EC@mac.com>
Message-ID: <167204d20812291017j22807ec3u84cc3fe52179a81f@mail.gmail.com>

Chuck

Where do you want to set the sequence number?

- at the Publisher(s)
- at the Exchanges(s)
- at the Queue(s)
- at your Sequencer(s)

?

alexis



On Mon, Dec 29, 2008 at 5:51 PM, Chuck Remes <cremes.devlist at mac.com> wrote:
>
> On Dec 29, 2008, at 11:43 AM, Chuck Remes wrote:
>
>>
>> On Dec 29, 2008, at 10:18 AM, Ben Hood wrote:
>>>> 3. Is there a way to make this more dynamic so I do not have to
>>>> declare all the exchanges up-front in this sequencer code? Ideally
>>>> this service could detect that new exchanges were declared by other
>>>> services and automatically subscribe to them to do the sequence
>>>> stamping and routing.
>>>
>>> I don't know if the terminology is right here, because you generally
>>> don't subscribe to an exchange, rather to a queue.
>>
>> You are right. I was confusing the terminology. Let me try again.
>>
>> As other services declare exchanges and publish to them, I would like
>> my Sequencer to dynamically detect the existence of a new Exchange so
>> it can create a queue, bind the new queue to the Exchange and receive
>> messages from it for processing and republishing.
>
>
> Let me provide more reasoning for why I would like to do this
> dynamically.
>
> PublisherA may create a durable topic Exchange called out.topic1.
> PublisherB may create a non-durable Exchange called out.topic2.
>
> The Sequencer has to republish all messages from both Exchanges to two
> new Exchanges that share the same semantics (durable vs non-durable,
> immediate, mandatory, etc). The Sequencer would need to declare a new
> durable Exchange called in.topic1 for republishing those messages.
> Likewise, it would declare a non-durable Exchange for publishing to
> in.topic2. (I hope I am not mixing up my durable/immediate/mandatory
> terminology with Exchanges when they apply to Queues or something.)
>
> A naive way of creating the Sequencer would be to hardcode all of
> these things but that could rapidly become a maintenance nightmare as
> the distributed application grows.
>
> cr
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From 0x6e6562 at gmail.com  Mon Dec 29 18:29:51 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 29 Dec 2008 18:29:51 +0000
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
	<0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
Message-ID: <269388e30812291029u30c2b4e6oa4c0a2686b315118@mail.gmail.com>

Chuck,

On Mon, Dec 29, 2008 at 5:43 PM, Chuck Remes <cremes.devlist at mac.com> wrote:
> Your last sentence quoted above gets it exactly. Each publisher will
> set the sequence number to 0 so that the republisher/sequencer service
> can add the global number stamp to it. I guess the publishers could
> also set it to nil; the initial value is irrelevant since the
> Sequencer will overwrite it.

Fair point. It need not be set until it passes through the broker.
FWIW there are some standard header properties that could be misused
for this purpose, e.g. the message_id field.

> The use case is to stamp a global order on all messages through the
> broker for the purposes of replay, debugging and async logging. I
> realize that during normal operation the services will be publishing
> messages in an arbitrary order; it doesn't matter to me. I need to
> recreate that arbitrary order *exactly* for a replay.

What is the scope of the stamp? Is it globally monotonic

a) accross the entire Rabbit cluster
b) within a single Rabbit node
c) within a single AMQP channel
d) just through a particular queue

?

Obviously, as the scope widens the throughput will become more serial.

And the last option is a giveaway - at the queue level you get the
ordering *for free*.

> Think of the sequencer as the software equivalent of a hardware bus
> clock. Alternately, think of the sequencer as the equivalent of adding
> an identity column to a database table (this column contains a
> monotonically increasing integer assigned by the server).

Strict ingress ordering is going to cost more than global identity,
which could be achieved by a guid, for example.

A timestamp would be cheaper, but than would not be strictly ordered,
just asymptotically.

> I think this does solve the issue. I don't know Erlang yet so I'll
> probably keep the Sequencer as an external Java client for the short-
> term, but it's nice to know I can get a performance win with a rewrite
> in Erlang. Avoiding the TCP overhead, even if it is short circuited on
> a localhost, is a good thing.

What would be more efficient would be a custom exchange implementation
that stamps each message as it passes through, because you would avoid
the delivery-redelivery overhead. This would also mean less moving
parts.

In contrast to the Erlang AMQP client, this would involve some coding
in the server.


> As other services declare exchanges and publish to them, I would like
> my Sequencer to dynamically detect the existence of a new Exchange so
> it can create a queue, bind the new queue to the Exchange and receive
> messages from it for processing and republishing.

ATM there is no notification facility present in Rabbit to tell
somebody that an exchange has been created. One could extend Rabbit to
do this (which wouldn't be rocket science) or you could also do this
on the application level, i.e. maintain a notification queue that the
sequencer listens on, and have whoever creates a new exchange also
post to this queue.

HTH,

Ben



From 0x6e6562 at gmail.com  Mon Dec 29 18:37:08 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 29 Dec 2008 18:37:08 +0000
Subject: [rabbitmq-discuss] rabbitmqctl remotely posibble?
In-Reply-To: <269388e30812290832l7dc01606qcd1514021b1819dd@mail.gmail.com>
References: <!&!AAAAAAAAAAAYAAAAAAAAAKmCSsECxmlLkxuEpydKKTLCgAAAEAAAAD7N5XUCF9lJlsI8QMdC5t8BAAAAAA==@oryo.lt>
	<269388e30812290832l7dc01606qcd1514021b1819dd@mail.gmail.com>
Message-ID: <269388e30812291037p18783b0cra0fedbee46d8dcce@mail.gmail.com>

A learned colleague points out the following error in this post:

On Mon, Dec 29, 2008 at 4:32 PM, Ben Hood <0x6e6562 at gmail.com> wrote:

> The rabbitmqctl script is a wrapper that starts an Erlang instance to
> speak to a Rabbit instance that is running in a different VM, so by
> default, it is remoting out of the box, albeit most people run it on
> it the same machine as the server is running, so you don't notice
> intra-VM communication.

"Intra-VM would be comms within one VM; whereas Inter-VM would be
between two VMs, which may or may not be on one machine."

I was referring to the latter.

Ben



From cremes.devlist at mac.com  Mon Dec 29 18:56:21 2008
From: cremes.devlist at mac.com (Chuck Remes)
Date: Mon, 29 Dec 2008 12:56:21 -0600
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <167204d20812291017j22807ec3u84cc3fe52179a81f@mail.gmail.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
	<0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
	<A2AE2DA0-D34B-4923-930A-BC4D938878EC@mac.com>
	<167204d20812291017j22807ec3u84cc3fe52179a81f@mail.gmail.com>
Message-ID: <8F86E4AA-E1A7-476D-BC39-C6B9642F2602@mac.com>

I want to set the sequence number in the single Sequencer.

cr

On Dec 29, 2008, at 12:17 PM, Alexis Richardson wrote:

> Chuck
>
> Where do you want to set the sequence number?
>
> - at the Publisher(s)
> - at the Exchanges(s)
> - at the Queue(s)
> - at your Sequencer(s)
>
> ?
>
> alexis
>
>
>
> On Mon, Dec 29, 2008 at 5:51 PM, Chuck Remes  
> <cremes.devlist at mac.com> wrote:
>>
>> On Dec 29, 2008, at 11:43 AM, Chuck Remes wrote:
>>
>>>
>>> On Dec 29, 2008, at 10:18 AM, Ben Hood wrote:
>>>>> 3. Is there a way to make this more dynamic so I do not have to
>>>>> declare all the exchanges up-front in this sequencer code? Ideally
>>>>> this service could detect that new exchanges were declared by  
>>>>> other
>>>>> services and automatically subscribe to them to do the sequence
>>>>> stamping and routing.
>>>>
>>>> I don't know if the terminology is right here, because you  
>>>> generally
>>>> don't subscribe to an exchange, rather to a queue.
>>>
>>> You are right. I was confusing the terminology. Let me try again.
>>>
>>> As other services declare exchanges and publish to them, I would  
>>> like
>>> my Sequencer to dynamically detect the existence of a new Exchange  
>>> so
>>> it can create a queue, bind the new queue to the Exchange and  
>>> receive
>>> messages from it for processing and republishing.
>>
>>
>> Let me provide more reasoning for why I would like to do this
>> dynamically.
>>
>> PublisherA may create a durable topic Exchange called out.topic1.
>> PublisherB may create a non-durable Exchange called out.topic2.
>>
>> The Sequencer has to republish all messages from both Exchanges to  
>> two
>> new Exchanges that share the same semantics (durable vs non-durable,
>> immediate, mandatory, etc). The Sequencer would need to declare a new
>> durable Exchange called in.topic1 for republishing those messages.
>> Likewise, it would declare a non-durable Exchange for publishing to
>> in.topic2. (I hope I am not mixing up my durable/immediate/mandatory
>> terminology with Exchanges when they apply to Queues or something.)
>>
>> A naive way of creating the Sequencer would be to hardcode all of
>> these things but that could rapidly become a maintenance nightmare as
>> the distributed application grows.
>>
>> cr
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>




From alexis.richardson at cohesiveft.com  Mon Dec 29 19:08:04 2008
From: alexis.richardson at cohesiveft.com (Alexis Richardson)
Date: Mon, 29 Dec 2008 19:08:04 +0000
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <8F86E4AA-E1A7-476D-BC39-C6B9642F2602@mac.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
	<0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
	<A2AE2DA0-D34B-4923-930A-BC4D938878EC@mac.com>
	<167204d20812291017j22807ec3u84cc3fe52179a81f@mail.gmail.com>
	<8F86E4AA-E1A7-476D-BC39-C6B9642F2602@mac.com>
Message-ID: <167204d20812291108l4507fc4as11963ef3090e0109@mail.gmail.com>

For many replay scenarios, you could set the order using a dictionary
ordering <s,n> with more than one option for s.  I.e, you could have
>1 sequencer indexed by s.  Or, you could let s index queues or
exchanges which would obviate the need for your implicit relay.

Otherwise it looks like you want globally serial ordering.  Is that the case?

a

On Mon, Dec 29, 2008 at 6:56 PM, Chuck Remes <cremes.devlist at mac.com> wrote:
> I want to set the sequence number in the single Sequencer.
>
> cr
>
> On Dec 29, 2008, at 12:17 PM, Alexis Richardson wrote:
>
>> Chuck
>>
>> Where do you want to set the sequence number?
>>
>> - at the Publisher(s)
>> - at the Exchanges(s)
>> - at the Queue(s)
>> - at your Sequencer(s)
>>
>> ?
>>
>> alexis
>>
>>
>>
>> On Mon, Dec 29, 2008 at 5:51 PM, Chuck Remes <cremes.devlist at mac.com>
>> wrote:
>>>
>>> On Dec 29, 2008, at 11:43 AM, Chuck Remes wrote:
>>>
>>>>
>>>> On Dec 29, 2008, at 10:18 AM, Ben Hood wrote:
>>>>>>
>>>>>> 3. Is there a way to make this more dynamic so I do not have to
>>>>>> declare all the exchanges up-front in this sequencer code? Ideally
>>>>>> this service could detect that new exchanges were declared by other
>>>>>> services and automatically subscribe to them to do the sequence
>>>>>> stamping and routing.
>>>>>
>>>>> I don't know if the terminology is right here, because you generally
>>>>> don't subscribe to an exchange, rather to a queue.
>>>>
>>>> You are right. I was confusing the terminology. Let me try again.
>>>>
>>>> As other services declare exchanges and publish to them, I would like
>>>> my Sequencer to dynamically detect the existence of a new Exchange so
>>>> it can create a queue, bind the new queue to the Exchange and receive
>>>> messages from it for processing and republishing.
>>>
>>>
>>> Let me provide more reasoning for why I would like to do this
>>> dynamically.
>>>
>>> PublisherA may create a durable topic Exchange called out.topic1.
>>> PublisherB may create a non-durable Exchange called out.topic2.
>>>
>>> The Sequencer has to republish all messages from both Exchanges to two
>>> new Exchanges that share the same semantics (durable vs non-durable,
>>> immediate, mandatory, etc). The Sequencer would need to declare a new
>>> durable Exchange called in.topic1 for republishing those messages.
>>> Likewise, it would declare a non-durable Exchange for publishing to
>>> in.topic2. (I hope I am not mixing up my durable/immediate/mandatory
>>> terminology with Exchanges when they apply to Queues or something.)
>>>
>>> A naive way of creating the Sequencer would be to hardcode all of
>>> these things but that could rapidly become a maintenance nightmare as
>>> the distributed application grows.
>>>
>>> cr
>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>
>



From cremes.devlist at mac.com  Mon Dec 29 22:09:24 2008
From: cremes.devlist at mac.com (Chuck Remes)
Date: Mon, 29 Dec 2008 16:09:24 -0600
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <269388e30812291029u30c2b4e6oa4c0a2686b315118@mail.gmail.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
	<0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
	<269388e30812291029u30c2b4e6oa4c0a2686b315118@mail.gmail.com>
Message-ID: <A9D33052-C09F-458A-A4C1-3C75AB5CD69A@mac.com>


On Dec 29, 2008, at 12:29 PM, Ben Hood wrote:

> Chuck,
>
> On Mon, Dec 29, 2008 at 5:43 PM, Chuck Remes  
> <cremes.devlist at mac.com> wrote:
>> Your last sentence quoted above gets it exactly. Each publisher will
>> set the sequence number to 0 so that the republisher/sequencer  
>> service
>> can add the global number stamp to it. I guess the publishers could
>> also set it to nil; the initial value is irrelevant since the
>> Sequencer will overwrite it.
>
> Fair point. It need not be set until it passes through the broker.
> FWIW there are some standard header properties that could be misused
> for this purpose, e.g. the message_id field.

I would never dream of misusing a header field! :)

>> The use case is to stamp a global order on all messages through the
>> broker for the purposes of replay, debugging and async logging. I
>> realize that during normal operation the services will be publishing
>> messages in an arbitrary order; it doesn't matter to me. I need to
>> recreate that arbitrary order *exactly* for a replay.
>
> What is the scope of the stamp? Is it globally monotonic
>
> a) accross the entire Rabbit cluster
> b) within a single Rabbit node
> c) within a single AMQP channel
> d) just through a particular queue
>
> ?
>
> Obviously, as the scope widens the throughput will become more serial.

I need to order the messages for the entire distributed application,  
so in this case I believe that means (a) and (b). I haven't really  
given much thought to the clustered case. Any rules of thumb when  
designing for a cluster other than "share nothing?"


>> Think of the sequencer as the software equivalent of a hardware bus
>> clock. Alternately, think of the sequencer as the equivalent of  
>> adding
>> an identity column to a database table (this column contains a
>> monotonically increasing integer assigned by the server).
>
> Strict ingress ordering is going to cost more than global identity,
> which could be achieved by a guid, for example.
>
> A timestamp would be cheaper, but than would not be strictly ordered,
> just asymptotically.

Yes, this is strict ingress ordering. If it were just stamping it with  
a GUID I wouldn't have bothered you fine folks with my question.

>> I think this does solve the issue. I don't know Erlang yet so I'll
>> probably keep the Sequencer as an external Java client for the short-
>> term, but it's nice to know I can get a performance win with a  
>> rewrite
>> in Erlang. Avoiding the TCP overhead, even if it is short circuited  
>> on
>> a localhost, is a good thing.
>
> What would be more efficient would be a custom exchange implementation
> that stamps each message as it passes through, because you would avoid
> the delivery-redelivery overhead. This would also mean less moving
> parts.
>
> In contrast to the Erlang AMQP client, this would involve some coding
> in the server.

This is the best suggestion yet. I'll start with a Java client and as  
we require additional performance I'll see about contracting this out  
via LShift. While I'd love to write it myself, I long ago concluded  
that it makes more sense to farm this kind of activity out to the real  
experts.


>> As other services declare exchanges and publish to them, I would like
>> my Sequencer to dynamically detect the existence of a new Exchange so
>> it can create a queue, bind the new queue to the Exchange and receive
>> messages from it for processing and republishing.
>
> ATM there is no notification facility present in Rabbit to tell
> somebody that an exchange has been created. One could extend Rabbit to
> do this (which wouldn't be rocket science) or you could also do this
> on the application level, i.e. maintain a notification queue that the
> sequencer listens on, and have whoever creates a new exchange also
> post to this queue.

Excellent suggestion; I'll do this at the application level. Thank you!

cr




From 0x6e6562 at gmail.com  Mon Dec 29 23:44:30 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 29 Dec 2008 23:44:30 +0000
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <A9D33052-C09F-458A-A4C1-3C75AB5CD69A@mac.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
	<0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
	<269388e30812291029u30c2b4e6oa4c0a2686b315118@mail.gmail.com>
	<A9D33052-C09F-458A-A4C1-3C75AB5CD69A@mac.com>
Message-ID: <269388e30812291544s61950113ie844e93a28fcedd@mail.gmail.com>

Chuck,

On Mon, Dec 29, 2008 at 10:09 PM, Chuck Remes <cremes.devlist at mac.com> wrote:
>> What is the scope of the stamp? Is it globally monotonic
>>
>> a) accross the entire Rabbit cluster
>> b) within a single Rabbit node
>> c) within a single AMQP channel
>> d) just through a particular queue
> I need to order the messages for the entire distributed application,
> so in this case I believe that means (a) and (b). I haven't really
> given much thought to the clustered case. Any rules of thumb when
> designing for a cluster other than "share nothing?"

Well apart from breaking the golden rule of "share nothing" in a
cluster, doing this should be straight forward.

What I mean to say is that stamping each message with a header
property is a pretty trivial extension in terms of the lines of code
you'd have to write to set the header.

And you could use mnesia to maintain a globally unique ordering key
and not have to worry about the coherency of this key.

So all in all, this is all quite doable.

The downside to synchronizing of a single piece of global state (which
is what strict global ordering implies) is that you introduce a not
insignificant bottleneck into the system.

So unless you come up with some funky way to maintain a coherent
global counter, your application will not scale.

Having said that, if scalability/throughput/latency are not issues for
you, then I would cut to the chase and go for the custom exchange I
described earlier.

> This is the best suggestion yet. I'll start with a Java client and as
> we require additional performance I'll see about contracting this out
> via LShift. While I'd love to write it myself, I long ago concluded
> that it makes more sense to farm this kind of activity out to the real
> experts.

As indicated above, setting this for each message would not be too
difficult to do. Given a mechanism to maintain a global counter, it
would be less effort to do the custom exchange that any external relay
mechanism.

HTH,

Ben



From 0x6e6562 at gmail.com  Tue Dec 30 00:36:59 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 30 Dec 2008 00:36:59 +0000
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <E17D8BC4-C99B-4205-ABC2-A3AE56EA5772@mac.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
	<0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
	<269388e30812291029u30c2b4e6oa4c0a2686b315118@mail.gmail.com>
	<A9D33052-C09F-458A-A4C1-3C75AB5CD69A@mac.com>
	<269388e30812291544s61950113ie844e93a28fcedd@mail.gmail.com>
	<E17D8BC4-C99B-4205-ABC2-A3AE56EA5772@mac.com>
Message-ID: <269388e30812291636x511e8672rc0560a7bc12b2a7c@mail.gmail.com>

Chuck,

On Tue, Dec 30, 2008 at 12:13 AM, Chuck Remes <cremes.devlist at mac.com> wrote:
>> As indicated above, setting this for each message would not be too
>> difficult to do. Given a mechanism to maintain a global counter, it
>> would be less effort to do the custom exchange that any external relay
>> mechanism.
>
> This has helped immensely. Can you provide a pointer to an example custom
> exchange?

There isn't one really, but if you look in the deliver/5 function in
the rabbit_router module, all you have to do is to fold the global
counter into each message that gets applied to the list of queue
endpoints. This would be one way to skin the cat.

You still have the problem of how to maintain the global counter though.

Having said this, are you interested in strict ordering as if it were
be monitored by some all-knowing being or is it just a case of needing
to be able to replay the same order?

If your application could tolerate some perceived re-ordering, but
still replays in the same order, you could request batches of ordering
keys from your globally visible state. The effect of this would allow
a degree of parallelization at the cost of some stuff *appearing* to
have arrived out of the *true* global order. But you could replay in
the same order and the things were stamped.

Having said that, you might find using plain jane timestamps easier,
if you can relax this true global ordering constraint a bit.

HTH,

Ben



From 0x6e6562 at gmail.com  Tue Dec 30 11:44:34 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 30 Dec 2008 11:44:34 +0000
Subject: [rabbitmq-discuss] [erlang-questions] cheap low-power boards
In-Reply-To: <4959F8C7.5000304@diskware.net>
References: <33CFEAE2-CDB6-41BA-9AB6-ED48E38EDFA6@gmail.com>
	<269388e30812290342v1cc8aa01y8e9c16624a5d64a3@mail.gmail.com>
	<4958BD11.3020809@diskware.net>
	<269388e30812290459l48d38a41p8e3a6b69a3e66d47@mail.gmail.com>
	<4958D05A.2020209@diskware.net>
	<269388e30812290730i1d8c1db6xb9dbb9dce49e92ef@mail.gmail.com>
	<4958F3FA.4000403@diskware.net>
	<269388e30812290838t4a988a8bx17c896e599a75c0@mail.gmail.com>
	<4959F8C7.5000304@diskware.net>
Message-ID: <269388e30812300344m4d970ea5xb4d426a49386662a@mail.gmail.com>

Martin,

On Tue, Dec 30, 2008 at 10:32 AM, Martin Scholl <ms at diskware.net> wrote:
> I have just compiled RabbitMQ on the ATOM board and successfully started it:
>        MNESIA_DIR=mnesia/ LOG_BASE=logs/ ./rabbitmq-server.cp
>
> rabbitmq-server.cp is rabbitmq-server without the -noinput flag given to
> erl.
>
>
> I cannot proceed starting the performance testing client:
>
>        ./runperftest.sh 192.168.1.129

Sorry, I don't know how that script works (although it is in the java
client package).

OTOH I do know how the underlying MulticastMain works and I'm
wondering what difference it makes if you run it without the arguments
that the runperfest.sh script sets.

For example, you could run

./runjava.sh com.rabbitmq.examples.MulticastMain -h 192.168.1.129

To get a list of options of what you can set, pass in --help as an argument.

> . The clients throws an IOException:
>
> === running with '  '

I don't know what " running with '  ' " means, but I don't think this
affects anything in the underlying MulticastMain class.

> starting consumer #0
> Main thread caught exception: java.io.IOException
> java.io.IOException
>        at com.rabbitmq.client.impl.AMQChannel.wrap(AMQChannel.java:121)
>        at
> com.rabbitmq.client.impl.AMQConnection.open(AMQConnection.java:370)
>        at
> com.rabbitmq.client.impl.AMQConnection.<init>(AMQConnection.java:204)
>        at
> com.rabbitmq.client.impl.AMQConnection.<init>(AMQConnection.java:174)
>        at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:165)
>        at
> com.rabbitmq.client.ConnectionFactory.newConnection(ConnectionFactory.java:213)
>        at com.rabbitmq.examples.MulticastMain.main(MulticastMain.java:100)
> Caused by: com.rabbitmq.client.ShutdownSignalException (connection
> error; reason: java.io.EOFException)
>        at
> com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:606)
>        at
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:468)
> Caused by: java.io.EOFException
>        at
> java.io.DataInputStream.readUnsignedByte(DataInputStream.java:273)
>        at com.rabbitmq.client.impl.Frame.readFrom(Frame.java:117)
>        at
> com.rabbitmq.client.impl.SocketFrameHandler.readFrame(SocketFrameHandler.java:151)
>        at
> com.rabbitmq.client.impl.AMQConnection.readFrame(AMQConnection.java:295)
>        at
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:438)
>
>
> Can you give me some hints on how to proceed?

HTH,

Ben



From 0x6e6562 at gmail.com  Tue Dec 30 14:11:54 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 30 Dec 2008 14:11:54 +0000
Subject: [rabbitmq-discuss] [erlang-questions] cheap low-power boards
In-Reply-To: <495A20F2.5000109@diskware.net>
References: <33CFEAE2-CDB6-41BA-9AB6-ED48E38EDFA6@gmail.com>
	<4958BD11.3020809@diskware.net>
	<269388e30812290459l48d38a41p8e3a6b69a3e66d47@mail.gmail.com>
	<4958D05A.2020209@diskware.net>
	<269388e30812290730i1d8c1db6xb9dbb9dce49e92ef@mail.gmail.com>
	<4958F3FA.4000403@diskware.net>
	<269388e30812290838t4a988a8bx17c896e599a75c0@mail.gmail.com>
	<4959F8C7.5000304@diskware.net>
	<269388e30812300344m4d970ea5xb4d426a49386662a@mail.gmail.com>
	<495A20F2.5000109@diskware.net>
Message-ID: <269388e30812300611g666ba72aj24260be0e7ecca0d@mail.gmail.com>

Martin,

On Tue, Dec 30, 2008 at 1:24 PM, Martin Scholl <ms at diskware.net> wrote:
> [not posting to rabbitmq-*@ as I am not subscribed there].

No worries, I'll cross-post.

> I have finally managed to get the benchmarking done.
> Hardware:
>
> RabbitMQ 1.5.0 was run on
>        Intel Board D945GCLF2 which has a ATOM 330 onboard
>        2GB ram, DDR2 533
>        Maxtor 6V200E0 HD, 200gb,
>        Ubuntu Ibex
>        R12B-5
>
> Client vsn 1.5.0 is
>        Ubuntu HH, Sun's Java 1.5, Intel Core2 Duo 6700
>
>
> The network is our corporate network. Both nodes use intel 1gbe cards
> and are 2 switch-hops away. The network's latency could be better.
>
> For some tests top showed ~220% CPU of beam (sometimes for short periods
> even 376% -- the ATOM 330 has 2 cores with 2 hyperthreads each). For
> most of the time beam occupied 1 core and hyperthread.
>
> The results were collected by calling
>        ./runperftest.sh 192.168.1.129 > run-${i}
> . You will find them attached.
>
>
> It would be great to get some reference results for comparison purposes
> as I am unable to interpret the attached results.
>
> Hope it helps the RabbitMQ project a bit.

Yes, you have started a useful discussion. I'm sure that some people
in the Rabbit community can use your results to compare it with their
current setups.

Any takers?

Ben

> === running with '  '
> starting consumer #0
> starting producer #0
> recving rate avg: 3981 msg/s
> sending rate avg: 4083 msg/s
> === running with '-a  '
> starting consumer #0
> starting producer #0
> recving rate avg: 4688 msg/s
> sending rate avg: 4801 msg/s
> === running with '-m 1  '
> starting consumer #0
> starting producer #0
> recving rate avg: 818 msg/s
> sending rate avg: 818 msg/s
> === running with '-m 1 -n 1  '
> starting consumer #0
> starting producer #0
> sending rate avg: 818 msg/s
> recving rate avg: 81 msg/s
> === running with '-m 10  '
> starting consumer #0
> starting producer #0
> recving rate avg: 2100 msg/s
> sending rate avg: 2103 msg/s
> === running with '-m 10 -n 10  '
> starting consumer #0
> starting producer #0
> recving rate avg: 1731 msg/s
> sending rate avg: 1977 msg/s
> === running with ' -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 3531 msg/s
> sending rate avg: 3825 msg/s
> === running with '-a -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 4298 msg/s
> sending rate avg: 4401 msg/s
> === running with '-m 1 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 83 msg/s
> sending rate avg: 83 msg/s
> === running with '-m 1 -n 1 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 33 msg/s
> sending rate avg: 47 msg/s
> === running with '-m 10 -f persistent '
> starting consumer #0
> starting producer #0
> sending rate avg: 672 msg/s
> recving rate avg: 669 msg/s
> === running with '-m 10 -n 10 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 355 msg/s
> sending rate avg: 358 msg/s
> === running with '  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 3401 msg/s
> sending rate avg: 3433 msg/s
> === running with '-a  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 4084 msg/s
> sending rate avg: 4110 msg/s
> === running with '-m 1  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 790 msg/s
> sending rate avg: 790 msg/s
> === running with '-m 1 -n 1  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 368 msg/s
> sending rate avg: 766 msg/s
> === running with '-m 10  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 2086 msg/s
> sending rate avg: 2089 msg/s
> === running with '-m 10 -n 10  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 1965 msg/s
> sending rate avg: 1967 msg/s
> === running with ' -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 3208 msg/s
> sending rate avg: 3242 msg/s
> === running with '-a -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 3728 msg/s
> sending rate avg: 3752 msg/s
> === running with '-m 1 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 85 msg/s
> sending rate avg: 85 msg/s
> === running with '-m 1 -n 1 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> sending rate avg: 46 msg/s
> recving rate avg: 33 msg/s
> === running with '-m 10 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 633 msg/s
> sending rate avg: 631 msg/s
> === running with '-m 10 -n 10 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> sending rate avg: 358 msg/s
> recving rate avg: 356 msg/s
> === running with '-a -f mandatory'
> starting consumer #0
> starting producer #0
> recving rate avg: 2556 msg/s
> sending rate avg: 4925 msg/s
> === running with '-a -f mandatory -f immediate'
> starting consumer #0
> starting producer #0
> recving rate avg: 2573 msg/s
> sending rate avg: 5031 msg/s
>
> === running with '  '
> starting consumer #0
> starting producer #0
> recving rate avg: 4016 msg/s
> sending rate avg: 4110 msg/s
> === running with '-a  '
> starting consumer #0
> starting producer #0
> recving rate avg: 4632 msg/s
> sending rate avg: 4768 msg/s
> === running with '-m 1  '
> starting consumer #0
> starting producer #0
> recving rate avg: 802 msg/s
> sending rate avg: 803 msg/s
> === running with '-m 1 -n 1  '
> starting consumer #0
> starting producer #0
> sending rate avg: 813 msg/s
> recving rate avg: 79 msg/s
> === running with '-m 10  '
> starting consumer #0
> starting producer #0
> recving rate avg: 2103 msg/s
> sending rate avg: 2107 msg/s
> === running with '-m 10 -n 10  '
> starting consumer #0
> starting producer #0
> recving rate avg: 1692 msg/s
> sending rate avg: 1978 msg/s
> === running with ' -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 3505 msg/s
> sending rate avg: 3752 msg/s
> === running with '-a -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 4258 msg/s
> sending rate avg: 4391 msg/s
> === running with '-m 1 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 83 msg/s
> sending rate avg: 83 msg/s
> === running with '-m 1 -n 1 -f persistent '
> starting consumer #0
> starting producer #0
> sending rate avg: 48 msg/s
> recving rate avg: 32 msg/s
> === running with '-m 10 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 659 msg/s
> sending rate avg: 661 msg/s
> === running with '-m 10 -n 10 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 358 msg/s
> sending rate avg: 361 msg/s
> === running with '  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 3475 msg/s
> sending rate avg: 3492 msg/s
> === running with '-a  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 4070 msg/s
> sending rate avg: 4103 msg/s
> === running with '-m 1  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 805 msg/s
> sending rate avg: 806 msg/s
> === running with '-m 1 -n 1  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 367 msg/s
> sending rate avg: 754 msg/s
> === running with '-m 10  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 2070 msg/s
> sending rate avg: 2073 msg/s
> === running with '-m 10 -n 10  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 2033 msg/s
> sending rate avg: 2035 msg/s
> === running with ' -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 3190 msg/s
> sending rate avg: 3325 msg/s
> === running with '-a -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 3981 msg/s
> sending rate avg: 4015 msg/s
> === running with '-m 1 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 86 msg/s
> sending rate avg: 86 msg/s
> === running with '-m 1 -n 1 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> sending rate avg: 47 msg/s
> recving rate avg: 32 msg/s
> === running with '-m 10 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 619 msg/s
> sending rate avg: 619 msg/s
> === running with '-m 10 -n 10 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 356 msg/s
> sending rate avg: 358 msg/s
> === running with '-a -f mandatory'
> starting consumer #0
> starting producer #0
> recving rate avg: 2633 msg/s
> sending rate avg: 4695 msg/s
> === running with '-a -f mandatory -f immediate'
> starting consumer #0
> starting producer #0
> recving rate avg: 2567 msg/s
> sending rate avg: 5154 msg/s
>
> === running with '  '
> starting consumer #0
> starting producer #0
> recving rate avg: 3996 msg/s
> sending rate avg: 4095 msg/s
> === running with '-a  '
> starting consumer #0
> starting producer #0
> recving rate avg: 4691 msg/s
> sending rate avg: 4798 msg/s
> === running with '-m 1  '
> starting consumer #0
> starting producer #0
> recving rate avg: 744 msg/s
> sending rate avg: 744 msg/s
> === running with '-m 1 -n 1  '
> starting consumer #0
> starting producer #0
> recving rate avg: 81 msg/s
> sending rate avg: 794 msg/s
> === running with '-m 10  '
> starting consumer #0
> starting producer #0
> recving rate avg: 2117 msg/s
> sending rate avg: 2120 msg/s
> === running with '-m 10 -n 10  '
> starting consumer #0
> starting producer #0
> recving rate avg: 1663 msg/s
> sending rate avg: 1983 msg/s
> === running with ' -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 3488 msg/s
> sending rate avg: 3777 msg/s
> === running with '-a -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 4580 msg/s
> sending rate avg: 4721 msg/s
> === running with '-m 1 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 82 msg/s
> sending rate avg: 82 msg/s
> === running with '-m 1 -n 1 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 32 msg/s
> sending rate avg: 49 msg/s
> === running with '-m 10 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 617 msg/s
> sending rate avg: 619 msg/s
> === running with '-m 10 -n 10 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 360 msg/s
> sending rate avg: 363 msg/s
> === running with '  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 3381 msg/s
> sending rate avg: 3432 msg/s
> === running with '-a  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 4107 msg/s
> sending rate avg: 4162 msg/s
> === running with '-m 1  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 705 msg/s
> sending rate avg: 705 msg/s
> === running with '-m 1 -n 1  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 344 msg/s
> sending rate avg: 701 msg/s
> === running with '-m 10  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 1988 msg/s
> sending rate avg: 1991 msg/s
> === running with '-m 10 -n 10  -s 1000'
> starting consumer #0
> starting producer #0
> sending rate avg: 1939 msg/s
> recving rate avg: 1936 msg/s
> === running with ' -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 3101 msg/s
> sending rate avg: 3182 msg/s
> === running with '-a -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 3900 msg/s
> sending rate avg: 3950 msg/s
> === running with '-m 1 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 79 msg/s
> sending rate avg: 79 msg/s
> === running with '-m 1 -n 1 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 37 msg/s
> sending rate avg: 42 msg/s
> === running with '-m 10 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 634 msg/s
> sending rate avg: 635 msg/s
> === running with '-m 10 -n 10 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 365 msg/s
> sending rate avg: 367 msg/s
> === running with '-a -f mandatory'
> starting consumer #0
> starting producer #0
> recving rate avg: 2466 msg/s
> sending rate avg: 5029 msg/s
> === running with '-a -f mandatory -f immediate'
> starting consumer #0
> starting producer #0
> recving rate avg: 2542 msg/s
> sending rate avg: 4956 msg/s
>
> === running with '  '
> starting consumer #0
> starting producer #0
> recving rate avg: 3943 msg/s
> sending rate avg: 4065 msg/s
> === running with '-a  '
> starting consumer #0
> starting producer #0
> recving rate avg: 4530 msg/s
> sending rate avg: 4638 msg/s
> === running with '-m 1  '
> starting consumer #0
> starting producer #0
> recving rate avg: 716 msg/s
> sending rate avg: 716 msg/s
> === running with '-m 1 -n 1  '
> starting consumer #0
> starting producer #0
> recving rate avg: 85 msg/s
> sending rate avg: 780 msg/s
> === running with '-m 10  '
> starting consumer #0
> starting producer #0
> recving rate avg: 2034 msg/s
> sending rate avg: 2038 msg/s
> === running with '-m 10 -n 10  '
> starting consumer #0
> starting producer #0
> sending rate avg: 1841 msg/s
> recving rate avg: 1553 msg/s
> === running with ' -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 3324 msg/s
> sending rate avg: 3758 msg/s
> === running with '-a -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 4247 msg/s
> sending rate avg: 4344 msg/s
> === running with '-m 1 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 81 msg/s
> sending rate avg: 81 msg/s
> === running with '-m 1 -n 1 -f persistent '
> starting consumer #0
> starting producer #0
> sending rate avg: 48 msg/s
> recving rate avg: 32 msg/s
> === running with '-m 10 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 650 msg/s
> sending rate avg: 651 msg/s
> === running with '-m 10 -n 10 -f persistent '
> starting consumer #0
> starting producer #0
> recving rate avg: 361 msg/s
> sending rate avg: 369 msg/s
> === running with '  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 3475 msg/s
> sending rate avg: 3513 msg/s
> === running with '-a  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 4032 msg/s
> sending rate avg: 4059 msg/s
> === running with '-m 1  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 715 msg/s
> sending rate avg: 716 msg/s
> === running with '-m 1 -n 1  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 334 msg/s
> sending rate avg: 666 msg/s
> === running with '-m 10  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 1976 msg/s
> sending rate avg: 1979 msg/s
> === running with '-m 10 -n 10  -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 1891 msg/s
> sending rate avg: 1894 msg/s
> === running with ' -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 3055 msg/s
> sending rate avg: 3192 msg/s
> === running with '-a -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 3737 msg/s
> sending rate avg: 3755 msg/s
> === running with '-m 1 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 80 msg/s
> sending rate avg: 80 msg/s
> === running with '-m 1 -n 1 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 37 msg/s
> sending rate avg: 42 msg/s
> === running with '-m 10 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 599 msg/s
> sending rate avg: 600 msg/s
> === running with '-m 10 -n 10 -f persistent -s 1000'
> starting consumer #0
> starting producer #0
> recving rate avg: 355 msg/s
> sending rate avg: 357 msg/s
> === running with '-a -f mandatory'
> starting consumer #0
> starting producer #0
> recving rate avg: 2696 msg/s
> sending rate avg: 4868 msg/s
> === running with '-a -f mandatory -f immediate'
> starting consumer #0
> starting producer #0
> recving rate avg: 2602 msg/s
> sending rate avg: 5102 msg/s
>
>



From cremes.devlist at mac.com  Tue Dec 30 15:00:39 2008
From: cremes.devlist at mac.com (Chuck Remes)
Date: Tue, 30 Dec 2008 09:00:39 -0600
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <269388e30812291636x511e8672rc0560a7bc12b2a7c@mail.gmail.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
	<0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
	<269388e30812291029u30c2b4e6oa4c0a2686b315118@mail.gmail.com>
	<A9D33052-C09F-458A-A4C1-3C75AB5CD69A@mac.com>
	<269388e30812291544s61950113ie844e93a28fcedd@mail.gmail.com>
	<E17D8BC4-C99B-4205-ABC2-A3AE56EA5772@mac.com>
	<269388e30812291636x511e8672rc0560a7bc12b2a7c@mail.gmail.com>
Message-ID: <BD09DC61-43EF-4B16-8EFE-8683F06F204D@mac.com>


On Dec 29, 2008, at 6:36 PM, Ben Hood wrote:

> Chuck,
>
> On Tue, Dec 30, 2008 at 12:13 AM, Chuck Remes  
> <cremes.devlist at mac.com> wrote:
>>> As indicated above, setting this for each message would not be too
>>> difficult to do. Given a mechanism to maintain a global counter, it
>>> would be less effort to do the custom exchange that any external  
>>> relay
>>> mechanism.
>>
>> This has helped immensely. Can you provide a pointer to an example  
>> custom
>> exchange?
>
> There isn't one really, but if you look in the deliver/5 function in
> the rabbit_router module, all you have to do is to fold the global
> counter into each message that gets applied to the list of queue
> endpoints. This would be one way to skin the cat.

I took a look but my lack of knowledge regarding Erlang made the code  
look like line noise. :)

> You still have the problem of how to maintain the global counter  
> though.

I don't understand this issue. Do you say this because the deliver/5  
function may be called from many Erlang threads thereby requiring the  
counter to be protected by a mutex? I thought Erlang serialized all  
accesses via messaging to "mailboxes" so these kinds of race  
conditions did not exist.

What is the problem with doing (the Erlang equivalent of):
global_counter++;


> Having said this, are you interested in strict ordering as if it were
> be monitored by some all-knowing being or is it just a case of needing
> to be able to replay the same order?

I am only concerned about the replay order.

> If your application could tolerate some perceived re-ordering, but
> still replays in the same order, you could request batches of ordering
> keys from your globally visible state. The effect of this would allow
> a degree of parallelization at the cost of some stuff *appearing* to
> have arrived out of the *true* global order. But you could replay in
> the same order and the things were stamped.

This sounds reasonable.

But let me make sure I am understanding you clearly. You are saying  
that it is possible for messages to be stamped in a different order  
than they were received by the Exchange. Is that the case? Or are you  
saying they may be delivered to queues in a different order than they  
were received by the Exchange?

Off-list I received a message from Alexis who highlighted this issue.  
Apparently the 0-8 AMQP spec does not address any ordering constraints  
except in the case of Queues, so the server has the option of  
reordering messages internally while processing. I don't think this  
really bothers me all that much.

> Having said that, you might find using plain jane timestamps easier,
> if you can relax this true global ordering constraint a bit.

Why is a timestamp better? Is it because it pushes the access to a  
"global counter" (in this case the system clock) outside of Erlang?  
Your answer to the earlier ordering questions will likely answer this  
one too.

I am not opposed to using a timestamp. I thought it would be *simpler*  
(and faster) to use an integer.

cr



From 0x6e6562 at gmail.com  Tue Dec 30 17:15:04 2008
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 30 Dec 2008 17:15:04 +0000
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <BD09DC61-43EF-4B16-8EFE-8683F06F204D@mac.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
	<0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
	<269388e30812291029u30c2b4e6oa4c0a2686b315118@mail.gmail.com>
	<A9D33052-C09F-458A-A4C1-3C75AB5CD69A@mac.com>
	<269388e30812291544s61950113ie844e93a28fcedd@mail.gmail.com>
	<E17D8BC4-C99B-4205-ABC2-A3AE56EA5772@mac.com>
	<269388e30812291636x511e8672rc0560a7bc12b2a7c@mail.gmail.com>
	<BD09DC61-43EF-4B16-8EFE-8683F06F204D@mac.com>
Message-ID: <269388e30812300915n364b4893mfb068ffac4977824@mail.gmail.com>

Chuck,

On Tue, Dec 30, 2008 at 3:00 PM, Chuck Remes <cremes.devlist at mac.com> wrote:
> I took a look but my lack of knowledge regarding Erlang made the code
> look like line noise. :)

Yes, well it's only an optimization over the dequeue/enqueue relay.

>> You still have the problem of how to maintain the global counter
>> though.
>
> I don't understand this issue. Do you say this because the deliver/5
> function may be called from many Erlang threads thereby requiring the
> counter to be protected by a mutex? I thought Erlang serialized all
> accesses via messaging to "mailboxes" so these kinds of race
> conditions did not exist.
>
> What is the problem with doing (the Erlang equivalent of):
> global_counter++;

The issue is not thread safety - what you are suggesting is perfectly doable.

The issue is that you have serialized access to a global counter,
which just causes scalability and performance issues.

So will not run into problems because of concurrency, rather you will
run into problems through lack of concurrency because of the big
global lock.

> I am only concerned about the replay order.
>
>> If your application could tolerate some perceived re-ordering, but
>> still replays in the same order, you could request batches of ordering
>> keys from your globally visible state. The effect of this would allow
>> a degree of parallelization at the cost of some stuff *appearing* to
>> have arrived out of the *true* global order. But you could replay in
>> the same order and the things were stamped.
>
> This sounds reasonable.
>
> But let me make sure I am understanding you clearly. You are saying
> that it is possible for messages to be stamped in a different order
> than they were received by the Exchange. Is that the case? Or are you
> saying they may be delivered to queues in a different order than they
> were received by the Exchange?

There's really no such thing as an single instance of an exchange - an
exchange is just the application of a routing rule based an exchange
name and a routing key. Hence this can be evaluated in parallel by
different processes or on different nodes. In contrast to queues,
exchanges are not endpoints where messages land, they are just a
convention to provide coherent routing functionality.

> Off-list I received a message from Alexis who highlighted this issue.
> Apparently the 0-8 AMQP spec does not address any ordering constraints
> except in the case of Queues

This is true and this ties in with what I just said above - there is
no notion of inbound queueing in 0-8 AMQP, just outbound queueing. So
you will get strict ordering by queues but in order (pardon the pun)
to get global inbound ordering, you are going to need to impose a
barrier that each message has to pass through (as indicated above with
the global lock).

Consider the scenario where you have 2 queues bound to one exchange.
If you send 2 messages to the exchange, then each queue instance will
deliver 2 messages to a consumer in the order that they arrived at the
queue. But on the input side, those 2 messages could have been
published on a different channels (or on different nodes). There is no
guarantee that 2 messages sent to the same exchange on different
channels will not get re-ordered - to do so you would have to have
some kind of barrier.

>> Having said that, you might find using plain jane timestamps easier,
>> if you can relax this true global ordering constraint a bit.
>
> Why is a timestamp better? Is it because it pushes the access to a
> "global counter" (in this case the system clock) outside of Erlang?
> Your answer to the earlier ordering questions will likely answer this
> one too.

Yes, there might be some mileage in re-reading the entire thread,
because I think that the conversation does not read entirely linearly.

> I am not opposed to using a timestamp. I thought it would be *simpler*
> (and faster) to use an integer.

Not if this integer has to be atomically incremented across a cluster
(or even between two different channels). This is effectively a global
compare and swap operation which constitutes a very coarse grained
lock.

Using timestamps is cheaper because you don't have any contented
locks. but you get this with a certain degree of inaccuracy. The same
trade-off applies for the bulk counter fetch method I proposed in my
previous post.

At the end of the day I think you have to make the decision to either

a) opt for true ordering and accept the cost (this would be perfectly valid);
b) try to exploit a natural partition in your use case that allows you
to break the global lock down into finer locks;
c) redesign your application to be able to cope with eventual
consistency rather than absolute consistency.

HTH,

Ben



From cremes.devlist at mac.com  Tue Dec 30 17:30:32 2008
From: cremes.devlist at mac.com (Chuck Remes)
Date: Tue, 30 Dec 2008 11:30:32 -0600
Subject: [rabbitmq-discuss] [Q] best way to add a sequencer to the broker
In-Reply-To: <269388e30812300915n364b4893mfb068ffac4977824@mail.gmail.com>
References: <2840ECA2-9E57-4BD9-B8E1-BB5A40544532@mac.com>
	<269388e30812290818w9052696h63163ab3c7844639@mail.gmail.com>
	<0626524F-5125-4060-811A-78AC4497DF3A@mac.com>
	<269388e30812291029u30c2b4e6oa4c0a2686b315118@mail.gmail.com>
	<A9D33052-C09F-458A-A4C1-3C75AB5CD69A@mac.com>
	<269388e30812291544s61950113ie844e93a28fcedd@mail.gmail.com>
	<E17D8BC4-C99B-4205-ABC2-A3AE56EA5772@mac.com>
	<269388e30812291636x511e8672rc0560a7bc12b2a7c@mail.gmail.com>
	<BD09DC61-43EF-4B16-8EFE-8683F06F204D@mac.com>
	<269388e30812300915n364b4893mfb068ffac4977824@mail.gmail.com>
Message-ID: <E176139B-F4C4-4E41-BCFB-6617C1EBB3F6@mac.com>

Ben,

On Dec 30, 2008, at 11:15 AM, Ben Hood wrote:

> Chuck,
>
> At the end of the day I think you have to make the decision to either
>
> a) opt for true ordering and accept the cost (this would be  
> perfectly valid);
> b) try to exploit a natural partition in your use case that allows you
> to break the global lock down into finer locks;
> c) redesign your application to be able to cope with eventual
> consistency rather than absolute consistency.

Thank you for your patience in answering these questions.

I'll take this back to the business folks and see what they have to  
say. Ultimately it is their business requirement which is driving  
this, so if we can relax it a bit then I can avoid this complexity.

cr




From tim+rabbitmq.com at coote.org  Wed Dec 31 12:17:02 2008
From: tim+rabbitmq.com at coote.org (Tim Coote)
Date: Wed, 31 Dec 2008 12:17:02 +0000
Subject: [rabbitmq-discuss] question on the faq
Message-ID: <637BFF3A-19BB-4D94-AB94-7240C411205D@coote.org>

Hullo

A neophyte's question:

The  faq includes 'is rabbitmq transactional?'

The answer is 'yes' and then says that it has atomicity and durability  
guarantees. What about Isolation and consistency? (although the latter  
may be partly embedded in the apps that use rabbitmq, I think that  
consistency implies guarantees about serialisation/deserialisation).  
Is the answer buried in the semantics of a TX AMQP message type?

I'd expect good engineering practice like ACID transactions and  
failfast guidelines in Erlang/OTP programming as I think that these  
are pretty much essential for any large scale system that's intended  
to be robust.  (Unlike many commercial programs ;-)

Tim






