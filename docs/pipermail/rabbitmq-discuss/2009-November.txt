From pauljones23 at gmail.com  Sun Nov  1 07:59:04 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Sun, 1 Nov 2009 07:59:04 +0000
Subject: [rabbitmq-discuss] how to use rabbitmq on shared hosting servers
In-Reply-To: <26146825.post@talk.nabble.com>
References: <26146825.post@talk.nabble.com>
Message-ID: <29598b610911010059n4d729a05p3c8eb833fcb456fe@mail.gmail.com>

Hi,

If you can get Erlang functioning successfully on the machine, then the
Generic UNIX install of Rabbit is simply a tarball that can be placed
anywhere. As for getting Erlang working appropriately, that is going to be
very dependent on the shared host at hand.

Paul.

On Sat, Oct 31, 2009 at 11:37 PM, python.django.user <
python.django.user at gmail.com> wrote:

>
> Hi,
> I am thinking of setting up rabbitmq and erlang on a shared hosting web
> server. Are there any pointers on how to install to a custom directory
> without requiring administrative rights?
>
> Thanks!
> --
> View this message in context:
> http://old.nabble.com/how-to-use-rabbitmq-on-shared-hosting-servers-tp26146825p26146825.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091101/60ecd1c1/attachment.htm 

From niranjan.par at gmail.com  Mon Nov  2 04:58:43 2009
From: niranjan.par at gmail.com (niranjan)
Date: Mon, 02 Nov 2009 10:28:43 +0530
Subject: [rabbitmq-discuss] RabbitMQ server losing connections
In-Reply-To: <FA86BFB2-2EFD-494A-B262-6155844C2D42@pmamediagroup.com>
References: <4AEA755A.8070501@gmail.com>
	<FA86BFB2-2EFD-494A-B262-6155844C2D42@pmamediagroup.com>
Message-ID: <4AEE6703.6070805@gmail.com>

Hi,

No there are no error in the rabbitmq server logs. The only entries I 
can see in log files are of type:

=INFO REPORT==== 25-Oct-2009::07:25:13 ===
accepted TCP connection on 0.0.0.0:5672 from 10.7.253.22:53703

=INFO REPORT==== 25-Oct-2009::07:25:13 ===
starting TCP connection <0.11373.20> from 10.7.253.22:53703

=INFO REPORT==== 25-Oct-2009::07:25:13 ===
closing TCP connection <0.11373.20> from 10.7.253.22:53703
........




Tracey Eubanks wrote:
> Hey Niranjan,
> Does the rabbitmq server log have any errors in it?
>
>
>
> On Oct 29, 2009, at 11:10 PM, niranjan <niranjan.par at gmail.com> wrote:
>
>> Hi All,
>>
>> I am using RabbitMQ 1.6 with ruby AMQP to subscribe to the queue over
>> the network. Immediately after starting the listeners I see the queues
>> registered with the server (rabbitmqctl list_queues) as well as
>> connections (rabbitmqctl list_connections).
>>
>> ~$ sudo rabbitmqctl list_connections
>> Listing connections ...
>> guest    10.7.253.22    53703
>> guest    10.7.253.12    55797
>> ...done...done.
>>
>> ~$ sudo rabbitmqctl list_queues name durable messages messages_ready
>> Listing queues ...
>> foo_deletes    false    0    0
>> foo_updates    false    0    0
>> foo_creates    false    0    0
>> duplicate_listener_on_localhost  false    0    0
>> ...done.
>>
>> ~$ netstat -anlp | grep 5672
>> tcp        0      0 0.0.0.0:5672            0.0.0.0:*
>> LISTEN      -
>> tcp        0      0 10.7.253.12:5672        10.7.253.12:55797
>> ESTABLISHED -
>> tcp        0      0 10.7.253.12:5672        10.7.253.22:53703
>> ESTABLISHED -
>>
>> After an hour or so server loses the connection with with listeners. The
>> list_queues still shows all the queues but list_connections shows no
>> active connections.
>>
>> ~$ sudo rabbitmqctl list_connections
>> Listing connections ...
>> ...done...done.
>>
>> ~$ sudo rabbitmqctl list_queues name durable messages messages_ready
>> Listing queues ...
>> foo_deletes    false    0    0
>> foo_updates    false    0    0
>> foo_creates    false    0    0
>> duplicate_listener_on_localhost  false    0    0
>> ...done.
>>
>> ~$ netstat -anlp | grep 5672
>> tcp        0      0 0.0.0.0:5672            0.0.0.0:*
>> LISTEN      -
>>
>> I am not too sure which side lies the problem as on listener side I
>> don't see any logs indicating that the connection is lost, but server
>> definitely has lost it. Server not only loses the connection over the
>> network but connection from localhost as well.
>>
>> Has anyone faced similar problem or could you point out where I should
>> start?
>>
>> Thanks and Regards,
>> Niranjan
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>




From steve at changesciences.com  Mon Nov  2 14:14:56 2009
From: steve at changesciences.com (Steve Ellis)
Date: Mon, 02 Nov 2009 09:14:56 -0500
Subject: [rabbitmq-discuss] Could not upgrade the network driver to ssl
In-Reply-To: <20091031193708.GA5572@wellquite.org>
References: <4AEC89FA.4050008@changesciences.com>
	<20091031193708.GA5572@wellquite.org>
Message-ID: <4AEEE960.70102@changesciences.com>

Hi Matthew,

Thank you for your detailed response. It was easiest for me to try the
upgrade to R13B02-1 which seems to have fixed the problem. My rabbit.log 
now looks like this and my call to start_network/1 no longer gives the 
error.

=INFO REPORT==== 31-Oct-2009::16:45:12 ===
started TCP Listener on 0.0.0.0:5672

=INFO REPORT==== 31-Oct-2009::16:45:12 ===
started SSL Listener on 0.0.0.0:5671

=INFO REPORT==== 31-Oct-2009::16:45:22 ===
accepted TCP connection on 0.0.0.0:5671 from 127.0.0.1:54769

=INFO REPORT==== 31-Oct-2009::16:45:23 ===
upgraded TCP connection from 127.0.0.1:54769 to SSL

=INFO REPORT==== 31-Oct-2009::16:45:23 ===
starting TCP connection <0.171.0> from 127.0.0.1:54769

Hope this helps someone else!

Steve





From matthew at lshift.net  Mon Nov  2 14:33:58 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 2 Nov 2009 14:33:58 +0000
Subject: [rabbitmq-discuss] Could not upgrade the network driver to ssl
In-Reply-To: <4AEEE960.70102@changesciences.com>
References: <4AEC89FA.4050008@changesciences.com>
	<20091031193708.GA5572@wellquite.org>
	<4AEEE960.70102@changesciences.com>
Message-ID: <20091102143358.GC24716@mrnibble.lshift.net>

Hi Steve,

On Mon, Nov 02, 2009 at 09:14:56AM -0500, Steve Ellis wrote:
> Thank you for your detailed response. It was easiest for me to try the
> upgrade to R13B02-1 which seems to have fixed the problem. My
> rabbit.log now looks like this and my call to start_network/1 no
> longer gives the error.

That's good to know and thanks for letting us know the outcome.

Matthew



From g at rre.tt  Mon Nov  2 18:02:38 2009
From: g at rre.tt (Garrett Smith)
Date: Mon, 2 Nov 2009 13:02:38 -0500
Subject: [rabbitmq-discuss] rabbitmq-server restart also restarts epmd
Message-ID: <ce2570e20911021002u26650618i82e660ef5eec5d58@mail.gmail.com>

I wanted to post here before digging into this, but the Debian control
scripts for rabbitmq appear to affecting a restart of epmd:

# pgrep epmd
28133
# /etc/init.d/rabbitmq-server restart
Restarting rabbitmq-server: SUCCESS
rabbitmq-server.
# pgrep epmd
29027

Needless to say, this makes other registered Erlang nodes running on
the server very cranky :)

Is this by design? Is there a preferred way to restart rabbitmq on Debian?

Thanks,
Garrett



From matthias at lshift.net  Mon Nov  2 18:21:08 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 02 Nov 2009 18:21:08 +0000
Subject: [rabbitmq-discuss] rabbitmq-server restart also restarts epmd
In-Reply-To: <ce2570e20911021002u26650618i82e660ef5eec5d58@mail.gmail.com>
References: <ce2570e20911021002u26650618i82e660ef5eec5d58@mail.gmail.com>
Message-ID: <4AEF2314.8070208@lshift.net>

Garrett,

Garrett Smith wrote:
> # pgrep epmd
> 28133
> # /etc/init.d/rabbitmq-server restart
> Restarting rabbitmq-server: SUCCESS
> rabbitmq-server.
> # pgrep epmd
> 29027
> 
> Needless to say, this makes other registered Erlang nodes running on
> the server very cranky :)
> 
> Is this by design? Is there a preferred way to restart rabbitmq on Debian?

This was introduced in order to prevent failures during package purge 
(which attempts to remove the 'rabbitmq' user, and failed when epmd was 
started by that user and is still running).

Note that it will only kill a 'rabbitmq' owned epmd, so one way to keep 
epmd running is to start it explicitly, as a different user.

We could do a few other things, e.g.

- only kill epmd if it was started by the init script

- only kill epmd on package purge

- start epmd as a different user, e.g. root

They all have drawbacks too though. Any other suggestions?


Matthias.



From matthias at lshift.net  Mon Nov  2 19:28:02 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 02 Nov 2009 19:28:02 +0000
Subject: [rabbitmq-discuss] rabbitmq-server restart also restarts epmd
In-Reply-To: <ce2570e20911021115ibe6dc76n96c68bb9d254bf16@mail.gmail.com>
References: <ce2570e20911021002u26650618i82e660ef5eec5d58@mail.gmail.com>	<4AEF2314.8070208@lshift.net>
	<ce2570e20911021115ibe6dc76n96c68bb9d254bf16@mail.gmail.com>
Message-ID: <4AEF32C2.8010208@lshift.net>

Garrett,

Garrett Smith wrote:
> The approach that seems to have the fewest surprises is to kill epmd
> only during a package purge. What drawback do you see there?

- this would still disturb other Erlang apps, just less frequently

- it makes start/stop asymmetric; if epmd gets started as a side-effect 
of starting rabbitmq, then it should get stopped as a side effect of 
stopping rabbitmq


Matthias.



From g at rre.tt  Mon Nov  2 20:47:37 2009
From: g at rre.tt (Garrett Smith)
Date: Mon, 2 Nov 2009 15:47:37 -0500
Subject: [rabbitmq-discuss] rabbitmq-server restart also restarts epmd
In-Reply-To: <4AEF32C2.8010208@lshift.net>
References: <ce2570e20911021002u26650618i82e660ef5eec5d58@mail.gmail.com>
	<4AEF2314.8070208@lshift.net>
	<ce2570e20911021115ibe6dc76n96c68bb9d254bf16@mail.gmail.com>
	<4AEF32C2.8010208@lshift.net>
Message-ID: <ce2570e20911021247j1dff6d88vef43dc0a005a5e5d@mail.gmail.com>

On Mon, Nov 2, 2009 at 2:28 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Garrett,
>
> Garrett Smith wrote:
>>
>> The approach that seems to have the fewest surprises is to kill epmd
>> only during a package purge. What drawback do you see there?
>
> - this would still disturb other Erlang apps, just less frequently
>
> - it makes start/stop asymmetric; if epmd gets started as a side-effect of
> starting rabbitmq, then it should get stopped as a side effect of stopping
> rabbitmq

This problem pops up from Erlang's implicit creation of a long running
process that's relied upon multiple Erlang nodes :(

Rather than try to solve the dependency/ordering issue that's at the
heart of this, I'd punt and just take the most defensible course:

- Running the rabbitmq Erlang process is going to implicitly start
epmd under the rabbit user. This is least surprising -- it's the way
any Erlang process behaves.

- Removing the rabbitmq-server package necessitates removal of the
rabbit user, which necessitates stopping all of its processes. This is
also pretty obvious.

If a sysadmin needs to manage the shared epmd process, he/she can do
so outside the scope of rabbit. This is going to be a problem with any
Erlang application that runs under a non-privileged user.

I agree that it's never ideal to kill epmd, but short of trying to
solve Erlang's problem for them, I'd settle for this.

Garrett



From elliot at canonical.com  Mon Nov  2 21:26:34 2009
From: elliot at canonical.com (Elliot Murphy)
Date: Mon, 02 Nov 2009 16:26:34 -0500
Subject: [rabbitmq-discuss] rabbitmq-server restart also restarts epmd
In-Reply-To: <ce2570e20911021247j1dff6d88vef43dc0a005a5e5d@mail.gmail.com>
References: <ce2570e20911021002u26650618i82e660ef5eec5d58@mail.gmail.com>	<4AEF2314.8070208@lshift.net>	<ce2570e20911021115ibe6dc76n96c68bb9d254bf16@mail.gmail.com>	<4AEF32C2.8010208@lshift.net>
	<ce2570e20911021247j1dff6d88vef43dc0a005a5e5d@mail.gmail.com>
Message-ID: <4AEF4E8A.3040107@canonical.com>

On 11/02/2009 03:47 PM, Garrett Smith wrote:
 > - Removing the rabbitmq-server package necessitates removal of the
> rabbit user, which necessitates stopping all of its processes. This is
> also pretty obvious.

CouchDB has faced similar issues.

My understanding of Debian and Ubuntu policy/best practice is that
packages should not remove system users that they have created.

I didn't find where this is specified in debian policy, but here is a
wiki page that describes some of the problems with removing system
users: http://wiki.debian.org/AccountHandlingInMaintainerScripts

What we have done for CouchDB in Ubuntu (at the insistence/encouragement
of the core Ubuntu developers) is simply changed the package to not
remove the CouchDB user, and I'd recommend the same change for RabbitMQ.

-- 
Elliot Murphy | https://launchpad.net/~statik/

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 197 bytes
Desc: OpenPGP digital signature
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091102/e36b33dd/attachment.pgp 

From matthias at lshift.net  Tue Nov  3 07:20:44 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 03 Nov 2009 07:20:44 +0000
Subject: [rabbitmq-discuss] RabbitMQ server losing connections
In-Reply-To: <4AEE6703.6070805@gmail.com>
References: <4AEA755A.8070501@gmail.com>	<FA86BFB2-2EFD-494A-B262-6155844C2D42@pmamediagroup.com>
	<4AEE6703.6070805@gmail.com>
Message-ID: <4AEFD9CC.2020000@lshift.net>

Niranjan,

niranjan wrote:
> Hi,
> 
> No there are no error in the rabbitmq server logs. The only entries I 
> can see in log files are of type:
> 
> =INFO REPORT==== 25-Oct-2009::07:25:13 ===
> accepted TCP connection on 0.0.0.0:5672 from 10.7.253.22:53703
> 
> =INFO REPORT==== 25-Oct-2009::07:25:13 ===
> starting TCP connection <0.11373.20> from 10.7.253.22:53703
> 
> =INFO REPORT==== 25-Oct-2009::07:25:13 ===
> closing TCP connection <0.11373.20> from 10.7.253.22:53703
> ........

The above shows a single connection being opened and closed within a 
single second (the <...> identifies the connection).

If you really have nothing but the above entries, i.e. 
"accepted/starting/closing TCP connection" then the client must have 
performed a controlled shutdown of the connection. In any other 
circumstances, e.g. the network or client dying, or the server 
encountering an error, the log would show an error or warning.


Regards,

Matthias.



From rtrlists at googlemail.com  Tue Nov  3 09:47:12 2009
From: rtrlists at googlemail.com (Robert Raschke)
Date: Tue, 3 Nov 2009 09:47:12 +0000
Subject: [rabbitmq-discuss] Making backups of RabbitMQ state?
Message-ID: <6a3ae47e0911030147u372d9f9dp54d4af835c0b6a5e@mail.gmail.com>

Hi,

I am having a little bit of trouble figuring out what the proper backup
procedure for the RabbitMQ state would be.

For the configuration (vhosts, users, exchanges, queues, etc.) I can use the
normal Mnesia backup and restore. That I understand.

But for the persistant messages I am not so sure. How is the
rabbit_persister.LOG managed? Can I just take a backup copy of it whenever,
or may I only take one of the rabbit_persister.LOG.previous? Where would I
look to find out how often it is rolled? Can I trigger a manual roll?

Any pointers are highly appreciated.

Thanks,
Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091103/eadc79a3/attachment.htm 

From david.wragg at lshift.net  Tue Nov  3 21:02:09 2009
From: david.wragg at lshift.net (David Wragg)
Date: Tue, 03 Nov 2009 21:02:09 +0000
Subject: [rabbitmq-discuss] rabbitmq-server restart also restarts epmd
In-Reply-To: <ce2570e20911021247j1dff6d88vef43dc0a005a5e5d@mail.gmail.com>
	(Garrett Smith's message of "Mon\, 2 Nov 2009 15\:47\:37 -0500")
References: <ce2570e20911021002u26650618i82e660ef5eec5d58@mail.gmail.com>
	<4AEF2314.8070208@lshift.net>
	<ce2570e20911021115ibe6dc76n96c68bb9d254bf16@mail.gmail.com>
	<4AEF32C2.8010208@lshift.net>
	<ce2570e20911021247j1dff6d88vef43dc0a005a5e5d@mail.gmail.com>
Message-ID: <k5zl73490u.fsf@mrbraver.lshift.net>

Hi Garrett,

Garrett Smith <g at rre.tt> writes:
> Rather than try to solve the dependency/ordering issue that's at the
> heart of this, I'd punt and just take the most defensible course:
>
> - Running the rabbitmq Erlang process is going to implicitly start
> epmd under the rabbit user. This is least surprising -- it's the way
> any Erlang process behaves.
>
> - Removing the rabbitmq-server package necessitates removal of the
> rabbit user, which necessitates stopping all of its processes. This is
> also pretty obvious.

I tend to agree that if we are killing epmd in order to remove the
rabbitmq user, then the right time to do it is immediately before the
deluser.  While it would be nice if we could have a rabbitmq-specific
epmd process that gets started and killed along with the rabbitmq
server, erlang doesn't currently make that easy to achieve.  I'll add
the issue to the rabbitmq tracking system.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From david.wragg at lshift.net  Tue Nov  3 21:02:33 2009
From: david.wragg at lshift.net (David Wragg)
Date: Tue, 03 Nov 2009 21:02:33 +0000
Subject: [rabbitmq-discuss] rabbitmq-server restart also restarts epmd
In-Reply-To: <4AEF4E8A.3040107@canonical.com> (Elliot Murphy's message of
	"Mon\, 02 Nov 2009 16\:26\:34 -0500")
References: <ce2570e20911021002u26650618i82e660ef5eec5d58@mail.gmail.com>
	<4AEF2314.8070208@lshift.net>
	<ce2570e20911021115ibe6dc76n96c68bb9d254bf16@mail.gmail.com>
	<4AEF32C2.8010208@lshift.net>
	<ce2570e20911021247j1dff6d88vef43dc0a005a5e5d@mail.gmail.com>
	<4AEF4E8A.3040107@canonical.com>
Message-ID: <k5y6mn4906.fsf@mrbraver.lshift.net>

Hi Elliot,

Elliot Murphy <elliot at canonical.com> writes:
> On 11/02/2009 03:47 PM, Garrett Smith wrote:
>  > - Removing the rabbitmq-server package necessitates removal of the
>> rabbit user, which necessitates stopping all of its processes. This is
>> also pretty obvious.
>
> CouchDB has faced similar issues.
>
> My understanding of Debian and Ubuntu policy/best practice is that
> packages should not remove system users that they have created.
>
> I didn't find where this is specified in debian policy, but here is a
> wiki page that describes some of the problems with removing system
> users: http://wiki.debian.org/AccountHandlingInMaintainerScripts

Thanks for the link.  That page contains an interesting collection of
both pros and cons of removing accounts, though it doesn't seem to
reach a definitive conclusion on the matter.

> What we have done for CouchDB in Ubuntu (at the insistence/encouragement
> of the core Ubuntu developers) is simply changed the package to not
> remove the CouchDB user, and I'd recommend the same change for RabbitMQ.

I still tend to think that removing the rabbitmq user account when
purging is the right thing to do.  Given that debian packages have
distinct 'remove' and 'purge' operations, it seems sensible to me that
'purge' should remove all traces of the package, and rabbitmq-server's
postrm script adheres to this (for example, when purging it deletes
all files that the package might have created, including log files
etc.).  If the administrator wants a less thorough removal of the
package, then that is exactly what the 'remove' operation is for.
Though I accept that my view might be influenced by our frequent need
to test the rabbitmq-server packages, which makes having 'purge'
return a system to a pristine state rabbit-wise particularly useful.

But naturally, if the Debian community reaches a consensus that
deleting users is never the right thing, then we will make our package
conform.  But it would be good to see a clear signal first, such as a
change to the debian-policy manual.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From mark.geib at echostar.com  Tue Nov  3 23:48:55 2009
From: mark.geib at echostar.com (Mark Geib)
Date: Tue, 03 Nov 2009 16:48:55 -0700
Subject: [rabbitmq-discuss] how do I change the connection timeout in the
	java client
Message-ID: <4AF0C167.6090401@echostar.com>

I need to be able to change the timeout for making a new connection to a
broker to a smaller time. I have not been able to find out how to do
this for the rabbitmq java client. Is there a way.??

Thanks,
Mark.
-- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD



From marcus at marcusirven.com  Wed Nov  4 00:24:17 2009
From: marcus at marcusirven.com (Marcus Irven)
Date: Tue, 3 Nov 2009 18:24:17 -0600
Subject: [rabbitmq-discuss] Problem running rabbitmqctl
Message-ID: <27d4903a0911031624k107d7ee9j766a79237ece185c@mail.gmail.com>

I've installed rabbitmq 1.6.0 via yum on two CentOS servers (one on
slicehost and the other on EC2) and I'm running rabbitmq as a service.  On
both servers I get an error when trying to run rabbitmqctl:

{"init terminating in
do_boot",{undef,[{rabbit_control,start,[]},{init,start_it,1},{init,start_em,1}]}}

Crash dump was written to: erl_crash.dump


Any help is appreciated.

Thanks,
Marcus
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091103/4bd1cebe/attachment.htm 

From mtodd at highgroove.com  Wed Nov  4 00:30:05 2009
From: mtodd at highgroove.com (Matt Todd)
Date: Tue, 3 Nov 2009 19:30:05 -0500
Subject: [rabbitmq-discuss] Problem running rabbitmqctl
In-Reply-To: <27d4903a0911031624k107d7ee9j766a79237ece185c@mail.gmail.com>
References: <27d4903a0911031624k107d7ee9j766a79237ece185c@mail.gmail.com>
Message-ID: <2a8d4a710911031630r12158039la8f29b87fe9c50c1@mail.gmail.com>

There's not enough information here to troubleshoot the problem. Do you mind
locating the log files (usually /var/log/rabbitmq/), specifically the
startup_err and startup_log files, and showing us the last few lines?

Matt



On Tue, Nov 3, 2009 at 7:24 PM, Marcus Irven <marcus at marcusirven.com> wrote:

> I've installed rabbitmq 1.6.0 via yum on two CentOS servers (one on
> slicehost and the other on EC2) and I'm running rabbitmq as a service.  On
> both servers I get an error when trying to run rabbitmqctl:
>
> {"init terminating in
> do_boot",{undef,[{rabbit_control,start,[]},{init,start_it,1},{init,start_em,1}]}}
>
> Crash dump was written to: erl_crash.dump
>
>
> Any help is appreciated.
>
> Thanks,
> Marcus
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>


-- 
Matt Todd
Highgroove Studios
www.highgroove.com
cell: 404-314-2612
blog: maraby.org

Scout - Web Monitoring and Reporting Software
www.scoutapp.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091103/4074371b/attachment.htm 

From marcus at marcusirven.com  Wed Nov  4 00:43:20 2009
From: marcus at marcusirven.com (Marcus Irven)
Date: Tue, 3 Nov 2009 18:43:20 -0600
Subject: [rabbitmq-discuss] Problem running rabbitmqctl
In-Reply-To: <2a8d4a710911031630r12158039la8f29b87fe9c50c1@mail.gmail.com>
References: <27d4903a0911031624k107d7ee9j766a79237ece185c@mail.gmail.com>
	<2a8d4a710911031630r12158039la8f29b87fe9c50c1@mail.gmail.com>
Message-ID: <27d4903a0911031643p589a3099xd5e39bf7fc25d0d2@mail.gmail.com>

On Tue, Nov 3, 2009 at 6:30 PM, Matt Todd <mtodd at highgroove.com> wrote:

> There's not enough information here to troubleshoot the problem. Do you
> mind locating the log files (usually /var/log/rabbitmq/), specifically the
> startup_err and startup_log files, and showing us the last few lines?
>
> Matt
>

I should point out that rabbitmq is working fine, I just can't use
rabbitmqctl.

# cat startup_err
# cat startup_log
Starting all nodes...
Starting node rabbit at marcusirven-1...
RabbitMQ 1.6.0 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node        : rabbit at marcusirven-1
log         : /var/log/rabbitmq/rabbit.log
sasl log    : /var/log/rabbitmq/rabbit-sasl.log
database dir: /var/lib/rabbitmq/mnesia/rabbit

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done

broker running
OK
done.


>
>
> On Tue, Nov 3, 2009 at 7:24 PM, Marcus Irven <marcus at marcusirven.com>wrote:
>
>> I've installed rabbitmq 1.6.0 via yum on two CentOS servers (one on
>> slicehost and the other on EC2) and I'm running rabbitmq as a service.  On
>> both servers I get an error when trying to run rabbitmqctl:
>>
>> {"init terminating in
>> do_boot",{undef,[{rabbit_control,start,[]},{init,start_it,1},{init,start_em,1}]}}
>>
>> Crash dump was written to: erl_crash.dump
>>
>>
>> Any help is appreciated.
>>
>> Thanks,
>> Marcus
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> --
> Matt Todd
> Highgroove Studios
> www.highgroove.com
> cell: 404-314-2612
> blog: maraby.org
>
> Scout - Web Monitoring and Reporting Software
> www.scoutapp.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091103/1a27dc8d/attachment.htm 

From mtodd at highgroove.com  Wed Nov  4 00:56:20 2009
From: mtodd at highgroove.com (Matt Todd)
Date: Tue, 3 Nov 2009 19:56:20 -0500
Subject: [rabbitmq-discuss] Problem running rabbitmqctl
In-Reply-To: <27d4903a0911031643p589a3099xd5e39bf7fc25d0d2@mail.gmail.com>
References: <27d4903a0911031624k107d7ee9j766a79237ece185c@mail.gmail.com> 
	<2a8d4a710911031630r12158039la8f29b87fe9c50c1@mail.gmail.com> 
	<27d4903a0911031643p589a3099xd5e39bf7fc25d0d2@mail.gmail.com>
Message-ID: <2a8d4a710911031656w26cb558cnb7b88bf4ec5d2ceb@mail.gmail.com>

On Tue, Nov 3, 2009 at 7:43 PM, Marcus Irven <marcus at marcusirven.com>wrote:
>
> I should point out that rabbitmq is working fine, I just can't use
> rabbitmqctl.
>

Interesting. I'm no expert, but things I would check first are the cookie
files matching correctly (if you have one in your home directory), the node
being set correctly (marcusirven-1... being set to localhost or generally
accessible by itself), or the node name being correctly set (rabbit, though
this looks just fine).

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091103/dc02c95b/attachment.htm 

From matthias at lshift.net  Wed Nov  4 10:05:49 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 04 Nov 2009 10:05:49 +0000
Subject: [rabbitmq-discuss] Problem running rabbitmqctl
In-Reply-To: <27d4903a0911031624k107d7ee9j766a79237ece185c@mail.gmail.com>
References: <27d4903a0911031624k107d7ee9j766a79237ece185c@mail.gmail.com>
Message-ID: <4AF151FD.9080904@lshift.net>

Marcis,

Marcus Irven wrote:
> I've installed rabbitmq 1.6.0 via yum on two CentOS servers (one on
> slicehost and the other on EC2) and I'm running rabbitmq as a service.
>  On both servers I get an error when trying to run rabbitmqctl:
> 
>     {"init terminating in
>     do_boot",{undef,[{rabbit_control,start,[]},{init,start_it,1},{init,start_em,1}]}}

The error indicates that rabbitmqctl cannot find the rabbit erlang
modules. Where did you install the server?

Btw, I recommend upgrading to RabbitMQ 1.7.0 - it is less sensitive to
install locations than previous releases.


Regards,

Matthias.



From rtrlists at googlemail.com  Wed Nov  4 10:08:08 2009
From: rtrlists at googlemail.com (Robert Raschke)
Date: Wed, 4 Nov 2009 10:08:08 +0000
Subject: [rabbitmq-discuss] Problem running rabbitmqctl
In-Reply-To: <27d4903a0911031624k107d7ee9j766a79237ece185c@mail.gmail.com>
References: <27d4903a0911031624k107d7ee9j766a79237ece185c@mail.gmail.com>
Message-ID: <6a3ae47e0911040208g2ee6418avd438e7a68f79c7fe@mail.gmail.com>

On Wed, Nov 4, 2009 at 12:24 AM, Marcus Irven <marcus at marcusirven.com>wrote:

> I've installed rabbitmq 1.6.0 via yum on two CentOS servers (one on
> slicehost and the other on EC2) and I'm running rabbitmq as a service.  On
> both servers I get an error when trying to run rabbitmqctl:
>
> {"init terminating in
> do_boot",{undef,[{rabbit_control,start,[]},{init,start_it,1},{init,start_em,1}]}}
>
> Crash dump was written to: erl_crash.dump
>
>
> Any help is appreciated.
>
>
The error means that rabbit_control:start() is a function that could not be
found by the Erlang runtime (it's undefined). I'm not sure how things are
installed for you (combined Erlang and Rabbit or just Rabbit making use of a
centrally installed Erlang). You could check the Erlang path settings in the
rabbitmqctl script to see if the Rabbit folders are included correctly.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091104/81fa32e5/attachment.htm 

From desrie.qi at wealthcraft.com  Wed Nov  4 10:31:08 2009
From: desrie.qi at wealthcraft.com (Desrie Qi)
Date: Wed, 4 Nov 2009 18:31:08 +0800
Subject: [rabbitmq-discuss]  API for Acess Control
Message-ID: <8F16BDCC98E64841857E711110AF5EDDF4D8A54497@EXMBX01.wealthcraft.local>

Please anyone who know the .NET APIs for permission control such as Setting user permissions and Clearing user permissions?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091104/9fa9ca1a/attachment.htm 

From robert.pogorzelski at gmail.com  Wed Nov  4 10:53:07 2009
From: robert.pogorzelski at gmail.com (Robert Pogorzelski)
Date: Wed, 4 Nov 2009 11:53:07 +0100
Subject: [rabbitmq-discuss] Problem running rabbitmqctl
In-Reply-To: <6a3ae47e0911040208g2ee6418avd438e7a68f79c7fe@mail.gmail.com>
References: <27d4903a0911031624k107d7ee9j766a79237ece185c@mail.gmail.com>
	<6a3ae47e0911040208g2ee6418avd438e7a68f79c7fe@mail.gmail.com>
Message-ID: <28AC8533-14A2-45F3-9A79-4B6667E423D2@gmail.com>

On Nov 4, 2009, at 11:08 AM, Robert Raschke wrote:
> On Wed, Nov 4, 2009 at 12:24 AM, Marcus Irven  
> <marcus at marcusirven.com> wrote:
> I've installed rabbitmq 1.6.0 via yum on two CentOS servers (one on  
> slicehost and the other on EC2) and I'm running rabbitmq as a  
> service.  On both servers I get an error when trying to run  
> rabbitmqctl:
[...]

Just to let you know that we managed to install RabbitMQ 1.6.0  
successfully on CentOS 5.3 using following:
$ sudo rpm -Uvh http://download.fedora.redhat.com/pub/epel/5/x86_64/epel-release-5-3.noarch.rpm
$ sudo yum install erlang
$ sudo yum install rabbitmq-server

Good luck,
Robert




From marcus at marcusirven.com  Wed Nov  4 14:00:01 2009
From: marcus at marcusirven.com (Marcus Irven)
Date: Wed, 4 Nov 2009 08:00:01 -0600
Subject: [rabbitmq-discuss] Problem running rabbitmqctl
In-Reply-To: <6a3ae47e0911040208g2ee6418avd438e7a68f79c7fe@mail.gmail.com>
References: <27d4903a0911031624k107d7ee9j766a79237ece185c@mail.gmail.com>
	<6a3ae47e0911040208g2ee6418avd438e7a68f79c7fe@mail.gmail.com>
Message-ID: <27d4903a0911040600j14624390j821b45b34afb412e@mail.gmail.com>

Ok, thanks everybody for your help. The problem is that I had installed
erlang several months ago by hand and yum also installed it in a different
location when installing rabbit. When I deleted the old version everything
started working.

Cheers!
Marcus

On Wed, Nov 4, 2009 at 4:08 AM, Robert Raschke <rtrlists at googlemail.com>wrote:

>
> On Wed, Nov 4, 2009 at 12:24 AM, Marcus Irven <marcus at marcusirven.com>wrote:
>
>> I've installed rabbitmq 1.6.0 via yum on two CentOS servers (one on
>> slicehost and the other on EC2) and I'm running rabbitmq as a service.  On
>> both servers I get an error when trying to run rabbitmqctl:
>>
>> {"init terminating in
>> do_boot",{undef,[{rabbit_control,start,[]},{init,start_it,1},{init,start_em,1}]}}
>>
>> Crash dump was written to: erl_crash.dump
>>
>>
>> Any help is appreciated.
>>
>>
> The error means that rabbit_control:start() is a function that could not be
> found by the Erlang runtime (it's undefined). I'm not sure how things are
> installed for you (combined Erlang and Rabbit or just Rabbit making use of a
> centrally installed Erlang). You could check the Erlang path settings in the
> rabbitmqctl script to see if the Rabbit folders are included correctly.
>
> Robby
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091104/fb3c02a6/attachment.htm 

From irrer at umich.edu  Wed Nov  4 14:52:44 2009
From: irrer at umich.edu (Jim Irrer)
Date: Wed, 4 Nov 2009 09:52:44 -0500
Subject: [rabbitmq-discuss] compatibility with legacy code
Message-ID: <3b6ef0790911040652s38dddee4hb37c2affb136f360@mail.gmail.com>

Greetings -

We are starting to use RabbitMQ but need to connect to
a legacy application written in C/C++ (about 2 million lines
of code).  Does anyone have any suggestions or experience
on how to do this?

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091104/afc522b5/attachment.htm 

From python.django.user at gmail.com  Wed Nov  4 15:33:20 2009
From: python.django.user at gmail.com (python.django.user)
Date: Wed, 4 Nov 2009 07:33:20 -0800 (PST)
Subject: [rabbitmq-discuss] os_mon/priv/bin/cpu_sup: No such file or
 directory
Message-ID: <26198338.post@talk.nabble.com>


Hi,

I downloaded the Erlang sources and did "./configre" followed by "make".

I then downloaded the genric unix version of RabbitMQ, and modified
rabbitmq-server to use the erl from above.

When I try to run the server using "./rabbitmq-server", it seems to run (I
see "broker running"), but I see the following errors in the console output:

sh: /home/someone/tmp/otp_src_R13B02-1/lib/os_mon/priv/bin/cpu_sup: No such
file or directory
sh: line 0: exec:
/home/someone/tmp/otp_src_R13B02-1/lib/os_mon/priv/bin/cpu_sup: cannot
execute: No such file or directory

Any ideas what this means, and whether/how I should fix this?


-- 
View this message in context: http://old.nabble.com/os_mon-priv-bin-cpu_sup%3A-No-such-file-or-directory-tp26198338p26198338.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From onelson at ringling.edu  Wed Nov  4 16:07:57 2009
From: onelson at ringling.edu (Owen Nelson)
Date: Wed, 04 Nov 2009 11:07:57 -0500
Subject: [rabbitmq-discuss] rabbit chokes?
Message-ID: <4AF1A6DD.40406@ringling.edu>

Hi all,
I've been running rabbitmq for some web services (limited intranet user
base) for about 6 months now and everything has been great... until
recently.

I started to notice that the rabbitmq service would randomly die. 
Digging through the logs I started to see messages like the following:

=INFO REPORT==== 1-Nov-2009::09:13:41 ===
starting TCP connection <0.27459.0> from 127.0.0.1:47608

=INFO REPORT==== 1-Nov-2009::09:13:41 ===
closing TCP connection <0.27459.0> from 127.0.0.1:47608

=INFO REPORT==== 1-Nov-2009::09:13:43 ===
    alarm_handler: {set,{system_memory_high_watermark,[]}}

=INFO REPORT==== 1-Nov-2009::09:13:44 ===
    alarm_handler: {clear,system_memory_high_watermark}

=INFO REPORT==== 1-Nov-2009::09:13:51 ===
Rolling persister log to
"/var/lib/rabbitmq/mnesia/rabbit/rabbit_persister.LOG.previous"

=INFO REPORT==== 1-Nov-2009::09:14:16 ===
    alarm_handler: {set,{system_memory_high_watermark,[]}}

=INFO REPORT==== 1-Nov-2009::09:14:17 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:47609

=INFO REPORT==== 1-Nov-2009::09:14:17 ===
starting TCP connection <0.27501.0> from 127.0.0.1:47609

=INFO REPORT==== 1-Nov-2009::09:14:17 ===
closing TCP connection <0.27501.0> from 127.0.0.1:47609

=INFO REPORT==== 1-Nov-2009::09:14:18 ===
    alarm_handler: {clear,system_memory_high_watermark}

=INFO REPORT==== 1-Nov-2009::09:14:19 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:47612

=INFO REPORT==== 1-Nov-2009::09:14:19 ===
starting TCP connection <0.27508.0> from 127.0.0.1:47612

=INFO REPORT==== 1-Nov-2009::09:14:19 ===
closing TCP connection <0.27508.0> from 127.0.0.1:47612

=INFO REPORT==== 1-Nov-2009::09:14:19 ===
    alarm_handler: {set,{system_memory_high_watermark,[]}}

=INFO REPORT==== 1-Nov-2009::09:14:22 ===
    alarm_handler: {clear,system_memory_high_watermark}


The server that is running the web application, and the rabbitmq service
rarely feels any kind of strain, so I'm having a hard time believing
that it's suffering from resource starvation.  Any ideas as to what I
can do to not have to jump start rabbitmq every couple days?

Regards,
Owen Nelson



From david.wragg at lshift.net  Wed Nov  4 16:24:51 2009
From: david.wragg at lshift.net (David Wragg)
Date: Wed, 04 Nov 2009 16:24:51 +0000
Subject: [rabbitmq-discuss] compatibility with legacy code
In-Reply-To: <3b6ef0790911040652s38dddee4hb37c2affb136f360@mail.gmail.com>
	(Jim Irrer's message of "Wed\, 4 Nov 2009 09\:52\:44 -0500")
References: <3b6ef0790911040652s38dddee4hb37c2affb136f360@mail.gmail.com>
Message-ID: <k5my3245rg.fsf@mrbraver.lshift.net>

Hi Jim,

Jim Irrer <irrer at umich.edu> writes:
> We are starting to use RabbitMQ but need to connect to
> a legacy application written in C/C++ (about 2 million lines
> of code).  Does anyone have any suggestions or experience
> on how to do this?

There's a C client for rabbitmq at
<http://hg.rabbitmq.com/rabbitmq-c/>.  It's marked as experimental,
but I think it's seen some real-world use already.  If you take a
look, I'm sure Tony would be interested in any feedback you have.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From jdc at hive7.com  Wed Nov  4 17:22:30 2009
From: jdc at hive7.com (JD Conley)
Date: Wed, 4 Nov 2009 09:22:30 -0800
Subject: [rabbitmq-discuss] intermittent erl.exe crash
Message-ID: <00eb01ca5d73$64079080$2c16b180$@com>

I'm running a Rabbitmq cluster on two Windows Server 2008 machines and am
having an issue with erl.exe crashing occasionally, which sometimes corrupts
the Rabbitmq database forcing me to delete it. Here is the output from
Windows event viewer:

 

Faulting application erl.exe, version 0.0.0.0, time stamp 0x491190a3,
faulting module beam.smp.dll, version 0.0.0.0, time stamp 0x49118fbd,
exception code 0x40000015, fault offset 0x00010831, process id 0x6e0,
application start time 0x01ca5ce1246bff61.

 

This was all installed using the Windows bundle version 1.7.0.

 

Any ideas where to start trying to track this down? I can provide logs,
system information, etc. I'm idling on the IRC channel if anyone wants to
discuss in real time.

 

Thanks,

JD

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091104/3691cb13/attachment.htm 

From lynton.grice at logosworld.com  Thu Nov  5 06:25:53 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Thu, 5 Nov 2009 08:25:53 +0200
Subject: [rabbitmq-discuss] Running Broker Query Langugae (BQL) on Windows -
	activation error
Message-ID: <000001ca5de0$d7271280$85753780$@grice@logosworld.com>

Hi there,

 

I decided to try out the BQL on my windows box to see how it all works. I
followed the installation instructions at
http://www.rabbitmq.com/rabbitmq-bql.html

And did copy the required .EZ files (amqp_client.ez, rabbitmq-bql.ez,
rfc4627_jsonrpc.ez) into the "plugins" folder of the RabbitMQ server.

 

But now when I run the "rabbitmq-activate-plugins.bat" file I get the
following error:

 

C:\tmp\erlang\rabbitmq-public-umbrella\rabbitmq-server\scripts>rabbitmq-acti
vate-plugins.bat

ERROR: generation of boot script file
C:/tmp/erlang/rabbitmq-public-umbrella/rabbitmq-server/scripts/../ebin/rabbi
t.script failed:

{{module_not_found,amqp_client,amqp_direct_driver},

 {amqp_direct_driver,'$$ignore$$',amqp_client,"0.0.0",

 
"c:/tmp/erlang/rabbitmq-public-umbrella/rabbitmq-server/scripts/../priv/plug
ins/amqp_client/ebin"}}

{{module_not_found,amqp_client,amqp_network_driver},

 {amqp_network_driver,'$$ignore$$',amqp_client,"0.0.0",

 
"c:/tmp/erlang/rabbitmq-public-umbrella/rabbitmq-server/scripts/../priv/plug
ins/amqp_client/ebin"}}

 

If I look inside the EZ files I cannot see the amqp_network_driver.beam or
the amqp_direct_driver.beam files? Any reason why they were not included in
the EZ file? 

 

I can add them in manually and modify the .app file for them, but that is
not the answer.

 

Any idea how I can solve this? Has anyone else got BQL working on Windows?

 

Thanks for the help

 

Lynton

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091105/18697e4a/attachment.htm 

From matthias at lshift.net  Thu Nov  5 09:12:46 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 05 Nov 2009 09:12:46 +0000
Subject: [rabbitmq-discuss] Making backups of RabbitMQ state?
In-Reply-To: <6a3ae47e0911030147u372d9f9dp54d4af835c0b6a5e@mail.gmail.com>
References: <6a3ae47e0911030147u372d9f9dp54d4af835c0b6a5e@mail.gmail.com>
Message-ID: <4AF2970E.2030603@lshift.net>

Robert,

Robert Raschke wrote:
> But for the persistant messages I am not so sure. How is the 
> rabbit_persister.LOG managed? Can I just take a backup copy of it 
> whenever, or may I only take one of the rabbit_persister.LOG.previous? 

I'd back up both files. It should be possible to restore the 
rabbit_persister.LOG from a backup even when that backup was taken in 
the middle of an append - I haven't tested that though. The .previous 
log is needed in case the backup takes place while the log is being rolled.

> Where would I look to find out how often it is rolled?

The logic for deciding when to roll the log is rather complex.

> Can I trigger a manual roll?

rabbit_persister:force_snapshot() in the Erlang shell does the trick.


Regards,

Matthias.



From matthias at lshift.net  Thu Nov  5 09:27:09 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 05 Nov 2009 09:27:09 +0000
Subject: [rabbitmq-discuss] how do I change the connection timeout in
 the	java client
In-Reply-To: <4AF0C167.6090401@echostar.com>
References: <4AF0C167.6090401@echostar.com>
Message-ID: <4AF29A6D.8030109@lshift.net>

Mark,

Mark Geib wrote:
> I need to be able to change the timeout for making a new connection to a
> broker to a smaller time. I have not been able to find out how to do
> this for the rabbitmq java client. Is there a way.??

Unfortunately javax.net.SocketFactory and its default implementations in 
the JDK, which is what the Java client is using, do not appear to 
support the setting of a connection timeout.

You could write your own implementation of the SocketFactory interface 
that creates sockets with a connection timeout, and supply instances of 
that implementation to com.rabbitmq.client.ConnectionFactory's 
setSocketFactory method.


Regards,

Matthias.



From matthias at lshift.net  Thu Nov  5 09:34:32 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 05 Nov 2009 09:34:32 +0000
Subject: [rabbitmq-discuss] os_mon/priv/bin/cpu_sup: No such file or
	directory
In-Reply-To: <26198338.post@talk.nabble.com>
References: <26198338.post@talk.nabble.com>
Message-ID: <4AF29C28.300@lshift.net>

Hi,

python.django.user wrote:
> When I try to run the server using "./rabbitmq-server", it seems to run (I
> see "broker running"), but I see the following errors in the console output:
> 
> sh: /home/someone/tmp/otp_src_R13B02-1/lib/os_mon/priv/bin/cpu_sup: No such
> file or directory
> sh: line 0: exec:
> /home/someone/tmp/otp_src_R13B02-1/lib/os_mon/priv/bin/cpu_sup: cannot
> execute: No such file or directory

It looks like your Erlang installation is incomplete - the cpu_sup 
executable mentioned in the error should have been constructed when you 
built Erlang.


Regards,

Matthias.




From 0x6e6562 at gmail.com  Thu Nov  5 09:36:11 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 5 Nov 2009 09:36:11 +0000
Subject: [rabbitmq-discuss] Running Broker Query Langugae (BQL) on
	Windows - activation error
In-Reply-To: <-7446867022505221429@unknownmsgid>
References: <-7446867022505221429@unknownmsgid>
Message-ID: <269388e30911050136u24c0475dib4f13b23522f801a@mail.gmail.com>

Lynton,

On Thu, Nov 5, 2009 at 6:25 AM, Lynton Grice
<lynton.grice at logosworld.com> wrote:
> {{module_not_found,amqp_client,amqp_direct_driver},

This is a bug in the current mainline version of the Erlang client.
Basically we refactored the client and nuked the *_driver modules, but
forgot to pull it straight in the .app file :-) So we'll just
synchronize the .app file and update the default version.

Cheers,

Ben



From matthias at lshift.net  Thu Nov  5 09:38:27 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 05 Nov 2009 09:38:27 +0000
Subject: [rabbitmq-discuss] rabbit chokes?
In-Reply-To: <4AF1A6DD.40406@ringling.edu>
References: <4AF1A6DD.40406@ringling.edu>
Message-ID: <4AF29D13.3000205@lshift.net>

Owen,

Owen Nelson wrote:
> =INFO REPORT==== 1-Nov-2009::09:13:43 ===
>     alarm_handler: {set,{system_memory_high_watermark,[]}}
> 
> =INFO REPORT==== 1-Nov-2009::09:13:44 ===
>     alarm_handler: {clear,system_memory_high_watermark}

These messages indicate that rabbit is running low on memory and is 
attempting to throttle producers.

I recommend checking the status of your rabbit using the 'rabbitmqctl 
list_* ...' commands. Chances are you have lots of messages in queues, 
or perhaps lots of queues, exchanges or bindings.


Regards,

Matthias.



From matthias at lshift.net  Thu Nov  5 09:43:00 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 05 Nov 2009 09:43:00 +0000
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <00eb01ca5d73$64079080$2c16b180$@com>
References: <00eb01ca5d73$64079080$2c16b180$@com>
Message-ID: <4AF29E24.4080701@lshift.net>

JD,

JD Conley wrote:
> I'm running a Rabbitmq cluster on two Windows Server 2008 machines and 
> am having an issue with erl.exe crashing occasionally, which sometimes 
> corrupts the Rabbitmq database forcing me to delete it. Here is the 
> output from Windows event viewer:
> 
> Faulting application erl.exe, version 0.0.0.0, time stamp 0x491190a3, 
> faulting module beam.smp.dll, version 0.0.0.0, time stamp 0x49118fbd, 
> exception code 0x40000015, fault offset 0x00010831, process id 0x6e0, 
> application start time 0x01ca5ce1246bff61.

That error doesn't tell us much :(

Did Erlang write a erl_crash.dump file? If so, that should provide some 
clues as to the cause.

Also, is there anything unusual at all in the rabbit logs?


Regards,

Matthias.



From lynton.grice at logosworld.com  Thu Nov  5 09:51:16 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Thu, 5 Nov 2009 11:51:16 +0200
Subject: [rabbitmq-discuss] Running Broker Query Langugae (BQL) on
	Windows - activation error
In-Reply-To: <269388e30911050136u24c0475dib4f13b23522f801a@mail.gmail.com>
References: <-7446867022505221429@unknownmsgid>
	<269388e30911050136u24c0475dib4f13b23522f801a@mail.gmail.com>
Message-ID: <000e01ca5dfd$891bccd0$9b536670$@grice@logosworld.com>

Hi Ben,

Does that mean I need to download the "umbrella" again with everything or
can I simply download the client?

Can you let me know when it is done?

Also, and forgive me for the stupid question but let's say I download the
latest client with something like:

http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/rabbitmq_v1_6_0.zip

My question is how do I know if a new ZIP file has been uploaded?

Thanks for the help

Lynton

-----Original Message-----
From: Ben Hood [mailto:0x6e6562 at gmail.com] 
Sent: 05 November 2009 11:36 AM
To: Lynton Grice
Cc: rabbitmq
Subject: Re: [rabbitmq-discuss] Running Broker Query Langugae (BQL) on
Windows - activation error

Lynton,

On Thu, Nov 5, 2009 at 6:25 AM, Lynton Grice
<lynton.grice at logosworld.com> wrote:
> {{module_not_found,amqp_client,amqp_direct_driver},

This is a bug in the current mainline version of the Erlang client.
Basically we refactored the client and nuked the *_driver modules, but
forgot to pull it straight in the .app file :-) So we'll just
synchronize the .app file and update the default version.

Cheers,

Ben




From onelson at ringling.edu  Thu Nov  5 14:22:12 2009
From: onelson at ringling.edu (Owen Nelson)
Date: Thu, 05 Nov 2009 09:22:12 -0500
Subject: [rabbitmq-discuss] rabbit chokes?
In-Reply-To: <4AF29D13.3000205@lshift.net>
References: <4AF1A6DD.40406@ringling.edu> <4AF29D13.3000205@lshift.net>
Message-ID: <4AF2DF94.1040003@ringling.edu>

Perhaps this is the culprit?

rabbitmqctl list_queues -p gmate_test
Listing queues ...
celerygraph     277558
celery  0
...done.

What's the best way to clear that out?  Looking at the man page for
rabbitmqctl, the only thing I see that would potentially do it would be
to reset the node, then rebuild the vhosts/users.  Is that the only way?


Matthias Radestock wrote:
> Owen,
>
> Owen Nelson wrote:
>> =INFO REPORT==== 1-Nov-2009::09:13:43 ===
>>     alarm_handler: {set,{system_memory_high_watermark,[]}}
>>
>> =INFO REPORT==== 1-Nov-2009::09:13:44 ===
>>     alarm_handler: {clear,system_memory_high_watermark}
>
> These messages indicate that rabbit is running low on memory and is
> attempting to throttle producers.
>
> I recommend checking the status of your rabbit using the 'rabbitmqctl
> list_* ...' commands. Chances are you have lots of messages in queues,
> or perhaps lots of queues, exchanges or bindings.
>
>
> Regards,
>
> Matthias.



From 0x6e6562 at gmail.com  Thu Nov  5 14:26:30 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 5 Nov 2009 14:26:30 +0000
Subject: [rabbitmq-discuss] Running Broker Query Langugae (BQL) on
	Windows - activation error
In-Reply-To: <-2693059666065668418@unknownmsgid>
References: <-7446867022505221429@unknownmsgid>
	<269388e30911050136u24c0475dib4f13b23522f801a@mail.gmail.com>
	<-2693059666065668418@unknownmsgid>
Message-ID: <269388e30911050626t4fe09162geb75f6c2a1c4d6cd@mail.gmail.com>

Lynton,

On Thu, Nov 5, 2009 at 9:51 AM, Lynton Grice
<lynton.grice at logosworld.com> wrote:
> Does that mean I need to download the "umbrella" again with everything or
> can I simply download the client?

Did you check out the umbrella using hg?

> Can you let me know when it is done?

It's done now.

> Also, and forgive me for the stupid question but let's say I download the
> latest client with something like:
>
> http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/rabbitmq_v1_6_0.zip
>
> My question is how do I know if a new ZIP file has been uploaded?

That download is a dynamically generated by the hgweb CGI script.

BTW, the 1.6.0 tag is a bit crufty - you will probably fair better by
taking the head of the default branch, i.e.
http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/default.zip

Ben



From 0x6e6562 at gmail.com  Thu Nov  5 14:28:14 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 5 Nov 2009 14:28:14 +0000
Subject: [rabbitmq-discuss] rabbit-erlang-client/ebin/amqp_client.app.in
	refers to non existant files
In-Reply-To: <FC84AB94-3D3E-4908-B500-83B13718F6EE@epicadvertising.com>
References: <8A1AF416-6685-4E3B-A346-73D671A00E42@epicadvertising.com>
	<269388e30910301014m1bfea81epdb3e8da58091e921@mail.gmail.com>
	<FC84AB94-3D3E-4908-B500-83B13718F6EE@epicadvertising.com>
Message-ID: <269388e30911050628i3eac6748nfb58a7daef2a4c74@mail.gmail.com>

Scott,

On Fri, Oct 30, 2009 at 5:19 PM, Scott Brooks
<scott.brooks at epicadvertising.com> wrote:
> I've got a plugin I'm working on that is not loading due to that which
> is how I ran across it.

Sorry about the long delay for pushing out a 2 second fix - it's now
in the default branch.

Cheers,

Ben



From igor at goryachev.org  Thu Nov  5 14:35:52 2009
From: igor at goryachev.org (Igor Goryachev)
Date: Thu, 05 Nov 2009 17:35:52 +0300
Subject: [rabbitmq-discuss] a possibility of AMQP/RabbitMQ extension?
Message-ID: <87pr7x9gzb.fsf@goryachev.org>

Hello, everyone!

I am very new to AMQP/RabbitMQ and have several (well, mostly
newbie) questions:

0. is it safe to extend AMQP for customer needs (in such way as XMPP
permits to do)?

1. is it possible to use AMQP broker as a sort of key-value storage
instance? Or it seems to be a really bad idea which doesn't match
AMQP pattern?

Thanks.


-- 
    Igor Goryachev              E-Mail/Jabber: igor at goryachev.org



From alexis.richardson at gmail.com  Thu Nov  5 14:58:37 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 5 Nov 2009 14:58:37 +0000
Subject: [rabbitmq-discuss] a possibility of AMQP/RabbitMQ extension?
In-Reply-To: <87pr7x9gzb.fsf@goryachev.org>
References: <87pr7x9gzb.fsf@goryachev.org>
Message-ID: <167204d20911050658v5a131ad5u339dbac5250eea52@mail.gmail.com>

On Thu, Nov 5, 2009 at 2:35 PM, Igor Goryachev <igor at goryachev.org> wrote:
> Hello, everyone!
>
> I am very new to AMQP/RabbitMQ and have several (well, mostly
> newbie) questions:
>
> 0. is it safe to extend AMQP for customer needs (in such way as XMPP
> permits to do)?

I am not sure about XMPP permits *but*

1. AMQP is 'programmable' so you can set up lots of messaging
applications by customer need.

2. You can write custom routers aka "exchanges" eg for content based routing

3. RabbitMQ supports plugins, see eg
http://www.lshift.net/blog/2009/10/26/http-routing-with-rabbitmq-and-trapeze



> 1. is it possible to use AMQP broker as a sort of key-value storage
> instance? Or it seems to be a really bad idea which doesn't match
> AMQP pattern?

AMQP has destructive reads ie. 'get message', whereas with a long term
store you want non-destructive reads.  So, currently I would say No to
that.  It's an interesting idea though.

alexis




>
> --
> ? ?Igor Goryachev ? ? ? ? ? ? ?E-Mail/Jabber: igor at goryachev.org
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From 0x6e6562 at gmail.com  Thu Nov  5 15:18:17 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 5 Nov 2009 15:18:17 +0000
Subject: [rabbitmq-discuss] rabbit-erlang-client/ebin/amqp_client.app.in
	refers to non existant files
Message-ID: <269388e30911050718g2e7ba54evd98b9fd256927c63@mail.gmail.com>

How a proper broker deals with resource constraints :-)

---------- Forwarded message ----------
From:  <postmaster at collaborationhost.net>
Date: Thu, Nov 5, 2009 at 2:26 PM
Subject: Undeliverable: Re: [rabbitmq-discuss]
rabbit-erlang-client/ebin/amqp_client.app.in 	refers to non existant
files
To: 0x6e6562 at gmail.com


Delivery has failed to these recipients or distribution lists:

Scott Brooks
The recipient's mailbox is full and can't accept messages now.
Microsoft Exchange will not try to redeliver this message for you.
Please try resending this message later, or contact the recipient
directly.

________________________________
Sent by Microsoft Exchange Server 2007





Diagnostic information for administrators:

Generating server: collaborationhost.net

scott.brooks at epicadvertising.com
#550 5.2.2 STOREDRV.Deliver: mailbox full. The following information
should help identify the cause:
"MapiExceptionShutoffQuotaExceeded:16.18969:B8000000,
17.27161:0000000094000000000000000000000000000000, 255.23226:C2220000,
255.27962:FE000000, 255.17082:DD040000, 0.26937:08000000,
4.21921:DD040000, 255.27962:FA000000, 255.1494:00000000,
255.26426:FE000000, 4.7588:0F010480, 4.6564:0F010480, 4.4740:05000780,
4.6276:05000780, 4.5721:DD040000, 4.6489:DD040000, 4.2199:DD040000,
4.17097:DD040000, 4.8620:DD040000, 255.1750:2F400000,
0.26849:00000000, 255.21817:DD040000, 0.26297:00000000,
4.16585:DD040000, 0.32441:2D000000, 4.1706:DD040000, 0.24761:632A0000,
4.20665:DD040000, 0.25785:00000000, 4.29881:DD040000". ##

Original message headers:

Received: from p01c11m002.mxlogic.net (10.2.3.199) by
 in005.collaborationhost.net (10.2.0.231) with Microsoft SMTP Server (TLS) id
 8.1.336.0; Thu, 5 Nov 2009 08:26:31 -0600
Received: from unknown [209.85.210.200] (EHLO mail-yx0-f200.google.com)	by
 p01c11m002.mxlogic.net(mxl_mta-6.4.0-2)	with ESMTP id
 001e2fa4.0.68619.00-116.101372.p01c11m002.mxlogic.net (envelope-from
 <0x6e6562 at gmail.com>);	Thu, 05 Nov 2009 07:28:16 -0700 (MST)
Received: by yxe38 with SMTP id 38so110422yxe.6        for
 <scott.brooks at epicadvertising.com>; Thu, 05 Nov 2009 06:28:15 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:message-id:subject:from:to:cc:content-type;
        bh=VUS4tQlBNKBz4b/DCu2JaTjknJNVAkaBkeRVuAr0iOk=;
        b=Tl2UaJWD6SN7887k56kDpVHQzyuGta/pEdKujzJSI3UrgtcQ/zya79cp9aoeUYla1H
         aBJ+9ev/SDSlTlnAJ5+Gc1xefn8YqYKzCFBeGqlUiX1gEZlxm9OcuODO59aJFbl//FmG
         j8aXH7/OHI1of6Pyy+aWdMyVK2weOcW5+lMgU=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :cc:content-type;
        b=p9W95tVJ5xDsnt/3EcdXlB4GMcPkUQ2Z6hyUIFNJhrGBCehzDij+v6bciNNh2GQwbU
         0rinRA0E2kriw9Eugi+8X2Sje2elojP3fJ2YN1bX1SXYSizG6qH4bnx3WxJH1AhiSSRW
         AFIdCWp2MfEl6acsAJJEZfnmNPpyfGFbGMM98=
MIME-Version: 1.0
Received: by 10.91.28.9 with SMTP id f9mr6326643agj.89.1257431294992; Thu, 05
 	Nov 2009 06:28:14 -0800 (PST)
In-Reply-To: <FC84AB94-3D3E-4908-B500-83B13718F6EE at epicadvertising.com>
References: <8A1AF416-6685-4E3B-A346-73D671A00E42 at epicadvertising.com>
	 <269388e30910301014m1bfea81epdb3e8da58091e921 at mail.gmail.com>
	 <FC84AB94-3D3E-4908-B500-83B13718F6EE at epicadvertising.com>
Date: Thu, 5 Nov 2009 14:28:14 +0000
Message-ID: <269388e30911050628i3eac6748nfb58a7daef2a4c74 at mail.gmail.com>
Subject: Re: [rabbitmq-discuss] rabbit-erlang-client/ebin/amqp_client.app.in
	refers to non existant files
From: Ben Hood <0x6e6562 at gmail.com>
To: Scott Brooks <scott.brooks at epicadvertising.com>
CC: "rabbitmq-discuss at lists.rabbitmq.com"
	<rabbitmq-discuss at lists.rabbitmq.com>
Content-Type: text/plain; charset="ISO-8859-1"
X-Spam: exempt
X-MAIL-FROM: <0x6e6562 at gmail.com>
X-SOURCE-IP: [209.85.210.200]
Return-Path: 0x6e6562 at gmail.com

Final-Recipient: rfc822;scott.brooks at epicadvertising.com
Action: failed
Status: 5.2.2
Diagnostic-Code: smtp;550 5.2.2 STOREDRV.Deliver: mailbox full. The
following information should help identify the cause:
"MapiExceptionShutoffQuotaExceeded:16.18969:B8000000,
17.27161:0000000094000000000000000000000000000000, 255.23226:C2220000,
255.27962:FE000000, 255.17082:DD040000, 0.26937:08000000,
4.21921:DD040000, 255.27962:FA000000, 255.1494:00000000,
255.26426:FE000000, 4.7588:0F010480, 4.6564:0F010480, 4.4740:05000780,
4.6276:05000780, 4.5721:DD040000, 4.6489:DD040000, 4.2199:DD040000,
4.17097:DD040000, 4.8620:DD040000, 255.1750:2F400000,
0.26849:00000000, 255.21817:DD040000, 0.26297:00000000,
4.16585:DD040000, 0.32441:2D000000, 4.1706:DD040000, 0.24761:632A0000,
4.20665:DD040000, 0.25785:00000000, 4.29881:DD040000".
X-Display-Name: Scott Brooks



---------- Forwarded message ----------
From:?Ben Hood <0x6e6562 at gmail.com>
To:?Scott Brooks <scott.brooks at epicadvertising.com>
Date:?Thu, 5 Nov 2009 14:28:14 +0000
Subject:?Re: [rabbitmq-discuss]
rabbit-erlang-client/ebin/amqp_client.app.in refers to non existant
files
Scott,

On Fri, Oct 30, 2009 at 5:19 PM, Scott Brooks
<scott.brooks at epicadvertising.com> wrote:
> I've got a plugin I'm working on that is not loading due to that which
> is how I ran across it.

Sorry about the long delay for pushing out a 2 second fix - it's now
in the default branch.

Cheers,

Ben



From pauljones23 at gmail.com  Thu Nov  5 15:47:08 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Thu, 5 Nov 2009 15:47:08 +0000
Subject: [rabbitmq-discuss] rabbit chokes?
In-Reply-To: <4AF2DF94.1040003@ringling.edu>
References: <4AF1A6DD.40406@ringling.edu> <4AF29D13.3000205@lshift.net>
	<4AF2DF94.1040003@ringling.edu>
Message-ID: <29598b610911050747qf43fafan1d7e1fac9164d6ca@mail.gmail.com>

Hi Owen,

You've got two options for this. Either you can write a client app to do a
queue purge, or you can install the BQL plugin which provides a console that
you can execute commands on.

The page at http://www.rabbitmq.com/rabbitmq-bql.html#installation discusses
installation of this plugin - once you've done that, you should be able to
execute a command such as:
  BQL> purge queue celerygraph;

Thanks,
Paul.

On Thu, Nov 5, 2009 at 2:22 PM, Owen Nelson <onelson at ringling.edu> wrote:

> Perhaps this is the culprit?
>
> rabbitmqctl list_queues -p gmate_test
> Listing queues ...
> celerygraph     277558
> celery  0
> ...done.
>
> What's the best way to clear that out?  Looking at the man page for
> rabbitmqctl, the only thing I see that would potentially do it would be
> to reset the node, then rebuild the vhosts/users.  Is that the only way?
>
>
> Matthias Radestock wrote:
> > Owen,
> >
> > Owen Nelson wrote:
> >> =INFO REPORT==== 1-Nov-2009::09:13:43 ===
> >>     alarm_handler: {set,{system_memory_high_watermark,[]}}
> >>
> >> =INFO REPORT==== 1-Nov-2009::09:13:44 ===
> >>     alarm_handler: {clear,system_memory_high_watermark}
> >
> > These messages indicate that rabbit is running low on memory and is
> > attempting to throttle producers.
> >
> > I recommend checking the status of your rabbit using the 'rabbitmqctl
> > list_* ...' commands. Chances are you have lots of messages in queues,
> > or perhaps lots of queues, exchanges or bindings.
> >
> >
> > Regards,
> >
> > Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091105/003589e0/attachment.htm 

From pauljones23 at gmail.com  Thu Nov  5 15:54:06 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Thu, 5 Nov 2009 15:54:06 +0000
Subject: [rabbitmq-discuss] rabbit chokes?
In-Reply-To: <29598b610911050747qf43fafan1d7e1fac9164d6ca@mail.gmail.com>
References: <4AF1A6DD.40406@ringling.edu> <4AF29D13.3000205@lshift.net>
	<4AF2DF94.1040003@ringling.edu>
	<29598b610911050747qf43fafan1d7e1fac9164d6ca@mail.gmail.com>
Message-ID: <29598b610911050754r363db7f4x3819efe761516c09@mail.gmail.com>

Unfortunately, its just been pointed out to me that you are using a
non-default vhost which the BQL tool currently can't do. So perhaps it won't
be useful in your situation at this point in time. Sorry about that.

On Thu, Nov 5, 2009 at 3:47 PM, Paul Jones <pauljones23 at gmail.com> wrote:

> Hi Owen,
>
> You've got two options for this. Either you can write a client app to do a
> queue purge, or you can install the BQL plugin which provides a console that
> you can execute commands on.
>
> The page at http://www.rabbitmq.com/rabbitmq-bql.html#installationdiscusses installation of this plugin - once you've done that, you should be
> able to execute a command such as:
>   BQL> purge queue celerygraph;
>
> Thanks,
> Paul.
>
>
> On Thu, Nov 5, 2009 at 2:22 PM, Owen Nelson <onelson at ringling.edu> wrote:
>
>> Perhaps this is the culprit?
>>
>> rabbitmqctl list_queues -p gmate_test
>> Listing queues ...
>> celerygraph     277558
>> celery  0
>> ...done.
>>
>> What's the best way to clear that out?  Looking at the man page for
>> rabbitmqctl, the only thing I see that would potentially do it would be
>> to reset the node, then rebuild the vhosts/users.  Is that the only way?
>>
>>
>> Matthias Radestock wrote:
>> > Owen,
>> >
>> > Owen Nelson wrote:
>> >> =INFO REPORT==== 1-Nov-2009::09:13:43 ===
>> >>     alarm_handler: {set,{system_memory_high_watermark,[]}}
>> >>
>> >> =INFO REPORT==== 1-Nov-2009::09:13:44 ===
>> >>     alarm_handler: {clear,system_memory_high_watermark}
>> >
>> > These messages indicate that rabbit is running low on memory and is
>> > attempting to throttle producers.
>> >
>> > I recommend checking the status of your rabbit using the 'rabbitmqctl
>> > list_* ...' commands. Chances are you have lots of messages in queues,
>> > or perhaps lots of queues, exchanges or bindings.
>> >
>> >
>> > Regards,
>> >
>> > Matthias.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091105/1627f774/attachment.htm 

From onelson at ringling.edu  Thu Nov  5 15:55:25 2009
From: onelson at ringling.edu (Owen Nelson)
Date: Thu, 05 Nov 2009 10:55:25 -0500
Subject: [rabbitmq-discuss] rabbit chokes?
In-Reply-To: <29598b610911050754r363db7f4x3819efe761516c09@mail.gmail.com>
References: <4AF1A6DD.40406@ringling.edu> <4AF29D13.3000205@lshift.net>	
	<4AF2DF94.1040003@ringling.edu>	
	<29598b610911050747qf43fafan1d7e1fac9164d6ca@mail.gmail.com>
	<29598b610911050754r363db7f4x3819efe761516c09@mail.gmail.com>
Message-ID: <4AF2F56D.9020002@ringling.edu>

Yeah, I use 2 separate vhosts, one for development and one for
production.  Good to know!

Paul Jones wrote:
> Unfortunately, its just been pointed out to me that you are using a
> non-default vhost which the BQL tool currently can't do. So perhaps it
> won't be useful in your situation at this point in time. Sorry about that.
>
> On Thu, Nov 5, 2009 at 3:47 PM, Paul Jones <pauljones23 at gmail.com
> <mailto:pauljones23 at gmail.com>> wrote:
>
>     Hi Owen,
>
>     You've got two options for this. Either you can write a client app
>     to do a queue purge, or you can install the BQL plugin which
>     provides a console that you can execute commands on.
>
>     The page at http://www.rabbitmq.com/rabbitmq-bql.html#installation
>     discusses installation of this plugin - once you've done that, you
>     should be able to execute a command such as:
>       BQL> purge queue celerygraph;
>
>     Thanks,
>     Paul.
>
>
>     On Thu, Nov 5, 2009 at 2:22 PM, Owen Nelson <onelson at ringling.edu
>     <mailto:onelson at ringling.edu>> wrote:
>
>         Perhaps this is the culprit?
>
>         rabbitmqctl list_queues -p gmate_test
>         Listing queues ...
>         celerygraph     277558
>         celery  0
>         ...done.
>
>         What's the best way to clear that out?  Looking at the man
>         page for
>         rabbitmqctl, the only thing I see that would potentially do it
>         would be
>         to reset the node, then rebuild the vhosts/users.  Is that the
>         only way?
>
>
>         Matthias Radestock wrote:
>         > Owen,
>         >
>         > Owen Nelson wrote:
>         >> =INFO REPORT==== 1-Nov-2009::09:13:43 ===
>         >>     alarm_handler: {set,{system_memory_high_watermark,[]}}
>         >>
>         >> =INFO REPORT==== 1-Nov-2009::09:13:44 ===
>         >>     alarm_handler: {clear,system_memory_high_watermark}
>         >
>         > These messages indicate that rabbit is running low on memory
>         and is
>         > attempting to throttle producers.
>         >
>         > I recommend checking the status of your rabbit using the
>         'rabbitmqctl
>         > list_* ...' commands. Chances are you have lots of messages
>         in queues,
>         > or perhaps lots of queues, exchanges or bindings.
>         >
>         >
>         > Regards,
>         >
>         > Matthias.
>
>         _______________________________________________
>         rabbitmq-discuss mailing list
>         rabbitmq-discuss at lists.rabbitmq.com
>         <mailto:rabbitmq-discuss at lists.rabbitmq.com>
>         http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>



From mark.geib at echostar.com  Thu Nov  5 16:15:22 2009
From: mark.geib at echostar.com (Mark Geib)
Date: Thu, 05 Nov 2009 09:15:22 -0700
Subject: [rabbitmq-discuss] how do I change the connection timeout in
 the	java client
In-Reply-To: <4AF29A6D.8030109@lshift.net>
References: <4AF0C167.6090401@echostar.com> <4AF29A6D.8030109@lshift.net>
Message-ID: <4AF2FA1A.5060305@echostar.com>

Thanks for the reply, darn.

Have you looked at XSocket. We have used it extensively, and it is very
flexible...

Mark.

Matthias Radestock wrote:
> Mark,
> 
> Mark Geib wrote:
>> I need to be able to change the timeout for making a new connection to a
>> broker to a smaller time. I have not been able to find out how to do
>> this for the rabbitmq java client. Is there a way.??
> 
> Unfortunately javax.net.SocketFactory and its default implementations in
> the JDK, which is what the Java client is using, do not appear to
> support the setting of a connection timeout.
> 
> You could write your own implementation of the SocketFactory interface
> that creates sockets with a connection timeout, and supply instances of
> that implementation to com.rabbitmq.client.ConnectionFactory's
> setSocketFactory method.
> 
> 
> Regards,
> 
> Matthias.
> 

-- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD



From askh at opera.com  Thu Nov  5 16:21:35 2009
From: askh at opera.com (Ask Solem)
Date: Thu, 5 Nov 2009 17:21:35 +0100
Subject: [rabbitmq-discuss] rabbit chokes?
In-Reply-To: <29598b610911050747qf43fafan1d7e1fac9164d6ca@mail.gmail.com>
References: <4AF1A6DD.40406@ringling.edu> <4AF29D13.3000205@lshift.net>
	<4AF2DF94.1040003@ringling.edu>
	<29598b610911050747qf43fafan1d7e1fac9164d6ca@mail.gmail.com>
Message-ID: <00399AF1-563C-443B-95E8-EE4626485ED8@opera.com>


On Nov 5, 2009, at 4:47 PM, Paul Jones wrote:

>
> celerygraph     277558


You're running celeryd with the --statistics option on.
http://ask.github.com/celery/reference/celery.bin.celeryd.html#cmdoption-celeryd-s

If you're going to use this feature, you have to flush the events from  
time to time (consume it to generate
the statistics)

     from celery.monitoring import StatsCollector
     s = StatsCollector()
     s.collect()
     s.dump()

But chances are, if you didn't know this, you are probably using it by  
accident.


-- 
Ask Solem
Opera Software, Web Team
askh at opera.com



From igor at goryachev.org  Thu Nov  5 16:28:00 2009
From: igor at goryachev.org (Igor Goryachev)
Date: Thu, 05 Nov 2009 19:28:00 +0300
Subject: [rabbitmq-discuss] a possibility of AMQP/RabbitMQ extension?
In-Reply-To: <167204d20911050658v5a131ad5u339dbac5250eea52@mail.gmail.com>
	(Alexis Richardson's message of "Thu, 5 Nov 2009 14:58:37 +0000")
References: <87pr7x9gzb.fsf@goryachev.org>
	<167204d20911050658v5a131ad5u339dbac5250eea52@mail.gmail.com>
Message-ID: <87ljil7x7z.fsf@goryachev.org>

Alexis Richardson <alexis.richardson at gmail.com> writes:

> 1. AMQP is 'programmable' so you can set up lots of messaging
> applications by customer need.

BTW, is it safe to implement i.e. custom methods or some other 'core'
features?

> 2. You can write custom routers aka "exchanges" eg for content based routing
>
> 3. RabbitMQ supports plugins, see eg
> http://www.lshift.net/blog/2009/10/26/http-routing-with-rabbitmq-and-trapeze

Ok. I have already played a bit with rabbit's plugin API inside
'umbrella' development environment. It seems to be fine enough and
really works for me.

> AMQP has destructive reads ie. 'get message', whereas with a long term
> store you want non-destructive reads.  So, currently I would say No to
> that.  It's an interesting idea though.

Well, then we will use real kv-database for this kind of task (at least
for now) and continue using rabbitmq as our middleware service.

Thank you very much for such a quick answer!


-- 
    Igor Goryachev              E-Mail/Jabber: igor at goryachev.org



From onelson at ringling.edu  Thu Nov  5 16:29:09 2009
From: onelson at ringling.edu (Owen Nelson)
Date: Thu, 05 Nov 2009 11:29:09 -0500
Subject: [rabbitmq-discuss] rabbit chokes?
In-Reply-To: <00399AF1-563C-443B-95E8-EE4626485ED8@opera.com>
References: <4AF1A6DD.40406@ringling.edu>
	<4AF29D13.3000205@lshift.net>	<4AF2DF94.1040003@ringling.edu>	<29598b610911050747qf43fafan1d7e1fac9164d6ca@mail.gmail.com>
	<00399AF1-563C-443B-95E8-EE4626485ED8@opera.com>
Message-ID: <4AF2FD55.8000409@ringling.edu>

Great catch - thanks Solem.  Disabling the stat output now.

Ask Solem wrote:
> On Nov 5, 2009, at 4:47 PM, Paul Jones wrote:
>
>   
>> celerygraph     277558
>>     
>
>
> You're running celeryd with the --statistics option on.
> http://ask.github.com/celery/reference/celery.bin.celeryd.html#cmdoption-celeryd-s
>
> If you're going to use this feature, you have to flush the events from  
> time to time (consume it to generate
> the statistics)
>
>      from celery.monitoring import StatsCollector
>      s = StatsCollector()
>      s.collect()
>      s.dump()
>
> But chances are, if you didn't know this, you are probably using it by  
> accident.
>
>
>   



From jdc at hive7.com  Thu Nov  5 16:31:31 2009
From: jdc at hive7.com (JD Conley)
Date: Thu, 5 Nov 2009 08:31:31 -0800
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <4AF29E24.4080701@lshift.net>
References: <00eb01ca5d73$64079080$2c16b180$@com> <4AF29E24.4080701@lshift.net>
Message-ID: <01a501ca5e35$6e94bec0$4bbe3c40$@com>

> > Faulting application erl.exe, version 0.0.0.0, time stamp 0x491190a3,
> > faulting module beam.smp.dll, version 0.0.0.0, time stamp 0x49118fbd,
> > exception code 0x40000015, fault offset 0x00010831, process id 0x6e0,
> > application start time 0x01ca5ce1246bff61.
> 
> That error doesn't tell us much :(
> 
> Did Erlang write a erl_crash.dump file? If so, that should provide some
> clues as to the cause.

I'm an Erlang newbie, so forgive the ignorance. Where would I find the dump
file on Windows? I haven't changed any of the default configuration -- other
than the setup required to run a cluster. I searched under the Rabbitmq
directory for the file but nothing was there. Is there any configuration I
can do to try to get more information?
 
> Also, is there anything unusual at all in the rabbit logs?

I don't know. The one thing I notice is Rabbitmq seems to get very upset and
disconnect the client when we try to unbind a non-existent binding. You can
see the log file on pastebin: http://pastebin.com/m614be2bb

Thank you,
JD




From matthias at lshift.net  Thu Nov  5 16:51:47 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 05 Nov 2009 16:51:47 +0000
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <01a501ca5e35$6e94bec0$4bbe3c40$@com>
References: <00eb01ca5d73$64079080$2c16b180$@com> <4AF29E24.4080701@lshift.net>
	<01a501ca5e35$6e94bec0$4bbe3c40$@com>
Message-ID: <4AF302A3.6090105@lshift.net>

JD,

JD Conley wrote:
> Where would I find the dump file on Windows?

By default the Windows service setup of rabbitmq configures Erlang to
place the erl_crash.dump file in the same place as the rabbit logs.
Well, that's what the code in rabbitmq-service.bat purports to do - no
idea whether anything actually pays attention to that setting.

> Is there any configuration I can do to try to get more information?

If you can, try running the server directly rather than starting it as a
service. Then, if it crashes, a) you may see a message in the console
where you started it, and b) the erl_crash.dump should get written to
the dir where you started the server.

> The one thing I notice is Rabbitmq seems to get very upset and
> disconnect the client when we try to unbind a non-existent binding.

It doesn't really get upset about it, it just logs it as an error and
closes the offending connection with an appropriate error message.

> You can see the log file on pastebin: http://pastebin.com/m614be2bb

Is there anything in the sasl log?


Regards,

Matthias.



From irrer at umich.edu  Thu Nov  5 16:52:47 2009
From: irrer at umich.edu (Jim Irrer)
Date: Thu, 5 Nov 2009 11:52:47 -0500
Subject: [rabbitmq-discuss] Fwd:  compatibility with legacy code
In-Reply-To: <3b6ef0790911041205k2dcf27f1n7dffb5b9d7376f33@mail.gmail.com>
References: <3b6ef0790911040652s38dddee4hb37c2affb136f360@mail.gmail.com>
	<k5my3245rg.fsf@mrbraver.lshift.net>
	<3b6ef0790911041205k2dcf27f1n7dffb5b9d7376f33@mail.gmail.com>
Message-ID: <3b6ef0790911050852m318e02e3l2141062bdc89d42a@mail.gmail.com>

Forgot to CC the discussion group.


---------- Forwarded message ----------
From: Jim Irrer <irrer at umich.edu>
Date: Wed, Nov 4, 2009 at 3:05 PM
Subject: Re: [rabbitmq-discuss] compatibility with legacy code
To: tonyg at lshift.net
Cc: David Wragg <david.wragg at lshift.net>, Jim Irrer <irrer at umich.edu>


Tony -

David Wragg suggested I try your C interface to RabbitMQ.  I did, and
got the following build (running on Ubuntu 2.6.28-15) error below.  Does
this
mean that the package is missing the *amqp-0.9.1.json* file?

Also, I was using rabbitmq-c-06125761fef6.tar.gz from
http://hg.rabbitmq.com/ .

irrer-ubuntu:autoreconf -i ; echo $?
libtoolize: putting auxiliary files in `.'.
libtoolize: copying file `./config.guess'
libtoolize: copying file `./config.sub'
libtoolize: copying file `./install-sh'
libtoolize: copying file `./ltmain.sh'
libtoolize: Consider adding `AC_CONFIG_MACRO_DIR([m4])' to configure.ac and
libtoolize: rerunning libtoolize, to keep the correct libtool macros
in-tree.
libtoolize: Consider adding `-I m4' to ACLOCAL_AMFLAGS in Makefile.am.
configure.ac:3: installing `./missing'
examples/Makefile.am: installing `./depcomp'
0
irrer-ubuntu:./configure ; echo $?
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... no
checking for mawk... mawk
checking whether make sets $(MAKE)... yes
checking for gcc... gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables...
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking for style of include used by make... GNU
checking dependency style of gcc... gcc3
checking build system type... i686-pc-linux-gnu
checking host system type... i686-pc-linux-gnu
checking for a sed that does not truncate output... /bin/sed
checking for grep that handles long lines and -e... /bin/grep
checking for egrep... /bin/grep -E
checking for fgrep... /bin/grep -F
checking for ld used by gcc... /usr/bin/ld
checking if the linker (/usr/bin/ld) is GNU ld... yes
checking for BSD- or MS-compatible name lister (nm)... /usr/bin/nm -B
checking the name lister (/usr/bin/nm -B) interface... BSD nm
checking whether ln -s works... yes
checking the maximum length of command line arguments... 1572864
checking whether the shell understands some XSI constructs... yes
checking whether the shell understands "+="... yes
checking for /usr/bin/ld option to reload object files... -r
checking for objdump... objdump
checking how to recognize dependent libraries... pass_all
checking for ar... ar
checking for strip... strip
checking for ranlib... ranlib
checking command to parse /usr/bin/nm -B output from gcc object... ok
checking how to run the C preprocessor... gcc -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking for dlfcn.h... yes
checking for objdir... .libs
checking if gcc supports -fno-rtti -fno-exceptions... no
checking for gcc option to produce PIC... -fPIC -DPIC
checking if gcc PIC flag -fPIC -DPIC works... yes
checking if gcc static flag -static works... yes
checking if gcc supports -c -o file.o... yes
checking if gcc supports -c -o file.o... (cached) yes
checking whether the gcc linker (/usr/bin/ld) supports shared libraries...
yes
checking whether -lc should be explicitly linked in... no
checking dynamic linker characteristics... GNU/Linux ld.so
checking how to hardcode library paths into programs... immediate
checking whether stripping libraries is possible... yes
checking if libtool supports shared libraries... yes
checking whether to build shared libraries... yes
checking whether to build static libraries... yes
checking for ANSI C header files... (cached) yes
checking location of AMQP codegen directory... configure: error: could not
find AMQP spec file at "'/home/irrer/utilitie
s/rabbitmq/rabbitmq-c/rabbitmq-c-06125761fef6/codegen/amqp-0.9.1.json'"


Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Wed, Nov 4, 2009 at 11:24 AM, David Wragg <david.wragg at lshift.net> wrote:

> Hi Jim,
>
> Jim Irrer <irrer at umich.edu> writes:
> > We are starting to use RabbitMQ but need to connect to
> > a legacy application written in C/C++ (about 2 million lines
> > of code).  Does anyone have any suggestions or experience
> > on how to do this?
>
> There's a C client for rabbitmq at
> <http://hg.rabbitmq.com/rabbitmq-c/>.  It's marked as experimental,
> but I think it's seen some real-world use already.  If you take a
> look, I'm sure Tony would be interested in any feedback you have.
>
> David
>
> --
>  [][][] David Wragg       | mail: david.wragg at lshift.net
>   [][] Senior Developer  | tel: +44 (0)20 7729 7060
>  []  [] LShift Ltd        | web: www.lshift.net
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091105/0a339e38/attachment.htm 

From jdc at hive7.com  Thu Nov  5 17:15:10 2009
From: jdc at hive7.com (JD Conley)
Date: Thu, 5 Nov 2009 09:15:10 -0800
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <4AF302A3.6090105@lshift.net>
References: <00eb01ca5d73$64079080$2c16b180$@com> <4AF29E24.4080701@lshift.net>
	<01a501ca5e35$6e94bec0$4bbe3c40$@com> <4AF302A3.6090105@lshift.net>
Message-ID: <01ac01ca5e3b$87d36520$977a2f60$@com>

> By default the Windows service setup of rabbitmq configures Erlang to
> place the erl_crash.dump file in the same place as the rabbit logs.

It's not there. I did some file system searching in %appdata% as well, with
no luck. So, I guess it didn't write one. 

> If you can, try running the server directly rather than starting it as
> a
> service.

I have the broker running interactively from a cmd prompt. I'll let you know
when it crashes. I hope it crashes. It would be annoying if it didn't. :)
The big difference with the interactive one is it is running with my user
account, where the service is running as local system. Hopefully that
doesn't make a difference (I copied the cookie).

> > The one thing I notice is Rabbitmq seems to get very upset and
> > disconnect the client when we try to unbind a non-existent binding.
> 
> It doesn't really get upset about it, it just logs it as an error and
> closes the offending connection with an appropriate error message.

Is there any way to change this behavior through configuration? The log is
fine, but part of my use case is binding/unbinding occasionally and I would
prefer it if my clients didn't keep getting errors and having to reconnect.

> Is there anything in the sasl log?

No. It's using guest only.

Thanks,
JD




From matthias at lshift.net  Thu Nov  5 17:58:25 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 05 Nov 2009 17:58:25 +0000
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <01ac01ca5e3b$87d36520$977a2f60$@com>
References: <00eb01ca5d73$64079080$2c16b180$@com>
	<4AF29E24.4080701@lshift.net>	<01a501ca5e35$6e94bec0$4bbe3c40$@com>
	<4AF302A3.6090105@lshift.net> <01ac01ca5e3b$87d36520$977a2f60$@com>
Message-ID: <4AF31241.1040203@lshift.net>

JD,

JD Conley wrote:
>>> The one thing I notice is Rabbitmq seems to get very upset and
>>> disconnect the client when we try to unbind a non-existent binding.
>> It doesn't really get upset about it, it just logs it as an error and
>> closes the offending connection with an appropriate error message.
> 
> Is there any way to change this behavior through configuration? The log is
> fine, but part of my use case is binding/unbinding occasionally and I would
> prefer it if my clients didn't keep getting errors and having to reconnect.

Why are your clients trying to unbind non-existing bindings?

The AMQP spec requires that this results in an error.

>> Is there anything in the sasl log?
> 
> No. It's using guest only.

I mean the rabbit-sasl.log; "SASL" in this case stands for Erlang's
"System Architecture Support Libraries" - nothing to do with authentication.


Regards,

Matthias.



From jdc at hive7.com  Thu Nov  5 18:40:10 2009
From: jdc at hive7.com (JD Conley)
Date: Thu, 5 Nov 2009 10:40:10 -0800
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <4AF31241.1040203@lshift.net>
References: <00eb01ca5d73$64079080$2c16b180$@com>
	<4AF29E24.4080701@lshift.net>	<01a501ca5e35$6e94bec0$4bbe3c40$@com>
	<4AF302A3.6090105@lshift.net> <01ac01ca5e3b$87d36520$977a2f60$@com>
	<4AF31241.1040203@lshift.net>
Message-ID: <01bf01ca5e47$67c0d4a0$37427de0$@com>

> Why are your clients trying to unbind non-existing bindings?

They don't know the bindings are non-existent since the queues/exchange in
question aren't durable and, say, a server might crash and restart. A client
created a binding, then some time went by and it was time to remove the
binding, probably by a different client, that maybe wasn't connected yet and
doesn't know the binding was destroyed. There is a web farm with long
running connections/sessions to the Rabbitmq cluster.

I'm using this as a message passing system for a web application written
using the official .NET client. I have a Fanout exchange and a queue per
user session. Sort of like a chat room, when a user 'joins' her queue is
bound to the routing key for that 'room'. Users are long polling my web app,
which is doing a BasicConsume through a shared EventingBasicConsumer during
the 60 second polling period, and a BasicCancel when the poll is completed.
I persist the list of currently bound routing keys in a database and a
binding will usually last a few minutes before it is unbound. There is a
background cleanup process that runs and removes bindings and destroys
queues after users haven't polled in a while.

If there's a better way to do something like this, I'm open to suggestion.
:)

> The AMQP spec requires that this results in an error.

That's fine, but that doesn't seem critical enough for the connection to
have to drop. As a newcomer in the space, it's ironic to me that I can
declare duplicate queues and exchanges without any errors but not silently
remove a binding that doesn't exist. It would be great if it were an option
to behave like the .NET generic Dictionary that returns 'true' on remove if
there was actually something there, or silently ignores the call and returns
'false' if not. Is there a DoesBindingExist method I can use to do things
cleanly today? I didn't see one.

> >> Is there anything in the sasl log?
> >
> > No. It's using guest only.
> 
> I mean the rabbit-sasl.log; "SASL" in this case stands for Erlang's
> "System Architecture Support Libraries" - nothing to do with
> authentication.

Hah! Oops. Too much network protocol background in my past. The answer is
the same, even without the part of me looking like an idiot. The log is
empty.

-JD




From matthias at lshift.net  Thu Nov  5 19:29:48 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 05 Nov 2009 19:29:48 +0000
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <01bf01ca5e47$67c0d4a0$37427de0$@com>
References: <00eb01ca5d73$64079080$2c16b180$@com>	<4AF29E24.4080701@lshift.net>	<01a501ca5e35$6e94bec0$4bbe3c40$@com>	<4AF302A3.6090105@lshift.net>
	<01ac01ca5e3b$87d36520$977a2f60$@com>	<4AF31241.1040203@lshift.net>
	<01bf01ca5e47$67c0d4a0$37427de0$@com>
Message-ID: <4AF327AC.7070707@lshift.net>

JD,

JD Conley wrote:
>> Why are your clients trying to unbind non-existing bindings?
> 
> They don't know the bindings are non-existent since the queues/exchange in
> question aren't durable and, say, a server might crash and restart.

Rabbit doesn't usually crash ;)

> I persist the list of currently bound routing keys in a database and a
> binding will usually last a few minutes before it is unbound. There is a
> background cleanup process that runs and removes bindings and destroys
> queues after users haven't polled in a while.
> 
> If there's a better way to do something like this, I'm open to suggestion.

I think what you are doing is fine. One possible improvement is to 
(re)declare the queues/bindings just before attempting to delete them. 
It's a cheap operation for the server if the entities do exist already - 
which is the common case - and it prevents the errors when they don't.

One possible extension of RabbitMQ could allow queues to have a 
"automatically delete if idle for longer than X" setting. That would 
actually be quite easy to implement and is a natural extension of the 
existing exclusivity and auto-delete flags. Would that work for you or 
do you actually need an idle timeout for *bindings*? Those would be a 
lot harder to implement.

>> The AMQP spec requires that this results in an error.
> 
> That's fine, but that doesn't seem critical enough for the connection to
> have to drop.

Actually, not_found (404) is defined to be *soft* error, which means it 
only closes the channel, not the connection. So I suspect your 
application code is tripping over the channel error and causing the 
connection to close.

> As a newcomer in the space, it's ironic to me that I can declare
> duplicate queues and exchanges without any errors but not silently 
> remove a binding that doesn't exist.

Declaration is an assertion of existence, and hence is idempotent - you 
can assert the existence of something as many times as you like; you 
cannot create duplicates. Now, deletion/unbind should really be an 
assertion of non-existence and hence be idempotent too, but 
unfortunately it isn't. One day that will hopefully get fixed in the 
protocol spec.

> It would be great if it were an option to behave like the .NET
> generic Dictionary that returns 'true' on remove if there was
> actually something there, or silently ignores the call and returns 
> 'false' if not. Is there a DoesBindingExist method I can use to do
> things cleanly today? I didn't see one.

There is no such mechanism. Ideally the protocol would allow the listing 
of existing entities. RabbitMQ currently allows that via the 
'rabbitmqctl list_*' commands, but that is outside the protocol and not 
designed for high rates of execution.


Regards,

Matthias.



From alexis.richardson at gmail.com  Thu Nov  5 20:30:43 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 5 Nov 2009 20:30:43 +0000
Subject: [rabbitmq-discuss] rabbit-erlang-client/ebin/amqp_client.app.in
	refers to non existant files
In-Reply-To: <269388e30911050718g2e7ba54evd98b9fd256927c63@mail.gmail.com>
References: <269388e30911050718g2e7ba54evd98b9fd256927c63@mail.gmail.com>
Message-ID: <167204d20911051230h60ca11b6gfff1ef76391f1c30@mail.gmail.com>

Ooh can we have an error message like that for the .NET edition?


On Thu, Nov 5, 2009 at 3:18 PM, Ben Hood <0x6e6562 at gmail.com> wrote:
> How a proper broker deals with resource constraints :-)
>
> ---------- Forwarded message ----------
> From: ?<postmaster at collaborationhost.net>
> Date: Thu, Nov 5, 2009 at 2:26 PM
> Subject: Undeliverable: Re: [rabbitmq-discuss]
> rabbit-erlang-client/ebin/amqp_client.app.in ? ?refers to non existant
> files
> To: 0x6e6562 at gmail.com
>
>
> Delivery has failed to these recipients or distribution lists:
>
> Scott Brooks
> The recipient's mailbox is full and can't accept messages now.
> Microsoft Exchange will not try to redeliver this message for you.
> Please try resending this message later, or contact the recipient
> directly.
>
> ________________________________
> Sent by Microsoft Exchange Server 2007
>
>
>
>
>
> Diagnostic information for administrators:
>
> Generating server: collaborationhost.net
>
> scott.brooks at epicadvertising.com
> #550 5.2.2 STOREDRV.Deliver: mailbox full. The following information
> should help identify the cause:
> "MapiExceptionShutoffQuotaExceeded:16.18969:B8000000,
> 17.27161:0000000094000000000000000000000000000000, 255.23226:C2220000,
> 255.27962:FE000000, 255.17082:DD040000, 0.26937:08000000,
> 4.21921:DD040000, 255.27962:FA000000, 255.1494:00000000,
> 255.26426:FE000000, 4.7588:0F010480, 4.6564:0F010480, 4.4740:05000780,
> 4.6276:05000780, 4.5721:DD040000, 4.6489:DD040000, 4.2199:DD040000,
> 4.17097:DD040000, 4.8620:DD040000, 255.1750:2F400000,
> 0.26849:00000000, 255.21817:DD040000, 0.26297:00000000,
> 4.16585:DD040000, 0.32441:2D000000, 4.1706:DD040000, 0.24761:632A0000,
> 4.20665:DD040000, 0.25785:00000000, 4.29881:DD040000". ##
>
> Original message headers:
>
> Received: from p01c11m002.mxlogic.net (10.2.3.199) by
> ?in005.collaborationhost.net (10.2.0.231) with Microsoft SMTP Server (TLS) id
> ?8.1.336.0; Thu, 5 Nov 2009 08:26:31 -0600
> Received: from unknown [209.85.210.200] (EHLO mail-yx0-f200.google.com) by
> ?p01c11m002.mxlogic.net(mxl_mta-6.4.0-2) ? ? ? ?with ESMTP id
> ?001e2fa4.0.68619.00-116.101372.p01c11m002.mxlogic.net (envelope-from
> ?<0x6e6562 at gmail.com>); Thu, 05 Nov 2009 07:28:16 -0700 (MST)
> Received: by yxe38 with SMTP id 38so110422yxe.6 ? ? ? ?for
> ?<scott.brooks at epicadvertising.com>; Thu, 05 Nov 2009 06:28:15 -0800 (PST)
> DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
> ? ? ? ?d=gmail.com; s=gamma;
> ? ? ? ?h=domainkey-signature:mime-version:received:in-reply-to:references
> ? ? ? ? :date:message-id:subject:from:to:cc:content-type;
> ? ? ? ?bh=VUS4tQlBNKBz4b/DCu2JaTjknJNVAkaBkeRVuAr0iOk=;
> ? ? ? ?b=Tl2UaJWD6SN7887k56kDpVHQzyuGta/pEdKujzJSI3UrgtcQ/zya79cp9aoeUYla1H
> ? ? ? ? aBJ+9ev/SDSlTlnAJ5+Gc1xefn8YqYKzCFBeGqlUiX1gEZlxm9OcuODO59aJFbl//FmG
> ? ? ? ? j8aXH7/OHI1of6Pyy+aWdMyVK2weOcW5+lMgU=
> DomainKey-Signature: a=rsa-sha1; c=nofws;
> ? ? ? ?d=gmail.com; s=gamma;
> ? ? ? ?h=mime-version:in-reply-to:references:date:message-id:subject:from:to
> ? ? ? ? :cc:content-type;
> ? ? ? ?b=p9W95tVJ5xDsnt/3EcdXlB4GMcPkUQ2Z6hyUIFNJhrGBCehzDij+v6bciNNh2GQwbU
> ? ? ? ? 0rinRA0E2kriw9Eugi+8X2Sje2elojP3fJ2YN1bX1SXYSizG6qH4bnx3WxJH1AhiSSRW
> ? ? ? ? AFIdCWp2MfEl6acsAJJEZfnmNPpyfGFbGMM98=
> MIME-Version: 1.0
> Received: by 10.91.28.9 with SMTP id f9mr6326643agj.89.1257431294992; Thu, 05
> ? ? ? ?Nov 2009 06:28:14 -0800 (PST)
> In-Reply-To: <FC84AB94-3D3E-4908-B500-83B13718F6EE at epicadvertising.com>
> References: <8A1AF416-6685-4E3B-A346-73D671A00E42 at epicadvertising.com>
> ? ? ? ? <269388e30910301014m1bfea81epdb3e8da58091e921 at mail.gmail.com>
> ? ? ? ? <FC84AB94-3D3E-4908-B500-83B13718F6EE at epicadvertising.com>
> Date: Thu, 5 Nov 2009 14:28:14 +0000
> Message-ID: <269388e30911050628i3eac6748nfb58a7daef2a4c74 at mail.gmail.com>
> Subject: Re: [rabbitmq-discuss] rabbit-erlang-client/ebin/amqp_client.app.in
> ? ? ? ?refers to non existant files
> From: Ben Hood <0x6e6562 at gmail.com>
> To: Scott Brooks <scott.brooks at epicadvertising.com>
> CC: "rabbitmq-discuss at lists.rabbitmq.com"
> ? ? ? ?<rabbitmq-discuss at lists.rabbitmq.com>
> Content-Type: text/plain; charset="ISO-8859-1"
> X-Spam: exempt
> X-MAIL-FROM: <0x6e6562 at gmail.com>
> X-SOURCE-IP: [209.85.210.200]
> Return-Path: 0x6e6562 at gmail.com
>
> Final-Recipient: rfc822;scott.brooks at epicadvertising.com
> Action: failed
> Status: 5.2.2
> Diagnostic-Code: smtp;550 5.2.2 STOREDRV.Deliver: mailbox full. The
> following information should help identify the cause:
> "MapiExceptionShutoffQuotaExceeded:16.18969:B8000000,
> 17.27161:0000000094000000000000000000000000000000, 255.23226:C2220000,
> 255.27962:FE000000, 255.17082:DD040000, 0.26937:08000000,
> 4.21921:DD040000, 255.27962:FA000000, 255.1494:00000000,
> 255.26426:FE000000, 4.7588:0F010480, 4.6564:0F010480, 4.4740:05000780,
> 4.6276:05000780, 4.5721:DD040000, 4.6489:DD040000, 4.2199:DD040000,
> 4.17097:DD040000, 4.8620:DD040000, 255.1750:2F400000,
> 0.26849:00000000, 255.21817:DD040000, 0.26297:00000000,
> 4.16585:DD040000, 0.32441:2D000000, 4.1706:DD040000, 0.24761:632A0000,
> 4.20665:DD040000, 0.25785:00000000, 4.29881:DD040000".
> X-Display-Name: Scott Brooks
>
>
>
> ---------- Forwarded message ----------
> From:?Ben Hood <0x6e6562 at gmail.com>
> To:?Scott Brooks <scott.brooks at epicadvertising.com>
> Date:?Thu, 5 Nov 2009 14:28:14 +0000
> Subject:?Re: [rabbitmq-discuss]
> rabbit-erlang-client/ebin/amqp_client.app.in refers to non existant
> files
> Scott,
>
> On Fri, Oct 30, 2009 at 5:19 PM, Scott Brooks
> <scott.brooks at epicadvertising.com> wrote:
>> I've got a plugin I'm working on that is not loading due to that which
>> is how I ran across it.
>
> Sorry about the long delay for pushing out a 2 second fix - it's now
> in the default branch.
>
> Cheers,
>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From alexis.richardson at gmail.com  Thu Nov  5 20:39:44 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 5 Nov 2009 20:39:44 +0000
Subject: [rabbitmq-discuss] a possibility of AMQP/RabbitMQ extension?
In-Reply-To: <87ljil7x7z.fsf@goryachev.org>
References: <87pr7x9gzb.fsf@goryachev.org>
	<167204d20911050658v5a131ad5u339dbac5250eea52@mail.gmail.com>
	<87ljil7x7z.fsf@goryachev.org>
Message-ID: <167204d20911051239u7dc83f5pb769fa9da3ce9ee3@mail.gmail.com>

On Thu, Nov 5, 2009 at 4:28 PM, Igor Goryachev <igor at goryachev.org> wrote:
> Alexis Richardson <alexis.richardson at gmail.com> writes:
>
>> 1. AMQP is 'programmable' so you can set up lots of messaging
>> applications by customer need.
>
> BTW, is it safe to implement i.e. custom methods or some other 'core'
> features?

I'm not sure what you mean - do you mean modifying the source of the
broker?  Or something else?


>> 2. You can write custom routers aka "exchanges" eg for content based routing
>>
>> 3. RabbitMQ supports plugins, see eg
>> http://www.lshift.net/blog/2009/10/26/http-routing-with-rabbitmq-and-trapeze
>
> Ok. I have already played a bit with rabbit's plugin API inside
> 'umbrella' development environment. It seems to be fine enough and
> really works for me.
>
>> AMQP has destructive reads ie. 'get message', whereas with a long term
>> store you want non-destructive reads. ?So, currently I would say No to
>> that. ?It's an interesting idea though.
>
> Well, then we will use real kv-database for this kind of task (at least
> for now) and continue using rabbitmq as our middleware service.
>
> Thank you very much for such a quick answer!

It's a pleasure.

A good thing to investigate is how to make RabbitMQ integrate with KV
stores, e.g. by pushing data into them.

alexis




>
> --
> ? ?Igor Goryachev ? ? ? ? ? ? ?E-Mail/Jabber: igor at goryachev.org
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From jdc at hive7.com  Thu Nov  5 20:46:14 2009
From: jdc at hive7.com (JD Conley)
Date: Thu, 5 Nov 2009 12:46:14 -0800
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <4AF327AC.7070707@lshift.net>
References: <00eb01ca5d73$64079080$2c16b180$@com>	<4AF29E24.4080701@lshift.net>	<01a501ca5e35$6e94bec0$4bbe3c40$@com>	<4AF302A3.6090105@lshift.net>
	<01ac01ca5e3b$87d36520$977a2f60$@com>	<4AF31241.1040203@lshift.net>
	<01bf01ca5e47$67c0d4a0$37427de0$@com> <4AF327AC.7070707@lshift.net>
Message-ID: <01cb01ca5e59$0424eeb0$0c6ecc10$@com>

> One possible extension of RabbitMQ could allow queues to have a
> "automatically delete if idle for longer than X" setting. That would
> actually be quite easy to implement and is a natural extension of the
> existing exclusivity and auto-delete flags. Would that work for you or
> do you actually need an idle timeout for *bindings*? Those would be a
> lot harder to implement.

That's interesting, and would save my app code a lot of headache. My use
case is an idle timeout for inactive queues, which by definition should
remove associated bindings, right? Activity in my case would be defined as
having a consumer within X amount of time.

> Actually, not_found (404) is defined to be *soft* error, which means it
> only closes the channel, not the connection. So I suspect your
> application code is tripping over the channel error and causing the
> connection to close.

I'm using the .NET client, which is throwing an
OperationInterruptedException. Stack looks something like:

RabbitMQ.Client.Exceptions.OperationInterruptedException: The AMQP operation
was interrupted: AMQP close-reason, initiated by Peer, code=404,
text="NOT_FOUND - no queue
'youtopia.playerqueue.bc19a9767bc94cc18a20c7d8c4c9c1c6' in vhost '/'",
classId=50, methodId=50, cause=
   at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply()
   at RabbitMQ.Client.Impl.ModelBase.ModelRpc(MethodBase method,
ContentHeaderBase header, Byte[] body)
   at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueUnbind(String queue,
String exchange, String routingKey, IDictionary arguments)
[My code here]

I am not closing the connection unless IModel.IsOpen is false after any
operation. You say it closes the channel. So, would that be the IModel in
.NET client speak? How would I recover from this exception without
rebuilding everything from the connection on up?

-JD




From diclophis at gmail.com  Thu Nov  5 20:48:04 2009
From: diclophis at gmail.com (Jon Bardin)
Date: Thu, 5 Nov 2009 12:48:04 -0800
Subject: [rabbitmq-discuss] RabbitMQ + STOMP adapter + SSL
Message-ID: <c1d41d540911051248g19b7c204kf335e6c13e78b070@mail.gmail.com>

Hello everyone,

Does the current RabbitMQ+STOMP adapter support SSL clients?

And if it does not, are there plans for supporting it in the future?

Thanks

-Jon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091105/16b9f743/attachment.htm 

From alexis.richardson at gmail.com  Thu Nov  5 21:01:33 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 5 Nov 2009 21:01:33 +0000
Subject: [rabbitmq-discuss] RabbitMQ + STOMP adapter + SSL
In-Reply-To: <c1d41d540911051248g19b7c204kf335e6c13e78b070@mail.gmail.com>
References: <c1d41d540911051248g19b7c204kf335e6c13e78b070@mail.gmail.com>
Message-ID: <167204d20911051301g7519b972tc92cd351c2a0d481@mail.gmail.com>

Jon

According to Tony G, the answer is "not directly. use stunnel4".

HTH

alexis


On Thu, Nov 5, 2009 at 8:48 PM, Jon Bardin <diclophis at gmail.com> wrote:
> Hello everyone,
>
> Does the current RabbitMQ+STOMP adapter support SSL clients?
>
> And if it does not, are there plans for supporting it in the future?
>
> Thanks
>
> -Jon
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthias at lshift.net  Thu Nov  5 21:16:30 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 05 Nov 2009 21:16:30 +0000
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <01cb01ca5e59$0424eeb0$0c6ecc10$@com>
References: <00eb01ca5d73$64079080$2c16b180$@com>	<4AF29E24.4080701@lshift.net>	<01a501ca5e35$6e94bec0$4bbe3c40$@com>	<4AF302A3.6090105@lshift.net>	<01ac01ca5e3b$87d36520$977a2f60$@com>	<4AF31241.1040203@lshift.net>	<01bf01ca5e47$67c0d4a0$37427de0$@com>
	<4AF327AC.7070707@lshift.net> <01cb01ca5e59$0424eeb0$0c6ecc10$@com>
Message-ID: <4AF340AE.6050901@lshift.net>

JD,

JD Conley wrote:
>> One possible extension of RabbitMQ could allow queues to have a
>> "automatically delete if idle for longer than X" setting.
> 
> My use case is an idle timeout for inactive queues, which by
> definition should remove associated bindings, right?

Yes, bindings to a queue get removed when the queue is removed.

> Activity in my case would be defined as having a consumer within X amount of time.

Actually I'd define "in use" to mean either having consumers, or 
performing any operation affecting the queue that one might expect a 
(logical) consumer to perform, such as basic.get, basic.ack, 
basic.consume, basic.cancel, queue.purge, queue.bind, queue.unbind, 
queue.declare, queue.delete. Essentially the only excluded operations 
are routing messages to queues and administrative operations, e.g. 
rabbitmqctl commands.

>> Actually, not_found (404) is defined to be *soft* error, which means it
>> only closes the channel, not the connection. So I suspect your
>> application code is tripping over the channel error and causing the
>> connection to close.
> 
> I'm using the .NET client, which is throwing an
> OperationInterruptedException. 
> 
> I am not closing the connection unless IModel.IsOpen is false after any
> operation. You say it closes the channel. So, would that be the IModel in
> .NET client speak? How would I recover from this exception without
> rebuilding everything from the connection on up?

IModel does indeed correspond to AMQP's notion of a channel. You can 
proceed after the error by opening a fresh channel with 
IConnection.CreateModel().


Regards,

Matthias.



From alexis.richardson at gmail.com  Thu Nov  5 21:41:04 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 5 Nov 2009 21:41:04 +0000
Subject: [rabbitmq-discuss] API for Acess Control
In-Reply-To: <8F16BDCC98E64841857E711110AF5EDDF4D8A54497@EXMBX01.wealthcraft.local>
References: <8F16BDCC98E64841857E711110AF5EDDF4D8A54497@EXMBX01.wealthcraft.local>
Message-ID: <167204d20911051341y5f470d70lea3afa223be3fa76@mail.gmail.com>

Desrie

Currently you can do this with the rabbitmqctl tool - take a look at:
http://www.rabbitmq.com/admin-guide.html#access-control

alexis


On Wed, Nov 4, 2009 at 10:31 AM, Desrie Qi <desrie.qi at wealthcraft.com> wrote:
> Please anyone who know the .NET APIs for permission control such as Setting
> user permissions and Clearing user permissions?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From diclophis at gmail.com  Thu Nov  5 21:52:22 2009
From: diclophis at gmail.com (Jon Bardin)
Date: Thu, 5 Nov 2009 13:52:22 -0800
Subject: [rabbitmq-discuss] RabbitMQ + STOMP adapter + SSL
In-Reply-To: <167204d20911051301g7519b972tc92cd351c2a0d481@mail.gmail.com>
References: <c1d41d540911051248g19b7c204kf335e6c13e78b070@mail.gmail.com>
	<167204d20911051301g7519b972tc92cd351c2a0d481@mail.gmail.com>
Message-ID: <c1d41d540911051352i6a7dfad2k966d9710fa099c6b@mail.gmail.com>

Interesting approach, thanks

On Thu, Nov 5, 2009 at 1:01 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Jon
>
> According to Tony G, the answer is "not directly. use stunnel4".
>
> HTH
>
> alexis
>
>
> On Thu, Nov 5, 2009 at 8:48 PM, Jon Bardin <diclophis at gmail.com> wrote:
> > Hello everyone,
> >
> > Does the current RabbitMQ+STOMP adapter support SSL clients?
> >
> > And if it does not, are there plans for supporting it in the future?
> >
> > Thanks
> >
> > -Jon
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091105/f3caa4b2/attachment.htm 

From sjaday at gmail.com  Thu Nov  5 21:57:31 2009
From: sjaday at gmail.com (Stephen Day)
Date: Thu, 5 Nov 2009 13:57:31 -0800
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
	memory
In-Reply-To: <4AE15339.10801@lshift.net>
References: <4d376de30910131403i772069a2w25b307b6e818da76@mail.gmail.com>
	<4d376de30910211417j2458d60fh3bf2690af8ca7861@mail.gmail.com>
	<4AE01D24.8020704@lshift.net>
	<4d376de30910221103h7cc9e0e3ja5e4e513271644ad@mail.gmail.com>
	<4AE0A585.1020701@lshift.net>
	<4d376de30910221350t5e646d7am942e88c4b0a1dae9@mail.gmail.com>
	<4d376de30910221422q3824d9cye43b3d428ae4fd3d@mail.gmail.com>
	<4AE0E99B.7040300@lshift.net>
	<4d376de30910221747h25bddf47pfab075df8524854f@mail.gmail.com>
	<4AE15339.10801@lshift.net>
Message-ID: <4d376de30911051357s168e1583qe7f3402e215b0d84@mail.gmail.com>

Its been awhile since I brought this up, but made I a small patch to the
memory supervisor that has fixed most of the memory usage problems.
Basically, I just force a garbage collect before checking the memory alarm
condition:

diff -r 7b0512cdf3bc src/vm_memory_monitor.erl
--- a/src/vm_memory_monitor.erl    Thu Nov 05 15:19:05 2009 +0000
+++ b/src/vm_memory_monitor.erl    Thu Nov 05 13:48:06 2009 -0800
@@ -174,6 +174,7 @@

 internal_update(State = #state { memory_limit = MemLimit,
                                  alarmed = Alarmed}) ->
+    [garbage_collect(P) || P <- processes()],
     MemUsed = erlang:memory(total),
     NewAlarmed = MemUsed > MemLimit,
     case {Alarmed, NewAlarmed} of

Indeed, this is a bit heinous, but it gets the job done. Unfortunately, I
don't have the appropriate bug id so I didn't create an hg branch for you to
pull from.

As far as overall system effects go, I haven't noticed any (aside from the
lack of crashes). We have been running this in production for a bit and
haven't seen any large problems, although the application is low throughput.
Are there any performance unit tests that I can run to check this?

Stephen J Day
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091105/a85a5605/attachment.htm 

From tim.cole at canonical.com  Thu Nov  5 21:57:47 2009
From: tim.cole at canonical.com (Tim Cole)
Date: Thu, 05 Nov 2009 16:57:47 -0500
Subject: [rabbitmq-discuss] auto_delete queues not going away
Message-ID: <1257458267.3831.383.camel@bede>

Hello,

I'm having some difficulty with queues not going away even after their
last consumer has gone.  The orphaned queues stick around and fill up
with messages until the RabbitMQ server has to be restarted or the
queues manually deleted.

For example, `rabbitmqctl name messages consumers` shows lots of entries
like:

 notify.a388d3c7-c501-4fef-92bb-516710950f4a	7198	0

(With the 'messages' column quickly growing in size...)

These queues were created with durable=True, exclusive=True, and
auto_delete=True.  It had been my understanding that the last option
bit, auto_delete, would ensure that the queue would be deleted once
there were no more consumers, but that doesn't appear to actually be the
case.

Help?

Thanks,
Tim
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091105/9da9ddd2/attachment.pgp 

From matthias at lshift.net  Thu Nov  5 23:02:57 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 05 Nov 2009 23:02:57 +0000
Subject: [rabbitmq-discuss] auto_delete queues not going away
In-Reply-To: <1257458267.3831.383.camel@bede>
References: <1257458267.3831.383.camel@bede>
Message-ID: <4AF359A1.6000900@lshift.net>

Tim,

Tim Cole wrote:
> I'm having some difficulty with queues not going away even after their
> last consumer has gone.  The orphaned queues stick around and fill up
> with messages until the RabbitMQ server has to be restarted or the
> queues manually deleted.
> 
> For example, `rabbitmqctl name messages consumers` shows lots of entries
> like:
> 
>  notify.a388d3c7-c501-4fef-92bb-516710950f4a	7198	0
> 
> (With the 'messages' column quickly growing in size...)
> 
> These queues were created with durable=True, exclusive=True, and
> auto_delete=True.  It had been my understanding that the last option
> bit, auto_delete, would ensure that the queue would be deleted once
> there were no more consumers, but that doesn't appear to actually be the
> case.

Marking an exclusive queue as durable is quite a strange thing to do, 
since 'exclusive' means the queue should go away when the creating 
connection dies, such as during a broker restart, but 'durable' means it 
should survive broker restarts.

There is in fact a known problem with durable, exclusive queues - if the 
server restarts it is possible that these queues survive even though 
their owning connections are dead.

So I suggest dropping the 'durable' flag.

Also note that auto_delete only kicks in only after the queue has had at 
least one consumer registered with basic.consume. basic.get doesn't count.

And exclusivity is attached to the *connection*, not the channel, so 
it's worth checking that the connection(s) which created the queues are 
indeed dead.


Regards,

Matthias.



From desrie.qi at wealthcraft.com  Fri Nov  6 01:35:55 2009
From: desrie.qi at wealthcraft.com (Desrie Qi)
Date: Fri, 6 Nov 2009 09:35:55 +0800
Subject: [rabbitmq-discuss] API for Acess Control
In-Reply-To: <167204d20911051341y5f470d70lea3afa223be3fa76@mail.gmail.com>
References: <8F16BDCC98E64841857E711110AF5EDDF4D8A54497@EXMBX01.wealthcraft.local>
	<167204d20911051341y5f470d70lea3afa223be3fa76@mail.gmail.com>
Message-ID: <8F16BDCC98E64841857E711110AF5EDDF4D8A54502@EXMBX01.wealthcraft.local>

Alexis

Do you mean currently is not possible for client to control this by win/web UI for RPC?

Thanks
Desrie

-----Original Message-----
From: Alexis Richardson [mailto:alexis.richardson at gmail.com] 
Sent: Friday, 6 November 2009 5:41 AM
To: Desrie Qi
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] API for Acess Control

Desrie

Currently you can do this with the rabbitmqctl tool - take a look at:
http://www.rabbitmq.com/admin-guide.html#access-control

alexis


On Wed, Nov 4, 2009 at 10:31 AM, Desrie Qi <desrie.qi at wealthcraft.com> wrote:
> Please anyone who know the .NET APIs for permission control such as Setting
> user permissions and Clearing user permissions?
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From arun.suresh at gmail.com  Fri Nov  6 02:28:09 2009
From: arun.suresh at gmail.com (Arun Suresh)
Date: Fri, 6 Nov 2009 07:58:09 +0530
Subject: [rabbitmq-discuss] Weird Issue when cluster member restarts
Message-ID: <9f4a617f0911051828q6c67b2e3jd51fd0261eadd8e2@mail.gmail.com>

Hi..

My setup is as follows :
* 2 RabbitMQ (1.7.0 running on R13B02.1) servers in a cluster (say rabbit at m1,
rabbit at m2).. both disk nodes.
* 2 Clients (client at m1 connected to rabbit at m1, client at m2 connected to
rabbit at m2). I am using the Erlang client (which currently has an issue when
connecting to a server which is part of a cluster... this I fixed by setting
"insist = true" in the #'connection.open' record)
* both clients have processes that have subscribed to the same durable Queue
(Q) using the same key (K). Q is bound to a durable topic exchange (X). X
and Q are created on rabbit at m1.

Now this is what i do..
* I bring down rabbit at m1, and client at m1 (They are co hosted... so both are
brought down together). I do a "rabbitmqctl list_queues" on rabbit at m2... I
do not see Q there..
* I bring rabbit at m1 up again... After which I see Q when i do a "rabbitmqctl
list_queues".
* Before I bring up client at m2, I publish a messge to X with a routing key
K...
Issue  : Since client at m2 is up and has a process subscribed to Q, I expect
that process to receive the message... It doesnt..
Further more... I notice that when i bring client at m2 back up, It restarts
its subscribers... now all messages published to X with K are sent ONLY to
client at m2.

I was wondering if anyone's faced the same problem.. and if so how did u get
around it..
Thanx in Advance..

-Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091106/50426cf5/attachment.htm 

From lynton.grice at logosworld.com  Fri Nov  6 04:47:40 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Fri, 6 Nov 2009 06:47:40 +0200
Subject: [rabbitmq-discuss] Broker Query Langauge (BQL) crashing with simple
	SELECT?
Message-ID: <000501ca5e9c$47f1f9b0$d7d5ed10$@grice@logosworld.com>

Hi there,

 

I have just installed the BQL plugin on my windows box, but when I run a
simple select it dies?

 

C:\soabox\erlang\erl5.7.1\lib\rabbitmq_server\priv\plugins\rabbitmq-bql\scri
pts>bql.bat

BQL> select * from exchanges

{"init terminating in
do_boot",{{case_clause,{badrpc,{'EXIT',{noproc,{gen_server,call,[bql_server,
{execute,<<5 bytes>>,<<5 bytes>>,<<8 bytes>>,"select * fr

om
exchanges\n"}]}}}}},[{bql_client,execute_block,1},{bql_client,run_command,0}
,{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init,s

tart_em,1}]}}

 

Crash dump was written to: erl_crash.dump

init terminating in do_boot ()

 

Any ideas here?

 

Thanks

 

Lynton

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091106/204c80f3/attachment.htm 

From lynton.grice at logosworld.com  Fri Nov  6 04:50:25 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Fri, 6 Nov 2009 06:50:25 +0200
Subject: [rabbitmq-discuss] BQL execution failed? - BADARG
Message-ID: <000a01ca5e9c$ab74fb40$025ef1c0$@grice@logosworld.com>

Hi there,

 

I have been battling to get the BQL working on my windows box, and have now
tried to get it to work with the RabbitMQ server instance in the "umbrella"
download, but unfortunately get a "badarg" when running the following query
"select * from exchanges"....

 

C:\tmp\erlang\rabbitmq-public-umbrella\rabbitmq-server\priv\plugins\rabbitmq
-bql\scripts>bql

BQL> select * from exchanges

{"init terminating in do_boot",{badarg,[{io,format,[<0.29.0>,"BQL execution
failed:~n
~s~n",[{undef,[{rabbit_misc,localnode,[rabbit]},{bql_applicator,appl

y_commands,2},{bql_server,handle_message,1},{bql_server,handle_call,3},{gen_
server,handle_msg,5},{proc_lib,init_p_do_apply,3}]}]]},{bql_client,run_comma
nd,

0},{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init
,start_em,1}]}}

 

Crash dump was written to: erl_crash.dump

init terminating in do_boot ()

 

Thanks for the help

 

Lynton

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091106/90e6ad01/attachment.htm 

From pauljones23 at gmail.com  Fri Nov  6 06:11:21 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 6 Nov 2009 06:11:21 +0000
Subject: [rabbitmq-discuss] Broker Query Langauge (BQL) crashing with
	simple SELECT?
In-Reply-To: <-8341269367530030735@unknownmsgid>
References: <-8341269367530030735@unknownmsgid>
Message-ID: <29598b610911052211w26843525w65921aa76523401e@mail.gmail.com>

Hi Lynton,

How are you running the Rabbit Server? It would appear that the BQL support
inside of it isn't started. There is a known issue that when you start
Rabbit as a service on Windows, the plugins are not initialised.

Thanks,
Paul.

On Fri, Nov 6, 2009 at 4:47 AM, Lynton Grice <lynton.grice at logosworld.com>wrote:

>  Hi there,
>
>
>
> I have just installed the BQL plugin on my windows box, but when I run a
> simple select it dies?
>
>
>
>
> C:\soabox\erlang\erl5.7.1\lib\rabbitmq_server\priv\plugins\rabbitmq-bql\scripts>bql.bat
>
> BQL> select * from exchanges
>
> {"init terminating in
> do_boot",{{case_clause,{badrpc,{'EXIT',{noproc,{gen_server,call,[bql_server,{execute,<<5
> bytes>>,<<5 bytes>>,<<8 bytes>>,"select * fr
>
> om
> exchanges\n"}]}}}}},[{bql_client,execute_block,1},{bql_client,run_command,0},{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init,s
>
> tart_em,1}]}}
>
>
>
> Crash dump was written to: erl_crash.dump
>
> init terminating in do_boot ()
>
>
>
> Any ideas here?
>
>
>
> Thanks
>
>
>
> Lynton
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091106/860b3a3a/attachment.htm 

From lynton.grice at logosworld.com  Fri Nov  6 06:24:46 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Fri, 6 Nov 2009 08:24:46 +0200
Subject: [rabbitmq-discuss] Broker Query Langauge (BQL) crashing with
	simple SELECT?
In-Reply-To: <29598b610911052211w26843525w65921aa76523401e@mail.gmail.com>
References: <-8341269367530030735@unknownmsgid>
	<29598b610911052211w26843525w65921aa76523401e@mail.gmail.com>
Message-ID: <001e01ca5ea9$da7a1bc0$8f6e5340$@grice@logosworld.com>

Hi there,

 

Yes, I am running it as a windows service. The steps I followed were to stop
the service, activate the plugins, then start the service again.

 

Is there any way around this? Let me stop the service and run Rabbit from
the BAT file instead and see what happens.

 

Any workaround with the Windows service issue here?

 

Thanks for the help ;-)

 

Lynton

 

From: Paul Jones [mailto:pauljones23 at gmail.com] 
Sent: 06 November 2009 08:11 AM
To: Lynton Grice
Cc: rabbitmq
Subject: Re: [rabbitmq-discuss] Broker Query Langauge (BQL) crashing with
simple SELECT?

 

Hi Lynton,

How are you running the Rabbit Server? It would appear that the BQL support
inside of it isn't started. There is a known issue that when you start
Rabbit as a service on Windows, the plugins are not initialised.

Thanks,
Paul.

On Fri, Nov 6, 2009 at 4:47 AM, Lynton Grice <lynton.grice at logosworld.com>
wrote:

Hi there,

 

I have just installed the BQL plugin on my windows box, but when I run a
simple select it dies?

 

C:\soabox\erlang\erl5.7.1\lib\rabbitmq_server\priv\plugins\rabbitmq-bql\scri
pts>bql.bat

BQL> select * from exchanges

{"init terminating in
do_boot",{{case_clause,{badrpc,{'EXIT',{noproc,{gen_server,call,[bql_server,
{execute,<<5 bytes>>,<<5 bytes>>,<<8 bytes>>,"select * fr

om
exchanges\n"}]}}}}},[{bql_client,execute_block,1},{bql_client,run_command,0}
,{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init,s

tart_em,1}]}}

 

Crash dump was written to: erl_crash.dump

init terminating in do_boot ()

 

Any ideas here?

 

Thanks

 

Lynton

 


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091106/c898e32f/attachment.htm 

From lynton.grice at logosworld.com  Fri Nov  6 06:32:00 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Fri, 6 Nov 2009 08:32:00 +0200
Subject: [rabbitmq-discuss] Error during "make" of RabbitMQ Erlang client -
	File operation error
Message-ID: <002301ca5eaa$dbee9de0$93cbd9a0$@grice@logosworld.com>

Hi there,

 

I just downloaded the default branch of the RabbitMQ Erlang client from
http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/default.zip

 

I am running all this on Windows and am using Cygwin to compile etc.

 

When I run "make" it kind of works BUT you can see a number of error reports
below (I highlighted a couple errors in RED).

 

Are these errors "normal"?

 

$ make

sed -e 's:%%VSN%%:0.0.0:g' < rabbit_common.app.in > rabbit_common.app

make -C ../rabbitmq-server

make[1]: Entering directory
`/cygdrive/c/tmp/erlang/rabbitmq-public-umbrella/rab

bitmq-server'

make[1]: Nothing to be done for `all'.

make[1]: Leaving directory
`/cygdrive/c/tmp/erlang/rabbitmq-public-umbrella/rabb

itmq-server'

mkdir -p dist/rabbit_common/include

mkdir -p dist/rabbit_common/ebin

cp rabbit_common.app dist/rabbit_common/ebin

( cp ../rabbitmq-server/ebin/rabbit_writer.beam dist/rabbit_common/ebin );
( cp

 ../rabbitmq-server/ebin/rabbit_reader.beam dist/rabbit_common/ebin );  ( cp
../

rabbitmq-server/ebin/rabbit_framing.beam dist/rabbit_common/ebin );  ( cp
../rab

bitmq-server/ebin/rabbit_framing_channel.beam dist/rabbit_common/ebin );  (
cp .

./rabbitmq-server/ebin/rabbit_basic.beam dist/rabbit_common/ebin );  ( cp
../rab

bitmq-server/ebin/rabbit_binary_generator.beam dist/rabbit_common/ebin );  (
cp

../rabbitmq-server/ebin/rabbit_binary_parser.beam dist/rabbit_common/ebin );
(

cp ../rabbitmq-server/ebin/rabbit_channel.beam dist/rabbit_common/ebin );  (
cp

../rabbitmq-server/ebin/rabbit_misc.beam dist/rabbit_common/ebin );  ( cp
../rab

bitmq-server/ebin/rabbit_net.beam dist/rabbit_common/ebin );  ( cp
../rabbitmq-s

erver/ebin/rabbit_heartbeat.beam dist/rabbit_common/ebin );  ( cp
../rabbitmq-se

rver/ebin/gen_server2.beam dist/rabbit_common/ebin );

cp ../rabbitmq-server/include/*.hrl dist/rabbit_common/include

(cd dist; zip -r rabbit_common.ez rabbit_common)

  adding: rabbit_common/ (stored 0%)

  adding: rabbit_common/ebin/ (stored 0%)

  adding: rabbit_common/ebin/gen_server2.beam (deflated 18%)

  adding: rabbit_common/ebin/rabbit_basic.beam (deflated 7%)

  adding: rabbit_common/ebin/rabbit_binary_generator.beam (deflated 13%)

  adding: rabbit_common/ebin/rabbit_binary_parser.beam (deflated 19%)

  adding: rabbit_common/ebin/rabbit_channel.beam (deflated 17%)

  adding: rabbit_common/ebin/rabbit_common.app (deflated 61%)

  adding: rabbit_common/ebin/rabbit_framing.beam (deflated 20%)

  adding: rabbit_common/ebin/rabbit_framing_channel.beam (deflated 14%)

  adding: rabbit_common/ebin/rabbit_heartbeat.beam (deflated 23%)

  adding: rabbit_common/ebin/rabbit_misc.beam (deflated 17%)

  adding: rabbit_common/ebin/rabbit_net.beam (deflated 12%)

  adding: rabbit_common/ebin/rabbit_reader.beam (deflated 16%)

  adding: rabbit_common/ebin/rabbit_writer.beam (deflated 11%)

  adding: rabbit_common/include/ (stored 0%)

  adding: rabbit_common/include/rabbit.hrl (deflated 70%)

  adding: rabbit_common/include/rabbit_framing.hrl (deflated 77%)

  adding: rabbit_common/include/rabbit_framing_spec.hrl (deflated 62%)

mkdir -p deps

unzip -o -d deps dist/rabbit_common.ez

Archive:  dist/rabbit_common.ez

   creating: deps/rabbit_common/

   creating: deps/rabbit_common/ebin/

  inflating: deps/rabbit_common/ebin/gen_server2.beam

  inflating: deps/rabbit_common/ebin/rabbit_basic.beam

  inflating: deps/rabbit_common/ebin/rabbit_binary_generator.beam

  inflating: deps/rabbit_common/ebin/rabbit_binary_parser.beam

  inflating: deps/rabbit_common/ebin/rabbit_channel.beam

  inflating: deps/rabbit_common/ebin/rabbit_common.app

  inflating: deps/rabbit_common/ebin/rabbit_framing.beam

  inflating: deps/rabbit_common/ebin/rabbit_framing_channel.beam

  inflating: deps/rabbit_common/ebin/rabbit_heartbeat.beam

  inflating: deps/rabbit_common/ebin/rabbit_misc.beam

  inflating: deps/rabbit_common/ebin/rabbit_net.beam

  inflating: deps/rabbit_common/ebin/rabbit_reader.beam

  inflating: deps/rabbit_common/ebin/rabbit_writer.beam

   creating: deps/rabbit_common/include/

  inflating: deps/rabbit_common/include/rabbit.hrl

  inflating: deps/rabbit_common/include/rabbit_framing.hrl

  inflating: deps/rabbit_common/include/rabbit_framing_spec.hrl

mkdir -p deps

unzip -o -d deps dist/rabbit_common.ez

Archive:  dist/rabbit_common.ez

  inflating: deps/rabbit_common/ebin/gen_server2.beam

  inflating: deps/rabbit_common/ebin/rabbit_basic.beam

  inflating: deps/rabbit_common/ebin/rabbit_binary_generator.beam

  inflating: deps/rabbit_common/ebin/rabbit_binary_parser.beam

  inflating: deps/rabbit_common/ebin/rabbit_channel.beam

  inflating: deps/rabbit_common/ebin/rabbit_common.app

  inflating: deps/rabbit_common/ebin/rabbit_framing.beam

  inflating: deps/rabbit_common/ebin/rabbit_framing_channel.beam

  inflating: deps/rabbit_common/ebin/rabbit_heartbeat.beam

  inflating: deps/rabbit_common/ebin/rabbit_misc.beam

  inflating: deps/rabbit_common/ebin/rabbit_net.beam

  inflating: deps/rabbit_common/ebin/rabbit_reader.beam

  inflating: deps/rabbit_common/ebin/rabbit_writer.beam

  inflating: deps/rabbit_common/include/rabbit.hrl

  inflating: deps/rabbit_common/include/rabbit_framing.hrl

  inflating: deps/rabbit_common/include/rabbit_framing_spec.hrl

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_channe

l.erl

{error_logger,{{2009,11,6},{6,31,14}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:14 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_channe

l_util.erl

{error_logger,{{2009,11,6},{6,31,21}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:21 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_connec

tion.erl

{error_logger,{{2009,11,6},{6,31,24}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:24 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_direct

_connection.erl

{error_logger,{{2009,11,6},{6,31,28}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:28 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_main_r

eader.erl

{error_logger,{{2009,11,6},{6,31,32}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:32 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_networ

k_connection.erl

{error_logger,{{2009,11,6},{6,31,35}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:35 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_rpc_cl

ient.erl

{error_logger,{{2009,11,6},{6,31,39}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:39 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_rpc_se

rver.erl

{error_logger,{{2009,11,6},{6,31,42}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:42 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

sed -e 's:%%VSN%%:0.0.0:g' < ebin/amqp_client.app.in > ebin/amqp_client.app

rm -rf dist/amqp_client

mkdir -p dist/amqp_client/ebin

cp -r ebin/*.beam dist/amqp_client/ebin

cp -r ebin/*.app dist/amqp_client/ebin

mkdir -p dist/amqp_client/include

cp -r include/* dist/amqp_client/include

(cd dist; zip -r amqp_client.ez amqp_client)

  adding: amqp_client/ (stored 0%)

  adding: amqp_client/ebin/ (stored 0%)

  adding: amqp_client/ebin/amqp_channel.beam (deflated 14%)

  adding: amqp_client/ebin/amqp_channel_util.beam (deflated 13%)

  adding: amqp_client/ebin/amqp_client.app (deflated 57%)

  adding: amqp_client/ebin/amqp_connection.beam (deflated 7%)

  adding: amqp_client/ebin/amqp_direct_connection.beam (deflated 10%)

  adding: amqp_client/ebin/amqp_main_reader.beam (deflated 9%)

  adding: amqp_client/ebin/amqp_network_connection.beam (deflated 13%)

  adding: amqp_client/ebin/amqp_rpc_client.beam (deflated 7%)

  adding: amqp_client/ebin/amqp_rpc_server.beam (deflated 6%)

  adding: amqp_client/include/ (stored 0%)

  adding: amqp_client/include/amqp_client.hrl (deflated 54%)

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091106/a4aa8b75/attachment.htm 

From pauljones23 at gmail.com  Fri Nov  6 07:00:41 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 6 Nov 2009 07:00:41 +0000
Subject: [rabbitmq-discuss] Broker Query Langauge (BQL) crashing with
	simple SELECT?
In-Reply-To: <7274769614128678636@unknownmsgid>
References: <-8341269367530030735@unknownmsgid>
	<29598b610911052211w26843525w65921aa76523401e@mail.gmail.com>
	<7274769614128678636@unknownmsgid>
Message-ID: <29598b610911052300w75c0316dge664fac7f32001a4@mail.gmail.com>

Hi Lynton,

The service issue is hopefully being corrected very soon - as soon as the
fix lands on default, you'll hopefully be able to download the batch file
from there and overwrite the current service batch file with it.

Thanks,
Paul.

On Fri, Nov 6, 2009 at 6:24 AM, Lynton Grice <lynton.grice at logosworld.com>wrote:

>  Hi there,
>
>
>
> Yes, I am running it as a windows service. The steps I followed were to
> stop the service, activate the plugins, then start the service again.
>
>
>
> Is there any way around this? Let me stop the service and run Rabbit from
> the BAT file instead and see what happens.
>
>
>
> Any workaround with the Windows service issue here?
>
>
>
> Thanks for the help ;-)
>
>
>
> Lynton
>
>
>
> *From:* Paul Jones [mailto:pauljones23 at gmail.com]
> *Sent:* 06 November 2009 08:11 AM
> *To:* Lynton Grice
> *Cc:* rabbitmq
> *Subject:* Re: [rabbitmq-discuss] Broker Query Langauge (BQL) crashing
> with simple SELECT?
>
>
>
> Hi Lynton,
>
> How are you running the Rabbit Server? It would appear that the BQL support
> inside of it isn't started. There is a known issue that when you start
> Rabbit as a service on Windows, the plugins are not initialised.
>
> Thanks,
> Paul.
>
> On Fri, Nov 6, 2009 at 4:47 AM, Lynton Grice <lynton.grice at logosworld.com>
> wrote:
>
> Hi there,
>
>
>
> I have just installed the BQL plugin on my windows box, but when I run a
> simple select it dies?
>
>
>
>
> C:\soabox\erlang\erl5.7.1\lib\rabbitmq_server\priv\plugins\rabbitmq-bql\scripts>bql.bat
>
> BQL> select * from exchanges
>
> {"init terminating in
> do_boot",{{case_clause,{badrpc,{'EXIT',{noproc,{gen_server,call,[bql_server,{execute,<<5
> bytes>>,<<5 bytes>>,<<8 bytes>>,"select * fr
>
> om
> exchanges\n"}]}}}}},[{bql_client,execute_block,1},{bql_client,run_command,0},{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init,s
>
> tart_em,1}]}}
>
>
>
> Crash dump was written to: erl_crash.dump
>
> init terminating in do_boot ()
>
>
>
> Any ideas here?
>
>
>
> Thanks
>
>
>
> Lynton
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091106/1b5503e0/attachment.htm 

From matthias at lshift.net  Fri Nov  6 07:55:31 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 06 Nov 2009 07:55:31 +0000
Subject: [rabbitmq-discuss] BQL execution failed? - BADARG
In-Reply-To: <000a01ca5e9c$ab74fb40$025ef1c0$@grice@logosworld.com>
References: <000a01ca5e9c$ab74fb40$025ef1c0$@grice@logosworld.com>
Message-ID: <4AF3D673.1050706@lshift.net>

Lynton,

Lynton Grice wrote:
> BQL> select * from exchanges
> 
> {"init terminating in do_boot",{badarg,[{io,format,[<0.29.0>,"BQL 
> execution failed:~n  
> ~s~n",[{undef,[{rabbit_misc,localnode,[rabbit]},{bql_applicator,appl
> 
> y_commands,2},

Looks like the BQL plug-in hasn't been updated following a recent change 
in some of the RabbitMQ server's internal APIs. I have filed a bug to 
get that fixed.

Thanks for reporting this.


Regards,

Matthias.



From matthias at lshift.net  Fri Nov  6 08:12:13 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 06 Nov 2009 08:12:13 +0000
Subject: [rabbitmq-discuss] API for Acess Control
In-Reply-To: <8F16BDCC98E64841857E711110AF5EDDF4D8A54502@EXMBX01.wealthcraft.local>
References: <8F16BDCC98E64841857E711110AF5EDDF4D8A54497@EXMBX01.wealthcraft.local>	<167204d20911051341y5f470d70lea3afa223be3fa76@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDDF4D8A54502@EXMBX01.wealthcraft.local>
Message-ID: <4AF3DA5D.2000608@lshift.net>

Desrie,

Desrie Qi wrote:
> Do you mean currently is not possible for client to control this by win/web UI for RPC?

You asked about .NET APIs. If you want a win/web UI, then there are 
existing monitoring and "management" UIs that people have written. IIRC 
some of them allow configuration of the broker, rather than just 
monitoring, but I could be wrong. Alexis may have a list somewhere of 
the UIs we are currently aware of.


Regards,

Matthias.



From lynton.grice at logosworld.com  Fri Nov  6 08:14:01 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Fri, 6 Nov 2009 10:14:01 +0200
Subject: [rabbitmq-discuss] BQL execution failed? - BADARG
In-Reply-To: <4AF3D673.1050706@lshift.net>
References: <000a01ca5e9c$ab74fb40$025ef1c0$@grice@logosworld.com>
	<4AF3D673.1050706@lshift.net>
Message-ID: <004801ca5eb9$1dd01fa0$59705ee0$@grice@logosworld.com>

HI Matthias,

Thanks for the feedback on this, much appreciated ;-)

How do people like me know when the bug fix has been done?

Chat later

Lynton

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: 06 November 2009 09:56 AM
To: Lynton Grice
Cc: 'rabbitmq'
Subject: Re: [rabbitmq-discuss] BQL execution failed? - BADARG

Lynton,

Lynton Grice wrote:
> BQL> select * from exchanges
> 
> {"init terminating in do_boot",{badarg,[{io,format,[<0.29.0>,"BQL 
> execution failed:~n  
> ~s~n",[{undef,[{rabbit_misc,localnode,[rabbit]},{bql_applicator,appl
> 
> y_commands,2},

Looks like the BQL plug-in hasn't been updated following a recent change 
in some of the RabbitMQ server's internal APIs. I have filed a bug to 
get that fixed.

Thanks for reporting this.


Regards,

Matthias.




From matthias at lshift.net  Fri Nov  6 08:24:14 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 06 Nov 2009 08:24:14 +0000
Subject: [rabbitmq-discuss] BQL execution failed? - BADARG
In-Reply-To: <004801ca5eb9$1dd01fa0$59705ee0$@grice@logosworld.com>
References: <000a01ca5e9c$ab74fb40$025ef1c0$@grice@logosworld.com>
	<4AF3D673.1050706@lshift.net>
	<004801ca5eb9$1dd01fa0$59705ee0$@grice@logosworld.com>
Message-ID: <4AF3DD2E.7080406@lshift.net>

Lynton,

Lynton Grice wrote:
> How do people like me know when the bug fix has been done?

For bugs that have been reported on the list, and that we fix promptly, 
we generally send a mail to the list.

You can also subscribe to rss/atom feeds of changes at 
http://hg.rabbitmq.com/.


Regards,

Matthias.



From alexis.richardson at gmail.com  Fri Nov  6 08:24:32 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 6 Nov 2009 08:24:32 +0000
Subject: [rabbitmq-discuss] API for Acess Control
In-Reply-To: <4AF3DA5D.2000608@lshift.net>
References: <8F16BDCC98E64841857E711110AF5EDDF4D8A54497@EXMBX01.wealthcraft.local>
	<167204d20911051341y5f470d70lea3afa223be3fa76@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDDF4D8A54502@EXMBX01.wealthcraft.local>
	<4AF3DA5D.2000608@lshift.net>
Message-ID: <167204d20911060024y7088e14fq9f9c47d71792b899@mail.gmail.com>

On Fri, Nov 6, 2009 at 8:12 AM, Matthias Radestock <matthias at lshift.net> wrote:
>
> Desrie Qi wrote:
>>
>> Do you mean currently is not possible for client to control this by
>> win/web UI for RPC?
>
> You asked about .NET APIs. If you want a win/web UI, then there are existing
> monitoring and "management" UIs that people have written. IIRC some of them
> allow configuration of the broker, rather than just monitoring, but I could
> be wrong. Alexis may have a list somewhere of the UIs we are currently aware
> of.

Indeed...

Desrie,

You can also use a pair of tools called Alice and Wonderland.
Wonderland is a web GUI.  It is a front end for Alice which is a
programmatic HTTP interface for RabbitMQ:
http://willcodeforfoo.com/2009/07/13/announcing-alice/

Links to other tools and blog posts about management are here:
http://delicious.com/alexisrichardson/rabbitmq+management

alexis



From igor at goryachev.org  Fri Nov  6 08:58:14 2009
From: igor at goryachev.org (Igor Goryachev)
Date: Fri, 06 Nov 2009 11:58:14 +0300
Subject: [rabbitmq-discuss] a possibility of AMQP/RabbitMQ extension?
In-Reply-To: <167204d20911051239u7dc83f5pb769fa9da3ce9ee3@mail.gmail.com>
	(Alexis Richardson's message of "Thu, 5 Nov 2009 20:39:44 +0000")
References: <87pr7x9gzb.fsf@goryachev.org>
	<167204d20911050658v5a131ad5u339dbac5250eea52@mail.gmail.com>
	<87ljil7x7z.fsf@goryachev.org>
	<167204d20911051239u7dc83f5pb769fa9da3ce9ee3@mail.gmail.com>
Message-ID: <87skcsghcp.fsf@goryachev.org>

Alexis Richardson <alexis.richardson at gmail.com> writes:

>> BTW, is it safe to implement i.e. custom methods or some other 'core'
>> features?
>
> I'm not sure what you mean - do you mean modifying the source of the
> broker?  Or something else?

I meant modifying AMQP proto itself (then of course modifying broker and
client source core accordingly).


Well, yet another dummy question. Is it possible to get particular
message from the queue? I.e. there three messages waiting in queue,
'message_a', 'message_b' and 'message_c'. Is there any chance to get
'message_b' while not even touching other messages? I guess it is
impossible, but I want to get sure.


-- 
    Igor Goryachev              E-Mail/Jabber: igor at goryachev.org



From pauljones23 at gmail.com  Fri Nov  6 09:11:13 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 6 Nov 2009 09:11:13 +0000
Subject: [rabbitmq-discuss] a possibility of AMQP/RabbitMQ extension?
In-Reply-To: <87skcsghcp.fsf@goryachev.org>
References: <87pr7x9gzb.fsf@goryachev.org>
	<167204d20911050658v5a131ad5u339dbac5250eea52@mail.gmail.com>
	<87ljil7x7z.fsf@goryachev.org>
	<167204d20911051239u7dc83f5pb769fa9da3ce9ee3@mail.gmail.com>
	<87skcsghcp.fsf@goryachev.org>
Message-ID: <29598b610911060111r707ca993i929dbbd913613426@mail.gmail.com>

Igor,

You can get at the messages, but not in a particularly nice or scalable way.
If you setup a consumer on the queue without auto-acknowledgment, then
you'll receive all of the messages. If you then only acknowledge message B,
and then close the channel, the messages will be returned to the queue (and
redelivered to other consumers). This probably isn't an approach that is
recommended however, since it starts to get very messy once you break beyond
simplified examples such as the one you've just posted.

Paul.

On Fri, Nov 6, 2009 at 8:58 AM, Igor Goryachev <igor at goryachev.org> wrote:

> Alexis Richardson <alexis.richardson at gmail.com> writes:
>
> >> BTW, is it safe to implement i.e. custom methods or some other 'core'
> >> features?
> >
> > I'm not sure what you mean - do you mean modifying the source of the
> > broker?  Or something else?
>
> I meant modifying AMQP proto itself (then of course modifying broker and
> client source core accordingly).
>
>
> Well, yet another dummy question. Is it possible to get particular
> message from the queue? I.e. there three messages waiting in queue,
> 'message_a', 'message_b' and 'message_c'. Is there any chance to get
> 'message_b' while not even touching other messages? I guess it is
> impossible, but I want to get sure.
>
>
> --
>     Igor Goryachev              E-Mail/Jabber: igor at goryachev.org
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091106/dc64213b/attachment.htm 

From igor at goryachev.org  Fri Nov  6 09:11:14 2009
From: igor at goryachev.org (Igor Goryachev)
Date: Fri, 06 Nov 2009 12:11:14 +0300
Subject: [rabbitmq-discuss] testing RabbitMQ under high load
Message-ID: <87ocngggr1.fsf@goryachev.org>

Hello, everyone.

Does anybody know how to test RabbitMQ (or arbitrary AMQP broker) under
high load? Is there ready for use code for such task, maybe even based
on Tsung framework?


-- 
    Igor Goryachev              E-Mail/Jabber: igor at goryachev.org



From matthew at lshift.net  Fri Nov  6 10:06:20 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 6 Nov 2009 10:06:20 +0000
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
 memory
In-Reply-To: <4d376de30911051357s168e1583qe7f3402e215b0d84@mail.gmail.com>
References: <4d376de30910211417j2458d60fh3bf2690af8ca7861@mail.gmail.com>
	<4AE01D24.8020704@lshift.net>
	<4d376de30910221103h7cc9e0e3ja5e4e513271644ad@mail.gmail.com>
	<4AE0A585.1020701@lshift.net>
	<4d376de30910221350t5e646d7am942e88c4b0a1dae9@mail.gmail.com>
	<4d376de30910221422q3824d9cye43b3d428ae4fd3d@mail.gmail.com>
	<4AE0E99B.7040300@lshift.net>
	<4d376de30910221747h25bddf47pfab075df8524854f@mail.gmail.com>
	<4AE15339.10801@lshift.net>
	<4d376de30911051357s168e1583qe7f3402e215b0d84@mail.gmail.com>
Message-ID: <20091106100620.GB30680@wellquite.org>

Hi Stephen,

Thanks for the patch, and for digging around enough to come up with a
solution.

On Thu, Nov 05, 2009 at 01:57:31PM -0800, Stephen Day wrote:
> Indeed, this is a bit heinous, but it gets the job done. Unfortunately, I
> don't have the appropriate bug id so I didn't create an hg branch for you to
> pull from.

That's fine. I have to say that it's unlikely this patch will make it
through - the memory management code has gone through a lot of change
recently as we're getting a much better handle on resource management.
Whilst you've obviously been working from the head of our default branch
(many thanks!), there are a couple of issues with garbage collecting
every process like that, for example, it's possible that garbage
collecting vast numbers of processes will take longer than the
memory_check_interval, making messages queue up for the memory manager
process. This would become a problem if the garbage collection is unable
to reclaim any memory at all - eg millions of queues, all of which are
empty.

> As far as overall system effects go, I haven't noticed any (aside from the
> lack of crashes). We have been running this in production for a bit and
> haven't seen any large problems, although the application is low throughput.
> Are there any performance unit tests that I can run to check this?

Yeah, when you garbage collect a process it stops the process. Also, I
*believe* that Erlang uses a generational garbage collector. Normally,
it'll most likely only sweep the young generation, which should be
quick, but I suspect that manually calling garbage_collect will do a
full sweep of all generations, thus potentially taking longer. You may
find that this causes performance to dip.

We tend to measure using the java client. If you get that, and then ant
dist, and then cd build/dist, then start up rabbit and try:

sh runjava.sh com.rabbitmq.examples.MulticastMain -r 20000 -s 0 -a

On my machine, I can bump that 20000 to about 25000 and the sending
rates and receiving rates are about equal (i.e. the queue length doesn't
grow too much). Obviously your hardware may be different, but I suspect
that garbage collection may have a performance impact, obviously
depending on how often it's done. With the default memory_check_interval
of 1 sec, my guess is that it'd be noticeable.

Much better resource management is on its way. However, if your patch
works for you then obviously, please use it.

Matthew



From alexis.richardson at gmail.com  Fri Nov  6 10:16:16 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 6 Nov 2009 10:16:16 +0000
Subject: [rabbitmq-discuss] testing RabbitMQ under high load
In-Reply-To: <87ocngggr1.fsf@goryachev.org>
References: <87ocngggr1.fsf@goryachev.org>
Message-ID: <167204d20911060216t1e3ca58cyf2f0c6553f255790@mail.gmail.com>

On Fri, Nov 6, 2009 at 9:11 AM, Igor Goryachev <igor at goryachev.org> wrote:
> Hello, everyone.
>
> Does anybody know how to test RabbitMQ (or arbitrary AMQP broker) under
> high load? Is there ready for use code for such task

There are some suitable clients such as MulticastMain.

>From another thread today, from Matthew:

>> > We tend to measure using the java client. If you get that, and then ant
>> > dist, and then cd build/dist, then start up rabbit and try:
>> >
>> > sh runjava.sh com.rabbitmq.examples.MulticastMain -r 20000 -s 0 -a

You should also:

* Read http://old.nabble.com/Re:-Measuring-Broker-Behavior-p23930095.html
* Consider testing with a C client
* Keep the list informed in case anyone can help or comment ;-)

You may also find this search result set useful:

* http://www.google.co.uk/search?hl=en&q=nabble+rabbitmq+testing+matthias&btnG=Search&meta=&aq=f&oq=


> maybe even based
> on Tsung framework?

I am not sure what that is ..  Is it a testing harness?

alexis





>
> --
> ? ?Igor Goryachev ? ? ? ? ? ? ?E-Mail/Jabber: igor at goryachev.org
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthias at lshift.net  Fri Nov  6 10:22:45 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 06 Nov 2009 10:22:45 +0000
Subject: [rabbitmq-discuss] testing RabbitMQ under high load
In-Reply-To: <167204d20911060216t1e3ca58cyf2f0c6553f255790@mail.gmail.com>
References: <87ocngggr1.fsf@goryachev.org>
	<167204d20911060216t1e3ca58cyf2f0c6553f255790@mail.gmail.com>
Message-ID: <4AF3F8F5.2080001@lshift.net>

Alexis Richardson wrote:
> On Fri, Nov 6, 2009 at 9:11 AM, Igor Goryachev <igor at goryachev.org> wrote:
>> maybe even based on Tsung framework?
> 
> I am not sure what that is ..  Is it a testing harness?

http://tsung.erlang-projects.org/

It would be great if somebody wrote an AMQP plugin for tsung.


Matthias.



From alexis.richardson at gmail.com  Fri Nov  6 10:28:18 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 6 Nov 2009 10:28:18 +0000
Subject: [rabbitmq-discuss] a possibility of AMQP/RabbitMQ extension?
In-Reply-To: <29598b610911060111r707ca993i929dbbd913613426@mail.gmail.com>
References: <87pr7x9gzb.fsf@goryachev.org>
	<167204d20911050658v5a131ad5u339dbac5250eea52@mail.gmail.com>
	<87ljil7x7z.fsf@goryachev.org>
	<167204d20911051239u7dc83f5pb769fa9da3ce9ee3@mail.gmail.com>
	<87skcsghcp.fsf@goryachev.org>
	<29598b610911060111r707ca993i929dbbd913613426@mail.gmail.com>
Message-ID: <167204d20911060228q6d582bbbr5d8d125f57a02d2f@mail.gmail.com>

Igor,

Several people have asked about browsing queues, and being able to
read or extract selected messages out of order.

It's an interesting feature because it represents a different way of
thinking about messaging queues: as containers for resources, instead
of as streams of values.  It's not obvious whether this difference is
always fundamental.

As you can see from Paul's post below, our current implementation,
which follows the spirit of AMQP as well as the letter, forces you to
take a streams based view.  This leads to a number of contortions if
you want to reach into the middle of the stream without disrupting
other consumers.

If you have any thoughts on this let us know.

Re your other question about 'modifying AMQP proto': I think the
safest approach is to say a bit more about what you would like to do,
on this list.  We can advise.  I would not want to discourage anyone
from messing with the code or the innards of AMQP... but it's 'at your
own risk' ;-)

alexis





On Fri, Nov 6, 2009 at 9:11 AM, Paul Jones <pauljones23 at gmail.com> wrote:
> Igor,
>
> You can get at the messages, but not in a particularly nice or scalable way.
> If you setup a consumer on the queue without auto-acknowledgment, then
> you'll receive all of the messages. If you then only acknowledge message B,
> and then close the channel, the messages will be returned to the queue (and
> redelivered to other consumers). This probably isn't an approach that is
> recommended however, since it starts to get very messy once you break beyond
> simplified examples such as the one you've just posted.
>
> Paul.
>
> On Fri, Nov 6, 2009 at 8:58 AM, Igor Goryachev <igor at goryachev.org> wrote:
>>
>> Alexis Richardson <alexis.richardson at gmail.com> writes:
>>
>> >> BTW, is it safe to implement i.e. custom methods or some other 'core'
>> >> features?
>> >
>> > I'm not sure what you mean - do you mean modifying the source of the
>> > broker? ?Or something else?
>>
>> I meant modifying AMQP proto itself (then of course modifying broker and
>> client source core accordingly).
>>
>>
>> Well, yet another dummy question. Is it possible to get particular
>> message from the queue? I.e. there three messages waiting in queue,
>> 'message_a', 'message_b' and 'message_c'. Is there any chance to get
>> 'message_b' while not even touching other messages? I guess it is
>> impossible, but I want to get sure.
>>
>>
>> --
>> ? ?Igor Goryachev ? ? ? ? ? ? ?E-Mail/Jabber: igor at goryachev.org
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From desrie.qi at wealthcraft.com  Fri Nov  6 10:31:11 2009
From: desrie.qi at wealthcraft.com (Desrie Qi)
Date: Fri, 6 Nov 2009 18:31:11 +0800
Subject: [rabbitmq-discuss] API for Acess Control
In-Reply-To: <4AF3DA5D.2000608@lshift.net>
References: <8F16BDCC98E64841857E711110AF5EDDF4D8A54497@EXMBX01.wealthcraft.local>
	<167204d20911051341y5f470d70lea3afa223be3fa76@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDDF4D8A54502@EXMBX01.wealthcraft.local>
	<4AF3DA5D.2000608@lshift.net>
Message-ID: <8F16BDCC98E64841857E711110AF5EDDF4D8A54573@EXMBX01.wealthcraft.local>

Matthias

I just want to build a web UI myself by .Net AMQP API to achieve manage RabbitMQ permissions. I have difficulty to read Erlang.

Thanks
Desrie

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: Friday, 6 November 2009 4:12 PM
To: Desrie Qi
Cc: Alexis Richardson; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] API for Acess Control

Desrie,

Desrie Qi wrote:
> Do you mean currently is not possible for client to control this by win/web UI for RPC?

You asked about .NET APIs. If you want a win/web UI, then there are 
existing monitoring and "management" UIs that people have written. IIRC 
some of them allow configuration of the broker, rather than just 
monitoring, but I could be wrong. Alexis may have a list somewhere of 
the UIs we are currently aware of.


Regards,

Matthias.



From alexis.richardson at gmail.com  Fri Nov  6 10:37:02 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 6 Nov 2009 10:37:02 +0000
Subject: [rabbitmq-discuss] API for Acess Control
In-Reply-To: <8F16BDCC98E64841857E711110AF5EDDF4D8A54573@EXMBX01.wealthcraft.local>
References: <8F16BDCC98E64841857E711110AF5EDDF4D8A54497@EXMBX01.wealthcraft.local>
	<167204d20911051341y5f470d70lea3afa223be3fa76@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDDF4D8A54502@EXMBX01.wealthcraft.local>
	<4AF3DA5D.2000608@lshift.net>
	<8F16BDCC98E64841857E711110AF5EDDF4D8A54573@EXMBX01.wealthcraft.local>
Message-ID: <167204d20911060237u22aa8ecg9496e17725a34eb5@mail.gmail.com>

Desrie

You could build a GUI in .NET using any .NET tools you like, and make
use of the Alice HTTP management interface that I sent you a link to.
 That way not only do you not have to read Erlang, but you can use
HTTP to talk to RabbitMQ instead of AMQP :-)

For example see this use case from
http://willcodeforfoo.com/2009/07/13/announcing-alice/.  Below the
example is using curl but you could make the HTTP call from your .NET
client...

# Setting permissions
curl -i -XPOST -d '{"vhost":"/", "configure":".*", "read":".*", "write":".*"}' \
  http://localhost:9999/permissions/guest
HTTP/1.1 200 OK
Server: MochiWeb/1.0 (Any of you quaids got a smint?)
Date: Tue, 04 Aug 2009 07:55:33 GMT
Content-Type: text/json
Content-Length: 38

{"permissions":[["/",".*",".*",".*"]]}

Does that get you what you need?

alexis


On Fri, Nov 6, 2009 at 10:31 AM, Desrie Qi <desrie.qi at wealthcraft.com> wrote:
> Matthias
>
> I just want to build a web UI myself by .Net AMQP API to achieve manage RabbitMQ permissions. I have difficulty to read Erlang.
>
> Thanks
> Desrie
>
> -----Original Message-----
> From: Matthias Radestock [mailto:matthias at lshift.net]
> Sent: Friday, 6 November 2009 4:12 PM
> To: Desrie Qi
> Cc: Alexis Richardson; rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] API for Acess Control
>
> Desrie,
>
> Desrie Qi wrote:
>> Do you mean currently is not possible for client to control this by win/web UI for RPC?
>
> You asked about .NET APIs. If you want a win/web UI, then there are
> existing monitoring and "management" UIs that people have written. IIRC
> some of them allow configuration of the broker, rather than just
> monitoring, but I could be wrong. Alexis may have a list somewhere of
> the UIs we are currently aware of.
>
>
> Regards,
>
> Matthias.
>



From matthew at lshift.net  Fri Nov  6 10:43:43 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 6 Nov 2009 10:43:43 +0000
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
 memory
In-Reply-To: <20091106100620.GB30680@wellquite.org>
References: <4AE01D24.8020704@lshift.net>
	<4d376de30910221103h7cc9e0e3ja5e4e513271644ad@mail.gmail.com>
	<4AE0A585.1020701@lshift.net>
	<4d376de30910221350t5e646d7am942e88c4b0a1dae9@mail.gmail.com>
	<4d376de30910221422q3824d9cye43b3d428ae4fd3d@mail.gmail.com>
	<4AE0E99B.7040300@lshift.net>
	<4d376de30910221747h25bddf47pfab075df8524854f@mail.gmail.com>
	<4AE15339.10801@lshift.net>
	<4d376de30911051357s168e1583qe7f3402e215b0d84@mail.gmail.com>
	<20091106100620.GB30680@wellquite.org>
Message-ID: <20091106104343.GE30680@wellquite.org>

On Fri, Nov 06, 2009 at 10:06:20AM +0000, Matthew Sackman wrote:
> That's fine. I have to say that it's unlikely this patch will make it
> through - the memory management code has gone through a lot of change
> recently as we're getting a much better handle on resource management.
> Whilst you've obviously been working from the head of our default branch
> (many thanks!), there are a couple of issues with garbage collecting
> every process like that, for example, it's possible that garbage
> collecting vast numbers of processes will take longer than the
> memory_check_interval, making messages queue up for the memory manager
> process. This would become a problem if the garbage collection is unable
> to reclaim any memory at all - eg millions of queues, all of which are
> empty.

Some immediate ideas to improve this a little.
1) Only do the GC when you initially hit the memory alarm. I.e. in the
first case when going from non-alarmed to alarmed, put the gc in there,
then maybe recurse again (though you'll likely want another param on the
function to stop infinite recursion).

2) Only put GC in processes that are known to eat lots of RAM. Eg if
it's the persister, then putting in a manual GC right after it does a
snapshot is probably a good idea.

Matthew



From desrie.qi at wealthcraft.com  Fri Nov  6 10:48:44 2009
From: desrie.qi at wealthcraft.com (Desrie Qi)
Date: Fri, 6 Nov 2009 18:48:44 +0800
Subject: [rabbitmq-discuss] API for Acess Control
In-Reply-To: <167204d20911060237u22aa8ecg9496e17725a34eb5@mail.gmail.com>
References: <8F16BDCC98E64841857E711110AF5EDDF4D8A54497@EXMBX01.wealthcraft.local>
	<167204d20911051341y5f470d70lea3afa223be3fa76@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDDF4D8A54502@EXMBX01.wealthcraft.local>
	<4AF3DA5D.2000608@lshift.net>
	<8F16BDCC98E64841857E711110AF5EDDF4D8A54573@EXMBX01.wealthcraft.local>
	<167204d20911060237u22aa8ecg9496e17725a34eb5@mail.gmail.com>
Message-ID: <8F16BDCC98E64841857E711110AF5EDDF4D8A54574@EXMBX01.wealthcraft.local>

Alexis 

Appreciate for your great help. I'll get a try.

Thanks
Desrie

-----Original Message-----
From: Alexis Richardson [mailto:alexis.richardson at gmail.com] 
Sent: Friday, 6 November 2009 6:37 PM
To: Desrie Qi
Cc: Matthias Radestock; rabbitmq-discuss at lists.rabbitmq.com; jim at rabbitmq.com
Subject: Re: [rabbitmq-discuss] API for Acess Control

Desrie

You could build a GUI in .NET using any .NET tools you like, and make
use of the Alice HTTP management interface that I sent you a link to.
 That way not only do you not have to read Erlang, but you can use
HTTP to talk to RabbitMQ instead of AMQP :-)

For example see this use case from
http://willcodeforfoo.com/2009/07/13/announcing-alice/.  Below the
example is using curl but you could make the HTTP call from your .NET
client...

# Setting permissions
curl -i -XPOST -d '{"vhost":"/", "configure":".*", "read":".*", "write":".*"}' \
  http://localhost:9999/permissions/guest
HTTP/1.1 200 OK
Server: MochiWeb/1.0 (Any of you quaids got a smint?)
Date: Tue, 04 Aug 2009 07:55:33 GMT
Content-Type: text/json
Content-Length: 38

{"permissions":[["/",".*",".*",".*"]]}

Does that get you what you need?

alexis


On Fri, Nov 6, 2009 at 10:31 AM, Desrie Qi <desrie.qi at wealthcraft.com> wrote:
> Matthias
>
> I just want to build a web UI myself by .Net AMQP API to achieve manage RabbitMQ permissions. I have difficulty to read Erlang.
>
> Thanks
> Desrie
>
> -----Original Message-----
> From: Matthias Radestock [mailto:matthias at lshift.net]
> Sent: Friday, 6 November 2009 4:12 PM
> To: Desrie Qi
> Cc: Alexis Richardson; rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] API for Acess Control
>
> Desrie,
>
> Desrie Qi wrote:
>> Do you mean currently is not possible for client to control this by win/web UI for RPC?
>
> You asked about .NET APIs. If you want a win/web UI, then there are
> existing monitoring and "management" UIs that people have written. IIRC
> some of them allow configuration of the broker, rather than just
> monitoring, but I could be wrong. Alexis may have a list somewhere of
> the UIs we are currently aware of.
>
>
> Regards,
>
> Matthias.
>



From igor at goryachev.org  Fri Nov  6 11:18:54 2009
From: igor at goryachev.org (Igor Goryachev)
Date: Fri, 06 Nov 2009 14:18:54 +0300
Subject: [rabbitmq-discuss] testing RabbitMQ under high load
In-Reply-To: <167204d20911060216t1e3ca58cyf2f0c6553f255790@mail.gmail.com>
	(Alexis Richardson's message of "Fri, 6 Nov 2009 10:16:16 +0000")
References: <87ocngggr1.fsf@goryachev.org>
	<167204d20911060216t1e3ca58cyf2f0c6553f255790@mail.gmail.com>
Message-ID: <87y6mjgau9.fsf@goryachev.org>

On Fri, Nov 06, 2009 at 13:16, Alexis Richardson <alexis.richardson at gmail.com> wrote:

>> maybe even based
>> on Tsung framework?
>
> I am not sure what that is ..  Is it a testing harness?

Yes, Tsung is an open-source multi-protocol (HTTP, WebDAV, SOAP,
PostgreSQL, MySQL, LDAP and XMPP) distributed load testing tool written
in erlang, supported by ProccesOne and located here:
http://tsung.erlang-projects.org/. It is nice one, has a quite mature
code and I've used it on my previous job for testing XMPP servers.

I am not familiar with Java, so I would probably prefer to work with
erlangish AMQP client, in particular I would like to develop AMQP plugin
for Tsung environment. I just wanted to know, if somebody already has
done this. :-)

Many thanks for your answer!


-- 
    Igor Goryachev              E-Mail/Jabber: igor at goryachev.org



From alexis.richardson at gmail.com  Fri Nov  6 11:23:00 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 6 Nov 2009 11:23:00 +0000
Subject: [rabbitmq-discuss] testing RabbitMQ under high load
In-Reply-To: <87y6mjgau9.fsf@goryachev.org>
References: <87ocngggr1.fsf@goryachev.org>
	<167204d20911060216t1e3ca58cyf2f0c6553f255790@mail.gmail.com>
	<87y6mjgau9.fsf@goryachev.org>
Message-ID: <167204d20911060323w1af25ad2tdd3ece2db7c0f788@mail.gmail.com>

Igor

It would be great if you could develop an AMQP plugin for the Tsung environment!

It has not been done yet.

alexis


On Fri, Nov 6, 2009 at 11:18 AM, Igor Goryachev <igor at goryachev.org> wrote:
> On Fri, Nov 06, 2009 at 13:16, Alexis Richardson <alexis.richardson at gmail.com> wrote:
>
>>> maybe even based
>>> on Tsung framework?
>>
>> I am not sure what that is .. ?Is it a testing harness?
>
> Yes, Tsung is an open-source multi-protocol (HTTP, WebDAV, SOAP,
> PostgreSQL, MySQL, LDAP and XMPP) distributed load testing tool written
> in erlang, supported by ProccesOne and located here:
> http://tsung.erlang-projects.org/. It is nice one, has a quite mature
> code and I've used it on my previous job for testing XMPP servers.
>
> I am not familiar with Java, so I would probably prefer to work with
> erlangish AMQP client, in particular I would like to develop AMQP plugin
> for Tsung environment. I just wanted to know, if somebody already has
> done this. :-)
>
> Many thanks for your answer!
>
>
> --
> ? ?Igor Goryachev ? ? ? ? ? ? ?E-Mail/Jabber: igor at goryachev.org
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthew at lshift.net  Fri Nov  6 11:26:53 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 6 Nov 2009 11:26:53 +0000
Subject: [rabbitmq-discuss] Weird Issue when cluster member restarts
In-Reply-To: <9f4a617f0911051828q6c67b2e3jd51fd0261eadd8e2@mail.gmail.com>
References: <9f4a617f0911051828q6c67b2e3jd51fd0261eadd8e2@mail.gmail.com>
Message-ID: <20091106112652.GF30680@wellquite.org>

Hi Arun,

On Fri, Nov 06, 2009 at 07:58:09AM +0530, Arun Suresh wrote:
> My setup is as follows :
> * 2 RabbitMQ (1.7.0 running on R13B02.1) servers in a cluster (say rabbit at m1,
> rabbit at m2).. both disk nodes.
> * 2 Clients (client at m1 connected to rabbit at m1, client at m2 connected to
> rabbit at m2). I am using the Erlang client (which currently has an issue when
> connecting to a server which is part of a cluster... this I fixed by setting
> "insist = true" in the #'connection.open' record)

Can you elaborate on this issue a bit? Is this redirection coming back
from the server?

> * both clients have processes that have subscribed to the same durable Queue
> (Q) using the same key (K). Q is bound to a durable topic exchange (X). X
> and Q are created on rabbit at m1.

I don't understand what you mean by a queue with a key. I take it you
have one topic exchange, one queue bound to the exchange with one
binding key (is this the K you refer to above?), and two consumers on
the queue. (From reading the rest of your email, yes this is clearly
what you mean).

> Now this is what i do..
> * I bring down rabbit at m1, and client at m1 (They are co hosted... so both are
> brought down together). I do a "rabbitmqctl list_queues" on rabbit at m2... I
> do not see Q there..

Ok, so the queue has been created on m1, not m2.

> * I bring rabbit at m1 up again... After which I see Q when i do a "rabbitmqctl
> list_queues".
> * Before I bring up client at m2, I publish a messge to X with a routing key
> K...
> Issue  : Since client at m2 is up and has a process subscribed to Q, I expect
> that process to receive the message... It doesnt..

Indeed it won't.

Clustering makes all exchanges and queues available on all nodes of the
cluster. *However*, a queue is still located on a single node, even
though it is accessible via all nodes. The queue will be created on the
node the client is connected to when it creates the queue. Thus your
queue has been created on m1, thus it's accessible from both m1 and m2,
but when m1 goes down, the queue will go down with it.

>From that point on, m2 has no record of the queue, so msgs sent to X
with K to go to Q will not ever reach Q - as far as m2 is concerned, Q
just does not exist.

When m1 comes back up, Q will be recovered.

> Further more... I notice that when i bring client at m2 back up, It restarts
> its subscribers... now all messages published to X with K are sent ONLY to
> client at m2.

Well client at m1 died. This means its subscriptions to Q were lost - there
is no concept of persisting subscriptions, so when rabbit at m1 comes back
up, the Q will have no consumers at all. If you restart client at m2 then
yes, it'll recreate its subscription to Q, and thus receive all the msgs
sent to that Q. If you also restart client at m1 then that too will
recreate its subscription to Q and share the msgs with client at m2 as
before.

Hope this is of help.

Matthew



From pauljones23 at gmail.com  Fri Nov  6 11:48:10 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Fri, 6 Nov 2009 11:48:10 +0000
Subject: [rabbitmq-discuss] Error during "make" of RabbitMQ Erlang
	client - File operation error
In-Reply-To: <7843363470016095814@unknownmsgid>
References: <7843363470016095814@unknownmsgid>
Message-ID: <29598b610911060348q7f51db0bvb031869c4c6b47c6@mail.gmail.com>

Hi Lynton,

Unfortunately, none of the Rabbit development team has ever attempted to
build the Erlang client under Cygwin. Generally, we build on a more standard
UNIX platform and copy the binaries. So at this point, we can't really
confirm whether those messages are expected or not.

Sorry not to be more help on this issue.

Paul.

On Fri, Nov 6, 2009 at 6:32 AM, Lynton Grice <lynton.grice at logosworld.com>wrote:

>  Hi there,
>
>
>
> I just downloaded the default branch of the RabbitMQ Erlang client from
> http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/default.zip
>
>
>
> I am running all this on Windows and am using Cygwin to compile etc.
>
>
>
> When I run ?make? it kind of works BUT you can see a number of error
> reports below (I highlighted a couple errors in RED).
>
>
>
> Are these errors ?normal??
>
>
>
> $ make
>
> sed -e 's:%%VSN%%:0.0.0:g' < rabbit_common.app.in > rabbit_common.app
>
> make -C ../rabbitmq-server
>
> make[1]: Entering directory
> `/cygdrive/c/tmp/erlang/rabbitmq-public-umbrella/rab
>
> bitmq-server'
>
> make[1]: Nothing to be done for `all'.
>
> make[1]: Leaving directory
> `/cygdrive/c/tmp/erlang/rabbitmq-public-umbrella/rabb
>
> itmq-server'
>
> mkdir -p dist/rabbit_common/include
>
> mkdir -p dist/rabbit_common/ebin
>
> cp rabbit_common.app dist/rabbit_common/ebin
>
> ( cp ../rabbitmq-server/ebin/rabbit_writer.beam dist/rabbit_common/ebin );
> ( cp
>
>  ../rabbitmq-server/ebin/rabbit_reader.beam dist/rabbit_common/ebin );  (
> cp ../
>
> rabbitmq-server/ebin/rabbit_framing.beam dist/rabbit_common/ebin );  ( cp
> ../rab
>
> bitmq-server/ebin/rabbit_framing_channel.beam dist/rabbit_common/ebin );  (
> cp .
>
> ./rabbitmq-server/ebin/rabbit_basic.beam dist/rabbit_common/ebin );  ( cp
> ../rab
>
> bitmq-server/ebin/rabbit_binary_generator.beam dist/rabbit_common/ebin );
> ( cp
>
> ../rabbitmq-server/ebin/rabbit_binary_parser.beam dist/rabbit_common/ebin
> );  (
>
> cp ../rabbitmq-server/ebin/rabbit_channel.beam dist/rabbit_common/ebin );
> ( cp
>
> ../rabbitmq-server/ebin/rabbit_misc.beam dist/rabbit_common/ebin );  ( cp
> ../rab
>
> bitmq-server/ebin/rabbit_net.beam dist/rabbit_common/ebin );  ( cp
> ../rabbitmq-s
>
> erver/ebin/rabbit_heartbeat.beam dist/rabbit_common/ebin );  ( cp
> ../rabbitmq-se
>
> rver/ebin/gen_server2.beam dist/rabbit_common/ebin );
>
> cp ../rabbitmq-server/include/*.hrl dist/rabbit_common/include
>
> (cd dist; zip -r rabbit_common.ez rabbit_common)
>
>   adding: rabbit_common/ (stored 0%)
>
>   adding: rabbit_common/ebin/ (stored 0%)
>
>   adding: rabbit_common/ebin/gen_server2.beam (deflated 18%)
>
>   adding: rabbit_common/ebin/rabbit_basic.beam (deflated 7%)
>
>   adding: rabbit_common/ebin/rabbit_binary_generator.beam (deflated 13%)
>
>   adding: rabbit_common/ebin/rabbit_binary_parser.beam (deflated 19%)
>
>   adding: rabbit_common/ebin/rabbit_channel.beam (deflated 17%)
>
>   adding: rabbit_common/ebin/rabbit_common.app (deflated 61%)
>
>   adding: rabbit_common/ebin/rabbit_framing.beam (deflated 20%)
>
>   adding: rabbit_common/ebin/rabbit_framing_channel.beam (deflated 14%)
>
>   adding: rabbit_common/ebin/rabbit_heartbeat.beam (deflated 23%)
>
>   adding: rabbit_common/ebin/rabbit_misc.beam (deflated 17%)
>
>   adding: rabbit_common/ebin/rabbit_net.beam (deflated 12%)
>
>   adding: rabbit_common/ebin/rabbit_reader.beam (deflated 16%)
>
>   adding: rabbit_common/ebin/rabbit_writer.beam (deflated 11%)
>
>   adding: rabbit_common/include/ (stored 0%)
>
>   adding: rabbit_common/include/rabbit.hrl (deflated 70%)
>
>   adding: rabbit_common/include/rabbit_framing.hrl (deflated 77%)
>
>   adding: rabbit_common/include/rabbit_framing_spec.hrl (deflated 62%)
>
> mkdir -p deps
>
> unzip -o -d deps dist/rabbit_common.ez
>
> Archive:  dist/rabbit_common.ez
>
>    creating: deps/rabbit_common/
>
>    creating: deps/rabbit_common/ebin/
>
>   inflating: deps/rabbit_common/ebin/gen_server2.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_basic.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_binary_generator.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_binary_parser.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_channel.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_common.app
>
>   inflating: deps/rabbit_common/ebin/rabbit_framing.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_framing_channel.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_heartbeat.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_misc.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_net.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_reader.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_writer.beam
>
>    creating: deps/rabbit_common/include/
>
>   inflating: deps/rabbit_common/include/rabbit.hrl
>
>   inflating: deps/rabbit_common/include/rabbit_framing.hrl
>
>   inflating: deps/rabbit_common/include/rabbit_framing_spec.hrl
>
> mkdir -p deps
>
> unzip -o -d deps dist/rabbit_common.ez
>
> Archive:  dist/rabbit_common.ez
>
>   inflating: deps/rabbit_common/ebin/gen_server2.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_basic.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_binary_generator.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_binary_parser.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_channel.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_common.app
>
>   inflating: deps/rabbit_common/ebin/rabbit_framing.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_framing_channel.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_heartbeat.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_misc.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_net.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_reader.beam
>
>   inflating: deps/rabbit_common/ebin/rabbit_writer.beam
>
>   inflating: deps/rabbit_common/include/rabbit.hrl
>
>   inflating: deps/rabbit_common/include/rabbit_framing.hrl
>
>   inflating: deps/rabbit_common/include/rabbit_framing_spec.hrl
>
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> src/amqp_channe
>
> l.erl
>
> {error_logger,{{2009,11,6},{6,31,14}},std_error,"File operation error: eio.
> Targ
>
> et: deps:dist. Function: list_dir. Process: code_server."}
>
>
>
> =ERROR REPORT==== 6-Nov-2009::06:31:14 ===
>
> File operation error: eio. Target: deps:dist. Function: list_dir. Process:
> code_
>
> server.
>
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> src/amqp_channe
>
> l_util.erl
>
> {error_logger,{{2009,11,6},{6,31,21}},std_error,"File operation error: eio.
> Targ
>
> et: deps:dist. Function: list_dir. Process: code_server."}
>
>
>
> =ERROR REPORT==== 6-Nov-2009::06:31:21 ===
>
> File operation error: eio. Target: deps:dist. Function: list_dir. Process:
> code_
>
> server.
>
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> src/amqp_connec
>
> tion.erl
>
> {error_logger,{{2009,11,6},{6,31,24}},std_error,"File operation error: eio.
> Targ
>
> et: deps:dist. Function: list_dir. Process: code_server."}
>
>
>
> =ERROR REPORT==== 6-Nov-2009::06:31:24 ===
>
> File operation error: eio. Target: deps:dist. Function: list_dir. Process:
> code_
>
> server.
>
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> src/amqp_direct
>
> _connection.erl
>
> {error_logger,{{2009,11,6},{6,31,28}},std_error,"File operation error: eio.
> Targ
>
> et: deps:dist. Function: list_dir. Process: code_server."}
>
>
>
> =ERROR REPORT==== 6-Nov-2009::06:31:28 ===
>
> File operation error: eio. Target: deps:dist. Function: list_dir. Process:
> code_
>
> server.
>
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> src/amqp_main_r
>
> eader.erl
>
> {error_logger,{{2009,11,6},{6,31,32}},std_error,"File operation error: eio.
> Targ
>
> et: deps:dist. Function: list_dir. Process: code_server."}
>
>
>
> =ERROR REPORT==== 6-Nov-2009::06:31:32 ===
>
> File operation error: eio. Target: deps:dist. Function: list_dir. Process:
> code_
>
> server.
>
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> src/amqp_networ
>
> k_connection.erl
>
> {error_logger,{{2009,11,6},{6,31,35}},std_error,"File operation error: eio.
> Targ
>
> et: deps:dist. Function: list_dir. Process: code_server."}
>
>
>
> =ERROR REPORT==== 6-Nov-2009::06:31:35 ===
>
> File operation error: eio. Target: deps:dist. Function: list_dir. Process:
> code_
>
> server.
>
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> src/amqp_rpc_cl
>
> ient.erl
>
> {error_logger,{{2009,11,6},{6,31,39}},std_error,"File operation error: eio.
> Targ
>
> et: deps:dist. Function: list_dir. Process: code_server."}
>
>
>
> =ERROR REPORT==== 6-Nov-2009::06:31:39 ===
>
> File operation error: eio. Target: deps:dist. Function: list_dir. Process:
> code_
>
> server.
>
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> src/amqp_rpc_se
>
> rver.erl
>
> {error_logger,{{2009,11,6},{6,31,42}},std_error,"File operation error: eio.
> Targ
>
> et: deps:dist. Function: list_dir. Process: code_server."}
>
>
>
> =ERROR REPORT==== 6-Nov-2009::06:31:42 ===
>
> File operation error: eio. Target: deps:dist. Function: list_dir. Process:
> code_
>
> server.
>
> sed -e 's:%%VSN%%:0.0.0:g' < ebin/amqp_client.app.in >
> ebin/amqp_client.app
>
> rm -rf dist/amqp_client
>
> mkdir -p dist/amqp_client/ebin
>
> cp -r ebin/*.beam dist/amqp_client/ebin
>
> cp -r ebin/*.app dist/amqp_client/ebin
>
> mkdir -p dist/amqp_client/include
>
> cp -r include/* dist/amqp_client/include
>
> (cd dist; zip -r amqp_client.ez amqp_client)
>
>   adding: amqp_client/ (stored 0%)
>
>   adding: amqp_client/ebin/ (stored 0%)
>
>   adding: amqp_client/ebin/amqp_channel.beam (deflated 14%)
>
>   adding: amqp_client/ebin/amqp_channel_util.beam (deflated 13%)
>
>   adding: amqp_client/ebin/amqp_client.app (deflated 57%)
>
>   adding: amqp_client/ebin/amqp_connection.beam (deflated 7%)
>
>   adding: amqp_client/ebin/amqp_direct_connection.beam (deflated 10%)
>
>   adding: amqp_client/ebin/amqp_main_reader.beam (deflated 9%)
>
>   adding: amqp_client/ebin/amqp_network_connection.beam (deflated 13%)
>
>   adding: amqp_client/ebin/amqp_rpc_client.beam (deflated 7%)
>
>   adding: amqp_client/ebin/amqp_rpc_server.beam (deflated 6%)
>
>   adding: amqp_client/include/ (stored 0%)
>
>   adding: amqp_client/include/amqp_client.hrl (deflated 54%)
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091106/4e5987b5/attachment.htm 

From michael at elsdoerfer.com  Fri Nov  6 12:47:38 2009
From: michael at elsdoerfer.com (=?ISO-8859-1?Q?Michael_Elsd=F6rfer?=)
Date: Fri, 06 Nov 2009 13:47:38 +0100
Subject: [rabbitmq-discuss] DNS Issues / Error: cannot_get_pid
Message-ID: <4AF41AEA.5050306@elsdoerfer.com>

I am running into this problem:

http://old.nabble.com/Re:-getting-started,-broker-runs--can't-get-status-p21759181.html
http://old.nabble.com/Re:-getting-started,-broker-runs--can't-get-status-p21816912.html

That is, when trying to start up the server it hangs for a long time,
before ending with "Error: cannot_get_pid" in startup_err. In the
background, the server seems to be running though, and two ... processes
are also run by the rabbitmq user, so apparently it is trying to do some
DNS resolving.

My hostname resolves to a public ip address, and communication on there
is dropped by the firewall. If I point it to localhost in /etc/hosts,
everything works fine.

I wonder if there is another solution (I couldn't find one in the thread
above). Can't I tell rabbitmq to just bind to loopback? It's really only
supposed to run locally.

Thanks.

Michael




From lynton.grice at logosworld.com  Fri Nov  6 13:00:54 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Fri, 6 Nov 2009 15:00:54 +0200
Subject: [rabbitmq-discuss] Error during "make" of RabbitMQ Erlang
	client - File operation error
In-Reply-To: <29598b610911060348q7f51db0bvb031869c4c6b47c6@mail.gmail.com>
References: <7843363470016095814@unknownmsgid>
	<29598b610911060348q7f51db0bvb031869c4c6b47c6@mail.gmail.com>
Message-ID: <006001ca5ee1$31301e10$93905a30$@grice@logosworld.com>

Hey Paul,

 

No stress at all....personally I need to move off this Windows rubbish
anyway and onto a proper OS like Ubuntu or a BSD version..

 

Thanks anyway ;-)

 

Lynton

 

From: Paul Jones [mailto:pauljones23 at gmail.com] 
Sent: 06 November 2009 01:48 PM
To: Lynton Grice
Cc: rabbitmq
Subject: Re: [rabbitmq-discuss] Error during "make" of RabbitMQ Erlang
client - File operation error

 

Hi Lynton,

Unfortunately, none of the Rabbit development team has ever attempted to
build the Erlang client under Cygwin. Generally, we build on a more standard
UNIX platform and copy the binaries. So at this point, we can't really
confirm whether those messages are expected or not.

Sorry not to be more help on this issue.

Paul.

On Fri, Nov 6, 2009 at 6:32 AM, Lynton Grice <lynton.grice at logosworld.com>
wrote:

Hi there,

 

I just downloaded the default branch of the RabbitMQ Erlang client from
http://hg.rabbitmq.com/rabbitmq-erlang-client/archive/default.zip

 

I am running all this on Windows and am using Cygwin to compile etc.

 

When I run "make" it kind of works BUT you can see a number of error reports
below (I highlighted a couple errors in RED).

 

Are these errors "normal"?

 

$ make

sed -e 's:%%VSN%%:0.0.0:g' < rabbit_common.app.in > rabbit_common.app

make -C ../rabbitmq-server

make[1]: Entering directory
`/cygdrive/c/tmp/erlang/rabbitmq-public-umbrella/rab

bitmq-server'

make[1]: Nothing to be done for `all'.

make[1]: Leaving directory
`/cygdrive/c/tmp/erlang/rabbitmq-public-umbrella/rabb

itmq-server'

mkdir -p dist/rabbit_common/include

mkdir -p dist/rabbit_common/ebin

cp rabbit_common.app dist/rabbit_common/ebin

( cp ../rabbitmq-server/ebin/rabbit_writer.beam dist/rabbit_common/ebin );
( cp

 ../rabbitmq-server/ebin/rabbit_reader.beam dist/rabbit_common/ebin );  ( cp
../

rabbitmq-server/ebin/rabbit_framing.beam dist/rabbit_common/ebin );  ( cp
../rab

bitmq-server/ebin/rabbit_framing_channel.beam dist/rabbit_common/ebin );  (
cp .

./rabbitmq-server/ebin/rabbit_basic.beam dist/rabbit_common/ebin );  ( cp
../rab

bitmq-server/ebin/rabbit_binary_generator.beam dist/rabbit_common/ebin );  (
cp

../rabbitmq-server/ebin/rabbit_binary_parser.beam dist/rabbit_common/ebin );
(

cp ../rabbitmq-server/ebin/rabbit_channel.beam dist/rabbit_common/ebin );  (
cp

../rabbitmq-server/ebin/rabbit_misc.beam dist/rabbit_common/ebin );  ( cp
../rab

bitmq-server/ebin/rabbit_net.beam dist/rabbit_common/ebin );  ( cp
../rabbitmq-s

erver/ebin/rabbit_heartbeat.beam dist/rabbit_common/ebin );  ( cp
../rabbitmq-se

rver/ebin/gen_server2.beam dist/rabbit_common/ebin );

cp ../rabbitmq-server/include/*.hrl dist/rabbit_common/include

(cd dist; zip -r rabbit_common.ez rabbit_common)

  adding: rabbit_common/ (stored 0%)

  adding: rabbit_common/ebin/ (stored 0%)

  adding: rabbit_common/ebin/gen_server2.beam (deflated 18%)

  adding: rabbit_common/ebin/rabbit_basic.beam (deflated 7%)

  adding: rabbit_common/ebin/rabbit_binary_generator.beam (deflated 13%)

  adding: rabbit_common/ebin/rabbit_binary_parser.beam (deflated 19%)

  adding: rabbit_common/ebin/rabbit_channel.beam (deflated 17%)

  adding: rabbit_common/ebin/rabbit_common.app (deflated 61%)

  adding: rabbit_common/ebin/rabbit_framing.beam (deflated 20%)

  adding: rabbit_common/ebin/rabbit_framing_channel.beam (deflated 14%)

  adding: rabbit_common/ebin/rabbit_heartbeat.beam (deflated 23%)

  adding: rabbit_common/ebin/rabbit_misc.beam (deflated 17%)

  adding: rabbit_common/ebin/rabbit_net.beam (deflated 12%)

  adding: rabbit_common/ebin/rabbit_reader.beam (deflated 16%)

  adding: rabbit_common/ebin/rabbit_writer.beam (deflated 11%)

  adding: rabbit_common/include/ (stored 0%)

  adding: rabbit_common/include/rabbit.hrl (deflated 70%)

  adding: rabbit_common/include/rabbit_framing.hrl (deflated 77%)

  adding: rabbit_common/include/rabbit_framing_spec.hrl (deflated 62%)

mkdir -p deps

unzip -o -d deps dist/rabbit_common.ez

Archive:  dist/rabbit_common.ez

   creating: deps/rabbit_common/

   creating: deps/rabbit_common/ebin/

  inflating: deps/rabbit_common/ebin/gen_server2.beam

  inflating: deps/rabbit_common/ebin/rabbit_basic.beam

  inflating: deps/rabbit_common/ebin/rabbit_binary_generator.beam

  inflating: deps/rabbit_common/ebin/rabbit_binary_parser.beam

  inflating: deps/rabbit_common/ebin/rabbit_channel.beam

  inflating: deps/rabbit_common/ebin/rabbit_common.app

  inflating: deps/rabbit_common/ebin/rabbit_framing.beam

  inflating: deps/rabbit_common/ebin/rabbit_framing_channel.beam

  inflating: deps/rabbit_common/ebin/rabbit_heartbeat.beam

  inflating: deps/rabbit_common/ebin/rabbit_misc.beam

  inflating: deps/rabbit_common/ebin/rabbit_net.beam

  inflating: deps/rabbit_common/ebin/rabbit_reader.beam

  inflating: deps/rabbit_common/ebin/rabbit_writer.beam

   creating: deps/rabbit_common/include/

  inflating: deps/rabbit_common/include/rabbit.hrl

  inflating: deps/rabbit_common/include/rabbit_framing.hrl

  inflating: deps/rabbit_common/include/rabbit_framing_spec.hrl

mkdir -p deps

unzip -o -d deps dist/rabbit_common.ez

Archive:  dist/rabbit_common.ez

  inflating: deps/rabbit_common/ebin/gen_server2.beam

  inflating: deps/rabbit_common/ebin/rabbit_basic.beam

  inflating: deps/rabbit_common/ebin/rabbit_binary_generator.beam

  inflating: deps/rabbit_common/ebin/rabbit_binary_parser.beam

  inflating: deps/rabbit_common/ebin/rabbit_channel.beam

  inflating: deps/rabbit_common/ebin/rabbit_common.app

  inflating: deps/rabbit_common/ebin/rabbit_framing.beam

  inflating: deps/rabbit_common/ebin/rabbit_framing_channel.beam

  inflating: deps/rabbit_common/ebin/rabbit_heartbeat.beam

  inflating: deps/rabbit_common/ebin/rabbit_misc.beam

  inflating: deps/rabbit_common/ebin/rabbit_net.beam

  inflating: deps/rabbit_common/ebin/rabbit_reader.beam

  inflating: deps/rabbit_common/ebin/rabbit_writer.beam

  inflating: deps/rabbit_common/include/rabbit.hrl

  inflating: deps/rabbit_common/include/rabbit_framing.hrl

  inflating: deps/rabbit_common/include/rabbit_framing_spec.hrl

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_channe

l.erl

{error_logger,{{2009,11,6},{6,31,14}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:14 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_channe

l_util.erl

{error_logger,{{2009,11,6},{6,31,21}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:21 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_connec

tion.erl

{error_logger,{{2009,11,6},{6,31,24}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:24 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_direct

_connection.erl

{error_logger,{{2009,11,6},{6,31,28}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:28 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_main_r

eader.erl

{error_logger,{{2009,11,6},{6,31,32}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:32 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_networ

k_connection.erl

{error_logger,{{2009,11,6},{6,31,35}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:35 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_rpc_cl

ient.erl

{error_logger,{{2009,11,6},{6,31,39}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:39 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
src/amqp_rpc_se

rver.erl

{error_logger,{{2009,11,6},{6,31,42}},std_error,"File operation error: eio.
Targ

et: deps:dist. Function: list_dir. Process: code_server."}

 

=ERROR REPORT==== 6-Nov-2009::06:31:42 ===

File operation error: eio. Target: deps:dist. Function: list_dir. Process:
code_

server.

sed -e 's:%%VSN%%:0.0.0:g' < ebin/amqp_client.app.in > ebin/amqp_client.app

rm -rf dist/amqp_client

mkdir -p dist/amqp_client/ebin

cp -r ebin/*.beam dist/amqp_client/ebin

cp -r ebin/*.app dist/amqp_client/ebin

mkdir -p dist/amqp_client/include

cp -r include/* dist/amqp_client/include

(cd dist; zip -r amqp_client.ez amqp_client)

  adding: amqp_client/ (stored 0%)

  adding: amqp_client/ebin/ (stored 0%)

  adding: amqp_client/ebin/amqp_channel.beam (deflated 14%)

  adding: amqp_client/ebin/amqp_channel_util.beam (deflated 13%)

  adding: amqp_client/ebin/amqp_client.app (deflated 57%)

  adding: amqp_client/ebin/amqp_connection.beam (deflated 7%)

  adding: amqp_client/ebin/amqp_direct_connection.beam (deflated 10%)

  adding: amqp_client/ebin/amqp_main_reader.beam (deflated 9%)

  adding: amqp_client/ebin/amqp_network_connection.beam (deflated 13%)

  adding: amqp_client/ebin/amqp_rpc_client.beam (deflated 7%)

  adding: amqp_client/ebin/amqp_rpc_server.beam (deflated 6%)

  adding: amqp_client/include/ (stored 0%)

  adding: amqp_client/include/amqp_client.hrl (deflated 54%)


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091106/f0030a1f/attachment.htm 

From igor at goryachev.org  Fri Nov  6 13:22:22 2009
From: igor at goryachev.org (Igor Goryachev)
Date: Fri, 06 Nov 2009 16:22:22 +0300
Subject: [rabbitmq-discuss] testing RabbitMQ under high load
In-Reply-To: <167204d20911060323w1af25ad2tdd3ece2db7c0f788@mail.gmail.com>
	(Alexis Richardson's message of "Fri, 6 Nov 2009 11:23:00 +0000")
References: <87ocngggr1.fsf@goryachev.org>
	<167204d20911060216t1e3ca58cyf2f0c6553f255790@mail.gmail.com>
	<87y6mjgau9.fsf@goryachev.org>
	<167204d20911060323w1af25ad2tdd3ece2db7c0f788@mail.gmail.com>
Message-ID: <87tyx7g54h.fsf@goryachev.org>

On Fri, Nov 06, 2009 at 14:23, Alexis Richardson <alexis.richardson at gmail.com> wrote:

> It would be great if you could develop an AMQP plugin for the Tsung environment!
>
> It has not been done yet.

Ok. I have started implementation of AMQP plugin for Tsung. Details will
follow a bit later.


-- 
    Igor Goryachev              E-Mail/Jabber: igor at goryachev.org



From tim.cole at canonical.com  Fri Nov  6 15:44:23 2009
From: tim.cole at canonical.com (Tim Cole)
Date: Fri, 06 Nov 2009 10:44:23 -0500
Subject: [rabbitmq-discuss] auto_delete queues not going away
In-Reply-To: <4AF359A1.6000900@lshift.net>
References: <1257458267.3831.383.camel@bede>  <4AF359A1.6000900@lshift.net>
Message-ID: <1257522263.3831.396.camel@bede>

On Thu, 2009-11-05 at 23:02 +0000, Matthias Radestock wrote:
> Marking an exclusive queue as durable is quite a strange thing to do, 
> since 'exclusive' means the queue should go away when the creating 
> connection dies, such as during a broker restart, but 'durable' means it 
> should survive broker restarts.

The reason for durable in this case was to match the exchange, since a
decision had been made to declare the exchange manually as a once-off
and keep it around rather than having clients do that.  I'm content to
have the clients attempt to declare the exchange if it doesn't exist
though.

> There is in fact a known problem with durable, exclusive queues - if the 
> server restarts it is possible that these queues survive even though 
> their owning connections are dead.

Hm, in this case the server wasn't restarted, but the clients were shut
down and replaced by new machines.  Perhaps it's also an issue if the
connection wasn't shut down cleanly?

> So I suggest dropping the 'durable' flag.
> 
> Also note that auto_delete only kicks in only after the queue has had at 
> least one consumer registered with basic.consume. basic.get doesn't count.

basic.consume was in use in this case.

> And exclusivity is attached to the *connection*, not the channel, so 
> it's worth checking that the connection(s) which created the queues are 
> indeed dead.

They definitely are; the client machines to which those queues belonged
were taken down.

Anyway, it sounds like what we want in this particular case is
durable=False, exclusive=True, and auto_delete=False.  Ideally, we don't
actually want the queue to go away when the channel/consumer dies, but
only if the connection does.  Does that sound right?

Thanks,
-Tim
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091106/1bd651f9/attachment.pgp 

From matthias at lshift.net  Fri Nov  6 17:00:35 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 06 Nov 2009 17:00:35 +0000
Subject: [rabbitmq-discuss] auto_delete queues not going away
In-Reply-To: <1257522263.3831.396.camel@bede>
References: <1257458267.3831.383.camel@bede> <4AF359A1.6000900@lshift.net>
	<1257522263.3831.396.camel@bede>
Message-ID: <4AF45633.3090402@lshift.net>

Tim,

Tim Cole wrote:
> The server wasn't restarted, but the clients were shut down and
> replaced by new machines.  Perhaps it's also an issue if the 
> connection wasn't shut down cleanly?

An "abrupt" termination of a client connection will cause the associated
exclusive queues to be deleted. There are no known problems with that
functionality, and it is used widely.

So if the queues stayed around then either they weren't declared as
'exclusive' after all, or the server thought the connections were still
alive.

> Anyway, it sounds like what we want in this particular case is
> durable=False, exclusive=True, and auto_delete=False.  Ideally, we don't
> actually want the queue to go away when the channel/consumer dies, but
> only if the connection does.  Does that sound right?

Spot on.


Regards,

Matthias.



From sjaday at gmail.com  Fri Nov  6 20:57:33 2009
From: sjaday at gmail.com (Stephen Day)
Date: Fri, 6 Nov 2009 12:57:33 -0800
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
	memory
In-Reply-To: <20091106104343.GE30680@wellquite.org>
References: <4AE01D24.8020704@lshift.net> <4AE0A585.1020701@lshift.net>
	<4d376de30910221350t5e646d7am942e88c4b0a1dae9@mail.gmail.com>
	<4d376de30910221422q3824d9cye43b3d428ae4fd3d@mail.gmail.com>
	<4AE0E99B.7040300@lshift.net>
	<4d376de30910221747h25bddf47pfab075df8524854f@mail.gmail.com>
	<4AE15339.10801@lshift.net>
	<4d376de30911051357s168e1583qe7f3402e215b0d84@mail.gmail.com>
	<20091106100620.GB30680@wellquite.org>
	<20091106104343.GE30680@wellquite.org>
Message-ID: <4d376de30911061257p163ac74eh31f82d0f4e74a19@mail.gmail.com>

On Fri, Nov 6, 2009 at 2:43 AM, Matthew Sackman <matthew at lshift.net> wrote:

> On Fri, Nov 06, 2009 at 10:06:20AM +0000, Matthew Sackman wrote:
> > That's fine. I have to say that it's unlikely this patch will make it
> > through - the memory management code has gone through a lot of change
> > recently as we're getting a much better handle on resource management.
>
Agreed. This is a definitely a workaround fix for the problem. In the
interest of full disclosure, I have gotten rabbitmq to crash with this patch
for the same reason, by getting the memory to spike before excess can be
collected, so this isn't a full fix by any means. I will try to dig further
into the root cause in 1.7.0 release when I have time.


> > Whilst you've obviously been working from the head of our default branch
> > (many thanks!), there are a couple of issues with garbage collecting
> > every process like that, for example, it's possible that garbage
> > collecting vast numbers of processes will take longer than the
> > memory_check_interval, making messages queue up for the memory manager
> > process. This would become a problem if the garbage collection is unable
> > to reclaim any memory at all - eg millions of queues, all of which are
> > empty.
>
However, with rabbit's current memory problems, I wouldn't run it with more
than 10 queues, let alone millions ;). I will give the java client test a
try.


>
> Some immediate ideas to improve this a little.
> 1) Only do the GC when you initially hit the memory alarm. I.e. in the
> first case when going from non-alarmed to alarmed, put the gc in there,
> then maybe recurse again (though you'll likely want another param on the
> function to stop infinite recursion).
>
This was my initial thought as well. However, by the time the alarm goes
off, it is often too late for this to stop rabbit from crashing. For
example, the default memory alarm is set to 0.95. Many of the crashes where
to due to a failed allocation of 200-300 MB by the VM. At 4GB (rounding
*up*), 200 MB is the limit of the allocation that can be made before garbage
collecting (1 - .2/4 = 0.95). So, if more is allocated, the server is dead
in the water.


> 2) Only put GC in processes that are known to eat lots of RAM. Eg if
> it's the persister, then putting in a manual GC right after it does a
> snapshot is probably a good idea.
>
The persister is indeed where the binary memory is hanging around, but I am
not sure if the snapshot point is the problem. The crashes happen when
adding batches into the queue. Its like the persister can't keep up.

For now, I will try this at the same point shown in the patch, but only do
the persister:

garbage_collect(whereis(rabbit_persister)).

I would say the correct pattern would be something like python's MemoryError
or handling of a malloc failure in C. Is there an exception that is thrown,
where a garbage collect can be run?

_steve
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091106/2e712c63/attachment.htm 

From jdc at hive7.com  Fri Nov  6 22:09:38 2009
From: jdc at hive7.com (JD Conley)
Date: Fri, 6 Nov 2009 14:09:38 -0800
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <4AF302A3.6090105@lshift.net>
References: <00eb01ca5d73$64079080$2c16b180$@com> <4AF29E24.4080701@lshift.net>
	<01a501ca5e35$6e94bec0$4bbe3c40$@com> <4AF302A3.6090105@lshift.net>
Message-ID: <000601ca5f2d$d59e7860$80db6920$@com>

> 
> If you can, try running the server directly rather than starting it as
> a
> service. Then, if it crashes, a) you may see a message in the console
> where you started it, and b) the erl_crash.dump should get written to
> the dir where you started the server.

Ok, running it directly worked. I got a crash dump.
http://corp.hive7.com/download/erl_crash.zip

The logs weren't very interesting. Just more of the same stuff with
connections terminating and being re-created. Nothing in the SASL log.

It seems like it ran out of memory. How much memory overhead is there per
queue/stored message? I might need to make my timeout sweeping more
aggressive, or bring up more instances.

Or, more likely, my queue configuration or consuming code is wrong and my
messages are being stored forever in memory causing the memory leak. Here
are some c# snippets:

//init
_model.ExchangeDeclare("myexchangename", ExchangeType.Fanout, false, false,
false, false, false, null);
_consumer = new EventingBasicConsumer();

...

//start consuming
_model.QueueDeclare(userQueue, false, false, false, false, false, null);
consumerTag = _model.BasicConsume(userQueue, true, null, _consumer);

...

//end consuming
_model.BasicCancel(consumerTag);

...

//bind user specific queue to routing key
_model.QueueDeclare(userQueue, false, false, false, false, false, null);
_model.QueueBind(userQueue, _exchange, key, false, null);

...

//unbind user queue from routing key
_model.QueueUnbind(userQueue, _exchange, key, null);

...

//publish message
var props = _model.CreateBasicProperties();
props.Expiration = "5000"; //is this right? desired expiration time is 5
seconds.
_model.BasicPublish(_exchange, key, false, false, props, body);

...

And, here's the console output:

node          : rabbit at VMPRODWEB2
app descriptor: c:/Rabbitmq/rabbitmq_server-1.7.0/sbin/../ebin/rabbit.app
home dir      : C:\Users\jdc
cookie hash   : //1wK/zUYlPaC0GVhNfEsw==
log           : C:/Rabbitmq/data/log/rabbit.log
sasl log      : C:/Rabbitmq/data/log/rabbit-sasl.log
database dir  : c:/Rabbitmq/data/db/rabbit-mnesia

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done
starting SSL listeners        ...done

broker running

Crash dump was written to: erl_crash.dump
temp_alloc: Cannot allocate 9176036 bytes of memory (of type "tmp_heap").

This application has requested the Runtime to terminate it in an unusual
way.
Please contact the application's support team for more information.

-JD




From kpatel at egnyte.com  Mon Nov  9 01:41:02 2009
From: kpatel at egnyte.com (Kalpesh)
Date: Sun, 8 Nov 2009 19:41:02 -0600
Subject: [rabbitmq-discuss] RabbitMQ new Persister
Message-ID: <000f01ca60dd$b27966e0$176c34a0$@com>

Hello Matthew,

 

We are looking forward for the new persister that RabbitMQ team is working
on. We are currently using Rabbit in a low volume scenario, now we are
planning to use it for a high volume scenario. We can't afford to lose any
messages,  currently Rabbit runs out of memory if we overfed it and then it
crashes. The only way to not lose message is to store it in some db or
filesystem and than push it to Rabbit just for distribution to consumers.

 

Is there any way we can get access to the new persister code? I would be
happy to do some tests on it.

 

Thanks

-Kalpesh

Kalpesh Patel
Egnyte - your On Demand File Server
Big infrastructure; Small price tag
W 650.265.4054 | C 650.740.3062
sign up at http://www.egnyte.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091108/9d1e498a/attachment.htm 

From arun.suresh at gmail.com  Mon Nov  9 01:56:07 2009
From: arun.suresh at gmail.com (Arun Suresh)
Date: Mon, 9 Nov 2009 07:26:07 +0530
Subject: [rabbitmq-discuss] RabbitMQ new Persister
In-Reply-To: <000f01ca60dd$b27966e0$176c34a0$@com>
References: <000f01ca60dd$b27966e0$176c34a0$@com>
Message-ID: <9f4a617f0911081756p4d4b546dxc5e84c6636f55e@mail.gmail.com>

Hello Kalpesh

We are using RabbitMQ as well in our team... Most of our messaging needs are
not high volume.. but we do have a set of messages where we expect something
like 350/min at peek load to be distributed to consumers..

Just curious to know what is the load at which the current implementation of
the RabbitMQ persistor bails out on you..

-Arun Suresh
Yahoo! India

On Mon, Nov 9, 2009 at 7:11 AM, Kalpesh <kpatel at egnyte.com> wrote:

>  Hello Matthew,
>
>
>
> We are looking forward for the new persister that RabbitMQ team is working
> on. We are currently using Rabbit in a low volume scenario, now we are
> planning to use it for a high volume scenario. We can't afford to lose any
> messages,  currently Rabbit runs out of memory if we overfed it and then it
> crashes. The only way to not lose message is to store it in some db or
> filesystem and than push it to Rabbit just for distribution to consumers.
>
>
>
> Is there any way we can get access to the new persister code? I would be
> happy to do some tests on it.
>
>
>
> Thanks
>
> -Kalpesh
>
> Kalpesh Patel
> *Egnyte *- your *On Demand File Server
> *Big infrastructure; Small price tag
> W 650.265.4054 | C 650.740.3062
> sign up at http://www.egnyte.com
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091109/bba20c88/attachment.htm 

From arun.suresh at gmail.com  Mon Nov  9 02:28:36 2009
From: arun.suresh at gmail.com (Arun Suresh)
Date: Mon, 9 Nov 2009 07:58:36 +0530
Subject: [rabbitmq-discuss] Weird Issue when cluster member restarts
In-Reply-To: <20091106112652.GF30680@wellquite.org>
References: <9f4a617f0911051828q6c67b2e3jd51fd0261eadd8e2@mail.gmail.com>
	<20091106112652.GF30680@wellquite.org>
Message-ID: <9f4a617f0911081828j41c64fcdhdce2aad65536c68a@mail.gmail.com>

Hello Mathew..

Thanks for ur reply.. was out of town so couldn attend to mail earlier.. my
comments inline...

On Fri, Nov 6, 2009 at 4:56 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Arun,
>
> On Fri, Nov 06, 2009 at 07:58:09AM +0530, Arun Suresh wrote:
> > My setup is as follows :
> > * 2 RabbitMQ (1.7.0 running on R13B02.1) servers in a cluster (say
> rabbit at m1,
> > rabbit at m2).. both disk nodes.
> > * 2 Clients (client at m1 connected to rabbit at m1, client at m2 connected to
> > rabbit at m2). I am using the Erlang client (which currently has an issue
> when
> > connecting to a server which is part of a cluster... this I fixed by
> setting
> > "insist = true" in the #'connection.open' record)
>
> Can you elaborate on this issue a bit? Is this redirection coming back
> from the server?
>
Yes.. I guess its a redirection request coming from the server..
basicaly.. the response to my 'connection.open' request is a
'conncetion.redirect' which on recipt, the client throws an exception and
exits..
ive gotten around this issue by setting 'insist = true' in the request
record...
Maybe ill look at the Java client and see whats done there ?

>
> > * both clients have processes that have subscribed to the same durable
> Queue
> > (Q) using the same key (K). Q is bound to a durable topic exchange (X). X
> > and Q are created on rabbit at m1.
>
> I don't understand what you mean by a queue with a key. I take it you
> have one topic exchange, one queue bound to the exchange with one
> binding key (is this the K you refer to above?), and two consumers on
> the queue. (From reading the rest of your email, yes this is clearly
> what you mean).
>
> > Now this is what i do..
> > * I bring down rabbit at m1, and client at m1 (They are co hosted... so both
> are
> > brought down together). I do a "rabbitmqctl list_queues" on rabbit at m2...
> I
> > do not see Q there..
>
> Ok, so the queue has been created on m1, not m2.
>
> > * I bring rabbit at m1 up again... After which I see Q when i do a
> "rabbitmqctl
> > list_queues".
> > * Before I bring up client at m2, I publish a messge to X with a routing
> key
> > K...
> > Issue  : Since client at m2 is up and has a process subscribed to Q, I
> expect
> > that process to receive the message... It doesnt..
>
> Indeed it won't.
>
> Clustering makes all exchanges and queues available on all nodes of the
> cluster. *However*, a queue is still located on a single node, even
> though it is accessible via all nodes. The queue will be created on the
> node the client is connected to when it creates the queue. Thus your
> queue has been created on m1, thus it's accessible from both m1 and m2,
> but when m1 goes down, the queue will go down with it.
>
> From that point on, m2 has no record of the queue, so msgs sent to X
> with K to go to Q will not ever reach Q - as far as m2 is concerned, Q
> just does not exist.
>
> When m1 comes back up, Q will be recovered.
>
> > Further more... I notice that when i bring client at m2 back up, It
> restarts
> > its subscribers... now all messages published to X with K are sent ONLY
> to
> > client at m2.
>
> Well client at m1 died. This means its subscriptions to Q were lost - there
> is no concept of persisting subscriptions, so when rabbit at m1 comes back
> up, the Q will have no consumers at all. If you restart client at m2 then
> yes, it'll recreate its subscription to Q, and thus receive all the msgs
> sent to that Q. If you also restart client at m1 then that too will
> recreate its subscription to Q and share the msgs with client at m2 as
> before.
>

Confirms what ive been thinking... But Is there any way for clients to be
notified of dead subscriptions ? That would be helpful, else i would have to
keep polling something to get that information..

>
> Hope this is of help.
>

Definitely.. thanx

>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091109/137fd0ef/attachment.htm 

From kpatel at egnyte.com  Mon Nov  9 02:28:42 2009
From: kpatel at egnyte.com (Kalpesh)
Date: Sun, 8 Nov 2009 20:28:42 -0600
Subject: [rabbitmq-discuss] RabbitMQ new Persister
In-Reply-To: <9f4a617f0911081756p4d4b546dxc5e84c6636f55e@mail.gmail.com>
References: <000f01ca60dd$b27966e0$176c34a0$@com>
	<9f4a617f0911081756p4d4b546dxc5e84c6636f55e@mail.gmail.com>
Message-ID: <000301ca60e4$5cca9230$165fb690$@com>

Hello Arun,

 

The current production in egnyte uses Rabbit in a low volume scenario like
10/15 per min. In future versions we are planning to use Rabbit as the
backend messaging system for handling most of our background jobs. The
volume can comes in bursts and if background job consumers are down it can
accumulate in worse case to 200-500K per day (This is worse case, in normal
case the queue should be exhausted immediately).  

 

I tried a simple test of pushing 200K messages each 1KB then killed the
rabbit and started Rabbit again and Rabbit was able to recover all messages.
Then in another test I tried pushing 500K messages 1 KB each and Rabbit
died, I wasn't able to recover the mnesia database (I had to purge the db
and start over with fresh db and lost all messags).  The only solution I
found was to have 2 or more rabbits and use round robin to increase the no
of messages Rabbit can hold. In addition we can't afford to lose messages
and I will have to use the control-flow mechanism to throttle the consumers
to log to some db or filesystem in case both Rabbits are full (but then the
solution is becoming complex if I have to introduce a db in the mix as the
consumers will have to keep checkpoints and other recovery mechanism).

 

The ideal solution is that Rabbit should keep only those many messages in
memory that it can hold and rest should be persisted in the disk that way we
are limited by disk and not physical memory of the machine. I saw that
Matthew and team are already working on it that's why I am interested in
testing it out if its available as beta.

 

Thanks

-Kalpesh

 

From: Arun Suresh [mailto:arun.suresh at gmail.com] 
Sent: Sunday, November 08, 2009 7:56 PM
To: Kalpesh
Cc: matthew at lshift.net; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ new Persister

 

Hello Kalpesh

We are using RabbitMQ as well in our team... Most of our messaging needs are
not high volume.. but we do have a set of messages where we expect something
like 350/min at peek load to be distributed to consumers..

Just curious to know what is the load at which the current implementation of
the RabbitMQ persistor bails out on you..

-Arun Suresh
Yahoo! India

On Mon, Nov 9, 2009 at 7:11 AM, Kalpesh <kpatel at egnyte.com> wrote:

Hello Matthew,

 

We are looking forward for the new persister that RabbitMQ team is working
on. We are currently using Rabbit in a low volume scenario, now we are
planning to use it for a high volume scenario. We can't afford to lose any
messages,  currently Rabbit runs out of memory if we overfed it and then it
crashes. The only way to not lose message is to store it in some db or
filesystem and than push it to Rabbit just for distribution to consumers.

 

Is there any way we can get access to the new persister code? I would be
happy to do some tests on it.

 

Thanks

-Kalpesh

Kalpesh Patel
Egnyte - your On Demand File Server
Big infrastructure; Small price tag
W 650.265.4054 | C 650.740.3062
sign up at http://www.egnyte.com


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091108/f9cc9196/attachment.htm 

From arun.suresh at gmail.com  Mon Nov  9 04:08:11 2009
From: arun.suresh at gmail.com (Arun Suresh)
Date: Mon, 9 Nov 2009 09:38:11 +0530
Subject: [rabbitmq-discuss] RabbitMQ new Persister
In-Reply-To: <000301ca60e4$5cca9230$165fb690$@com>
References: <000f01ca60dd$b27966e0$176c34a0$@com>
	<9f4a617f0911081756p4d4b546dxc5e84c6636f55e@mail.gmail.com>
	<000301ca60e4$5cca9230$165fb690$@com>
Message-ID: <9f4a617f0911082008g53129ef5ie0b849fdbc91816a@mail.gmail.com>

Hey Kalpesh

Thank u for ur response

On Mon, Nov 9, 2009 at 7:58 AM, Kalpesh <kpatel at egnyte.com> wrote:

>  Hello Arun,
>
>
>
> The current production in egnyte uses Rabbit in a low volume scenario like
> 10/15 per min. In future versions we are planning to use Rabbit as the
> backend messaging system for handling most of our background jobs. The
> volume can comes in bursts and if background job consumers are down it can
> accumulate in worse case to 200-500K per day (This is worse case, in normal
> case the queue should be exhausted immediately).
>
>
>
> I tried a simple test of pushing 200K messages each 1KB then killed the
> rabbit and started Rabbit again and Rabbit was able to recover all messages.
> Then in another test I tried pushing 500K messages 1 KB each and Rabbit
> died, I wasn't able to recover the mnesia database (I had to purge the db
> and start over with fresh db and lost all messags).  The only solution I
> found was to have 2 or more rabbits and use round robin to increase the no
> of messages Rabbit can hold. In addition we can't afford to lose messages
> and I will have to use the control-flow mechanism to throttle the consumers
> to log to some db or filesystem in case both Rabbits are full (but then the
> solution is becoming complex if I have to introduce a db in the mix as the
> consumers will have to keep checkpoints and other recovery mechanism).
>
>
>
> The ideal solution is that Rabbit should keep only those many messages in
> memory that it can hold and rest should be persisted in the disk that way we
> are limited by disk and not physical memory of the machine. I saw that
> Matthew and team are already working on it that's why I am interested in
> testing it out if its available as beta.
>
Guess this is a fundamental problem with mnesia (storing data both in ram
and fs)..
Looking forward to the new persister

-Arun

>
>
> Thanks
>
> -Kalpesh
>
>
>
> *From:* Arun Suresh [mailto:arun.suresh at gmail.com]
> *Sent:* Sunday, November 08, 2009 7:56 PM
> *To:* Kalpesh
> *Cc:* matthew at lshift.net; rabbitmq-discuss at lists.rabbitmq.com
> *Subject:* Re: [rabbitmq-discuss] RabbitMQ new Persister
>
>
>
> Hello Kalpesh
>
> We are using RabbitMQ as well in our team... Most of our messaging needs
> are not high volume.. but we do have a set of messages where we expect
> something like 350/min at peek load to be distributed to consumers..
>
> Just curious to know what is the load at which the current implementation
> of the RabbitMQ persistor bails out on you..
>
> -Arun Suresh
> Yahoo! India
>
> On Mon, Nov 9, 2009 at 7:11 AM, Kalpesh <kpatel at egnyte.com> wrote:
>
> Hello Matthew,
>
>
>
> We are looking forward for the new persister that RabbitMQ team is working
> on. We are currently using Rabbit in a low volume scenario, now we are
> planning to use it for a high volume scenario. We can't afford to lose any
> messages,  currently Rabbit runs out of memory if we overfed it and then it
> crashes. The only way to not lose message is to store it in some db or
> filesystem and than push it to Rabbit just for distribution to consumers.
>
>
>
> Is there any way we can get access to the new persister code? I would be
> happy to do some tests on it.
>
>
>
> Thanks
>
> -Kalpesh
>
> Kalpesh Patel
> *Egnyte *- your *On Demand File Server
> *Big infrastructure; Small price tag
> W 650.265.4054 | C 650.740.3062
> sign up at http://www.egnyte.com
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091109/0f6a534e/attachment.htm 

From matthew at lshift.net  Mon Nov  9 10:51:29 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 9 Nov 2009 10:51:29 +0000
Subject: [rabbitmq-discuss] RabbitMQ new Persister
In-Reply-To: <000f01ca60dd$b27966e0$176c34a0$@com>
References: <000f01ca60dd$b27966e0$176c34a0$@com>
Message-ID: <20091109105129.GA6371@mrnibble.lshift.net>

Hi Kalpesh,

Many people have been asking about the new persister and we are fully
aware of how eagerly it is being awaited by the community. It is not
finished yet and the code is not feature complete yet, so you would only
be wasting your time to test it.

The last thing we want to do is to rush through to the end of it and
release a half baked solution that has faults in it and does not behave
as advertised. That would be bad for everyone. Thus it'll be at least a
few weeks before it's even feature complete, and then it has to go
through QA too.

Matthew



From kpatel at egnyte.com  Mon Nov  9 13:57:33 2009
From: kpatel at egnyte.com (Kalpesh)
Date: Mon, 9 Nov 2009 07:57:33 -0600
Subject: [rabbitmq-discuss] RabbitMQ new Persister
In-Reply-To: <20091109105129.GA6371@mrnibble.lshift.net>
References: <000f01ca60dd$b27966e0$176c34a0$@com>
	<20091109105129.GA6371@mrnibble.lshift.net>
Message-ID: <002d01ca6144$9626b530$c2741f90$@com>

Thanks Matthew for the status!! Is there any mailing list that I can follow
to be updated when its available for beta or this is the list where you guys
will announce it. 

-Kalpesh

-----Original Message-----
From: Matthew Sackman [mailto:matthew at lshift.net] 
Sent: Monday, November 09, 2009 4:51 AM
To: Kalpesh
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: RabbitMQ new Persister

Hi Kalpesh,

Many people have been asking about the new persister and we are fully
aware of how eagerly it is being awaited by the community. It is not
finished yet and the code is not feature complete yet, so you would only
be wasting your time to test it.

The last thing we want to do is to rush through to the end of it and
release a half baked solution that has faults in it and does not behave
as advertised. That would be bad for everyone. Thus it'll be at least a
few weeks before it's even feature complete, and then it has to go
through QA too.

Matthew




From matthew at lshift.net  Mon Nov  9 14:01:00 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 9 Nov 2009 14:01:00 +0000
Subject: [rabbitmq-discuss] RabbitMQ new Persister
In-Reply-To: <002d01ca6144$9626b530$c2741f90$@com>
References: <000f01ca60dd$b27966e0$176c34a0$@com>
	<20091109105129.GA6371@mrnibble.lshift.net>
	<002d01ca6144$9626b530$c2741f90$@com>
Message-ID: <20091109140100.GB6371@mrnibble.lshift.net>

On Mon, Nov 09, 2009 at 07:57:33AM -0600, Kalpesh wrote:
> Thanks Matthew for the status!! Is there any mailing list that I can follow
> to be updated when its available for beta or this is the list where you guys
> will announce it. 

There is no mailing list, and it's actually unlikely we'll make a public
announcement of it before a release. Mainly this is because once it's
made it through QA and we've merged it into our default branch it's very
likely we'll do a full release of rabbit at that stage. Until it's been
through our own internal code review, the odds of there being bugs in
the code is higher, and we'd rather not waste our users' time with them
testing code that we don't yet have full confidence in.

Matthew



From alexis.richardson at gmail.com  Mon Nov  9 14:04:09 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 9 Nov 2009 14:04:09 +0000
Subject: [rabbitmq-discuss] RabbitMQ new Persister
In-Reply-To: <20091109140100.GB6371@mrnibble.lshift.net>
References: <000f01ca60dd$b27966e0$176c34a0$@com>
	<20091109105129.GA6371@mrnibble.lshift.net>
	<002d01ca6144$9626b530$c2741f90$@com>
	<20091109140100.GB6371@mrnibble.lshift.net>
Message-ID: <167204d20911090604u47724085gb5dcf8eb43f6f901@mail.gmail.com>

Kalpesh

So, this is one of the lists you ought to watch for more info.

alexis


On Mon, Nov 9, 2009 at 2:01 PM, Matthew Sackman <matthew at lshift.net> wrote:
> On Mon, Nov 09, 2009 at 07:57:33AM -0600, Kalpesh wrote:
>> Thanks Matthew for the status!! Is there any mailing list that I can follow
>> to be updated when its available for beta or this is the list where you guys
>> will announce it.
>
> There is no mailing list, and it's actually unlikely we'll make a public
> announcement of it before a release. Mainly this is because once it's
> made it through QA and we've merged it into our default branch it's very
> likely we'll do a full release of rabbit at that stage. Until it's been
> through our own internal code review, the odds of there being bugs in
> the code is higher, and we'd rather not waste our users' time with them
> testing code that we don't yet have full confidence in.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From tim at cloudspace.com  Mon Nov  9 15:26:27 2009
From: tim at cloudspace.com (Tim Rosenblatt)
Date: Mon, 9 Nov 2009 10:26:27 -0500
Subject: [rabbitmq-discuss] list_connections failing
Message-ID: <381842ac0911090726y54fadf54qc69828b9f569b78b@mail.gmail.com>

I'm running RabbitMQ 1.5.4 on Ubuntu, and when I run `rabbitmqctl
list_connections`, I usually get the following output

root at servername:~# rabbitmqctl list_connections
Listing connections ...
Error: {badrpc,
           {'EXIT',
               {timeout,
                   {gen_server,call,
                       [<4391.27413.7>,
                        {info,[user,peer_address,peer_port]}]}}}}

Obviously it looks like a timeout, but it comes back after only ~5 seconds,
which seems very short for a timeout. Sometimes this does list the
connections -- there's only ever 10, which is the correct number -- but it
often fails. This was working fine until a few days ago, when for no obvious
reason, it started returning this. I am logged in as root when running this.

Any thoughts?

-- 
Tim Rosenblatt
Cloudspace
Office: 407-823-8808
Cell: 407-719-2777

10244 E Colonial Dr, Suite 106
Orlando, FL 32817
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091109/9d9ca763/attachment.htm 

From david.wragg at lshift.net  Mon Nov  9 15:54:06 2009
From: david.wragg at lshift.net (David Wragg)
Date: Mon, 09 Nov 2009 15:54:06 +0000
Subject: [rabbitmq-discuss] list_connections failing
In-Reply-To: <381842ac0911090726y54fadf54qc69828b9f569b78b@mail.gmail.com>
	(Tim Rosenblatt's message of "Mon\, 9 Nov 2009 10\:26\:27 -0500")
References: <381842ac0911090726y54fadf54qc69828b9f569b78b@mail.gmail.com>
Message-ID: <k51vk7y9r5.fsf@mrbraver.lshift.net>

Hi Tim,

Tim Rosenblatt <tim at cloudspace.com> writes:
> I'm running RabbitMQ 1.5.4 on Ubuntu, and when I run `rabbitmqctl
> list_connections`, I usually get the following output
>
> [...]
>
> Obviously it looks like a timeout, but it comes back after only ~5 seconds,
> which seems very short for a timeout. Sometimes this does list the
> connections -- there's only ever 10, which is the correct number -- but it
> often fails. This was working fine until a few days ago, when for no obvious
> reason, it started returning this. I am logged in as root when running this.

This sounds similar to an issue that was fixed in 1.7.0 ("prevent
timeouts of rabbitmqctl when the server is busy").  Could you migrate
to 1.7.0 and see if it solves your problem?

(Note that migrating from 1.5.4 to 1.7.0 involves a database schema
change - see the "Upgrading" section of the release notes at
<http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/3aaed239/attachment.txt>)

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From tim at cloudspace.com  Mon Nov  9 16:15:36 2009
From: tim at cloudspace.com (Tim Rosenblatt)
Date: Mon, 9 Nov 2009 11:15:36 -0500
Subject: [rabbitmq-discuss] list_connections failing
In-Reply-To: <k51vk7y9r5.fsf@mrbraver.lshift.net>
References: <381842ac0911090726y54fadf54qc69828b9f569b78b@mail.gmail.com> 
	<k51vk7y9r5.fsf@mrbraver.lshift.net>
Message-ID: <381842ac0911090815n73ef33e6ob8fa39f8553e4acf@mail.gmail.com>

Thanks for the fast response, David.

I don't think upgrading is possible right now. We've got a deadline to show
this project in the next few weeks, and I'm using the Bunny gem in Ruby,
which isn't yet compatible with 1.7.0. Changing versions of Rabbit as well
as changing the library being feels unwise at this point.

For the future, in case Bunny isn't upgraded, do you have a recommended
library for Ruby? I need the ability to publish to named queues, and
subscribe to them.

You say that it sounds like the "prevent timeouts when server is busy". What
defines "busy" here? Is that when the server is in the middle of something
at the moment I run the command, and if I just run it a few more times, I'll
eventually get through? Or is there something deeper here?

Thanks.

On Mon, Nov 9, 2009 at 10:54 AM, David Wragg <david.wragg at lshift.net> wrote:

> Hi Tim,
>
> Tim Rosenblatt <tim at cloudspace.com> writes:
> > I'm running RabbitMQ 1.5.4 on Ubuntu, and when I run `rabbitmqctl
> > list_connections`, I usually get the following output
> >
> > [...]
> >
> > Obviously it looks like a timeout, but it comes back after only ~5
> seconds,
> > which seems very short for a timeout. Sometimes this does list the
> > connections -- there's only ever 10, which is the correct number -- but
> it
> > often fails. This was working fine until a few days ago, when for no
> obvious
> > reason, it started returning this. I am logged in as root when running
> this.
>
> This sounds similar to an issue that was fixed in 1.7.0 ("prevent
> timeouts of rabbitmqctl when the server is busy").  Could you migrate
> to 1.7.0 and see if it solves your problem?
>
> (Note that migrating from 1.5.4 to 1.7.0 involves a database schema
> change - see the "Upgrading" section of the release notes at
> <
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/3aaed239/attachment.txt
> >)
>
> David
>
> --
>  [][][] David Wragg       | mail: david.wragg at lshift.net
>   [][] Senior Developer  | tel: +44 (0)20 7729 7060
>  []  [] LShift Ltd        | web: www.lshift.net
>



-- 
Tim Rosenblatt
Cloudspace
Office: 407-823-8808
Cell: 407-719-2777

10244 E Colonial Dr, Suite 106
Orlando, FL 32817
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091109/f5157dc2/attachment.htm 

From brian.peck at lmco.com  Mon Nov  9 17:13:30 2009
From: brian.peck at lmco.com (peckb)
Date: Mon, 9 Nov 2009 09:13:30 -0800 (PST)
Subject: [rabbitmq-discuss] Having trouble connecting via jInterface
In-Reply-To: <25874678.post@talk.nabble.com>
References: <25866384.post@talk.nabble.com>
	<4e3934860910130336g732d02b4x64771cff684362ce@mail.gmail.com>
	<25874678.post@talk.nabble.com>
Message-ID: <26270064.post@talk.nabble.com>


Hey all,

Well I was able to get all of my functionality (all the rabbitmqctl) methods
in python, but now I need to move back to Java.

When I brought up the old code I still am getting the same problems as
before, but I know that there are messages in my queue. 

When I run the following...

connection.sendRPC("rabbit_amqqueue", "stat_all", new OtpErlangList());
OtpErlangObject receiveRPC = connection.receiveRPC()
System.out.println(receiveRPC);

I receive

[{ok,{resource,#Bin<1>,queue,#Bin<11>},501,0}]

which makes sense since I published 501 messages to 'SimpleQueue' on my '/'
vHost

But, when I run

OtpErlangObject [] objectArray = { new OtpErlangBinary("/") };

connection.sendRPC("rabbit_amqqueue", "info_all", objectArray);
OtpErlangObject receiveRPC = connection.receiveRPC()
System.out.println(receiveRPC);

I receive

[]

They are run right after another (the info_all going first). I seem to be
getting problems only when I have to send in parameters, other functions
that don't require parameters are also working correctly.

Any idea why stat_all is working but info_all does not? Or just how to get
info_all to work?



peckb wrote:
> 
> When I try that I just get [] from the output, which Java is telling me is
> an OtpErlangList with .arity() = 0
> 
> 
> Aaron Feng wrote:
>> 
>> Brian,
>> 
>> Try connection.receiveRPC() instead of OtpMsg receiveMsg =
>> connection.receiveMsg();
>> 
>> Aaron
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
>> 
> 
> 

-- 
View this message in context: http://old.nabble.com/Having-trouble-connecting-via-jInterface-tp25866384p26270064.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From david.wragg at lshift.net  Mon Nov  9 18:05:44 2009
From: david.wragg at lshift.net (David Wragg)
Date: Mon, 09 Nov 2009 18:05:44 +0000
Subject: [rabbitmq-discuss] list_connections failing
In-Reply-To: <381842ac0911090815n73ef33e6ob8fa39f8553e4acf@mail.gmail.com>
	(Tim Rosenblatt's message of "Mon\, 9 Nov 2009 11\:15\:36 -0500")
References: <381842ac0911090726y54fadf54qc69828b9f569b78b@mail.gmail.com>
	<k51vk7y9r5.fsf@mrbraver.lshift.net>
	<381842ac0911090815n73ef33e6ob8fa39f8553e4acf@mail.gmail.com>
Message-ID: <k5skcnwp3b.fsf@mrbraver.lshift.net>

Tim Rosenblatt <tim at cloudspace.com> writes:
> I don't think upgrading is possible right now. We've got a deadline to show
> this project in the next few weeks, and I'm using the Bunny gem in Ruby,
> which isn't yet compatible with 1.7.0. Changing versions of Rabbit as well
> as changing the library being feels unwise at this point.
>
> For the future, in case Bunny isn't upgraded, do you have a recommended
> library for Ruby? I need the ability to publish to named queues, and
> subscribe to them.

I know nothing about Bunny, but RabbitMQ uses the same version of AMQP
(0.8) as 1.6.0 and 1.5.x did, so client libraries ought to be
compatible.  Are you sure that Bunny isn't compatible with 1.7.0?

I can understand your reluctance to upgrade in the face of a deadline,
but an number of bugs have been addressed between 1.5.x and 1.7.0, so
you should plan to upgrade when possible.

> You say that it sounds like the "prevent timeouts when server is busy". What
> defines "busy" here? Is that when the server is in the middle of something
> at the moment I run the command, and if I just run it a few more times, I'll
> eventually get through? Or is there something deeper here?

Prior to 1.7.0, rabbitmq had a second timeout on RPC calls to RabbitMQ
server processes.  For some operations, with the server under heavy
load, this timeout could be exceeded, causing intermittent failures.

However, I've looked back at the relevant change, and I see that the
old timeout was 30 seconds, which doesn't correspond to the delay of 5
seconds you describe.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From diclophis at gmail.com  Mon Nov  9 20:00:23 2009
From: diclophis at gmail.com (Jon Bardin)
Date: Mon, 9 Nov 2009 12:00:23 -0800
Subject: [rabbitmq-discuss] Prototype SSL/TLS enabled rabbitmq stomp adapter
Message-ID: <c1d41d540911091200j1d6d9c59r42b66113a14850de@mail.gmail.com>

Hello everyone,

Attached to this email is a patch file to
rabbitmq-stomp/src/rabbit_stomp_server.erl that enables SSL.

It is _very_ hacky... it does not allow for any configuration whatsoever and
may contain bugs... but I have been able to successfully run the provided
test/test.py and connect to it with a SSL enabled client.

I would like to take the steps to somehow make this a configurable option
for the adapter... and to get this merged into the office source.

I am just not sure what to do next...

Thanks

-Jon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091109/95aec03b/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ssl_rabbit_stomp_server.erl.diff
Type: application/octet-stream
Size: 5173 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091109/95aec03b/attachment.obj 

From celldee at gmail.com  Mon Nov  9 20:08:05 2009
From: celldee at gmail.com (Chris Duncan)
Date: Mon, 9 Nov 2009 20:08:05 +0000
Subject: [rabbitmq-discuss] list_connections failing
In-Reply-To: <381842ac0911090815n73ef33e6ob8fa39f8553e4acf@mail.gmail.com>
References: <381842ac0911090726y54fadf54qc69828b9f569b78b@mail.gmail.com>
	<k51vk7y9r5.fsf@mrbraver.lshift.net>
	<381842ac0911090815n73ef33e6ob8fa39f8553e4acf@mail.gmail.com>
Message-ID: <D009B0E7-C12D-4DCD-BD8B-6F3AF950CA53@gmail.com>

Hi Tim,

I did reply to your question about Bunny on GitHub. I asked if you  
could show me some code so that I can try to help. I'm not sure what  
you are trying to do that is causing a problem, therefore it's very  
difficult to come up with sensible suggestions. Although I have  
forgotten to update the Bunny Readme to say that it can be used with  
RabbitMQ 1.7.0, I use it with 1.7.0 all the time.

Regards,

Chris

On 9 Nov 2009, at 16:15, Tim Rosenblatt wrote:

> Thanks for the fast response, David.
>
> I don't think upgrading is possible right now. We've got a deadline  
> to show this project in the next few weeks, and I'm using the Bunny  
> gem in Ruby, which isn't yet compatible with 1.7.0. Changing  
> versions of Rabbit as well as changing the library being feels  
> unwise at this point.
>
> For the future, in case Bunny isn't upgraded, do you have a  
> recommended library for Ruby? I need the ability to publish to  
> named queues, and subscribe to them.
>
> You say that it sounds like the "prevent timeouts when server is  
> busy". What defines "busy" here? Is that when the server is in the  
> middle of something at the moment I run the command, and if I just  
> run it a few more times, I'll eventually get through? Or is there  
> something deeper here?
>
> Thanks.
>
> On Mon, Nov 9, 2009 at 10:54 AM, David Wragg  
> <david.wragg at lshift.net> wrote:
> Hi Tim,
>
> Tim Rosenblatt <tim at cloudspace.com> writes:
> > I'm running RabbitMQ 1.5.4 on Ubuntu, and when I run `rabbitmqctl
> > list_connections`, I usually get the following output
> >
> > [...]
> >
> > Obviously it looks like a timeout, but it comes back after only  
> ~5 seconds,
> > which seems very short for a timeout. Sometimes this does list the
> > connections -- there's only ever 10, which is the correct number  
> -- but it
> > often fails. This was working fine until a few days ago, when for  
> no obvious
> > reason, it started returning this. I am logged in as root when  
> running this.
>
> This sounds similar to an issue that was fixed in 1.7.0 ("prevent
> timeouts of rabbitmqctl when the server is busy").  Could you migrate
> to 1.7.0 and see if it solves your problem?
>
> (Note that migrating from 1.5.4 to 1.7.0 involves a database schema
> change - see the "Upgrading" section of the release notes at
> <http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/ 
> 20091007/3aaed239/attachment.txt>)
>
> David
>
> --
>  [][][] David Wragg       | mail: david.wragg at lshift.net
>   [][] Senior Developer  | tel: +44 (0)20 7729 7060
>  []  [] LShift Ltd        | web: www.lshift.net
>
>
>
> -- 
> Tim Rosenblatt
> Cloudspace
> Office: 407-823-8808
> Cell: 407-719-2777
>
> 10244 E Colonial Dr, Suite 106
> Orlando, FL 32817
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091109/230a1515/attachment.htm 

From tim at cloudspace.com  Tue Nov 10 00:46:42 2009
From: tim at cloudspace.com (Tim Rosenblatt)
Date: Mon, 9 Nov 2009 19:46:42 -0500
Subject: [rabbitmq-discuss] list_connections failing
In-Reply-To: <D009B0E7-C12D-4DCD-BD8B-6F3AF950CA53@gmail.com>
References: <381842ac0911090726y54fadf54qc69828b9f569b78b@mail.gmail.com> 
	<k51vk7y9r5.fsf@mrbraver.lshift.net>
	<381842ac0911090815n73ef33e6ob8fa39f8553e4acf@mail.gmail.com> 
	<D009B0E7-C12D-4DCD-BD8B-6F3AF950CA53@gmail.com>
Message-ID: <381842ac0911091646v22c30936vf6b223e5cdd866c5@mail.gmail.com>

Hey Chris,

Thanks for jumping in. I did get your response from GitHub, and I replied in
that thread. Again, thanks for making Bunny, it's a nice simple library.

This was really just a RabbitMQ issue, but it's good to know that Bunny will
work with 1.7.0. I may try upgrading again, since all I have to do is a bit
of package magic with apt to switch up and down versions.

-- Tim

On Mon, Nov 9, 2009 at 3:08 PM, Chris Duncan <celldee at gmail.com> wrote:

>  Hi Tim,
>
> I did reply to your question about Bunny on GitHub. I asked if you could
> show me some code so that I can try to help. I'm not sure what you are
> trying to do that is causing a problem, therefore it's very difficult to
> come up with sensible suggestions. Although I have forgotten to update the
> Bunny Readme to say that it can be used with RabbitMQ 1.7.0, I use it with
> 1.7.0 all the time.
>
> Regards,
>
> Chris
>
> On 9 Nov 2009, at 16:15, Tim Rosenblatt wrote:
>
> Thanks for the fast response, David.
>
> I don't think upgrading is possible right now. We've got a deadline to show
> this project in the next few weeks, and I'm using the Bunny gem in Ruby,
> which isn't yet compatible with 1.7.0. Changing versions of Rabbit as well
> as changing the library being feels unwise at this point.
>
> For the future, in case Bunny isn't upgraded, do you have a recommended
> library for Ruby? I need the ability to publish to named queues, and
> subscribe to them.
>
> You say that it sounds like the "prevent timeouts when server is busy".
> What defines "busy" here? Is that when the server is in the middle of
> something at the moment I run the command, and if I just run it a few more
> times, I'll eventually get through? Or is there something deeper here?
>
> Thanks.
>
> On Mon, Nov 9, 2009 at 10:54 AM, David Wragg <david.wragg at lshift.net>wrote:
>
>> Hi Tim,
>>
>> Tim Rosenblatt <tim at cloudspace.com> writes:
>> > I'm running RabbitMQ 1.5.4 on Ubuntu, and when I run `rabbitmqctl
>> > list_connections`, I usually get the following output
>> >
>> > [...]
>> >
>> > Obviously it looks like a timeout, but it comes back after only ~5
>> seconds,
>> > which seems very short for a timeout. Sometimes this does list the
>> > connections -- there's only ever 10, which is the correct number -- but
>> it
>> > often fails. This was working fine until a few days ago, when for no
>> obvious
>> > reason, it started returning this. I am logged in as root when running
>> this.
>>
>> This sounds similar to an issue that was fixed in 1.7.0 ("prevent
>> timeouts of rabbitmqctl when the server is busy").  Could you migrate
>> to 1.7.0 and see if it solves your problem?
>>
>> (Note that migrating from 1.5.4 to 1.7.0 involves a database schema
>> change - see the "Upgrading" section of the release notes at
>> <
>> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091007/3aaed239/attachment.txt
>> >)
>>
>> David
>>
>> --
>>  [][][] David Wragg       | mail: david.wragg at lshift.net
>>   [][] Senior Developer  | tel: +44 (0)20 7729 7060
>>  []  [] LShift Ltd        | web: www.lshift.net
>>
>
>
>
> --
> Tim Rosenblatt
> Cloudspace
> Office: 407-823-8808
> Cell: 407-719-2777
>
> 10244 E Colonial Dr, Suite 106
> Orlando, FL 32817
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>


-- 
Tim Rosenblatt
Cloudspace
Office: 407-823-8808
Cell: 407-719-2777

10244 E Colonial Dr, Suite 106
Orlando, FL 32817
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091109/6652958b/attachment.htm 

From jewel at subvert-the-dominant-paradigm.net  Tue Nov 10 06:30:09 2009
From: jewel at subvert-the-dominant-paradigm.net (John Leuner)
Date: Tue, 10 Nov 2009 08:30:09 +0200 (SAST)
Subject: [rabbitmq-discuss] [Fwd: Bug#555490: rabbitmq files moved from
 /usr/lib/erlang to /usr/lib/rabbitmq]
Message-ID: <32113.196.15.235.146.1257834609.squirrel@subvert-the-dominant-paradigm.net>

---------------------------- Original Message ----------------------------
Subject: Bug#555490: rabbitmq files moved from /usr/lib/erlang to
/usr/lib/rabbitmq
From:    "Manish Singh" <yosh at gimp.org>
Date:    Tue, November 10, 2009 12:36 am
To:      submit at bugs.debian.org
--------------------------------------------------------------------------

Package: rabbitmq-server
Version: 1.7.0-3

In rabbitmq-server 1.6.0-x, most of the rabbitmq files were in:
/usr/lib/erlang/lib/rabbitmq_server-1.6.0

With 1.7.0-x, they're in:
/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.0

Was this intentional? I noticed because one of my erlang apps talks to
rabbitmq, and thus needs the headers. Stuff like this:

-include_lib("rabbitmq_server/include/rabbit.hrl").

worked fine with the 1.6.0 dist without any extra -I compiler flags, but
now doesn't.

-Manish







From david.wragg at lshift.net  Tue Nov 10 10:52:33 2009
From: david.wragg at lshift.net (David Wragg)
Date: Tue, 10 Nov 2009 10:52:33 +0000
Subject: [rabbitmq-discuss] [Fwd: Bug#555490: rabbitmq files moved from
	/usr/lib/erlang to /usr/lib/rabbitmq]
In-Reply-To: <32113.196.15.235.146.1257834609.squirrel@subvert-the-dominant-paradigm.net>
	(John Leuner's message of "Tue\, 10 Nov 2009 08\:30\:09 +0200 \(SAST\)")
References: <32113.196.15.235.146.1257834609.squirrel@subvert-the-dominant-paradigm.net>
Message-ID: <k5ocnawt1q.fsf@mrbraver.lshift.net>

Hi John and Manish,

"John Leuner" <jewel at subvert-the-dominant-paradigm.net> writes:
> In rabbitmq-server 1.6.0-x, most of the rabbitmq files were in:
> /usr/lib/erlang/lib/rabbitmq_server-1.6.0
>
> With 1.7.0-x, they're in:
> /usr/lib/rabbitmq/lib/rabbitmq_server-1.7.0
>
> Was this intentional? I noticed because one of my erlang apps talks to
> rabbitmq, and thus needs the headers. Stuff like this:
>
> -include_lib("rabbitmq_server/include/rabbit.hrl").
>
> worked fine with the 1.6.0 dist without any extra -I compiler flags, but
> now doesn't.

This is intentional.  The rationale is described in the 1.7.0 release
notes:
> - install server Erlang app in RabbitMQ-specific directory tree
>  (e.g. /usr/lib/rabbitmq) rather than the Erlang/OTP tree. This
>  allows OTP to be upgraded w/o breaking rabbit.

It also follows practice established by some other popular Erlang
apps, such as ejabberd and couchdb.

But yes, this does mean that you will need to point to the rabbitmq
directory in some places where it was not previously necessary.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From matthew at lshift.net  Tue Nov 10 14:45:05 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 10 Nov 2009 14:45:05 +0000
Subject: [rabbitmq-discuss] DNS Issues / Error: cannot_get_pid
In-Reply-To: <4AF41AEA.5050306@elsdoerfer.com>
References: <4AF41AEA.5050306@elsdoerfer.com>
Message-ID: <20091110144504.GA3233@mrnibble.lshift.net>

Michael,

On Fri, Nov 06, 2009 at 01:47:38PM +0100, Michael Elsd?rfer wrote:
> I wonder if there is another solution (I couldn't find one in the thread
> above). Can't I tell rabbitmq to just bind to loopback? It's really only
> supposed to run locally.

Indeed. In your /etc/rabbitmq/rabbitmq.conf, add the line:

NODENAME=rabbit at localhost

This will force Erlang to not look at your hostname when trying to
determine its node name, and instead will use localhost. Note though
that this means the *Erlang node* is not contactable via a different
machine (i.e. you couldn't use rabbitmqctl from a different machine, or
do clustering). Also node it does not stop *Rabbit* from listening on
public interfaces. If you want to make sure Rabbit only listens to
127.0.0.1 then add a further line to your rabbitmq.conf:

NODE_IP_ADDRESS=127.0.0.1

I hope that's of help.

Matthew



From irrer at umich.edu  Tue Nov 10 14:50:53 2009
From: irrer at umich.edu (Jim Irrer)
Date: Tue, 10 Nov 2009 09:50:53 -0500
Subject: [rabbitmq-discuss] compatibility with legacy code
In-Reply-To: <4AF979B8.8070807@lshift.net>
References: <3b6ef0790911040652s38dddee4hb37c2affb136f360@mail.gmail.com>
	<k5my3245rg.fsf@mrbraver.lshift.net>
	<3b6ef0790911041205k2dcf27f1n7dffb5b9d7376f33@mail.gmail.com>
	<4AF979B8.8070807@lshift.net>
Message-ID: <3b6ef0790911100650w475f577bw3c352d02dfbaee81@mail.gmail.com>

Tony -

I tried the http://hg.rabbitmq.com/rabbitmq-c/archive/default.tar.gz which
got me the file rabbitmq-c-default.tar.gz (md5sum:
b50fd568311a052a45157631ba17c2b5)
but it is also missing a file as shown by the last few lines from running
./configure below:

.
.
.
checking how to hardcode library paths into programs... immediate
checking whether stripping libraries is possible... yes
checking for ANSI C header files... (cached) yes
checking location of AMQP codegen directory... configure: error: could not
find AMQP spec file at "'/codegen/amqp-0.9.1.json'"

Am I supposed to get that file from somewhere else, or should it be in the
tarball?

Also, I have doubts that this will work anyway, because the RabbitMQ server
is running at version 0.8, so it won't be compatible with this client.  Does
that
sound correct?

Thanks,

- Jim

Jim Irrer     irrer at umich.edu       (734) 647-4409
University of Michigan Hospital Radiation Oncology
519 W. William St.             Ann Arbor, MI 48103


On Tue, Nov 10, 2009 at 9:33 AM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Hi Jim,
>
> My apologies for the delay in responding. I have been travelling (and
> then of course recovering from jetlag!).
>
> Jim Irrer wrote:
> > Also, I was using rabbitmq-c-06125761fef6.tar.gz from
> > http://hg.rabbitmq.com/ .
>
> Ah, that is the problem. Mercurial's web interface is downright
> misleading sometimes :-( because it points people at the "tip" revision,
> which is an almost perfectly meaningless label. Instead, it should point
> people at the "default" revision, A.K.A head of the master branch. The
> revision it sent you was from the 0-9-1 branch of the C client!
>
> The default branch holds the 0-8 C client. Please try this tarball instead:
> http://hg.rabbitmq.com/rabbitmq-c/archive/default.tar.gz
>
> (and similarly for rabbitmq-codegen.)
>
> Alternatively, if you check the code out using Mercurial itself, it will
> do the right thing, and give you the "default" branch by default, which
> currently is the 0-8 branch.
>
> Please let me know if this helps you get it working!
>
> Regards,
>   Tony
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091110/1c200daa/attachment.htm 

From matthew at lshift.net  Tue Nov 10 14:59:03 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 10 Nov 2009 14:59:03 +0000
Subject: [rabbitmq-discuss] Having trouble connecting via jInterface
In-Reply-To: <26270064.post@talk.nabble.com>
References: <25866384.post@talk.nabble.com>
	<4e3934860910130336g732d02b4x64771cff684362ce@mail.gmail.com>
	<25874678.post@talk.nabble.com> <26270064.post@talk.nabble.com>
Message-ID: <20091110145903.GB3233@mrnibble.lshift.net>

Hi Brian,

On Mon, Nov 09, 2009 at 09:13:30AM -0800, peckb wrote:
> But, when I run
> 
> OtpErlangObject [] objectArray = { new OtpErlangBinary("/") };
> 
> connection.sendRPC("rabbit_amqqueue", "info_all", objectArray);
> OtpErlangObject receiveRPC = connection.receiveRPC()
> System.out.println(receiveRPC);
> 
> I receive
> 
> []

Hmm, this is odd. None of us here have played with the various language
bindings which act as Erlang nodes, so I'm afraid we're struggling to
help you here. I can confirm that rabbit_amqqueue:info_all(<<"/">>) does
indeed work.

> When I run the following...
>
> connection.sendRPC("rabbit_amqqueue", "stat_all", new OtpErlangList());
> OtpErlangObject receiveRPC = connection.receiveRPC()
> System.out.println(receiveRPC);
>
> I receive
>
> [{ok,{resource,#Bin<1>,queue,#Bin<11>},501,0}]

That #Bin<1> is the virtual host. I wonder if the binary you're
constructing in new OtpErlangBinary("/") is somehow different. Maybe try
unpacking the result of the stat_all and check that the values match.
Similarly, that #Bin<11> should be the queue name <<"SimpleQueue">>. If
neither call worked then I'd wonder about host and node names, but the
fact that you have one of them working suggests all of that is set up.

Sorry I can't think of anything else. You may be better off using
rabbitmqctl with the -q (quiet) flag and parsing the output. Also,
use something like wireshark, and compare what your python, erlang
client and java are sending when doing these rpc calls.

Matthew



From tonyg at lshift.net  Tue Nov 10 15:06:10 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 10 Nov 2009 15:06:10 +0000
Subject: [rabbitmq-discuss] compatibility with legacy code
In-Reply-To: <3b6ef0790911100650w475f577bw3c352d02dfbaee81@mail.gmail.com>
References: <3b6ef0790911040652s38dddee4hb37c2affb136f360@mail.gmail.com>	
	<k5my3245rg.fsf@mrbraver.lshift.net>	
	<3b6ef0790911041205k2dcf27f1n7dffb5b9d7376f33@mail.gmail.com>	
	<4AF979B8.8070807@lshift.net>
	<3b6ef0790911100650w475f577bw3c352d02dfbaee81@mail.gmail.com>
Message-ID: <4AF98162.5070405@lshift.net>

Hi Jim,

Jim Irrer wrote:
> checking location of AMQP codegen directory... configure: error: could
> not find AMQP spec file at "'/codegen/amqp-0.9.1.json'"

The MD5sum is correct, b50fd568311a052a45157631ba17c2b5, but are you
sure you're really building the one you just downloaded? For me, using
the file with the MD5sum you provided, I get:

checking location of AMQP codegen directory... configure: error: could
not find AMQP spec file at
"'/Users/tonyg/qq/rabbitmq-c-default/codegen/amqp-0.8.json'"

Note the 0.8 version number.

> Am I supposed to get that file from somewhere else, or should it be in
> the tarball?

You should retrieve rabbitmq-codegen as well. Sorry for the incomplete
instructions, I really must write this up properly and check it in.
Here's a complete recipe for building the C client and examples, on the
0-8 branch.

 curl http://hg.rabbitmq.com/rabbitmq-codegen/archive/default.tar.gz\
  | tar -zxf -
 curl http://hg.rabbitmq.com/rabbitmq-c/archive/default.tar.gz\
  | tar -zxf -
 mv rabbitmq-codegen-default rabbitmq-codegen
 mv rabbitmq-c-default rabbitmq-c
 cd rabbitmq-c
 autoreconf -i
 ./configure
 make

Alternatively, if you have mercurial installed:

 hg clone http://hg.rabbitmq.com/rabbitmq-codegen
 hg clone http://hg.rabbitmq.com/rabbitmq-c
 cd rabbitmq-c
 autoreconf -i
 ./configure
 make

> Also, I have doubts that this will work anyway, because the RabbitMQ server
> is running at version 0.8, so it won't be compatible with this client. 

The "default" branches of both the C client and the server are for 0-8,
and do work together.

Cheers,
  Tony



From matthew at lshift.net  Tue Nov 10 15:12:25 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 10 Nov 2009 15:12:25 +0000
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <000601ca5f2d$d59e7860$80db6920$@com>
References: <00eb01ca5d73$64079080$2c16b180$@com> <4AF29E24.4080701@lshift.net>
	<01a501ca5e35$6e94bec0$4bbe3c40$@com> <4AF302A3.6090105@lshift.net>
	<000601ca5f2d$d59e7860$80db6920$@com>
Message-ID: <20091110151225.GC3233@mrnibble.lshift.net>

On Fri, Nov 06, 2009 at 02:09:38PM -0800, JD Conley wrote:
> It seems like it ran out of memory. How much memory overhead is there per
> queue/stored message? I might need to make my timeout sweeping more
> aggressive, or bring up more instances.

It entirely depends on the size of the messages. Also note that until
you ack a message explicitly, or set the NoAck option on consumption,
Rabbit will not forget about messages.

> Or, more likely, my queue configuration or consuming code is wrong and my
> messages are being stored forever in memory causing the memory leak. Here
> are some c# snippets:
> 
> //start consuming
> _model.QueueDeclare(userQueue, false, false, false, false, false, null);
> consumerTag = _model.BasicConsume(userQueue, true, null, _consumer);

Ok, you're setting noAck true, so you shouldn't need to ack explicitly.

> //publish message
> var props = _model.CreateBasicProperties();
> props.Expiration = "5000"; //is this right? desired expiration time is 5
> seconds.
> _model.BasicPublish(_exchange, key, false, false, props, body);

Expiration is not implemented. There is no notion of Time To Live or
messages expiring in RabbitMQ. This is an oft requested feature and is
high on our todo list, but is not in active development yet.

> Crash dump was written to: erl_crash.dump
> temp_alloc: Cannot allocate 9176036 bytes of memory (of type "tmp_heap").

Err, that's odd, that's only about 8MB of RAM. How much RAM do you have
in this machine that's available to Rabbit? Also, before it crashes,
run:
rabbitmqctl list_queues name messages messages_unacknowledged memory

as that might give you some more information.

Matthew



From matthew at lshift.net  Tue Nov 10 15:16:46 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 10 Nov 2009 15:16:46 +0000
Subject: [rabbitmq-discuss] Weird Issue when cluster member restarts
In-Reply-To: <9f4a617f0911081828j41c64fcdhdce2aad65536c68a@mail.gmail.com>
References: <9f4a617f0911051828q6c67b2e3jd51fd0261eadd8e2@mail.gmail.com>
	<20091106112652.GF30680@wellquite.org>
	<9f4a617f0911081828j41c64fcdhdce2aad65536c68a@mail.gmail.com>
Message-ID: <20091110151646.GD3233@mrnibble.lshift.net>

Hi Arun,

On Mon, Nov 09, 2009 at 07:58:36AM +0530, Arun Suresh wrote:
> > Can you elaborate on this issue a bit? Is this redirection coming back
> > from the server?
> >
> Yes.. I guess its a redirection request coming from the server..
> basicaly.. the response to my 'connection.open' request is a
> 'conncetion.redirect' which on recipt, the client throws an exception and
> exits..
> ive gotten around this issue by setting 'insist = true' in the request
> record...
> Maybe ill look at the Java client and see whats done there ?

The redirection stuff has gone from AMQP 0.9.1 so there's not a huge
need to worry about it if you're just experimenting for the time being.
The idea is that in a cluster, a node can request that you change the
connection to a different node, for load balancing reasons. The Java and
.Net clients both detect these errors and attempt to obey the
redirection requests.

> > Well client at m1 died. This means its subscriptions to Q were lost - there
> > is no concept of persisting subscriptions, so when rabbit at m1 comes back
> > up, the Q will have no consumers at all. If you restart client at m2 then
> > yes, it'll recreate its subscription to Q, and thus receive all the msgs
> > sent to that Q. If you also restart client at m1 then that too will
> > recreate its subscription to Q and share the msgs with client at m2 as
> > before.
> >
> 
> Confirms what ive been thinking... But Is there any way for clients to be
> notified of dead subscriptions ? That would be helpful, else i would have to
> keep polling something to get that information..

Well, you could simply check to see if the socket is still open. If the
broker goes down then your network socket from the client will also go
down.

Matthew



From tonyg at lshift.net  Tue Nov 10 15:19:44 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 10 Nov 2009 15:19:44 +0000
Subject: [rabbitmq-discuss] Deduplication filters,
	and distributed key-value stores
Message-ID: <4AF98490.6030404@lshift.net>

We talk every now and then about deduplication filters, for avoiding
repeated work. One problem is that it can be hard to know what to do if
you have a worker pool, because you have to share the state about what
messages the whole pool has seen, across the whole pool.

Sounds like a job for a distributed key-value store. What if redis,
riak, even memcached, were used as the dedup filter? Each worker pool
(a.k.a "queue", heh) would have a key-value store of their own. The
store would hold, for each labelled request, either

 - nothing: the request is fresh to the pool

 - an indication of partial completeness and/or receipt

 - the response that was sent back to the requestor, that can be
   sent back again if a replay is detected, without doing any more
   work

The nice thing is that not only are these distributed key-value stores
pretty quick these days, they also scale up tremendously well and
furthermore you can "shard" them because you can scope them to the
collection of workers that are sharing a queue.

The only missing piece is clearing out old, definitely stale records
from the filter after a while. For that you can use a separate
garbage-collection/expiry process, I guess; I haven't run any
experiments here, though. Maybe some of these new stores even include
time-to-live for their records, which solves the problem for us!

So: rabbitmq for the routing, buffering, relaying and delivery of
requests and responses; and a distributed key-value store for deduplication.

Tony



From arun.suresh at gmail.com  Tue Nov 10 15:20:12 2009
From: arun.suresh at gmail.com (Arun Suresh)
Date: Tue, 10 Nov 2009 20:50:12 +0530
Subject: [rabbitmq-discuss] Weird Issue when cluster member restarts
In-Reply-To: <20091110151646.GD3233@mrnibble.lshift.net>
References: <9f4a617f0911051828q6c67b2e3jd51fd0261eadd8e2@mail.gmail.com>
	<20091106112652.GF30680@wellquite.org>
	<9f4a617f0911081828j41c64fcdhdce2aad65536c68a@mail.gmail.com>
	<20091110151646.GD3233@mrnibble.lshift.net>
Message-ID: <9f4a617f0911100720g1268d665gddce5a79ae120370@mail.gmail.com>

Hi Mathew..

On Tue, Nov 10, 2009 at 8:46 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Arun,
>
> On Mon, Nov 09, 2009 at 07:58:36AM +0530, Arun Suresh wrote:
> > > Can you elaborate on this issue a bit? Is this redirection coming back
> > > from the server?
> > >
> > Yes.. I guess its a redirection request coming from the server..
> > basicaly.. the response to my 'connection.open' request is a
> > 'conncetion.redirect' which on recipt, the client throws an exception and
> > exits..
> > ive gotten around this issue by setting 'insist = true' in the request
> > record...
> > Maybe ill look at the Java client and see whats done there ?
>
> The redirection stuff has gone from AMQP 0.9.1 so there's not a huge
> need to worry about it if you're just experimenting for the time being.
> The idea is that in a cluster, a node can request that you change the
> connection to a different node, for load balancing reasons. The Java and
> .Net clients both detect these errors and attempt to obey the
> redirection requests.
>
> > > Well client at m1 died. This means its subscriptions to Q were lost -
> there
> > > is no concept of persisting subscriptions, so when rabbit at m1 comes
> back
> > > up, the Q will have no consumers at all. If you restart client at m2 then
> > > yes, it'll recreate its subscription to Q, and thus receive all the
> msgs
> > > sent to that Q. If you also restart client at m1 then that too will
> > > recreate its subscription to Q and share the msgs with client at m2 as
> > > before.
> > >
> >
> > Confirms what ive been thinking... But Is there any way for clients to be
> > notified of dead subscriptions ? That would be helpful, else i would have
> to
> > keep polling something to get that information..
>
> Well, you could simply check to see if the socket is still open. If the
> broker goes down then your network socket from the client will also go
> down.
>

:) thing is.. I have clients connected to the RabbitMQ instance that DIDNT
go down.. but have subscriptions to Queues persisted on the instance that
did..
These clients wont know if queue is gone or not...

>
> Matthew
>
-Arun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091110/b78c284f/attachment.htm 

From matthew at lshift.net  Tue Nov 10 15:26:47 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 10 Nov 2009 15:26:47 +0000
Subject: [rabbitmq-discuss] Weird Issue when cluster member restarts
In-Reply-To: <9f4a617f0911100720g1268d665gddce5a79ae120370@mail.gmail.com>
References: <9f4a617f0911051828q6c67b2e3jd51fd0261eadd8e2@mail.gmail.com>
	<20091106112652.GF30680@wellquite.org>
	<9f4a617f0911081828j41c64fcdhdce2aad65536c68a@mail.gmail.com>
	<20091110151646.GD3233@mrnibble.lshift.net>
	<9f4a617f0911100720g1268d665gddce5a79ae120370@mail.gmail.com>
Message-ID: <20091110152647.GE3233@mrnibble.lshift.net>

Hi Arun,

On Tue, Nov 10, 2009 at 08:50:12PM +0530, Arun Suresh wrote:
> > Well, you could simply check to see if the socket is still open. If the
> > broker goes down then your network socket from the client will also go
> > down.
> >
> 
> :) thing is.. I have clients connected to the RabbitMQ instance that DIDNT
> go down.. but have subscriptions to Queues persisted on the instance that
> did..
> These clients wont know if queue is gone or not...

Ahh, I see, yes indeed you are right. One way round may be to have
connections open to each node in the cluster, and watch for when those
connections go down. However, that would require that you know which
node each queue is on. Alternatively, your clients could publish with
the mandatory flag set and then you'll get an exception should the
message not be able to be routed to a queue. Unfortunately, no, the kind
of notification you're looking for isn't available in AMQP.

Matthew



From matthew at lshift.net  Tue Nov 10 15:28:02 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 10 Nov 2009 15:28:02 +0000
Subject: [rabbitmq-discuss] Having trouble connecting via jInterface
In-Reply-To: <20091110145903.GB3233@mrnibble.lshift.net>
References: <25866384.post@talk.nabble.com>
	<4e3934860910130336g732d02b4x64771cff684362ce@mail.gmail.com>
	<25874678.post@talk.nabble.com> <26270064.post@talk.nabble.com>
	<20091110145903.GB3233@mrnibble.lshift.net>
Message-ID: <20091110152802.GF3233@mrnibble.lshift.net>

> On Mon, Nov 09, 2009 at 09:13:30AM -0800, peckb wrote:
> > OtpErlangObject [] objectArray = { new OtpErlangBinary("/") };

Matthias has spotted that this is wrong - called that way, the object
will be serialized. Thus you're ending up with a weird non existing
vhost. Instead, you want OtpErlangBinary("/".toBytes())

Matthew



From arun.suresh at gmail.com  Tue Nov 10 15:29:53 2009
From: arun.suresh at gmail.com (Arun Suresh)
Date: Tue, 10 Nov 2009 20:59:53 +0530
Subject: [rabbitmq-discuss] Weird Issue when cluster member restarts
In-Reply-To: <20091110152647.GE3233@mrnibble.lshift.net>
References: <9f4a617f0911051828q6c67b2e3jd51fd0261eadd8e2@mail.gmail.com>
	<20091106112652.GF30680@wellquite.org>
	<9f4a617f0911081828j41c64fcdhdce2aad65536c68a@mail.gmail.com>
	<20091110151646.GD3233@mrnibble.lshift.net>
	<9f4a617f0911100720g1268d665gddce5a79ae120370@mail.gmail.com>
	<20091110152647.GE3233@mrnibble.lshift.net>
Message-ID: <9f4a617f0911100729p4b2e46c3n4c6060f4cda505b6@mail.gmail.com>

On Tue, Nov 10, 2009 at 8:56 PM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Arun,
>
> On Tue, Nov 10, 2009 at 08:50:12PM +0530, Arun Suresh wrote:
> > > Well, you could simply check to see if the socket is still open. If the
> > > broker goes down then your network socket from the client will also go
> > > down.
> > >
> >
> > :) thing is.. I have clients connected to the RabbitMQ instance that
> DIDNT
> > go down.. but have subscriptions to Queues persisted on the instance that
> > did..
> > These clients wont know if queue is gone or not...
>
> Ahh, I see, yes indeed you are right. One way round may be to have
> connections open to each node in the cluster, and watch for when those
> connections go down. However, that would require that you know which
> node each queue is on. Alternatively, your clients could publish with
> the mandatory flag set and then you'll get an exception should the
> message not be able to be routed to a queue. Unfortunately, no, the kind
> of notification you're looking for isn't available in AMQP.
>
Hmmm... That seems like a decent solution.. thanx

>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091110/376cd7c2/attachment.htm 

From kevin at hypotheticalabs.com  Tue Nov 10 16:29:42 2009
From: kevin at hypotheticalabs.com (Kevin A. Smith)
Date: Tue, 10 Nov 2009 11:29:42 -0500
Subject: [rabbitmq-discuss] Deduplication filters,
	and distributed key-value stores
In-Reply-To: <4AF98490.6030404@lshift.net>
References: <4AF98490.6030404@lshift.net>
Message-ID: <B46FCEB5-3714-4031-851B-A3E74D894E8B@hypotheticalabs.com>

Redis already supports explicit timeouts for entries via the expire and ttl commands so it can take care of that as well.

--Kevin
On Nov 10, 2009, at 10:19 AM, Tony Garnock-Jones wrote:

> We talk every now and then about deduplication filters, for avoiding
> repeated work. One problem is that it can be hard to know what to do if
> you have a worker pool, because you have to share the state about what
> messages the whole pool has seen, across the whole pool.
> 
> Sounds like a job for a distributed key-value store. What if redis,
> riak, even memcached, were used as the dedup filter? Each worker pool
> (a.k.a "queue", heh) would have a key-value store of their own. The
> store would hold, for each labelled request, either
> 
> - nothing: the request is fresh to the pool
> 
> - an indication of partial completeness and/or receipt
> 
> - the response that was sent back to the requestor, that can be
>   sent back again if a replay is detected, without doing any more
>   work
> 
> The nice thing is that not only are these distributed key-value stores
> pretty quick these days, they also scale up tremendously well and
> furthermore you can "shard" them because you can scope them to the
> collection of workers that are sharing a queue.
> 
> The only missing piece is clearing out old, definitely stale records
> from the filter after a while. For that you can use a separate
> garbage-collection/expiry process, I guess; I haven't run any
> experiments here, though. Maybe some of these new stores even include
> time-to-live for their records, which solves the problem for us!
> 
> So: rabbitmq for the routing, buffering, relaying and delivery of
> requests and responses; and a distributed key-value store for deduplication.
> 
> Tony
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From derek.burdick at gmail.com  Tue Nov 10 17:22:09 2009
From: derek.burdick at gmail.com (Derek Burdick)
Date: Tue, 10 Nov 2009 10:22:09 -0700
Subject: [rabbitmq-discuss] Durable Exchanges, Queues and Persistent Messages
Message-ID: <4ece5be60911100922w4e2865eendacc2c29adfcadac@mail.gmail.com>

I have a durable queue and exchange I am sending persistent messages to.
The exchange is set as fanout.  What I am seeing, is that the messages are
stored to disk but never removed.  If a new consumer comes up, he gets the
entire history of that queue.

Is this the intended behavior of persistent fanout messages?

Thanks,
  Derek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091110/16c65b08/attachment.htm 

From matthew at lshift.net  Tue Nov 10 17:26:02 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 10 Nov 2009 17:26:02 +0000
Subject: [rabbitmq-discuss] Durable Exchanges,
 Queues and Persistent Messages
In-Reply-To: <4ece5be60911100922w4e2865eendacc2c29adfcadac@mail.gmail.com>
References: <4ece5be60911100922w4e2865eendacc2c29adfcadac@mail.gmail.com>
Message-ID: <20091110172602.GA6172@mrnibble.lshift.net>

On Tue, Nov 10, 2009 at 10:22:09AM -0700, Derek Burdick wrote:
> I have a durable queue and exchange I am sending persistent messages to.
> The exchange is set as fanout.  What I am seeing, is that the messages are
> stored to disk but never removed.  If a new consumer comes up, he gets the
> entire history of that queue.
> 
> Is this the intended behavior of persistent fanout messages?

I suspect your consumer is not acknowledging messages. Messages are not
forgotten until the client confirms that they have received the message
by using basic.ack. This is required whether the client is doing
basic.get or using basic.consume.

Alternatively, in both basic.get and basic.consume, the noAck flag can
be set, indicating to Rabbit that it should not expect acks from the
client, and thus should forget about messages as soon as they've been
sent to a client.

I hope that's of use. If my guess is wrong, do please let us know!

Matthew



From derek.burdick at gmail.com  Tue Nov 10 17:44:14 2009
From: derek.burdick at gmail.com (Derek Burdick)
Date: Tue, 10 Nov 2009 10:44:14 -0700
Subject: [rabbitmq-discuss] Rabbit-MQ crashing
Message-ID: <4ece5be60911100944y696030e9ga2ba6d153d0c19b6@mail.gmail.com>

I have a durable, fanout exchange and queue.  I post persistent messages to
the exchange.  After sending messages for some time, the ERL process stops
and I can not restart RabbitMQ without deleting the contents of the
Database.  Here is the log from startup:


=INFO REPORT==== 9-Nov-2009::10:00:06 ===
disk_log: repairing
"c:/RabbitMQ/Runtime/db/rabbit-mnesia/rabbit_persister.LOG" ...

=INFO REPORT==== 9-Nov-2009::10:00:06 ===
Repaired persister log - 0 recovered, 0 bad

=INFO REPORT==== 9-Nov-2009::10:00:06 ===
    application: rabbit
    exited: {bad_return,
                {{rabbit,start,[normal,[]]},
                 {'EXIT',
                     {{badmatch,
                          {error,
                              {{{badmatch,eof},

[{rabbit_persister,internal_load_snapshot,2},
                                 {rabbit_persister,init,1},
                                 {gen_server,init_it,6},
                                 {proc_lib,init_p_do_apply,3}]},
                               {child,undefined,rabbit_persister,
                                   {rabbit_persister,start_link,[]},
                                   transient,100,worker,
                                   [rabbit_persister]}}}},
                      [{rabbit,start_child,1},
                       {rabbit,'-start/2-fun-4-',0},
                       {rabbit,'-start/2-fun-0-',1},
                       {lists,foreach,2},
                       {rabbit,start,2},
                       {application_master,start_it_old,4}]}}}}
    type: temporary

=INFO REPORT==== 9-Nov-2009::10:00:06 ===
    application: mnesia
    exited: stopped
    type: temporary

=INFO REPORT==== 9-Nov-2009::10:00:06 ===
    application: os_mon
    exited: stopped
    type: temporary


Thanks,
  Derek
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091110/3fa3f553/attachment.htm 

From derek.burdick at gmail.com  Tue Nov 10 17:49:29 2009
From: derek.burdick at gmail.com (Derek Burdick)
Date: Tue, 10 Nov 2009 10:49:29 -0700
Subject: [rabbitmq-discuss] Durable Exchanges,
	Queues and Persistent 	Messages
In-Reply-To: <20091110172602.GA6172@mrnibble.lshift.net>
References: <4ece5be60911100922w4e2865eendacc2c29adfcadac@mail.gmail.com>
	<20091110172602.GA6172@mrnibble.lshift.net>
Message-ID: <4ece5be60911100949x59f8512crf92ca82e8fd3d5f9@mail.gmail.com>

That sounds like the likely culprit.  I'll test that and let you know.  What
I was hoping to accomplish, was to have the message queue, keep a copy of a
message for an hour so that when a new consumer connected, he receives the
last hour of messages.  I might have to add this logic to the applications
somehow.



On Tue, Nov 10, 2009 at 10:26 AM, Matthew Sackman <matthew at lshift.net>wrote:

> On Tue, Nov 10, 2009 at 10:22:09AM -0700, Derek Burdick wrote:
> > I have a durable queue and exchange I am sending persistent messages to.
> > The exchange is set as fanout.  What I am seeing, is that the messages
> are
> > stored to disk but never removed.  If a new consumer comes up, he gets
> the
> > entire history of that queue.
> >
> > Is this the intended behavior of persistent fanout messages?
>
> I suspect your consumer is not acknowledging messages. Messages are not
> forgotten until the client confirms that they have received the message
> by using basic.ack. This is required whether the client is doing
> basic.get or using basic.consume.
>
> Alternatively, in both basic.get and basic.consume, the noAck flag can
> be set, indicating to Rabbit that it should not expect acks from the
> client, and thus should forget about messages as soon as they've been
> sent to a client.
>
> I hope that's of use. If my guess is wrong, do please let us know!
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091110/fa60f58f/attachment.htm 

From matthew at lshift.net  Tue Nov 10 17:51:16 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 10 Nov 2009 17:51:16 +0000
Subject: [rabbitmq-discuss] Durable Exchanges,
 Queues and Persistent Messages
In-Reply-To: <4ece5be60911100949x59f8512crf92ca82e8fd3d5f9@mail.gmail.com>
References: <4ece5be60911100922w4e2865eendacc2c29adfcadac@mail.gmail.com>
	<20091110172602.GA6172@mrnibble.lshift.net>
	<4ece5be60911100949x59f8512crf92ca82e8fd3d5f9@mail.gmail.com>
Message-ID: <20091110175116.GB6172@mrnibble.lshift.net>

On Tue, Nov 10, 2009 at 10:49:29AM -0700, Derek Burdick wrote:
> That sounds like the likely culprit.  I'll test that and let you know.  What
> I was hoping to accomplish, was to have the message queue, keep a copy of a
> message for an hour so that when a new consumer connected, he receives the
> last hour of messages.  I might have to add this logic to the applications
> somehow.

Yes, there is currently no way of giving messages a TTL in RabbitMQ.
You'll need to do this at the application layer.

Matthew



From eishay at gmail.com  Tue Nov 10 17:58:21 2009
From: eishay at gmail.com (Eishay Smith)
Date: Tue, 10 Nov 2009 09:58:21 -0800
Subject: [rabbitmq-discuss] Deduplication filters,
	and distributed 	key-value stores
In-Reply-To: <B46FCEB5-3714-4031-851B-A3E74D894E8B@hypotheticalabs.com>
References: <4AF98490.6030404@lshift.net>
	<B46FCEB5-3714-4031-851B-A3E74D894E8B@hypotheticalabs.com>
Message-ID: <390628a20911100958y3638e061uaf215b6499845e18@mail.gmail.com>

Voldemort has key expiration as well.

On Tue, Nov 10, 2009 at 8:29 AM, Kevin A. Smith
<kevin at hypotheticalabs.com>wrote:

> Redis already supports explicit timeouts for entries via the expire and ttl
> commands so it can take care of that as well.
>
> --Kevin
> On Nov 10, 2009, at 10:19 AM, Tony Garnock-Jones wrote:
>
> > We talk every now and then about deduplication filters, for avoiding
> > repeated work. One problem is that it can be hard to know what to do if
> > you have a worker pool, because you have to share the state about what
> > messages the whole pool has seen, across the whole pool.
> >
> > Sounds like a job for a distributed key-value store. What if redis,
> > riak, even memcached, were used as the dedup filter? Each worker pool
> > (a.k.a "queue", heh) would have a key-value store of their own. The
> > store would hold, for each labelled request, either
> >
> > - nothing: the request is fresh to the pool
> >
> > - an indication of partial completeness and/or receipt
> >
> > - the response that was sent back to the requestor, that can be
> >   sent back again if a replay is detected, without doing any more
> >   work
> >
> > The nice thing is that not only are these distributed key-value stores
> > pretty quick these days, they also scale up tremendously well and
> > furthermore you can "shard" them because you can scope them to the
> > collection of workers that are sharing a queue.
> >
> > The only missing piece is clearing out old, definitely stale records
> > from the filter after a while. For that you can use a separate
> > garbage-collection/expiry process, I guess; I haven't run any
> > experiments here, though. Maybe some of these new stores even include
> > time-to-live for their records, which solves the problem for us!
> >
> > So: rabbitmq for the routing, buffering, relaying and delivery of
> > requests and responses; and a distributed key-value store for
> deduplication.
> >
> > Tony
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091110/45993906/attachment.htm 

From derek.burdick at gmail.com  Tue Nov 10 18:04:09 2009
From: derek.burdick at gmail.com (Derek Burdick)
Date: Tue, 10 Nov 2009 11:04:09 -0700
Subject: [rabbitmq-discuss] Durable Exchanges,
	Queues and Persistent 	Messages
In-Reply-To: <20091110175116.GB6172@mrnibble.lshift.net>
References: <4ece5be60911100922w4e2865eendacc2c29adfcadac@mail.gmail.com>
	<20091110172602.GA6172@mrnibble.lshift.net>
	<4ece5be60911100949x59f8512crf92ca82e8fd3d5f9@mail.gmail.com>
	<20091110175116.GB6172@mrnibble.lshift.net>
Message-ID: <4ece5be60911101004p24727cf7t1f19a57cd498b63d@mail.gmail.com>

Is there a roadmap of when TTL's might be available, or work already being
done toward this?  I believe I read somewhere that TTL was not defined well
in the AMQP 8 spec or something like that.

Thanks for all of your help.

On Tue, Nov 10, 2009 at 10:51 AM, Matthew Sackman <matthew at lshift.net>wrote:

> On Tue, Nov 10, 2009 at 10:49:29AM -0700, Derek Burdick wrote:
> > That sounds like the likely culprit.  I'll test that and let you know.
>  What
> > I was hoping to accomplish, was to have the message queue, keep a copy of
> a
> > message for an hour so that when a new consumer connected, he receives
> the
> > last hour of messages.  I might have to add this logic to the
> applications
> > somehow.
>
> Yes, there is currently no way of giving messages a TTL in RabbitMQ.
> You'll need to do this at the application layer.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091110/b8bd841b/attachment.htm 

From matthew at lshift.net  Tue Nov 10 18:08:19 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 10 Nov 2009 18:08:19 +0000
Subject: [rabbitmq-discuss] Durable Exchanges,
 Queues and Persistent Messages
In-Reply-To: <4ece5be60911101004p24727cf7t1f19a57cd498b63d@mail.gmail.com>
References: <4ece5be60911100922w4e2865eendacc2c29adfcadac@mail.gmail.com>
	<20091110172602.GA6172@mrnibble.lshift.net>
	<4ece5be60911100949x59f8512crf92ca82e8fd3d5f9@mail.gmail.com>
	<20091110175116.GB6172@mrnibble.lshift.net>
	<4ece5be60911101004p24727cf7t1f19a57cd498b63d@mail.gmail.com>
Message-ID: <20091110180819.GC6172@mrnibble.lshift.net>

On Tue, Nov 10, 2009 at 11:04:09AM -0700, Derek Burdick wrote:
> Is there a roadmap of when TTL's might be available, or work already being
> done toward this?  I believe I read somewhere that TTL was not defined well
> in the AMQP 8 spec or something like that.

Not much is defined well in the AMQP 0.8 spec. AMQP 0.9.1 is much much
better and we, along with several other implementors of AMQP are moving
rapidly towards implementing 0.9.1.

TTL is high on our todo list, but other than some brainstorming and
individual notes, we have not started any coding towards it.

Matthew



From tonyg at lshift.net  Tue Nov 10 18:26:18 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 10 Nov 2009 18:26:18 +0000
Subject: [rabbitmq-discuss] Extending the protocol is straightforward enough
 (was Re: a possibility of AMQP/RabbitMQ extension?)
In-Reply-To: <87pr7x9gzb.fsf@goryachev.org>
References: <87pr7x9gzb.fsf@goryachev.org>
Message-ID: <4AF9B04A.1060706@lshift.net>

Hi Igor,

Igor Goryachev wrote:
> 0. is it safe to extend AMQP for customer needs (in such way as XMPP
> permits to do)?

Interesting question. It's certainly *possible* -- you'd start by adding
the method to the specification document (in the rabbitmq-codegen
downloadable), and then cleaning and regenerating the client and server
(which generates the necessary stubs and skeletons, roughly), and then
extending rabbit_channel.erl to handle invocations of the various new
methods, and adding corresponding features to the client library.

All a bit awkward, but certainly possible, and in fact explicitly part
of the way AMQP was set up.

Sadly, you have to just *choose* a classID/methodID, because there are
none reserved for experimental or private use, and there's no registry.
But so long as you control both endpoints, you'll be fine...

... which brings me to the "safe" question. Your extension will be just
that, an extension, meaning that clients that don't understand the
classIDs/methodIDs you add will be at a loss. Again, if you have control
over both sides, you'll be fine.

I'm curious: what kind of extension would you like to add? Please tell
us more :-)

Regards,
  Tony

PS: there's an experimental branch of rabbitmq-codegen and
rabbitmq-server that has support for adding additional protocol
definitions without having to modify the central spec doc: it's
"bug21763". It's undocumented, which is why it hasn't been QA'd and
merged into default yet. I'm working on it (on a back-back-back-burner).



From tonyg at lshift.net  Tue Nov 10 18:31:17 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 10 Nov 2009 18:31:17 +0000
Subject: [rabbitmq-discuss] Error during "make" of RabbitMQ Erlang
 client -	File operation error
In-Reply-To: <002301ca5eaa$dbee9de0$93cbd9a0$@grice@logosworld.com>
References: <002301ca5eaa$dbee9de0$93cbd9a0$@grice@logosworld.com>
Message-ID: <4AF9B175.8080708@lshift.net>

Hi Lynton,

Lynton Grice wrote:
> File operation error: eio. Target: deps:dist. Function: list_dir.
> Process: code_server.
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info 
> src/amqp_rpc_server.erl

Interesting. My guess (not having looked at code, or tried it, or
anything!) is that it's trying to read "deps:dist" from the ERL_LIBS env
var as if it were a pathname -- and on windows, that'll look for a DEPS:
drive, or something, won't it?

Our build scripts and makefiles no doubt will need tweaking for cygwin.
There's a cygpath utility I dimly remember for translating paths back
and forth -- perhaps the script could detect its platform and apply
either cygpath or a noop in strategic places?

Tony




From tonyg at lshift.net  Tue Nov 10 18:31:58 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 10 Nov 2009 18:31:58 +0000
Subject: [rabbitmq-discuss] testing RabbitMQ under high load
In-Reply-To: <87tyx7g54h.fsf@goryachev.org>
References: <87ocngggr1.fsf@goryachev.org>	<167204d20911060216t1e3ca58cyf2f0c6553f255790@mail.gmail.com>	<87y6mjgau9.fsf@goryachev.org>	<167204d20911060323w1af25ad2tdd3ece2db7c0f788@mail.gmail.com>
	<87tyx7g54h.fsf@goryachev.org>
Message-ID: <4AF9B19E.6090404@lshift.net>

Hi Igor,

Igor Goryachev wrote:
> Ok. I have started implementation of AMQP plugin for Tsung. Details will
> follow a bit later.

That's exciting! Please keep us informed.

Regards,
  Tony



From jdc at hive7.com  Tue Nov 10 19:01:31 2009
From: jdc at hive7.com (JD Conley)
Date: Tue, 10 Nov 2009 11:01:31 -0800
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <20091110151225.GC3233@mrnibble.lshift.net>
References: <00eb01ca5d73$64079080$2c16b180$@com>
	<4AF29E24.4080701@lshift.net>	<01a501ca5e35$6e94bec0$4bbe3c40$@com>
	<4AF302A3.6090105@lshift.net>	<000601ca5f2d$d59e7860$80db6920$@com>
	<20091110151225.GC3233@mrnibble.lshift.net>
Message-ID: <010701ca6238$3785b2c0$a6911840$@com>

> > //start consuming
> > _model.QueueDeclare(userQueue, false, false, false, false, false,
> null);
> > consumerTag = _model.BasicConsume(userQueue, true, null, _consumer);
> 
> Ok, you're setting noAck true, so you shouldn't need to ack explicitly.

Yeah, that's what I thought. But yesterday I added acking just to see if it
would help and the memory footprint no longer grows out of control and the
process hasn't crashed since. I wonder if either the .NET client or rabbit
isn't honoring the noack for this use case?

> Expiration is not implemented. There is no notion of Time To Live or
> messages expiring in RabbitMQ. This is an oft requested feature and is
> high on our todo list, but is not in active development yet.

Add one more to that request number.

> > Crash dump was written to: erl_crash.dump
> > temp_alloc: Cannot allocate 9176036 bytes of memory (of type
> "tmp_heap").
> 
> Err, that's odd, that's only about 8MB of RAM. How much RAM do you have
> in this machine that's available to Rabbit? Also, before it crashes,
> run:

As I said doing an Ack when I receive a message (even though I have noack
set) seems to have resolved the memory usage and crashing issue.

The dump is over 1GB. What is the VM limit for erlang by default? Maybe we
just hit that? The system has 4gb ram and plenty free to use the 2GB imposed
user land limit in Windows, not to mention swap space.

-JD




From gojko-yahoolist at gojko.com  Wed Nov 11 00:53:25 2009
From: gojko-yahoolist at gojko.com (Gojko Adzic)
Date: Wed, 11 Nov 2009 00:53:25 +0000
Subject: [rabbitmq-discuss] connection/channel pooling
Message-ID: <4AFA0B05.80708@gojko.com>

Hi,

I'm evaluating rabbitmq so bear with me while I post a ton of beginner 
questions in the next few days. I'm using the Java API to post messages 
from a cluster of application servers and amqp-as3 to read them. I have 
the basic examples working, but couldn't find enough information on 
connectivity best practices to satisfy my curiosity. So I'd appreciate 
some expert advice :) According to these two things

http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-November/001896.html

http://agilewebdevelopment.com/plugins/http___github_com_danielsdeleo_qusion

a connection can be cached and shared but channels should be 
thread-local. For the purpose of improving throughput, does it make 
sense to create a pool of channels or is there no penalty in opening and 
closing channel for every message sent?  Also, does multi-threaded 
posting through channels belonging to a single connection cause 
contention on the same socket? What's the best practice for throughput - 
should I have a number of connections open to post messages and then 
allocate several channels per connection, or is this an overkill?

--
gojko adzic
http://gojko.net



From matthew at lshift.net  Wed Nov 11 11:32:31 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 11 Nov 2009 11:32:31 +0000
Subject: [rabbitmq-discuss] RabbitMQ crashes hard when it runs out of
 memory
In-Reply-To: <4d376de30911061257p163ac74eh31f82d0f4e74a19@mail.gmail.com>
References: <4AE0A585.1020701@lshift.net>
	<4d376de30910221350t5e646d7am942e88c4b0a1dae9@mail.gmail.com>
	<4d376de30910221422q3824d9cye43b3d428ae4fd3d@mail.gmail.com>
	<4AE0E99B.7040300@lshift.net>
	<4d376de30910221747h25bddf47pfab075df8524854f@mail.gmail.com>
	<4AE15339.10801@lshift.net>
	<4d376de30911051357s168e1583qe7f3402e215b0d84@mail.gmail.com>
	<20091106100620.GB30680@wellquite.org>
	<20091106104343.GE30680@wellquite.org>
	<4d376de30911061257p163ac74eh31f82d0f4e74a19@mail.gmail.com>
Message-ID: <20091111113231.GF6172@mrnibble.lshift.net>

Hi Steve,

On Fri, Nov 06, 2009 at 12:57:33PM -0800, Stephen Day wrote:
> On Fri, Nov 6, 2009 at 2:43 AM, Matthew Sackman <matthew at lshift.net> wrote:
> However, with rabbit's current memory problems, I wouldn't run it with more
> than 10 queues, let alone millions ;). I will give the java client test a
> try.

Queues themselves don't take much memory - it's just a process and a
little state. I'm seeing about 35KB for a queue with nothing in it. It's
the number and size of messages that are the issue. We tend to encourage
users to make sure that the bottleneck is at the producing side, not the
consuming side, to prevent queues growing much in Rabbit. In such a
setup, many thousands of queues is very possible. However, people using
Rabbit as a buffering / decoupling mechanism to cope with load spikes
between different systems is a very common and important use case and
this should get much much better once the new resource management and
persister finally lands.

> This was my initial thought as well. However, by the time the alarm goes
> off, it is often too late for this to stop rabbit from crashing. For
> example, the default memory alarm is set to 0.95.

Right, but it's not hardcoded at 0.95. Feel free to lower it
substantially.

> I would say the correct pattern would be something like python's MemoryError
> or handling of a malloc failure in C. Is there an exception that is thrown,
> where a garbage collect can be run?

Sure, but what exactly can you do in that situation? The malloc is
failing during a GC run, because of the generational copying GC, so it
doesn't really make much difference whether you catch the exception or
not - you still can't allocate new memory, which makes life somewhat
challenging, especially in the middle of a GC run, where processes are
suspended.

Our resource management is getting much better, and is something we're
working hard on improving. Sadly though, we're not going to give out
ETAs only to break them, though we understand how fun that is for all ;)

Matthew



From matthew at lshift.net  Wed Nov 11 11:49:33 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 11 Nov 2009 11:49:33 +0000
Subject: [rabbitmq-discuss] connection/channel pooling
In-Reply-To: <4AFA0B05.80708@gojko.com>
References: <4AFA0B05.80708@gojko.com>
Message-ID: <20091111114933.GG6172@mrnibble.lshift.net>

Hi,

On Wed, Nov 11, 2009 at 12:53:25AM +0000, Gojko Adzic wrote:
> a connection can be cached and shared but channels should be 
> thread-local. For the purpose of improving throughput, does it make 
> sense to create a pool of channels or is there no penalty in opening and 
> closing channel for every message sent?

Opening a channel takes some client side and server side resources. If
you are able to use a pool of channels and reuse them then yes, that
would be a better solution to creating endless fresh channels.

> Also, does multi-threaded 
> posting through channels belonging to a single connection cause 
> contention on the same socket? What's the best practice for throughput - 
> should I have a number of connections open to post messages and then 
> allocate several channels per connection, or is this an overkill?

There will be contention - at the end of the day, the kernel must
serialise writes to the socket. One can certainly over supply the kernel
with data to write from a single thread, let alone several threads. I
would suggest that you start with the simple thing - use one connection
- and see if that's enough for you. Don't forget premature optimization
is the root of all evil!

With something like Rabbit, it's so flexible and can be configured in
so many different ways that we can't really write extensive "best
practises" because with just a few small differences in the setup, they
may very well cease to be "best". Thus we would always recommend that
you test and benchmark yourself and then make decisions based on what
you see is happening for you.

Matthew



From michael at elsdoerfer.com  Wed Nov 11 12:32:47 2009
From: michael at elsdoerfer.com (=?ISO-8859-1?Q?Michael_Elsd=F6rfer?=)
Date: Wed, 11 Nov 2009 13:32:47 +0100
Subject: [rabbitmq-discuss] DNS Issues / Error: cannot_get_pid
In-Reply-To: <20091110144504.GA3233@mrnibble.lshift.net>
References: <4AF41AEA.5050306@elsdoerfer.com>
	<20091110144504.GA3233@mrnibble.lshift.net>
Message-ID: <4AFAAEEF.7010304@elsdoerfer.com>

Thanks for the response.

I actually managed to gather those settings on my own and had tried them
in the meantime - they don't seem to work (not in fixing the DNS-related
issue, anyway):

* With "NODENAME=rabbit at localhost" startup_log says "Starting node
rabbit at localhost@myhostname..."""

* Strangely, "rabbitmq-multi status" still references
"rabbit at myhostname", despite the NODENAME setting.

I'm using the Debian package from http://www.rabbitmq.com/debian/
(version 1.7.0-1).

I should say that I've since worked around the issue by configuring
iptables to pass all connections from the local interface through
(using: iptables -A INPUT -i lo -j ACCEPT), so it's not a showstopper
for me.

Michael

[FWIW, the process name missing in my initial mail is "init_gethost 4" -
though I've since noticed that the two instances of it are also running
when RabbitMQ started up successfully, so I suppose that's actually normal.]

Matthew Sackman schrieb:
> Michael,
> 
> On Fri, Nov 06, 2009 at 01:47:38PM +0100, Michael Elsd?rfer wrote:
>> I wonder if there is another solution (I couldn't find one in the thread
>> above). Can't I tell rabbitmq to just bind to loopback? It's really only
>> supposed to run locally.
> 
> Indeed. In your /etc/rabbitmq/rabbitmq.conf, add the line:
> 
> NODENAME=rabbit at localhost
> 
> This will force Erlang to not look at your hostname when trying to
> determine its node name, and instead will use localhost. Note though
> that this means the *Erlang node* is not contactable via a different
> machine (i.e. you couldn't use rabbitmqctl from a different machine, or
> do clustering). Also node it does not stop *Rabbit* from listening on
> public interfaces. If you want to make sure Rabbit only listens to
> 127.0.0.1 then add a further line to your rabbitmq.conf:
> 
> NODE_IP_ADDRESS=127.0.0.1
> 
> I hope that's of help.
> 
> Matthew





From matthew at lshift.net  Wed Nov 11 12:58:26 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 11 Nov 2009 12:58:26 +0000
Subject: [rabbitmq-discuss] DNS Issues / Error: cannot_get_pid
In-Reply-To: <4AFAAEEF.7010304@elsdoerfer.com>
References: <4AF41AEA.5050306@elsdoerfer.com>
	<20091110144504.GA3233@mrnibble.lshift.net>
	<4AFAAEEF.7010304@elsdoerfer.com>
Message-ID: <20091111125826.GH6172@mrnibble.lshift.net>

Hi Michael,

On Wed, Nov 11, 2009 at 01:32:47PM +0100, Michael Elsd?rfer wrote:
> I actually managed to gather those settings on my own and had tried them
> in the meantime - they don't seem to work (not in fixing the DNS-related
> issue, anyway):
> 
> * With "NODENAME=rabbit at localhost" startup_log says "Starting node
> rabbit at localhost@myhostname..."""
> 
> * Strangely, "rabbitmq-multi status" still references
> "rabbit at myhostname", despite the NODENAME setting.

That's weird. What happens if you just do "erl -sname foo at localhost" ?
Also, can you start up rabbit like this, and then do a ps ax | grep
rabbit - and check the sname param - for me (installing from a package),
I get "... -sname rabbit at localhost ..." and it does all work correctly.

> I'm using the Debian package from http://www.rabbitmq.com/debian/
> (version 1.7.0-1).

Which version of Erlang are you using?

I have a vague recollection that -sname only used to allow the node part
of the node name, which tallies with what you're seeing, but I've tried
going back as far as R11B5 and it still works there. I've just had a
quick trawl through the Erlang release notes and can't find anything
there either. In fact, with R11B5, R12B3 and R13B02, if I try
erl -sname foo at bar@baz then it blows up with invalid hostname, whereas
erl -sname foo at bar works fine.

> I should say that I've since worked around the issue by configuring
> iptables to pass all connections from the local interface through
> (using: iptables -A INPUT -i lo -j ACCEPT), so it's not a showstopper
> for me.

Ahh yes, I remember having to use that rule in the past, though not for
Rabbit. Glad you've found a work around, but I'd quite like to dig into
why it's not working for you as I think it should.

Matthew



From matthew at lshift.net  Wed Nov 11 13:51:08 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 11 Nov 2009 13:51:08 +0000
Subject: [rabbitmq-discuss] DNS Issues / Error: cannot_get_pid
In-Reply-To: <20091111125826.GH6172@mrnibble.lshift.net>
References: <4AF41AEA.5050306@elsdoerfer.com>
	<20091110144504.GA3233@mrnibble.lshift.net>
	<4AFAAEEF.7010304@elsdoerfer.com>
	<20091111125826.GH6172@mrnibble.lshift.net>
Message-ID: <20091111135108.GI6172@mrnibble.lshift.net>

Hi Michael,

It's just been pointed out to me that the issue you're seeing has been
fixed and will be part of 1.7.1. It was a bug in our code. The packages
that I was testing with were packages I'd built using more up to date
code than in 1.7.0 which is why it was all working for me.

So again, it's a case of "just wait a bit" and then your problems will
be magically solved!

Matthew



From yaodongxian at gmail.com  Wed Nov 11 15:21:40 2009
From: yaodongxian at gmail.com (Yao, Dongxian)
Date: Wed, 11 Nov 2009 09:21:40 -0600
Subject: [rabbitmq-discuss] rabbitmq vs qpid
Message-ID: <d96a67a0911110721i7baf1fbgbcf281f6a78203ad@mail.gmail.com>

I am not sure if this is good question, but I really want to know how
do you compare rabbitmq vs qpid. What is the reason you choose
rabbitmq, better documentation? Erlang? More users? Better server/
client support? Better performance? More reliable?  ...

It looks like qpid is one step ahead with the AMQP implentation, they
said they have implemented the AMQP 0-10, but rabbitmq is still on 0-8
and 0-9.

Thanks for your comments, I really appreciate it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091111/7d22ebc2/attachment.htm 

From alexis.richardson at gmail.com  Wed Nov 11 15:27:36 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 11 Nov 2009 15:27:36 +0000
Subject: [rabbitmq-discuss] rabbitmq vs qpid
In-Reply-To: <d96a67a0911110721i7baf1fbgbcf281f6a78203ad@mail.gmail.com>
References: <d96a67a0911110721i7baf1fbgbcf281f6a78203ad@mail.gmail.com>
Message-ID: <167204d20911110727w5e62bfa9la63190ae4b37d703@mail.gmail.com>

Yao,

The great thing about AMQP is that it should not be an 'either or'
decision.  Like with TCP and HTTP choose what works for you - and
maybe use *both* brokers.  The RabbitMQ and Qpid teams have invested
in different areas.  Sure there is a lot of overlap, because our goal
is interoperable, standard, open business messaging.

Some highlights of the RabbitMQ world are here: http://www.rabbitmq.com/

I recommend that you dig around some of the community links and "get
started" pages.  That may help shed light on your question.  For
example this is a very nice recent presentation by Paolo Negri:
http://www.slideshare.net/hungryblank/rabbitmq-with-python-and-ruby-rupy-2009

alexis




On Wed, Nov 11, 2009 at 3:21 PM, Yao, Dongxian <yaodongxian at gmail.com> wrote:
> I am not sure if this is good question, but I really want to know how
> do you compare rabbitmq vs qpid. What is the reason you choose
> rabbitmq, better documentation? Erlang? More users? Better server/
> client support? Better performance? More reliable?? ...
>
> It looks like qpid is one step ahead with the AMQP implentation, they
> said they have implemented the AMQP 0-10, but rabbitmq is still on 0-8
> and 0-9.
>
> Thanks for your comments, I really appreciate it.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From majek04 at gmail.com  Wed Nov 11 15:41:02 2009
From: majek04 at gmail.com (majek04)
Date: Wed, 11 Nov 2009 15:41:02 +0000
Subject: [rabbitmq-discuss] rabbitmq vs qpid
In-Reply-To: <d96a67a0911110721i7baf1fbgbcf281f6a78203ad@mail.gmail.com>
References: <d96a67a0911110721i7baf1fbgbcf281f6a78203ad@mail.gmail.com>
Message-ID: <3bb0d9710911110741x2a601270k39cc662f0774de73@mail.gmail.com>

On Wed, Nov 11, 2009 at 15:21, Yao, Dongxian <yaodongxian at gmail.com> wrote:
> I am not sure if this is good question, but I really want to know how
> do you compare rabbitmq vs qpid. What is the reason you choose
> rabbitmq, better documentation? Erlang? More users? Better server/
> client support? Better performance? More reliable?? ...

As this is a RabbitMQ mailing list, I feel obligated to reassure
you that RabbitMQ is the best!


Marek Majkowski



From g at rre.tt  Wed Nov 11 16:14:00 2009
From: g at rre.tt (Garrett Smith)
Date: Wed, 11 Nov 2009 10:14:00 -0600
Subject: [rabbitmq-discuss] rabbitmq vs qpid
In-Reply-To: <d96a67a0911110721i7baf1fbgbcf281f6a78203ad@mail.gmail.com>
References: <d96a67a0911110721i7baf1fbgbcf281f6a78203ad@mail.gmail.com>
Message-ID: <ce2570e20911110814q35f71bbex784f2d39abcdd76c@mail.gmail.com>

On Wed, Nov 11, 2009 at 9:21 AM, Yao, Dongxian <yaodongxian at gmail.com> wrote:
> I am not sure if this is good question, but I really want to know how
> do you compare rabbitmq vs qpid. What is the reason you choose
> rabbitmq, better documentation? Erlang? More users? Better server/
> client support? Better performance? More reliable?? ...
>
> It looks like qpid is one step ahead with the AMQP implentation, they
> said they have implemented the AMQP 0-10, but rabbitmq is still on 0-8
> and 0-9.

I've worked with both a fair amount. We're currently using RabbitMQ
primarily because it's bulidtime/runtime requirements are simpler than
Qpid's. That probably sounds weird.

I'm a big proponent of aggressively minimizing moving parts. Qpid's
use of libboost introduces a large number of libraries that have to be
carefully managed for upgrades. We experienced a couple breakages on
Debian updates that caused us to look more closely at RabbitMQ, which
runs on Erlang/OTP.

That said, I'm a bit on the fence about the issue. We could have side
stepped the Debian issue by managing the build configuration
ourselves. However, the relative stability of Erlang/OTP (a very
conservative platform to say the least) was appealing.

As far as the merits of the two AMQP implementations, Qpid is indeed
"further along" in that they support 0.8, 0.9, and 0.10. There are
some features in the later specs that I think offer material benefit
(TTL is a big one). However, for the most part, 0.8 should suffice for
most applications. If you need something specific in a later AMQP spec
that isn't in 0.8, post a question here -- there may be an approach
you can take in RabbitMQ that works fine.

Bear in mind though that AMQP is still a work in progress. It doesn't
bother me at all that the RabbitMQ team hasn't tried to "keep up with
the Jones's" in spec implementation. The penalty Qpid has paid for
supporting all three versions is increased complexity in the code
base. If you're curious about this, download the sources for both Qpid
(server) and RabbitMQ (server) and peruse both.

Both projects are *extremely* well managed.

Both communities are friendly and responsive to questions/issues of any type.

Unfortunately (or fortunately -- a big win for AMQP!), there's no easy
formula for choosing between these two implementations. If the
size/scope of your application is large enough to justify in-depth
research, download and play around with both. If you're using a
mainstream client like Java, I'd budget 2-3 days. If you're
application is more exploratory and you want to get up and running
with AMQP quickly, I think you'll find RabbitMQ faster to get started
with.

Garrett



From brian.peck at lmco.com  Wed Nov 11 16:51:39 2009
From: brian.peck at lmco.com (peckb)
Date: Wed, 11 Nov 2009 08:51:39 -0800 (PST)
Subject: [rabbitmq-discuss] Having trouble connecting via jInterface
In-Reply-To: <20091110152802.GF3233@mrnibble.lshift.net>
References: <25866384.post@talk.nabble.com>
	<4e3934860910130336g732d02b4x64771cff684362ce@mail.gmail.com>
	<25874678.post@talk.nabble.com> <26270064.post@talk.nabble.com>
	<20091110145903.GB3233@mrnibble.lshift.net>
	<20091110152802.GF3233@mrnibble.lshift.net>
Message-ID: <26304593.post@talk.nabble.com>


Ah, excelent! That did do the trick. It also worked for all of the other
methods where sending in an OtpErlangBinary wasn't working [most all of
them].  The OtpErlangAtom(s) that I have (for making info_all only return
the data I want) were still ok being pure strings at construction.  Thanks
again.


Matthew Sackman wrote:
> 
>> On Mon, Nov 09, 2009 at 09:13:30AM -0800, peckb wrote:
>> > OtpErlangObject [] objectArray = { new OtpErlangBinary("/") };
> 
> Matthias has spotted that this is wrong - called that way, the object
> will be serialized. Thus you're ending up with a weird non existing
> vhost. Instead, you want OtpErlangBinary("/".toBytes())
> 
> Matthew
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://old.nabble.com/Having-trouble-connecting-via-jInterface-tp25866384p26304593.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From michael at elsdoerfer.com  Thu Nov 12 04:52:22 2009
From: michael at elsdoerfer.com (=?ISO-8859-1?Q?Michael_Elsd=F6rfer?=)
Date: Thu, 12 Nov 2009 05:52:22 +0100
Subject: [rabbitmq-discuss] DNS Issues / Error: cannot_get_pid
In-Reply-To: <20091111135108.GI6172@mrnibble.lshift.net>
References: <4AF41AEA.5050306@elsdoerfer.com>	<20091110144504.GA3233@mrnibble.lshift.net>	<4AFAAEEF.7010304@elsdoerfer.com>	<20091111125826.GH6172@mrnibble.lshift.net>
	<20091111135108.GI6172@mrnibble.lshift.net>
Message-ID: <4AFB9486.1040607@elsdoerfer.com>

Great - thanks for your help!

Michael

Matthew Sackman schrieb:
> Hi Michael,
> 
> It's just been pointed out to me that the issue you're seeing has been
> fixed and will be part of 1.7.1. It was a bug in our code. The packages
> that I was testing with were packages I'd built using more up to date
> code than in 1.7.0 which is why it was all working for me.
> 
> So again, it's a case of "just wait a bit" and then your problems will
> be magically solved!
> 
> Matthew
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From matthias at lshift.net  Thu Nov 12 05:05:34 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 12 Nov 2009 05:05:34 +0000
Subject: [rabbitmq-discuss] Queues and auto_delete
In-Reply-To: <4A7B3187.6070501@lshift.net>
References: <ce2570e20908060906k16c17056w20df974ce133b04b@mail.gmail.com>	<4A7B2A24.4080206@lshift.net>
	<ce2570e20908061217u1551a2bbw473071f6a51f74cd@mail.gmail.com>
	<4A7B3187.6070501@lshift.net>
Message-ID: <4AFB979E.5080605@lshift.net>

Garrett,

Matthias Radestock wrote:
> Garrett Smith wrote:
>> I only want a single consumer from the queue, but the queue needs to
>> stick around to collected messages even when the consumer is
>> disconnected.
> 
> Exclusivity is on a per-connection basis. It sounds like you want a
> notion of exclusivity based on consumer identity. That is not directly
> supported by AMQP

Actually, AMQP (and RabbitMQ) *does* support this. When a consumer does 
a 'basic.consume' with the 'exclusive' flag set to true, then any other 
consumer attempting to consume from the same queue will get an error 
until the exclusive consumer has disappeared (through basic.cancel, 
channel/connection closure, client/network failure, etc).


Regards,

Matthias.



From tonyg at lshift.net  Thu Nov 12 14:08:34 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 12 Nov 2009 14:08:34 +0000
Subject: [rabbitmq-discuss] Cherly
Message-ID: <4AFC16E2.1020307@lshift.net>

This looks interesting: http://github.com/cliffmoon/cherly

Could it be of use in the server codebase? I vaguely recall occasionally
wanting an LRU cache, but can't quite remember for what.

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From alexis.richardson at gmail.com  Thu Nov 12 14:12:50 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 12 Nov 2009 14:12:50 +0000
Subject: [rabbitmq-discuss] Cherly
In-Reply-To: <4AFC16E2.1020307@lshift.net>
References: <4AFC16E2.1020307@lshift.net>
Message-ID: <167204d20911120612m4de82a73j3bf32c3f47df803d@mail.gmail.com>

Interesting.  I am cc'ing Cliff in case he would like to comment.

a


On Thu, Nov 12, 2009 at 2:08 PM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> This looks interesting: http://github.com/cliffmoon/cherly
>
> Could it be of use in the server codebase? I vaguely recall occasionally
> wanting an LRU cache, but can't quite remember for what.
>
> Tony
> --
> ?[][][] Tony Garnock-Jones ? ? | Mob: +44 (0)7905 974 211
> ? [][] LShift Ltd ? ? ? ? ? ? | Tel: +44 (0)20 7729 7060
> ?[] ?[] http://www.lshift.net/ | Email: tonyg at lshift.net
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From tonyg at lshift.net  Thu Nov 12 14:25:55 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 12 Nov 2009 14:25:55 +0000
Subject: [rabbitmq-discuss] Rabbit-MQ crashing
In-Reply-To: <4ece5be60911100944y696030e9ga2ba6d153d0c19b6@mail.gmail.com>
References: <4ece5be60911100944y696030e9ga2ba6d153d0c19b6@mail.gmail.com>
Message-ID: <4AFC1AF3.6000406@lshift.net>

Hi Derek,

(Replying here as well for the archive)

Derek Burdick wrote:
> I have a durable, fanout exchange and queue.  I post persistent messages
> to the exchange.  After sending messages for some time, the ERL process
> stops and I can not restart RabbitMQ without deleting the contents of
> the Database.  Here is the log from startup:
> [...]
>                               {{{badmatch,eof},
> [{rabbit_persister,internal_load_snapshot,2},
> [...]

RabbitMQ has become overfull, and crashed during persister log rollover
as a result. You probably have a zero-byte-long rabbit_persister.LOG,
and a large rabbit_persister.LOG.previous. Make a backup of the
.previous file somewhere else, just in case, and then copy it over top
of the rabbit_persister.LOG file and start the broker. You shouldn't
need to delete the whole database.

We're working on fixing the underlying cause, but for now, you must not
store more messages than (some proportion of) your available RAM can
hold. If you are simply buffering things without trying to consume them,
then you will probably need to introduce some consumers of some kind :-)
and if you do have consumers running, but Rabbit is running out of
memory anyway, you should probably check that you are acknowledging
deliveries from the broker properly.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From kevin at hypotheticalabs.com  Thu Nov 12 18:01:13 2009
From: kevin at hypotheticalabs.com (Kevin A. Smith)
Date: Thu, 12 Nov 2009 13:01:13 -0500
Subject: [rabbitmq-discuss] Cherly
In-Reply-To: <167204d20911120612m4de82a73j3bf32c3f47df803d@mail.gmail.com>
References: <4AFC16E2.1020307@lshift.net>
	<167204d20911120612m4de82a73j3bf32c3f47df803d@mail.gmail.com>
Message-ID: <18A6BED3-FF29-429A-B709-EA7F3C632271@hypotheticalabs.com>

FWIW, I've used cherly a bit and it's a nice LRU for smallish binaries. It's backed by Judy arrays and has a decent API and good performance -- at least for the bit of load I've put it under.

--Kevin
On Nov 12, 2009, at 9:12 AM, Alexis Richardson wrote:

> Interesting.  I am cc'ing Cliff in case he would like to comment.
> 
> a
> 
> 
> On Thu, Nov 12, 2009 at 2:08 PM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
>> This looks interesting: http://github.com/cliffmoon/cherly
>> 
>> Could it be of use in the server codebase? I vaguely recall occasionally
>> wanting an LRU cache, but can't quite remember for what.
>> 
>> Tony
>> --
>>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>>   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>>  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>> 
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From tonyg at lshift.net  Thu Nov 12 18:22:14 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Thu, 12 Nov 2009 18:22:14 +0000
Subject: [rabbitmq-discuss] Cherly
In-Reply-To: <4AFC50B4.8020904@gmail.com>
References: <4AFC16E2.1020307@lshift.net>
	<167204d20911120612m4de82a73j3bf32c3f47df803d@mail.gmail.com>
	<18A6BED3-FF29-429A-B709-EA7F3C632271@hypotheticalabs.com>
	<4AFC50B4.8020904@gmail.com>
Message-ID: <4AFC5256.9010400@lshift.net>

Good points. Well, next time we run into a place where a solid LRU cache
is required, we can look into it again... I'm guessing that eventually
we'll need to address the issue of binary deps, but for now we can avoid
them, so we probably should.

Cheers,
  Tony


Cliff Moon wrote:
> Actually I designed it for larger binaries (> 64 bytes) since I'm using
> the vector API's to avoid any copying on larger binaries.  The LRU data
> structure is a simple doubly linked list that keeps pointers into the
> judy array.  One issue you might have with integrating it into something
> like rabbitmq is that you are now introducing binary dependencies. 
> Cherly is mostly C, and judy is all C.  I have not done any work on
> getting cherly to run on windows, and I'm not sure if judy arrays run on
> windows either.
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From g at rre.tt  Fri Nov 13 17:04:02 2009
From: g at rre.tt (Garrett Smith)
Date: Fri, 13 Nov 2009 11:04:02 -0600
Subject: [rabbitmq-discuss] Debug strategy for truncated message bodies
Message-ID: <ce2570e20911130904q5ceee8e7h9d2eb302f3a4f121@mail.gmail.com>

I have a case where a Java client (RabbitMQ 1.6) is sending to a reply
queue, which is owned/read by a Python client (qpid, 0.8 spec). The
message body sent by the Java client is ~500K. The message body read
by the Python client is ~172K. Comparing the two byte streams,
something is truncating the message body along the way.

My first inclination is just to use tcpdump to figure out what's going
on, but perhaps there's a more straight forward approach for debugging
this, or any obvious known issues that would explain the truncation.

Thanks,
Garrett



From g at rre.tt  Fri Nov 13 17:16:50 2009
From: g at rre.tt (Garrett Smith)
Date: Fri, 13 Nov 2009 11:16:50 -0600
Subject: [rabbitmq-discuss] 1.7.0 Java client not in Maven repo
Message-ID: <ce2570e20911130916g507dd3f2k823bb9ab7b8e3bd4@mail.gmail.com>

Per the docs here:

http://www.rabbitmq.com/java-client.html

I'm looking for 1.7.0 in this location:

http://repo1.maven.org/maven2/com/rabbitmq/amqp-client/

I spotted an earlier thread re 1.6.0 which took some time to propagate
to the Maven repo, so apologies is this is a known issue.

Garrett



From g at rre.tt  Fri Nov 13 17:26:18 2009
From: g at rre.tt (Garrett Smith)
Date: Fri, 13 Nov 2009 11:26:18 -0600
Subject: [rabbitmq-discuss] 1.7.0 Java client not in Maven repo
In-Reply-To: <ce2570e20911130916g507dd3f2k823bb9ab7b8e3bd4@mail.gmail.com>
References: <ce2570e20911130916g507dd3f2k823bb9ab7b8e3bd4@mail.gmail.com>
Message-ID: <ce2570e20911130926i4b8e59adre1edbf06f7352bc5@mail.gmail.com>

On Fri, Nov 13, 2009 at 11:16 AM, Garrett Smith <g at rre.tt> wrote:
> Per the docs here:
>
> http://www.rabbitmq.com/java-client.html
>
> I'm looking for 1.7.0 in this location:
>
> http://repo1.maven.org/maven2/com/rabbitmq/amqp-client/
>
> I spotted an earlier thread re 1.6.0 which took some time to propagate
> to the Maven repo, so apologies is this is a known issue.

Ugh, I just saw the note in the download page explicitly stating the
delay. Sorry for the noise :(



From tonyg at lshift.net  Fri Nov 13 18:13:16 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 13 Nov 2009 18:13:16 +0000
Subject: [rabbitmq-discuss] Debug strategy for truncated message bodies
In-Reply-To: <ce2570e20911130904q5ceee8e7h9d2eb302f3a4f121@mail.gmail.com>
References: <ce2570e20911130904q5ceee8e7h9d2eb302f3a4f121@mail.gmail.com>
Message-ID: <4AFDA1BC.2040407@lshift.net>

Hi Garrett,

Garrett Smith wrote:
> My first inclination is just to use tcpdump to figure out what's going
> on, but perhaps there's a more straight forward approach for debugging
> this, or any obvious known issues that would explain the truncation.

No obvious known issues, not to me at least; tcpdump or the RabbitMQ
Tracer (java CLI app, com.rabbitmq.tools.Tracer) would be good starts.
Also interesting would be to try a dummy consumer in Java to see if it's
on the inbound (to RabbitMQ) leg or on the outbound leg that the
truncation is appearing.

Tony



From g at rre.tt  Sat Nov 14 02:01:00 2009
From: g at rre.tt (Garrett Smith)
Date: Fri, 13 Nov 2009 20:01:00 -0600
Subject: [rabbitmq-discuss] Debug strategy for truncated message bodies
In-Reply-To: <4AFDA1BC.2040407@lshift.net>
References: <ce2570e20911130904q5ceee8e7h9d2eb302f3a4f121@mail.gmail.com>
	<4AFDA1BC.2040407@lshift.net>
Message-ID: <ce2570e20911131801w201a0624mb623f85d9dbce6b@mail.gmail.com>

On Fri, Nov 13, 2009 at 12:13 PM, Tony Garnock-Jones <tonyg at lshift.net> wrote:
> Hi Garrett,
>
> Garrett Smith wrote:
>> My first inclination is just to use tcpdump to figure out what's going
>> on, but perhaps there's a more straight forward approach for debugging
>> this, or any obvious known issues that would explain the truncation.
>
> No obvious known issues, not to me at least; tcpdump or the RabbitMQ
> Tracer (java CLI app, com.rabbitmq.tools.Tracer) would be good starts.
> Also interesting would be to try a dummy consumer in Java to see if it's
> on the inbound (to RabbitMQ) leg or on the outbound leg that the
> truncation is appearing.

Thanks Tony.

Just to followup on this...

The problem lies with the qpid Python client, which (apparently) only
reads one frame when reading a message body. The ~128K message body
that's truncated represents one frame -- subsequent frames are
dropped.

I've opened a ticket on jira.

As a possible work around (hack), is there a straight forward way to
have rabbit send the entire message body in a single frame?

Garrett



From lynton.grice at logosworld.com  Sat Nov 14 10:44:10 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Sat, 14 Nov 2009 12:44:10 +0200
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
Message-ID: <000e01ca6517$6a90ad00$3fb20700$@grice@logosworld.com>

Hi there,

 

I have written about this before and still no luck ;-( I have just installed
the latest "rabbitmq-public-umbrella" and ran MAKE etc to get all the
required EZ files created for the BQL.

 

I then activated the plugins....and have RabbitMQ started now in the command
prompt (not a windows service), and the moment I try do a simple select
statement I get a dump...

 

BQL> select * from exchanges

{"init terminating in do_boot",{badarg,[{io,format,[<0.29.0>,"BQL execution
failed:~n
~s~n",[{undef,[{rabbit_misc,localnode,[rabbit]},{bql_applicator,appl

y_commands,2},{bql_server,handle_message,1},{bql_server,handle_call,3},{gen_
server,handle_msg,5},{proc_lib,init_p_do_apply,3}]}]]},{bql_client,run_comma
nd,

0},{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init
,start_em,1}]}}

 

Crash dump was written to: erl_crash.dump

init terminating in do_boot ()

 

Any idea what this could be? Some version issue or something?

 

Thanks for the help

 

Lynton

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091114/65f1b5ae/attachment.htm 

From tonyg at lshift.net  Sat Nov 14 13:10:33 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Sat, 14 Nov 2009 13:10:33 +0000
Subject: [rabbitmq-discuss] Debug strategy for truncated message bodies
In-Reply-To: <ce2570e20911131801w201a0624mb623f85d9dbce6b@mail.gmail.com>
References: <ce2570e20911130904q5ceee8e7h9d2eb302f3a4f121@mail.gmail.com>	
	<4AFDA1BC.2040407@lshift.net>
	<ce2570e20911131801w201a0624mb623f85d9dbce6b@mail.gmail.com>
Message-ID: <4AFEAC49.5070205@lshift.net>

Garrett Smith wrote:
> As a possible work around (hack), is there a straight forward way to
> have rabbit send the entire message body in a single frame?

Interesting. No, not without source code changes. (I will file a bug to
make this configurable.) First, make sure that all clients negotiate to
as large a frame size as possible, given the maximum that the server
suggests, and then change the (hard coded!) 131072 in rabbit_reader.erl
to some large value and rebuild.

Note that if the *sending* client has a small frame size, but the
*receiving* client has a large frame size, Rabbit will not currently
refragment the messages, so you will still see the problem.

Alternatively, there's py-amqplib and pika.

Cheers,
  Tony



From jesus at omniti.com  Sat Nov 14 18:45:38 2009
From: jesus at omniti.com (Theo Schlossnagle)
Date: Sat, 14 Nov 2009 13:45:38 -0500
Subject: [rabbitmq-discuss] rabbitmq-c thread-safe
Message-ID: <37EA636C-7DD4-4229-8B60-6C9526AA4A40@omniti.com>

The current tip of rabbit-mq has two issues:

The first is that it declares many blank structures:
 typedef struct foo { } foo_t;

Many compilers don't allow this -- in fact, gcc is the only know I know of that does.  This should be changed to something like:
 typedef struct foo { unsigned unused:1; } foo_t;

This is autogenerated code...


The second issue is that the library uses a global variable to track the reply state on the a connection making it not thread safe.  I've patched the tip, it is attached.

I'd love to just declare the variable as __thread, but too many compilers and platforms do not support that annotation.  So, I've used a pthread_key to localize the reply variable per thread. "works for me"


I'm not "on list", so please keep me in the Cc if you've any questions, thoughts or concerns.

Thanks!

Also, rabbitmq-c has been exposed for perl-lovers as Net::RabbitMQ on CPAN.

--
Theo Schlossnagle
http://omniti.com/is/theo-schlossnagle


-------------- next part --------------
A non-text attachment was scrubbed...
Name: thread-safe.diff
Type: application/octet-stream
Size: 5250 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091114/ba9a66ba/attachment.obj 
-------------- next part --------------




From pauljones23 at gmail.com  Sun Nov 15 01:17:57 2009
From: pauljones23 at gmail.com (Paul Jones)
Date: Sun, 15 Nov 2009 01:17:57 +0000
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <4108381017247949175@unknownmsgid>
References: <4108381017247949175@unknownmsgid>
Message-ID: <29598b610911141717u63b03bffy882f1775a106f544@mail.gmail.com>

Hi Lynton,

There is currently a slight compatibility issue between BQL and the head
revision of the broker. If you update your rabbitmq server to the 1.7.0 tag
(hg up -C rabbitmq_v1_7_0 in the rabbitmq-server dir), then it should start
successfully.

Paul.

On Sat, Nov 14, 2009 at 10:44 AM, Lynton Grice
<lynton.grice at logosworld.com>wrote:

>  Hi there,
>
>
>
> I have written about this before and still no luck ;-( I have just
> installed the latest ?rabbitmq-public-umbrella? and ran MAKE etc to get all
> the required EZ files created for the BQL.
>
>
>
> I then activated the plugins....and have RabbitMQ started now in the
> command prompt (not a windows service), and the moment I try do a simple
> select statement I get a dump...
>
>
>
> BQL> select * from exchanges
>
> {"init terminating in do_boot",{badarg,[{io,format,[<0.29.0>,"BQL execution
> failed:~n
> ~s~n",[{undef,[{rabbit_misc,localnode,[rabbit]},{bql_applicator,appl
>
>
> y_commands,2},{bql_server,handle_message,1},{bql_server,handle_call,3},{gen_server,handle_msg,5},{proc_lib,init_p_do_apply,3}]}]]},{bql_client,run_command,
>
>
> 0},{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init,start_em,1}]}}
>
>
>
> Crash dump was written to: erl_crash.dump
>
> init terminating in do_boot ()
>
>
>
> Any idea what this could be? Some version issue or something?
>
>
>
> Thanks for the help
>
>
>
> Lynton
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091115/b7ea4786/attachment.htm 

From lynton.grice at logosworld.com  Sun Nov 15 06:25:36 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Sun, 15 Nov 2009 08:25:36 +0200
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <29598b610911141717u63b03bffy882f1775a106f544@mail.gmail.com>
References: <4108381017247949175@unknownmsgid>
	<29598b610911141717u63b03bffy882f1775a106f544@mail.gmail.com>
Message-ID: <002b01ca65bc$754a2190$5fde64b0$@grice@logosworld.com>

Hi Paul,

 

I did exactly what you said using the "hg up -C rabbitmq_v1_7_0" in the
server dir, re-compiled everything and now the server will not start ;-(

 

C:\soabox\erlang\rabbitmq-public-umbrella\rabbitmq-server-rabbitmq_v1_7_0\sc
ripts>rabbitmq-server.bat

Using Custom Boot File
"C:\soabox\erlang\rabbitmq-public-umbrella\rabbitmq-server-rabbitmq_v1_7_0\s
cripts\..\ebin\rabbit.boot"

and was unexpected at this time.

 

I then decided to start fresh and download version 1.7.0 directly from
http://hg.rabbitmq.com/rabbitmq-server/archive/rabbitmq_v1_7_0.zip

 

And I copied the EZ files into the plugins dir, and activated them...and
even now when I try start the server I get the same error as above?

 

Am I missing something here?

 

Thanks

 

Lynto

 

From: Paul Jones [mailto:pauljones23 at gmail.com] 
Sent: 15 November 2009 03:18 AM
To: Lynton Grice
Cc: rabbitmq
Subject: Re: [rabbitmq-discuss] Broker Query Language (BQL) crashing

 

Hi Lynton,

There is currently a slight compatibility issue between BQL and the head
revision of the broker. If you update your rabbitmq server to the 1.7.0 tag
(hg up -C rabbitmq_v1_7_0 in the rabbitmq-server dir), then it should start
successfully.

Paul.

On Sat, Nov 14, 2009 at 10:44 AM, Lynton Grice <lynton.grice at logosworld.com>
wrote:

Hi there,

 

I have written about this before and still no luck ;-( I have just installed
the latest "rabbitmq-public-umbrella" and ran MAKE etc to get all the
required EZ files created for the BQL.

 

I then activated the plugins....and have RabbitMQ started now in the command
prompt (not a windows service), and the moment I try do a simple select
statement I get a dump...

 

BQL> select * from exchanges

{"init terminating in do_boot",{badarg,[{io,format,[<0.29.0>,"BQL execution
failed:~n
~s~n",[{undef,[{rabbit_misc,localnode,[rabbit]},{bql_applicator,appl

y_commands,2},{bql_server,handle_message,1},{bql_server,handle_call,3},{gen_
server,handle_msg,5},{proc_lib,init_p_do_apply,3}]}]]},{bql_client,run_comma
nd,

0},{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init
,start_em,1}]}}

 

Crash dump was written to: erl_crash.dump

init terminating in do_boot ()

 

Any idea what this could be? Some version issue or something?

 

Thanks for the help

 

Lynton


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091115/c4986031/attachment.htm 

From lynton.grice at logosworld.com  Sun Nov 15 06:35:35 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Sun, 15 Nov 2009 08:35:35 +0200
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <29598b610911141717u63b03bffy882f1775a106f544@mail.gmail.com>
References: <4108381017247949175@unknownmsgid>
	<29598b610911141717u63b03bffy882f1775a106f544@mail.gmail.com>
Message-ID: <003601ca65bd$db7c4820$9274d860$@grice@logosworld.com>

Hi Paul,

 

I just tried again and can see the server starts if I deactivate the
plugins, so there must be some other version issue now.

 

I have the EZ plugins outlined in the BQL install guide. Do I now need to
get a different version of the erlang client or something?

 

Thanks

 

Lynton

 

From: Paul Jones [mailto:pauljones23 at gmail.com] 
Sent: 15 November 2009 03:18 AM
To: Lynton Grice
Cc: rabbitmq
Subject: Re: [rabbitmq-discuss] Broker Query Language (BQL) crashing

 

Hi Lynton,

There is currently a slight compatibility issue between BQL and the head
revision of the broker. If you update your rabbitmq server to the 1.7.0 tag
(hg up -C rabbitmq_v1_7_0 in the rabbitmq-server dir), then it should start
successfully.

Paul.

On Sat, Nov 14, 2009 at 10:44 AM, Lynton Grice <lynton.grice at logosworld.com>
wrote:

Hi there,

 

I have written about this before and still no luck ;-( I have just installed
the latest "rabbitmq-public-umbrella" and ran MAKE etc to get all the
required EZ files created for the BQL.

 

I then activated the plugins....and have RabbitMQ started now in the command
prompt (not a windows service), and the moment I try do a simple select
statement I get a dump...

 

BQL> select * from exchanges

{"init terminating in do_boot",{badarg,[{io,format,[<0.29.0>,"BQL execution
failed:~n
~s~n",[{undef,[{rabbit_misc,localnode,[rabbit]},{bql_applicator,appl

y_commands,2},{bql_server,handle_message,1},{bql_server,handle_call,3},{gen_
server,handle_msg,5},{proc_lib,init_p_do_apply,3}]}]]},{bql_client,run_comma
nd,

0},{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init
,start_em,1}]}}

 

Crash dump was written to: erl_crash.dump

init terminating in do_boot ()

 

Any idea what this could be? Some version issue or something?

 

Thanks for the help

 

Lynton


_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091115/7c125296/attachment.htm 

From matthew at lshift.net  Sun Nov 15 11:22:30 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Sun, 15 Nov 2009 11:22:30 +0000
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <000e01ca6517$6a90ad00$3fb20700$@grice@logosworld.com>
References: <000e01ca6517$6a90ad00$3fb20700$@grice@logosworld.com>
Message-ID: <20091115112229.GA17316@wellquite.org>

Hi Lynton,

On Sat, Nov 14, 2009 at 12:44:10PM +0200, Lynton Grice wrote:
> I then activated the plugins....and have RabbitMQ started now in the command
> prompt (not a windows service), and the moment I try do a simple select
> statement I get a dump...
> 
> Any idea what this could be? Some version issue or something?

*Sigh*. Yes, it's a version issue. You need to be using a version of BQL
that matches the server v1.7.0 because they share source. Sadly, and
this is not your fault at all, there are no tagged versions for the BQL
so you have very little guidance as to which version to use. The only
thing I can suggest is to work by date:
http://hg.rabbitmq.com/rabbitmq-bql/ shows that there have been commits
very recently which will be based on code going into 1.7.1 which is why
it won't work with 1.7.0. According to
http://www.rabbitmq.com/news.html#2009-10-07T00:00:00Z 1.7.0 was
released 7th October. Revision ff24a539e6a1 of the bql looks most
appropriate then as it's both on default branch and happened just before
the release. I would expect that to work.

Other than that, if you're using the experimental downloads then really
the only thing that we would expect to work is the head of the default
branch of the experimental downloads with the head of the default branch
of the server.

Matthew



From lynton.grice at logosworld.com  Sun Nov 15 15:01:46 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Sun, 15 Nov 2009 17:01:46 +0200
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <20091115112229.GA17316@wellquite.org>
References: <000e01ca6517$6a90ad00$3fb20700$@grice@logosworld.com>
	<20091115112229.GA17316@wellquite.org>
Message-ID: <000801ca6604$91b6d060$b5247120$@grice@logosworld.com>

Hi Matthew,

Thanks for the response, much appreciated.

I have tried exactly what you suggested below and I still get this error:

C:\soabox\erlang\rabbitmq-public-umbrella_just_compiled\rabbitmq-server\scri
pts>rabbitmq-server.bat
Using Custom Boot File
"C:\soabox\erlang\rabbitmq-public-umbrella_just_compiled\rabbitmq-server\scr
ipts\..\ebin\rabbit.boot"
and was unexpected at this time.

This version incompatibility is very frustrating ;-( It makes me wonder how
many people out there have actually got BQL even running? I have following
the install guide / plugin guide perfectly and tried now numerous times, and
still no luck...

My exact setup is the latest "Rabbit_Umbrella" and I have downloaded the BQL
you suggested (ff24a539e6a1) and am using Rabbit Server 1.7.0. 

Any other possibilities? All I want is to get BQL running ;-)

Chat later

Lynton

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew
Sackman
Sent: 15 November 2009 01:23 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Broker Query Language (BQL) crashing

Hi Lynton,

On Sat, Nov 14, 2009 at 12:44:10PM +0200, Lynton Grice wrote:
> I then activated the plugins....and have RabbitMQ started now in the
command
> prompt (not a windows service), and the moment I try do a simple select
> statement I get a dump...
> 
> Any idea what this could be? Some version issue or something?

*Sigh*. Yes, it's a version issue. You need to be using a version of BQL
that matches the server v1.7.0 because they share source. Sadly, and
this is not your fault at all, there are no tagged versions for the BQL
so you have very little guidance as to which version to use. The only
thing I can suggest is to work by date:
http://hg.rabbitmq.com/rabbitmq-bql/ shows that there have been commits
very recently which will be based on code going into 1.7.1 which is why
it won't work with 1.7.0. According to
http://www.rabbitmq.com/news.html#2009-10-07T00:00:00Z 1.7.0 was
released 7th October. Revision ff24a539e6a1 of the bql looks most
appropriate then as it's both on default branch and happened just before
the release. I would expect that to work.

Other than that, if you're using the experimental downloads then really
the only thing that we would expect to work is the head of the default
branch of the experimental downloads with the head of the default branch
of the server.

Matthew

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From tonyg at lshift.net  Mon Nov 16 13:01:15 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 16 Nov 2009 13:01:15 +0000
Subject: [rabbitmq-discuss] rabbitmq-c thread-safe
In-Reply-To: <37EA636C-7DD4-4229-8B60-6C9526AA4A40@omniti.com>
References: <37EA636C-7DD4-4229-8B60-6C9526AA4A40@omniti.com>
Message-ID: <4B014D1B.6030200@lshift.net>

Hi Theo,

Theo Schlossnagle wrote:
> The current tip of rabbit-mq has two issues:
> The first is that it declares many blank structures:
>  typedef struct foo { } foo_t;
> Many compilers don't allow this -- in fact, gcc is the only know I know of that does.  This should be changed to something like:
>  typedef struct foo { unsigned unused:1; } foo_t;

Yes, the code is gcc-specific. It uses some of the gcc extensions (e.g.
statement expressions) which make C less unpalatable. I don't know how
much effort it would be to avoid the gccisms in the code, and I have to
say I'm not particularly motivated to try...

It's a shame that other compilers don't let you have no-member structs;
it seems to me perfectly sensible. Glancing at the language standard,
however, I see that syntactically an empty struct is not permitted, and
semantically if no members are declared the behaviour is undefined :-(

> The second issue is that the library uses a global variable to track
> the reply state on the a connection making it not thread safe.  I've
> patched the tip, it is attached.

Would it work instead to put the amqp_rpc_reply variable in the
amqp_connection_state_t?

> Also, rabbitmq-c has been exposed for perl-lovers as Net::RabbitMQ on CPAN.

Awesome! Thank you very much :-)

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From gcorominas at dexmatech.com  Mon Nov 16 18:24:23 2009
From: gcorominas at dexmatech.com (Guillem Corominas)
Date: Mon, 16 Nov 2009 19:24:23 +0100
Subject: [rabbitmq-discuss] queue memory issues
Message-ID: <4B0198D7.2020808@dexmatech.com>

Hi all,

I am using RabbitMQ to send data messages between 2 java applications in 
2 different machines.
Sometimes the RabbitMQ broker crashes because the queues are too large, 
due to large comunication cuts (days).
I tried using MessageProperties.PERSISTENT_BASIC when performing 
basicPublish action, so it persists the messages to disk, but the 
problem doesn't
solve by doing that.

I would really apreciate if someone could help me solve a couple of 
questions (or tell me where to look at, I've looked up in the API and 
docs, but couldn't find it):
a) how can I give more memory to the rabbit to store (both memory and 
persistent) messages?
b) is it possible to make the queue discard old messages when queue 
reaches it limit, so at least the RabbitMQ broker doesn't crash?

thanks in advance,


guillem





From igor at goryachev.org  Mon Nov 16 18:41:26 2009
From: igor at goryachev.org (Igor Goryachev)
Date: Mon, 16 Nov 2009 21:41:26 +0300
Subject: [rabbitmq-discuss] testing RabbitMQ under high load
References: <87ocngggr1.fsf@goryachev.org>
	<167204d20911060216t1e3ca58cyf2f0c6553f255790@mail.gmail.com>
	<87y6mjgau9.fsf@goryachev.org>
	<167204d20911060323w1af25ad2tdd3ece2db7c0f788@mail.gmail.com>
	<87tyx7g54h.fsf@goryachev.org> <4AF9B19E.6090404@lshift.net>
Message-ID: <871vjy1fe1.fsf@goryachev.org>

On Tue, Nov 10, 2009 at 21:31, Tony Garnock-Jones wrote:

>> Ok. I have started implementation of AMQP plugin for Tsung. Details will
>> follow a bit later.
>
> That's exciting! Please keep us informed.

The work is in progress. The only one problem I've met is that Tsung
modules designed to operate bare sockets and raw protocols. Is it
possible somehow to get raw protocol methods within erlang amqp client
(or rabbitmq itself)? Well, and I am not very familiar with amqp
protocol yet... Any advices?


-- 
    Igor Goryachev              E-Mail/Jabber: igor at goryachev.org



From jdc at hive7.com  Mon Nov 16 22:41:29 2009
From: jdc at hive7.com (JD Conley)
Date: Mon, 16 Nov 2009 14:41:29 -0800
Subject: [rabbitmq-discuss] how to consume one message at a time
Message-ID: <011b01ca670d$f09eb890$d1dc29b0$@com>

I'm using the .NET client and can't figure out how to consume only one
message at a time. Basically I would like to simply:

1. Consume one message from a queue
2. Cancel consumption so I don't lose any messages

My confusion comes with the statement in the user guide that "Application
callback handlers must not invoke blocking AMQP operations (such as
IModel.QueueDeclare or IModel.BasicCancel). If they do, the channel will
deadlock." But, a BasicCancel is precisely what I want to do in the
callback.

I want to use the EventingBasicConsumer. What would be the best way to
accomplish this? Which options do I set? 

-JD




From scott.brooks at epicadvertising.com  Tue Nov 17 02:59:35 2009
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Mon, 16 Nov 2009 20:59:35 -0600
Subject: [rabbitmq-discuss] how to consume one message at a time
In-Reply-To: <011b01ca670d$f09eb890$d1dc29b0$@com>
References: <011b01ca670d$f09eb890$d1dc29b0$@com>
Message-ID: <A5771158-9659-4F96-AEE8-9E10F3811A4A@epicadvertising.com>

I'm not sure what the .NET api looks like, but you want to do a basic get, rather then a basic subscribe.

It will return a single message from the queue, and then when you call it again, you will get the next message(or null/something similar)

Scott

On 2009-11-16, at 5:41 PM, JD Conley wrote:

> I'm using the .NET client and can't figure out how to consume only one
> message at a time. Basically I would like to simply:
> 
> 1. Consume one message from a queue
> 2. Cancel consumption so I don't lose any messages
> 
> My confusion comes with the statement in the user guide that "Application
> callback handlers must not invoke blocking AMQP operations (such as
> IModel.QueueDeclare or IModel.BasicCancel). If they do, the channel will
> deadlock." But, a BasicCancel is precisely what I want to do in the
> callback.
> 
> I want to use the EventingBasicConsumer. What would be the best way to
> accomplish this? Which options do I set? 
> 
> -JD
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From jdc at hive7.com  Tue Nov 17 03:42:59 2009
From: jdc at hive7.com (JD Conley)
Date: Mon, 16 Nov 2009 19:42:59 -0800 (PST)
Subject: [rabbitmq-discuss] how to consume one message at a time
In-Reply-To: <1918941155.103311258429325767.JavaMail.javamailuser@localhost>
Message-ID: <1707529410.103331258429379934.JavaMail.javamailuser@localhost>

Thanks Scott. But I do want to subscribe/consume (I think), as it is unknown whether there will be any data in the queue, and I want to be notified immediately when there is. I don't really want to poll rabbit using a basic.get and would rather be notified asynchronously when new items are in the queue. I have hundreds (thousands soon) of queues waiting for data across a cluster and the polling overhead would be higher than I want it to be. 


-JD 

----- Original Message ----- 
From: "Scott Brooks" <scott.brooks at epicadvertising.com> 
To: "JD Conley" <jdc at hive7.com> 
Cc: rabbitmq-discuss at lists.rabbitmq.com 
Sent: Monday, November 16, 2009 6:59:35 PM GMT -08:00 US/Canada Pacific 
Subject: Re: [rabbitmq-discuss] how to consume one message at a time 

I'm not sure what the .NET api looks like, but you want to do a basic get, rather then a basic subscribe. 

It will return a single message from the queue, and then when you call it again, you will get the next message(or null/something similar) 

Scott 

On 2009-11-16, at 5:41 PM, JD Conley wrote: 

> I'm using the .NET client and can't figure out how to consume only one 
> message at a time. Basically I would like to simply: 
> 
> 1. Consume one message from a queue 
> 2. Cancel consumption so I don't lose any messages 
> 
> My confusion comes with the statement in the user guide that "Application 
> callback handlers must not invoke blocking AMQP operations (such as 
> IModel.QueueDeclare or IModel.BasicCancel). If they do, the channel will 
> deadlock." But, a BasicCancel is precisely what I want to do in the 
> callback. 
> 
> I want to use the EventingBasicConsumer. What would be the best way to 
> accomplish this? Which options do I set? 
> 
> -JD 
> 
> 
> _______________________________________________ 
> rabbitmq-discuss mailing list 
> rabbitmq-discuss at lists.rabbitmq.com 
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091116/237045bd/attachment.htm 

From anthony-rabbitmq at hogan.id.au  Tue Nov 17 03:54:50 2009
From: anthony-rabbitmq at hogan.id.au (Anthony)
Date: Tue, 17 Nov 2009 14:54:50 +1100
Subject: [rabbitmq-discuss] Monitoring RabbitMQ - is it possible to extract
	IO stats from exchanges?
Message-ID: <1bf8be120911161954u49a82ccbh1f7b47e12e49a861@mail.gmail.com>

As we continue to develop our newer inhouse software around an AMQP
(RabbitMQ) core, we occasionally notice run-away queues (usually a problem
on our end) and these are easily spotted in rabbitmqctl and cony output.

What we don't seem to be able to determine at the moment, is a breakdown of
things like average message size, messages per second or size per second (or
whatever period) for specific queues and exchanges.

The concern we have is that the system might be working reliably, but that
we're putting so much data through the system it has an affect on the data
quotas of the connections we use as well as potentially slowing down other
things going through the system.

In discussing this with a colleague, the only piece of the system that knows
everything coming in and going out, would be things like exchanges within a
rabbit instance - unless one were to try and implement monitoring on every
single endpoint (which would then be another data stream which needs to be
handled)...

We looked through the source code of the erlang behind the rabbitmqctl
shellscript and couldn't really find any existing obvious ways to extract
statistics that would capture details of messages that are being processed.

Google found this:
https://dev.rabbitmq.com/wiki/ManagementAndMonitoring

Tried searching the mailing list on discussion mentioning that page and
found a few references but nothing that really talked about the metrics site
of what the page mentions. Is there any functionality available at the
moment, even if it doesn't have a frontend yet, that would allow us to
extract statistics like those mentioned on your dev wiki under requirements?

Anthony
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091117/609d6bf4/attachment.htm 

From scott.brooks at epicadvertising.com  Tue Nov 17 04:44:52 2009
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Mon, 16 Nov 2009 22:44:52 -0600
Subject: [rabbitmq-discuss] how to consume one message at a time
In-Reply-To: <1707529410.103331258429379934.JavaMail.javamailuser@localhost>
References: <1707529410.103331258429379934.JavaMail.javamailuser@localhost>
Message-ID: <1B029AE7-5E94-41C9-9DF2-CF832B6CE793@epicadvertising.com>

Then adjusting the prefetch(part of basic.qos) is probably what you want.  If you set the prefetch to 1, and subscribe with ack's turned on, then you will only get the next message after you ack the previous one.

Hopefully that works for you.  Again, I'm not sure what the .net way to specify that is though.

Scott

On 2009-11-16, at 10:42 PM, JD Conley wrote:

Thanks Scott. But I do want to subscribe/consume (I think), as it is unknown whether there will be any data in the queue, and I want to be notified immediately when there is. I don't really want to poll rabbit using a basic.get and would rather be notified asynchronously when new items are in the queue. I have hundreds (thousands soon) of queues waiting for data across a cluster and the polling overhead would be higher than I want it to be.

-JD

----- Original Message -----
From: "Scott Brooks" <scott.brooks at epicadvertising.com<mailto:scott.brooks at epicadvertising.com>>
To: "JD Conley" <jdc at hive7.com<mailto:jdc at hive7.com>>
Cc: rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
Sent: Monday, November 16, 2009 6:59:35 PM GMT -08:00 US/Canada Pacific
Subject: Re: [rabbitmq-discuss] how to consume one message at a time

I'm not sure what the .NET api looks like, but you want to do a basic get, rather then a basic subscribe.

It will return a single message from the queue, and then when you call it again, you will get the next message(or null/something similar)

Scott

On 2009-11-16, at 5:41 PM, JD Conley wrote:

> I'm using the .NET client and can't figure out how to consume only one
> message at a time. Basically I would like to simply:
>
> 1. Consume one message from a queue
> 2. Cancel consumption so I don't lose any messages
>
> My confusion comes with the statement in the user guide that "Application
> callback handlers must not invoke blocking AMQP operations (such as
> IModel.QueueDeclare or IModel.BasicCancel). If they do, the channel will
> deadlock." But, a BasicCancel is precisely what I want to do in the
> callback.
>
> I want to use the EventingBasicConsumer. What would be the best way to
> accomplish this? Which options do I set?
>
> -JD
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com<mailto:rabbitmq-discuss at lists.rabbitmq.com>
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091116/211f1c60/attachment.htm 

From matthew at lshift.net  Tue Nov 17 10:29:08 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 17 Nov 2009 10:29:08 +0000
Subject: [rabbitmq-discuss] queue memory issues
In-Reply-To: <4B0198D7.2020808@dexmatech.com>
References: <4B0198D7.2020808@dexmatech.com>
Message-ID: <20091117102906.GB21190@wellquite.org>

Hi Guillem,

On Mon, Nov 16, 2009 at 07:24:23PM +0100, Guillem Corominas wrote:
> I am using RabbitMQ to send data messages between 2 java applications in 
> 2 different machines.
> Sometimes the RabbitMQ broker crashes because the queues are too large, 
> due to large comunication cuts (days).
> I tried using MessageProperties.PERSISTENT_BASIC when performing 
> basicPublish action, so it persists the messages to disk, but the 
> problem doesn't
> solve by doing that.

This is an oft reported problem, and a thorough solution has been worked
on for many months and is nearing completion. Currently, even persistent
messages are held in RAM. Persistent messages are also written out to
disk.

> I would really apreciate if someone could help me solve a couple of 
> questions (or tell me where to look at, I've looked up in the API and 
> docs, but couldn't find it):
> a) how can I give more memory to the rabbit to store (both memory and 
> persistent) messages?

At the moment, other than increasing the amount of RAM in the server,
there is not much else you can do.

> b) is it possible to make the queue discard old messages when queue 
> reaches it limit, so at least the RabbitMQ broker doesn't crash?

Sadly not, no. There is no TTL or expiry of messages, though that too is
an oft requested feature (alas, we have not started work on that yet).

Matthew



From matthew at lshift.net  Tue Nov 17 10:29:56 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 17 Nov 2009 10:29:56 +0000
Subject: [rabbitmq-discuss] how to consume one message at a time
In-Reply-To: <A5771158-9659-4F96-AEE8-9E10F3811A4A@epicadvertising.com>
References: <011b01ca670d$f09eb890$d1dc29b0$@com>
	<A5771158-9659-4F96-AEE8-9E10F3811A4A@epicadvertising.com>
Message-ID: <20091117102955.GC21190@wellquite.org>

On Mon, Nov 16, 2009 at 08:59:35PM -0600, Scott Brooks wrote:
> I'm not sure what the .NET api looks like, but you want to do a basic get, rather then a basic subscribe.
> 
> It will return a single message from the queue, and then when you call it again, you will get the next message(or null/something similar)

Yup, that'll work. Or set QoS to 1 and use subscribe and then you'll
only get the next msg when you ack the previous one.

Matthew



From matthew at lshift.net  Tue Nov 17 10:54:27 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 17 Nov 2009 10:54:27 +0000
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <010701ca6238$3785b2c0$a6911840$@com>
References: <00eb01ca5d73$64079080$2c16b180$@com> <4AF29E24.4080701@lshift.net>
	<01a501ca5e35$6e94bec0$4bbe3c40$@com> <4AF302A3.6090105@lshift.net>
	<000601ca5f2d$d59e7860$80db6920$@com>
	<20091110151225.GC3233@mrnibble.lshift.net>
	<010701ca6238$3785b2c0$a6911840$@com>
Message-ID: <20091117105426.GD21190@wellquite.org>

On Tue, Nov 10, 2009 at 11:01:31AM -0800, JD Conley wrote:
> Yeah, that's what I thought. But yesterday I added acking just to see if it
> would help and the memory footprint no longer grows out of control and the
> process hasn't crashed since. I wonder if either the .NET client or rabbit
> isn't honoring the noack for this use case?

The .Net and Java clients definitely honour the noAck flag. Can you
produce a small test case that shows the issue you're seeing?

> > Expiration is not implemented. There is no notion of Time To Live or
> > messages expiring in RabbitMQ. This is an oft requested feature and is
> > high on our todo list, but is not in active development yet.
> 
> Add one more to that request number.

Noted; rapidly approaching integer overflow...

> The dump is over 1GB. What is the VM limit for erlang by default? Maybe we
> just hit that? The system has 4gb ram and plenty free to use the 2GB imposed
> user land limit in Windows, not to mention swap space.

Well on a 64-bit Linux system, I've made erlang happily eat 10s of GBs
of memory. I would have thought that erlang should be able to make use
of 2GB in Windows, but that error message suggests to me that's coming
back from malloc, thus it's Windows that's causing the issue. We would
thoroughly recommend you use at least a 64-bit system. ;)

Matthew



From rajkumars at gmail.com  Tue Nov 17 15:11:07 2009
From: rajkumars at gmail.com (Rajkumar S)
Date: Tue, 17 Nov 2009 20:41:07 +0530
Subject: [rabbitmq-discuss] Processing error in stomp plugin
Message-ID: <64de5c8b0911170711r7bae2825gc0b208209cc3d419@mail.gmail.com>

Hi,

I am running rabbitmq (1.6.0) with stomp plugin (tag:
rabbitmq_v1_6_0).  For past couple of days the stomp receiver
occationally stops accepting connections. if I connect with a test
client I get the following error:

Connecting to stomp using login:'guest' passcode:'guest'
body => Processing error

headers => HASH(0x82b76c8)
command => ERROR
content-type => text/plain
content-length => 17
bytes_message => 1
message => Processing error

log show the following entry:

=ERROR REPORT==== 17-Nov-2009::20:00:43 ===
STOMP error frame sent:
Message: "Processing error"
Detail: "Processing error\n"
Server private detail: {{badmatch,
                         {ok,
                          {'channel.flow',false},
                          {state,#Port<0.55143>,undefined,<0.13851.3>,
                           {headers,
                            {hstate,command,[],undefined,undefined,[]}}}}},
                        [{rabbit_stomp_server,do_login,4},
                         {rabbit_stomp_server,process_frame,3},
                         {rabbit_stomp_server,process_received_bytes,2},
                         {rabbit_stomp_server,init,1},
                         {proc_lib,init_p,5}]}


I have to stop the rabbitmq and restart it for it to start accepting
connections again. Am I doing some thing wrong or is rabbitmq acting
funny ?

with regards,

raj



From matthew at lshift.net  Tue Nov 17 16:47:10 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 17 Nov 2009 16:47:10 +0000
Subject: [rabbitmq-discuss] Processing error in stomp plugin
In-Reply-To: <64de5c8b0911170711r7bae2825gc0b208209cc3d419@mail.gmail.com>
References: <64de5c8b0911170711r7bae2825gc0b208209cc3d419@mail.gmail.com>
Message-ID: <20091117164710.GE21190@wellquite.org>

Hi Raj,

I don't really know the Stomp adapter - hopefully if I get anything
wrong someone else will correct me.

On Tue, Nov 17, 2009 at 08:41:07PM +0530, Rajkumar S wrote:
> Server private detail: {{badmatch,
>                          {ok,
>                           {'channel.flow',false},

I suspect you've run out of memory and so the channel flow feature has
been activated to stop you publishing anything further. Are there any
entries in the log suggesting you've hit the memory high watermark, or
does "rabbitmqctl list_queues names messages messages_unacknowledged"
show lots of messages?

Matthew



From jdc at hive7.com  Tue Nov 17 20:06:45 2009
From: jdc at hive7.com (JD Conley)
Date: Tue, 17 Nov 2009 12:06:45 -0800
Subject: [rabbitmq-discuss] channel limits
Message-ID: <000001ca67c1$7d665d10$78331730$@com>

Are there limits on the number of channels that can be created per cluster
node, per connection, per anything?

I read from archives about a year ago that channels are expensive to create.
Is this still true in 1.7.0? 

Does having a lot of channels open concurrently significantly add to the
overhead of any other operations?

Thanks,
JD




From jdc at hive7.com  Tue Nov 17 20:06:45 2009
From: jdc at hive7.com (JD Conley)
Date: Tue, 17 Nov 2009 12:06:45 -0800
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <20091117105426.GD21190@wellquite.org>
References: <00eb01ca5d73$64079080$2c16b180$@com>
	<4AF29E24.4080701@lshift.net>	<01a501ca5e35$6e94bec0$4bbe3c40$@com>
	<4AF302A3.6090105@lshift.net>	<000601ca5f2d$d59e7860$80db6920$@com>	<20091110151225.GC3233@mrnibble.lshift.net>	<010701ca6238$3785b2c0$a6911840$@com>
	<20091117105426.GD21190@wellquite.org>
Message-ID: <000601ca67c1$7e16c150$7a4443f0$@com>

> > process hasn't crashed since. I wonder if either the .NET client or
> rabbit
> > isn't honoring the noack for this use case?
> 
> The .Net and Java clients definitely honour the noAck flag. Can you
> produce a small test case that shows the issue you're seeing?

I seemed to have mistakenly thought my problem was solved, when in fact I
just introduced a bug so I was no longer publishing anything. My Rabbit is
still crashing due to running out of memory with my noack queue. Though, I
have recently been told I will probably need to use qos and acks in order to
get the behavior I want in the end -- see the 'how to consume one message at
a time' thread.

> Well on a 64-bit Linux system, I've made erlang happily eat 10s of GBs
> of memory. I would have thought that erlang should be able to make use
> of 2GB in Windows, but that error message suggests to me that's coming
> back from malloc, thus it's Windows that's causing the issue. We would
> thoroughly recommend you use at least a 64-bit system. ;)

It's a 64 bit OS, but the erlang that shipped with rabbit in the Windows
package was 32 bit and I was trying to go with the defaults. Is there a 64
bit erlang build for Windows? I couldn't find one...

Looks like I'll probably end up moving my cluster to Linux if there isn't a
64 bit Windows runtime.

-JD




From matthew at lshift.net  Wed Nov 18 13:13:26 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 18 Nov 2009 13:13:26 +0000
Subject: [rabbitmq-discuss] channel limits
In-Reply-To: <000001ca67c1$7d665d10$78331730$@com>
References: <000001ca67c1$7d665d10$78331730$@com>
Message-ID: <20091118131326.GC18309@mrnibble.lshift.net>

On Tue, Nov 17, 2009 at 12:06:45PM -0800, JD Conley wrote:
> Are there limits on the number of channels that can be created per cluster
> node, per connection, per anything?

Yes. Memory is likely the limiting factor - channels do not have zero
cost. The channel number is a short in the AMQP spec, which means 16
bits, so 65535 is the maximum channel. It's likely you'll need to tune
Erlang slightly for this given the default number of processes is 32768.
A +P 134217727 arg to erl should get round this for you.

> I read from archives about a year ago that channels are expensive to create.
> Is this still true in 1.7.0? 

They're certainly not free and you should reuse them as much as
possible. Depends how you define expensive though - compared to sending
a message, definitely. Compared to writing RabbitMQ, certainly not.

> Does having a lot of channels open concurrently significantly add to the
> overhead of any other operations?

If the choice is between doing N actions on one channel and doing N
actions on M channels where M is large, the former will be faster, if
only for cache and scheduling reasons. Also a number of other processes
within Rabbit are either "per channel" or measure things on a per
channel basis, thus there will be some additional accountancy and so
forth.

Matthew



From rajkumars at gmail.com  Wed Nov 18 13:31:19 2009
From: rajkumars at gmail.com (Rajkumar S)
Date: Wed, 18 Nov 2009 19:01:19 +0530
Subject: [rabbitmq-discuss] Processing error in stomp plugin
In-Reply-To: <20091117164710.GE21190@wellquite.org>
References: <64de5c8b0911170711r7bae2825gc0b208209cc3d419@mail.gmail.com>
	<20091117164710.GE21190@wellquite.org>
Message-ID: <64de5c8b0911180531q2300cffcif9b8091321e8e639@mail.gmail.com>

On Tue, Nov 17, 2009 at 10:17 PM, Matthew Sackman <matthew at lshift.net> wrote:
> Hi Raj,
>
> I don't really know the Stomp adapter - hopefully if I get anything
> wrong someone else will correct me.
>
> On Tue, Nov 17, 2009 at 08:41:07PM +0530, Rajkumar S wrote:
>> Server private detail: {{badmatch,
>> ? ? ? ? ? ? ? ? ? ? ? ? ?{ok,
>> ? ? ? ? ? ? ? ? ? ? ? ? ? {'channel.flow',false},
>
> I suspect you've run out of memory and so the channel flow feature has
> been activated to stop you publishing anything further. Are there any
> entries in the log suggesting you've hit the memory high watermark, or
> does "rabbitmqctl list_queues names messages messages_unacknowledged"
> show lots of messages?

Thanks Matthew for your kind answer,

I run this command under watch to refresh the output every 2 seconds.

 ./scripts/rabbitmqctl list_queues name messages consumers
messages_ready messages_unacknowledged messages_uncommitted
Listing queues ...
greyruby        0       0       0       0       0
postfix 2       0       0       2       0
amavis  0       0       0       0       0

Usually there are about 4 - 5 messages in queue. But when error
happens the number of messages become zero because all messages are
consumed and no new messages are being added to queues. All consumers
(I am consuming using python/amqplib) are running and live but just
waiting for messages in queue.

rabbitmq currently uses about 125m (Virtual Image), though I do not
have exact number while rabbitmq is showing error, I have not noticed
any thing unusual.

One thing I remembered when you mentioned channel flow feature is that
there are lot's of connections coming to this rabbitmq via stomp. Each
message is an individual tcp connection. I had problems with tcp syn
cookies before because of number of tcp connections and I have
disabled it now. Not sure if this is a factor but thought it would be
useful.

with regards,

raj



From matthias at lshift.net  Wed Nov 18 13:36:12 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 18 Nov 2009 13:36:12 +0000
Subject: [rabbitmq-discuss] Processing error in stomp plugin
In-Reply-To: <20091117164710.GE21190@wellquite.org>
References: <64de5c8b0911170711r7bae2825gc0b208209cc3d419@mail.gmail.com>
	<20091117164710.GE21190@wellquite.org>
Message-ID: <4B03F84C.5040506@lshift.net>

Matthew Sackman wrote:
> On Tue, Nov 17, 2009 at 08:41:07PM +0530, Rajkumar S wrote:
>> Server private detail: {{badmatch,
>>                          {ok,
>>                           {'channel.flow',false},
> 
> I suspect you've run out of memory

That is indeed the probable cause. However, ...

> and so the channel flow feature has been activated to stop you
> publishing anything further

the stomp plug-in does not implement channel.flow - it will either die
(as it did in the above case) or ignore it, depending on circumstances.
Fixing that is on our todo list, though it's a long way down, since the
stomp plug-in is experimental.

Regards,

Matthias.



From m.nacos at gmail.com  Wed Nov 18 16:58:43 2009
From: m.nacos at gmail.com (Michael Nacos)
Date: Wed, 18 Nov 2009 16:58:43 +0000
Subject: [rabbitmq-discuss] Reliable way to get number of messages in a
	queue
In-Reply-To: <4AE21B80.7080607@lshift.net>
References: <476587320910230941p3cfb8cc8w237c71c0027fff8c@mail.gmail.com>
	<20091023171754.GA6672@mrnibble.lshift.net>
	<476587320910231059h1306a7afy71bbfb5f9b3a7b60@mail.gmail.com>
	<4AE21B80.7080607@lshift.net>
Message-ID: <407fa4640911180858yfa503a4o7eb6211d21e447b8@mail.gmail.com>

Hi there,

I know there is nothing in the protocol supporting book-keeping information
such as queue lengths etc.
However, basic get ok returns a message count which is more or less correct,
except when consumers are
still attached to the queue (there's no connection closing until the very
end of the experiment, we are reusing
a few connections). I have been using rabbitmqctl to check to the queue
lengths and according to rabbitmqctl
the consumer processes do not keep up with the message generation rate but
the external poller process gets
a message count of zero. As soon as the consumers disconnect, message count
reports the right number of
unhandled messages again.

Is this something that you have seen before/would expect? My polling
strategy is: consume a single message
from a queue with no_ack=false, read the message count, send no ack and
disconnect.

regards, Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091118/cf226472/attachment.htm 

From matthew at lshift.net  Wed Nov 18 17:18:53 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 18 Nov 2009 17:18:53 +0000
Subject: [rabbitmq-discuss] Reliable way to get number of messages in a
 queue
In-Reply-To: <407fa4640911180858yfa503a4o7eb6211d21e447b8@mail.gmail.com>
References: <476587320910230941p3cfb8cc8w237c71c0027fff8c@mail.gmail.com>
	<20091023171754.GA6672@mrnibble.lshift.net>
	<476587320910231059h1306a7afy71bbfb5f9b3a7b60@mail.gmail.com>
	<4AE21B80.7080607@lshift.net>
	<407fa4640911180858yfa503a4o7eb6211d21e447b8@mail.gmail.com>
Message-ID: <20091118171853.GB27828@mrnibble.lshift.net>

Hi Michael,

On Wed, Nov 18, 2009 at 04:58:43PM +0000, Michael Nacos wrote:
> I know there is nothing in the protocol supporting book-keeping information
> such as queue lengths etc.
> However, basic get ok returns a message count which is more or less correct,
> except when consumers are
> still attached to the queue (there's no connection closing until the very
> end of the experiment, we are reusing
> a few connections). I have been using rabbitmqctl to check to the queue
> lengths and according to rabbitmqctl
> the consumer processes do not keep up with the message generation rate but
> the external poller process gets
> a message count of zero. As soon as the consumers disconnect, message count
> reports the right number of
> unhandled messages again.

That's odd. However, you're really much much better off using
queue.declare to redeclare the existing queue - the declare-ok that you
get back contains the number of messages in the queue. This is a much
neater strategy than below. I would recommend you switch to using this
and repeat your test.

> Is this something that you have seen before/would expect? My polling
> strategy is: consume a single message
> from a queue with no_ack=false, read the message count, send no ack and
> disconnect.

That's a dangerous thing to do as it may change message order - the
message that is reinserted into the queue as a result of the absence of
the ack and the disconnect is not guaranteed to be placed at the head of
the queue - it may very likely be placed at the tail of the queue
instead.

Matthew



From jdc at hive7.com  Wed Nov 18 17:44:28 2009
From: jdc at hive7.com (JD Conley)
Date: Wed, 18 Nov 2009 09:44:28 -0800
Subject: [rabbitmq-discuss] channel limits
In-Reply-To: <20091118131326.GC18309@mrnibble.lshift.net>
References: <000001ca67c1$7d665d10$78331730$@com>
	<20091118131326.GC18309@mrnibble.lshift.net>
Message-ID: <005f01ca6876$c76ba270$5642e750$@com>

> The channel number is a short in the AMQP spec, which means 16
> bits, so 65535 is the maximum channel. It's likely you'll need to tune
> Erlang slightly for this given the default number of processes is
> 32768.
> A +P 134217727 arg to erl should get round this for you.

Is this a limitation per RabbitMQ cluster then? Just trying to get a feel
for how I need to architect the cluster and application code...

Does RabbitMQ re-use old channel numbers? I have a channel pool that my
basic.consume clients use. These pools are torn down whenever my client
process restarts, which is often multiple times per day (whenever we push an
update to the web farm).

-JD




From matthew at lshift.net  Wed Nov 18 17:46:26 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 18 Nov 2009 17:46:26 +0000
Subject: [rabbitmq-discuss] channel limits
In-Reply-To: <005f01ca6876$c76ba270$5642e750$@com>
References: <000001ca67c1$7d665d10$78331730$@com>
	<20091118131326.GC18309@mrnibble.lshift.net>
	<005f01ca6876$c76ba270$5642e750$@com>
Message-ID: <20091118174626.GC27828@mrnibble.lshift.net>

On Wed, Nov 18, 2009 at 09:44:28AM -0800, JD Conley wrote:
> > The channel number is a short in the AMQP spec, which means 16
> > bits, so 65535 is the maximum channel. It's likely you'll need to tune
> > Erlang slightly for this given the default number of processes is
> > 32768.
> > A +P 134217727 arg to erl should get round this for you.
> 
> Is this a limitation per RabbitMQ cluster then? Just trying to get a feel
> for how I need to architect the cluster and application code...

No, that's a limit per node within the cluster.

> Does RabbitMQ re-use old channel numbers?

Yup.

> I have a channel pool that my
> basic.consume clients use. These pools are torn down whenever my client
> process restarts, which is often multiple times per day (whenever we push an
> update to the web farm).

Yes, that should be fine.

Matthew



From matthew at lshift.net  Wed Nov 18 17:52:06 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 18 Nov 2009 17:52:06 +0000
Subject: [rabbitmq-discuss] Reliable way to get number of messages in a
 queue
In-Reply-To: <20091118171853.GB27828@mrnibble.lshift.net>
References: <476587320910230941p3cfb8cc8w237c71c0027fff8c@mail.gmail.com>
	<20091023171754.GA6672@mrnibble.lshift.net>
	<476587320910231059h1306a7afy71bbfb5f9b3a7b60@mail.gmail.com>
	<4AE21B80.7080607@lshift.net>
	<407fa4640911180858yfa503a4o7eb6211d21e447b8@mail.gmail.com>
	<20091118171853.GB27828@mrnibble.lshift.net>
Message-ID: <20091118175206.GD27828@mrnibble.lshift.net>

On Wed, Nov 18, 2009 at 05:18:53PM +0000, Matthew Sackman wrote:
> That's odd. However, you're really much much better off using
> queue.declare to redeclare the existing queue - the declare-ok that you
> get back contains the number of messages in the queue. This is a much
> neater strategy than below. I would recommend you switch to using this
> and repeat your test.

What's actually wrong with what you were doing is that the rabbitmqctl
list_queues contains both the ready messages and the unack'd msgs (as
well as uncommitted msgs). Thus if your consumers aren't acking msgs
quickly enough (and have an unbounded qos setting) then it will appear
that they're not keeping up. Use:

rabbitmqctl list_queues name messages_ready messages_unacknowledged

Matthew



From m.nacos at gmail.com  Wed Nov 18 18:10:56 2009
From: m.nacos at gmail.com (Michael Nacos)
Date: Wed, 18 Nov 2009 18:10:56 +0000
Subject: [rabbitmq-discuss] Reliable way to get number of messages in a
	queue
In-Reply-To: <20091118175206.GD27828@mrnibble.lshift.net>
References: <476587320910230941p3cfb8cc8w237c71c0027fff8c@mail.gmail.com>
	<20091023171754.GA6672@mrnibble.lshift.net>
	<476587320910231059h1306a7afy71bbfb5f9b3a7b60@mail.gmail.com>
	<4AE21B80.7080607@lshift.net>
	<407fa4640911180858yfa503a4o7eb6211d21e447b8@mail.gmail.com>
	<20091118171853.GB27828@mrnibble.lshift.net>
	<20091118175206.GD27828@mrnibble.lshift.net>
Message-ID: <407fa4640911181010o27d298bbl1abb2025e7197ac3@mail.gmail.com>

thanks... more testing tomorrow

2009/11/18 Matthew Sackman <matthew at lshift.net>

> On Wed, Nov 18, 2009 at 05:18:53PM +0000, Matthew Sackman wrote:
> > That's odd. However, you're really much much better off using
> > queue.declare to redeclare the existing queue - the declare-ok that you
> > get back contains the number of messages in the queue. This is a much
> > neater strategy than below. I would recommend you switch to using this
> > and repeat your test.
>
> What's actually wrong with what you were doing is that the rabbitmqctl
> list_queues contains both the ready messages and the unack'd msgs (as
> well as uncommitted msgs). Thus if your consumers aren't acking msgs
> quickly enough (and have an unbounded qos setting) then it will appear
> that they're not keeping up. Use:
>
> rabbitmqctl list_queues name messages_ready messages_unacknowledged
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091118/e658ea58/attachment.htm 

From chris.peele at mclaneat.com  Wed Nov 18 18:35:18 2009
From: chris.peele at mclaneat.com (cpeele00)
Date: Wed, 18 Nov 2009 10:35:18 -0800 (PST)
Subject: [rabbitmq-discuss]  What are the System Requirements?
Message-ID: <26411888.post@talk.nabble.com>



Good morning,

Would someone please be able to provide me with the minimum System
Requirements for Rabbit MQ? (i.e. Ram, hard-drive space, etc?)?

I am trying to justify using it to our client and need to provide them with
this information and I wasn?t able to locate it on your site.

Thanks very much for your assistance.

V/R



-- 
View this message in context: http://old.nabble.com/What-are-the-System-Requirements--tp26411888p26411888.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From gojko-yahoolist at gojko.com  Thu Nov 19 07:27:24 2009
From: gojko-yahoolist at gojko.com (Gojko Adzic)
Date: Thu, 19 Nov 2009 07:27:24 +0000
Subject: [rabbitmq-discuss] 2 nodes, 4k queues
Message-ID: <4B04F35C.2050103@gojko.com>


Hi,

We had a case of a 2 nodes cluster where message delivery latency was
unacceptably slow (~ 1-2 min) when the number of queues rose above 4k.
All the messages were going out to a single topic exchange, average
message size is 5KB, the number of messages was not more than 10/s and
most of the messages matched 3-4 queues. We're using topic matching
between exchange and queues. RabbitMQ was running at about 20-30% CPU on
large EC2 instances, and about 9% memory, so there doesn't seem to be a
memory or CPU bottleneck on the machines. Is this kind of performance
expected (and if it is, how many queues per node would you suggest), or 
have we hit a configuration problem? Any ideas on monitoring/measuring 
what starts slowing down processing when the number
of queues goes up.

--
gojko adzic
http://gojko.net




From gojko-yahoolist at gojko.com  Thu Nov 19 08:20:16 2009
From: gojko-yahoolist at gojko.com (Gojko Adzic)
Date: Thu, 19 Nov 2009 08:20:16 +0000
Subject: [rabbitmq-discuss] when are auto_delete queues actually deleted?
Message-ID: <4B04FFC0.2090004@gojko.com>

Hi,

when are auto_delete queues actually dropped? When the client connection 
dies or periodically?

gojko



From rajkumars at gmail.com  Thu Nov 19 09:01:45 2009
From: rajkumars at gmail.com (Rajkumar S)
Date: Thu, 19 Nov 2009 14:31:45 +0530
Subject: [rabbitmq-discuss] Processing error in stomp plugin
In-Reply-To: <4B03F84C.5040506@lshift.net>
References: <64de5c8b0911170711r7bae2825gc0b208209cc3d419@mail.gmail.com>
	<20091117164710.GE21190@wellquite.org> <4B03F84C.5040506@lshift.net>
Message-ID: <64de5c8b0911190101h324e308bt642cd658722b12b@mail.gmail.com>

On Wed, Nov 18, 2009 at 7:06 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Matthew Sackman wrote:
>> I suspect you've run out of memory
>
> That is indeed the probable cause. However, ...

RabbitMQ has stopped responding again and here is the memory usage from top:

  PID USER      PR  NI  VIRT  SHR S %CPU %MEM    TIME+  SWAP COMMAND
21098 root      20   0  160m 2140 S    1  2.9  29:45.33  44m beam.smp

Is 160MB too much memory usage? Also all queues are showing zero
entries in messages consumers messages_ready messages_unacknowledged
and messages_uncommitted

>> and so the channel flow feature has been activated to stop you
>> publishing anything further
>
> the stomp plug-in does not implement channel.flow - it will either die
> (as it did in the above case) or ignore it, depending on circumstances.
> Fixing that is on our todo list, though it's a long way down, since the
> stomp plug-in is experimental.

:((

raj



From matthias at lshift.net  Thu Nov 19 09:22:29 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 19 Nov 2009 09:22:29 +0000
Subject: [rabbitmq-discuss] Processing error in stomp plugin
In-Reply-To: <64de5c8b0911190101h324e308bt642cd658722b12b@mail.gmail.com>
References: <64de5c8b0911170711r7bae2825gc0b208209cc3d419@mail.gmail.com>	
	<20091117164710.GE21190@wellquite.org>
	<4B03F84C.5040506@lshift.net>
	<64de5c8b0911190101h324e308bt642cd658722b12b@mail.gmail.com>
Message-ID: <4B050E55.3060708@lshift.net>

Raj,

Rajkumar S wrote:
> RabbitMQ has stopped responding again and here is the memory usage from top:
> 
>   PID USER      PR  NI  VIRT  SHR S %CPU %MEM    TIME+  SWAP COMMAND
> 21098 root      20   0  160m 2140 S    1  2.9  29:45.33  44m beam.smp
> 
> Is 160MB too much memory usage?

Note the 44m of *swap* in the above report. Either your system is 
configured with very little memory or there are other processes that use 
it all.

Rabbit, like most programs, will run very slowly when it starts 
swapping. Therefore the memory manager throttles producers in an attempt 
to get memory usage down.

If, for whatever reason, you really need to use swap, then one option is 
to disable the memory alarms. That is described at
   http://www.rabbitmq.com/extensions.html#memsup


Regards,

Matthias.



From rajkumars at gmail.com  Thu Nov 19 09:45:25 2009
From: rajkumars at gmail.com (Rajkumar S)
Date: Thu, 19 Nov 2009 15:15:25 +0530
Subject: [rabbitmq-discuss] Processing error in stomp plugin
In-Reply-To: <4B050E55.3060708@lshift.net>
References: <64de5c8b0911170711r7bae2825gc0b208209cc3d419@mail.gmail.com>
	<20091117164710.GE21190@wellquite.org> <4B03F84C.5040506@lshift.net>
	<64de5c8b0911190101h324e308bt642cd658722b12b@mail.gmail.com>
	<4B050E55.3060708@lshift.net>
Message-ID: <64de5c8b0911190145n26bda4abp8bd822fd1ec5e59f@mail.gmail.com>

On Thu, Nov 19, 2009 at 2:52 PM, Matthias Radestock <matthias at lshift.net> wrote:
> Note the 44m of *swap* in the above report. Either your system is configured
> with very little memory or there are other processes that use it all.

It's a 4Gig box, but has apache and mysql running along. I have
stopped apache and now it has about 1G memory free.

> Rabbit, like most programs, will run very slowly when it starts swapping.
> Therefore the memory manager throttles producers in an attempt to get memory
> usage down.

It may very well be possible that at some time total available memory
may be < 5% of the total memory available to the system. I will now
monitor this case also when the system stops responding.

> If, for whatever reason, you really need to use swap, then one option is to
> disable the memory alarms. That is described at
> ?http://www.rabbitmq.com/extensions.html#memsup

Thanks, I will do so if problem persists. Previously I was using old
1.3 and that did not have such problems, now I understand why.

thanks again for your help.

raj



From matthias at lshift.net  Thu Nov 19 10:03:45 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 19 Nov 2009 10:03:45 +0000
Subject: [rabbitmq-discuss] Prototype SSL/TLS enabled rabbitmq stomp
	adapter
In-Reply-To: <c1d41d540911091200j1d6d9c59r42b66113a14850de@mail.gmail.com>
References: <c1d41d540911091200j1d6d9c59r42b66113a14850de@mail.gmail.com>
Message-ID: <4B051801.5010608@lshift.net>

Jon,

Jon Bardin wrote:
> I would like to take the steps to somehow make this a configurable 
> option for the adapter... and to get this merged into the office source.
> 
> I am just not sure what to do next...

I have added stomp ssl support to our todo list. It's a fair amount of 
work to get right (anything involving ssl usually is), and will probably 
necessitate some refactoring of the server code base in order to avoid 
copy&paste.

Regards,

Matthias.



From matthias at lshift.net  Thu Nov 19 10:18:49 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 19 Nov 2009 10:18:49 +0000
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <000601ca67c1$7e16c150$7a4443f0$@com>
References: <00eb01ca5d73$64079080$2c16b180$@com>	<4AF29E24.4080701@lshift.net>	<01a501ca5e35$6e94bec0$4bbe3c40$@com>	<4AF302A3.6090105@lshift.net>	<000601ca5f2d$d59e7860$80db6920$@com>	<20091110151225.GC3233@mrnibble.lshift.net>	<010701ca6238$3785b2c0$a6911840$@com>	<20091117105426.GD21190@wellquite.org>
	<000601ca67c1$7e16c150$7a4443f0$@com>
Message-ID: <4B051B89.2020306@lshift.net>

JD,

JD Conley wrote:
> My Rabbit is still crashing due to running out of memory with my
> noack queue.

Did you check whether your queue sizes are growing? ('rabbitmqctl 
list_queues')

Could you post complete, runnable code to reproduce this?

> Is there a 64 bit erlang build for Windows? I couldn't find one...

I found this thread
 
http://groups.google.com/group/erlang-programming/browse_thread/thread/3b172141797e7e62

but I am not convinced the information therein is accurate. I suggest 
you post a query to the erlang-questions mailing list.


Regards,

Matthias.



From matthew at lshift.net  Thu Nov 19 10:25:51 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 19 Nov 2009 10:25:51 +0000
Subject: [rabbitmq-discuss] when are auto_delete queues actually deleted?
In-Reply-To: <4B04FFC0.2090004@gojko.com>
References: <4B04FFC0.2090004@gojko.com>
Message-ID: <20091119102551.GE27828@mrnibble.lshift.net>

Hi,

On Thu, Nov 19, 2009 at 08:20:16AM +0000, Gojko Adzic wrote:
> when are auto_delete queues actually dropped? When the client connection 
> dies or periodically?

On connection death.

Matthew



From matthias at lshift.net  Thu Nov 19 10:38:07 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 19 Nov 2009 10:38:07 +0000
Subject: [rabbitmq-discuss] when are auto_delete queues actually deleted?
In-Reply-To: <20091119102551.GE27828@mrnibble.lshift.net>
References: <4B04FFC0.2090004@gojko.com>
	<20091119102551.GE27828@mrnibble.lshift.net>
Message-ID: <4B05200F.1040407@lshift.net>

Matthew Sackman wrote:
> On Thu, Nov 19, 2009 at 08:20:16AM +0000, Gojko Adzic wrote:
>> when are auto_delete queues actually dropped? When the client connection 
>> dies or periodically?
> 
> On connection death.

To be precise, auto_delete queues are deleted when the last consumer 
disappears. That can be triggered by three events: basic.cancel, channel 
closure, connection closure. If the queue still has other consumers then 
it will survive.

By contrast, exclusive queues get deleted unconditionally when the 
connection that created them is closed.

Regards,

Matthias.



From gojko-yahoolist at gojko.com  Thu Nov 19 10:54:05 2009
From: gojko-yahoolist at gojko.com (Gojko Adzic)
Date: Thu, 19 Nov 2009 10:54:05 +0000
Subject: [rabbitmq-discuss] when are auto_delete queues actually deleted?
In-Reply-To: <4B05200F.1040407@lshift.net>
References: <4B04FFC0.2090004@gojko.com>	<20091119102551.GE27828@mrnibble.lshift.net>
	<4B05200F.1040407@lshift.net>
Message-ID: <4B0523CD.3040106@gojko.com>

so this is a bug then?

-bash-3.2# rabbitmqctl list_queues name auto_delete consumers | grep 0$
amq.gen-v6OnaGmZrKj3vDNWy3B0pA==        true    0
amq.gen-meDIMMmWVzZlgNIYmWySJg==        true    0
amq.gen-+kWwe8PtGrO/4AtsqwzqJg==        true    0
amq.gen-0vOWLk96SDEWD6rcLG9H1A==        true    0
amq.gen-FFEHkUo6lzYTmvXXt2evSg==        true    0
amq.gen-Z8Ob8BZDJFBNPXoN7oyV4g==        true    0
amq.gen-1d9lXsBZwiTM/tVG3cUcug==        true    0
amq.gen-OyEzVIng+Z8LgXaF/sXTlA==        true    0
amq.gen-Vl3QAu0kbw+WJYZJSrsq3g==        true    0
amq.gen-ayBsF3TVUrB/gziaeFd6gg==        true    0
amq.gen-hSiCo7cXHduxIWhKm+/6UA==        true    0
amq.gen-EzUDC0tIlDbS7lmSgiNxAQ==        true    0
amq.gen-dZHzHom4n7Az7yZDdjhuQA==        true    0
amq.gen-6Le+Ex6JhIpR32JOCSbPEQ==        true    0

gojko

Matthias Radestock wrote:
> Matthew Sackman wrote:
>> On Thu, Nov 19, 2009 at 08:20:16AM +0000, Gojko Adzic wrote:
>>> when are auto_delete queues actually dropped? When the client connection 
>>> dies or periodically?
>> On connection death.
> 
> To be precise, auto_delete queues are deleted when the last consumer 
> disappears. That can be triggered by three events: basic.cancel, channel 
> closure, connection closure. If the queue still has other consumers then 
> it will survive.
> 
> By contrast, exclusive queues get deleted unconditionally when the 
> connection that created them is closed.
> 
> Regards,
> 
> Matthias.
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 




From matthew at lshift.net  Thu Nov 19 10:57:18 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 19 Nov 2009 10:57:18 +0000
Subject: [rabbitmq-discuss] when are auto_delete queues actually deleted?
In-Reply-To: <4B0523CD.3040106@gojko.com>
References: <4B04FFC0.2090004@gojko.com>
	<20091119102551.GE27828@mrnibble.lshift.net>
	<4B05200F.1040407@lshift.net> <4B0523CD.3040106@gojko.com>
Message-ID: <20091119105717.GF27828@mrnibble.lshift.net>

On Thu, Nov 19, 2009 at 10:54:05AM +0000, Gojko Adzic wrote:
> so this is a bug then?
> 
> -bash-3.2# rabbitmqctl list_queues name auto_delete consumers | grep 0$
> amq.gen-v6OnaGmZrKj3vDNWy3B0pA==        true    0
> amq.gen-meDIMMmWVzZlgNIYmWySJg==        true    0
> amq.gen-+kWwe8PtGrO/4AtsqwzqJg==        true    0
> amq.gen-0vOWLk96SDEWD6rcLG9H1A==        true    0
> amq.gen-FFEHkUo6lzYTmvXXt2evSg==        true    0
> amq.gen-Z8Ob8BZDJFBNPXoN7oyV4g==        true    0
> amq.gen-1d9lXsBZwiTM/tVG3cUcug==        true    0
> amq.gen-OyEzVIng+Z8LgXaF/sXTlA==        true    0
> amq.gen-Vl3QAu0kbw+WJYZJSrsq3g==        true    0
> amq.gen-ayBsF3TVUrB/gziaeFd6gg==        true    0
> amq.gen-hSiCo7cXHduxIWhKm+/6UA==        true    0
> amq.gen-EzUDC0tIlDbS7lmSgiNxAQ==        true    0
> amq.gen-dZHzHom4n7Az7yZDdjhuQA==        true    0
> amq.gen-6Le+Ex6JhIpR32JOCSbPEQ==        true    0

Unlikely. I suspect you've created all those private queues and have
never attached any consumer to them. Auto_delete queues need a consumer
to have been added and then left for them to be deleted this way.

Matthew



From matthias at lshift.net  Thu Nov 19 11:01:35 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 19 Nov 2009 11:01:35 +0000
Subject: [rabbitmq-discuss] when are auto_delete queues actually deleted?
In-Reply-To: <4B0523CD.3040106@gojko.com>
References: <4B04FFC0.2090004@gojko.com>	<20091119102551.GE27828@mrnibble.lshift.net>
	<4B05200F.1040407@lshift.net> <4B0523CD.3040106@gojko.com>
Message-ID: <4B05258F.3080400@lshift.net>

Gojko,

Gojko Adzic wrote:
> so this is a bug then?
> 
> -bash-3.2# rabbitmqctl list_queues name auto_delete consumers | grep 0$
> amq.gen-v6OnaGmZrKj3vDNWy3B0pA==        true    0
> amq.gen-meDIMMmWVzZlgNIYmWySJg==        true    0
> amq.gen-+kWwe8PtGrO/4AtsqwzqJg==        true    0
> amq.gen-0vOWLk96SDEWD6rcLG9H1A==        true    0
> amq.gen-FFEHkUo6lzYTmvXXt2evSg==        true    0
> amq.gen-Z8Ob8BZDJFBNPXoN7oyV4g==        true    0
> amq.gen-1d9lXsBZwiTM/tVG3cUcug==        true    0
> amq.gen-OyEzVIng+Z8LgXaF/sXTlA==        true    0
> amq.gen-Vl3QAu0kbw+WJYZJSrsq3g==        true    0
> amq.gen-ayBsF3TVUrB/gziaeFd6gg==        true    0
> amq.gen-hSiCo7cXHduxIWhKm+/6UA==        true    0
> amq.gen-EzUDC0tIlDbS7lmSgiNxAQ==        true    0
> amq.gen-dZHzHom4n7Az7yZDdjhuQA==        true    0
> amq.gen-6Le+Ex6JhIpR32JOCSbPEQ==        true    0

A chose my words carefully: "auto_delete queues are deleted when the 
*last consumer disappears*". In other words it's the event of the last 
consumer disappearing that triggers auto-deletion, not the fact that 
there are no consumers. An auto-delete queue that has not had any 
consumers does survive. It has to, since it would have to be deleted 
straight after creation otherwise. I suspect the queues listed above 
have never had any consumers.


Regards,

Matthias.



From scott.brooks at epicadvertising.com  Thu Nov 19 13:06:05 2009
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Thu, 19 Nov 2009 07:06:05 -0600
Subject: [rabbitmq-discuss] when are auto_delete queues actually deleted?
In-Reply-To: <4B05258F.3080400@lshift.net>
References: <4B04FFC0.2090004@gojko.com>
	<20091119102551.GE27828@mrnibble.lshift.net>	<4B05200F.1040407@lshift.net>
	<4B0523CD.3040106@gojko.com> <4B05258F.3080400@lshift.net>
Message-ID: <AAE58EB2-0199-422B-8CC8-F2EDDDB37DB8@epicadvertising.com>

On 2009-11-19, at 6:01 AM, Matthias Radestock wrote:

> Gojko,
> 
> Gojko Adzic wrote:
>> so this is a bug then?
>> 
>> -bash-3.2# rabbitmqctl list_queues name auto_delete consumers | grep 0$
>> amq.gen-v6OnaGmZrKj3vDNWy3B0pA==        true    0
>> amq.gen-meDIMMmWVzZlgNIYmWySJg==        true    0
>> amq.gen-+kWwe8PtGrO/4AtsqwzqJg==        true    0
>> amq.gen-0vOWLk96SDEWD6rcLG9H1A==        true    0
>> amq.gen-FFEHkUo6lzYTmvXXt2evSg==        true    0
>> amq.gen-Z8Ob8BZDJFBNPXoN7oyV4g==        true    0
>> amq.gen-1d9lXsBZwiTM/tVG3cUcug==        true    0
>> amq.gen-OyEzVIng+Z8LgXaF/sXTlA==        true    0
>> amq.gen-Vl3QAu0kbw+WJYZJSrsq3g==        true    0
>> amq.gen-ayBsF3TVUrB/gziaeFd6gg==        true    0
>> amq.gen-hSiCo7cXHduxIWhKm+/6UA==        true    0
>> amq.gen-EzUDC0tIlDbS7lmSgiNxAQ==        true    0
>> amq.gen-dZHzHom4n7Az7yZDdjhuQA==        true    0
>> amq.gen-6Le+Ex6JhIpR32JOCSbPEQ==        true    0
> 
> A chose my words carefully: "auto_delete queues are deleted when the 
> *last consumer disappears*". In other words it's the event of the last 
> consumer disappearing that triggers auto-deletion, not the fact that 
> there are no consumers. An auto-delete queue that has not had any 
> consumers does survive. It has to, since it would have to be deleted 
> straight after creation otherwise. I suspect the queues listed above 
> have never had any consumers.
> 
> 
> Regards,
> 
> Matthias.

Also, when it says "last consumer disappears", it means exactly what is says.  If you use basic.get to pull messages off of those queues one at a time, rather then a basic.subscribe, from my experience, it will not trigger an auto delete.

We were surprised by that and switched from auto-delete to exclusive for the use case we had where we found that.

Scott





From gojko-yahoolist at gojko.com  Thu Nov 19 13:34:00 2009
From: gojko-yahoolist at gojko.com (Gojko Adzic)
Date: Thu, 19 Nov 2009 13:34:00 +0000
Subject: [rabbitmq-discuss] when are auto_delete queues actually deleted?
In-Reply-To: <4B05258F.3080400@lshift.net>
References: <4B04FFC0.2090004@gojko.com>	<20091119102551.GE27828@mrnibble.lshift.net>
	<4B05200F.1040407@lshift.net> <4B0523CD.3040106@gojko.com>
	<4B05258F.3080400@lshift.net>
Message-ID: <4B054948.90606@gojko.com>

so the case would be that the flash client dies between declaring a 
queue and creating a subscriber?

gojko

> A chose my words carefully: "auto_delete queues are deleted when the 
> *last consumer disappears*". In other words it's the event of the last 
> consumer disappearing that triggers auto-deletion, not the fact that 
> there are no consumers. An auto-delete queue that has not had any 
> consumers does survive. It has to, since it would have to be deleted 
> straight after creation otherwise. I suspect the queues listed above 
> have never had any consumers.
> 
> 
> Regards,
> 
> Matthias.
> 




From matthias at lshift.net  Thu Nov 19 13:42:54 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 19 Nov 2009 13:42:54 +0000
Subject: [rabbitmq-discuss] when are auto_delete queues actually deleted?
In-Reply-To: <4B054948.90606@gojko.com>
References: <4B04FFC0.2090004@gojko.com>	<20091119102551.GE27828@mrnibble.lshift.net>
	<4B05200F.1040407@lshift.net> <4B0523CD.3040106@gojko.com>
	<4B05258F.3080400@lshift.net> <4B054948.90606@gojko.com>
Message-ID: <4B054B5E.8040706@lshift.net>

Gojko,

Gojko Adzic wrote:
> so the case would be that the flash client dies between declaring a
> queue and creating a subscriber?

That certainly would cause the symptoms you have seen.

Perhaps you should mark the queues as 'exclusive' instead of 'auto_delete'?


Matthias.



From m.nacos at gmail.com  Thu Nov 19 16:08:52 2009
From: m.nacos at gmail.com (Michael Nacos)
Date: Thu, 19 Nov 2009 16:08:52 +0000
Subject: [rabbitmq-discuss] Reliable way to get number of messages in a
	queue
In-Reply-To: <407fa4640911181010o27d298bbl1abb2025e7197ac3@mail.gmail.com>
References: <476587320910230941p3cfb8cc8w237c71c0027fff8c@mail.gmail.com>
	<20091023171754.GA6672@mrnibble.lshift.net>
	<476587320910231059h1306a7afy71bbfb5f9b3a7b60@mail.gmail.com>
	<4AE21B80.7080607@lshift.net>
	<407fa4640911180858yfa503a4o7eb6211d21e447b8@mail.gmail.com>
	<20091118171853.GB27828@mrnibble.lshift.net>
	<20091118175206.GD27828@mrnibble.lshift.net>
	<407fa4640911181010o27d298bbl1abb2025e7197ac3@mail.gmail.com>
Message-ID: <407fa4640911190808s407ccdc6vef08563f50f2367f@mail.gmail.com>

Thanks again for your help.

I have changed our polling strategy to read the message count from
queue.declare, it makes more sense, obviously. I am using the Erlang client
for the polling process. Previous answers such as 'not supported by the
protocol' had put me in a 'dirty'-solution mindset, which explains the
initial polling strategy (I used the first thing I had seen which gave me
that sort of information).

The problem, as you have guessed already, is the number we really want is
messages_unacknowledged. The number I get from the message count is
messages_ready. I have been trying to make a producer process self-regulate
its firing rate in case the consumers are not keeping up (to avoid ram
exhaustion until the new persister comes along -- sorry Matthew :-)

Our Java consumers re-use their channels and consume messages 'by
subscription' (it's obviously a better approach) without disconnecting at
any point while the system is running. When even a single consumer connects
to the queue in question (it's a multiple consumers for a single queue
round-robin scenario) in this mode, all 'ready' messages become
'unacknowledged' messages, even though there is no way our Java threads have
processed them this fast (do the messages go into an internal Java client
buffer perhaps? or is this more of a responsibility transfer case?). So our
polling process constantly gets zero (messages_ready), unless all consumers
disconnect, in which case messages_ready shoots up to whatever
messages_unacknowledged is when this happens. Is this what you would expect?

For our purposes, anything less than an ack means our consumers are not
keeping up, so we have enforced a qos setting of 1 for each consumer. This
way, the message_ready value returned to the polling process will, of
course, be off by a few messages each time but, at least, its order of
magnitude indicates if our consumers are keeping up.

Best regards,

Michael

2009/11/18 Michael Nacos <m.nacos at gmail.com>

> thanks... more testing tomorrow
>
> 2009/11/18 Matthew Sackman <matthew at lshift.net>
>
> On Wed, Nov 18, 2009 at 05:18:53PM +0000, Matthew Sackman wrote:
>> > That's odd. However, you're really much much better off using
>> > queue.declare to redeclare the existing queue - the declare-ok that you
>> > get back contains the number of messages in the queue. This is a much
>> > neater strategy than below. I would recommend you switch to using this
>> > and repeat your test.
>>
>> What's actually wrong with what you were doing is that the rabbitmqctl
>> list_queues contains both the ready messages and the unack'd msgs (as
>> well as uncommitted msgs). Thus if your consumers aren't acking msgs
>> quickly enough (and have an unbounded qos setting) then it will appear
>> that they're not keeping up. Use:
>>
>> rabbitmqctl list_queues name messages_ready messages_unacknowledged
>>
>> Matthew
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091119/c2b492f1/attachment.htm 

From jdc at hive7.com  Thu Nov 19 17:27:49 2009
From: jdc at hive7.com (JD Conley)
Date: Thu, 19 Nov 2009 09:27:49 -0800
Subject: [rabbitmq-discuss] intermittent erl.exe crash
In-Reply-To: <4B051B89.2020306@lshift.net>
References: <00eb01ca5d73$64079080$2c16b180$@com>	<4AF29E24.4080701@lshift.net>	<01a501ca5e35$6e94bec0$4bbe3c40$@com>	<4AF302A3.6090105@lshift.net>	<000601ca5f2d$d59e7860$80db6920$@com>	<20091110151225.GC3233@mrnibble.lshift.net>	<010701ca6238$3785b2c0$a6911840$@com>	<20091117105426.GD21190@wellquite.org>
	<000601ca67c1$7e16c150$7a4443f0$@com> <4B051B89.2020306@lshift.net>
Message-ID: <008c01ca693d$9de25da0$d9a718e0$@com>

> JD Conley wrote:
> > My Rabbit is still crashing due to running out of memory with my
> > noack queue.
> 
> Did you check whether your queue sizes are growing? ('rabbitmqctl
> list_queues')

Yes, this appears to be an issue with our use case. I'm going to have to
write a pretty aggressive background cleanup process that goes through and
gets rid of queues we're not consuming anymore.

If I had ever used erlang I might be inclined to create a plug-in or patch
to add something like auto_delete_on_idle for queues and TTL for messages.
If there's anyone listening that might want to do such a thing on a
contract, send me an email off-list.

-JD




From mark.geib at echostar.com  Thu Nov 19 18:04:18 2009
From: mark.geib at echostar.com (Mark Geib)
Date: Thu, 19 Nov 2009 11:04:18 -0700
Subject: [rabbitmq-discuss] is it possible to have broker listen on multiple
	ports
Message-ID: <4B0588A2.9030704@echostar.com>

Sorry if this has be asked/answered but was not able to search the forum.

Is is possible to somehow configure a rabbitmq broker to listen on
multiple network ports.

I am running 1.6 and 1.7.

Mark.

-- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD



From anthony-rabbitmq at hogan.id.au  Fri Nov 20 06:24:42 2009
From: anthony-rabbitmq at hogan.id.au (Anthony)
Date: Fri, 20 Nov 2009 17:24:42 +1100
Subject: [rabbitmq-discuss] Monitoring RabbitMQ - is it possible to
	extract IO stats from exchanges?
In-Reply-To: <1bf8be120911161954u49a82ccbh1f7b47e12e49a861@mail.gmail.com>
References: <1bf8be120911161954u49a82ccbh1f7b47e12e49a861@mail.gmail.com>
Message-ID: <1bf8be120911192224mcc4fd20r17855677133991e8@mail.gmail.com>

I realised I botched what I said in my previous post a little bit with
respect to exchanges and such..

Basically, we want to know how much data's going into and out of rabbit and
how often, down to the individual destinations of a given message (perhaps
not always providing/recording this data until monitoring is specifically
required, or otherwise, as part of a debug mode if it proves to be a
significant load issue).

As sometimes a program might fail to consume messages or similar, as far as
I can tell, this kind of data could only be reliably determined from within
rabbit, as rabbit is the one doing the message routing.

Google found this:
> https://dev.rabbitmq.com/wiki/ManagementAndMonitoring
>

The above page is dated 21st July, 2008. Has there been any developments
with internal RabbitMQ traffic metrics/statistics since then beyond being
able to obtain a "snapshot" of queue behaviour at a given time from rabbit
itself?

-- 
Regards,

Anthony Hogan
System Administrator
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091120/346e4363/attachment.htm 

From gojko-yahoolist at gojko.com  Fri Nov 20 08:48:12 2009
From: gojko-yahoolist at gojko.com (Gojko Adzic)
Date: Fri, 20 Nov 2009 08:48:12 +0000
Subject: [rabbitmq-discuss] is it possible to have broker listen on
 multiple ports
In-Reply-To: <4B0588A2.9030704@echostar.com>
References: <4B0588A2.9030704@echostar.com>
Message-ID: <4B0657CC.5030305@gojko.com>

under linux, this can be trivially achieved by iptables port forwarding 
if the broker itself doesn't support it.

Mark Geib wrote:
> Sorry if this has be asked/answered but was not able to search the forum.
> 
> Is is possible to somehow configure a rabbitmq broker to listen on
> multiple network ports.
> 
> I am running 1.6 and 1.7.
> 
> Mark.
> 




From matthew at lshift.net  Fri Nov 20 12:24:27 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 20 Nov 2009 12:24:27 +0000
Subject: [rabbitmq-discuss] channel limits
In-Reply-To: <005f01ca6876$c76ba270$5642e750$@com>
References: <000001ca67c1$7d665d10$78331730$@com>
	<20091118131326.GC18309@mrnibble.lshift.net>
	<005f01ca6876$c76ba270$5642e750$@com>
Message-ID: <20091120122427.GB5083@mrnibble.lshift.net>

On Wed, Nov 18, 2009 at 09:44:28AM -0800, JD Conley wrote:
> > The channel number is a short in the AMQP spec, which means 16
> > bits, so 65535 is the maximum channel. It's likely you'll need to tune
> > Erlang slightly for this given the default number of processes is
> > 32768.
> > A +P 134217727 arg to erl should get round this for you.
> 
> Is this a limitation per RabbitMQ cluster then? Just trying to get a feel
> for how I need to architect the cluster and application code...

Each node in the cluster has a limit of the maximum number of erlang
processes. This number is set by the +P arg to erlang, and has a maximum
of 134217727. Each channel requires one process.

Each connection can potentially create up to 65535 channels. With the
process limit set to the maximum of 134217727, this suggests that you'll
be able to have around 2000 connections, each with 65535 channels, *per
node*. However, each connection takes several processes, as do queues
and so forth, so you're unlikely to be able to reach this - you'll run
out of processes earlier.

> Does RabbitMQ re-use old channel numbers?

Yes.

Matthew



From matthew at lshift.net  Fri Nov 20 12:53:09 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 20 Nov 2009 12:53:09 +0000
Subject: [rabbitmq-discuss] is it possible to have broker listen on
 multiple ports
In-Reply-To: <4B0588A2.9030704@echostar.com>
References: <4B0588A2.9030704@echostar.com>
Message-ID: <20091120125309.GC5083@mrnibble.lshift.net>

Hi Mark,

Staggeringly, this doesn't seem to be on our website, and the FAQ entry
is wrong. You want to alter the tcp_listeners argument to Rabbit.
Unfortunately, the ways of doing this are all pretty grim and I've
raised a bug internally for us to look at this and sort things out.
Ideally, you should be able to make an entry in
/etc/rabbitmq/rabbitmq.config so that the file looks a bit like:

[{rabbit, [{tcp_listeners, [{'10.224.189.156', 3333},
                            {'10.224.189.156', 3334}
                           ]
           }
          ]
 }
].

That will tell Rabbit to listen on ports 3333 and 3334 on the indicated
IP. You can use '0.0.0.0' to indicate all network interfaces. Don't
forget the quotes around the IP addresses, otherwise Rabbit will fail to
parse the configuration file.

However, sadly, Rabbit's start-up scripts override the configuration for
tcp_listeners. Thus, edit /usr/lib/rabbitmq/bin/rabbitmq-server. Towards
the bottom, you'll find a line:

    -rabbit tcp_listeners '[{"'${RABBITMQ_NODE_IP_ADDRESS}'", '${RABBITMQ_NODE_PORT}'}]' \

Just remove that line completely, and save the file. Then, when starting
rabbit, you should find entries in the logs indicating it has correctly
started listening on all the interfaces specified.

This will definitely work on 1.7. On 1.6, the configuration file didn't
exist, and whilst there are ways around, they're even more hairy, so I
would encourage you to stick with 1.7!

Matthew



From mark.geib at echostar.com  Fri Nov 20 13:14:45 2009
From: mark.geib at echostar.com (Mark Geib)
Date: Fri, 20 Nov 2009 06:14:45 -0700
Subject: [rabbitmq-discuss] is it possible to have broker listen on
 multiple ports
In-Reply-To: <20091120125309.GC5083@mrnibble.lshift.net>
References: <4B0588A2.9030704@echostar.com>
	<20091120125309.GC5083@mrnibble.lshift.net>
Message-ID: <4B069645.9080809@echostar.com>

Matthew,

Thanks for the reply. In a related issue I have found that the erlang
client, tagged for 1.6.0, does not support specifying the port for the
broker connection. This actually prompted the first question. In a new
application our IT wants to use a different port for the broker
connections, but I found it difficult to support in an erlang client.

I will plan to go with 1.7.0.

Mark.

Matthew Sackman wrote:
> Hi Mark,
> 
> Staggeringly, this doesn't seem to be on our website, and the FAQ entry
> is wrong. You want to alter the tcp_listeners argument to Rabbit.
> Unfortunately, the ways of doing this are all pretty grim and I've
> raised a bug internally for us to look at this and sort things out.
> Ideally, you should be able to make an entry in
> /etc/rabbitmq/rabbitmq.config so that the file looks a bit like:
> 
> [{rabbit, [{tcp_listeners, [{'10.224.189.156', 3333},
>                             {'10.224.189.156', 3334}
>                            ]
>            }
>           ]
>  }
> ].
> 
> That will tell Rabbit to listen on ports 3333 and 3334 on the indicated
> IP. You can use '0.0.0.0' to indicate all network interfaces. Don't
> forget the quotes around the IP addresses, otherwise Rabbit will fail to
> parse the configuration file.
> 
> However, sadly, Rabbit's start-up scripts override the configuration for
> tcp_listeners. Thus, edit /usr/lib/rabbitmq/bin/rabbitmq-server. Towards
> the bottom, you'll find a line:
> 
>     -rabbit tcp_listeners '[{"'${RABBITMQ_NODE_IP_ADDRESS}'", '${RABBITMQ_NODE_PORT}'}]' \
> 
> Just remove that line completely, and save the file. Then, when starting
> rabbit, you should find entries in the logs indicating it has correctly
> started listening on all the interfaces specified.
> 
> This will definitely work on 1.7. On 1.6, the configuration file didn't
> exist, and whilst there are ways around, they're even more hairy, so I
> would encourage you to stick with 1.7!
> 
> Matthew
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD



From mark.geib at echostar.com  Fri Nov 20 13:16:25 2009
From: mark.geib at echostar.com (Mark Geib)
Date: Fri, 20 Nov 2009 06:16:25 -0700
Subject: [rabbitmq-discuss] is it possible to have broker listen on
 multiple ports
In-Reply-To: <4B0657CC.5030305@gojko.com>
References: <4B0588A2.9030704@echostar.com> <4B0657CC.5030305@gojko.com>
Message-ID: <4B0696A9.4090507@echostar.com>

Yes, this is our current solution.
Thanks.

Gojko Adzic wrote:
> under linux, this can be trivially achieved by iptables port forwarding 
> if the broker itself doesn't support it.
> 
> Mark Geib wrote:
>> Sorry if this has be asked/answered but was not able to search the forum.
>>
>> Is is possible to somehow configure a rabbitmq broker to listen on
>> multiple network ports.
>>
>> I am running 1.6 and 1.7.
>>
>> Mark.
>>
> 
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 

-- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD



From matthew at lshift.net  Fri Nov 20 13:25:38 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 20 Nov 2009 13:25:38 +0000
Subject: [rabbitmq-discuss] Reliable way to get number of messages in a
 queue
In-Reply-To: <407fa4640911190808s407ccdc6vef08563f50f2367f@mail.gmail.com>
References: <476587320910230941p3cfb8cc8w237c71c0027fff8c@mail.gmail.com>
	<20091023171754.GA6672@mrnibble.lshift.net>
	<476587320910231059h1306a7afy71bbfb5f9b3a7b60@mail.gmail.com>
	<4AE21B80.7080607@lshift.net>
	<407fa4640911180858yfa503a4o7eb6211d21e447b8@mail.gmail.com>
	<20091118171853.GB27828@mrnibble.lshift.net>
	<20091118175206.GD27828@mrnibble.lshift.net>
	<407fa4640911181010o27d298bbl1abb2025e7197ac3@mail.gmail.com>
	<407fa4640911190808s407ccdc6vef08563f50f2367f@mail.gmail.com>
Message-ID: <20091120132538.GD5083@mrnibble.lshift.net>

Hi Michael,

On Thu, Nov 19, 2009 at 04:08:52PM +0000, Michael Nacos wrote:
> I have changed our polling strategy to read the message count from
> queue.declare, it makes more sense, obviously. I am using the Erlang client
> for the polling process. Previous answers such as 'not supported by the
> protocol' had put me in a 'dirty'-solution mindset, which explains the
> initial polling strategy (I used the first thing I had seen which gave me
> that sort of information).

That's fair enough. The erlang client has got a lot better in recent
months and is continuing to improve. It is our next target to move into
a fully supported client mode, but there's still some work to do to get
it to that stage.

> The problem, as you have guessed already, is the number we really want is
> messages_unacknowledged. The number I get from the message count is
> messages_ready. I have been trying to make a producer process self-regulate
> its firing rate in case the consumers are not keeping up (to avoid ram
> exhaustion until the new persister comes along -- sorry Matthew :-)

Heh, that's fine - the persister is entering QA and code review stages
now so progress is being made, but as ever, no ETA!

Right, I would suggest that what you do is in the consumers, set QoS to
1. That way consumers won't get flooded with messages and will only get
new messages when they ack the previous one. As a result, if the
messages_ready count on the queue > 0, then the number of consumers is
equal to the number of unacked messages.

> Our Java consumers re-use their channels and consume messages 'by
> subscription' (it's obviously a better approach) without disconnecting at
> any point while the system is running. When even a single consumer connects
> to the queue in question (it's a multiple consumers for a single queue
> round-robin scenario) in this mode, all 'ready' messages become
> 'unacknowledged' messages, even though there is no way our Java threads have
> processed them this fast (do the messages go into an internal Java client
> buffer perhaps? or is this more of a responsibility transfer case?

Yeah, without QoS set, they all will get sent down to consumers who will
buffer them.

> ). So our
> polling process constantly gets zero (messages_ready), unless all consumers
> disconnect, in which case messages_ready shoots up to whatever
> messages_unacknowledged is when this happens. Is this what you would expect?

Yup. QoS is your friend here ;)

> For our purposes, anything less than an ack means our consumers are not
> keeping up, so we have enforced a qos setting of 1 for each consumer. This
> way, the message_ready value returned to the polling process will, of
> course, be off by a few messages each time but, at least, its order of
> magnitude indicates if our consumers are keeping up.

Yes, that's the right thing to do. Some other users do something very
similar - set QoS to 1 and then if the messages_ready count is non zero,
start up a new consumer process, thus allowing you to grow your
parallelism on the consuming side dynamically with load, which is fairly
neat. I'm not sure whether you're able to do that - I get the impression
that you have a static number of consumers and are trying to throttle at
the producers.

One other idea you could play with is to set the
system_memory_high_watermark configuration value (see the bottom of
http://www.rabbitmq.com/extensions.html) to a very low value, and then
as soon as there's any buildup in Rabbit, it'll raise the channel.flow
flag to the producers, thus stopping them from sending anything in. This
may be sufficient, but it depends somewhat on your platform, resources
etc. Might be worth investigating though.

Matthew



From matthew at lshift.net  Fri Nov 20 13:49:26 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 20 Nov 2009 13:49:26 +0000
Subject: [rabbitmq-discuss] 2 nodes, 4k queues
In-Reply-To: <4B04F35C.2050103@gojko.com>
References: <4B04F35C.2050103@gojko.com>
Message-ID: <20091120134926.GE5083@mrnibble.lshift.net>

Hi Gojko,

On Thu, Nov 19, 2009 at 07:27:24AM +0000, Gojko Adzic wrote:
> We had a case of a 2 nodes cluster where message delivery latency was
> unacceptably slow (~ 1-2 min) when the number of queues rose above 4k.
> All the messages were going out to a single topic exchange, average
> message size is 5KB, the number of messages was not more than 10/s and
> most of the messages matched 3-4 queues. We're using topic matching
> between exchange and queues. RabbitMQ was running at about 20-30% CPU on
> large EC2 instances, and about 9% memory, so there doesn't seem to be a
> memory or CPU bottleneck on the machines. Is this kind of performance
> expected (and if it is, how many queues per node would you suggest), or 
> have we hit a configuration problem? Any ideas on monitoring/measuring 
> what starts slowing down processing when the number
> of queues goes up.

Yeah, our topic matching is inefficient - it's O(n) where n is the
number of bindings. We do have a bug open to improve this. You didn't
mention the number of bindings that you have, but if you're up to 20k
bindings or so then I wouldn't be surprised if this is the performance
you're getting. In general, until we fix this bug (it should become
O(log?(n)) because really it should just be walking a tree), we'd
probably recommend to use a direct or fanout exchange and then drop
inappropriate messages in the consumer. I know this isn't ideal, but it
might solve the problems you're seeing.

Wrt CPU load, the matching of routing keys against bindings is not
parallelised - thus you can burn a max of 1 CPU for each channel doing
the publish. So if you only have 1 publisher and several CPUs then you
will only really be able to make work for 1 CPU. The situation should be
better if you have many channels or connections and are publishing in
parallel, but there may be something else I've forgotten that limits
this case. What is your topology on the publishing side?

Matthew



From matthew at lshift.net  Fri Nov 20 14:05:46 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 20 Nov 2009 14:05:46 +0000
Subject: [rabbitmq-discuss] Monitoring RabbitMQ - is it possible to
 extract IO stats from exchanges?
In-Reply-To: <1bf8be120911192224mcc4fd20r17855677133991e8@mail.gmail.com>
References: <1bf8be120911161954u49a82ccbh1f7b47e12e49a861@mail.gmail.com>
	<1bf8be120911192224mcc4fd20r17855677133991e8@mail.gmail.com>
Message-ID: <20091120140546.GA28602@mrnibble.lshift.net>

Hi Anthony,

Everything you wrote makes sense and are perfectly reasonable things to
want to monitor. Monitoring, measuring and management of RabbitMQ is a
large topic and I'm afraid at the moment is still very much a whiteboard
topic - we're still thinking about different ways of doing this and
exactly what we should be measuring. As a result, beyond rabbitmqctl,
there's not really much that's available to you right now.

As usual with us, it's the case that we are aware of the issues and have
been thinking about them, but have a few higher priority items to deal
with first, and unless someone's going to pay us to reorder our todo
list, it's not something that's just around the corner. That said, we
are very aware that a comprehensive solution to monitoring and
management is necessary, and it will be forthcoming, eventually!

Sorry I can't give you better news.

Matthew



From alexis.richardson at gmail.com  Fri Nov 20 14:23:19 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 20 Nov 2009 14:23:19 +0000
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <-4919060389016830964@unknownmsgid>
References: <20091115112229.GA17316@wellquite.org>
	<-4919060389016830964@unknownmsgid>
Message-ID: <167204d20911200623i45b9e8ddr32818b407acd7897@mail.gmail.com>

Lynton

Any luck?

alexis


On Sun, Nov 15, 2009 at 3:01 PM, Lynton Grice
<lynton.grice at logosworld.com> wrote:
> Hi Matthew,
>
> Thanks for the response, much appreciated.
>
> I have tried exactly what you suggested below and I still get this error:
>
> C:\soabox\erlang\rabbitmq-public-umbrella_just_compiled\rabbitmq-server\scri
> pts>rabbitmq-server.bat
> Using Custom Boot File
> "C:\soabox\erlang\rabbitmq-public-umbrella_just_compiled\rabbitmq-server\scr
> ipts\..\ebin\rabbit.boot"
> and was unexpected at this time.
>
> This version incompatibility is very frustrating ;-( It makes me wonder how
> many people out there have actually got BQL even running? I have following
> the install guide / plugin guide perfectly and tried now numerous times, and
> still no luck...
>
> My exact setup is the latest "Rabbit_Umbrella" and I have downloaded the BQL
> you suggested (ff24a539e6a1) and am using Rabbit Server 1.7.0.
>
> Any other possibilities? All I want is to get BQL running ;-)
>
> Chat later
>
> Lynton
>
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew
> Sackman
> Sent: 15 November 2009 01:23 PM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Broker Query Language (BQL) crashing
>
> Hi Lynton,
>
> On Sat, Nov 14, 2009 at 12:44:10PM +0200, Lynton Grice wrote:
>> I then activated the plugins....and have RabbitMQ started now in the
> command
>> prompt (not a windows service), and the moment I try do a simple select
>> statement I get a dump...
>>
>> Any idea what this could be? Some version issue or something?
>
> *Sigh*. Yes, it's a version issue. You need to be using a version of BQL
> that matches the server v1.7.0 because they share source. Sadly, and
> this is not your fault at all, there are no tagged versions for the BQL
> so you have very little guidance as to which version to use. The only
> thing I can suggest is to work by date:
> http://hg.rabbitmq.com/rabbitmq-bql/ shows that there have been commits
> very recently which will be based on code going into 1.7.1 which is why
> it won't work with 1.7.0. According to
> http://www.rabbitmq.com/news.html#2009-10-07T00:00:00Z 1.7.0 was
> released 7th October. Revision ff24a539e6a1 of the bql looks most
> appropriate then as it's both on default branch and happened just before
> the release. I would expect that to work.
>
> Other than that, if you're using the experimental downloads then really
> the only thing that we would expect to work is the head of the default
> branch of the experimental downloads with the head of the default branch
> of the server.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthew at lshift.net  Fri Nov 20 14:34:53 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 20 Nov 2009 14:34:53 +0000
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <000801ca6604$91b6d060$b5247120$@grice@logosworld.com>
References: <000e01ca6517$6a90ad00$3fb20700$@grice@logosworld.com>
	<20091115112229.GA17316@wellquite.org>
	<000801ca6604$91b6d060$b5247120$@grice@logosworld.com>
Message-ID: <20091120143453.GA1118@mrnibble.lshift.net>

Hi Lynton,

Sorry for the delay in getting back to you.

On Sun, Nov 15, 2009 at 05:01:46PM +0200, Lynton Grice wrote:
> 
> I have tried exactly what you suggested below and I still get this error:
> 
> C:\soabox\erlang\rabbitmq-public-umbrella_just_compiled\rabbitmq-server\scri
> pts>rabbitmq-server.bat
> Using Custom Boot File
> "C:\soabox\erlang\rabbitmq-public-umbrella_just_compiled\rabbitmq-server\scr
> ipts\..\ebin\rabbit.boot"
> and was unexpected at this time.

Right, that, it turns out, was an issue with quoting paths under Windows
which exists in 1.7.0 and has since been fixed. Thus rabbitmq-server
default branch no longer has this bug.

> This version incompatibility is very frustrating ;-( It makes me wonder how
> many people out there have actually got BQL even running?

Under Windows? I suspect you may be the first!

> Any other possibilities? All I want is to get BQL running ;-)

Right, I have fixed the bug on the BQL plugin. Unfortunately it has yet
to be QA'd and so it's not on the default branch. At this point, because
of the above bug, the only possible solution under Windows is to run the
default branch of rabbitmq-server and the bab71e658da2 revision of BQL.
I believe that *should* work under Windows. I'm afraid that for reasons
of sanity, none of us develop here under Windows which explains,
although does not excuse, how these problems arose.

Please let us know how you get on.

Matthew



From lynton.grice at logosworld.com  Fri Nov 20 14:48:17 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Fri, 20 Nov 2009 16:48:17 +0200
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <167204d20911200623i45b9e8ddr32818b407acd7897@mail.gmail.com>
References: <20091115112229.GA17316@wellquite.org>	
	<-4919060389016830964@unknownmsgid>
	<167204d20911200623i45b9e8ddr32818b407acd7897@mail.gmail.com>
Message-ID: <000901ca69f0$85483590$8fd8a0b0$@grice@logosworld.com>

Hi there,

Still no luck, the version issue amongst the different components is not
happy I think...

I have tried numerous times with different combinations and still no luck
;-(

Lynton

-----Original Message-----
From: Alexis Richardson [mailto:alexis.richardson at gmail.com] 
Sent: 20 November 2009 04:23 PM
To: Lynton Grice
Cc: Matthew Sackman; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Broker Query Language (BQL) crashing

Lynton

Any luck?

alexis


On Sun, Nov 15, 2009 at 3:01 PM, Lynton Grice
<lynton.grice at logosworld.com> wrote:
> Hi Matthew,
>
> Thanks for the response, much appreciated.
>
> I have tried exactly what you suggested below and I still get this error:
>
>
C:\soabox\erlang\rabbitmq-public-umbrella_just_compiled\rabbitmq-server\scri
> pts>rabbitmq-server.bat
> Using Custom Boot File
>
"C:\soabox\erlang\rabbitmq-public-umbrella_just_compiled\rabbitmq-server\scr
> ipts\..\ebin\rabbit.boot"
> and was unexpected at this time.
>
> This version incompatibility is very frustrating ;-( It makes me wonder
how
> many people out there have actually got BQL even running? I have following
> the install guide / plugin guide perfectly and tried now numerous times,
and
> still no luck...
>
> My exact setup is the latest "Rabbit_Umbrella" and I have downloaded the
BQL
> you suggested (ff24a539e6a1) and am using Rabbit Server 1.7.0.
>
> Any other possibilities? All I want is to get BQL running ;-)
>
> Chat later
>
> Lynton
>
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew
> Sackman
> Sent: 15 November 2009 01:23 PM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Broker Query Language (BQL) crashing
>
> Hi Lynton,
>
> On Sat, Nov 14, 2009 at 12:44:10PM +0200, Lynton Grice wrote:
>> I then activated the plugins....and have RabbitMQ started now in the
> command
>> prompt (not a windows service), and the moment I try do a simple select
>> statement I get a dump...
>>
>> Any idea what this could be? Some version issue or something?
>
> *Sigh*. Yes, it's a version issue. You need to be using a version of BQL
> that matches the server v1.7.0 because they share source. Sadly, and
> this is not your fault at all, there are no tagged versions for the BQL
> so you have very little guidance as to which version to use. The only
> thing I can suggest is to work by date:
> http://hg.rabbitmq.com/rabbitmq-bql/ shows that there have been commits
> very recently which will be based on code going into 1.7.1 which is why
> it won't work with 1.7.0. According to
> http://www.rabbitmq.com/news.html#2009-10-07T00:00:00Z 1.7.0 was
> released 7th October. Revision ff24a539e6a1 of the bql looks most
> appropriate then as it's both on default branch and happened just before
> the release. I would expect that to work.
>
> Other than that, if you're using the experimental downloads then really
> the only thing that we would expect to work is the head of the default
> branch of the experimental downloads with the head of the default branch
> of the server.
>
> Matthew
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>




From lynton.grice at logosworld.com  Fri Nov 20 14:51:25 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Fri, 20 Nov 2009 16:51:25 +0200
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <20091120143453.GA1118@mrnibble.lshift.net>
References: <000e01ca6517$6a90ad00$3fb20700$@grice@logosworld.com>
	<20091115112229.GA17316@wellquite.org>
	<000801ca6604$91b6d060$b5247120$@grice@logosworld.com>
	<20091120143453.GA1118@mrnibble.lshift.net>
Message-ID: <000a01ca69f0$f385cc20$da916460$@grice@logosworld.com>

Hi Matthew,

Many thanks for the response below, I will most certainly give it a try and
will let you know soon.

Windows sucks but unfortunately I have to use it for now ;-)

Chat later 
Lynton

-----Original Message-----
From: Matthew Sackman [mailto:matthew at lshift.net] 
Sent: 20 November 2009 04:35 PM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Broker Query Language (BQL) crashing

Hi Lynton,

Sorry for the delay in getting back to you.

On Sun, Nov 15, 2009 at 05:01:46PM +0200, Lynton Grice wrote:
> 
> I have tried exactly what you suggested below and I still get this error:
> 
>
C:\soabox\erlang\rabbitmq-public-umbrella_just_compiled\rabbitmq-server\scri
> pts>rabbitmq-server.bat
> Using Custom Boot File
>
"C:\soabox\erlang\rabbitmq-public-umbrella_just_compiled\rabbitmq-server\scr
> ipts\..\ebin\rabbit.boot"
> and was unexpected at this time.

Right, that, it turns out, was an issue with quoting paths under Windows
which exists in 1.7.0 and has since been fixed. Thus rabbitmq-server
default branch no longer has this bug.

> This version incompatibility is very frustrating ;-( It makes me wonder
how
> many people out there have actually got BQL even running?

Under Windows? I suspect you may be the first!

> Any other possibilities? All I want is to get BQL running ;-)

Right, I have fixed the bug on the BQL plugin. Unfortunately it has yet
to be QA'd and so it's not on the default branch. At this point, because
of the above bug, the only possible solution under Windows is to run the
default branch of rabbitmq-server and the bab71e658da2 revision of BQL.
I believe that *should* work under Windows. I'm afraid that for reasons
of sanity, none of us develop here under Windows which explains,
although does not excuse, how these problems arose.

Please let us know how you get on.

Matthew




From gojko-yahoolist at gojko.com  Fri Nov 20 15:08:23 2009
From: gojko-yahoolist at gojko.com (Gojko Adzic)
Date: Fri, 20 Nov 2009 15:08:23 +0000
Subject: [rabbitmq-discuss] 2 nodes, 4k queues
In-Reply-To: <20091120134926.GE5083@mrnibble.lshift.net>
References: <4B04F35C.2050103@gojko.com>
	<20091120134926.GE5083@mrnibble.lshift.net>
Message-ID: <4B06B0E7.2020001@gojko.com>

> inappropriate messages in the consumer. I know this isn't ideal, but it
> might solve the problems you're seeing.

direct or fanout is not an option as we'd burn the bandwidth. is header 
matching more efficient(we can do the same with header matching)? we 
have ~4 bindings per queue.

> this case. What is your topology on the publishing side?

10-20 publishers running in parallel.

gojko



From lynton.grice at logosworld.com  Fri Nov 20 15:17:40 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Fri, 20 Nov 2009 17:17:40 +0200
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <20091120143453.GA1118@mrnibble.lshift.net>
References: <000e01ca6517$6a90ad00$3fb20700$@grice@logosworld.com>
	<20091115112229.GA17316@wellquite.org>
	<000801ca6604$91b6d060$b5247120$@grice@logosworld.com>
	<20091120143453.GA1118@mrnibble.lshift.net>
Message-ID: <001001ca69f4$9e52e590$daf8b0b0$@grice@logosworld.com>

Hi Matthew,

I just tried you exact recommendations below using the latest default branch
of the server and the version of the BQL you specified, then I created the
EZ files etc (actually put the new versions of the server and BQL you
specified over the one in e FRESH "rabbit umbrella" download).....so that
was my exact config on Windows.

I followed the exact instructions again to install the BQL stuff, activated
the plugins and restarted the server and I still get an error ;-(

C:\soabox\erlang\rabbitmq-public-umbrella\rabbitmq-server\priv\plugins\rabbi
tmq-bql\scripts>bql.bat
BQL> select * from exchanges
{"init terminating in do_boot",{badarg,[{io,format,[<0.29.0>,"BQL execution
failed:~n
~s~n",[{undef,[{rabbit_misc,localnode,[rabbit]},{bql_applicator,appl
y_commands,2},{bql_server,handle_message,1},{bql_server,handle_call,3},{gen_
server,handle_msg,5},{proc_lib,init_p_do_apply,3}]}]]},{bql_client,run_comma
nd,
0},{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init
,start_em,1}]}}

Any ideas?

Lynton



-----Original Message-----
From: Matthew Sackman [mailto:matthew at lshift.net] 
Sent: 20 November 2009 04:35 PM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Broker Query Language (BQL) crashing

Hi Lynton,

Sorry for the delay in getting back to you.

On Sun, Nov 15, 2009 at 05:01:46PM +0200, Lynton Grice wrote:
> 
> I have tried exactly what you suggested below and I still get this error:
> 
>
C:\soabox\erlang\rabbitmq-public-umbrella_just_compiled\rabbitmq-server\scri
> pts>rabbitmq-server.bat
> Using Custom Boot File
>
"C:\soabox\erlang\rabbitmq-public-umbrella_just_compiled\rabbitmq-server\scr
> ipts\..\ebin\rabbit.boot"
> and was unexpected at this time.

Right, that, it turns out, was an issue with quoting paths under Windows
which exists in 1.7.0 and has since been fixed. Thus rabbitmq-server
default branch no longer has this bug.

> This version incompatibility is very frustrating ;-( It makes me wonder
how
> many people out there have actually got BQL even running?

Under Windows? I suspect you may be the first!

> Any other possibilities? All I want is to get BQL running ;-)

Right, I have fixed the bug on the BQL plugin. Unfortunately it has yet
to be QA'd and so it's not on the default branch. At this point, because
of the above bug, the only possible solution under Windows is to run the
default branch of rabbitmq-server and the bab71e658da2 revision of BQL.
I believe that *should* work under Windows. I'm afraid that for reasons
of sanity, none of us develop here under Windows which explains,
although does not excuse, how these problems arose.

Please let us know how you get on.

Matthew




From matthew at lshift.net  Fri Nov 20 15:19:08 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 20 Nov 2009 15:19:08 +0000
Subject: [rabbitmq-discuss] 2 nodes, 4k queues
In-Reply-To: <4B06B0E7.2020001@gojko.com>
References: <4B04F35C.2050103@gojko.com>
	<20091120134926.GE5083@mrnibble.lshift.net>
	<4B06B0E7.2020001@gojko.com>
Message-ID: <20091120151908.GB1118@mrnibble.lshift.net>

On Fri, Nov 20, 2009 at 03:08:23PM +0000, Gojko Adzic wrote:
> > inappropriate messages in the consumer. I know this isn't ideal, but it
> > might solve the problems you're seeing.
> 
> direct or fanout is not an option as we'd burn the bandwidth. is header 
> matching more efficient(we can do the same with header matching)? we 
> have ~4 bindings per queue.

Header matching is at least as bad, if not worse. We're only talking 16k
bindings though, I'm wondering what is the bottleneck. Are these
messages persistent and being written to disk at all? Do the queues get
particularly long or stay pretty much empty?

> > this case. What is your topology on the publishing side?
> 10-20 publishers running in parallel.

Hmm. I'll do some testing, but I'm wondering whether something else is
going on here...

Matthew



From matthew at lshift.net  Fri Nov 20 15:21:33 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 20 Nov 2009 15:21:33 +0000
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <001001ca69f4$9e52e590$daf8b0b0$@grice@logosworld.com>
References: <000e01ca6517$6a90ad00$3fb20700$@grice@logosworld.com>
	<20091115112229.GA17316@wellquite.org>
	<000801ca6604$91b6d060$b5247120$@grice@logosworld.com>
	<20091120143453.GA1118@mrnibble.lshift.net>
	<001001ca69f4$9e52e590$daf8b0b0$@grice@logosworld.com>
Message-ID: <20091120152133.GC1118@mrnibble.lshift.net>

On Fri, Nov 20, 2009 at 05:17:40PM +0200, Lynton Grice wrote:
> C:\soabox\erlang\rabbitmq-public-umbrella\rabbitmq-server\priv\plugins\rabbi
> tmq-bql\scripts>bql.bat
> BQL> select * from exchanges
> {"init terminating in do_boot",{badarg,[{io,format,[<0.29.0>,"BQL execution
> failed:~n
> ~s~n",[{undef,[{rabbit_misc,localnode,[rabbit]},{bql_applicator,appl
> y_commands,2},{bql_server,handle_message,1},{bql_server,handle_call,3},{gen_
> server,handle_msg,5},{proc_lib,init_p_do_apply,3}]}]]},{bql_client,run_comma
> nd,
> 0},{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init
> ,start_em,1}]}}

Yeah, if you've updated to the right revision of bql - bab71e658da2 -
then it looks like the build process has gone wrong - in the
rabbitmq-bql directory, do a make clean and then a make. There should be
no calls to rabbit_misc:localnode at all.

Matthew



From lynton.grice at logosworld.com  Fri Nov 20 15:30:40 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Fri, 20 Nov 2009 17:30:40 +0200
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <20091120152133.GC1118@mrnibble.lshift.net>
References: <000e01ca6517$6a90ad00$3fb20700$@grice@logosworld.com>	<20091115112229.GA17316@wellquite.org>	<000801ca6604$91b6d060$b5247120$@grice@logosworld.com>	<20091120143453.GA1118@mrnibble.lshift.net>	<001001ca69f4$9e52e590$daf8b0b0$@grice@logosworld.com>
	<20091120152133.GC1118@mrnibble.lshift.net>
Message-ID: <001401ca69f6$6f174df0$4d45e9d0$@grice@logosworld.com>

Hi there,

I ran make clean and then make in the BQL folder....all seemed to compile
100%.

I then copied the new EZ files into the plugins folder of the server (after
deactivating the current plugins)...
I then activated the plugins and started up the server again....same error.

I will start a FRESH install of this a little later ;-) Any other ideas?

C:\soabox\erlang\rabbitmq-public-umbrella\rabbitmq-server\priv\plugins\rabbi
tmq-bql\scripts>bql.bat
BQL> select * from exchanges
{"init terminating in do_boot",{badarg,[{io,format,[<0.29.0>,"BQL execution
failed:~n
~s~n",[{undef,[{rabbit_misc,localnode,[rabbit]},{bql_applicator,appl
y_commands,2},{bql_server,handle_message,1},{bql_server,handle_call,3},{gen_
server,handle_msg,5},{proc_lib,init_p_do_apply,3}]}]]},{bql_client,run_comma
nd,
0},{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init
,start_em,1}]}}

-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Matthew
Sackman
Sent: 20 November 2009 05:22 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Broker Query Language (BQL) crashing

On Fri, Nov 20, 2009 at 05:17:40PM +0200, Lynton Grice wrote:
>
C:\soabox\erlang\rabbitmq-public-umbrella\rabbitmq-server\priv\plugins\rabbi
> tmq-bql\scripts>bql.bat
> BQL> select * from exchanges
> {"init terminating in do_boot",{badarg,[{io,format,[<0.29.0>,"BQL
execution
> failed:~n
> ~s~n",[{undef,[{rabbit_misc,localnode,[rabbit]},{bql_applicator,appl
>
y_commands,2},{bql_server,handle_message,1},{bql_server,handle_call,3},{gen_
>
server,handle_msg,5},{proc_lib,init_p_do_apply,3}]}]]},{bql_client,run_comma
> nd,
>
0},{bql_client,execute_shell,0},{bql_client,start,0},{init,start_it,1},{init
> ,start_em,1}]}}

Yeah, if you've updated to the right revision of bql - bab71e658da2 -
then it looks like the build process has gone wrong - in the
rabbitmq-bql directory, do a make clean and then a make. There should be
no calls to rabbit_misc:localnode at all.

Matthew

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From matthew at lshift.net  Fri Nov 20 15:42:25 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 20 Nov 2009 15:42:25 +0000
Subject: [rabbitmq-discuss] Broker Query Language (BQL) crashing
In-Reply-To: <001401ca69f6$6f174df0$4d45e9d0$@grice@logosworld.com>
References: <000e01ca6517$6a90ad00$3fb20700$@grice@logosworld.com>
	<20091115112229.GA17316@wellquite.org>
	<000801ca6604$91b6d060$b5247120$@grice@logosworld.com>
	<20091120143453.GA1118@mrnibble.lshift.net>
	<001001ca69f4$9e52e590$daf8b0b0$@grice@logosworld.com>
	<20091120152133.GC1118@mrnibble.lshift.net>
	<001401ca69f6$6f174df0$4d45e9d0$@grice@logosworld.com>
Message-ID: <20091120154225.GD1118@mrnibble.lshift.net>

Hi,

Ok, sorry, but I'm convinced you're doing something wrong:

matthew at mrnibble:.../rabbitmq-public-umbrella$ rm -rf rabbitmq-bql/
matthew at mrnibble:.../rabbitmq-public-umbrella$ hg clone http://hg.rabbitmq.com/rabbitmq-bql/
destination directory: rabbitmq-bql
requesting all changes
adding changesets
adding manifests
adding file changes
added 62 changesets with 175 changes to 35 files
updating to branch default
30 files updated, 0 files merged, 0 files removed, 0 files unresolved
matthew at mrnibble:.../rabbitmq-public-umbrella$ cd rabbitmq-bql/
matthew at mrnibble:.../rabbitmq-public-umbrella/rabbitmq-bql$ grep rabbit_misc:localnode src/*.erl
src/bql_applicator.erl:    Node = rabbit_misc:localnode(rabbit),
matthew at mrnibble:.../rabbitmq-public-umbrella/rabbitmq-bql$ hg up bab71e658da2
5 files updated, 0 files merged, 0 files removed, 0 files unresolved
matthew at mrnibble:.../rabbitmq-public-umbrella/rabbitmq-bql$ grep rabbit_misc:localnode src/*.erl
matthew at mrnibble:.../rabbitmq-public-umbrella/rabbitmq-bql$ 

Are you rerunning activate-plugins after compiling? My usual process is
1) compile the plugin
2) make the symlinks from the plugins dir in rabbitmq-server
3) activate-plugins

If you're using the make package, I wonder if either a) it's not
rebuilding it correctly, or b) the activate-plugins may unpack it
somewhere and may not be overwriting with the updated version. I would
suggest make clean in the server, and nuke out anything in the plugins
directory.

Matthew



From alexis.richardson at gmail.com  Fri Nov 20 18:19:22 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 20 Nov 2009 18:19:22 +0000
Subject: [rabbitmq-discuss] What are the System Requirements?
In-Reply-To: <26411888.post@talk.nabble.com>
References: <26411888.post@talk.nabble.com>
Message-ID: <167204d20911201019y418ce3f9j28faaa42d601d138@mail.gmail.com>

Chris

You should be ok with one COTS server in most cases.  Throughput is
good enough for that, in both transient and persistent scenarios.

For example, many of our customers use 2Gb of RAM and at least the
same amount of disk.  But an 8Gb server and say 10Gb of disk is also
common.  Note that the RAM and disk consumption are almost the same
here.  This is because you don't really want your O/S to be using
memory/disk swap.  With the future 'page to disk' feature, RabbitMQ
will manage its own swap so that much larger data sets on disk can and
will make sense.

The install itself is quite small.

If you want HA then you will want at least two servers and shared
storage eg RAID.

Does this answer your question?

alexis





On Wed, Nov 18, 2009 at 6:35 PM, cpeele00 <chris.peele at mclaneat.com> wrote:
>
>
> Good morning,
>
> Would someone please be able to provide me with the minimum System
> Requirements for Rabbit MQ? (i.e. Ram, hard-drive space, etc?)?
>
> I am trying to justify using it to our client and need to provide them with
> this information and I wasn?t able to locate it on your site.
>
> Thanks very much for your assistance.
>
> V/R
>
>
>
> --
> View this message in context: http://old.nabble.com/What-are-the-System-Requirements--tp26411888p26411888.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From jdc at hive7.com  Fri Nov 20 22:05:24 2009
From: jdc at hive7.com (JD Conley)
Date: Fri, 20 Nov 2009 14:05:24 -0800
Subject: [rabbitmq-discuss] 2 nodes, 4k queues
In-Reply-To: <20091120134926.GE5083@mrnibble.lshift.net>
References: <4B04F35C.2050103@gojko.com>
	<20091120134926.GE5083@mrnibble.lshift.net>
Message-ID: <00e601ca6a2d$902a3c00$b07eb400$@com>

> Yeah, our topic matching is inefficient - it's O(n) where n is the
> number of bindings. We do have a bug open to improve this. You didn't
> mention the number of bindings that you have, but if you're up to 20k
> bindings or so then I wouldn't be surprised if this is the performance
> you're getting. In general, until we fix this bug (it should become
> O(log?(n)) because really it should just be walking a tree), we'd
> probably recommend to use a direct or fanout exchange and then drop
> inappropriate messages in the consumer. I know this isn't ideal, but it
> might solve the problems you're seeing.

Is it O(n) relative to the number of bindings per exchange, or per server node, or per cluster? I'm researching the overhead of a lot of bindings as well... Does the lookup overhead increase in a cluster, or is the 'route table' replicated to all nodes so it's always an in-memory lookup?

-JD





From scott.brooks at epicadvertising.com  Fri Nov 20 22:03:19 2009
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Fri, 20 Nov 2009 16:03:19 -0600
Subject: [rabbitmq-discuss] rabbit-erlang-client heartbeats
Message-ID: <4EB4C344-78DF-4F46-8C85-2ED018648B41@epicadvertising.com>

I can't seem to find a way to specify a heartbeat setting with the rabbit-erlang-client.

I was looking at adding it, but wasn't sure if it's ok to modify the amqp_params record or not.

Scott


From alexis.richardson at gmail.com  Fri Nov 20 22:24:19 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 20 Nov 2009 22:24:19 +0000
Subject: [rabbitmq-discuss] 2 nodes, 4k queues
In-Reply-To: <00e601ca6a2d$902a3c00$b07eb400$@com>
References: <4B04F35C.2050103@gojko.com>
	<20091120134926.GE5083@mrnibble.lshift.net>
	<00e601ca6a2d$902a3c00$b07eb400$@com>
Message-ID: <167204d20911201424g6acb5679kf8d765b83856e2da@mail.gmail.com>

On Fri, Nov 20, 2009 at 10:05 PM, JD Conley <jdc at hive7.com> wrote:
>> Yeah, our topic matching is inefficient - it's O(n) where n is the
>> number of bindings. We do have a bug open to improve this. You didn't
>> mention the number of bindings that you have, but if you're up to 20k
>> bindings or so then I wouldn't be surprised if this is the performance
>> you're getting. In general, until we fix this bug (it should become
>> O(log?(n)) because really it should just be walking a tree), we'd
>> probably recommend to use a direct or fanout exchange and then drop
>> inappropriate messages in the consumer. I know this isn't ideal, but it
>> might solve the problems you're seeing.
>
> Is it O(n) relative to the number of bindings per exchange, or per server node, or per cluster? I'm researching the overhead of a lot of bindings as well... Does the lookup overhead increase in a cluster, or is the 'route table' replicated to all nodes so it's always an in-memory lookup?

An exchange routing table is shared across nodes in a cluster.  This
is achieved by replication across all nodes in the cluster.  Lookup is
therefore in-memory and takes O(n) where n the number of bindings in
that exchange.

alexis





> -JD
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From alexis.richardson at gmail.com  Fri Nov 20 22:25:23 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 20 Nov 2009 22:25:23 +0000
Subject: [rabbitmq-discuss] 2 nodes, 4k queues
In-Reply-To: <167204d20911201424g6acb5679kf8d765b83856e2da@mail.gmail.com>
References: <4B04F35C.2050103@gojko.com>
	<20091120134926.GE5083@mrnibble.lshift.net>
	<00e601ca6a2d$902a3c00$b07eb400$@com>
	<167204d20911201424g6acb5679kf8d765b83856e2da@mail.gmail.com>
Message-ID: <167204d20911201425yceedafcka4f02217a29420d3@mail.gmail.com>

One more thing...

On Fri, Nov 20, 2009 at 10:24 PM, Alexis Richardson
<alexis.richardson at gmail.com> wrote:
>>
>> Is it O(n) relative to the number of bindings per exchange, or per server node, or per cluster? I'm researching the overhead of a lot of bindings as well... Does the lookup overhead increase in a cluster, or is the 'route table' replicated to all nodes so it's always an in-memory lookup?
>
> An exchange routing table is shared across nodes in a cluster. ?This
> is achieved by replication across all nodes in the cluster. ?Lookup is
> therefore in-memory and takes O(n) where n the number of bindings in
> that exchange.

To be clear, O(n) is for *topic* exchanges in the *current* implementation.





> alexis
>
>
>
>
>
>> -JD
>>
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>



From michael.justin at gmx.net  Sat Nov 21 09:01:05 2009
From: michael.justin at gmx.net (mjustin)
Date: Sat, 21 Nov 2009 01:01:05 -0800 (PST)
Subject: [rabbitmq-discuss]  Compiling under Windows Vista
Message-ID: <26454283.post@talk.nabble.com>


Hello,

this is my first try to compile RabbitMQ on Windows 7. It looks like I need
some additional software and maybe making some mistakes.

I used Mercurial to download rabbitmq-public-umbrella, rabbitmq-server and
rabbitmq-stomp (in subdirectories of umbrella). I have also installed the
Python kit which is included in the Windows distribution of RabbitMQ, and
GNU make.

The output contains some error messages:

* cut: this command can not be found
* [ seems to be an invalid command
* make says there is no rule to build target ?codegen/amqp_codegen.py

Here is the full output:

C:\Users\mj\Desktop\Development\Sandbox\RabbitMQ\rabbitmq-public-umbrella\rabbit
mq-server>cd..

C:\Users\mj\Desktop\Development\Sandbox\RabbitMQ\rabbitmq-public-umbrella>make
Das System kann den angegebenen Pfad nicht finden.
Der Befehl "cut" ist entweder falsch geschrieben oder
konnte nicht gefunden werden.
make -C rabbitmq-server all &&  make -C rabbitmq-codegen all &&  make -C
rabbitm
q-erlang-client all &&  make -C rabbitmq-jsonrpc all &&  make -C
rabbitmq-mochiw
eb all &&  make -C rabbitmq-jsonrpc-channel all &&  make -C rabbitmq-bql all
&&
 make -C rabbitmq-stomp all &&  make -C rabbitmq-smtp all &&  make -C
erlang-rfc
4627 all && true
Der Befehl "[" ist entweder falsch geschrieben oder
konnte nicht gefunden werden.
Der Befehl "[" ist entweder falsch geschrieben oder
konnte nicht gefunden werden.
Der Befehl "[" ist entweder falsch geschrieben oder
konnte nicht gefunden werden.
Der Befehl "[" ist entweder falsch geschrieben oder
konnte nicht gefunden werden.
make[1]: Entering directory
`C:/Users/mj/Desktop/Development/Sandbox/RabbitMQ/ra
bbitmq-public-umbrella/rabbitmq-server'
make[1]: *** Keine Regel vorhanden, um das Target ?codegen/amqp_codegen.py?,
  ben?tigt von ?src/rabbit_framing.erl?, zu erstellen.  Schluss.
make[1]: Leaving directory
`C:/Users/mj/Desktop/Development/Sandbox/RabbitMQ/rab
bitmq-public-umbrella/rabbitmq-server'
make: *** [all] Fehler 2

C:\Users\mj\Desktop\Development\Sandbox\RabbitMQ\rabbitmq-public-umbrella>

-----
Michael Justin
SCJP, SCJA
betasoft - Software for Delphi? and for the Java? platform
http://www.mikejustin.com - http://www.betabeans.de
-- 
View this message in context: http://old.nabble.com/Compiling-under-Windows-Vista-tp26454283p26454283.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From frederick.ryckbosch at gmail.com  Sat Nov 21 11:41:10 2009
From: frederick.ryckbosch at gmail.com (Frederick Ryckbosch)
Date: Sat, 21 Nov 2009 12:41:10 +0100
Subject: [rabbitmq-discuss] Latency between publish and wait
Message-ID: <AC365FCC-16AF-46E6-ADEC-0C1AC98DABCF@gmail.com>

Hi,

I'm using the python amqplib to connect to a rabbitmq server with the  
following queue configuration:

Exchange: non durable, no auto delete, direct binding
Queue: non durable, non exclusive, no auto delete
The exchange and queue are binding with routing_key "test".

The total execution time of this :

chan.basic_publish(amqp.Message(msg.body), exchange="xchange",  
routing_key="test")
chan.wait() # Waiting on the queue

is 40ms. When I profiled the code, it spends most of its time waiting  
on the socket.

Is 40 ms a normal latency between putting in the exchange to getting  
it from the queue ?
Or am I doing something terribly wrong ?

Thanks !
Frederick





From matthias at lshift.net  Mon Nov 23 17:18:00 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 23 Nov 2009 17:18:00 +0000
Subject: [rabbitmq-discuss] rabbit-erlang-client heartbeats
In-Reply-To: <4EB4C344-78DF-4F46-8C85-2ED018648B41@epicadvertising.com>
References: <4EB4C344-78DF-4F46-8C85-2ED018648B41@epicadvertising.com>
Message-ID: <4B0AC3C8.30904@lshift.net>

Scott,

Scott Brooks wrote:
> I can't seem to find a way to specify a heartbeat setting with the
> rabbit-erlang-client.

The code for this was awaiting qa, which has now been done, so please 
update to the latest 'default' branch.


Regards,

Matthias.



From matthias at lshift.net  Mon Nov 23 21:28:56 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 23 Nov 2009 21:28:56 +0000
Subject: [rabbitmq-discuss] Latency between publish and wait
In-Reply-To: <AC365FCC-16AF-46E6-ADEC-0C1AC98DABCF@gmail.com>
References: <AC365FCC-16AF-46E6-ADEC-0C1AC98DABCF@gmail.com>
Message-ID: <4B0AFE98.2060705@lshift.net>

Frederick,

Frederick Ryckbosch wrote:
> The total execution time of this :
> 
> chan.basic_publish(amqp.Message(msg.body), exchange="xchange",  
> routing_key="test")
> chan.wait() # Waiting on the queue
> 
> is 40ms. When I profiled the code, it spends most of its time waiting  
> on the socket.
> 
> Is 40 ms a normal latency between putting in the exchange to getting  
> it from the queue ?
> Or am I doing something terribly wrong ?

With the RabbitMQ Java client we see latencies in the hundreds of 
microseconds on moderate throughput. Looks like py-amqplib is a lot 
slower. One possible cause might be that the socket isn't configured 
with Nagle disabled, but I haven't looked at the code to check.


Regards,

Matthias.



From matthias at lshift.net  Mon Nov 23 21:34:16 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 23 Nov 2009 21:34:16 +0000
Subject: [rabbitmq-discuss] Compiling under Windows Vista
In-Reply-To: <26454283.post@talk.nabble.com>
References: <26454283.post@talk.nabble.com>
Message-ID: <4B0AFFD8.9040101@lshift.net>

Michael,

mjustin wrote:
> this is my first try to compile RabbitMQ on Windows 7. It looks like I need
> some additional software and maybe making some mistakes.

I see you are actually trying to compile all the plug-ins, as well as 
RabbitMQ itself. I highly recommend you find a Unix system, preferably 
Debian-based, to do that.

You will likely run into quite a few issues attempting to compile 
RabbitMQ on Windows. It's not something we are planning to support. The 
only exception is the .net client, which should build out of box.


Regards,

Matthias.



From igor at goryachev.org  Tue Nov 24 16:55:56 2009
From: igor at goryachev.org (Igor Goryachev)
Date: Tue, 24 Nov 2009 19:55:56 +0300
Subject: [rabbitmq-discuss] rabbitmq-erlang-client and connection.redirect
Message-ID: <87d437n9pf.fsf@goryachev.org>

Hi.

It seems rabbitmq-erlang-client doesn't handle connection.redirect,
am I right?


-- 
    Igor Goryachev              E-Mail/Jabber: igor at goryachev.org



From igor at goryachev.org  Tue Nov 24 17:11:25 2009
From: igor at goryachev.org (Igor Goryachev)
Date: Tue, 24 Nov 2009 20:11:25 +0300
Subject: [rabbitmq-discuss] rabbitmq-erlang-client and
	connection.redirect
In-Reply-To: <87d437n9pf.fsf@goryachev.org> (Igor Goryachev's message of "Tue, 
	24 Nov 2009 19:55:56 +0300")
References: <87d437n9pf.fsf@goryachev.org>
Message-ID: <87638zn8zm.fsf@goryachev.org>

On Tue, Nov 24, 2009 at 19:55, Igor Goryachev wrote:

> Hi.
>
> It seems rabbitmq-erlang-client doesn't handle connection.redirect,
> am I right?

Sorry, forgot to include exception:

17> amqp_test:test().
** exception error: no match of right hand side value
                    {error,
                        {{badmatch,
                             {'connection.redirect',<<"dev1.local:5672">>,
                                 <<"dev3.local:5672,dev2.local:5672,dev1.local:5672">>}},
                         [{amqp_network_connection,network_handshake,1},
                          {amqp_network_connection,do_handshake,1},
                          {amqp_network_connection,init,1},
                          {gen_server,init_it,6},
                          {proc_lib,init_p_do_apply,3}]}}
     in function  amqp_connection:start_network_internal/2
     in call from amqp_test:test/0



-- 
    Igor Goryachev              E-Mail/Jabber: igor at goryachev.org



From jdc at hive7.com  Wed Nov 25 21:04:19 2009
From: jdc at hive7.com (JD Conley)
Date: Wed, 25 Nov 2009 13:04:19 -0800
Subject: [rabbitmq-discuss] basic.getall?
Message-ID: <019801ca6e12$db4b43d0$91e1cb70$@com>

What would be the best approach to get all of the messages in a queue with
as few calls as possible? Right now I'm doing a basic.get loop until the
queue is empty, but I think there is probably a better way.

Thanks,
JD




From gmr at myyearbook.com  Wed Nov 25 21:08:40 2009
From: gmr at myyearbook.com (Gavin M. Roy)
Date: Wed, 25 Nov 2009 16:08:40 -0500
Subject: [rabbitmq-discuss] Announcing Siphon
Message-ID: <af1bce590911251308m267ac188vb1956c403da03c78@mail.gmail.com>

Siphon is a daemon to requeue messages from ActiveMQ and put them into RabbitMQ.

In managing a migration project to move off of ActiveMQ we found we
needed to use our RabbitMQ consumers and code prior to our ability to
move our code that publishes into the queues.  Siphon allows us to
transparently move to the new backend consumer code while maintaining
a reasonable quality of service until we can move fully off of
publishing to ActiveMQ.

http://github.com/gmr/Siphon

Regards,

Gavin



From celldee at gmail.com  Thu Nov 26 01:02:47 2009
From: celldee at gmail.com (Chris Duncan)
Date: Thu, 26 Nov 2009 01:02:47 +0000
Subject: [rabbitmq-discuss] Re-declaring named exchange with passive
	argument set to true
Message-ID: <07432668-F520-4C33-9FE4-0C1C31599519@gmail.com>

Hi,

Someone recently asked me a question about finding a named exchange  
without specifying the type in the declare method call. I've done  
some testing against RabbitMQ v1.7.0 and it seems that you cannot re- 
declare an existing exchange without supplying a type argument, even  
if the passive argument is used and set to true. I consistently get a  
503 error.

The 0-9-1 AMQP XML spec suggests that if you set the passive argument  
to true in the exchange declare method call, then type should be  
ignored.

====  Start of excerpt from 0-9-1 spec ====
<field name = "passive" domain = "bit" label = "do not create exchange">
         <doc>
           If set, the server will reply with Declare-Ok if the  
exchange already
           exists with the same name, and raise an error if not.  The  
client can
           use this to check whether an exchange exists without  
modifying the
           server state. When set, all other method fields except  
name and no-wait
           are ignored.  A declare with both passive and no-wait has  
no effect.
           Arguments are compared for semantic equivalence.
         </doc>

====  End of excerpt from 0-9-1 spec ====

Firstly, can anyone confirm that the behaviour I am observing  
regarding arguments passed in the exchange declare method is correct.  
There could be a problem with my client library that I haven't found.

Secondly, if the type argument is mandatory even when the passive  
argument is used and set to true, is this a bug in RabbitMQ?

Regards,

Chris

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091126/7167f057/attachment.htm 

From scottblanc at gmail.com  Thu Nov 26 01:19:25 2009
From: scottblanc at gmail.com (scott w)
Date: Wed, 25 Nov 2009 17:19:25 -0800
Subject: [rabbitmq-discuss] Slow throughput on consume side using java
	client API
Message-ID: <401b577e0911251719tfd405auaf542a8c87b54b3@mail.gmail.com>

I'm not seeing the expected throughput on the consume side of things using
the Java client API and looking for some suggestions. The way I've set up my
tests I create N=25 channels/queue consumers for a single queue (according
to the java api docs you can't have more than one thread on a given channel
at once) and then I have 50 threads that fill up the queue (publish
throughput is fine) and then another 50 threads which pull from the queue. I
synchronize on the channels and each thread uses round robin to to select a
channel and queue consumer pair and uses that to do the consume and ack. But
even after some twiddling I am not able to get beyond 50 reads per sec which
is less than 10x what I am seeing on the publish side. Below is what the key
code looks like. Any suggestions for what may be causing the slowness?

thanks,
Scott

Here is the consume code looks like:

    Integer channelNum = pickRandomChannel();
    Channel channel = getChannel( channelNum );
    QueueingConsumer consumer = getConsumer( channelNum );
    synchronized (getChannel( channelNum )) {
      try {
        channel.basicConsume( getQueueName(), noAck, consumer ); //noAck =
false here
      } catch (IOException e) {
        logger.warn( "Exception when consuming message from queue: " +
getQueueName(), e );
      }
      try {
        QueueingConsumer.Delivery delivery = consumer.nextDelivery(
this.defaultTimeout );
        if (delivery == null) {
          return null;
        }
        return delivery.getBody()
      } catch (InterruptedException ie) {
        logger.warn( "Interruped exception on next delivery", ie );
        return null;
      }
    }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091125/c041d734/attachment.htm 

From michael.justin at gmx.net  Thu Nov 26 08:52:29 2009
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 26 Nov 2009 09:52:29 +0100
Subject: [rabbitmq-discuss] RabbitMQ/Stomp on Windows
Message-ID: <4B0E41CD.6020909@gmx.net>

Hello,

is it possible to transfer the compiled code of the Stomp adapter to a 
Windows box, and modify the startup script for the the Windows 
distribution so that it uses the Stomp adapter? Currently I am using a 
Ubuntu VM and it works fine for me, but it might be good to know there 
is a setup which requires one system only.

Best regards,

-- 
Michael Justin
SCJP, SCJA
betasoft - Software for Delphi? and for the Java? platform
http://www.mikejustin.com - http://www.betabeans.de




From rtrlists at googlemail.com  Thu Nov 26 09:57:47 2009
From: rtrlists at googlemail.com (Robert Raschke)
Date: Thu, 26 Nov 2009 09:57:47 +0000
Subject: [rabbitmq-discuss] basic.getall?
In-Reply-To: <019801ca6e12$db4b43d0$91e1cb70$@com>
References: <019801ca6e12$db4b43d0$91e1cb70$@com>
Message-ID: <6a3ae47e0911260157l26329095l318490fc6b62e9b4@mail.gmail.com>

On Wed, Nov 25, 2009 at 9:04 PM, JD Conley <jdc at hive7.com> wrote:

> What would be the best approach to get all of the messages in a queue with
> as few calls as possible? Right now I'm doing a basic.get loop until the
> queue is empty, but I think there is probably a better way.
>
>
Well, in my experience the fastest way to get messages is through
subscribe/deliver. That can have your desired side-effect of keeping the
queue clear if you can process the messages quickly enough.

It doesn't address your immediate question, though. Sorry.

On further thought, I guess you can mimic a getall approach by having a
consumer do the buffering for you. So, provide a client that subscribes to
the queue and buffers all the delivered messages. Your current end client
then uses whatever interface your intermediate one supplies to get all
currently buffered messages.

Robby
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091126/f1659724/attachment.htm 

From matthew at lshift.net  Thu Nov 26 10:10:33 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 26 Nov 2009 10:10:33 +0000
Subject: [rabbitmq-discuss] Slow throughput on consume side using java
 client API
In-Reply-To: <401b577e0911251719tfd405auaf542a8c87b54b3@mail.gmail.com>
References: <401b577e0911251719tfd405auaf542a8c87b54b3@mail.gmail.com>
Message-ID: <20091126101033.GA22260@mrnibble.lshift.net>

Hi Scott,

I must admit I'm a little confused by your description as it would
appear somewhat complex to me. However, am I correct in the following?

1. You have 1 queue, which is being published to by 50 threads.
2. You have 25 consumers on that queue.
3. To receive, you randomly select a consumer, and get that consumer to
consume a message.

If that's correct, I'm not surprised by your findings. Consumers on a
queue are round-robin'd by the broker. Thus each of your 25 consumers
will receive one 25th of the messages. Thus if you randomly select a
consumer then it may well have nothing waiting on it as messages have
been sent to the other consumers. Thus you will have to wait for up to
25 publishes before that consumer gets a message.

Why are you using so many threads and consumers?

Also, please let me know if I misunderstood anything about your setup.

Best wishes,

Matthew



From matthew at lshift.net  Thu Nov 26 10:13:23 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 26 Nov 2009 10:13:23 +0000
Subject: [rabbitmq-discuss] basic.getall?
In-Reply-To: <6a3ae47e0911260157l26329095l318490fc6b62e9b4@mail.gmail.com>
References: <019801ca6e12$db4b43d0$91e1cb70$@com>
	<6a3ae47e0911260157l26329095l318490fc6b62e9b4@mail.gmail.com>
Message-ID: <20091126101323.GB22260@mrnibble.lshift.net>

On Thu, Nov 26, 2009 at 09:57:47AM +0000, Robert Raschke wrote:
> On Wed, Nov 25, 2009 at 9:04 PM, JD Conley <jdc at hive7.com> wrote:
> > What would be the best approach to get all of the messages in a queue with
> > as few calls as possible? Right now I'm doing a basic.get loop until the
> > queue is empty, but I think there is probably a better way.
> >
> Well, in my experience the fastest way to get messages is through
> subscribe/deliver. That can have your desired side-effect of keeping the
> queue clear if you can process the messages quickly enough.

Absolutely. Don't use basic.get. Instead subscribe to the queue with
basic.consume, and if you really want to avoid sending any responses to
the broker, set the noAck flag to true. That way you don't even have to
send acks back.

Matthew



From matthew at lshift.net  Thu Nov 26 10:33:00 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 26 Nov 2009 10:33:00 +0000
Subject: [rabbitmq-discuss] basic.getall?
In-Reply-To: <20091126101323.GB22260@mrnibble.lshift.net>
References: <019801ca6e12$db4b43d0$91e1cb70$@com>
	<6a3ae47e0911260157l26329095l318490fc6b62e9b4@mail.gmail.com>
	<20091126101323.GB22260@mrnibble.lshift.net>
Message-ID: <20091126103300.GC22260@mrnibble.lshift.net>

On Thu, Nov 26, 2009 at 10:13:23AM +0000, Matthew Sackman wrote:
> On Thu, Nov 26, 2009 at 09:57:47AM +0000, Robert Raschke wrote:
> > On Wed, Nov 25, 2009 at 9:04 PM, JD Conley <jdc at hive7.com> wrote:
> > > What would be the best approach to get all of the messages in a queue with
> > > as few calls as possible? Right now I'm doing a basic.get loop until the
> > > queue is empty, but I think there is probably a better way.
> 
> Absolutely. Don't use basic.get. Instead subscribe to the queue with
> basic.consume, and if you really want to avoid sending any responses to
> the broker, set the noAck flag to true. That way you don't even have to
> send acks back.

It's just been pointed out to me that of course with this, you won't
know when the queue is empty. You could either periodically, or wait
until the rate drops (which would require measuring rate), call
queue.declare to redeclare the queue which will give you a count of the
msgs in the queue. Depends how quickly you need to know that the queue
has become empty. Something like "if you've not received a msg in the
last 0.5 seconds, try a queue.declare to detect queue-end" may work for
you, but it's more application logic.

Matthew



From mikeb at lshift.net  Thu Nov 26 11:14:29 2009
From: mikeb at lshift.net (Michael Bridgen)
Date: Thu, 26 Nov 2009 11:14:29 +0000
Subject: [rabbitmq-discuss] Re-declaring named exchange with
 passive	argument set to true
In-Reply-To: <07432668-F520-4C33-9FE4-0C1C31599519@gmail.com>
References: <07432668-F520-4C33-9FE4-0C1C31599519@gmail.com>
Message-ID: <4B0E6315.8080809@lshift.net>

Hi Chris,

> Someone recently asked me a question about finding a named exchange 
> without specifying the type in the declare method call. I've done some 
> testing against RabbitMQ v1.7.0 and it seems that you cannot re-declare 
> an existing exchange without supplying a type argument, even if the 
> passive argument is used and set to true. I consistently get a 503 error.

RabbitMQ implements AMQP 0-8 right now, which doesn't specify passive in 
quite the same way as 0-9-1.  In 0-8, only auto-delete and durable are 
ignored.

> The 0-9-1 AMQP XML spec suggests that if you set the passive argument to 
> true in the exchange declare method call, then type should be ignored.

Yes indeed; 0-9-1 is much clearer than 0-8 on what the passive flag 
means.  Essentially exchange.declare and queue.declare, with passive 
set, are different methods.

> Firstly, can anyone confirm that the behaviour I am observing regarding 
> arguments passed in the exchange declare method is correct. There could 
> be a problem with my client library that I haven't found.

If "without supplying a type argument" above means you send an empty 
string, you're getting back 503 Command Invalid because of AMQP 0-8 rule 
amqp_exchange_18, which says the server must send 503 if it doesn't 
support the exchange type.

If you know the exchange type you should be able to send that and get a 
declare-ok or 404 back.

> Secondly, if the type argument is mandatory even when the passive 
> argument is used and set to true, is this a bug in RabbitMQ?

Not at the minute.  We are working on 0-9-1 support, in the (fairly 
stable and up to date) branch amqp_0_9_1.  In this branch right now, 
Queue.Declare has the new semantics, though Exchange.Declare doesn't 
quite yet.

The client APIs are also being changed; e.g., in the Java client, 
there's now Channel.declarePassive(String name), and Channel.declare no 
longer takes an argument for passive.


Cheers,
Michael




From celldee at gmail.com  Thu Nov 26 12:12:34 2009
From: celldee at gmail.com (Chris Duncan)
Date: Thu, 26 Nov 2009 12:12:34 +0000
Subject: [rabbitmq-discuss] Re-declaring named exchange with passive
	argument set to true
In-Reply-To: <4B0E6315.8080809@lshift.net>
References: <07432668-F520-4C33-9FE4-0C1C31599519@gmail.com>
	<4B0E6315.8080809@lshift.net>
Message-ID: <e1542d30911260412q41c777bka3d271e2450618cf@mail.gmail.com>

Thanks for the information Michael.

Regards,

Chris
2009/11/26 Michael Bridgen <mikeb at lshift.net>

> Hi Chris,
>
> > Someone recently asked me a question about finding a named exchange
> > without specifying the type in the declare method call. I've done some
> > testing against RabbitMQ v1.7.0 and it seems that you cannot re-declare
> > an existing exchange without supplying a type argument, even if the
> > passive argument is used and set to true. I consistently get a 503 error.
>
> RabbitMQ implements AMQP 0-8 right now, which doesn't specify passive in
> quite the same way as 0-9-1.  In 0-8, only auto-delete and durable are
> ignored.
>
> > The 0-9-1 AMQP XML spec suggests that if you set the passive argument to
> > true in the exchange declare method call, then type should be ignored.
>
> Yes indeed; 0-9-1 is much clearer than 0-8 on what the passive flag
> means.  Essentially exchange.declare and queue.declare, with passive
> set, are different methods.
>
> > Firstly, can anyone confirm that the behaviour I am observing regarding
> > arguments passed in the exchange declare method is correct. There could
> > be a problem with my client library that I haven't found.
>
> If "without supplying a type argument" above means you send an empty
> string, you're getting back 503 Command Invalid because of AMQP 0-8 rule
> amqp_exchange_18, which says the server must send 503 if it doesn't
> support the exchange type.
>
> If you know the exchange type you should be able to send that and get a
> declare-ok or 404 back.
>
> > Secondly, if the type argument is mandatory even when the passive
> > argument is used and set to true, is this a bug in RabbitMQ?
>
> Not at the minute.  We are working on 0-9-1 support, in the (fairly
> stable and up to date) branch amqp_0_9_1.  In this branch right now,
> Queue.Declare has the new semantics, though Exchange.Declare doesn't
> quite yet.
>
> The client APIs are also being changed; e.g., in the Java client,
> there's now Channel.declarePassive(String name), and Channel.declare no
> longer takes an argument for passive.
>
>
> Cheers,
> Michael
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
Regards

Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091126/e930a92d/attachment.htm 

From m.nacos at gmail.com  Thu Nov 26 14:19:13 2009
From: m.nacos at gmail.com (Michael Nacos)
Date: Thu, 26 Nov 2009 14:19:13 +0000
Subject: [rabbitmq-discuss] sample postgresql C function using librabbitmq
Message-ID: <407fa4640911260619x32591e14p75b232182e678004@mail.gmail.com>

We do a lot of db work involving postgresql and some of our new processes
use rabbitmq. We currently use an Erlang-based monitoring system for queues,
consumers and some
non-rabbit things. Since there is a C rabbitmq library these days (thanks
Tony), I have tried to achieve the same thing through C functions
interfacing directly with the AMQP broker,
removing the need for an intermediate layer when pushing/pulling from the
database. When I find a little more time, I am hoping to organize the most
useful rabbitmq-related functions
I have written into a postgresql module (probably github). Until then, here
is some toy code in the public domain:

regards, Michael

/*
** Filename: rabbit.c
*/

#include "postgres.h"
#include "fmgr.h"
#include "funcapi.h"
#include "executor/spi.h"
#include "nodes/execnodes.h"
#include "commands/trigger.h"
#include "utils/builtins.h"
#include <ctype.h>
#include "amqp.h"
#include "amqp_framing.h"

#ifdef PG_MODULE_MAGIC
PG_MODULE_MAGIC;
#endif

/*
    HOW TO run this toy code (you need postgresql sources and librabbitmq.so
installed)

--------------------------------------------------------------------------------------
    [assuming postgresql is installed in /usr/local/pgsql8.4.1]

    make rabbit.so; mv rabbit.so /usr/local/pgsql8.4.1/lib
    cat rabbit.sql | /usr/local/pgsql8.4.1/bin/psql -U postgres db_of_choice
    echo "SELECT rabbit_count('localhost');" |
/usr/local/pgsql8.4.1/bin/psql -U postgres ...

    # Makefile sample
--------------------------------------------------------------------

    SERVER_INCLUDES += -I $(shell /usr/local/pgsql8.4.1/bin/pg_config
--includedir)
    SERVER_INCLUDES += -I $(shell /usr/local/pgsql8.4.1/bin/pg_config
--includedir-server)
    CFLAGS += -O3 $(SERVER_INCLUDES)
    .SUFFIXES:      .so
    .c.so:
        $(CC) $(CFLAGS) -fpic -c $<
        $(CC) $(CFLAGS) -shared -lrabbitmq -o $@ $(basename $<).o

    # rabbit.sql sample
------------------------------------------------------------------

        CREATE OR REPLACE FUNCTION rabbit_count(hostname VARCHAR)
            RETURNS INT AS 'rabbit.so', 'rabbit_count' LANGUAGE 'C';

    #
------------------------------------------------------------------------------------
*/

/* toy postgresql C function rabbit_count()
      accepts a single VARCHAR argument (hostname)
      returns NULL if there is a connection error
      or the number of consumers currently attached to a queue called
'PREDEFINED'      */

PG_FUNCTION_INFO_V1(rabbit_count);
Datum rabbit_count(PG_FUNCTION_ARGS)
{
    int ret = -1;
    int port;
    char const *queue;
    char const *user; char const *pass;
      int sockfd;
      amqp_connection_state_t conn;

    if (PG_ARGISNULL(0)) { PG_RETURN_NULL(); }
    VarChar *sql = PG_GETARG_VARCHAR_P(0); unsigned int size = VARSIZE(sql)
- VARHDRSZ;
    char *hostname = (char *) palloc(size+1);
    strncpy(hostname,VARDATA(sql),size); hostname[size] = '\0'; //
converting varchar into native string

    port = 5672;
    queue = "PREDEFINED";
    user = "guest"; pass = "guest";

      conn = amqp_new_connection();
    if (conn < 0) {
        elog(ERROR, "rabbit.so (rabbit_count) -- amqp_new_connection()
error");
        return PointerGetDatum(NULL);
    }

      sockfd = amqp_open_socket(hostname, port);
      if (sockfd < 0) {
        elog(ERROR, "rabbit.so (rabbit_count) -- amqp_open_socket() error");
        return PointerGetDatum(NULL);
    }
    amqp_set_sockfd(conn, sockfd);

    // probably needs something like die_on_amqp_error -- see below
      amqp_login(conn, "/", 0, 131072, 0, AMQP_SASL_METHOD_PLAIN, user,
pass);
    // probably needs something like die_on_amqp_error -- see below
    amqp_channel_open(conn, 1);
    // die_on_amqp_error(amqp_rpc_reply, "Opening channel");

    // after the queue argument, numbers correspond to bool vals for
passive, durable, exclusive, auto_delete
    amqp_queue_declare_ok_t *r = amqp_queue_declare(conn, 1,
amqp_cstring_bytes(queue), 0, 1, 0, 0, AMQP_EMPTY_TABLE);
    // die_on_amqp_error(amqp_rpc_reply, "Declaring queue");

    //   uint32_t message_count;
    //   uint32_t consumer_count;
    ret = r->consumer_count;

    amqp_channel_close(conn, 1, AMQP_REPLY_SUCCESS);
    amqp_connection_close(conn, AMQP_REPLY_SUCCESS);
    amqp_destroy_connection(conn);
    close(sockfd);

    pfree(hostname);

    if ( ret == -1 ) {
        elog(ERROR, "rabbit.so (rabbit_count) -- ret error");
        return PointerGetDatum(NULL);
    }

    return (ret);
}
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091126/db44fec4/attachment.htm 

From michael.justin at gmx.net  Thu Nov 26 15:10:26 2009
From: michael.justin at gmx.net (Michael Justin)
Date: Thu, 26 Nov 2009 16:10:26 +0100
Subject: [rabbitmq-discuss] ANN: Delphi client library for RabbitMQ AMQP
	message broker
Message-ID: <4B0E9A62.60304@gmx.net>

betasoft <http://www.mikejustin.com/> started the beta test of the 
Habari RabbitMQ Client library for Delphi and Free Pascal today.

Habari RabbitMQ Client uses the Stomp message protocol and a plug-in 
architecture for communication libraries and message transformers for 
XML and JSON <http://en.wikipedia.org/wiki/Json> object serialization. 
It follows the specification of the JMS (Java Message Service 
<http://en.wikipedia.org/wiki/Java_Message_Service>) API for Message 
Oriented Middleware.

Read the full announcement here:

https://forums.embarcadero.com/thread.jspa?threadID=28862

/RabbitMQ? is a Trademark of Rabbit Technologies Ltd./

-- 
Michael Justin
SCJP, SCJA
betasoft - Software for Delphi? and for the Java? platform
http://www.mikejustin.com - http://www.betabeans.de




From mabrek at gmail.com  Thu Nov 26 16:26:51 2009
From: mabrek at gmail.com (mabrek)
Date: Thu, 26 Nov 2009 19:26:51 +0300
Subject: [rabbitmq-discuss] bug21444 branch experience
Message-ID: <c26271fb0911260826l668b0ecbjb1fc86ba3a45f622@mail.gmail.com>

Hello.
We need to handle large queues (50Gb) and thus I started experimenting
with bug21444 branch (revision 7a219f11bb3e) that seems to have this
feature.
First trouble was concerned with leaking disk space. Queue files were
remaining open after deletion.
Simple workaround limited wasted disk space:
src/rabbit_msg_store.erl
@@ -43,7 +43,7 @@

 -define(SERVER, ?MODULE).

--define(MAX_READ_FILE_HANDLES, 256).
+-define(MAX_READ_FILE_HANDLES, 32).
 -define(FILE_SIZE_LIMIT,       (256*1024*1024)).
 -define(SYNC_INTERVAL,         5). %% milliseconds

Another problem arised while starting server with large disk queue. It
seems that erlang gc can't keep up with the speed of reading files and
release unused binary data on time.
Forced garbage collection helped server to survive startup
src/rabbit_msg_store.erl
@@ -790,6 +790,7 @@
     build_index(undefined, Files, [], State).

 build_index(Left, [], FilesToCompact, State) ->
+	[erlang:garbage_collect(P) || P <- erlang:processes()],
     ok = index_delete_by_file(undefined, State),
     Offset = case lists:reverse(index_search_by_file(Left, State)) of
                  [] -> 0;
@@ -801,6 +802,7 @@
             State #msstate { current_file = Left, current_offset = Offset });
 build_index(Left, [File|Files], FilesToCompact,
             State = #msstate { dir = Dir, file_summary = FileSummary }) ->
+	[erlang:garbage_collect(P) || P <- erlang:processes()],
     {ok, Messages} = scan_file_for_valid_messages(Dir, filenum_to_name(File)),
     {ValidMessages, ValidTotalSize, AllValid} =
         lists:foldl(

>From repository changelog I can conclude that there is active
development in branch bug21673 and it have changes concerned with disk
queue. Is it worth trying?

Regards,
Anton Lebedevich.



From matthew at lshift.net  Thu Nov 26 16:32:09 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 26 Nov 2009 16:32:09 +0000
Subject: [rabbitmq-discuss] bug21444 branch experience
In-Reply-To: <c26271fb0911260826l668b0ecbjb1fc86ba3a45f622@mail.gmail.com>
References: <c26271fb0911260826l668b0ecbjb1fc86ba3a45f622@mail.gmail.com>
Message-ID: <20091126163209.GE22260@mrnibble.lshift.net>

Hi Anton,

On Thu, Nov 26, 2009 at 07:26:51PM +0300, mabrek wrote:
> We need to handle large queues (50Gb) and thus I started experimenting
> with bug21444 branch (revision 7a219f11bb3e) that seems to have this
> feature.

Yup, though that is quite old now.

> First trouble was concerned with leaking disk space. Queue files were
> remaining open after deletion.

I'm not quite sure what you mean by this or how the attached patch
helps. Can you describe what you were seeing in more detail?

> From repository changelog I can conclude that there is active
> development in branch bug21673 and it have changes concerned with disk
> queue. Is it worth trying?

Yup. This is the active development. It's currently going through QA.
Please feel free to try it and let us know how you get on with it.

Best wishes,

Matthew



From jdc at hive7.com  Thu Nov 26 17:01:17 2009
From: jdc at hive7.com (JD Conley)
Date: Thu, 26 Nov 2009 09:01:17 -0800
Subject: [rabbitmq-discuss] basic.getall?
In-Reply-To: <20091126103300.GC22260@mrnibble.lshift.net>
References: <019801ca6e12$db4b43d0$91e1cb70$@com>	<6a3ae47e0911260157l26329095l318490fc6b62e9b4@mail.gmail.com>	<20091126101323.GB22260@mrnibble.lshift.net>
	<20091126103300.GC22260@mrnibble.lshift.net>
Message-ID: <003c01ca6eba$12057380$36105a80$@com>

> > Absolutely. Don't use basic.get. Instead subscribe to the queue with
> > basic.consume, and if you really want to avoid sending any responses
> to
> > the broker, set the noAck flag to true. That way you don't even have
> to
> > send acks back.
> 
> It's just been pointed out to me that of course with this, you won't
> know when the queue is empty. 

Right, this was my issue with consume. I would like it to return all the
messages as quickly as possible.

Let me explain my current implementation. I'm using this for my Comet-style
long polling application. When the polling client first connects, I empty
its queue quickly and deterministically with a basic.get loop and return the
data. If there is no data I setup an asynchronous acking consumer with a QoS
count of 1. When a message is received, I basic.cancel and then ack. If the
wait period passes without consuming anything I cancel consuming.

> Something like "if you've not received a msg in the
> last 0.5 seconds, try a queue.declare to detect queue-end" may work for
> you, but it's more application logic.

That could work. I guess the big question for me will be... Is it cheaper
(time/cpu wise) to basic.get or setup a consumer. I suppose it would depend
on how many messages are waiting in the queue.

-JD




From vlad at lshift.net  Thu Nov 26 17:25:17 2009
From: vlad at lshift.net (Vlad Alexandru Ionescu)
Date: Thu, 26 Nov 2009 17:25:17 +0000
Subject: [rabbitmq-discuss] rabbitmq-erlang-client
	and	connection.redirect
In-Reply-To: <87638zn8zm.fsf@goryachev.org>
References: <87d437n9pf.fsf@goryachev.org> <87638zn8zm.fsf@goryachev.org>
Message-ID: <4B0EB9FD.2060207@lshift.net>


Hi Igor,
> It seems rabbitmq-erlang-client doesn't handle connection.redirect,
> am I right?
>   

You're right, it isn't handled.
We are not planning on implementing it, because the feature is gone in 
AMQP 0.9.1. I have committed a fix to set the insist flag to true in 
'connection.open' to prevent the server from replying with 
'connection.redirect'; it will be in default as soon as it is QA'ed.

Vlad.

-- 

 [][][] Vlad Alexandru Ionescu | Developer
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] www.lshift.net         | Email: vlad at lshift.net





From matthew at lshift.net  Thu Nov 26 17:38:44 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Thu, 26 Nov 2009 17:38:44 +0000
Subject: [rabbitmq-discuss] rabbitmq-erlang-client and
 connection.redirect
In-Reply-To: <4B0EB9FD.2060207@lshift.net>
References: <87d437n9pf.fsf@goryachev.org> <87638zn8zm.fsf@goryachev.org>
	<4B0EB9FD.2060207@lshift.net>
Message-ID: <20091126173843.GI22260@mrnibble.lshift.net>

Hi Igor,

On Thu, Nov 26, 2009 at 05:25:17PM +0000, Vlad Alexandru Ionescu wrote:
> You're right, it isn't handled.
> We are not planning on implementing it, because the feature is gone in 
> AMQP 0.9.1. I have committed a fix to set the insist flag to true in 
> 'connection.open' to prevent the server from replying with 
> 'connection.redirect'; it will be in default as soon as it is QA'ed.

It's now been QA'd and is on default branch.

Matthew



From gojko-yahoolist at gojko.com  Fri Nov 27 01:00:13 2009
From: gojko-yahoolist at gojko.com (Gojko Adzic)
Date: Fri, 27 Nov 2009 01:00:13 +0000
Subject: [rabbitmq-discuss] intermittent disconnects under load
Message-ID: <4B0F249D.8050903@gojko.com>

Hi,

we had a round of stress testing and got intermittent connection errors. 
I don't know exactly what causes it but the Java client throws this 
exception from a background thread and packets don't go completely to 
the client. We ran it on a cluster of two nodes, using Java clients.

Exception in thread "Thread-22" 
com.rabbitmq.client.ShutdownSignalException: connection error; reason: 
java.lang.NullPointerException
at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:588)
at 
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:454)
Caused by: java.lang.NullPointerException
at 
com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:438)


Line above 438 of AMQConnection says "//FIXME: catch 
NullPointerException and throw more informative one?" so I guess this is 
a well known problem - any hints on what is causing it and how to work 
around it until a fix is in place?

gojko



From mabrek at gmail.com  Fri Nov 27 08:46:57 2009
From: mabrek at gmail.com (mabrek)
Date: Fri, 27 Nov 2009 11:46:57 +0300
Subject: [rabbitmq-discuss] bug21444 branch experience
In-Reply-To: <20091126163209.GE22260@mrnibble.lshift.net>
References: <c26271fb0911260826l668b0ecbjb1fc86ba3a45f622@mail.gmail.com>
	<20091126163209.GE22260@mrnibble.lshift.net>
Message-ID: <c26271fb0911270046p37a2d71ueb0075f00e1811c3@mail.gmail.com>

On Thu, Nov 26, 2009 at 7:32 PM, Matthew Sackman <matthew at lshift.net> wrote:
>> First trouble was concerned with leaking disk space. Queue files were
>> remaining open after deletion.
>
> I'm not quite sure what you mean by this or how the attached patch
> helps. Can you describe what you were seeing in more detail?

file_handle_cache.erl was rewritten completely in bug21673 and my
workaround became irrelevant for it.

>> From repository changelog I can conclude that there is active
>> development in branch bug21673 and it have changes concerned with disk
>> queue. Is it worth trying?
>
> Yup. This is the active development. It's currently going through QA.
> Please feel free to try it and let us know how you get on with it.

I've tried (rev 8f9f7b0177e6) and crashed it. Test scenario was to
create 4 non-transactional producers without consumers, each producer
was about to send 1m messages with size 10kbytes each.

./scripts/rabbitmqctl list_queues name messages_unacknowledged
messages memory consumers
Listing queues ...
mail.active     0       36414   51855936        0
...done.

Queue disappeared after storing ~40000 messages, client started to
receive returned messages with replyCode 312, replyText 'unroutable',
routingKey mail.active.

./scripts/rabbitmqctl list_queues name messages_unacknowledged
messages memory consumers
Listing queues ...
...done.

And then erlang died with message:
Crash dump was written to: erl_crash.dump
eheap_alloc: Cannot allocate 1824525600 bytes of memory (of type "old_heap").
Aborted

See attached file for crash logs.

Here is small documentation patch for rabbitmqctl list_queues name
storage_mode replying with Error: {bad_argument,storage_mode}

diff -r 8f9f7b0177e6 src/rabbit_control.erl
--- a/src/rabbit_control.erl    Thu Nov 26 21:51:35 2009 +0000
+++ b/src/rabbit_control.erl    Fri Nov 27 11:34:50 2009 +0300
@@ -174,7 +174,7 @@

 <QueueInfoItem> must be a member of the list [name, durable, auto_delete,
 arguments, node, messages_ready, messages_unacknowledged,
messages_uncommitted,
-messages, acks_uncommitted, consumers, transactions, memory, storage_mode]. The
+messages, acks_uncommitted, consumers, transactions, memory]. The
 default is to display name and (number of) messages.

 <ExchangeInfoItem> must be a member of the list [name, type, durable,

Regards,
Anton.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: crash-logs.tgz
Type: application/x-gzip
Size: 151622 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091127/c1c2f23b/attachment.bin 

From matthias at lshift.net  Fri Nov 27 09:15:07 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 27 Nov 2009 09:15:07 +0000
Subject: [rabbitmq-discuss] bug21444 branch experience
In-Reply-To: <c26271fb0911270046p37a2d71ueb0075f00e1811c3@mail.gmail.com>
References: <c26271fb0911260826l668b0ecbjb1fc86ba3a45f622@mail.gmail.com>	<20091126163209.GE22260@mrnibble.lshift.net>
	<c26271fb0911270046p37a2d71ueb0075f00e1811c3@mail.gmail.com>
Message-ID: <4B0F989B.7090801@lshift.net>

Anton,

mabrek wrote:
> I've tried (rev 8f9f7b0177e6) and crashed it.

Fixed. I'm afraid that until qa is completed that is bound to happen.

> Here is small documentation patch for rabbitmqctl list_queues name
> storage_mode replying with Error: {bad_argument,storage_mode}

We'll look into that. There are some more changes necessary.


Regards,

Matthias.



From alexis.richardson at gmail.com  Fri Nov 27 10:47:10 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 27 Nov 2009 10:47:10 +0000
Subject: [rabbitmq-discuss] rabbitmq xmas do
Message-ID: <167204d20911270247i32365d59q68821cfd924a36de@mail.gmail.com>

Hi folks,

If you are in or near London: we plan to have a small xmas party
jointly with Redmonk, Homecamp, Pubsub and some other good folks who
work near RabbitHQ.

Please put it in your diaries and *please* email me off list if you
plan to come.

Cheers

alexis



From mabrek at gmail.com  Fri Nov 27 11:03:50 2009
From: mabrek at gmail.com (mabrek)
Date: Fri, 27 Nov 2009 14:03:50 +0300
Subject: [rabbitmq-discuss] bug21444 branch experience
In-Reply-To: <4B0F989B.7090801@lshift.net>
References: <c26271fb0911260826l668b0ecbjb1fc86ba3a45f622@mail.gmail.com>
	<20091126163209.GE22260@mrnibble.lshift.net>
	<c26271fb0911270046p37a2d71ueb0075f00e1811c3@mail.gmail.com>
	<4B0F989B.7090801@lshift.net>
Message-ID: <c26271fb0911270303i23f63871r714e8ebc698218e3@mail.gmail.com>

On Fri, Nov 27, 2009 at 12:15 PM, Matthias Radestock
<matthias at lshift.net> wrote:
> Anton,
>
> mabrek wrote:
>>
>> I've tried (rev 8f9f7b0177e6) and crashed it.
>
> Fixed. I'm afraid that until qa is completed that is bound to happen.

Great thanks for quick response! It works after update.

Regards,
Anton Lebedevich



From geir at pobox.com  Fri Nov 27 11:58:20 2009
From: geir at pobox.com (Geir Magnusson Jr.)
Date: Fri, 27 Nov 2009 06:58:20 -0500
Subject: [rabbitmq-discuss] rabbitmq xmas do
In-Reply-To: <167204d20911270247i32365d59q68821cfd924a36de@mail.gmail.com>
References: <167204d20911270247i32365d59q68821cfd924a36de@mail.gmail.com>
Message-ID: <2C88F70A-2F0F-4DC0-A63A-333D0E75D5B1@pobox.com>

Any specific date and time?

geir

On Nov 27, 2009, at 5:47 AM, Alexis Richardson wrote:

> Hi folks,
> 
> If you are in or near London: we plan to have a small xmas party
> jointly with Redmonk, Homecamp, Pubsub and some other good folks who
> work near RabbitHQ.
> 
> Please put it in your diaries and *please* email me off list if you
> plan to come.
> 
> Cheers
> 
> alexis
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss




From alexis.richardson at gmail.com  Fri Nov 27 12:22:45 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 27 Nov 2009 12:22:45 +0000
Subject: [rabbitmq-discuss] rabbitmq xmas do
In-Reply-To: <2C88F70A-2F0F-4DC0-A63A-333D0E75D5B1@pobox.com>
References: <167204d20911270247i32365d59q68821cfd924a36de@mail.gmail.com>
	<2C88F70A-2F0F-4DC0-A63A-333D0E75D5B1@pobox.com>
Message-ID: <167204d20911270422i326184a1oeedaf2356934623a@mail.gmail.com>

Geir, et al.

Thanks for pointing out that I cluelessly left out the date:

December 17th, starting around 6pm.  There will also be a 'pubsub'
get-together before that.

alexis


On Fri, Nov 27, 2009 at 11:58 AM, Geir Magnusson Jr. <geir at pobox.com> wrote:
> Any specific date and time?
>
> geir
>
> On Nov 27, 2009, at 5:47 AM, Alexis Richardson wrote:
>
>> Hi folks,
>>
>> If you are in or near London: we plan to have a small xmas party
>> jointly with Redmonk, Homecamp, Pubsub and some other good folks who
>> work near RabbitHQ.
>>
>> Please put it in your diaries and *please* email me off list if you
>> plan to come.
>>
>> Cheers
>>
>> alexis
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From scottblanc at gmail.com  Fri Nov 27 16:18:49 2009
From: scottblanc at gmail.com (scott w)
Date: Fri, 27 Nov 2009 08:18:49 -0800
Subject: [rabbitmq-discuss] Slow throughput on consume side using java
	client API
In-Reply-To: <20091126101033.GA22260@mrnibble.lshift.net>
References: <401b577e0911251719tfd405auaf542a8c87b54b3@mail.gmail.com>
	<20091126101033.GA22260@mrnibble.lshift.net>
Message-ID: <401b577e0911270818o769f5db1q391261c79a21469b@mail.gmail.com>

Hi Matthew --

Thanks for the feedback. Comments below.

cheers,
Scott

On Thu, Nov 26, 2009 at 2:10 AM, Matthew Sackman <matthew at lshift.net> wrote:

> Hi Scott,
>
> I must admit I'm a little confused by your description as it would
> appear somewhat complex to me. However, am I correct in the following?
>

Not quite. Let me clarify.

>
> 1. You have 1 queue, which is being published to by 50 threads.
>

Yes although for the purposes of this discussion the publishing side is not
important. You can just assume the queue is filled up with thousands of
messages.


> 2. You have 25 consumers on that queue.
>

2a. 50 threads calling the equivalent of queue.pop()

2b. Within the queue, I have 25 QueueConsumers and 25 channel (each
QueueConsumer takes in 1 channel in its constructor and there is a 1-1
mapping between QueueConsumer and channel)


> 3. To receive, you randomly select a consumer, and get that consumer to
> consume a message.
>

Right so one of 50 threads will call queue.pop(), and internally picks a
random channel, synchronizes on that channel, and then calls consume on the
QueueConsumer that maps 1-1 with that channel.


> If that's correct, I'm not surprised by your findings. Consumers on a
> queue are round-robin'd by the broker. Thus each of your 25 consumers
> will receive one 25th of the messages. Thus if you randomly select a
> consumer then it may well have nothing waiting on it as messages have
> been sent to the other consumers.


This would definitely be true if there was only a single thread. In the case
where there are 50 threads and 25 queue consumers/channels, then on average
there will be 2 threads working on any individual queue consumer/channel.
When the queue starts to drain out, i.e. is almost empty, the impl as I have
it can be sub optimal since some threads may be asking to work on queue
consumers that are empty when there are other queue consumers that have work
to do (something I need to fix) but when the queue isn't close to draining
out, I don't think there should be the problem you describe. I do see the
read throughput go down as it starts to drain out but the 50 reads / sec I
was describing is before it starts to drain.



> Thus you will have to wait for up to
> 25 publishes before that consumer gets a message.
>
> Why are you using so many threads and consumers?
>

I started with one thread and one consumer and was seeing unacceptable read
throughput (well under 10 reads/sec) so I decided to make the # channels of
and threads parameterizable. After trying various permutations, I found 50
threads and 25 channels to work better than other choices although it wasn't
as scientific as it could be.

The documentation says you can not have multiple threads going against a
single channel so my assumption was that if I need to bump up performance
with multiple threads I would need multiple channels and hence multiple
queue consumers (since it doesn't appear you can have a single queue
consumer going against multiple channels)t. Please correct me if I am wrong.
Or even better if you have some consumer side java code you can share that
you know gives high read throughput, if you wouldn't mind sharing that would
be very much appreciated.

thanks,
Scott
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091127/d2ca9aea/attachment.htm 

From 0x6e6562 at gmail.com  Fri Nov 27 19:14:49 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 27 Nov 2009 19:14:49 +0000
Subject: [rabbitmq-discuss] Error during "make" of RabbitMQ Erlang
	client - File operation error
In-Reply-To: <7843363470016095814@unknownmsgid>
References: <7843363470016095814@unknownmsgid>
Message-ID: <269388e30911271114u423da76erf9b987a6b41d11d9@mail.gmail.com>

Lynton,

On Fri, Nov 6, 2009 at 6:32 AM, Lynton Grice
<lynton.grice at logosworld.com> wrote:
> ERL_LIBS=deps:dist erlc -I include -o ebin -Wall -v +debug_info
> src/amqp_channel.erl
> {error_logger,{{2009,11,6},{6,31,14}},std_error,"File operation error: eio.
> Target: deps:dist. Function: list_dir. Process: code_server."}

If you put the definition of ERL_LIBS in quotation marks, then make
under cygwin doesn't barf:

LIBS_PATH=ERL_LIBS="$(DEPS_DIR);$(DIST_DIR);$(ERL_LIBS)"

However, to get the tests to run you'll need to put erl_call in your
path and the dependency resolution still appears to cycle a bit.

Unfortunately the build process not very Windows friendly :-(

Ben



From michael.justin at gmx.net  Fri Nov 27 19:25:56 2009
From: michael.justin at gmx.net (Michael Justin)
Date: Fri, 27 Nov 2009 20:25:56 +0100
Subject: [rabbitmq-discuss] Amazon EC2 image with Stomp support available?
Message-ID: <4B1027C4.4030201@gmx.net>

Hello,

is there a EC2 RabbitMQ image available which has Stomp enabled? This 
would offer a great way to develop and demonstrate client libraries.

Many thanks in advance,

-- 
Michael Justin
SCJP, SCJA
betasoft - Software for Delphi? and for the Java? platform
http://www.mikejustin.com - http://www.betabeans.de




From scottblanc at gmail.com  Fri Nov 27 21:31:35 2009
From: scottblanc at gmail.com (scott w)
Date: Fri, 27 Nov 2009 13:31:35 -0800
Subject: [rabbitmq-discuss] Slow throughput on consume side using java
	client API
In-Reply-To: <401b577e0911270818o769f5db1q391261c79a21469b@mail.gmail.com>
References: <401b577e0911251719tfd405auaf542a8c87b54b3@mail.gmail.com>
	<20091126101033.GA22260@mrnibble.lshift.net>
	<401b577e0911270818o769f5db1q391261c79a21469b@mail.gmail.com>
Message-ID: <401b577e0911271331t328ef42ci6ce17cb8ec26f0bf@mail.gmail.com>

Just to follow up on my earlier email, I have discovered the culprit. I had
been running the rabbitmq server on EC2 and my performance tests on my
laptop. When I switch to also running the rabbitmq server on my laptop the
read throughput looks great. I'm not sure why the read throughput (and not
the write throughput) slows down so much when running on EC2 but at least
it's good the problem is not coming from rabbitmq.

thanks,
Scott

On Fri, Nov 27, 2009 at 8:18 AM, scott w <scottblanc at gmail.com> wrote:

> Hi Matthew --
>
> Thanks for the feedback. Comments below.
>
> cheers,
> Scott
>
> On Thu, Nov 26, 2009 at 2:10 AM, Matthew Sackman <matthew at lshift.net>wrote:
>
>> Hi Scott,
>>
>> I must admit I'm a little confused by your description as it would
>> appear somewhat complex to me. However, am I correct in the following?
>>
>
> Not quite. Let me clarify.
>
>>
>> 1. You have 1 queue, which is being published to by 50 threads.
>>
>
> Yes although for the purposes of this discussion the publishing side is not
> important. You can just assume the queue is filled up with thousands of
> messages.
>
>
>> 2. You have 25 consumers on that queue.
>>
>
> 2a. 50 threads calling the equivalent of queue.pop()
>
> 2b. Within the queue, I have 25 QueueConsumers and 25 channel (each
> QueueConsumer takes in 1 channel in its constructor and there is a 1-1
> mapping between QueueConsumer and channel)
>
>
>> 3. To receive, you randomly select a consumer, and get that consumer to
>> consume a message.
>>
>
> Right so one of 50 threads will call queue.pop(), and internally picks a
> random channel, synchronizes on that channel, and then calls consume on the
> QueueConsumer that maps 1-1 with that channel.
>
>
>> If that's correct, I'm not surprised by your findings. Consumers on a
>> queue are round-robin'd by the broker. Thus each of your 25 consumers
>> will receive one 25th of the messages. Thus if you randomly select a
>> consumer then it may well have nothing waiting on it as messages have
>> been sent to the other consumers.
>
>
> This would definitely be true if there was only a single thread. In the
> case where there are 50 threads and 25 queue consumers/channels, then on
> average there will be 2 threads working on any individual queue
> consumer/channel. When the queue starts to drain out, i.e. is almost empty,
> the impl as I have it can be sub optimal since some threads may be asking to
> work on queue consumers that are empty when there are other queue consumers
> that have work to do (something I need to fix) but when the queue isn't
> close to draining out, I don't think there should be the problem you
> describe. I do see the read throughput go down as it starts to drain out but
> the 50 reads / sec I was describing is before it starts to drain.
>
>
>
>> Thus you will have to wait for up to
>> 25 publishes before that consumer gets a message.
>>
>> Why are you using so many threads and consumers?
>>
>
> I started with one thread and one consumer and was seeing unacceptable read
> throughput (well under 10 reads/sec) so I decided to make the # channels of
> and threads parameterizable. After trying various permutations, I found 50
> threads and 25 channels to work better than other choices although it wasn't
> as scientific as it could be.
>
> The documentation says you can not have multiple threads going against a
> single channel so my assumption was that if I need to bump up performance
> with multiple threads I would need multiple channels and hence multiple
> queue consumers (since it doesn't appear you can have a single queue
> consumer going against multiple channels)t. Please correct me if I am wrong.
> Or even better if you have some consumer side java code you can share that
> you know gives high read throughput, if you wouldn't mind sharing that would
> be very much appreciated.
>
> thanks,
> Scott
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091127/116fe9f7/attachment.htm 

From michael.justin at gmx.net  Sat Nov 28 07:53:23 2009
From: michael.justin at gmx.net (Michael Justin)
Date: Sat, 28 Nov 2009 08:53:23 +0100
Subject: [rabbitmq-discuss] content-type for binary Stomp messages
Message-ID: <4B10D6F3.2000001@gmx.net>

For bytes messages transferred over the Stomp adapter, is 
application/octet-stream the correct value of the content-type header?

Best regards,

-- 
Michael Justin
SCJP, SCJA
betasoft - Software for Delphi? and for the Java? platform
http://www.mikejustin.com - http://www.betabeans.de




From alexis.richardson at gmail.com  Sat Nov 28 10:36:41 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sat, 28 Nov 2009 10:36:41 +0000
Subject: [rabbitmq-discuss] ANN: Delphi client library for RabbitMQ AMQP
	message broker
In-Reply-To: <4B0E9A62.60304@gmx.net>
References: <4B0E9A62.60304@gmx.net>
Message-ID: <167204d20911280236p3068a024j666dfa17614b57f@mail.gmail.com>

Michael

Thanks very much for releasing this!

alexis


On Thu, Nov 26, 2009 at 3:10 PM, Michael Justin <michael.justin at gmx.net> wrote:
> betasoft <http://www.mikejustin.com/> started the beta test of the
> Habari RabbitMQ Client library for Delphi and Free Pascal today.
>
> Habari RabbitMQ Client uses the Stomp message protocol and a plug-in
> architecture for communication libraries and message transformers for
> XML and JSON <http://en.wikipedia.org/wiki/Json> object serialization.
> It follows the specification of the JMS (Java Message Service
> <http://en.wikipedia.org/wiki/Java_Message_Service>) API for Message
> Oriented Middleware.
>
> Read the full announcement here:
>
> https://forums.embarcadero.com/thread.jspa?threadID=28862
>
> /RabbitMQ? is a Trademark of Rabbit Technologies Ltd./
>
> --
> Michael Justin
> SCJP, SCJA
> betasoft - Software for Delphi? and for the Java? platform
> http://www.mikejustin.com - http://www.betabeans.de
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From rabbitmq at tmm1.net  Sun Nov 29 03:49:57 2009
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Sat, 28 Nov 2009 22:49:57 -0500
Subject: [rabbitmq-discuss] Channel.Close w/ subscribed consumers
Message-ID: <e1c05edd0911281949l1dc5af48qe8e992ade8942802@mail.gmail.com>

With the latest rabbitmq, I'm seeing strange behavior where a
Channel.Close is not acknowledged with a Close-Ok until after
subscribed consumers on that channel stop receiving messages. To
reproduce:

publisher process:
  publish message to test-queue at a high rate (500 messages/second)

subscriber process:
  subscribe to test-queue
  send a Channel.Close on the channel after 1 second

A Channel.CloseOk will not be received until after the publisher
process is stopped and all the messages in the queue are consumed by
the subscriber.

  Aman



From jewel at subvert-the-dominant-paradigm.net  Sun Nov 29 07:10:35 2009
From: jewel at subvert-the-dominant-paradigm.net (John Leuner)
Date: Sun, 29 Nov 2009 09:10:35 +0200
Subject: [rabbitmq-discuss] [Fwd: Bug#558462: rabbitmq-server logs in as
 rabbitmq and hangs on pam_mount password prompt]
Message-ID: <1259478635.12342.4.camel@cmalu.WAG54GS>


-------------- next part --------------
An embedded message was scrubbed...
From: Florin Iucha <florin at iucha.net>
Subject: Bug#558462: rabbitmq-server logs in as rabbitmq and hangs on
 pam_mount password prompt
Date: Sat, 28 Nov 2009 22:32:15 -0600
Size: 6524
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091129/e8b30015/attachment.eml 

From david.wragg at lshift.net  Sun Nov 29 09:58:07 2009
From: david.wragg at lshift.net (David Wragg)
Date: Sun, 29 Nov 2009 09:58:07 +0000
Subject: [rabbitmq-discuss] [Fwd: Bug#558462: rabbitmq-server logs in as
	rabbitmq and hangs on pam_mount password prompt]
References: <1259478635.12342.4.camel@cmalu.WAG54GS>
Message-ID: <k5r5rh8xg0.fsf@mrbraver.lshift.net>

Hi John,

Thanks for forwarding this bug report.

John Leuner <jewel at subvert-the-dominant-paradigm.net> writes:
> [...]
> zeus:~# cd /var/log/rabbitmq/
> zeus:/var/log/rabbitmq# ls -la
> total 8
> drwxr-xr-x  2 rabbitmq rabbitmq   42 2009-11-28 22:16 .
> drwxr-xr-x 15 root     root     4096 2009-11-28 22:16 ..
> -rw-r--r--  1 root     root       31 2009-11-28 22:16 startup_err
> -rw-r--r--  1 root     root        0 2009-11-28 22:16 startup_log
> zeus:/var/log/rabbitmq# cat startup_err 
> reenter password for pam_mount:zeus:/var/log/rabbitmq# 
>
> The home directories on this box are mounted over CIFS, so I'm using
> pam-mount and the option is "required".
>
> Is there something that can be done so rabbitmq doesn't go through PAM
> and doesn't get hung up on trying to mount some remote filesystems?

I don't think the rabbitmq packages are doing anything unusual, and I
wonder whether this affects any packages with init scripts that use
su, directly or indirectly, to start a daemon.  So it might be a case
of "well don't do that".  I find it strange that pam_mount doesn't
exclude system accounts (the rabbitmq user is created as a system
account).

One likely fix on Florin's side would be to edit /etc/pam.d/su to
remove the pam_mount lines.

David

-- 
 [][][] David Wragg       | mail: david.wragg at lshift.net
   [][] Senior Developer  | tel: +44 (0)20 7729 7060
 []  [] LShift Ltd        | web: www.lshift.net



From matthias at lshift.net  Mon Nov 30 10:16:32 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 30 Nov 2009 10:16:32 +0000
Subject: [rabbitmq-discuss] testing RabbitMQ under high load
In-Reply-To: <871vjy1fe1.fsf@goryachev.org>
References: <87ocngggr1.fsf@goryachev.org>	<167204d20911060216t1e3ca58cyf2f0c6553f255790@mail.gmail.com>	<87y6mjgau9.fsf@goryachev.org>	<167204d20911060323w1af25ad2tdd3ece2db7c0f788@mail.gmail.com>	<87tyx7g54h.fsf@goryachev.org>
	<4AF9B19E.6090404@lshift.net> <871vjy1fe1.fsf@goryachev.org>
Message-ID: <4B139B80.4010104@lshift.net>

Igor,

Igor Goryachev wrote:
> On Tue, Nov 10, 2009 at 21:31, Tony Garnock-Jones wrote:
> 
>>> Ok. I have started implementation of AMQP plugin for Tsung. Details will
>>> follow a bit later.
>> That's exciting! Please keep us informed.
> 
> The work is in progress. The only one problem I've met is that Tsung
> modules designed to operate bare sockets and raw protocols. Is it
> possible somehow to get raw protocol methods within erlang amqp client
> (or rabbitmq itself)? Well, and I am not very familiar with amqp
> protocol yet... Any advices?

What do you mean by "raw protocol methods"?


Regards,

Matthias.



From matthias at lshift.net  Mon Nov 30 11:25:21 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 30 Nov 2009 11:25:21 +0000
Subject: [rabbitmq-discuss] RabbitMQ/Stomp on Windows
In-Reply-To: <4B0E41CD.6020909@gmx.net>
References: <4B0E41CD.6020909@gmx.net>
Message-ID: <4B13ABA1.7000806@lshift.net>

Michael,

Michael Justin wrote:
> is it possible to transfer the compiled code of the Stomp adapter to a 
> Windows box,

Yes, as long as the version of Erlang you are running on the Windows box 
is the same or more recent than the one where you did the compilation.

> and modify the startup script for the the Windows  distribution so
> that it uses the Stomp adapter?

There is no need to modify any startup scripts; the required 
configuration for the stomp plug-in can be added to the configuration 
file - see http://www.rabbitmq.com/install.html#configfile.


Regards,

Matthias.



From matthias at lshift.net  Mon Nov 30 11:43:26 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 30 Nov 2009 11:43:26 +0000
Subject: [rabbitmq-discuss] intermittent disconnects under load
In-Reply-To: <4B0F249D.8050903@gojko.com>
References: <4B0F249D.8050903@gojko.com>
Message-ID: <4B13AFDE.3060401@lshift.net>

Gojko,

Gojko Adzic wrote:
> we had a round of stress testing and got intermittent connection errors. 
> I don't know exactly what causes it but the Java client throws this 
> exception from a background thread and packets don't go completely to 
> the client. We ran it on a cluster of two nodes, using Java clients.
> 
> Exception in thread "Thread-22" 
> com.rabbitmq.client.ShutdownSignalException: connection error; reason: 
> java.lang.NullPointerException
> at com.rabbitmq.client.impl.AMQConnection.shutdown(AMQConnection.java:588)
> at 
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:454)
> Caused by: java.lang.NullPointerException
> at 
> com.rabbitmq.client.impl.AMQConnection$MainLoop.run(AMQConnection.java:438)
> 
> 
> Line above 438 of AMQConnection says "//FIXME: catch 
> NullPointerException and throw more informative one?" so I guess this is 
> a well known problem - any hints on what is causing it and how to work 
> around it until a fix is in place?

Looking at the code, the NPE would result if an incoming frame 
references a channel that does not exist. I can't see how that can 
happen unless the server is misbehaving (which it shouldn't - I am 
assuming you are talking to a RabbitMQ server, right?). I've had a quick 
look through our channel closing code for any obvious race condition, 
but it seems fine.

Is the above reproducible, and if so, can you send us the code & 
instructions?


Regards,

Matthias



From matthias at lshift.net  Mon Nov 30 12:26:22 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 30 Nov 2009 12:26:22 +0000
Subject: [rabbitmq-discuss] Channel.Close w/ subscribed consumers
In-Reply-To: <e1c05edd0911281949l1dc5af48qe8e992ade8942802@mail.gmail.com>
References: <e1c05edd0911281949l1dc5af48qe8e992ade8942802@mail.gmail.com>
Message-ID: <4B13B9EE.7030309@lshift.net>

Aman,

Aman Gupta wrote:
> With the latest rabbitmq, I'm seeing strange behavior where a
> Channel.Close is not acknowledged with a Close-Ok until after
> subscribed consumers on that channel stop receiving messages.

latest == RabbitMQ 1.7.0?

I don't recall any changes in that area vs 1.6.x

> To reproduce:
> 
> publisher process:
>   publish message to test-queue at a high rate (500 messages/second)
> 
> subscriber process:
>   subscribe to test-queue
>   send a Channel.Close on the channel after 1 second
> 
> A Channel.CloseOk will not be received until after the publisher
> process is stopped and all the messages in the queue are consumed by
> the subscriber.

Can you send us the complete code to reproduce this?


Regards,

Matthias.



From matthias at lshift.net  Mon Nov 30 12:38:42 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 30 Nov 2009 12:38:42 +0000
Subject: [rabbitmq-discuss] content-type for binary Stomp messages
In-Reply-To: <4B10D6F3.2000001@gmx.net>
References: <4B10D6F3.2000001@gmx.net>
Message-ID: <4B13BCD2.6000607@lshift.net>

Michael,

Michael Justin wrote:
> For bytes messages transferred over the Stomp adapter, is 
> application/octet-stream the correct value of the content-type header?

The server pays no attention to the content-type header; it just passes 
it through. Hence you can set it to whatever you like.


Regards,

Matthias.



From majek04 at gmail.com  Mon Nov 30 14:39:37 2009
From: majek04 at gmail.com (majek04)
Date: Mon, 30 Nov 2009 14:39:37 +0000
Subject: [rabbitmq-discuss] Amazon EC2 image with Stomp support available?
In-Reply-To: <3bb0d9710911300638s5f08936etc9ece75efd5b921@mail.gmail.com>
References: <4B1027C4.4030201@gmx.net>
	<3bb0d9710911300638s5f08936etc9ece75efd5b921@mail.gmail.com>
Message-ID: <3bb0d9710911300639y33c69a44k2678a73f6aea15f4@mail.gmail.com>

On Fri, Nov 27, 2009 at 19:25, Michael Justin <michael.justin at gmx.net> wrote:
> Hello,
>
> is there a EC2 RabbitMQ image available which has Stomp enabled? This
> would offer a great way to develop and demonstrate client libraries.
>
> Many thanks in advance,


Justin,

Currently there's only a EC2 image with basic RabbitMQ. If you need
stomp, you can just install stomp plugin.

So you can run rabbit ec2 instance. I prepared stomp binaries,
you can get them from:
http://dev.lshift.net/majek/rabbitmq-stomp_1.7.0.tar.gz

Though, beware, I haven't tested them carefully.

To install it:
0. download the tarball onto the instance.
1. extract .ez files into
/usr/lib/rabbitmq/lib/rabbitmq_server-1.7.0/plugins

2. run
rabbitmq-activate-plugins
you can ignore *WARNING* lines

3. restart rabbit
/etc/init.d/rabbitmq-server restart

4. enjoy your stomp plugin under:
127.0.0.1:61613


Cheers!
? Marek Majkowski



From matthew at lshift.net  Mon Nov 30 17:42:47 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Mon, 30 Nov 2009 17:42:47 +0000
Subject: [rabbitmq-discuss] Bleeding edge persister and Erlang R13B03
Message-ID: <20091130174247.GK22260@mrnibble.lshift.net>

Hi,

For those of you testing the new persister (branch bug21673), you are
well advised to use Erlang R13B03, and not any version prior to this.
The reason is that in R13B02 and earlier, the garbage collector doesn't
seem to do much. This has a very bad effect on the new persister. R13B03
behaves quite wonderfully in comparison.

Typically, for a process state of about 20MB in size, in R13B02, we see
around 500MB allocated, and manually calling garbage_collect doesn't
shrink it much. In R13B03, for the same amount of process state, we see
about 40MB allocated - i.e. about twice as much as strictly necessary
(which seems to be sensible given garbage collection), as opposed to
more than 20 times as much.

In fact, for those of you using v1.7.0 or any other version of Rabbit,
it's quite likely the improvements to garbage collection in R13B03 are
going to be beneficial.

Matthew



From rabbitmq at tmm1.net  Mon Nov 30 19:43:23 2009
From: rabbitmq at tmm1.net (Aman Gupta)
Date: Mon, 30 Nov 2009 14:43:23 -0500
Subject: [rabbitmq-discuss] Channel.Close w/ subscribed consumers
In-Reply-To: <4B13B9EE.7030309@lshift.net>
References: <e1c05edd0911281949l1dc5af48qe8e992ade8942802@mail.gmail.com> 
	<4B13B9EE.7030309@lshift.net>
Message-ID: <e1c05edd0911301143o76830c2i5bf083d2b66ce803@mail.gmail.com>

On Mon, Nov 30, 2009 at 7:26 AM, Matthias Radestock <matthias at lshift.net> wrote:
> Aman,
>
> Aman Gupta wrote:
>>
>> With the latest rabbitmq, I'm seeing strange behavior where a
>> Channel.Close is not acknowledged with a Close-Ok until after
>> subscribed consumers on that channel stop receiving messages.
>
> latest == RabbitMQ 1.7.0?
>
> I don't recall any changes in that area vs 1.6.x

I haven't tested this since rabbit 1.4, so I'm not sure when the
behavior changed. I'm currently testing with the hg default branch.

>
>> To reproduce:
>>
>> publisher process:
>> ?publish message to test-queue at a high rate (500 messages/second)
>>
>> subscriber process:
>> ?subscribe to test-queue
>> ?send a Channel.Close on the channel after 1 second
>>
>> A Channel.CloseOk will not be received until after the publisher
>> process is stopped and all the messages in the queue are consumed by
>> the subscriber.
>
> Can you send us the complete code to reproduce this?

Sure:

publisher.rb:

require 'mq'
AMQP.start(:host => 'localhost') do
  EM.add_periodic_timer(0) {
    puts "Publishing #{Time.now}"
    MQ.queue("testqueue").publish("message: #{Time.now}")
  }
end


subscriber.rb:

require 'mq'
trap("INT") { puts "calling amqp.stop @ #{Time.now}"; AMQP.stop { puts
"inside amqp.stop @ #{Time.now}"; EM.stop } }
# AMQP.logging=true
AMQP.start(:host => 'localhost') do
  MQ.queue("testqueue").subscribe do |msg|
    puts "Got message: #{msg.inspect}"
    #sleep 1
  end
end


sending the subscriber process a SIGINT will send a Channel.Close.
When a Channel.Close-Ok is received, it prints out "inside amqp.stop"
and ends the process. This never happens while the publisher is still
running.

  Aman

>
>
> Regards,
>
> Matthias.
>



From matthias at lshift.net  Mon Nov 30 21:06:42 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 30 Nov 2009 21:06:42 +0000
Subject: [rabbitmq-discuss] Channel.Close w/ subscribed consumers
In-Reply-To: <e1c05edd0911301143o76830c2i5bf083d2b66ce803@mail.gmail.com>
References: <e1c05edd0911281949l1dc5af48qe8e992ade8942802@mail.gmail.com>
	<4B13B9EE.7030309@lshift.net>
	<e1c05edd0911301143o76830c2i5bf083d2b66ce803@mail.gmail.com>
Message-ID: <4B1433E2.702@lshift.net>

Aman,

Aman Gupta wrote:
> I haven't tested this since rabbit 1.4, so I'm not sure when the
> behavior changed. I'm currently testing with the hg default branch.

Ok. There definitely have been changes in that area since 1.4.

>> Can you send us the complete code to reproduce this?
> 
> Sure:

Thanks. I'm not sure when I will find time to look into this. If you 
want to progress things in the meantime, it would be really useful to 
get a trace of the interactions between the client and the server, 
captured with http://www.rabbitmq.com/examples.html#tracer. That will 
tell us whether the server is doing anything odd.


Matthias.



From scott.brooks at epicadvertising.com  Mon Nov 30 21:16:25 2009
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Mon, 30 Nov 2009 15:16:25 -0600
Subject: [rabbitmq-discuss] RabbitMQ SNMP Plugin
Message-ID: <92562906-5DA3-452A-B7B1-3EF2B47B11E9@epicadvertising.com>

I'm getting to the last stages of a SNMP plugin to expose the info provided by rabbitmqctl.  I've attached the output from some snmptable commands.

As I'm finishing off the plugin, I'm guessing that it would probably be worthwhile to have this included as a core piece of RabbitMQ.  The plugin is not really doing anything different compared to running rabbitmqctl from the erlang side, and that probably wouldn't scale that well for large servers.  Having that information be published to the snmp agent would probably scale better.

LShift: Is there much enthusiasm for having SNMP support builtin to rabbit?  Or should I keep pursing the plugin side.


-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: exchanges.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091130/8ecbe0bb/attachment.txt 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: queues.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091130/8ecbe0bb/attachment-0001.txt 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: vhosts.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091130/8ecbe0bb/attachment-0002.txt 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ATT00001.c
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20091130/8ecbe0bb/attachment-0003.txt 

From matthias at lshift.net  Mon Nov 30 21:37:40 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 30 Nov 2009 21:37:40 +0000
Subject: [rabbitmq-discuss] RabbitMQ SNMP Plugin
In-Reply-To: <92562906-5DA3-452A-B7B1-3EF2B47B11E9@epicadvertising.com>
References: <92562906-5DA3-452A-B7B1-3EF2B47B11E9@epicadvertising.com>
Message-ID: <4B143B24.4020600@lshift.net>

Scott,

Scott Brooks wrote:
> I'm getting to the last stages of a SNMP plugin to expose the info
> provided by rabbitmqctl.  I've attached the output from some
> snmptable commands.

Very nice. Would you mind posting / pointing us at the MIB?

> LShift: Is there much enthusiasm for having SNMP support builtin to
> rabbit?  Or should I keep pursing the plugin side.

We'd definitely like to see SNMP support shipping with the core broker. 
But switching from a plug-in to a core broker component should be 
straightforward, so until the code has matured it's probably best to 
keep it as a plug-in.


Regards,

Matthias.



