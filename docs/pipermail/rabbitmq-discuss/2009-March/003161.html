<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ Cluster, option &quot;-setcookie cookie&quot; + 	EC2 experiences
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20Cluster%2C%0A%20option%20%22-setcookie%20cookie%22%20%2B%20%09EC2%20experiences&In-Reply-To=d272f0690903131903r46d57f33p28a8191266232c51%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003160.html">
   <LINK REL="Next"  HREF="003174.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ Cluster, option &quot;-setcookie cookie&quot; + 	EC2 experiences</H1>
    <B>Dmitriy Samovskiy</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20RabbitMQ%20Cluster%2C%0A%20option%20%22-setcookie%20cookie%22%20%2B%20%09EC2%20experiences&In-Reply-To=d272f0690903131903r46d57f33p28a8191266232c51%40mail.gmail.com"
       TITLE="[rabbitmq-discuss] RabbitMQ Cluster, option &quot;-setcookie cookie&quot; + 	EC2 experiences">dmitriy.samovskiy at cohesiveft.com
       </A><BR>
    <I>Sun Mar 15 04:42:01 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003160.html">[rabbitmq-discuss] RabbitMQ Cluster,	option &quot;-setcookie cookie&quot; + 	EC2 experiences
</A></li>
        <LI>Next message: <A HREF="003174.html">[rabbitmq-discuss] RabbitMQ Cluster,	option &quot;-setcookie cookie&quot; + 	EC2 experiences
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3161">[ date ]</a>
              <a href="thread.html#3161">[ thread ]</a>
              <a href="subject.html#3161">[ subject ]</a>
              <a href="author.html#3161">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi Alex,

Alex Clemesha wrote:
&gt;&gt;&gt;<i>  Im getting: socket.gaierror: (8, 'nodename nor servname provided, or
</I>&gt;&gt;&gt;<i> not known') when trying to attach a client to second broker (in the
</I>&gt;&gt;&gt;<i> cluster).
</I>&gt;&gt;<i> That looks like an error thrown by the python client library and, on the
</I>&gt;&gt;<i> surface of it, does not appear to indicate a problem with the RabbitMQ
</I>&gt;&gt;<i> broker. Do the connection attempts show up in the server logs at all?
</I>&gt;<i> 
</I>&gt;<i> I've gotten to the root of the problem - it has to do with the fact
</I>&gt;<i> that the second
</I>&gt;<i> rabbit broker is doing a redirect, i.e, from
</I>&gt;<i> /var/log/rabbitmq/rabbit.log I see:
</I>&gt;<i> 
</I>&gt;<i> INFO REPORT==== 14-Mar-2009::00:18:55 ===
</I>&gt;<i> connection &lt;0.16842.0&gt; redirecting to
</I>&gt;<i> &lt;&lt;&quot;domU-12-31-39-00-7E-16.compute-1.internal:5672&quot;&gt;&gt;
</I>This name (*.internal) is an
internal DNS name that resolves only in EC2 region where your brokers are running. Clients
connecting from another region (regions are US or EU) or from Internet will not be able to
resolve this - they should be using the instance's public DNS name.

Python on my mac does raise gaierror 8 when I tried to connect to unresolvable name (see 
below). Interestingly, python in Linux raised gaierror -2 'Name or service not known'.

$ python
Python 2.5.1 (r251:54863, Apr 15 2008, 22:57:26)
[GCC 4.0.1 (Apple Inc. build 5465)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
 &gt;&gt;&gt; import socket
 &gt;&gt;&gt; sock = socket.socket()
 &gt;&gt;&gt; sock.connect(('foo.bar.internal', 5672))
Traceback (most recent call last):
   File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
   File &quot;&lt;string&gt;&quot;, line 1, in connect
socket.gaierror: (8, 'nodename nor servname provided, or not known')



You *might* get rabbit to put right name into known_hosts field by associating public DNS 
name of rabbit instance (ec2*.amazonaws.com) with its private IP address (10.X.X.X) in 
/etc/hosts. Or do client side load balancing with insist=True, like you said.

Also, here is a link to a potentially related thread:
<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-September/001901.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2008-September/001901.html</A>




- Dmitriy


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003160.html">[rabbitmq-discuss] RabbitMQ Cluster,	option &quot;-setcookie cookie&quot; + 	EC2 experiences
</A></li>
	<LI>Next message: <A HREF="003174.html">[rabbitmq-discuss] RabbitMQ Cluster,	option &quot;-setcookie cookie&quot; + 	EC2 experiences
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3161">[ date ]</a>
              <a href="thread.html#3161">[ thread ]</a>
              <a href="subject.html#3161">[ subject ]</a>
              <a href="author.html#3161">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
