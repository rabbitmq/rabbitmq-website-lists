<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] max amount of persisted data
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20max%20amount%20of%20persisted%20data&In-Reply-To=49BF9214.1080402%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003190.html">
   <LINK REL="Next"  HREF="003199.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] max amount of persisted data</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20max%20amount%20of%20persisted%20data&In-Reply-To=49BF9214.1080402%40lshift.net"
       TITLE="[rabbitmq-discuss] max amount of persisted data">matthias at lshift.net
       </A><BR>
    <I>Wed Mar 18 07:52:05 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003190.html">[rabbitmq-discuss] max amount of persisted data
</A></li>
        <LI>Next message: <A HREF="003199.html">[rabbitmq-discuss] max amount of persisted data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3193">[ date ]</a>
              <a href="thread.html#3193">[ thread ]</a>
              <a href="subject.html#3193">[ subject ]</a>
              <a href="author.html#3193">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias Radestock wrote:
&gt;<i> unacked_message_q in rabbit_channel keeps track of the ids of
</I>&gt;<i> messages that have been sent to consumers but have not been ack'ed
</I>&gt;<i> yet. It does not hold undelivered messages and it does not hold
</I>&gt;<i> message content. That all happens in rabbit_amqqueue_process' #q.q
</I>&gt;<i> field (which I reckon Tony thought you were talking about), and
</I>&gt;<i> rabbit_persister's #psnapshot.queues field (for persistent messages).
</I>
Just to correct some minor inaccuracies in the above ...

- rabbit_channel's unacked_message_q does in fact hold message content, 
not just ids. But, as stated above, the messages are only those that 
have been sent to consumers and not yet acknowledged. So generally that 
should just be a few messages.

- The field in rabbit_amqqueue_process' #q state which contains the 
message queue is called 'message_buffer', not 'q'.

tsuraan wrote:
&gt;<i> can hot standby rabbits be made by rsync'ing the
</I>&gt;<i> /var/lib/rabbitmw/mnesia directory to another machine?  To rephrase
</I>&gt;<i> the question, is the data on disk always valid, or at least
</I>&gt;<i> recoverable?  Obviously any work done between the snapshot and the
</I>&gt;<i> machine failure would be lost, but would the on-disk data be usable?
</I>
There have been some discussions on the list about using a SAN to hold 
the /var/lib/rabbitmq/mnesia dir. Generally that (and the rsync 
technique you suggest) should work, and the data should be recoverable.

An important constraint is that the Erlang node name must remain 
unchanged, i.e. you must not use one node's /var/lib/rabbitmq/mnesia dir 
on a node with a different name.


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003190.html">[rabbitmq-discuss] max amount of persisted data
</A></li>
	<LI>Next message: <A HREF="003199.html">[rabbitmq-discuss] max amount of persisted data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3193">[ date ]</a>
              <a href="thread.html#3193">[ thread ]</a>
              <a href="subject.html#3193">[ subject ]</a>
              <a href="author.html#3193">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
