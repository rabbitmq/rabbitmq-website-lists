<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] GPB and AMQP/RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20GPB%20and%20AMQP/RabbitMQ&In-Reply-To=D4C5E348C434294AA040A57B0D3DF5ED02EA826D%40MER2-EXCHB1.echostar.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003242.html">
   <LINK REL="Next"  HREF="003249.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] GPB and AMQP/RabbitMQ</H1>
    <B>Kirk Wylie</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20GPB%20and%20AMQP/RabbitMQ&In-Reply-To=D4C5E348C434294AA040A57B0D3DF5ED02EA826D%40MER2-EXCHB1.echostar.com"
       TITLE="[rabbitmq-discuss] GPB and AMQP/RabbitMQ">kirk at kirkwylie.com
       </A><BR>
    <I>Wed Mar 25 22:39:39 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003242.html">[rabbitmq-discuss] GPB and AMQP/RabbitMQ
</A></li>
        <LI>Next message: <A HREF="003249.html">[rabbitmq-discuss] GPB and AMQP/RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3245">[ date ]</a>
              <a href="thread.html#3245">[ thread ]</a>
              <a href="subject.html#3245">[ subject ]</a>
              <a href="author.html#3245">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Mar 25, 2009 at 9:32 PM, Elsner, Robert
&lt;<A HREF="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">Robert.Elsner at echostar.com</A>&gt; wrote:
&gt;&gt;<i> Interestingly, when GPB came out, ActiveMQ did this precise
</I>&gt;&gt;<i> thing (to have a parallel wire protocol beyond the existing
</I>&gt;&gt;<i> ones that was based on using GPB as the wire representation),
</I>&gt;&gt;<i> and they said that it worked quite well. That being said, it
</I>&gt;&gt;<i> definitely wouldn't work for AMQP given that it is designed
</I>&gt;&gt;<i> as a completely neutral wire representation, but it might be
</I>&gt;&gt;<i> useful for members of the WG to know that many people find
</I>&gt;&gt;<i> the current wire encoding a bit too high-overhead.
</I>&gt;<i>
</I>&gt;<i> I did not know ActiveMQ had that, very interesting.
</I>
Bear in mind that I don't know where James went with it, I know that
he had the transport in an experimental branch, but I'm not sure if it
was anything other than a thought experiment for him. If nothing else,
the new transport was both faster and had lower CPU overhead than the
existing one, so he probably should have kept it. :-)

&gt;<i> &#160;The part I have
</I>&gt;<i> enjoyed the most about GPB is that the languages we use (C#, Java,
</I>&gt;<i> Erlang, C) have generated source, operate very similarly, and work
</I>&gt;<i> incredibly well. &#160;GPB versus our current packet format adds a little
</I>&gt;<i> overhead, but the flexibility and extensibility far exceeds what we've
</I>&gt;<i> done thus far. &#160;I know there are other libraries out there, do you know
</I>&gt;<i> if anyone has done anything similar with AMQP and the other formats?
</I>
There are plenty of people using Thrift in similar use cases, and some
stuff that I've done with other MOM infrastructure was relatively
similar (which I'll talk about in a little bit).

&gt;<i> I've looked over some of the AMQPWG posts and they do seem to have the
</I>&gt;<i> idea that the overhead can be a little bit extreme. &#160;Perhaps a push from
</I>&gt;<i> the RabbitMQ team to help work this out would be beneficial. &#160;Hopefully
</I>&gt;<i> some good things will come out of their next meeting.
</I>
And this is the time. AMQP 1.0 is under public review, so if you have
any comments, I'm sure you can pass them along to Alexis or another
Rabbit team member and they can help provide that feedback.

&gt;<i> I think if I was to go to GPB as a wireformat for AMQP, I would probably
</I>&gt;<i> wait until multicast udp/unicast udp support were added, and use the
</I>&gt;<i> datagram concept of UDP as the message delimiter. &#160;This might be
</I>&gt;<i> beneficial for my use, but adds a higher workload for the brokers.
</I>
That's quite an interesting concept, but in general, I think using
something like GPB isn't ideal for a fixed protocol like AMQP. AMQP
has to have at the wire level a very fixed, stable, well known
protocol for interoperability. That means that you're better off
defining the protocol itself in a very compact representation, because
you don't really care about the whole
generation-from-arbitrary-specification side that something like GPB
has, and any backwards compatibility has to be &quot;baked in&quot; to the
specification.

It also has to be a protocol which is particularly subject to hardware
implementation and stream analysis (think Wireshark). That has its own
protocol design requirements that something like GPB (which is a more
general purpose system) can ignore (varint128 is probably not ideal
for a small hardware implementation for example).

So in general, I think smaller framing overhead == Big Win, use of
GPB/Thrift itself == Unnecessary.

&gt;<i> The one factor I don't like about GPB is that it isn't self-describing,
</I>&gt;<i> to really understand a message one needs the .proto or the code
</I>&gt;<i> generated from it. &#160;For something like AMQP it might be more useful to
</I>&gt;<i> the community to pick a binary wireformat that encodes well, which also
</I>&gt;<i> self-describes its message.
</I>
This is where some work that I did at my last job may pay off.
Essentially, we rolled our own packed, binary, self-describing,
hierarchical message format. Extremely compact (minimum 10 bytes
overhead), fields were all self-describing with type information,
everything was easy to map into direct CPUs (no varints), and fully
hierarchical. Unfortunately that implementation is trapped at the
former employer, but they've given the go-ahead to support a cleanroom
implementation of the encoding and tools in the open source arena (and
plan on helping with the effort, since they don't want to own it long
term).

I'm more than willing to discuss what this (Fudge) is, since I'm
getting down to the clean room implementation these days if you think
it's interesting (I've gotten a lot of positive feedback). The
ultimate plan is to support a low-level message format (getField,
setField, that type of thing) as well as mapping to/from higher level
message representations (.proto, .xsd) and full XPath lookups.

Kirk


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003242.html">[rabbitmq-discuss] GPB and AMQP/RabbitMQ
</A></li>
	<LI>Next message: <A HREF="003249.html">[rabbitmq-discuss] GPB and AMQP/RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3245">[ date ]</a>
              <a href="thread.html#3245">[ thread ]</a>
              <a href="subject.html#3245">[ subject ]</a>
              <a href="author.html#3245">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
