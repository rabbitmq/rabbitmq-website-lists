<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] max amount of persisted data
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20max%20amount%20of%20persisted%20data&In-Reply-To=49BF83BE.8050100%40lshift.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003184.html">
   <LINK REL="Next"  HREF="003193.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] max amount of persisted data</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20max%20amount%20of%20persisted%20data&In-Reply-To=49BF83BE.8050100%40lshift.net"
       TITLE="[rabbitmq-discuss] max amount of persisted data">matthias at lshift.net
       </A><BR>
    <I>Tue Mar 17 12:05:40 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003184.html">[rabbitmq-discuss] max amount of persisted data
</A></li>
        <LI>Next message: <A HREF="003193.html">[rabbitmq-discuss] max amount of persisted data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3190">[ date ]</a>
              <a href="thread.html#3190">[ thread ]</a>
              <a href="subject.html#3190">[ subject ]</a>
              <a href="author.html#3190">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Tsuraan,

Tony Garnock-Jones wrote:
&gt;<i> Matthias Radestock wrote:
</I>&gt;&gt;<i> tsuraan wrote:
</I>&gt;&gt;&gt;<i> Would replacing the queue currently used for unacked_message_q in
</I>&gt;&gt;&gt;<i> rabbit_channel.erl with a queue that overflows to a tempfile be
</I>&gt;&gt;&gt;<i> sufficient to resolve this?
</I>&gt;&gt;<i> The short answer is 'no'.
</I>&gt;<i> 
</I>&gt;<i> :-) Or, seen another way, &quot;yes&quot;. It's a start. It'd work for when
</I>&gt;<i> non-persistent messages were being sent through the broker.
</I>
No, it won't. My original answer is correct. unacked_message_q in 
rabbit_channel keeps track of the ids of messages that have been sent to 
consumers but have not been ack'ed yet. It does not hold undelivered 
messages and it does not hold message content. That all happens in 
rabbit_amqqueue_process' #q.q field (which I reckon Tony thought you 
were talking about), and rabbit_persister's #psnapshot.queues field (for 
persistent messages).

&gt;<i> The full solution needs to carefully balance three interacting components:
</I>&gt;<i> 
</I>&gt;<i>  - persistent storage of messages
</I>&gt;<i>  - the memory needs of the queue-data-structure of messages in each
</I>&gt;<i>    AMQP-queue
</I>&gt;<i>  - TX-class transactions
</I>
+ fanout (not keeping multiple copies of messages)
+ clustering (which affects decisions on where messages should be 
persisted, and how recovery works)
+ non-linear access (for priorities and message expiry)
+ a few other things we will no doubt discover


Matthias.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003184.html">[rabbitmq-discuss] max amount of persisted data
</A></li>
	<LI>Next message: <A HREF="003193.html">[rabbitmq-discuss] max amount of persisted data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3190">[ date ]</a>
              <a href="thread.html#3190">[ thread ]</a>
              <a href="subject.html#3190">[ subject ]</a>
              <a href="author.html#3190">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
