<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] High cpu usage for Java RabbitMQ	client?	(solved, my fault)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20High%20cpu%20usage%20for%20Java%20RabbitMQ%0A%09client%3F%09%28solved%2C%20my%20fault%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003222.html">
   <LINK REL="Next"  HREF="003234.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] High cpu usage for Java RabbitMQ	client?	(solved, my fault)</H1>
    <B>Elsner, Robert</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=%5Brabbitmq-discuss%5D%20High%20cpu%20usage%20for%20Java%20RabbitMQ%0A%09client%3F%09%28solved%2C%20my%20fault%29&In-Reply-To="
       TITLE="[rabbitmq-discuss] High cpu usage for Java RabbitMQ	client?	(solved, my fault)">Robert.Elsner at echostar.com
       </A><BR>
    <I>Wed Mar 25 11:41:33 GMT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="003222.html">[rabbitmq-discuss] High cpu usage for Java RabbitMQ client?	(solved, my fault)
</A></li>
        <LI>Next message: <A HREF="003234.html">[rabbitmq-discuss] High cpu usage for Java RabbitMQ	client?	(solved, my fault)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3223">[ date ]</a>
              <a href="thread.html#3223">[ thread ]</a>
              <a href="subject.html#3223">[ subject ]</a>
              <a href="author.html#3223">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Matthias,

&gt;<i> The instructions do indeed need fixing. We are aware of that, but just
</I>&gt;<i> haven't found the time to do it yet.
</I>
There's never enough time for documentation :)

&gt;<i> &gt; Also, I have looked through the AMQP lists a little bit and saw some
</I>&gt;<i> &gt;  discussion of a compressed or binary wire format, specifically
</I>&gt;<i> &gt; relating to market quotes.  It looks like this is slated for 1.0, but
</I>&gt;<i> &gt; that would be ideal for me (since AMQP overhead is ~30-50% of my
</I>&gt;<i> &gt; message size now).  Is there a roadmap to adoption?
</I>&gt;<i> 
</I>&gt;<i> You are the first person to ask about this :) We have thought about more 
</I>&gt;<i> compact encodings for messaging than present in AMQP. See, for example 
</I>&gt;<i> Tony's &quot;Streamlining HTTP&quot; post 
</I>&gt;<i> (<A HREF="http://www.lshift.net/blog/2009/02/27/streamlining-http">http://www.lshift.net/blog/2009/02/27/streamlining-http</A>), but we have 
</I>&gt;<i> no concrete plans for implementation yet.
</I>
Have you thought about approaching the AMQP spec with Thrift or ProtocolBuffers encoding?  Tony's post is very much inline with what I've found, we have a few messages that are very small (24 bytes) and some that are larger (~500 bytes) so the AMQP overhead is very noticeable.  Disabling positive-ack from the queues helped alleviate some of the traffic, but not enough to matter.

&gt;<i> Does the overhead really cause problems in your setup? Do you end up 
</I>&gt;<i> saturating the network?
</I>
Well, our current system has about 50 clients each consuming a 3Mbps stream.  I was hoping to be able to swap out the backend to AMQP and then perform optimizations using the routing keys.  However, the AMQP &quot;stream&quot; would at that point bump to 5-6Mbps.  That's not too practical over our WAN links.  This just adds a little bit of effort to switch to AMQP, by reworking the client to query the more static data from a DB instead of streaming it over and over (so the discussions I've seen about last quote caching would be a nice feature).  The eventual goal is to have clustered brokers that do the traffic management between the remote nodes that generate messages, so that the data that needs to be routed across our WAN links is, but the majority of the data will stay local to the producers for archiving.

Thanks,
Rob

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090325/0dcf0afe/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090325/0dcf0afe/attachment.htm</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003222.html">[rabbitmq-discuss] High cpu usage for Java RabbitMQ client?	(solved, my fault)
</A></li>
	<LI>Next message: <A HREF="003234.html">[rabbitmq-discuss] High cpu usage for Java RabbitMQ	client?	(solved, my fault)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3223">[ date ]</a>
              <a href="thread.html#3223">[ thread ]</a>
              <a href="subject.html#3223">[ subject ]</a>
              <a href="author.html#3223">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
