From reverri at gmail.com  Wed Jul  1 00:46:57 2009
From: reverri at gmail.com (Dan Reverri)
Date: Tue, 30 Jun 2009 16:46:57 -0700
Subject: [rabbitmq-discuss] Sample code for python?
In-Reply-To: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
Message-ID: <e04d73f80906301646g53910225s379f732eedae80e8@mail.gmail.com>

On Tue, Jun 30, 2009 at 2:51 PM, Allen Fowler<allen.fowler at yahoo.com> wrote:
>
> Hello,
>
> I am looking at RabbitMQ to perhaps add message passing to a Python program being written.
>
> Right now "messages" are being pased in and out of a database. ?Not a very good solution.
>
> How hard is it to produce and consume messages from Python using RabbitMQ? ?What libraries do I need, and is there sample code ?/ tutorial available?
>
> Thank you,
> :)
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

Here are some introduction articles if you are interested in using
AMQP from Twisted:

Getting started with RabbitMQ, Python, Twisted, and txAMQP on Ubuntu 9.04
http://app.arat.us/blog/?p=38

Writing an AMQP connector with Python, Twisted, Trial and txAMQP
http://app.arat.us/blog/?p=112



From vivek.kubaji at onmobile.com  Wed Jul  1 06:52:22 2009
From: vivek.kubaji at onmobile.com (krv)
Date: Tue, 30 Jun 2009 22:52:22 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ/Spring integration - help required
In-Reply-To: <167204d20906291419x5122dbb9n31cc1e37a01ac295@mail.gmail.com>
References: <24203688.post@talk.nabble.com>
	<A767955DD6BCC54C99FC1C628AA8BBA009278BBF@newexchangemail.onmobile.com>
	<167204d20906291419x5122dbb9n31cc1e37a01ac295@mail.gmail.com>
Message-ID: <24284545.post@talk.nabble.com>


Hi Folks,

Thanks for your valuable suggestions, I was able to advance a bit.
Nevertheless I'm still stuck with getting 'rabbitmqctl.bat' working (Windows
env and user is neither 'rabbitmq' nor 'root'). I was caught up with
something else so couldn't look much into this. Will work on this today and
try to get it working.

Hope RabbitMQ does not have any issue running on Windows, cuz most of the
posts speak of running on Linux.

Regards,
Vivek


Alexis Richardson-4 wrote:
> 
> Vivek
> 
> Have you been able to resolve this issue?
> 
> alexis
> 
> 
> On Thu, Jun 25, 2009 at 4:18 PM, Vivek Ramesh.
> Kubaji<vivek.kubaji at onmobile.com> wrote:
>> Hi,
>>
>>
>>
>> I'm trying to evaluate RabbitMQ for our project. And I'm using
>> Spring-integration framework. From the posts in the forum I ended up
>> using
>> the following configuration (jms part):
>>
>>
>>
>> ????? <beans:bean id="amqConnectionFactory"
>>
>> class="org.apache.qpid.client.AMQConnectionFactory">
>>
>> ??????????? <beans:constructor-arg
>>
>> value="amqp://guest:guest@/localhost?brokerlist='tcp://localhost:5672'"
>> />
>>
>> ????? </beans:bean>
>>
>>
>>
>> ????? <beans:bean id="connectionFactory"
>>
>> class="org.springframework.jms.connection.SingleConnectionFactory">
>>
>> ??????????? <beans:property name="targetConnectionFactory"
>>
>> ref="amqConnectionFactory"/>
>>
>> ????? </beans:bean>
>>
>>
>>
>> ????? <beans:bean id="jms_QueueWest"
>> class="org.apache.qpid.client.AMQQueue">
>>
>> ??????????? <beans:constructor-arg>
>>
>> ????????????????? <beans:bean class="org.apache.qpid.url.AMQBindingURL">
>>
>> ??????????????????????? <beans:constructor-arg value="${jms.queue1}"/>
>>
>> ????????????????? </beans:bean>
>>
>> ??????????? </beans:constructor-arg>
>>
>> ????? </beans:bean>
>>
>>
>>
>> and have this in my properties file:
>>
>>
>>
>> jms.queue1=direct://rabbit//my.queue1
>>
>>
>>
>> I'm running the RabbitMQ broker using the command
>> $RABBITMQ_HOME$/sbin/rabbitmq-server.bat. When I start my client
>> application
>> I am getting the following error:
>>
>>
>>
>> 2009-06-25 19:00:21,192 INFO
>>
>> org.springframework.jms.listener.DefaultMessageListenerContainer#0-1
>>
>> [DefaultMessageListenerContainer.refreshConnectionUntilSuccessful] -
>> Could
>> not refresh JMS Connection for destination
>> 'direct://rabbit/my.queue1/my.queue1?routingkey='my.queue1'' - retrying
>> in
>> 5000 ms. Cause: Error creating connection: Unable to Connect
>> org.apache.qpid.transport.ConnectionException
>>
>> ??????? at
>> org.apache.qpid.transport.Connection.close(Connection.java:494)
>>
>> ??????? at
>> org.apache.qpid.transport.Connection.connect(Connection.java:193)
>>
>> ??????? at
>>
>> org.apache.qpid.client.AMQConnectionDelegate_0_10.makeBrokerConnection(AMQConnectionDelegate_0_10.java:161)
>>
>> ??????? at
>>
>> org.apache.qpid.client.AMQConnection.makeBrokerConnection(AMQConnection.java:728)
>>
>> ??????? at
>>
>> org.apache.qpid.client.AMQConnection.<init>(AMQConnection.java:520)
>>
>> ??????? at
>>
>> org.apache.qpid.client.AMQConnectionFactory.createConnection(AMQConnectionFactory.java:276)
>>
>> ??????? at
>>
>> org.springframework.jms.connection.SingleConnectionFactory.doCreateConnection(SingleConnectionFactory.java:343)
>>
>> ??????? at
>>
>> org.springframework.jms.connection.SingleConnectionFactory.initConnection(SingleConnectionFactory.java:290)
>>
>> ??????? at
>>
>> org.springframework.jms.connection.SingleConnectionFactory.createConnection(SingleConnectionFactory.java:227)
>>
>> ??????? at
>>
>> org.springframework.jms.support.JmsAccessor.createConnection(JmsAccessor.java:184)
>>
>> ??????? at
>>
>> org.springframework.jms.listener.AbstractJmsListeningContainer.createSharedConnection(AbstractJmsListeningContainer.java:378)
>>
>> ??????? at
>>
>> org.springframework.jms.listener.AbstractJmsListeningContainer.refreshSharedConnection(AbstractJmsListeningContainer.java:363)
>>
>> ??????? at
>>
>> org.springframework.jms.listener.DefaultMessageListenerContainer.refreshConnectionUntilSuccessful(DefaultMessageListenerContainer.java:785)
>>
>> ??????? at
>>
>> org.springframework.jms.listener.DefaultMessageListenerContainer.recoverAfterListenerSetupFailure(DefaultMessageListenerContainer.java:767)
>>
>> ??????? at
>>
>> org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:898)
>>
>> ??? ????at java.lang.Thread.run(Thread.java:619)
>>
>> Caused by: org.apache.qpid.transport.ConnectionException
>>
>> ??????? at
>>
>> org.apache.qpid.transport.Connection.exception(Connection.java:405)
>>
>> ??????? at
>>
>> org.apache.qpid.transport.network.Assembler.exception(Assembler.java:108)
>>
>> ??????? at
>>
>> org.apache.qpid.transport.network.InputHandler.exception(InputHandler.java:196)
>>
>> ??????? at
>>
>> org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:146)
>>
>> ?????? ?... 1 more
>>
>> Caused by: java.lang.IllegalStateException
>>
>> ??????? at
>>
>> org.apache.qpid.transport.network.InputHandler.next(InputHandler.java:190)
>>
>> ??????? at
>>
>> org.apache.qpid.transport.network.InputHandler.received(InputHandler.java:103)
>>
>> ??????? at
>>
>> org.apache.qpid.transport.network.InputHandler.received(InputHandler.java:42)
>>
>> ??????? at
>>
>> org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:128)
>>
>> ??????? ... 1 more
>>
>>
>>
>> Seeing the error I feel I have done some stupid mistake . Somebody please
>> help me ...
>>
>>
>>
>> Thanks in advance.
>>
>>
>>
>> Regards,
>>
>> Vivek
>>
>>
>>
>>
>>
>> Regards,
>>
>> Vivek Kubaji
>>
>> Mail?????? : vivek.kubaji at onmobile.com
>>
>> Mobile? : 9880199884
>>
>> Ext????????? : 6147
>>
>>
>>
>> ==============================
>> DISCLAIMER: The information in this message is confidential and may be
>> legally privileged. It is intended solely for the addressee. Access to
>> this
>> message by anyone else is unauthorized. If you are not the intended
>> recipient, any disclosure, copying, or distribution of the message, or
>> any
>> action or omission taken by you in reliance on it, is prohibited and may
>> be
>> unlawful. Please immediately contact the sender if you have received this
>> message in error. Further, this e-mail may contain viruses and all
>> reasonable precaution to minimize the risk arising there from is taken by
>> OnMobile. OnMobile is not liable for any damage sustained by you as a
>> result
>> of any virus in this e-mail. All applicable virus checks should be
>> carried
>> out by you before opening this e-mail or any attachment thereto.
>> Thank you - OnMobile Global Limited.
>> ==============================
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> 
> 

-- 
View this message in context: http://www.nabble.com/RabbitMQ-Spring-integration---help-required-tp24203688p24284545.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From m.nacos at gmail.com  Wed Jul  1 10:13:49 2009
From: m.nacos at gmail.com (Michael Nacos)
Date: Wed, 1 Jul 2009 10:13:49 +0100
Subject: [rabbitmq-discuss] tcp -> rabbitmq gives emfile + 541
In-Reply-To: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>
References: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>
Message-ID: <407fa4640907010213h542c1baaw868f53c7633b1aac@mail.gmail.com>

Dear Tony,

thank you for your email concerning the 0.9.1 C client (*), it is obviously
the right way to go, but it would force me to deploy 0.9.1 in our
infrastructure, I was hoping to go live with the current setup in the next
couple of weeks. So, please forgive me if I insist on debugging the current
setup.

The reason I am annoying you guys with this is that, surely, you must have
come across situations when your system runs out of file descriptors while
you are opening/closing tcp connections in stress tests.  Valentino, for
example, has posted some suggestions concerning kernel params (please see
the second link below).

Here's what I'm trying to do:

  +------------+     +----------------+      +-------------+
  | DB Trigger |    \|   TCP listener |     \|   RabbitMQ  |
  |     (C)    '''''/|    (Erlang)    ''''''/|   (Erlang)  |
  +------------+     +----------------+      +-------------+


I have got a C trigger function in a database (Postgresql) which opens and
closes a new TCP connection to an Erlang node every time it fires. That's
the nature of row-level trigger functions, there is no way I can pool
connections/maintain state across invocations. So this is 2 file descriptors
(for 2 minutes -- TIME_WAIT) just getting the message from the trigger to
the Erlang node, and then rabbitmq will probably consume some file
descriptors for opening/closing channels. The trigger is executed several
times per second, say every 50-100ms, I have increased the user's nofile
ulimit to 32768, I have increased the number of concurrent Erlang processes
to millions, I have even tried running my tcp acceptor code within the same
VM as RabbitMQ, so that I can use a direct client connection and avoid any
TCP overhead between the tcp listener and RabbitMQ. At this stage, I'm not
consuming the (persistent) messages as they come in, they are stored in
mnesia. And I either run out of file descriptors (separate VMs) or the
RabbitMQ VM just dies after approx. 300000 messages (if tcp listener is
running within RabbitMQ vm).

I guess what I am asking is some feedback/stats, such as throughput limits
you have observed with RabbitMQ, mnesia or the operating system, whether
deploying 0.9.1 would lift any barriers, is there something fundamentally
wrong with the way I am trying to use RabbitMQ etc. I remember from the
Erlang factory talks you have been working with new persistence/offload to
disk mechanisms.

cheers, Michael

Links:
---------
(*)
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-June/004337.html
http://www.nabble.com/Large-number-of-connections-td22994598.html
http://www.nabble.com/spawn-problem-td9684760.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090701/feeefb2d/attachment.htm 

From lynton.grice at logosworld.com  Wed Jul  1 12:44:02 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Wed, 1 Jul 2009 13:44:02 +0200
Subject: [rabbitmq-discuss] Eclipse type view of RabbitMQ exchanges etc
Message-ID: <000001c9fa41$3ebb72a0$bc3257e0$@grice@logosworld.com>

Hi there,

 

I use RabbitMQ and am a huge fan of it. I am also pretty familiar with
FioranoMQ and WebsphereMQ and am just curious if there is any "side project"
or current initiative to have some really cool GUI viewer of RabbitMQ?

 

For example with WebsphereMQ you have an Eclipse interface where you can
create new queues etc......see what the message contents are on a queue etc

 

Obviously with AMQP it is slightly different but it would be super if there
was a great GUI out there for RabbitMQ.

 

For me as a techie I don't really mind either which way, but I am just
thinking what would help RabbitMQ get more mainstream with the big
corporate...

 

Your thoughts?

 

Thanks

 

Lynton

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090701/3d856589/attachment.htm 

From joelr1 at gmail.com  Wed Jul  1 12:48:15 2009
From: joelr1 at gmail.com (Joel Reymont)
Date: Wed, 1 Jul 2009 12:48:15 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
Message-ID: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>

I'm running Erlang R13B01 and RabbitMQ 1.5.3 server with the Erlang  
client library.

I start 100 Erlang processes that subscribe to a single topic and  
publish a single message once all the client processes are ready. Only  
a random number of my client processes receive the message and the  
number is less than 50.

Is there an explanation?

More detail...

Client processes synchronize by monitoring a single Erlang process  
(barrier). Every client subscribes to the topic only when notified  
that the barrier is open ({'DOWN', _, process, Pid, normal}). Clients  
bump a counter in the barrier when they are up and running and the  
barrier opens once the target # of bumps has been reached.

In other words, I don't publish until everyone is ready and subscribed.

The client subscription process looks like this, where  
common:random_token() returns a 16-digit hash as a string:

     QS = [$t, $h, $q|common:random_token()],
     Q = list_to_binary(QS),
     Tok1 = common:random_token(),
     Tag = list_to_binary([QS, Tok1]),
     lib_amqp:declare_exchange(State#state.channel, Topic, <<"topic">>),
     lib_amqp:declare_queue(State#state.channel, Q),
     lib_amqp:bind_queue(State#state.channel, Topic, Q,  
State#state.type),
     lib_amqp:subscribe(State#state.channel, Q, self(), Tag),

Publishing a message then looks like this:

     Con = lib_amqp:start_connection(Rabbit),
     Chan = lib_amqp:start_channel(Con),
     Exch = list_to_binary(Topic),
     #'exchange.declare_ok'{} = lib_amqp:declare_exchange(Chan, Exch,  
<<"topic">>),
     ...
     lib_amqp:publish(Chan, Exch, <<"raw">>, MsgWithId),
     lib_amqp:publish(Chan, Exch, <<"http">>, HttpMsg),
     lib_amqp:publish(Chan, Exch, <<"flash">>, FlashMsg),
     lib_amqp:teardown(Con, Chan),

The name of the exchange is always the topic.

I know that 100 clients have subscribed and received messages because  
I trace in Erlang and count the 'basic.consume_ok' and 'basic.deliver'  
messages, e.g.

grep "basic.consume_ok" /tmp/foo|wc -l
grep "basic.deliver" /tmp/foo|wc -l

What am I doing wrong and is there a way to do it better?

All I want is to push a single message to hundreds of thousands of  
subscribers with minimum latency.

	Thanks, Joel

---
Mac hacker with a performance bent
http://www.linkedin.com/in/joelreymont




From matthew at lshift.net  Wed Jul  1 13:03:28 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 1 Jul 2009 13:03:28 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
Message-ID: <20090701120328.GA32183@mrnibble.lshift.net>

Hi Joel,

On Wed, Jul 01, 2009 at 12:48:15PM +0100, Joel Reymont wrote:
> Publishing a message then looks like this:
> 
>      Con = lib_amqp:start_connection(Rabbit),
>      Chan = lib_amqp:start_channel(Con),
>      Exch = list_to_binary(Topic),
>      #'exchange.declare_ok'{} = lib_amqp:declare_exchange(Chan, Exch,  
> <<"topic">>),
>      ...
>      lib_amqp:publish(Chan, Exch, <<"raw">>, MsgWithId),
>      lib_amqp:publish(Chan, Exch, <<"http">>, HttpMsg),
>      lib_amqp:publish(Chan, Exch, <<"flash">>, FlashMsg),
>      lib_amqp:teardown(Con, Chan),
> 
> What am I doing wrong and is there a way to do it better?

As a first step to debugging this, I would suggest using transactions.
It's quite possible the teardown is happening before the publishes are
getting out of the socket. Could you thus rework this to use tx_select,
publish and tx_commit? Once you get the commit-ok back, you should know
for certain that the messages have made it to the broker. Please let us
know how you get on.

Cheers,

Matthew



From joelr1 at gmail.com  Wed Jul  1 15:23:33 2009
From: joelr1 at gmail.com (Joel Reymont)
Date: Wed, 1 Jul 2009 15:23:33 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <20090701120328.GA32183@mrnibble.lshift.net>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
	<20090701120328.GA32183@mrnibble.lshift.net>
Message-ID: <B21E39F0-43C3-4399-85FE-4DB5A927C528@gmail.com>


On Jul 1, 2009, at 1:03 PM, Matthew Sackman wrote:

> Could you thus rework this to use tx_select, publish and tx_commit?

I don't have tx_* in my version of rabbitmq-erlang-client.

Should I use a more up-to-date version and if so which one?
	
	Thanks, Joel

---
Mac hacker with a performance bent
http://www.linkedin.com/in/joelreymont




From joelr1 at gmail.com  Wed Jul  1 15:39:14 2009
From: joelr1 at gmail.com (Joel Reymont)
Date: Wed, 1 Jul 2009 15:39:14 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <20090701120328.GA32183@mrnibble.lshift.net>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
	<20090701120328.GA32183@mrnibble.lshift.net>
Message-ID: <0929DFE4-B15C-43CC-9C1C-DA522675856E@gmail.com>

Matthew,

On Jul 1, 2009, at 1:03 PM, Matthew Sackman wrote:

> Could you thus rework this to use tx_select, publish and tx_commit?

How do transactions affect latency? Do transactions finish once the  
message has been delivered to all subscribers?

	Thanks, Joel

---
Mac hacker with a performance bent
http://www.linkedin.com/in/joelreymont




From tonyg at lshift.net  Wed Jul  1 15:43:37 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 01 Jul 2009 15:43:37 +0100
Subject: [rabbitmq-discuss] tcp -> rabbitmq gives emfile + 541
In-Reply-To: <407fa4640907010213h542c1baaw868f53c7633b1aac@mail.gmail.com>
References: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>
	<407fa4640907010213h542c1baaw868f53c7633b1aac@mail.gmail.com>
Message-ID: <4A4B7619.8030702@lshift.net>

Hi Michael,

Michael Nacos wrote:
> thank you for your email concerning the 0.9.1 C client (*)

The C client on the default branch speaks AMQP 0-8, which is compatible
with current releases of RabbitMQ.

There is a 0-9-1 *branch*, but you have to explicitly select it -- which
is why I advised you omit the branch-switching step :-) If you follow
the instructions (without the switch-to-0-9-1 step!) you will end up
with an AMQP 0-8 C client library.

Here, for the record, are instructions for getting the default branch of
the C client (and example programs) built; at the time of writing, the
code on the default branch speaks AMQP 0-8:

  hg clone http://hg.rabbitmq.com/rabbitmq-codegen
  hg clone http://hg.rabbitmq.com/rabbitmq-c
  cd rabbitmq-c
  autoreconf -i
  ./configure
  make

Regarding the issue with your TCP server, I'm not sure why you're
running into fd limits; surely TIME_WAIT applies to sockets, not fds?

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Wed Jul  1 15:44:00 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 01 Jul 2009 15:44:00 +0100
Subject: [rabbitmq-discuss] The C client speaks AMQP 0-8 by default (was Re:
 tcp -> rabbitmq gives emfile + 541)
In-Reply-To: <407fa4640907010213h542c1baaw868f53c7633b1aac@mail.gmail.com>
References: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>
	<407fa4640907010213h542c1baaw868f53c7633b1aac@mail.gmail.com>
Message-ID: <4A4B7630.70307@lshift.net>

Hi Michael,

Michael Nacos wrote:
> thank you for your email concerning the 0.9.1 C client (*)

The C client on the default branch speaks AMQP 0-8, which is compatible
with current releases of RabbitMQ.

There is a 0-9-1 *branch*, but you have to explicitly select it -- which
is why I advised you omit the branch-switching step :-) If you follow
the instructions (without the switch-to-0-9-1 step!) you will end up
with an AMQP 0-8 C client library.

Here, for the record, are instructions for getting the default branch of
the C client (and example programs) built; at the time of writing, the
code on the default branch speaks AMQP 0-8:

  hg clone http://hg.rabbitmq.com/rabbitmq-codegen
  hg clone http://hg.rabbitmq.com/rabbitmq-c
  cd rabbitmq-c
  autoreconf -i
  ./configure
  make

Regarding the issue with your TCP server, I'm not sure why you're
running into fd limits; surely TIME_WAIT applies to sockets, not fds?

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From joelr1 at gmail.com  Wed Jul  1 15:42:17 2009
From: joelr1 at gmail.com (Joel Reymont)
Date: Wed, 1 Jul 2009 15:42:17 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <20090701120328.GA32183@mrnibble.lshift.net>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
	<20090701120328.GA32183@mrnibble.lshift.net>
Message-ID: <A99C8976-8BF3-49C0-AD3D-E178FF59BD22@gmail.com>


On Jul 1, 2009, at 1:03 PM, Matthew Sackman wrote:

> As a first step to debugging this, I would suggest using transactions.
> It's quite possible the teardown is happening before the publishes are
> getting out of the socket.

I removed the teardown but I'm still not getting the 100 messages,  
e.g. over 3 runs:

superbot: n: 100, good: 64, bad: 36
superbot: n: 100, good: 12, bad: 88
superbot: n: 100, good: 17, bad: 83

	Thanks, Joel

---
Mac hacker with a performance bent
http://www.linkedin.com/in/joelreymont




From joelr1 at gmail.com  Wed Jul  1 15:52:53 2009
From: joelr1 at gmail.com (Joel Reymont)
Date: Wed, 1 Jul 2009 15:52:53 +0100
Subject: [rabbitmq-discuss] conceptual question
Message-ID: <4BE7A2A4-4198-47A9-A1BD-B0D5F4E3CB39@gmail.com>

Assume that I have a cluster of RabbitMQ nodes and hundreds of  
thousands of subscribers connected to them. Are subscriptions kept per  
node such that a message going out is first sent to individual nodes  
and from there to this node's subscriber list?

My ideal would be for each node to handle delivery to its portion of  
the subscriber list but I don't know if that's how RabbitMQ works.

	Thanks, Joel

---
Mac hacker with a performance bent
http://www.linkedin.com/in/joelreymont




From matthew at lshift.net  Wed Jul  1 15:57:34 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 1 Jul 2009 15:57:34 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <0929DFE4-B15C-43CC-9C1C-DA522675856E@gmail.com>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
	<20090701120328.GA32183@mrnibble.lshift.net>
	<0929DFE4-B15C-43CC-9C1C-DA522675856E@gmail.com>
Message-ID: <20090701145733.GB32183@mrnibble.lshift.net>

Hi Joel,

On Wed, Jul 01, 2009 at 03:39:14PM +0100, Joel Reymont wrote:
> On Jul 1, 2009, at 1:03 PM, Matthew Sackman wrote:
> >Could you thus rework this to use tx_select, publish and tx_commit?

Ok, we've had some more thoughts here about this, and basically, we
don't think you should need transactions (which aren't in the lib_amqp
module as you've found (and I'd forgotten)). The teardown that you're
doing is synchronous and will force everything out, so there is no risk
of messages getting stuck in the client. Thus don't worry about
transactions, and leave the teardown in.

We're wondering whether you're using the same channel or connection for
all of your clients? If so, that would be bad as as soon as one of them
closes, the other messages will not get through - teardown shuts both
the channel and the connection.

Could you send us the complete code so that we can reproduce the
problem?

Matthew



From joelr1 at gmail.com  Wed Jul  1 16:03:15 2009
From: joelr1 at gmail.com (Joel Reymont)
Date: Wed, 1 Jul 2009 16:03:15 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <20090701145733.GB32183@mrnibble.lshift.net>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
	<20090701120328.GA32183@mrnibble.lshift.net>
	<0929DFE4-B15C-43CC-9C1C-DA522675856E@gmail.com>
	<20090701145733.GB32183@mrnibble.lshift.net>
Message-ID: <BBE05A6D-8EDD-458F-B7CF-2FA326A8D2EF@gmail.com>


On Jul 1, 2009, at 3:57 PM, Matthew Sackman wrote:

> We're wondering whether you're using the same channel or connection  
> for
> all of your clients?

On the publishing end I do:

     Con = lib_amqp:start_connection(Rabbit),
     Chan = lib_amqp:start_channel(Con),

On the client end I do:

     Conn = amqp_manager:get_connection(),
     Chan = lib_amqp:start_channel(Conn),

The client end shares the connection cached by amqp_manager but starts  
a separate channel.

Is this proper?

	Thanks, Joel

---
Mac hacker with a performance bent
http://www.linkedin.com/in/joelreymont




From joelr1 at gmail.com  Wed Jul  1 16:13:58 2009
From: joelr1 at gmail.com (Joel Reymont)
Date: Wed, 1 Jul 2009 16:13:58 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <20090701145733.GB32183@mrnibble.lshift.net>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
	<20090701120328.GA32183@mrnibble.lshift.net>
	<0929DFE4-B15C-43CC-9C1C-DA522675856E@gmail.com>
	<20090701145733.GB32183@mrnibble.lshift.net>
Message-ID: <E2902E4D-73AD-4947-8064-58C85FF74AF3@gmail.com>


On Jul 1, 2009, at 3:57 PM, Matthew Sackman wrote:

> We're wondering whether you're using the same channel or connection  
> for
> all of your clients? If so, that would be bad as as soon as one of  
> them
> closes, the other messages will not get through - teardown shuts both
> the channel and the connection.


I hasten to add that although a single connection is shared on the  
client side by Erlang processes, this connection is not closed when  
clients terminate. The channel that's started for each individual  
client is closed, though.

	Thanks, Joel

---
Mac hacker with a performance bent
http://www.linkedin.com/in/joelreymont




From matthew at lshift.net  Wed Jul  1 16:14:54 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 1 Jul 2009 16:14:54 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <BBE05A6D-8EDD-458F-B7CF-2FA326A8D2EF@gmail.com>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
	<20090701120328.GA32183@mrnibble.lshift.net>
	<0929DFE4-B15C-43CC-9C1C-DA522675856E@gmail.com>
	<20090701145733.GB32183@mrnibble.lshift.net>
	<BBE05A6D-8EDD-458F-B7CF-2FA326A8D2EF@gmail.com>
Message-ID: <20090701151454.GC32183@mrnibble.lshift.net>

On Wed, Jul 01, 2009 at 04:03:15PM +0100, Joel Reymont wrote:
> On Jul 1, 2009, at 3:57 PM, Matthew Sackman wrote:
> >We're wondering whether you're using the same channel or
> >connection for
> >all of your clients?
> 
> On the publishing end I do:
> 
>     Con = lib_amqp:start_connection(Rabbit),
>     Chan = lib_amqp:start_channel(Con),
> 
> On the client end I do:
> 
>     Conn = amqp_manager:get_connection(),
>     Chan = lib_amqp:start_channel(Conn),
> 
> The client end shares the connection cached by amqp_manager but
> starts a separate channel.

Sorry Joel but we're still guessing what the total code looks like
here. Please can you send us enough of it so that we can reproduce
the problem?

It's perfectly fine to share a connection between processes but if you
shut the connection then all the channels on that connection will die.

Matthew



From joelr1 at gmail.com  Wed Jul  1 16:22:06 2009
From: joelr1 at gmail.com (Joel Reymont)
Date: Wed, 1 Jul 2009 16:22:06 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <20090701151454.GC32183@mrnibble.lshift.net>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
	<20090701120328.GA32183@mrnibble.lshift.net>
	<0929DFE4-B15C-43CC-9C1C-DA522675856E@gmail.com>
	<20090701145733.GB32183@mrnibble.lshift.net>
	<BBE05A6D-8EDD-458F-B7CF-2FA326A8D2EF@gmail.com>
	<20090701151454.GC32183@mrnibble.lshift.net>
Message-ID: <E7E5152B-38BB-44C3-8B24-5AA6CA15768B@gmail.com>


On Jul 1, 2009, at 4:14 PM, Matthew Sackman wrote:

> Sorry Joel but we're still guessing what the total code looks like
> here. Please can you send us enough of it so that we can reproduce
> the problem?

I'll talk to my client to see what code I can share.

> It's perfectly fine to share a connection between processes but if you
> shut the connection then all the channels on that connection will die.


I don't shut down the connection.

	Thanks, Joel

---
Mac hacker with a performance bent
http://www.linkedin.com/in/joelreymont




From matthew at lshift.net  Wed Jul  1 16:25:47 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 1 Jul 2009 16:25:47 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <E7E5152B-38BB-44C3-8B24-5AA6CA15768B@gmail.com>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
	<20090701120328.GA32183@mrnibble.lshift.net>
	<0929DFE4-B15C-43CC-9C1C-DA522675856E@gmail.com>
	<20090701145733.GB32183@mrnibble.lshift.net>
	<BBE05A6D-8EDD-458F-B7CF-2FA326A8D2EF@gmail.com>
	<20090701151454.GC32183@mrnibble.lshift.net>
	<E7E5152B-38BB-44C3-8B24-5AA6CA15768B@gmail.com>
Message-ID: <20090701152547.GD32183@mrnibble.lshift.net>

On Wed, Jul 01, 2009 at 04:22:06PM +0100, Joel Reymont wrote:
> 
> On Jul 1, 2009, at 4:14 PM, Matthew Sackman wrote:
> 
> >Sorry Joel but we're still guessing what the total code looks like
> >here. Please can you send us enough of it so that we can reproduce
> >the problem?
> 
> I'll talk to my client to see what code I can share.

Ok. One other thing is to use rabbitmqctl list_queues to see what
messages are left in the queue. That might give you some more
information about where the messages are going or if they're getting
through.

Matthew



From m.nacos at gmail.com  Wed Jul  1 16:31:53 2009
From: m.nacos at gmail.com (Michael Nacos)
Date: Wed, 1 Jul 2009 16:31:53 +0100
Subject: [rabbitmq-discuss] tcp -> rabbitmq gives emfile + 541
In-Reply-To: <4A4B7619.8030702@lshift.net>
References: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>
	<407fa4640907010213h542c1baaw868f53c7633b1aac@mail.gmail.com>
	<4A4B7619.8030702@lshift.net>
Message-ID: <407fa4640907010831r9586f87lef707694e035d16b@mail.gmail.com>

Dear Tony,

this is excellent news, I'll definitely give the new C client a try. This is
just a pilot project, we have got big messaging needs, and I'd like to
explore the possibility of Database --> Messaging workflows much further.

In regards to the TCP server, I don't claim to be an expert in such things
but I am under the impression all sort of different resources consume file
descriptors in POSIX systems, including sockets, and while a socket is in
TIME_WAIT state a fd is still being used. (see e.g.
http://judystak.tistory.com/136)

by raising the nofile ulimit for the right users, I think I have gone past
this problem and what happens now is that RabbitMQ crashes because all the
undelivered messages are written to disk (for persistence) but the whole set
stays in memory, which is eventually exhausted. I don't know if this is out
of date information, but see
http://www.nabble.com/RabbitMQ-memory-management-td19428592.html

Now, I distinctly remember Matthew speaking about a mechanism which monitors
free memory and offloads to disk to the point of RabbitMQ working as long as
there is still room for a single message in RAM, but I don't remember if
this is already available or when it's going to be.

If I am right, attaching a fast enough consumer to the queue while running
my tests will probably take care of the crashes, I have only experienced
crashes when the number of undelivered messages exceeded 200000 messages.

overall, I am very happy with rabbitmq, I'm only complaining (not really)
because you have set the bar high :)

regards, Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090701/1d13a9e0/attachment.htm 

From matthew at lshift.net  Wed Jul  1 16:33:33 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 1 Jul 2009 16:33:33 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <20090701152547.GD32183@mrnibble.lshift.net>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
	<20090701120328.GA32183@mrnibble.lshift.net>
	<0929DFE4-B15C-43CC-9C1C-DA522675856E@gmail.com>
	<20090701145733.GB32183@mrnibble.lshift.net>
	<BBE05A6D-8EDD-458F-B7CF-2FA326A8D2EF@gmail.com>
	<20090701151454.GC32183@mrnibble.lshift.net>
	<E7E5152B-38BB-44C3-8B24-5AA6CA15768B@gmail.com>
	<20090701152547.GD32183@mrnibble.lshift.net>
Message-ID: <20090701153332.GE32183@mrnibble.lshift.net>

On Wed, Jul 01, 2009 at 04:25:47PM +0100, Matthew Sackman wrote:
> Ok. One other thing is to use rabbitmqctl list_queues to see what
> messages are left in the queue. That might give you some more
> information about where the messages are going or if they're getting
> through.

And there's also the Tracer in the java client which you can put
between your erlang clients and the broker in order to capture what's
going on at the protocol level. See http://www.rabbitmq.com/examples.html

Matthew



From matthew at lshift.net  Wed Jul  1 16:39:21 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Wed, 1 Jul 2009 16:39:21 +0100
Subject: [rabbitmq-discuss] tcp -> rabbitmq gives emfile + 541
In-Reply-To: <407fa4640907010831r9586f87lef707694e035d16b@mail.gmail.com>
References: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>
	<407fa4640907010213h542c1baaw868f53c7633b1aac@mail.gmail.com>
	<4A4B7619.8030702@lshift.net>
	<407fa4640907010831r9586f87lef707694e035d16b@mail.gmail.com>
Message-ID: <20090701153921.GF32183@mrnibble.lshift.net>

Hi Michael,

Just replying specifically about the new persister, I'll let Tony respond
to your other comments.

On Wed, Jul 01, 2009 at 04:31:53PM +0100, Michael Nacos wrote:
> Now, I distinctly remember Matthew speaking about a mechanism which monitors
> free memory and offloads to disk to the point of RabbitMQ working as long as
> there is still room for a single message in RAM, but I don't remember if
> this is already available or when it's going to be.

I'm afraid it's still not quite ready. Most of the core work is done and
it is pretty well tested, but I'm still finding the odd bug (which are
becoming increasingly tricky to track down!), coming up with new
optimisations, and generally still tuning the solution. This means that
it hasn't been through QA yet and so we don't recommend people use it.

Further, what's currently eating my time is trying to work out the best
policy of when to decide when a queue should be paged out, and how
resources should be allocated between queues. We have a number of ideas
in this space, some of which smell much better than others, but it is a
rather open problem and will take a little while before we settle on a
solution that we think works well.

> If I am right, attaching a fast enough consumer to the queue while running
> my tests will probably take care of the crashes, I have only experienced
> crashes when the number of undelivered messages exceeded 200000 messages.

Can you check the logs and say whether you get alarm high_water_mark
type messages in there? Also, in these cases, does free, or similar,
show pretty much no free RAM? Also, does a ball park calcualation of
message size * 200000 give you about your amount of RAM (within a factor
of 2)?

Matthew



From joelr1 at gmail.com  Wed Jul  1 16:43:02 2009
From: joelr1 at gmail.com (Joel Reymont)
Date: Wed, 1 Jul 2009 16:43:02 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <20090701152547.GD32183@mrnibble.lshift.net>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
	<20090701120328.GA32183@mrnibble.lshift.net>
	<0929DFE4-B15C-43CC-9C1C-DA522675856E@gmail.com>
	<20090701145733.GB32183@mrnibble.lshift.net>
	<BBE05A6D-8EDD-458F-B7CF-2FA326A8D2EF@gmail.com>
	<20090701151454.GC32183@mrnibble.lshift.net>
	<E7E5152B-38BB-44C3-8B24-5AA6CA15768B@gmail.com>
	<20090701152547.GD32183@mrnibble.lshift.net>
Message-ID: <0C1869EA-8961-4500-B2A9-35F770EE48BC@gmail.com>


On Jul 1, 2009, at 4:25 PM, Matthew Sackman wrote:

> Ok. One other thing is to use rabbitmqctl list_queues to see what
> messages are left in the queue.

Here's the result of 3 runs, starting with a fresh RabbitMQ instance:

n: 100, good: 99, bad: 1,  queued: 0
n: 100, good: 21, bad: 79, queued: 100
n: 100, good: 12, bad: 88, queued: 100

Good is messages received, bad not received and queued is the number  
of messages in queues according to list_queues.

Doesn't quite make sense to me.

---
Mac hacker with a performance bent
http://www.linkedin.com/in/joelreymont




From m.nacos at gmail.com  Wed Jul  1 17:14:05 2009
From: m.nacos at gmail.com (Michael Nacos)
Date: Wed, 1 Jul 2009 17:14:05 +0100
Subject: [rabbitmq-discuss] tcp -> rabbitmq gives emfile + 541
In-Reply-To: <20090701153921.GF32183@mrnibble.lshift.net>
References: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>
	<407fa4640907010213h542c1baaw868f53c7633b1aac@mail.gmail.com>
	<4A4B7619.8030702@lshift.net>
	<407fa4640907010831r9586f87lef707694e035d16b@mail.gmail.com>
	<20090701153921.GF32183@mrnibble.lshift.net>
Message-ID: <407fa4640907010914w73941cf1rc0688d079d68d8bb@mail.gmail.com>

Dear Matthew,

I'm afraid it's still not quite ready. Most of the core work is done and


it's not a trivial problem, and it'll be such a cool feature! I guess it's
wishful hearing that made me think it's ready :)

Can you check the logs and say whether you get alarm high_water_mark
> type messages in there? Also, in these cases, does free, or similar,
> show pretty much no free RAM? Also, does a ball park calcualation of
> message size * 200000 give you about your amount of RAM (within a factor
> of 2)?
>

could you offer a rule of thumb for calculating the AMQP message size? I am
sending lists of 5-10 ASCII characters. Judging from the disk space consumed
by the mnesia directory, however, I think it's possible we are exhausting
the RAM, if all messages are also kept in memory. And yes, just before the
vm crashes, free shows little memory left (~150Mb), there is a little bit of
lag between reaching this amount and the crash, it's a little hard to tell
because rabbitmq runs on the database server and there are other programs
running as well. There's no indication of any problems in the logs, except

=SUPERVISOR REPORT==== 1-Jul-2009::15:46:06 ===
     Supervisor: {local,rabbit_sup}
     Context:    shutdown_error
     Reason:     shutdown
     Offender:   [{pid,<0.142.0>},
                  {name,rabbit_persister},
                  {mfa,{rabbit_persister,start_link,[]}},
                  {restart_type,transient},
                  {shutdown,100},
                  {child_type,worker}]

in rabbit-sasl.log (but the vm definetly dies)

cheers, Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090701/86cb3b2d/attachment.htm 

From lynton.grice at logosworld.com  Wed Jul  1 17:30:32 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Wed, 1 Jul 2009 18:30:32 +0200
Subject: [rabbitmq-discuss] Eclipse type view of RabbitMQ exchanges etc
In-Reply-To: <bb4674270907010623r2b005641ga77dab23ed4c34a0@mail.gmail.com>
References: <3049392912252308816@unknownmsgid>
	<bb4674270907010623r2b005641ga77dab23ed4c34a0@mail.gmail.com>
Message-ID: <001201c9fa69$44c79390$ce56bab0$@grice@logosworld.com>

Hi Neil,

Thanks a lot for the useful comments, I really appreciate it ;-)

I will check out the links you sent me....

Thanks again ;-)

Lynton

-----Original Message-----
From: Neil Bartlett [mailto:njbartlett at gmail.com] 
Sent: 01 July 2009 03:23 PM
To: Lynton Grice
Subject: Re: [rabbitmq-discuss] Eclipse type view of RabbitMQ exchanges etc

Hello Lynton,

A couple of suggestions:

1) I have begun a project to integrate the RabbitMQ Java client
library into OSGi, providing exchanges and queues as Services etc.
Currently this provides a simplistic command-line oriented UI via the
OSGi console, but it could be used as the basis for a richer GUI. The
source code is on Github: http://github.com/njbartlett/rabbitosgi

2) The Eclipse Communications Framework (ECF) project is building all
sorts of back-end and front-end features for both synchronous and
asynchronous comms in Eclipse. I would be surprised if they did not
have at least something in incubation relating to AMQP.
http://www.eclipse.org/ecf

3) HermesJMS is a generic management console for JMS. It appears to
work with QPID, perhaps using the JMS adapter API.
http://hermesjms.com/confluence/display/HJMS/Home

I think developing some simple views in Eclipse to create messages and
view queues would make an interesting -- and not too challenging --
project for somebody learning Eclipse development.

Regards,
Neil


On Wed, Jul 1, 2009 at 12:44 PM, Lynton
Grice<lynton.grice at logosworld.com> wrote:
> Hi there,
>
>
>
> I use RabbitMQ and am a huge fan of it. I am also pretty familiar with
> FioranoMQ and WebsphereMQ and am just curious if there is any ?side project?
> or current initiative to have some really cool GUI viewer of RabbitMQ?
>
>
>
> For example with WebsphereMQ you have an Eclipse interface where you can
> create new queues etc......see what the message contents are on a queue etc
>
>
>
> Obviously with AMQP it is slightly different but it would be super if there
> was a great GUI out there for RabbitMQ.
>
>
>
> For me as a techie I don?t really mind either which way, but I am just
> thinking what would help RabbitMQ get more mainstream with the big
> corporate...
>
>
>
> Your thoughts?
>
>
>
> Thanks
>
>
>
> Lynton
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>




From alexis.richardson at gmail.com  Thu Jul  2 09:48:06 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 2 Jul 2009 09:48:06 +0100
Subject: [rabbitmq-discuss] Eclipse type view of RabbitMQ exchanges etc
In-Reply-To: <5911894494815075412@unknownmsgid>
References: <3049392912252308816@unknownmsgid>
	<bb4674270907010623r2b005641ga77dab23ed4c34a0@mail.gmail.com>
	<5911894494815075412@unknownmsgid>
Message-ID: <167204d20907020148y3ccfbd67vb6ef6a1f62461f4c@mail.gmail.com>

Lynton

It's definitely worth looking at Hermes.  I have pinged the author who
may take a look but it would be great if you had a go too.

There are also some tools that people are working on, see:
http://www.nabble.com/Monitoring-options-beyond-rabbitmqctl-td23835035.html

alexis




On Wed, Jul 1, 2009 at 5:30 PM, Lynton Grice<lynton.grice at logosworld.com> wrote:
> Hi Neil,
>
> Thanks a lot for the useful comments, I really appreciate it ;-)
>
> I will check out the links you sent me....
>
> Thanks again ;-)
>
> Lynton
>
> -----Original Message-----
> From: Neil Bartlett [mailto:njbartlett at gmail.com]
> Sent: 01 July 2009 03:23 PM
> To: Lynton Grice
> Subject: Re: [rabbitmq-discuss] Eclipse type view of RabbitMQ exchanges etc
>
> Hello Lynton,
>
> A couple of suggestions:
>
> 1) I have begun a project to integrate the RabbitMQ Java client
> library into OSGi, providing exchanges and queues as Services etc.
> Currently this provides a simplistic command-line oriented UI via the
> OSGi console, but it could be used as the basis for a richer GUI. The
> source code is on Github: http://github.com/njbartlett/rabbitosgi
>
> 2) The Eclipse Communications Framework (ECF) project is building all
> sorts of back-end and front-end features for both synchronous and
> asynchronous comms in Eclipse. I would be surprised if they did not
> have at least something in incubation relating to AMQP.
> http://www.eclipse.org/ecf
>
> 3) HermesJMS is a generic management console for JMS. It appears to
> work with QPID, perhaps using the JMS adapter API.
> http://hermesjms.com/confluence/display/HJMS/Home
>
> I think developing some simple views in Eclipse to create messages and
> view queues would make an interesting -- and not too challenging --
> project for somebody learning Eclipse development.
>
> Regards,
> Neil
>
>
> On Wed, Jul 1, 2009 at 12:44 PM, Lynton
> Grice<lynton.grice at logosworld.com> wrote:
>> Hi there,
>>
>>
>>
>> I use RabbitMQ and am a huge fan of it. I am also pretty familiar with
>> FioranoMQ and WebsphereMQ and am just curious if there is any ?side project?
>> or current initiative to have some really cool GUI viewer of RabbitMQ?
>>
>>
>>
>> For example with WebsphereMQ you have an Eclipse interface where you can
>> create new queues etc......see what the message contents are on a queue etc
>>
>>
>>
>> Obviously with AMQP it is slightly different but it would be super if there
>> was a great GUI out there for RabbitMQ.
>>
>>
>>
>> For me as a techie I don?t really mind either which way, but I am just
>> thinking what would help RabbitMQ get more mainstream with the big
>> corporate...
>>
>>
>>
>> Your thoughts?
>>
>>
>>
>> Thanks
>>
>>
>>
>> Lynton
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From lynton.grice at logosworld.com  Thu Jul  2 10:37:40 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Thu, 2 Jul 2009 11:37:40 +0200
Subject: [rabbitmq-discuss] Eclipse type view of RabbitMQ exchanges etc
In-Reply-To: <167204d20907020148y3ccfbd67vb6ef6a1f62461f4c@mail.gmail.com>
References: <3049392912252308816@unknownmsgid>	
	<bb4674270907010623r2b005641ga77dab23ed4c34a0@mail.gmail.com>	
	<5911894494815075412@unknownmsgid>
	<167204d20907020148y3ccfbd67vb6ef6a1f62461f4c@mail.gmail.com>
Message-ID: <000601c9faf8$c2229710$4667c530$@grice@logosworld.com>

Hi Alexis,

Many thanks for the advise on this, I will most certainly have a good look
at it ;-)

Maybe someone will even grab the "WX" library in Erlang and create a cool
GUI as well ;-)

Chat later

Lynton

-----Original Message-----
From: Alexis Richardson [mailto:alexis.richardson at gmail.com] 
Sent: 02 July 2009 10:48 AM
To: Lynton Grice
Cc: Neil Bartlett; rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Eclipse type view of RabbitMQ exchanges etc

Lynton

It's definitely worth looking at Hermes.  I have pinged the author who
may take a look but it would be great if you had a go too.

There are also some tools that people are working on, see:
http://www.nabble.com/Monitoring-options-beyond-rabbitmqctl-td23835035.html

alexis




On Wed, Jul 1, 2009 at 5:30 PM, Lynton Grice<lynton.grice at logosworld.com>
wrote:
> Hi Neil,
>
> Thanks a lot for the useful comments, I really appreciate it ;-)
>
> I will check out the links you sent me....
>
> Thanks again ;-)
>
> Lynton
>
> -----Original Message-----
> From: Neil Bartlett [mailto:njbartlett at gmail.com]
> Sent: 01 July 2009 03:23 PM
> To: Lynton Grice
> Subject: Re: [rabbitmq-discuss] Eclipse type view of RabbitMQ exchanges
etc
>
> Hello Lynton,
>
> A couple of suggestions:
>
> 1) I have begun a project to integrate the RabbitMQ Java client
> library into OSGi, providing exchanges and queues as Services etc.
> Currently this provides a simplistic command-line oriented UI via the
> OSGi console, but it could be used as the basis for a richer GUI. The
> source code is on Github: http://github.com/njbartlett/rabbitosgi
>
> 2) The Eclipse Communications Framework (ECF) project is building all
> sorts of back-end and front-end features for both synchronous and
> asynchronous comms in Eclipse. I would be surprised if they did not
> have at least something in incubation relating to AMQP.
> http://www.eclipse.org/ecf
>
> 3) HermesJMS is a generic management console for JMS. It appears to
> work with QPID, perhaps using the JMS adapter API.
> http://hermesjms.com/confluence/display/HJMS/Home
>
> I think developing some simple views in Eclipse to create messages and
> view queues would make an interesting -- and not too challenging --
> project for somebody learning Eclipse development.
>
> Regards,
> Neil
>
>
> On Wed, Jul 1, 2009 at 12:44 PM, Lynton
> Grice<lynton.grice at logosworld.com> wrote:
>> Hi there,
>>
>>
>>
>> I use RabbitMQ and am a huge fan of it. I am also pretty familiar with
>> FioranoMQ and WebsphereMQ and am just curious if there is any "side
project"
>> or current initiative to have some really cool GUI viewer of RabbitMQ?
>>
>>
>>
>> For example with WebsphereMQ you have an Eclipse interface where you can
>> create new queues etc......see what the message contents are on a queue
etc
>>
>>
>>
>> Obviously with AMQP it is slightly different but it would be super if
there
>> was a great GUI out there for RabbitMQ.
>>
>>
>>
>> For me as a techie I don't really mind either which way, but I am just
>> thinking what would help RabbitMQ get more mainstream with the big
>> corporate...
>>
>>
>>
>> Your thoughts?
>>
>>
>>
>> Thanks
>>
>>
>>
>> Lynton
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>




From esteve at sindominio.net  Thu Jul  2 10:51:48 2009
From: esteve at sindominio.net (Esteve Fernandez)
Date: Thu, 2 Jul 2009 11:51:48 +0200 (CEST)
Subject: [rabbitmq-discuss] recent and upcoming RabbitMQ / txAMQP talks
In-Reply-To: <167204d20906291330r2bf73aafud412057251e02a56@mail.gmail.com>
References: <167204d20906291330r2bf73aafud412057251e02a56@mail.gmail.com>
Message-ID: <63754.212.2.21.3.1246528308.squirrel@webmail.sindominio.net>

Hi all

> This is a short note to announce that Esteve Fernandez, author of the
> txAMQP client for Python/Twisted, will give a talk at 4pm on Friday
> July 3rd at RabbitHQ in London.  Please come along and join us for a
> beer afterwards.  If you want to come, please email me so that I can
> get a rough idea of numbers.

Where's RabbitHQ? Lshift? I couldn't find any address at rabbitmq.com

BTW, I'll talk about Thrift too and how we at Fluidinfo combined it with AMQP
for easy (and fast) RPC over messaging.

This is the presentation I gave at PyCon US in March and at EuroPython just a
few days ago:

http://us.pycon.org/2009/conference/schedule/event/28/

Cheers.




From alexis.richardson at gmail.com  Thu Jul  2 11:07:11 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 2 Jul 2009 11:07:11 +0100
Subject: [rabbitmq-discuss] recent and upcoming RabbitMQ / txAMQP talks
In-Reply-To: <63754.212.2.21.3.1246528308.squirrel@webmail.sindominio.net>
References: <167204d20906291330r2bf73aafud412057251e02a56@mail.gmail.com>
	<63754.212.2.21.3.1246528308.squirrel@webmail.sindominio.net>
Message-ID: <167204d20907020307m78505f3ejca334678cb3a1a38@mail.gmail.com>

Esteve

Yes, we are all working out of the LShift offices - the address is on
the LShift web site.

It woud be great if you talked about Thrift too :-)

alexis



On Thu, Jul 2, 2009 at 10:51 AM, Esteve Fernandez<esteve at sindominio.net> wrote:
> Hi all
>
>> This is a short note to announce that Esteve Fernandez, author of the
>> txAMQP client for Python/Twisted, will give a talk at 4pm on Friday
>> July 3rd at RabbitHQ in London. ?Please come along and join us for a
>> beer afterwards. ?If you want to come, please email me so that I can
>> get a rough idea of numbers.
>
> Where's RabbitHQ? Lshift? I couldn't find any address at rabbitmq.com
>
> BTW, I'll talk about Thrift too and how we at Fluidinfo combined it with AMQP
> for easy (and fast) RPC over messaging.
>
> This is the presentation I gave at PyCon US in March and at EuroPython just a
> few days ago:
>
> http://us.pycon.org/2009/conference/schedule/event/28/
>
> Cheers.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From bms at incunabulum.net  Thu Jul  2 13:35:00 2009
From: bms at incunabulum.net (Bruce Simpson)
Date: Thu, 02 Jul 2009 13:35:00 +0100
Subject: [rabbitmq-discuss] NETCONF over AMQP
Message-ID: <4A4CA974.9040103@incunabulum.net>

Hi,

Somewhat off-topic, but, AMQP brains-r-us on this list:-

Has anyone done any thinking about NETCONF, the emerging network 
management protocol standard?
    http://en.wikipedia.org/wiki/Netconf

Maybe they didn't know about AMQP, or veer towards XMPP. The fact that 
they use XML for just about everything makes me shudder, though.

cheers,
BMS



From m.nacos at gmail.com  Thu Jul  2 15:44:09 2009
From: m.nacos at gmail.com (Michael Nacos)
Date: Thu, 2 Jul 2009 15:44:09 +0100
Subject: [rabbitmq-discuss] The C client speaks AMQP 0-8 by default (was
	Re: tcp -> rabbitmq gives emfile + 541)
In-Reply-To: <4A4B7630.70307@lshift.net>
References: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>
	<407fa4640907010213h542c1baaw868f53c7633b1aac@mail.gmail.com>
	<4A4B7630.70307@lshift.net>
Message-ID: <407fa4640907020744j66ecddc1m6ba5a345d805d102@mail.gmail.com>

yes, it does!

I don't remember how I downloaded the previous version I tested
(it's possible I had changed branch thinking the default speaks 0.9.1)
but it looked different and it wouldn't compile
I'll give this client a go, while I'm waiting for the other tests to finish
I might be doing some throughput tests next week.

thanks, Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090702/0cf311bc/attachment.htm 

From tsuraan at gmail.com  Thu Jul  2 18:23:27 2009
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 2 Jul 2009 12:23:27 -0500
Subject: [rabbitmq-discuss] multiple consumers on one channel?
Message-ID: <84fb38e30907021023t527f9105jfb594e24e20e0097@mail.gmail.com>

Is it sane to have more than one basicConsume on a single channel?  I
have a simple test program that does two basicConsume calls with two
different consumers on two different queues, using the same channel.
It looks like all the messages are consumed from the first created
consumer, and then the second consumer is started.  Is it possible to
have multiple simultaneous consumers on the same channel, or is that
not a good idea?



From allen.fowler at yahoo.com  Thu Jul  2 19:21:14 2009
From: allen.fowler at yahoo.com (Allen Fowler)
Date: Thu, 2 Jul 2009 11:21:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Sample code for python?
In-Reply-To: <d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
	<d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com>
Message-ID: <558122.16141.qm@web45608.mail.sp1.yahoo.com>







> >
> > I am looking at RabbitMQ to perhaps add message passing to a Python program 
> being written.
> >
> > Right now "messages" are being pased in and out of a database.  Not a very 
> good solution.
> >
> > How hard is it to produce and consume messages from Python using RabbitMQ? 
>  What libraries do I need, and is there sample code  / tutorial available?
> 
> It's both fun and pretty easy to get started.
> 
> Start here:
> http://blogs.digitar.com/jjww/2009/01/rabbits-and-warrens/
> 



Thank you!  :)

Couple of more questions:

- What kind of formats do people use for their messages?  XML? JSON? Other?   I need to pass less than 1KB of data made up of Text, Dates, Numbers, etc.

- How would I integrate a UI (web app in my case) on top of a system that uses RabbitMQ for back-end processing.  I mean to say: If the UI submits an "add customer" message to the RabbitMQ server to be routed to a worker, how does the worker / RabbitMQ respond back to the UI with a success, fail (or even no-worker available / timeout) message?


      




From clemesha at gmail.com  Thu Jul  2 19:51:46 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Thu, 2 Jul 2009 11:51:46 -0700
Subject: [rabbitmq-discuss] Sample code for python?
In-Reply-To: <558122.16141.qm@web45608.mail.sp1.yahoo.com>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
	<d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com>
	<558122.16141.qm@web45608.mail.sp1.yahoo.com>
Message-ID: <d272f0690907021151k9b581a9w61803baa37092398@mail.gmail.com>

>
> Thank you! ?:)
>
> Couple of more questions:
>
> - What kind of formats do people use for their messages? ?XML? JSON? Other? ? I need to pass less than 1KB of data made up of Text, Dates, Numbers, etc.
I find JSON easiest to work with, but if you need richer datatypes you
can basically jam anything into AMQP messages,
like pickled python objects, etc.


> - How would I integrate a UI (web app in my case) on top of a system that uses RabbitMQ for back-end processing. ?I mean to say: If the UI submits an "add customer" message to the RabbitMQ server to be routed to a worker, how does the worker / RabbitMQ respond back to the UI with a success, fail (or even no-worker available / timeout) message?

I'd say start with Carrot - http://github.com/ask/carrot/tree/master -
I have not yet used it
personally, but just by looking at the documentation and development
activity, I'd say it looks like a really good bet.


-Alex





>
>
>
>
>



-- 
Alex Clemesha
clemesha.org



From allen.fowler at yahoo.com  Thu Jul  2 20:22:25 2009
From: allen.fowler at yahoo.com (Allen Fowler)
Date: Thu, 2 Jul 2009 12:22:25 -0700 (PDT)
Subject: [rabbitmq-discuss] Return message? [Was: Re: Sample code for
	python?]
In-Reply-To: <d272f0690907021151k9b581a9w61803baa37092398@mail.gmail.com>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
	<d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com>
	<558122.16141.qm@web45608.mail.sp1.yahoo.com>
	<d272f0690907021151k9b581a9w61803baa37092398@mail.gmail.com>
Message-ID: <825108.73047.qm@web45604.mail.sp1.yahoo.com>





> > - What kind of formats do people use for their messages?  XML? JSON? Other?   
> I need to pass less than 1KB of data made up of Text, Dates, Numbers, etc.
> I find JSON easiest to work with, but if you need richer datatypes you
> can basically jam anything into AMQP messages,
> like pickled python objects, etc.
> 
>


OK... I was just wondering what folks tend to use,.

 
> > - How would I integrate a UI (web app in my case) on top of a system that uses 
> RabbitMQ for back-end processing.  I mean to say: If the UI submits an "add 
> customer" message to the RabbitMQ server to be routed to a worker, how does the 
> worker / RabbitMQ respond back to the UI with a success, fail (or even no-worker 
> available / timeout) message?
> 
> I'd say start with Carrot - http://github.com/ask/carrot/tree/master -
> I have not yet used it
> personally, but just by looking at the documentation and development
> activity, I'd say it looks like a really good bet.
> 


I'm not at all clear what Carrot adds over plain py-amqplib ... I can't even find the docs.  

My question, in general, is how does the rabbitmq system deal with the need to report back (in a guaranteed timely manner) to the entity submitting a request/job the result of said request/job.  (either the response returned from the worker, or an error staing the request has expired.)


      




From clemesha at gmail.com  Thu Jul  2 20:50:52 2009
From: clemesha at gmail.com (Alex Clemesha)
Date: Thu, 2 Jul 2009 12:50:52 -0700
Subject: [rabbitmq-discuss] Return message? [Was: Re: Sample code for
	python?]
In-Reply-To: <825108.73047.qm@web45604.mail.sp1.yahoo.com>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
	<d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com>
	<558122.16141.qm@web45608.mail.sp1.yahoo.com>
	<d272f0690907021151k9b581a9w61803baa37092398@mail.gmail.com>
	<825108.73047.qm@web45604.mail.sp1.yahoo.com>
Message-ID: <d272f0690907021250j1a1177aoe121c3fc749b3ff0@mail.gmail.com>

>
> I'm not at all clear what Carrot adds over plain py-amqplib ... I can't even find the docs.

I'm sorry, what I meant to post was "Celery" not "Carrot" (baah! Too
many rabbit related project :-)
http://www.celeryq.org/index.html

Which is a RabbitMQ friendly Django Task Queue framework.


-Alex

>
> My question, in general, is how does the rabbitmq system deal with the need to report back (in a guaranteed timely manner) to the entity submitting a request/job the result of said request/job. ?(either the response returned from the worker, or an error staing the request has expired.)

Celery has lots of stuff on Tasks (aka Jobs):
http://www.celeryq.org/reference/celery.task.base.html

so you'll probably be able to solve you problems with that.


good luck,
Alex




>
>
>
>
>



-- 
Alex Clemesha
clemesha.org



From tsuraan at gmail.com  Thu Jul  2 20:51:59 2009
From: tsuraan at gmail.com (tsuraan)
Date: Thu, 2 Jul 2009 14:51:59 -0500
Subject: [rabbitmq-discuss] multiple consumers on one channel?
In-Reply-To: <84fb38e30907021023t527f9105jfb594e24e20e0097@mail.gmail.com>
References: <84fb38e30907021023t527f9105jfb594e24e20e0097@mail.gmail.com>
Message-ID: <84fb38e30907021251m11f0f22na827784ff4fc70f1@mail.gmail.com>

Ok, this is strange.  I can't even get two subscriptions on the same
connection, using different channels.  If I make a different
connection for each consumer, then I get messages simultaneously.  If
I have my two channels on the same connection, I get all the messages
from one of the queues, then all the messages from the other one.
I've included some pretty ugly code to demonstrate parallel consumers.
 If you change main() to only use one connection and two channels, you
can see it draining messages from the first queue at one message per
second, then draining messages from the second queue at the same rate.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ChannelTest.java
Type: text/x-java
Size: 2417 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090702/4f09a2a5/attachment.java 

From allen.fowler at yahoo.com  Thu Jul  2 21:33:02 2009
From: allen.fowler at yahoo.com (Allen Fowler)
Date: Thu, 2 Jul 2009 13:33:02 -0700 (PDT)
Subject: [rabbitmq-discuss] Return message? [Was: Re: Sample code for
	python?]
In-Reply-To: <d272f0690907021250j1a1177aoe121c3fc749b3ff0@mail.gmail.com>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
	<d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com>
	<558122.16141.qm@web45608.mail.sp1.yahoo.com>
	<d272f0690907021151k9b581a9w61803baa37092398@mail.gmail.com>
	<825108.73047.qm@web45604.mail.sp1.yahoo.com>
	<d272f0690907021250j1a1177aoe121c3fc749b3ff0@mail.gmail.com>
Message-ID: <716148.78533.qm@web45616.mail.sp1.yahoo.com>





> > I'm not at all clear what Carrot adds over plain py-amqplib ... I can't even 
> find the docs.
> 
> I'm sorry, what I meant to post was "Celery" not "Carrot" (baah! Too
> many rabbit related project :-)
> http://www.celeryq.org/index.html
> 
> Which is a RabbitMQ friendly Django Task Queue framework.
> 
>


Ah Ok.  An understandable confusion. :)

 
> >
> > My question, in general, is how does the rabbitmq system deal with the need to 
> > report back (in a guaranteed timely manner) to the entity submitting a 
> > request/job the result of said request/job.  (either the response returned from 
> > the worker, or an error staing the request has expired.)
> 
> Celery has lots of stuff on Tasks (aka Jobs):
> http://www.celeryq.org/reference/celery.task.base.html
> 
> so you'll probably be able to solve you problems with that.


>From the looks of it Celery is very python specific...   sending pickled tasks is not at all what we need.

In our case, the back-end machines will be .net or possibly Java.  The front end web-UI will be python. (Likely TurboGears 2)

As it stands now, the front end machines will be calling specific functions on the back-end boxes via a basic HTTP/XML API.  For instance:  "Place order for customer X"

The back-end machines do whatever processing they need and reply with a result code.  (Success, No Stock Left, System Busy, etc.)

My idea was to use RabbitMQ for the request transport instread of HTTP.  Is this a resonaable idea? Can/Should RabbitMQ be used in this sort of environment?  


      




From allen.fowler at yahoo.com  Thu Jul  2 22:19:41 2009
From: allen.fowler at yahoo.com (Allen Fowler)
Date: Thu, 2 Jul 2009 14:19:41 -0700 (PDT)
Subject: [rabbitmq-discuss] RabbitMQ book?
Message-ID: <741174.37639.qm@web45605.mail.sp1.yahoo.com>


Hello,

Is there a book, or tutorial, for RabbitMQ that does not presume previous knowledge of MQ technology, but does presume the reader wants to solve real-world problems in a scalable way? (for instance: IM message routing, n-tier RPC, compute-farm task exectuation, etc )

Thank you,
:)


      




From dialtone at gmail.com  Thu Jul  2 22:35:24 2009
From: dialtone at gmail.com (Valentino Volonghi)
Date: Thu, 2 Jul 2009 14:35:24 -0700
Subject: [rabbitmq-discuss] Return message? [Was: Re: Sample code for
	python?]
In-Reply-To: <716148.78533.qm@web45616.mail.sp1.yahoo.com>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
	<d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com>
	<558122.16141.qm@web45608.mail.sp1.yahoo.com>
	<d272f0690907021151k9b581a9w61803baa37092398@mail.gmail.com>
	<825108.73047.qm@web45604.mail.sp1.yahoo.com>
	<d272f0690907021250j1a1177aoe121c3fc749b3ff0@mail.gmail.com>
	<716148.78533.qm@web45616.mail.sp1.yahoo.com>
Message-ID: <0058CDE8-43F9-4390-B7BB-E811D6CBF7E2@gmail.com>


On Jul 2, 2009, at 1:33 PM, Allen Fowler wrote:

> In our case, the back-end machines will be .net or possibly Java.   
> The front end web-UI will be python. (Likely TurboGears 2)
>
> As it stands now, the front end machines will be calling specific  
> functions on the back-end boxes via a basic HTTP/XML API.  For  
> instance:  "Place order for customer X"
>
> The back-end machines do whatever processing they need and reply  
> with a result code.  (Success, No Stock Left, System Busy, etc.)
>
> My idea was to use RabbitMQ for the request transport instread of  
> HTTP.  Is this a resonaable idea? Can/Should RabbitMQ be used in  
> this sort of environment?


In this case I have been writing the tool that you might need:

http://bitbucket.org/adroll/quebert/overview/

This is also written in Python but doesn't require Python anywhere else
and deployment is easy.

Most of the things I wrote in an old email to this list are still true:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-June/004273.html

Although the API changed a bit for the better.

Essentially just using a mediator like this:
http://bitbucket.org/adroll/quebert/src/tip/examples/med.py

and starting it using (just one example):
twistd --pidfile=/var/run/quebert.pid --logfile=/var/log/quebert.log  
quebert --config=med.main --with_syslog_prefix=quebert
Would give you a system that for any message that gets in routes it to  
any
available HTTP server that knows how to process it (and you can do this
through a load balancer or directly sending the message).

The actual example code can be used as a configuration file without
changing it.

You can then easily add more features through hooks or on the point
of execution. I've essentially designed the system to answer your very
same concerns :).

--
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090702/48b2086f/attachment.pgp 

From ben.browitt at gmail.com  Fri Jul  3 12:06:14 2009
From: ben.browitt at gmail.com (Ben Browitt)
Date: Fri, 3 Jul 2009 14:06:14 +0300
Subject: [rabbitmq-discuss] Comet interface
Message-ID: <b0200d7f0907030406l3811e222r964358757ac0bb70@mail.gmail.com>

Hi,

I want to write a Comet web interface to RabbitMQ in Erlang.
This interface will be responsible for authenticating users, managing
sessions and routing messages.
For each logged-in user the interface will create a process that will route
messages from the client to RabbitMQ,
send messages from RabbitMQ to the client when possible and queue them in
its mailbox when it's not.
The reason for the queue is that in some implementations of Comet the client
is not available 100% of the time.

I wonder what is the best approach to communicate with RabbitMQ considering
that the interface is in Erlang.
One possibility is that each process will be an instance of the RabbitMQ
client
and the other option is that there will be one central process that will act
as a bridge.

I've noticed the http example and the STOMP adapter but read on several
places that they don't work with every release
probably because RabbitMQ is a moving target and is in active development (a
good thing).
Do the http example and the STOMP adapter use one of the approaches I
mentioned above?

Is the Erlang client stable?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090703/77143975/attachment.htm 

From ben.browitt at gmail.com  Fri Jul  3 12:14:27 2009
From: ben.browitt at gmail.com (Ben Browitt)
Date: Fri, 3 Jul 2009 14:14:27 +0300
Subject: [rabbitmq-discuss] module skeleton (behaviour)
Message-ID: <b0200d7f0907030414v6567e54ftd87c836ae7936a0f@mail.gmail.com>

Hi,

This is a feature request to implement a skeleton and a central config file
for RabbitMQ modules(extensions).
If modules will use an Erlang behaviour, RabbitMQ could start/stop and
monitor the module automatically.

A good reference is the gen_mod in Ejabberd:
http://www.process-one.net/en/wiki/ejabberd_module_development/
You activate a module by adding it to the list of modules in the config
file.
You can add module specific config options and Ejabberd let you access the
settings in run-time.
Each module implements:
start(Host, Opts) -> ok
stop(Host) -> ok

start and stop are good places to manage custom mnesia tables for example.

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090703/d94f83cf/attachment.htm 

From alexis.richardson at gmail.com  Fri Jul  3 13:39:24 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 3 Jul 2009 13:39:24 +0100
Subject: [rabbitmq-discuss] RabbitMQ book?
In-Reply-To: <741174.37639.qm@web45605.mail.sp1.yahoo.com>
References: <741174.37639.qm@web45605.mail.sp1.yahoo.com>
Message-ID: <167204d20907030539oc743fc3xeecd67c93f133ac2@mail.gmail.com>

Allen,

Have you looked at some of the links on this page:
http://www.rabbitmq.com/how.html ?

Some of the best articles are referenced, and I maintain a repo of
links at del.icio.us which is also linked to.

alexis


On Thu, Jul 2, 2009 at 10:19 PM, Allen Fowler<allen.fowler at yahoo.com> wrote:
>
> Hello,
>
> Is there a book, or tutorial, for RabbitMQ that does not presume previous knowledge of MQ technology, but does presume the reader wants to solve real-world problems in a scalable way? (for instance: IM message routing, n-tier RPC, compute-farm task exectuation, etc )
>
> Thank you,
> :)
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From aljosa.mohorovic at gmail.com  Fri Jul  3 15:07:47 2009
From: aljosa.mohorovic at gmail.com (Aljosa Mohorovic)
Date: Fri, 3 Jul 2009 16:07:47 +0200
Subject: [rabbitmq-discuss] channel.basicPublish - sending json data
Message-ID: <87d364ab0907030707n7fd021e0p1c0d4d16e90a189@mail.gmail.com>

i'm trying to use channel.basicPublish to send json encoded data but
with no luck.
there is com.rabbitmq.tools.json.JSONWriter but i have no idea how
should it be used?
could somebody point me to some related docs or post a simple example?

i was trying to encode HashMap to json and then use something like:
-----------------------------------------------------------------------------------------
AMQP.BasicProperties prop = new AMQP.BasicProperties();
prop.contentType = "application/json";
prop.contentEncoding = "utf-8";
channel.basicPublish("ex", "route", prop, msg);
-----------------------------------------------------------------------------------------

i did try to find something useful in rabbitmq archives but there is
only one message that mentions JSONWriter.
any tips/comments appreciated.

Aljosa Mohorovic



From gaganarora.itm at gmail.com  Fri Jul  3 15:08:27 2009
From: gaganarora.itm at gmail.com (GAGAN ARORA)
Date: Fri, 3 Jul 2009 19:38:27 +0530
Subject: [rabbitmq-discuss] Dropping out messages from a queue
Message-ID: <e2ab72f80907030708v7c3ef798ie27fe37bd766c8f8@mail.gmail.com>

Hi
I am developing a system in which a user will connect to two servers. On
connecting to first server he will become online and will send his presence
update but he will receive presence updates only once he is connected to
other server as his consumer subscribes to his queue after connecting to
second server.
I am using one exchange and one queue per user. So if one user comes online
then he will send his presence update to his exchange and users bound to
that will receive updates.
I need to configure a queue which would hold messages for user who has just
came online until he is connected to other server. After connecting to
second server all messages will be consumed. All messages sent to queue will
be dropped once user goes offline.

Is it possible?

Thanks
Gagan Arora
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090703/60c60f0b/attachment.htm 

From gaganarora.itm at gmail.com  Fri Jul  3 15:10:54 2009
From: gaganarora.itm at gmail.com (GAGAN ARORA)
Date: Fri, 3 Jul 2009 19:40:54 +0530
Subject: [rabbitmq-discuss] Messages Timeout in Queue
Message-ID: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>

Hi
Is it possible to set message time out in Java client API, so that messages
drop out from queue after some interval of time if nobody consumes it?.

Thanks
Gagan Arora
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090703/ec443110/attachment.htm 

From alexis.richardson at gmail.com  Fri Jul  3 15:47:03 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 3 Jul 2009 15:47:03 +0100
Subject: [rabbitmq-discuss] Messages Timeout in Queue
In-Reply-To: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>
References: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>
Message-ID: <167204d20907030747ie3357d7l24c7818a40cd25c9@mail.gmail.com>

Gagan,

On Fri, Jul 3, 2009 at 3:10 PM, GAGAN ARORA<gaganarora.itm at gmail.com> wrote:
> Hi
> Is it possible to set message time out in Java client API, so that messages
> drop out from queue after some interval of time if nobody consumes it?.

Not yet but this is a feature have been asking for quite a bit.  It's
on our roadmap.

There may be other ways to achieve what you want.

alexis



> Thanks
> Gagan Arora
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at gmail.com  Fri Jul  3 15:53:07 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 3 Jul 2009 15:53:07 +0100
Subject: [rabbitmq-discuss] Dropping out messages from a queue
In-Reply-To: <e2ab72f80907030708v7c3ef798ie27fe37bd766c8f8@mail.gmail.com>
References: <e2ab72f80907030708v7c3ef798ie27fe37bd766c8f8@mail.gmail.com>
Message-ID: <167204d20907030753l5a44cfcanea13f261aee3d16e@mail.gmail.com>

Gagan,

I'm a bit confused about what you are trying to do.  I think what you
describe is possible but I am not sure what role is being played by
your two servers.  Is RabbitMQ running on both of them, one of them,
or neither?  You may find it easier to just use one RabbitMQ server.

Can you send a drawing of what your desired configuration is?

alexis




On Fri, Jul 3, 2009 at 3:08 PM, GAGAN ARORA<gaganarora.itm at gmail.com> wrote:
> Hi
> I am developing a system in which a user will connect to two servers. On
> connecting to first server he will become online and will send his presence
> update but he will receive presence updates only once he is connected to
> other server as his consumer subscribes to his queue after connecting to
> second server.
> I am using one exchange and one queue per user. So if one user comes online
> then he will send his presence update to his exchange and users bound to
> that will receive updates.
> I need to configure a queue which would hold messages for user who has just
> came online until he is connected to other server. After connecting to
> second server all messages will be consumed. All messages sent to queue will
> be dropped once user goes offline.
> Is it possible?
> Thanks
> Gagan Arora
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at gmail.com  Fri Jul  3 16:06:50 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 3 Jul 2009 16:06:50 +0100
Subject: [rabbitmq-discuss] conceptual question
In-Reply-To: <4BE7A2A4-4198-47A9-A1BD-B0D5F4E3CB39@gmail.com>
References: <4BE7A2A4-4198-47A9-A1BD-B0D5F4E3CB39@gmail.com>
Message-ID: <167204d20907030806p1c178ea6jf4dde8d6cd653d6e@mail.gmail.com>

Joel

I am not sure if this answers your question but the way RabbitMQ works
is that each consumer gets messages from a queue and each queue is
bound to one node (to which the consumer is connected).  In a cluster
the exchanges' routing tables are replicated across all nodes.  So
when a message arrives a some node in the cluster it will get routed
to any queues that need to see it, whatever node they are on.  In
other words each message makes at most one hop between nodes.

You ask:

> Are subscriptions kept per
> node such that a message going out is first sent to individual nodes
> and from there to this node's subscriber list?

I think the answer is therefore: YES.

Please let me know if this does not make sense or if I have not
understood or answered your question.

alexis



On Wed, Jul 1, 2009 at 3:52 PM, Joel Reymont<joelr1 at gmail.com> wrote:
> Assume that I have a cluster of RabbitMQ nodes and hundreds of
> thousands of subscribers connected to them. Are subscriptions kept per
> node such that a message going out is first sent to individual nodes
> and from there to this node's subscriber list?
>
> My ideal would be for each node to handle delivery to its portion of
> the subscriber list but I don't know if that's how RabbitMQ works.
>
> ? ? ? ?Thanks, Joel
>
> ---
> Mac hacker with a performance bent
> http://www.linkedin.com/in/joelreymont
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From gaganarora.itm at gmail.com  Fri Jul  3 17:05:16 2009
From: gaganarora.itm at gmail.com (GAGAN ARORA)
Date: Fri, 3 Jul 2009 21:35:16 +0530
Subject: [rabbitmq-discuss] Dropping out messages from a queue
In-Reply-To: <167204d20907030753l5a44cfcanea13f261aee3d16e@mail.gmail.com>
References: <e2ab72f80907030708v7c3ef798ie27fe37bd766c8f8@mail.gmail.com>
	<167204d20907030753l5a44cfcanea13f261aee3d16e@mail.gmail.com>
Message-ID: <e2ab72f80907030905w2556e7f1ua9b792bb49b5f7e2@mail.gmail.com>

Hi Alexis
Attaching a doc having architecture diagram and cases desired. Hope this
would make things more clear to you.

Thanks
Gagan Arora

On Fri, Jul 3, 2009 at 8:23 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Gagan,
>
> I'm a bit confused about what you are trying to do.  I think what you
> describe is possible but I am not sure what role is being played by
> your two servers.  Is RabbitMQ running on both of them, one of them,
> or neither?  You may find it easier to just use one RabbitMQ server.
>
> Can you send a drawing of what your desired configuration is?
>
> alexis
>
>
>
>
> On Fri, Jul 3, 2009 at 3:08 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> wrote:
> > Hi
> > I am developing a system in which a user will connect to two servers. On
> > connecting to first server he will become online and will send his
> presence
> > update but he will receive presence updates only once he is connected to
> > other server as his consumer subscribes to his queue after connecting to
> > second server.
> > I am using one exchange and one queue per user. So if one user comes
> online
> > then he will send his presence update to his exchange and users bound to
> > that will receive updates.
> > I need to configure a queue which would hold messages for user who has
> just
> > came online until he is connected to other server. After connecting to
> > second server all messages will be consumed. All messages sent to queue
> will
> > be dropped once user goes offline.
> > Is it possible?
> > Thanks
> > Gagan Arora
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090703/c6c72e41/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Initial State.doc
Type: application/msword
Size: 31232 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090703/c6c72e41/attachment.doc 

From gaganarora.itm at gmail.com  Fri Jul  3 17:08:12 2009
From: gaganarora.itm at gmail.com (GAGAN ARORA)
Date: Fri, 3 Jul 2009 21:38:12 +0530
Subject: [rabbitmq-discuss] Messages Timeout in Queue
In-Reply-To: <167204d20907030747ie3357d7l24c7818a40cd25c9@mail.gmail.com>
References: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>
	<167204d20907030747ie3357d7l24c7818a40cd25c9@mail.gmail.com>
Message-ID: <e2ab72f80907030908n3dfe8dbfu83d38e23b0d793b4@mail.gmail.com>

Hi Alexis

The problem statement here is I dont want my messages in queue for more than
1 minute. I have tried expiration property while publishing a message but
later came to know that it is still not implemented. Can you help me out in
figuring some alternate approach?
Thanks
Gagan Arora

On Fri, Jul 3, 2009 at 8:17 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Gagan,
>
> On Fri, Jul 3, 2009 at 3:10 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> wrote:
> > Hi
> > Is it possible to set message time out in Java client API, so that
> messages
> > drop out from queue after some interval of time if nobody consumes it?.
>
> Not yet but this is a feature have been asking for quite a bit.  It's
> on our roadmap.
>
> There may be other ways to achieve what you want.
>
> alexis
>
>
>
> > Thanks
> > Gagan Arora
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090703/b725401e/attachment.htm 

From Ken.Anderson at sungard.com  Fri Jul  3 19:38:02 2009
From: Ken.Anderson at sungard.com (Ken.Anderson at sungard.com)
Date: Fri, 3 Jul 2009 14:38:02 -0400
Subject: [rabbitmq-discuss] conceptual question
References: <4BE7A2A4-4198-47A9-A1BD-B0D5F4E3CB39@gmail.com>
	<167204d20907030806p1c178ea6jf4dde8d6cd653d6e@mail.gmail.com>
Message-ID: <897C0AFD34144B4F9DB484F132C698AD016162A7@VOO-EXCHANGE05.internal.sungard.corp>

Sorry to interject here, but I'm curious as to the answer as well.  I'm assuming the question is related to performance - does the message make on hop between nodes, and then get distributed, or does the exchange on node X send a separate message to all queues on node Y ?


-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com on behalf of Alexis Richardson
Sent: Fri 7/3/2009 11:06 AM
To: Joel Reymont
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] conceptual question
 
Joel

I am not sure if this answers your question but the way RabbitMQ works
is that each consumer gets messages from a queue and each queue is
bound to one node (to which the consumer is connected).  In a cluster
the exchanges' routing tables are replicated across all nodes.  So
when a message arrives a some node in the cluster it will get routed
to any queues that need to see it, whatever node they are on.  In
other words each message makes at most one hop between nodes.

You ask:

> Are subscriptions kept per
> node such that a message going out is first sent to individual nodes
> and from there to this node's subscriber list?

I think the answer is therefore: YES.

Please let me know if this does not make sense or if I have not
understood or answered your question.

alexis



On Wed, Jul 1, 2009 at 3:52 PM, Joel Reymont<joelr1 at gmail.com> wrote:
> Assume that I have a cluster of RabbitMQ nodes and hundreds of
> thousands of subscribers connected to them. Are subscriptions kept per
> node such that a message going out is first sent to individual nodes
> and from there to this node's subscriber list?
>
> My ideal would be for each node to handle delivery to its portion of
> the subscriber list but I don't know if that's how RabbitMQ works.
>
> ? ? ? ?Thanks, Joel
>
> ---
> Mac hacker with a performance bent
> http://www.linkedin.com/in/joelreymont
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss






From alexis.richardson at gmail.com  Fri Jul  3 19:47:20 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 3 Jul 2009 19:47:20 +0100
Subject: [rabbitmq-discuss] conceptual question
In-Reply-To: <897C0AFD34144B4F9DB484F132C698AD016162A7@VOO-EXCHANGE05.internal.sungard.corp>
References: <4BE7A2A4-4198-47A9-A1BD-B0D5F4E3CB39@gmail.com>
	<167204d20907030806p1c178ea6jf4dde8d6cd653d6e@mail.gmail.com>
	<897C0AFD34144B4F9DB484F132C698AD016162A7@VOO-EXCHANGE05.internal.sungard.corp>
Message-ID: <167204d20907031147m6ea1d8f8ke2248f3bf084e238@mail.gmail.com>

I am fairly sure that....

On Fri, Jul 3, 2009 at 7:38 PM, <Ken.Anderson at sungard.com> wrote:
> Sorry to interject here, but I'm curious as to the answer as well. ?I'm assuming the question is related to performance - does the message make on hop between nodes, and then get distributed,

Yes.

> or does the exchange on node X send a separate message to all queues on node Y ?

No.

Also, on a given node, there is only one copy of a given message in
memory, even when that message has been routed to multiple queues on
that node - provided that message is >60 or so bytes in size (iirc).

alexis



>
> -----Original Message-----
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com on behalf of Alexis Richardson
> Sent: Fri 7/3/2009 11:06 AM
> To: Joel Reymont
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] conceptual question
>
> Joel
>
> I am not sure if this answers your question but the way RabbitMQ works
> is that each consumer gets messages from a queue and each queue is
> bound to one node (to which the consumer is connected). ?In a cluster
> the exchanges' routing tables are replicated across all nodes. ?So
> when a message arrives a some node in the cluster it will get routed
> to any queues that need to see it, whatever node they are on. ?In
> other words each message makes at most one hop between nodes.
>
> You ask:
>
>> Are subscriptions kept per
>> node such that a message going out is first sent to individual nodes
>> and from there to this node's subscriber list?
>
> I think the answer is therefore: YES.
>
> Please let me know if this does not make sense or if I have not
> understood or answered your question.
>
> alexis
>
>
>
> On Wed, Jul 1, 2009 at 3:52 PM, Joel Reymont<joelr1 at gmail.com> wrote:
>> Assume that I have a cluster of RabbitMQ nodes and hundreds of
>> thousands of subscribers connected to them. Are subscriptions kept per
>> node such that a message going out is first sent to individual nodes
>> and from there to this node's subscriber list?
>>
>> My ideal would be for each node to handle delivery to its portion of
>> the subscriber list but I don't know if that's how RabbitMQ works.
>>
>> ? ? ? ?Thanks, Joel
>>
>> ---
>> Mac hacker with a performance bent
>> http://www.linkedin.com/in/joelreymont
>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
>
>



From tsuraan at gmail.com  Fri Jul  3 21:34:43 2009
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 3 Jul 2009 15:34:43 -0500
Subject: [rabbitmq-discuss] Channel thread safety in Java Client
Message-ID: <84fb38e30907031334p56ac5affuf5d92c9428779477@mail.gmail.com>

In the Java client guide, it states that channels should not be used
by more than one thread simultaneously.  How can I guarantee this when
I have a consumer on a channel?  I'd like to have a consumer that puts
messages into a local java BlockingQueue, and then once the messages
are handled by other threads, they are acked on the channel that they
came from.  I can easily ensure that none of my acks coincide with
each other, but how can I ensure that the Connection thread isn't
using the Channel while I'm trying to do an ack?



From 0x6e6562 at gmail.com  Sat Jul  4 09:33:56 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 4 Jul 2009 09:33:56 +0100
Subject: [rabbitmq-discuss] Channel thread safety in Java Client
In-Reply-To: <84fb38e30907031334p56ac5affuf5d92c9428779477@mail.gmail.com>
References: <84fb38e30907031334p56ac5affuf5d92c9428779477@mail.gmail.com>
Message-ID: <269388e30907040133m195bd06awf4692fa15e89b9bc@mail.gmail.com>

Tsuraan,

On Fri, Jul 3, 2009 at 9:34 PM, tsuraan<tsuraan at gmail.com> wrote:
> In the Java client guide, it states that channels should not be used
> by more than one thread simultaneously. ?How can I guarantee this when
> I have a consumer on a channel? ?I'd like to have a consumer that puts
> messages into a local java BlockingQueue, and then once the messages
> are handled by other threads, they are acked on the channel that they
> came from. ?I can easily ensure that none of my acks coincide with
> each other, but how can I ensure that the Connection thread isn't
> using the Channel while I'm trying to do an ack?

The race condition can occur within a single channel is when message
sending gets interleaved and hence sends jumbled frames to the broker.
The connection thread OTOH is not using the channel to transmit
messages, rather, it is the channel that is using the connection to
transmit messages, so I don't think you'll run into an issue if you
are, as I assume, maintaining a mutex around the shared channel
instance.

BTW (I know that app might not permit this), but have you considered
using a channel per consumer?

HTH,

Ben



From alexis.richardson at gmail.com  Sat Jul  4 10:53:21 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sat, 4 Jul 2009 10:53:21 +0100
Subject: [rabbitmq-discuss] Dropping out messages from a queue
In-Reply-To: <e2ab72f80907030905w2556e7f1ua9b792bb49b5f7e2@mail.gmail.com>
References: <e2ab72f80907030708v7c3ef798ie27fe37bd766c8f8@mail.gmail.com>
	<167204d20907030753l5a44cfcanea13f261aee3d16e@mail.gmail.com>
	<e2ab72f80907030905w2556e7f1ua9b792bb49b5f7e2@mail.gmail.com>
Message-ID: <167204d20907040253t7237c0bre7b2735594f56de0@mail.gmail.com>

Gagan,

Hi - thank-you for sending the diagram and information which was very
useful.  There are several ways to implement the 'twitter style'
pattern that you have described.  See below for one way to do it that
illustrates the AMQP model.  It may not be the most efficient solution
in terms of performance as I shall point out.

Two quick questions:

1. Are you using fanout exchanges for this (if you want one exchange
per user, then the answer should be 'yes').

2. Where is the RabbitMQ server running?  Is it on Server 1 or 2, or
is it on a 3rd server?  It may not be that important but it would be
good to know.

OK - to your cases -

Case1: User B sending his message to UserB Exchange which will route
message to User A queue but User A is not connected to any of servers.
At this point of  all messages sent to Queue A should be dropped.

>>> One way to do this is to identify the lifecycle of Queue A with the presence of User A on servers 1 and 2.  In other words, when User A is not connected to server 1, and also not connected to server 2, then Queue A does not exist.  Note - This is not the only way to achieve what you want but it may be the least fiddly :-)

Case2: User A connected to server 1 but UserA consumer is not yet
subscribed to UserA queue. If UserB sends any message to its exchange
which is routed to Queue of UserA. At this moment of time I want all
messages to be stored in queue.

>>> One way to do this (continuing from the above) is to create Queue A immediately after UserA connects to server 1.  This is an action that server 1 can initiate on behalf of UserA.  After Queue A has been created, then it should be bound to all exchanges from which it will receive messages, such as UserB's exchange.  This will then have the stated effect you seek "If UserB sends any message to its exchange [it] is routed to Queue of UserA.".  Also, because UserA's consumer has not yet started consuming messages from Queue A, the messages will all remain stored in the queue.

>>> In addition, if instead of proceeding to Case 3, we revert to Case 1, for example User A disconnects from Server 1, then Queue A can simply be deleted (along with its contents).  (See also Case 5 below)

>>> However - while simple, the above is possibly not the most performant solution if (a) you are running RabbitMQ in clustered mode and (b) your Users generally follow a lot of other Users and (c) they connect and disconnect frequently.  This is because the effect of (c) is to frequuently update the routing table, possibly with a lot of binding/routing data (b), and then replicating it across the cluster (a).

>>> Let us know if you want more info about other ways to do this.


Case3: User A is connected to both servers and UserA consumer is
subscribed to UserA queue. If UserB sends any message to its exchange
which is routed to Queue of UserA. At this moment of time I want all
messages stored in queue to be delievered plus any other incoming
message should also be routed.

>>> In any case, to achieve this, just start consuming messages from Queue A.

>>> I assume by 'delivered', you mean 'delivered to UserA's consumer'.  Where is that running?




Case4: User A is connected to both servers and UserA consumer is
subscribed to UserA queue. Now User disconnects from Server 2. If
UserB sends any message to its exchange which is routed to Queue of
UserA. Again I want to store all messages.

>>> To achieve this, just stop consuming messages from Queue A.  They will be stored in Queue A.



Case5: If user A is disconnected from both servers. Initial state is
achieved again.

>>> When User A disconnects from Server 1, then Server 1 can tell RabbitMQ to delete Queue A (along with its contents)

Cheers,

alexis






On Fri, Jul 3, 2009 at 5:05 PM, GAGAN ARORA<gaganarora.itm at gmail.com> wrote:
> Hi Alexis
> Attaching a doc having architecture diagram and cases desired. Hope this
> would make things more clear to you.
> Thanks
> Gagan Arora
>
> On Fri, Jul 3, 2009 at 8:23 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Gagan,
>>
>> I'm a bit confused about what you are trying to do. ?I think what you
>> describe is possible but I am not sure what role is being played by
>> your two servers. ?Is RabbitMQ running on both of them, one of them,
>> or neither? ?You may find it easier to just use one RabbitMQ server.
>>
>> Can you send a drawing of what your desired configuration is?
>>
>> alexis
>>
>>
>>
>>
>> On Fri, Jul 3, 2009 at 3:08 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> wrote:
>> > Hi
>> > I am developing a system in which a user will connect to two servers. On
>> > connecting to first server he will become online and will send his
>> > presence
>> > update but he will receive presence updates only once he is connected to
>> > other server as his consumer subscribes to his queue after connecting to
>> > second server.
>> > I am using one exchange and one queue per user. So if one user comes
>> > online
>> > then he will send his presence update to his exchange and users bound to
>> > that will receive updates.
>> > I need to configure a queue which would hold messages for user who has
>> > just
>> > came online until he is connected to other server. After connecting to
>> > second server all messages will be consumed. All messages sent to queue
>> > will
>> > be dropped once user goes offline.
>> > Is it possible?
>> > Thanks
>> > Gagan Arora
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>



From alexis.richardson at gmail.com  Sat Jul  4 11:02:41 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sat, 4 Jul 2009 11:02:41 +0100
Subject: [rabbitmq-discuss] Messages Timeout in Queue
In-Reply-To: <e2ab72f80907030908n3dfe8dbfu83d38e23b0d793b4@mail.gmail.com>
References: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>
	<167204d20907030747ie3357d7l24c7818a40cd25c9@mail.gmail.com>
	<e2ab72f80907030908n3dfe8dbfu83d38e23b0d793b4@mail.gmail.com>
Message-ID: <167204d20907040302l561be62pc7921176ed319095@mail.gmail.com>

Gagan,

On Fri, Jul 3, 2009 at 5:08 PM, GAGAN ARORA<gaganarora.itm at gmail.com> wrote:
> Hi Alexis
> The problem statement here is I dont want my messages in queue for more than
> 1 minute.

The easiest way to do this is for the client to keep consuming the
messages from the queue.

However: presumably you want messages to be ignored in the case where
(a) there is no consumer to get the messages from the queue; and (b)
the messages are more than one minute old.

If so then: Have you considered putting a timestamp on the messages?
That way, when a consumer starts taking messages from the queue, it
can simply check the timestamps and throw away anything 'old'.  This
solution works just fine when (i) you don't need real time accuracy
ie. "about a minute" is just as good as "exactly a minute", and
provided that (ii) there aren't too many messages to throw away.
Judging by the document that you sent, both (i) and (ii) are true.

Does this help?

alexis


> I have tried expiration property while publishing a message but
> later came to know that it is still not implemented. Can you help me out in
> figuring some alternate approach?
> Thanks
> Gagan Arora
>
> On Fri, Jul 3, 2009 at 8:17 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Gagan,
>>
>> On Fri, Jul 3, 2009 at 3:10 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> wrote:
>> > Hi
>> > Is it possible to set message time out in Java client API, so that
>> > messages
>> > drop out from queue after some interval of time if nobody consumes it?.
>>
>> Not yet but this is a feature have been asking for quite a bit. ?It's
>> on our roadmap.
>>
>> There may be other ways to achieve what you want.
>>
>> alexis
>>
>>
>>
>> > Thanks
>> > Gagan Arora
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>
>



From alexis.richardson at gmail.com  Sat Jul  4 13:10:13 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sat, 4 Jul 2009 13:10:13 +0100
Subject: [rabbitmq-discuss] Comet interface
In-Reply-To: <b0200d7f0907030406l3811e222r964358757ac0bb70@mail.gmail.com>
References: <b0200d7f0907030406l3811e222r964358757ac0bb70@mail.gmail.com>
Message-ID: <167204d20907040510r5ab6c569ue692ecf086853035@mail.gmail.com>

Ben,

I am going to jump in and try to answer your questions though please
bear in mind that I am far from intimate with some of the engineering
details.



On Fri, Jul 3, 2009 at 12:06 PM, Ben Browitt<ben.browitt at gmail.com> wrote:
> Hi,
>
> I want to write a Comet web interface to RabbitMQ in Erlang.

Great!



> This interface will be responsible for authenticating users, managing
> sessions and routing messages.

Interesting.  How would auth work?


> For each logged-in user the interface will create a process that will route
> messages from the client to RabbitMQ,
> send messages from RabbitMQ to the client when possible and queue them in
> its mailbox when it's not.
> The reason for the queue is that in some implementations of Comet the client
> is not available 100% of the time.

OK.



> I wonder what is the best approach to communicate with RabbitMQ considering
> that the interface is in Erlang.
> One possibility is that each process will be an instance of the RabbitMQ
> client
> and the other option is that there will be one central process that will act
> as a bridge.
>
> I've noticed the http example

Before proceeding I would strongly recommend you dig into the existing
HTTP server and client example.  There may be duplication between
those and what you propose.  Indeed, if you could evaluate what we
have done and propose or write improvements, that could be very
helpful.


>  .... and the STOMP adapter but read on several
> places that they don't work with every release
> probably because RabbitMQ is a moving target and is in active development (a
> good thing).

Yes, the release process for clients lags that for the broker at the
moment, partly because the whole team is very busy, and partly because
we are adding new features to the broker which, as Matthias says, are
of 'beta' status on initial release.

Other approaches you may wish to check out -

1. Use Orbited (open source) or Kaazing
2. Use RabbitHub:
http://www.lshift.net/blog/2009/06/30/pubsub-over-webhooks-with-rabbithub



> Do the http example and the STOMP adapter use one of the approaches I
> mentioned above?

Yes, I think there may well be similarities.  Take a look at the code.
 Maybe Tony will be tempted to comment over the weekend but please
note that the weather in London is currently pretty good ;-)


> Is the Erlang client stable?

It could benefit from review.  Please see the discussions between Jack
Moffitt and the team here, a few weeks ago.

Cheers,

alexis



> Thanks
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From 0x6e6562 at gmail.com  Sat Jul  4 13:27:39 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 4 Jul 2009 13:27:39 +0100
Subject: [rabbitmq-discuss] Fwd:  channel.basicPublish - sending json data
In-Reply-To: <269388e30907040527y3597ead6kc4bfb6f8d15ac18b@mail.gmail.com>
References: <87d364ab0907030707n7fd021e0p1c0d4d16e90a189@mail.gmail.com>
	<269388e30907040527y3597ead6kc4bfb6f8d15ac18b@mail.gmail.com>
Message-ID: <269388e30907040527g2d0c2e48u4a89102ac0856cb8@mail.gmail.com>

---------- Forwarded message ----------
From: Ben Hood <0x6e6562 at gmail.com>
Date: Sat, Jul 4, 2009 at 1:27 PM
Subject: Re: [rabbitmq-discuss] channel.basicPublish - sending json data
To: Aljosa Mohorovic <aljosa.mohorovic at gmail.com>


Aljosa,

On Fri, Jul 3, 2009 at 3:07 PM, Aljosa
Mohorovic<aljosa.mohorovic at gmail.com> wrote:
> i'm trying to use channel.basicPublish to send json encoded data but
> with no luck.
> there is com.rabbitmq.tools.json.JSONWriter but i have no idea how
> should it be used?
> could somebody point me to some related docs or post a simple example?
>
> i was trying to encode HashMap to json and then use something like:
> -----------------------------------------------------------------------------------------
> AMQP.BasicProperties prop = new AMQP.BasicProperties();
> prop.contentType = "application/json";
> prop.contentEncoding = "utf-8";
> channel.basicPublish("ex", "route", prop, msg);
> -----------------------------------------------------------------------------------------
>
> i did try to find something useful in rabbitmq archives but there is
> only one message that mentions JSONWriter.
> any tips/comments appreciated.

Have a look at the HelloJsonClient and HelloJsonServer examples in the
Java client. Basically there is a JSON serializer implementation in
the examples directory and all this does is pack and unpack JSON
objects.

HTH,

Ben



From bms at incunabulum.net  Sat Jul  4 14:15:48 2009
From: bms at incunabulum.net (Bruce Simpson)
Date: Sat, 04 Jul 2009 14:15:48 +0100
Subject: [rabbitmq-discuss] FreeBSD ports/net/rabbitmq bumped
Message-ID: <4A4F5604.4020807@incunabulum.net>

Hi,

I found and fixed a few issues in the RabbitMQ port for FreeBSD. 
rabbitmqctl now known to work.

The FreshPorts page for RabbitMQ is here:
   http://www.freshports.org/net/rabbitmq

I have txAMQP loaded as a clip but I can't fire it -- problems with 
encoding, raised with Esteve off-list.

cheers,
BMS



From gaganarora.itm at gmail.com  Sat Jul  4 20:07:08 2009
From: gaganarora.itm at gmail.com (GAGAN ARORA)
Date: Sun, 5 Jul 2009 00:37:08 +0530
Subject: [rabbitmq-discuss] Dropping out messages from a queue
In-Reply-To: <167204d20907040253t7237c0bre7b2735594f56de0@mail.gmail.com>
References: <e2ab72f80907030708v7c3ef798ie27fe37bd766c8f8@mail.gmail.com>
	<167204d20907030753l5a44cfcanea13f261aee3d16e@mail.gmail.com>
	<e2ab72f80907030905w2556e7f1ua9b792bb49b5f7e2@mail.gmail.com>
	<167204d20907040253t7237c0bre7b2735594f56de0@mail.gmail.com>
Message-ID: <e2ab72f80907041207l61b7d8ei8fb391204945f471@mail.gmail.com>

Alexis,

Thanks for your wonderful support and solutions.

Firstly answers to your queries:

1. Are you using fanout exchanges for this (if you want one exchange
per user, then the answer should be 'yes').

>> No I am using topic exchanges because there will be three type of
bindings of a queue with an excajnde. One for publishing messages to all
users, another for one to one messaging and third for publishing message to
a set of users.

2. Where is the RabbitMQ server running?  Is it on Server 1 or 2, or
is it on a 3rd server?  It may not be that important but it would be
good to know.

>> RabbitMQ Server is running on 3rd Server.


Back to original problem.

Actually I thought of the solution provided by you before posting the query
to you. But if I follow this solution I have to perform following steps
whenever a user comes online:
1. Create a queue.
2. Create a binding of newly created queue with all exchanges of other users
for retrieving messages published by other users.
3. Creating a binding with exchange of all users for one to one messaging.
4. Create a binding with exchanges of a set of users.

When user goes offline following operation is to be performed:
1. Delete all the existing bindings of a queue.
2. Deleting the queue.

Actually I want my online and offline processes light weighted. According to
me this solution would have a high impact on performance and will increase
time to come online and offline.

Kindly let me know if this can be achieved in some other manner.

Thanks
Gagan Arora





On Sat, Jul 4, 2009 at 3:23 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Gagan,
>
> Hi - thank-you for sending the diagram and information which was very
> useful.  There are several ways to implement the 'twitter style'
> pattern that you have described.  See below for one way to do it that
> illustrates the AMQP model.  It may not be the most efficient solution
> in terms of performance as I shall point out.
>
> Two quick questions:
>
> 1. Are you using fanout exchanges for this (if you want one exchange
> per user, then the answer should be 'yes').
>
> 2. Where is the RabbitMQ server running?  Is it on Server 1 or 2, or
> is it on a 3rd server?  It may not be that important but it would be
> good to know.
>
> OK - to your cases -
>
> Case1: User B sending his message to UserB Exchange which will route
> message to User A queue but User A is not connected to any of servers.
> At this point of  all messages sent to Queue A should be dropped.
>
> >>> One way to do this is to identify the lifecycle of Queue A with the
> presence of User A on servers 1 and 2.  In other words, when User A is not
> connected to server 1, and also not connected to server 2, then Queue A does
> not exist.  Note - This is not the only way to achieve what you want but it
> may be the least fiddly :-)
>
> Case2: User A connected to server 1 but UserA consumer is not yet
> subscribed to UserA queue. If UserB sends any message to its exchange
> which is routed to Queue of UserA. At this moment of time I want all
> messages to be stored in queue.
>
> >>> One way to do this (continuing from the above) is to create Queue A
> immediately after UserA connects to server 1.  This is an action that server
> 1 can initiate on behalf of UserA.  After Queue A has been created, then it
> should be bound to all exchanges from which it will receive messages, such
> as UserB's exchange.  This will then have the stated effect you seek "If
> UserB sends any message to its exchange [it] is routed to Queue of UserA.".
>  Also, because UserA's consumer has not yet started consuming messages from
> Queue A, the messages will all remain stored in the queue.
>
> >>> In addition, if instead of proceeding to Case 3, we revert to Case 1,
> for example User A disconnects from Server 1, then Queue A can simply be
> deleted (along with its contents).  (See also Case 5 below)
>
> >>> However - while simple, the above is possibly not the most performant
> solution if (a) you are running RabbitMQ in clustered mode and (b) your
> Users generally follow a lot of other Users and (c) they connect and
> disconnect frequently.  This is because the effect of (c) is to frequuently
> update the routing table, possibly with a lot of binding/routing data (b),
> and then replicating it across the cluster (a).
>
> >>> Let us know if you want more info about other ways to do this.
>
>
> Case3: User A is connected to both servers and UserA consumer is
> subscribed to UserA queue. If UserB sends any message to its exchange
> which is routed to Queue of UserA. At this moment of time I want all
> messages stored in queue to be delievered plus any other incoming
> message should also be routed.
>
> >>> In any case, to achieve this, just start consuming messages from Queue
> A.
>
> >>> I assume by 'delivered', you mean 'delivered to UserA's consumer'.
>  Where is that running?
>
>
>
>
> Case4: User A is connected to both servers and UserA consumer is
> subscribed to UserA queue. Now User disconnects from Server 2. If
> UserB sends any message to its exchange which is routed to Queue of
> UserA. Again I want to store all messages.
>
> >>> To achieve this, just stop consuming messages from Queue A.  They will
> be stored in Queue A.
>
>
>
> Case5: If user A is disconnected from both servers. Initial state is
> achieved again.
>
> >>> When User A disconnects from Server 1, then Server 1 can tell RabbitMQ
> to delete Queue A (along with its contents)
>
> Cheers,
>
> alexis
>
>
>
>
>
>
> On Fri, Jul 3, 2009 at 5:05 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> wrote:
> > Hi Alexis
> > Attaching a doc having architecture diagram and cases desired. Hope this
> > would make things more clear to you.
> > Thanks
> > Gagan Arora
> >
> > On Fri, Jul 3, 2009 at 8:23 PM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Gagan,
> >>
> >> I'm a bit confused about what you are trying to do.  I think what you
> >> describe is possible but I am not sure what role is being played by
> >> your two servers.  Is RabbitMQ running on both of them, one of them,
> >> or neither?  You may find it easier to just use one RabbitMQ server.
> >>
> >> Can you send a drawing of what your desired configuration is?
> >>
> >> alexis
> >>
> >>
> >>
> >>
> >> On Fri, Jul 3, 2009 at 3:08 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> >> wrote:
> >> > Hi
> >> > I am developing a system in which a user will connect to two servers.
> On
> >> > connecting to first server he will become online and will send his
> >> > presence
> >> > update but he will receive presence updates only once he is connected
> to
> >> > other server as his consumer subscribes to his queue after connecting
> to
> >> > second server.
> >> > I am using one exchange and one queue per user. So if one user comes
> >> > online
> >> > then he will send his presence update to his exchange and users bound
> to
> >> > that will receive updates.
> >> > I need to configure a queue which would hold messages for user who has
> >> > just
> >> > came online until he is connected to other server. After connecting to
> >> > second server all messages will be consumed. All messages sent to
> queue
> >> > will
> >> > be dropped once user goes offline.
> >> > Is it possible?
> >> > Thanks
> >> > Gagan Arora
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090705/73a317a8/attachment.htm 

From gaganarora.itm at gmail.com  Sat Jul  4 20:28:02 2009
From: gaganarora.itm at gmail.com (GAGAN ARORA)
Date: Sun, 5 Jul 2009 00:58:02 +0530
Subject: [rabbitmq-discuss] Messages Timeout in Queue
In-Reply-To: <167204d20907040302l561be62pc7921176ed319095@mail.gmail.com>
References: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>
	<167204d20907030747ie3357d7l24c7818a40cd25c9@mail.gmail.com>
	<e2ab72f80907030908n3dfe8dbfu83d38e23b0d793b4@mail.gmail.com>
	<167204d20907040302l561be62pc7921176ed319095@mail.gmail.com>
Message-ID: <e2ab72f80907041228m7e91f02fy5e15779350983556@mail.gmail.com>

Hi Alexis

My system is similar to an IM system and is using RabbitMQ for presence
updates and have designed it in such a way that a consumer subscribes to a
queue only when it comes online.Now the issue is as stated by you there will
be a large no of messages ready to be deleivered when a user comes online.
Checking timestamp for each message will result in high cost.

There can be a solution in which a message can be published using immediate
flag. But it is desired by consumer to get all messages which are less than
1 minute old.

Can you suggest some other solution for achieving this?

Thanks
Gagan Arora




On Sat, Jul 4, 2009 at 3:32 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Gagan,
>
> On Fri, Jul 3, 2009 at 5:08 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> wrote:
> > Hi Alexis
> > The problem statement here is I dont want my messages in queue for more
> than
> > 1 minute.
>
> The easiest way to do this is for the client to keep consuming the
> messages from the queue.
>
> However: presumably you want messages to be ignored in the case where
> (a) there is no consumer to get the messages from the queue; and (b)
> the messages are more than one minute old.
>
> If so then: Have you considered putting a timestamp on the messages?
> That way, when a consumer starts taking messages from the queue, it
> can simply check the timestamps and throw away anything 'old'.  This
> solution works just fine when (i) you don't need real time accuracy
> ie. "about a minute" is just as good as "exactly a minute", and
> provided that (ii) there aren't too many messages to throw away.
> Judging by the document that you sent, both (i) and (ii) are true.
>
> Does this help?
>
> alexis
>
>
> > I have tried expiration property while publishing a message but
> > later came to know that it is still not implemented. Can you help me out
> in
> > figuring some alternate approach?
> > Thanks
> > Gagan Arora
> >
> > On Fri, Jul 3, 2009 at 8:17 PM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Gagan,
> >>
> >> On Fri, Jul 3, 2009 at 3:10 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> >> wrote:
> >> > Hi
> >> > Is it possible to set message time out in Java client API, so that
> >> > messages
> >> > drop out from queue after some interval of time if nobody consumes
> it?.
> >>
> >> Not yet but this is a feature have been asking for quite a bit.  It's
> >> on our roadmap.
> >>
> >> There may be other ways to achieve what you want.
> >>
> >> alexis
> >>
> >>
> >>
> >> > Thanks
> >> > Gagan Arora
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090705/31587c4a/attachment.htm 

From bms at incunabulum.net  Sat Jul  4 20:30:22 2009
From: bms at incunabulum.net (Bruce Simpson)
Date: Sat, 04 Jul 2009 20:30:22 +0100
Subject: [rabbitmq-discuss] FreeBSD ports/net/py-txamqp created
Message-ID: <4A4FADCE.2020604@incunabulum.net>

Hi all,

This is just a brief heads-up, to let you all know that I've just added 
a FreeBSD port entry, for Esteve Fernandez'  txAMQP module.

For those who don't already know, txAMQP is an asynchronous AMQP 
transport library for Python / Twisted.

The FreshPorts page for py-txamqp is here:
   http://www.freshports.org/net/py-txamqp

I ran Esteve's example code here with RabbitMQ 1.6.0 on FreeBSD 
7.2-STABLE, i386 and amd64 platforms, and all appears to work:
    http://fluidinfo.com/esteve/stuff/txamqp_consumer.py
    http://fluidinfo.com/esteve/stuff/txamqp_publisher.py

The Thrift stuff is not yet ready for prime time there, I need to fix 
the Python Thrift bindings since bumping it up to the Apache Incubator 
version.

thanks,
BMS



From tsuraan at gmail.com  Sun Jul  5 04:54:18 2009
From: tsuraan at gmail.com (tsuraan)
Date: Sat, 4 Jul 2009 22:54:18 -0500
Subject: [rabbitmq-discuss] Channel thread safety in Java Client
In-Reply-To: <269388e30907040133m195bd06awf4692fa15e89b9bc@mail.gmail.com>
References: <84fb38e30907031334p56ac5affuf5d92c9428779477@mail.gmail.com>
	<269388e30907040133m195bd06awf4692fa15e89b9bc@mail.gmail.com>
Message-ID: <84fb38e30907042054x4eb31f7fo2a19eace3cf941cf@mail.gmail.com>

> BTW (I know that app might not permit this), but have you considered
> using a channel per consumer?

I could do that.  I'd just have to keep track of which channel each
message came from.  Either way, I shouldn't be getting contention
between the Connection thread that's doing the message receiving and
the (properly synchronized) threads that are doing the acks and
publishes, right?



From bms at incunabulum.net  Sun Jul  5 11:58:23 2009
From: bms at incunabulum.net (Bruce Simpson)
Date: Sun, 05 Jul 2009 11:58:23 +0100
Subject: [rabbitmq-discuss] FreeBSD ports/net/amqp08 added
Message-ID: <4A50874F.5080808@incunabulum.net>

This is a stub port which installs the AMQP 0.8 XML specification hosted 
at Apache.

It seems like something which txAMQP and other packages obviously depend 
upon, however, no dependencies for it have been added yet.

So it will normally install into /usr/local/share/amqp/amqp0-8.xml.

cheers
BMS




From qingyan123 at gmail.com  Sun Jul  5 18:09:37 2009
From: qingyan123 at gmail.com (Qingyan(Evan) Liu)
Date: Mon, 6 Jul 2009 01:09:37 +0800
Subject: [rabbitmq-discuss] how can i make a message to be consumed at a
	later time
Message-ID: <c647ccce0907051009g184679a9k87c2f42877d5dde0@mail.gmail.com>

Sorry i'm fresh to rabbitmq. I wanna to use it like a timer, for
example, producer publishes a message called 'bomb', what i want is to
consume(explode) the 'bomb' after 5 minutes. Can i implement such case
by means of rabbitmq? And how?

Thanks a lot for your kind suggestions.

sincerely,
Evan



From dialtone at gmail.com  Sun Jul  5 19:41:20 2009
From: dialtone at gmail.com (Valentino Volonghi)
Date: Sun, 5 Jul 2009 11:41:20 -0700
Subject: [rabbitmq-discuss] how can i make a message to be consumed at a
	later time
In-Reply-To: <c647ccce0907051009g184679a9k87c2f42877d5dde0@mail.gmail.com>
References: <c647ccce0907051009g184679a9k87c2f42877d5dde0@mail.gmail.com>
Message-ID: <46499228-7A4E-414C-AB3B-1A1D0FF63096@gmail.com>


On Jul 5, 2009, at 10:09 AM, Qingyan(Evan) Liu wrote:

> Sorry i'm fresh to rabbitmq. I wanna to use it like a timer, for
> example, producer publishes a message called 'bomb', what i want is to
> consume(explode) the 'bomb' after 5 minutes. Can i implement such case
> by means of rabbitmq? And how?


This is one of the things I'm "fighting" with right now. I think the  
right way
to implement this, as it would be with TTL, is to include a timestamp  
for
execution inside the message, let's say "run at 2009-07-10 9:10:10"
then when the message is received instead of executing it right away
you just wait until the timer goes off. If you are using qos prefetch  
you
can increase the prefetch by one while you wait, if you are not you  
don't
care and it will work correctly.

--
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090705/4d95e473/attachment.pgp 

From 0x6e6562 at gmail.com  Sun Jul  5 20:45:11 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 5 Jul 2009 20:45:11 +0100
Subject: [rabbitmq-discuss] Channel thread safety in Java Client
In-Reply-To: <84fb38e30907042054x4eb31f7fo2a19eace3cf941cf@mail.gmail.com>
References: <84fb38e30907031334p56ac5affuf5d92c9428779477@mail.gmail.com>
	<269388e30907040133m195bd06awf4692fa15e89b9bc@mail.gmail.com>
	<84fb38e30907042054x4eb31f7fo2a19eace3cf941cf@mail.gmail.com>
Message-ID: <269388e30907051245l113fd063l60256552e659f4b3@mail.gmail.com>

Tsuraan,

On Sun, Jul 5, 2009 at 4:54 AM, tsuraan<tsuraan at gmail.com> wrote:
>> BTW (I know that app might not permit this), but have you considered
>> using a channel per consumer?
>
> I could do that. ?I'd just have to keep track of which channel each
> message came from.

Why is this?

> Either way, I shouldn't be getting contention
> between the Connection thread that's doing the message receiving and
> the (properly synchronized) threads that are doing the acks and
> publishes, right?

Yes, that's right.

Ben



From 0x6e6562 at gmail.com  Sun Jul  5 20:53:26 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 5 Jul 2009 20:53:26 +0100
Subject: [rabbitmq-discuss] multiple consumers on one channel?
In-Reply-To: <84fb38e30907021251m11f0f22na827784ff4fc70f1@mail.gmail.com>
References: <84fb38e30907021023t527f9105jfb594e24e20e0097@mail.gmail.com>
	<84fb38e30907021251m11f0f22na827784ff4fc70f1@mail.gmail.com>
Message-ID: <269388e30907051253v3749ac35kc05c0ef6673b09d5@mail.gmail.com>

Tsuraan,

On Thu, Jul 2, 2009 at 8:51 PM, tsuraan<tsuraan at gmail.com> wrote:
> Ok, this is strange. ?I can't even get two subscriptions on the same
> connection, using different channels. ?If I make a different
> connection for each consumer, then I get messages simultaneously. ?If
> I have my two channels on the same connection, I get all the messages
> from one of the queues, then all the messages from the other one.
> I've included some pretty ugly code to demonstrate parallel consumers.
> ?If you change main() to only use one connection and two channels, you
> can see it draining messages from the first queue at one message per
> second, then draining messages from the second queue at the same rate.

Is this question still current, or have you answered your own question
in the meantime?

Ben



From zerthurd at gmail.com  Mon Jul  6 11:41:01 2009
From: zerthurd at gmail.com (Maxim Treskin)
Date: Mon, 6 Jul 2009 17:41:01 +0700
Subject: [rabbitmq-discuss]  General message tracing
Message-ID: <be8f531d0907060341w77ff96c2h91ae55e056beb50f@mail.gmail.com>

Hello

Is there any way to realise tracing and logging of messages, published on
bus?
We can declare exchange type "headers", bind it with match-rules
with tracing queue and publicate messages having some flags in headers.
When this flags matched with rules in binding, message passed to tracing
queue.

But this behaviour is not appropriated because we want to publicate message
to
specified routing in some cases and possible trace it.
So, this behaviour is best for us:
1. Create exchange "mq.exch" with type "headers"
2. ??? Bind queue "trace" and "mq.exch" with match-rule [{"x-match": "any"},
{"trace":1}],
   so, if message-headers contains trace:1 flag, this message passed to
"trace" queue. ??? (or anything else?)
3. Bind main handler queue "handler" and "mq.exch" with route "mq.handler"
4. Publish message without any headers to route "mq.handler", it passed to
"handler" queue.
5. Publish message with header trace:1 to route mq.handler, it passed to
"handler" queue and "trace" queue.

How we can make it (or something with this behaviour) with RabbitMQ?

Thank you.

-- 
Maxim Treskin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090706/59683238/attachment.htm 

From tsuraan at gmail.com  Mon Jul  6 16:41:14 2009
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 6 Jul 2009 10:41:14 -0500
Subject: [rabbitmq-discuss] Channel thread safety in Java Client
In-Reply-To: <269388e30907051245l113fd063l60256552e659f4b3@mail.gmail.com>
References: <84fb38e30907031334p56ac5affuf5d92c9428779477@mail.gmail.com>
	<269388e30907040133m195bd06awf4692fa15e89b9bc@mail.gmail.com>
	<84fb38e30907042054x4eb31f7fo2a19eace3cf941cf@mail.gmail.com>
	<269388e30907051245l113fd063l60256552e659f4b3@mail.gmail.com>
Message-ID: <84fb38e30907060841k77573663p1ed5d49ad0e9e339@mail.gmail.com>

>> I could do that.  I'd just have to keep track of which channel each
>> message came from.
>
> Why is this?

My current app needs to process messages in batches of 4, and it's
getting messages from multiple queues (although I think that might be
unnecessary).  Once the messages are batched together into a group of
4, they are put into a BlockingQueue, where another thread processes
the batch and then acks the messages as being done.  So, my basic
design is to have Consumers on each queue (each batch of work has only
messages from a single queue) aggregating messages and putting them
into the BlockingQueue once enough have been received.

If I only have one channel that's shared everywhere, I can just give
that channel to the thread that's doing the batch processing and it
can ack the messages on the only channel that there is.  If there are
multiple channels, then each message must be acked on the channel that
it was received on, so the message, the dtag, and the channel must all
be kept track of.  It's not a difficult thing, but a single shared
channel just seems cleaner somehow.

All this might be obsolete, since I may be able to just use a single
queue for all of these messages.  The messages all have the same
structure, and they're all processed by the same program, but they are
messages about different events, so I have them in different queues.
I might change that, since it's starting to look like excessive
complication now that I look at it carefully.



From tsuraan at gmail.com  Mon Jul  6 16:49:16 2009
From: tsuraan at gmail.com (tsuraan)
Date: Mon, 6 Jul 2009 10:49:16 -0500
Subject: [rabbitmq-discuss] multiple consumers on one channel?
In-Reply-To: <269388e30907051253v3749ac35kc05c0ef6673b09d5@mail.gmail.com>
References: <84fb38e30907021023t527f9105jfb594e24e20e0097@mail.gmail.com>
	<84fb38e30907021251m11f0f22na827784ff4fc70f1@mail.gmail.com>
	<269388e30907051253v3749ac35kc05c0ef6673b09d5@mail.gmail.com>
Message-ID: <84fb38e30907060849g3da67bc6m3b552260a9ad7e27@mail.gmail.com>

> Is this question still current, or have you answered your own question
> in the meantime?

I think I've answered it myself, but just for fun, here's what I've
seen:  I put two consumers on a single channel, where each queue being
subscribed to has some messages.  I always get all the messages from
one queue before getting any messages from the other queue.  After
both consumers have seen all the messages in their associated queues,
then any new messages in either queue are seen immediately.  Is that
normal?  I would have thought there would be some interleaving of
initial data, like the consumers would get alternating messages or
something, but that doesn't seem to be the case.



From allen.fowler at yahoo.com  Mon Jul  6 16:54:15 2009
From: allen.fowler at yahoo.com (Allen Fowler)
Date: Mon, 6 Jul 2009 08:54:15 -0700 (PDT)
Subject: [rabbitmq-discuss] Return message? [Was: Re: Sample code for
	python?]
In-Reply-To: <0058CDE8-43F9-4390-B7BB-E811D6CBF7E2@gmail.com>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
	<d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com>
	<558122.16141.qm@web45608.mail.sp1.yahoo.com>
	<d272f0690907021151k9b581a9w61803baa37092398@mail.gmail.com>
	<825108.73047.qm@web45604.mail.sp1.yahoo.com>
	<d272f0690907021250j1a1177aoe121c3fc749b3ff0@mail.gmail.com>
	<716148.78533.qm@web45616.mail.sp1.yahoo.com>
	<0058CDE8-43F9-4390-B7BB-E811D6CBF7E2@gmail.com>
Message-ID: <539885.23651.qm@web45608.mail.sp1.yahoo.com>





> > In our case, the back-end machines will be .net or possibly Java.  The front 
> end web-UI will be python. (Likely TurboGears 2)
> > 
> > As it stands now, the front end machines will be calling specific functions on 
> the back-end boxes via a basic HTTP/XML API.  For instance:  "Place order for 
> customer X"
> > 
> > The back-end machines do whatever processing they need and reply with a result 
> code.  (Success, No Stock Left, System Busy, etc.)
> > 
> > My idea was to use RabbitMQ for the request transport instread of HTTP.  Is 
> this a resonaable idea? Can/Should RabbitMQ be used in this sort of environment?
> 
> 
> In this case I have been writing the tool that you might need:
> 
> http://bitbucket.org/adroll/quebert/overview/
> 
> This is also written in Python but doesn't require Python anywhere else
> and deployment is easy.
> 
> Most of the things I wrote in an old email to this list are still true:
> http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-June/004273.html
> 
> Although the API changed a bit for the better.
> 
> Essentially just using a mediator like this:
> http://bitbucket.org/adroll/quebert/src/tip/examples/med.py
> 
> and starting it using (just one example):
> twistd --pidfile=/var/run/quebert.pid --logfile=/var/log/quebert.log quebert 
> --config=med.main --with_syslog_prefix=quebert
> Would give you a system that for any message that gets in routes it to any
> available HTTP server that knows how to process it (and you can do this
> through a load balancer or directly sending the message).
> 
> The actual example code can be used as a configuration file without
> changing it.
> 
> You can then easily add more features through hooks or on the point
> of execution. I've essentially designed the system to answer your very
> same concerns :).
> 


I am not at all familiar with the twisted system, but does this mean that RabbitMQ/AMQP does not, on it's own, provide any method for a message sender to ascertain the success or failure of a task embodied by a message?

 
That is to say: The backed system (job receiver) has no way of signaling to the front-end (job-sender) any details about the job the front-end is waiting on?


Is this true?


      




From alexis.richardson at gmail.com  Mon Jul  6 16:58:27 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 6 Jul 2009 16:58:27 +0100
Subject: [rabbitmq-discuss] Messages Timeout in Queue
In-Reply-To: <e2ab72f80907041228m7e91f02fy5e15779350983556@mail.gmail.com>
References: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>
	<167204d20907030747ie3357d7l24c7818a40cd25c9@mail.gmail.com>
	<e2ab72f80907030908n3dfe8dbfu83d38e23b0d793b4@mail.gmail.com>
	<167204d20907040302l561be62pc7921176ed319095@mail.gmail.com>
	<e2ab72f80907041228m7e91f02fy5e15779350983556@mail.gmail.com>
Message-ID: <167204d20907060858t2937f70bv32080711d32a750c@mail.gmail.com>

Gagan

As I understood from your document:

a) when the User A is not logged into server 1 or server 2, any
messages sent to them by User B are discarded
b) but, when User A is logged in to server 1, any messages sent by
User B that may be routed to User A are queued in Queue A, and then
...
c) .... delivered when User A logs into server 2.

Provided that you can implement this efficiently (see other email)
then the consumer at User A only needs to discard messages that are
older than one minute, and that were not already discarded due to (a)
above.  So unless the time interval between A logging into server 1,
and A logging into server 2, is "quite long" then the 'timestamp'
method adds very little overhead.

Is that correct or have I missed something?

alexis






On Sat, Jul 4, 2009 at 8:28 PM, GAGAN ARORA<gaganarora.itm at gmail.com> wrote:
> Hi Alexis
>
> My system is similar to an IM system and is using RabbitMQ for presence
> updates and have designed it in such a way that a consumer subscribes to a
> queue only when it comes online.Now the issue is as stated by you there will
> be a large no of messages ready to be deleivered when a user comes online.
> Checking timestamp for each message will result in high cost.
>
> There can be a solution in which a message can be published using immediate
> flag. But it is desired by consumer to get all messages which are less than
> 1 minute old.
>
> Can you suggest some other solution for achieving this?
>
> Thanks
> Gagan Arora
>
>
>
>
> On Sat, Jul 4, 2009 at 3:32 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Gagan,
>>
>> On Fri, Jul 3, 2009 at 5:08 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> wrote:
>> > Hi Alexis
>> > The problem statement here is I dont want my messages in queue for more
>> > than
>> > 1 minute.
>>
>> The easiest way to do this is for the client to keep consuming the
>> messages from the queue.
>>
>> However: presumably you want messages to be ignored in the case where
>> (a) there is no consumer to get the messages from the queue; and (b)
>> the messages are more than one minute old.
>>
>> If so then: Have you considered putting a timestamp on the messages?
>> That way, when a consumer starts taking messages from the queue, it
>> can simply check the timestamps and throw away anything 'old'. ?This
>> solution works just fine when (i) you don't need real time accuracy
>> ie. "about a minute" is just as good as "exactly a minute", and
>> provided that (ii) there aren't too many messages to throw away.
>> Judging by the document that you sent, both (i) and (ii) are true.
>>
>> Does this help?
>>
>> alexis
>>
>>
>> > I have tried expiration property while publishing a message but
>> > later came to know that it is still not implemented. Can you help me out
>> > in
>> > figuring some alternate approach?
>> > Thanks
>> > Gagan Arora
>> >
>> > On Fri, Jul 3, 2009 at 8:17 PM, Alexis Richardson
>> > <alexis.richardson at gmail.com> wrote:
>> >>
>> >> Gagan,
>> >>
>> >> On Fri, Jul 3, 2009 at 3:10 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> >> wrote:
>> >> > Hi
>> >> > Is it possible to set message time out in Java client API, so that
>> >> > messages
>> >> > drop out from queue after some interval of time if nobody consumes
>> >> > it?.
>> >>
>> >> Not yet but this is a feature have been asking for quite a bit. ?It's
>> >> on our roadmap.
>> >>
>> >> There may be other ways to achieve what you want.
>> >>
>> >> alexis
>> >>
>> >>
>> >>
>> >> > Thanks
>> >> > Gagan Arora
>> >> > _______________________________________________
>> >> > rabbitmq-discuss mailing list
>> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >
>> >> >
>> >
>> >
>
>



From alexis.richardson at gmail.com  Mon Jul  6 18:36:36 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 6 Jul 2009 18:36:36 +0100
Subject: [rabbitmq-discuss] Dropping out messages from a queue
In-Reply-To: <e2ab72f80907041207l61b7d8ei8fb391204945f471@mail.gmail.com>
References: <e2ab72f80907030708v7c3ef798ie27fe37bd766c8f8@mail.gmail.com>
	<167204d20907030753l5a44cfcanea13f261aee3d16e@mail.gmail.com>
	<e2ab72f80907030905w2556e7f1ua9b792bb49b5f7e2@mail.gmail.com>
	<167204d20907040253t7237c0bre7b2735594f56de0@mail.gmail.com>
	<e2ab72f80907041207l61b7d8ei8fb391204945f471@mail.gmail.com>
Message-ID: <167204d20907061036o11af55b6h3a03bead17b3327b@mail.gmail.com>

Gagan

One way to simplify the subscription management and get rid of 'heavy'
churn, is to use "exchange to exchange" bindings.  These are something
we have looked at - I am just checking with the guys to find out of
this solution would work well, and if so then when it will appear.

Another option would be to create a custom exchange which used
presence to 'show' and 'hide' queue bindings.  This would be quite
neat, but it would involve some coding.

alexis


On Sat, Jul 4, 2009 at 8:07 PM, GAGAN ARORA<gaganarora.itm at gmail.com> wrote:
> Alexis,
>
> Thanks for your wonderful support and solutions.
>
> Firstly answers to your queries:
>
> 1. Are you using fanout exchanges for this (if you want one exchange
> per user, then the answer should be 'yes').
>
>>> No I am using topic exchanges because there will be three type of
>>> bindings of a queue with an excajnde. One for publishing messages to all
>>> users, another for one to one messaging and third for publishing message to
>>> a set of users.
>
> 2. Where is the RabbitMQ server running? ?Is it on Server 1 or 2, or
> is it on a 3rd server? ?It may not be that important but it would be
> good to know.
>
>>> RabbitMQ Server is running on 3rd Server.
>
>
> Back to original problem.
>
> Actually I thought of the solution provided by you before posting the query
> to you. But if I follow this solution I have to perform following steps
> whenever a user comes online:
> 1. Create a queue.
> 2. Create a binding of newly created queue with all exchanges of other users
> for retrieving messages published by other users.
> 3. Creating a binding with exchange of all users for one to one messaging.
> 4. Create a binding with exchanges of a set of users.
>
> When user goes offline following operation is to be performed:
> 1. Delete all the existing bindings of a queue.
> 2. Deleting the queue.
>
> Actually I want my online and offline processes light weighted. According to
> me this solution would have a high impact on performance and will increase
> time to come online and offline.
>
> Kindly let me know if this can be achieved in some other manner.
>
> Thanks
> Gagan Arora
>
>
>
>
>
> On Sat, Jul 4, 2009 at 3:23 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Gagan,
>>
>> Hi - thank-you for sending the diagram and information which was very
>> useful. ?There are several ways to implement the 'twitter style'
>> pattern that you have described. ?See below for one way to do it that
>> illustrates the AMQP model. ?It may not be the most efficient solution
>> in terms of performance as I shall point out.
>>
>> Two quick questions:
>>
>> 1. Are you using fanout exchanges for this (if you want one exchange
>> per user, then the answer should be 'yes').
>>
>> 2. Where is the RabbitMQ server running? ?Is it on Server 1 or 2, or
>> is it on a 3rd server? ?It may not be that important but it would be
>> good to know.
>>
>> OK - to your cases -
>>
>> Case1: User B sending his message to UserB Exchange which will route
>> message to User A queue but User A is not connected to any of servers.
>> At this point of ?all messages sent to Queue A should be dropped.
>>
>> >>> One way to do this is to identify the lifecycle of Queue A with the
>> >>> presence of User A on servers 1 and 2. ?In other words, when User A is not
>> >>> connected to server 1, and also not connected to server 2, then Queue A does
>> >>> not exist. ?Note - This is not the only way to achieve what you want but it
>> >>> may be the least fiddly :-)
>>
>> Case2: User A connected to server 1 but UserA consumer is not yet
>> subscribed to UserA queue. If UserB sends any message to its exchange
>> which is routed to Queue of UserA. At this moment of time I want all
>> messages to be stored in queue.
>>
>> >>> One way to do this (continuing from the above) is to create Queue A
>> >>> immediately after UserA connects to server 1. ?This is an action that server
>> >>> 1 can initiate on behalf of UserA. ?After Queue A has been created, then it
>> >>> should be bound to all exchanges from which it will receive messages, such
>> >>> as UserB's exchange. ?This will then have the stated effect you seek "If
>> >>> UserB sends any message to its exchange [it] is routed to Queue of UserA.".
>> >>> ?Also, because UserA's consumer has not yet started consuming messages from
>> >>> Queue A, the messages will all remain stored in the queue.
>>
>> >>> In addition, if instead of proceeding to Case 3, we revert to Case 1,
>> >>> for example User A disconnects from Server 1, then Queue A can simply be
>> >>> deleted (along with its contents). ?(See also Case 5 below)
>>
>> >>> However - while simple, the above is possibly not the most performant
>> >>> solution if (a) you are running RabbitMQ in clustered mode and (b) your
>> >>> Users generally follow a lot of other Users and (c) they connect and
>> >>> disconnect frequently. ?This is because the effect of (c) is to frequuently
>> >>> update the routing table, possibly with a lot of binding/routing data (b),
>> >>> and then replicating it across the cluster (a).
>>
>> >>> Let us know if you want more info about other ways to do this.
>>
>>
>> Case3: User A is connected to both servers and UserA consumer is
>> subscribed to UserA queue. If UserB sends any message to its exchange
>> which is routed to Queue of UserA. At this moment of time I want all
>> messages stored in queue to be delievered plus any other incoming
>> message should also be routed.
>>
>> >>> In any case, to achieve this, just start consuming messages from Queue
>> >>> A.
>>
>> >>> I assume by 'delivered', you mean 'delivered to UserA's consumer'.
>> >>> ?Where is that running?
>>
>>
>>
>>
>> Case4: User A is connected to both servers and UserA consumer is
>> subscribed to UserA queue. Now User disconnects from Server 2. If
>> UserB sends any message to its exchange which is routed to Queue of
>> UserA. Again I want to store all messages.
>>
>> >>> To achieve this, just stop consuming messages from Queue A. ?They will
>> >>> be stored in Queue A.
>>
>>
>>
>> Case5: If user A is disconnected from both servers. Initial state is
>> achieved again.
>>
>> >>> When User A disconnects from Server 1, then Server 1 can tell RabbitMQ
>> >>> to delete Queue A (along with its contents)
>>
>> Cheers,
>>
>> alexis
>>
>>
>>
>>
>>
>>
>> On Fri, Jul 3, 2009 at 5:05 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> wrote:
>> > Hi Alexis
>> > Attaching a doc having architecture diagram and cases desired. Hope this
>> > would make things more clear to you.
>> > Thanks
>> > Gagan Arora
>> >
>> > On Fri, Jul 3, 2009 at 8:23 PM, Alexis Richardson
>> > <alexis.richardson at gmail.com> wrote:
>> >>
>> >> Gagan,
>> >>
>> >> I'm a bit confused about what you are trying to do. ?I think what you
>> >> describe is possible but I am not sure what role is being played by
>> >> your two servers. ?Is RabbitMQ running on both of them, one of them,
>> >> or neither? ?You may find it easier to just use one RabbitMQ server.
>> >>
>> >> Can you send a drawing of what your desired configuration is?
>> >>
>> >> alexis
>> >>
>> >>
>> >>
>> >>
>> >> On Fri, Jul 3, 2009 at 3:08 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> >> wrote:
>> >> > Hi
>> >> > I am developing a system in which a user will connect to two servers.
>> >> > On
>> >> > connecting to first server he will become online and will send his
>> >> > presence
>> >> > update but he will receive presence updates only once he is connected
>> >> > to
>> >> > other server as his consumer subscribes to his queue after connecting
>> >> > to
>> >> > second server.
>> >> > I am using one exchange and one queue per user. So if one user comes
>> >> > online
>> >> > then he will send his presence update to his exchange and users bound
>> >> > to
>> >> > that will receive updates.
>> >> > I need to configure a queue which would hold messages for user who
>> >> > has
>> >> > just
>> >> > came online until he is connected to other server. After connecting
>> >> > to
>> >> > second server all messages will be consumed. All messages sent to
>> >> > queue
>> >> > will
>> >> > be dropped once user goes offline.
>> >> > Is it possible?
>> >> > Thanks
>> >> > Gagan Arora
>> >> > _______________________________________________
>> >> > rabbitmq-discuss mailing list
>> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >
>> >> >
>> >
>> >
>
>



From zerthurd at gmail.com  Mon Jul  6 18:45:28 2009
From: zerthurd at gmail.com (Maxim Treskin)
Date: Tue, 7 Jul 2009 00:45:28 +0700
Subject: [rabbitmq-discuss] General message tracing
In-Reply-To: <be8f531d0907060341w77ff96c2h91ae55e056beb50f@mail.gmail.com>
References: <be8f531d0907060341w77ff96c2h91ae55e056beb50f@mail.gmail.com>
Message-ID: <be8f531d0907061045l5b3e6d9bt620e48452c6e3164@mail.gmail.com>

It seems that all works like this already :)

-- 
Maxim Treskin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090707/51e6b644/attachment.htm 

From gaganarora.itm at gmail.com  Mon Jul  6 19:02:24 2009
From: gaganarora.itm at gmail.com (GAGAN ARORA)
Date: Mon, 6 Jul 2009 23:32:24 +0530
Subject: [rabbitmq-discuss] Messages Timeout in Queue
In-Reply-To: <167204d20907060858t2937f70bv32080711d32a750c@mail.gmail.com>
References: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>
	<167204d20907030747ie3357d7l24c7818a40cd25c9@mail.gmail.com>
	<e2ab72f80907030908n3dfe8dbfu83d38e23b0d793b4@mail.gmail.com>
	<167204d20907040302l561be62pc7921176ed319095@mail.gmail.com>
	<e2ab72f80907041228m7e91f02fy5e15779350983556@mail.gmail.com>
	<167204d20907060858t2937f70bv32080711d32a750c@mail.gmail.com>
Message-ID: <e2ab72f80907061102m6e184e18x45bf6484e35b8c3c@mail.gmail.com>

Alexis

a) when the User A is not logged into server 1 or server 2, any
messages sent to them by User B are discarded
>> Actually during this case no consumer would be listening to User A queue
and hence the messages can't be discarded and would be queued in Queue.

b) but, when User A is logged in to server 1, any messages sent by
User B that may be routed to User A are queued in Queue A,
>> No of messages increases.

c) .... delivered when User A logs into server 2.
>> A large no of messages get delieverd.

It is a constraint in my system that I have to initialize consumer when User
A connects to Server2.

On Mon, Jul 6, 2009 at 9:28 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Gagan
>
> As I understood from your document:
>
> a) when the User A is not logged into server 1 or server 2, any
> messages sent to them by User B are discarded
> b) but, when User A is logged in to server 1, any messages sent by
> User B that may be routed to User A are queued in Queue A, and then
> ...
> c) .... delivered when User A logs into server 2.
>
> Provided that you can implement this efficiently (see other email)
> then the consumer at User A only needs to discard messages that are
> older than one minute, and that were not already discarded due to (a)
> above.  So unless the time interval between A logging into server 1,
> and A logging into server 2, is "quite long" then the 'timestamp'
> method adds very little overhead.
>
> Is that correct or have I missed something?
>
> alexis
>
>
>
>
>
>
> On Sat, Jul 4, 2009 at 8:28 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> wrote:
> > Hi Alexis
> >
> > My system is similar to an IM system and is using RabbitMQ for presence
> > updates and have designed it in such a way that a consumer subscribes to
> a
> > queue only when it comes online.Now the issue is as stated by you there
> will
> > be a large no of messages ready to be deleivered when a user comes
> online.
> > Checking timestamp for each message will result in high cost.
> >
> > There can be a solution in which a message can be published using
> immediate
> > flag. But it is desired by consumer to get all messages which are less
> than
> > 1 minute old.
> >
> > Can you suggest some other solution for achieving this?
> >
> > Thanks
> > Gagan Arora
> >
> >
> >
> >
> > On Sat, Jul 4, 2009 at 3:32 PM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Gagan,
> >>
> >> On Fri, Jul 3, 2009 at 5:08 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> >> wrote:
> >> > Hi Alexis
> >> > The problem statement here is I dont want my messages in queue for
> more
> >> > than
> >> > 1 minute.
> >>
> >> The easiest way to do this is for the client to keep consuming the
> >> messages from the queue.
> >>
> >> However: presumably you want messages to be ignored in the case where
> >> (a) there is no consumer to get the messages from the queue; and (b)
> >> the messages are more than one minute old.
> >>
> >> If so then: Have you considered putting a timestamp on the messages?
> >> That way, when a consumer starts taking messages from the queue, it
> >> can simply check the timestamps and throw away anything 'old'.  This
> >> solution works just fine when (i) you don't need real time accuracy
> >> ie. "about a minute" is just as good as "exactly a minute", and
> >> provided that (ii) there aren't too many messages to throw away.
> >> Judging by the document that you sent, both (i) and (ii) are true.
> >>
> >> Does this help?
> >>
> >> alexis
> >>
> >>
> >> > I have tried expiration property while publishing a message but
> >> > later came to know that it is still not implemented. Can you help me
> out
> >> > in
> >> > figuring some alternate approach?
> >> > Thanks
> >> > Gagan Arora
> >> >
> >> > On Fri, Jul 3, 2009 at 8:17 PM, Alexis Richardson
> >> > <alexis.richardson at gmail.com> wrote:
> >> >>
> >> >> Gagan,
> >> >>
> >> >> On Fri, Jul 3, 2009 at 3:10 PM, GAGAN ARORA<gaganarora.itm at gmail.com
> >
> >> >> wrote:
> >> >> > Hi
> >> >> > Is it possible to set message time out in Java client API, so that
> >> >> > messages
> >> >> > drop out from queue after some interval of time if nobody consumes
> >> >> > it?.
> >> >>
> >> >> Not yet but this is a feature have been asking for quite a bit.  It's
> >> >> on our roadmap.
> >> >>
> >> >> There may be other ways to achieve what you want.
> >> >>
> >> >> alexis
> >> >>
> >> >>
> >> >>
> >> >> > Thanks
> >> >> > Gagan Arora
> >> >> > _______________________________________________
> >> >> > rabbitmq-discuss mailing list
> >> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> >> >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >
> >> >> >
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090706/95602428/attachment.htm 

From gaganarora.itm at gmail.com  Mon Jul  6 19:04:24 2009
From: gaganarora.itm at gmail.com (GAGAN ARORA)
Date: Mon, 6 Jul 2009 23:34:24 +0530
Subject: [rabbitmq-discuss] Dropping out messages from a queue
In-Reply-To: <167204d20907061036o11af55b6h3a03bead17b3327b@mail.gmail.com>
References: <e2ab72f80907030708v7c3ef798ie27fe37bd766c8f8@mail.gmail.com>
	<167204d20907030753l5a44cfcanea13f261aee3d16e@mail.gmail.com>
	<e2ab72f80907030905w2556e7f1ua9b792bb49b5f7e2@mail.gmail.com>
	<167204d20907040253t7237c0bre7b2735594f56de0@mail.gmail.com>
	<e2ab72f80907041207l61b7d8ei8fb391204945f471@mail.gmail.com>
	<167204d20907061036o11af55b6h3a03bead17b3327b@mail.gmail.com>
Message-ID: <e2ab72f80907061104g250e2d62pc6dd0c6f278d3128@mail.gmail.com>

Alexis

When are you planning to release version for first option?

Can you explain the second option?

Thanks
Gagan

On Mon, Jul 6, 2009 at 11:06 PM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Gagan
>
> One way to simplify the subscription management and get rid of 'heavy'
> churn, is to use "exchange to exchange" bindings.  These are something
> we have looked at - I am just checking with the guys to find out of
> this solution would work well, and if so then when it will appear.
>
> Another option would be to create a custom exchange which used
> presence to 'show' and 'hide' queue bindings.  This would be quite
> neat, but it would involve some coding.
>
> alexis
>
>
> On Sat, Jul 4, 2009 at 8:07 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> wrote:
> > Alexis,
> >
> > Thanks for your wonderful support and solutions.
> >
> > Firstly answers to your queries:
> >
> > 1. Are you using fanout exchanges for this (if you want one exchange
> > per user, then the answer should be 'yes').
> >
> >>> No I am using topic exchanges because there will be three type of
> >>> bindings of a queue with an excajnde. One for publishing messages to
> all
> >>> users, another for one to one messaging and third for publishing
> message to
> >>> a set of users.
> >
> > 2. Where is the RabbitMQ server running?  Is it on Server 1 or 2, or
> > is it on a 3rd server?  It may not be that important but it would be
> > good to know.
> >
> >>> RabbitMQ Server is running on 3rd Server.
> >
> >
> > Back to original problem.
> >
> > Actually I thought of the solution provided by you before posting the
> query
> > to you. But if I follow this solution I have to perform following steps
> > whenever a user comes online:
> > 1. Create a queue.
> > 2. Create a binding of newly created queue with all exchanges of other
> users
> > for retrieving messages published by other users.
> > 3. Creating a binding with exchange of all users for one to one
> messaging.
> > 4. Create a binding with exchanges of a set of users.
> >
> > When user goes offline following operation is to be performed:
> > 1. Delete all the existing bindings of a queue.
> > 2. Deleting the queue.
> >
> > Actually I want my online and offline processes light weighted. According
> to
> > me this solution would have a high impact on performance and will
> increase
> > time to come online and offline.
> >
> > Kindly let me know if this can be achieved in some other manner.
> >
> > Thanks
> > Gagan Arora
> >
> >
> >
> >
> >
> > On Sat, Jul 4, 2009 at 3:23 PM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Gagan,
> >>
> >> Hi - thank-you for sending the diagram and information which was very
> >> useful.  There are several ways to implement the 'twitter style'
> >> pattern that you have described.  See below for one way to do it that
> >> illustrates the AMQP model.  It may not be the most efficient solution
> >> in terms of performance as I shall point out.
> >>
> >> Two quick questions:
> >>
> >> 1. Are you using fanout exchanges for this (if you want one exchange
> >> per user, then the answer should be 'yes').
> >>
> >> 2. Where is the RabbitMQ server running?  Is it on Server 1 or 2, or
> >> is it on a 3rd server?  It may not be that important but it would be
> >> good to know.
> >>
> >> OK - to your cases -
> >>
> >> Case1: User B sending his message to UserB Exchange which will route
> >> message to User A queue but User A is not connected to any of servers.
> >> At this point of  all messages sent to Queue A should be dropped.
> >>
> >> >>> One way to do this is to identify the lifecycle of Queue A with the
> >> >>> presence of User A on servers 1 and 2.  In other words, when User A
> is not
> >> >>> connected to server 1, and also not connected to server 2, then
> Queue A does
> >> >>> not exist.  Note - This is not the only way to achieve what you want
> but it
> >> >>> may be the least fiddly :-)
> >>
> >> Case2: User A connected to server 1 but UserA consumer is not yet
> >> subscribed to UserA queue. If UserB sends any message to its exchange
> >> which is routed to Queue of UserA. At this moment of time I want all
> >> messages to be stored in queue.
> >>
> >> >>> One way to do this (continuing from the above) is to create Queue A
> >> >>> immediately after UserA connects to server 1.  This is an action
> that server
> >> >>> 1 can initiate on behalf of UserA.  After Queue A has been created,
> then it
> >> >>> should be bound to all exchanges from which it will receive
> messages, such
> >> >>> as UserB's exchange.  This will then have the stated effect you seek
> "If
> >> >>> UserB sends any message to its exchange [it] is routed to Queue of
> UserA.".
> >> >>>  Also, because UserA's consumer has not yet started consuming
> messages from
> >> >>> Queue A, the messages will all remain stored in the queue.
> >>
> >> >>> In addition, if instead of proceeding to Case 3, we revert to Case
> 1,
> >> >>> for example User A disconnects from Server 1, then Queue A can
> simply be
> >> >>> deleted (along with its contents).  (See also Case 5 below)
> >>
> >> >>> However - while simple, the above is possibly not the most
> performant
> >> >>> solution if (a) you are running RabbitMQ in clustered mode and (b)
> your
> >> >>> Users generally follow a lot of other Users and (c) they connect and
> >> >>> disconnect frequently.  This is because the effect of (c) is to
> frequuently
> >> >>> update the routing table, possibly with a lot of binding/routing
> data (b),
> >> >>> and then replicating it across the cluster (a).
> >>
> >> >>> Let us know if you want more info about other ways to do this.
> >>
> >>
> >> Case3: User A is connected to both servers and UserA consumer is
> >> subscribed to UserA queue. If UserB sends any message to its exchange
> >> which is routed to Queue of UserA. At this moment of time I want all
> >> messages stored in queue to be delievered plus any other incoming
> >> message should also be routed.
> >>
> >> >>> In any case, to achieve this, just start consuming messages from
> Queue
> >> >>> A.
> >>
> >> >>> I assume by 'delivered', you mean 'delivered to UserA's consumer'.
> >> >>>  Where is that running?
> >>
> >>
> >>
> >>
> >> Case4: User A is connected to both servers and UserA consumer is
> >> subscribed to UserA queue. Now User disconnects from Server 2. If
> >> UserB sends any message to its exchange which is routed to Queue of
> >> UserA. Again I want to store all messages.
> >>
> >> >>> To achieve this, just stop consuming messages from Queue A.  They
> will
> >> >>> be stored in Queue A.
> >>
> >>
> >>
> >> Case5: If user A is disconnected from both servers. Initial state is
> >> achieved again.
> >>
> >> >>> When User A disconnects from Server 1, then Server 1 can tell
> RabbitMQ
> >> >>> to delete Queue A (along with its contents)
> >>
> >> Cheers,
> >>
> >> alexis
> >>
> >>
> >>
> >>
> >>
> >>
> >> On Fri, Jul 3, 2009 at 5:05 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> >> wrote:
> >> > Hi Alexis
> >> > Attaching a doc having architecture diagram and cases desired. Hope
> this
> >> > would make things more clear to you.
> >> > Thanks
> >> > Gagan Arora
> >> >
> >> > On Fri, Jul 3, 2009 at 8:23 PM, Alexis Richardson
> >> > <alexis.richardson at gmail.com> wrote:
> >> >>
> >> >> Gagan,
> >> >>
> >> >> I'm a bit confused about what you are trying to do.  I think what you
> >> >> describe is possible but I am not sure what role is being played by
> >> >> your two servers.  Is RabbitMQ running on both of them, one of them,
> >> >> or neither?  You may find it easier to just use one RabbitMQ server.
> >> >>
> >> >> Can you send a drawing of what your desired configuration is?
> >> >>
> >> >> alexis
> >> >>
> >> >>
> >> >>
> >> >>
> >> >> On Fri, Jul 3, 2009 at 3:08 PM, GAGAN ARORA<gaganarora.itm at gmail.com
> >
> >> >> wrote:
> >> >> > Hi
> >> >> > I am developing a system in which a user will connect to two
> servers.
> >> >> > On
> >> >> > connecting to first server he will become online and will send his
> >> >> > presence
> >> >> > update but he will receive presence updates only once he is
> connected
> >> >> > to
> >> >> > other server as his consumer subscribes to his queue after
> connecting
> >> >> > to
> >> >> > second server.
> >> >> > I am using one exchange and one queue per user. So if one user
> comes
> >> >> > online
> >> >> > then he will send his presence update to his exchange and users
> bound
> >> >> > to
> >> >> > that will receive updates.
> >> >> > I need to configure a queue which would hold messages for user who
> >> >> > has
> >> >> > just
> >> >> > came online until he is connected to other server. After connecting
> >> >> > to
> >> >> > second server all messages will be consumed. All messages sent to
> >> >> > queue
> >> >> > will
> >> >> > be dropped once user goes offline.
> >> >> > Is it possible?
> >> >> > Thanks
> >> >> > Gagan Arora
> >> >> > _______________________________________________
> >> >> > rabbitmq-discuss mailing list
> >> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> >> >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >
> >> >> >
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090706/d50c6e56/attachment.htm 

From alexis.richardson at gmail.com  Mon Jul  6 19:33:51 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 6 Jul 2009 19:33:51 +0100
Subject: [rabbitmq-discuss] Messages Timeout in Queue
In-Reply-To: <e2ab72f80907061102m6e184e18x45bf6484e35b8c3c@mail.gmail.com>
References: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>
	<167204d20907030747ie3357d7l24c7818a40cd25c9@mail.gmail.com>
	<e2ab72f80907030908n3dfe8dbfu83d38e23b0d793b4@mail.gmail.com>
	<167204d20907040302l561be62pc7921176ed319095@mail.gmail.com>
	<e2ab72f80907041228m7e91f02fy5e15779350983556@mail.gmail.com>
	<167204d20907060858t2937f70bv32080711d32a750c@mail.gmail.com>
	<e2ab72f80907061102m6e184e18x45bf6484e35b8c3c@mail.gmail.com>
Message-ID: <167204d20907061133u5148c539t9b98542acc03019f@mail.gmail.com>

Gagan,

On Mon, Jul 6, 2009 at 7:02 PM, GAGAN ARORA<gaganarora.itm at gmail.com> wrote:
> Alexis
>
> a) when the User A is not logged into server 1 or server 2, any
> messages sent to them by User B are discarded
>>> Actually during this case no consumer would be listening to User A queue
>>> and hence the messages can't be discarded and would be queued in Queue.

In your document you said:

"Case1: User B sending his message to UserB Exchange which will route
message to User A queue but User A is not connected to any of servers.
At this point of  all messages sent to Queue A should be dropped."

If this is happening then the messages will be discarded and not
queued in Queue.

alexis



> b) but, when User A is logged in to server 1, any messages sent by
> User B that may be routed to User A are queued in Queue A,
>>> No of messages increases.
>
> c) .... delivered when User A logs into server 2.
>>> A large no of messages get delieverd.
>
> It is a constraint in my system that I have to initialize consumer when User
> A connects to Server2.
>
> On Mon, Jul 6, 2009 at 9:28 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Gagan
>>
>> As I understood from your document:
>>
>> a) when the User A is not logged into server 1 or server 2, any
>> messages sent to them by User B are discarded
>> b) but, when User A is logged in to server 1, any messages sent by
>> User B that may be routed to User A are queued in Queue A, and then
>> ...
>> c) .... delivered when User A logs into server 2.
>>
>> Provided that you can implement this efficiently (see other email)
>> then the consumer at User A only needs to discard messages that are
>> older than one minute, and that were not already discarded due to (a)
>> above. ?So unless the time interval between A logging into server 1,
>> and A logging into server 2, is "quite long" then the 'timestamp'
>> method adds very little overhead.
>>
>> Is that correct or have I missed something?
>>
>> alexis
>>
>>
>>
>>
>>
>>
>> On Sat, Jul 4, 2009 at 8:28 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> wrote:
>> > Hi Alexis
>> >
>> > My system is similar to an IM system and is using RabbitMQ for presence
>> > updates and have designed it in such a way that a consumer subscribes to
>> > a
>> > queue only when it comes online.Now the issue is as stated by you there
>> > will
>> > be a large no of messages ready to be deleivered when a user comes
>> > online.
>> > Checking timestamp for each message will result in high cost.
>> >
>> > There can be a solution in which a message can be published using
>> > immediate
>> > flag. But it is desired by consumer to get all messages which are less
>> > than
>> > 1 minute old.
>> >
>> > Can you suggest some other solution for achieving this?
>> >
>> > Thanks
>> > Gagan Arora
>> >
>> >
>> >
>> >
>> > On Sat, Jul 4, 2009 at 3:32 PM, Alexis Richardson
>> > <alexis.richardson at gmail.com> wrote:
>> >>
>> >> Gagan,
>> >>
>> >> On Fri, Jul 3, 2009 at 5:08 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> >> wrote:
>> >> > Hi Alexis
>> >> > The problem statement here is I dont want my messages in queue for
>> >> > more
>> >> > than
>> >> > 1 minute.
>> >>
>> >> The easiest way to do this is for the client to keep consuming the
>> >> messages from the queue.
>> >>
>> >> However: presumably you want messages to be ignored in the case where
>> >> (a) there is no consumer to get the messages from the queue; and (b)
>> >> the messages are more than one minute old.
>> >>
>> >> If so then: Have you considered putting a timestamp on the messages?
>> >> That way, when a consumer starts taking messages from the queue, it
>> >> can simply check the timestamps and throw away anything 'old'. ?This
>> >> solution works just fine when (i) you don't need real time accuracy
>> >> ie. "about a minute" is just as good as "exactly a minute", and
>> >> provided that (ii) there aren't too many messages to throw away.
>> >> Judging by the document that you sent, both (i) and (ii) are true.
>> >>
>> >> Does this help?
>> >>
>> >> alexis
>> >>
>> >>
>> >> > I have tried expiration property while publishing a message but
>> >> > later came to know that it is still not implemented. Can you help me
>> >> > out
>> >> > in
>> >> > figuring some alternate approach?
>> >> > Thanks
>> >> > Gagan Arora
>> >> >
>> >> > On Fri, Jul 3, 2009 at 8:17 PM, Alexis Richardson
>> >> > <alexis.richardson at gmail.com> wrote:
>> >> >>
>> >> >> Gagan,
>> >> >>
>> >> >> On Fri, Jul 3, 2009 at 3:10 PM, GAGAN
>> >> >> ARORA<gaganarora.itm at gmail.com>
>> >> >> wrote:
>> >> >> > Hi
>> >> >> > Is it possible to set message time out in Java client API, so that
>> >> >> > messages
>> >> >> > drop out from queue after some interval of time if nobody consumes
>> >> >> > it?.
>> >> >>
>> >> >> Not yet but this is a feature have been asking for quite a bit.
>> >> >> ?It's
>> >> >> on our roadmap.
>> >> >>
>> >> >> There may be other ways to achieve what you want.
>> >> >>
>> >> >> alexis
>> >> >>
>> >> >>
>> >> >>
>> >> >> > Thanks
>> >> >> > Gagan Arora
>> >> >> > _______________________________________________
>> >> >> > rabbitmq-discuss mailing list
>> >> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >
>> >> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >
>> >> >> >
>> >> >
>> >> >
>> >
>> >
>
>



From dialtone at gmail.com  Mon Jul  6 19:36:45 2009
From: dialtone at gmail.com (Valentino Volonghi)
Date: Mon, 6 Jul 2009 11:36:45 -0700
Subject: [rabbitmq-discuss] Return message? [Was: Re: Sample code for
	python?]
In-Reply-To: <539885.23651.qm@web45608.mail.sp1.yahoo.com>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
	<d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com>
	<558122.16141.qm@web45608.mail.sp1.yahoo.com>
	<d272f0690907021151k9b581a9w61803baa37092398@mail.gmail.com>
	<825108.73047.qm@web45604.mail.sp1.yahoo.com>
	<d272f0690907021250j1a1177aoe121c3fc749b3ff0@mail.gmail.com>
	<716148.78533.qm@web45616.mail.sp1.yahoo.com>
	<0058CDE8-43F9-4390-B7BB-E811D6CBF7E2@gmail.com>
	<539885.23651.qm@web45608.mail.sp1.yahoo.com>
Message-ID: <D12B32DC-0119-46CE-A6F3-D9C7708DA295@gmail.com>


On Jul 6, 2009, at 8:54 AM, Allen Fowler wrote:

> I am not at all familiar with the twisted system, but does this mean  
> that RabbitMQ/AMQP does not, on it's own, provide any method for a  
> message sender to ascertain the success or failure of a task  
> embodied by a message?

Twisted Matrix is just an event driven networking framework. You
don't really need to know it to use quebert unless you want to implement
extra functionality in it (but even in that case you need to know only a
small part of it).

> That is to say: The backed system (job receiver) has no way of  
> signaling to the front-end (job-sender) any details about the job  
> the front-end is waiting on?

> Is this true?


Why do you need asynchronous guaranteed delivery when you want to
receive a synchronous result?

If your plan is to simply execute a task and know the outcome then  
simply
run an HTTP request to the service that runs it and if it fails you  
know it.

If you are looking for asynchronous execution then, no matter what  
system
you use, you'll have to come up with an alternative way to send the  
result
to the caller (which could even be dead when the task finishes).

RabbitMQ provides you guaranteed delivery of a message by taking
responsibility when you send the payload through it. Then it's queued  
and
the way you handle it in the consumer gives your communication channel
a subset (full or partial) of the properties that rabbitmq guarantees.  
Keep in
mind though that if the task executor is not online when you request a  
task
your search for a synchronous result would essentially be hanging  
forever.

Using HTTP between the consumer and the execution channel you are
using HTTP properties to know when a task executes or not. If the  
request
returns a 200 OK then it was completed and the result might be in the  
returned
response or saved in another storage that something else might poll  
while
in the response there might be the unique key or URI to get to that  
payload.

I believe that IMHO you are mixing some unrelated problems, one is
asynchronous execution of tasks and the other is "returning" a result,  
to
do the second one you need to create your own system (carrot, which is
the base for celery, provides a built-in system where the result is  
stored
in a key-value store or again in rabbitmq where the original producer  
waits
for it, IMHO this is not how I would do it, the task should be  
autocontained
and should do everything in itself, the "frontend" (producer) should  
just
access data normally and look for the result where it would normally, if
you actually need a result then your infrastructure should give you a  
way
to use the systems both synchronously and asynchronously in the simplest
way possible, and an HTTP request without going through RabbitMQ is
the simplest way possible when you need a result).


--
Valentino Volonghi aka Dialtone
Now running MacOS X 10.5
Home Page: http://www.twisted.it
http://www.adroll.com

-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 194 bytes
Desc: This is a digitally signed message part
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090706/8be78c85/attachment.pgp 

From alexis.richardson at gmail.com  Mon Jul  6 19:40:49 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 6 Jul 2009 19:40:49 +0100
Subject: [rabbitmq-discuss] Dropping out messages from a queue
In-Reply-To: <e2ab72f80907061104g250e2d62pc6dd0c6f278d3128@mail.gmail.com>
References: <e2ab72f80907030708v7c3ef798ie27fe37bd766c8f8@mail.gmail.com>
	<167204d20907030753l5a44cfcanea13f261aee3d16e@mail.gmail.com>
	<e2ab72f80907030905w2556e7f1ua9b792bb49b5f7e2@mail.gmail.com>
	<167204d20907040253t7237c0bre7b2735594f56de0@mail.gmail.com>
	<e2ab72f80907041207l61b7d8ei8fb391204945f471@mail.gmail.com>
	<167204d20907061036o11af55b6h3a03bead17b3327b@mail.gmail.com>
	<e2ab72f80907061104g250e2d62pc6dd0c6f278d3128@mail.gmail.com>
Message-ID: <167204d20907061140m3158a13av27ebef1b8adbfc76@mail.gmail.com>

On Mon, Jul 6, 2009 at 7:04 PM, GAGAN ARORA<gaganarora.itm at gmail.com> wrote:
> Alexis
>
> When are you planning to release version for first option?

As I said below: "I am just checking with the guys to find out ...
when it will appear."



> Can you explain the second option?

Yes of course :-)

AMQP has a notion of 'custom exchange' for cases where fanout, direct,
and topic or headers don't make sense.  Anyone can define any
exchange, so what you could do is define an exchange which ignores
some set of bindings if some predicate (or more simply, flag) is true.
 The predicate you want in your case is something that means 'User A
is offline'.  This has exactly the same effect as using
exchange-exchange but it could be implemented by you today - or by us
- take your pick ;-)

alexis




>
> Thanks
> Gagan
>
> On Mon, Jul 6, 2009 at 11:06 PM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Gagan
>>
>> One way to simplify the subscription management and get rid of 'heavy'
>> churn, is to use "exchange to exchange" bindings. ?These are something
>> we have looked at - I am just checking with the guys to find out of
>> this solution would work well, and if so then when it will appear.
>>
>> Another option would be to create a custom exchange which used
>> presence to 'show' and 'hide' queue bindings. ?This would be quite
>> neat, but it would involve some coding.
>>
>> alexis
>>
>>
>> On Sat, Jul 4, 2009 at 8:07 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> wrote:
>> > Alexis,
>> >
>> > Thanks for your wonderful support and solutions.
>> >
>> > Firstly answers to your queries:
>> >
>> > 1. Are you using fanout exchanges for this (if you want one exchange
>> > per user, then the answer should be 'yes').
>> >
>> >>> No I am using topic exchanges because there will be three type of
>> >>> bindings of a queue with an excajnde. One for publishing messages to
>> >>> all
>> >>> users, another for one to one messaging and third for publishing
>> >>> message to
>> >>> a set of users.
>> >
>> > 2. Where is the RabbitMQ server running? ?Is it on Server 1 or 2, or
>> > is it on a 3rd server? ?It may not be that important but it would be
>> > good to know.
>> >
>> >>> RabbitMQ Server is running on 3rd Server.
>> >
>> >
>> > Back to original problem.
>> >
>> > Actually I thought of the solution provided by you before posting the
>> > query
>> > to you. But if I follow this solution I have to perform following steps
>> > whenever a user comes online:
>> > 1. Create a queue.
>> > 2. Create a binding of newly created queue with all exchanges of other
>> > users
>> > for retrieving messages published by other users.
>> > 3. Creating a binding with exchange of all users for one to one
>> > messaging.
>> > 4. Create a binding with exchanges of a set of users.
>> >
>> > When user goes offline following operation is to be performed:
>> > 1. Delete all the existing bindings of a queue.
>> > 2. Deleting the queue.
>> >
>> > Actually I want my online and offline processes light weighted.
>> > According to
>> > me this solution would have a high impact on performance and will
>> > increase
>> > time to come online and offline.
>> >
>> > Kindly let me know if this can be achieved in some other manner.
>> >
>> > Thanks
>> > Gagan Arora
>> >
>> >
>> >
>> >
>> >
>> > On Sat, Jul 4, 2009 at 3:23 PM, Alexis Richardson
>> > <alexis.richardson at gmail.com> wrote:
>> >>
>> >> Gagan,
>> >>
>> >> Hi - thank-you for sending the diagram and information which was very
>> >> useful. ?There are several ways to implement the 'twitter style'
>> >> pattern that you have described. ?See below for one way to do it that
>> >> illustrates the AMQP model. ?It may not be the most efficient solution
>> >> in terms of performance as I shall point out.
>> >>
>> >> Two quick questions:
>> >>
>> >> 1. Are you using fanout exchanges for this (if you want one exchange
>> >> per user, then the answer should be 'yes').
>> >>
>> >> 2. Where is the RabbitMQ server running? ?Is it on Server 1 or 2, or
>> >> is it on a 3rd server? ?It may not be that important but it would be
>> >> good to know.
>> >>
>> >> OK - to your cases -
>> >>
>> >> Case1: User B sending his message to UserB Exchange which will route
>> >> message to User A queue but User A is not connected to any of servers.
>> >> At this point of ?all messages sent to Queue A should be dropped.
>> >>
>> >> >>> One way to do this is to identify the lifecycle of Queue A with the
>> >> >>> presence of User A on servers 1 and 2. ?In other words, when User A
>> >> >>> is not
>> >> >>> connected to server 1, and also not connected to server 2, then
>> >> >>> Queue A does
>> >> >>> not exist. ?Note - This is not the only way to achieve what you
>> >> >>> want but it
>> >> >>> may be the least fiddly :-)
>> >>
>> >> Case2: User A connected to server 1 but UserA consumer is not yet
>> >> subscribed to UserA queue. If UserB sends any message to its exchange
>> >> which is routed to Queue of UserA. At this moment of time I want all
>> >> messages to be stored in queue.
>> >>
>> >> >>> One way to do this (continuing from the above) is to create Queue A
>> >> >>> immediately after UserA connects to server 1. ?This is an action
>> >> >>> that server
>> >> >>> 1 can initiate on behalf of UserA. ?After Queue A has been created,
>> >> >>> then it
>> >> >>> should be bound to all exchanges from which it will receive
>> >> >>> messages, such
>> >> >>> as UserB's exchange. ?This will then have the stated effect you
>> >> >>> seek "If
>> >> >>> UserB sends any message to its exchange [it] is routed to Queue of
>> >> >>> UserA.".
>> >> >>> ?Also, because UserA's consumer has not yet started consuming
>> >> >>> messages from
>> >> >>> Queue A, the messages will all remain stored in the queue.
>> >>
>> >> >>> In addition, if instead of proceeding to Case 3, we revert to Case
>> >> >>> 1,
>> >> >>> for example User A disconnects from Server 1, then Queue A can
>> >> >>> simply be
>> >> >>> deleted (along with its contents). ?(See also Case 5 below)
>> >>
>> >> >>> However - while simple, the above is possibly not the most
>> >> >>> performant
>> >> >>> solution if (a) you are running RabbitMQ in clustered mode and (b)
>> >> >>> your
>> >> >>> Users generally follow a lot of other Users and (c) they connect
>> >> >>> and
>> >> >>> disconnect frequently. ?This is because the effect of (c) is to
>> >> >>> frequuently
>> >> >>> update the routing table, possibly with a lot of binding/routing
>> >> >>> data (b),
>> >> >>> and then replicating it across the cluster (a).
>> >>
>> >> >>> Let us know if you want more info about other ways to do this.
>> >>
>> >>
>> >> Case3: User A is connected to both servers and UserA consumer is
>> >> subscribed to UserA queue. If UserB sends any message to its exchange
>> >> which is routed to Queue of UserA. At this moment of time I want all
>> >> messages stored in queue to be delievered plus any other incoming
>> >> message should also be routed.
>> >>
>> >> >>> In any case, to achieve this, just start consuming messages from
>> >> >>> Queue
>> >> >>> A.
>> >>
>> >> >>> I assume by 'delivered', you mean 'delivered to UserA's consumer'.
>> >> >>> ?Where is that running?
>> >>
>> >>
>> >>
>> >>
>> >> Case4: User A is connected to both servers and UserA consumer is
>> >> subscribed to UserA queue. Now User disconnects from Server 2. If
>> >> UserB sends any message to its exchange which is routed to Queue of
>> >> UserA. Again I want to store all messages.
>> >>
>> >> >>> To achieve this, just stop consuming messages from Queue A. ?They
>> >> >>> will
>> >> >>> be stored in Queue A.
>> >>
>> >>
>> >>
>> >> Case5: If user A is disconnected from both servers. Initial state is
>> >> achieved again.
>> >>
>> >> >>> When User A disconnects from Server 1, then Server 1 can tell
>> >> >>> RabbitMQ
>> >> >>> to delete Queue A (along with its contents)
>> >>
>> >> Cheers,
>> >>
>> >> alexis
>> >>
>> >>
>> >>
>> >>
>> >>
>> >>
>> >> On Fri, Jul 3, 2009 at 5:05 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> >> wrote:
>> >> > Hi Alexis
>> >> > Attaching a doc having architecture diagram and cases desired. Hope
>> >> > this
>> >> > would make things more clear to you.
>> >> > Thanks
>> >> > Gagan Arora
>> >> >
>> >> > On Fri, Jul 3, 2009 at 8:23 PM, Alexis Richardson
>> >> > <alexis.richardson at gmail.com> wrote:
>> >> >>
>> >> >> Gagan,
>> >> >>
>> >> >> I'm a bit confused about what you are trying to do. ?I think what
>> >> >> you
>> >> >> describe is possible but I am not sure what role is being played by
>> >> >> your two servers. ?Is RabbitMQ running on both of them, one of them,
>> >> >> or neither? ?You may find it easier to just use one RabbitMQ server.
>> >> >>
>> >> >> Can you send a drawing of what your desired configuration is?
>> >> >>
>> >> >> alexis
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >> On Fri, Jul 3, 2009 at 3:08 PM, GAGAN
>> >> >> ARORA<gaganarora.itm at gmail.com>
>> >> >> wrote:
>> >> >> > Hi
>> >> >> > I am developing a system in which a user will connect to two
>> >> >> > servers.
>> >> >> > On
>> >> >> > connecting to first server he will become online and will send his
>> >> >> > presence
>> >> >> > update but he will receive presence updates only once he is
>> >> >> > connected
>> >> >> > to
>> >> >> > other server as his consumer subscribes to his queue after
>> >> >> > connecting
>> >> >> > to
>> >> >> > second server.
>> >> >> > I am using one exchange and one queue per user. So if one user
>> >> >> > comes
>> >> >> > online
>> >> >> > then he will send his presence update to his exchange and users
>> >> >> > bound
>> >> >> > to
>> >> >> > that will receive updates.
>> >> >> > I need to configure a queue which would hold messages for user who
>> >> >> > has
>> >> >> > just
>> >> >> > came online until he is connected to other server. After
>> >> >> > connecting
>> >> >> > to
>> >> >> > second server all messages will be consumed. All messages sent to
>> >> >> > queue
>> >> >> > will
>> >> >> > be dropped once user goes offline.
>> >> >> > Is it possible?
>> >> >> > Thanks
>> >> >> > Gagan Arora
>> >> >> > _______________________________________________
>> >> >> > rabbitmq-discuss mailing list
>> >> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >
>> >> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >
>> >> >> >
>> >> >
>> >> >
>> >
>> >
>
>



From alexis.richardson at gmail.com  Mon Jul  6 19:52:42 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 6 Jul 2009 19:52:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ/Spring integration - help required
In-Reply-To: <24284545.post@talk.nabble.com>
References: <24203688.post@talk.nabble.com>
	<A767955DD6BCC54C99FC1C628AA8BBA009278BBF@newexchangemail.onmobile.com>
	<167204d20906291419x5122dbb9n31cc1e37a01ac295@mail.gmail.com>
	<24284545.post@talk.nabble.com>
Message-ID: <167204d20907061152n5d3d7684wf57b0a8dbf8f4781@mail.gmail.com>

Vivek

Did you get this working?  Let us know - there are lots of people here
who know about rabbitmqctl.

Yes, RabbitMQ works *just fine* on Windows and if you have any
problems with that - please tell us.

alexis


On Wed, Jul 1, 2009 at 6:52 AM, krv<vivek.kubaji at onmobile.com> wrote:
>
> Hi Folks,
>
> Thanks for your valuable suggestions, I was able to advance a bit.
> Nevertheless I'm still stuck with getting 'rabbitmqctl.bat' working (Windows
> env and user is neither 'rabbitmq' nor 'root'). I was caught up with
> something else so couldn't look much into this. Will work on this today and
> try to get it working.
>
> Hope RabbitMQ does not have any issue running on Windows, cuz most of the
> posts speak of running on Linux.
>
> Regards,
> Vivek
>
>
> Alexis Richardson-4 wrote:
>>
>> Vivek
>>
>> Have you been able to resolve this issue?
>>
>> alexis
>>
>>
>> On Thu, Jun 25, 2009 at 4:18 PM, Vivek Ramesh.
>> Kubaji<vivek.kubaji at onmobile.com> wrote:
>>> Hi,
>>>
>>>
>>>
>>> I'm trying to evaluate RabbitMQ for our project. And I'm using
>>> Spring-integration framework. From the posts in the forum I ended up
>>> using
>>> the following configuration (jms part):
>>>
>>>
>>>
>>> ????? <beans:bean id="amqConnectionFactory"
>>>
>>> class="org.apache.qpid.client.AMQConnectionFactory">
>>>
>>> ??????????? <beans:constructor-arg
>>>
>>> value="amqp://guest:guest@/localhost?brokerlist='tcp://localhost:5672'"
>>> />
>>>
>>> ????? </beans:bean>
>>>
>>>
>>>
>>> ????? <beans:bean id="connectionFactory"
>>>
>>> class="org.springframework.jms.connection.SingleConnectionFactory">
>>>
>>> ??????????? <beans:property name="targetConnectionFactory"
>>>
>>> ref="amqConnectionFactory"/>
>>>
>>> ????? </beans:bean>
>>>
>>>
>>>
>>> ????? <beans:bean id="jms_QueueWest"
>>> class="org.apache.qpid.client.AMQQueue">
>>>
>>> ??????????? <beans:constructor-arg>
>>>
>>> ????????????????? <beans:bean class="org.apache.qpid.url.AMQBindingURL">
>>>
>>> ??????????????????????? <beans:constructor-arg value="${jms.queue1}"/>
>>>
>>> ????????????????? </beans:bean>
>>>
>>> ??????????? </beans:constructor-arg>
>>>
>>> ????? </beans:bean>
>>>
>>>
>>>
>>> and have this in my properties file:
>>>
>>>
>>>
>>> jms.queue1=direct://rabbit//my.queue1
>>>
>>>
>>>
>>> I'm running the RabbitMQ broker using the command
>>> $RABBITMQ_HOME$/sbin/rabbitmq-server.bat. When I start my client
>>> application
>>> I am getting the following error:
>>>
>>>
>>>
>>> 2009-06-25 19:00:21,192 INFO
>>>
>>> org.springframework.jms.listener.DefaultMessageListenerContainer#0-1
>>>
>>> [DefaultMessageListenerContainer.refreshConnectionUntilSuccessful] -
>>> Could
>>> not refresh JMS Connection for destination
>>> 'direct://rabbit/my.queue1/my.queue1?routingkey='my.queue1'' - retrying
>>> in
>>> 5000 ms. Cause: Error creating connection: Unable to Connect
>>> org.apache.qpid.transport.ConnectionException
>>>
>>> ??????? at
>>> org.apache.qpid.transport.Connection.close(Connection.java:494)
>>>
>>> ??????? at
>>> org.apache.qpid.transport.Connection.connect(Connection.java:193)
>>>
>>> ??????? at
>>>
>>> org.apache.qpid.client.AMQConnectionDelegate_0_10.makeBrokerConnection(AMQConnectionDelegate_0_10.java:161)
>>>
>>> ??????? at
>>>
>>> org.apache.qpid.client.AMQConnection.makeBrokerConnection(AMQConnection.java:728)
>>>
>>> ??????? at
>>>
>>> org.apache.qpid.client.AMQConnection.<init>(AMQConnection.java:520)
>>>
>>> ??????? at
>>>
>>> org.apache.qpid.client.AMQConnectionFactory.createConnection(AMQConnectionFactory.java:276)
>>>
>>> ??????? at
>>>
>>> org.springframework.jms.connection.SingleConnectionFactory.doCreateConnection(SingleConnectionFactory.java:343)
>>>
>>> ??????? at
>>>
>>> org.springframework.jms.connection.SingleConnectionFactory.initConnection(SingleConnectionFactory.java:290)
>>>
>>> ??????? at
>>>
>>> org.springframework.jms.connection.SingleConnectionFactory.createConnection(SingleConnectionFactory.java:227)
>>>
>>> ??????? at
>>>
>>> org.springframework.jms.support.JmsAccessor.createConnection(JmsAccessor.java:184)
>>>
>>> ??????? at
>>>
>>> org.springframework.jms.listener.AbstractJmsListeningContainer.createSharedConnection(AbstractJmsListeningContainer.java:378)
>>>
>>> ??????? at
>>>
>>> org.springframework.jms.listener.AbstractJmsListeningContainer.refreshSharedConnection(AbstractJmsListeningContainer.java:363)
>>>
>>> ??????? at
>>>
>>> org.springframework.jms.listener.DefaultMessageListenerContainer.refreshConnectionUntilSuccessful(DefaultMessageListenerContainer.java:785)
>>>
>>> ??????? at
>>>
>>> org.springframework.jms.listener.DefaultMessageListenerContainer.recoverAfterListenerSetupFailure(DefaultMessageListenerContainer.java:767)
>>>
>>> ??????? at
>>>
>>> org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:898)
>>>
>>> ??? ????at java.lang.Thread.run(Thread.java:619)
>>>
>>> Caused by: org.apache.qpid.transport.ConnectionException
>>>
>>> ??????? at
>>>
>>> org.apache.qpid.transport.Connection.exception(Connection.java:405)
>>>
>>> ??????? at
>>>
>>> org.apache.qpid.transport.network.Assembler.exception(Assembler.java:108)
>>>
>>> ??????? at
>>>
>>> org.apache.qpid.transport.network.InputHandler.exception(InputHandler.java:196)
>>>
>>> ??????? at
>>>
>>> org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:146)
>>>
>>> ?????? ?... 1 more
>>>
>>> Caused by: java.lang.IllegalStateException
>>>
>>> ??????? at
>>>
>>> org.apache.qpid.transport.network.InputHandler.next(InputHandler.java:190)
>>>
>>> ??????? at
>>>
>>> org.apache.qpid.transport.network.InputHandler.received(InputHandler.java:103)
>>>
>>> ??????? at
>>>
>>> org.apache.qpid.transport.network.InputHandler.received(InputHandler.java:42)
>>>
>>> ??????? at
>>>
>>> org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:128)
>>>
>>> ??????? ... 1 more
>>>
>>>
>>>
>>> Seeing the error I feel I have done some stupid mistake . Somebody please
>>> help me ...
>>>
>>>
>>>
>>> Thanks in advance.
>>>
>>>
>>>
>>> Regards,
>>>
>>> Vivek
>>>
>>>
>>>
>>>
>>>
>>> Regards,
>>>
>>> Vivek Kubaji
>>>
>>> Mail?????? : vivek.kubaji at onmobile.com
>>>
>>> Mobile? : 9880199884
>>>
>>> Ext????????? : 6147
>>>
>>>
>>>
>>> ==============================
>>> DISCLAIMER: The information in this message is confidential and may be
>>> legally privileged. It is intended solely for the addressee. Access to
>>> this
>>> message by anyone else is unauthorized. If you are not the intended
>>> recipient, any disclosure, copying, or distribution of the message, or
>>> any
>>> action or omission taken by you in reliance on it, is prohibited and may
>>> be
>>> unlawful. Please immediately contact the sender if you have received this
>>> message in error. Further, this e-mail may contain viruses and all
>>> reasonable precaution to minimize the risk arising there from is taken by
>>> OnMobile. OnMobile is not liable for any damage sustained by you as a
>>> result
>>> of any virus in this e-mail. All applicable virus checks should be
>>> carried
>>> out by you before opening this e-mail or any attachment thereto.
>>> Thank you - OnMobile Global Limited.
>>> ==============================
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
> --
> View this message in context: http://www.nabble.com/RabbitMQ-Spring-integration---help-required-tp24203688p24284545.html
> Sent from the RabbitMQ mailing list archive at Nabble.com.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From gaganarora.itm at gmail.com  Mon Jul  6 20:17:50 2009
From: gaganarora.itm at gmail.com (GAGAN ARORA)
Date: Tue, 7 Jul 2009 00:47:50 +0530
Subject: [rabbitmq-discuss] Messages Timeout in Queue
In-Reply-To: <167204d20907061133u5148c539t9b98542acc03019f@mail.gmail.com>
References: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>
	<167204d20907030747ie3357d7l24c7818a40cd25c9@mail.gmail.com>
	<e2ab72f80907030908n3dfe8dbfu83d38e23b0d793b4@mail.gmail.com>
	<167204d20907040302l561be62pc7921176ed319095@mail.gmail.com>
	<e2ab72f80907041228m7e91f02fy5e15779350983556@mail.gmail.com>
	<167204d20907060858t2937f70bv32080711d32a750c@mail.gmail.com>
	<e2ab72f80907061102m6e184e18x45bf6484e35b8c3c@mail.gmail.com>
	<167204d20907061133u5148c539t9b98542acc03019f@mail.gmail.com>
Message-ID: <e2ab72f80907061217r63c84eedu964979cef09affc4@mail.gmail.com>

Alexis

Actually dropping out messages from queue is another problem I am facing and
is following it on another thread with you. In this case I am assuming there
is no dropping  out of messages from queue if there is no consumer is
listening to the queue and a message is always queued up in queue.

Thanks
Gagan

On Tue, Jul 7, 2009 at 12:03 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Gagan,
>
> On Mon, Jul 6, 2009 at 7:02 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> wrote:
> > Alexis
> >
> > a) when the User A is not logged into server 1 or server 2, any
> > messages sent to them by User B are discarded
> >>> Actually during this case no consumer would be listening to User A
> queue
> >>> and hence the messages can't be discarded and would be queued in Queue.
>
> In your document you said:
>
> "Case1: User B sending his message to UserB Exchange which will route
> message to User A queue but User A is not connected to any of servers.
> At this point of  all messages sent to Queue A should be dropped."
>
> If this is happening then the messages will be discarded and not
> queued in Queue.
>
> alexis
>
>
>
> > b) but, when User A is logged in to server 1, any messages sent by
> > User B that may be routed to User A are queued in Queue A,
> >>> No of messages increases.
> >
> > c) .... delivered when User A logs into server 2.
> >>> A large no of messages get delieverd.
> >
> > It is a constraint in my system that I have to initialize consumer when
> User
> > A connects to Server2.
> >
> > On Mon, Jul 6, 2009 at 9:28 PM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Gagan
> >>
> >> As I understood from your document:
> >>
> >> a) when the User A is not logged into server 1 or server 2, any
> >> messages sent to them by User B are discarded
> >> b) but, when User A is logged in to server 1, any messages sent by
> >> User B that may be routed to User A are queued in Queue A, and then
> >> ...
> >> c) .... delivered when User A logs into server 2.
> >>
> >> Provided that you can implement this efficiently (see other email)
> >> then the consumer at User A only needs to discard messages that are
> >> older than one minute, and that were not already discarded due to (a)
> >> above.  So unless the time interval between A logging into server 1,
> >> and A logging into server 2, is "quite long" then the 'timestamp'
> >> method adds very little overhead.
> >>
> >> Is that correct or have I missed something?
> >>
> >> alexis
> >>
> >>
> >>
> >>
> >>
> >>
> >> On Sat, Jul 4, 2009 at 8:28 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> >> wrote:
> >> > Hi Alexis
> >> >
> >> > My system is similar to an IM system and is using RabbitMQ for
> presence
> >> > updates and have designed it in such a way that a consumer subscribes
> to
> >> > a
> >> > queue only when it comes online.Now the issue is as stated by you
> there
> >> > will
> >> > be a large no of messages ready to be deleivered when a user comes
> >> > online.
> >> > Checking timestamp for each message will result in high cost.
> >> >
> >> > There can be a solution in which a message can be published using
> >> > immediate
> >> > flag. But it is desired by consumer to get all messages which are less
> >> > than
> >> > 1 minute old.
> >> >
> >> > Can you suggest some other solution for achieving this?
> >> >
> >> > Thanks
> >> > Gagan Arora
> >> >
> >> >
> >> >
> >> >
> >> > On Sat, Jul 4, 2009 at 3:32 PM, Alexis Richardson
> >> > <alexis.richardson at gmail.com> wrote:
> >> >>
> >> >> Gagan,
> >> >>
> >> >> On Fri, Jul 3, 2009 at 5:08 PM, GAGAN ARORA<gaganarora.itm at gmail.com
> >
> >> >> wrote:
> >> >> > Hi Alexis
> >> >> > The problem statement here is I dont want my messages in queue for
> >> >> > more
> >> >> > than
> >> >> > 1 minute.
> >> >>
> >> >> The easiest way to do this is for the client to keep consuming the
> >> >> messages from the queue.
> >> >>
> >> >> However: presumably you want messages to be ignored in the case where
> >> >> (a) there is no consumer to get the messages from the queue; and (b)
> >> >> the messages are more than one minute old.
> >> >>
> >> >> If so then: Have you considered putting a timestamp on the messages?
> >> >> That way, when a consumer starts taking messages from the queue, it
> >> >> can simply check the timestamps and throw away anything 'old'.  This
> >> >> solution works just fine when (i) you don't need real time accuracy
> >> >> ie. "about a minute" is just as good as "exactly a minute", and
> >> >> provided that (ii) there aren't too many messages to throw away.
> >> >> Judging by the document that you sent, both (i) and (ii) are true.
> >> >>
> >> >> Does this help?
> >> >>
> >> >> alexis
> >> >>
> >> >>
> >> >> > I have tried expiration property while publishing a message but
> >> >> > later came to know that it is still not implemented. Can you help
> me
> >> >> > out
> >> >> > in
> >> >> > figuring some alternate approach?
> >> >> > Thanks
> >> >> > Gagan Arora
> >> >> >
> >> >> > On Fri, Jul 3, 2009 at 8:17 PM, Alexis Richardson
> >> >> > <alexis.richardson at gmail.com> wrote:
> >> >> >>
> >> >> >> Gagan,
> >> >> >>
> >> >> >> On Fri, Jul 3, 2009 at 3:10 PM, GAGAN
> >> >> >> ARORA<gaganarora.itm at gmail.com>
> >> >> >> wrote:
> >> >> >> > Hi
> >> >> >> > Is it possible to set message time out in Java client API, so
> that
> >> >> >> > messages
> >> >> >> > drop out from queue after some interval of time if nobody
> consumes
> >> >> >> > it?.
> >> >> >>
> >> >> >> Not yet but this is a feature have been asking for quite a bit.
> >> >> >>  It's
> >> >> >> on our roadmap.
> >> >> >>
> >> >> >> There may be other ways to achieve what you want.
> >> >> >>
> >> >> >> alexis
> >> >> >>
> >> >> >>
> >> >> >>
> >> >> >> > Thanks
> >> >> >> > Gagan Arora
> >> >> >> > _______________________________________________
> >> >> >> > rabbitmq-discuss mailing list
> >> >> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> >> >> >
> >> >> >> >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >> >
> >> >> >> >
> >> >> >
> >> >> >
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090707/dd3d9177/attachment.htm 

From nemik at nemik.net  Mon Jul  6 21:08:21 2009
From: nemik at nemik.net (Nemanja Stefanovic)
Date: Mon, 6 Jul 2009 15:08:21 -0500
Subject: [rabbitmq-discuss] When is a rabbitmq-stomp 1.6.0 adapter
	coming?
In-Reply-To: <14f55850906271248p80399fcw7e50d46befe5017@mail.gmail.com>
References: <14f55850906271248p80399fcw7e50d46befe5017@mail.gmail.com>
Message-ID: <acceaadf0907061308w2bc8f940v88ce94cdbdf3ce18@mail.gmail.com>

I'm wondering about this too. One thing tripping me up now is the
STOMPadapter is passing:
"ChPid =
         rabbit_channel:start_link(self(), self(),
                                  U#user.username,
list_to_binary(VirtualHost)),"

and rabbit_channel:start_link() is:
"start_link(Channel, ReaderPid, WriterPid, Username, VHost) ->
...."

I'm not sure what that first Channel parameter should be...seeing as that's
what should get returned by that function?

Just not sure why that change was made or how I could fix it, any tips would
be appreciated because once that's solved I'm pretty sure it'll all work
nicely.

Thank you,
Nemanja


On Sat, Jun 27, 2009 at 2:48 PM, Ivan Delchev <ivdelchev at gmail.com> wrote:

> Hi everyone,
>
> I'm new to the list but I'm very fascinated by the features of
> RabbitMQ and plan to use it for a project of mine. For the purpose I
> would also require the rabbitmq-stomp adapter. I noticed that the
> current version of RabbitMQ is 1.6.0 but the latest tagged
> rabbitmq-stomp adapter is 1.5.5. When do you plan to release a 1.6
> rabbitmq-stomp adapter - I quite like the newly introduced access
> control features of RabbitMQ 1.6.0. Are there any recorded issues when
> using the new server with the older adapter?
>
> Great job!
>
> Regards,
> Ivan
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090706/4bd5e8b5/attachment.htm 

From alexis.richardson at gmail.com  Mon Jul  6 21:55:03 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 6 Jul 2009 21:55:03 +0100
Subject: [rabbitmq-discuss] Messages Timeout in Queue
In-Reply-To: <e2ab72f80907061217r63c84eedu964979cef09affc4@mail.gmail.com>
References: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>
	<167204d20907030747ie3357d7l24c7818a40cd25c9@mail.gmail.com>
	<e2ab72f80907030908n3dfe8dbfu83d38e23b0d793b4@mail.gmail.com>
	<167204d20907040302l561be62pc7921176ed319095@mail.gmail.com>
	<e2ab72f80907041228m7e91f02fy5e15779350983556@mail.gmail.com>
	<167204d20907060858t2937f70bv32080711d32a750c@mail.gmail.com>
	<e2ab72f80907061102m6e184e18x45bf6484e35b8c3c@mail.gmail.com>
	<167204d20907061133u5148c539t9b98542acc03019f@mail.gmail.com>
	<e2ab72f80907061217r63c84eedu964979cef09affc4@mail.gmail.com>
Message-ID: <167204d20907061355h6a9f3d18g67448bd81949c551@mail.gmail.com>

On Mon, Jul 6, 2009 at 8:17 PM, GAGAN ARORA<gaganarora.itm at gmail.com> wrote:
> Alexis
>
> Actually dropping out messages from queue is another problem I am facing and
> is following it on another thread with you. In this case I am assuming there
> is no dropping? out of messages from queue if there is no consumer is
> listening to the queue and a message is always queued up in queue.

Messages will get dropped by an exchange X instead of being put in a
queue Q, when Q is not bound to X.

So to go through your case:

"Case1: User B sending his message to UserB Exchange which will route
message to User A queue but User A is not connected to any of servers.
 At this point of  all messages sent to Queue A should be dropped."

The property you want is:

* When User A is not connected to any of servers
* Then all messages sent to Queue A should be dropped

This is true IF when User A is not connected to any of the servers,
THEN queue A is not bound to any exchanges.

This has *nothing* to do with consumers or what they are 'listening' to.

So - when User A is not connected then (if above) messages for A get
dropped.  Easy peasy.

alexis





> Thanks
> Gagan
>
> On Tue, Jul 7, 2009 at 12:03 AM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Gagan,
>>
>> On Mon, Jul 6, 2009 at 7:02 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> wrote:
>> > Alexis
>> >
>> > a) when the User A is not logged into server 1 or server 2, any
>> > messages sent to them by User B are discarded
>> >>> Actually during this case no consumer would be listening to User A
>> >>> queue
>> >>> and hence the messages can't be discarded and would be queued in
>> >>> Queue.
>>
>> In your document you said:
>>
>> "Case1: User B sending his message to UserB Exchange which will route
>> message to User A queue but User A is not connected to any of servers.
>> At this point of ?all messages sent to Queue A should be dropped."
>>
>> If this is happening then the messages will be discarded and not
>> queued in Queue.
>>
>> alexis
>>
>>
>>
>> > b) but, when User A is logged in to server 1, any messages sent by
>> > User B that may be routed to User A are queued in Queue A,
>> >>> No of messages increases.
>> >
>> > c) .... delivered when User A logs into server 2.
>> >>> A large no of messages get delieverd.
>> >
>> > It is a constraint in my system that I have to initialize consumer when
>> > User
>> > A connects to Server2.
>> >
>> > On Mon, Jul 6, 2009 at 9:28 PM, Alexis Richardson
>> > <alexis.richardson at gmail.com> wrote:
>> >>
>> >> Gagan
>> >>
>> >> As I understood from your document:
>> >>
>> >> a) when the User A is not logged into server 1 or server 2, any
>> >> messages sent to them by User B are discarded
>> >> b) but, when User A is logged in to server 1, any messages sent by
>> >> User B that may be routed to User A are queued in Queue A, and then
>> >> ...
>> >> c) .... delivered when User A logs into server 2.
>> >>
>> >> Provided that you can implement this efficiently (see other email)
>> >> then the consumer at User A only needs to discard messages that are
>> >> older than one minute, and that were not already discarded due to (a)
>> >> above. ?So unless the time interval between A logging into server 1,
>> >> and A logging into server 2, is "quite long" then the 'timestamp'
>> >> method adds very little overhead.
>> >>
>> >> Is that correct or have I missed something?
>> >>
>> >> alexis
>> >>
>> >>
>> >>
>> >>
>> >>
>> >>
>> >> On Sat, Jul 4, 2009 at 8:28 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> >> wrote:
>> >> > Hi Alexis
>> >> >
>> >> > My system is similar to an IM system and is using RabbitMQ for
>> >> > presence
>> >> > updates and have designed it in such a way that a consumer subscribes
>> >> > to
>> >> > a
>> >> > queue only when it comes online.Now the issue is as stated by you
>> >> > there
>> >> > will
>> >> > be a large no of messages ready to be deleivered when a user comes
>> >> > online.
>> >> > Checking timestamp for each message will result in high cost.
>> >> >
>> >> > There can be a solution in which a message can be published using
>> >> > immediate
>> >> > flag. But it is desired by consumer to get all messages which are
>> >> > less
>> >> > than
>> >> > 1 minute old.
>> >> >
>> >> > Can you suggest some other solution for achieving this?
>> >> >
>> >> > Thanks
>> >> > Gagan Arora
>> >> >
>> >> >
>> >> >
>> >> >
>> >> > On Sat, Jul 4, 2009 at 3:32 PM, Alexis Richardson
>> >> > <alexis.richardson at gmail.com> wrote:
>> >> >>
>> >> >> Gagan,
>> >> >>
>> >> >> On Fri, Jul 3, 2009 at 5:08 PM, GAGAN
>> >> >> ARORA<gaganarora.itm at gmail.com>
>> >> >> wrote:
>> >> >> > Hi Alexis
>> >> >> > The problem statement here is I dont want my messages in queue for
>> >> >> > more
>> >> >> > than
>> >> >> > 1 minute.
>> >> >>
>> >> >> The easiest way to do this is for the client to keep consuming the
>> >> >> messages from the queue.
>> >> >>
>> >> >> However: presumably you want messages to be ignored in the case
>> >> >> where
>> >> >> (a) there is no consumer to get the messages from the queue; and (b)
>> >> >> the messages are more than one minute old.
>> >> >>
>> >> >> If so then: Have you considered putting a timestamp on the messages?
>> >> >> That way, when a consumer starts taking messages from the queue, it
>> >> >> can simply check the timestamps and throw away anything 'old'. ?This
>> >> >> solution works just fine when (i) you don't need real time accuracy
>> >> >> ie. "about a minute" is just as good as "exactly a minute", and
>> >> >> provided that (ii) there aren't too many messages to throw away.
>> >> >> Judging by the document that you sent, both (i) and (ii) are true.
>> >> >>
>> >> >> Does this help?
>> >> >>
>> >> >> alexis
>> >> >>
>> >> >>
>> >> >> > I have tried expiration property while publishing a message but
>> >> >> > later came to know that it is still not implemented. Can you help
>> >> >> > me
>> >> >> > out
>> >> >> > in
>> >> >> > figuring some alternate approach?
>> >> >> > Thanks
>> >> >> > Gagan Arora
>> >> >> >
>> >> >> > On Fri, Jul 3, 2009 at 8:17 PM, Alexis Richardson
>> >> >> > <alexis.richardson at gmail.com> wrote:
>> >> >> >>
>> >> >> >> Gagan,
>> >> >> >>
>> >> >> >> On Fri, Jul 3, 2009 at 3:10 PM, GAGAN
>> >> >> >> ARORA<gaganarora.itm at gmail.com>
>> >> >> >> wrote:
>> >> >> >> > Hi
>> >> >> >> > Is it possible to set message time out in Java client API, so
>> >> >> >> > that
>> >> >> >> > messages
>> >> >> >> > drop out from queue after some interval of time if nobody
>> >> >> >> > consumes
>> >> >> >> > it?.
>> >> >> >>
>> >> >> >> Not yet but this is a feature have been asking for quite a bit.
>> >> >> >> ?It's
>> >> >> >> on our roadmap.
>> >> >> >>
>> >> >> >> There may be other ways to achieve what you want.
>> >> >> >>
>> >> >> >> alexis
>> >> >> >>
>> >> >> >>
>> >> >> >>
>> >> >> >> > Thanks
>> >> >> >> > Gagan Arora
>> >> >> >> > _______________________________________________
>> >> >> >> > rabbitmq-discuss mailing list
>> >> >> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >> >
>> >> >> >> >
>> >> >> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >> >
>> >> >> >> >
>> >> >> >
>> >> >> >
>> >> >
>> >> >
>> >
>> >
>
>



From gaganarora.itm at gmail.com  Tue Jul  7 05:39:04 2009
From: gaganarora.itm at gmail.com (GAGAN ARORA)
Date: Tue, 7 Jul 2009 10:09:04 +0530
Subject: [rabbitmq-discuss] Messages Timeout in Queue
In-Reply-To: <167204d20907061355h6a9f3d18g67448bd81949c551@mail.gmail.com>
References: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>
	<167204d20907030747ie3357d7l24c7818a40cd25c9@mail.gmail.com>
	<e2ab72f80907030908n3dfe8dbfu83d38e23b0d793b4@mail.gmail.com>
	<167204d20907040302l561be62pc7921176ed319095@mail.gmail.com>
	<e2ab72f80907041228m7e91f02fy5e15779350983556@mail.gmail.com>
	<167204d20907060858t2937f70bv32080711d32a750c@mail.gmail.com>
	<e2ab72f80907061102m6e184e18x45bf6484e35b8c3c@mail.gmail.com>
	<167204d20907061133u5148c539t9b98542acc03019f@mail.gmail.com>
	<e2ab72f80907061217r63c84eedu964979cef09affc4@mail.gmail.com>
	<167204d20907061355h6a9f3d18g67448bd81949c551@mail.gmail.com>
Message-ID: <e2ab72f80907062139t2ae6157bp19e841fffd189974@mail.gmail.com>

Alexis
But my design says queue must be  bind to an exchange when user is created
and not at time User connects to server 1.

Gagan

On Tue, Jul 7, 2009 at 2:25 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> On Mon, Jul 6, 2009 at 8:17 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> wrote:
> > Alexis
> >
> > Actually dropping out messages from queue is another problem I am facing
> and
> > is following it on another thread with you. In this case I am assuming
> there
> > is no dropping  out of messages from queue if there is no consumer is
> > listening to the queue and a message is always queued up in queue.
>
> Messages will get dropped by an exchange X instead of being put in a
> queue Q, when Q is not bound to X.
>
> So to go through your case:
>
> "Case1: User B sending his message to UserB Exchange which will route
> message to User A queue but User A is not connected to any of servers.
>  At this point of  all messages sent to Queue A should be dropped."
>
> The property you want is:
>
> * When User A is not connected to any of servers
> * Then all messages sent to Queue A should be dropped
>
> This is true IF when User A is not connected to any of the servers,
> THEN queue A is not bound to any exchanges.
>
> This has *nothing* to do with consumers or what they are 'listening' to.
>
> So - when User A is not connected then (if above) messages for A get
> dropped.  Easy peasy.
>
> alexis
>
>
>
>
>
> > Thanks
> > Gagan
> >
> > On Tue, Jul 7, 2009 at 12:03 AM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Gagan,
> >>
> >> On Mon, Jul 6, 2009 at 7:02 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
> >> wrote:
> >> > Alexis
> >> >
> >> > a) when the User A is not logged into server 1 or server 2, any
> >> > messages sent to them by User B are discarded
> >> >>> Actually during this case no consumer would be listening to User A
> >> >>> queue
> >> >>> and hence the messages can't be discarded and would be queued in
> >> >>> Queue.
> >>
> >> In your document you said:
> >>
> >> "Case1: User B sending his message to UserB Exchange which will route
> >> message to User A queue but User A is not connected to any of servers.
> >> At this point of  all messages sent to Queue A should be dropped."
> >>
> >> If this is happening then the messages will be discarded and not
> >> queued in Queue.
> >>
> >> alexis
> >>
> >>
> >>
> >> > b) but, when User A is logged in to server 1, any messages sent by
> >> > User B that may be routed to User A are queued in Queue A,
> >> >>> No of messages increases.
> >> >
> >> > c) .... delivered when User A logs into server 2.
> >> >>> A large no of messages get delieverd.
> >> >
> >> > It is a constraint in my system that I have to initialize consumer
> when
> >> > User
> >> > A connects to Server2.
> >> >
> >> > On Mon, Jul 6, 2009 at 9:28 PM, Alexis Richardson
> >> > <alexis.richardson at gmail.com> wrote:
> >> >>
> >> >> Gagan
> >> >>
> >> >> As I understood from your document:
> >> >>
> >> >> a) when the User A is not logged into server 1 or server 2, any
> >> >> messages sent to them by User B are discarded
> >> >> b) but, when User A is logged in to server 1, any messages sent by
> >> >> User B that may be routed to User A are queued in Queue A, and then
> >> >> ...
> >> >> c) .... delivered when User A logs into server 2.
> >> >>
> >> >> Provided that you can implement this efficiently (see other email)
> >> >> then the consumer at User A only needs to discard messages that are
> >> >> older than one minute, and that were not already discarded due to (a)
> >> >> above.  So unless the time interval between A logging into server 1,
> >> >> and A logging into server 2, is "quite long" then the 'timestamp'
> >> >> method adds very little overhead.
> >> >>
> >> >> Is that correct or have I missed something?
> >> >>
> >> >> alexis
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >>
> >> >> On Sat, Jul 4, 2009 at 8:28 PM, GAGAN ARORA<gaganarora.itm at gmail.com
> >
> >> >> wrote:
> >> >> > Hi Alexis
> >> >> >
> >> >> > My system is similar to an IM system and is using RabbitMQ for
> >> >> > presence
> >> >> > updates and have designed it in such a way that a consumer
> subscribes
> >> >> > to
> >> >> > a
> >> >> > queue only when it comes online.Now the issue is as stated by you
> >> >> > there
> >> >> > will
> >> >> > be a large no of messages ready to be deleivered when a user comes
> >> >> > online.
> >> >> > Checking timestamp for each message will result in high cost.
> >> >> >
> >> >> > There can be a solution in which a message can be published using
> >> >> > immediate
> >> >> > flag. But it is desired by consumer to get all messages which are
> >> >> > less
> >> >> > than
> >> >> > 1 minute old.
> >> >> >
> >> >> > Can you suggest some other solution for achieving this?
> >> >> >
> >> >> > Thanks
> >> >> > Gagan Arora
> >> >> >
> >> >> >
> >> >> >
> >> >> >
> >> >> > On Sat, Jul 4, 2009 at 3:32 PM, Alexis Richardson
> >> >> > <alexis.richardson at gmail.com> wrote:
> >> >> >>
> >> >> >> Gagan,
> >> >> >>
> >> >> >> On Fri, Jul 3, 2009 at 5:08 PM, GAGAN
> >> >> >> ARORA<gaganarora.itm at gmail.com>
> >> >> >> wrote:
> >> >> >> > Hi Alexis
> >> >> >> > The problem statement here is I dont want my messages in queue
> for
> >> >> >> > more
> >> >> >> > than
> >> >> >> > 1 minute.
> >> >> >>
> >> >> >> The easiest way to do this is for the client to keep consuming the
> >> >> >> messages from the queue.
> >> >> >>
> >> >> >> However: presumably you want messages to be ignored in the case
> >> >> >> where
> >> >> >> (a) there is no consumer to get the messages from the queue; and
> (b)
> >> >> >> the messages are more than one minute old.
> >> >> >>
> >> >> >> If so then: Have you considered putting a timestamp on the
> messages?
> >> >> >> That way, when a consumer starts taking messages from the queue,
> it
> >> >> >> can simply check the timestamps and throw away anything 'old'.
>  This
> >> >> >> solution works just fine when (i) you don't need real time
> accuracy
> >> >> >> ie. "about a minute" is just as good as "exactly a minute", and
> >> >> >> provided that (ii) there aren't too many messages to throw away.
> >> >> >> Judging by the document that you sent, both (i) and (ii) are true.
> >> >> >>
> >> >> >> Does this help?
> >> >> >>
> >> >> >> alexis
> >> >> >>
> >> >> >>
> >> >> >> > I have tried expiration property while publishing a message but
> >> >> >> > later came to know that it is still not implemented. Can you
> help
> >> >> >> > me
> >> >> >> > out
> >> >> >> > in
> >> >> >> > figuring some alternate approach?
> >> >> >> > Thanks
> >> >> >> > Gagan Arora
> >> >> >> >
> >> >> >> > On Fri, Jul 3, 2009 at 8:17 PM, Alexis Richardson
> >> >> >> > <alexis.richardson at gmail.com> wrote:
> >> >> >> >>
> >> >> >> >> Gagan,
> >> >> >> >>
> >> >> >> >> On Fri, Jul 3, 2009 at 3:10 PM, GAGAN
> >> >> >> >> ARORA<gaganarora.itm at gmail.com>
> >> >> >> >> wrote:
> >> >> >> >> > Hi
> >> >> >> >> > Is it possible to set message time out in Java client API, so
> >> >> >> >> > that
> >> >> >> >> > messages
> >> >> >> >> > drop out from queue after some interval of time if nobody
> >> >> >> >> > consumes
> >> >> >> >> > it?.
> >> >> >> >>
> >> >> >> >> Not yet but this is a feature have been asking for quite a bit.
> >> >> >> >>  It's
> >> >> >> >> on our roadmap.
> >> >> >> >>
> >> >> >> >> There may be other ways to achieve what you want.
> >> >> >> >>
> >> >> >> >> alexis
> >> >> >> >>
> >> >> >> >>
> >> >> >> >>
> >> >> >> >> > Thanks
> >> >> >> >> > Gagan Arora
> >> >> >> >> > _______________________________________________
> >> >> >> >> > rabbitmq-discuss mailing list
> >> >> >> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> >> >> >> >
> >> >> >> >> >
> >> >> >> >> >
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >> >> >> >
> >> >> >> >> >
> >> >> >> >
> >> >> >> >
> >> >> >
> >> >> >
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090707/8d14943f/attachment.htm 

From alexis.richardson at gmail.com  Tue Jul  7 08:42:20 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 7 Jul 2009 08:42:20 +0100
Subject: [rabbitmq-discuss] Messages Timeout in Queue
In-Reply-To: <e2ab72f80907062139t2ae6157bp19e841fffd189974@mail.gmail.com>
References: <e2ab72f80907030710y56b39606wb2c9da626352369c@mail.gmail.com>
	<e2ab72f80907030908n3dfe8dbfu83d38e23b0d793b4@mail.gmail.com>
	<167204d20907040302l561be62pc7921176ed319095@mail.gmail.com>
	<e2ab72f80907041228m7e91f02fy5e15779350983556@mail.gmail.com>
	<167204d20907060858t2937f70bv32080711d32a750c@mail.gmail.com>
	<e2ab72f80907061102m6e184e18x45bf6484e35b8c3c@mail.gmail.com>
	<167204d20907061133u5148c539t9b98542acc03019f@mail.gmail.com>
	<e2ab72f80907061217r63c84eedu964979cef09affc4@mail.gmail.com>
	<167204d20907061355h6a9f3d18g67448bd81949c551@mail.gmail.com>
	<e2ab72f80907062139t2ae6157bp19e841fffd189974@mail.gmail.com>
Message-ID: <167204d20907070042m22c2fb46o6162732cdff63c1d@mail.gmail.com>

On Tue, Jul 7, 2009 at 5:39 AM, GAGAN ARORA<gaganarora.itm at gmail.com> wrote:
> Alexis
> But my design says queue must be ?bind to an exchange when user is created
> and not at time User connects to server 1.

If so, then that information is not in the document you sent.  You
will see that the queue binding has to happen between Case 1 (when
messages are dropped) and Case 2 (when messages are queued).

In your design doc, how does Case 5 arise?  It looks like User A is
disconnecting from both servers, but not getting destroyed.  I suggest
you use this mechanism to avoid remaining in the state 'Case 4' for
unbounded periods of time.  That way, you won't need TTL.

alexis














> Gagan
>
> On Tue, Jul 7, 2009 at 2:25 AM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> On Mon, Jul 6, 2009 at 8:17 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> wrote:
>> > Alexis
>> >
>> > Actually dropping out messages from queue is another problem I am facing
>> > and
>> > is following it on another thread with you. In this case I am assuming
>> > there
>> > is no dropping? out of messages from queue if there is no consumer is
>> > listening to the queue and a message is always queued up in queue.
>>
>> Messages will get dropped by an exchange X instead of being put in a
>> queue Q, when Q is not bound to X.
>>
>> So to go through your case:
>>
>> "Case1: User B sending his message to UserB Exchange which will route
>> message to User A queue but User A is not connected to any of servers.
>> ?At this point of ?all messages sent to Queue A should be dropped."
>>
>> The property you want is:
>>
>> * When User A is not connected to any of servers
>> * Then all messages sent to Queue A should be dropped
>>
>> This is true IF when User A is not connected to any of the servers,
>> THEN queue A is not bound to any exchanges.
>>
>> This has *nothing* to do with consumers or what they are 'listening' to.
>>
>> So - when User A is not connected then (if above) messages for A get
>> dropped. ?Easy peasy.
>>
>> alexis
>>
>>
>>
>>
>>
>> > Thanks
>> > Gagan
>> >
>> > On Tue, Jul 7, 2009 at 12:03 AM, Alexis Richardson
>> > <alexis.richardson at gmail.com> wrote:
>> >>
>> >> Gagan,
>> >>
>> >> On Mon, Jul 6, 2009 at 7:02 PM, GAGAN ARORA<gaganarora.itm at gmail.com>
>> >> wrote:
>> >> > Alexis
>> >> >
>> >> > a) when the User A is not logged into server 1 or server 2, any
>> >> > messages sent to them by User B are discarded
>> >> >>> Actually during this case no consumer would be listening to User A
>> >> >>> queue
>> >> >>> and hence the messages can't be discarded and would be queued in
>> >> >>> Queue.
>> >>
>> >> In your document you said:
>> >>
>> >> "Case1: User B sending his message to UserB Exchange which will route
>> >> message to User A queue but User A is not connected to any of servers.
>> >> At this point of ?all messages sent to Queue A should be dropped."
>> >>
>> >> If this is happening then the messages will be discarded and not
>> >> queued in Queue.
>> >>
>> >> alexis
>> >>
>> >>
>> >>
>> >> > b) but, when User A is logged in to server 1, any messages sent by
>> >> > User B that may be routed to User A are queued in Queue A,
>> >> >>> No of messages increases.
>> >> >
>> >> > c) .... delivered when User A logs into server 2.
>> >> >>> A large no of messages get delieverd.
>> >> >
>> >> > It is a constraint in my system that I have to initialize consumer
>> >> > when
>> >> > User
>> >> > A connects to Server2.
>> >> >
>> >> > On Mon, Jul 6, 2009 at 9:28 PM, Alexis Richardson
>> >> > <alexis.richardson at gmail.com> wrote:
>> >> >>
>> >> >> Gagan
>> >> >>
>> >> >> As I understood from your document:
>> >> >>
>> >> >> a) when the User A is not logged into server 1 or server 2, any
>> >> >> messages sent to them by User B are discarded
>> >> >> b) but, when User A is logged in to server 1, any messages sent by
>> >> >> User B that may be routed to User A are queued in Queue A, and then
>> >> >> ...
>> >> >> c) .... delivered when User A logs into server 2.
>> >> >>
>> >> >> Provided that you can implement this efficiently (see other email)
>> >> >> then the consumer at User A only needs to discard messages that are
>> >> >> older than one minute, and that were not already discarded due to
>> >> >> (a)
>> >> >> above. ?So unless the time interval between A logging into server 1,
>> >> >> and A logging into server 2, is "quite long" then the 'timestamp'
>> >> >> method adds very little overhead.
>> >> >>
>> >> >> Is that correct or have I missed something?
>> >> >>
>> >> >> alexis
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >> On Sat, Jul 4, 2009 at 8:28 PM, GAGAN
>> >> >> ARORA<gaganarora.itm at gmail.com>
>> >> >> wrote:
>> >> >> > Hi Alexis
>> >> >> >
>> >> >> > My system is similar to an IM system and is using RabbitMQ for
>> >> >> > presence
>> >> >> > updates and have designed it in such a way that a consumer
>> >> >> > subscribes
>> >> >> > to
>> >> >> > a
>> >> >> > queue only when it comes online.Now the issue is as stated by you
>> >> >> > there
>> >> >> > will
>> >> >> > be a large no of messages ready to be deleivered when a user comes
>> >> >> > online.
>> >> >> > Checking timestamp for each message will result in high cost.
>> >> >> >
>> >> >> > There can be a solution in which a message can be published using
>> >> >> > immediate
>> >> >> > flag. But it is desired by consumer to get all messages which are
>> >> >> > less
>> >> >> > than
>> >> >> > 1 minute old.
>> >> >> >
>> >> >> > Can you suggest some other solution for achieving this?
>> >> >> >
>> >> >> > Thanks
>> >> >> > Gagan Arora
>> >> >> >
>> >> >> >
>> >> >> >
>> >> >> >
>> >> >> > On Sat, Jul 4, 2009 at 3:32 PM, Alexis Richardson
>> >> >> > <alexis.richardson at gmail.com> wrote:
>> >> >> >>
>> >> >> >> Gagan,
>> >> >> >>
>> >> >> >> On Fri, Jul 3, 2009 at 5:08 PM, GAGAN
>> >> >> >> ARORA<gaganarora.itm at gmail.com>
>> >> >> >> wrote:
>> >> >> >> > Hi Alexis
>> >> >> >> > The problem statement here is I dont want my messages in queue
>> >> >> >> > for
>> >> >> >> > more
>> >> >> >> > than
>> >> >> >> > 1 minute.
>> >> >> >>
>> >> >> >> The easiest way to do this is for the client to keep consuming
>> >> >> >> the
>> >> >> >> messages from the queue.
>> >> >> >>
>> >> >> >> However: presumably you want messages to be ignored in the case
>> >> >> >> where
>> >> >> >> (a) there is no consumer to get the messages from the queue; and
>> >> >> >> (b)
>> >> >> >> the messages are more than one minute old.
>> >> >> >>
>> >> >> >> If so then: Have you considered putting a timestamp on the
>> >> >> >> messages?
>> >> >> >> That way, when a consumer starts taking messages from the queue,
>> >> >> >> it
>> >> >> >> can simply check the timestamps and throw away anything 'old'.
>> >> >> >> ?This
>> >> >> >> solution works just fine when (i) you don't need real time
>> >> >> >> accuracy
>> >> >> >> ie. "about a minute" is just as good as "exactly a minute", and
>> >> >> >> provided that (ii) there aren't too many messages to throw away.
>> >> >> >> Judging by the document that you sent, both (i) and (ii) are
>> >> >> >> true.
>> >> >> >>
>> >> >> >> Does this help?
>> >> >> >>
>> >> >> >> alexis
>> >> >> >>
>> >> >> >>
>> >> >> >> > I have tried expiration property while publishing a message but
>> >> >> >> > later came to know that it is still not implemented. Can you
>> >> >> >> > help
>> >> >> >> > me
>> >> >> >> > out
>> >> >> >> > in
>> >> >> >> > figuring some alternate approach?
>> >> >> >> > Thanks
>> >> >> >> > Gagan Arora
>> >> >> >> >
>> >> >> >> > On Fri, Jul 3, 2009 at 8:17 PM, Alexis Richardson
>> >> >> >> > <alexis.richardson at gmail.com> wrote:
>> >> >> >> >>
>> >> >> >> >> Gagan,
>> >> >> >> >>
>> >> >> >> >> On Fri, Jul 3, 2009 at 3:10 PM, GAGAN
>> >> >> >> >> ARORA<gaganarora.itm at gmail.com>
>> >> >> >> >> wrote:
>> >> >> >> >> > Hi
>> >> >> >> >> > Is it possible to set message time out in Java client API,
>> >> >> >> >> > so
>> >> >> >> >> > that
>> >> >> >> >> > messages
>> >> >> >> >> > drop out from queue after some interval of time if nobody
>> >> >> >> >> > consumes
>> >> >> >> >> > it?.
>> >> >> >> >>
>> >> >> >> >> Not yet but this is a feature have been asking for quite a
>> >> >> >> >> bit.
>> >> >> >> >> ?It's
>> >> >> >> >> on our roadmap.
>> >> >> >> >>
>> >> >> >> >> There may be other ways to achieve what you want.
>> >> >> >> >>
>> >> >> >> >> alexis
>> >> >> >> >>
>> >> >> >> >>
>> >> >> >> >>
>> >> >> >> >> > Thanks
>> >> >> >> >> > Gagan Arora
>> >> >> >> >> > _______________________________________________
>> >> >> >> >> > rabbitmq-discuss mailing list
>> >> >> >> >> > rabbitmq-discuss at lists.rabbitmq.com
>> >> >> >> >> >
>> >> >> >> >> >
>> >> >> >> >> >
>> >> >> >> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >> >> >> >> >
>> >> >> >> >> >
>> >> >> >> >
>> >> >> >> >
>> >> >> >
>> >> >> >
>> >> >
>> >> >
>> >
>> >
>
>



From tsuraan at gmail.com  Tue Jul  7 20:12:11 2009
From: tsuraan at gmail.com (tsuraan)
Date: Tue, 7 Jul 2009 14:12:11 -0500
Subject: [rabbitmq-discuss] queue_disappeared?
Message-ID: <84fb38e30907071212k71b5ec28s9df63718b067a6e9@mail.gmail.com>

So I was running some tests of my system with Rabbit 1.5.3, and all of
a sudden the system died because a central queue "disappeared".  The
error message in the rabbit.log is this:

=ERROR REPORT==== 7-Jul-2009::14:03:53 ===
connection <0.15624.1> (running), channel 1 - error:
{amqp,internal_error,
      "commit failed: [{exit,{queue_disappeared,<0.15429.1>}}]",'tx.commit'}


Is this a known issue that has been fixed, or am I just lucky?  I can
upgrade to the latest stable version (1.5.5?) or even the 1.6.0 beta
if this is a known issue, or I'd be happy to provide any information
that I can if this is a new bug.



From esteve at sindominio.net  Tue Jul  7 20:20:58 2009
From: esteve at sindominio.net (Esteve Fernandez)
Date: Tue, 7 Jul 2009 21:20:58 +0200 (CEST)
Subject: [rabbitmq-discuss] Return message? [Was: Re: Sample code for
 python?]
In-Reply-To: <825108.73047.qm@web45604.mail.sp1.yahoo.com>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
	<d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com>
	<558122.16141.qm@web45608.mail.sp1.yahoo.com>
	<d272f0690907021151k9b581a9w61803baa37092398@mail.gmail.com>
	<825108.73047.qm@web45604.mail.sp1.yahoo.com>
Message-ID: <32861.80.37.183.27.1246994458.squirrel@webmail.sindominio.net>

> OK... I was just wondering what folks tend to use,.

We're using Thrift for RPC over AMQP [1], but you can use it purely as a
serialization library, without RPC (so you don't need Twisted and txAMQP at
all). Serialized Thrift structures tend to be 50%-80% smaller than the
equivalent JSON ones. Also, if you're using Python, Thrift is slightly faster
than cjson.

I wouldn't use pickle for serializing objects and sending them over the
network, as its not cross-platform and completely insecure:

http://jcalderone.livejournal.com/15864.html

Cheers.

1 - https://launchpad.net/txamqp




From esteve at sindominio.net  Tue Jul  7 20:34:53 2009
From: esteve at sindominio.net (Esteve Fernandez)
Date: Tue, 7 Jul 2009 21:34:53 +0200 (CEST)
Subject: [rabbitmq-discuss] Return message? [Was: Re: Sample code for
 python?]
In-Reply-To: <32861.80.37.183.27.1246994458.squirrel@webmail.sindominio.net>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
	<d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com>
	<558122.16141.qm@web45608.mail.sp1.yahoo.com>
	<d272f0690907021151k9b581a9w61803baa37092398@mail.gmail.com>
	<825108.73047.qm@web45604.mail.sp1.yahoo.com>
	<32861.80.37.183.27.1246994458.squirrel@webmail.sindominio.net>
Message-ID: <54064.80.37.183.27.1246995293.squirrel@webmail.sindominio.net>

>> OK... I was just wondering what folks tend to use,.

I forgot Google Protocol Buffers, I know it's being used together with AMQP.
However, in our benchmarks, GPB in Python is at least 60 times slower than
Thrift and cjson. I heard it's much more mature in Java and C++, but the
Python implementation was rushed out the door (AFAIK, Kenton Varda is Protocol
Buffers' main developer):

http://groups.google.com/group/protobuf/browse_thread/thread/9acb7638e1f5ff61

Cheers.




From tsuraan at gmail.com  Tue Jul  7 20:38:51 2009
From: tsuraan at gmail.com (tsuraan)
Date: Tue, 7 Jul 2009 14:38:51 -0500
Subject: [rabbitmq-discuss] queue_disappeared?
In-Reply-To: <84fb38e30907071212k71b5ec28s9df63718b067a6e9@mail.gmail.com>
References: <84fb38e30907071212k71b5ec28s9df63718b067a6e9@mail.gmail.com>
Message-ID: <84fb38e30907071238m1421fac3l8c4fdf46592e2ff1@mail.gmail.com>

> So I was running some tests of my system with Rabbit 1.5.3, and all of
> a sudden the system died because a central queue "disappeared".  The
> error message in the rabbit.log is this:
>
> =ERROR REPORT==== 7-Jul-2009::14:03:53 ===
> connection <0.15624.1> (running), channel 1 - error:
> {amqp,internal_error,
>       "commit failed:
> [{exit,{queue_disappeared,<0.15429.1>}}]",'tx.commit'}

Ok, so that was the first thing that I saw  from reading the log from
the bottom up.  Going from the top down is probably more useful.  The
full(-ish) log of what happened is:

=ERROR REPORT==== 7-Jul-2009::14:03:12 ===
** Generic server <0.15604.1> terminating
** Last message in was {commit,{{1,<0.15636.1>},14828}}
** When Server state == {q,{amqqueue,
                               {resource,<<"/">>,queue,<<"DocSearchEmails">>},
                               true,false,[],none},
                           none,none,true,3036,
                           {[],[]},
                           {[{<0.15729.1>,
                              {consumer,
                                  <<"amq.ctag-ONnWMrwJlReM+3ObdgstOA==">>,
                                  true}}],
                            []}}
** Reason for termination ==
** {timeout,
       {gen_server,call,
           [rabbit_persister,
            {commit_transaction,
                {{{1,<0.15636.1>},14828},
                 {resource,<<"/">>,queue,<<"DocSearchEmails">>}}}]}}

=ERROR REPORT==== 7-Jul-2009::14:03:14 ===
connection <0.6457.2> (running), channel 1 - error:
{{timeout,{gen_server,call,[<0.15508.1>,{basic_get,<0.6461.2>,false}]}},
 [{gen_server,call,2},
  {rabbit_misc,with_exit_handler,2},
  {rabbit_channel,handle_method,3},
  {rabbit_channel,handle_message,2},
  {buffering_proxy,'-mainloop/4-fun-0-',3},
  {lists,foldl,3},
  {buffering_proxy,mainloop,4}]}

=WARNING REPORT==== 7-Jul-2009::14:03:14 ===
Non-AMQP exit reason '{{timeout,
                           {gen_server,call,
                               [<0.15508.1>,{basic_get,<0.6461.2>,false}]}},
                       [{gen_server,call,2},
                        {rabbit_misc,with_exit_handler,2},
                        {rabbit_channel,handle_method,3},
                        {rabbit_channel,handle_message,2},
                        {buffering_proxy,'-mainloop/4-fun-0-',3},
                        {lists,foldl,3},
                        {buffering_proxy,mainloop,4}]}'

=INFO REPORT==== 7-Jul-2009::14:03:14 ===
closing TCP connection <0.6457.2> from 127.0.0.1:55212

=ERROR REPORT==== 7-Jul-2009::14:03:14 ===
** Generic server <0.15508.1> terminating
** Last message in was {commit,{{1,<0.15636.1>},14828}}
** When Server state == {q,{amqqueue,{resource,<<"/">>,queue,<<"EmailCount">>},
                                     true,false,[],none},
                           none,none,false,4306,
                           {[],[]},
                           {[],[]}}
** Reason for termination ==
** {timeout,
       {gen_server,call,
           [rabbit_persister,
            {commit_transaction,
                {{{1,<0.15636.1>},14828},
                 {resource,<<"/">>,queue,<<"EmailCount">>}}}]}}

And then a few more dumps of queues that were _really_ huge.  They
appear to have every single message that was in each of the queues,
which I guess is what an erlang server state dump usually shows.  Not
all of my queues died, and neither of my largest queues died.  The
server was only using about 1GB of RAM when the queues started dieing,
so it shouldn't have been an out of memory condition.  It might have
been swapping though.  Could that cause the timeouts that then caused
the cascading process deaths?



From matthew at lshift.net  Tue Jul  7 20:42:51 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 7 Jul 2009 20:42:51 +0100
Subject: [rabbitmq-discuss] queue_disappeared?
In-Reply-To: <84fb38e30907071238m1421fac3l8c4fdf46592e2ff1@mail.gmail.com>
References: <84fb38e30907071212k71b5ec28s9df63718b067a6e9@mail.gmail.com>
	<84fb38e30907071238m1421fac3l8c4fdf46592e2ff1@mail.gmail.com>
Message-ID: <20090707194251.GA12213@wellquite.org>

On Tue, Jul 07, 2009 at 02:38:51PM -0500, tsuraan wrote:
> Ok, so that was the first thing that I saw  from reading the log from
> the bottom up.  Going from the top down is probably more useful.  The
> full(-ish) log of what happened is:
> 
> =ERROR REPORT==== 7-Jul-2009::14:03:12 ===
> ** Generic server <0.15604.1> terminating
> ** Last message in was {commit,{{1,<0.15636.1>},14828}}
> ** When Server state == {q,{amqqueue,
>                                {resource,<<"/">>,queue,<<"DocSearchEmails">>},
>                                true,false,[],none},
>                            none,none,true,3036,
>                            {[],[]},
>                            {[{<0.15729.1>,
>                               {consumer,
>                                   <<"amq.ctag-ONnWMrwJlReM+3ObdgstOA==">>,
>                                   true}}],
>                             []}}
> ** Reason for termination ==
> ** {timeout,
>        {gen_server,call,
>            [rabbit_persister,
>             {commit_transaction,
>                 {{{1,<0.15636.1>},14828},
>                  {resource,<<"/">>,queue,<<"DocSearchEmails">>}}}]}}

timeout just means your server was very heavily loaded. We solved this is a
later release. Either use the latest 1.5 (1.5.5?) or 1.6.

Matthew



From tsuraan at gmail.com  Tue Jul  7 20:46:34 2009
From: tsuraan at gmail.com (tsuraan)
Date: Tue, 7 Jul 2009 14:46:34 -0500
Subject: [rabbitmq-discuss] queue_disappeared?
In-Reply-To: <20090707194251.GA12213@wellquite.org>
References: <84fb38e30907071212k71b5ec28s9df63718b067a6e9@mail.gmail.com>
	<84fb38e30907071238m1421fac3l8c4fdf46592e2ff1@mail.gmail.com>
	<20090707194251.GA12213@wellquite.org>
Message-ID: <84fb38e30907071246ge7804c9x19fbb99ac4e75aa6@mail.gmail.com>

> timeout just means your server was very heavily loaded. We solved this is a
> later release. Either use the latest 1.5 (1.5.5?) or 1.6.
>
> Matthew

Ok, I'll be testing out 1.6.0 for a while then.  Will there be a
"stable" (non-beta) 1.6.x release, or is 1.7 the stable target?



From dln at eintr.org  Tue Jul  7 21:39:36 2009
From: dln at eintr.org (Daniel Lundin)
Date: Tue, 7 Jul 2009 22:39:36 +0200
Subject: [rabbitmq-discuss] Return message? [Was: Re: Sample code for
	python?]
In-Reply-To: <54064.80.37.183.27.1246995293.squirrel@webmail.sindominio.net>
References: <795548.16020.qm@web45601.mail.sp1.yahoo.com>
	<d272f0690906301457k1028d2b5t160d5b60bc201209@mail.gmail.com> 
	<558122.16141.qm@web45608.mail.sp1.yahoo.com>
	<d272f0690907021151k9b581a9w61803baa37092398@mail.gmail.com> 
	<825108.73047.qm@web45604.mail.sp1.yahoo.com>
	<32861.80.37.183.27.1246994458.squirrel@webmail.sindominio.net>
	<54064.80.37.183.27.1246995293.squirrel@webmail.sindominio.net>
Message-ID: <185945640907071339v9b4faa3vbc9a25cc2523d158@mail.gmail.com>

> I forgot Google Protocol Buffers, I know it's being used together with AMQP.
> However, in our benchmarks, GPB in Python is at least 60 times slower than
> Thrift and cjson.

Protobufs are great if for no other reason the excellent docs, but
like you mentioned the python implementation is suffering because
there's only a pure-python implementation (which makes sense for
appengine). And often it's decent enough for tiny-to-small objects.

We've benched pb vs thrift as well, and decided to go with thrift
because of improved python performance. The extra features are pretty
handy too though. :)

For simplicity in messaging, it's hard to beat JSON though. It works,
everywhere and in all languages with minimum fuss. If you don't need
strict typing / protocols, it's all good.

/d



From matthew at lshift.net  Tue Jul  7 22:43:59 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 7 Jul 2009 22:43:59 +0100
Subject: [rabbitmq-discuss] queue_disappeared?
In-Reply-To: <84fb38e30907071246ge7804c9x19fbb99ac4e75aa6@mail.gmail.com>
References: <84fb38e30907071212k71b5ec28s9df63718b067a6e9@mail.gmail.com>
	<84fb38e30907071238m1421fac3l8c4fdf46592e2ff1@mail.gmail.com>
	<20090707194251.GA12213@wellquite.org>
	<84fb38e30907071246ge7804c9x19fbb99ac4e75aa6@mail.gmail.com>
Message-ID: <20090707214358.GB12213@wellquite.org>

On Tue, Jul 07, 2009 at 02:46:34PM -0500, tsuraan wrote:
> > timeout just means your server was very heavily loaded. We solved this is a
> > later release. Either use the latest 1.5 (1.5.5?) or 1.6.
> 
> Ok, I'll be testing out 1.6.0 for a while then.  Will there be a
> "stable" (non-beta) 1.6.x release, or is 1.7 the stable target?

As bugs are found in 1.6.0, they will be fixed, and point releases
made. 1.7.0 will certainly not be marked "final" in the way that
1.5.5 was. But all of the fixes incorporated into 1.5.5 are in 1.6
so the source of new bugs will (normally) be new code. All of which
is a very long winded way of saying "we don't know". It depends on
bugs being found in 1.6.0, and how fast work gets finished for 1.7.

About the only thing useful I can tell you is that currently there
is one bug open for 1.6.0 which I opened myself and is more to do
with me moaning than with anything that's likely to affect people
using Rabbit in the wild! - i.e. we are not sitting on a massive
stack of open bugs for 1.6.0 - unless people have not been telling
us about bugs, it appears to be no less stable than 1.5.5.

I hope that's of some use.

Matthew



From brownspice at gmail.com  Wed Jul  8 15:30:20 2009
From: brownspice at gmail.com (Amit Bhatnagar)
Date: Wed, 8 Jul 2009 08:30:20 -0600
Subject: [rabbitmq-discuss] RabbitMQ 1.6.0 absence in Maven Central Repo
Message-ID: <5c32ef890907080730o4d42efd1j25c4112e828e8b22@mail.gmail.com>

Given 1.6.0's release on June 17th, shouldn't we see it in the Maven central
repository by now? I know we are to expect a couple of weeks lag between the
release and it's appearance in the repo, but I would have thought we should
see this by now(?)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090708/0abfd197/attachment.htm 

From ewaters at gmail.com  Wed Jul  8 17:13:39 2009
From: ewaters at gmail.com (Eric Waters)
Date: Wed, 8 Jul 2009 10:13:39 -0600
Subject: [rabbitmq-discuss] Net::AMQP perl module work in progress
Message-ID: <353587920907080913y73e5f147me4c80f776beba50c@mail.gmail.com>

Hello!  I thought I'd mention here that I'm currently working on a
Net::AMQP protocol module and POE::Component::Client::AMQP client
module.  I'll publish it to CPAN as soon as it's in a relatively
feature complete state (probably in a week) and if appropriate, I'll
mention it here too.  I'm designing it against RabbitMQ, as that's
probably going to be our production AMQP server for the project this
is needed for.

Darien Kindlund mentioned on this list in the past that he was working
on a Net::AMQP, as has Eric Rybski on PAUSE, but both of these appear
to not have resulted in any code.  Please let me know if I'm being
presumptuous with my intent.

Eric Waters
http://search.cpan.org/~ewaters/



From juhani at juranki.com  Wed Jul  8 17:31:00 2009
From: juhani at juranki.com (=?ISO-8859-1?Q?Juhani_R=E4nkimies?=)
Date: Wed, 8 Jul 2009 19:31:00 +0300
Subject: [rabbitmq-discuss] twiddling with rabbitmq-http2 on windows
Message-ID: <e55356640907080930i3293b2b8h5ab4052170f632cf@mail.gmail.com>

Hi,

After some exploration I got rabbitmq-http2 to work on Windows XP.
This is roughly what I did (countless dead ends omitted):

1) compile rabbitmq-http2 and erlang-rfc4627 using make module
(attached EMakefile has also instructions for erlang-client, you
should delete or comment them)
2) create folder ...\rabbitmq-http2-default\server_root\logs
3) in ...\rabbitmq-http2-default\server_root\logs\ copy http.conf.in
to http.conf and replace @SERVER_ROOT@ with real path (forward
slashes)
4) create script that sets RABBITMQ_SERVER_START_ARGS and calls
rabbitmq-server.bat (the attached run.bat, check the paths)
5) run.bat

The examples work with recent versions of Chrome, Safari and Firefox.

But when I enable firebug, Firefox starts to behave strangely.

Sometimes messages are received only in combination with send.
Sometimes only sending works.
And then sending stops to work and errors are printed on page

JsonRPC error:
Service: "/rpc/38E41B75EEED17CDDC28D8CAA0CC1EF8"
Method: "cast"
Params: ["basic.publish",[1,"canvasPainter","",false,false],"{\"event\":\"drawAction\",\"args\":{\"startPos\":{\"x\":89,\"y\":175},\"curPos\":{\"x\":92,\"y\":241},\"drawColor\":\"rgb(0,0,0)\",\"lineWidth\":10,\"actionNumber\":2}}",[null,null,null,null,null,null,null,null,null,null,null,null,null,null]]
Response: {"version":"1.1","id":46,"error":{"name":"JSONRPCError","code":404,"message":"Service
not found","error":"38E41B75EEED17CDDC28D8CAA0CC1EF8"}}

If I disable FB console and net tabs, and refresh, messages flow again.
And continue to do so even if console and net are enabled again.

There are no error messages on FB console.

br,
-juhani
-------------- next part --------------
set SRC=C:\src\rabbit
set SERVER_ROOT=c:/src/rabbit/rabbitmq-http2-default/server_root
set ERL_HOME=c:\Program Files\erl5.6.1
set RABBIT_SBIN=%ERL_HOME%\lib\rabbitmq_server-1.6.0\sbin

set JSON=%SRC%\erlang-rfc4627-default\ebin
set CLIENT=%SRC%\rabbitmq-erlang-client-default\ebin
set HTTP2=%SRC%\rabbitmq-http2-default\ebin

set PATHS=-pa %JSON% -pa %HTTP2% 
rem -pa %CLIENT% 

set RABBITMQ_SERVER_START_ARGS= %PATHS% ^
-rabbit rabbit_http_conf \""%SERVER_ROOT%/conf/httpd.conf"\" ^
extra_startup_steps [{\"HTTP-JSON-listeners\",rabbit_http,kickstart,[]}]

"%RABBIT_SBIN%\rabbitmq-server.bat"
-------------- next part --------------
A non-text attachment was scrubbed...
Name: EMakefile
Type: application/octet-stream
Size: 556 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090708/8203c331/attachment.obj 

From darien at kindlund.com  Wed Jul  8 17:36:05 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Wed, 8 Jul 2009 12:36:05 -0400
Subject: [rabbitmq-discuss] Net::AMQP perl module work in progress
In-Reply-To: <353587920907080913y73e5f147me4c80f776beba50c@mail.gmail.com>
References: <353587920907080913y73e5f147me4c80f776beba50c@mail.gmail.com>
Message-ID: <AB74DF43-147E-4CCD-8350-90EF6BC2C9E0@kindlund.com>

Hi Eric,

Go ahead, as I would certainly help beta test the implementation. I  
tried contacting Eric Rybski about his implementation, but I got no  
response.

You may need to contact the CPAN PAUSE folks in order to publish that  
code in the Net::AMQP namespace.

Regards,
-- Darien

On Jul 8, 2009, at 12:13 PM, Eric Waters <ewaters at gmail.com> wrote:

> Hello!  I thought I'd mention here that I'm currently working on a
> Net::AMQP protocol module and POE::Component::Client::AMQP client
> module.  I'll publish it to CPAN as soon as it's in a relatively
> feature complete state (probably in a week) and if appropriate, I'll
> mention it here too.  I'm designing it against RabbitMQ, as that's
> probably going to be our production AMQP server for the project this
> is needed for.
>
> Darien Kindlund mentioned on this list in the past that he was working
> on a Net::AMQP, as has Eric Rybski on PAUSE, but both of these appear
> to not have resulted in any code.  Please let me know if I'm being
> presumptuous with my intent.
>
> Eric Waters
> http://search.cpan.org/~ewaters/
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From lvh at laurensvh.be  Wed Jul  8 17:57:55 2009
From: lvh at laurensvh.be (Laurens Van Houtven)
Date: Wed, 8 Jul 2009 18:57:55 +0200
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
Message-ID: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi :-)


I'm wondering about encryption and authentication within AMQP (using RabbitMQ).

I'm porting existing code that did not have a messaging component.
This code used per-client (in AMQP these would be producers)
pre-shared certificates to do authentication. The problem in porting
it (as I see it at least), is that with RabbitMQ+stunnel, the servers
(= AMQP consumers) never get to see the SSL'ed data coming from the
clients, so they cannot see the client certificate, so I can't use it
to do authentication.

I'm trying to find a solution to this problem. I'd like to keep using
SSL, but just using SSL with pre-shared certificates only guarantees
my consumers that the producer is *a* known user -- my consumers don't
know *who* the producer is. For example, given two registered users
(with pre shared SSL certs) Alice and Mallory (the latter being up to
no good), I want to prevent that Mallory logs in with his SSL cert and
his username, but then pretends to be Alice in the actual message
contents.

I'm not yet intricately familiar with the way RabbitMQ ACL's work, but
I think that it could be solved by using SSL (with stunnel), together
with a username and a password, and then have one vhost per user and
per consumer role. I'm not entirely sure how well RabbitMQ is designed
to scale as the number of vhosts increase, since this would result in
N*M queues (with M the number of services and N the number of uesrs).
Also, I think this means I also need one queue per user and per
service, since otherwise my consumers still don't know anything about
the user identity. I think this (unfortunately) means that my
consumers will need to be reconfigured every time a new user is added,
which obviously sucks pretty bad.

Am I better off putting authentication in my message contents?

Thanks in advance
Laurens
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.9 (GNU/Linux)
Comment: Use GnuPG with Firefox : http://getfiregpg.org (Version: 0.7.6)

iEYEARECAAYFAkpUz+4ACgkQT5v5zGkvKT7VjQCfRxz/PD00FieuaEhQ3aAsjOFB
zyYAoLwdWb8pd34zaHCldzGUFnrD70yh
=wttN
-----END PGP SIGNATURE-----



From darien at kindlund.com  Wed Jul  8 18:04:17 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Wed, 8 Jul 2009 13:04:17 -0400
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
In-Reply-To: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com>
References: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com>
Message-ID: <50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com>

Hi Laurens,

I'm not an OpenSSL nor RabbitMQ expert, but I got the impression that
stunnel (which uses OpenSSL) somehow populates certificate information
after the connection is established via environment variables.  See
this URL for more information about the types of environment variables
available:
http://httpd.apache.org/docs/2.2/mod/mod_ssl.html

Again, I'm not sure if 'mod_ssl' had to do anything with OpenSSL in
order to expose these variables to apache, but I'm guessing it _can_
be done with stunnel.

Hope this helps,
-- Darien

On Wed, Jul 8, 2009 at 12:57 PM, Laurens Van Houtven<lvh at laurensvh.be> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hi :-)
>
>
> I'm wondering about encryption and authentication within AMQP (using RabbitMQ).
>
> I'm porting existing code that did not have a messaging component.
> This code used per-client (in AMQP these would be producers)
> pre-shared certificates to do authentication. The problem in porting
> it (as I see it at least), is that with RabbitMQ+stunnel, the servers
> (= AMQP consumers) never get to see the SSL'ed data coming from the
> clients, so they cannot see the client certificate, so I can't use it
> to do authentication.
>
> I'm trying to find a solution to this problem. I'd like to keep using
> SSL, but just using SSL with pre-shared certificates only guarantees
> my consumers that the producer is *a* known user -- my consumers don't
> know *who* the producer is. For example, given two registered users
> (with pre shared SSL certs) Alice and Mallory (the latter being up to
> no good), I want to prevent that Mallory logs in with his SSL cert and
> his username, but then pretends to be Alice in the actual message
> contents.
>
> I'm not yet intricately familiar with the way RabbitMQ ACL's work, but
> I think that it could be solved by using SSL (with stunnel), together
> with a username and a password, and then have one vhost per user and
> per consumer role. I'm not entirely sure how well RabbitMQ is designed
> to scale as the number of vhosts increase, since this would result in
> N*M queues (with M the number of services and N the number of uesrs).
> Also, I think this means I also need one queue per user and per
> service, since otherwise my consumers still don't know anything about
> the user identity. I think this (unfortunately) means that my
> consumers will need to be reconfigured every time a new user is added,
> which obviously sucks pretty bad.
>
> Am I better off putting authentication in my message contents?
>
> Thanks in advance
> Laurens
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.9 (GNU/Linux)
> Comment: Use GnuPG with Firefox : http://getfiregpg.org (Version: 0.7.6)
>
> iEYEARECAAYFAkpUz+4ACgkQT5v5zGkvKT7VjQCfRxz/PD00FieuaEhQ3aAsjOFB
> zyYAoLwdWb8pd34zaHCldzGUFnrD70yh
> =wttN
> -----END PGP SIGNATURE-----
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From eric at grokthis.net  Wed Jul  8 19:26:40 2009
From: eric at grokthis.net (eric)
Date: Wed, 08 Jul 2009 14:26:40 -0400
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
In-Reply-To: <50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com>
References: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com>
	<50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com>
Message-ID: <1247077600.26930.50.camel@eric-desktop.grokthis.net>

On Wed, 2009-07-08 at 13:04 -0400, Darien Kindlund wrote:
> Hi Laurens,
> 
> I'm not an OpenSSL nor RabbitMQ expert, but I got the impression that
> stunnel (which uses OpenSSL) somehow populates certificate information
> after the connection is established via environment variables.  See
> this URL for more information about the types of environment variables
> available:

This isn't how stunnel works, it creates simple SSL server and client
wrappers/proxies.  Stunnel doesn't need to know anything about the
application-layer protocols it encapsulates, doesn't need environmental
variables, LD_PRELOAD, or any other funny magic.  For these reasons,
stunnel is a pretty good fit for Rabbit, where encryption is needed.

How it works is quite simple, really. It sends and receives clear-text
on one side (i.e. a local RabbitMQ), and encrypted communications on the
other (i.e. the internet).  This is what allows applications that work
purely with clear-text such as Rabbit, to communicate securely via
stunnel.

The server side is relatively simple to set up, because aside from the
extra process running, it requires no changes to the server daemon
process.  You can simply set up a proxy for the AMQP port and walk away.

The client side, however, will need either SSL support in the client's
AMQP library, or will need to connect to a local stunnel instance to
provide a reverse SSL proxy.  That is, your client application can speak
clear-text to the local stunnel, this stunnel will speak SSL to the
remote stunnel (which, in turn, speaks clear-text to RabbitMQ).  Its
very clear that SSL support in the client's AMQP library is preferable.

-- 
Regards,
Eric Windisch




From darien at kindlund.com  Wed Jul  8 19:55:11 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Wed, 8 Jul 2009 14:55:11 -0400
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
In-Reply-To: <1247077600.26930.50.camel@eric-desktop.grokthis.net>
References: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com> 
	<50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com> 
	<1247077600.26930.50.camel@eric-desktop.grokthis.net>
Message-ID: <50c8ffe90907081155l2bbd603as8cc9a707fe7a1d08@mail.gmail.com>

Hi Eric,
Thanks for the clarification.  So what you're saying is: "If you need
to access these environment variables, don't use stunnel and just have
your client application talk to OpenSSL directly."
-- Darien

On Wed, Jul 8, 2009 at 2:26 PM, eric<eric at grokthis.net> wrote:
> On Wed, 2009-07-08 at 13:04 -0400, Darien Kindlund wrote:
>> Hi Laurens,
>>
>> I'm not an OpenSSL nor RabbitMQ expert, but I got the impression that
>> stunnel (which uses OpenSSL) somehow populates certificate information
>> after the connection is established via environment variables. ?See
>> this URL for more information about the types of environment variables
>> available:
>
> This isn't how stunnel works, it creates simple SSL server and client
> wrappers/proxies. ?Stunnel doesn't need to know anything about the
> application-layer protocols it encapsulates, doesn't need environmental
> variables, LD_PRELOAD, or any other funny magic. ?For these reasons,
> stunnel is a pretty good fit for Rabbit, where encryption is needed.
>
> How it works is quite simple, really. It sends and receives clear-text
> on one side (i.e. a local RabbitMQ), and encrypted communications on the
> other (i.e. the internet). ?This is what allows applications that work
> purely with clear-text such as Rabbit, to communicate securely via
> stunnel.
>
> The server side is relatively simple to set up, because aside from the
> extra process running, it requires no changes to the server daemon
> process. ?You can simply set up a proxy for the AMQP port and walk away.
>
> The client side, however, will need either SSL support in the client's
> AMQP library, or will need to connect to a local stunnel instance to
> provide a reverse SSL proxy. ?That is, your client application can speak
> clear-text to the local stunnel, this stunnel will speak SSL to the
> remote stunnel (which, in turn, speaks clear-text to RabbitMQ). ?Its
> very clear that SSL support in the client's AMQP library is preferable.
>
> --
> Regards,
> Eric Windisch
>
>



From eric at grokthis.net  Wed Jul  8 20:29:52 2009
From: eric at grokthis.net (eric)
Date: Wed, 08 Jul 2009 15:29:52 -0400
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
In-Reply-To: <50c8ffe90907081155l2bbd603as8cc9a707fe7a1d08@mail.gmail.com>
References: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com>
	<50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com>
	<1247077600.26930.50.camel@eric-desktop.grokthis.net>
	<50c8ffe90907081155l2bbd603as8cc9a707fe7a1d08@mail.gmail.com>
Message-ID: <1247081392.26930.86.camel@eric-desktop.grokthis.net>

One, hopefully final, thought is that in all of these scenarios, we are
not discussing the security of clustered Rabbit configurations and
encryption between brokers.   This is also something that the RabbitMQ
FAQ fails to address in its coverage "Channel Encryption", which it
otherwise addresses very well.

For now, I'd say to put all of the RabbitMQ brokers on a secure network
for intercommunication.  If not, in *addition* to using SSL, you should
encrypt the messages as well.  Presumably, you could also wrap the OTP
communication in stunnel, but that would be a bit more complex to
implement.

-- 
Regards,
Eric Windisch




From eric at grokthis.net  Wed Jul  8 20:19:10 2009
From: eric at grokthis.net (eric)
Date: Wed, 08 Jul 2009 15:19:10 -0400
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
In-Reply-To: <50c8ffe90907081155l2bbd603as8cc9a707fe7a1d08@mail.gmail.com>
References: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com>
	<50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com>
	<1247077600.26930.50.camel@eric-desktop.grokthis.net>
	<50c8ffe90907081155l2bbd603as8cc9a707fe7a1d08@mail.gmail.com>
Message-ID: <1247080750.26930.75.camel@eric-desktop.grokthis.net>

On Wed, 2009-07-08 at 14:55 -0400, Darien Kindlund wrote:
> Thanks for the clarification.  So what you're saying is: "If you need
> to access these environment variables, don't use stunnel and just have
> your client application talk to OpenSSL directly."

There are a few use-cases to consider here.

First, is the use-case where you simply want encryption and don't care
about knowing how it is done.  That is easy, you can just use stunnel
directly on both ends.  This is encryption pure and simple, without any
AAA.

Second, you have a case where you simply want to your consumer or
publisher to know basic details such as the server's DN, the cipher
used, etc.  In that case, the server can use stunnel and then the
client's AMQP library must understand SSL.  This provides, at a minimum,
verification of the server's identity to the clients (otherwise, someone
could install a rogue stunnel proxy and you'd never know!)

Third, there are certainly use-cases where a publisher speaks SSL with a
client-certificate, and the consuming client wants to know where the
message came from, which client published the message.  This is
impossible without modifications to RabbitMQ itself and, more
importantly, as I understand it, the AMQP protocol.

For use-case #3, your best bet is to implement the solution to the
second use-case and then having the contents of your messages signed.
This is how e-mail is done currently, and it works reasonably well.

Before anyone publicly suggests mentions DTLS or SCTP, they only solve
the transport issues and do not solve any AAA issues for Rabbit.

-- 
Regards,
Eric Windisch




From darien at kindlund.com  Wed Jul  8 20:45:51 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Wed, 8 Jul 2009 15:45:51 -0400
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
In-Reply-To: <1247080750.26930.75.camel@eric-desktop.grokthis.net>
References: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com> 
	<50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com> 
	<1247077600.26930.50.camel@eric-desktop.grokthis.net>
	<50c8ffe90907081155l2bbd603as8cc9a707fe7a1d08@mail.gmail.com> 
	<1247080750.26930.75.camel@eric-desktop.grokthis.net>
Message-ID: <50c8ffe90907081245u7b398e58l8f18f29b5e123b87@mail.gmail.com>

Okay, I think Laurens original issue was that she wanted RabbitMQ to
verify SSL connections -- not individual messages... with the idea of
different client certificates being allowed access to different
vhosts.

So, based on this, there's no need to have consumers verify
signed/encrypted messages ... since the logic of comparing credentials
per vhost is more suited on the RabbitMQ server than pushing that
verification to each consumer.  I agree that if you're looking for
end-to-end security, signing/encrypting/verifying messages certainly
prevents any consumers from handling untrusted data.  However, having
only this signing/encrypting/verifying capability at the end points
(producer/consumer) and doing nothing on RabbitMQ does not address the
issue of dealing with an _untrusted_ producer from shoving malformed
messages onto RabbitMQ -- although these messages would eventually be
discarded by the consumer, it could still end up being a
denial-of-service (DoS) condition.

> Second, you have a case where you simply want to your consumer or
> publisher to know basic details such as the server's DN, the cipher
> used, etc.  In that case, the server can use stunnel and then the
> client's AMQP library must understand SSL.  This provides, at a minimum,
> verification of the server's identity to the clients (otherwise, someone
> could install a rogue stunnel proxy and you'd never know!)

I think this is closer (but not exactly) what Laurens was looking for.
 Specifically, the RabbitMQ server needs to verify the CLIENT's
certificate credentials (not any server certs) -- specifically (I'm
guessing) verifying the client's certificate is valid and that its
path is valid (which stunnel can already do for you, given a valid set
of CA certificates to use).  But also, look at the client
certificate's DN and depending on what the DN matches... allow or deny
access to the corresponding vhost channel.

After thinking about it further, yes, this capability would definitely
require modifying the RabbitMQ server's source code... the trick is
whether or not stunnel exposes the client certificate's DN as an
environment variable which can then be used inside of the Erlang code.
 If that's not possible, then Lauren would have to not use stunnel and
simply develop a new wrapper which talks directly to the OpenSSL
libraries.

-- Darien

On Wed, Jul 8, 2009 at 3:19 PM, eric<eric at grokthis.net> wrote:
> On Wed, 2009-07-08 at 14:55 -0400, Darien Kindlund wrote:
>> Thanks for the clarification. ?So what you're saying is: "If you need
>> to access these environment variables, don't use stunnel and just have
>> your client application talk to OpenSSL directly."
>
> There are a few use-cases to consider here.
>
> First, is the use-case where you simply want encryption and don't care
> about knowing how it is done. ?That is easy, you can just use stunnel
> directly on both ends. ?This is encryption pure and simple, without any
> AAA.
>
> Second, you have a case where you simply want to your consumer or
> publisher to know basic details such as the server's DN, the cipher
> used, etc. ?In that case, the server can use stunnel and then the
> client's AMQP library must understand SSL. ?This provides, at a minimum,
> verification of the server's identity to the clients (otherwise, someone
> could install a rogue stunnel proxy and you'd never know!)
>
> Third, there are certainly use-cases where a publisher speaks SSL with a
> client-certificate, and the consuming client wants to know where the
> message came from, which client published the message. ?This is
> impossible without modifications to RabbitMQ itself and, more
> importantly, as I understand it, the AMQP protocol.
>
> For use-case #3, your best bet is to implement the solution to the
> second use-case and then having the contents of your messages signed.
> This is how e-mail is done currently, and it works reasonably well.
>
> Before anyone publicly suggests mentions DTLS or SCTP, they only solve
> the transport issues and do not solve any AAA issues for Rabbit.
>
> --
> Regards,
> Eric Windisch
>
>



From eric at grokthis.net  Wed Jul  8 21:09:56 2009
From: eric at grokthis.net (eric)
Date: Wed, 08 Jul 2009 16:09:56 -0400
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
In-Reply-To: <50c8ffe90907081245u7b398e58l8f18f29b5e123b87@mail.gmail.com>
References: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com>
	<50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com>
	<1247077600.26930.50.camel@eric-desktop.grokthis.net>
	<50c8ffe90907081155l2bbd603as8cc9a707fe7a1d08@mail.gmail.com>
	<1247080750.26930.75.camel@eric-desktop.grokthis.net>
	<50c8ffe90907081245u7b398e58l8f18f29b5e123b87@mail.gmail.com>
Message-ID: <1247083796.26930.104.camel@eric-desktop.grokthis.net>


> After thinking about it further, yes, this capability would definitely
> require modifying the RabbitMQ server's source code... the trick is
> whether or not stunnel exposes the client certificate's DN as an
> environment variable which can then be used inside of the Erlang code.
>  If that's not possible, then Lauren would have to not use stunnel and
> simply develop a new wrapper which talks directly to the OpenSSL
> libraries.

Then, to do what Lauren wants requires SASL/EXTERNAL.  While related, it
is a much different question.  This same mechanism would be how one
would support LDAP and other authentication mechanisms.

I don't know how complete the SASL implementation used by Rabbit is, or
what that implementation is.

Pardon me for, uh, not reading the original post ;-)

-- 
Regards,
Eric Windisch




From alexis.richardson at gmail.com  Wed Jul  8 23:03:32 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 8 Jul 2009 23:03:32 +0100
Subject: [rabbitmq-discuss] Net::AMQP perl module work in progress
In-Reply-To: <AB74DF43-147E-4CCD-8350-90EF6BC2C9E0@kindlund.com>
References: <353587920907080913y73e5f147me4c80f776beba50c@mail.gmail.com>
	<AB74DF43-147E-4CCD-8350-90EF6BC2C9E0@kindlund.com>
Message-ID: <167204d20907081503t7c968bcanaf4e6c08cd6e338d@mail.gmail.com>

Very cool.  This is really great to see.

Concurrently, this may be of interest to perl hackers:
http://github.com/norbu09/Net_RabbitMQ_HTTP/tree/master

alexis


On Wed, Jul 8, 2009 at 5:36 PM, Darien Kindlund<darien at kindlund.com> wrote:
> Hi Eric,
>
> Go ahead, as I would certainly help beta test the implementation. I
> tried contacting Eric Rybski about his implementation, but I got no
> response.
>
> You may need to contact the CPAN PAUSE folks in order to publish that
> code in the Net::AMQP namespace.
>
> Regards,
> -- Darien
>
> On Jul 8, 2009, at 12:13 PM, Eric Waters <ewaters at gmail.com> wrote:
>
>> Hello! ?I thought I'd mention here that I'm currently working on a
>> Net::AMQP protocol module and POE::Component::Client::AMQP client
>> module. ?I'll publish it to CPAN as soon as it's in a relatively
>> feature complete state (probably in a week) and if appropriate, I'll
>> mention it here too. ?I'm designing it against RabbitMQ, as that's
>> probably going to be our production AMQP server for the project this
>> is needed for.
>>
>> Darien Kindlund mentioned on this list in the past that he was working
>> on a Net::AMQP, as has Eric Rybski on PAUSE, but both of these appear
>> to not have resulted in any code. ?Please let me know if I'm being
>> presumptuous with my intent.
>>
>> Eric Waters
>> http://search.cpan.org/~ewaters/
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From alexis.richardson at gmail.com  Wed Jul  8 23:09:53 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 8 Jul 2009 23:09:53 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.6.0 absence in Maven Central Repo
In-Reply-To: <5c32ef890907080730o4d42efd1j25c4112e828e8b22@mail.gmail.com>
References: <5c32ef890907080730o4d42efd1j25c4112e828e8b22@mail.gmail.com>
Message-ID: <167204d20907081509o13293f4dp4b9a6ef6e62a1bf7@mail.gmail.com>

Amit,

Understood.

You are very welcome to help.  It's important to the success of
RabbitMQ but one of the things that is neither automated nor able to
divert resources from, e.g., paging to disk.  Let me know if you want
an intro to the guy who very helpfully mavenised 1.5.x

alexis


On Wed, Jul 8, 2009 at 3:30 PM, Amit Bhatnagar<brownspice at gmail.com> wrote:
> Given 1.6.0's release on June 17th, shouldn't we see it in the Maven central
> repository by now? I know we are to expect a couple of weeks lag between the
> release and it's appearance in the repo, but I would have thought we should
> see this by now(?)
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From norbu09 at googlemail.com  Wed Jul  8 23:23:29 2009
From: norbu09 at googlemail.com (lenz)
Date: Thu, 9 Jul 2009 10:23:29 +1200
Subject: [rabbitmq-discuss] Net::AMQP perl module work in progress
In-Reply-To: <167204d20907081503t7c968bcanaf4e6c08cd6e338d@mail.gmail.com>
References: <353587920907080913y73e5f147me4c80f776beba50c@mail.gmail.com>
	<AB74DF43-147E-4CCD-8350-90EF6BC2C9E0@kindlund.com>
	<167204d20907081503t7c968bcanaf4e6c08cd6e338d@mail.gmail.com>
Message-ID: <e25246b60907081523j1e09ce64x27c1dd4689d37ec8@mail.gmail.com>

yeah ... finally this one gets done :-)
i
am happy helping out testing and debugging - is there a public
repository for it?

if someone still cares i just wrote a basic rabbitmq interface via the
http/json adapter for rabbitmq. not in cpan yet but on github:
http://github.com/norbu09/Net_RabbitMQ_HTTP/tree/master
(thanks alexis for mentioning it)

cheers
lenz

(nice to see this one finally going somewhere)

On Thu, Jul 9, 2009 at 10:03 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Very cool.  This is really great to see.
>
> Concurrently, this may be of interest to perl hackers:
> http://github.com/norbu09/Net_RabbitMQ_HTTP/tree/master
>
> alexis
>
>
> On Wed, Jul 8, 2009 at 5:36 PM, Darien Kindlund<darien at kindlund.com>
> wrote:
> > Hi Eric,
> >
> > Go ahead, as I would certainly help beta test the implementation. I
> > tried contacting Eric Rybski about his implementation, but I got no
> > response.
> >
> > You may need to contact the CPAN PAUSE folks in order to publish that
> > code in the Net::AMQP namespace.
> >
> > Regards,
> > -- Darien
> >
> > On Jul 8, 2009, at 12:13 PM, Eric Waters <ewaters at gmail.com> wrote:
> >
> >> Hello!  I thought I'd mention here that I'm currently working on a
> >> Net::AMQP protocol module and POE::Component::Client::AMQP client
> >> module.  I'll publish it to CPAN as soon as it's in a relatively
> >> feature complete state (probably in a week) and if appropriate, I'll
> >> mention it here too.  I'm designing it against RabbitMQ, as that's
> >> probably going to be our production AMQP server for the project this
> >> is needed for.
> >>
> >> Darien Kindlund mentioned on this list in the past that he was working
> >> on a Net::AMQP, as has Eric Rybski on PAUSE, but both of these appear
> >> to not have resulted in any code.  Please let me know if I'm being
> >> presumptuous with my intent.
> >>
> >> Eric Waters
> >> http://search.cpan.org/~ewaters/
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



-- 
iWantMyName.com
painless domain registration (finally)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090709/336bc491/attachment.htm 

From lars at worldlingo.com  Fri Jul 10 11:32:03 2009
From: lars at worldlingo.com (Lars George)
Date: Fri, 10 Jul 2009 12:32:03 +0200
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
Message-ID: <4A5718A3.9000807@worldlingo.com>

Hi,

I would like to use a blocking provider, but the QueueingConsumer is 
somewhat limiting as it receives whatever the queue sends and caches it 
locally, in the app servers memory. If that is a very large number then 
you can quickly run out of memory and kill the Java process with an OOME.

Is there a way to implement a Consumer that say only receives N queue 
items before it waits until they get processed locally? I mean from the 
internal BlockingQueue and using handleDelivery() this is doable but 
then you would block the main loop in the AMPQ connection - and miss 
heart beats etc.?

Is there a better way with this or do I have to go with a dumb while 
(true) { channel.basicGet() } loop. With that you have the issue to 
somehow gracefully handle the null delivery and not create a loop that 
consumes all CPU cycles with no actual work being done.

Thanks,
Lars
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lars.vcf
Type: text/x-vcard
Size: 313 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090710/5ad8572c/attachment.vcf 

From tonyg at lshift.net  Fri Jul 10 12:24:31 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 10 Jul 2009 12:24:31 +0100
Subject: [rabbitmq-discuss] When is a rabbitmq-stomp 1.6.0 adapter
	coming?
In-Reply-To: <14f55850906271248p80399fcw7e50d46befe5017@mail.gmail.com>
References: <14f55850906271248p80399fcw7e50d46befe5017@mail.gmail.com>
Message-ID: <4A5724EF.8060903@lshift.net>

Hi Ivan (and others who've asked about this),

I've just tagged rabbitmq_v1_6_0 of rabbitmq-stomp, so you should be 
able to get things running with:


(1) Retrieve and build RabbitMQ server v1.6.0

   wget 
http://www.rabbitmq.com/releases/rabbitmq-server/v1.6.0/rabbitmq-server-1.6.0.tar.gz
   tar -zxf rabbitmq-server-1.6.0.tar.gz
   make -C rabbitmq-server-1.6.0


(2) Retrieve and build the 1.6.0-compatible STOMP adapter

   wget http://hg.rabbitmq.com/rabbitmq-stomp/archive/rabbitmq_v1_6_0.tar.gz
   tar -zxf rabbitmq_v1_6_0.tar.gz
   make -C rabbitmq-stomp-rabbitmq_v1_6_0 
RABBIT_SERVER_SOURCE_ROOT=../rabbitmq-server-1.6.0 run


Sorry for the delay and the confusion!

Regards,
   Tony



Ivan Delchev wrote:
> Hi everyone,
> 
> I'm new to the list but I'm very fascinated by the features of
> RabbitMQ and plan to use it for a project of mine. For the purpose I
> would also require the rabbitmq-stomp adapter. I noticed that the
> current version of RabbitMQ is 1.6.0 but the latest tagged
> rabbitmq-stomp adapter is 1.5.5. When do you plan to release a 1.6
> rabbitmq-stomp adapter - I quite like the newly introduced access
> control features of RabbitMQ 1.6.0. Are there any recorded issues when
> using the new server with the older adapter?
> 
> Great job!
> 
> Regards,
> Ivan
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From brownspice at gmail.com  Fri Jul 10 15:23:57 2009
From: brownspice at gmail.com (amit bhatnagar)
Date: Fri, 10 Jul 2009 07:23:57 -0700 (PDT)
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <4A5718A3.9000807@worldlingo.com>
References: <4A5718A3.9000807@worldlingo.com>
Message-ID: <7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>

Check out Channel.BasicQos() and set a prefetch count.

Have a look here for a good description of the prefetch:
http://hopper.squarespace.com/blog/2009/1/26/work-distribution-in-rabbitmq.html

fta:

"This command allows a consumer to choose a prefetch window that
specifies the amount of unacknowledged messages it is prepared to
receive. By setting the prefetch count to a non-zero value, the broker
will not deliver any messages to the consumer that would breach that
limit. To move the window forwards, the consumer has to acknowledge
the receipt of a message (or a group of messages). By acknowledging a
message, the consumer gains credit in the broker which makes it
eligible to receive more messages. This credit-based flow control
allows the broker to distribute work proportional to the individual
processing ability of each worker, as opposed to a simple round robin
mechanism."


On Jul 10, 4:32?am, Lars George <l... at worldlingo.com> wrote:
> Hi,
>
> I would like to use a blocking provider, but the QueueingConsumer is
> somewhat limiting as it receives whatever the queue sends and caches it
> locally, in the app servers memory. If that is a very large number then
> you can quickly run out of memory and kill the Java process with an OOME.
>
> Is there a way to implement a Consumer that say only receives N queue
> items before it waits until they get processed locally? I mean from the
> internal BlockingQueue and using handleDelivery() this is doable but
> then you would block the main loop in the AMPQ connection - and miss
> heart beats etc.?
>
> Is there a better way with this or do I have to go with a dumb while
> (true) { channel.basicGet() } loop. With that you have the issue to
> somehow gracefully handle the null delivery and not create a loop that
> consumes all CPU cycles with no actual work being done.
>
> Thanks,
> Lars
>
> ?lars.vcf
> < 1KViewDownload
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From tammo.filusch at btc-ag.com  Fri Jul 10 15:31:17 2009
From: tammo.filusch at btc-ag.com (tammof)
Date: Fri, 10 Jul 2009 07:31:17 -0700 (PDT)
Subject: [rabbitmq-discuss]  Rmq WCF binding
Message-ID: <24428325.post@talk.nabble.com>


Hey there,

I recently implemented a client server architecture with the  rabbitmq wcf
binding that works like a charm.

The following question arises:

I need to contact the webservice from a system that is not capable of using
wcf. 

Is it somehow possible to feed the messages manually into the queue that is
binded to the webservice via the wcf-binding?

In other words:
I want to manually insert messages into the queue at the according message
broker so that they get delivered to the webservice.

Cheers,

Tammo
-- 
View this message in context: http://www.nabble.com/Rmq-WCF-binding-tp24428325p24428325.html
Sent from the RabbitMQ mailing list archive at Nabble.com.




From juhani at juranki.com  Fri Jul 10 17:25:11 2009
From: juhani at juranki.com (=?ISO-8859-1?Q?Juhani_R=E4nkimies?=)
Date: Fri, 10 Jul 2009 19:25:11 +0300
Subject: [rabbitmq-discuss] twiddling with rabbitmq-http2 on windows
In-Reply-To: <e55356640907080930i3293b2b8h5ab4052170f632cf@mail.gmail.com>
References: <e55356640907080930i3293b2b8h5ab4052170f632cf@mail.gmail.com>
Message-ID: <e55356640907100925y57a7b216w65f7f799f30cfff2@mail.gmail.com>

This bug is the cause of the problem with firefox/firebug:

http://www.nczonline.net/blog/2009/07/09/firefox-35firebug-xmlhttprequest-and-readystatechange-bug/

-juhani

On Wed, Jul 8, 2009 at 7:31 PM, Juhani R?nkimies<juhani at juranki.com> wrote:
>
> The examples work with recent versions of Chrome, Safari and Firefox.
>
> But when I enable firebug, Firefox starts to behave strangely.
>



From brownspice at gmail.com  Fri Jul 10 18:17:14 2009
From: brownspice at gmail.com (amit bhatnagar)
Date: Fri, 10 Jul 2009 10:17:14 -0700 (PDT)
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
References: <4A5718A3.9000807@worldlingo.com>
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
Message-ID: <8a623f4f-5a36-4ef2-b884-315cc4764fe4@f33g2000vbm.googlegroups.com>

Having said this, I am wondering if it makes sense to use a
QueueingConsumer on a channel that has a basicQos of 1? Would I be
safe to use a DefaultConsumer here instead?

On Jul 10, 8:23?am, amit bhatnagar <brownsp... at gmail.com> wrote:
> Check out Channel.BasicQos() and set a prefetch count.
>
> Have a look here for a good description of the prefetch:http://hopper.squarespace.com/blog/2009/1/26/work-distribution-in-rab...
>
> fta:
>
> "This command allows a consumer to choose a prefetch window that
> specifies the amount of unacknowledged messages it is prepared to
> receive. By setting the prefetch count to a non-zero value, the broker
> will not deliver any messages to the consumer that would breach that
> limit. To move the window forwards, the consumer has to acknowledge
> the receipt of a message (or a group of messages). By acknowledging a
> message, the consumer gains credit in the broker which makes it
> eligible to receive more messages. This credit-based flow control
> allows the broker to distribute work proportional to the individual
> processing ability of each worker, as opposed to a simple round robin
> mechanism."
>
> On Jul 10, 4:32?am, Lars George <l... at worldlingo.com> wrote:
>
>
>
> > Hi,
>
> > I would like to use a blocking provider, but the QueueingConsumer is
> > somewhat limiting as it receives whatever the queue sends and caches it
> > locally, in the app servers memory. If that is a very large number then
> > you can quickly run out of memory and kill the Java process with an OOME.
>
> > Is there a way to implement a Consumer that say only receives N queue
> > items before it waits until they get processed locally? I mean from the
> > internal BlockingQueue and using handleDelivery() this is doable but
> > then you would block the main loop in the AMPQ connection - and miss
> > heart beats etc.?
>
> > Is there a better way with this or do I have to go with a dumb while
> > (true) { channel.basicGet() } loop. With that you have the issue to
> > somehow gracefully handle the null delivery and not create a loop that
> > consumes all CPU cycles with no actual work being done.
>
> > Thanks,
> > Lars
>
> > ?lars.vcf
> > < 1KViewDownload
>
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From juhani at juranki.com  Fri Jul 10 20:17:34 2009
From: juhani at juranki.com (=?ISO-8859-1?Q?Juhani_R=E4nkimies?=)
Date: Fri, 10 Jul 2009 22:17:34 +0300
Subject: [rabbitmq-discuss] twiddling with rabbitmq-http2 on windows
In-Reply-To: <e55356640907100925y57a7b216w65f7f799f30cfff2@mail.gmail.com>
References: <e55356640907080930i3293b2b8h5ab4052170f632cf@mail.gmail.com>
	<e55356640907100925y57a7b216w65f7f799f30cfff2@mail.gmail.com>
Message-ID: <e55356640907101217i6dfe3c60g6940261335fa8f10@mail.gmail.com>

Here's a dirty workaround for this problem. This is NOT a solution.
Use only in your development env and if you absolutely need it, until
the bug gets fixed in FF/FB.

diff -r 7ab764d1ca27 server_root/htdocs/prototype-1.4.0.js
--- a/server_root/htdocs/prototype-1.4.0.js	Mon Feb 02 12:34:17 2009 +0000
+++ b/server_root/htdocs/prototype-1.4.0.js	Fri Jul 10 21:45:38 2009 +0300
@@ -641,8 +641,13 @@
         this.options.asynchronous);

       if (this.options.asynchronous) {
-        this.transport.onreadystatechange = this.onStateChange.bind(this);
-        setTimeout((function() {this.respondToReadyState(1)}).bind(this), 10);
+           if (/Firefox\/3.5/.test(navigator.userAgent)){
+               var xhr = this.transport;
+               xhr.onload = xhr.onerror = xhr.onabort =
this.onStateChange.bind(this);
+           } else {
+               this.transport.onreadystatechange =
this.onStateChange.bind(this);
+           }
+           setTimeout((function()
{this.respondToReadyState(1)}).bind(this), 10);
       }

       this.setRequestHeaders();




On Fri, Jul 10, 2009 at 7:25 PM, Juhani R?nkimies<juhani at juranki.com> wrote:
> This bug is the cause of the problem with firefox/firebug:
>
> http://www.nczonline.net/blog/2009/07/09/firefox-35firebug-xmlhttprequest-and-readystatechange-bug/
>
> -juhani
>
> On Wed, Jul 8, 2009 at 7:31 PM, Juhani R?nkimies<juhani at juranki.com> wrote:
>>
>> The examples work with recent versions of Chrome, Safari and Firefox.
>>
>> But when I enable firebug, Firefox starts to behave strangely.
>>
>



From lars at worldlingo.com  Fri Jul 10 21:36:09 2009
From: lars at worldlingo.com (Lars George)
Date: Fri, 10 Jul 2009 22:36:09 +0200
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <8a623f4f-5a36-4ef2-b884-315cc4764fe4@f33g2000vbm.googlegroups.com>
References: <4A5718A3.9000807@worldlingo.com>	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
	<8a623f4f-5a36-4ef2-b884-315cc4764fe4@f33g2000vbm.googlegroups.com>
Message-ID: <4A57A639.1050000@worldlingo.com>

Hi Amit,

Thanks for the answer. So this QoS is only in trunk of the Java client. 
I will have to check this out.

Using the DefaultConsumer means extending it anyways, right? As by 
default it does not do anything. Even setting QoS to 1 would mean you 
will have to enforce ack'ing the message or else the async process will 
keep sending the next one. So a simple single local Delivery bean 
instance could hold the current message.

Saves the queue part. But then you also have to lock on that instance 
for the blocking behavior, which the QueueingConsumer has build in.

Am I on the right track here?

Regards,
Lars

amit bhatnagar wrote:
> Having said this, I am wondering if it makes sense to use a
> QueueingConsumer on a channel that has a basicQos of 1? Would I be
> safe to use a DefaultConsumer here instead?
>
> On Jul 10, 8:23 am, amit bhatnagar <brownsp... at gmail.com> wrote:
>   
>> Check out Channel.BasicQos() and set a prefetch count.
>>
>> Have a look here for a good description of the prefetch:http://hopper.squarespace.com/blog/2009/1/26/work-distribution-in-rab...
>>
>> fta:
>>
>> "This command allows a consumer to choose a prefetch window that
>> specifies the amount of unacknowledged messages it is prepared to
>> receive. By setting the prefetch count to a non-zero value, the broker
>> will not deliver any messages to the consumer that would breach that
>> limit. To move the window forwards, the consumer has to acknowledge
>> the receipt of a message (or a group of messages). By acknowledging a
>> message, the consumer gains credit in the broker which makes it
>> eligible to receive more messages. This credit-based flow control
>> allows the broker to distribute work proportional to the individual
>> processing ability of each worker, as opposed to a simple round robin
>> mechanism."
>>
>> On Jul 10, 4:32 am, Lars George <l... at worldlingo.com> wrote:
>>
>>
>>
>>     
>>> Hi,
>>>       
>>> I would like to use a blocking provider, but the QueueingConsumer is
>>> somewhat limiting as it receives whatever the queue sends and caches it
>>> locally, in the app servers memory. If that is a very large number then
>>> you can quickly run out of memory and kill the Java process with an OOME.
>>>       
>>> Is there a way to implement a Consumer that say only receives N queue
>>> items before it waits until they get processed locally? I mean from the
>>> internal BlockingQueue and using handleDelivery() this is doable but
>>> then you would block the main loop in the AMPQ connection - and miss
>>> heart beats etc.?
>>>       
>>> Is there a better way with this or do I have to go with a dumb while
>>> (true) { channel.basicGet() } loop. With that you have the issue to
>>> somehow gracefully handle the null delivery and not create a loop that
>>> consumes all CPU cycles with no actual work being done.
>>>       
>>> Thanks,
>>> Lars
>>>       
>>>  lars.vcf
>>> < 1KViewDownload
>>>       
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>       
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>     
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>   
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lars.vcf
Type: text/x-vcard
Size: 301 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090710/3ba9de13/attachment.vcf 

From ewaters at gmail.com  Sat Jul 11 00:06:25 2009
From: ewaters at gmail.com (Eric Waters)
Date: Fri, 10 Jul 2009 17:06:25 -0600
Subject: [rabbitmq-discuss] Perl AMQP client software in github
Message-ID: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>

I'll avoid talking about something that's not specific to
RabbitMQ in this forum in the
future, but wanted to mention this as a follow up to a post earlier this week.
I now have functioning code released for Net::AMQP and
POE::Component::Client::AMQP.  Tested it against RabbitMQ 1.6.0.  Get
it from
http://github.com/ewaters.  You'll need to clone both repositories to run
the example pingpong.pl program (idea copied from ruby-amqp).

To try it out, clone both projects into the same directory, cd into
poe-component-client-amqp, and run:

  DEBUG=0 perl -Ilib -I../net-amqp/lib examples/pingpong.pl
../net-amqp/spec/amqp0-8.xml

If you'd like to see the full protocol debug, change DEBUG=1.

The perl modules are fully documented in POD.  If anyone is interested, I'd
love for collaboration on the project.  Drop me a line with your github
username and I'll add you as a github collaborator.

Sorry for the interruption.  Back to your regularly scheduled RabbitMQ
programming.  :)

Eric
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090710/b5a90696/attachment.htm 

From lynton.grice at logosworld.com  Sun Jul 12 18:13:19 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Sun, 12 Jul 2009 19:13:19 +0200
Subject: [rabbitmq-discuss] RabbitMQ Consumer Error
Message-ID: <000001ca0314$122f7610$368e6230$@grice@logosworld.com>

Hi there,

 

I wonder if someone can help me on this one. I am building the following
scenario:

 

Client -> Mochiweb -> RabbitMQ (via Erlang RabbitMQ Client code) -> Python
consumer (using the Python CARROT AMQP library)

 

I have everything working right until the Python consumer picks up the
message. I get the following error:

 

"No JSON object could be decoded" 

 

 Let me step back a second.....here is an example of the BINARY sent from
the Erlang client (inside Mochiweb) to RabbitMQ:

 

NOTE: I have simplified the call by just making a binary called "Hello
World" for "Payload"

 

Payload = <<"Hello World">>,

                Content = #content{class_id = 60,

                     properties = amqp_util:basic_properties(),

                     properties_bin = none, 

                     payload_fragments_rev = [Payload]

                    },

                amqp_channel:cast(Channel, BasicPublish, Content),

 

When the Python JSON library (decoder.py) receives this I can see the
message is formatted like:

 

'Hello World'

 

But if I send to RabbitMQ like follows using PYTHON..

 

from carrot.messaging import Publisher

from carrot.connection import AMQPConnection

 

amqpconn = AMQPConnection(hostname="localhost", port=5672, userid="guest",
password="guest",vhost="/")

publisher = Publisher(connection=amqpconn, exchange="amq.direct",
routing_key="a.b.c.*")

publisher.send('Hello World')

publisher.close()

 

I get the following for the message in the Python JSON library (decoder.py):

 

'"Hello World"'

 

NOTE the subtle different between the two.....the first one is 'Hello World'
(from Erlang) and the second (from Python) is '"Hello World"'

 

I am just wondering if this is a "Unicode" thing or do I need to do
something to the Erlang BINARY before sending it to RabbitMQ?

 

I think this could also have to do with the BUILT IN JSON library in Python
2.6......I will look into that.....

 

Thanks for the help....much appreciated ;-)

 

Lynton

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090712/50856736/attachment.htm 

From 0x6e6562 at gmail.com  Sun Jul 12 22:05:10 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 12 Jul 2009 22:05:10 +0100
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <8a623f4f-5a36-4ef2-b884-315cc4764fe4@f33g2000vbm.googlegroups.com>
References: <4A5718A3.9000807@worldlingo.com>
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
	<8a623f4f-5a36-4ef2-b884-315cc4764fe4@f33g2000vbm.googlegroups.com>
Message-ID: <269388e30907121405t2c2e5d3al97a0fb4ac9256c46@mail.gmail.com>

Amit,

On Fri, Jul 10, 2009 at 6:17 PM, amit bhatnagar<brownspice at gmail.com> wrote:
> Having said this, I am wondering if it makes sense to use a
> QueueingConsumer on a channel that has a basicQos of 1? Would I be
> safe to use a DefaultConsumer here instead?

Using a DefaultConsumer is only a client side convenience, it has no
bearing on the server's view of message flow. The only way to control
flow effectively is to set the prefetch window as you have previously
indicated.

HTH,

Ben



From 0x6e6562 at gmail.com  Sun Jul 12 22:14:52 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 12 Jul 2009 22:14:52 +0100
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <4A57A639.1050000@worldlingo.com>
References: <4A5718A3.9000807@worldlingo.com>
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
	<8a623f4f-5a36-4ef2-b884-315cc4764fe4@f33g2000vbm.googlegroups.com>
	<4A57A639.1050000@worldlingo.com>
Message-ID: <269388e30907121414n6485b484sbc7a6f15f59179ac@mail.gmail.com>

Lars,

On Fri, Jul 10, 2009 at 9:36 PM, Lars George<lars at worldlingo.com> wrote:
> Thanks for the answer. So this QoS is only in trunk of the Java client. I
> will have to check this out.

The QoS command is part of all of the client libraries that the Rabbit
team maintain. I'm reasonably sure that other clients implement this
as well, since the client side is trivial - all of the complexity is
on the server side.

> Using the DefaultConsumer means extending it anyways, right? As by default
> it does not do anything. Even setting QoS to 1 would mean you will have to
> enforce ack'ing the message or else the async process will keep sending the
> next one. So a simple single local Delivery bean instance could hold the
> current message.
>
> Saves the queue part. But then you also have to lock on that instance for
> the blocking behavior, which the QueueingConsumer has build in.
>
> Am I on the right track here?

IMHO the QueueingConsumer abstraction is double-edged sword. It is a
really great way to easily consume messages without having to
implement every protocol callback. However, without flow control, the
QueueingConsumer can absorb the pressure that you actually want to
push back onto the broker to stem the flow on messages. This aspect is
irrelevant if you do use flow control, but doing so kind of obviates
the need to have this blocking convenience.

HTH,

Ben



From lynton.grice at logosworld.com  Mon Jul 13 06:31:43 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Mon, 13 Jul 2009 07:31:43 +0200
Subject: [rabbitmq-discuss] RabbitMQ Consumer Error
In-Reply-To: <000001ca0314$122f7610$368e6230$@grice@logosworld.com>
References: <000001ca0314$122f7610$368e6230$@grice@logosworld.com>
Message-ID: <000f01ca037b$38ffa820$aafef860$@grice@logosworld.com>

Hi there,

 

I seemed to have solved the issue....it all had to do with the
"content_encoding"....so I replaced this:

 

Content = #content{class_id = 60,

                     properties = amqp_util:basic_properties(),

                     properties = Properties,

                     properties_bin = none,                 

                     payload_fragments_rev = [Payload]

                    },

 

With this:

 

Properties = #'P_basic'{content_type = <<"application/octet-stream">>,

                       content_encoding = <<"binary">>,

                      delivery_mode = 1,

                      priority = 0},

                Content = #content{class_id = 60,

                     properties = Properties,

                     properties_bin = none,                 

                     payload_fragments_rev = [Payload]

                    },

 

Now my Python consumer in CARROT is working 100% ;-)

 

Chat later

 

Lynton

From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Lynton
Grice
Sent: 12 July 2009 07:13 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] RabbitMQ Consumer Error

 

Hi there,

 

I wonder if someone can help me on this one. I am building the following
scenario:

 

Client -> Mochiweb -> RabbitMQ (via Erlang RabbitMQ Client code) -> Python
consumer (using the Python CARROT AMQP library)

 

I have everything working right until the Python consumer picks up the
message. I get the following error:

 

"No JSON object could be decoded" 

 

 Let me step back a second.....here is an example of the BINARY sent from
the Erlang client (inside Mochiweb) to RabbitMQ:

 

NOTE: I have simplified the call by just making a binary called "Hello
World" for "Payload"

 

Payload = <<"Hello World">>,

                Content = #content{class_id = 60,

                     properties = amqp_util:basic_properties(),

                     properties_bin = none, 

                     payload_fragments_rev = [Payload]

                    },

                amqp_channel:cast(Channel, BasicPublish, Content),

 

When the Python JSON library (decoder.py) receives this I can see the
message is formatted like:

 

'Hello World'

 

But if I send to RabbitMQ like follows using PYTHON..

 

from carrot.messaging import Publisher

from carrot.connection import AMQPConnection

 

amqpconn = AMQPConnection(hostname="localhost", port=5672, userid="guest",
password="guest",vhost="/")

publisher = Publisher(connection=amqpconn, exchange="amq.direct",
routing_key="a.b.c.*")

publisher.send('Hello World')

publisher.close()

 

I get the following for the message in the Python JSON library (decoder.py):

 

'"Hello World"'

 

NOTE the subtle different between the two.....the first one is 'Hello World'
(from Erlang) and the second (from Python) is '"Hello World"'

 

I am just wondering if this is a "Unicode" thing or do I need to do
something to the Erlang BINARY before sending it to RabbitMQ?

 

I think this could also have to do with the BUILT IN JSON library in Python
2.6......I will look into that.....

 

Thanks for the help....much appreciated ;-)

 

Lynton

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090713/b9f054e4/attachment.htm 

From terry at fluidinfo.com  Tue Jul 14 06:24:43 2009
From: terry at fluidinfo.com (Terry Jones)
Date: Tue, 14 Jul 2009 07:24:43 +0200
Subject: [rabbitmq-discuss] Suggested small changes to
	/etc/init.d/rabbitmq-server
Message-ID: <19036.5787.668952.233232@jon.es>

It would be nice if /etc/init.d/rabbitmq-server allowed one to customize
where it writes the output that currently goes to /var/log/rabbitmq.

Attached is a trivial diff to allow the directory for those files to be set
in /etc/default/rabbitmq

There are a few other small things I'd do to that script too, were it mine.

Is there any decent reason why the scripts in /usr/sbin/rabbit-* refuse to
run rabbitmq unless you're root?  Seeing as a normal user can directly run
/usr/lib/rabbitmq/bin/rabbit-*, I don't really see the point of denying a
normal user in /usr/sbin/rabbit-*.  The /usr/sbin scripts could check to
see if you're root and use su rabbitmq if so, and just run as the user if
not. The worst that can happen is that rabbit fails to start, isn't it?

I ask all this because I'm upgrading some automated scripts to a modern
version of RabbitMQ after Esteve Fernandez noticed I was running 1.4. Last
time, I went behind the back of the normal rabbit startup scripts (using
rabbitmqctl_real) to get things done as a normal user. It would be nice to
just be able to run /etc/init.d/rabbit-server and not to have to hack it
again this time (and next time, if something like rabbitmqctl_real appears
or disappears behind the scenes). But the /var/log and the /usr/sbin root
check don't want to let me do that.

Thanks!

Terry

-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: rabbit-diff
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090714/dde5d80f/attachment.txt 

From lars at worldlingo.com  Tue Jul 14 07:06:39 2009
From: lars at worldlingo.com (Lars George)
Date: Tue, 14 Jul 2009 08:06:39 +0200
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
References: <4A5718A3.9000807@worldlingo.com>
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
Message-ID: <4A5C206F.9070901@worldlingo.com>

Hi Amit,

We upgraded to 1.6.0 and I added for example channel.basicQos(30); but 
to no avail. My test program still fills the local queue way past the 30 
message limit using the QueueingConsumer and noAck set to false.

Is this in a later version? Am I doing something wrong?

Regards,
Lars


amit bhatnagar wrote:
> Check out Channel.BasicQos() and set a prefetch count.
>
> Have a look here for a good description of the prefetch:
> http://hopper.squarespace.com/blog/2009/1/26/work-distribution-in-rabbitmq.html
>
> fta:
>
> "This command allows a consumer to choose a prefetch window that
> specifies the amount of unacknowledged messages it is prepared to
> receive. By setting the prefetch count to a non-zero value, the broker
> will not deliver any messages to the consumer that would breach that
> limit. To move the window forwards, the consumer has to acknowledge
> the receipt of a message (or a group of messages). By acknowledging a
> message, the consumer gains credit in the broker which makes it
> eligible to receive more messages. This credit-based flow control
> allows the broker to distribute work proportional to the individual
> processing ability of each worker, as opposed to a simple round robin
> mechanism."
>
>
> On Jul 10, 4:32 am, Lars George <l... at worldlingo.com> wrote:
>   
>> Hi,
>>
>> I would like to use a blocking provider, but the QueueingConsumer is
>> somewhat limiting as it receives whatever the queue sends and caches it
>> locally, in the app servers memory. If that is a very large number then
>> you can quickly run out of memory and kill the Java process with an OOME.
>>
>> Is there a way to implement a Consumer that say only receives N queue
>> items before it waits until they get processed locally? I mean from the
>> internal BlockingQueue and using handleDelivery() this is doable but
>> then you would block the main loop in the AMPQ connection - and miss
>> heart beats etc.?
>>
>> Is there a better way with this or do I have to go with a dumb while
>> (true) { channel.basicGet() } loop. With that you have the issue to
>> somehow gracefully handle the null delivery and not create a loop that
>> consumes all CPU cycles with no actual work being done.
>>
>> Thanks,
>> Lars
>>
>>  lars.vcf
>> < 1KViewDownload
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>     
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>   
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lars.vcf
Type: text/x-vcard
Size: 301 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090714/26d56458/attachment.vcf 

From 0x6e6562 at gmail.com  Tue Jul 14 12:22:48 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Tue, 14 Jul 2009 12:22:48 +0100
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <4A5C206F.9070901@worldlingo.com>
References: <4A5718A3.9000807@worldlingo.com>
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
	<4A5C206F.9070901@worldlingo.com>
Message-ID: <B61B9153-2239-4E6A-B759-9669BC046CC8@gmail.com>

Lars,

On 14 Jul 2009, at 07:06, Lars George <lars at worldlingo.com> wrote:

> Hi Amit,
>
> We upgraded to 1.6.0 and I added for example channel.basicQos(30);  
> but to no avail. My test program still fills the local queue way  
> past the 30 message limit using the QueueingConsumer and noAck set  
> to false.
>
> Is this in a later version? Am I doing something wrong?
>

Interesting. Can you send a cut down version of the code that  
reproduces the behaviour and to make sure that are you are definetly  
not auto-acking anything?

Ben

> Regards,
> Lars
>
>
> amit bhatnagar wrote:
>> Check out Channel.BasicQos() and set a prefetch count.
>>
>> Have a look here for a good description of the prefetch:
>> http://hopper.squarespace.com/blog/2009/1/26/work-distribution-in-rabbitmq.html
>>
>> fta:
>>
>> "This command allows a consumer to choose a prefetch window that
>> specifies the amount of unacknowledged messages it is prepared to
>> receive. By setting the prefetch count to a non-zero value, the  
>> broker
>> will not deliver any messages to the consumer that would breach that
>> limit. To move the window forwards, the consumer has to acknowledge
>> the receipt of a message (or a group of messages). By acknowledging a
>> message, the consumer gains credit in the broker which makes it
>> eligible to receive more messages. This credit-based flow control
>> allows the broker to distribute work proportional to the individual
>> processing ability of each worker, as opposed to a simple round robin
>> mechanism."
>>
>>
>> On Jul 10, 4:32 am, Lars George <l... at worldlingo.com> wrote:
>>
>>> Hi,
>>>
>>> I would like to use a blocking provider, but the QueueingConsumer is
>>> somewhat limiting as it receives whatever the queue sends and  
>>> caches it
>>> locally, in the app servers memory. If that is a very large number  
>>> then
>>> you can quickly run out of memory and kill the Java process with  
>>> an OOME.
>>>
>>> Is there a way to implement a Consumer that say only receives N  
>>> queue
>>> items before it waits until they get processed locally? I mean  
>>> from the
>>> internal BlockingQueue and using handleDelivery() this is doable but
>>> then you would block the main loop in the AMPQ connection - and miss
>>> heart beats etc.?
>>>
>>> Is there a better way with this or do I have to go with a dumb while
>>> (true) { channel.basicGet() } loop. With that you have the issue to
>>> somehow gracefully handle the null delivery and not create a loop  
>>> that
>>> consumes all CPU cycles with no actual work being done.
>>>
>>> Thanks,
>>> Lars
>>>
>>> lars.vcf
>>> < 1KViewDownload
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi- 
>>> bin/mailman/listinfo/rabbitmq-discuss
>>>
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
> <lars.vcf>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From lars at worldlingo.com  Tue Jul 14 16:15:34 2009
From: lars at worldlingo.com (Lars George)
Date: Tue, 14 Jul 2009 17:15:34 +0200
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <B61B9153-2239-4E6A-B759-9669BC046CC8@gmail.com>
References: <4A5718A3.9000807@worldlingo.com>
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
	<4A5C206F.9070901@worldlingo.com>
	<B61B9153-2239-4E6A-B759-9669BC046CC8@gmail.com>
Message-ID: <4A5CA116.4030208@worldlingo.com>

Hi Ben,

The code is really straight forward. Here is the Listener:

  public static void main(String[] args) {
    try {
      ConnectionParameters params = new ConnectionParameters();
      params.setUsername("guest");
      params.setPassword("guest");
      params.setVirtualHost("/");
      params.setRequestedHeartbeat(0);
      ConnectionFactory factory = new ConnectionFactory(params);
      Connection conn = factory.newConnection("queue1.internal");
      Channel channel = conn.createChannel();
     
      channel.basicQos(1);
     
      int wait = -1;
      if (args.length > 0) wait = Integer.parseInt(args[0]);
      boolean noAck = false;
      boolean exit = false;
      TestConsumer consumer = new TestConsumer(channel);
      channel.basicConsume("test", noAck, consumer);
      while (!exit) {
        TestConsumer.Delivery delivery;
        try {
          delivery = consumer.nextDelivery();
        } catch (InterruptedException ie) {
          continue;
        }
        byte[] body = delivery.getBody();
        String msg = new String(body);
        System.out.println("msg -> " + msg);
        // (process the message components ...)
        channel.basicAck(delivery.getEnvelope().getDeliveryTag(), false);
        exit = msg != null && msg.startsWith("STOP");
        if (wait > -1) {
          System.out.println("waiting secs -> " + wait);
          Thread.sleep(wait * 1000);
        }
      }
      channel.close();
      conn.close();
    } catch (Exception e) {
      e.printStackTrace();
    }
  }


And the Publisher looks like this:

  public static void main(String[] args) {
    try {
      ConnectionParameters params = new ConnectionParameters();
      params.setUsername("guest");
      params.setPassword("guest");
      params.setVirtualHost("/");
      params.setRequestedHeartbeat(0);
      ConnectionFactory factory = new ConnectionFactory(params);
      Connection conn = factory.newConnection("queue1.internal");
      Channel channel = conn.createChannel();
 
      channel.exchangeDeclare("test-rabbitmq", "fanout");
      channel.queueDeclare("test");
      channel.queueBind("test", "test-rabbitmq", "test");

      int num = 1;
      if (args.length > 1) num = Integer.parseInt(args[1]);
      for (int n = 0; n < num; n++) {
        String msg = args[0] + "-" + (n+1) + "/" + num;
        byte[] body = msg.getBytes();
        channel.basicPublish("test-rabbitmq", "test", null, body);
        System.out.println("Sending -> " + msg);
      }
     
      channel.close();
      conn.close();
    } catch (IOException e) {
      e.printStackTrace();
    }
  }

So the way I test this is run three Listeners, one with an additional 
"5" as the parameter to make is sleep 5 seconds between takes.

java -cp 
\workspace\test-rabbitmq\lib\rabbitmq-client.jar;\workspace\test-rabbitmq\bin;\workspace\test-rabbitmq\lib\commons-io-1.4.jar 
Listener
java -cp 
\workspace\test-rabbitmq\lib\rabbitmq-client.jar;\workspace\test-rabbitmq\bin;\workspace\test-rabbitmq\lib\commons-io-1.4.jar 
Listener
java -cp 
\workspace\test-rabbitmq\lib\rabbitmq-client.jar;\workspace\test-rabbitmq\bin;\workspace\test-rabbitmq\lib\commons-io-1.4.jar 
Listener 5

The I start the Publisher and push 10000 messages

java -cp 
\workspace\test-rabbitmq\lib\rabbitmq-client.jar;\workspace\test-rabbitmq\lib\commons-io-1.4.jar;\workspace\test-rabbitmq\bin 
Publisher test 10000

The idea is that the one Listener that waits 5 seconds should only ever 
receive 1, or 30 or whatever prefetch size is, messages. But I have 
instrumented the QueueingConsumer with logging and named it TestConsumer 
just adding this

  @Override
  public void handleDelivery(String consumerTag, Envelope envelope,
      AMQP.BasicProperties properties, byte[] body) throws IOException {
    _queue.add(ValueOrException.<Delivery, ShutdownSignalException>
      makeValue(new Delivery(envelope, properties, body)));
    System.out.println("new queue size -> " + _queue.size());
  }

to print out the size of the in memory queue. And it runs without 
bounds. If you like I can send you all three classes directly. Let me know.

Regards,
Lars


Ben Hood wrote:
> Lars,
>
> On 14 Jul 2009, at 07:06, Lars George <lars at worldlingo.com> wrote:
>
>> Hi Amit,
>>
>> We upgraded to 1.6.0 and I added for example channel.basicQos(30); 
>> but to no avail. My test program still fills the local queue way past 
>> the 30 message limit using the QueueingConsumer and noAck set to false.
>>
>> Is this in a later version? Am I doing something wrong?
>>
>
> Interesting. Can you send a cut down version of the code that 
> reproduces the behaviour and to make sure that are you are definetly 
> not auto-acking anything?
>
> Ben
>
>> Regards,
>> Lars
>>
>>
>> amit bhatnagar wrote:
>>> Check out Channel.BasicQos() and set a prefetch count.
>>>
>>> Have a look here for a good description of the prefetch:
>>> http://hopper.squarespace.com/blog/2009/1/26/work-distribution-in-rabbitmq.html 
>>>
>>>
>>> fta:
>>>
>>> "This command allows a consumer to choose a prefetch window that
>>> specifies the amount of unacknowledged messages it is prepared to
>>> receive. By setting the prefetch count to a non-zero value, the broker
>>> will not deliver any messages to the consumer that would breach that
>>> limit. To move the window forwards, the consumer has to acknowledge
>>> the receipt of a message (or a group of messages). By acknowledging a
>>> message, the consumer gains credit in the broker which makes it
>>> eligible to receive more messages. This credit-based flow control
>>> allows the broker to distribute work proportional to the individual
>>> processing ability of each worker, as opposed to a simple round robin
>>> mechanism."
>>>
>>>
>>> On Jul 10, 4:32 am, Lars George <l... at worldlingo.com> wrote:
>>>
>>>> Hi,
>>>>
>>>> I would like to use a blocking provider, but the QueueingConsumer is
>>>> somewhat limiting as it receives whatever the queue sends and 
>>>> caches it
>>>> locally, in the app servers memory. If that is a very large number 
>>>> then
>>>> you can quickly run out of memory and kill the Java process with an 
>>>> OOME.
>>>>
>>>> Is there a way to implement a Consumer that say only receives N queue
>>>> items before it waits until they get processed locally? I mean from 
>>>> the
>>>> internal BlockingQueue and using handleDelivery() this is doable but
>>>> then you would block the main loop in the AMPQ connection - and miss
>>>> heart beats etc.?
>>>>
>>>> Is there a better way with this or do I have to go with a dumb while
>>>> (true) { channel.basicGet() } loop. With that you have the issue to
>>>> somehow gracefully handle the null delivery and not create a loop that
>>>> consumes all CPU cycles with no actual work being done.
>>>>
>>>> Thanks,
>>>> Lars
>>>>
>>>> lars.vcf
>>>> < 1KViewDownload
>>>>
>>>> _______________________________________________
>>>> rabbitmq-discuss mailing list
>>>> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss 
>>>>
>>>>
>>>
>>> _______________________________________________
>>> rabbitmq-discuss mailing list
>>> rabbitmq-discuss at lists.rabbitmq.com
>>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>>
>>>
>> <lars.vcf>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lars.vcf
Type: text/x-vcard
Size: 301 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090714/c59bd0a2/attachment.vcf 

From nemik at nemik.net  Tue Jul 14 20:40:07 2009
From: nemik at nemik.net (Nemanja Stefanovic)
Date: Tue, 14 Jul 2009 14:40:07 -0500
Subject: [rabbitmq-discuss] When is a rabbitmq-stomp 1.6.0 adapter
	coming?
In-Reply-To: <4A5724EF.8060903@lshift.net>
References: <14f55850906271248p80399fcw7e50d46befe5017@mail.gmail.com>
	<4A5724EF.8060903@lshift.net>
Message-ID: <acceaadf0907141240w10781267qd4f34d6c961b8371@mail.gmail.com>

Tony,

Sorry for not replying sooner but thank you very much! I guess just the
?MODULE on the first arg was missing...

Thank you!
-Nemanja

On Fri, Jul 10, 2009 at 6:24 AM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Hi Ivan (and others who've asked about this),
>
> I've just tagged rabbitmq_v1_6_0 of rabbitmq-stomp, so you should be
> able to get things running with:
>
>
> (1) Retrieve and build RabbitMQ server v1.6.0
>
>   wget
>
> http://www.rabbitmq.com/releases/rabbitmq-server/v1.6.0/rabbitmq-server-1.6.0.tar.gz
>   tar -zxf rabbitmq-server-1.6.0.tar.gz
>   make -C rabbitmq-server-1.6.0
>
>
> (2) Retrieve and build the 1.6.0-compatible STOMP adapter
>
>   wget
> http://hg.rabbitmq.com/rabbitmq-stomp/archive/rabbitmq_v1_6_0.tar.gz
>   tar -zxf rabbitmq_v1_6_0.tar.gz
>   make -C rabbitmq-stomp-rabbitmq_v1_6_0
> RABBIT_SERVER_SOURCE_ROOT=../rabbitmq-server-1.6.0 run
>
>
> Sorry for the delay and the confusion!
>
> Regards,
>    Tony
>
>
>
> Ivan Delchev wrote:
> > Hi everyone,
> >
> > I'm new to the list but I'm very fascinated by the features of
> > RabbitMQ and plan to use it for a project of mine. For the purpose I
> > would also require the rabbitmq-stomp adapter. I noticed that the
> > current version of RabbitMQ is 1.6.0 but the latest tagged
> > rabbitmq-stomp adapter is 1.5.5. When do you plan to release a 1.6
> > rabbitmq-stomp adapter - I quite like the newly introduced access
> > control features of RabbitMQ 1.6.0. Are there any recorded issues when
> > using the new server with the older adapter?
> >
> > Great job!
> >
> > Regards,
> > Ivan
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090714/bc0f3868/attachment.htm 

From cwiegand at mobileaccord.com  Tue Jul 14 23:59:51 2009
From: cwiegand at mobileaccord.com (Chris Wiegand)
Date: Tue, 14 Jul 2009 18:59:51 -0400
Subject: [rabbitmq-discuss] RabbitMQ 1.6 persistence?
Message-ID: <658AD87BE18A64499819C89D6FCAAD963C069908@SIMON.mobileaccord.local>

We were trying out RabbitMQ (1.6, just downloaded it last week), and while it's throughput is great compared to ActiveMQ, I'm finding that if the erlang session dies (like say if I kill it, or try to pump in 1 million messages and it runs out of memory), and then I re-start the RabbitMQ server it takes a rather long time to load the persistence stuff, but then just clears out the queues, and the file (rabbit_persister.LOG) just gets truncated and the messages were not persisted.

Am I misunderstanding how RabbitMQ implements persistence? I expected that if the broker stops, and then gets relaunched that it would reload the last saved state for the queues, etc.., but that doesn't seem to be taking place. We're running it under Windows, under the most recent version of erlang (also just downloaded last week), in case that would affect anything. I'll try this under Linux and OpenSolaris here soon, in case that makes a difference.

I'm using the .Net bindings, and setting the BasicProperties' DeliveryMode to 2 for persistence, is there anything else I have to do to make a queue persist?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090714/8c84b37c/attachment.htm 

From wilson.ke at wealthcraft.com  Wed Jul 15 03:01:22 2009
From: wilson.ke at wealthcraft.com (Wilson Ke)
Date: Wed, 15 Jul 2009 10:01:22 +0800
Subject: [rabbitmq-discuss] RabbitMQ 1.6 persistence?
In-Reply-To: <658AD87BE18A64499819C89D6FCAAD963C069908@SIMON.mobileaccord.local>
References: <658AD87BE18A64499819C89D6FCAAD963C069908@SIMON.mobileaccord.local>
Message-ID: <8F16BDCC98E64841857E711110AF5EDD698A1AAF61@EXMBX01.wealthcraft.local>


Hi chris,

         I meet same question with you. I solute as below:

1.       When you declare queue, please announce it to durable.
        private int DecalreQueue(string [] args)
        {
            string serverAddress = args[0];
            string inputQueueName = args[1];
            bool durable=true;

            using (IConnection conn = new ConnectionFactory().CreateConnection(serverAddress))
            {
                using (IModel ch = conn.CreateModel())
                {

                    string finalName = ch.QueueDeclare(inputQueueName, false,
                                                       durable, false, false,
                                                       false, null);
                    Console.WriteLine("{0}\t{1}", finalName, durable);


                    return 0;
                }
            }
        }
2.       Declare exchange with durable , when send message, bind the queue to the exchange.
        private int SendString(string message)
        {
            try
            {

                string serverAddress = "192.168.1.87";
                string exchange = "yourexchange";
                string exchangeType = ExchangeType.Topic;
                string routingKey = "key";

                using (IConnection conn = new ConnectionFactory().CreateConnection(serverAddress))
                {
                    using (IModel ch = conn.CreateModel())
                    {

                        if (exchange != "")
                        {
                            ch.ExchangeDeclare(exchange, exchangeType,true,false,false,false,false,null);
                        }
                        ch.QueueBind("subscriptionqueue", exchange, routingKey, false, null);
                        ch.BasicPublish(exchange,
                                        routingKey,
                                        null,
                                        Encoding.UTF8.GetBytes(message));
                        return 0;
                    }
                }
            }
            catch (Exception e)
            {
                MessageBox.Show(e.Message);
                return 2;
            }
        }




Good luck!


Best Regards,
wilson

________________________________
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Chris Wiegand
Sent: 2009?7?15? 7:00
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] RabbitMQ 1.6 persistence?

We were trying out RabbitMQ (1.6, just downloaded it last week), and while it?s throughput is great compared to ActiveMQ, I?m finding that if the erlang session dies (like say if I kill it, or try to pump in 1 million messages and it runs out of memory), and then I re-start the RabbitMQ server it takes a rather long time to load the persistence stuff, but then just clears out the queues, and the file (rabbit_persister.LOG) just gets truncated and the messages were not persisted.

Am I misunderstanding how RabbitMQ implements persistence? I expected that if the broker stops, and then gets relaunched that it would reload the last saved state for the queues, etc.., but that doesn?t seem to be taking place. We?re running it under Windows, under the most recent version of erlang (also just downloaded last week), in case that would affect anything. I?ll try this under Linux and OpenSolaris here soon, in case that makes a difference.

I?m using the .Net bindings, and setting the BasicProperties? DeliveryMode to 2 for persistence, is there anything else I have to do to make a queue persist?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090715/0e75af85/attachment.htm 

From alexis.richardson at gmail.com  Wed Jul 15 09:41:59 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 15 Jul 2009 09:41:59 +0100
Subject: [rabbitmq-discuss] Perl AMQP client software in github
In-Reply-To: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>
References: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>
Message-ID: <167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>

Eric

Thanks for this.  I'm not familiar with Perl so please can you explain
how the two projects relate to each other?  Should they always be used
together?

alexis


On Sat, Jul 11, 2009 at 12:06 AM, Eric Waters<ewaters at gmail.com> wrote:
> I'll avoid talking about something that's not specific to
> RabbitMQ?in?this?forum in the
> future,?but?wanted?to?mention?this?as?a?follow?up?to?a?post?earlier?this?week.
> I?now?have?functioning?code?released?for?Net::AMQP?and?POE::Component::Client::AMQP.??Tested?it?against?RabbitMQ?1.6.0.??Get?it?from?http://github.com/ewaters.??You'll?need?to?clone?both?repositories
> to run the example pingpong.pl program (idea copied from ruby-amqp).
> To try it out, clone both projects into the same directory, cd into
> poe-component-client-amqp, and run:
> ??DEBUG=0 perl -Ilib -I../net-amqp/lib examples/pingpong.pl
> ../net-amqp/spec/amqp0-8.xml
> If you'd like to see the full protocol debug, change DEBUG=1.
> The?perl?modules?are?fully?documented?in?POD. ?If anyone is interested, I'd
> love for collaboration on the project. ?Drop me a line with your github
> username and I'll add you as a github collaborator.
> Sorry for the interruption. ?Back to your regularly scheduled RabbitMQ
> programming. ?:)
> Eric
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From wilson.ke at wealthcraft.com  Wed Jul 15 11:43:27 2009
From: wilson.ke at wealthcraft.com (Wilson Ke)
Date: Wed, 15 Jul 2009 18:43:27 +0800
Subject: [rabbitmq-discuss] how to make Wcf bind to rabbitmq exchange and
	queue?
In-Reply-To: <167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>
References: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>
	<167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>
Message-ID: <8F16BDCC98E64841857E711110AF5EDD698A1AAFD1@EXMBX01.wealthcraft.local>

Hi all,

     I am use Wcf and RabbitMQ to make project.  I can use Wcf bind RabbitMQ to work normal as below ,but I don't know how to make Wcf bind to rabbitmq exchange and queue, could you help me? Many thanks!



C# code:

namespace Server

{

    using System;

    using System.ServiceModel;

    using WcfServiceLibrary1;

    using RabbitMQ.ServiceModel;



    class Server

    {

        public void Run()

        {







            ServiceHost host = new ServiceHost(typeof(HelloService));

            host.Open();



            Console.WriteLine("Service Ready");

            Console.ReadLine();



            host.Close();

        }

    }

}



Config file:

<?xml version="1.0" encoding="utf-8" ?>

<configuration>

  <system.serviceModel>



    <services>

      <service name="WcfServiceLibrary1.HelloService">

        <host>

          <baseAddresses>

            <add baseAddress="soap.amqp:///"   />

          </baseAddresses>

        </host>

        <endpoint

          address="Hello"

          binding="rabbitMQBinding"

          bindingConfiguration="rabbitMQConfig"

          contract="WcfServiceLibrary1.IHelloContract"/>

      </service>

    </services>

    <bindings>

      <rabbitMQBinding>

        <binding name="rabbitMQConfig"

          broker="amqp://192.168.1.87:5672/"

          protocolversion="AMQP_0_8"

         oneWay="false"

                    />

      </rabbitMQBinding>

    </bindings>



    <extensions>

      <bindingExtensions>

        <add

          name="rabbitMQBinding"

          type="RabbitMQ.ServiceModel.RabbitMQBindingSection, RabbitMQ.ServiceModel, Version=1.0.110.0, Culture=neutral, PublicKeyToken=null"/>

      </bindingExtensions>

    </extensions>



  </system.serviceModel>

</configuration>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090715/4d0eb016/attachment.htm 

From alexis.richardson at gmail.com  Wed Jul 15 11:47:04 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 15 Jul 2009 11:47:04 +0100
Subject: [rabbitmq-discuss] how to make Wcf bind to rabbitmq exchange
	and queue?
In-Reply-To: <8F16BDCC98E64841857E711110AF5EDD698A1AAFD1@EXMBX01.wealthcraft.local>
References: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>
	<167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD698A1AAFD1@EXMBX01.wealthcraft.local>
Message-ID: <167204d20907150347l1c98680ao22abf760c47e761c@mail.gmail.com>

Wilson

Have you read the documentation -- eg. the PDFs -- on this page?

http://www.rabbitmq.com/dotnet.html

alexis


On Wed, Jul 15, 2009 at 11:43 AM, Wilson Ke<wilson.ke at wealthcraft.com> wrote:
> Hi all,
>
> ???? I am use Wcf and RabbitMQ to make project. ?I can use Wcf bind RabbitMQ
> to work normal as below ,but I don?t know how to make Wcf bind to rabbitmq
> exchange and queue, could you help me? Many thanks!
>
>
>
> C# code:
>
> namespace Server
>
> {
>
> ??? using System;
>
> ??? using System.ServiceModel;
>
> ??? using WcfServiceLibrary1;
>
> ??? using RabbitMQ.ServiceModel;
>
>
>
> ??? class Server
>
> ??? {
>
> ??????? public void Run()
>
> ??????? {
>
>
>
>
>
>
>
> ???????? ???ServiceHost host = new ServiceHost(typeof(HelloService));
>
> ??????????? host.Open();
>
>
>
> ??????????? Console.WriteLine("Service Ready");
>
> ??????????? Console.ReadLine();
>
>
>
> ??????????? host.Close();
>
> ??????? }
>
> ??? }
>
> }
>
>
>
> Config file:
>
> <?xml version="1.0" encoding="utf-8" ?>
>
> <configuration>
>
> ? <system.serviceModel>
>
>
>
> ??? <services>
>
> ????? <service name="WcfServiceLibrary1.HelloService">
>
> ??????? <host>
>
> ????????? <baseAddresses>
>
> ??????????? <add baseAddress="soap.amqp:///"?? />
>
> ????????? </baseAddresses>
>
> ??????? </host>
>
> ??????? <endpoint
>
> ????????? address="Hello"
>
> ????????? binding="rabbitMQBinding"
>
> ????????? bindingConfiguration="rabbitMQConfig"
>
> ????????? contract="WcfServiceLibrary1.IHelloContract"/>
>
> ????? </service>
>
> ??? </services>
>
> ??? <bindings>
>
> ????? <rabbitMQBinding>
>
> ??????? <binding name="rabbitMQConfig"
>
> ???????? ?broker="amqp://192.168.1.87:5672/"
>
> ???????? ?protocolversion="AMQP_0_8"
>
> ???????? oneWay="false"
>
> ?????????????????? ?/>
>
> ????? </rabbitMQBinding>
>
> ??? </bindings>
>
>
>
> ??? <extensions>
>
> ????? <bindingExtensions>
>
> ??????? <add
>
> ????????? name="rabbitMQBinding"
>
> ????????? type="RabbitMQ.ServiceModel.RabbitMQBindingSection,
> RabbitMQ.ServiceModel, Version=1.0.110.0, Culture=neutral,
> PublicKeyToken=null"/>
>
> ????? </bindingExtensions>
>
> ??? </extensions>
>
>
>
> ? </system.serviceModel>
>
> </configuration>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From pekenney at gmail.com  Wed Jul 15 15:43:00 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Wed, 15 Jul 2009 07:43:00 -0700
Subject: [rabbitmq-discuss] how to make Wcf bind to rabbitmq exchange
	and queue?
In-Reply-To: <167204d20907150347l1c98680ao22abf760c47e761c@mail.gmail.com>
References: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>
	<167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD698A1AAFD1@EXMBX01.wealthcraft.local>
	<167204d20907150347l1c98680ao22abf760c47e761c@mail.gmail.com>
Message-ID: <3a5f03340907150743y330741c6o2da65e090a825fe2@mail.gmail.com>

I have...

And as a new user myself, I would like to suggest some very basic "how do I"
fully functional, one stop shopping samples, for common tasks, and similar
tasks, such as this is how create, connect, publish, subscribe to a MSMQ
queue, via WCF and this is how you do it with RabbitMQ C#, WCF, etc.,  along
the lines that Microsoft does it especially when there are several pdfs to
go through, and api's to absorb like AMQP...
In my view this will facilitate a faster learning and or adoption period for
RabbitMQ and give it a larger following...

thanks in advance.

On Wed, Jul 15, 2009 at 3:47 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Wilson
>
> Have you read the documentation -- eg. the PDFs -- on this page?
>
> http://www.rabbitmq.com/dotnet.html
>
> alexis
>
>
> On Wed, Jul 15, 2009 at 11:43 AM, Wilson Ke<wilson.ke at wealthcraft.com>
> wrote:
> > Hi all,
> >
> >      I am use Wcf and RabbitMQ to make project.  I can use Wcf bind
> RabbitMQ
> > to work normal as below ,but I don?t know how to make Wcf bind to
> rabbitmq
> > exchange and queue, could you help me? Many thanks!
> >
> >
> >
> > C# code:
> >
> > namespace Server
> >
> > {
> >
> >     using System;
> >
> >     using System.ServiceModel;
> >
> >     using WcfServiceLibrary1;
> >
> >     using RabbitMQ.ServiceModel;
> >
> >
> >
> >     class Server
> >
> >     {
> >
> >         public void Run()
> >
> >         {
> >
> >
> >
> >
> >
> >
> >
> >             ServiceHost host = new ServiceHost(typeof(HelloService));
> >
> >             host.Open();
> >
> >
> >
> >             Console.WriteLine("Service Ready");
> >
> >             Console.ReadLine();
> >
> >
> >
> >             host.Close();
> >
> >         }
> >
> >     }
> >
> > }
> >
> >
> >
> > Config file:
> >
> > <?xml version="1.0" encoding="utf-8" ?>
> >
> > <configuration>
> >
> >   <system.serviceModel>
> >
> >
> >
> >     <services>
> >
> >       <service name="WcfServiceLibrary1.HelloService">
> >
> >         <host>
> >
> >           <baseAddresses>
> >
> >             <add baseAddress="soap.amqp:///"   />
> >
> >           </baseAddresses>
> >
> >         </host>
> >
> >         <endpoint
> >
> >           address="Hello"
> >
> >           binding="rabbitMQBinding"
> >
> >           bindingConfiguration="rabbitMQConfig"
> >
> >           contract="WcfServiceLibrary1.IHelloContract"/>
> >
> >       </service>
> >
> >     </services>
> >
> >     <bindings>
> >
> >       <rabbitMQBinding>
> >
> >         <binding name="rabbitMQConfig"
> >
> >           broker="amqp://192.168.1.87:5672/"
> >
> >           protocolversion="AMQP_0_8"
> >
> >          oneWay="false"
> >
> >                     />
> >
> >       </rabbitMQBinding>
> >
> >     </bindings>
> >
> >
> >
> >     <extensions>
> >
> >       <bindingExtensions>
> >
> >         <add
> >
> >           name="rabbitMQBinding"
> >
> >           type="RabbitMQ.ServiceModel.RabbitMQBindingSection,
> > RabbitMQ.ServiceModel, Version=1.0.110.0, Culture=neutral,
> > PublicKeyToken=null"/>
> >
> >       </bindingExtensions>
> >
> >     </extensions>
> >
> >
> >
> >   </system.serviceModel>
> >
> > </configuration>
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090715/ec49a9b2/attachment.htm 

From alexis.richardson at gmail.com  Wed Jul 15 15:47:30 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 15 Jul 2009 15:47:30 +0100
Subject: [rabbitmq-discuss] how to make Wcf bind to rabbitmq exchange
	and queue?
In-Reply-To: <3a5f03340907150743y330741c6o2da65e090a825fe2@mail.gmail.com>
References: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>
	<167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD698A1AAFD1@EXMBX01.wealthcraft.local>
	<167204d20907150347l1c98680ao22abf760c47e761c@mail.gmail.com>
	<3a5f03340907150743y330741c6o2da65e090a825fe2@mail.gmail.com>
Message-ID: <167204d20907150747k776a6685n9fe03ec7c0c1a51c@mail.gmail.com>

Patrick

RabbitMQ does not connect to MSMQ directly, although you could wire an
integration between RabbitMQ and MSMQ through WCF. For the latter, use
standard MS docs and for the former please can you check out the
documents on www.rabbitmq.com/dotnet.html and tell us in what way they
can be improved.  The PDFs do contain examples of the type you
request, or at least, they are supposed to do so ;-)

alexis


On Wed, Jul 15, 2009 at 3:43 PM, Patrick Kenney<pekenney at gmail.com> wrote:
> I have...
>
> And as a new user myself, I would like to suggest some very basic "how do I"
> fully functional, one stop shopping samples, for common tasks, and similar
> tasks, such as this is how create, connect, publish, subscribe to a MSMQ
> queue, via WCF and this is how you do it with RabbitMQ C#, WCF, etc.,? along
> the lines that Microsoft does it especially when there are several pdfs to
> go through, and api's to absorb like AMQP...
> In my view this will facilitate a faster learning and or adoption period for
> RabbitMQ and give it a larger following...
>
> thanks in advance.
>
> On Wed, Jul 15, 2009 at 3:47 AM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Wilson
>>
>> Have you read the documentation -- eg. the PDFs -- on this page?
>>
>> http://www.rabbitmq.com/dotnet.html
>>
>> alexis
>>
>>
>> On Wed, Jul 15, 2009 at 11:43 AM, Wilson Ke<wilson.ke at wealthcraft.com>
>> wrote:
>> > Hi all,
>> >
>> > ???? I am use Wcf and RabbitMQ to make project. ?I can use Wcf bind
>> > RabbitMQ
>> > to work normal as below ,but I don?t know how to make Wcf bind to
>> > rabbitmq
>> > exchange and queue, could you help me? Many thanks!
>> >
>> >
>> >
>> > C# code:
>> >
>> > namespace Server
>> >
>> > {
>> >
>> > ??? using System;
>> >
>> > ??? using System.ServiceModel;
>> >
>> > ??? using WcfServiceLibrary1;
>> >
>> > ??? using RabbitMQ.ServiceModel;
>> >
>> >
>> >
>> > ??? class Server
>> >
>> > ??? {
>> >
>> > ??????? public void Run()
>> >
>> > ??????? {
>> >
>> >
>> >
>> >
>> >
>> >
>> >
>> > ???????? ???ServiceHost host = new ServiceHost(typeof(HelloService));
>> >
>> > ??????????? host.Open();
>> >
>> >
>> >
>> > ??????????? Console.WriteLine("Service Ready");
>> >
>> > ??????????? Console.ReadLine();
>> >
>> >
>> >
>> > ??????????? host.Close();
>> >
>> > ??????? }
>> >
>> > ??? }
>> >
>> > }
>> >
>> >
>> >
>> > Config file:
>> >
>> > <?xml version="1.0" encoding="utf-8" ?>
>> >
>> > <configuration>
>> >
>> > ? <system.serviceModel>
>> >
>> >
>> >
>> > ??? <services>
>> >
>> > ????? <service name="WcfServiceLibrary1.HelloService">
>> >
>> > ??????? <host>
>> >
>> > ????????? <baseAddresses>
>> >
>> > ??????????? <add baseAddress="soap.amqp:///"?? />
>> >
>> > ????????? </baseAddresses>
>> >
>> > ??????? </host>
>> >
>> > ??????? <endpoint
>> >
>> > ????????? address="Hello"
>> >
>> > ????????? binding="rabbitMQBinding"
>> >
>> > ????????? bindingConfiguration="rabbitMQConfig"
>> >
>> > ????????? contract="WcfServiceLibrary1.IHelloContract"/>
>> >
>> > ????? </service>
>> >
>> > ??? </services>
>> >
>> > ??? <bindings>
>> >
>> > ????? <rabbitMQBinding>
>> >
>> > ??????? <binding name="rabbitMQConfig"
>> >
>> > ???????? ?broker="amqp://192.168.1.87:5672/"
>> >
>> > ???????? ?protocolversion="AMQP_0_8"
>> >
>> > ???????? oneWay="false"
>> >
>> > ?????????????????? ?/>
>> >
>> > ????? </rabbitMQBinding>
>> >
>> > ??? </bindings>
>> >
>> >
>> >
>> > ??? <extensions>
>> >
>> > ????? <bindingExtensions>
>> >
>> > ??????? <add
>> >
>> > ????????? name="rabbitMQBinding"
>> >
>> > ????????? type="RabbitMQ.ServiceModel.RabbitMQBindingSection,
>> > RabbitMQ.ServiceModel, Version=1.0.110.0, Culture=neutral,
>> > PublicKeyToken=null"/>
>> >
>> > ????? </bindingExtensions>
>> >
>> > ??? </extensions>
>> >
>> >
>> >
>> > ? </system.serviceModel>
>> >
>> > </configuration>
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From pekenney at gmail.com  Wed Jul 15 16:55:36 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Wed, 15 Jul 2009 08:55:36 -0700
Subject: [rabbitmq-discuss] how to make Wcf bind to rabbitmq exchange
	and queue?
In-Reply-To: <167204d20907150747k776a6685n9fe03ec7c0c1a51c@mail.gmail.com>
References: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>
	<167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD698A1AAFD1@EXMBX01.wealthcraft.local>
	<167204d20907150347l1c98680ao22abf760c47e761c@mail.gmail.com>
	<3a5f03340907150743y330741c6o2da65e090a825fe2@mail.gmail.com>
	<167204d20907150747k776a6685n9fe03ec7c0c1a51c@mail.gmail.com>
Message-ID: <3a5f03340907150855h7c75d1e3t15c239894680eca8@mail.gmail.com>

MSMQ was a point of reference...

RabbitMQ .NET client library API guide has a few snippets... no fully
functional ready to run examples...
RabbitMQ .NET Client Library User Guide... ditto, although it does reference
examples in section 6, building the samples is problematic, using visual
studio as documented and the related samples are not part of a ready to run
solution, that you can walk through in debug mode in visual studio,
AddClient, AddServer, DeclareQueue etc... and they are individual console,
widgets...

so in my view if there was some single C# solution, (winform) that one could
just open and run with a test consumer/subscriber/publisher/create queue
etc., that if one set some break points in, they could in a single solution
(one-stop-shopping) go through all the common tasks in debug mode in visual
studio...

create a queue, dispatcher, publish to that queue, subscribe to that queue,
add address, binding, contract, context, protocol programmaticly, view
message, etc...

thanks in advance.

re:
On Wed, Jul 15, 2009 at 7:47 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Patrick
>
> RabbitMQ does not connect to MSMQ directly, although you could wire an
> integration between RabbitMQ and MSMQ through WCF. For the latter, use
> standard MS docs and for the former please can you check out the
> documents on www.rabbitmq.com/dotnet.html and tell us in what way they
> can be improved.  The PDFs do contain examples of the type you
> request, or at least, they are supposed to do so ;-)
>
> alexis
>
>
> On Wed, Jul 15, 2009 at 3:43 PM, Patrick Kenney<pekenney at gmail.com> wrote:
> > I have...
> >
> > And as a new user myself, I would like to suggest some very basic "how do
> I"
> > fully functional, one stop shopping samples, for common tasks, and
> similar
> > tasks, such as this is how create, connect, publish, subscribe to a MSMQ
> > queue, via WCF and this is how you do it with RabbitMQ C#, WCF, etc.,
> along
> > the lines that Microsoft does it especially when there are several pdfs
> to
> > go through, and api's to absorb like AMQP...
> > In my view this will facilitate a faster learning and or adoption period
> for
> > RabbitMQ and give it a larger following...
> >
> > thanks in advance.
> >
> > On Wed, Jul 15, 2009 at 3:47 AM, Alexis Richardson
> > <alexis.richardson at gmail.com> wrote:
> >>
> >> Wilson
> >>
> >> Have you read the documentation -- eg. the PDFs -- on this page?
> >>
> >> http://www.rabbitmq.com/dotnet.html
> >>
> >> alexis
> >>
> >>
> >> On Wed, Jul 15, 2009 at 11:43 AM, Wilson Ke<wilson.ke at wealthcraft.com>
> >> wrote:
> >> > Hi all,
> >> >
> >> >      I am use Wcf and RabbitMQ to make project.  I can use Wcf bind
> >> > RabbitMQ
> >> > to work normal as below ,but I don?t know how to make Wcf bind to
> >> > rabbitmq
> >> > exchange and queue, could you help me? Many thanks!
> >> >
> >> >
> >> >
> >> > C# code:
> >> >
> >> > namespace Server
> >> >
> >> > {
> >> >
> >> >     using System;
> >> >
> >> >     using System.ServiceModel;
> >> >
> >> >     using WcfServiceLibrary1;
> >> >
> >> >     using RabbitMQ.ServiceModel;
> >> >
> >> >
> >> >
> >> >     class Server
> >> >
> >> >     {
> >> >
> >> >         public void Run()
> >> >
> >> >         {
> >> >
> >> >
> >> >
> >> >
> >> >
> >> >
> >> >
> >> >             ServiceHost host = new ServiceHost(typeof(HelloService));
> >> >
> >> >             host.Open();
> >> >
> >> >
> >> >
> >> >             Console.WriteLine("Service Ready");
> >> >
> >> >             Console.ReadLine();
> >> >
> >> >
> >> >
> >> >             host.Close();
> >> >
> >> >         }
> >> >
> >> >     }
> >> >
> >> > }
> >> >
> >> >
> >> >
> >> > Config file:
> >> >
> >> > <?xml version="1.0" encoding="utf-8" ?>
> >> >
> >> > <configuration>
> >> >
> >> >   <system.serviceModel>
> >> >
> >> >
> >> >
> >> >     <services>
> >> >
> >> >       <service name="WcfServiceLibrary1.HelloService">
> >> >
> >> >         <host>
> >> >
> >> >           <baseAddresses>
> >> >
> >> >             <add baseAddress="soap.amqp:///"   />
> >> >
> >> >           </baseAddresses>
> >> >
> >> >         </host>
> >> >
> >> >         <endpoint
> >> >
> >> >           address="Hello"
> >> >
> >> >           binding="rabbitMQBinding"
> >> >
> >> >           bindingConfiguration="rabbitMQConfig"
> >> >
> >> >           contract="WcfServiceLibrary1.IHelloContract"/>
> >> >
> >> >       </service>
> >> >
> >> >     </services>
> >> >
> >> >     <bindings>
> >> >
> >> >       <rabbitMQBinding>
> >> >
> >> >         <binding name="rabbitMQConfig"
> >> >
> >> >           broker="amqp://192.168.1.87:5672/"
> >> >
> >> >           protocolversion="AMQP_0_8"
> >> >
> >> >          oneWay="false"
> >> >
> >> >                     />
> >> >
> >> >       </rabbitMQBinding>
> >> >
> >> >     </bindings>
> >> >
> >> >
> >> >
> >> >     <extensions>
> >> >
> >> >       <bindingExtensions>
> >> >
> >> >         <add
> >> >
> >> >           name="rabbitMQBinding"
> >> >
> >> >           type="RabbitMQ.ServiceModel.RabbitMQBindingSection,
> >> > RabbitMQ.ServiceModel, Version=1.0.110.0, Culture=neutral,
> >> > PublicKeyToken=null"/>
> >> >
> >> >       </bindingExtensions>
> >> >
> >> >     </extensions>
> >> >
> >> >
> >> >
> >> >   </system.serviceModel>
> >> >
> >> > </configuration>
> >> >
> >> > _______________________________________________
> >> > rabbitmq-discuss mailing list
> >> > rabbitmq-discuss at lists.rabbitmq.com
> >> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >> >
> >> >
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090715/227e8068/attachment.htm 

From ewaters at gmail.com  Wed Jul 15 17:24:40 2009
From: ewaters at gmail.com (Eric Waters)
Date: Wed, 15 Jul 2009 10:24:40 -0600
Subject: [rabbitmq-discuss] Perl AMQP client software in github
In-Reply-To: <167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>
References: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>
	<167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>
Message-ID: <353587920907150924r2c7cb53as85e4ea4f5d169d9a@mail.gmail.com>

I choose to create two separate projects to allow for the greatest
flexibility in implementing client or server software.
Net::AMQP is a OO representation of the protocol.  It uses the XML spec to
dynamically create new classes in a Net::AMQP::Protocol:: namespace.  The
chief purpose of this is to (de)serialize the wire-level encoding of AMQP
frames and provide convenient OO representation of the frames.

POE::Component::Client::AMQP is an asynchronous client module which
establishes the TCP connection to the server and uses Net::AMQP for it's
(de)serialization of the frames.  It has to know some of the basics of the
protocol, such as the connection grammar Start/StartOk, Tune/TuneOk, etc
(though, now that I think of it, it's possible this could be moved to
Net::AMQP as well).  It uses the data in Net::AMQP to automatically handle
synchronous methods and their expected responses and content header
building.  Ultimately POE::Component::Client::AMQP offers simply a channel
for sending Net::AMQP packets and handling their responses, allowing you to
write complex clients without worrying about the details of connecting and
the protocol.

POE is a reactor pattern (http://en.wikipedia.org/wiki/Reactor_pattern) for
Perl.  It is similar to Twisted for Python and EventMachine for Ruby.  Some
people aren't fond of programming with the reactor pattern, as it's more
difficult to track what's
happening at any given moment, and one can't usually write linear
code.  For this reason, it's likely that another Perl client will be
instituted (lenz
is working on Net::AMQP::Simple) that will probably use IO::Socket directly.

Eric

On Wed, Jul 15, 2009 at 2:41 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Eric
>
> Thanks for this.  I'm not familiar with Perl so please can you explain
> how the two projects relate to each other?  Should they always be used
> together?
>
> alexis
>
>
> On Sat, Jul 11, 2009 at 12:06 AM, Eric Waters<ewaters at gmail.com> wrote:
> > I'll avoid talking about something that's not specific to
> > RabbitMQ in this forum in the
> >
> future, but wanted to mention this as a follow up to a post earlier this week.
> >
> I now have functioning code released for Net::AMQP and POE::Component::Client::AMQP.  Tested it against RabbitMQ 1.6.0.  Get it from
> http://github.com/ewaters.  You'll need to clone both repositories
> > to run the example pingpong.pl program (idea copied from ruby-amqp).
> > To try it out, clone both projects into the same directory, cd into
> > poe-component-client-amqp, and run:
> >   DEBUG=0 perl -Ilib -I../net-amqp/lib examples/pingpong.pl
> > ../net-amqp/spec/amqp0-8.xml
> > If you'd like to see the full protocol debug, change DEBUG=1.
> > The perl modules are fully documented in POD.  If anyone is interested,
> I'd
> > love for collaboration on the project.  Drop me a line with your github
> > username and I'll add you as a github collaborator.
> > Sorry for the interruption.  Back to your regularly scheduled RabbitMQ
> > programming.  :)
> > Eric
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090715/bd69fdb2/attachment.htm 

From pekenney at gmail.com  Wed Jul 15 21:45:20 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Wed, 15 Jul 2009 13:45:20 -0700
Subject: [rabbitmq-discuss] Multicast in a transaction
Message-ID: <3a5f03340907151345w138f5692t90c994087523d0dd@mail.gmail.com>

Does RabbitMQ support Multicast in a transaction?

examples?

can not find this one...

thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090715/aee305ad/attachment.htm 

From 0x6e6562 at gmail.com  Wed Jul 15 23:17:45 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 15 Jul 2009 23:17:45 +0100
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <4A5CA116.4030208@worldlingo.com>
References: <4A5718A3.9000807@worldlingo.com>
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
	<4A5C206F.9070901@worldlingo.com>
	<B61B9153-2239-4E6A-B759-9669BC046CC8@gmail.com>
	<4A5CA116.4030208@worldlingo.com>
Message-ID: <269388e30907151517m37d7e2c6w434c7aefe4590836@mail.gmail.com>

Lars,

On Tue, Jul 14, 2009 at 4:15 PM, Lars George<lars at worldlingo.com> wrote:
> Hi Ben,
>
> The code is really straight forward. Here is the Listener:

You appear to have hard coded the name of the host that you installed
the broker onto.

Also, you didn't send the definition of the TestConsumer.

Having compilable and runnable code does make life a lot easier when
debugging stuff :-)

I'll see how I get on.

Ben



From 0x6e6562 at gmail.com  Wed Jul 15 23:31:20 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 15 Jul 2009 23:31:20 +0100
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <4A5CA116.4030208@worldlingo.com>
References: <4A5718A3.9000807@worldlingo.com>
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
	<4A5C206F.9070901@worldlingo.com>
	<B61B9153-2239-4E6A-B759-9669BC046CC8@gmail.com>
	<4A5CA116.4030208@worldlingo.com>
Message-ID: <269388e30907151531n58a9b2c6hace9c81196442269@mail.gmail.com>

Lars,

On Tue, Jul 14, 2009 at 4:15 PM, Lars George<lars at worldlingo.com> wrote:
> The code is really straight forward. Here is the Listener:

Assuming that I've guestimated your actual code correctly (see earlier
post), I can't reproduce this behaviour.

That's not to say that it's not happening for you, it's just that when
I run your code as described, flow control works as I would expect.

Having said that, maybe you could package something up that does not
require (or allow) me to tinker with any parameters, so that I can
reproduce your problem. A complete m2 client would probably do the
trick.

HTH,

Ben



From 0x6e6562 at gmail.com  Wed Jul 15 23:33:30 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 15 Jul 2009 23:33:30 +0100
Subject: [rabbitmq-discuss] Multicast in a transaction
In-Reply-To: <3a5f03340907151345w138f5692t90c994087523d0dd@mail.gmail.com>
References: <3a5f03340907151345w138f5692t90c994087523d0dd@mail.gmail.com>
Message-ID: <269388e30907151533j6e224ae6v27e302026145cfb4@mail.gmail.com>

Patrick,

On Wed, Jul 15, 2009 at 9:45 PM, Patrick Kenney<pekenney at gmail.com> wrote:
> Does RabbitMQ support Multicast in a transaction?

What exactly do you mean by multicast? I'm assuming that you're aware
how routing works in AMQP in general.

HTH,

Ben



From 0x6e6562 at gmail.com  Wed Jul 15 23:39:25 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 15 Jul 2009 23:39:25 +0100
Subject: [rabbitmq-discuss] how to make Wcf bind to rabbitmq exchange
	and queue?
In-Reply-To: <3a5f03340907150855h7c75d1e3t15c239894680eca8@mail.gmail.com>
References: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>
	<167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD698A1AAFD1@EXMBX01.wealthcraft.local>
	<167204d20907150347l1c98680ao22abf760c47e761c@mail.gmail.com>
	<3a5f03340907150743y330741c6o2da65e090a825fe2@mail.gmail.com>
	<167204d20907150747k776a6685n9fe03ec7c0c1a51c@mail.gmail.com>
	<3a5f03340907150855h7c75d1e3t15c239894680eca8@mail.gmail.com>
Message-ID: <269388e30907151539n22c03186m556ee5f320f61b7f@mail.gmail.com>

Patrick,

On Wed, Jul 15, 2009 at 4:55 PM, Patrick Kenney<pekenney at gmail.com> wrote:
> RabbitMQ .NET client library API guide has a few snippets... no fully
> functional ready to run examples...
> RabbitMQ .NET Client Library User Guide... ditto, although it does reference
> examples in section 6, building the samples is problematic, using visual
> studio as documented and the related samples are not part of a ready to run
> solution, that you can walk through in debug mode in visual studio,
> AddClient, AddServer, DeclareQueue etc... and they are individual console,
> widgets...

If you download the binary tarball, it contains the sources and
binaries of each example, so that you don't need to compile it if you
don't want to.

Having said that, all you have to get things going in VS is to add the
dll as a reference, copy and paste the example code and away you go.

Ben



From 0x6e6562 at gmail.com  Wed Jul 15 23:48:11 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 15 Jul 2009 23:48:11 +0100
Subject: [rabbitmq-discuss] RabbitMQ 1.6 persistence?
In-Reply-To: <658AD87BE18A64499819C89D6FCAAD963C069908@SIMON.mobileaccord.local>
References: <658AD87BE18A64499819C89D6FCAAD963C069908@SIMON.mobileaccord.local>
Message-ID: <269388e30907151548n7999dbafs1a942879e95e91ba@mail.gmail.com>

Chris,

On Tue, Jul 14, 2009 at 11:59 PM, Chris
Wiegand<cwiegand at mobileaccord.com> wrote:
> I?m finding that if the erlang session dies

What do you mean by Erlang session? Do you mean that the Erlang VM process dies?

> (like say if I kill it, or try to pump in 1 million
> messages and it runs out of memory),

In 1.6.0 every message is resident in memory - solution to this is
being developed ATM.

> and then I re-start the RabbitMQ server
> it takes a rather long time to load the persistence stuff, but then just
> clears out the queues, and the file (rabbit_persister.LOG) just gets
> truncated and the messages were not persisted.
>
>
>
> Am I misunderstanding how RabbitMQ implements persistence? I expected that
> if the broker stops, and then gets relaunched that it would reload the last
> saved state for the queues, etc.., but that doesn?t seem to be taking place.
> We?re running it under Windows, under the most recent version of erlang
> (also just downloaded last week), in case that would affect anything. I?ll
> try this under Linux and OpenSolaris here soon, in case that makes a
> difference.
>
>
>
> I?m using the .Net bindings, and setting the BasicProperties? DeliveryMode
> to 2 for persistence, is there anything else I have to do to make a queue
> persist?

OFV and if you have queues bound to your exchanges, what you are
describing should probably not be happening. Can you give us a cut
down version of your code that reproduces this behaviour?

Ben



From 0x6e6562 at gmail.com  Wed Jul 15 23:54:57 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 15 Jul 2009 23:54:57 +0100
Subject: [rabbitmq-discuss] Durable queues and high availability (broker
	failage)
In-Reply-To: <185945640906290212t54a0ea15lcf1d6595f48d833a@mail.gmail.com>
References: <4A488522.9000003@eintr.org>
	<185945640906290212t54a0ea15lcf1d6595f48d833a@mail.gmail.com>
Message-ID: <269388e30907151554l17b69d6fv1147a10fac36833f@mail.gmail.com>

Daniel,

On Mon, Jun 29, 2009 at 10:12 AM, Daniel Lundin<dln at eintr.org> wrote:
> Q1) Is there some notification mechanism to rely on to reliably tell a
> queues has failed so apps can take measures to manage the failure, i.e
> recreate the queue or set up a "temporary fail" queue?

Not really.

> Q2) Is there a way to "replay" recovered messages from the failed,
> no-longer-relevant queue, into the newly/upon-failure created one? This
> seems it would allow graceful recovery, even automatically so, once the
> failed node does come back up.

Yes, persistent messages will be re-queued when a node is rehydrated.
This is a manual process though.

> So, what is the preferred way to handle node failure in a real-life
> rabbitmq-based app today?

I should think most people currently use a replicated FS to back
persistent messages with and monitor each node with something like
nagios.

HTH,

Ben



From 0x6e6562 at gmail.com  Wed Jul 15 23:57:52 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Wed, 15 Jul 2009 23:57:52 +0100
Subject: [rabbitmq-discuss] opposite of basicAck?
In-Reply-To: <84fb38e30906250957od213dfl139022812d19a57a@mail.gmail.com>
References: <84fb38e30906250957od213dfl139022812d19a57a@mail.gmail.com>
Message-ID: <269388e30907151557v69eb5ed3t8429423e30f2dec3@mail.gmail.com>

Tsuraan,

On Thu, Jun 25, 2009 at 5:57 PM, tsuraan<tsuraan at gmail.com> wrote:
> If I have a message that I know that I don't want to handle right now,
> is there something like basicAck that rejects a deliveryTag instead of
> acking it? ?IIRC, after some timeout, or a channel close, the message
> will be queued for redelivery, but I have a case where I know that a
> message I received isn't useful for me yet, so I'd like to immediately
> reject it so I can pick it up later. ?Is that possible?

0-8 rejections, were Rabbit to implement them, are scoped on a
channel. Just nuking the channel and letting them get consumed on a
different channel has the same effect.

Ben



From wilson.ke at wealthcraft.com  Thu Jul 16 02:36:38 2009
From: wilson.ke at wealthcraft.com (Wilson Ke)
Date: Thu, 16 Jul 2009 09:36:38 +0800
Subject: [rabbitmq-discuss] how to make Wcf bind to rabbitmq exchange
 and queue?
In-Reply-To: <167204d20907150347l1c98680ao22abf760c47e761c@mail.gmail.com>
References: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>
	<167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD698A1AAFD1@EXMBX01.wealthcraft.local>
	<167204d20907150347l1c98680ao22abf760c47e761c@mail.gmail.com>
Message-ID: <8F16BDCC98E64841857E711110AF5EDD698A1AAFD8@EXMBX01.wealthcraft.local>

Dear all,

     Thanks for your reply. But I have read doc and example code for several times. But can't fine answer. I want to use Wcf to bind the special queue by queue name, just like below code. But I want to use Wcf to implement. Could you show some sample code



        private int SendString(string message)

        {

            try

            {



                string serverAddress = "192.168.1.87";

                string exchange = "yourexchange";

                string exchangeType = ExchangeType.Topic;

                string routingKey = "key";



                using (IConnection conn = new ConnectionFactory().CreateConnection(serverAddress))

                {

                    using (IModel ch = conn.CreateModel())

                    {





                        if (exchange != "")

                        {

                            ch.ExchangeDeclare(exchange, exchangeType,true,false,false,false,false,null);

                        }

                        ch.QueueBind("subscriptionqueue", exchange, routingKey, false, null);//how to bind by using Wcf?

                        ch.BasicPublish(exchange,

                                        routingKey,

                                        null,

                                        Encoding.UTF8.GetBytes(message));

                        return 0;

                    }

                }

            }

            catch (Exception e)

            {

                MessageBox.Show(e.Message);

                return 2;

            }

        }





-----Original Message-----
From: Alexis Richardson [mailto:alexis.richardson at gmail.com]
Sent: 2009?7?15? 18:47
To: Wilson Ke
Cc: rabbitmq-discuss
Subject: Re: [rabbitmq-discuss] how to make Wcf bind to rabbitmq exchange and queue?



Wilson



Have you read the documentation -- eg. the PDFs -- on this page?



http://www.rabbitmq.com/dotnet.html



alexis





On Wed, Jul 15, 2009 at 11:43 AM, Wilson Ke<wilson.ke at wealthcraft.com> wrote:

> Hi all,

>

>      I am use Wcf and RabbitMQ to make project.  I can use Wcf bind RabbitMQ

> to work normal as below ,but I don?t know how to make Wcf bind to rabbitmq

> exchange and queue, could you help me? Many thanks!

>

>

>

> C# code:

>

> namespace Server

>

> {

>

>     using System;

>

>     using System.ServiceModel;

>

>     using WcfServiceLibrary1;

>

>     using RabbitMQ.ServiceModel;

>

>

>

>     class Server

>

>     {

>

>         public void Run()

>

>         {

>

>

>

>

>

>

>

>             ServiceHost host = new ServiceHost(typeof(HelloService));

>

>             host.Open();

>

>

>

>             Console.WriteLine("Service Ready");

>

>             Console.ReadLine();

>

>

>

>             host.Close();

>

>         }

>

>     }

>

> }

>

>

>

> Config file:

>

> <?xml version="1.0" encoding="utf-8" ?>

>

> <configuration>

>

>   <system.serviceModel>

>

>

>

>     <services>

>

>       <service name="WcfServiceLibrary1.HelloService">

>

>         <host>

>

>           <baseAddresses>

>

>             <add baseAddress="soap.amqp:///"   />

>

>           </baseAddresses>

>

>         </host>

>

>         <endpoint

>

>           address="Hello"

>

>           binding="rabbitMQBinding"

>

>           bindingConfiguration="rabbitMQConfig"

>

>           contract="WcfServiceLibrary1.IHelloContract"/>

>

>       </service>

>

>     </services>

>

>     <bindings>

>

>       <rabbitMQBinding>

>

>         <binding name="rabbitMQConfig"

>

>           broker="amqp://192.168.1.87:5672/"

>

>           protocolversion="AMQP_0_8"

>

>          oneWay="false"

>

>                     />

>

>       </rabbitMQBinding>

>

>     </bindings>

>

>

>

>     <extensions>

>

>       <bindingExtensions>

>

>         <add

>

>           name="rabbitMQBinding"

>

>           type="RabbitMQ.ServiceModel.RabbitMQBindingSection,

> RabbitMQ.ServiceModel, Version=1.0.110.0, Culture=neutral,

> PublicKeyToken=null"/>

>

>       </bindingExtensions>

>

>     </extensions>

>

>

>

>   </system.serviceModel>

>

> </configuration>

>

> _______________________________________________

> rabbitmq-discuss mailing list

> rabbitmq-discuss at lists.rabbitmq.com

> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

>

>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/df242863/attachment.htm 

From lynton.grice at logosworld.com  Thu Jul 16 10:48:13 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Thu, 16 Jul 2009 11:48:13 +0200
Subject: [rabbitmq-discuss] RabbitMQ message monitoring directly via Mnesia
	tables?
Message-ID: <000001ca05fa$9331d580$b9958080$@grice@logosworld.com>

Hi there,

 

If messages are persisted on RabbitMQ can someone interrogate the message
data by directly accessing the Mnesia tables? Or are the Mnesia tables only
for admin / configuration data?

 

Basically I have a setup where I would like to be able to see message
details on the queue/s without pulling the messages off.....

 

If the messages are not persisted to Mnesia where are they kept? In a file
on disk?

 

Thanks for the help, much appreciated ;-)

 

Lynton

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/47995aa3/attachment.htm 

From alexis.richardson at gmail.com  Thu Jul 16 11:07:27 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 16 Jul 2009 11:07:27 +0100
Subject: [rabbitmq-discuss] RabbitMQ message monitoring directly via
	Mnesia tables?
In-Reply-To: <-5334770247457749045@unknownmsgid>
References: <-5334770247457749045@unknownmsgid>
Message-ID: <167204d20907160307g25be45a1vb10607a8996fe304@mail.gmail.com>

Lynton

On Thu, Jul 16, 2009 at 10:48 AM, Lynton
Grice<lynton.grice at logosworld.com> wrote:
> Hi there,
>
>
>
> If messages are persisted on RabbitMQ can someone interrogate the message
> data by directly accessing the Mnesia tables? Or are the Mnesia tables only
> for admin / configuration data?

Mnesia only stores the routing tables and config data.


> Basically I have a setup where I would like to be able to see message
> details on the queue/s without pulling the messages off.....

Ah yes :-)

I don't think this is currently supported.


> If the messages are not persisted to Mnesia where are they kept? In a file
> on disk?

Yes, that is correct.  Messages are journalled to disk for recovery.

One thing that people have asked for is 'pluggable persistence' in
which messages can also be stored in $YOUR_FAVOURITE_DATABASE

alexis




> Thanks for the help, much appreciated ;-)
>
>
>
> Lynton
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From wilson.ke at wealthcraft.com  Thu Jul 16 11:33:52 2009
From: wilson.ke at wealthcraft.com (Wilson Ke)
Date: Thu, 16 Jul 2009 18:33:52 +0800
Subject: [rabbitmq-discuss] RabbitMQ message monitoring directly
	via	Mnesia tables?
In-Reply-To: <167204d20907160307g25be45a1vb10607a8996fe304@mail.gmail.com>
References: <-5334770247457749045@unknownmsgid>
	<167204d20907160307g25be45a1vb10607a8996fe304@mail.gmail.com>
Message-ID: <8F16BDCC98E64841857E711110AF5EDD698A1AB058@EXMBX01.wealthcraft.local>


RabbitMQInputChannel class of RabbitMQ.ServiceModel namespace is not public class ?




From lynton.grice at logosworld.com  Thu Jul 16 11:35:54 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Thu, 16 Jul 2009 12:35:54 +0200
Subject: [rabbitmq-discuss] RabbitMQ message monitoring directly via
	Mnesia tables?
In-Reply-To: <167204d20907160307g25be45a1vb10607a8996fe304@mail.gmail.com>
References: <-5334770247457749045@unknownmsgid>
	<167204d20907160307g25be45a1vb10607a8996fe304@mail.gmail.com>
Message-ID: <000001ca0601$53f660f0$fbe322d0$@grice@logosworld.com>

Hi Alexis,

Many thanks for the comments, much appreciated.

On the "pluggable persistence" I think there is already some CouchDB
replication of messages already?
https://dev.rabbitmq.com/wiki/RabbitCouchRelay


I look forward to when we can see message data in RabbitMQ without pulling
off the messages...

Thanks again ;-)

Lynton

-----Original Message-----
From: Alexis Richardson [mailto:alexis.richardson at gmail.com] 
Sent: 16 July 2009 12:07 PM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ message monitoring directly via
Mnesia tables?

Lynton

On Thu, Jul 16, 2009 at 10:48 AM, Lynton
Grice<lynton.grice at logosworld.com> wrote:
> Hi there,
>
>
>
> If messages are persisted on RabbitMQ can someone interrogate the message
> data by directly accessing the Mnesia tables? Or are the Mnesia tables
only
> for admin / configuration data?

Mnesia only stores the routing tables and config data.


> Basically I have a setup where I would like to be able to see message
> details on the queue/s without pulling the messages off.....

Ah yes :-)

I don't think this is currently supported.


> If the messages are not persisted to Mnesia where are they kept? In a file
> on disk?

Yes, that is correct.  Messages are journalled to disk for recovery.

One thing that people have asked for is 'pluggable persistence' in
which messages can also be stored in $YOUR_FAVOURITE_DATABASE

alexis




> Thanks for the help, much appreciated ;-)
>
>
>
> Lynton
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>




From alexis.richardson at gmail.com  Thu Jul 16 11:39:42 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 16 Jul 2009 11:39:42 +0100
Subject: [rabbitmq-discuss] RabbitMQ message monitoring directly via
	Mnesia tables?
In-Reply-To: <8F16BDCC98E64841857E711110AF5EDD698A1AB058@EXMBX01.wealthcraft.local>
References: <-5334770247457749045@unknownmsgid>
	<167204d20907160307g25be45a1vb10607a8996fe304@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD698A1AB058@EXMBX01.wealthcraft.local>
Message-ID: <167204d20907160339y5bb2b2f7wee676f694a60f91d@mail.gmail.com>

On Thu, Jul 16, 2009 at 11:33 AM, Wilson Ke<wilson.ke at wealthcraft.com> wrote:
>
> RabbitMQInputChannel class of RabbitMQ.ServiceModel namespace is not public class ?

What does the source code say?



From alexis.richardson at gmail.com  Thu Jul 16 11:42:06 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 16 Jul 2009 11:42:06 +0100
Subject: [rabbitmq-discuss] RabbitMQ message monitoring directly via
	Mnesia tables?
In-Reply-To: <-122057331042237195@unknownmsgid>
References: <-5334770247457749045@unknownmsgid>
	<167204d20907160307g25be45a1vb10607a8996fe304@mail.gmail.com>
	<-122057331042237195@unknownmsgid>
Message-ID: <167204d20907160342q207a0f1dw3449c356867927ec@mail.gmail.com>

On Thu, Jul 16, 2009 at 11:35 AM, Lynton
Grice<lynton.grice at logosworld.com> wrote:
> Hi Alexis,
>
> Many thanks for the comments, much appreciated.
>
> On the "pluggable persistence" I think there is already some CouchDB
> replication of messages already?
> https://dev.rabbitmq.com/wiki/RabbitCouchRelay

Yes there has been some dabbling but nothing 'integrated'.  What you
see is a write-behind store, not really very different from consuming
and writing to a database.




> I look forward to when we can see message data in RabbitMQ without pulling
> off the messages...

Agreed, it could be useful.  My understanding from the engineering
team is that it's not a trivial thing to implement properly.

alexis





> Thanks again ;-)
>
> Lynton
>
> -----Original Message-----
> From: Alexis Richardson [mailto:alexis.richardson at gmail.com]
> Sent: 16 July 2009 12:07 PM
> To: Lynton Grice
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] RabbitMQ message monitoring directly via
> Mnesia tables?
>
> Lynton
>
> On Thu, Jul 16, 2009 at 10:48 AM, Lynton
> Grice<lynton.grice at logosworld.com> wrote:
>> Hi there,
>>
>>
>>
>> If messages are persisted on RabbitMQ can someone interrogate the message
>> data by directly accessing the Mnesia tables? Or are the Mnesia tables
> only
>> for admin / configuration data?
>
> Mnesia only stores the routing tables and config data.
>
>
>> Basically I have a setup where I would like to be able to see message
>> details on the queue/s without pulling the messages off.....
>
> Ah yes :-)
>
> I don't think this is currently supported.
>
>
>> If the messages are not persisted to Mnesia where are they kept? In a file
>> on disk?
>
> Yes, that is correct. ?Messages are journalled to disk for recovery.
>
> One thing that people have asked for is 'pluggable persistence' in
> which messages can also be stored in $YOUR_FAVOURITE_DATABASE
>
> alexis
>
>
>
>
>> Thanks for the help, much appreciated ;-)
>>
>>
>>
>> Lynton
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>



From lars at worldlingo.com  Thu Jul 16 13:23:26 2009
From: lars at worldlingo.com (Lars George)
Date: Thu, 16 Jul 2009 14:23:26 +0200
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <269388e30907151531n58a9b2c6hace9c81196442269@mail.gmail.com>
References: <4A5718A3.9000807@worldlingo.com>	
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>	
	<4A5C206F.9070901@worldlingo.com>	
	<B61B9153-2239-4E6A-B759-9669BC046CC8@gmail.com>	
	<4A5CA116.4030208@worldlingo.com>
	<269388e30907151531n58a9b2c6hace9c81196442269@mail.gmail.com>
Message-ID: <4A5F1BBE.1050600@worldlingo.com>

Hi Ben,

I sent you the source in a separate message. Please let me know if that 
helps or if you want me to send you the compiled classes too. Yes, the 
host is hardcoded, that is the only real dependency which is of course 
easily changed. If you like I can change the code so that the host is a 
command line option too. Please advise.

What is an m2 client?

Lars

Ben Hood wrote:
> Lars,
>
> On Tue, Jul 14, 2009 at 4:15 PM, Lars George<lars at worldlingo.com> wrote:
>   
>> The code is really straight forward. Here is the Listener:
>>     
>
> Assuming that I've guestimated your actual code correctly (see earlier
> post), I can't reproduce this behaviour.
>
> That's not to say that it's not happening for you, it's just that when
> I run your code as described, flow control works as I would expect.
>
> Having said that, maybe you could package something up that does not
> require (or allow) me to tinker with any parameters, so that I can
> reproduce your problem. A complete m2 client would probably do the
> trick.
>
> HTH,
>
> Ben
>
>   
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lars.vcf
Type: text/x-vcard
Size: 301 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/223da646/attachment.vcf 

From 0x6e6562 at gmail.com  Thu Jul 16 14:34:59 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 16 Jul 2009 14:34:59 +0100
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <4A5F1BBE.1050600@worldlingo.com>
References: <4A5718A3.9000807@worldlingo.com>
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
	<4A5C206F.9070901@worldlingo.com>
	<B61B9153-2239-4E6A-B759-9669BC046CC8@gmail.com>
	<4A5CA116.4030208@worldlingo.com>
	<269388e30907151531n58a9b2c6hace9c81196442269@mail.gmail.com>
	<4A5F1BBE.1050600@worldlingo.com>
Message-ID: <269388e30907160634q66681ed9w627e639d9fd7ccb2@mail.gmail.com>

Lars,

On Thu, Jul 16, 2009 at 1:23 PM, Lars George<lars at worldlingo.com> wrote:
> I sent you the source in a separate message. Please let me know if that
> helps or if you want me to send you the compiled classes too. Yes, the host
> is hardcoded, that is the only real dependency which is of course easily
> changed. If you like I can change the code so that the host is a command
> line option too. Please advise.

Ok, I've just run this code and the behavior is the same as yesterday,
i.e. I my observations do not concur with yours.

When setting prefetch to 1, the internal queue never grows bigger than
one, which is inline with what it with what it is designed to do.

When I turn off QoS, the maximum queue depth I observed was about 150,
but YMMV of course.

Hence, I can't really help in this case since I cannot reproduce the issue.

> What is an m2 client?

I meant that you cook up a maven pom to that will run everything. I
don't know if this will shed any light on the situation, because I
imported your code and the only thing I modified was the hostname and
the namespace of the classes.

Hence, I'm at a loss as to what could be going wrong - the only think
that I can think is that you may using a earlier version of Rabbit
(although you said that you've upgraded to 1.6.0) and if you were, I'd
expect to see something in the server logs.

Ben



From brownspice at gmail.com  Thu Jul 16 15:22:06 2009
From: brownspice at gmail.com (amit bhatnagar)
Date: Thu, 16 Jul 2009 07:22:06 -0700 (PDT)
Subject: [rabbitmq-discuss] opposite of basicAck?
In-Reply-To: <269388e30907151557v69eb5ed3t8429423e30f2dec3@mail.gmail.com>
References: <84fb38e30906250957od213dfl139022812d19a57a@mail.gmail.com> 
	<269388e30907151557v69eb5ed3t8429423e30f2dec3@mail.gmail.com>
Message-ID: <6ec6c0ed-9b7c-4648-b527-11fdb4d14007@d9g2000prh.googlegroups.com>

When you do this by closing the channel, (essentially faking a
Basic.Reject), the message gets put back on the queue and gets ready
for consumption by another consumer (or channel from same consumer if
it had more than one channel).

a) Is the producer registering for an BasicReturn listener the proper
mechanism to be informed that the message was undeliverable?

b) If a is true, how long would the message sit on the queue waiting
for a potential consumer to pick it up before the basic.return was
generated by the broker back for the producer?

c) If no such BasicReturn listener was registered, the message gets
dropped?

On Jul 15, 4:57?pm, Ben Hood <0x6e6... at gmail.com> wrote:
> 0-8 rejections, were Rabbit to implement them, are scoped on a
> channel. Just nuking the channel and letting them get consumed on a
> different channel has the same effect.
>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-disc... at lists.rabbitmq.comhttp://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From alexis.richardson at gmail.com  Thu Jul 16 15:25:53 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 16 Jul 2009 15:25:53 +0100
Subject: [rabbitmq-discuss] Multicast in a transaction
In-Reply-To: <269388e30907151533j6e224ae6v27e302026145cfb4@mail.gmail.com>
References: <3a5f03340907151345w138f5692t90c994087523d0dd@mail.gmail.com>
	<269388e30907151533j6e224ae6v27e302026145cfb4@mail.gmail.com>
Message-ID: <167204d20907160725x45518913y779df2a50b1fc523@mail.gmail.com>

Patrick

What Ben said.

Plus ... Do you mean 'delivery to more than one queue'?  Yes, you can
group these into a TX class transaction, which I recommend you see as
a way of grouping a stream of messages.

In AMQP 0-8/0-9-1 we suggest ***care*** with TX, in particular when
combining TX with multiple deliveries, queues, and the 'mandatory' or
'immediate' flags.

alexis


On Wed, Jul 15, 2009 at 11:33 PM, Ben Hood<0x6e6562 at gmail.com> wrote:
> Patrick,
>
> On Wed, Jul 15, 2009 at 9:45 PM, Patrick Kenney<pekenney at gmail.com> wrote:
>> Does RabbitMQ support Multicast in a transaction?
>
> What exactly do you mean by multicast? I'm assuming that you're aware
> how routing works in AMQP in general.
>
> HTH,
>
> Ben
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From Tammo.Filusch at btc-ag.com  Thu Jul 16 15:45:56 2009
From: Tammo.Filusch at btc-ag.com (Tammo.Filusch at btc-ag.com)
Date: Thu, 16 Jul 2009 16:45:56 +0200
Subject: [rabbitmq-discuss] "None of the specified endpoints were reachable"
Message-ID: <D7F3579680FB2F4B9A040F9BC78865F76445E65B82@OLCA9095.btcnet.btc-ag.com>

Hy,

i?m building a client server .net application that uses rabbitmq as mom.

the code i?m using to pulish messages is:

                          IProtocol protocol = Protocols.FromEnvironment();
                    IConnection conn = factory.CreateConnection(rmqBrokerUrl);
                    IModel channel  = conn.CreateModel();
                    conn.AutoClose = true;
                    IBasicProperties props = channel.CreateBasicProperties();
                    channel.BasicPublish(exchange, routingKey, props, buffer);
                    channel.Close(200, "Goodbye");




after sending about 4000msg each in a single thread using the above code,  im getting error that states:

"None of the specified endpoints were reachable".



any hints on this?

thanks a lot,

Tammo




-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/695a7aed/attachment.htm 

From pekenney at gmail.com  Thu Jul 16 15:49:09 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Thu, 16 Jul 2009 07:49:09 -0700
Subject: [rabbitmq-discuss] Multicast in a transaction
In-Reply-To: <167204d20907160725x45518913y779df2a50b1fc523@mail.gmail.com>
References: <3a5f03340907151345w138f5692t90c994087523d0dd@mail.gmail.com>
	<269388e30907151533j6e224ae6v27e302026145cfb4@mail.gmail.com>
	<167204d20907160725x45518913y779df2a50b1fc523@mail.gmail.com>
Message-ID: <3a5f03340907160749s627f68a5x47cfe9fe58fb7d46@mail.gmail.com>

Yes, 'delivery to more than one queue' of the same message...

the amqp spec infers its supported, but not very clearly one way or the
other...

basically i want to be able to send the same message to one or more
subscribers while in a transaction, this is typically called multi-cast as I
understand it...

re:
On Thu, Jul 16, 2009 at 7:25 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> Patrick
>
> What Ben said.
>
> Plus ... Do you mean 'delivery to more than one queue'?  Yes, you can
> group these into a TX class transaction, which I recommend you see as
> a way of grouping a stream of messages.
>
> In AMQP 0-8/0-9-1 we suggest ***care*** with TX, in particular when
> combining TX with multiple deliveries, queues, and the 'mandatory' or
> 'immediate' flags.
>
> alexis
>
>
> On Wed, Jul 15, 2009 at 11:33 PM, Ben Hood<0x6e6562 at gmail.com> wrote:
> > Patrick,
> >
> > On Wed, Jul 15, 2009 at 9:45 PM, Patrick Kenney<pekenney at gmail.com>
> wrote:
> >> Does RabbitMQ support Multicast in a transaction?
> >
> > What exactly do you mean by multicast? I'm assuming that you're aware
> > how routing works in AMQP in general.
> >
> > HTH,
> >
> > Ben
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/0cb2595a/attachment.htm 

From alexis.richardson at gmail.com  Thu Jul 16 15:51:30 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 16 Jul 2009 15:51:30 +0100
Subject: [rabbitmq-discuss] Multicast in a transaction
In-Reply-To: <3a5f03340907160749s627f68a5x47cfe9fe58fb7d46@mail.gmail.com>
References: <3a5f03340907151345w138f5692t90c994087523d0dd@mail.gmail.com>
	<269388e30907151533j6e224ae6v27e302026145cfb4@mail.gmail.com>
	<167204d20907160725x45518913y779df2a50b1fc523@mail.gmail.com>
	<3a5f03340907160749s627f68a5x47cfe9fe58fb7d46@mail.gmail.com>
Message-ID: <167204d20907160751s1a9e888esfba74da846ac34af@mail.gmail.com>

On Thu, Jul 16, 2009 at 3:49 PM, Patrick Kenney<pekenney at gmail.com> wrote:
> Yes, 'delivery to more than one queue' of the same message...
>
> the amqp spec infers its supported, but not very clearly one way or the
> other...

it is vague in places :-|

0-9-1 is a bit clearer


> basically i want to be able to send the same message to one or more
> subscribers while in a transaction,

yes you can do that using TX but read the small print very carefully.

and - feel free to ask specific questions about your case here


> this is typically called multi-cast as I
> understand it...

it is indeed, but multicast as a term has also become entwined with
udp/multicast as provided by cisco/tibco using specific multicast
network transports.. hence our confusion



> re:
> On Thu, Jul 16, 2009 at 7:25 AM, Alexis Richardson
> <alexis.richardson at gmail.com> wrote:
>>
>> Patrick
>>
>> What Ben said.
>>
>> Plus ... Do you mean 'delivery to more than one queue'? ?Yes, you can
>> group these into a TX class transaction, which I recommend you see as
>> a way of grouping a stream of messages.
>>
>> In AMQP 0-8/0-9-1 we suggest ***care*** with TX, in particular when
>> combining TX with multiple deliveries, queues, and the 'mandatory' or
>> 'immediate' flags.
>>
>> alexis
>>
>>
>> On Wed, Jul 15, 2009 at 11:33 PM, Ben Hood<0x6e6562 at gmail.com> wrote:
>> > Patrick,
>> >
>> > On Wed, Jul 15, 2009 at 9:45 PM, Patrick Kenney<pekenney at gmail.com>
>> > wrote:
>> >> Does RabbitMQ support Multicast in a transaction?
>> >
>> > What exactly do you mean by multicast? I'm assuming that you're aware
>> > how routing works in AMQP in general.
>> >
>> > HTH,
>> >
>> > Ben
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>
>



From lars at worldlingo.com  Thu Jul 16 16:05:30 2009
From: lars at worldlingo.com (Lars George)
Date: Thu, 16 Jul 2009 17:05:30 +0200
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <269388e30907160634q66681ed9w627e639d9fd7ccb2@mail.gmail.com>
References: <4A5718A3.9000807@worldlingo.com>	
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>	
	<4A5C206F.9070901@worldlingo.com>	
	<B61B9153-2239-4E6A-B759-9669BC046CC8@gmail.com>	
	<4A5CA116.4030208@worldlingo.com>	
	<269388e30907151531n58a9b2c6hace9c81196442269@mail.gmail.com>	
	<4A5F1BBE.1050600@worldlingo.com>
	<269388e30907160634q66681ed9w627e639d9fd7ccb2@mail.gmail.com>
Message-ID: <4A5F41BA.7010300@worldlingo.com>

Hi Ben,

OK, well that is a start, if you saw the right behavior with only one 
element in the local queue then that also tells something. Somewhere I 
must miss a setting or so. Let me dig in deeper.

Just to confirm, the beta server and Java client that is on the main 
download page is what I need, right?

Thanks,
Lars


Ben Hood wrote:
> Lars,
>
> On Thu, Jul 16, 2009 at 1:23 PM, Lars George<lars at worldlingo.com> wrote:
>   
>> I sent you the source in a separate message. Please let me know if that
>> helps or if you want me to send you the compiled classes too. Yes, the host
>> is hardcoded, that is the only real dependency which is of course easily
>> changed. If you like I can change the code so that the host is a command
>> line option too. Please advise.
>>     
>
> Ok, I've just run this code and the behavior is the same as yesterday,
> i.e. I my observations do not concur with yours.
>
> When setting prefetch to 1, the internal queue never grows bigger than
> one, which is inline with what it with what it is designed to do.
>
> When I turn off QoS, the maximum queue depth I observed was about 150,
> but YMMV of course.
>
> Hence, I can't really help in this case since I cannot reproduce the issue.
>
>   
>> What is an m2 client?
>>     
>
> I meant that you cook up a maven pom to that will run everything. I
> don't know if this will shed any light on the situation, because I
> imported your code and the only thing I modified was the hostname and
> the namespace of the classes.
>
> Hence, I'm at a loss as to what could be going wrong - the only think
> that I can think is that you may using a earlier version of Rabbit
> (although you said that you've upgraded to 1.6.0) and if you were, I'd
> expect to see something in the server logs.
>
> Ben
>
>   
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lars.vcf
Type: text/x-vcard
Size: 301 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/f838debb/attachment.vcf 

From pekenney at gmail.com  Thu Jul 16 16:18:33 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Thu, 16 Jul 2009 08:18:33 -0700
Subject: [rabbitmq-discuss] how to make Wcf bind to rabbitmq exchange
	and queue?
In-Reply-To: <8F16BDCC98E64841857E711110AF5EDD698A1AAFD8@EXMBX01.wealthcraft.local>
References: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>
	<167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD698A1AAFD1@EXMBX01.wealthcraft.local>
	<167204d20907150347l1c98680ao22abf760c47e761c@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD698A1AAFD8@EXMBX01.wealthcraft.local>
Message-ID: <3a5f03340907160818q37ab0defjb1eacb1868bace99@mail.gmail.com>

I hate to keep asking this but...

The RabbitMQ .NET Client Library User Guide ("Examples Section") of the pdf
is not as straight forward, simple and as easy for all of us as implied thus
far...

Hence the need (As far as C# based RabbitMQ discovery goes anyway) in my
opinion for a single ready to run (download, open the visual studio solution
and hit F5)  WinForm based Visual Studio 2005/2008 solution, that gives a
newbie one stop shopping so to speak on how to utilize WCF and RabbitMQ,
Exchanges, Queues and messaging, etc...
A single WinForm in a Visual Studio 2005/2008 solution that actually does
all the things itemized in the The RabbitMQ .NET Client Library User Guide
("Examples Section") of the  pdf

There is just a lot to take in at one time with AMQP, and the differences
between queuing with MSMQ and RabbitMQ...

I see tremendous potential for RabbitMQ if the learning curve could be
reduced...
Its obviously better then MSMQ, and with no knowledge of MSMQ with
Microsoft's and other readily available examples, one can get going with
MSMQ much faster...

thanks in advance
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/9d8803dd/attachment.htm 

From cwiegand at mobileaccord.com  Thu Jul 16 16:24:39 2009
From: cwiegand at mobileaccord.com (Chris Wiegand)
Date: Thu, 16 Jul 2009 11:24:39 -0400
Subject: [rabbitmq-discuss] RabbitMQ 1.6 persistence?
In-Reply-To: <269388e30907151548n7999dbafs1a942879e95e91ba@mail.gmail.com>
References: <658AD87BE18A64499819C89D6FCAAD963C069908@SIMON.mobileaccord.local>
	<269388e30907151548n7999dbafs1a942879e95e91ba@mail.gmail.com>
Message-ID: <658AD87BE18A64499819C89D6FCAAD963C069A20@SIMON.mobileaccord.local>

Yeah, I get a stack trace that essentially says it tried to allocate more memory than allowed. I cut-and-pasted the console response below, if you want I can send over the erl_crash.dmp file (818 kb).

I actually was able to solve the problem using (thanks Wilson Ke!) - I was only declaring the messages persistent, but not the queue itself. Once I declared the queue (and exchange, to be safe) to be durable it started working as expected.

Here's the error I get on the console:

D:\rabbitmq_server-1.6.0>sbin\rabbitmq-server.bat
RabbitMQ 1.6.0 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node        : rabbit at Tomato
log         : C:/Documents and Settings/Administrator/Application Data/RabbitMQ/log/rabbit.log
sasl log    : C:/Documents and Settings/Administrator/Application Data/RabbitMQ/log/rabbit-sasl.log
database dir: c:/Documents and Settings/Administrator/Application Data/RabbitMQ/db/rabbit-mnesia

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...done
starting guid generator       ...done
starting builtin applications ...done
starting TCP listeners        ...done

broker running

Crash dump was written to: erl_crash.dump
binary_alloc: Cannot allocate 251777643 bytes of memory (of type "binary").

This application has requested the Runtime to terminate it in an unusual way.
Please contact the application's support team for more information.

-----Original Message-----
From: Ben Hood [mailto:0x6e6562 at gmail.com] 
Sent: Wednesday, July 15, 2009 4:48 PM
To: Chris Wiegand
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ 1.6 persistence?

Chris,

On Tue, Jul 14, 2009 at 11:59 PM, Chris
Wiegand<cwiegand at mobileaccord.com> wrote:
> I'm finding that if the erlang session dies

What do you mean by Erlang session? Do you mean that the Erlang VM process dies?

> (like say if I kill it, or try to pump in 1 million
> messages and it runs out of memory),

In 1.6.0 every message is resident in memory - solution to this is
being developed ATM.

> and then I re-start the RabbitMQ server
> it takes a rather long time to load the persistence stuff, but then just
> clears out the queues, and the file (rabbit_persister.LOG) just gets
> truncated and the messages were not persisted.
>
>
>
> Am I misunderstanding how RabbitMQ implements persistence? I expected that
> if the broker stops, and then gets relaunched that it would reload the last
> saved state for the queues, etc.., but that doesn't seem to be taking place.
> We're running it under Windows, under the most recent version of erlang
> (also just downloaded last week), in case that would affect anything. I'll
> try this under Linux and OpenSolaris here soon, in case that makes a
> difference.
>
>
>
> I'm using the .Net bindings, and setting the BasicProperties' DeliveryMode
> to 2 for persistence, is there anything else I have to do to make a queue
> persist?

OFV and if you have queues bound to your exchanges, what you are
describing should probably not be happening. Can you give us a cut
down version of your code that reproduces this behaviour?

Ben



From alexis.richardson at gmail.com  Thu Jul 16 16:30:33 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 16 Jul 2009 16:30:33 +0100
Subject: [rabbitmq-discuss] how to make Wcf bind to rabbitmq exchange
	and queue?
In-Reply-To: <3a5f03340907160818q37ab0defjb1eacb1868bace99@mail.gmail.com>
References: <353587920907101606n8daf816h225cb601da2abac7@mail.gmail.com>
	<167204d20907150141x579824cdo33aeb223f025daa9@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD698A1AAFD1@EXMBX01.wealthcraft.local>
	<167204d20907150347l1c98680ao22abf760c47e761c@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD698A1AAFD8@EXMBX01.wealthcraft.local>
	<3a5f03340907160818q37ab0defjb1eacb1868bace99@mail.gmail.com>
Message-ID: <167204d20907160830m68b03927y52ce75bde0dc8ad5@mail.gmail.com>

Patrick

I really appreciate this feedback but we may require some help from
you, to achieve your expectations.

First off, please can you tell me what you think of the following:

* Jason Williams' post "Rabbits and Warrens" linked to from here:
http://www.rabbitmq.com/how.html

* Any other intros that catch your eye, linked to from the above URL

* Chapters 1-5 of the dotnet user guide.  Especially chapters 2 and 3.

* The AMQP 0-9-1 spec.

Tell us if we should be holding initial users' hands more and perhaps
making it easier to read these in the *correct order*.  What is the
correct order?  We need your advice to get it right.

Second, have you been able to do what Ben suggested and load the DLL
examples into Visual Studio?

What are the specific steps needed to go from there, to the 'one stop
shop' approach that you describe?  Are they (a) more examples; (b)
better examples; (c) closer links between examples in VS and the
various documents linked to from http://www.rabbitmq.com/how.html ...
or (d) better packaging.

Cheers

alexis





On Thu, Jul 16, 2009 at 4:18 PM, Patrick Kenney<pekenney at gmail.com> wrote:
> I hate to keep asking this but...
>
> The RabbitMQ .NET Client Library User Guide ("Examples Section") of the pdf
> is not as straight forward, simple and as easy for all of us as implied thus
> far...
>
> Hence the need (As far as C# based RabbitMQ discovery goes anyway) in my
> opinion for a single ready to run (download, open the visual studio solution
> and hit F5)? WinForm based Visual Studio 2005/2008 solution, that gives a
> newbie one stop shopping so to speak on how to utilize WCF and RabbitMQ,
> Exchanges, Queues and messaging, etc...
> A single WinForm in a Visual Studio 2005/2008 solution that actually does
> all the things itemized in the The RabbitMQ .NET Client Library User Guide
> ("Examples Section") of the? pdf
>
> There is just a lot to take in at one time with AMQP, and the differences
> between queuing with MSMQ and RabbitMQ...
>
> I see tremendous potential for RabbitMQ if the learning curve could be
> reduced...
> Its obviously better then MSMQ, and with no knowledge of MSMQ with
> Microsoft's and other readily available examples, one can get going with
> MSMQ much faster...
>
> thanks in advance
>
>



From brownspice at gmail.com  Thu Jul 16 17:45:33 2009
From: brownspice at gmail.com (amit bhatnagar)
Date: Thu, 16 Jul 2009 09:45:33 -0700 (PDT)
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <4A5F41BA.7010300@worldlingo.com>
References: <4A5718A3.9000807@worldlingo.com>
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
	<4A5C206F.9070901@worldlingo.com>
	<B61B9153-2239-4E6A-B759-9669BC046CC8@gmail.com> 
	<4A5CA116.4030208@worldlingo.com>
	<269388e30907151531n58a9b2c6hace9c81196442269@mail.gmail.com> 
	<4A5F1BBE.1050600@worldlingo.com>
	<269388e30907160634q66681ed9w627e639d9fd7ccb2@mail.gmail.com> 
	<4A5F41BA.7010300@worldlingo.com>
Message-ID: <6be742e0-b63f-440b-a083-c17d9d67c168@d15g2000prc.googlegroups.com>

On Jul 16, 9:05?am, Lars George <l... at worldlingo.com> wrote:
> Just to confirm, the beta server and Java client that is on the main
> download page is what I need, right?

You should only need to install RabbitMQ 1.6.0 beta from the main
download page.



From 0x6e6562 at gmail.com  Thu Jul 16 18:27:19 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Thu, 16 Jul 2009 18:27:19 +0100
Subject: [rabbitmq-discuss] opposite of basicAck?
In-Reply-To: <6ec6c0ed-9b7c-4648-b527-11fdb4d14007@d9g2000prh.googlegroups.com>
References: <84fb38e30906250957od213dfl139022812d19a57a@mail.gmail.com>
	<269388e30907151557v69eb5ed3t8429423e30f2dec3@mail.gmail.com>
	<6ec6c0ed-9b7c-4648-b527-11fdb4d14007@d9g2000prh.googlegroups.com>
Message-ID: <269388e30907161027q437a3c35w2f204fb301655392@mail.gmail.com>

Amit,

On Thu, Jul 16, 2009 at 3:22 PM, amit bhatnagar<brownspice at gmail.com> wrote:
> When you do this by closing the channel, (essentially faking a
> Basic.Reject), the message gets put back on the queue and gets ready
> for consumption by another consumer (or channel from same consumer if
> it had more than one channel).
>
> a) Is the producer registering for an BasicReturn listener the proper
> mechanism to be informed that the message was undeliverable?

The answer to your question might lie in the spec's definition of the
BasicReturn command:

"This method returns an undeliverable message that was published with
the "immediate" flag set, or an unroutable message published with the
"mandatory" flag set. The reply code and text provide information
about the reason that the message was undeliverable."


> b) If a is true, how long would the message sit on the queue waiting
> for a potential consumer to pick it up before the basic.return was
> generated by the broker back for the producer?

See above.

> c) If no such BasicReturn listener was registered, the message gets
> dropped?

The broker will send the rejection back to the client in any case.
Whether this ever lands back in the client application depends on
whether (a) the client library black holes these messages or (b)
whether the client application registers some kind of callback to
handle returns. Both of which are outside of the broker's remit.

Ben



From ryan at acceleration.net  Thu Jul 16 19:02:22 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Thu, 16 Jul 2009 14:02:22 -0400
Subject: [rabbitmq-discuss] .NET client SimpleRpcServer question
In-Reply-To: <4A2EE289.3080505@lshift.net>
References: <4A292998.3090407@acceleration.net>	<4A2D70A5.6040907@lshift.net>	<4A2E878E.3000700@acceleration.net>	<4A2EA81B.8060303@acceleration.net>
	<4A2EB25D.10907@acceleration.net>
	<4A2EDC35.6030201@acceleration.net> <4A2EE289.3080505@lshift.net>
Message-ID: <4A5F6B2E.3080706@acceleration.net>

Matthias Radestock wrote:
>
> Thanks for the patch. If you don't mind, we'll look into this in a few
> weeks when the person who wrote the original code is back from holidays.
Has your .NET programmer had a chance to look at this patch yet?  I have
not had any problems running it in production (albeit with a light
message load).

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506





From arilerner at mac.com  Thu Jul 16 20:15:43 2009
From: arilerner at mac.com (Ari Lerner)
Date: Thu, 16 Jul 2009 12:15:43 -0700
Subject: [rabbitmq-discuss] Alice and wonderland,
 the REST client and WebUI administration interface is now live
Message-ID: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>

Hey guys,

I just wanted to send a quick note about a project we've been working  
on to expose RabbitMQ administration for our company's techops team.  
Alice (http://github.com/auser/alice/tree/master) provides a RESTful  
interface to Rabbit and Wonderland (http://github.com/auser/wonderland/tree/master 
) provides a WebUI to Alice.

Alice is written in erlang and talks natively to the RabbitMQ server  
(through the same mechanism that rabbitmqctl does). It's written to be  
extensible and easily editable. Both projects are open-sourced on  
github (links above).

The official announcement is here: http://willcodeforfoo.com/2009/07/13/announcing-alice 
.

http://alicetheapp.com

Ari Lerner and the CloudTeam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/5d7114ef/attachment.htm 

From alexis.richardson at gmail.com  Thu Jul 16 20:37:12 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 16 Jul 2009 20:37:12 +0100
Subject: [rabbitmq-discuss] Alice and wonderland,
	the REST client and 	WebUI administration interface is now live
In-Reply-To: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
References: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
Message-ID: <167204d20907161237w100e799cm9f5131fd7980cd0f@mail.gmail.com>

Ari

Thank-you!  This looks interesting indeed.

Rabbit folks, please do take a look and share your thoughts.

alexis


On Thu, Jul 16, 2009 at 8:15 PM, Ari Lerner<arilerner at mac.com> wrote:
> Hey guys,
>
> I just wanted to send a quick note about a project we've been working on to
> expose RabbitMQ administration for our company's techops team. Alice
> (http://github.com/auser/alice/tree/master) provides a RESTful interface to
> Rabbit and Wonderland (http://github.com/auser/wonderland/tree/master)
> provides a WebUI to Alice.
>
> Alice is written in erlang and talks natively to the RabbitMQ server
> (through the same mechanism that rabbitmqctl does). It's written to be
> extensible and easily editable. Both projects are open-sourced on github
> (links above).
>
> The official announcement is
> here:?http://willcodeforfoo.com/2009/07/13/announcing-alice.
>
> http://alicetheapp.com
>
> Ari Lerner and the CloudTeam
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From spook at wetafx.co.nz  Thu Jul 16 20:55:10 2009
From: spook at wetafx.co.nz (Luke Chamberlain)
Date: Fri, 17 Jul 2009 07:55:10 +1200
Subject: [rabbitmq-discuss] Alice and wonderland,
 the REST client and WebUI administration interface is now live
In-Reply-To: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
References: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
Message-ID: <4A5F859E.4010702@wetafx.co.nz>

You've just made my day Ari.
I'll be trying this out for sure. :)

- Luke


On 07/17/09 07:15, Ari Lerner wrote:
> Hey guys,
>
> I just wanted to send a quick note about a project we've been working 
> on to expose RabbitMQ administration for our company's techops team. 
> Alice (http://github.com/auser/alice/tree/master) provides a RESTful 
> interface to Rabbit and Wonderland 
> (http://github.com/auser/wonderland/tree/master) provides a WebUI to 
> Alice.
>
> Alice is written in erlang and talks natively to the RabbitMQ server 
> (through the same mechanism that rabbitmqctl does). It's written to be 
> extensible and easily editable. Both projects are open-sourced on 
> github (links above).
>
> The official announcement is here: 
> http://willcodeforfoo.com/2009/07/13/announcing-alice.
>
> http://alicetheapp.com <http://alicetheapp.com/>
>
> Ari Lerner and the CloudTeam
> ------------------------------------------------------------------------
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090717/a9e0aead/attachment.htm 

From pekenney at gmail.com  Thu Jul 16 22:16:52 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Thu, 16 Jul 2009 14:16:52 -0700
Subject: [rabbitmq-discuss] Issues Running RabbitMQ DotNet Samples
Message-ID: <3a5f03340907161416l25eab309ofe2ea147b4be8353@mail.gmail.com>

i am pretty much getting the same error no matter which of the samples i
run...

since there currently is no step by step instructions for the examples...
no functional example of valid set of arguments, etc...

perhaps somebody can help me out in the mean time...

I am passing the following to the SendString example...

localhost testexchange testexchangetype testroutingkey "test message"

and getting the following error...

Cannot access a disposed object. Object name: 'System.Net.Sockets.Socket'
System.Exception {System.ObjectDisposedException}

again i am pretty much getting the same error no matter which of the samples
i run...

thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/fa0af4b9/attachment.htm 

From darien at kindlund.com  Thu Jul 16 22:27:38 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Thu, 16 Jul 2009 17:27:38 -0400
Subject: [rabbitmq-discuss] Alice and wonderland,
	the REST client and 	WebUI administration interface is now live
In-Reply-To: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
References: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
Message-ID: <50c8ffe90907161427g38339652t21f442da5440057e@mail.gmail.com>

Ari,

Cool project; 2 questions:

1) Are you planning on adding user authentication to the webservice?
(For example, you could leverage the username/password accounts
already created by rabbitmqctl, rather than storing your own set of
credentials.)

2) I'm not too familiar with mochiweb, but is there a way to serve up
pages over HTTPS within the app?  Or would you have to configure
something like stunnel for that purpose?

Regards,
-- Darien

On Thu, Jul 16, 2009 at 3:15 PM, Ari Lerner<arilerner at mac.com> wrote:
> Hey guys,
>
> I just wanted to send a quick note about a project we've been working on to
> expose RabbitMQ administration for our company's techops team. Alice
> (http://github.com/auser/alice/tree/master) provides a RESTful interface to
> Rabbit and Wonderland (http://github.com/auser/wonderland/tree/master)
> provides a WebUI to Alice.
>
> Alice is written in erlang and talks natively to the RabbitMQ server
> (through the same mechanism that rabbitmqctl does). It's written to be
> extensible and easily editable. Both projects are open-sourced on github
> (links above).
>
> The official announcement is
> here:?http://willcodeforfoo.com/2009/07/13/announcing-alice.
>
> http://alicetheapp.com
>
> Ari Lerner and the CloudTeam
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From pekenney at gmail.com  Thu Jul 16 22:33:39 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Thu, 16 Jul 2009 14:33:39 -0700
Subject: [rabbitmq-discuss] Alice and wonderland,
	the REST client and 	WebUI administration interface is now live
In-Reply-To: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
References: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
Message-ID: <3a5f03340907161433l5a468d56t6e00fd2a9bd9cc9c@mail.gmail.com>

C# Port in the making or available?

re:
On Thu, Jul 16, 2009 at 12:15 PM, Ari Lerner <arilerner at mac.com> wrote:

> Hey guys,
>
> I just wanted to send a quick note about a project we've been working on to
> expose RabbitMQ administration for our company's techops team. Alice (
> http://github.com/auser/alice/tree/master) provides a RESTful interface to
> Rabbit and Wonderland (http://github.com/auser/wonderland/tree/master)
> provides a WebUI to Alice.
>
> Alice is written in erlang and talks natively to the RabbitMQ server
> (through the same mechanism that rabbitmqctl does). It's written to be
> extensible and easily editable. Both projects are open-sourced on github
> (links above).
>
> The official announcement is here:
> http://willcodeforfoo.com/2009/07/13/announcing-alice.
>
> http://alicetheapp.com
>
> Ari Lerner and the CloudTeam
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/18bda67c/attachment.htm 

From michael.greene at gmail.com  Thu Jul 16 22:52:18 2009
From: michael.greene at gmail.com (Michael Greene)
Date: Thu, 16 Jul 2009 16:52:18 -0500
Subject: [rabbitmq-discuss] Alice and wonderland,
	the REST client and 	WebUI administration interface is now live
In-Reply-To: <3a5f03340907161433l5a468d56t6e00fd2a9bd9cc9c@mail.gmail.com>
References: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
	<3a5f03340907161433l5a468d56t6e00fd2a9bd9cc9c@mail.gmail.com>
Message-ID: <f4d6a21a0907161452q63d5b67wc7c6b846f526641e@mail.gmail.com>

C#'s HttpWebRequest should be able to interrogate Alice as easily as
any other language can.

On Thu, Jul 16, 2009 at 4:33 PM, Patrick Kenney<pekenney at gmail.com> wrote:
> C# Port in the making or available?
>
> re:
> On Thu, Jul 16, 2009 at 12:15 PM, Ari Lerner <arilerner at mac.com> wrote:
>>
>> Hey guys,
>>
>> I just wanted to send a quick note about a project we've been working on
>> to expose RabbitMQ administration for our company's techops team. Alice
>> (http://github.com/auser/alice/tree/master) provides a RESTful interface to
>> Rabbit and Wonderland (http://github.com/auser/wonderland/tree/master)
>> provides a WebUI to Alice.
>>
>> Alice is written in erlang and talks natively to the RabbitMQ server
>> (through the same mechanism that rabbitmqctl does). It's written to be
>> extensible and easily editable. Both projects are open-sourced on github
>> (links above).
>>
>> The official announcement is
>> here:?http://willcodeforfoo.com/2009/07/13/announcing-alice.
>>
>> http://alicetheapp.com
>>
>> Ari Lerner and the CloudTeam
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From arilerner at mac.com  Thu Jul 16 22:54:23 2009
From: arilerner at mac.com (Ari Lerner)
Date: Thu, 16 Jul 2009 14:54:23 -0700
Subject: [rabbitmq-discuss] Alice and wonderland,
 the REST client and WebUI administration interface is now live
In-Reply-To: <4A5F859E.4010702@wetafx.co.nz>
References: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
	<4A5F859E.4010702@wetafx.co.nz>
Message-ID: <40E2EEA8-4A93-4479-A6A0-526BA7D06A84@mac.com>

Awesome!

Looking forward to hearing your feedback!

Thanks,
Ari Lerner

On Jul 16, 2009, at 12:55 PM, Luke Chamberlain wrote:

> You've just made my day Ari.
> I'll be trying this out for sure. :)
>
> - Luke
>
>
> On 07/17/09 07:15, Ari Lerner wrote:
>>
>> Hey guys,
>>
>> I just wanted to send a quick note about a project we've been  
>> working on to expose RabbitMQ administration for our company's  
>> techops team. Alice (http://github.com/auser/alice/tree/master)  
>> provides a RESTful interface to Rabbit and Wonderland (http://github.com/auser/wonderland/tree/master 
>> ) provides a WebUI to Alice.
>>
>> Alice is written in erlang and talks natively to the RabbitMQ  
>> server (through the same mechanism that rabbitmqctl does). It's  
>> written to be extensible and easily editable. Both projects are  
>> open-sourced on github (links above).
>>
>> The official announcement is here: http://willcodeforfoo.com/2009/07/13/announcing-alice 
>> .
>>
>> http://alicetheapp.com
>>
>> Ari Lerner and the CloudTeam
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/f8cc21a4/attachment.htm 

From pekenney at gmail.com  Thu Jul 16 22:58:02 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Thu, 16 Jul 2009 14:58:02 -0700
Subject: [rabbitmq-discuss] Alice and wonderland,
	the REST client and 	WebUI administration interface is now live
In-Reply-To: <f4d6a21a0907161452q63d5b67wc7c6b846f526641e@mail.gmail.com>
References: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
	<3a5f03340907161433l5a468d56t6e00fd2a9bd9cc9c@mail.gmail.com>
	<f4d6a21a0907161452q63d5b67wc7c6b846f526641e@mail.gmail.com>
Message-ID: <3a5f03340907161458w434093b4ubd785d37fdb6d0df@mail.gmail.com>

I was referring to a C# port of the current erlang source...

On Thu, Jul 16, 2009 at 2:52 PM, Michael Greene <michael.greene at gmail.com>wrote:

> C#'s HttpWebRequest should be able to interrogate Alice as easily as
> any other language can.
>
> On Thu, Jul 16, 2009 at 4:33 PM, Patrick Kenney<pekenney at gmail.com> wrote:
> > C# Port in the making or available?
> >
> > re:
> > On Thu, Jul 16, 2009 at 12:15 PM, Ari Lerner <arilerner at mac.com> wrote:
> >>
> >> Hey guys,
> >>
> >> I just wanted to send a quick note about a project we've been working on
> >> to expose RabbitMQ administration for our company's techops team. Alice
> >> (http://github.com/auser/alice/tree/master) provides a RESTful
> interface to
> >> Rabbit and Wonderland (http://github.com/auser/wonderland/tree/master)
> >> provides a WebUI to Alice.
> >>
> >> Alice is written in erlang and talks natively to the RabbitMQ server
> >> (through the same mechanism that rabbitmqctl does). It's written to be
> >> extensible and easily editable. Both projects are open-sourced on github
> >> (links above).
> >>
> >> The official announcement is
> >> here: http://willcodeforfoo.com/2009/07/13/announcing-alice.
> >>
> >> http://alicetheapp.com
> >>
> >> Ari Lerner and the CloudTeam
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/4f7dab60/attachment.htm 

From arilerner at mac.com  Thu Jul 16 23:07:20 2009
From: arilerner at mac.com (Ari Lerner)
Date: Thu, 16 Jul 2009 15:07:20 -0700
Subject: [rabbitmq-discuss] Alice and wonderland,
 the REST client and	WebUI administration interface is now live
In-Reply-To: <3a5f03340907161458w434093b4ubd785d37fdb6d0df@mail.gmail.com>
References: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
	<3a5f03340907161433l5a468d56t6e00fd2a9bd9cc9c@mail.gmail.com>
	<f4d6a21a0907161452q63d5b67wc7c6b846f526641e@mail.gmail.com>
	<3a5f03340907161458w434093b4ubd785d37fdb6d0df@mail.gmail.com>
Message-ID: <84F3E880-288E-4FD2-A1CA-F1BC3FF4077B@mac.com>

Patrick,

There are no plans to port to C#... what is the use-case, out of  
curiosity? Why not just query the server?

Ari Lerner

On Jul 16, 2009, at 2:58 PM, Patrick Kenney wrote:

> I was referring to a C# port of the current erlang source...
>
> On Thu, Jul 16, 2009 at 2:52 PM, Michael Greene <michael.greene at gmail.com 
> > wrote:
> C#'s HttpWebRequest should be able to interrogate Alice as easily as
> any other language can.
>
> On Thu, Jul 16, 2009 at 4:33 PM, Patrick Kenney<pekenney at gmail.com>  
> wrote:
> > C# Port in the making or available?
> >
> > re:
> > On Thu, Jul 16, 2009 at 12:15 PM, Ari Lerner <arilerner at mac.com>  
> wrote:
> >>
> >> Hey guys,
> >>
> >> I just wanted to send a quick note about a project we've been  
> working on
> >> to expose RabbitMQ administration for our company's techops team.  
> Alice
> >> (http://github.com/auser/alice/tree/master) provides a RESTful  
> interface to
> >> Rabbit and Wonderland (http://github.com/auser/wonderland/tree/master 
> )
> >> provides a WebUI to Alice.
> >>
> >> Alice is written in erlang and talks natively to the RabbitMQ  
> server
> >> (through the same mechanism that rabbitmqctl does). It's written  
> to be
> >> extensible and easily editable. Both projects are open-sourced on  
> github
> >> (links above).
> >>
> >> The official announcement is
> >> here: http://willcodeforfoo.com/2009/07/13/announcing-alice.
> >>
> >> http://alicetheapp.com
> >>
> >> Ari Lerner and the CloudTeam
> >>
> >> _______________________________________________
> >> rabbitmq-discuss mailing list
> >> rabbitmq-discuss at lists.rabbitmq.com
> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >>
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/b04b73bf/attachment.htm 

From pekenney at gmail.com  Thu Jul 16 23:19:55 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Thu, 16 Jul 2009 15:19:55 -0700
Subject: [rabbitmq-discuss] Alice and wonderland,
	the REST client and 	WebUI administration interface is now live
In-Reply-To: <84F3E880-288E-4FD2-A1CA-F1BC3FF4077B@mac.com>
References: <D2E11557-218A-4AD5-9F26-051D1DD610C3@mac.com>
	<3a5f03340907161433l5a468d56t6e00fd2a9bd9cc9c@mail.gmail.com>
	<f4d6a21a0907161452q63d5b67wc7c6b846f526641e@mail.gmail.com>
	<3a5f03340907161458w434093b4ubd785d37fdb6d0df@mail.gmail.com>
	<84F3E880-288E-4FD2-A1CA-F1BC3FF4077B@mac.com>
Message-ID: <3a5f03340907161519y78b8a69bj195269902fa3afed@mail.gmail.com>

I do not know erlang well and looking at C# or C++ or Java is more intuitive
to me in understanding how it works under the hood...

re:
On Thu, Jul 16, 2009 at 3:07 PM, Ari Lerner <arilerner at mac.com> wrote:

> Patrick,
>
> There are no plans to port to C#... what is the use-case, out of curiosity?
> Why not just query the server?
>
> Ari Lerner
>
> On Jul 16, 2009, at 2:58 PM, Patrick Kenney wrote:
>
> I was referring to a C# port of the current erlang source...
>
> On Thu, Jul 16, 2009 at 2:52 PM, Michael Greene <michael.greene at gmail.com>wrote:
>
>> C#'s HttpWebRequest should be able to interrogate Alice as easily as
>> any other language can.
>>
>> On Thu, Jul 16, 2009 at 4:33 PM, Patrick Kenney<pekenney at gmail.com>
>> wrote:
>> > C# Port in the making or available?
>> >
>> > re:
>> > On Thu, Jul 16, 2009 at 12:15 PM, Ari Lerner <arilerner at mac.com> wrote:
>> >>
>> >> Hey guys,
>> >>
>> >> I just wanted to send a quick note about a project we've been working
>> on
>> >> to expose RabbitMQ administration for our company's techops team. Alice
>> >> (http://github.com/auser/alice/tree/master) provides a RESTful
>> interface to
>> >> Rabbit and Wonderland (http://github.com/auser/wonderland/tree/master)
>> >> provides a WebUI to Alice.
>> >>
>> >> Alice is written in erlang and talks natively to the RabbitMQ server
>> >> (through the same mechanism that rabbitmqctl does). It's written to be
>> >> extensible and easily editable. Both projects are open-sourced on
>> github
>> >> (links above).
>> >>
>> >> The official announcement is
>> >> here: http://willcodeforfoo.com/2009/07/13/announcing-alice.
>> >>
>> >> http://alicetheapp.com
>> >>
>> >> Ari Lerner and the CloudTeam
>> >>
>> >> _______________________________________________
>> >> rabbitmq-discuss mailing list
>> >> rabbitmq-discuss at lists.rabbitmq.com
>> >> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >>
>> >
>> >
>> > _______________________________________________
>> > rabbitmq-discuss mailing list
>> > rabbitmq-discuss at lists.rabbitmq.com
>> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>> >
>> >
>>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090716/5d005464/attachment.htm 

From tonyg at lshift.net  Fri Jul 17 11:42:39 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 11:42:39 +0100
Subject: [rabbitmq-discuss] NETCONF over AMQP
In-Reply-To: <4A4CA974.9040103@incunabulum.net>
References: <4A4CA974.9040103@incunabulum.net>
Message-ID: <4A60559F.2000209@lshift.net>

Hi Bruce,

Bruce Simpson wrote:
> Has anyone done any thinking about NETCONF, the emerging network 
> management protocol standard?
>     http://en.wikipedia.org/wiki/Netconf

Interesting idea. What kinds of wins would layering this across AMQP bring?

Perhaps the option to configure and/or interrogate *groups* of machines
(by relaying through an exchange)...?

Tony




From lars at worldlingo.com  Fri Jul 17 11:54:41 2009
From: lars at worldlingo.com (Lars George)
Date: Fri, 17 Jul 2009 12:54:41 +0200
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <269388e30907160634q66681ed9w627e639d9fd7ccb2@mail.gmail.com>
References: <4A5718A3.9000807@worldlingo.com>	
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>	
	<4A5C206F.9070901@worldlingo.com>	
	<B61B9153-2239-4E6A-B759-9669BC046CC8@gmail.com>	
	<4A5CA116.4030208@worldlingo.com>	
	<269388e30907151531n58a9b2c6hace9c81196442269@mail.gmail.com>	
	<4A5F1BBE.1050600@worldlingo.com>
	<269388e30907160634q66681ed9w627e639d9fd7ccb2@mail.gmail.com>
Message-ID: <4A605871.7050901@worldlingo.com>

Hi Ben,

Darn it. I recompiled the whole lot and now it works! Not sure what 
happened or why it did not run before (as I added the new basicQos() and 
recompiled I assumed it is a fresh compile). But anyways, sorry for the 
hassle and thanks for helping!

Regards,
Lars


Ben Hood wrote:
> Lars,
>
> On Thu, Jul 16, 2009 at 1:23 PM, Lars George<lars at worldlingo.com> wrote:
>   
>> I sent you the source in a separate message. Please let me know if that
>> helps or if you want me to send you the compiled classes too. Yes, the host
>> is hardcoded, that is the only real dependency which is of course easily
>> changed. If you like I can change the code so that the host is a command
>> line option too. Please advise.
>>     
>
> Ok, I've just run this code and the behavior is the same as yesterday,
> i.e. I my observations do not concur with yours.
>
> When setting prefetch to 1, the internal queue never grows bigger than
> one, which is inline with what it with what it is designed to do.
>
> When I turn off QoS, the maximum queue depth I observed was about 150,
> but YMMV of course.
>
> Hence, I can't really help in this case since I cannot reproduce the issue.
>
>   
>> What is an m2 client?
>>     
>
> I meant that you cook up a maven pom to that will run everything. I
> don't know if this will shed any light on the situation, because I
> imported your code and the only thing I modified was the hostname and
> the namespace of the classes.
>
> Hence, I'm at a loss as to what could be going wrong - the only think
> that I can think is that you may using a earlier version of Rabbit
> (although you said that you've upgraded to 1.6.0) and if you were, I'd
> expect to see something in the server logs.
>
> Ben
>
>   
-------------- next part --------------
A non-text attachment was scrubbed...
Name: lars.vcf
Type: text/x-vcard
Size: 301 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090717/1b05b754/attachment.vcf 

From tonyg at lshift.net  Fri Jul 17 11:56:30 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 11:56:30 +0100
Subject: [rabbitmq-discuss] Different Stomp Issue: rabbitmq-stomp and
 Codehaus PHP Stomp class
In-Reply-To: <af1bce590906080951u2b6dec29h63251f6011e81ba2@mail.gmail.com>
References: <af1bce590906031546l6a6a05beifa2ac0acd659569a@mail.gmail.com>	
	<4A292EA7.5030103@lshift.net>
	<af1bce590906080951u2b6dec29h63251f6011e81ba2@mail.gmail.com>
Message-ID: <4A6058DE.80100@lshift.net>

Hi Gavin,

Gavin M. Roy wrote:
> It does not respond to the frame.

Hmm. I can't reproduce this with tip-of-default rabbitmq-stomp at the
moment; I've just added (to the repository, and also attached to this
message) a couple of example files that can be netcatted into the server
to see what its response is: could you take a look and see if they match
the problem-causing inputs you describe?

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
-------------- next part --------------
A non-text attachment was scrubbed...
Name: nul-and-newline-stomp-tests.zip
Type: application/zip
Size: 822 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090717/2ad6fbae/attachment.zip 

From alexis.richardson at gmail.com  Fri Jul 17 11:58:24 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 17 Jul 2009 11:58:24 +0100
Subject: [rabbitmq-discuss] STOMP Adapter Example: Headers Exchange
In-Reply-To: <50c8ffe90906222314w5af83fbbl16057236a5ad9f92@mail.gmail.com>
References: <50c8ffe90906222314w5af83fbbl16057236a5ad9f92@mail.gmail.com>
Message-ID: <167204d20907170358o1e117807jeaba2c226cf672dd@mail.gmail.com>

*bump*

Eric, I'm not sure if your native Perl clients support Headers...


On Tue, Jun 23, 2009 at 7:14 AM, Darien Kindlund<darien at kindlund.com> wrote:
> Hi Tony,
>
> As a sanity check for my code, could you upload a perl example using
> the new headers exchange via STOMP? ?Also, is there example ruby code
> using the headers exchange via the AMQP ruby library?
>
> Thanks,
> -- Darien
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From alexis.richardson at gmail.com  Fri Jul 17 12:01:20 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 17 Jul 2009 12:01:20 +0100
Subject: [rabbitmq-discuss] Issues Running RabbitMQ DotNet Samples
In-Reply-To: <3a5f03340907161416l25eab309ofe2ea147b4be8353@mail.gmail.com>
References: <3a5f03340907161416l25eab309ofe2ea147b4be8353@mail.gmail.com>
Message-ID: <167204d20907170401i37d2d735qc5f8fe1986d36445@mail.gmail.com>

Patrick

I'm sorry this is resisting your efforts :-(

Can I suggest that you try talking to the demo server running here:
http://www.rabbitmq.com/examples.html

This will ensure you are not the victim of a server installation issue
or similar.  You may wish to talk to the server using something other
than the .NET libraries, just while you are getting started, and then
reverting to the .NET case once you feel more comfortable with the
model.

Thanks again,

alexis




On Thu, Jul 16, 2009 at 10:16 PM, Patrick Kenney<pekenney at gmail.com> wrote:
> i am pretty much getting the same error no matter which of the samples i
> run...
>
> since there currently is no step by step instructions for the examples...
> no functional example of valid set of arguments, etc...
>
> perhaps somebody can help me out in the mean time...
>
> I am passing the following to the SendString example...
>
> localhost testexchange testexchangetype testroutingkey "test message"
>
> and getting the following error...
>
> Cannot access a disposed object. Object name: 'System.Net.Sockets.Socket'
> System.Exception {System.ObjectDisposedException}
>
> again i am pretty much getting the same error no matter which of the samples
> i run...
>
> thanks in advance.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From alexis.richardson at gmail.com  Fri Jul 17 12:02:06 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 17 Jul 2009 12:02:06 +0100
Subject: [rabbitmq-discuss] RabbitMQ Consumer Error
In-Reply-To: <2856908155873130970@unknownmsgid>
References: <2856908155873130970@unknownmsgid>
Message-ID: <167204d20907170402m4f128024q625cdba187bbc07c@mail.gmail.com>

Excellent - have you mentioned this to the Carrot folks?


On Mon, Jul 13, 2009 at 6:31 AM, Lynton
Grice<lynton.grice at logosworld.com> wrote:
> Hi there,
>
>
>
> I seemed to have solved the issue....it all had to do with the
> ?content_encoding?....so I replaced this:
>
>
>
> Content = #content{class_id = 60,
>
> ??????????????? ???? properties = amqp_util:basic_properties(),
>
> ??????????????? ???? properties = Properties,
>
> ??????????????? ???? properties_bin = none,
>
> ??????????????? ???? payload_fragments_rev = [Payload]
>
> ??????????????? ??? },
>
>
>
> With this:
>
>
>
> Properties = #'P_basic'{content_type = <<"application/octet-stream">>,
>
> ??????????????? ?????? content_encoding = <<"binary">>,
>
> ?????????????? ???????delivery_mode = 1,
>
> ?????????????? ???????priority = 0},
>
> ??????????????? Content = #content{class_id = 60,
>
> ??????????????? ???? properties = Properties,
>
> ??????????????? ???? properties_bin = none,
>
> ??????????????? ???? payload_fragments_rev = [Payload]
>
> ??????????????? ??? },
>
>
>
> Now my Python consumer in CARROT is working 100% ;-)
>
>
>
> Chat later
>
>
>
> Lynton
>
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Lynton
> Grice
> Sent: 12 July 2009 07:13 PM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] RabbitMQ Consumer Error
>
>
>
> Hi there,
>
>
>
> I wonder if someone can help me on this one. I am building the following
> scenario:
>
>
>
> Client -> Mochiweb -> RabbitMQ (via Erlang RabbitMQ Client code) -> Python
> consumer (using the Python CARROT AMQP library)
>
>
>
> I have everything working right until the Python consumer picks up the
> message. I get the following error:
>
>
>
> "No JSON object could be decoded"
>
>
>
> ?Let me step back a second.....here is an example of the BINARY sent from
> the Erlang client (inside Mochiweb) to RabbitMQ:
>
>
>
> NOTE: I have simplified the call by just making a binary called ?Hello
> World? for ?Payload?
>
>
>
> Payload = <<"Hello World">>,
>
> ??????????????? Content = #content{class_id = 60,
>
> ??????????????? ???? properties = amqp_util:basic_properties(),
>
> ??????????????? ???? properties_bin = none,
>
> ??????????????? ???? payload_fragments_rev = [Payload]
>
> ??????????????? ??? },
>
> ??????????????? amqp_channel:cast(Channel, BasicPublish, Content),
>
>
>
> When the Python JSON library (decoder.py) receives this I can see the
> message is formatted like:
>
>
>
> ?Hello World?
>
>
>
> But if I send to RabbitMQ like follows using PYTHON..
>
>
>
> from carrot.messaging import Publisher
>
> from carrot.connection import AMQPConnection
>
>
>
> amqpconn = AMQPConnection(hostname="localhost", port=5672, userid="guest",
> password="guest",vhost="/")
>
> publisher = Publisher(connection=amqpconn, exchange="amq.direct",
> routing_key="a.b.c.*")
>
> publisher.send('Hello World')
>
> publisher.close()
>
>
>
> I get the following for the message in the Python JSON library (decoder.py):
>
>
>
> ??Hello World??
>
>
>
> NOTE the subtle different between the two.....the first one is ?Hello World?
> (from Erlang) and the second (from Python) is ??Hello World??
>
>
>
> I am just wondering if this is a ?Unicode? thing or do I need to do
> something to the Erlang BINARY before sending it to RabbitMQ?
>
>
>
> I think this could also have to do with the BUILT IN JSON library in Python
> 2.6......I will look into that.....
>
>
>
> Thanks for the help....much appreciated ;-)
>
>
>
> Lynton
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From anand.ved at Xoriant.Com  Fri Jul 17 12:05:58 2009
From: anand.ved at Xoriant.Com (Anand Ved)
Date: Fri, 17 Jul 2009 16:35:58 +0530
Subject: [rabbitmq-discuss] Can I generate SNMP traps on Connection events?
Message-ID: <FA3D7C54DA3A1540B2C92C93ACD2156005681784@XOREXCH.India.XoriantCorp.com>

Hi,

Does anyone know if RabbitMQ supports SNMP traps integration and how can
we do it?

Regards,
Anand Ved | Xoriant Solutions Pvt. Ltd. 
Winchester, Hiranandani Business Park, Powai, Mumbai 400076, INDIA. 
Tel: +91 22 30511000 | +91 22 3051 1058 (Direct) | VOIP: + 1 408 834
4495 
Yahoo IM: anandved  | http://www.xoriant.com <http://www.xoriant.com/>

 <<Picture (Device Independent Bitmap)>> Modern technology, Owes
ecology, An apology. ~Alan M. Eddison - Go Green!!


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090717/9e6c35d0/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: image/bmp
Size: 3126 bytes
Desc: Picture (Device Independent Bitmap)
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090717/9e6c35d0/attachment.bin 

From matthias at lshift.net  Fri Jul 17 12:31:42 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 17 Jul 2009 12:31:42 +0100
Subject: [rabbitmq-discuss] BrokerUnreachableException on .NET client
In-Reply-To: <4e3934860906110946h6eda8f5eoe5b77e8c4b8d9078@mail.gmail.com>
References: <4e3934860906101005q51671cf4xc382c5f9a78de8b7@mail.gmail.com>	<4A2FECE3.6030408@lshift.net>	<4e3934860906101048w1fef119bw851ed08628f450c@mail.gmail.com>	<4A2FF832.2050201@lshift.net>	<4e3934860906101234g1abda03bx2c808a198b714672@mail.gmail.com>	<4A300F31.2090908@lshift.net>	<4e3934860906101300p465e0637ped3dc20eaf2553e1@mail.gmail.com>	<4A30143B.8030202@lshift.net>	<4e3934860906101357t28b305ddk8bf80742df93d613@mail.gmail.com>	<4A3021A2.2000509@lshift.net>
	<4e3934860906110946h6eda8f5eoe5b77e8c4b8d9078@mail.gmail.com>
Message-ID: <4A60611E.7080101@lshift.net>

Aaron Feng wrote:
> I have attached the sample program.

Just FTR, Aaron and I looked into this issue in more depth a few weeks
ago. The problem is purely at the .NET client end - the client is
getting a WSAETIMEDOUT which, according to
http://www.tomshardware.com/forum/170046-46-wsaetimedout, is probably
due to the TCP connection attempt timing out. Apparently there are some
registry settings and possible params to tweak, though it turns out that
registry setting has been removed from more recent version of Windows.
"using an asynchronous client socket" (google for it) may help.

I have filed a bug to investigate this further, but it's fairly low
priority since there are very few realistic usage scenarios where the
problem would manifest itself. Meanwhile, anybody familiar with the
Windows & .NET TCP stack is welcome to look into this and submit a patch.


Matthias.




From 0x6e6562 at gmail.com  Fri Jul 17 12:38:26 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 17 Jul 2009 12:38:26 +0100
Subject: [rabbitmq-discuss] Limit QueueingConsumer Memory Usage
In-Reply-To: <4A605871.7050901@worldlingo.com>
References: <4A5718A3.9000807@worldlingo.com>
	<7910d13b-bb21-4e67-86a6-2ee6f3465f3b@h8g2000yqm.googlegroups.com>
	<4A5C206F.9070901@worldlingo.com>
	<B61B9153-2239-4E6A-B759-9669BC046CC8@gmail.com>
	<4A5CA116.4030208@worldlingo.com>
	<269388e30907151531n58a9b2c6hace9c81196442269@mail.gmail.com>
	<4A5F1BBE.1050600@worldlingo.com>
	<269388e30907160634q66681ed9w627e639d9fd7ccb2@mail.gmail.com>
	<4A605871.7050901@worldlingo.com>
Message-ID: <269388e30907170438m52f00d2aidd20b53654af6d1c@mail.gmail.com>

Lars,

On Fri, Jul 17, 2009 at 11:54 AM, Lars George<lars at worldlingo.com> wrote:
> Darn it. I recompiled the whole lot and now it works! Not sure what happened
> or why it did not run before (as I added the new basicQos() and recompiled I
> assumed it is a fresh compile). But anyways, sorry for the hassle and thanks
> for helping!

Good to know.

Ben



From alexis.richardson at gmail.com  Fri Jul 17 12:41:18 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Fri, 17 Jul 2009 12:41:18 +0100
Subject: [rabbitmq-discuss] dropped messages on low volume
In-Reply-To: <0C1869EA-8961-4500-B2A9-35F770EE48BC@gmail.com>
References: <789BE7EA-A982-45E3-BC50-4D7BC1167AAC@gmail.com>
	<20090701120328.GA32183@mrnibble.lshift.net>
	<0929DFE4-B15C-43CC-9C1C-DA522675856E@gmail.com>
	<20090701145733.GB32183@mrnibble.lshift.net>
	<BBE05A6D-8EDD-458F-B7CF-2FA326A8D2EF@gmail.com>
	<20090701151454.GC32183@mrnibble.lshift.net>
	<E7E5152B-38BB-44C3-8B24-5AA6CA15768B@gmail.com>
	<20090701152547.GD32183@mrnibble.lshift.net>
	<0C1869EA-8961-4500-B2A9-35F770EE48BC@gmail.com>
Message-ID: <167204d20907170441j46e84c1i8f46d1fb6a097f24@mail.gmail.com>

Joel,

Did you manage to resolve this in the end?

alexis


On Wed, Jul 1, 2009 at 4:43 PM, Joel Reymont<joelr1 at gmail.com> wrote:
>
> On Jul 1, 2009, at 4:25 PM, Matthew Sackman wrote:
>
>> Ok. One other thing is to use rabbitmqctl list_queues to see what
>> messages are left in the queue.
>
> Here's the result of 3 runs, starting with a fresh RabbitMQ instance:
>
> n: 100, good: 99, bad: 1, ?queued: 0
> n: 100, good: 21, bad: 79, queued: 100
> n: 100, good: 12, bad: 88, queued: 100
>
> Good is messages received, bad not received and queued is the number
> of messages in queues according to list_queues.
>
> Doesn't quite make sense to me.
>
> ---
> Mac hacker with a performance bent
> http://www.linkedin.com/in/joelreymont
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From tonyg at lshift.net  Fri Jul 17 13:06:05 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 13:06:05 +0100
Subject: [rabbitmq-discuss] .NET client SimpleRpcServer question
In-Reply-To: <4A5F6B2E.3080706@acceleration.net>
References: <4A292998.3090407@acceleration.net>	<4A2D70A5.6040907@lshift.net>	<4A2E878E.3000700@acceleration.net>	<4A2EA81B.8060303@acceleration.net>	<4A2EB25D.10907@acceleration.net>	<4A2EDC35.6030201@acceleration.net>
	<4A2EE289.3080505@lshift.net> <4A5F6B2E.3080706@acceleration.net>
Message-ID: <4A60692D.7010600@lshift.net>

Hi Ryan,

Ryan Davis wrote:
> Has your .NET programmer had a chance to look at this patch yet?  I have
> not had any problems running it in production (albeit with a light
> message load).

I've taken a look at the issue this morning; things are moving at last.
Sorry for the delay. I've just committed a proposed fix with a lighter
locking pattern to branch bug20945; hopefully it will pass QA soon and
be merged into default.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Fri Jul 17 13:17:53 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 13:17:53 +0100
Subject: [rabbitmq-discuss] Fwd:  Fwd: Objective-C AMQP Library
In-Reply-To: <2a8d4a710906092320w557861bbj50bdf10d1f5fc05e@mail.gmail.com>
References: <8018CECC-6BD8-4275-8DA4-7202B1221C84@mac.com>	<7C2FE79B-D629-4757-A1E6-3F148E9AA3DA@mac.com>	<2a8d4a710906092320i7e84556ay80d8bbdbc0c1e4df@mail.gmail.com>
	<2a8d4a710906092320w557861bbj50bdf10d1f5fc05e@mail.gmail.com>
Message-ID: <4A606BF1.8010708@lshift.net>

Matt Todd wrote:
> Perhaps even a library like libev or kqueue can
> be used to create the evented model I'm fond of?

I've used rabbitmq-c with both raw sockets and with libevent successfully.

The bundled sample programs all use raw sockets, and for a (quite
complex! and not finished) example using libevent, you could take a look
at http://github.com/tonyg/rais.

By the way, autoconf and automake are terrifying, but there really
aren't many alternatives. Straight-up Make is perhaps simpler to get
started with, though!

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net




From tonyg at lshift.net  Fri Jul 17 13:33:12 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 13:33:12 +0100
Subject: [rabbitmq-discuss] STOMP Adapter Example: Headers Exchange
In-Reply-To: <50c8ffe90906222314w5af83fbbl16057236a5ad9f92@mail.gmail.com>
References: <50c8ffe90906222314w5af83fbbl16057236a5ad9f92@mail.gmail.com>
Message-ID: <4A606F88.1030806@lshift.net>

Hi Darien,

Darien Kindlund wrote:
> As a sanity check for my code, could you upload a perl example using
> the new headers exchange via STOMP?  Also, is there example ruby code
> using the headers exchange via the AMQP ruby library?

I don't know about the ruby library; I've just committed a couple of
example perl scripts that use the STOMP adapter to bind to and publish
to the amq.headers exchange; see them here:

http://hg.rabbitmq.com/rabbitmq-stomp/file/66738337b04f/examples/perl/headers-example-recv.pl
http://hg.rabbitmq.com/rabbitmq-stomp/file/66738337b04f/examples/perl/headers-example-send.pl

Note the use of "X-B-" headers on the SUBSCRIBE, and "X-" headers on the
SEND.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Fri Jul 17 14:03:40 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 14:03:40 +0100
Subject: [rabbitmq-discuss] Issue related to message consumption
In-Reply-To: <FA3D7C54DA3A1540B2C92C93ACD215600556AB04@XOREXCH.India.XoriantCorp.com>
References: <FA3D7C54DA3A1540B2C92C93ACD215600556AB04@XOREXCH.India.XoriantCorp.com>
Message-ID: <4A6076AC.5000004@lshift.net>

Anand Ved wrote:
> However, during consumption, I face an exception (say NullPointer) which
> although I am catching it, traveses up to the Connection triggering it
> to be closed.

It's very strange that it keeps on travelling up even though it's being
caught!

> Please suggest if there is a better way of managing this.

Is it possible for you to switch to using QueueingConsumer instead?

>From the javadoc comment for interface Consumer:

" * Note: all methods of this interface are invoked inside the {@link
 * Connection}'s thread. This means they a) should be non-blocking and
 * generally do little work, b) must not call {@link Channel} or
 * {@link Connection} methods, or a deadlock will ensue. One way of
 * ensuring this is to use/subclass {@link QueueingConsumer}."

We recommend using QueueingConsumer if possible, to avoid issues like
that you've run in to.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Fri Jul 17 14:07:44 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 14:07:44 +0100
Subject: [rabbitmq-discuss] multiple consumers on one channel?
In-Reply-To: <84fb38e30907060849g3da67bc6m3b552260a9ad7e27@mail.gmail.com>
References: <84fb38e30907021023t527f9105jfb594e24e20e0097@mail.gmail.com>	<84fb38e30907021251m11f0f22na827784ff4fc70f1@mail.gmail.com>	<269388e30907051253v3749ac35kc05c0ef6673b09d5@mail.gmail.com>
	<84fb38e30907060849g3da67bc6m3b552260a9ad7e27@mail.gmail.com>
Message-ID: <4A6077A0.7040805@lshift.net>

tsuraan wrote:
> I would have thought there would be some interleaving of
> initial data, like the consumers would get alternating messages or
> something, but that doesn't seem to be the case.

The server is probably "too fast": seeing the first subscription, the
queue starts relaying out messages and manages to get through a large
number of them before it sees the second subscription. The queue is an
asynchronous process, independent of the channel process your client is
talking to.

If you wanted to experiment with this stuff some more, you could see
what effect basic.qos has on this behaviour.

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Fri Jul 17 14:09:12 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 14:09:12 +0100
Subject: [rabbitmq-discuss] Comet interface
In-Reply-To: <b0200d7f0907030406l3811e222r964358757ac0bb70@mail.gmail.com>
References: <b0200d7f0907030406l3811e222r964358757ac0bb70@mail.gmail.com>
Message-ID: <4A6077F8.4090403@lshift.net>

Ben Browitt wrote:
> I want to write a Comet web interface to RabbitMQ in Erlang.

Hi Ben,

Have you looked at http://hg.rabbitmq.com/rabbitmq-http2 ?

For an example of use, see http://dev.rabbitmq.com/chat/index.html (with
code here: http://dev.rabbitmq.com/chat/chat.js)

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Fri Jul 17 14:18:13 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 14:18:13 +0100
Subject: [rabbitmq-discuss] Channel thread safety in Java Client
In-Reply-To: <84fb38e30907042054x4eb31f7fo2a19eace3cf941cf@mail.gmail.com>
References: <84fb38e30907031334p56ac5affuf5d92c9428779477@mail.gmail.com>	<269388e30907040133m195bd06awf4692fa15e89b9bc@mail.gmail.com>
	<84fb38e30907042054x4eb31f7fo2a19eace3cf941cf@mail.gmail.com>
Message-ID: <4A607A15.3070606@lshift.net>

tsuraan wrote:
> I could do that.  I'd just have to keep track of which channel each
> message came from.

FYI, any subclass of DefaultConsumer has getChannel(), which returns the
channel that the Consumer is associated with. So, for example, given a
QueueingConsumer "qc":

 while (true) {
  QueueingConsumer.Delivery delivery = qc.nextDelivery();
  System.out.println("Message: " + new String(delivery.getBody()));
  qc.getChannel().basicAck(delivery.getEnvelope().getDeliveryTag(),
                           false);
 }

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From darien at kindlund.com  Fri Jul 17 14:20:26 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Fri, 17 Jul 2009 09:20:26 -0400
Subject: [rabbitmq-discuss] STOMP Adapter Example: Headers Exchange
In-Reply-To: <4A606F88.1030806@lshift.net>
References: <50c8ffe90906222314w5af83fbbl16057236a5ad9f92@mail.gmail.com>
	<4A606F88.1030806@lshift.net>
Message-ID: <156E287C-3DF2-4F68-BB2B-913EE2A1F48E@kindlund.com>

Perfect; thanks!

-- Darien

On Jul 17, 2009, at 8:33 AM, Tony Garnock-Jones <tonyg at lshift.net>  
wrote:

> Hi Darien,
>
> Darien Kindlund wrote:
>> As a sanity check for my code, could you upload a perl example using
>> the new headers exchange via STOMP?  Also, is there example ruby code
>> using the headers exchange via the AMQP ruby library?
>
> I don't know about the ruby library; I've just committed a couple of
> example perl scripts that use the STOMP adapter to bind to and publish
> to the amq.headers exchange; see them here:
>
> http://hg.rabbitmq.com/rabbitmq-stomp/file/66738337b04f/examples/perl/headers-example-recv.pl
> http://hg.rabbitmq.com/rabbitmq-stomp/file/66738337b04f/examples/perl/headers-example-send.pl
>
> Note the use of "X-B-" headers on the SUBSCRIBE, and "X-" headers on  
> the
> SEND.
>
> Regards,
>  Tony
> -- 
> [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
> []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Fri Jul 17 14:21:26 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 14:21:26 +0100
Subject: [rabbitmq-discuss] twiddling with rabbitmq-http2 on windows
In-Reply-To: <e55356640907101217i6dfe3c60g6940261335fa8f10@mail.gmail.com>
References: <e55356640907080930i3293b2b8h5ab4052170f632cf@mail.gmail.com>	<e55356640907100925y57a7b216w65f7f799f30cfff2@mail.gmail.com>
	<e55356640907101217i6dfe3c60g6940261335fa8f10@mail.gmail.com>
Message-ID: <4A607AD6.7050103@lshift.net>

Juhani R?nkimies wrote:
> Here's a dirty workaround for this problem. This is NOT a solution.
> Use only in your development env and if you absolutely need it, until
> the bug gets fixed in FF/FB.

Thanks for following this up, Juhani!

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From matthias at lshift.net  Fri Jul 17 14:23:59 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 17 Jul 2009 14:23:59 +0100
Subject: [rabbitmq-discuss] conceptual question
In-Reply-To: <167204d20907031147m6ea1d8f8ke2248f3bf084e238@mail.gmail.com>
References: <4BE7A2A4-4198-47A9-A1BD-B0D5F4E3CB39@gmail.com>	<167204d20907030806p1c178ea6jf4dde8d6cd653d6e@mail.gmail.com>	<897C0AFD34144B4F9DB484F132C698AD016162A7@VOO-EXCHANGE05.internal.sungard.corp>
	<167204d20907031147m6ea1d8f8ke2248f3bf084e238@mail.gmail.com>
Message-ID: <4A607B6F.1090700@lshift.net>

Alexis Richardson wrote:
> I am fairly sure that....
> 
> On Fri, Jul 3, 2009 at 7:38 PM, <Ken.Anderson at sungard.com> wrote:
>> Sorry to interject here, but I'm curious as to the answer as well.
>> I'm assuming the question is related to performance - does the
>> message make on hop between nodes, and then get distributed,
> 
> Yes.

Actually, the answer, at present, is 'no', though it used to be 'yes'.
We disabled the optimisation which sends just one copy of the message to
a node on which multiple destination queues reside, since it broke some
of AMQP's ordering guarantees. A fix for that, allowing us to re-enable
the optimisation, is on our todo list.


Matthias.



From tonyg at lshift.net  Fri Jul 17 14:24:30 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 14:24:30 +0100
Subject: [rabbitmq-discuss] Rmq WCF binding
In-Reply-To: <24428325.post@talk.nabble.com>
References: <24428325.post@talk.nabble.com>
Message-ID: <4A607B8E.2020801@lshift.net>

tammof wrote:
> Is it somehow possible to feed the messages manually into the queue that is
> binded to the webservice via the wcf-binding?
> 
> In other words:
> I want to manually insert messages into the queue at the according message
> broker so that they get delivered to the webservice.

It is *possible*, but it's not *easy*, from what I understand of WCF. I
think it's largely WS-* carried over whatever transport adapters you
have -- in this case AMQP -- so you'd have to deal with all the WS-*
stuff yourself.

I could be wrong, however! :-)

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Fri Jul 17 14:31:44 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 14:31:44 +0100
Subject: [rabbitmq-discuss] "None of the specified endpoints were
	reachable"
In-Reply-To: <D7F3579680FB2F4B9A040F9BC78865F76445E65B82@OLCA9095.btcnet.btc-ag.com>
References: <D7F3579680FB2F4B9A040F9BC78865F76445E65B82@OLCA9095.btcnet.btc-ag.com>
Message-ID: <4A607D40.6050609@lshift.net>

Hi Tammo,

Tammo.Filusch at btc-ag.com wrote:
> after sending about 4000msg each in a single thread using the above
> code,  im getting error that states:
> "None of the specified endpoints were reachable".

That's interesting. Are the messages really sent (as in, are they
received by some consumer further down the chain)?

Here's an example exception report I see when I have no broker running.
Notice how there's an "Endpoints attempted" report below the main
exception report. What does your system print for the "Endpoints
attempted" report?

None of the specified endpoints were reachable
Endpoints attempted:
  endpoint=amqp-0-8://localhost:5672, attempts=1, outcome=Connection refused
Stack trace:
  at RabbitMQ.Client.ConnectionFactory.CreateConnection (Int32
maxRedirects, RabbitMQ.Client.AmqpTcpEndpoint[] endpoints) [0x00000]
  at RabbitMQ.Client.ConnectionFactory.CreateConnection
(RabbitMQ.Client.AmqpTcpEndpoint[] endpoints) [0x00000]
  at RabbitMQ.Client.ConnectionFactory.CreateConnection (System.String
address) [0x00000]
  at RabbitMQ.Client.Examples.LogTail.Main (System.String[] args) [0x00000]




From darien at kindlund.com  Fri Jul 17 14:31:52 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Fri, 17 Jul 2009 09:31:52 -0400
Subject: [rabbitmq-discuss] Headers Exchange Logic
Message-ID: <DA8DCBDB-CBF9-4BF8-860B-15FFE706E40C@kindlund.com>

Hi Tony,

I just have a general question about the headers exchange  
implementation in RabbitMQ.  According to the spec (I think), you can  
supply regex to match on particular headers, when binding a queue to  
an exchange.  However, I wondering if it's possible to do something  
like:

- Declare exchange 'foo'
- Declare queue 'bar'
- Bind 'bar' to 'foo', where header 'VALUE > 20'.  Meaning: evaluate  
this header; if it's not an integer or if the value is <= 20, discard  
or let other applicable queues receive it. Otherwise, accept.

I'm pretty sure this type of language isn't supported, but I'd be  
curious if it's something you're considering in the future.

-- Darien



From opendev at gmail.com  Fri Jul 17 14:57:23 2009
From: opendev at gmail.com (Joern)
Date: Fri, 17 Jul 2009 15:57:23 +0200
Subject: [rabbitmq-discuss] Component lifecycle notifications
Message-ID: <9e009ad0907170657o1c000791ifff4d7d34626b81f@mail.gmail.com>

Hi RabbitMQ list,

is there some kind of component lifecycle notification support
available in some branch / planned / already implemented? I was
thinking about sth. along the lines of messages being send when
components (Exchanges, Queues and Bindings) are declared or
(auto)deleted. This would solve the problem of modelling presence real
nicely.

Best regards,


Joern
--



From lynton.grice at logosworld.com  Fri Jul 17 15:09:10 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Fri, 17 Jul 2009 16:09:10 +0200
Subject: [rabbitmq-discuss] RabbitMQ Consumer Error
In-Reply-To: <167204d20907170402m4f128024q625cdba187bbc07c@mail.gmail.com>
References: <2856908155873130970@unknownmsgid>
	<167204d20907170402m4f128024q625cdba187bbc07c@mail.gmail.com>
Message-ID: <001201ca06e8$2af81080$80e83180$@grice@logosworld.com>

Hi Alexis,

I will drop the Carrot guys the message ;-)

Chat later

Lynton

-----Original Message-----
From: Alexis Richardson [mailto:alexis.richardson at gmail.com] 
Sent: 17 July 2009 01:02 PM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ Consumer Error

Excellent - have you mentioned this to the Carrot folks?


On Mon, Jul 13, 2009 at 6:31 AM, Lynton
Grice<lynton.grice at logosworld.com> wrote:
> Hi there,
>
>
>
> I seemed to have solved the issue....it all had to do with the
> ?content_encoding?....so I replaced this:
>
>
>
> Content = #content{class_id = 60,
>
> ??????????????? ???? properties = amqp_util:basic_properties(),
>
> ??????????????? ???? properties = Properties,
>
> ??????????????? ???? properties_bin = none,
>
> ??????????????? ???? payload_fragments_rev = [Payload]
>
> ??????????????? ??? },
>
>
>
> With this:
>
>
>
> Properties = #'P_basic'{content_type = <<"application/octet-stream">>,
>
> ??????????????? ?????? content_encoding = <<"binary">>,
>
> ?????????????? ???????delivery_mode = 1,
>
> ?????????????? ???????priority = 0},
>
> ??????????????? Content = #content{class_id = 60,
>
> ??????????????? ???? properties = Properties,
>
> ??????????????? ???? properties_bin = none,
>
> ??????????????? ???? payload_fragments_rev = [Payload]
>
> ??????????????? ??? },
>
>
>
> Now my Python consumer in CARROT is working 100% ;-)
>
>
>
> Chat later
>
>
>
> Lynton
>
> From: rabbitmq-discuss-bounces at lists.rabbitmq.com
> [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Lynton
> Grice
> Sent: 12 July 2009 07:13 PM
> To: rabbitmq-discuss at lists.rabbitmq.com
> Subject: [rabbitmq-discuss] RabbitMQ Consumer Error
>
>
>
> Hi there,
>
>
>
> I wonder if someone can help me on this one. I am building the following
> scenario:
>
>
>
> Client -> Mochiweb -> RabbitMQ (via Erlang RabbitMQ Client code) -> Python
> consumer (using the Python CARROT AMQP library)
>
>
>
> I have everything working right until the Python consumer picks up the
> message. I get the following error:
>
>
>
> "No JSON object could be decoded"
>
>
>
> ?Let me step back a second.....here is an example of the BINARY sent from
> the Erlang client (inside Mochiweb) to RabbitMQ:
>
>
>
> NOTE: I have simplified the call by just making a binary called ?Hello
> World? for ?Payload?
>
>
>
> Payload = <<"Hello World">>,
>
> ??????????????? Content = #content{class_id = 60,
>
> ??????????????? ???? properties = amqp_util:basic_properties(),
>
> ??????????????? ???? properties_bin = none,
>
> ??????????????? ???? payload_fragments_rev = [Payload]
>
> ??????????????? ??? },
>
> ??????????????? amqp_channel:cast(Channel, BasicPublish, Content),
>
>
>
> When the Python JSON library (decoder.py) receives this I can see the
> message is formatted like:
>
>
>
> ?Hello World?
>
>
>
> But if I send to RabbitMQ like follows using PYTHON..
>
>
>
> from carrot.messaging import Publisher
>
> from carrot.connection import AMQPConnection
>
>
>
> amqpconn = AMQPConnection(hostname="localhost", port=5672, userid="guest",
> password="guest",vhost="/")
>
> publisher = Publisher(connection=amqpconn, exchange="amq.direct",
> routing_key="a.b.c.*")
>
> publisher.send('Hello World')
>
> publisher.close()
>
>
>
> I get the following for the message in the Python JSON library
(decoder.py):
>
>
>
> ??Hello World??
>
>
>
> NOTE the subtle different between the two.....the first one is ?Hello
World?
> (from Erlang) and the second (from Python) is ??Hello World??
>
>
>
> I am just wondering if this is a ?Unicode? thing or do I need to do
> something to the Erlang BINARY before sending it to RabbitMQ?
>
>
>
> I think this could also have to do with the BUILT IN JSON library in
Python
> 2.6......I will look into that.....
>
>
>
> Thanks for the help....much appreciated ;-)
>
>
>
> Lynton
>
>
>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>




From 0x6e6562 at gmail.com  Fri Jul 17 15:30:23 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Fri, 17 Jul 2009 15:30:23 +0100
Subject: [rabbitmq-discuss] Headers Exchange Logic
In-Reply-To: <DA8DCBDB-CBF9-4BF8-860B-15FFE706E40C@kindlund.com>
References: <DA8DCBDB-CBF9-4BF8-860B-15FFE706E40C@kindlund.com>
Message-ID: <269388e30907170730t37c03a7tb45a55c87fd39ccb@mail.gmail.com>

Darien,

On Fri, Jul 17, 2009 at 2:31 PM, Darien Kindlund<darien at kindlund.com> wrote:
> I just have a general question about the headers exchange
> implementation in RabbitMQ. ?According to the spec (I think), you can
> supply regex to match on particular headers, when binding a queue to
> an exchange. ?However, I wondering if it's possible to do something
> like:
>
> - Declare exchange 'foo'
> - Declare queue 'bar'
> - Bind 'bar' to 'foo', where header 'VALUE > 20'. ?Meaning: evaluate
> this header; if it's not an integer or if the value is <= 20, discard
> or let other applicable queues receive it. Otherwise, accept.
>
> I'm pretty sure this type of language isn't supported, but I'd be
> curious if it's something you're considering in the future.

This is basically the JMS selector semantics, which IIRC are generally
implemented in the client  as opposed to the broker (I think that MQ
Series version 7 has some kind of server side support for this, but I
haven't used it myself).

We did look at this briefly, but decided to shelve this feature
because it is very difficult to implement on the broker side because
of the multi-dimensional indexes you'd have to maintain.

Having said that, maybe implementing it on the broker side is perhaps
being a bit too fancy - maybe you can just trade off network bandwidth
for broker side query complexity.

Having said this though, you'd probably want a way to reject messages
without having to nuke the channel.

HTH,

Ben



From tonyg at lshift.net  Fri Jul 17 15:41:23 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 15:41:23 +0100
Subject: [rabbitmq-discuss] Headers Exchange Logic
In-Reply-To: <DA8DCBDB-CBF9-4BF8-860B-15FFE706E40C@kindlund.com>
References: <DA8DCBDB-CBF9-4BF8-860B-15FFE706E40C@kindlund.com>
Message-ID: <4A608D93.4080100@lshift.net>

Hi Darien,

Darien Kindlund wrote:
> According to the spec (I think), you can supply regex to
> match on particular headers, when binding a queue to an exchange. 

Sadly, it's not even regular expressions. It's either an AND or an OR of
various headers each either existing, or precisely matching the pattern
supplied.

> However, I wondering if it's possible to do something like:
> - Bind 'bar' to 'foo', where header 'VALUE > 20'.  Meaning: evaluate
> this header; if it's not an integer or if the value is <= 20, discard or
> let other applicable queues receive it. Otherwise, accept.

No, not yet.

> I'm pretty sure this type of language isn't supported, but I'd be
> curious if it's something you're considering in the future.

Absolutely -- there's a hugely rich vein of possible exchange behaviours
waiting to be explored. Streaming SQL? Javascript-based message
matching? The sky's the limit :)

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Fri Jul 17 15:44:50 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Fri, 17 Jul 2009 15:44:50 +0100
Subject: [rabbitmq-discuss] Component lifecycle notifications
In-Reply-To: <9e009ad0907170657o1c000791ifff4d7d34626b81f@mail.gmail.com>
References: <9e009ad0907170657o1c000791ifff4d7d34626b81f@mail.gmail.com>
Message-ID: <4A608E62.8050309@lshift.net>

Hi Joern,

Totally! You've got the right idea. There have been a few experiments
along those lines, most notably bug19230. It's lagging the mainline
releases quite significantly at the moment, but could be revived. Here's
a quick description of the experiment:

"Alternative experimental presence scheme, with amq.rabbitmq.presence
exchange and every queue broadcasting startup/shutdown into it, with the
queue name in the routing key."

There are some serious issues to resolve before any of this stuff will
hit mainline releases, though.

Regards,
  Tony


Joern wrote:
> Hi RabbitMQ list,
> 
> is there some kind of component lifecycle notification support
> available in some branch / planned / already implemented? I was
> thinking about sth. along the lines of messages being send when
> components (Exchanges, Queues and Bindings) are declared or
> (auto)deleted. This would solve the problem of modelling presence real
> nicely.
> 
> Best regards,
> 
> 
> Joern
> --
> 
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss


-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From matthew at lshift.net  Fri Jul 17 15:52:12 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Fri, 17 Jul 2009 15:52:12 +0100
Subject: [rabbitmq-discuss] tcp -> rabbitmq gives emfile + 541
In-Reply-To: <407fa4640907010914w73941cf1rc0688d079d68d8bb@mail.gmail.com>
References: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>
	<407fa4640907010213h542c1baaw868f53c7633b1aac@mail.gmail.com>
	<4A4B7619.8030702@lshift.net>
	<407fa4640907010831r9586f87lef707694e035d16b@mail.gmail.com>
	<20090701153921.GF32183@mrnibble.lshift.net>
	<407fa4640907010914w73941cf1rc0688d079d68d8bb@mail.gmail.com>
Message-ID: <20090717145212.GA32204@mrnibble.lshift.net>

Dear Michael,

Sorry for the delay getting back to you. We're all pretty swamped here.

On Wed, Jul 01, 2009 at 05:14:05PM +0100, Michael Nacos wrote:
> could you offer a rule of thumb for calculating the AMQP message size? I am
> sending lists of 5-10 ASCII characters.

Well on the wire, it's pretty efficient - probably only a dozen bytes or
so for AMQP headers (but then, yeah you've got TCP and IP etc as
normal). In memory Erlang won't be quite as efficient, but we keep the
message payload as a binary blob so that won't be expanded. I'd say a
reasonable guess is 100 bytes plus the size of the payload.

However, if the payload is under 64 bytes then Erlang will permit
multiple copies of it to exist in memory at the same time which could in
this case (because the messages, at least as far as v1.6 and before are
concerned) are stored in several places, so you can get duplication of
data. This has been trimmed back somewhat for the new disk queue stuff
so you may well see in the future that for small message sizes, there is
greater efficiency in use of memory.

> Judging from the disk space consumed
> by the mnesia directory, however, I think it's possible we are exhausting
> the RAM, if all messages are also kept in memory. And yes, just before the
> vm crashes, free shows little memory left (~150Mb), there is a little bit of
> lag between reaching this amount and the crash, it's a little hard to tell
> because rabbitmq runs on the database server and there are other programs
> running as well.

Right. Yeah, exhausting RAM is pretty common problem really, and
something that the new disk queue really does address well. "Stay tuned"
is about the best I can offer at this stage. I'm tempted to say it
shouldn't be too much longer, but then I've thought that before and been
proved wrong...

Matthew



From darien at kindlund.com  Fri Jul 17 15:55:07 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Fri, 17 Jul 2009 10:55:07 -0400
Subject: [rabbitmq-discuss] Headers Exchange Logic
In-Reply-To: <269388e30907170730t37c03a7tb45a55c87fd39ccb@mail.gmail.com>
References: <DA8DCBDB-CBF9-4BF8-860B-15FFE706E40C@kindlund.com> 
	<269388e30907170730t37c03a7tb45a55c87fd39ccb@mail.gmail.com>
Message-ID: <50c8ffe90907170755w607cff9n6a81cbafa4edac0e@mail.gmail.com>

Hi Ben,

> We did look at this briefly, but decided to shelve this feature
> because it is very difficult to implement on the broker side because
> of the multi-dimensional indexes you'd have to maintain.
>
> Having said that, maybe implementing it on the broker side is perhaps
> being a bit too fancy - maybe you can just trade off network bandwidth
> for broker side query complexity.
>
> Having said this though, you'd probably want a way to reject messages
> without having to nuke the channel.

Understood.  Thanks for the clarification.  So currently, custom
header processing such as this would require all applicable consumers
receive a copy of the message with the expectation that 1 consumer
will process the message, while the remaining consumers would simply
drop it on the floor.  Yes, essentially, that would work -- the only
downside is the additional CPU processing required by each consumer
(that evaluated and dropped the message, so N-1 consumers total),
along with the network bandwidth associated with sending the messages
to the (N-1) consumers.

This solution is feasible, as long as N remains relatively small.
There's a point, though, where N becomes large enough to want this
functionality pushed to the AMQP server.

Hi Tony,

> Absolutely -- there's a hugely rich vein of possible exchange behaviours
> waiting to be explored. Streaming SQL? Javascript-based message
> matching? The sky's the limit :)

Okay, I'm glad it's something on your radar.  I realize this type of
support can quickly become extremely complicated, so I understand why
it's not developed just yet.  One thing to keep in mind is that as you
support more complicated evaluations, you'll require the AMQP server
to generate more and more CPU cycles per message.  If you're in an
environment where you don't entirely trust all the consumers, then you
probably want some sort of sanity checking on the evaluation logic
each consumer supplies the server during a bind request.  For example,
if the pseudo code for the bind header were something like:
"while(true) { header > 2; }" then the first evaluation becomes a DoS
attack.  Thus, you'd probably want to set a max evaluation timeout and
if during any message processing, the eval logic takes more than X
amount of time --- *keep* the message in the queue, but *destroy* the
queue/binding of the offending consumer, so that the consumer is
penalized but the message can still be (potentially) reliably
delivered.

I'm sure there's a lot more complexity to deal with than just this
example, but I hope it helps.

Regards,
-- Darien



From tsuraan at gmail.com  Fri Jul 17 17:47:45 2009
From: tsuraan at gmail.com (tsuraan)
Date: Fri, 17 Jul 2009 11:47:45 -0500
Subject: [rabbitmq-discuss] multiple consumers on one channel?
In-Reply-To: <4A6077A0.7040805@lshift.net>
References: <84fb38e30907021023t527f9105jfb594e24e20e0097@mail.gmail.com>
	<84fb38e30907021251m11f0f22na827784ff4fc70f1@mail.gmail.com>
	<269388e30907051253v3749ac35kc05c0ef6673b09d5@mail.gmail.com>
	<84fb38e30907060849g3da67bc6m3b552260a9ad7e27@mail.gmail.com>
	<4A6077A0.7040805@lshift.net>
Message-ID: <84fb38e30907170947n25854129je2e42d4b5b38f0ea@mail.gmail.com>

> The server is probably "too fast": seeing the first subscription, the
> queue starts relaying out messages and manages to get through a large
> number of them before it sees the second subscription. The queue is an
> asynchronous process, independent of the channel process your client is
> talking to.

Yeah, that's right.  I have a really terrible mental model of how
rabbit works right now.  I know, consciously, that consume is async,
and that the server sends a lot of messages as soon as the first
consume call is made, but somehow it doesn't click in my head.  I'll
get the hang of this sooner or later :)

>
> If you wanted to experiment with this stuff some more, you could see
> what effect basic.qos has on this behaviour.

Yeah, I'll have a look at that.  Thanks!



From amitrathore at gmail.com  Sat Jul 18 02:33:59 2009
From: amitrathore at gmail.com (Amit Rathore)
Date: Fri, 17 Jul 2009 18:33:59 -0700
Subject: [rabbitmq-discuss] strange behavior with non-persistent message
	settings
Message-ID: <909FDB87-28EF-4C56-997B-5D94C4465CFC@gmail.com>

I'm a RabbitMQ newbie, so this may be that I'm doing something stupid...

  I'm using TEXT_PLAIN field from MessageProperties to send a message  
- this is supposed to set the deliveryMode property to 1 which means  
non-persistent. However, when the consumer comes up (after a producer  
already sent a message), it receives the message. It shouldn't right,  
since it was non-persistent?

Any help would be greatly appreciated, thanks in advance!

Regards,
Amit



From amitrathore at gmail.com  Sat Jul 18 03:23:42 2009
From: amitrathore at gmail.com (Amit Rathore)
Date: Fri, 17 Jul 2009 19:23:42 -0700
Subject: [rabbitmq-discuss] strange behavior with non-persistent message
	settings
In-Reply-To: <909FDB87-28EF-4C56-997B-5D94C4465CFC@gmail.com>
References: <909FDB87-28EF-4C56-997B-5D94C4465CFC@gmail.com>
Message-ID: <ffa680d90907171923v8113e5egd6ee07af572bc7a7@mail.gmail.com>

Or perhaps I misunderstand what persistent means - and what I really want to
do is to disable the store-and-forward behavior... is there a way to do
that?

On Fri, Jul 17, 2009 at 6:33 PM, Amit Rathore <amitrathore at gmail.com> wrote:

> I'm a RabbitMQ newbie, so this may be that I'm doing something stupid...
>
>  I'm using TEXT_PLAIN field from MessageProperties to send a message - this
> is supposed to set the deliveryMode property to 1 which means
> non-persistent. However, when the consumer comes up (after a producer
> already sent a message), it receives the message. It shouldn't right, since
> it was non-persistent?
>
> Any help would be greatly appreciated, thanks in advance!
>
> Regards,
> Amit
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090717/0939df71/attachment.htm 

From lynton.grice at logosworld.com  Sat Jul 18 10:59:11 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Sat, 18 Jul 2009 11:59:11 +0200
Subject: [rabbitmq-discuss] Query RabbitMQ with "queue.query" or
	"exchange.query"?
Message-ID: <003d01ca078e$69b34ff0$3d19efd0$@grice@logosworld.com>

Hi there,

 

I am wanting to know if it is (or will be possible sometime) that we can
QUERY the contents of an exchange or queue?

 

I am wanting to be able to BROWSE / PEEK the messages in an exchange or
queue and noticed that the AMQP specification has both a "queue.query" and a
"exchange.query"......does RabbitMQ implement these yet? Are there any plans
to do this?

 

Thanks for the help '-)

 

Lynton

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090718/065feac6/attachment.htm 

From alexis.richardson at gmail.com  Sat Jul 18 11:15:09 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sat, 18 Jul 2009 11:15:09 +0100
Subject: [rabbitmq-discuss] Query RabbitMQ with "queue.query" or
	"exchange.query"?
In-Reply-To: <1479649607685268236@unknownmsgid>
References: <1479649607685268236@unknownmsgid>
Message-ID: <167204d20907180315o697cd6b3j78d33891b4980395@mail.gmail.com>

Which version of the spec are you looking at?

The short answer is no, but you could create a custom exchange to
route based on queries.


On Sat, Jul 18, 2009 at 10:59 AM, Lynton
Grice<lynton.grice at logosworld.com> wrote:
> Hi there,
>
>
>
> I am wanting to know if it is (or will be possible sometime) that we can
> QUERY the contents of an exchange or queue?
>
>
>
> I am wanting to be able to BROWSE / PEEK the messages in an exchange or
> queue and noticed that the AMQP specification has both a ?queue.query? and a
> ?exchange.query?......does RabbitMQ implement these yet? Are there any plans
> to do this?
>
>
>
> Thanks for the help ?-)
>
>
>
> Lynton
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From lynton.grice at logosworld.com  Sat Jul 18 11:29:13 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Sat, 18 Jul 2009 12:29:13 +0200
Subject: [rabbitmq-discuss] Query RabbitMQ with "queue.query" or
	"exchange.query"?
In-Reply-To: <167204d20907180315o697cd6b3j78d33891b4980395@mail.gmail.com>
References: <1479649607685268236@unknownmsgid>
	<167204d20907180315o697cd6b3j78d33891b4980395@mail.gmail.com>
Message-ID: <004801ca0792$9c260f00$d4722d00$@grice@logosworld.com>

Hi there,

I am looking at the AMQP 0.10 spec....

I guess I am just trying to work out what RabbitMQ will be doing in the
future to cater for the ability to PEEK / BROWSE messages without pulling
them off ....

Chat later ;-)

Lynton

-----Original Message-----
From: Alexis Richardson [mailto:alexis.richardson at gmail.com] 
Sent: 18 July 2009 12:15 PM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Query RabbitMQ with "queue.query" or
"exchange.query"?

Which version of the spec are you looking at?

The short answer is no, but you could create a custom exchange to
route based on queries.


On Sat, Jul 18, 2009 at 10:59 AM, Lynton
Grice<lynton.grice at logosworld.com> wrote:
> Hi there,
>
>
>
> I am wanting to know if it is (or will be possible sometime) that we can
> QUERY the contents of an exchange or queue?
>
>
>
> I am wanting to be able to BROWSE / PEEK the messages in an exchange or
> queue and noticed that the AMQP specification has both a "queue.query" and
a
> "exchange.query"......does RabbitMQ implement these yet? Are there any
plans
> to do this?
>
>
>
> Thanks for the help '-)
>
>
>
> Lynton
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>




From alexis.richardson at gmail.com  Sat Jul 18 11:42:04 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sat, 18 Jul 2009 11:42:04 +0100
Subject: [rabbitmq-discuss] Query RabbitMQ with "queue.query" or
	"exchange.query"?
In-Reply-To: <2765550512156536252@unknownmsgid>
References: <1479649607685268236@unknownmsgid>
	<167204d20907180315o697cd6b3j78d33891b4980395@mail.gmail.com>
	<2765550512156536252@unknownmsgid>
Message-ID: <167204d20907180342y34a22c0dj972cc529d0f5f2cb@mail.gmail.com>

On Sat, Jul 18, 2009 at 11:29 AM, Lynton
Grice<lynton.grice at logosworld.com> wrote:
> Hi there,
>
> I am looking at the AMQP 0.10 spec....

RabbitMQ does not support AMQP 0-10.

You need to look at AMQP 0-8 and 0-9-1.  They are very similar.
RabbitMQ supports 0-8 and we have some 0-9-1 support working 'in the
labs'.  It's on the roadmap.






> I guess I am just trying to work out what RabbitMQ will be doing in the
> future to cater for the ability to PEEK / BROWSE messages without pulling
> them off ....

It's a good question for this list :-)

alexis





> Chat later ;-)
>
> Lynton
>
> -----Original Message-----
> From: Alexis Richardson [mailto:alexis.richardson at gmail.com]
> Sent: 18 July 2009 12:15 PM
> To: Lynton Grice
> Cc: rabbitmq-discuss at lists.rabbitmq.com
> Subject: Re: [rabbitmq-discuss] Query RabbitMQ with "queue.query" or
> "exchange.query"?
>
> Which version of the spec are you looking at?
>
> The short answer is no, but you could create a custom exchange to
> route based on queries.
>
>
> On Sat, Jul 18, 2009 at 10:59 AM, Lynton
> Grice<lynton.grice at logosworld.com> wrote:
>> Hi there,
>>
>>
>>
>> I am wanting to know if it is (or will be possible sometime) that we can
>> QUERY the contents of an exchange or queue?
>>
>>
>>
>> I am wanting to be able to BROWSE / PEEK the messages in an exchange or
>> queue and noticed that the AMQP specification has both a "queue.query" and
> a
>> "exchange.query"......does RabbitMQ implement these yet? Are there any
> plans
>> to do this?
>>
>>
>>
>> Thanks for the help '-)
>>
>>
>>
>> Lynton
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>>
>
>



From 0x6e6562 at gmail.com  Sat Jul 18 11:45:47 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sat, 18 Jul 2009 11:45:47 +0100
Subject: [rabbitmq-discuss] strange behavior with non-persistent message
	settings
In-Reply-To: <909FDB87-28EF-4C56-997B-5D94C4465CFC@gmail.com>
References: <909FDB87-28EF-4C56-997B-5D94C4465CFC@gmail.com>
Message-ID: <5318F147-41A0-42FC-A60A-00728D9CED1D@gmail.com>

Amit,

On 18 Jul 2009, at 02:33, Amit Rathore <amitrathore at gmail.com> wrote:

> I'm a RabbitMQ newbie, so this may be that I'm doing something  
> stupid...
>
>  I'm using TEXT_PLAIN field from MessageProperties to send a message
> - this is supposed to set the deliveryMode property to 1 which means
> non-persistent. However, when the consumer comes up (after a producer
> already sent a message), it receives the message. It shouldn't right,
> since it was non-persistent.

If there is a bound queue, then any messages will get routed,  
irrespective of whether there is a consumer or not. One way to bind  
the queue's lifecycle to the consumer is to set the auto-delete flag  
on queue declaration, or just nuke it yourself. BTW reading the spec's  
description of the commands helps understand the model semantics.

HTH,

Ben



From lynton.grice at logosworld.com  Sat Jul 18 15:58:17 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Sat, 18 Jul 2009 16:58:17 +0200
Subject: [rabbitmq-discuss] RabbitMQ Synchronous Client Example?
Message-ID: <000001ca07b8$3273d7b0$975b8710$@grice@logosworld.com>

Hi guys,

 

Quick one.....I have the following scenario:

 

Client sends message -> Mochiweb HTTP Server -> AMQP Erlang client ->
RabbitMQ -> PYTHON consumer

 

Obviously the scenario suits ASYNCHRONOUS processing very well.......but now
I want to handle SYNCHRONOUS as well....? 

 

So what I would like is a SYNCHRONOUS scenario whereby the message goes from
the client -> Mochiweb HTTP server -> then to the AMQP Erlang client, this
then sends the message to RabbitMQ and blocks for a RESPONSE (waits for
return message).....then the Python consumer picks up the
message....processes it and sends the response to a "RESPONSE queue".....the
code then receives this response message (via some type of "correlationID"?)
and sends it back to the calling client.

 

So basically how are synchronous scenarios handles in RabbitMQ? Does anyone
have any example code in Erlang (or other) that shows how to process a
message with ID "123" in RabbitMQ and put the result of message "123" into
some other response queue..

 

Well I suppose when I speak of queues above maybe it should be
"exchange"....maybe with a "routing_key"? The "routing_key" could be an
internal "correlationID" of sorts?

 

So essentially the process will seem SYNCHRONOUS from that calling client
but will be ASYNCHRONOUS in the "internals"...

 

Any ideas?

 

Thanks for the help ;-)

 

Lynton

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090718/f1defce6/attachment.htm 

From alexis.richardson at gmail.com  Sat Jul 18 19:47:32 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sat, 18 Jul 2009 19:47:32 +0100
Subject: [rabbitmq-discuss] RabbitMQ Synchronous Client Example?
In-Reply-To: <-4784230161917205322@unknownmsgid>
References: <-4784230161917205322@unknownmsgid>
Message-ID: <167204d20907181147w4ff8a03dwb85aa237b224e59a@mail.gmail.com>

Lynton

There should be some examples of the RPC pattern in the source and
docs.  At least for Java and .NET.  You could also look at some of the
python and ruby synchronous clients.  None of them use HTTP though.
They all use AMQP (iirc).

alexis


On Sat, Jul 18, 2009 at 3:58 PM, Lynton
Grice<lynton.grice at logosworld.com> wrote:
> Hi guys,
>
>
>
> Quick one.....I have the following scenario:
>
>
>
> Client sends message -> Mochiweb HTTP Server -> AMQP Erlang client ->
> RabbitMQ -> PYTHON consumer
>
>
>
> Obviously the scenario suits ASYNCHRONOUS processing very well.......but now
> I want to handle SYNCHRONOUS as well....?
>
>
>
> So what I would like is a SYNCHRONOUS scenario whereby the message goes from
> the client -> Mochiweb HTTP server -> then to the AMQP Erlang client, this
> then sends the message to RabbitMQ and blocks for a RESPONSE (waits for
> return message).....then the Python consumer picks up the
> message....processes it and sends the response to a ?RESPONSE queue?.....the
> code then receives this response message (via some type of ?correlationID??)
> and sends it back to the calling client.
>
>
>
> So basically how are synchronous scenarios handles in RabbitMQ? Does anyone
> have any example code in Erlang (or other) that shows how to process a
> message with ID ?123? in RabbitMQ and put the result of message ?123? into
> some other response queue..
>
>
>
> Well I suppose when I speak of queues above maybe it should be
> ?exchange?....maybe with a ?routing_key?? The ?routing_key? could be an
> internal ?correlationID? of sorts?
>
>
>
> So essentially the process will seem SYNCHRONOUS from that calling client
> but will be ASYNCHRONOUS in the ?internals?...
>
>
>
> Any ideas?
>
>
>
> Thanks for the help ;-)
>
>
>
> Lynton
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From lynton.grice at logosworld.com  Sun Jul 19 08:59:06 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Sun, 19 Jul 2009 09:59:06 +0200
Subject: [rabbitmq-discuss] RabbitMQ Synchronous Client Example?
In-Reply-To: <167204d20907181147w4ff8a03dwb85aa237b224e59a@mail.gmail.com>
References: <-4784230161917205322@unknownmsgid>
	<167204d20907181147w4ff8a03dwb85aa237b224e59a@mail.gmail.com>
Message-ID: <000301ca0846$cd484940$67d8dbc0$@grice@logosworld.com>

Hi Alexis,

Ideally I would want an AMQP client in Erlang code for the RPC pattern....I
will check it out, thanks for the help ;-)

Lynton

-----Original Message-----
From: Alexis Richardson [mailto:alexis.richardson at gmail.com] 
Sent: 18 July 2009 08:48 PM
To: Lynton Grice
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] RabbitMQ Synchronous Client Example?

Lynton

There should be some examples of the RPC pattern in the source and
docs.  At least for Java and .NET.  You could also look at some of the
python and ruby synchronous clients.  None of them use HTTP though.
They all use AMQP (iirc).

alexis


On Sat, Jul 18, 2009 at 3:58 PM, Lynton
Grice<lynton.grice at logosworld.com> wrote:
> Hi guys,
>
>
>
> Quick one.....I have the following scenario:
>
>
>
> Client sends message -> Mochiweb HTTP Server -> AMQP Erlang client ->
> RabbitMQ -> PYTHON consumer
>
>
>
> Obviously the scenario suits ASYNCHRONOUS processing very well.......but
now
> I want to handle SYNCHRONOUS as well....?
>
>
>
> So what I would like is a SYNCHRONOUS scenario whereby the message goes
from
> the client -> Mochiweb HTTP server -> then to the AMQP Erlang client, this
> then sends the message to RabbitMQ and blocks for a RESPONSE (waits for
> return message).....then the Python consumer picks up the
> message....processes it and sends the response to a "RESPONSE
queue".....the
> code then receives this response message (via some type of
"correlationID"?)
> and sends it back to the calling client.
>
>
>
> So basically how are synchronous scenarios handles in RabbitMQ? Does
anyone
> have any example code in Erlang (or other) that shows how to process a
> message with ID "123" in RabbitMQ and put the result of message "123" into
> some other response queue..
>
>
>
> Well I suppose when I speak of queues above maybe it should be
> "exchange"....maybe with a "routing_key"? The "routing_key" could be an
> internal "correlationID" of sorts?
>
>
>
> So essentially the process will seem SYNCHRONOUS from that calling client
> but will be ASYNCHRONOUS in the "internals"...
>
>
>
> Any ideas?
>
>
>
> Thanks for the help ;-)
>
>
>
> Lynton
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>




From work at anomalizer.net  Sun Jul 19 13:28:15 2009
From: work at anomalizer.net (Arvind Jayaprakash)
Date: Sun, 19 Jul 2009 17:58:15 +0530
Subject: [rabbitmq-discuss] how can i make a message to be consumed at	a
	later time
In-Reply-To: <c647ccce0907051009g184679a9k87c2f42877d5dde0@mail.gmail.com>
References: <c647ccce0907051009g184679a9k87c2f42877d5dde0@mail.gmail.com>
Message-ID: <20090719122815.GA7411@aa>

On Jul 06, Qingyan(Evan) Liu wrote:
>Sorry i'm fresh to rabbitmq. I wanna to use it like a timer, for
>example, producer publishes a message called 'bomb', what i want is to
>consume(explode) the 'bomb' after 5 minutes. Can i implement such case
>by means of rabbitmq? And how?

No.

A MQ is a wrong kind of tool to achieve the behaviour you are looking
for. Message queues are asynchronous and distributed systems; a message
reaches the destination when it reaches; there is nothing you can do
about it.



From 0x6e6562 at gmail.com  Sun Jul 19 14:54:02 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 19 Jul 2009 14:54:02 +0100
Subject: [rabbitmq-discuss] RabbitMQ Synchronous Client Example?
In-Reply-To: <3393856920438896037@unknownmsgid>
References: <-4784230161917205322@unknownmsgid>
	<167204d20907181147w4ff8a03dwb85aa237b224e59a@mail.gmail.com>
	<3393856920438896037@unknownmsgid>
Message-ID: <269388e30907190654u1b2d78ebi913dc3fc9ee59c54@mail.gmail.com>

Lynton,

On Sun, Jul 19, 2009 at 8:59 AM, Lynton
Grice<lynton.grice at logosworld.com> wrote:

> Ideally I would want an AMQP client in Erlang code for the RPC pattern....I
> will check it out, thanks for the help ;-)

Not really sure if I understand you correctly but there is an RPC over
AMQP pattern in the Erlang client.

Check out the test case for it to see it's usage (the test is called
rpc_test/1 in the test_util module).

HTH,

Ben



From 0x6e6562 at gmail.com  Sun Jul 19 14:55:57 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 19 Jul 2009 14:55:57 +0100
Subject: [rabbitmq-discuss] how can i make a message to be consumed at a
	later time
In-Reply-To: <20090719122815.GA7411@aa>
References: <c647ccce0907051009g184679a9k87c2f42877d5dde0@mail.gmail.com>
	<20090719122815.GA7411@aa>
Message-ID: <269388e30907190655y21e22220w72887d793df4d135@mail.gmail.com>

On Sun, Jul 19, 2009 at 1:28 PM, Arvind Jayaprakash<work at anomalizer.net> wrote:
> On Jul 06, Qingyan(Evan) Liu wrote:
>>Sorry i'm fresh to rabbitmq. I wanna to use it like a timer, for
>>example, producer publishes a message called 'bomb', what i want is to
>>consume(explode) the 'bomb' after 5 minutes. Can i implement such case
>>by means of rabbitmq? And how?
>
> No.
>
> A MQ is a wrong kind of tool to achieve the behaviour you are looking
> for. Message queues are asynchronous and distributed systems; a message
> reaches the destination when it reaches; there is nothing you can do
> about it.

AMQP does have the concept of message expiry - it just hasn't been
implemented in Rabbit.

Ben



From lynton.grice at logosworld.com  Sun Jul 19 15:27:22 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Sun, 19 Jul 2009 16:27:22 +0200
Subject: [rabbitmq-discuss] RabbitMQ Synchronous Client Example?
In-Reply-To: <269388e30907190654u1b2d78ebi913dc3fc9ee59c54@mail.gmail.com>
References: <-4784230161917205322@unknownmsgid>	
	<167204d20907181147w4ff8a03dwb85aa237b224e59a@mail.gmail.com>	
	<3393856920438896037@unknownmsgid>
	<269388e30907190654u1b2d78ebi913dc3fc9ee59c54@mail.gmail.com>
Message-ID: <000301ca087d$0c668520$25338f60$@grice@logosworld.com>

Hi Ben,

Yup, I ran that earlier and it worked fine....thanks....

Can you explain to me how it would work if I had a PYTHON consumer (or
other) that would take the message off the queue....process it and send it
back? What do I send it back to?  I assume it would all be on
"correlationid".....

I can see the TEST code below:

rpc_test(Connection) ->
    Q = uuid(),
    Fun = fun(X) -> X + 1 end,
    RPCHandler = fun(X) -> term_to_binary(Fun(binary_to_term(X))) end,
    Server = amqp_rpc_server:start(Connection, Q, RPCHandler),
    Client = amqp_rpc_client:start(Connection, Q),
    Input = 1,
    Reply = amqp_rpc_client:call(Client, term_to_binary(Input)),
    Expected = Fun(Input),
    DecodedReply = binary_to_term(Reply),
    ?assertMatch(Expected, DecodedReply),
    amqp_rpc_client:stop(Client),
    amqp_rpc_server:stop(Server),
    ok.

So as I mentioned above I want to send the message to a Python consumer, let
it process the message and send the response back....

Any ideas? Or a rough sketch on how that would work?

Thanks for the help, I really appreciate it ;-)

Lynton



 
-----Original Message-----
From: Ben Hood [mailto:0x6e6562 at gmail.com] 
Sent: 19 July 2009 03:54 PM
To: Lynton Grice
Cc: rabbitmq
Subject: Re: [rabbitmq-discuss] RabbitMQ Synchronous Client Example?

Lynton,

On Sun, Jul 19, 2009 at 8:59 AM, Lynton
Grice<lynton.grice at logosworld.com> wrote:

> Ideally I would want an AMQP client in Erlang code for the RPC
pattern....I
> will check it out, thanks for the help ;-)

Not really sure if I understand you correctly but there is an RPC over
AMQP pattern in the Erlang client.

Check out the test case for it to see it's usage (the test is called
rpc_test/1 in the test_util module).

HTH,

Ben




From 0x6e6562 at gmail.com  Sun Jul 19 21:29:09 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Sun, 19 Jul 2009 21:29:09 +0100
Subject: [rabbitmq-discuss] RabbitMQ Synchronous Client Example?
In-Reply-To: <7248684255621155988@unknownmsgid>
References: <-4784230161917205322@unknownmsgid>
	<167204d20907181147w4ff8a03dwb85aa237b224e59a@mail.gmail.com>
	<3393856920438896037@unknownmsgid>
	<269388e30907190654u1b2d78ebi913dc3fc9ee59c54@mail.gmail.com>
	<7248684255621155988@unknownmsgid>
Message-ID: <269388e30907191329q6bfa8dcfs2500e0b6c598a8fc@mail.gmail.com>

Lynton,

On Sun, Jul 19, 2009 at 3:27 PM, Lynton
Grice<lynton.grice at logosworld.com> wrote:
> Can you explain to me how it would work if I had a PYTHON consumer (or
> other) that would take the message off the queue....process it and send it
> back? What do I send it back to? ?I assume it would all be on
> "correlationid".....
..
> So as I mentioned above I want to send the message to a Python consumer, let
> it process the message and send the response back....

The client sets both the name of it's private queue in the reply-to
field and and creates a unique correlation id for each RPC. So all the
"server" has to do when responding is to a) set the routing key of the
message to the value of the reply-to field it received on the inbound
message and b) copy the correlation id from the inbound message to the
resulting outbound message. There are examples of how to do this in
the Erlang, Java and .NET clients - just look for modules/classes
called RpcServer.

HTH,

Ben



From m.nacos at gmail.com  Mon Jul 20 09:52:59 2009
From: m.nacos at gmail.com (Michael Nacos)
Date: Mon, 20 Jul 2009 11:52:59 +0300
Subject: [rabbitmq-discuss] tcp -> rabbitmq gives emfile + 541
In-Reply-To: <20090717145212.GA32204@mrnibble.lshift.net>
References: <407fa4640906300131v20b285fau1787ceadafa5bbec@mail.gmail.com>
	<407fa4640907010213h542c1baaw868f53c7633b1aac@mail.gmail.com>
	<4A4B7619.8030702@lshift.net>
	<407fa4640907010831r9586f87lef707694e035d16b@mail.gmail.com>
	<20090701153921.GF32183@mrnibble.lshift.net>
	<407fa4640907010914w73941cf1rc0688d079d68d8bb@mail.gmail.com>
	<20090717145212.GA32204@mrnibble.lshift.net>
Message-ID: <407fa4640907200152j348105a9v540d4245e6d68446@mail.gmail.com>

Dear Matthew,

thanks for your email and sorry I have not followed this up. Since our last
emails I have confirmed that the crashes are RAM-related by attaching
appropriate consumers and running the experiments again. As long as the
messages are consumed at a decent rate, our new rabbity sub-sys does not
crash. Which is fine for the time being, but does introduce an additional
dependency, from an operational perspective. So, I am still looking forward
to the new persister.

I am on holidays now, but when I return, I am hoping to submit/publish some
examples of the way we are (ab-)using rabbit.

cheers,

Michael
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090720/2d1e2c96/attachment.htm 

From juhani at juranki.com  Mon Jul 20 10:24:56 2009
From: juhani at juranki.com (=?ISO-8859-1?Q?Juhani_R=E4nkimies?=)
Date: Mon, 20 Jul 2009 12:24:56 +0300
Subject: [rabbitmq-discuss] rabbitmq-http2 with jquery
Message-ID: <e55356640907200224n684fbdfbm92b7b1a8c0638654@mail.gmail.com>

Hi,

I translated the browser part of rabbitmq-http2 from prototype to jquery.
Drop jq_rabbitmq.hs to server_root/htdocs and jq_chat.* to
server_root/htdocs/chat to try it out

(preprepreprealpha warning)

-juhani
-------------- next part --------------
A non-text attachment was scrubbed...
Name: jq_rabbitmq.zip
Type: application/zip
Size: 3949 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090720/5850a174/attachment.zip 

From 0x6e6562 at gmail.com  Mon Jul 20 11:07:50 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 20 Jul 2009 11:07:50 +0100
Subject: [rabbitmq-discuss] rabbitmq-http2 with jquery
In-Reply-To: <e55356640907200224n684fbdfbm92b7b1a8c0638654@mail.gmail.com>
References: <e55356640907200224n684fbdfbm92b7b1a8c0638654@mail.gmail.com>
Message-ID: <269388e30907200307o3476e65bpad3575066cf67431@mail.gmail.com>

Hey Juhani,

On Mon, Jul 20, 2009 at 10:24 AM, Juhani R?nkimies<juhani at juranki.com> wrote:
> I translated the browser part of rabbitmq-http2 from prototype to jquery.
> Drop jq_rabbitmq.hs to server_root/htdocs and jq_chat.* to
> server_root/htdocs/chat to try it out
>
> (preprepreprealpha warning)

Unfortunately for you, this work has already been done, albeit it has
not been QA'ed and merged into the default yet. If you're interested,
bug21150 in the hg repo refers.

Just BTW, this adapter *may* be receiving some more TLC soon, so if
you want to avoid implementing things twice, or conversely, allowing
us to avoid unnecessary work I suggest dropping a line first :-)

Cheers,

Ben



From juhani at juranki.com  Mon Jul 20 12:47:17 2009
From: juhani at juranki.com (=?ISO-8859-1?Q?Juhani_R=E4nkimies?=)
Date: Mon, 20 Jul 2009 14:47:17 +0300
Subject: [rabbitmq-discuss] rabbitmq-http2 with jquery
In-Reply-To: <269388e30907200307o3476e65bpad3575066cf67431@mail.gmail.com>
References: <e55356640907200224n684fbdfbm92b7b1a8c0638654@mail.gmail.com>
	<269388e30907200307o3476e65bpad3575066cf67431@mail.gmail.com>
Message-ID: <e55356640907200447q658b1b49mea726baa6a36da1c@mail.gmail.com>

On Mon, Jul 20, 2009 at 1:07 PM, Ben Hood<0x6e6562 at gmail.com> wrote:

> Unfortunately for you, this work has already been done, albeit it has
> not been QA'ed and merged into the default yet.

Learned a lot with a small effort, and now I'm getting a QA'd implementation.
Don't feel unfortunate at all :-)

> If you're interested,
> bug21150 in the hg repo refers.

Having a look. You're dropping support for prototype?

> Just BTW, this adapter *may* be receiving some more TLC soon, so if
> you want to avoid implementing things twice, or conversely, allowing
> us to avoid unnecessary work I suggest dropping a line first :-)
>

I'll try to keep that in mind.

Delightful to see a surge of activity on rabbitmq-http2 change log.
I can see jquery on client-side, and plugin architecture and otp on server-side.
Do you have something else in mind for the adapter?

-juhani



From 0x6e6562 at gmail.com  Mon Jul 20 14:42:40 2009
From: 0x6e6562 at gmail.com (Ben Hood)
Date: Mon, 20 Jul 2009 14:42:40 +0100
Subject: [rabbitmq-discuss] rabbitmq-http2 with jquery
In-Reply-To: <e55356640907200447q658b1b49mea726baa6a36da1c@mail.gmail.com>
References: <e55356640907200224n684fbdfbm92b7b1a8c0638654@mail.gmail.com>
	<269388e30907200307o3476e65bpad3575066cf67431@mail.gmail.com>
	<e55356640907200447q658b1b49mea726baa6a36da1c@mail.gmail.com>
Message-ID: <269388e30907200642m15d3e4a3h1bddee3078986c80@mail.gmail.com>

Juhani,

On Mon, Jul 20, 2009 at 12:47 PM, Juhani R?nkimies<juhani at juranki.com> wrote:
> Having a look. You're dropping support for prototype?

Most likely. The cool kids seem to be using jquery :-)

> Delightful to see a surge of activity on rabbitmq-http2 change log.
> I can see jquery on client-side, and plugin architecture and otp on server-side.
> Do you have something else in mind for the adapter?

Potentially, but I don't want to talk about unlaid eggs just yet. I'll
let you know in due course if anything transpires.

Cheers,

Ben



From ryan at acceleration.net  Mon Jul 20 16:27:22 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Mon, 20 Jul 2009 11:27:22 -0400
Subject: [rabbitmq-discuss] .NET client SimpleRpcServer question
In-Reply-To: <4A60692D.7010600@lshift.net>
References: <4A292998.3090407@acceleration.net>	<4A2D70A5.6040907@lshift.net>	<4A2E878E.3000700@acceleration.net>	<4A2EA81B.8060303@acceleration.net>	<4A2EB25D.10907@acceleration.net>	<4A2EDC35.6030201@acceleration.net>
	<4A2EE289.3080505@lshift.net> <4A5F6B2E.3080706@acceleration.net>
	<4A60692D.7010600@lshift.net>
Message-ID: <4A648CDA.8000804@acceleration.net>

Tony Garnock-Jones wrote:
> I've taken a look at the issue this morning; things are moving at last.
> Sorry for the delay. I've just committed a proposed fix with a lighter
> locking pattern to branch bug20945; hopefully it will pass QA soon and
> be merged into default.
>   
Great!  No worries on the delay, hope you had a great holiday.  I'd like
to clarify where I'm supposed to call SimpleRpcServer.Close().  Looking
at the Shutdownable examples in branch bug20945, it looks like I'm
supposed to send the server a special "shut me down" AMQP message, and
have the server call Close().  Is that correct?

Thanks,

Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506





From brian at echonest.com  Mon Jul 20 16:47:34 2009
From: brian at echonest.com (Brian Whitman)
Date: Mon, 20 Jul 2009 11:47:34 -0400
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
Message-ID: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>

Hi, I am trying to implement this (python code):
http://notes.variogr.am/post/143623387/broadcasting-your-logs-with-rabbitmq-and-python

Which is a simple fanout exchange that any # of listeners can bind to with a
random queue name. My goal is to have the messages sent to the exchange but
not stick around in any way. If there are no queues bound to the exchange,
the messages should disappear. If there are listeners, the messages should
get sent out but not stay in the broker.

This is not what I'm seeing: running the broker for a few minutes with a few
listeners registered I have:

~/rabbitmq-server/scripts# ./rabbitmqctl list_queues name mode messages
messages_ready messages_unacknowledged durable
Listing queues ...
logger_d179b888-753c-11de-b258-0023dfde57d8 mixed 46847 46847 0 false
logger_a0856c74-753f-11de-b4dd-0022413719b3 mixed 17946 17946 0 false
logger_6c317904-7530-11de-996e-0023dfde57d8 mixed 79776 79776 0 false
logger mixed 301503 301503 0 false

Note that logger is the producer's "writer" queue. The logger_UUID() ones
are the consumers/listeners.

I am concerned about this because over the weekend the broker crashed
(not sure why yet, but I assume it had something to do with probably
~50m messages sitting in the exchange.) How
can I have messages be completely transient?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090720/f17cccbc/attachment.htm 

From tonyg at lshift.net  Mon Jul 20 16:49:20 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Mon, 20 Jul 2009 16:49:20 +0100
Subject: [rabbitmq-discuss] .NET client SimpleRpcServer question
In-Reply-To: <4A648CDA.8000804@acceleration.net>
References: <4A292998.3090407@acceleration.net>	<4A2D70A5.6040907@lshift.net>	<4A2E878E.3000700@acceleration.net>	<4A2EA81B.8060303@acceleration.net>	<4A2EB25D.10907@acceleration.net>	<4A2EDC35.6030201@acceleration.net>
	<4A2EE289.3080505@lshift.net> <4A5F6B2E.3080706@acceleration.net>
	<4A60692D.7010600@lshift.net> <4A648CDA.8000804@acceleration.net>
Message-ID: <4A649200.1070603@lshift.net>

Hi Ryan,

Ryan Davis wrote:
> Great!  No worries on the delay, hope you had a great holiday.  I'd like
> to clarify where I'm supposed to call SimpleRpcServer.Close().  Looking
> at the Shutdownable examples in branch bug20945, it looks like I'm
> supposed to send the server a special "shut me down" AMQP message, and
> have the server call Close().  Is that correct?

The example has two styles of call to Close: one from within the 
server's own mainloop, as you describe, but also one in a detached 
thread sitting outside the mainloop. It seems important to me to be able 
to robustly shut down a Subscription from both within and without. So 
your original example should work fine, too.

Tony



From holger.hoffstaette at googlemail.com  Mon Jul 20 17:10:53 2009
From: holger.hoffstaette at googlemail.com (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Mon, 20 Jul 2009 18:10:53 +0200
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>
Message-ID: <4A64970D.7070309@googlemail.com>

Brian Whitman wrote:
> I am concerned about this because over the weekend the broker crashed
> (not sure why yet, but I assume it had something to do with probably
> ~50m messages sitting in the exchange.) How can I have messages be
> completely transient?

This is done with the "immediate" flag for a message; if there is no
recipient, the message will be dropped.

-h



From matthias at lshift.net  Mon Jul 20 17:20:02 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 20 Jul 2009 17:20:02 +0100
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <4A64970D.7070309@googlemail.com>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>
	<4A64970D.7070309@googlemail.com>
Message-ID: <4A649932.6030905@lshift.net>

Brian, Holger,

Holger Hoffst?tte wrote:
> Brian Whitman wrote:
>> I am concerned about this because over the weekend the broker crashed
>> (not sure why yet, but I assume it had something to do with probably
>> ~50m messages sitting in the exchange.) How can I have messages be
>> completely transient?
> 
> This is done with the "immediate" flag for a message; if there is no
> recipient, the message will be dropped.

Actually, generally a better solution to the problem is to ensure that
the queues do not outlive the consumers - by either marking them
exclusive (if you only have one consumer per queue) or auto-delete.

That way messages do really get dropped silently when there are no
consumers. By contrast, when setting 'immediate' the server will send a
basic.return to the producer.

And buffering can still take place to deal with temporarily
backlogged/slow consumers. By contrast, with 'immediate' the messages
will get dropped when the consumers are busy (not just when they are not
present).


Regards,

Matthias.



From brian at echonest.com  Mon Jul 20 17:36:36 2009
From: brian at echonest.com (Brian Whitman)
Date: Mon, 20 Jul 2009 12:36:36 -0400
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <4A649932.6030905@lshift.net>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>
	<4A64970D.7070309@googlemail.com> <4A649932.6030905@lshift.net>
Message-ID: <dbd9700a0907200936r4aff4bc2xf92a3aeafe021c47@mail.gmail.com>

Hmm... this is not working the way I expect.
If I do either Holger or Matthias's solution the write-only "logger" queue
continues to grow but the listener queues do stay at 0:

~/rabbitmq-server/scripts# ./rabbitmqctl list_queues name mode messages
messages_ready messages_unacknowledged durable
Listing queues ...
logger_2b02ca30-754b-11de-99c0-0023dfde57d8 mixed 0 0 0 false
logger mixed 110 110 0 false

What I would like to see here is that logger is always 0 messages. If there
are listeners or not, I don't want the queue called "logger" to ever retain
any messages.

For both "logger" (write only) and the random queue names (read only) I am
doing

    ch.exchange_declare(my_exchange, 'fanout', durable=False,
auto_delete=False)
    qname, n_msgs, n_consumers = ch.queue_declare(queue_name, durable=False,
exclusive=False, auto_delete=True)







On Mon, Jul 20, 2009 at 12:20 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Brian, Holger,
>
> Holger Hoffst?tte wrote:
> > Brian Whitman wrote:
> >> I am concerned about this because over the weekend the broker crashed
> >> (not sure why yet, but I assume it had something to do with probably
> >> ~50m messages sitting in the exchange.) How can I have messages be
> >> completely transient?
> >
> > This is done with the "immediate" flag for a message; if there is no
> > recipient, the message will be dropped.
>
> Actually, generally a better solution to the problem is to ensure that
> the queues do not outlive the consumers - by either marking them
> exclusive (if you only have one consumer per queue) or auto-delete.
>
> That way messages do really get dropped silently when there are no
> consumers. By contrast, when setting 'immediate' the server will send a
> basic.return to the producer.
>
> And buffering can still take place to deal with temporarily
> backlogged/slow consumers. By contrast, with 'immediate' the messages
> will get dropped when the consumers are busy (not just when they are not
> present).
>
>
> Regards,
>
> Matthias.
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090720/79eeae2f/attachment.htm 

From holger.hoffstaette at googlemail.com  Mon Jul 20 17:51:51 2009
From: holger.hoffstaette at googlemail.com (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Mon, 20 Jul 2009 18:51:51 +0200
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <4A649932.6030905@lshift.net>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>	<4A64970D.7070309@googlemail.com>
	<4A649932.6030905@lshift.net>
Message-ID: <4A64A0A7.7050601@googlemail.com>

Matthias Radestock wrote:
>> This is done with the "immediate" flag for a message; if there is no
>> recipient, the message will be dropped.
> 
> Actually, generally a better solution to the problem is to ensure that
> the queues do not outlive the consumers - by either marking them
> exclusive (if you only have one consumer per queue) or auto-delete.

Good point! Likely the better solution.

> And buffering can still take place to deal with temporarily
> backlogged/slow consumers. By contrast, with 'immediate' the messages
> will get dropped when the consumers are busy (not just when they are not
> present).

But what about when clients are half-dead, e.g. silently looping or
whatever, without disconnecting - especially in the case of
non-multithreaded clients like python/ruby etc.? Will the server only
buffer until the zombie consumer is killed for good (e.g. by a watchdog)
and then zap the backlog? Otherwise an undetected zombie can still gobble
up memory (or soon disk). I guess in that case only auto-expiry would help.

cheers
-h



From brian at echonest.com  Mon Jul 20 17:51:58 2009
From: brian at echonest.com (Brian Whitman)
Date: Mon, 20 Jul 2009 12:51:58 -0400
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <dbd9700a0907200936r4aff4bc2xf92a3aeafe021c47@mail.gmail.com>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>
	<4A64970D.7070309@googlemail.com> <4A649932.6030905@lshift.net>
	<dbd9700a0907200936r4aff4bc2xf92a3aeafe021c47@mail.gmail.com>
Message-ID: <dbd9700a0907200951x491c953lfe6b90537bee43b0@mail.gmail.com>

Ah, if I do both
    ch.exchange_declare(my_exchange, 'fanout', durable=False,
auto_delete=False)
    qname, n_msgs, n_consumers = ch.queue_declare(queue_name, durable=False,
exclusive=False, auto_delete=True)
and send the message as immediate

    def message(self, message):
        self.ch.basic_publish(
            amqp.Message(pickle.dumps(message)),
            my_exchange, "logger", immediate=True
        )

Then it works the way I expect.




On Mon, Jul 20, 2009 at 12:36 PM, Brian Whitman <brian at echonest.com> wrote:

> Hmm... this is not working the way I expect.
> If I do either Holger or Matthias's solution the write-only "logger" queue
> continues to grow but the listener queues do stay at 0:
>
> ~/rabbitmq-server/scripts# ./rabbitmqctl list_queues name mode messages
> messages_ready messages_unacknowledged durable
> Listing queues ...
> logger_2b02ca30-754b-11de-99c0-0023dfde57d8 mixed 0 0 0 false
> logger mixed 110 110 0 false
>
> What I would like to see here is that logger is always 0 messages. If there
> are listeners or not, I don't want the queue called "logger" to ever retain
> any messages.
>
> For both "logger" (write only) and the random queue names (read only) I am
> doing
>
>     ch.exchange_declare(my_exchange, 'fanout', durable=False,
> auto_delete=False)
>     qname, n_msgs, n_consumers = ch.queue_declare(queue_name,
> durable=False, exclusive=False, auto_delete=True)
>
>
>
>
>
>
>
> On Mon, Jul 20, 2009 at 12:20 PM, Matthias Radestock <matthias at lshift.net>wrote:
>
>> Brian, Holger,
>>
>> Holger Hoffst?tte wrote:
>> > Brian Whitman wrote:
>> >> I am concerned about this because over the weekend the broker crashed
>> >> (not sure why yet, but I assume it had something to do with probably
>> >> ~50m messages sitting in the exchange.) How can I have messages be
>> >> completely transient?
>> >
>> > This is done with the "immediate" flag for a message; if there is no
>> > recipient, the message will be dropped.
>>
>> Actually, generally a better solution to the problem is to ensure that
>> the queues do not outlive the consumers - by either marking them
>> exclusive (if you only have one consumer per queue) or auto-delete.
>>
>> That way messages do really get dropped silently when there are no
>> consumers. By contrast, when setting 'immediate' the server will send a
>> basic.return to the producer.
>>
>> And buffering can still take place to deal with temporarily
>> backlogged/slow consumers. By contrast, with 'immediate' the messages
>> will get dropped when the consumers are busy (not just when they are not
>> present).
>>
>>
>> Regards,
>>
>> Matthias.
>>
>> _______________________________________________
>> rabbitmq-discuss mailing list
>> rabbitmq-discuss at lists.rabbitmq.com
>> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090720/8c0cbe64/attachment.htm 

From matthias at lshift.net  Mon Jul 20 17:54:56 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 20 Jul 2009 17:54:56 +0100
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <dbd9700a0907200936r4aff4bc2xf92a3aeafe021c47@mail.gmail.com>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>	<4A64970D.7070309@googlemail.com>
	<4A649932.6030905@lshift.net>
	<dbd9700a0907200936r4aff4bc2xf92a3aeafe021c47@mail.gmail.com>
Message-ID: <4A64A160.1050902@lshift.net>

Brian,

Brian Whitman wrote:
> Hmm... this is not working the way I expect. 
> 
> If I do either Holger or Matthias's solution the write-only "logger"
> queue continues to grow but the listener queues do stay at 0:
> 
> ~/rabbitmq-server/scripts# ./rabbitmqctl list_queues name mode messages
> messages_ready messages_unacknowledged durable
> Listing queues ...
> logger_2b02ca30-754b-11de-99c0-0023dfde57d8 mixed 0 0 0 false
> logger mixed 110 110 0 false
> 
> What I would like to see here is that logger is always 0 messages. If
> there are listeners or not, I don't want the queue called "logger" to
> ever retain any messages. 
> 
> For both "logger" (write only) and the random queue names (read only) I
> am doing
> 
>     ch.exchange_declare(my_exchange, 'fanout', durable=False,
> auto_delete=False)
>     qname, n_msgs, n_consumers = ch.queue_declare(queue_name,
> durable=False, exclusive=False, auto_delete=True)
> 

If you have declared logger_* and logger as auto_delete then they should
not show up in list_queues *unless*

- both of them currently have consumers

- both of them have never had any consumers

The former case is presumably correct behaviour for you, so I suspect
what you are seeing is an instance of the second behaviour. The question
then is: How did you end up with queues that have never had any
consumers? Generally the way to avoid that is to make the *consumers*
perform these three steps:

1) declare auto-delete (or exclusive, if there is only one consumer per
queue) queue
2) bind queue
3) consume from queue

Note that queue declaration and binding are idempotent.


Matthias.
PS: I see you are using a development branch of the server. That could
have bugs in that area, so please try to get things working first using
the 1.6.0 release.



From matthias at lshift.net  Mon Jul 20 17:58:41 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 20 Jul 2009 17:58:41 +0100
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <4A64A0A7.7050601@googlemail.com>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>	<4A64970D.7070309@googlemail.com>	<4A649932.6030905@lshift.net>
	<4A64A0A7.7050601@googlemail.com>
Message-ID: <4A64A241.8080306@lshift.net>

Holger,

Holger Hoffst?tte wrote:
> But what about when clients are half-dead, e.g. silently looping or
> whatever, without disconnecting - especially in the case of
> non-multithreaded clients like python/ruby etc.? Will the server only
> buffer until the zombie consumer is killed for good (e.g. by a watchdog)
> and then zap the backlog? Otherwise an undetected zombie can still gobble
> up memory (or soon disk). I guess in that case only auto-expiry would help.

Dealing with "half-dead" clients is tricky - how do you know/decide when
a client is dead? Message expiries (not yet implemented in RabbitMQ) do
indeed provide (one) way of addressing that.


Matthias.



From matthias at lshift.net  Mon Jul 20 20:20:12 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 20 Jul 2009 20:20:12 +0100
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
In-Reply-To: <50c8ffe90907081245u7b398e58l8f18f29b5e123b87@mail.gmail.com>
References: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com>
	<50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com>
	<1247077600.26930.50.camel@eric-desktop.grokthis.net>	<50c8ffe90907081155l2bbd603as8cc9a707fe7a1d08@mail.gmail.com>
	<1247080750.26930.75.camel@eric-desktop.grokthis.net>
	<50c8ffe90907081245u7b398e58l8f18f29b5e123b87@mail.gmail.com>
Message-ID: <4A64C36C.7060800@lshift.net>

Darien, Eric, Lauren,

Darien Kindlund wrote:
> Okay, I think Laurens original issue was that she wanted RabbitMQ to
> verify SSL connections -- not individual messages... with the idea of
> different client certificates being allowed access to different
> vhosts.
> 
> So, based on this, there's no need to have consumers verify
> signed/encrypted messages ... since the logic of comparing credentials
> per vhost is more suited on the RabbitMQ server than pushing that
> verification to each consumer.  I agree that if you're looking for
> end-to-end security, signing/encrypting/verifying messages certainly
> prevents any consumers from handling untrusted data.  However, having
> only this signing/encrypting/verifying capability at the end points
> (producer/consumer) and doing nothing on RabbitMQ does not address the
> issue of dealing with an _untrusted_ producer from shoving malformed
> messages onto RabbitMQ -- although these messages would eventually be
> discarded by the consumer, it could still end up being a
> denial-of-service (DoS) condition.

We are in the final stages of qa'ing "native" SSL support for the 
RabbitMQ server, Java, .net and Erlang clients that addressed the above. 
A description of the new functionality is available at 
https://dev.rabbitmq.com/wiki/SslSupport, and you can find the code in 
the 'bug19356' branches of the respective hg repositories.

>  Specifically, the RabbitMQ server needs to verify the CLIENT's
> certificate credentials (not any server certs) -- specifically (I'm
> guessing) verifying the client's certificate is valid and that its
> path is valid (which stunnel can already do for you, given a valid set
> of CA certificates to use).  But also, look at the client
> certificate's DN and depending on what the DN matches... allow or deny
> access to the corresponding vhost channel.

The new code can verify the client certs. Access to particular vhosts, 
and specific resources can be controlled by the existing RabbitMQ 
permissions system based on the supplied user name.

Note that there is no association of subjectDNs and users, so in 
principle any user can use any trusted cert. That should be ok though as 
long as the username/password are treated as sensitive information in 
the same way as the private keys for the client certs.


Regards,

Matthias



From darien at kindlund.com  Mon Jul 20 20:46:09 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Mon, 20 Jul 2009 15:46:09 -0400
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
In-Reply-To: <4A64C36C.7060800@lshift.net>
References: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com> 
	<50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com> 
	<1247077600.26930.50.camel@eric-desktop.grokthis.net>
	<50c8ffe90907081155l2bbd603as8cc9a707fe7a1d08@mail.gmail.com> 
	<1247080750.26930.75.camel@eric-desktop.grokthis.net>
	<50c8ffe90907081245u7b398e58l8f18f29b5e123b87@mail.gmail.com> 
	<4A64C36C.7060800@lshift.net>
Message-ID: <50c8ffe90907201246y3dba41f9n41cb0d17a76c2516@mail.gmail.com>

Hi Matthias,

Great start!

Couple of basic questions:
1) So, for reference, would we call this AMQPS, AMQP-SSL, or SAMPQ ?
2) Are you planning on supporting CRLs and/or OCSP for certificate revocation?
3) Can we specify the cipher strength?

> Note that there is no association of subjectDNs and users, so in principle
> any user can use any trusted cert. That should be ok though as long as the
> username/password are treated as sensitive information in the same way as
> the private keys for the client certs.

4) Okay once SSL is supported natively, do you think a future version
of RabbitMQ would be able to map particular subjectDNs to existing
username/password credentials?  It would be really nice if clients
could authenticate with only client certs and nothing else.  An
example lightweight implementation could simply be:
- Create username/password pairs using rabbitmqctl, where each pair
really represents a "client profile".  We assume the password portion
will never be used, so we set it to something ridiculously long.
- Use rabbitmqctl to declare a many-to-one relationship between sets
of subjectDNs and usernames, where each subjectDNs match maps to a
valid username.  Conflicting subjectDN entries could be resolved
either by: (a) first match wins (so order matters) or (b) most
specific match wins (and actively disallow duplicate
subjectDN/username bindings).

I'm guessing #4 may actually break the existing AMQP spec, since we're
talking about bypassing username/password authentication.  If that's
the case, I'm not sure if you typically wait for the spec to get
ratified before implementing any experimental features, such as this.

Regards,
-- Darien



From matthias at lshift.net  Mon Jul 20 21:00:55 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 20 Jul 2009 21:00:55 +0100
Subject: [rabbitmq-discuss] Suggested small changes to
	/etc/init.d/rabbitmq-server
In-Reply-To: <19036.5787.668952.233232@jon.es>
References: <19036.5787.668952.233232@jon.es>
Message-ID: <4A64CCF7.8060502@lshift.net>

Terry,

Terry Jones wrote:
> It would be nice if /etc/init.d/rabbitmq-server allowed one to customize
> where it writes the output that currently goes to /var/log/rabbitmq.
> 
> Attached is a trivial diff to allow the directory for those files to be set
> in /etc/default/rabbitmq

Sounds like a good idea and the patch looks fine. I have filed a bug to 
get (something like) this incorporated.

> Is there any decent reason why the scripts in /usr/sbin/rabbit-* refuse to
> run rabbitmq unless you're root?  Seeing as a normal user can directly run
> /usr/lib/rabbitmq/bin/rabbit-*, I don't really see the point of denying a
> normal user in /usr/sbin/rabbit-*.

The scripts in /usr/sbin are there to start/control system-wide 
instances of RabbitMQ. That's why they are in sbin and need to be run as 
root. They are actually very thin wrappers around the scripts in 
/usr/lib/rabbitmq/bin, and it's the latter that should be invoked (in 
combination with suitable env var / config settings) if you want to run 
rabbit as an ordinary user.

> The /usr/sbin scripts could check to see if you're root and use su
> rabbitmq if so, and just run as the user if not. The worst that can
> happen is that rabbit fails to start, isn't it?

Rabbit failing to start is what *will* happen if we allowed ordinary 
users to run the scripts in /usr/sbin, unless they changed various 
paths/permissions to the mnesia dirs, log files etc. Many RabbitMQ users 
ran into this (and were perplexed by the resulting error messages) 
before we added the root check.

> Last time, I went behind the back of the normal rabbit startup
> scripts (using rabbitmqctl_real) to get things done as a normal user.
> It would be nice to just be able to run /etc/init.d/rabbit-server and
> not to have to hack it again this time

As above, the scripts in /etc/init.d/ are meant to be run as root and 
are for system-wide processes. Running them as ordinary users is 
generally not supported.


Regards,

Matthias.



From matthias at lshift.net  Mon Jul 20 21:14:20 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 20 Jul 2009 21:14:20 +0100
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
In-Reply-To: <50c8ffe90907201246y3dba41f9n41cb0d17a76c2516@mail.gmail.com>
References: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com>
	<50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com>
	<1247077600.26930.50.camel@eric-desktop.grokthis.net>	<50c8ffe90907081155l2bbd603as8cc9a707fe7a1d08@mail.gmail.com>
	<1247080750.26930.75.camel@eric-desktop.grokthis.net>	<50c8ffe90907081245u7b398e58l8f18f29b5e123b87@mail.gmail.com>
	<4A64C36C.7060800@lshift.net>
	<50c8ffe90907201246y3dba41f9n41cb0d17a76c2516@mail.gmail.com>
Message-ID: <4A64D01C.6020908@lshift.net>

Darien,

Darien Kindlund wrote:
> Couple of basic questions:
> 1) So, for reference, would we call this AMQPS, AMQP-SSL, or SAMPQ ?

Does it have to have a name?

> 2) Are you planning on supporting CRLs and/or OCSP for certificate revocation?
> 3) Can we specify the cipher strength?

We support whatever the Erlang SSL implementation supports. See 
http://www.erlang.org/doc/man/new_ssl.html for details. That's a moving 
target, and ATM the answers to the above are 'no' and 'yes'.

> 4) Okay once SSL is supported natively, do you think a future version
> of RabbitMQ would be able to map particular subjectDNs to existing
> username/password credentials?  It would be really nice if clients
> could authenticate with only client certs and nothing else.
> 
> I'm guessing #4 may actually break the existing AMQP spec, since we're
> talking about bypassing username/password authentication.  If that's
> the case, I'm not sure if you typically wait for the spec to get
> ratified before implementing any experimental features, such as this.

AMQP has some built-in support for negotiating different security 
mechanisms, so your latter concern isn't an issue. Making the necessary 
changes at the server and client end would take some time, but it 
shouldn't be a big job. Perhaps this is something you could have a stab 
at yourself once the new SSL support has landed?


Regards,

Matthias.



From matthias at lshift.net  Mon Jul 20 21:33:06 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 20 Jul 2009 21:33:06 +0100
Subject: [rabbitmq-discuss] Can I generate SNMP traps on Connection
	events?
In-Reply-To: <FA3D7C54DA3A1540B2C92C93ACD2156005681784@XOREXCH.India.XoriantCorp.com>
References: <FA3D7C54DA3A1540B2C92C93ACD2156005681784@XOREXCH.India.XoriantCorp.com>
Message-ID: <4A64D482.4040802@lshift.net>

Anand,

Anand Ved wrote:
> Does anyone know if RabbitMQ supports SNMP traps integration and how can 
> we do it?

Erlang/OTP has one of the best SNMP stacks out there, certainly in the 
open-source world. So equipping RabbitMQ with SNMP support should be 
straightforward technically, but it hasn't been done yet. The main 
challenge is defining a MIB, which for a relatively complex product like 
RabbitMQ takes a fair amount of time. If there are any SNMP/MIB gurus 
out there we'd definitely appreciate some help here - a good starting 
point would be to try to come up with a MIB that can represent all the 
information accessible via rabbitmqctl.

Regards,

Matthias.



From darien at kindlund.com  Mon Jul 20 21:37:14 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Mon, 20 Jul 2009 16:37:14 -0400
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
In-Reply-To: <4A64D01C.6020908@lshift.net>
References: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com> 
	<50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com> 
	<1247077600.26930.50.camel@eric-desktop.grokthis.net>
	<50c8ffe90907081155l2bbd603as8cc9a707fe7a1d08@mail.gmail.com> 
	<1247080750.26930.75.camel@eric-desktop.grokthis.net>
	<50c8ffe90907081245u7b398e58l8f18f29b5e123b87@mail.gmail.com> 
	<4A64C36C.7060800@lshift.net>
	<50c8ffe90907201246y3dba41f9n41cb0d17a76c2516@mail.gmail.com> 
	<4A64D01C.6020908@lshift.net>
Message-ID: <50c8ffe90907201337g73bbe2ep14cc60db5bf8c953@mail.gmail.com>

>> Couple of basic questions:
>> 1) So, for reference, would we call this AMQPS, AMQP-SSL, or SAMPQ ?
>
> Does it have to have a name?

Well, AMQP over SSL is a little long; plus, I assume IANA will want a
protocol name if you're going to make 5672 (amqp) and 5673 (amqps) in
/etc/services as standards.

>> 2) Are you planning on supporting CRLs and/or OCSP for certificate
>> revocation?
>> 3) Can we specify the cipher strength?
>
> We support whatever the Erlang SSL implementation supports. See
> http://www.erlang.org/doc/man/new_ssl.html for details. That's a moving
> target, and ATM the answers to the above are 'no' and 'yes'.

Okay, gotcha.  #2 wasn't a hard requirement, I was just more
interested to see if it was on anyone's radar.

>> 4) Okay once SSL is supported natively, do you think a future version
>> of RabbitMQ would be able to map particular subjectDNs to existing
>> username/password credentials? ?It would be really nice if clients
>> could authenticate with only client certs and nothing else.
>>
>> I'm guessing #4 may actually break the existing AMQP spec, since we're
>> talking about bypassing username/password authentication. ?If that's
>> the case, I'm not sure if you typically wait for the spec to get
>> ratified before implementing any experimental features, such as this.
>
> AMQP has some built-in support for negotiating different security
> mechanisms, so your latter concern isn't an issue. Making the necessary
> changes at the server and client end would take some time, but it shouldn't
> be a big job. Perhaps this is something you could have a stab at yourself
> once the new SSL support has landed?

Depends.  I'm not an erlang expert by any means; I'm currently working
on integrating some erlang supervisory code.  Assuming I can grok the
syntax and language, I could take a stab at this later on.  A change
like this would probably also mean digging through the nmesia DB
schema, as the mappings would probably have to reside there (wherever
the username/passwords are stored).

-- Darien



From pekenney at gmail.com  Mon Jul 20 21:39:26 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Mon, 20 Jul 2009 13:39:26 -0700
Subject: [rabbitmq-discuss] No Exchange Error
Message-ID: <3a5f03340907201339v6b73611ej3b7d9079f210bb93@mail.gmail.com>

in working with the samples I am using the following test consumer snippet
...

<snip>
ServiceHost dispatcherHost = new ServiceHost(typeof(DispatcherService), new
Uri("soap.amqp:///"));
dispatcherHost.AddServiceEndpoint(typeof(IDispatcherService), new
RabbitMQBinding(new Uri("amqp://localhost:5672/"), Protocols.AMQP_0_8),
"soap.amqp://localhost/dispatcher");
</snip>

when the RabbitMQBinding is hit in the RabbitMQ.Service model I get the
following nasty gram...

RabbitMQ.Client.Exceptions.OperationInterruptedException was unhandled by
user code
  Message="The AMQP operation was interrupted: AMQP close-reason, initiated
by Peer, code=404, text=\"NOT_FOUND - no exchange 'localhost' in vhost
'/'\", classId=50, methodId=20, cause="
  Source="RabbitMQ.Client"
  StackTrace:
       at RabbitMQ.Client.Impl.SimpleBlockingRpcContinuation.GetReply() in
C:\RabbitMQ.Client\RabbitMQ\Client\Impl\SimpleBlockingRpcContinuation.cs:line
22
       at RabbitMQ.Client.Impl.ModelBase.ModelRpc(MethodBase method,
ContentHeaderBase header, Byte[] body) in
C:\\RabbitMQ.Client\RabbitMQ\Client\Impl\ModelBase.cs:line 498
       at RabbitMQ.Client.Framing.Impl.v0_8.Model.QueueBind(String queue,
String exchange, String routingKey, Boolean nowait, IDictionary arguments)
in C:\\RabbitMQ.Client\RabbitMQ\Client\Framing\Impl\v0_8\Model.cs:line 374
       at RabbitMQ.ServiceModel.RabbitMQInputChannel.Open(TimeSpan timeout)
in
C:\\RabbitMQ.ServiceModel\RabbitMQ\ServiceModel\RabbitMQInputChannel.cs:line
52
       at
System.ServiceModel.Channels.InternalDuplexChannelListener.ServerCompositeDuplexChannel.OnOpen(TimeSpan
timeout)
       at System.ServiceModel.Channels.CommunicationObject.Open(TimeSpan
timeout)
       at System.ServiceModel.Channels.CommunicationObject.Open()
       at
System.ServiceModel.Channels.ReliableChannelListener`3.HandleAcceptComplete(TInnerChannel
channel)
  InnerException:

any suggestions from those more familiar with the Client/Service Model
libraries?

Am I missing something obvious?

thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090720/ee18da4e/attachment.htm 

From matthias at lshift.net  Mon Jul 20 21:49:05 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 20 Jul 2009 21:49:05 +0100
Subject: [rabbitmq-discuss] AMQP authentication with RabbitMQ
In-Reply-To: <50c8ffe90907201337g73bbe2ep14cc60db5bf8c953@mail.gmail.com>
References: <cedc0c090907080957x6a043b12o11e665300bd86fc3@mail.gmail.com>
	<50c8ffe90907081004y3de2e62v931b806c65aded7e@mail.gmail.com>
	<1247077600.26930.50.camel@eric-desktop.grokthis.net>
	<50c8ffe90907081155l2bbd603as8cc9a707fe7a1d08@mail.gmail.com>
	<1247080750.26930.75.camel@eric-desktop.grokthis.net>
	<50c8ffe90907081245u7b398e58l8f18f29b5e123b87@mail.gmail.com>
	<4A64C36C.7060800@lshift.net>
	<50c8ffe90907201246y3dba41f9n41cb0d17a76c2516@mail.gmail.com>
	<4A64D01C.6020908@lshift.net>
	<50c8ffe90907201337g73bbe2ep14cc60db5bf8c953@mail.gmail.com>
Message-ID: <4A64D841.4020008@lshift.net>

Darien,

Darien Kindlund wrote:
> Well, AMQP over SSL is a little long; plus, I assume IANA will want a
> protocol name if you're going to make 5672 (amqp) and 5673 (amqps) in
> /etc/services as standards.

amqp and amqps have already been registered with IANA for ports 5672 and 
5671 (NB: not ...3) respectively. So AMQPS it is.

> I'm not an erlang expert by any means; I'm currently working on
> integrating some erlang supervisory code. Assuming I can grok the 
> syntax and language, I could take a stab at this later on. A change 
> like this would probably also mean digging through the nmesia DB 
> schema, as the mappings would probably have to reside there (wherever
>  the username/passwords are stored).

Yes, some tweaks to the mnesia schema will be necessary. Should all be 
fairly straightforward though and not lead you anywhere near the really 
complex pieces of the rabbitmq code base.


Matthias.



From brian at echonest.com  Tue Jul 21 14:25:23 2009
From: brian at echonest.com (Brian Whitman)
Date: Tue, 21 Jul 2009 09:25:23 -0400
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <4A64A241.8080306@lshift.net>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>
	<4A64970D.7070309@googlemail.com> <4A649932.6030905@lshift.net>
	<4A64A0A7.7050601@googlemail.com> <4A64A241.8080306@lshift.net>
Message-ID: <dbd9700a0907210625k7afabafeked2750299779731e@mail.gmail.com>

Matthias -- I'm not sure how I'm seeing them in the queue list when there
are no consumers. And relatedly perhaps, the broker will crash after 20
hours or so when it runs out of memory, which confuses me as the queue
lengths are always 0.
Here's my steps using the following code:
http://notes.variogr.am/post/143623387/broadcasting-your-logs-with-rabbitmq-and-python

1) Declare a Producer() and start sending messages
 - this does a channel access request, declares the fanout exchange w/
auto_delete=True, then declares the "logger" queue with exclusive False and
auto_delete as True, then binds the exchange and the queue

At this point logger shows up in list_queues with 0 messages. There are
about 8 machines all writing messages to the queue (using immediate=True on
basic_publish.) There are no consumers at this point but the queue "logger"
is in the list.

2) Declare a few Consumers()
 - this does the same channel access request, declare, bind as the
Producer() -- same auto_delete and etc except the queue name is now
"logger-randomUUID" per Conusmer

At this point logger and any logger-randomUUID show up in the list_queues.
Each has 0 messages, always. Everything works as it should... consumers get
messages from the Producers, queue size stays 0.

But...

Memory keeps going
up -- and eventually the broker will crash. Yesterday it lasted about
20 hours. I booted it again this a.m. and am testing with abnormal
message loads (sending millions of messages.) Right
now memory is at 3.9% and increasing after only running 30m.

I am using a newer version on the server, yes, and I will do a test on the
release version to see if that behavior changes. But my guess is I am doing
something else wrong in my queue setup.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090721/09b0fa31/attachment.htm 

From brian at echonest.com  Tue Jul 21 14:44:03 2009
From: brian at echonest.com (Brian Whitman)
Date: Tue, 21 Jul 2009 09:44:03 -0400
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <dbd9700a0907210625k7afabafeked2750299779731e@mail.gmail.com>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>
	<4A64970D.7070309@googlemail.com> <4A649932.6030905@lshift.net>
	<4A64A0A7.7050601@googlemail.com> <4A64A241.8080306@lshift.net>
	<dbd9700a0907210625k7afabafeked2750299779731e@mail.gmail.com>
Message-ID: <dbd9700a0907210644v3879b1e7i99cedb6cfadd378e@mail.gmail.com>

I can confirm that the same behavior happens in 1.6.0 -- the "logger" queue
appears with no consumers, and also the memory increases with messages sent
to the fanout queue (whether there's consumers or not) until an eventual
crash.

On Tue, Jul 21, 2009 at 9:25 AM, Brian Whitman <brian at echonest.com> wrote:

> Matthias -- I'm not sure how I'm seeing them in the queue list when there
> are no consumers. And relatedly perhaps, the broker will crash after 20
> hours or so when it runs out of memory, which confuses me as the queue
> lengths are always 0.
> Here's my steps using the following code:
>
> http://notes.variogr.am/post/143623387/broadcasting-your-logs-with-rabbitmq-and-python
>
> 1) Declare a Producer() and start sending messages
>  - this does a channel access request, declares the fanout exchange w/
> auto_delete=True, then declares the "logger" queue with exclusive False and
> auto_delete as True, then binds the exchange and the queue
>
> At this point logger shows up in list_queues with 0 messages. There are
> about 8 machines all writing messages to the queue (using immediate=True on
> basic_publish.) There are no consumers at this point but the queue "logger"
> is in the list.
>
> 2) Declare a few Consumers()
>  - this does the same channel access request, declare, bind as the
> Producer() -- same auto_delete and etc except the queue name is now
> "logger-randomUUID" per Conusmer
>
> At this point logger and any logger-randomUUID show up in the list_queues.
> Each has 0 messages, always. Everything works as it should... consumers get
> messages from the Producers, queue size stays 0.
>
> But...
>
> Memory keeps going
> up -- and eventually the broker will crash. Yesterday it lasted about 20 hours. I booted it again this a.m. and am testing with abnormal message loads (sending millions of messages.) Right
> now memory is at 3.9% and increasing after only running 30m.
>
> I am using a newer version on the server, yes, and I will do a test on the
> release version to see if that behavior changes. But my guess is I am doing
> something else wrong in my queue setup.
>
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090721/d732aca6/attachment.htm 

From matthias at lshift.net  Tue Jul 21 14:58:57 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 21 Jul 2009 14:58:57 +0100
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <dbd9700a0907210625k7afabafeked2750299779731e@mail.gmail.com>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>	<4A64970D.7070309@googlemail.com>
	<4A649932.6030905@lshift.net>	<4A64A0A7.7050601@googlemail.com>
	<4A64A241.8080306@lshift.net>
	<dbd9700a0907210625k7afabafeked2750299779731e@mail.gmail.com>
Message-ID: <4A65C9A1.1070801@lshift.net>

Brian,

Brian Whitman wrote:
> Matthias -- I'm not sure how I'm seeing them in the queue list when
> there are no consumers. And relatedly perhaps, the broker will crash
> after 20 hours or so when it runs out of memory, which confuses me as
> the queue lengths are always 0.
> 
> Here's my steps using the following code:
> 
> http://notes.variogr.am/post/143623387/broadcasting-your-logs-with-rabbitmq-and-python
> 
> 1) Declare a Producer() and start sending messages 
>  - this does a channel access request, declares the fanout exchange w/
> auto_delete=True, then declares the "logger" queue with exclusive False
> and auto_delete as True, then binds the exchange and the queue
> 
> At this point logger shows up in list_queues with 0 messages. There are
> about 8 machines all writing messages to the queue (using immediate=True
> on basic_publish.) There are no consumers at this point but the queue
> "logger" is in the list.
> 
> 2) Declare a few Consumers() 
>  - this does the same channel access request, declare, bind as the
> Producer() -- same auto_delete and etc except the queue name is now
> "logger-randomUUID" per Conusmer
> 
> At this point logger and any logger-randomUUID show up in the
> list_queues. Each has 0 messages, always. Everything works as it
> should... consumers get messages from the Producers, queue size stays 0. 
> 
> But...
> 
> Memory keeps going
> up -- and eventually the broker will crash. Yesterday it lasted about 20 hours. I booted it again this a.m. and am testing with abnormal message loads (sending millions of messages.) Right
> now memory is at 3.9% and increasing after only running 30m.
> 
> I am using a newer version on the server, yes, and I will do a test on
> the release version to see if that behavior changes. But my guess is I
> am doing something else wrong in my queue setup.

Your setup looks basically ok, except for two things:

1) no consumers ever subscribe to the "logger" queue. That means it
would normally keep accumulating messages. The only reason it doesn't is
because you set immediate=true, but that's generally not the best way to
go about suppressing message storage. Why do you have the logger queue
at all?

2) You are setting immediate=true. I'd advise against that, for reasons
I explained earlier. Setting exclusive or auto_delete on the queues, so
that they disappear when the consumers vanish, should be sufficient.

Neither explains a gradual growth in memory usage. My best guess atm is
that there is a bug in the particular branch of the code you are working
on. So please try the 1.6.0 release. Also, if you still see the problem
then, please post precise instructions on how to reproduce it - a
transcript of a command line session showing how you are invoking the
various producer and consumers scripts would be great.


Regards,

Matthias.



From brian at echonest.com  Tue Jul 21 15:31:36 2009
From: brian at echonest.com (Brian Whitman)
Date: Tue, 21 Jul 2009 10:31:36 -0400
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <4A65C9A1.1070801@lshift.net>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>
	<4A64970D.7070309@googlemail.com> <4A649932.6030905@lshift.net>
	<4A64A0A7.7050601@googlemail.com> <4A64A241.8080306@lshift.net>
	<dbd9700a0907210625k7afabafeked2750299779731e@mail.gmail.com>
	<4A65C9A1.1070801@lshift.net>
Message-ID: <dbd9700a0907210731t41498c02i63a38dc2b46cdc55@mail.gmail.com>

>
> 1) no consumers ever subscribe to the "logger" queue. Why do you have the
> logger queue at all?
>

This was my bad-- I for some reason thought you needed to declare a queue to
send messages to an exchange. Fixed that now, no more "logger" queue.


> 2) You are setting immediate=true. I'd advise against that, for reasons
> I explained earlier. Setting exclusive or auto_delete on the queues, so
> that they disappear when the consumers vanish, should be sufficient.


So I changed this now, exclusive=True and auto_delete=True and
immediate=False on the Producer. This fixes the "memory leak." Everything
works the way I want and there's no mem usage growth or eventual crash. This
is on 1.6.0 BTW. I guess it had something to do w/ immediate=True, but I'm
not positive.


Also, if you still see the problem then, please post precise instructions on
> how to reproduce it -


If you want to see the mem growth, use the code (I've updated it) in my blog
post but just add immediate=True to the basic_publish command. Then I just
did

b = Producer()
for x in xrange(1000000):
    b.message({"message":"a long message", "id":str(x)})

and you can just watch the mem increase, whether you have consumers or not.
(only if immediate=True is on)

thanks for all the help, I think we're doing good now.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090721/24569954/attachment.htm 

From tonyg at lshift.net  Tue Jul 21 15:38:26 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 21 Jul 2009 15:38:26 +0100
Subject: [rabbitmq-discuss] "None of the specified endpoints were
 reachable"
In-Reply-To: <D7F3579680FB2F4B9A040F9BC78865F76445E65F07@OLCA9095.btcnet.btc-ag.com>
References: <D7F3579680FB2F4B9A040F9BC78865F76445E65B82@OLCA9095.btcnet.btc-ag.com>
	<4A607D40.6050609@lshift.net>
	<D7F3579680FB2F4B9A040F9BC78865F76445E65F07@OLCA9095.btcnet.btc-ag.com>
Message-ID: <4A65D2E2.2070906@lshift.net>

Hi Tammo,

Tammo.Filusch at btc-ag.com wrote:
> None of the specified endpoints were reachable
> Endpoints attempted:
>   endpoint=amqp-0-8://localhost:5672, attempts=1, outcome=Normalerweise darf jede Socketadresse (Protokoll, Netzwerkadresse oder Anschluss) nur jeweils einmal verwendet werden 127.0.0.1:5672
> Stack trace:
>    bei RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects, AmqpTcpEndpoint[] endpoints)
>    bei RabbitMQ.Client.ConnectionFactory.CreateConnection(AmqpTcpEndpoint[] endpoints)
>    bei RabbitMQ.Client.ConnectionFactory.CreateConnection(String address)
>    bei ...SendDataViaTcp(dataRequest request) in ...\RmqServiceClient.cs:Line 46.

This error text is associated with error code 10048, WSAEADDRINUSE.

> looking at the "outcome" part of the error message, it seems as if
> the connection from the client to the broker is not closed properly
> and because of that all possible sockets are taken.

Exactly -- but it's not necessarily because the connection isn't closed
properly! (Though, of course, it could be -- please try your system's
equivalent of netstat after 1000 messages or so, and see if there are
around 1000 active connections lying around.) I suspect TCP's TIME_WAIT
state, where if many connections are rapidly opened and closed, the TCBs
are kept around for a while to let delayed segments drop out of the
network. After a while, these can build up, leading to client-side TCP
port exhaustion.

> the following code is executed for every single message. after about
> 3800 messages had been transfered and consumed successfully the above
> error message is thrown by the sending client while executing the
> first line:
> using (IConnection conn = new ConnectionFactory().CreateConnection(serverAddress))
>                 { [...] }

Over how long a period are these 3800 connections opened and closed? If
it's reasonably quickly -- a couple of minutes, say -- it could well be
TIME_WAIT causing the issue.

> are there any obvious mistakes in my pieces of code?

Well... if possible, open *one* connection, and reuse it! :-)

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From Tammo.Filusch at btc-ag.com  Tue Jul 21 15:59:09 2009
From: Tammo.Filusch at btc-ag.com (Tammo.Filusch at btc-ag.com)
Date: Tue, 21 Jul 2009 16:59:09 +0200
Subject: [rabbitmq-discuss] "None of the specified endpoints were
 reachable"
In-Reply-To: <4A65D2E2.2070906@lshift.net>
References: <D7F3579680FB2F4B9A040F9BC78865F76445E65B82@OLCA9095.btcnet.btc-ag.com>
	<4A607D40.6050609@lshift.net>
	<D7F3579680FB2F4B9A040F9BC78865F76445E65F07@OLCA9095.btcnet.btc-ag.com>
	<4A65D2E2.2070906@lshift.net>
Message-ID: <D7F3579680FB2F4B9A040F9BC78865F76445E65F63@OLCA9095.btcnet.btc-ag.com>

Hey Tony,

first of all thanks for the great advice so far.

> -----Urspr?ngliche Nachricht-----
> Von: Tony Garnock-Jones [mailto:tonyg at lshift.net] 
> Gesendet: Dienstag, 21. Juli 2009 16:38
> An: Filusch, Tammo
> Cc: rabbitmq
> Betreff: Re: AW: [rabbitmq-discuss] "None of the specified endpoints were reachable"
>
> Hi Tammo,
>
> Tammo.Filusch at btc-ag.com wrote:
>> None of the specified endpoints were reachable
>> Endpoints attempted:
>>   endpoint=amqp-0-8://localhost:5672, attempts=1, outcome=Normalerweise darf jede Socketadresse (Protokoll, Netzwerkadresse oder Anschluss) nur jeweils einmal verwendet werden 127.0.0.1:5672
>> Stack trace:
>>    bei RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects, AmqpTcpEndpoint[] endpoints)
>>    bei RabbitMQ.Client.ConnectionFactory.CreateConnection(AmqpTcpEndpoint[] endpoints)
>>    bei RabbitMQ.Client.ConnectionFactory.CreateConnection(String address)
>>    bei ...SendDataViaTcp(dataRequest request) in ...\RmqServiceClient.cs:Line 46.
>
>This error text is associated with error code 10048, WSAEADDRINUSE.
>
> looking at the "outcome" part of the error message, it seems as if
> the connection from the client to the broker is not closed properly
> and because of that all possible sockets are taken.
>
>Exactly -- but it's not necessarily because the connection isn't closed
>properly! (Though, of course, it could be -- please try your system's
>equivalent of netstat after 1000 messages or so, and see if there are
>around 1000 active connections lying around.) I suspect TCP's TIME_WAIT
>state, where if many connections are rapidly opened and closed, the TCBs
>are kept around for a while to let delayed segments drop out of the
>network. After a while, these can build up, leading to client-side TCP
>port exhaustion. 


I will use 'netstat' tomorrow and try to verify your first theory. 
I suspect that your second suggestion is the more plausible since the connections are opened "as fast as possible", 
and if your second explanation turns out to be true the  design should be seriously changed.


>> the following code is executed for every single message. after about
>> 3800 messages had been transfered and consumed successfully the above
>> error message is thrown by the sending client while executing the
>> first line:
>> using (IConnection conn = new ConnectionFactory().CreateConnection(serverAddress))
>>                 { [...] }
>
>Over how long a period are these 3800 connections opened and closed? If
>it's reasonably quickly -- a couple of minutes, say -- it could well be
>TIME_WAIT causing the issue.
>
>> are there any obvious mistakes in my pieces of code?
>Well... if possible, open *one* connection, and reuse it! :-)


This was my first attempt to solve this and works perfectly, but unfortunatly not applicable without violation of the design constraints.

Thanks again for the great help,

Cheers,

Tammo



From majek04 at gmail.com  Tue Jul 21 16:14:10 2009
From: majek04 at gmail.com (majek04)
Date: Tue, 21 Jul 2009 16:14:10 +0100
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <dbd9700a0907210731t41498c02i63a38dc2b46cdc55@mail.gmail.com>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>
	<4A64970D.7070309@googlemail.com> <4A649932.6030905@lshift.net>
	<4A64A0A7.7050601@googlemail.com> <4A64A241.8080306@lshift.net>
	<dbd9700a0907210625k7afabafeked2750299779731e@mail.gmail.com>
	<4A65C9A1.1070801@lshift.net>
	<dbd9700a0907210731t41498c02i63a38dc2b46cdc55@mail.gmail.com>
Message-ID: <3bb0d9710907210814n4fc60268hc4adfb4f4fc28701@mail.gmail.com>

On Tue, Jul 21, 2009 at 15:31, Brian Whitman<brian at echonest.com> wrote:
> If you want to see the mem growth, use the code (I've updated it) in my blog
> post but just add immediate=True to the basic_publish command. Then I just
> did
> b = Producer()
> for x in xrange(1000000):
> ?? ?b.message({"message":"a long message", "id":str(x)})
> and you can just watch the mem increase, whether you have consumers or not.
> (only if immediate=True is on)

I can confirm that. Indeed, when you send 'immediate=True' messages
from python  the memory is growing in a rabbit process.

We even found a source of a problem - it's a python amqp client library.
You see, when an 'immediate' message is not delivered, it's returned to the
sender. But the python library is not reading anything from the socket,
Rabbit is still trying to return messages, but after a while buffers on
network socket are filled and Erlang memory footprint starts to grow.

This is an output from netstat -n:
Active Internet connections (w/o servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp    73440      0 127.0.0.1:47121         127.0.0.1:5672          ESTABLISHED
tcp        0  24864 127.0.0.1:5672          127.0.0.1:47121         ESTABLISHED

As you see the buffers are full.

Hope that helps.

Marek Majkowski



From alexis.richardson at gmail.com  Tue Jul 21 16:15:07 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 21 Jul 2009 16:15:07 +0100
Subject: [rabbitmq-discuss] Ruby / Rails / RabbitMQ talk in London on
	Saturday
Message-ID: <167204d20907210815o2eba960ck65d068071164c704@mail.gmail.com>

Hi

For London Ruby folks... there is a talk this week from Paolo Negri:
http://www.rails-underground.com/09-conference-schedule.html

alexis



From Rajesh_Reddy at ml.com  Tue Jul 21 16:51:41 2009
From: Rajesh_Reddy at ml.com (Reddy, Rajesh (GPT EMEA))
Date: Tue, 21 Jul 2009 16:51:41 +0100
Subject: [rabbitmq-discuss] queue is locked exclusively
Message-ID: <03FC0D29D4E88943AB7420C524BE8489027C397C@mllnc20mb056.emea.win.ml.com>

Hi

Iam using the RabbitMQ client for .NET . I need to re subscribe to the
queue from my client if the connection drops or queue deletes. 
Iam getting the following error when trying to resubscribe to the queue.
[AMQP Heartbeat Inbound for Connection
amqp-0-8://GBWMAPPROPP04.emea.win.ml.com:5672] ERROR
MessagingManager.MessagingSubscriber SubscribeForMessage - OpIntEx: The
AMQP operation was interrupted: AMQP close-reason, initiated by Peer,
code=405, text="RESOURCE_LOCKED - cannot obtain exclusive access to
locked queue 'reddyraj_ELONW124027_4244_20090721-091729_PM' in vhost
'/'", classId=50, methodId=10, cause=
2009-07-21 12:35:32,376 [AMQP Connection
amqp-0-8://GBWMAPPROPP04.emea.win.ml.com:5672] ERROR
MessagingManager.MessagingSubscriber HandleBasicDeliver - OpIntEx: The
AMQP operation was interrupted: AMQP close-reason, initiated by Library,
code=0, text="End of stream", classId=0, methodId=0,
cause=System.IO.EndOfStreamException: Heartbeat missing with heartbeat
== 30 seconds

Is there a way to identify if the queue is locked exclusively?

Thanks
Rajesh



--------------------------------------------------------------------------
This message w/attachments (message) may be privileged, confidential or proprietary, and if you are not an intended recipient, please notify the sender, do not use or share it and delete it. Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Merrill Lynch. Subject to applicable law, Merrill Lynch may monitor, review and retain e-communications (EC) traveling through its networks/systems. The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or error-free. References to "Merrill Lynch" are references to any company in the Merrill Lynch & Co., Inc. group of companies, which are wholly-owned by Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Attachments that are part of this E-communication may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: http://www.ml.com/e-communications_terms/. By messaging with Merrill Lynch you consent to the foregoing.
--------------------------------------------------------------------------
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090721/fbe67ded/attachment.htm 

From meyer at paperplanes.de  Tue Jul 21 20:32:22 2009
From: meyer at paperplanes.de (Mathias Meyer)
Date: Tue, 21 Jul 2009 21:32:22 +0200
Subject: [rabbitmq-discuss] Login woes with the Ruby amqp library
Message-ID: <fce2e45e0907211232g1e016bedv7bfc1ce156b1a8c3@mail.gmail.com>

Hey,

I'm trying to hunt down a problem that I can reproduce with the Ruby
amqp library by Aman, and RabbitMQ 1.6. I'm not sure on which end of
both the actual problem is, maybe you have some ideas.

The problem is rather simple, I try to log in with invalid data.
RabbitMQ's way seems to be to log an error and shutdown the
connection. The library on the other hand doesn't seem to take that
too seriously, and tries reopening connections like crazy, immediately
after the previous connection has been closed. Obviously the log is
showing the right errors with access_refused as you'd expect, but I'm
not sure if that error actually reaches the client or is handled by it
in any way. Does the server return the error to the client at all?
That'd probably mean the problem is on the library's end. I tried the
whole thing with bunny, and it at least realizes there's no more data
coming from the server, but obviously it uses a more procedural
approach compared to the EventMachine-based amqp library.

Any pointers would be most welcome. The problem I end up with with
these endless reconnect is an Erlang VM that eats up CPU like crazy,
and that's not great.

Thanks!

Cheers, Mathias
-- 
http://paperplanes.de | http://holgarific.net
http://twitter.com/roidrage



From matthias at lshift.net  Tue Jul 21 20:46:12 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Tue, 21 Jul 2009 20:46:12 +0100
Subject: [rabbitmq-discuss] Login woes with the Ruby amqp library
In-Reply-To: <fce2e45e0907211232g1e016bedv7bfc1ce156b1a8c3@mail.gmail.com>
References: <fce2e45e0907211232g1e016bedv7bfc1ce156b1a8c3@mail.gmail.com>
Message-ID: <4A661B04.8080001@lshift.net>

Mathias,

Mathias Meyer wrote:
> The problem is rather simple, I try to log in with invalid data.
> RabbitMQ's way seems to be to log an error and shutdown the
> connection. The library on the other hand doesn't seem to take that
> too seriously, and tries reopening connections like crazy, immediately
> after the previous connection has been closed. Obviously the log is
> showing the right errors with access_refused as you'd expect, but I'm
> not sure if that error actually reaches the client or is handled by it
> in any way. Does the server return the error to the client at all?

 From section 2.2.4 of the AMQP 0-9-1 spec:
<quote>
There is no hand-shaking for errors on connections that are not fully 
open. Following successful protocol header negotiation, which is defined 
in detail later, and prior to sending or receiving Open or Open-Ok, a 
peer that detects an error MUST close the socket without sending any 
further data.
</quote>

In other words, an authentication failure will result in the connection 
getting closed by the server, without it sending any error to the client.


Regards,

Matthias.



From meyer at paperplanes.de  Tue Jul 21 21:02:56 2009
From: meyer at paperplanes.de (Mathias Meyer)
Date: Tue, 21 Jul 2009 22:02:56 +0200
Subject: [rabbitmq-discuss] Login woes with the Ruby amqp library
In-Reply-To: <4A661B04.8080001@lshift.net>
References: <fce2e45e0907211232g1e016bedv7bfc1ce156b1a8c3@mail.gmail.com> 
	<4A661B04.8080001@lshift.net>
Message-ID: <fce2e45e0907211302u4127ca6ds75a3c6b27bdedcf5@mail.gmail.com>

On Tue, Jul 21, 2009 at 9:46 PM, Matthias Radestock<matthias at lshift.net> wrote:
> Mathias,
>
> From section 2.2.4 of the AMQP 0-9-1 spec:
> <quote>
> There is no hand-shaking for errors on connections that are not fully open.
> Following successful protocol header negotiation, which is defined in detail
> later, and prior to sending or receiving Open or Open-Ok, a peer that
> detects an error MUST close the socket without sending any further data.
> </quote>
>
> In other words, an authentication failure will result in the connection
> getting closed by the server, without it sending any error to the client.
>
Matthias,

I was looking at the 0-8 spec, but this sure fills in the blank it had
in that regard. Guess that means fixing the library.

Thanks!

Cheers, Mathias
-- 
http://paperplanes.de | http://holgarific.net
http://twitter.com/roidrage



From tonyg at lshift.net  Wed Jul 22 14:54:14 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 22 Jul 2009 14:54:14 +0100
Subject: [rabbitmq-discuss] Login woes with the Ruby amqp library
In-Reply-To: <4A661B04.8080001@lshift.net>
References: <fce2e45e0907211232g1e016bedv7bfc1ce156b1a8c3@mail.gmail.com>
	<4A661B04.8080001@lshift.net>
Message-ID: <4A671A06.4070903@lshift.net>

Matthias Radestock wrote:
> In other words, an authentication failure will result in the connection 
> getting closed by the server, without it sending any error to the client.

This is something I'm torn on. On the one hand, it'd be easy enough to
transmit a connection.close (or similar) before shutting the socket
down; but on the other hand, a closed connection at this point is pretty
unambiguously an authentication failure, IIUC.

I think clients -- all of them -- should probably be altered to report
such an abrupt connecton closure at that phase of connection
establishment as an authentication failure.

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Wed Jul 22 14:55:48 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 22 Jul 2009 14:55:48 +0100
Subject: [rabbitmq-discuss] Login woes with the Ruby amqp library
In-Reply-To: <fce2e45e0907211232g1e016bedv7bfc1ce156b1a8c3@mail.gmail.com>
References: <fce2e45e0907211232g1e016bedv7bfc1ce156b1a8c3@mail.gmail.com>
Message-ID: <4A671A64.7000908@lshift.net>

Mathias Meyer wrote:
> Any pointers would be most welcome. The problem I end up with with
> these endless reconnect is an Erlang VM that eats up CPU like crazy,
> and that's not great.

You're quite right -- that's pretty terrible. We've filed a bug to
change this so that auth failures end up holding the connection open for
a few seconds before closing the socket. This will help avoid accidental
DoSs of this kind. (Libraries of course can still be improved along the
lines I suggested in my previous message, independent of server changes
like this.)

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From pekenney at gmail.com  Wed Jul 22 15:19:24 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Wed, 22 Jul 2009 07:19:24 -0700
Subject: [rabbitmq-discuss] Looking for a functional .Net Publish, Subscribe,
	Dispatch example...
Message-ID: <3a5f03340907220719r1a757638h2d72600ead0d9709@mail.gmail.com>

I am Looking for a functional .Net Publish, Subscribe, Dispatch example...

thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090722/e6978e06/attachment.htm 

From matthias at lshift.net  Wed Jul 22 15:30:20 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 22 Jul 2009 15:30:20 +0100
Subject: [rabbitmq-discuss] Login woes with the Ruby amqp library
In-Reply-To: <4A671A06.4070903@lshift.net>
References: <fce2e45e0907211232g1e016bedv7bfc1ce156b1a8c3@mail.gmail.com>	<4A661B04.8080001@lshift.net>
	<4A671A06.4070903@lshift.net>
Message-ID: <4A67227C.1050604@lshift.net>

Tony Garnock-Jones wrote:
> On the one hand, it'd be easy enough to transmit a connection.close
> (or similar) before shutting the socket down;

I'd rather avoid that since it would be in direct violation of an
explicit (and recent) instruction to the contrary in the protocol spec,
and could cause (non-rabbit) clients to do all sorts of nasty things.

> but on the other hand, a closed connection at this point is pretty 
> unambiguously an authentication failure, IIUC.

True. Well spotted!

> I think clients -- all of them -- should probably be altered to
> report such an abrupt connection closure at that phase of connection 
> establishment as an authentication failure.

I'd suggest a slightly more circumspect wording along the lines of
"likely cause: authentication failure". After all, there are other
possible causes as well such as malformed framing, or the server or
network dying for some unrelated reason.


Matthias.



From bmurphy1976 at gmail.com  Wed Jul 22 15:48:48 2009
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Wed, 22 Jul 2009 09:48:48 -0500
Subject: [rabbitmq-discuss] Diagnosing a problem
Message-ID: <7fd310d10907220748y18419ff8gc3fa4d6d326b6e5c@mail.gmail.com>

Hey guys,
Yesterday we had a queue that was causing our web application to throw
service unavailable errors (I think the application was blocking on sending
a message to queue, but I don't know that for sure).  At some point, I
needed to restart the RabbitMQ server and when I restarted it failed to
start with a crash dump.  I saved the old data directory and I have the
crash dump, but I'm unsure how to go about investigating what went wrong.
 What should I do with them?

Thanks,
Bryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090722/ad17d44b/attachment.htm 

From tonyg at lshift.net  Wed Jul 22 16:12:03 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 22 Jul 2009 16:12:03 +0100
Subject: [rabbitmq-discuss] Login woes with the Ruby amqp library
In-Reply-To: <4A67227C.1050604@lshift.net>
References: <fce2e45e0907211232g1e016bedv7bfc1ce156b1a8c3@mail.gmail.com>	<4A661B04.8080001@lshift.net>
	<4A671A06.4070903@lshift.net> <4A67227C.1050604@lshift.net>
Message-ID: <4A672C43.3080701@lshift.net>

Matthias Radestock wrote:
> I'd rather avoid [an error message] since it would be in direct violation of an
> explicit (and recent) instruction to the contrary in the protocol spec

Excellent point.

> I'd suggest a slightly more circumspect wording along the lines of
> "likely cause: authentication failure". After all, there are other
> possible causes as well such as malformed framing, or the server or
> network dying for some unrelated reason.

Also a very good idea. We should do that for all the clients we
maintain, I think.

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Wed Jul 22 17:49:38 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 22 Jul 2009 17:49:38 +0100
Subject: [rabbitmq-discuss] Looking for a functional .Net Publish,
 Subscribe, Dispatch example...
In-Reply-To: <3a5f03340907220719r1a757638h2d72600ead0d9709@mail.gmail.com>
References: <3a5f03340907220719r1a757638h2d72600ead0d9709@mail.gmail.com>
Message-ID: <4A674322.2090504@lshift.net>

Hi Patrick,

Patrick Kenney wrote:
> I am Looking for a functional .Net Publish, Subscribe, Dispatch example...

Like these?

http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/SendString.cs
http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/LogTail.cs
http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/AddServer.cs

Regards,
  Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Wed Jul 22 17:50:43 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 22 Jul 2009 17:50:43 +0100
Subject: [rabbitmq-discuss] Diagnosing a problem
In-Reply-To: <7fd310d10907220748y18419ff8gc3fa4d6d326b6e5c@mail.gmail.com>
References: <7fd310d10907220748y18419ff8gc3fa4d6d326b6e5c@mail.gmail.com>
Message-ID: <4A674363.7010804@lshift.net>

Hi Bryan,

Bryan Murphy wrote:
> point, I needed to restart the RabbitMQ server and when I restarted it
> failed to start with a crash dump.  I saved the old data directory and I

Do you have the text that was printed by the server at startup? It gives
a brief summary in a fairly hard-to-read format just before telling you
it's writing the crash dump.

Tony
-- 
 [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
 []  [] http://www.lshift.net/ | Email: tonyg at lshift.net



From tonyg at lshift.net  Wed Jul 22 17:52:52 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 22 Jul 2009 17:52:52 +0100
Subject: [rabbitmq-discuss] rabbitmq-http2 with jquery
In-Reply-To: <e55356640907200447q658b1b49mea726baa6a36da1c@mail.gmail.com>
References: <e55356640907200224n684fbdfbm92b7b1a8c0638654@mail.gmail.com>	<269388e30907200307o3476e65bpad3575066cf67431@mail.gmail.com>
	<e55356640907200447q658b1b49mea726baa6a36da1c@mail.gmail.com>
Message-ID: <4A6743E4.7020601@lshift.net>

Juhani R?nkimies wrote:
> Do you have something else in mind for the adapter?

One thing that's neat about it is that it's built in terms of an AMQP
JSON-RPC object, and it uses a general-purpose JSON-RPC service
framework on the erlang side, so other JSON-RPC objects (e.g.
management, monitoring etc!) could be *very* easily run alongside the
objects that provide AMQP messaging service...




From meyer at paperplanes.de  Wed Jul 22 19:47:38 2009
From: meyer at paperplanes.de (Mathias Meyer)
Date: Wed, 22 Jul 2009 20:47:38 +0200
Subject: [rabbitmq-discuss] Login woes with the Ruby amqp library
In-Reply-To: <4A671A64.7000908@lshift.net>
References: <fce2e45e0907211232g1e016bedv7bfc1ce156b1a8c3@mail.gmail.com> 
	<4A671A64.7000908@lshift.net>
Message-ID: <fce2e45e0907221147s43c607a8xf12dc5fad0a59cee@mail.gmail.com>

On Wed, Jul 22, 2009 at 3:55 PM, Tony Garnock-Jones<tonyg at lshift.net> wrote:
> You're quite right -- that's pretty terrible. We've filed a bug to
> change this so that auth failures end up holding the connection open for
> a few seconds before closing the socket. This will help avoid accidental
> DoSs of this kind. (Libraries of course can still be improved along the
> lines I suggested in my previous message, independent of server changes
> like this.)
>
>From my point of view, something like this would make sense. While
it's feasable to fix client libraries accordingly, there's nothing
standing in the way of a rogue client trying to bog down the server.
We will add a firewall rule, just to be sure that one client can't
connect more than say once per second, but in general it would be a
useful addition to the server itself to not return immediately.

Thanks!

Cheers, Mathias
-- 
http://paperplanes.de | http://holgarific.net
http://twitter.com/roidrage



From tonyg at lshift.net  Wed Jul 22 20:20:53 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 22 Jul 2009 20:20:53 +0100
Subject: [rabbitmq-discuss] Looking for a functional .Net Publish,
 Subscribe, Dispatch example...
In-Reply-To: <3a5f03340907221022n3a283d88l5691669b396300be@mail.gmail.com>
References: <3a5f03340907220719r1a757638h2d72600ead0d9709@mail.gmail.com>	
	<4A674322.2090504@lshift.net>
	<3a5f03340907221022n3a283d88l5691669b396300be@mail.gmail.com>
Message-ID: <4A676695.2020406@lshift.net>

Ah, I see -- a UI for management of the messaging service, plus simple 
UI for test injection and extraction of messages? I'm afraid nothing 
comes as part of RabbitMQ for that, but you might investigate 
Alice&Wonderland and Trixx for the management aspect. For the message 
injection and extraction, it ought to be straightforward for someone who 
knows WinForms programming to build a simple graphical shell around the 
core of the SendString and LogTail examples that come with the RabbitMQ 
.NET client library.

Any takers on the mailinglist?

Regards,
   Tony

Patrick Kenney wrote:
> no, something more like the attached...
> 
> 
> On Wed, Jul 22, 2009 at 9:49 AM, Tony Garnock-Jones <tonyg at lshift.net 
> <mailto:tonyg at lshift.net>> wrote:
> 
>     Hi Patrick,
> 
>     Patrick Kenney wrote:
>      > I am Looking for a functional .Net Publish, Subscribe, Dispatch
>     example...
> 
>     Like these?
> 
>     http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/SendString.cs
>     http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/LogTail.cs
>     http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/AddServer.cs
> 
>     Regards,
>      Tony
>     --
>      [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>       [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>      []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>     <mailto:tonyg at lshift.net>
> 
> 



From pekenney at gmail.com  Wed Jul 22 21:05:37 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Wed, 22 Jul 2009 13:05:37 -0700
Subject: [rabbitmq-discuss] Looking for a functional .Net Publish,
	Subscribe, Dispatch example...
In-Reply-To: <4A676695.2020406@lshift.net>
References: <3a5f03340907220719r1a757638h2d72600ead0d9709@mail.gmail.com>
	<4A674322.2090504@lshift.net>
	<3a5f03340907221022n3a283d88l5691669b396300be@mail.gmail.com>
	<4A676695.2020406@lshift.net>
Message-ID: <3a5f03340907221305v3bc26af9r744c1b70972fd6c4@mail.gmail.com>

not necessarily for management per se, but a simple one stop shopping .Net
WinForm app/sln/proj that demonstrates the common tasks such as wcf rabbit
hosting a dispatcher, subscriber, publishing, subscribing etc...

would make it much easier and faster in my view for someone to more quickly
get up to speed on rabbitmq.net

thanks in advance.

re:
On Wed, Jul 22, 2009 at 12:20 PM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Ah, I see -- a UI for management of the messaging service, plus simple UI
> for test injection and extraction of messages? I'm afraid nothing comes as
> part of RabbitMQ for that, but you might investigate Alice&Wonderland and
> Trixx for the management aspect. For the message injection and extraction,
> it ought to be straightforward for someone who knows WinForms programming to
> build a simple graphical shell around the core of the SendString and LogTail
> examples that come with the RabbitMQ .NET client library.
>
> Any takers on the mailinglist?
>
> Regards,
>  Tony
>
> Patrick Kenney wrote:
>
>> no, something more like the attached...
>>
>>
>> On Wed, Jul 22, 2009 at 9:49 AM, Tony Garnock-Jones <tonyg at lshift.net<mailto:
>> tonyg at lshift.net>> wrote:
>>
>>    Hi Patrick,
>>
>>    Patrick Kenney wrote:
>>     > I am Looking for a functional .Net Publish, Subscribe, Dispatch
>>    example...
>>
>>    Like these?
>>
>>
>> http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/SendString.cs
>>
>> http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/LogTail.cs
>>
>> http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/AddServer.cs
>>
>>    Regards,
>>     Tony
>>    --
>>     [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>>      [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>>     []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>>    <mailto:tonyg at lshift.net>
>>
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090722/67c65272/attachment.htm 

From bmurphy1976 at gmail.com  Wed Jul 22 21:05:53 2009
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Wed, 22 Jul 2009 15:05:53 -0500
Subject: [rabbitmq-discuss] Diagnosing a problem
In-Reply-To: <4A674363.7010804@lshift.net>
References: <7fd310d10907220748y18419ff8gc3fa4d6d326b6e5c@mail.gmail.com>
	<4A674363.7010804@lshift.net>
Message-ID: <7fd310d10907221305g3e6d5edag351877f56c74dd57@mail.gmail.com>

(sorry for the duplicate email)

This was in my rabbitmq startup error log:

Starting all nodes...
Starting node rabbit at domU-12-31-39-01-C4-14...
RabbitMQ 1.6.0 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC.,
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node        : rabbit at domU-12-31-39-01-C4-14
log         : /var/log/rabbitmq/rabbit.log
sasl log    : /var/log/rabbitmq/rabbit-sasl.log
database dir: /var/lib/rabbitmq/mnesia/rabbit

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...{"init terminating in
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{{badmatch,{error,{{function_clause,[{rabbit_persister,replay,[{corrupt_log_file,"/var/lib/rabbitmq/mnesia/rabbit/rabbit_persister.LOG"},rabbit_persister,error,{psnapshot,1,{dict,0,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},192,193}]},{rabbit_persister,internal_load_snapshot,2},{rabbit_persister,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]},{child,undefined,rabbit_persister,{rabbit_persister,start_link,[]},transient,100,worker,[rabbit_persister]}}}},[{rabbit,start_child,1},{rabbit,'-start/2-fun-4-',0},{rabbit,'-start/2-fun-0-',1},{lists,foreach,2},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}}},[{init,start_it,1},{init,start_em,1}]}}

On Wed, Jul 22, 2009 at 11:50 AM, Tony Garnock-Jones <tonyg at lshift.net>wrote:

> Hi Bryan,
>
> Bryan Murphy wrote:
> > point, I needed to restart the RabbitMQ server and when I restarted it
> > failed to start with a crash dump.  I saved the old data directory and I
>
> Do you have the text that was printed by the server at startup? It gives
> a brief summary in a fairly hard-to-read format just before telling you
> it's writing the crash dump.
>
> Tony
> --
>  [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
>   [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
>  []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090722/b075d2f5/attachment.htm 

From pekenney at gmail.com  Thu Jul 23 02:27:03 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Wed, 22 Jul 2009 18:27:03 -0700
Subject: [rabbitmq-discuss] Error: there was no space available in the
	reliable channel's transfer window (on subscribe)
Message-ID: <3a5f03340907221827v2e532ed0ldc05aad4c8ca68dd@mail.gmail.com>

anybody run across this error before?

test messages are tiny...
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090722/0e02fa4e/attachment.htm 

From alexis.richardson at gmail.com  Thu Jul 23 08:25:51 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Thu, 23 Jul 2009 08:25:51 +0100
Subject: [rabbitmq-discuss] Looking for a functional .Net Publish,
	Subscribe, Dispatch example...
In-Reply-To: <3a5f03340907221305v3bc26af9r744c1b70972fd6c4@mail.gmail.com>
References: <3a5f03340907220719r1a757638h2d72600ead0d9709@mail.gmail.com>
	<4A674322.2090504@lshift.net>
	<3a5f03340907221022n3a283d88l5691669b396300be@mail.gmail.com>
	<4A676695.2020406@lshift.net>
	<3a5f03340907221305v3bc26af9r744c1b70972fd6c4@mail.gmail.com>
Message-ID: <167204d20907230025m4c88d73fyb03288f9599bae28@mail.gmail.com>

I have asked someone who knows Winforms and has run RabbitMQ on .NET
if they would mind having a go at this.  Bear with us.  It's really
down to the person concerned, how busy they are etc ;-)


On Wed, Jul 22, 2009 at 9:05 PM, Patrick Kenney<pekenney at gmail.com> wrote:
> not necessarily for management per se, but a simple one stop shopping .Net
> WinForm app/sln/proj that demonstrates the common tasks such as wcf rabbit
> hosting a dispatcher, subscriber, publishing, subscribing etc...
>
> would make it much easier and faster in my view for someone to more quickly
> get up to speed on rabbitmq.net
>
> thanks in advance.
>
> re:
> On Wed, Jul 22, 2009 at 12:20 PM, Tony Garnock-Jones <tonyg at lshift.net>
> wrote:
>>
>> Ah, I see -- a UI for management of the messaging service, plus simple UI
>> for test injection and extraction of messages? I'm afraid nothing comes as
>> part of RabbitMQ for that, but you might investigate Alice&Wonderland and
>> Trixx for the management aspect. For the message injection and extraction,
>> it ought to be straightforward for someone who knows WinForms programming to
>> build a simple graphical shell around the core of the SendString and LogTail
>> examples that come with the RabbitMQ .NET client library.
>>
>> Any takers on the mailinglist?
>>
>> Regards,
>> ?Tony
>>
>> Patrick Kenney wrote:
>>>
>>> no, something more like the attached...
>>>
>>>
>>> On Wed, Jul 22, 2009 at 9:49 AM, Tony Garnock-Jones <tonyg at lshift.net
>>> <mailto:tonyg at lshift.net>> wrote:
>>>
>>> ? ?Hi Patrick,
>>>
>>> ? ?Patrick Kenney wrote:
>>> ? ? > I am Looking for a functional .Net Publish, Subscribe, Dispatch
>>> ? ?example...
>>>
>>> ? ?Like these?
>>>
>>>
>>> ?http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/SendString.cs
>>>
>>> ?http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/LogTail.cs
>>>
>>> ?http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/AddServer.cs
>>>
>>> ? ?Regards,
>>> ? ? Tony
>>> ? ?--
>>> ? ? [][][] Tony Garnock-Jones ? ? | Mob: +44 (0)7905 974 211
>>> ? ? ?[][] LShift Ltd ? ? ? ? ? ? | Tel: +44 (0)20 7729 7060
>>> ? ? [] ?[] http://www.lshift.net/ | Email: tonyg at lshift.net
>>> ? ?<mailto:tonyg at lshift.net>
>>>
>>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From pekenney at gmail.com  Thu Jul 23 14:56:53 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Thu, 23 Jul 2009 06:56:53 -0700
Subject: [rabbitmq-discuss] Looking for a functional .Net Publish,
	Subscribe, Dispatch example...
In-Reply-To: <167204d20907230025m4c88d73fyb03288f9599bae28@mail.gmail.com>
References: <3a5f03340907220719r1a757638h2d72600ead0d9709@mail.gmail.com>
	<4A674322.2090504@lshift.net>
	<3a5f03340907221022n3a283d88l5691669b396300be@mail.gmail.com>
	<4A676695.2020406@lshift.net>
	<3a5f03340907221305v3bc26af9r744c1b70972fd6c4@mail.gmail.com>
	<167204d20907230025m4c88d73fyb03288f9599bae28@mail.gmail.com>
Message-ID: <3a5f03340907230656o261e5a1fxff03b44f7493b97f@mail.gmail.com>

thanks, there is just a lot to take in, and this would give myself and
others in my view a significant, and more expeditious jump start in being
able to effectively begin leveraging RabbitMq.net/Amqp...

thanks in advance.

re:
On Thu, Jul 23, 2009 at 12:25 AM, Alexis Richardson <
alexis.richardson at gmail.com> wrote:

> I have asked someone who knows Winforms and has run RabbitMQ on .NET
> if they would mind having a go at this.  Bear with us.  It's really
> down to the person concerned, how busy they are etc ;-)
>
>
> On Wed, Jul 22, 2009 at 9:05 PM, Patrick Kenney<pekenney at gmail.com> wrote:
> > not necessarily for management per se, but a simple one stop shopping
> .Net
> > WinForm app/sln/proj that demonstrates the common tasks such as wcf
> rabbit
> > hosting a dispatcher, subscriber, publishing, subscribing etc...
> >
> > would make it much easier and faster in my view for someone to more
> quickly
> > get up to speed on rabbitmq.net
> >
> > thanks in advance.
> >
> > re:
> > On Wed, Jul 22, 2009 at 12:20 PM, Tony Garnock-Jones <tonyg at lshift.net>
> > wrote:
> >>
> >> Ah, I see -- a UI for management of the messaging service, plus simple
> UI
> >> for test injection and extraction of messages? I'm afraid nothing comes
> as
> >> part of RabbitMQ for that, but you might investigate Alice&Wonderland
> and
> >> Trixx for the management aspect. For the message injection and
> extraction,
> >> it ought to be straightforward for someone who knows WinForms
> programming to
> >> build a simple graphical shell around the core of the SendString and
> LogTail
> >> examples that come with the RabbitMQ .NET client library.
> >>
> >> Any takers on the mailinglist?
> >>
> >> Regards,
> >>  Tony
> >>
> >> Patrick Kenney wrote:
> >>>
> >>> no, something more like the attached...
> >>>
> >>>
> >>> On Wed, Jul 22, 2009 at 9:49 AM, Tony Garnock-Jones <tonyg at lshift.net
> >>> <mailto:tonyg at lshift.net>> wrote:
> >>>
> >>>    Hi Patrick,
> >>>
> >>>    Patrick Kenney wrote:
> >>>     > I am Looking for a functional .Net Publish, Subscribe, Dispatch
> >>>    example...
> >>>
> >>>    Like these?
> >>>
> >>>
> >>>
> http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/SendString.cs
> >>>
> >>>
> http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/LogTail.cs
> >>>
> >>>
> http://hg.rabbitmq.com/rabbitmq-dotnet-client/file/default/src/examples/AddServer.cs
> >>>
> >>>    Regards,
> >>>     Tony
> >>>    --
> >>>     [][][] Tony Garnock-Jones     | Mob: +44 (0)7905 974 211
> >>>      [][] LShift Ltd             | Tel: +44 (0)20 7729 7060
> >>>     []  [] http://www.lshift.net/ | Email: tonyg at lshift.net
> >>>    <mailto:tonyg at lshift.net>
> >>>
> >>>
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090723/ca184c3f/attachment.htm 

From pekenney at gmail.com  Thu Jul 23 17:13:21 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Thu, 23 Jul 2009 09:13:21 -0700
Subject: [rabbitmq-discuss] Trying to do a simple subscription returns
	message too long error... (RabbitMq.Net)
Message-ID: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>

although there are no messages any longer then "test message" in the
applicable queue...

the following is returned...

The AMQP operation was interrupted: AMQP close-reason, initiated by Library,
code=311, text="The body of a message (18446744073709551575 bytes) was too
long.", classId=0, methodId=0,
cause=RabbitMQ.Client.Impl.BodyTooLongException: The body of a message
(18446744073709551575 bytes) was too long.
   at RabbitMQ.Client.Impl.ContentHeaderBase.ReadFrom(Int32 channelNumber,
NetworkBinaryReader reader) in
C:\RabbitMQ.Client\RabbitMQ\Client\Impl\ContentHeaderBase.cs:line 23
   at RabbitMQ.Client.Impl.CommandAssembler.HandleFrame(Frame f) in
C:\RabbitMQ.Client\RabbitMQ\Client\Impl\CommandAssembler.cs:line 53
   at RabbitMQ.Client.Impl.Session.HandleFrame(Frame frame) in
C:\RabbitMQ.Client\RabbitMQ\Client\Impl\Session.cs:line 16
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration() in
C:\RabbitMQ.Client\RabbitMQ\Client\Impl\ConnectionBase.cs:line 434
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoop() in
C:\RabbitMQ.Client\RabbitMQ\Client\Impl\ConnectionBase.cs:line 388

suggestions, comments, assistance?

thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090723/17dab1dc/attachment.htm 

From matthias at lshift.net  Thu Jul 23 18:40:19 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 23 Jul 2009 18:40:19 +0100
Subject: [rabbitmq-discuss] No Exchange Error
In-Reply-To: <3a5f03340907201339v6b73611ej3b7d9079f210bb93@mail.gmail.com>
References: <3a5f03340907201339v6b73611ej3b7d9079f210bb93@mail.gmail.com>
Message-ID: <4A68A083.1080009@lshift.net>

Patrick,

Patrick Kenney wrote:
> in working with the samples I am using the following test consumer
> snippet ...
> 
> <snip>
> ServiceHost dispatcherHost = new ServiceHost(typeof(DispatcherService),
> new Uri("soap.amqp:///"));
> dispatcherHost.AddServiceEndpoint(typeof(IDispatcherService), new
> RabbitMQBinding(new Uri("amqp://localhost:5672/"), Protocols.AMQP_0_8),
> "soap.amqp://localhost/dispatcher");
> </snip>
> 
> when the RabbitMQBinding is hit in the RabbitMQ.Service model I get the
> following nasty gram...
> 
> RabbitMQ.Client.Exceptions.OperationInterruptedException was unhandled
> by user code
>   Message="The AMQP operation was interrupted: AMQP close-reason,
> initiated by Peer, code=404, text=\"NOT_FOUND - no exchange 'localhost'
> in vhost '/'\", classId=50, methodId=20, cause="
>   Source="RabbitMQ.Client"

The error says that you attempted to access an exchange 'localhost',
which doesn't exist.

According to the RabbitMQ WCF binding documentation,
  serviceAddress = ?soap.amqp://? [exchangeName] ?/? serviceName
which, looking at the above code, explains where the exchange name comes
from.

I suspect you meant to use the default exchange instead, in which case,
as per the docs ("If the exchange name is omitted, the default exchange
is used.") just leave out the exchange name.


Matthias.



From matthias at lshift.net  Thu Jul 23 18:42:21 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 23 Jul 2009 18:42:21 +0100
Subject: [rabbitmq-discuss] fanout exchange that does not keep messages
In-Reply-To: <3bb0d9710907210814n4fc60268hc4adfb4f4fc28701@mail.gmail.com>
References: <dbd9700a0907200847y43b861d2y12c845fbebb67a47@mail.gmail.com>	<4A64970D.7070309@googlemail.com>
	<4A649932.6030905@lshift.net>	<4A64A0A7.7050601@googlemail.com>
	<4A64A241.8080306@lshift.net>	<dbd9700a0907210625k7afabafeked2750299779731e@mail.gmail.com>	<4A65C9A1.1070801@lshift.net>	<dbd9700a0907210731t41498c02i63a38dc2b46cdc55@mail.gmail.com>
	<3bb0d9710907210814n4fc60268hc4adfb4f4fc28701@mail.gmail.com>
Message-ID: <4A68A0FD.7000604@lshift.net>

majek04 wrote:
> I can confirm that. Indeed, when you send 'immediate=True' messages
> from python  the memory is growing in a rabbit process.
> 
> We even found a source of a problem - it's a python amqp client library.

If any of the developers of that library are listening in, could you
please take a look at this problem and fix it?


Regards,

Matthias.



From matthias at lshift.net  Thu Jul 23 18:46:32 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 23 Jul 2009 18:46:32 +0100
Subject: [rabbitmq-discuss] Trying to do a simple subscription returns
 message too long error... (RabbitMq.Net)
In-Reply-To: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>
Message-ID: <4A68A1F8.7080204@lshift.net>

Patrick,

Patrick Kenney wrote:
> although there are no messages any longer then "test message" in the
> applicable queue...
> 
> the following is returned...
> 
> The AMQP operation was interrupted: AMQP close-reason, initiated by
> Library, code=311, text="The body of a message (18446744073709551575
> bytes) was too long."

That looks like a low-level codec problem, or data corruption during
transmission. Do you have some code you can send us that reproduces the
problem reliably?


Regards,

Matthias.



From pekenney at gmail.com  Thu Jul 23 20:46:05 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Thu, 23 Jul 2009 12:46:05 -0700
Subject: [rabbitmq-discuss] Trying to do a simple subscription returns
	message too long error... (RabbitMq.Net)
In-Reply-To: <4A68A1F8.7080204@lshift.net>
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>
	<4A68A1F8.7080204@lshift.net>
Message-ID: <3a5f03340907231246s59a53e65qdf0685a5852c5a59@mail.gmail.com>

I am referencing the downloaded 1.5.3 RabbitMQ.Client and
RabbitMQ.ServiceModel...

<CodeSnip>
//subscribe call in winform button click event...

using (System.ServiceModel.ChannelFactory<IDispatcherService> scf =
GetDispatcherCF())
{
    IDispatcherService client = scf.CreateChannel();
    client.Subscribe(new SubscriberInfo("amqp:///subscriber", "c1", "c2"));
}

//IDispatcherService Interface...

using Test.Entity;
using System;
using System.ServiceModel;

namespace Test.Base
{
    [ServiceContract]
    public interface IDispatcherService
    {
        [OperationContract(IsOneWay = true)]
        void Publish(Message message);
        [OperationContract(IsOneWay = true)]
        void Subscribe(SubscriberInfo subscriber);
        [OperationContract(IsOneWay = true)]
        void Unsubscribe(SubscriberInfo subscriber, bool removeAllContexts);
    }
}

//GetDispatcherCF() called by winform button click event above...

private ChannelFactory<IDispatcherService> GetDispatcherCF()
{
    ChannelFactory<IDispatcherService> scf;

*//the error I  posted previously and below occurs here during the
RabbitMQBinding instantiation...    *
        scf = new ChannelFactory<IDispatcherService>(
           new RabbitMQBinding(
            new Uri("amqp://localhost:5672/"),
              Protocols.AMQP_0_8),
                new EndpointAddress("amqp:///dispatcher"));


    return scf;
}

</CodeSnip>

<ErrorSnip>
the following is returned...

The AMQP operation was interrupted: AMQP close-reason, initiated by Library,
code=311, text="The body of a message (18446744073709551575 bytes) was too
long.", classId=0, methodId=0, cause=RabbitMQ.Client.Impl.BodyTooLongException:
The body of a message (18446744073709551575 bytes) was too long.
   at RabbitMQ.Client.Impl.ContentHeaderBase.ReadFrom(Int32 channelNumber,
NetworkBinaryReader reader) in
C:\RabbitMQ.Client\RabbitMQ\Client\Impl\ContentHeaderBase.cs:line 23
   at RabbitMQ.Client.Impl.CommandAssembler.HandleFrame(Frame f) in
C:\RabbitMQ.Client\RabbitMQ\Client\Impl\CommandAssembler.cs:line 53
   at RabbitMQ.Client.Impl.Session.HandleFrame(Frame frame) in
C:\RabbitMQ.Client\RabbitMQ\Client\Impl\Session.cs:line 16
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration() in
C:\RabbitMQ.Client\RabbitMQ\Client\Impl\ConnectionBase.cs:line 434
   at RabbitMQ.Client.Impl.ConnectionBase.MainLoop() in
C:\RabbitMQ.Client\RabbitMQ\Client\Impl\ConnectionBase.cs:line 388

</ErrorSnip>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090723/427b5894/attachment.htm 

From paulosuzart at gmail.com  Thu Jul 23 21:07:29 2009
From: paulosuzart at gmail.com (Paulo Suzart)
Date: Thu, 23 Jul 2009 17:07:29 -0300
Subject: [rabbitmq-discuss] Error (re)installing rabbit on ubuntu 9.04
Message-ID: <346810630907231307x61035396radec06aa571d0c0e@mail.gmail.com>

Hi people,

I tried to install rabbit in a Ubuntu updated from 8.04 to 8.10 and then
9.04 and I got this screen (http://twitpic.com/b9psl) .

Actually it is my last reinstall try. But the error is just the same since
the first time.

A talked to @rabbitmq and he recommended me mailing rabbitmq-discuss about
this issue.

Any Idea? What kind of material can I provide yo to help find a solution?

Paulo Suzart
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090723/919cb766/attachment.htm 

From matthias at lshift.net  Thu Jul 23 23:07:10 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 23 Jul 2009 23:07:10 +0100
Subject: [rabbitmq-discuss] Trying to do a simple subscription returns
 message too long error... (RabbitMq.Net)
In-Reply-To: <3a5f03340907231246s59a53e65qdf0685a5852c5a59@mail.gmail.com>
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>	<4A68A1F8.7080204@lshift.net>
	<3a5f03340907231246s59a53e65qdf0685a5852c5a59@mail.gmail.com>
Message-ID: <4A68DF0E.7030508@lshift.net>

Patrick,

Patrick Kenney wrote:
> I am referencing the downloaded 1.5.3 RabbitMQ.Client and
> RabbitMQ.ServiceModel...
> 
> <CodeSnip>

Thanks, but where is the code that publishes a message? If possible,
could you condense your program into a form where you can post *all* of
it, plus instructions on how to run it and reproduce the problem?

Also, have you tried the 1.6.0 library and server? I doubt it will make
a difference, but it's worth checking.


Matthias.



From matthias at lshift.net  Thu Jul 23 23:09:44 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 23 Jul 2009 23:09:44 +0100
Subject: [rabbitmq-discuss] Error (re)installing rabbit on ubuntu 9.04
In-Reply-To: <346810630907231307x61035396radec06aa571d0c0e@mail.gmail.com>
References: <346810630907231307x61035396radec06aa571d0c0e@mail.gmail.com>
Message-ID: <4A68DFA8.8060907@lshift.net>

Paulo,

Paulo Suzart wrote:
> I tried to install rabbit in a Ubuntu updated from 8.04 to 8.10 and then
> 9.04 and I got this screen (http://twitpic.com/b9psl) .

As per the message on the screen, please "check
/var/log/rabbitmq/startup_{log,err}" and post their contents. That
should hopefully provide some clues to where the startup is failing.


Regards,

Matthias.



From paulosuzart at gmail.com  Fri Jul 24 00:38:33 2009
From: paulosuzart at gmail.com (Paulo Suzart)
Date: Thu, 23 Jul 2009 20:38:33 -0300
Subject: [rabbitmq-discuss] Error (re)installing rabbit on ubuntu 9.04
In-Reply-To: <4A68DFA8.8060907@lshift.net>
References: <346810630907231307x61035396radec06aa571d0c0e@mail.gmail.com> 
	<4A68DFA8.8060907@lshift.net>
Message-ID: <346810630907231638q7b75ed7fna4226dcd144af1e7@mail.gmail.com>

Matthias,

Firstly thanks for helping. Here go the two logs.

startup_err:

Crash dump was written to: erl_crash.dump
init terminating in do_boot ()

startup_log:

{"init terminating in
do_boot",{undef,[{rabbit_multi,start,[]},{init,start_it,1},{init,start_em,1}]}}



Thanks.

2009/7/23 Matthias Radestock <matthias at lshift.net>

> Paulo,
>
> Paulo Suzart wrote:
> > I tried to install rabbit in a Ubuntu updated from 8.04 to 8.10 and then
> > 9.04 and I got this screen (http://twitpic.com/b9psl) .
>
> As per the message on the screen, please "check
> /var/log/rabbitmq/startup_{log,err}" and post their contents. That
> should hopefully provide some clues to where the startup is failing.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090723/d8818c86/attachment.htm 

From matthias at lshift.net  Fri Jul 24 01:10:28 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 24 Jul 2009 01:10:28 +0100
Subject: [rabbitmq-discuss] Error (re)installing rabbit on ubuntu 9.04
In-Reply-To: <346810630907231638q7b75ed7fna4226dcd144af1e7@mail.gmail.com>
References: <346810630907231307x61035396radec06aa571d0c0e@mail.gmail.com>
	<4A68DFA8.8060907@lshift.net>
	<346810630907231638q7b75ed7fna4226dcd144af1e7@mail.gmail.com>
Message-ID: <4A68FBF4.4020803@lshift.net>

Paulo,

Paulo Suzart wrote:
> Firstly thanks for helping. Here go the two logs.
> 
> startup_err:
>  
> Crash dump was written to: erl_crash.dump
> init terminating in do_boot ()
> 
> startup_log:
> 
> {"init terminating in
> do_boot",{undef,[{rabbit_multi,start,[]},{init,start_it,1},{init,start_em,1}]}}

The error indicates that erlang could not find the RabbitMQ code
modules. In a package-managed installation of RabbitMQ like yours one
typical reason for that is a secondary installation of Erlang that is on
the PATH before the package-managed one. To test that, run 'erl' and
inspect the output of evaluating
  code:lib_dir().
That will tell you where Erlang is looking for its libraries. If 'erl'
is the package-managed installation then this will usually point to
'/usr/lib/erlang/lib', and you will find a rabbitmq_server-<vsn>
directory underneath that. I suspect in your case it will point
elsewhere (and there is no rabbitmq_server subdir there). If so, remove
your secondary Erlang installation and that should solve the problem.
Alternatively you can also create a symlink in the reported library dir
to /usr/lib/erlang/lib/rabbitmq_server-<vsn> (assuming that is where the
package manager installed the RabbitMQ modules).

There could be other reasons for the reported error, but the above
scenario is the one people run into most frequently.


Regards,

Matthias.



From matthias at lshift.net  Fri Jul 24 01:49:41 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 24 Jul 2009 01:49:41 +0100
Subject: [rabbitmq-discuss] Trying to do a simple subscription returns
 message too long error... (RabbitMq.Net)
In-Reply-To: <3a5f03340907231738w646518dfma466bd08343b71c6@mail.gmail.com>
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>	<4A68A1F8.7080204@lshift.net>	<3a5f03340907231246s59a53e65qdf0685a5852c5a59@mail.gmail.com>	<4A68DF0E.7030508@lshift.net>
	<3a5f03340907231738w646518dfma466bd08343b71c6@mail.gmail.com>
Message-ID: <4A690525.2050207@lshift.net>

Patrick,

Patrick Kenney wrote:
> the thing is... the error is not occurring in publish... which is
> basically the SendString example...
> 
> the applicable code is what I provided previously...
> 
> the error is occurring in the rabbitmq client/servicemodel dll's that I
> downloaded... as itemized

I know, but in order to reproduce the error I want to mimic your setup
as closely as possible, which means running *exactly* the same code as
you have.

Did you get a chance to test against the RabbitMQ 1.6.0 library and server?


Matthias.



From paulosuzart at gmail.com  Fri Jul 24 02:23:25 2009
From: paulosuzart at gmail.com (Paulo Suzart)
Date: Thu, 23 Jul 2009 22:23:25 -0300
Subject: [rabbitmq-discuss] Error (re)installing rabbit on ubuntu 9.04
In-Reply-To: <4A68FBF4.4020803@lshift.net>
References: <346810630907231307x61035396radec06aa571d0c0e@mail.gmail.com> 
	<4A68DFA8.8060907@lshift.net>
	<346810630907231638q7b75ed7fna4226dcd144af1e7@mail.gmail.com> 
	<4A68FBF4.4020803@lshift.net>
Message-ID: <346810630907231823x78f62a94m9b467b33e2f459db@mail.gmail.com>

Wow! Bang! Right there Matthias.

RabbitMQ is up and runnig. Really thanks for that. Finally going deep in my
studies. Hope have fun with rabbit.

Sincerely

Paulo Suzart

2009/7/23 Matthias Radestock <matthias at lshift.net>

> Paulo,
>
> Paulo Suzart wrote:
> > Firstly thanks for helping. Here go the two logs.
> >
> > startup_err:
> >
> > Crash dump was written to: erl_crash.dump
> > init terminating in do_boot ()
> >
> > startup_log:
> >
> > {"init terminating in
> >
> do_boot",{undef,[{rabbit_multi,start,[]},{init,start_it,1},{init,start_em,1}]}}
>
> The error indicates that erlang could not find the RabbitMQ code
> modules. In a package-managed installation of RabbitMQ like yours one
> typical reason for that is a secondary installation of Erlang that is on
> the PATH before the package-managed one. To test that, run 'erl' and
> inspect the output of evaluating
>  code:lib_dir().
> That will tell you where Erlang is looking for its libraries. If 'erl'
> is the package-managed installation then this will usually point to
> '/usr/lib/erlang/lib', and you will find a rabbitmq_server-<vsn>
> directory underneath that. I suspect in your case it will point
> elsewhere (and there is no rabbitmq_server subdir there). If so, remove
> your secondary Erlang installation and that should solve the problem.
> Alternatively you can also create a symlink in the reported library dir
> to /usr/lib/erlang/lib/rabbitmq_server-<vsn> (assuming that is where the
> package manager installed the RabbitMQ modules).
>
> There could be other reasons for the reported error, but the above
> scenario is the one people run into most frequently.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090723/f70109f6/attachment.htm 

From Tammo.Filusch at btc-ag.com  Fri Jul 24 08:08:45 2009
From: Tammo.Filusch at btc-ag.com (Tammo.Filusch at btc-ag.com)
Date: Fri, 24 Jul 2009 09:08:45 +0200
Subject: [rabbitmq-discuss] "None of the specified endpoints were
 reachable"
In-Reply-To: <D7F3579680FB2F4B9A040F9BC78865F76445E65F63@OLCA9095.btcnet.btc-ag.com>
References: <D7F3579680FB2F4B9A040F9BC78865F76445E65B82@OLCA9095.btcnet.btc-ag.com>
	<4A607D40.6050609@lshift.net>
	<D7F3579680FB2F4B9A040F9BC78865F76445E65F07@OLCA9095.btcnet.btc-ag.com>
	<4A65D2E2.2070906@lshift.net>
	<D7F3579680FB2F4B9A040F9BC78865F76445E65F63@OLCA9095.btcnet.btc-ag.com>
Message-ID: <D7F3579680FB2F4B9A040F9BC78865F76445E661A5@OLCA9095.btcnet.btc-ag.com>

Hy,

i was able to solve this by changing windows registry entries for "MaxUserPort" and "TcpTimedWaitDelay".
Found a nice howto here:
http://msdn.microsoft.com/en-us/library/cc296845(BTS.10).aspx


because i experienced connection timeouts after setting "TcpTimedWaitDelay" to its minimum i had to balance the values and it works fine now.

thanks again.




Hey Tony,

first of all thanks for the great advice so far.

> -----Urspr?ngliche Nachricht-----
> Von: Tony Garnock-Jones [mailto:tonyg at lshift.net] 
> Gesendet: Dienstag, 21. Juli 2009 16:38
> An: Filusch, Tammo
> Cc: rabbitmq
> Betreff: Re: AW: [rabbitmq-discuss] "None of the specified endpoints were reachable"
>
> Hi Tammo,
>
> Tammo.Filusch at btc-ag.com wrote:
>> None of the specified endpoints were reachable
>> Endpoints attempted:
>>   endpoint=amqp-0-8://localhost:5672, attempts=1, outcome=Normalerweise darf jede Socketadresse (Protokoll, Netzwerkadresse oder Anschluss) nur jeweils einmal verwendet werden 127.0.0.1:5672
>> Stack trace:
>>    bei RabbitMQ.Client.ConnectionFactory.CreateConnection(Int32 maxRedirects, AmqpTcpEndpoint[] endpoints)
>>    bei RabbitMQ.Client.ConnectionFactory.CreateConnection(AmqpTcpEndpoint[] endpoints)
>>    bei RabbitMQ.Client.ConnectionFactory.CreateConnection(String address)
>>    bei ...SendDataViaTcp(dataRequest request) in ...\RmqServiceClient.cs:Line 46.
>
>This error text is associated with error code 10048, WSAEADDRINUSE.
>
> looking at the "outcome" part of the error message, it seems as if
> the connection from the client to the broker is not closed properly
> and because of that all possible sockets are taken.
>
>Exactly -- but it's not necessarily because the connection isn't closed
>properly! (Though, of course, it could be -- please try your system's
>equivalent of netstat after 1000 messages or so, and see if there are
>around 1000 active connections lying around.) I suspect TCP's TIME_WAIT
>state, where if many connections are rapidly opened and closed, the TCBs
>are kept around for a while to let delayed segments drop out of the
>network. After a while, these can build up, leading to client-side TCP
>port exhaustion. 


I will use 'netstat' tomorrow and try to verify your first theory. 
I suspect that your second suggestion is the more plausible since the connections are opened "as fast as possible", 
and if your second explanation turns out to be true the  design should be seriously changed.


>> the following code is executed for every single message. after about
>> 3800 messages had been transfered and consumed successfully the above
>> error message is thrown by the sending client while executing the
>> first line:
>> using (IConnection conn = new ConnectionFactory().CreateConnection(serverAddress))
>>                 { [...] }
>
>Over how long a period are these 3800 connections opened and closed? If
>it's reasonably quickly -- a couple of minutes, say -- it could well be
>TIME_WAIT causing the issue.
>
>> are there any obvious mistakes in my pieces of code?
>Well... if possible, open *one* connection, and reuse it! :-)


This was my first attempt to solve this and works perfectly, but unfortunatly not applicable without violation of the design constraints.

Thanks again for the great help,

Cheers,

Tammo

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss



From charleswoerner.lists at gmail.com  Sun Jul 26 01:30:00 2009
From: charleswoerner.lists at gmail.com (charles woerner)
Date: Sat, 25 Jul 2009 17:30:00 -0700
Subject: [rabbitmq-discuss] rabbitmq cluster failover for persistent queues
Message-ID: <de2dbca0907251730m6c4d3e9ds2f5d061a48fd86b@mail.gmail.com>

Hello,

Although this is my first post to the rabbitmq-discuss list, I've enjoyed
reading the archives over the last few days.  We're evaluating rabbitmq for
a system at work.  One apparent limitation that we've run into is that while
exchange information (which node a queue lives on, etc.) is replicated each
node itself seems to be a single point of failure in that if it goes down
then a message whose routing key only matches bindings to queues on that
node will be dropped.  That is, from what I understand it appears that
although the contents of persistent queues are /recoverable/ in the event of
a disaster I don't see a built-in way of having another node in the cluster
"take over" a queue which previously lived on a node which has just gone
down.

I'd like to know whether a) I've missed something in my interpretation of
how rabbitmq server handles persistent queues in a cluster and b) if this is
indeed the current behavior what other rabbitmq users have done to provide
fault tolerance.

I appreciate any insight into how people solve these issues with rabbitmq.
Thanks in advance.

-Charles
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090725/a16e32fa/attachment.htm 

From work at anomalizer.net  Sun Jul 26 10:10:58 2009
From: work at anomalizer.net (Arvind Jayaprakash)
Date: Sun, 26 Jul 2009 14:40:58 +0530
Subject: [rabbitmq-discuss] rabbitmq cluster failover for
	persistent	queues
In-Reply-To: <de2dbca0907251730m6c4d3e9ds2f5d061a48fd86b@mail.gmail.com>
References: <de2dbca0907251730m6c4d3e9ds2f5d061a48fd86b@mail.gmail.com>
Message-ID: <20090726091058.GA10274@aa>

On Jul 25, charles woerner wrote:
>Hello,
>
>Although this is my first post to the rabbitmq-discuss list, I've enjoyed
>reading the archives over the last few days.  We're evaluating rabbitmq for
>a system at work.  One apparent limitation that we've run into is that while
>exchange information (which node a queue lives on, etc.) is replicated each
>node itself seems to be a single point of failure in that if it goes down
>then a message whose routing key only matches bindings to queues on that
>node will be dropped.  That is, from what I understand it appears that
>although the contents of persistent queues are /recoverable/ in the event of
>a disaster I don't see a built-in way of having another node in the cluster
>"take over" a queue which previously lived on a node which has just gone
>down.
>
>I'd like to know whether a) I've missed something in my interpretation of
>how rabbitmq server handles persistent queues in a cluster and b) if this is
>indeed the current behavior what other rabbitmq users have done to provide
>fault tolerance.

Your description is correct and I had the same question myself a few
months ago. Many thanks to Alexis for providing this link:
http://skillsmatter.com/podcast/erlang/rabbitmq-internal-architecture-tony-garnock-jones



From charleswoerner.lists at gmail.com  Sun Jul 26 18:45:11 2009
From: charleswoerner.lists at gmail.com (charles woerner)
Date: Sun, 26 Jul 2009 10:45:11 -0700
Subject: [rabbitmq-discuss] rabbitmq cluster failover for persistent
	queues
In-Reply-To: <20090726091058.GA10274@aa>
References: <de2dbca0907251730m6c4d3e9ds2f5d061a48fd86b@mail.gmail.com>
	<20090726091058.GA10274@aa>
Message-ID: <de2dbca0907261045s6ec7dcafxae0ba57d5bf5cc7c@mail.gmail.com>

Thanks Arvind.  That seems to confirm our belief that rabbitmq doesn't
handle failover of session state at the moment.  So in the case of competing
consumers taking messages from a rabbitmq broker cluster it sounds like
once-and-only-once delivery is somewhat up to the application to implement
by arranging for each message to be delivered to redundant queues (ie. 2
separate queues with similar bindings residing on different hosts), then
coordinate among your consumers to ensure once-and-only-once delivery using
a database or simply to make your workflow idempotent with respect to the
duplicate messages.

Ideally, I'd like my broker cluster to handle this.  I'm looking into apache
qpid as it seems to be more mature with respect to availability.  The main
downside with rabbitmq for me right now is the lack of at least an option
for session state replication.  It sounds like a future release of rabbitmq
with pluggable persisters will make distributed session state possible via
mnesia.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090726/eb547aa0/attachment.htm 

From alexis.richardson at gmail.com  Sun Jul 26 21:51:07 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Sun, 26 Jul 2009 21:51:07 +0100
Subject: [rabbitmq-discuss] rabbitmq cluster failover for persistent
	queues
In-Reply-To: <de2dbca0907261045s6ec7dcafxae0ba57d5bf5cc7c@mail.gmail.com>
References: <de2dbca0907251730m6c4d3e9ds2f5d061a48fd86b@mail.gmail.com>
	<20090726091058.GA10274@aa>
	<de2dbca0907261045s6ec7dcafxae0ba57d5bf5cc7c@mail.gmail.com>
Message-ID: <167204d20907261351x6d524fcej96c57a86af9597cc@mail.gmail.com>

Charles

Thank-you very much for your questions.  (And Arvind, thanks for
answering them!).

Can you clarify what you mean by "failover of session state" please?
I am assuming you mean that when a node dies, then another node can
'take over' from it, without loss of any state that the first node has
committed (to some other node and/or persistent store), and that the
second node can 'take over' in some sense 'faster' than recovery by
restarting the first node from disk would.  I ask because this case is
not quite the same as 'exactly once' delivery.

Cheers,

alexis





On Sun, Jul 26, 2009 at 6:45 PM, charles
woerner<charleswoerner.lists at gmail.com> wrote:
> Thanks Arvind.? That seems to confirm our belief that rabbitmq doesn't
> handle failover of session state at the moment.? So in the case of competing
> consumers taking messages from a rabbitmq broker cluster it sounds like
> once-and-only-once delivery is somewhat up to the application to implement
> by arranging for each message to be delivered to redundant queues (ie. 2
> separate queues with similar bindings residing on different hosts), then
> coordinate among your consumers to ensure once-and-only-once delivery using
> a database or simply to make your workflow idempotent with respect to the
> duplicate messages.
>
> Ideally, I'd like my broker cluster to handle this.? I'm looking into apache
> qpid as it seems to be more mature with respect to availability.? The main
> downside with rabbitmq for me right now is the lack of at least an option
> for session state replication.? It sounds like a future release of rabbitmq
> with pluggable persisters will make distributed session state possible via
> mnesia.
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>



From matthias at lshift.net  Mon Jul 27 00:38:17 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Mon, 27 Jul 2009 00:38:17 +0100
Subject: [rabbitmq-discuss] rabbitmq cluster failover for persistent
	queues
In-Reply-To: <de2dbca0907261045s6ec7dcafxae0ba57d5bf5cc7c@mail.gmail.com>
References: <de2dbca0907251730m6c4d3e9ds2f5d061a48fd86b@mail.gmail.com>	<20090726091058.GA10274@aa>
	<de2dbca0907261045s6ec7dcafxae0ba57d5bf5cc7c@mail.gmail.com>
Message-ID: <4A6CE8E9.5070100@lshift.net>

Charles,

charles woerner wrote:
> So in the case of competing consumers taking messages from a rabbitmq
> broker cluster it sounds like once-and-only-once delivery is somewhat
> up to the application to implement by arranging for each message to
> be delivered to redundant queues (ie. 2 separate queues with similar
> bindings residing on different hosts), then coordinate among your
> consumers to ensure once-and-only-once delivery using a database or
> simply to make your workflow idempotent with respect to the duplicate
> messages.

Exactly-once requires coordination between consumers, or idempotency,
even when there is just a single queue. The consumer, broker or network
may die during the transmission of the ack for a message, thus causing
retransmission of the message (which the consumer has already seen and
processed) at a later point.

Once that issue has been addressed in a system, the introduction of 
redundant queues doesn't present any new challenges.


Regards,

Matthias.



From charleswoerner.lists at gmail.com  Mon Jul 27 01:00:56 2009
From: charleswoerner.lists at gmail.com (charles woerner)
Date: Sun, 26 Jul 2009 17:00:56 -0700
Subject: [rabbitmq-discuss] rabbitmq cluster failover for persistent
	queues
In-Reply-To: <167204d20907261351x6d524fcej96c57a86af9597cc@mail.gmail.com>
References: <de2dbca0907251730m6c4d3e9ds2f5d061a48fd86b@mail.gmail.com>
	<20090726091058.GA10274@aa>
	<de2dbca0907261045s6ec7dcafxae0ba57d5bf5cc7c@mail.gmail.com>
	<167204d20907261351x6d524fcej96c57a86af9597cc@mail.gmail.com>
Message-ID: <de2dbca0907261700r61c9bf1aw1fa0812dbb139133@mail.gmail.com>

Alexis,

Can you clarify what you mean by "failover of session state" please?
> I am assuming you mean that when a node dies, then another node can
> 'take over' from it, without loss of any state that the first node has
> committed (to some other node and/or persistent store), and that the
> second node can 'take over' in some sense 'faster' than recovery by
> restarting the first node from disk would.


More or less.  I'm personally not that concerned with the timeliness of
recovery for committed messages.  I'm mostly concerned with any messages
being dropped by the system because no bindings matching a particular
message's routing key existed in the exchange at the time of the enqueue
command (because the one node which contained the queue which matched that
routing key has suffered a disaster).  To go further I really want the
ability to define something like "failover bindings" (e.g. create queue Q on
node A as master and node B for failover)  in the exchange such that if
delivery to to a queue "Q" on node "A" fails then the exchange will declare
that node "B" is the new master for queue "Q" and all subsequent routing
will be adjusted.  It seems that if the persister were using mnesia to
record session state (queue data) and one could define "failover bindings"
like I mentioned above then the exchange could failover a queue to a
secondary node transparently to all producers and consumers in the system,
save for the ones that were directly connected to the node which suffered
the disaster.


>  I ask because this case is
> not quite the same as 'exactly once' delivery.


Yes, I was just referring to my belief that if I want to eliminate this
single point of failure I would need to create redundant queues on separate
nodes and have some kind of out-of-band mechanism to guard against duplicate
processing (or that I would need to make sure that all downstream operations
were idempotent).


>
>
> Cheers,
>
> alexis
>
>
>
>
>
> On Sun, Jul 26, 2009 at 6:45 PM, charles
> woerner<charleswoerner.lists at gmail.com> wrote:
> > Thanks Arvind.  That seems to confirm our belief that rabbitmq doesn't
> > handle failover of session state at the moment.  So in the case of
> competing
> > consumers taking messages from a rabbitmq broker cluster it sounds like
> > once-and-only-once delivery is somewhat up to the application to
> implement
> > by arranging for each message to be delivered to redundant queues (ie. 2
> > separate queues with similar bindings residing on different hosts), then
> > coordinate among your consumers to ensure once-and-only-once delivery
> using
> > a database or simply to make your workflow idempotent with respect to the
> > duplicate messages.
> >
> > Ideally, I'd like my broker cluster to handle this.  I'm looking into
> apache
> > qpid as it seems to be more mature with respect to availability.  The
> main
> > downside with rabbitmq for me right now is the lack of at least an option
> > for session state replication.  It sounds like a future release of
> rabbitmq
> > with pluggable persisters will make distributed session state possible
> via
> > mnesia.
> >
> >
> > _______________________________________________
> > rabbitmq-discuss mailing list
> > rabbitmq-discuss at lists.rabbitmq.com
> > http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090726/c09eb7be/attachment.htm 

From charleswoerner.lists at gmail.com  Mon Jul 27 01:03:10 2009
From: charleswoerner.lists at gmail.com (charles woerner)
Date: Sun, 26 Jul 2009 17:03:10 -0700
Subject: [rabbitmq-discuss] rabbitmq cluster failover for persistent
	queues
In-Reply-To: <4A6CE8E9.5070100@lshift.net>
References: <de2dbca0907251730m6c4d3e9ds2f5d061a48fd86b@mail.gmail.com>
	<20090726091058.GA10274@aa>
	<de2dbca0907261045s6ec7dcafxae0ba57d5bf5cc7c@mail.gmail.com>
	<4A6CE8E9.5070100@lshift.net>
Message-ID: <de2dbca0907261703t5cf01b8fuf6264abb0d235d4c@mail.gmail.com>

Yes, thank you for clarifying that Matthias.

On Sun, Jul 26, 2009 at 4:38 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Charles,
>
> charles woerner wrote:
>
>> So in the case of competing consumers taking messages from a rabbitmq
>> broker cluster it sounds like once-and-only-once delivery is somewhat
>> up to the application to implement by arranging for each message to
>> be delivered to redundant queues (ie. 2 separate queues with similar
>> bindings residing on different hosts), then coordinate among your
>> consumers to ensure once-and-only-once delivery using a database or
>> simply to make your workflow idempotent with respect to the duplicate
>> messages.
>>
>
> Exactly-once requires coordination between consumers, or idempotency,
> even when there is just a single queue. The consumer, broker or network
> may die during the transmission of the ack for a message, thus causing
> retransmission of the message (which the consumer has already seen and
> processed) at a later point.
>
> Once that issue has been addressed in a system, the introduction of
> redundant queues doesn't present any new challenges.
>
>
> Regards,
>
> Matthias.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090726/9bd15aad/attachment.htm 

From cuonglb at facemain.com  Mon Jul 27 04:18:02 2009
From: cuonglb at facemain.com (Cuong Le)
Date: Mon, 27 Jul 2009 10:18:02 +0700
Subject: [rabbitmq-discuss] Error (re)installing rabbit on ubuntu 9.04
In-Reply-To: <346810630907231823x78f62a94m9b467b33e2f459db@mail.gmail.com>
References: <346810630907231307x61035396radec06aa571d0c0e@mail.gmail.com>
	<4A68DFA8.8060907@lshift.net>
	<346810630907231638q7b75ed7fna4226dcd144af1e7@mail.gmail.com>
	<4A68FBF4.4020803@lshift.net>
	<346810630907231823x78f62a94m9b467b33e2f459db@mail.gmail.com>
Message-ID: <aae1003d0907262018hcd54774h4357ea5bdc10cfb7@mail.gmail.com>

Other solution :

Clone source rabbitmq-server from github, build and install it (
http://www.rabbitmq.com/install.html). It's worked fine for me :D.

Cuong

On Fri, Jul 24, 2009 at 8:23 AM, Paulo Suzart <paulosuzart at gmail.com> wrote:

> Wow! Bang! Right there Matthias.
>
> RabbitMQ is up and runnig. Really thanks for that. Finally going deep in my
> studies. Hope have fun with rabbit.
>
> Sincerely
>
> Paulo Suzart
>
> 2009/7/23 Matthias Radestock <matthias at lshift.net>
>
>> Paulo,
>>
>>
>> Paulo Suzart wrote:
>> > Firstly thanks for helping. Here go the two logs.
>> >
>> > startup_err:
>> >
>> > Crash dump was written to: erl_crash.dump
>> > init terminating in do_boot ()
>> >
>> > startup_log:
>> >
>> > {"init terminating in
>> >
>> do_boot",{undef,[{rabbit_multi,start,[]},{init,start_it,1},{init,start_em,1}]}}
>>
>> The error indicates that erlang could not find the RabbitMQ code
>> modules. In a package-managed installation of RabbitMQ like yours one
>> typical reason for that is a secondary installation of Erlang that is on
>> the PATH before the package-managed one. To test that, run 'erl' and
>> inspect the output of evaluating
>>  code:lib_dir().
>> That will tell you where Erlang is looking for its libraries. If 'erl'
>> is the package-managed installation then this will usually point to
>> '/usr/lib/erlang/lib', and you will find a rabbitmq_server-<vsn>
>> directory underneath that. I suspect in your case it will point
>> elsewhere (and there is no rabbitmq_server subdir there). If so, remove
>> your secondary Erlang installation and that should solve the problem.
>> Alternatively you can also create a symlink in the reported library dir
>> to /usr/lib/erlang/lib/rabbitmq_server-<vsn> (assuming that is where the
>> package manager installed the RabbitMQ modules).
>>
>> There could be other reasons for the reported error, but the above
>> scenario is the one people run into most frequently.
>>
>>
>> Regards,
>>
>> Matthias.
>>
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090727/bc3e21a8/attachment.htm 

From garymazzaferro at gmail.com  Mon Jul 27 14:44:21 2009
From: garymazzaferro at gmail.com (Gary Mazz)
Date: Mon, 27 Jul 2009 07:44:21 -0600
Subject: [rabbitmq-discuss] Rabbit-MQ for solaris containers ?
Message-ID: <4A6DAF35.3090705@gmail.com>

Hi,

 I was wondering if there is a "how to" for RabbitMQ for solaris containers ? (really open solaris)  I'm  putting together a prototype for translating message contents. I was thinking solaris containers is highest yield way, so I don't need a dozen machines. VMs need too much memory in comparison to containers and don't have the new network routing stuff.  

Any advise would be appreciated...

cheers,

 -gary




From alexis.richardson at gmail.com  Mon Jul 27 15:00:00 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Mon, 27 Jul 2009 15:00:00 +0100
Subject: [rabbitmq-discuss] Rabbit-MQ for solaris containers ?
In-Reply-To: <4A6DAF35.3090705@gmail.com>
References: <4A6DAF35.3090705@gmail.com>
Message-ID: <167204d20907270700o65ae902dld6f472fe0ba3ea72@mail.gmail.com>

Gary

I think Jason Williams may be able to comment on this.  I have bcc'd him.

alexis


On Mon, Jul 27, 2009 at 2:44 PM, Gary Mazz<garymazzaferro at gmail.com> wrote:
> Hi,
>
> ?I was wondering if there is a "how to" for RabbitMQ for solaris containers ? (really open solaris) ?I'm ?putting together a prototype for translating message contents. I was thinking solaris containers is highest yield way, so I don't need a dozen machines. VMs need too much memory in comparison to containers and don't have the new network routing stuff.
>
> Any advise would be appreciated...
>
> cheers,
>
> ?-gary
>
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From niko.felger at googlemail.com  Mon Jul 27 16:55:09 2009
From: niko.felger at googlemail.com (Niko Felger)
Date: Mon, 27 Jul 2009 16:55:09 +0100
Subject: [rabbitmq-discuss] RabbitMQ load balancing/failover with LVS
Message-ID: <c4f7626d0907270855v17e8c524g5f9caaa7cb434b8d@mail.gmail.com>

Hi,

We have been working with a single RabbitMQ node for about a month
now, and have been very happy with it, so we decided to add a second
node, mainly for failover, since our load is moderate. We hooked up
two nodes following http://www.rabbitmq.com/clustering.html:

Status of node 'rabbit at dc1-live-mq1' ...
[{running_applications,[{rabbit,"RabbitMQ","1.5.5"},
                      {mnesia,"MNESIA  CXC 138 12","4.3.5"},
                      {os_mon,"CPO  CXC 138 46","2.1.2.1"},
                      {sasl,"SASL  CXC 138 11","2.1.5.1"},
                      {stdlib,"ERTS  CXC 138 10","1.14.5"},
                      {kernel,"ERTS  CXC 138 10","2.11.5"}]},
 {nodes,['rabbit at dc1-live-mq2','rabbit at dc1-live-mq1']},
 {running_nodes,['rabbit at dc1-live-mq2','rabbit at dc1-live-mq1']}]
...done.

Status of node 'rabbit at dc1-live-mq2' ...
[{running_applications,[{rabbit,"RabbitMQ","1.5.5"},
                      {mnesia,"MNESIA  CXC 138 12","4.3.5"},
                      {os_mon,"CPO  CXC 138 46","2.1.2.1"},
                      {sasl,"SASL  CXC 138 11","2.1.5.1"},
                      {stdlib,"ERTS  CXC 138 10","1.14.5"},
                      {kernel,"ERTS  CXC 138 10","2.11.5"}]},
 {nodes,['rabbit at dc1-live-mq2','rabbit at dc1-live-mq1']},
 {running_nodes,['rabbit at dc1-live-mq1','rabbit at dc1-live-mq2']}]
...done.

When we point our clients to either of the RabbitMQ nodes directly
everything works fine.

In order to allow our clients to always point to a single host,
regardless of which nodes are up, we set up LVS load balancing on a
third server called 'lb1'. However, once we do this, we experience
issues with low-volume queues. It goes roughly like this:

- Consumer starts and establishes a connection to lb1.
- lb1 forwards packets from the consumer to e.g. mq1.
- At this point, the consumer has an established connection to lb1,
mq1 has an established connection directly to the consumer, and
messages published to the queue reach the consumer.
- After ~5-10 minutes without messages published to the queue, the
connection on the consumer goes away, and it establishes a new
connection to lb1. mq1 at this point still has an established to
connection to the consumer on the original port, in addition to the
new connection. Messages published to the queue in question are now no
longer delivered to the consumer.
- We start another consumer, but it doesn't receive messages either.
- After some more time, the original connection times out
({inet_error,etimedout}), and messages get processed again, but only
by the second consumer.

It may be worth mentioning that the consumer subscribes to the queue
with auto-ack turned off.

The problem seems to be the load balancer dropping connections, but
since we're using it successfully in a few other cases, I thought I
could get some input on whether this is even a sensible strategy for
doing failover for RabbitMQ, and if anyone has experience with setups
similar to ours.

Thanks!
niko

PS: We're also seeing plenty of this in the rabbit.log, repeating
every 30 seconds:
=ERROR REPORT==== 27-Jul-2009::16:27:24 ===
** Generic server <0.9049.9> terminating
** Last message in was {inet_async,#Port<0.222>,41513,{ok,#Port<0.236483>}}
** When Server state == {state,{rabbit_networking,start_client,[]},
                             #Port<0.222>,
                             41513}
** Reason for termination ==
** {{badmatch,{error,enotconn}},
  [{tcp_acceptor,handle_info,2},
   {gen_server,handle_msg,6},
   {proc_lib,init_p,5}]}

>From rabbit-sasl.log:
=CRASH REPORT==== 27-Jul-2009::16:27:24 ===
 crasher:
  pid: <0.9049.9>
  registered_name: []
  error_info: {{badmatch,{error,enotconn}},
                [{tcp_acceptor,handle_info,2},
                 {gen_server,handle_msg,6},
                 {proc_lib,init_p,5}]}
  initial_call: {gen,init_it,
                    [gen_server,
                     <0.179.0>,
                     <0.179.0>,
                     tcp_acceptor,
                     {{rabbit_networking,start_client,[]},#Port<0.222>},
                     []]}
  ancestors: ['tcp_acceptor_sup_0.0.0.0:5672',
                <0.178.0>,
                rabbit_sup,
                <0.105.0>]
  messages: []
  links: [<0.179.0>,#Port<0.236483>]
  dictionary: []
  trap_exit: false
  status: running
  heap_size: 233
  stack_size: 21
  reductions: 166
 neighbours:

=SUPERVISOR REPORT==== 27-Jul-2009::16:27:24 ===
   Supervisor: {local,
                                         'tcp_acceptor_sup_0.0.0.0:5672'}
   Context:    child_terminated
   Reason:     {{badmatch,{error,enotconn}},
                [{tcp_acceptor,handle_info,2},
                 {gen_server,handle_msg,6},
                 {proc_lib,init_p,5}]}
   Offender:   [{pid,<0.9049.9>},
                {name,tcp_acceptor},
                {mfa,{tcp_acceptor,start_link,
                                   [{rabbit_networking,start_client,[]},
                                    #Port<0.222>]}},
                {restart_type,transient},
                {shutdown,brutal_kill},
                {child_type,worker}]



From wilson.ke at wealthcraft.com  Tue Jul 28 04:04:06 2009
From: wilson.ke at wealthcraft.com (Wilson Ke)
Date: Tue, 28 Jul 2009 11:04:06 +0800
Subject: [rabbitmq-discuss] Durable queues and high availability
	(broker	failage)
In-Reply-To: <269388e30907151554l17b69d6fv1147a10fac36833f@mail.gmail.com>
References: <4A488522.9000003@eintr.org>
	<185945640906290212t54a0ea15lcf1d6595f48d833a@mail.gmail.com>
	<269388e30907151554l17b69d6fv1147a10fac36833f@mail.gmail.com>
Message-ID: <8F16BDCC98E64841857E711110AF5EDD774785294A@EXMBX01.wealthcraft.local>

When I restart rabbitmq server,the durable queue had purge all messages. I want to remain these messages in the durable queue after restart rabbitmq server,how can I do?
Btw,I use deliverymode=2(persistent) to send messages to the queue. 




-----Original Message-----
From: rabbitmq-discuss-bounces at lists.rabbitmq.com [mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Ben Hood
Sent: 2009?7?16? 6:55
To: Daniel Lundin
Cc: rabbitmq-discuss at lists.rabbitmq.com
Subject: Re: [rabbitmq-discuss] Durable queues and high availability (broker failage)

Daniel,

On Mon, Jun 29, 2009 at 10:12 AM, Daniel Lundin<dln at eintr.org> wrote:
> Q1) Is there some notification mechanism to rely on to reliably tell a
> queues has failed so apps can take measures to manage the failure, i.e
> recreate the queue or set up a "temporary fail" queue?

Not really.

> Q2) Is there a way to "replay" recovered messages from the failed,
> no-longer-relevant queue, into the newly/upon-failure created one? This
> seems it would allow graceful recovery, even automatically so, once the
> failed node does come back up.

Yes, persistent messages will be re-queued when a node is rehydrated.
This is a manual process though.

> So, what is the preferred way to handle node failure in a real-life
> rabbitmq-based app today?

I should think most people currently use a replicated FS to back
persistent messages with and monitor each node with something like
nagios.

HTH,

Ben

_______________________________________________
rabbitmq-discuss mailing list
rabbitmq-discuss at lists.rabbitmq.com
http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss

From adrya1984 at gmail.com  Tue Jul 28 07:56:03 2009
From: adrya1984 at gmail.com (Adriana Rodean)
Date: Tue, 28 Jul 2009 09:56:03 +0300
Subject: [rabbitmq-discuss] Multiple consumers
Message-ID: <496c8fcc0907272356i1056c5aer7590f13ebe2d761f@mail.gmail.com>

Hi,

I have this example of a publisher:

? string exchangeName = "{27}{47}{System}", queueName =
"{27}{47}{System}", routingKey = "System";
??????????? channel.ExchangeDeclare(exchangeName, ExchangeType.Topic);
??????????? channel.QueueDeclare(queueName);
??????????? channel.QueueBind(queueName, exchangeName, routingKey, false, null);
??????????? byte[] messageBodyBytes =
System.Text.Encoding.UTF8.GetBytes("Hello, world! 27_2");
??????????? IBasicProperties props = channel.CreateBasicProperties();
??????????? props.ContentType = "text/plain";
??????????? props.DeliveryMode = 2;
??????????? channel.BasicPublish(exchangeName, routingKey, props,
messageBodyBytes);

And 2 different applications that subscribe to it with this code:

  Subscription sub = new Subscription(channel, queueName);
            foreach (BasicDeliverEventArgs e in sub)
            {
                Console.WriteLine(Encoding.UTF8.GetString(e.Body));

            }

When i publish message 1 subscriber receives the message. After i
close this subscriber the other one receives the message.
I want both subscribers to receive the message when they are open.
What am i doing wrong?
Please help!

Thanks,
Adriana



From matthew at lshift.net  Tue Jul 28 10:17:08 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 28 Jul 2009 10:17:08 +0100
Subject: [rabbitmq-discuss] Multiple consumers
In-Reply-To: <496c8fcc0907272356i1056c5aer7590f13ebe2d761f@mail.gmail.com>
References: <496c8fcc0907272356i1056c5aer7590f13ebe2d761f@mail.gmail.com>
Message-ID: <20090728091708.GA30019@mrnibble.lshift.net>

Hi Adriana,

On Tue, Jul 28, 2009 at 09:56:03AM +0300, Adriana Rodean wrote:
> When i publish message 1 subscriber receives the message. After i
> close this subscriber the other one receives the message.
> I want both subscribers to receive the message when they are open.
> What am i doing wrong?

When you subscribe, you're not setting the subscriber to auto-ack and
you're also not acknowledging the messages. You need to do one of these.

Without either of these, Rabbit will happily deliver messages to you,
but will hang on to them (because they've not been ack'd) and then when
the connection has been closed will add the messages back into the
queue. By ack'ing the messages, you tell Rabbit that you really have
received the messages and it can forget about them. Setting the
subscription to auto-ack mode does the same thing without you having to
sent explicit acks - i.e. it will consider the message acknowledged and
forget about it as soon as it's sent it to your consumer.

Matthew



From tonyg at lshift.net  Tue Jul 28 12:19:32 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 28 Jul 2009 12:19:32 +0100
Subject: [rabbitmq-discuss] Using Subscriptions in different ways (was Re:
 Multiple consumers)
In-Reply-To: <496c8fcc0907272356i1056c5aer7590f13ebe2d761f@mail.gmail.com>
References: <496c8fcc0907272356i1056c5aer7590f13ebe2d761f@mail.gmail.com>
Message-ID: <4A6EDEC4.2060306@lshift.net>

Hi Adriana,

Adriana Rodean wrote:
> When i publish message 1 subscriber receives the message. After i
> close this subscriber the other one receives the message.
> I want both subscribers to receive the message when they are open.
> What am i doing wrong?
> Please help!

Here is a schematic of what the code you posted sets up:

    exchange "{27}{47}{System}"
      |
      |
      V
    queue "{27}{47}{System}"
      |
      +-----+
      |     |
      V     V
      s1    s2

In AMQP, queues perform *round-robin* distribution of messages to 
consumers (a.k.a subscribers), meaning that only *one* subscriber to a 
queue will get each message. (See also Matthew's explanation of 
acknowledgements.) AMQP's *exchanges*, on the other hand, perform 
message *broadcasting*, copying messages onto all (matching) bound queues.

So to get your example of a single publication arriving at two different 
subscribers/consumers simultaneously, you would want something like the 
following:

    exchange "{27}{47}{System}"
      |
      +----------------------+
      |                      |
      V                      V
    queue 1                queue 2
      |                      |
      |                      |
      V                      V
      s1                     s2

Each subscriber should declare an auto-delete, private, uniquely-named 
queue for themselves. Here's how to do that with the .NET client:

   Subscription sub = new Subscription(channel,
                                       "{27}{47}{System}",
                                       ExchangeType.Topic,
                                       "System");
   foreach (BasicDeliverEventArgs e in sub) {
     Console.WriteLine(Encoding.UTF8.GetString(e.Body));
   }

Notice how a queue name is not mentioned: the Subscription calls 
channel.QueueDeclare() for you and uses the resulting private, 
uniquely-named, autodelete queue to bind and consume from.

Matthew wrote about acknowledgements: it's important to call sub.Ack(e) 
after your program successfully processes each message, otherwise the 
server will attempt to redeliver the messages later on, because it isn't 
being told that it's safe to remove them from its queues.

(As an aside, the Subscription generally takes care of declaring 
exchange and queue resources for you -- you don't generally need to call 
ExchangeDeclare, QueueDeclare, QueueBind if you're using Subscription.)

Regards,
   Tony




From adrya1984 at gmail.com  Tue Jul 28 13:11:58 2009
From: adrya1984 at gmail.com (Adriana Rodean)
Date: Tue, 28 Jul 2009 15:11:58 +0300
Subject: [rabbitmq-discuss] Using Subscriptions in different ways (was
	Re: Multiple consumers)
In-Reply-To: <4A6EDEC4.2060306@lshift.net>
References: <496c8fcc0907272356i1056c5aer7590f13ebe2d761f@mail.gmail.com> 
	<4A6EDEC4.2060306@lshift.net>
Message-ID: <496c8fcc0907280511w2d4dfe0g53845a85a0972c06@mail.gmail.com>

Hi Tony,

Thank you very much for your reply and example :)
I subscribed like this but now i get the published message only when
both subscribers are online.
If subscribers are offline when message is published neither of them
gets the message.
What can i change so the subscribers get the message even if they are
offline when message is published?

Subscription sub = new Subscription(channel,
                                "{27}{47}{System}",
                                ExchangeType.Topic,
                                "System");
            Console.WriteLine("Consumer tag: " + sub.ConsumerTag);
            foreach (BasicDeliverEventArgs e in sub)
            {

                Console.WriteLine(Encoding.UTF8.GetString(e.Body));
                sub.Ack(e);

            }

Thank you again,
Adriana

On Tue, Jul 28, 2009 at 14:19, Tony Garnock-Jones<tonyg at lshift.net> wrote:
> Hi Adriana,
>
> Adriana Rodean wrote:
>>
>> When i publish message 1 subscriber receives the message. After i
>> close this subscriber the other one receives the message.
>> I want both subscribers to receive the message when they are open.
>> What am i doing wrong?
>> Please help!
>
> Here is a schematic of what the code you posted sets up:
>
> ? exchange "{27}{47}{System}"
> ? ? |
> ? ? |
> ? ? V
> ? queue "{27}{47}{System}"
> ? ? |
> ? ? +-----+
> ? ? | ? ? |
> ? ? V ? ? V
> ? ? s1 ? ?s2
>
> In AMQP, queues perform *round-robin* distribution of messages to consumers
> (a.k.a subscribers), meaning that only *one* subscriber to a queue will get
> each message. (See also Matthew's explanation of acknowledgements.) AMQP's
> *exchanges*, on the other hand, perform message *broadcasting*, copying
> messages onto all (matching) bound queues.
>
> So to get your example of a single publication arriving at two different
> subscribers/consumers simultaneously, you would want something like the
> following:
>
> ? exchange "{27}{47}{System}"
> ? ? |
> ? ? +----------------------+
> ? ? | ? ? ? ? ? ? ? ? ? ? ?|
> ? ? V ? ? ? ? ? ? ? ? ? ? ?V
> ? queue 1 ? ? ? ? ? ? ? ?queue 2
> ? ? | ? ? ? ? ? ? ? ? ? ? ?|
> ? ? | ? ? ? ? ? ? ? ? ? ? ?|
> ? ? V ? ? ? ? ? ? ? ? ? ? ?V
> ? ? s1 ? ? ? ? ? ? ? ? ? ? s2
>
> Each subscriber should declare an auto-delete, private, uniquely-named queue
> for themselves. Here's how to do that with the .NET client:
>
> ?Subscription sub = new Subscription(channel,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?"{27}{47}{System}",
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?ExchangeType.Topic,
> ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ? ?"System");
> ?foreach (BasicDeliverEventArgs e in sub) {
> ? ?Console.WriteLine(Encoding.UTF8.GetString(e.Body));
> ?}
>
> Notice how a queue name is not mentioned: the Subscription calls
> channel.QueueDeclare() for you and uses the resulting private,
> uniquely-named, autodelete queue to bind and consume from.
>
> Matthew wrote about acknowledgements: it's important to call sub.Ack(e)
> after your program successfully processes each message, otherwise the server
> will attempt to redeliver the messages later on, because it isn't being told
> that it's safe to remove them from its queues.
>
> (As an aside, the Subscription generally takes care of declaring exchange
> and queue resources for you -- you don't generally need to call
> ExchangeDeclare, QueueDeclare, QueueBind if you're using Subscription.)
>
> Regards,
> ?Tony
>
>



From tonyg at lshift.net  Tue Jul 28 13:46:52 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Tue, 28 Jul 2009 13:46:52 +0100
Subject: [rabbitmq-discuss] Using Subscriptions in different ways (was
 Re: Multiple consumers)
In-Reply-To: <496c8fcc0907280511w2d4dfe0g53845a85a0972c06@mail.gmail.com>
References: <496c8fcc0907272356i1056c5aer7590f13ebe2d761f@mail.gmail.com>
	<4A6EDEC4.2060306@lshift.net>
	<496c8fcc0907280511w2d4dfe0g53845a85a0972c06@mail.gmail.com>
Message-ID: <4A6EF33C.5030005@lshift.net>

Hi Adriana,

Adriana Rodean wrote:
> I subscribed like this but now i get the published message only when
> both subscribers are online.
> If subscribers are offline when message is published neither of them
> gets the message.
> What can i change so the subscribers get the message even if they are
> offline when message is published?

I see.

For this, you *will* need to use named queues -- you will still need one 
queue per subscriber, but instead of making them autodelete, you'll make 
them durable.

So you'll, for each subscriber,

  - decide on a queue name unique to the subscriber

  - ExchangeDeclare your exchange, as you did in your original code

  - QueueDeclare the subscriber's own queue:
        channel.QueueDeclare(queueName, true);
    The "true" parameter makes it durable (i.e. survives broker
    restarts)

  - QueueBind, as you did in your original code

  - create a Subscription on the subscriber's queue, as you did in
    your original code

Ultimately, then, the only change from your original code is that each 
subscriber should be talking to the server about their own individual 
queues.

Regards,
   Tony




From matthew at lshift.net  Tue Jul 28 13:48:59 2009
From: matthew at lshift.net (Matthew Sackman)
Date: Tue, 28 Jul 2009 13:48:59 +0100
Subject: [rabbitmq-discuss] Using Subscriptions in different ways (was
 Re: Multiple consumers)
In-Reply-To: <496c8fcc0907280511w2d4dfe0g53845a85a0972c06@mail.gmail.com>
References: <496c8fcc0907272356i1056c5aer7590f13ebe2d761f@mail.gmail.com>
	<4A6EDEC4.2060306@lshift.net>
	<496c8fcc0907280511w2d4dfe0g53845a85a0972c06@mail.gmail.com>
Message-ID: <20090728124859.GB30019@mrnibble.lshift.net>

Hi Adriana,

On Tue, Jul 28, 2009 at 03:11:58PM +0300, Adriana Rodean wrote:
> Thank you very much for your reply and example :)
> I subscribed like this but now i get the published message only when
> both subscribers are online.
> If subscribers are offline when message is published neither of them
> gets the message.
> What can i change so the subscribers get the message even if they are
> offline when message is published?

In this case you need to make sure the exchange and both queues are
created in advance of the subscribers connecting. A message sent to an
exchange which has no queues bound to it will (under normal
circumstances) be dropped silently. This is what I suspect is happening
in your case. Create the exchange, then the two queues and bind them to
the exchange before the first message is published. The consumers should
pick the messages up at their leisure when they connect.

Matthew



From raykrueger at gmail.com  Tue Jul 28 18:21:44 2009
From: raykrueger at gmail.com (Ray Krueger)
Date: Tue, 28 Jul 2009 12:21:44 -0500
Subject: [rabbitmq-discuss] java-client question
Message-ID: <5b2d38840907281021h31679127i2febf7cb9fab831c@mail.gmail.com>

Is it thread-safe for multiple threads to issue basicPublish commands
on a channel?



From holger.hoffstaette at googlemail.com  Tue Jul 28 19:19:39 2009
From: holger.hoffstaette at googlemail.com (=?ISO-8859-1?Q?Holger_Hoffst=E4tte?=)
Date: Tue, 28 Jul 2009 20:19:39 +0200
Subject: [rabbitmq-discuss] java-client question
In-Reply-To: <5b2d38840907281021h31679127i2febf7cb9fab831c@mail.gmail.com>
References: <5b2d38840907281021h31679127i2febf7cb9fab831c@mail.gmail.com>
Message-ID: <4A6F413B.4010206@googlemail.com>

Ray Krueger wrote:
> Is it thread-safe for multiple threads to issue basicPublish commands
> on a channel?

http://www.rabbitmq.com/api-guide.html#channel-threads

-h



From raykrueger at gmail.com  Tue Jul 28 19:36:57 2009
From: raykrueger at gmail.com (Ray Krueger)
Date: Tue, 28 Jul 2009 13:36:57 -0500
Subject: [rabbitmq-discuss] java-client question
In-Reply-To: <4A6F413B.4010206@googlemail.com>
References: <5b2d38840907281021h31679127i2febf7cb9fab831c@mail.gmail.com>
	<4A6F413B.4010206@googlemail.com>
Message-ID: <5b2d38840907281136o2b4ba2b0n883e3767afe32227@mail.gmail.com>

2009/7/28 Holger Hoffst?tte <holger.hoffstaette at googlemail.com>:
> Ray Krueger wrote:
>> Is it thread-safe for multiple threads to issue basicPublish commands
>> on a channel?
>
> http://www.rabbitmq.com/api-guide.html#channel-threads

Yeah, I saw that. The javadoc says something about limiting a channel
to one command. I wasn't sure if publishing was a "command" or not.

The client doesn't support any form of pooling at all? Should I expect
to create a channel from scratch every time I want to publish a
message?

(Sorry for the direct email Holger, I see now you guys are using a
crappy list-serve that doesn't set the reply-to :P)



From alexis.richardson at gmail.com  Tue Jul 28 19:38:12 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Tue, 28 Jul 2009 19:38:12 +0100
Subject: [rabbitmq-discuss] java-client question
In-Reply-To: <5b2d38840907281136o2b4ba2b0n883e3767afe32227@mail.gmail.com>
References: <5b2d38840907281021h31679127i2febf7cb9fab831c@mail.gmail.com>
	<4A6F413B.4010206@googlemail.com>
	<5b2d38840907281136o2b4ba2b0n883e3767afe32227@mail.gmail.com>
Message-ID: <167204d20907281138s7fa53196lf215f54469375899@mail.gmail.com>

Apologies for the listserv :-P


2009/7/28 Ray Krueger <raykrueger at gmail.com>:
> 2009/7/28 Holger Hoffst?tte <holger.hoffstaette at googlemail.com>:
>> Ray Krueger wrote:
>>> Is it thread-safe for multiple threads to issue basicPublish commands
>>> on a channel?
>>
>> http://www.rabbitmq.com/api-guide.html#channel-threads
>
> Yeah, I saw that. The javadoc says something about limiting a channel
> to one command. I wasn't sure if publishing was a "command" or not.
>
> The client doesn't support any form of pooling at all? Should I expect
> to create a channel from scratch every time I want to publish a
> message?
>
> (Sorry for the direct email Holger, I see now you guys are using a
> crappy list-serve that doesn't set the reply-to :P)
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From matthias at lshift.net  Wed Jul 29 01:34:12 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Jul 2009 01:34:12 +0100
Subject: [rabbitmq-discuss] Durable queues and high availability	(broker
 failage)
In-Reply-To: <8F16BDCC98E64841857E711110AF5EDD774785294A@EXMBX01.wealthcraft.local>
References: <4A488522.9000003@eintr.org>	<185945640906290212t54a0ea15lcf1d6595f48d833a@mail.gmail.com>	<269388e30907151554l17b69d6fv1147a10fac36833f@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD774785294A@EXMBX01.wealthcraft.local>
Message-ID: <4A6F9904.5070209@lshift.net>

Wilson,

Wilson Ke wrote:
> When I restart rabbitmq server,the durable queue had purge all
> messages. I want to remain these messages in the durable queue after
> restart rabbitmq server,how can I do? Btw,I use
> deliverymode=2(persistent) to send messages to the queue.

As long as the queues are marked as durable, are not exclusive or
auto-delete, and the messages are marked as persistent, then the queues
and messages should survive a broker restart.

If all these conditions are met in your setup and the messages still
disappear then please post the code that creates the queues and the code
that sends the messages.

Regards,

Matthias.



From matthias at lshift.net  Wed Jul 29 02:02:46 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Jul 2009 02:02:46 +0100
Subject: [rabbitmq-discuss] RabbitMQ load balancing/failover with LVS
In-Reply-To: <c4f7626d0907270855v17e8c524g5f9caaa7cb434b8d@mail.gmail.com>
References: <c4f7626d0907270855v17e8c524g5f9caaa7cb434b8d@mail.gmail.com>
Message-ID: <4A6F9FB6.2040307@lshift.net>

Niko,

Niko Felger wrote:
> In order to allow our clients to always point to a single host,
> regardless of which nodes are up, we set up LVS load balancing on a
> third server called 'lb1'. However, once we do this, we experience
> issues with low-volume queues. It goes roughly like this:
> 
> - Consumer starts and establishes a connection to lb1.
> - lb1 forwards packets from the consumer to e.g. mq1.
> - At this point, the consumer has an established connection to lb1,
> mq1 has an established connection directly to the consumer, and
> messages published to the queue reach the consumer.

So the consumer has two connections - one to lb1 and one to mq1? That 
seems weird.

Also, you say that mq1 has a connection *to* the consumer - are you 
implying that your load-balancing reverses the direction of connection 
establishment?

> - After ~5-10 minutes without messages published to the queue, the
> connection on the consumer goes away, and it establishes a new
> connection to lb1. mq1 at this point still has an established to
> connection to the consumer on the original port, in addition to the
> new connection. Messages published to the queue in question are now no
> longer delivered to the consumer.

Any idea what causes the original connection to get dropped?

Also, what client are you using, and do you have heartbeats enabled on 
the AMQP connection?

> - We start another consumer, but it doesn't receive messages either.
> - After some more time, the original connection times out
> ({inet_error,etimedout}), and messages get processed again, but only
> by the second consumer.

That's a bit strange ... I would expect at least *some* messages to make 
it through via the new connections, since the queue delivers messages 
round-robin(ish) to connected consumers.

> The problem seems to be the load balancer dropping connections, but
> since we're using it successfully in a few other cases, I thought I
> could get some input on whether this is even a sensible strategy for
> doing failover for RabbitMQ, and if anyone has experience with setups
> similar to ours.

I am pretty sure some folks have used RabbitMQ behind a load balancer. 
Rabbit doesn't do anything fancy at the TCP/IP level, so generally this 
should work ok.

> PS: We're also seeing plenty of this in the rabbit.log, repeating
> every 30 seconds:
> =ERROR REPORT==== 27-Jul-2009::16:27:24 ===
> ** Generic server <0.9049.9> terminating
> ** Last message in was {inet_async,#Port<0.222>,41513,{ok,#Port<0.236483>}}
> ** When Server state == {state,{rabbit_networking,start_client,[]},
>                              #Port<0.222>,
>                              41513}
> ** Reason for termination ==
> ** {{badmatch,{error,enotconn}},
>   [{tcp_acceptor,handle_info,2},
>    {gen_server,handle_msg,6},
>    {proc_lib,init_p,5}]}

That looks like a connection is getting dropped before the server has 
completed accepting it. I have never seen this before, so would suspect 
your load balancer is doing something weird.


Regards,

Matthias.



From matthias at lshift.net  Wed Jul 29 02:18:56 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Jul 2009 02:18:56 +0100
Subject: [rabbitmq-discuss] Diagnosing a problem
In-Reply-To: <7fd310d10907221305g3e6d5edag351877f56c74dd57@mail.gmail.com>
References: <7fd310d10907220748y18419ff8gc3fa4d6d326b6e5c@mail.gmail.com>	<4A674363.7010804@lshift.net>
	<7fd310d10907221305g3e6d5edag351877f56c74dd57@mail.gmail.com>
Message-ID: <4A6FA380.3030205@lshift.net>

Bryan,

Bryan Murphy wrote:
> This was in my rabbitmq startup error log: [...] starting persister
> ...{"init terminating in 
> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{{badmatch,{error,{{function_clause,[{rabbit_persister,replay,[{corrupt_log_file,"/var/lib/rabbitmq/mnesia/rabbit/rabbit_persister.LOG"},rabbit_persister,error,{psnapshot,1,{dict,0,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},192,193}]},{rabbit_persister,internal_load_snapshot,2},{rabbit_persister,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]},{child,undefined,rabbit_persister,{rabbit_persister,start_link,[]},transient,100,worker,[rabbit_persister]}}}},[{rabbit,start_child,1},{rabbit,'-start/2-fun-4-',0},{rabbit,'-start/2-fun-0-',1},{lists,foreach,2},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}}},[{init,start_it,1},{init,start_em,1}]}}

Interesting! A corrupted persister log file. I don't think we've seen 
that particular error before.

Do you still have that file? Also, is there a .previous file in the same 
dir? If so, replacing the corrupted file with the .previous file would 
probably allow you to recover the messages.

The replacing really should happen automatically. This has been 
discussed as a possible enhancement on the mailing list before, but the 
new persister is going to be ready soon, so we are not planning any 
enhancements to the old one.

Regards,

Matthias



From wilson.ke at wealthcraft.com  Wed Jul 29 02:51:55 2009
From: wilson.ke at wealthcraft.com (Wilson Ke)
Date: Wed, 29 Jul 2009 09:51:55 +0800
Subject: [rabbitmq-discuss] Durable queues and high availability	(broker
 failage)
In-Reply-To: <4A6F9904.5070209@lshift.net>
References: <4A488522.9000003@eintr.org>
	<185945640906290212t54a0ea15lcf1d6595f48d833a@mail.gmail.com>
	<269388e30907151554l17b69d6fv1147a10fac36833f@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD774785294A@EXMBX01.wealthcraft.local>
	<4A6F9904.5070209@lshift.net>
Message-ID: <8F16BDCC98E64841857E711110AF5EDD774785299B@EXMBX01.wealthcraft.local>

Hi Matthias,

I declare exchange and queue are durable, and met all what you said. Now I post my code lines to below,

and the attachment is the wrapper class of rabbit API, if you have some ideas in my code lines. Please let me know.

Thanks.





//declare exchange

rabbitmqWrapper.ExchangeDeclare(Exchange.ExchangeName, ExchangeType.Topic, false, true, false, false, false, null);



//declare queue

rabbitmqWrapper.QueueDeclare(Queue.QueueName, false, true, false, false, false, null);



//bind queue

rabbitmqWrapper.QueueBind(quename, exchangename,"test",false,null);



//send message

private void SendMessage()

{

    string xml = GetXml();

    RabbitmqWrapper wrapper =new RabbitmqWrapper();

    wrapper.PublishMessage("wslinboundexchange",wslinboundque,"test",xml);

}

//function of RabbitmqWrapper class

public void PublishMessage(string exchangeName,string queueName,string returnKey,string xml)

{

IConnection conn = new ConnectionFactory().CreateConnection(this.rabbitmqHost);    using (IModel ch = conn.CreateModel())

    {

        IBasicProperties props = ch.CreateBasicProperties();

        props.ContentType = "text/plain";



        props.DeliveryMode = 2;

        IStreamMessageBuilder b = new StreamMessageBuilder(ch);

        byte[] byptes = Encoding.UTF8.GetBytes(xml);

        b.WriteBytes(byptes);

        ch.BasicPublish(exchangeName, returnKey,null,byptes);

    }

}

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net]
Sent: 2009?7?29? 8:34
To: Wilson Ke
Cc: 'rabbitmq-discuss at lists.rabbitmq.com'
Subject: Re: [rabbitmq-discuss] Durable queues and high availability (broker failage)



Wilson,



Wilson Ke wrote:

> When I restart rabbitmq server,the durable queue had purge all

> messages. I want to remain these messages in the durable queue after

> restart rabbitmq server,how can I do? Btw,I use

> deliverymode=2(persistent) to send messages to the queue.



As long as the queues are marked as durable, are not exclusive or

auto-delete, and the messages are marked as persistent, then the queues

and messages should survive a broker restart.



If all these conditions are met in your setup and the messages still

disappear then please post the code that creates the queues and the code

that sends the messages.



Regards,



Matthias.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090729/4be3c927/attachment.htm 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: RabbitmqWrapper.cs
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090729/4be3c927/attachment.txt 

From matthias at lshift.net  Wed Jul 29 03:02:48 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Jul 2009 03:02:48 +0100
Subject: [rabbitmq-discuss] Durable queues and high availability	(broker
 failage)
In-Reply-To: <8F16BDCC98E64841857E711110AF5EDD774785299B@EXMBX01.wealthcraft.local>
References: <4A488522.9000003@eintr.org>	<185945640906290212t54a0ea15lcf1d6595f48d833a@mail.gmail.com>	<269388e30907151554l17b69d6fv1147a10fac36833f@mail.gmail.com>	<8F16BDCC98E64841857E711110AF5EDD774785294A@EXMBX01.wealthcraft.local>	<4A6F9904.5070209@lshift.net>
	<8F16BDCC98E64841857E711110AF5EDD774785299B@EXMBX01.wealthcraft.local>
Message-ID: <4A6FADC8.9030909@lshift.net>

Wilson,

Wilson Ke wrote:
> I declare exchange and queue are durable, and met all what you said. Now 
> I post my code lines to below,

I think I have spotted the problem:

Your PublishMessage function has "props.DeliveryMode = 2", which is
correct. But that props object then isn't used for anything, so its
settings are ignored.


Regards,

Matthias



From raykrueger at gmail.com  Wed Jul 29 03:15:45 2009
From: raykrueger at gmail.com (Ray Krueger)
Date: Tue, 28 Jul 2009 21:15:45 -0500
Subject: [rabbitmq-discuss] Problems with the Java client and clustering
Message-ID: <5b2d38840907281915q52d84521r83bd0f8386c5a80d@mail.gmail.com>

I am currently evaluating RabbitMQ and the Java client. RabbitMQ is
absolutely awesome. The Java client though is giving me a lot of
grief.

The first thing I'm trying to deal with is trying to handle failure
gracefully. Currently I'm testing a pubsub model with a publisher
publishing to a topic exchange, and one consumer binding a
client-named queue to the exchange. The problem I keep seeing is that
after I stop_app and start_app on the primary node in the cluster, the
Consumer refuses to reconnect...

The Consumer works great until I bounce the primary "rabbit" node.
When I try to connect the Consumer after that I get this error.
{#method<channel.close>(reply-code=404,reply-text=NOT_FOUND - no queue
'q1' in vhost '/',class-id=60,method-id=20),null,""}

What am I doing wrong?

Sorry for two questions in one email here, but am I correct in
assuming that I should pass an array of addresses to the
ConnectionFactory when using a cluster?
My current cluster looks like...

Status of node 'rabbit at Rays-MacBook-Pro' ...
[{running_applications,[{rabbit,"RabbitMQ","1.6.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.9"},
                        {os_mon,"CPO  CXC 138 46","2.2.1"},
                        {sasl,"SASL  CXC 138 11","2.1.6"},
                        {stdlib,"ERTS  CXC 138 10","1.16.1"},
                        {kernel,"ERTS  CXC 138 10","2.13.1"}]},
 {nodes,['rabbit_1 at Rays-MacBook-Pro','rabbit at Rays-MacBook-Pro',
         'rabbit_2 at Rays-MacBook-Pro']},
 {running_nodes,['rabbit_1 at Rays-MacBook-Pro','rabbit_2 at Rays-MacBook-Pro',
                 'rabbit at Rays-MacBook-Pro']}]
...done.

I'm currently passing the following Address[] to the ConnectionFactory...
        Address[] addresses = {
                new Address("localhost", 5672),
                new Address("localhost", 5673),
                new Address("localhost", 5674)
        };

Is this correct?



From wilson.ke at wealthcraft.com  Wed Jul 29 03:34:51 2009
From: wilson.ke at wealthcraft.com (Wilson Ke)
Date: Wed, 29 Jul 2009 10:34:51 +0800
Subject: [rabbitmq-discuss] Durable queues and high availability	(broker
 failage)
In-Reply-To: <4A6FADC8.9030909@lshift.net>
References: <4A488522.9000003@eintr.org>
	<185945640906290212t54a0ea15lcf1d6595f48d833a@mail.gmail.com>
	<269388e30907151554l17b69d6fv1147a10fac36833f@mail.gmail.com>
	<8F16BDCC98E64841857E711110AF5EDD774785294A@EXMBX01.wealthcraft.local>
	<4A6F9904.5070209@lshift.net>
	<8F16BDCC98E64841857E711110AF5EDD774785299B@EXMBX01.wealthcraft.local>
	<4A6FADC8.9030909@lshift.net>
Message-ID: <8F16BDCC98E64841857E711110AF5EDD77478529A9@EXMBX01.wealthcraft.local>

Hi Matthias,
	I follow your correct suggestion, and settle my trouble, thanks very much!

Best Regards,
Wilson

-----Original Message-----
From: Matthias Radestock [mailto:matthias at lshift.net] 
Sent: 2009?7?29? 10:03
To: Wilson Ke
Cc: 'rabbitmq-discuss at lists.rabbitmq.com'
Subject: Re: [rabbitmq-discuss] Durable queues and high availability (broker failage)

Wilson,

Wilson Ke wrote:
> I declare exchange and queue are durable, and met all what you said. Now 
> I post my code lines to below,

I think I have spotted the problem:

Your PublishMessage function has "props.DeliveryMode = 2", which is
correct. But that props object then isn't used for anything, so its
settings are ignored.


Regards,

Matthias

From bmurphy1976 at gmail.com  Wed Jul 29 03:52:41 2009
From: bmurphy1976 at gmail.com (Bryan Murphy)
Date: Tue, 28 Jul 2009 21:52:41 -0500
Subject: [rabbitmq-discuss] Diagnosing a problem
In-Reply-To: <4A6FA380.3030205@lshift.net>
References: <7fd310d10907220748y18419ff8gc3fa4d6d326b6e5c@mail.gmail.com>
	<4A674363.7010804@lshift.net>
	<7fd310d10907221305g3e6d5edag351877f56c74dd57@mail.gmail.com>
	<4A6FA380.3030205@lshift.net>
Message-ID: <7fd310d10907281952v1d642fd5n7d81d3d1273871aa@mail.gmail.com>

I've still got the folder but it does not have a .previous file in it.  I
played around with it a bit, but couldn't get it to come up.  Unfortunately,
the instance we ran it on is a bit outdated and I don't have any
corresponding server I can run it on that is an exact 1 to 1 duplicate of
the machine where this occurred.  I don't know if that matters.  I could try
again on the other original machine, but it's a production box so I'm
inclined not to... :)
Bryan

On Tue, Jul 28, 2009 at 8:18 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Bryan,
>
> Bryan Murphy wrote:
>
>> This was in my rabbitmq startup error log: [...] starting persister
>> ...{"init terminating in
>> do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{{badmatch,{error,{{function_clause,[{rabbit_persister,replay,[{corrupt_log_file,"/var/lib/rabbitmq/mnesia/rabbit/rabbit_persister.LOG"},rabbit_persister,error,{psnapshot,1,{dict,0,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},192,193}]},{rabbit_persister,internal_load_snapshot,2},{rabbit_persister,init,1},{gen_server,init_it,6},{proc_lib,init_p,5}]},{child,undefined,rabbit_persister,{rabbit_persister,start_link,[]},transient,100,worker,[rabbit_persister]}}}},[{rabbit,start_child,1},{rabbit,'-start/2-fun-4-',0},{rabbit,'-start/2-fun-0-',1},{lists,foreach,2},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}}},[{init,start_it,1},{init,start_em,1}]}}
>>
>
> Interesting! A corrupted persister log file. I don't think we've seen that
> particular error before.
>
> Do you still have that file? Also, is there a .previous file in the same
> dir? If so, replacing the corrupted file with the .previous file would
> probably allow you to recover the messages.
>
> The replacing really should happen automatically. This has been discussed
> as a possible enhancement on the mailing list before, but the new persister
> is going to be ready soon, so we are not planning any enhancements to the
> old one.
>
> Regards,
>
> Matthias
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090728/1ebb7274/attachment.htm 

From juhani at juranki.com  Wed Jul 29 09:26:46 2009
From: juhani at juranki.com (=?ISO-8859-1?Q?Juhani_R=E4nkimies?=)
Date: Wed, 29 Jul 2009 11:26:46 +0300
Subject: [rabbitmq-discuss] Deploying rabbit in same node with other apps?
Message-ID: <e55356640907290126r6e4a14b7ja7f17fbe7bfa7a2c@mail.gmail.com>

Hi,

Is it safe to run rabbit in same node with other applications that use mnesia?

cheers,
-juhani



From alexis.richardson at gmail.com  Wed Jul 29 10:29:35 2009
From: alexis.richardson at gmail.com (Alexis Richardson)
Date: Wed, 29 Jul 2009 10:29:35 +0100
Subject: [rabbitmq-discuss] Deploying rabbit in same node with other
	apps?
In-Reply-To: <e55356640907290126r6e4a14b7ja7f17fbe7bfa7a2c@mail.gmail.com>
References: <e55356640907290126r6e4a14b7ja7f17fbe7bfa7a2c@mail.gmail.com>
Message-ID: <167204d20907290229jeb1ab1bof96898f4fe915ab@mail.gmail.com>

On Wed, Jul 29, 2009 at 9:26 AM, Juhani R?nkimies<juhani at juranki.com> wrote:
> Hi,
>
> Is it safe to run rabbit in same node with other applications that use mnesia?

You need to at the very least make sure there is no namespace clash
between RabbitMQ's mnesia tables, and those of the other apps.  We ran
into this problem with the XMPP adaptor, which loads RabbitMQ into
ejabberd.  Both Rabbit and ejabberd shared a table name which caused
problems.  This has now been fixed.

In general however, I would recommend running RabbitMQ on its own,
unless loads are very low, or you need to share data through mnesia.

alexis


> cheers,
> -juhani
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From niko.felger at googlemail.com  Wed Jul 29 10:54:51 2009
From: niko.felger at googlemail.com (Niko Felger)
Date: Wed, 29 Jul 2009 10:54:51 +0100
Subject: [rabbitmq-discuss] RabbitMQ load balancing/failover with LVS
In-Reply-To: <4A6F9FB6.2040307@lshift.net>
References: <c4f7626d0907270855v17e8c524g5f9caaa7cb434b8d@mail.gmail.com> 
	<4A6F9FB6.2040307@lshift.net>
Message-ID: <c4f7626d0907290254k485eba16pd6715e4edbd6e31c@mail.gmail.com>

Matthias,
Thanks for the reply!

On Wed, Jul 29, 2009 at 02:02, Matthias Radestock <matthias at lshift.net>wrote:

>
> So the consumer has two connections - one to lb1 and one to mq1? That seems
> weird.
>
> Also, you say that mq1 has a connection *to* the consumer - are you
> implying that your load-balancing reverses the direction of connection
> establishment?
>

I've done a bit more research on that, and it turns out our loadbalancer is
performing NAT, so that what looks like a second connection is actually the
other end of the connection established by the client.


> - After ~5-10 minutes without messages published to the queue, the
>> connection on the consumer goes away, and it establishes a new
>> connection to lb1. mq1 at this point still has an established to
>> connection to the consumer on the original port, in addition to the
>> new connection. Messages published to the queue in question are now no
>> longer delivered to the consumer.
>>
>
> Any idea what causes the original connection to get dropped?
>
> Also, what client are you using, and do you have heartbeats enabled on the
> AMQP connection?
>

>From what I've seen, the loadbalancer times out the connection, but fails to
close it on mq1. Why this happens, I don't know, but a colleague mentioend
he's seen LVS misbehaving like this in different setups before.

We're using this ruby library: http://github.com/tmm1/amqp/tree/master,
which implements
amqp-0.8. We haven't got heartbeats enabled, and as far as I can see, the
library doesn't expose a way to set it.


> I am pretty sure some folks have used RabbitMQ behind a load balancer.
> Rabbit doesn't do anything fancy at the TCP/IP level, so generally this
> should work ok.


I am by now fairly convinced that this is a misconfiguration/bug with the
loadbalancer per se. I will post more information as I get it.

Thanks for your help!
niko
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090729/6aa7eb8b/attachment.htm 

From mark.geib at echostar.com  Wed Jul 29 17:21:48 2009
From: mark.geib at echostar.com (Mark Geib)
Date: Wed, 29 Jul 2009 10:21:48 -0600
Subject: [rabbitmq-discuss] [rabbitmq-dscuss] Is it possible to recover from
	crash, "{corrupt_log_file, .}"
Message-ID: <4A70771C.2060307@echostar.com>

I have created durable queues and exchanges, and are publishing 
persistent message to test "robustness". I successufully stopped/started 
rabbitmq a number of times without data loss. Then I pulled power on the 
server and rabbitmq will not start. I get

cat /var/log/rabbitmq/startup_log
Starting all nodes...
Starting node rabbit at bilbo-gr...
RabbitMQ 1.5.5 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies 
LLC., and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node        : rabbit at bilbo-gr
log         : /var/log/rabbitmq/rabbit.log
sasl log    : /var/log/rabbitmq/rabbit-sasl.log
database dir: /var/lib/rabbitmq/mnesia/rabbit

starting database             ...done
starting core processes       ...done
starting recovery             ...done
starting persister            ...{"init terminating in 
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{bad_return,{{rabbit,start,[normal,[]]},{'EXIT',{{badmatch,{error,{{function_clause,[{rabbit_persister,replay,[{corrupt_log_file,"/var/lib/rabbitmq/mnesia/rabbit/rabbit_persister.LOG"},rabbit_persister,error,{psnapshot,1,{dict,0,16,16,8,80,48,{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]},{{[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[]}}},249901,253998}]},{rabbit_persister,internal_load_snapshot,2},{rabbit_persister,init,1},{gen_server,init_it,6},{proc_lib,init_p_do_apply,3}]},{child,undefined,rabbit_persister,{rabbit_persister,start_link,[]},transient,100,worker,[rabbit_persister]}}}},[{rabbit,start_child,1},{rabbit,'-start/2-fun-4-',0},{rabbit,'-start/2-fun-0-',1},{lists,foreach,2},{rabbit,start,2},{application_master,start_it_old,4}]}}}}}}},[{init,start_it,1},{init,start_em,1}]}}
geib at bilbo-gr:~$ cat /var/log/rabbitmq/startup_err
Erlang has closed
Error: {node_start_failed,normal}

Is it possible to recover from this state.?? Or, things I can do to make 
recovery from hard crash possible.??

Thanks,
Mark.



-- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD



From matthias at lshift.net  Wed Jul 29 17:57:07 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Jul 2009 17:57:07 +0100
Subject: [rabbitmq-discuss] [rabbitmq-dscuss] Is it possible to recover
 from	crash, "{corrupt_log_file, .}"
In-Reply-To: <4A70771C.2060307@echostar.com>
References: <4A70771C.2060307@echostar.com>
Message-ID: <4A707F63.4000603@lshift.net>

Mark,

Mark Geib wrote:
> I have created durable queues and exchanges, and are publishing 
> persistent message to test "robustness". I successufully stopped/started 
> rabbitmq a number of times without data loss. Then I pulled power on the 
> server and rabbitmq will not start. I get
> [...]
> {rabbit_persister,replay,[{corrupt_log_file,"/var/lib/rabbitmq/mnesia/rabbit/rabbit_persister.LOG"}, ...
> [...]
> Is it possible to recover from this state.??

There should be a .LOG.previous file in the same dir, and replacing the 
.LOG with the .LOG.previous file should work.

See these two threads:

http://www.nabble.com/Diagnosing-a-problem-to24607945.html
http://www.nabble.com/RabbitMQ-broker%27s-death-by-one-cut%3A-robustness-problem-to23253772.html


Regards,

Matthias.



From ryan at acceleration.net  Wed Jul 29 18:07:27 2009
From: ryan at acceleration.net (Ryan Davis)
Date: Wed, 29 Jul 2009 13:07:27 -0400
Subject: [rabbitmq-discuss] is there a good way to upgrade my broker without
	losing messages?
Message-ID: <4A7081CF.8020901@acceleration.net>

I'm currently running an older version of RabbitMQ (1.5.1) on windows,
using a single broker for my lightly-loaded system.  All
publishers/consumers are pointed to that broker.  I want to upgrade to
1.6, but don't want to lose any messages.  I cannot turn off all
publishers (messages come from external sources).   I've read that the
db schema changes, and the old db essentially gets replaced.  This means
even durable messages will get discarded, right?

I've come up with a few ideas involving putting up another RabbitMQ
instance (point publishers at the new broker, let my consumers empty the
old broker, point consumers at the new broker), but I was wondering: is
there easier way to do it?  How do people currently handle upgrades?

Thanks,

-- 
Ryan Davis
Acceleration.net
Director of Programming Services
2831 NW 41st street, suite B
Gainesville, FL 32606

Office: 352-335-6500 x 124
Fax: 352-335-6506




From mark.geib at echostar.com  Wed Jul 29 18:18:36 2009
From: mark.geib at echostar.com (Mark Geib)
Date: Wed, 29 Jul 2009 11:18:36 -0600
Subject: [rabbitmq-discuss] [rabbitmq-dscuss] Is it possible to recover
 from	crash, "{corrupt_log_file, .}"
In-Reply-To: <4A707F63.4000603@lshift.net>
References: <4A70771C.2060307@echostar.com> <4A707F63.4000603@lshift.net>
Message-ID: <4A70846C.1000706@echostar.com>

Matthias,

That did it, thanks. I will keep trying to break things...

Mark.

Matthias Radestock wrote:
> Mark,
> 
> Mark Geib wrote:
>> I have created durable queues and exchanges, and are publishing 
>> persistent message to test "robustness". I successufully 
>> stopped/started rabbitmq a number of times without data loss. Then I 
>> pulled power on the server and rabbitmq will not start. I get
>> [...]
>> {rabbit_persister,replay,[{corrupt_log_file,"/var/lib/rabbitmq/mnesia/rabbit/rabbit_persister.LOG"}, 
>> ...
>> [...]
>> Is it possible to recover from this state.??
> 
> There should be a .LOG.previous file in the same dir, and replacing the 
> .LOG with the .LOG.previous file should work.
> 
> See these two threads:
> 
> http://www.nabble.com/Diagnosing-a-problem-to24607945.html
> http://www.nabble.com/RabbitMQ-broker%27s-death-by-one-cut%3A-robustness-problem-to23253772.html 
> 
> 
> 
> Regards,
> 
> Matthias.
> 

-- 
Principal Engineer
Cheyenne Software Engineering
mark.geib at echostar.com / 35-215

PGP fingerprint:6DFC 389D 9796 0188 92E5 58F5 34C5 6B47 D091 76FD



From rich.kim at db.com  Wed Jul 29 19:21:09 2009
From: rich.kim at db.com (Rich Kim)
Date: Wed, 29 Jul 2009 14:21:09 -0400
Subject: [rabbitmq-discuss] Errors Restarting a Stopped Node in Cluster
Message-ID: <OF59377A64.9CE860EF-ON85257602.006310E9-85257602.0064CAC0@db.com>

Hi,

I have a cluster of 3 rabbitmq servers, when I attempt to restart one of 
these nodes, I am unable to bring it back up:

node        : rabbit at nygstsappu1
log         : 
/export/home/common/repository/rabbitmq/current/log/rabbit.log
sasl log    : 
/export/home/common/repository/rabbitmq/current/log/rabbit-sasl.log
database dir: 
/export/home/common/repository/rabbitmq/current/mnesia/rabbit

starting database             ...Erlang has closed
{"init terminating in 
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_durable_route,rabbit_durable_exchange,rabbit_durable_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}

Only after deleting the mnesia directory am I able to restart the node. Is 
there something I'm missing with regards to restoring a node back into a 
cluster?

Regards,
Richard

________________________
Richard Kim
Deutsche Bank Americas
Global Banking, New York
rich.kim at db.com
P: +1 212.250.4984

---
This communication may contain confidential and/or privileged information.
If you are not the intended recipient (or have received this communication
in error) please notify the sender immediately and destroy this
communication. Any unauthorized copying, disclosure or distribution of the
material in this communication is strictly forbidden.

Deutsche Bank does not render legal or tax advice, and the information
contained in this communication should not be regarded as such.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090729/fd629e80/attachment.htm 

From matthias at lshift.net  Wed Jul 29 19:47:50 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Jul 2009 19:47:50 +0100
Subject: [rabbitmq-discuss] Errors Restarting a Stopped Node in Cluster
In-Reply-To: <OF59377A64.9CE860EF-ON85257602.006310E9-85257602.0064CAC0@db.com>
References: <OF59377A64.9CE860EF-ON85257602.006310E9-85257602.0064CAC0@db.com>
Message-ID: <4A709956.2040607@lshift.net>

Richard,

Rich Kim wrote:
> I have a cluster of 3 rabbitmq servers, when I attempt to restart one of 
> these nodes, I am unable to bring it back up.

Can you post a transcript of the commands for starting the nodes, 
setting up the cluster, stopping the node, and then restarting it?

Generally, restarting a single node should work w/o any problems, so I 
suspect there is some peculiarity about your cluster setup or the way 
you restart the nodes. The transcript should make it obvious if that is 
the case.

When shutting down and restarting *multiple* nodes, the order can be 
important, depending on how exactly the cluster was configured.


Regards,

Matthias.



From scott.brooks at epicadvertising.com  Wed Jul 29 19:55:43 2009
From: scott.brooks at epicadvertising.com (Scott Brooks)
Date: Wed, 29 Jul 2009 14:55:43 -0400
Subject: [rabbitmq-discuss] Patch submission
Message-ID: <C289E9AE-8218-4362-9F40-AC24A8076FA5@epicadvertising.com>

I've got some patches for rabbitmq-erlang-client, and rabbitmq-c that  
I'll be cleaning up, and looking to submit.

The FAQ doesn't really go into details as far as the recommended  
submission process.  Is that defined anywhere?

Thanks

---------------------
Scott Brooks
Web Developer
Epic Advertising - New York, Toronto, San Francisco, London
www.EpicAdvertising.com
60 Columbia Way, Suite 310
Markham, ON L3R 0C9
(905) 946-0300 x2356 - phone
(888) 666-3120 - fax
scott.brooks at epicadvertising.com




From pekenney at gmail.com  Wed Jul 29 20:00:36 2009
From: pekenney at gmail.com (Patrick Kenney)
Date: Wed, 29 Jul 2009 12:00:36 -0700
Subject: [rabbitmq-discuss] Trying to do a simple subscription returns
	message too long error... (RabbitMq.Net)
In-Reply-To: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>
Message-ID: <3a5f03340907291200j40f91712ne6fe28aa3ce5191f@mail.gmail.com>

anybody see anything possible in the code snip below that could cause the
message to long error displayed at the bottom? note, this error is occurring
on subscribe, not publish...

I can reproduce it on a xp pro workstation and a windows server 2003 box...

<snip>
//winform app
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Collections;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.ServiceModel.Web;
using System.ServiceModel;
using System.ServiceModel.Channels;
using System.ServiceModel.Description;

using Test.Base;
using Test.Entity;

using RabbitMQ.ServiceModel;
using RabbitMQ.Client;

namespace RabbitMqPubSub1
{
    public partial class frmMain : Form
    {
        ServiceHost dispatcherHost = null;
        ServiceHost subscriberHost = null;

        string m_strSubscriber = string.Empty;
        string m_strDispatcher = string.Empty;
        string m_strSubscriberHost = string.Empty;

        public frmMain()
        {
            InitializeComponent();
        }

        /// <summary>
        /// Publish Test Message
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void btnPub_Click(object sender, EventArgs e)
        {
            try
            {
                using (ChannelFactory<IDispatcherService> scf =
GetDispatcherCF())
                {
                    IDispatcherService client = scf.CreateChannel();
                    Test.Entity.Message msg = new Test.Entity.Message();
                    msg.Source = txtPubContent.Text;
                    msg.Contexts.Add("c1");

                    for (int i = 0; i < 1000; i++) //change seed for generic
testing...
                    {
                        client.Publish(msg);
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }

        /// <summary>
        /// Host The Dispatcher
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void btnHostDispatcher_Click(object sender, EventArgs e)
        {
            if (txtHostDispatcher.Text == string.Empty)
            {
                m_strDispatcher = "amqp:///dispatcher";
            }
            else
            {
                m_strDispatcher = txtHostDispatcher.Text;
            }

            dispatcherHost = new
ServiceHost(typeof(Dispatcher.DispatcherService), new Uri("soap.amqp:///"));
            dispatcherHost.AddServiceEndpoint(typeof(IDispatcherService),
new RabbitMQBinding(new Uri("amqp://localhost:5672/"), Protocols.AMQP_0_8),
m_strDispatcher);
            dispatcherHost.CloseTimeout = TimeSpan.FromMinutes(10);

            dispatcherHost.Open();
        }

        private ChannelFactory<IDispatcherService> GetDispatcherCF()
        {
            if (txtHostDispatcher.Text == string.Empty)
            {
                m_strDispatcher = "amqp:///dispatcher";
            }
            else
            {
                m_strDispatcher = txtHostDispatcher.Text;
            }

            ChannelFactory<IDispatcherService> scf;

            //The RabbitMQBinding instantiation is where the error is being
raised...
            scf = new ChannelFactory<IDispatcherService>(
                new RabbitMQBinding(
                    new Uri("amqp://localhost:5672/"),
                        Protocols.AMQP_0_8),
                            new EndpointAddress(m_strDispatcher));

            return scf;
        }

        /// <summary>
        /// Subscribe to queue
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void btnSubscribe_Click(object sender, EventArgs e)
        {
            if (txtHostSubscriberAddress.Text == string.Empty)
            {
                m_strSubscriber = "amqp:///subscriber";
            }
            else
            {
                m_strSubscriber = txtHostSubscriberAddress.Text;
            }

            try
            {
                using (ChannelFactory<IDispatcherService> scf =
GetDispatcherCF())
                {
                    IDispatcherService client = scf.CreateChannel();
                    client.Subscribe(new
Test.Base.SubscriberInfo(m_strSubscriber, "c1", "c2"));
                }
            }

            catch (Exception ex)
            {
                throw ex;
            }
        }

        /// <summary>
        /// Host Subscriber
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void btnHostSubscriber_Click(object sender, EventArgs e)
        {
            if (txtHostSubscriberAddress.Text == string.Empty)
            {
                m_strSubscriberHost = "amqp:///subscriber";
            }
            else
            {
                m_strSubscriberHost = txtHostSubscriberAddress.Text;
            }

            //The ServiceHost must specify a base or absolute endpoint
address under the soap.amqp scheme.
            //An endpoint should then be added to the service using the
RabbitMQBinding.
            subscriberHost = new
ServiceHost(typeof(Subscriber.SubscriberService), new Uri("soap.amqp:///"));
            subscriberHost.AddServiceEndpoint(typeof(ISubscriberService),
new RabbitMQBinding(new Uri("amqp://localhost:5672/"), Protocols.AMQP_0_8),
m_strSubscriberHost);
            subscriberHost.CloseTimeout = TimeSpan.FromMinutes(10);

            subscriberHost.Open();
        }

        /// <summary>
        /// Create Queue
        /// </summary>
        /// <param name="sender"></param>
        /// <param name="e"></param>
        private void btnCreateQueue_Click(object sender, EventArgs e)
        {
            string address = "localhost:5672";//"amqp:///";
            string strQueue = txtQueueName.Text;
            bool durable = true;
            string exchange = string.Empty;
            string routingKey = string.Empty;

            using (IConnection connection = new
ConnectionFactory().CreateConnection(address))
            {
                using (IModel model = connection.CreateModel())
                {
                    strQueue = model.QueueDeclare(strQueue, durable);

                    model.QueueBind(strQueue, exchange, routingKey, false,
null);
                }
            }
        }
    }
}

</snip>

RE:
On Thu, Jul 23, 2009 at 9:13 AM, .... wrote:

> although there are no messages any longer then "test message" in the
> applicable queue...
>
> the following is returned...
>
> The AMQP operation was interrupted: AMQP close-reason, initiated by
> Library, code=311, text="The body of a message (18446744073709551575 bytes)
> was too long.", classId=0, methodId=0,
> cause=RabbitMQ.Client.Impl.BodyTooLongException: The body of a message
> (18446744073709551575 bytes) was too long.
>    at RabbitMQ.Client.Impl.ContentHeaderBase.ReadFrom(Int32 channelNumber,
> NetworkBinaryReader reader) in
> C:\RabbitMQ.Client\RabbitMQ\Client\Impl\ContentHeaderBase.cs:line 23
>    at RabbitMQ.Client.Impl.CommandAssembler.HandleFrame(Frame f) in
> C:\RabbitMQ.Client\RabbitMQ\Client\Impl\CommandAssembler.cs:line 53
>    at RabbitMQ.Client.Impl.Session.HandleFrame(Frame frame) in
> C:\RabbitMQ.Client\RabbitMQ\Client\Impl\Session.cs:line 16
>    at RabbitMQ.Client.Impl.ConnectionBase.MainLoopIteration() in
> C:\RabbitMQ.Client\RabbitMQ\Client\Impl\ConnectionBase.cs:line 434
>    at RabbitMQ.Client.Impl.ConnectionBase.MainLoop() in
> C:\RabbitMQ.Client\RabbitMQ\Client\Impl\ConnectionBase.cs:line 388
>
> suggestions, comments, assistance?
>
> thanks in advance.
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090729/e3b0e115/attachment.htm 

From matthias at lshift.net  Wed Jul 29 20:01:30 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Jul 2009 20:01:30 +0100
Subject: [rabbitmq-discuss] Patch submission
In-Reply-To: <C289E9AE-8218-4362-9F40-AC24A8076FA5@epicadvertising.com>
References: <C289E9AE-8218-4362-9F40-AC24A8076FA5@epicadvertising.com>
Message-ID: <4A709C8A.6000106@lshift.net>

Scott,

Scott Brooks wrote:
> I've got some patches for rabbitmq-erlang-client, and rabbitmq-c that  
> I'll be cleaning up, and looking to submit.

Great! Looking forward to see what you've done.

> The FAQ doesn't really go into details as far as the recommended  
> submission process.  Is that defined anywhere?

Please send the patches to this list.


Regards,

Matthias.



From rich.kim at db.com  Wed Jul 29 20:18:55 2009
From: rich.kim at db.com (Rich Kim)
Date: Wed, 29 Jul 2009 15:18:55 -0400
Subject: [rabbitmq-discuss] Errors Restarting a Stopped Node in Cluster
In-Reply-To: <4A709956.2040607@lshift.net>
Message-ID: <OF1DAB0726.1B708286-ON85257602.00691034-85257602.006A149E@db.com>

Hi Matthias,

I've have the cluster setup on auto-configuration, all 3 nodes were up & 
running at the time I brought down the first node.

rabbitmqctl status
Status of node rabbit at nygstsappu1 ...
[{running_applications,[{rabbit,"RabbitMQ","1.6.0"},
                        {mnesia,"MNESIA  CXC 138 12","4.4.10"},
                        {os_mon,"CPO  CXC 138 46","2.2.2"},
                        {sasl,"SASL  CXC 138 11","2.1.6"},
                        {stdlib,"ERTS  CXC 138 10","1.16.2"},
                        {kernel,"ERTS  CXC 138 10","2.13.2"}]},
 {nodes,[rabbit at nygstsappu1,rabbit at nygstsappu2,rabbit at nygstsappd1]},
 
{running_nodes,[rabbit at nygstsappd1,rabbit at nygstsappu1,rabbit at nygstsappu2]}]
...done.

rabbitmqctl stop_app
Stopping node rabbit at nygstsappu1 ...
Erlang has closed
...done.

rabbitmqctl stop
Stopping and halting node rabbit at nygstsappu1 ...

rabbitmq-server &

RabbitMQ 1.6.0 (AMQP 8-0)
Copyright (C) 2007-2009 LShift Ltd., Cohesive Financial Technologies LLC., 
and Rabbit Technologies Ltd.
Licensed under the MPL.  See http://www.rabbitmq.com/

node        : rabbit at nygstsappu1
log         : 
/export/home/common/repository/rabbitmq/current/log/rabbit.log
sasl log    : 
/export/home/common/repository/rabbitmq/current/log/rabbit-sasl.log
database dir: 
/export/home/common/repository/rabbitmq/current/mnesia/rabbit

starting database             ...Erlang has closed
{"init terminating in 
do_boot",{{nocatch,{error,{cannot_start_application,rabbit,{{timeout_waiting_for_tables,[rabbit_user,rabbit_user_permission,rabbit_vhost,rabbit_config,rabbit_durable_route,rabbit_durable_exchange,rabbit_durable_queue]},{rabbit,start,[normal,[]]}}}}},[{init,start_it,1},{init,start_em,1}]}}





________________________
Richard Kim
Deutsche Bank Americas
Global Banking, New York
rich.kim at db.com
P: +1 212.250.4984



Matthias Radestock <matthias at lshift.net> 
07/29/2009 02:47 PM

To
Rich Kim/db/dbcom at DBAmericas
cc
rabbitmq-discuss at lists.rabbitmq.com
Subject
Re: [rabbitmq-discuss] Errors Restarting a Stopped Node in Cluster






Richard,

Rich Kim wrote:
> I have a cluster of 3 rabbitmq servers, when I attempt to restart one of 

> these nodes, I am unable to bring it back up.

Can you post a transcript of the commands for starting the nodes, 
setting up the cluster, stopping the node, and then restarting it?

Generally, restarting a single node should work w/o any problems, so I 
suspect there is some peculiarity about your cluster setup or the way 
you restart the nodes. The transcript should make it obvious if that is 
the case.

When shutting down and restarting *multiple* nodes, the order can be 
important, depending on how exactly the cluster was configured.


Regards,

Matthias.



---
This communication may contain confidential and/or privileged information.
If you are not the intended recipient (or have received this communication
in error) please notify the sender immediately and destroy this
communication. Any unauthorized copying, disclosure or distribution of the
material in this communication is strictly forbidden.

Deutsche Bank does not render legal or tax advice, and the information
contained in this communication should not be regarded as such.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090729/74b24fb6/attachment.htm 

From matthias at lshift.net  Wed Jul 29 21:43:19 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Wed, 29 Jul 2009 21:43:19 +0100
Subject: [rabbitmq-discuss] Errors Restarting a Stopped Node in Cluster
In-Reply-To: <OF1DAB0726.1B708286-ON85257602.00691034-85257602.006A149E@db.com>
References: <OF1DAB0726.1B708286-ON85257602.00691034-85257602.006A149E@db.com>
Message-ID: <4A70B467.5040300@lshift.net>

Richard,

Rich Kim wrote:
> I've have the cluster setup on auto-configuration,

what's in the cluster config file of the three nodes?

Also, do any of the nodes have a file
 
/export/home/common/repository/rabbitmq/current/mnesia/rabbit/cluster_nodes.config

?

You said that the node came up after removing the mnesia dir. Did it end 
up clustering itself with the other nodes?


Here is another thought ... the above dir isn't by any chance on an NFS 
mount that is shared by all machines, is it? That certainly would cause 
all sorts of problems.


I am attaching a transcript of a session where I tried to reproduce the 
problem but failed. The setup isn't quite the same as yours - I am 
running all nodes on the same machine and I am using a recent 
development snapshot - but that shouldn't matter.

See whether you can spot any significant differences to what you are doing.

If you can produce a similar transcript that exhibits the problem then I 
can try to replicate your setup more closely.


Regards,

Matthias.
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: cluster_transcript.txt
Url: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090729/0f3ba504/attachment.txt 

From tonyg at lshift.net  Wed Jul 29 22:42:27 2009
From: tonyg at lshift.net (Tony Garnock-Jones)
Date: Wed, 29 Jul 2009 22:42:27 +0100
Subject: [rabbitmq-discuss] Trying to do a simple subscription returns
 message too long error... (RabbitMq.Net)
In-Reply-To: <3a5f03340907291200j40f91712ne6fe28aa3ce5191f@mail.gmail.com>
References: <3a5f03340907230913n47a8d94fvc87de32dea4044a@mail.gmail.com>
	<3a5f03340907291200j40f91712ne6fe28aa3ce5191f@mail.gmail.com>
Message-ID: <4A70C243.8020608@lshift.net>

Hi Patrick,

Patrick Kenney wrote:
>     (18446744073709551575 bytes) was too long.

Hmmm! That number converts to hex as 0xffffffffffffffd7. Minus 41? 
Weird. Points to a signed/unsigned issue somewhere - or a reassembly 
problem with 64bit quantities.


Tony



From matthias at lshift.net  Thu Jul 30 03:07:06 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 30 Jul 2009 03:07:06 +0100
Subject: [rabbitmq-discuss] queue is locked exclusively
In-Reply-To: <03FC0D29D4E88943AB7420C524BE8489027C397C@mllnc20mb056.emea.win.ml.com>
References: <03FC0D29D4E88943AB7420C524BE8489027C397C@mllnc20mb056.emea.win.ml.com>
Message-ID: <4A71004A.8050008@lshift.net>

Rajesh,

Reddy, Rajesh (GPT EMEA) wrote:
> Iam using the RabbitMQ client for .NET . I need to re subscribe to the 
> queue from my client if the connection drops or queue deletes.
> 
> Iam getting the following error when trying to resubscribe to the queue.
> [...] "RESOURCE_LOCKED - cannot obtain exclusive access to 
> locked queue 'reddyraj_ELONW124027_4244_20090721-091729_PM' in vhost 
> '/'" [...]
> Is there a way to identify if the queue is locked exclusively?

Exclusive queues are owned by the connection that created them. The 
general idea is for that (and *only* that) connection to subscribe 
consumer(s) to the queue. Exclusive queues are deleted when the 
connection goes away.

May I ask why you declare the queue as exclusive? Wouldn't a 
non-exclusive queue fit your use case better?


Regards,

Matthias



From matthias at lshift.net  Thu Jul 30 03:16:19 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 30 Jul 2009 03:16:19 +0100
Subject: [rabbitmq-discuss] Problems with the Java client and clustering
In-Reply-To: <5b2d38840907281915q52d84521r83bd0f8386c5a80d@mail.gmail.com>
References: <5b2d38840907281915q52d84521r83bd0f8386c5a80d@mail.gmail.com>
Message-ID: <4A710273.9000907@lshift.net>

Ray,

Ray Krueger wrote:
> The first thing I'm trying to deal with is trying to handle failure
> gracefully. Currently I'm testing a pubsub model with a publisher
> publishing to a topic exchange, and one consumer binding a
> client-named queue to the exchange. The problem I keep seeing is that
> after I stop_app and start_app on the primary node in the cluster, the
> Consumer refuses to reconnect...
> 
> The Consumer works great until I bounce the primary "rabbit" node.
> When I try to connect the Consumer after that I get this error.
> {#method<channel.close>(reply-code=404,reply-text=NOT_FOUND - no queue
> 'q1' in vhost '/',class-id=60,method-id=20),null,""}
> 
> What am I doing wrong?

Looks like the queue 'q1' is no longer there. I can think of several 
reasons for that, but the most likely are that either you didn't declare 
the queue as durable (and it resided on the node you bounced and hence 
got lots in the restart), or it was declared as exclusive (and resided 
on a different node but got deleted due to the consumer disconnecting).

> Sorry for two questions in one email here, but am I correct in
> assuming that I should pass an array of addresses to the
> ConnectionFactory when using a cluster?

Yes, assuming you want the client to try them in turn until it finds one 
that it can connect to.

Regards,

Matthias.



From femtowin at gmail.com  Thu Jul 30 06:27:49 2009
From: femtowin at gmail.com (femto Zheng)
Date: Thu, 30 Jul 2009 13:27:49 +0800
Subject: [rabbitmq-discuss] about the clustering of rabbitmq
Message-ID: <91170ee40907292227y35b3531wee18ff83f4cb3d22@mail.gmail.com>

Hi all, I'm checking out the clustering documentation of rabbitmq,
I have some question about load-balancing
it says
'Nodes in a cluster perform some basic load balancing by responding to
client connection attempts with AMQP's connection.redirect method as
appropriate',
so kindof, the routing logic is built into client, when client connects
to a server,if the server sends back a redirect, the client can freely
connects to the new server,
and if that server is down, the client would just tcp-socket time out
and can't connect to any server,
then there is not middle-man load balancer like http normally does,
is that correct?
Thanks.



From juhani at juranki.com  Thu Jul 30 07:30:01 2009
From: juhani at juranki.com (=?ISO-8859-1?Q?Juhani_R=E4nkimies?=)
Date: Thu, 30 Jul 2009 09:30:01 +0300
Subject: [rabbitmq-discuss] Deploying rabbit in same node with other
	apps?
In-Reply-To: <167204d20907290229jeb1ab1bof96898f4fe915ab@mail.gmail.com>
References: <e55356640907290126r6e4a14b7ja7f17fbe7bfa7a2c@mail.gmail.com>
	<167204d20907290229jeb1ab1bof96898f4fe915ab@mail.gmail.com>
Message-ID: <e55356640907292330k66eda6fbn9478c1b842e4719@mail.gmail.com>

On Wed, Jul 29, 2009 at 12:29 PM, Alexis
Richardson<alexis.richardson at gmail.com> wrote:
> On Wed, Jul 29, 2009 at 9:26 AM, Juhani R?nkimies<juhani at juranki.com> wrote:
>> Hi,
>>
>> Is it safe to run rabbit in same node with other applications that use mnesia?
>
> You need to at the very least make sure there is no namespace clash
> between RabbitMQ's mnesia tables, and those of the other apps.

Do all RabbitMQ tables start with 'rabbit_'?

-juhani



From matthias at lshift.net  Thu Jul 30 10:26:18 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 30 Jul 2009 10:26:18 +0100
Subject: [rabbitmq-discuss] Deploying rabbit in same node with other
	apps?
In-Reply-To: <e55356640907292330k66eda6fbn9478c1b842e4719@mail.gmail.com>
References: <e55356640907290126r6e4a14b7ja7f17fbe7bfa7a2c@mail.gmail.com>	<167204d20907290229jeb1ab1bof96898f4fe915ab@mail.gmail.com>
	<e55356640907292330k66eda6fbn9478c1b842e4719@mail.gmail.com>
Message-ID: <4A71673A.1030704@lshift.net>

Juhani,

Juhani R?nkimies wrote:
> Do all RabbitMQ tables start with 'rabbit_'?

Yes, as of release 1.6.0.


Matthias



From juhani at juranki.com  Thu Jul 30 20:03:09 2009
From: juhani at juranki.com (=?ISO-8859-1?Q?Juhani_R=E4nkimies?=)
Date: Thu, 30 Jul 2009 22:03:09 +0300
Subject: [rabbitmq-discuss] Erlang client: review request
Message-ID: <e55356640907301203m65c1a46akb14e0fd87b23519b@mail.gmail.com>

Hi,

I'm trying to get up and running with erlang client, and wrote a bot
for the rabbitmq-http2 chat demo as an excercise.
It'd be great if someone could have a look to see if I'm on the right track.

http://github.com/juranki/chatbot/blob/9734b5241591b8b1c75a0b57aa50a9a11412b413/src/chatbot_srv.erl


cheers,
-juhani



From digitalwarfare at gmail.com  Thu Jul 30 20:22:29 2009
From: digitalwarfare at gmail.com (Suhail Doshi)
Date: Thu, 30 Jul 2009 12:22:29 -0700
Subject: [rabbitmq-discuss] erlang-client issue, discarding content?
Message-ID: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com>

My producer essentially dies arbitrarily because of this:

Discarding content bearing method ({'basic.publish',1,<<"records">>,
                                       <<"event">>,false,false})


Any ideas?

Sincerely,

Suhail Doshi


-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090730/267c2344/attachment.htm 

From digitalwarfare at gmail.com  Thu Jul 30 20:24:10 2009
From: digitalwarfare at gmail.com (Suhail Doshi)
Date: Thu, 30 Jul 2009 12:24:10 -0700
Subject: [rabbitmq-discuss] erlang-client issue, discarding content?
In-Reply-To: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com>
References: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com>
Message-ID: <376f3e6f0907301224y6a427284m245bf922eb5638e1@mail.gmail.com>

When that happens, my swap goes up, the CPU load goes up, consumers are not
consuming anything. Very peculiar.
Suhail

On Thu, Jul 30, 2009 at 12:22 PM, Suhail Doshi <digitalwarfare at gmail.com>wrote:

> My producer essentially dies arbitrarily because of this:
>
> Discarding content bearing method ({'basic.publish',1,<<"records">>,
>                                        <<"event">>,false,false})
>
>
> Any ideas?
>
> Sincerely,
>
> Suhail Doshi
>
>
> --
> http://mixpanel.com
> Blog: http://blog.mixpanel.com
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090730/2de9a672/attachment.htm 

From digitalwarfare at gmail.com  Thu Jul 30 20:39:54 2009
From: digitalwarfare at gmail.com (Suhail Doshi)
Date: Thu, 30 Jul 2009 12:39:54 -0700
Subject: [rabbitmq-discuss] erlang-client issue, discarding content?
In-Reply-To: <376f3e6f0907301224y6a427284m245bf922eb5638e1@mail.gmail.com>
References: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com> 
	<376f3e6f0907301224y6a427284m245bf922eb5638e1@mail.gmail.com>
Message-ID: <376f3e6f0907301239u4600175al32b2b5f3b5af5137@mail.gmail.com>

Looking in my logs shows a large gap in time, in bold is where it is:
=INFO REPORT==== 30-Jul-2009::17:26:56 ===
    alarm_handler: {set,{system_memory_high_watermark,[]}}

=INFO REPORT==== 30-Jul-2009::17:26:57 ===
    alarm_handler: {clear,system_memory_high_watermark}

=INFO REPORT==== 30-Jul-2009::17:29:37 ===
    alarm_handler: {set,{system_memory_high_watermark,[]}}

=WARNING REPORT==== 30-Jul-2009::17:30:23 ===
exception on TCP connection <0.7304.42> from 127.0.0.1:48982
connection_closed_abruptly

=INFO REPORT==== 30-Jul-2009::17:30:25 ===
closing TCP connection <0.7304.42> from 127.0.0.1:48982

=INFO REPORT==== 30-Jul-2009::17:32:07 ===
    alarm_handler: {clear,system_memory_high_watermark}

=INFO REPORT==== 30-Jul-2009::19:00:09 ===
accepted TCP connection on 0.0.0.0:5672 from 127.0.0.1:38647

=INFO REPORT==== 30-Jul-2009::19:00:09 ===
starting TCP connection <0.13117.46> from 127.0.0.1:38647

=INFO REPORT==== 30-Jul-2009::19:00:33 ===
Rolling persister log to
"/var/lib/rabbitmq/mnesia/rabbit/rabbit_persister.LOG.previous"

On Thu, Jul 30, 2009 at 12:24 PM, Suhail Doshi <digitalwarfare at gmail.com>wrote:

> When that happens, my swap goes up, the CPU load goes up, consumers are not
> consuming anything. Very peculiar.
> Suhail
>
>
> On Thu, Jul 30, 2009 at 12:22 PM, Suhail Doshi <digitalwarfare at gmail.com>wrote:
>
>> My producer essentially dies arbitrarily because of this:
>>
>> Discarding content bearing method ({'basic.publish',1,<<"records">>,
>>                                        <<"event">>,false,false})
>>
>>
>> Any ideas?
>>
>> Sincerely,
>>
>> Suhail Doshi
>>
>>
>> --
>> http://mixpanel.com
>> Blog: http://blog.mixpanel.com
>>
>
>
>
> --
> http://mixpanel.com
> Blog: http://blog.mixpanel.com
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090730/fd0ac35a/attachment.htm 

From matthias at lshift.net  Thu Jul 30 20:46:55 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 30 Jul 2009 20:46:55 +0100
Subject: [rabbitmq-discuss] erlang-client issue, discarding content?
In-Reply-To: <376f3e6f0907301239u4600175al32b2b5f3b5af5137@mail.gmail.com>
References: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com>
	<376f3e6f0907301224y6a427284m245bf922eb5638e1@mail.gmail.com>
	<376f3e6f0907301239u4600175al32b2b5f3b5af5137@mail.gmail.com>
Message-ID: <4A71F8AF.2040406@lshift.net>

Suhail Doshi wrote:
> Looking in my logs shows a large gap in time, in bold is where it is:
> 
> =INFO REPORT==== 30-Jul-2009::17:26:56 ===
>     alarm_handler: {set,{system_memory_high_watermark,[]}}

This indicates that rabbit got close to running out of memory and told 
all connected clients to stop sending any more messages. Hence the 
"Discarding ..." message you were seeing in the erlang client. Your 
consumers should continue to receive messages, albeit slowly if rabbit 
is swapping.

Perhaps your consumers are not acknowledging received messages, causing 
them to keep piling up at the server?

I recommend checking the queue lengths/sizes with 'rabbitmqctl list_queues'.


Regards,

Matthias.



From digitalwarfare at gmail.com  Thu Jul 30 20:52:18 2009
From: digitalwarfare at gmail.com (Suhail Doshi)
Date: Thu, 30 Jul 2009 12:52:18 -0700
Subject: [rabbitmq-discuss] erlang-client issue, discarding content?
In-Reply-To: <4A71F8AF.2040406@lshift.net>
References: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com> 
	<376f3e6f0907301224y6a427284m245bf922eb5638e1@mail.gmail.com> 
	<376f3e6f0907301239u4600175al32b2b5f3b5af5137@mail.gmail.com> 
	<4A71F8AF.2040406@lshift.net>
Message-ID: <376f3e6f0907301252n773969abs220067999d1aed5f@mail.gmail.com>

mplivelog1 ~: sudo /usr/sbin/rabbitmqctl list_queues -p myqueue name
consumers messages messages_ready

Listing queues ...
storage 5 1 0
...done.

I currently have it running again after a restart and that's usually the
response I get, usually only 0-5 items in the queue, since it's being
processed.

When the error was occurring and I checked the queue, there were effectively
*zero* items in the queue according to that command I ran above in the
queue. In python I definitely do acknowledge items via:

self.channel.basic_ack(data.delivery_tag)

where self.channel is amqp.Connection(host=host, **info).channel()

Suhail

On Thu, Jul 30, 2009 at 12:46 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Suhail Doshi wrote:
>
>> Looking in my logs shows a large gap in time, in bold is where it is:
>>
>> =INFO REPORT==== 30-Jul-2009::17:26:56 ===
>>    alarm_handler: {set,{system_memory_high_watermark,[]}}
>>
>
> This indicates that rabbit got close to running out of memory and told all
> connected clients to stop sending any more messages. Hence the "Discarding
> ..." message you were seeing in the erlang client. Your consumers should
> continue to receive messages, albeit slowly if rabbit is swapping.
>
> Perhaps your consumers are not acknowledging received messages, causing
> them to keep piling up at the server?
>
> I recommend checking the queue lengths/sizes with 'rabbitmqctl
> list_queues'.
>
>
> Regards,
>
> Matthias.
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090730/72b8d8fa/attachment.htm 

From digitalwarfare at gmail.com  Thu Jul 30 20:54:40 2009
From: digitalwarfare at gmail.com (Suhail Doshi)
Date: Thu, 30 Jul 2009 12:54:40 -0700
Subject: [rabbitmq-discuss] erlang-client issue, discarding content?
In-Reply-To: <376f3e6f0907301252n773969abs220067999d1aed5f@mail.gmail.com>
References: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com> 
	<376f3e6f0907301224y6a427284m245bf922eb5638e1@mail.gmail.com> 
	<376f3e6f0907301239u4600175al32b2b5f3b5af5137@mail.gmail.com> 
	<4A71F8AF.2040406@lshift.net>
	<376f3e6f0907301252n773969abs220067999d1aed5f@mail.gmail.com>
Message-ID: <376f3e6f0907301254q7d87c1f2lb14db6123422dfb7@mail.gmail.com>

Here's the erlang module I use to send items to rabbit, it's largely adapted
from code open sourced online:
Dpaste of it: http://dpaste.com/73447/

-export([amqp_lifecycle/0, send_message/5, log/2]).

-include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit.hrl").
-include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit_framing.hrl").
-include("rabbitmq-erlang-client/include/amqp_client.hrl").

-record(rabbit_info, {channel, ticket, exchange, routing_key}).

amqp_lifecycle() ->
    User = "mixpanel",
    Password = "mixpanel0816",
    Realm = <<"mixpanel">>, %% virtual_host
    Connection = amqp_connection:start(User, Password, "127.0.0.1", Realm),
    Channel = amqp_connection:open_channel(Connection),
    Access = #'access.request'{
        realm = Realm,
        exclusive = false,
        passive = true,
        active = true,
        write = true,
        read = true
    },
    #'access.request_ok'{ticket = Ticket} = amqp_channel:call(Channel,
Access),

    Q = <<"storage">>,
    X = <<"records">>,
    BindKey = <<"event">>,

    QueueDeclare = #'queue.declare'{ticket = Ticket, queue = Q,
                                    passive = false, durable = true,
                                    exclusive = false, auto_delete = false,
                                    nowait = false, arguments = []},

    #'queue.declare_ok'{queue = Q} = amqp_channel:call(Channel,
QueueDeclare),

    ExchangeDeclare = #'exchange.declare'{ticket = Ticket,
                                          exchange = X, type = <<"direct">>,
                                          passive = false, durable = true,
                                          auto_delete = false, internal =
false,
                                          nowait = false, arguments = []},

    #'exchange.declare_ok'{} = amqp_channel:call(Channel, ExchangeDeclare),
    QueueBind = #'queue.bind'{ticket = Ticket,
                              queue = Q,
                              exchange = X,
                              routing_key = BindKey,
                              nowait = false, arguments = []},
    #'queue.bind_ok'{} = amqp_channel:call(Channel, QueueBind),

    RabbitInfo = #'rabbit_info'{
        channel = Channel,
        ticket = Ticket,
        exchange = X,
        routing_key = BindKey
    },
    RabbitInfo.

send_message(Channel, Ticket, X, RoutingKey, Payload) ->
    BasicPublish = #'basic.publish'{ticket = Ticket,
                                    exchange = X,
                                    routing_key = RoutingKey,
                                    mandatory = false,
                                    immediate = false},
    BasicProperties = amqp_util:basic_properties(),
    Properties = BasicProperties#'P_basic'{delivery_mode=2}, %% Persistence
plz
    Content = #content{class_id = 60,
         properties = Properties,
         properties_bin = none,
         payload_fragments_rev = [Payload]
        },
    amqp_channel:cast(Channel, BasicPublish, Content).

log(Key,Value) ->
    io:format("~p: ~p~n",[Key,Value]).


I do the following to send items to the queue:

event_queue_data(QueueInfo, Data) ->
    send_message(
        QueueInfo#'rabbit_info'.channel,
        QueueInfo#'rabbit_info'.ticket,
        QueueInfo#'rabbit_info'.exchange,
        QueueInfo#'rabbit_info'.routing_key,
        list_to_binary(Data)
    ),
    1.

On Thu, Jul 30, 2009 at 12:52 PM, Suhail Doshi <digitalwarfare at gmail.com>wrote:

> mplivelog1 ~: sudo /usr/sbin/rabbitmqctl list_queues -p myqueue name
> consumers messages messages_ready
>
> Listing queues ...
> storage 5 1 0
> ...done.
>
> I currently have it running again after a restart and that's usually the
> response I get, usually only 0-5 items in the queue, since it's being
> processed.
>
> When the error was occurring and I checked the queue, there were
> effectively *zero* items in the queue according to that command I ran above
> in the queue. In python I definitely do acknowledge items via:
>
> self.channel.basic_ack(data.delivery_tag)
>
> where self.channel is amqp.Connection(host=host, **info).channel()
>
> Suhail
>
> On Thu, Jul 30, 2009 at 12:46 PM, Matthias Radestock <matthias at lshift.net>wrote:
>
>> Suhail Doshi wrote:
>>
>>> Looking in my logs shows a large gap in time, in bold is where it is:
>>>
>>> =INFO REPORT==== 30-Jul-2009::17:26:56 ===
>>>    alarm_handler: {set,{system_memory_high_watermark,[]}}
>>>
>>
>> This indicates that rabbit got close to running out of memory and told all
>> connected clients to stop sending any more messages. Hence the "Discarding
>> ..." message you were seeing in the erlang client. Your consumers should
>> continue to receive messages, albeit slowly if rabbit is swapping.
>>
>> Perhaps your consumers are not acknowledging received messages, causing
>> them to keep piling up at the server?
>>
>> I recommend checking the queue lengths/sizes with 'rabbitmqctl
>> list_queues'.
>>
>>
>> Regards,
>>
>> Matthias.
>>
>
>
>
> --
> http://mixpanel.com
> Blog: http://blog.mixpanel.com
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090730/017609b0/attachment.htm 

From digitalwarfare at gmail.com  Thu Jul 30 21:15:34 2009
From: digitalwarfare at gmail.com (Suhail Doshi)
Date: Thu, 30 Jul 2009 13:15:34 -0700
Subject: [rabbitmq-discuss] erlang-client issue, discarding content?
In-Reply-To: <376f3e6f0907301254q7d87c1f2lb14db6123422dfb7@mail.gmail.com>
References: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com> 
	<376f3e6f0907301224y6a427284m245bf922eb5638e1@mail.gmail.com> 
	<376f3e6f0907301239u4600175al32b2b5f3b5af5137@mail.gmail.com> 
	<4A71F8AF.2040406@lshift.net>
	<376f3e6f0907301252n773969abs220067999d1aed5f@mail.gmail.com> 
	<376f3e6f0907301254q7d87c1f2lb14db6123422dfb7@mail.gmail.com>
Message-ID: <376f3e6f0907301315s76a305eatd9b909cfc0e2e914@mail.gmail.com>

I attached some images that might provide better insight into the problem.
You can basically see when everything went down and horribly wrong: memory
usage, swap in/out, and load average.
Suhail

On Thu, Jul 30, 2009 at 12:54 PM, Suhail Doshi <digitalwarfare at gmail.com>wrote:

> Here's the erlang module I use to send items to rabbit, it's largely
> adapted from code open sourced online:
> Dpaste of it: http://dpaste.com/73447/
>
> -export([amqp_lifecycle/0, send_message/5, log/2]).
>
> -include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit.hrl").
>
> -include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit_framing.hrl").
> -include("rabbitmq-erlang-client/include/amqp_client.hrl").
>
> -record(rabbit_info, {channel, ticket, exchange, routing_key}).
>
> amqp_lifecycle() ->
>     User = "mixpanel",
>     Password = "mixpanel0816",
>     Realm = <<"mixpanel">>, %% virtual_host
>     Connection = amqp_connection:start(User, Password, "127.0.0.1", Realm),
>     Channel = amqp_connection:open_channel(Connection),
>     Access = #'access.request'{
>         realm = Realm,
>         exclusive = false,
>         passive = true,
>          active = true,
>         write = true,
>         read = true
>     },
>     #'access.request_ok'{ticket = Ticket} = amqp_channel:call(Channel,
> Access),
>
>      Q = <<"storage">>,
>     X = <<"records">>,
>     BindKey = <<"event">>,
>
>     QueueDeclare = #'queue.declare'{ticket = Ticket, queue = Q,
>                                     passive = false, durable = true,
>                                     exclusive = false, auto_delete = false,
>                                     nowait = false, arguments = []},
>
>     #'queue.declare_ok'{queue = Q} = amqp_channel:call(Channel,
> QueueDeclare),
>
>     ExchangeDeclare = #'exchange.declare'{ticket = Ticket,
>                                           exchange = X, type =
> <<"direct">>,
>                                           passive = false, durable = true,
>                                           auto_delete = false, internal =
> false,
>                                           nowait = false, arguments = []},
>
>     #'exchange.declare_ok'{} = amqp_channel:call(Channel, ExchangeDeclare),
>     QueueBind = #'queue.bind'{ticket = Ticket,
>                               queue = Q,
>                               exchange = X,
>                               routing_key = BindKey,
>                               nowait = false, arguments = []},
>     #'queue.bind_ok'{} = amqp_channel:call(Channel, QueueBind),
>
>     RabbitInfo = #'rabbit_info'{
>         channel = Channel,
>         ticket = Ticket,
>         exchange = X,
>         routing_key = BindKey
>     },
>     RabbitInfo.
>
> send_message(Channel, Ticket, X, RoutingKey, Payload) ->
>     BasicPublish = #'basic.publish'{ticket = Ticket,
>                                     exchange = X,
>                                     routing_key = RoutingKey,
>                                     mandatory = false,
>                                     immediate = false},
>     BasicProperties = amqp_util:basic_properties(),
>     Properties = BasicProperties#'P_basic'{delivery_mode=2}, %% Persistence
> plz
>     Content = #content{class_id = 60,
>          properties = Properties,
>          properties_bin = none,
>          payload_fragments_rev = [Payload]
>         },
>     amqp_channel:cast(Channel, BasicPublish, Content).
>
> log(Key,Value) ->
>     io:format("~p: ~p~n",[Key,Value]).
>
>
> I do the following to send items to the queue:
>
> event_queue_data(QueueInfo, Data) ->
>     send_message(
>         QueueInfo#'rabbit_info'.channel,
>         QueueInfo#'rabbit_info'.ticket,
>         QueueInfo#'rabbit_info'.exchange,
>         QueueInfo#'rabbit_info'.routing_key,
>         list_to_binary(Data)
>     ),
>     1.
>
> On Thu, Jul 30, 2009 at 12:52 PM, Suhail Doshi <digitalwarfare at gmail.com>wrote:
>
>> mplivelog1 ~: sudo /usr/sbin/rabbitmqctl list_queues -p myqueue name
>> consumers messages messages_ready
>>
>> Listing queues ...
>> storage 5 1 0
>> ...done.
>>
>> I currently have it running again after a restart and that's usually the
>> response I get, usually only 0-5 items in the queue, since it's being
>> processed.
>>
>> When the error was occurring and I checked the queue, there were
>> effectively *zero* items in the queue according to that command I ran above
>> in the queue. In python I definitely do acknowledge items via:
>>
>> self.channel.basic_ack(data.delivery_tag)
>>
>> where self.channel is amqp.Connection(host=host, **info).channel()
>>
>> Suhail
>>
>> On Thu, Jul 30, 2009 at 12:46 PM, Matthias Radestock <matthias at lshift.net
>> > wrote:
>>
>>> Suhail Doshi wrote:
>>>
>>>> Looking in my logs shows a large gap in time, in bold is where it is:
>>>>
>>>> =INFO REPORT==== 30-Jul-2009::17:26:56 ===
>>>>    alarm_handler: {set,{system_memory_high_watermark,[]}}
>>>>
>>>
>>> This indicates that rabbit got close to running out of memory and told
>>> all connected clients to stop sending any more messages. Hence the
>>> "Discarding ..." message you were seeing in the erlang client. Your
>>> consumers should continue to receive messages, albeit slowly if rabbit is
>>> swapping.
>>>
>>> Perhaps your consumers are not acknowledging received messages, causing
>>> them to keep piling up at the server?
>>>
>>> I recommend checking the queue lengths/sizes with 'rabbitmqctl
>>> list_queues'.
>>>
>>>
>>> Regards,
>>>
>>> Matthias.
>>>
>>
>>
>>
>> --
>> http://mixpanel.com
>> Blog: http://blog.mixpanel.com
>>
>
>
>
> --
> http://mixpanel.com
> Blog: http://blog.mixpanel.com
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090730/01c4f409/attachment.htm 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Picture 1.png
Type: image/png
Size: 37615 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090730/01c4f409/attachment.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Picture 2.png
Type: image/png
Size: 17563 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090730/01c4f409/attachment-0001.png 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Picture 3.png
Type: image/png
Size: 20816 bytes
Desc: not available
Url : http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090730/01c4f409/attachment-0002.png 

From digitalwarfare at gmail.com  Thu Jul 30 22:17:00 2009
From: digitalwarfare at gmail.com (Suhail Doshi)
Date: Thu, 30 Jul 2009 14:17:00 -0700
Subject: [rabbitmq-discuss] erlang-client issue, discarding content?
In-Reply-To: <376f3e6f0907301315s76a305eatd9b909cfc0e2e914@mail.gmail.com>
References: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com> 
	<376f3e6f0907301224y6a427284m245bf922eb5638e1@mail.gmail.com> 
	<376f3e6f0907301239u4600175al32b2b5f3b5af5137@mail.gmail.com> 
	<4A71F8AF.2040406@lshift.net>
	<376f3e6f0907301252n773969abs220067999d1aed5f@mail.gmail.com> 
	<376f3e6f0907301254q7d87c1f2lb14db6123422dfb7@mail.gmail.com> 
	<376f3e6f0907301315s76a305eatd9b909cfc0e2e914@mail.gmail.com>
Message-ID: <376f3e6f0907301417p56cf9a26j6f02d4d7f7b38f13@mail.gmail.com>

The only thing I can think of is....definitely not acking properly but
consumers are definitely re-processing items so it's like it acks but
doesn't get removed out of memory?
What's the proper way to ack something in python? This is what I do:

self.channel.basic_ack(data.delivery_tag)

where data comes into the recv handler and channel is
amqp.Connection(host=host, **info).channel()

On Thu, Jul 30, 2009 at 1:15 PM, Suhail Doshi <digitalwarfare at gmail.com>wrote:

> I attached some images that might provide better insight into the problem.
> You can basically see when everything went down and horribly wrong: memory
> usage, swap in/out, and load average.
> Suhail
>
>
> On Thu, Jul 30, 2009 at 12:54 PM, Suhail Doshi <digitalwarfare at gmail.com>wrote:
>
>> Here's the erlang module I use to send items to rabbit, it's largely
>> adapted from code open sourced online:
>> Dpaste of it: http://dpaste.com/73447/
>>
>> -export([amqp_lifecycle/0, send_message/5, log/2]).
>>
>> -include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit.hrl").
>>
>> -include_lib("rabbitmq-erlang-client/rabbitmq_server/include/rabbit_framing.hrl").
>> -include("rabbitmq-erlang-client/include/amqp_client.hrl").
>>
>> -record(rabbit_info, {channel, ticket, exchange, routing_key}).
>>
>> amqp_lifecycle() ->
>>     User = "mixpanel",
>>     Password = "mixpanel0816",
>>     Realm = <<"mixpanel">>, %% virtual_host
>>     Connection = amqp_connection:start(User, Password, "127.0.0.1",
>> Realm),
>>     Channel = amqp_connection:open_channel(Connection),
>>     Access = #'access.request'{
>>         realm = Realm,
>>         exclusive = false,
>>         passive = true,
>>          active = true,
>>         write = true,
>>         read = true
>>     },
>>     #'access.request_ok'{ticket = Ticket} = amqp_channel:call(Channel,
>> Access),
>>
>>      Q = <<"storage">>,
>>     X = <<"records">>,
>>     BindKey = <<"event">>,
>>
>>     QueueDeclare = #'queue.declare'{ticket = Ticket, queue = Q,
>>                                     passive = false, durable = true,
>>                                     exclusive = false, auto_delete =
>> false,
>>                                     nowait = false, arguments = []},
>>
>>     #'queue.declare_ok'{queue = Q} = amqp_channel:call(Channel,
>> QueueDeclare),
>>
>>     ExchangeDeclare = #'exchange.declare'{ticket = Ticket,
>>                                           exchange = X, type =
>> <<"direct">>,
>>                                           passive = false, durable = true,
>>                                           auto_delete = false, internal =
>> false,
>>                                           nowait = false, arguments = []},
>>
>>     #'exchange.declare_ok'{} = amqp_channel:call(Channel,
>> ExchangeDeclare),
>>     QueueBind = #'queue.bind'{ticket = Ticket,
>>                               queue = Q,
>>                               exchange = X,
>>                               routing_key = BindKey,
>>                               nowait = false, arguments = []},
>>     #'queue.bind_ok'{} = amqp_channel:call(Channel, QueueBind),
>>
>>     RabbitInfo = #'rabbit_info'{
>>         channel = Channel,
>>         ticket = Ticket,
>>         exchange = X,
>>         routing_key = BindKey
>>     },
>>     RabbitInfo.
>>
>> send_message(Channel, Ticket, X, RoutingKey, Payload) ->
>>     BasicPublish = #'basic.publish'{ticket = Ticket,
>>                                     exchange = X,
>>                                     routing_key = RoutingKey,
>>                                     mandatory = false,
>>                                     immediate = false},
>>     BasicProperties = amqp_util:basic_properties(),
>>     Properties = BasicProperties#'P_basic'{delivery_mode=2}, %%
>> Persistence plz
>>     Content = #content{class_id = 60,
>>          properties = Properties,
>>          properties_bin = none,
>>          payload_fragments_rev = [Payload]
>>         },
>>     amqp_channel:cast(Channel, BasicPublish, Content).
>>
>> log(Key,Value) ->
>>     io:format("~p: ~p~n",[Key,Value]).
>>
>>
>> I do the following to send items to the queue:
>>
>> event_queue_data(QueueInfo, Data) ->
>>     send_message(
>>         QueueInfo#'rabbit_info'.channel,
>>         QueueInfo#'rabbit_info'.ticket,
>>         QueueInfo#'rabbit_info'.exchange,
>>         QueueInfo#'rabbit_info'.routing_key,
>>         list_to_binary(Data)
>>     ),
>>     1.
>>
>> On Thu, Jul 30, 2009 at 12:52 PM, Suhail Doshi <digitalwarfare at gmail.com>wrote:
>>
>>> mplivelog1 ~: sudo /usr/sbin/rabbitmqctl list_queues -p myqueue name
>>> consumers messages messages_ready
>>>
>>> Listing queues ...
>>> storage 5 1 0
>>> ...done.
>>>
>>> I currently have it running again after a restart and that's usually the
>>> response I get, usually only 0-5 items in the queue, since it's being
>>> processed.
>>>
>>> When the error was occurring and I checked the queue, there were
>>> effectively *zero* items in the queue according to that command I ran above
>>> in the queue. In python I definitely do acknowledge items via:
>>>
>>> self.channel.basic_ack(data.delivery_tag)
>>>
>>> where self.channel is amqp.Connection(host=host, **info).channel()
>>>
>>> Suhail
>>>
>>> On Thu, Jul 30, 2009 at 12:46 PM, Matthias Radestock <
>>> matthias at lshift.net> wrote:
>>>
>>>> Suhail Doshi wrote:
>>>>
>>>>> Looking in my logs shows a large gap in time, in bold is where it is:
>>>>>
>>>>> =INFO REPORT==== 30-Jul-2009::17:26:56 ===
>>>>>    alarm_handler: {set,{system_memory_high_watermark,[]}}
>>>>>
>>>>
>>>> This indicates that rabbit got close to running out of memory and told
>>>> all connected clients to stop sending any more messages. Hence the
>>>> "Discarding ..." message you were seeing in the erlang client. Your
>>>> consumers should continue to receive messages, albeit slowly if rabbit is
>>>> swapping.
>>>>
>>>> Perhaps your consumers are not acknowledging received messages, causing
>>>> them to keep piling up at the server?
>>>>
>>>> I recommend checking the queue lengths/sizes with 'rabbitmqctl
>>>> list_queues'.
>>>>
>>>>
>>>> Regards,
>>>>
>>>> Matthias.
>>>>
>>>
>>>
>>>
>>> --
>>> http://mixpanel.com
>>> Blog: http://blog.mixpanel.com
>>>
>>
>>
>>
>> --
>> http://mixpanel.com
>> Blog: http://blog.mixpanel.com
>>
>
>
>
> --
> http://mixpanel.com
> Blog: http://blog.mixpanel.com
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090730/7ecfd676/attachment.htm 

From matthias at lshift.net  Thu Jul 30 22:41:26 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Thu, 30 Jul 2009 22:41:26 +0100
Subject: [rabbitmq-discuss] erlang-client issue, discarding content?
In-Reply-To: <376f3e6f0907301315s76a305eatd9b909cfc0e2e914@mail.gmail.com>
References: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com>
	<376f3e6f0907301224y6a427284m245bf922eb5638e1@mail.gmail.com>
	<376f3e6f0907301239u4600175al32b2b5f3b5af5137@mail.gmail.com>
	<4A71F8AF.2040406@lshift.net>	<376f3e6f0907301252n773969abs220067999d1aed5f@mail.gmail.com>
	<376f3e6f0907301254q7d87c1f2lb14db6123422dfb7@mail.gmail.com>
	<376f3e6f0907301315s76a305eatd9b909cfc0e2e914@mail.gmail.com>
Message-ID: <4A721386.5070406@lshift.net>

Suhail,

Suhail Doshi wrote:
> I attached some images that might provide better insight into the 
> problem. You can basically see when everything went down and horribly 
> wrong: memory usage, swap in/out, and load average.

Is it definitely the rabbitmq server that is busy and eating all the 
memory, rather than some other process on your system (e.g. the erlang 
client, python consumers, desktop apps, etc)?

If it *is* the server, can you observe the memory growing gradually from 
the start, or does it suddenly spike?


Matthias



From digitalwarfare at gmail.com  Thu Jul 30 23:12:15 2009
From: digitalwarfare at gmail.com (Suhail Doshi)
Date: Thu, 30 Jul 2009 15:12:15 -0700
Subject: [rabbitmq-discuss] erlang-client issue, discarding content?
In-Reply-To: <4A721386.5070406@lshift.net>
References: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com> 
	<376f3e6f0907301224y6a427284m245bf922eb5638e1@mail.gmail.com> 
	<376f3e6f0907301239u4600175al32b2b5f3b5af5137@mail.gmail.com> 
	<4A71F8AF.2040406@lshift.net>
	<376f3e6f0907301252n773969abs220067999d1aed5f@mail.gmail.com> 
	<376f3e6f0907301254q7d87c1f2lb14db6123422dfb7@mail.gmail.com> 
	<376f3e6f0907301315s76a305eatd9b909cfc0e2e914@mail.gmail.com> 
	<4A721386.5070406@lshift.net>
Message-ID: <376f3e6f0907301512k2fb1cc8j5bc3f3739f40302d@mail.gmail.com>

Yeah definitely has to be, the moment I kill it the memory drops back down
and it is gradually growing, you can even see it gradually growing in the
images.
Suhail

On Thu, Jul 30, 2009 at 2:41 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Suhail,
>
> Suhail Doshi wrote:
>
>> I attached some images that might provide better insight into the problem.
>> You can basically see when everything went down and horribly wrong: memory
>> usage, swap in/out, and load average.
>>
>
> Is it definitely the rabbitmq server that is busy and eating all the
> memory, rather than some other process on your system (e.g. the erlang
> client, python consumers, desktop apps, etc)?
>
> If it *is* the server, can you observe the memory growing gradually from
> the start, or does it suddenly spike?
>
>
> Matthias
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090730/e92e93e8/attachment.htm 

From n8gray at n8gray.org  Fri Jul 31 00:28:23 2009
From: n8gray at n8gray.org (Nathan Gray)
Date: Thu, 30 Jul 2009 16:28:23 -0700
Subject: [rabbitmq-discuss] simple.publish over the JSON RPC interface
Message-ID: <65a6e3960907301628q2baac55ck59509244e8e8429f@mail.gmail.com>

I'm trying to use the rabbitmq-http2 bridge to create exchanges and
send messages to them via http/jsonrpc.  Creating an exchange works
fine but sending a message doesn't.  I'm using a simple python client
and I've generated the following request object:

{"version":"1.1",
"method": "cast",
"params": [
  "basic.publish",
  [1, "amq.topic", "this.that", false, false],
  "Hello world!",
  [null, null, null, null, null, null, null, null, null, null, null,
null, null, null]],
"id": 0}

AFAICT this is essentially the same as the example given in this posting:
http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/2009-April/003882.html

But this is what I get as a response (sorry for the formatting):

{"version":"1.1",
"id":0,
"error":
{ "name":"JSONRPCError",
  "code":500,
  "message":"Internal error",
  "error":"{timeout,\n    {gen_server,call,\n        [<0.432.0>,\n
    {jsonrpc,<<\"cast\">>,\n             {obj,\n
[{\"http_method\",<<\"POST\">>},\n
{\"http_query_parameters\",{obj,[]}},\n
{\"http_headers\",\n                   {obj,\n
[{\"user-agent\",<<\"python\">>},\n
{\"accept\",<<\"application/json\">>},\n
{\"content-type\",<<\"application/json\">>},\n
{\"content-length\",<<\"220\">>},\n
{\"accept-encoding\",<<\"identity\">>},\n
{\"host\",<<\"localhost:55672\">>}]}},\n
{\"remote_port\",61595},\n
{\"remote_peername\",<<\"0:0:0:0:0:0:0:1\">>},\n
{\"scheme\",<<\"http\">>}]},\n             [<<\"basic.publish\">>,\n
           [1,<<\"amq.topic\">>,<<\"this.that\">>,false,false],\n
        <<\"Hello world!\">>,\n
[null,null,null,null,null,null,null,null,null,null,null,null,\n
       null,null]]}]}}"
}}

Can anybody explain what I've done wrong?

Thanks!
-n8

PS: Please CC me with replies.

-- 
http://n8gray.org



From matthias at lshift.net  Fri Jul 31 00:37:48 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 31 Jul 2009 00:37:48 +0100
Subject: [rabbitmq-discuss] erlang-client issue, discarding content?
In-Reply-To: <376f3e6f0907301512k2fb1cc8j5bc3f3739f40302d@mail.gmail.com>
References: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com>
	<376f3e6f0907301224y6a427284m245bf922eb5638e1@mail.gmail.com>
	<376f3e6f0907301239u4600175al32b2b5f3b5af5137@mail.gmail.com>
	<4A71F8AF.2040406@lshift.net>	<376f3e6f0907301252n773969abs220067999d1aed5f@mail.gmail.com>
	<376f3e6f0907301254q7d87c1f2lb14db6123422dfb7@mail.gmail.com>
	<376f3e6f0907301315s76a305eatd9b909cfc0e2e914@mail.gmail.com>
	<4A721386.5070406@lshift.net>
	<376f3e6f0907301512k2fb1cc8j5bc3f3739f40302d@mail.gmail.com>
Message-ID: <4A722ECC.1070903@lshift.net>

Suhail,

Suhail Doshi wrote:
> Yeah definitely has to be, the moment I kill it the memory drops back 
> down and it is gradually growing, you can even see it gradually growing 
> in the images.

Do you definitely see the rabbit process consuming the memory? How big 
does it get? And what about CPU usage?

The reason I am asking is that killing the server also affects the 
clients, i.e. it is possible that a *client* is consuming all the 
memory, and releases it as soon as the server connection is severed.

So please check the *per-process* memory and CPU stats.

Now, if it really is the server that is eating the memory, please run 
all the various list_* commands in rabbitmqctl to see whether any of 
them are showing growth.

Finally, try publishing messages without marking them as persistent, and 
see whether that changes the behaviour.


Regards,

Matthias.



From juhani at juranki.com  Fri Jul 31 09:44:59 2009
From: juhani at juranki.com (=?ISO-8859-1?Q?Juhani_R=E4nkimies?=)
Date: Fri, 31 Jul 2009 11:44:59 +0300
Subject: [rabbitmq-discuss] client and server versioning
Message-ID: <e55356640907310144m258a52eekf7af4795dcdcb951@mail.gmail.com>

Hi,

Am I asking for trouble if I follow erlang-client default branch and
keep the server at 1.6.0?
I'd be using network connection.

cheers,
-juhani



From sam.owen at gazprom-mt.com  Fri Jul 31 14:45:39 2009
From: sam.owen at gazprom-mt.com (Sam Owen)
Date: Fri, 31 Jul 2009 14:45:39 +0100
Subject: [rabbitmq-discuss] rabbitmqctl with window services
Message-ID: <C3F648C3620DC6488A18F7F1BBC18F1A02380B@ex01kguk.Gazpromuk.intra>

Hi,

 

The rabbitmqctl command seems not to work with the rabbit windows
service I've installed. I get the following:

 

C:\rabbitmq_server-1.6.0\sbin>rabbitmqctl.bat status

Status of node rabbit at DEVELOPER26 ...

{badrpc,nodedown}

...done.

 

 

C:\rabbitmq_server-1.6.0\sbin>rabbitmqctl.bat list_queues

Listing queues ...

Error: {badrpc,nodedown}

 

 

It does work however, when I run the server from the rabbit-server
script:

 

C: \rabbitmq_server-1.6.0\sbin>rabbitmqctl.bat status

Status of node rabbit at DEVELOPER26 ...

[{running_applications,[{rabbit,"RabbitMQ","1.6.0"},

                        {mnesia,"MNESIA  CXC 138 12","4.3.5"},

                        {os_mon,"CPO  CXC 138 46","2.1.2.1"},

                        {sasl,"SASL  CXC 138 11","2.1.5.1"},

                        {stdlib,"ERTS  CXC 138 10","1.14.5"},

                        {kernel,"ERTS  CXC 138 10","2.11.5"}]},

 {nodes,[rabbit at DEVELOPER26]},

 {running_nodes,[rabbit at DEVELOPER26]}]

...done.

 

 

Any ideas?

 

Sam



The information transmitted is the property of Gazprom Marketing & Trading Ltd and is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material. Statements and opinions expressed in this e-mail may not represent those of the company. Any review, retransmission, dissemination and other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited. If you received this in error, please contact the sender immediately and delete the material from any computer. 

Registered office: Gazprom Marketing & Trading Ltd, Gazprom House, 60 Marina Place, Hampton Wick, Kingston upon Thames, KT1 4BH. Registered in England No. 3768267


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090731/dccfb850/attachment.htm 

From lynton.grice at logosworld.com  Fri Jul 31 16:36:20 2009
From: lynton.grice at logosworld.com (Lynton Grice)
Date: Fri, 31 Jul 2009 17:36:20 +0200
Subject: [rabbitmq-discuss] FW:  rabbitmqctl with window services
Message-ID: <009701ca11f4$aa85ac60$ff910520$@grice@logosworld.com>

Hi Sam,

 

I think I had the same issue before on windows....simply go to the RabbitMQ
service...right click-> properties..... and change the LOGON user to be your
username + password....then RabbitMQ should start up and all should be cool
;-)

 

Lynton

 

From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of Sam Owen
Sent: 31 July 2009 03:46 PM
To: rabbitmq-discuss at lists.rabbitmq.com
Subject: [rabbitmq-discuss] rabbitmqctl with window services

 

Hi,

 

The rabbitmqctl command seems not to work with the rabbit windows service
I've installed. I get the following:

 

C:\rabbitmq_server-1.6.0\sbin>rabbitmqctl.bat status

Status of node rabbit at DEVELOPER26 ...

{badrpc,nodedown}

...done.

 

 

C:\rabbitmq_server-1.6.0\sbin>rabbitmqctl.bat list_queues

Listing queues ...

Error: {badrpc,nodedown}

 

 

It does work however, when I run the server from the rabbit-server script:

 

C: \rabbitmq_server-1.6.0\sbin>rabbitmqctl.bat status

Status of node rabbit at DEVELOPER26 ...

[{running_applications,[{rabbit,"RabbitMQ","1.6.0"},

                        {mnesia,"MNESIA  CXC 138 12","4.3.5"},

                        {os_mon,"CPO  CXC 138 46","2.1.2.1"},

                        {sasl,"SASL  CXC 138 11","2.1.5.1"},

                        {stdlib,"ERTS  CXC 138 10","1.14.5"},

                        {kernel,"ERTS  CXC 138 10","2.11.5"}]},

 {nodes,[rabbit at DEVELOPER26]},

 {running_nodes,[rabbit at DEVELOPER26]}]

...done.

 

 

Any ideas?

 

Sam

 

The information transmitted is the property of Gazprom Marketing & Trading
Ltd and is intended only for the person or entity to which it is addressed
and may contain confidential and/or privileged material. Statements and
opinions expressed in this e-mail may not represent those of the company.
Any review, retransmission, dissemination and other use of, or taking of any
action in reliance upon, this information by persons or entities other than
the intended recipient is prohibited. If you received this in error, please
contact the sender immediately and delete the material from any computer. 

Registered office: Gazprom Marketing & Trading Ltd, Gazprom House, 60 Marina
Place, Hampton Wick, Kingston upon Thames, KT1 4BH. Registered in England
No. 3768267

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090731/cbb71402/attachment.htm 

From viditdrolia at gmail.com  Fri Jul 31 16:39:57 2009
From: viditdrolia at gmail.com (Vidit Drolia)
Date: Fri, 31 Jul 2009 11:39:57 -0400
Subject: [rabbitmq-discuss] Unique Messages in Queue
Message-ID: <4e1b00700907310839r69f389c9yaf8cecc951a52fa4@mail.gmail.com>

Hi,

Is it possible to store unique messages in a queue? I have a message
source that may provide duplicate messages but I do not want the
message to be processed more than once. I am trying to avoid using a
database or any other form of persistence in the client using the
queues. Any help/advice will be very helpful.

Thanks!

Regads,

-- 
Vidit Drolia



From Alister.Morton at tradition.com  Fri Jul 31 16:47:47 2009
From: Alister.Morton at tradition.com (Alister Morton)
Date: Fri, 31 Jul 2009 16:47:47 +0100
Subject: [rabbitmq-discuss] FW:  rabbitmqctl with window services
In-Reply-To: <009701ca11f4$aa85ac60$ff910520$@grice@logosworld.com>
References: <009701ca11f4$aa85ac60$ff910520$@grice@logosworld.com>
Message-ID: <5A46D132C446C04B9EFE8AD14E7891066EE871993F@SVR-2K3-BH-EMC.tradition.int>

I think I had the same issue before on windows....simply go to the RabbitMQ service...right click-> properties..... and change the LOGON user to be your username + password....then RabbitMQ should start up and all should be cool ;-)
That's a bit of a nasty kludge, though. Usually in a production environment you don't want services logging on with real user credentials.

________________________________
The information herein may have been obtained from various sources. Any opinion expressed may be that of the sender only, is subject to change without notice and should be independently evaluated. Nothing herein constitutes investment advice or an offer, or solicitation of an offer, to buy or sell any financial product. Any data consists of purely indicative prices and should not be relied upon to revalue any commercial positions held by any recipient. Tradition makes no warranty that the data represent or indicates prices at which transactions may be or have been made by any Tradition Group company. To the maximum extent of the law, Tradition accepts no responsibility for, and cannot and does not warrant the integrity, accuracy, quality, completeness, merchantability or suitability for a particular purpose or requirement of the information or data, even if arising out of the negligence of Tradition or otherwise. Tradition accepts no liability for any direct, indirect or other consequential loss arising out of any use of the information contained in this document or any omission from it. This communication is directed at Eligible Counterparties and Professional Clients as defined by the FSA. It is not for distribution to nor should it be relied upon by Private Clients. It is not intended for distribution to, or use by any person or entity in any jurisdiction or country where such distribution or use would be contrary to any applicable law or regulation. Please note that, for business or compliance reasons, we may monitor and read emails sent or received using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200), Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA 190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and regulated by the Financial Services Authority. VAT No: GB 365 4639 27 except TFS-ICAP GB 766 0854 05.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090731/bd186e2e/attachment.htm 

From darien at kindlund.com  Fri Jul 31 16:56:54 2009
From: darien at kindlund.com (Darien Kindlund)
Date: Fri, 31 Jul 2009 11:56:54 -0400
Subject: [rabbitmq-discuss] Unique Messages in Queue
In-Reply-To: <4e1b00700907310839r69f389c9yaf8cecc951a52fa4@mail.gmail.com>
References: <4e1b00700907310839r69f389c9yaf8cecc951a52fa4@mail.gmail.com>
Message-ID: <50c8ffe90907310856m586d5a97yfd12fb20aa564b31@mail.gmail.com>

Hi Vidit,

To my knowledge, RabbitMQ doesn't provide this type of capability by
default.  However, you could easily write a "pre-filter" application,
which takes in duplicate messages from your source on one queue and
then outputs the non-duplicates out on another queue.  You don't need
a database or other expensive I/O to check for duplicates.

Presumably, you have a way of identifying unique messages; I'll assume
it's some sort of unique ID associated with the message...
You can have your "pre-filter" application use a bloom filter
(http://en.wikipedia.org/wiki/Bloom_filters), which allocates constant
size memory and a configurable false-positive percentage.
The only major issue with this approach, is that bloom filters hold a
maximal amount of entries (user configurable), so you'll have to deal
with the corner case of how the application should behave when it has
seen the maximum number of unique messages -- either recreate a new
bloom filter (and discard your previous history) or chain multiple
bloom filters together (slowly increasing your CPU costs).  Again, the
maximal value can be set exceedingly large (e.g., 10 million), in
order to reduce the (probable) likelihood of dealing with this
situation.

-- Darien

On Fri, Jul 31, 2009 at 11:39 AM, Vidit Drolia<viditdrolia at gmail.com> wrote:
> Hi,
>
> Is it possible to store unique messages in a queue? I have a message
> source that may provide duplicate messages but I do not want the
> message to be processed more than once. I am trying to avoid using a
> database or any other form of persistence in the client using the
> queues. Any help/advice will be very helpful.
>
> Thanks!
>
> Regads,
>
> --
> Vidit Drolia
>
> _______________________________________________
> rabbitmq-discuss mailing list
> rabbitmq-discuss at lists.rabbitmq.com
> http://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss
>



From emile at lshift.net  Fri Jul 31 17:12:57 2009
From: emile at lshift.net (Emile Joubert)
Date: Fri, 31 Jul 2009 17:12:57 +0100
Subject: [rabbitmq-discuss] FW:  rabbitmqctl with window services
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891066EE871993F@SVR-2K3-BH-EMC.tradition.int>
References: <009701ca11f4$aa85ac60$ff910520$@grice@logosworld.com>
	<5A46D132C446C04B9EFE8AD14E7891066EE871993F@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <4A731809.1020709@lshift.net>

Alister Morton wrote:
> I think I had the same issue before on windows....simply go to the 
> RabbitMQ service...right click-> properties..... and change the LOGON 
> user to be your username + password....then RabbitMQ should start up and 
> all should be cool ;-)
> 
> That's a bit of a nasty kludge, though. Usually in a production 
> environment you don't want services logging on with real user credentials.

The root cause of the problem is probably that the erlang cookies of the 
  service account and the account running rabbitmqctl.bat are different. 
As an alternative to running the service and rabbitmqctl.bat as the same 
user, you could synchronise the cookies.

There are some instructions at
http://www.rabbitmq.com/install.html#running-windows-service .
Look for %WINDIR%\.erlang.cookie and %HOMEPATH%\.erlang.cookie .

-Emile

-- 

  [][][] Emile Joubert      | Tel: +44 (0)20 7729 7060
    [][] Software Developer | Fax: +44 (0)20 7729 7005
  []  [] www.lshift.net     | Email: emile at lshift.net



From sam.owen at gazprom-mt.com  Fri Jul 31 17:13:30 2009
From: sam.owen at gazprom-mt.com (Sam Owen)
Date: Fri, 31 Jul 2009 17:13:30 +0100
Subject: [rabbitmq-discuss] FW:  rabbitmqctl with window services
In-Reply-To: <5A46D132C446C04B9EFE8AD14E7891066EE871993F@SVR-2K3-BH-EMC.tradition.int>
References: <009701ca11f4$aa85ac60$ff910520$@grice@logosworld.com>
	<5A46D132C446C04B9EFE8AD14E7891066EE871993F@SVR-2K3-BH-EMC.tradition.int>
Message-ID: <C3F648C3620DC6488A18F7F1BBC18F1A02380D@ex01kguk.Gazpromuk.intra>

Indeed - we use service accounts to run our production services - using
these I'm seeing the same problem.

 

Is there workaround - or should I raise a bug?

 

Sam

 

 

 

________________________________

From: rabbitmq-discuss-bounces at lists.rabbitmq.com
[mailto:rabbitmq-discuss-bounces at lists.rabbitmq.com] On Behalf Of
Alister Morton
Sent: 31 July 2009 16:48
To: 'rabbitmq'
Subject: Re: [rabbitmq-discuss] FW: rabbitmqctl with window services

 

I think I had the same issue before on windows....simply go to the
RabbitMQ service...right click-> properties..... and change the LOGON
user to be your username + password....then RabbitMQ should start up and
all should be cool ;-) 

That's a bit of a nasty kludge, though. Usually in a production
environment you don't want services logging on with real user
credentials.

 

________________________________

The information herein may have been obtained from various sources. Any
opinion expressed may be that of the sender only, is subject to change
without notice and should be independently evaluated. Nothing herein
constitutes investment advice or an offer, or solicitation of an offer,
to buy or sell any financial product. Any data consists of purely
indicative prices and should not be relied upon to revalue any
commercial positions held by any recipient. Tradition makes no warranty
that the data represent or indicates prices at which transactions may be
or have been made by any Tradition Group company. To the maximum extent
of the law, Tradition accepts no responsibility for, and cannot and does
not warrant the integrity, accuracy, quality, completeness,
merchantability or suitability for a particular purpose or requirement
of the information or data, even if arising out of the negligence of
Tradition or otherwise. Tradition accepts no liability for any direct,
indirect or other consequential loss arising out of any use of the
information contained in this document or any omission from it. This
communication is directed at Eligible Counterparties and Professional
Clients as defined by the FSA. It is not for distribution to nor should
it be relied upon by Private Clients. It is not intended for
distribution to, or use by any person or entity in any jurisdiction or
country where such distribution or use would be contrary to any
applicable law or regulation. Please note that, for business or
compliance reasons, we may monitor and read emails sent or received
using our servers or equipment. Tradition (UK) Ltd (937647; FSA 139200),
Tradition Financial Services Ltd (1046064; FSA 147543), TFS Derivatives
Ltd (4051930; FSA 197244), Tradition London Clearing Ltd (3633863; FSA
190632) and TFS-ICAP Ltd (4025995; FSA 206018) registered in England at
Beaufort House, 15 St Botolph Street, London EC3A 7QX; authorised and
regulated by the Financial Services Authority. VAT No: GB 365 4639 27
except TFS-ICAP GB 766 0854 05.



<http://www.blackspider.com/>  



The information transmitted is the property of Gazprom Marketing & Trading Ltd and is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material. Statements and opinions expressed in this e-mail may not represent those of the company. Any review, retransmission, dissemination and other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited. If you received this in error, please contact the sender immediately and delete the material from any computer. 

Registered office: Gazprom Marketing & Trading Ltd, Gazprom House, 60 Marina Place, Hampton Wick, Kingston upon Thames, KT1 4BH. Registered in England No. 3768267


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090731/2a56489c/attachment.htm 

From matthias at lshift.net  Fri Jul 31 18:03:29 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 31 Jul 2009 18:03:29 +0100
Subject: [rabbitmq-discuss] Unique Messages in Queue
In-Reply-To: <4e1b00700907310839r69f389c9yaf8cecc951a52fa4@mail.gmail.com>
References: <4e1b00700907310839r69f389c9yaf8cecc951a52fa4@mail.gmail.com>
Message-ID: <4A7323E1.60605@lshift.net>

Vidit,

Vidit Drolia wrote:
> Is it possible to store unique messages in a queue? I have a message
> source that may provide duplicate messages but I do not want the
> message to be processed more than once.

As Darien pointed out, deduplicating messages at the client end isn't 
all that hard, and even easier than he described if, say, you can 
guarantee that message ids are monotonically increasing.

The really, really, hard part is ensuring that a message only gets 
*processed* once.

When can a message be considered to have been processed? Let's assume we 
have an app that pulls messages off a rabbit queue and calls a function 
process(msg) to process them. At what point then has the message been 
processed? At the exact point we call the function? At the exact point 
it returns? Somewhere inbetween? Whatever point you choose, you then 
still have to *record* the fact that the point has been reached, so that 
the message can be forgotten for good, or, alternatively, if the point 
hasn't been reached, replayed at a later point. That act of recording - 
whether it be by acknowledging the message in rabbit, or some other 
means - itself can fail, which will result in eventual resending and 
thus duplication.

The problem here is that the processing of the message itself, let alone 
the combination of it with the recording/acknowledging action are not 
atomic.

The only way to solve this is to either make everything - rabbit, your 
app, any apps it talks to, etc - part of a gigantic transaction - thus 
ensuring atomicity - or - and this is by far the easier and better 
option - construct your apps in such a way that messaging is idempotent.


Regards,

Matthias.



From viditdrolia at gmail.com  Fri Jul 31 18:24:36 2009
From: viditdrolia at gmail.com (Vidit Drolia)
Date: Fri, 31 Jul 2009 13:24:36 -0400
Subject: [rabbitmq-discuss] Unique Messages in Queue
In-Reply-To: <4A7323E1.60605@lshift.net>
References: <4e1b00700907310839r69f389c9yaf8cecc951a52fa4@mail.gmail.com>
	<4A7323E1.60605@lshift.net>
Message-ID: <4e1b00700907311024q78f976e1h9c37810864ce9384@mail.gmail.com>

Thanks Darien and Matthias.

Each message received is actually triggering an email. I can use Bloom
Filters to make sure messages are not duplicate, but if the node
running the filter application fails, I will end up losing historical
information. Running the filter on multiple nodes may be a solution.

The primary problem is that since the action being triggered by the
message is an email, I can't revert the action. So I am trying to
ensure that the application sending emails gets a message only once.
Is there another approach I can take to this problem?

Thanks again!

Vidit

On Fri, Jul 31, 2009 at 1:03 PM, Matthias Radestock<matthias at lshift.net> wrote:
> Vidit,
>
> Vidit Drolia wrote:
>>
>> Is it possible to store unique messages in a queue? I have a message
>> source that may provide duplicate messages but I do not want the
>> message to be processed more than once.
>
> As Darien pointed out, deduplicating messages at the client end isn't all
> that hard, and even easier than he described if, say, you can guarantee that
> message ids are monotonically increasing.
>
> The really, really, hard part is ensuring that a message only gets
> *processed* once.
>
> When can a message be considered to have been processed? Let's assume we
> have an app that pulls messages off a rabbit queue and calls a function
> process(msg) to process them. At what point then has the message been
> processed? At the exact point we call the function? At the exact point it
> returns? Somewhere inbetween? Whatever point you choose, you then still have
> to *record* the fact that the point has been reached, so that the message
> can be forgotten for good, or, alternatively, if the point hasn't been
> reached, replayed at a later point. That act of recording - whether it be by
> acknowledging the message in rabbit, or some other means - itself can fail,
> which will result in eventual resending and thus duplication.
>
> The problem here is that the processing of the message itself, let alone the
> combination of it with the recording/acknowledging action are not atomic.
>
> The only way to solve this is to either make everything - rabbit, your app,
> any apps it talks to, etc - part of a gigantic transaction - thus ensuring
> atomicity - or - and this is by far the easier and better option - construct
> your apps in such a way that messaging is idempotent.
>
>
> Regards,
>
> Matthias.
>



-- 
Vidit Drolia



From matthias at lshift.net  Fri Jul 31 19:08:03 2009
From: matthias at lshift.net (Matthias Radestock)
Date: Fri, 31 Jul 2009 19:08:03 +0100
Subject: [rabbitmq-discuss] Unique Messages in Queue
In-Reply-To: <4e1b00700907311024q78f976e1h9c37810864ce9384@mail.gmail.com>
References: <4e1b00700907310839r69f389c9yaf8cecc951a52fa4@mail.gmail.com>	<4A7323E1.60605@lshift.net>
	<4e1b00700907311024q78f976e1h9c37810864ce9384@mail.gmail.com>
Message-ID: <4A733303.5010703@lshift.net>

Vidit,

Vidit Drolia wrote:
> The primary problem is that since the action being triggered by the
> message is an email, I can't revert the action. So I am trying to
> ensure that the application sending emails gets a message only once.
> Is there another approach I can take to this problem?

If you replace "process(msg)" in my last email with "send_email(msg)", 
you will see that what you are asking for is impossible. The best one 
can do (in any system, involving rabbit or not) is to make it *very 
unlikely* that an email is sent more than once. As long as we can agree 
on that, let's proceed ...

If your main concern is removing the duplicates the senders can produce, 
then I suggest inserting a filtering proxy, i.e. a process that consumes 
messages from one queue, de-dups them and publishes the non-dups to 
another exchange.

This process does need to keep some state, so, as you say, if it crashes 
and the state is lost then you may get some dups. The process is very 
simple though, so the likelihood of it crashing should be low. Given 
that we have established that there can be no 100% no-dup guarantee, is 
it really worth worrying about that? If the answer is yes, then 
persisting that state, or replicating it between several redundant nodes 
are possible options.


Regards,

Matthias.



From viditdrolia at gmail.com  Fri Jul 31 19:41:34 2009
From: viditdrolia at gmail.com (Vidit Drolia)
Date: Fri, 31 Jul 2009 14:41:34 -0400
Subject: [rabbitmq-discuss] Unique Messages in Queue
In-Reply-To: <4A733303.5010703@lshift.net>
References: <4e1b00700907310839r69f389c9yaf8cecc951a52fa4@mail.gmail.com>
	<4A7323E1.60605@lshift.net>
	<4e1b00700907311024q78f976e1h9c37810864ce9384@mail.gmail.com>
	<4A733303.5010703@lshift.net>
Message-ID: <4e1b00700907311141y53b7e044hfe757c5bfe116d0c@mail.gmail.com>

Matthias,

Minimizing the probability of sending out a duplicate message is the
practical objective. So you are right in saying that the best we can
do is to make it very unlikely that a duplicate mail is sent out.

A filtering proxy would make most sense because I wanted to move away
from expensive I/O for persistence in the first place, plus if needed,
redundancy can be introduced later for fault-tolerance.

Thanks for all the help!

Best,

Vidit

On Fri, Jul 31, 2009 at 2:08 PM, Matthias Radestock<matthias at lshift.net> wrote:
> Vidit,
>
> Vidit Drolia wrote:
>>
>> The primary problem is that since the action being triggered by the
>> message is an email, I can't revert the action. So I am trying to
>> ensure that the application sending emails gets a message only once.
>> Is there another approach I can take to this problem?
>
> If you replace "process(msg)" in my last email with "send_email(msg)", you
> will see that what you are asking for is impossible. The best one can do (in
> any system, involving rabbit or not) is to make it *very unlikely* that an
> email is sent more than once. As long as we can agree on that, let's proceed
> ...
>
> If your main concern is removing the duplicates the senders can produce,
> then I suggest inserting a filtering proxy, i.e. a process that consumes
> messages from one queue, de-dups them and publishes the non-dups to another
> exchange.
>
> This process does need to keep some state, so, as you say, if it crashes and
> the state is lost then you may get some dups. The process is very simple
> though, so the likelihood of it crashing should be low. Given that we have
> established that there can be no 100% no-dup guarantee, is it really worth
> worrying about that? If the answer is yes, then persisting that state, or
> replicating it between several redundant nodes are possible options.
>
>
> Regards,
>
> Matthias.
>



From digitalwarfare at gmail.com  Fri Jul 31 20:33:50 2009
From: digitalwarfare at gmail.com (Suhail Doshi)
Date: Fri, 31 Jul 2009 12:33:50 -0700
Subject: [rabbitmq-discuss] erlang-client issue, discarding content?
In-Reply-To: <4A722ECC.1070903@lshift.net>
References: <376f3e6f0907301222o2742e210idc0c68a89fa37fa1@mail.gmail.com> 
	<376f3e6f0907301224y6a427284m245bf922eb5638e1@mail.gmail.com> 
	<376f3e6f0907301239u4600175al32b2b5f3b5af5137@mail.gmail.com> 
	<4A71F8AF.2040406@lshift.net>
	<376f3e6f0907301252n773969abs220067999d1aed5f@mail.gmail.com> 
	<376f3e6f0907301254q7d87c1f2lb14db6123422dfb7@mail.gmail.com> 
	<376f3e6f0907301315s76a305eatd9b909cfc0e2e914@mail.gmail.com> 
	<4A721386.5070406@lshift.net>
	<376f3e6f0907301512k2fb1cc8j5bc3f3739f40302d@mail.gmail.com> 
	<4A722ECC.1070903@lshift.net>
Message-ID: <376f3e6f0907311233n21d323ah9e09e77ea6fc3b38@mail.gmail.com>

The memory leak is in the consumers, thanks Matthias.
Suhail

On Thu, Jul 30, 2009 at 4:37 PM, Matthias Radestock <matthias at lshift.net>wrote:

> Suhail,
>
> Suhail Doshi wrote:
>
>> Yeah definitely has to be, the moment I kill it the memory drops back down
>> and it is gradually growing, you can even see it gradually growing in the
>> images.
>>
>
> Do you definitely see the rabbit process consuming the memory? How big does
> it get? And what about CPU usage?
>
> The reason I am asking is that killing the server also affects the clients,
> i.e. it is possible that a *client* is consuming all the memory, and
> releases it as soon as the server connection is severed.
>
> So please check the *per-process* memory and CPU stats.
>
> Now, if it really is the server that is eating the memory, please run all
> the various list_* commands in rabbitmqctl to see whether any of them are
> showing growth.
>
> Finally, try publishing messages without marking them as persistent, and
> see whether that changes the behaviour.
>
>
> Regards,
>
> Matthias.
>



-- 
http://mixpanel.com
Blog: http://blog.mixpanel.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20090731/e6d28556/attachment.htm 

