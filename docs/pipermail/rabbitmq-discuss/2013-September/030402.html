<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Clustering - just can't get it going
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20-%20just%20can%27t%20get%20it%20going&In-Reply-To=%3CE1B604B66AB5CC4D9BBB8B54008790AE0DEDA616%40SIDESWIPE.HostelBookers.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030400.html">
   <LINK REL="Next"  HREF="030403.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Clustering - just can't get it going</H1>
    <B>Robin Lawrie - HostelBookers</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Clustering%20-%20just%20can%27t%20get%20it%20going&In-Reply-To=%3CE1B604B66AB5CC4D9BBB8B54008790AE0DEDA616%40SIDESWIPE.HostelBookers.net%3E"
       TITLE="[rabbitmq-discuss] Clustering - just can't get it going">Robin.Lawrie at Hostelbookers.com
       </A><BR>
    <I>Wed Sep 25 15:55:25 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030400.html">[rabbitmq-discuss] Clustering - just can't get it going
</A></li>
        <LI>Next message: <A HREF="030403.html">[rabbitmq-discuss] Clustering - just can't get it going
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30402">[ date ]</a>
              <a href="thread.html#30402">[ thread ]</a>
              <a href="subject.html#30402">[ subject ]</a>
              <a href="author.html#30402">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

In my case, I have a 2 node cluster (called cache1 and cache2) and I needed to add an entry to the hosts file on both nodes to ensure each node can resolve the name of the other node before clustering worked for me.

My hosts file is in /etc and is called hosts

In there I entered the following:

On cache1.lon.hosting, enter the line 192.168.3.1 Cache2.domain.com Cache2
On cache2.lon.hosting, enter the line 192.168.3.0 Cache1.domain.com Cache1

Once done, I needed to confirm I could ping each node using it's hostname from the other node. I don't care about DNS or nslookup working/resolving the name.

HTH

Robin

From: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] On Behalf Of Derek Wyatt
Sent: 25 September 2013 15:47
To: Discussions about RabbitMQ
Subject: Re: [rabbitmq-discuss] Clustering - just can't get it going

Ah, I do have more information though:

DIAGNOSTICS
===========

nodes in question: ['RMQ1']

hosts, their running nodes and ports:
- unable to connect to epmd on RMQ1: nxdomain (non-existing domain)

current node details:
- node name: '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmqctl1577 at RMQ2</A>'
- home dir: /var/lib/rabbitmq
- cookie hash: ohQKEF09peb6bAgNqawvKA==

And just to be clear, the cookie is the same:

01:~$ sudo md5sum /var/lib/rabbitmq/.erlang.cookie
a2140a105d3da5e6fa6c080da9ac2f28  /var/lib/rabbitmq/.erlang.cookie
02:~$ sudo md5sum /var/lib/rabbitmq/.erlang.cookie
a2140a105d3da5e6fa6c080da9ac2f28  /var/lib/rabbitmq/.erlang.cookie

Somehow, telnet to epmd works just fine, but something that RMQ is doing fails to make that happen.  Is there some sort of DNS work that it's doing, instead of using the hosts files?

i.e. one thing I found is that nslookup fails:

02:~$ nslookup RMQ1
;; Got SERVFAIL reply from &lt;ipaddress&gt;, trying next server
Server:       &lt;ipaddress&gt;
Address:  &lt;ipaddress&gt;

** server can't find RMQ1: SERVFAIL

But if I ping RMQ1 it works fine.  /etc/nsswitch.conf specifies that files should be tried first, before DNS w.r.t. hosts.

So, it looks like RMQ is doing something more rigorous to resolve the host, and I don't know how to change that.  I also don't have access to the DNS server configuration in order to modify it in any way.


On 25 September 2013 09:57, Jason McIntosh &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mcintoshj at gmail.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mcintoshj at gmail.com</A>&gt;&gt; wrote:
Check your erlang cookie on both servers to make sure it matches I think it's in - /var/lib/rabbitmq/ - then you can use rabbitmqctl from one machine and see if you can connect to another to list queues.  I THINK that's rabbitmqctl -n &lt;servernode&gt; list_queues for example.  If both servers can talk to each other then it should be rabbitmqctl stop_app, join_cluster, start_app.

Jason

On Wed, Sep 25, 2013 at 8:50 AM, Derek Wyatt &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">derek at derekwyatt.org</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">derek at derekwyatt.org</A>&gt;&gt; wrote:
Hi,

I've seen a number of people failing to get clustering running and, unfortunately, I can't get it going either.  Here's the summary of what I've got:

  *   Two nodes - RMQ1 and RMQ2
  *   I can ping RMQ1 from RMQ2, and vice versa
  *   I can telnet from RMQ1 to RMQ2:epmd, and vice versa
  *   I can telnet from RMQ1 to RMQ2:amqp, and vice versa
  *   The cookie file is identical, as is clear from the startup INFO
My goal is to have RMQ2 join RMQ1 in a cluster.

The servers are started using the init script in Ubuntu (i.e. service rabbitmq-server start).  This is different than the script at <A HREF="http://www.rabbitmq.com/clustering.html,">http://www.rabbitmq.com/clustering.html,</A> which says to start with &quot;rabbitmq-server -detached&quot;.  I've tried that and it doesn't seem to make any difference so I always use the init script instead.

So, the script says to stop the RMQ2 server and then join the cluster.  The following transcript shows how well all this goes:

02:~$ sudo rabbitmqctl stop_app
Stopping node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at RMQ2</A>' ...
...done.

02:~$ sudo rabbitmqctl join_cluster --ram <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at RMQ1</A>
Clustering node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at RMQ2</A>' with '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at RMQ1</A>' ...
Error: {cannot_discover_cluster,&quot;The nodes provided are either offline or not running&quot;}

However, as I said above, telnetting to the ports works just fine:

02:~$ telnet RMQ1 epmd
Trying &lt;ip address&gt;...
Connected to RMQ1
Escape character is '^]'.
booger!
Connection closed by foreign host.

02:~$ telnet RMQ1 amqp
Trying &lt;ip address&gt;...
Connected to RMQ1
Escape character is '^]'.
booger!
AMQP Connection closed by foreign host.

I'm stuck for what else to test.  Does anyone know how to troubleshoot this thing further?

Thanks,
Derek


_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>



--
Jason McIntosh
<A HREF="http://mcintosh.poetshome.com/blog/">http://mcintosh.poetshome.com/blog/</A>
573-424-7612&lt;tel:573-424-7612&gt;

_______________________________________________
rabbitmq-discuss mailing list
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&lt;mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>

________________________________

This email is from Hostelbookers.com Limited. Registered office: 52-54 High Holborn, London, WC1V 6RL, UK. Registered in England under Company No.: 2841908. This email and any files transmitted with it are confidential and may be privileged and are intended solely for the use of the individual or entity to whom they are addressed. As email can be subject to operational or technical difficulties and time delays, communications that are subject to deadlines should also be sent by post. Any unauthorised direct or indirect dissemination, distribution or copying of this message and any attachments is strictly prohibited. If you have received the email in error, please notify <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">postmaster at hostelbookers.com</A>

________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130925/2e7e8131/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130925/2e7e8131/attachment.htm</A>&gt;
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030400.html">[rabbitmq-discuss] Clustering - just can't get it going
</A></li>
	<LI>Next message: <A HREF="030403.html">[rabbitmq-discuss] Clustering - just can't get it going
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30402">[ date ]</a>
              <a href="thread.html#30402">[ thread ]</a>
              <a href="subject.html#30402">[ subject ]</a>
              <a href="author.html#30402">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
