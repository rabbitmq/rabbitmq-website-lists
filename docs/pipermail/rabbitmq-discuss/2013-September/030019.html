<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Problem when enqueuing with no delay
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20when%20enqueuing%20with%20no%20delay&In-Reply-To=%3C4D1976E4-1C39-4EB3-8B3F-F0B1CFBC41FC%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030018.html">
   <LINK REL="Next"  HREF="030020.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Problem when enqueuing with no delay</H1>
    <B>Michael Klishin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Problem%20when%20enqueuing%20with%20no%20delay&In-Reply-To=%3C4D1976E4-1C39-4EB3-8B3F-F0B1CFBC41FC%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Problem when enqueuing with no delay">mklishin at gopivotal.com
       </A><BR>
    <I>Wed Sep 11 12:07:17 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030018.html">[rabbitmq-discuss] Problem when enqueuing with no delay
</A></li>
        <LI>Next message: <A HREF="030020.html">[rabbitmq-discuss] Problem when enqueuing with no delay
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30019">[ date ]</a>
              <a href="thread.html#30019">[ thread ]</a>
              <a href="subject.html#30019">[ subject ]</a>
              <a href="author.html#30019">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Pablo Briongos:

&gt;<i> The Ruby app process makes the crash of the machine as it increases the RAM and SWAP memory very fast to the limit.
</I>
That's expected. With periodic timer set to 0, you have an infinite loop in your app that allocates
memory (first when you publish, then when a message is delivered). CRuby VM will *not*
release memory once it's allocated (only reuse it after GC marks it as free). With an infinite
loop, you allocate faster than GC kicks in and does its work, so at some point OS starts
swapping, and then you run out of memory.

Why do you need to publish messages in a tight loop?

&gt;<i> I can't see any clear messages in log about it. I setted high watermark with:
</I>&gt;<i> 
</I>&gt;<i> sudo rabbitmqctl set_vm_memory_high_watermark 0.9
</I>
Well, if the Ruby app crashes, RabbitMQ does not know anything about it.

MK



-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130911/87d62256/attachment.pgp">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130911/87d62256/attachment.pgp</A>&gt;
</PRE>















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030018.html">[rabbitmq-discuss] Problem when enqueuing with no delay
</A></li>
	<LI>Next message: <A HREF="030020.html">[rabbitmq-discuss] Problem when enqueuing with no delay
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30019">[ date ]</a>
              <a href="thread.html#30019">[ thread ]</a>
              <a href="subject.html#30019">[ subject ]</a>
              <a href="author.html#30019">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
