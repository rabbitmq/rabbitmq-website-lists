<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ crash report
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20crash%20report&In-Reply-To=%3C1380097272338-29893.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030387.html">
   <LINK REL="Next"  HREF="030474.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ crash report</H1>
    <B>carlhoerberg</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20crash%20report&In-Reply-To=%3C1380097272338-29893.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ crash report">carl.hoerberg at gmail.com
       </A><BR>
    <I>Wed Sep 25 09:21:12 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030387.html">[rabbitmq-discuss] Nagios RabbitMQ Plugins (python based)
</A></li>
        <LI>Next message: <A HREF="030474.html">[rabbitmq-discuss] RabbitMQ crash report
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30390">[ date ]</a>
              <a href="thread.html#30390">[ thread ]</a>
              <a href="subject.html#30390">[ subject ]</a>
              <a href="author.html#30390">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>With a two node RabbitMQ 3.1.5 cluster, Erlang R16B01:

Suddenly all vhost delete operations times out (or never finishes) via both
the http api and rabbitmqctl. Later queue delete operation stops, and
eventually creating new vhosts/users. 

Restarting just one node (and yeah, as usual the node can't be stopped
normally but have to be killed), and when bringing it back up again it
endlessly throws: 

Discarding message {'$gen_call',{&lt;0.11812.0&gt;,#Ref&lt;0.0.0.180597&gt;},stat} from
&lt;0.11812.0&gt; to &lt;0.684.0&gt; in an old incarnation (2) of this node (3)

A full cluster restart was required. But then &quot;msg_store_persistent:
rebuilding indices from scratch&quot; takes about ten minutes. 

Have a big log dump with a lot of juice error messages in if you want to
take a look. Some examples:

=CRASH REPORT==== 25-Sep-2013::07:40:26 ===
  crasher:
    initial call: gen:init_it/6
    pid: &lt;0.1142.0&gt;
    registered_name: []
    exception exit: {bad_return_value,
                        {error,
                            {{badmatch,[]},
                             [{rabbit_mirror_queue_master,
                                  '-init_with_existing_bq/3-fun-0-',3,[]},
                              {mnesia_tm,apply_fun,3,
                                  [{file,&quot;mnesia_tm.erl&quot;},{line,830}]},
                              {mnesia_tm,execute_transaction,5,
                                  [{file,&quot;mnesia_tm.erl&quot;},{line,810}]},
                              {rabbit_misc,
                                 
'-execute_mnesia_transaction/1-fun-0-',1,[]},
                              {worker_pool_worker,handle_call,3,[]},
                              {gen_server2,handle_msg,2,[]},
                              {proc_lib,init_p_do_apply,3,
                                  [{file,&quot;proc_lib.erl&quot;},{line,239}]}]}}}
      in function  gen_server2:terminate/3 
    ancestors: [rabbit_amqqueue_sup,rabbit_sup,&lt;0.125.0&gt;]
    messages: []
    links: [&lt;0.247.0&gt;,&lt;0.1745.0&gt;,#Port&lt;0.22581&gt;]
    dictionary: [{{#Ref&lt;0.0.0.32922&gt;,fhc_handle},
                   {handle,{file_descriptor,prim_file,{#Port&lt;0.22581&gt;,853}},
                           0,false,0,infinity,[],true,
                          
&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at turtle-01</A>/queues/5U4MQIEI1ZAQX0119BWIV8SP0/journal.jif&quot;,
                           [write,binary,raw,read],
                           [{write_buffer,infinity}],
                           true,true,
                           {1380,94826,345789}}},
                 
{{&quot;/var/lib/rabbitmq/mnesia/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at turtle-01</A>/queues/5U4MQIEI1ZAQX0119BWIV8SP0/journal.jif&quot;,
                    fhc_file},
                   {file,1,true}},
                  {fhc_age_tree,{1,
                                 {{1380,94826,345789},
                                  #Ref&lt;0.0.0.32922&gt;,nil,nil}}},
                  {guid,{{4087053537,1505430215,3464040155,2830024215},1}}]
    trap_exit: true
    status: running
    heap_size: 2586
    stack_size: 27
    reductions: 3923
  neighbours:
    neighbour: [{pid,&lt;0.1746.0&gt;},
                  {registered_name,[]},
                  {initial_call,{gen,init_it,
                                     ['Argument__1','Argument__2',
                                      'Argument__3','Argument__4',
                                      'Argument__5','Argument__6']}},
                  {current_function,{gen_server2,process_next_msg,1}},
                  {ancestors,[&lt;0.1745.0&gt;,&lt;0.1142.0&gt;,rabbit_amqqueue_sup,
                              rabbit_sup,&lt;0.125.0&gt;]},
                  {messages,[]},
                  {links,[&lt;0.1745.0&gt;]},
                  {dictionary,[{random_seed,{1381,3909,13080}}]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,610},
                  {stack_size,7},
                  {reductions,213}]
    neighbour: [{pid,&lt;0.1745.0&gt;},
                  {registered_name,[]},
                  {initial_call,{gen,init_it,
                                     ['Argument__1','Argument__2',
                                      'Argument__3','Argument__4',
                                      'Argument__5','Argument__6']}},
                  {current_function,{gen_server2,process_next_msg,1}},
                  {ancestors,[&lt;0.1142.0&gt;,rabbit_amqqueue_sup,rabbit_sup,
                              &lt;0.125.0&gt;]},
                  {messages,[]},
                  {links,[&lt;0.1142.0&gt;,&lt;0.1746.0&gt;]},
                  {dictionary,[]},
                  {trap_exit,false},
                  {status,waiting},
                  {heap_size,233},
                  {stack_size,7},
                  {reductions,104}]

=SUPERVISOR REPORT==== 25-Sep-2013::07:40:26 ===
     Supervisor: {local,rabbit_amqqueue_sup}
     Context:    child_terminated
     Reason:     {bad_return_value,
                     {error,
                         {{badmatch,[]},
                          [{rabbit_mirror_queue_master,
                               '-init_with_existing_bq/3-fun-0-',3,[]},
                           {mnesia_tm,apply_fun,3,
                               [{file,&quot;mnesia_tm.erl&quot;},{line,830}]},
                           {mnesia_tm,execute_transaction,5,
                               [{file,&quot;mnesia_tm.erl&quot;},{line,810}]},
                           {rabbit_misc,
                               '-execute_mnesia_transaction/1-fun-0-',1,[]},
                           {worker_pool_worker,handle_call,3,[]},
                           {gen_server2,handle_msg,2,[]},
                           {proc_lib,init_p_do_apply,3,
                               [{file,&quot;proc_lib.erl&quot;},{line,239}]}]}}}
     Offender:   [{pid,&lt;0.1142.0&gt;},
                  {name,rabbit_amqqueue},
                  {mfa,
                      {rabbit_amqqueue_process,start_link,
                          [{amqqueue,
                               {resource,&lt;&lt;&quot;bizmvclr&quot;&gt;&gt;,queue,
                                   &lt;&lt;&quot;tmp_topic-0.2714721148367971&quot;&gt;&gt;},
                               true,true,&lt;0.9362.162&gt;,[],&lt;0.2758.162&gt;,[],[],
                               [{vhost,&lt;&lt;&quot;bizmvclr&quot;&gt;&gt;},
                                {name,&lt;&lt;&quot;HA&quot;&gt;&gt;},
                                {pattern,&lt;&lt;&quot;^(?!amq\\.).*&quot;&gt;&gt;},
                                {definition,[{&lt;&lt;&quot;ha-mode&quot;&gt;&gt;,&lt;&lt;&quot;all&quot;&gt;&gt;}]},
                                {priority,0}],
                               []}]}},
                  {restart_type,temporary},
                  {shutdown,4294967295},
                  {child_type,worker}]

And:

=SUPERVISOR REPORT==== 25-Sep-2013::07:08:10 ===
     Supervisor: {&lt;0.4774.372&gt;,rabbit_connection_sup}
     Context:    shutdown_error
     Reason:     channel_termination_timeout
     Offender:   [{pid,&lt;0.22496.371&gt;},
                  {name,reader},
                  {mfa,{rabbit_reader,start_link,
                                      [&lt;0.2222.372&gt;,&lt;0.28585.371&gt;,
                                       #Fun&lt;rabbit_heartbeat.2.69784259&gt;]}},
                  {restart_type,intrinsic},
                  {shutdown,4294967295},
                  {child_type,worker}]





--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-crash-report-tp29893.html">http://rabbitmq.1065348.n5.nabble.com/RabbitMQ-crash-report-tp29893.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030387.html">[rabbitmq-discuss] Nagios RabbitMQ Plugins (python based)
</A></li>
	<LI>Next message: <A HREF="030474.html">[rabbitmq-discuss] RabbitMQ crash report
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30390">[ date ]</a>
              <a href="thread.html#30390">[ thread ]</a>
              <a href="subject.html#30390">[ subject ]</a>
              <a href="author.html#30390">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
