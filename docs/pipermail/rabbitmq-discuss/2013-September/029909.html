<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbitmq up and running but	connection_closed_abruptly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20up%20and%20running%20but%0A%09connection_closed_abruptly&In-Reply-To=%3C36b02eaf-d4f9-45af-af4c-b1a43165b394%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029889.html">
   <LINK REL="Next"  HREF="029915.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbitmq up and running but	connection_closed_abruptly</H1>
    <B>Ken Henry</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbitmq%20up%20and%20running%20but%0A%09connection_closed_abruptly&In-Reply-To=%3C36b02eaf-d4f9-45af-af4c-b1a43165b394%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] Rabbitmq up and running but	connection_closed_abruptly">kenhen93 at gmail.com
       </A><BR>
    <I>Thu Sep  5 21:09:34 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029889.html">[rabbitmq-discuss] AutoHeal not working after yanking network	cable
</A></li>
        <LI>Next message: <A HREF="029915.html">[rabbitmq-discuss] Rabbitmq up and running but	connection_closed_abruptly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29909">[ date ]</a>
              <a href="thread.html#29909">[ thread ]</a>
              <a href="subject.html#29909">[ subject ]</a>
              <a href="author.html#29909">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am hoping you can help me as no one on the Zenoss forum is.

I am learning a lot about RabbitMQ during this troubleshooting process! :-)

I setup a two node veritas cluster running Zenoss which uses rabbitmq. In 
my configuration, i believe RabbitMQ does not know it is a cluster.

The cluster consists of a SAN drive this is switches between nodes on 
failover. Each node had rabbitmq installed then I move the mnesia database 
to the SAN drive and implemented a rabbitmq-env.conf

 tail /etc/rabbitmq/rabbitmq-env.conf
RABBITMQ_NODENAME=<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>
RABBITMQ_MNESIA_BASE=/opt/zenoss/rabbitmq
RABBITMQ_MNESIA_DIR=/opt/zenoss/rabbitmq/mnesia/rabbit\@localhost

By making the rabbitmq nodename localhost, I did not think it would have a 
problem with the failover as both hosts are localhost and it does not seem 
like there is a problem.

RabbitMQ runs fine on both hosts and host B gets an error when the Zenoss 
servers tries to connect to rabbitmq

=INFO REPORT==== 5-Sep-2013::15:11:36 ===
accepting AMQP connection &lt;0.470.0&gt; (127.0.0.1:44024 -&gt; 127.0.0.1:5672)

=WARNING REPORT==== 5-Sep-2013::15:11:36 ===
closing AMQP connection &lt;0.470.0&gt; (127.0.0.1:44024 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

service rabbitmq-server status
Status of node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A> ...
[{pid,9372},
 {running_applications,
     [{rabbitmq_management,&quot;RabbitMQ Management Console&quot;,&quot;2.8.7&quot;},
      {rabbitmq_management_agent,&quot;RabbitMQ Management Agent&quot;,&quot;2.8.7&quot;},
      {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;2.8.7&quot;},
      {rabbit,&quot;RabbitMQ&quot;,&quot;2.8.7&quot;},
      {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.7&quot;},
      {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.10&quot;},
      {rabbitmq_mochiweb,&quot;RabbitMQ Mochiweb Embedding&quot;,&quot;2.8.7&quot;},
      {webmachine,&quot;webmachine&quot;,&quot;1.9.1-rmq2.8.7-git52e62bc&quot;},
      {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;2.3.1-rmq2.8.7-gitd541e9a&quot;},
      {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.7.1&quot;},
      {xmerl,&quot;XML parser&quot;,&quot;1.2.10&quot;},
      {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.5&quot;},
      {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.17.5&quot;},
      {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.14.5&quot;}]},
 {os,{unix,linux}},
 {erlang_version,
     &quot;Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:24:24] [rq:24] 
[async-threads:30] [kernel-poll:true]\n&quot;},
 {memory,
     [{total,42808712},
      {processes,13595840},
      {processes_used,13579352},
      {system,29212872},
      {atom,1538337},
      {atom_used,1523802},
      {binary,3428320},
      {code,17183366},
      {ets,3819312}]},
 {vm_memory_high_watermark,0.4},
 {vm_memory_limit,60839985152},
 {disk_free_limit,1000000000},
 {disk_free,1029454253056},
 {file_descriptors,
     [{total_limit,924},
      {total_used,20},
      {sockets_limit,829},
      {sockets_used,10}]},
 {processes,[{limit,1048576},{used,303}]},
 {run_queue,0},
 {uptime,3704}]
...done.

rabbitmqctl list_connections
Listing connections ...
zenoss  127.0.0.1       43982   running
zenoss  127.0.0.1       43981   running
zenoss  127.0.0.1       43979   running
zenoss  127.0.0.1       43989   running
zenoss  127.0.0.1       43994   running
zenoss  127.0.0.1       43980   running
zenoss  127.0.0.1       43969   running
zenoss  127.0.0.1       43988   running
zenoss  127.0.0.1       43985   running
...done.

I am guessing these connections were made originally before the connection 
was closed abruptly?

Can anyone please help?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130905/d2a8aad7/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130905/d2a8aad7/attachment.htm</A>&gt;
</PRE>



















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029889.html">[rabbitmq-discuss] AutoHeal not working after yanking network	cable
</A></li>
	<LI>Next message: <A HREF="029915.html">[rabbitmq-discuss] Rabbitmq up and running but	connection_closed_abruptly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29909">[ date ]</a>
              <a href="thread.html#29909">[ thread ]</a>
              <a href="subject.html#29909">[ subject ]</a>
              <a href="author.html#29909">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
