<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Federation setup query
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20setup%20query&In-Reply-To=%3CDB14E94115BBC84E8960C12C176D06760127ECAD05%40MX25A.corp.emc.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030294.html">
   <LINK REL="Next"  HREF="030295.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Federation setup query</H1>
    <B>Jain, Punit</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20setup%20query&In-Reply-To=%3CDB14E94115BBC84E8960C12C176D06760127ECAD05%40MX25A.corp.emc.com%3E"
       TITLE="[rabbitmq-discuss] Federation setup query">Punit.Jain at emc.com
       </A><BR>
    <I>Mon Sep 23 07:23:27 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030294.html">[rabbitmq-discuss] Federation setup query
</A></li>
        <LI>Next message: <A HREF="030295.html">[rabbitmq-discuss] Can't Bind After Upgrading from 3.1.1 to 3.1.5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30324">[ date ]</a>
              <a href="thread.html#30324">[ thread ]</a>
              <a href="subject.html#30324">[ subject ]</a>
              <a href="author.html#30324">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Simon MacMullen [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>]
</I>&gt;<i> Sent: Friday, September 20, 2013 9:22 PM
</I>&gt;<i> To: Jain, Punit
</I>&gt;<i> Cc: Discussions about RabbitMQ
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] Federation setup query
</I>&gt;<i> 
</I>&gt;<i> On 20/09/2013 1:26PM, Jain, Punit wrote:
</I>&gt;<i> &gt; Hi, We are using federation setup with two URIs defined in an
</I>&gt;<i> &gt; upstream, as suggested by you. I simulated link failure by closing one
</I>&gt;<i> &gt; of the Ethernet port. I observed that it takes around 15-20 minutes to
</I>&gt;<i> &gt; switch link. Why is it taking this much time? Is there a way I can
</I>&gt;<i> &gt; decrease the switch time?
</I>&gt;<i> 
</I>&gt;<i> It should switch as soon as the &quot;old&quot; AMQP connection goes down - so check
</I>&gt;<i> your heartbeat settings.
</I>&gt;<i> 
</I>
I think it was set to default value which is 600. I changed it to 30 seconds on upstream.
Now it detects the failure in around a minute and changes the link.


&gt;<i> &gt; One more question: on the same setup, I stopped RabbitMQ server on
</I>&gt;<i> &gt; downstream and started it after few seconds. Sometimes the messages
</I>&gt;<i> &gt; published to upstream exchange during that duration are lost. Though,
</I>&gt;<i> &gt; they were present in the upstream queue during that period, but lost
</I>&gt;<i> &gt; after the downstream broker was started.
</I>&gt;<i> 
</I>&gt;<i> Hmm.
</I>&gt;<i> 
</I>&gt;<i> Of course that shouldn't be happening. How do you know they are lost? In
</I>&gt;<i> particular, it's possible for the downstream bindings to change while a link is
</I>&gt;<i> down, in which case messages can be queued on the upstream, then when the
</I>&gt;<i> link comes back they get transferred over and then dropped.
</I>&gt;<i> Could something like that be happening? The tracer might be helpful to see if
</I>&gt;<i> these messages are indeed getting published downstream.
</I>&gt;<i>
</I>

This behavior was observed when both links were up, but we just stopped and started the downstream broker. 
Bindings were not changed, there was only one queue listening to downstream stream with '#' routing key.
I will use tracer when I observe this next time.
 
Thank you, Simon.

&gt;<i> Cheers, Simon
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030294.html">[rabbitmq-discuss] Federation setup query
</A></li>
	<LI>Next message: <A HREF="030295.html">[rabbitmq-discuss] Can't Bind After Upgrading from 3.1.1 to 3.1.5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30324">[ date ]</a>
              <a href="thread.html#30324">[ thread ]</a>
              <a href="subject.html#30324">[ subject ]</a>
              <a href="author.html#30324">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
