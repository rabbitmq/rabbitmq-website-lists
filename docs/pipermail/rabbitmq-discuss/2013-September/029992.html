<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Mochiweb / SSL failing to boot on esl-erlang R16B01
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mochiweb%20/%20SSL%20failing%20to%20boot%20on%20esl-erlang%0A%20R16B01&In-Reply-To=%3C522EE312.6020705%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029991.html">
   <LINK REL="Next"  HREF="029996.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Mochiweb / SSL failing to boot on esl-erlang R16B01</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Mochiweb%20/%20SSL%20failing%20to%20boot%20on%20esl-erlang%0A%20R16B01&In-Reply-To=%3C522EE312.6020705%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Mochiweb / SSL failing to boot on esl-erlang R16B01">simon at rabbitmq.com
       </A><BR>
    <I>Tue Sep 10 10:14:58 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029991.html">[rabbitmq-discuss] Mochiweb / SSL failing to boot on esl-erlang	R16B01
</A></li>
        <LI>Next message: <A HREF="029996.html">[rabbitmq-discuss] Mochiweb / SSL failing to boot on esl-erlang R16B01
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29992">[ date ]</a>
              <a href="thread.html#29992">[ thread ]</a>
              <a href="subject.html#29992">[ subject ]</a>
              <a href="author.html#29992">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Can you confirm which version of RabbitMQ you're using? There was 
definitely a bug in this area that was fixed in 3.1.2.

If you're using &gt;= 3.1.2, are you using SSL *just* for mgmt? What 
happens if you enable it for AMQP as well?

Cheers, Simon

On 10/09/2013 10:03AM, Ceri Storey wrote:
&gt;<i> Hi there.
</I>&gt;<i>
</I>&gt;<i> We're using Erlang Solutions' packages of erlang for ubuntu
</I>&gt;<i> (specifically1:16.b.1-1~ubuntu~precise) , and there seems to be some bad
</I>&gt;<i> interaction between this, mochiweb, and ssl, meaning that the ASN1
</I>&gt;<i> application (seemingly) doesn't get started on boot, and rabbit crashes
</I>&gt;<i> trying to start the mochiweb listeners (crash logs below).
</I>&gt;<i>
</I>&gt;<i> The odd thing is, that with a version of R16B01 built from source with
</I>&gt;<i> kerl &lt;<A HREF="https://github.com/spawngrid/kerl">https://github.com/spawngrid/kerl</A>&gt;, everything works perfectly
</I>&gt;<i> well. Also, we can work around this by adding ssl as an application
</I>&gt;<i> dependency to either the mochiweb .app or the rabbit .app descriptor
</I>&gt;<i> files. But we'd like to understand this better, and get the root issue
</I>&gt;<i> fixed.
</I>&gt;<i>
</I>&gt;<i> I don't suppose that anyone could shed any light on this, perhaps?
</I>&gt;<i>
</I>&gt;<i> Thanks.
</I>&gt;<i>
</I>&gt;<i> ---
</I>&gt;<i>
</I>&gt;<i> -- Rabbit Log
</I>&gt;<i> =ERROR REPORT==== 9-Sep-2013::16:21:22 ===
</I>&gt;<i> ** Generic server rabbit_web_dispatch_registry terminating
</I>&gt;<i> ** Last message in was {add,rabbit_mgmt,
</I>&gt;<i>                             [{port,15672},
</I>&gt;<i>                              {ssl,true},
</I>&gt;<i>                              {ssl_opts,
</I>&gt;<i>                                  [{cacertfile,
</I>&gt;<i> &quot;/etc/ssl/certs/cacert.pem&quot;},
</I>&gt;<i>                                   {certfile,
</I>&gt;<i> &quot;/etc/ssl/certs/my-certfile.crt&quot;},
</I>&gt;<i>                                   {keyfile,
</I>&gt;<i> &quot;/etc/ssl/rabbit/my-certfile.key&quot;}]}],
</I>&gt;<i> #Fun&lt;rabbit_web_dispatch.1.31447083&gt;,
</I>&gt;<i> #Fun&lt;rabbit_mgmt_app.2.5043001&gt;,
</I>&gt;<i>                             {[],&quot;RabbitMQ Management&quot;}}
</I>&gt;<i> ** When Server state == undefined
</I>&gt;<i> ** Reason for termination ==
</I>&gt;<i> ** {could_not_start_listener,
</I>&gt;<i>         [{port,15672},
</I>&gt;<i>          {ssl,true},
</I>&gt;<i>          {ssl_opts,
</I>&gt;<i>              [{cacertfile,&quot;/etc/ssl/certs/cacert.pem&quot;},
</I>&gt;<i>               {certfile,&quot;/etc/ssl/certs/my-certfile.crt&quot;},
</I>&gt;<i> {keyfile,&quot;/etc/ssl/rabbit/my-certfile.key&quot;}]}],
</I>&gt;<i>         {'EXIT',
</I>&gt;<i>             {{case_clause,{error,{not_started,asn1}}},
</I>&gt;<i>              [{mochiweb,ensure_started,1,[]},
</I>&gt;<i>               {mochiweb_socket_server,prep_ssl,1,[]},
</I>&gt;<i>               {mochiweb_socket_server,start_server,2,[]},
</I>&gt;<i>               {supervisor,do_start_child,2,
</I>&gt;<i>                   [{file,&quot;supervisor.erl&quot;},{line,310}]},
</I>&gt;<i>               {supervisor,handle_start_child,2,
</I>&gt;<i>                   [{file,&quot;supervisor.erl&quot;},{line,681}]},
</I>&gt;<i> {supervisor,handle_call,3,[{file,&quot;supervisor.erl&quot;},{line,390}]},
</I>&gt;<i> {gen_server,handle_msg,5,[{file,&quot;gen_server.erl&quot;},{line,585}]},
</I>&gt;<i>               {proc_lib,init_p_do_apply,3,
</I>&gt;<i>                   [{file,&quot;proc_lib.erl&quot;},{line,239}]}]}}}
</I>&gt;<i>
</I>&gt;<i> -- Sasl log
</I>&gt;<i>
</I>&gt;<i> =CRASH REPORT==== 9-Sep-2013::16:21:22 ===
</I>&gt;<i>    crasher:
</I>&gt;<i>      initial call: rabbit_web_dispatch_registry:init/1
</I>&gt;<i>      pid: &lt;0.258.0&gt;
</I>&gt;<i>      registered_name: rabbit_web_dispatch_registry
</I>&gt;<i>      exception exit: {could_not_start_listener,
</I>&gt;<i>                          [{port,15672},
</I>&gt;<i>                           {ssl,true},
</I>&gt;<i>                           {ssl_opts,
</I>&gt;<i> [{cacertfile,&quot;/etc/ssl/certs/cacert.pem&quot;},
</I>&gt;<i>                                {certfile,
</I>&gt;<i> &quot;/etc/ssl/certs/my-certfile.crt&quot;},
</I>&gt;<i>                                {keyfile,
</I>&gt;<i> &quot;/etc/ssl/rabbit/my-certfile.key&quot;}]}],
</I>&gt;<i>                          {'EXIT',
</I>&gt;<i> {{case_clause,{error,{not_started,asn1}}},
</I>&gt;<i> [{mochiweb,ensure_started,1,[]},
</I>&gt;<i> {mochiweb_socket_server,prep_ssl,1,[]},
</I>&gt;<i> {mochiweb_socket_server,start_server,2,[]},
</I>&gt;<i>                                {supervisor,do_start_child,2,
</I>&gt;<i> [{file,&quot;supervisor.erl&quot;},{line,310}]},
</I>&gt;<i> {supervisor,handle_start_child,2,
</I>&gt;<i> [{file,&quot;supervisor.erl&quot;},{line,681}]},
</I>&gt;<i>                                {supervisor,handle_call,3,
</I>&gt;<i> [{file,&quot;supervisor.erl&quot;},{line,390}]},
</I>&gt;<i>                                {gen_server,handle_msg,5,
</I>&gt;<i> [{file,&quot;gen_server.erl&quot;},{line,585}]},
</I>&gt;<i>                                {proc_lib,init_p_do_apply,3,
</I>&gt;<i> [{file,&quot;proc_lib.erl&quot;},{line,239}]}]}}}
</I>&gt;<i>        in function  gen_server:terminate/6 (gen_server.erl, line 744)
</I>&gt;<i>      ancestors: [rabbit_web_dispatch_sup,&lt;0.256.0&gt;]
</I>&gt;<i>      messages: []
</I>&gt;<i>      links: [&lt;0.257.0&gt;]
</I>&gt;<i>      dictionary: []
</I>&gt;<i>      trap_exit: false
</I>&gt;<i>      status: running
</I>&gt;<i>      heap_size: 4185
</I>&gt;<i>      stack_size: 27
</I>&gt;<i>      reductions: 594
</I>&gt;<i>    neighbours:
</I>&gt;<i>
</I>&gt;<i> =SUPERVISOR REPORT==== 9-Sep-2013::16:21:22 ===
</I>&gt;<i>       Supervisor: {local,rabbit_web_dispatch_sup}
</I>&gt;<i>       Context:    child_terminated
</I>&gt;<i>       Reason:     {could_not_start_listener,
</I>&gt;<i>                       [{port,15672},
</I>&gt;<i>                        {ssl,true},
</I>&gt;<i>                        {ssl_opts,
</I>&gt;<i> [{cacertfile,&quot;/etc/ssl/certs/cacert.pem&quot;},
</I>&gt;<i>                             {certfile,
</I>&gt;<i> &quot;/etc/ssl/certs/my-certfile.crt&quot;},
</I>&gt;<i>                             {keyfile,
</I>&gt;<i> &quot;/etc/ssl/rabbit/my-certfile.key&quot;}]}],
</I>&gt;<i>                       {'EXIT',
</I>&gt;<i> {{case_clause,{error,{not_started,asn1}}},
</I>&gt;<i>                            [{mochiweb,ensure_started,1,[]},
</I>&gt;<i> {mochiweb_socket_server,prep_ssl,1,[]},
</I>&gt;<i> {mochiweb_socket_server,start_server,2,[]},
</I>&gt;<i>                             {supervisor,do_start_child,2,
</I>&gt;<i> [{file,&quot;supervisor.erl&quot;},{line,310}]},
</I>&gt;<i> {supervisor,handle_start_child,2,
</I>&gt;<i> [{file,&quot;supervisor.erl&quot;},{line,681}]},
</I>&gt;<i>                             {supervisor,handle_call,3,
</I>&gt;<i> [{file,&quot;supervisor.erl&quot;},{line,390}]},
</I>&gt;<i>                             {gen_server,handle_msg,5,
</I>&gt;<i> [{file,&quot;gen_server.erl&quot;},{line,585}]},
</I>&gt;<i>                             {proc_lib,init_p_do_apply,3,
</I>&gt;<i> [{file,&quot;proc_lib.erl&quot;},{line,239}]}]}}}
</I>&gt;<i>       Offender:   [{pid,&lt;0.258.0&gt;},
</I>&gt;<i>                    {name,rabbit_web_dispatch_registry},
</I>&gt;<i> {mfargs,{rabbit_web_dispatch_registry,start_link,[]}},
</I>&gt;<i>                    {restart_type,transient},
</I>&gt;<i>                    {shutdown,5000},
</I>&gt;<i>                    {child_type,worker}]
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> =CRASH REPORT==== 9-Sep-2013::16:21:22 ===
</I>&gt;<i>    crasher:
</I>&gt;<i>      initial call: application_master:init/4
</I>&gt;<i>      pid: &lt;0.260.0&gt;
</I>&gt;<i>      registered_name: []
</I>&gt;<i>      exception exit: {bad_return,
</I>&gt;<i>                       {{rabbit_mgmt_app,start,[normal,[]]},
</I>&gt;<i>                        {'EXIT',
</I>&gt;<i>                         {{could_not_start_listener,
</I>&gt;<i>                           [{port,15672},
</I>&gt;<i>                            {ssl,true},
</I>&gt;<i>                            {ssl_opts,
</I>&gt;<i> [{cacertfile,&quot;/etc/ssl/certs/cacert.pem&quot;},
</I>&gt;<i>                              {certfile,
</I>&gt;<i> &quot;/etc/ssl/certs/my-certfile.crt&quot;},
</I>&gt;<i>                              {keyfile,
</I>&gt;<i> &quot;/etc/ssl/rabbit/my-certfile.key&quot;}]}],
</I>&gt;<i>                           {'EXIT',
</I>&gt;<i> {{case_clause,{error,{not_started,asn1}}},
</I>&gt;<i>                             [{mochiweb,ensure_started,1,[]},
</I>&gt;<i> {mochiweb_socket_server,prep_ssl,1,[]},
</I>&gt;<i> {mochiweb_socket_server,start_server,2,[]},
</I>&gt;<i>                              {supervisor,do_start_child,2,
</I>&gt;<i> [{file,&quot;supervisor.erl&quot;},{line,310}]},
</I>&gt;<i> {supervisor,handle_start_child,2,
</I>&gt;<i> [{file,&quot;supervisor.erl&quot;},{line,681}]},
</I>&gt;<i>                              {supervisor,handle_call,3,
</I>&gt;<i> [{file,&quot;supervisor.erl&quot;},{line,390}]},
</I>&gt;<i>                              {gen_server,handle_msg,5,
</I>&gt;<i> [{file,&quot;gen_server.erl&quot;},{line,585}]},
</I>&gt;<i>                              {proc_lib,init_p_do_apply,3,
</I>&gt;<i> [{file,&quot;proc_lib.erl&quot;},{line,239}]}]}}},
</I>&gt;<i>                          {gen_server,call,
</I>&gt;<i>                           [rabbit_web_dispatch_registry,
</I>&gt;<i>                            {add,rabbit_mgmt,
</I>&gt;<i>                             [{port,15672},
</I>&gt;<i>                              {ssl,true},
</I>&gt;<i>                              {ssl_opts,
</I>&gt;<i> [{cacertfile,&quot;/etc/ssl/certs/cacert.pem&quot;},
</I>&gt;<i>                                {certfile,
</I>&gt;<i> &quot;/etc/ssl/certs/my-certfile.crt&quot;},
</I>&gt;<i>                                {keyfile,
</I>&gt;<i> &quot;/etc/ssl/rabbit/my-certfile.key&quot;}]}],
</I>&gt;<i> #Fun&lt;rabbit_web_dispatch.1.31447083&gt;,
</I>&gt;<i> #Fun&lt;rabbit_mgmt_app.2.5043001&gt;,
</I>&gt;<i>                             {[],&quot;RabbitMQ Management&quot;}},
</I>&gt;<i>                            infinity]}}}}}
</I>&gt;<i>        in function  application_master:init/4 (application_master.erl,
</I>&gt;<i> line 133)
</I>&gt;<i>      ancestors: [&lt;0.259.0&gt;]
</I>&gt;<i>      messages: [{'EXIT',&lt;0.261.0&gt;,normal}]
</I>&gt;<i>      links: [&lt;0.259.0&gt;,&lt;0.7.0&gt;]
</I>&gt;<i>      dictionary: []
</I>&gt;<i>      trap_exit: true
</I>&gt;<i>      status: running
</I>&gt;<i>      heap_size: 4185
</I>&gt;<i>      stack_size: 27
</I>&gt;<i>      reductions: 423
</I>&gt;<i>    neighbours:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>
-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029991.html">[rabbitmq-discuss] Mochiweb / SSL failing to boot on esl-erlang	R16B01
</A></li>
	<LI>Next message: <A HREF="029996.html">[rabbitmq-discuss] Mochiweb / SSL failing to boot on esl-erlang R16B01
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29992">[ date ]</a>
              <a href="thread.html#29992">[ thread ]</a>
              <a href="subject.html#29992">[ subject ]</a>
              <a href="author.html#29992">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
