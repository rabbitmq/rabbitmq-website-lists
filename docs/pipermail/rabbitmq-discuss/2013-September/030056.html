<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Strange behaviour of RabbitMQ or client when network problems occurs
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Strange%20behaviour%20of%20RabbitMQ%20or%20client%20when%0A%20network%20problems%20occurs&In-Reply-To=%3C1378979267460-29553.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030048.html">
   <LINK REL="Next"  HREF="030058.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Strange behaviour of RabbitMQ or client when network problems occurs</H1>
    <B>Haster</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Strange%20behaviour%20of%20RabbitMQ%20or%20client%20when%0A%20network%20problems%20occurs&In-Reply-To=%3C1378979267460-29553.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] Strange behaviour of RabbitMQ or client when network problems occurs">haster2004 at yandex.ru
       </A><BR>
    <I>Thu Sep 12 10:47:47 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030048.html">[rabbitmq-discuss] RabbitMQ Clustering issue - (2x Virtual Box OpenSuse machines) (NOOB)
</A></li>
        <LI>Next message: <A HREF="030058.html">[rabbitmq-discuss] Strange behaviour of RabbitMQ or client when	network problems occurs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30056">[ date ]</a>
              <a href="thread.html#30056">[ thread ]</a>
              <a href="subject.html#30056">[ subject ]</a>
              <a href="author.html#30056">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there!

I have a program that receive messages from RabbitMQ. The program loop is
like below:

init();
basic.consume();

while (1) {
  msg = read_message();
  if (!msg) {
     deinit();
    amqp_delete_connection (...);    // (1)
     sleep(5);
     init();
   }

  int res = process_message();
  if(res) {
   if (amqp_basic_ack(..) &lt; 0) {
     deinit();
    amqp_delete_connection (...);     // (2)
     sleep(5);
     init();
    }
  }
}


In our test we send 100 messages to server after that starts our program and
sometimes make network problems (by firewall REJECT).
And in result we get 11 duplicated messages and only to times we were in
point (2), where
we couldn't send ack.
I can't understand where from 9 duplicated messages come? 

And one more question:
I use prefetch count = 20, for example if we processed 5 messages and after
that network problem occured why the next received message is 25? I thought
that if we close connection and don't send ack messages should stay in
previous order.



--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Strange-behaviour-of-RabbitMQ-or-client-when-network-problems-occurs-tp29553.html">http://rabbitmq.1065348.n5.nabble.com/Strange-behaviour-of-RabbitMQ-or-client-when-network-problems-occurs-tp29553.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030048.html">[rabbitmq-discuss] RabbitMQ Clustering issue - (2x Virtual Box OpenSuse machines) (NOOB)
</A></li>
	<LI>Next message: <A HREF="030058.html">[rabbitmq-discuss] Strange behaviour of RabbitMQ or client when	network problems occurs
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30056">[ date ]</a>
              <a href="thread.html#30056">[ thread ]</a>
              <a href="subject.html#30056">[ subject ]</a>
              <a href="author.html#30056">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
