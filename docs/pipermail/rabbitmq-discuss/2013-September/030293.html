<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Federation setup query
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20setup%20query&In-Reply-To=%3CDB14E94115BBC84E8960C12C176D06760127ECAC47%40MX25A.corp.emc.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030492.html">
   <LINK REL="Next"  HREF="030294.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Federation setup query</H1>
    <B>Jain, Punit</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Federation%20setup%20query&In-Reply-To=%3CDB14E94115BBC84E8960C12C176D06760127ECAC47%40MX25A.corp.emc.com%3E"
       TITLE="[rabbitmq-discuss] Federation setup query">Punit.Jain at emc.com
       </A><BR>
    <I>Fri Sep 20 13:26:25 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030492.html">[rabbitmq-discuss] Performance and load testing of RMQ
</A></li>
        <LI>Next message: <A HREF="030294.html">[rabbitmq-discuss] Federation setup query
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30293">[ date ]</a>
              <a href="thread.html#30293">[ thread ]</a>
              <a href="subject.html#30293">[ subject ]</a>
              <a href="author.html#30293">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,
We are using federation setup with two URIs defined in an upstream, as suggested by you. I simulated link failure by closing one of the Ethernet port. I observed that it takes around 15-20 minutes to switch link. Why is it taking this much time? Is there a way I can decrease the switch time?

One more question: on the same setup, I stopped RabbitMQ server on downstream and started it after few seconds. Sometimes the messages published to upstream exchange during that duration are lost. Though, they were present in the upstream queue during that period, but lost after the downstream broker was started.

Thanks,
Punit

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Jain, Punit
</I>&gt;<i> Sent: Monday, August 05, 2013 10:45 PM
</I>&gt;<i> To: 'Simon MacMullen'; Discussions about RabbitMQ
</I>&gt;<i> Subject: RE: [rabbitmq-discuss] Federation setup query
</I>&gt;<i> 
</I>&gt;<i> Thanks a lot Simon for detailed explanation, this answers my questions
</I>&gt;<i> precisely.
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Simon MacMullen [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>]
</I>&gt;<i> Sent: Monday, August 05, 2013 10:22 PM
</I>&gt;<i> To: Discussions about RabbitMQ
</I>&gt;<i> Cc: Jain, Punit
</I>&gt;<i> Subject: Re: [rabbitmq-discuss] Federation setup query
</I>&gt;<i> 
</I>&gt;<i> On 05/08/13 15:24, Jain, Punit wrote:
</I>&gt;<i> &gt; I want to setup federation b/w two brokers called A (Downstream) and B
</I>&gt;<i> &gt; (Upstream). We have redundant network link between these two brokers.
</I>&gt;<i> &gt; B has two IPs, named IP1 and IP2. I have setup federation in following
</I>&gt;<i> &gt; way
</I>&gt;<i> 
</I>&gt;<i> &lt;snip&gt;
</I>&gt;<i> 
</I>&gt;<i> &gt; I have tested this setup and it is working fine. I have few questions
</I>&gt;<i> &gt; regarding this setup:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; *Is it wise to create a single upstream with two uris? Or the above
</I>&gt;<i> &gt; setup is good and will provide network high availability incase if a
</I>&gt;<i> &gt; network link goes down?
</I>&gt;<i> 
</I>&gt;<i> I would create a single upstream with two URIs. Both configurations will
</I>&gt;<i> provide network high availability, but if you have two upstreams you can see
</I>&gt;<i> messages being reordered.
</I>&gt;<i> 
</I>&gt;<i> &gt; *Though we have specified two upstream, but when we list exchanges and
</I>&gt;<i> &gt; queues on broker B it shows only one x-federation-upstream and a
</I>&gt;<i> &gt; single upstream queue
</I>&gt;<i> 
</I>&gt;<i> These objects are identified in the upstream broker by the name of the
</I>&gt;<i> downstream broker - therefore if you have a single downstream connecting
</I>&gt;<i> more than once you will have multiple federation links sharing the same queue
</I>&gt;<i> / exchange. This is not how it's designed to work.
</I>&gt;<i> 
</I>&gt;<i> &gt; and there is no duplication of messages. This is the exact behavior we
</I>&gt;<i> &gt; expect, but I want to understand that how does RabbitMQ achieve this
</I>&gt;<i> &gt; behavior and avoid duplication. It would be a great help if you can
</I>&gt;<i> &gt; point me to some documentation or a link.
</I>&gt;<i> 
</I>&gt;<i> There won't be duplication since there's only one upstream queue.
</I>&gt;<i> However since you have two links consuming from it and publishing to the
</I>&gt;<i> same exchange, messages can overtake each other and become reordered.
</I>&gt;<i> Also the links will consider themselves to each own the x-federation-upstream
</I>&gt;<i> exchange and the upstream queue; they may tread on each others toes here.
</I>&gt;<i> So...
</I>&gt;<i> 
</I>&gt;<i> &gt; Any suggestion or advice to improve this configuration.
</I>&gt;<i> 
</I>&gt;<i> ...you shouldn't point two upstreams to the same cluster.
</I>&gt;<i> 
</I>&gt;<i> Cheers, Simon
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030492.html">[rabbitmq-discuss] Performance and load testing of RMQ
</A></li>
	<LI>Next message: <A HREF="030294.html">[rabbitmq-discuss] Federation setup query
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30293">[ date ]</a>
              <a href="thread.html#30293">[ thread ]</a>
              <a href="subject.html#30293">[ subject ]</a>
              <a href="author.html#30293">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
