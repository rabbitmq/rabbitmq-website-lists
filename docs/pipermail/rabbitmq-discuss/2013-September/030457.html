<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] msg_store_transient usage question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20msg_store_transient%20usage%20question&In-Reply-To=%3CCAMcAHLXPYp5hDuQ1Ek-qv5jfqiAQ53NxRZ2w_oCUr81LnT94Pw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030456.html">
   <LINK REL="Next"  HREF="030458.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] msg_store_transient usage question</H1>
    <B>Alvaro Videla</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20msg_store_transient%20usage%20question&In-Reply-To=%3CCAMcAHLXPYp5hDuQ1Ek-qv5jfqiAQ53NxRZ2w_oCUr81LnT94Pw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] msg_store_transient usage question">videlalvaro at gmail.com
       </A><BR>
    <I>Thu Sep 26 18:21:55 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030456.html">[rabbitmq-discuss] msg_store_transient usage question
</A></li>
        <LI>Next message: <A HREF="030458.html">[rabbitmq-discuss] msg_store_transient usage question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30457">[ date ]</a>
              <a href="thread.html#30457">[ thread ]</a>
              <a href="subject.html#30457">[ subject ]</a>
              <a href="author.html#30457">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Simon,

That pages says this:

It is possible to set vm_memory_high_watermark_paging_ratio to a greater
value than 1.0. In this case queues will not page their contents to disc.

What would happen then? Will RabbitMQ stop receiving messages? Drop
messages?

Cheers,

Alvaro


On Thu, Sep 26, 2013 at 3:39 AM, Simon MacMullen &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">simon at rabbitmq.com</A>&gt; wrote:

&gt;<i> On 26/09/2013 4:37AM, Peter Wright wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> i was hoping someone could help explain to me under what circumstances
</I>&gt;&gt;<i> messages are written to the msg_store_transient directory.  i have been
</I>&gt;&gt;<i> witnessing this directory grow to 10's of GB - infact it spun out of
</I>&gt;&gt;<i> control at one point consuming almost 100G of space.  i do have a queue
</I>&gt;&gt;<i> with quite a few messages ready for consumption, yet when i monitor
</I>&gt;&gt;<i> memory utilization for this queue it rarely spikes above 20MB.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The memory use reported by the queue does not include message bodies
</I>&gt;<i> (since these are shared across queues). Also it does not include anything
</I>&gt;<i> that's been paged out, so if messages are paging out it can be quite low
</I>&gt;<i> anyway.
</I>&gt;<i>
</I>&gt;<i> The decision as to whether to page messages is made globally based on how
</I>&gt;<i> much memory is in use. All released versions of RabbitMQ (since 2.0.0 when
</I>&gt;<i> the persister was rewritten) will start to page out when 20% of the way to
</I>&gt;<i> the high watermark. By default the high watermark is at 40% of physical
</I>&gt;<i> memory, so paging will start at 8% memory used.
</I>&gt;<i>
</I>&gt;<i> That's probably too cautious, so the next release (3.2.x) will raise the
</I>&gt;<i> paging ratio from 20% to 50% (so paging will start at 20% memory used by
</I>&gt;<i> default) and also make it configurable. See <A HREF="http://next.rabbitmq.com/**">http://next.rabbitmq.com/**</A>
</I>&gt;<i> memory.html#memsup-paging&lt;<A HREF="http://next.rabbitmq.com/memory.html#memsup-paging">http://next.rabbitmq.com/memory.html#memsup-paging</A>&gt;
</I>&gt;<i>
</I>&gt;<i> Having said that, if msg_store_transient grows to 100GB of space, I
</I>&gt;<i> suspect you probably have 100GB of messages. If you don't have 100GB of
</I>&gt;<i> RAM, you're going to page out...
</I>&gt;<i>
</I>&gt;<i> Hope this helps.
</I>&gt;<i>
</I>&gt;<i> Cheers, Simon
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Simon MacMullen
</I>&gt;<i> RabbitMQ, Pivotal
</I>&gt;<i> ______________________________**_________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.</A>**rabbitmq.com&lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>&gt;
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/**cgi-bin/mailman/listinfo/**rabbitmq-discuss&lt;https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>&gt;
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130926/d6e4a9ce/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130926/d6e4a9ce/attachment.htm</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030456.html">[rabbitmq-discuss] msg_store_transient usage question
</A></li>
	<LI>Next message: <A HREF="030458.html">[rabbitmq-discuss] msg_store_transient usage question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30457">[ date ]</a>
              <a href="thread.html#30457">[ thread ]</a>
              <a href="subject.html#30457">[ subject ]</a>
              <a href="author.html#30457">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
