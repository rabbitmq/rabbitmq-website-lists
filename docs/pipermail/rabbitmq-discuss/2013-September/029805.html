<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] RabbitMQ queue durability question
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20queue%20durability%20question&In-Reply-To=%3C5225B50F.90004%40econsys.co.za%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029801.html">
   <LINK REL="Next"  HREF="029807.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] RabbitMQ queue durability question</H1>
    <B>Jan Jacobs</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20RabbitMQ%20queue%20durability%20question&In-Reply-To=%3C5225B50F.90004%40econsys.co.za%3E"
       TITLE="[rabbitmq-discuss] RabbitMQ queue durability question">janj at econsys.co.za
       </A><BR>
    <I>Tue Sep  3 11:08:15 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029801.html">[rabbitmq-discuss] RabbitMQ queue durability question
</A></li>
        <LI>Next message: <A HREF="029807.html">[rabbitmq-discuss] RabbitMQ queue durability question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29805">[ date ]</a>
              <a href="thread.html#29805">[ thread ]</a>
              <a href="subject.html#29805">[ subject ]</a>
              <a href="author.html#29805">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Emile

Thanks for your response.

On 03/09/2013 10:50, Emile Joubert wrote:
&gt;<i> Hi Jan,
</I>&gt;<i>
</I>&gt;<i> On 03/09/13 08:59, Jan Jacobs wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> A queue is created by the server or the client
</I>&gt;<i> Are you sure the server and client declare a queue with the same attributes?
</I>I am using libraries in the respective implementations.
Server:
I am using the amqp_rpc_server from the amqp_client.
 From the source code:

     process_flag( trap_exit, true ),

     %% Get config from config file for the server and port
     Params =
     #amqp_params_network
     {
         username  = amqp_conf:username()
         ,password = amqp_conf:password()
         ,host     = amqp_conf:server()
         ,port     = amqp_conf:port()
     },

     try amqp_connection:start( Params ) of
         {ok, Connection}
         -&gt;
             {
                 ok
                 ,State#state
                 {
                   connection    = Connection
                   ,time_started = {date(), time()}
                   ,server       = amqp_rpc_server:start( Connection, 
State#state.queue, State#state.handler )
                 }
             }
     catch
         _:Reason -&gt; {stop, Reason}
     end

Client:
I am using the RabbitMQ plugin for Grails:

// RabbitMQ
rabbitmq
{
     connectionfactory
     {
         username = 'guest';
         password = 'guest';
         hostname = '127.0.0.1';
         consumers = 1;
     }

     retryPolicy {
         maxAttempts = 3
     }

     queues =
     {
         'unitrac.application.MaxManV1.RPC'()
     }
}

 From the documentation:
&quot; the|autoDelete|,|durable|and|exclusive|attributes default to|false|and 
the|arguments|attribute defaults to null.&quot;

&gt;<i>
</I>&gt;&gt;<i> If the client and the server is active and the broker restarts then the
</I>&gt;&gt;<i> broker change the queue durability to |durable|: true and it survives
</I>&gt;&gt;<i> the restart.
</I>&gt;<i> That is not possible, because the non-durable queue is not present on
</I>&gt;<i> startup. The broker can't change the queue durability, and neither can a
</I>&gt;<i> client. A queue must be deleted before the durability or any other
</I>&gt;<i> attribute can be changed.
</I>&gt;<i>
</I>&gt;<i> A possible explanation is that the server and client don't create the
</I>&gt;<i> queue with the same attributes, and you see different behaviour
</I>&gt;<i> depending on which one gets to declare the queue.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -Emile
</I>&gt;<i>
</I>
According to me the server and the client declare the queue with the 
same attributes, but I will investigate more by only having one of them 
active when I restart the broker. That will indicate which one is 
responsible.

Thanks
-- 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130903/a98c2f1b/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130903/a98c2f1b/attachment.htm</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: JanEmailSignature.gif
Type: image/gif
Size: 9261 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130903/a98c2f1b/attachment.gif">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130903/a98c2f1b/attachment.gif</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: janj.vcf
Type: text/x-vcard
Size: 167 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130903/a98c2f1b/attachment.vcf">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130903/a98c2f1b/attachment.vcf</A>&gt;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029801.html">[rabbitmq-discuss] RabbitMQ queue durability question
</A></li>
	<LI>Next message: <A HREF="029807.html">[rabbitmq-discuss] RabbitMQ queue durability question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29805">[ date ]</a>
              <a href="thread.html#29805">[ thread ]</a>
              <a href="subject.html#29805">[ subject ]</a>
              <a href="author.html#29805">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
