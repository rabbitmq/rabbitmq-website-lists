<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Help with topics not working from Pika
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Help%20with%20topics%20not%20working%20from%20Pika&In-Reply-To=%3C52272FFC.2030905%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029832.html">
   <LINK REL="Next"  HREF="029834.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Help with topics not working from Pika</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Help%20with%20topics%20not%20working%20from%20Pika&In-Reply-To=%3C52272FFC.2030905%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Help with topics not working from Pika">simon at rabbitmq.com
       </A><BR>
    <I>Wed Sep  4 14:05:00 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029832.html">[rabbitmq-discuss] Help with topics not working from Pika
</A></li>
        <LI>Next message: <A HREF="029834.html">[rabbitmq-discuss] Help with topics not working from Pika
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29833">[ date ]</a>
              <a href="thread.html#29833">[ thread ]</a>
              <a href="subject.html#29833">[ subject ]</a>
              <a href="author.html#29833">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Because both receivers declare a queue with the same name, they both get 
the same queue. Each message can only exist once in a queue, so 
therefore you distribute the messages between the two receivers.

To get each (matching) message routed to each receiver, each receiver 
needs its own queue, and hence its own queue name. The simplest way to 
do this is with server-named queues as discussed in tutorial 3.

Cheers, Simon

On 04/09/13 13:57, Darren Govoni wrote:
&gt;<i> Hi,
</I>&gt;<i>    I have a bizarre situation with topics working and not working in
</I>&gt;<i> pika. Pretty sure this is a bug of some kind.
</I>&gt;<i> I adapted the topic pub/sub example slightly and found that it doesn't
</I>&gt;<i> act like a topic anymore, but a direct queue.
</I>&gt;<i>
</I>&gt;<i> Clearly these two files establish a topic exchange and bind a queue to
</I>&gt;<i> it and should thus behave like a topic,
</I>&gt;<i> but it behaves like a direct queue only.
</I>&gt;<i>
</I>&gt;<i> Step 1. In one window run &quot;python receive_1.py _workflow&quot;
</I>&gt;<i> Step 2. In another window run &quot;python receive_1.py _workflow&quot;
</I>&gt;<i> Step 3. In a third window run &quot;python emit_1.py _workflow&quot;
</I>&gt;<i>
</I>&gt;<i> Only one of the receivers gets the message. If you continue to run
</I>&gt;<i> emit_1.py
</I>&gt;<i> it distributes between your two receivers.
</I>&gt;<i>
</I>&gt;<i> Can I not declare a queue name and bind it to a topic exchange? It seems
</I>&gt;<i> not.
</I>&gt;<i>
</I>&gt;<i> Here are the files:
</I>&gt;<i>
</I>&gt;<i> emit_1.py
</I>&gt;<i> ============================================
</I>&gt;<i> #!/usr/bin/env python
</I>&gt;<i> import pika
</I>&gt;<i> import sys
</I>&gt;<i>
</I>&gt;<i> connection = pika.BlockingConnection(pika.ConnectionParameters(
</I>&gt;<i>          host='localhost'))
</I>&gt;<i> channel = connection.channel()
</I>&gt;<i>
</I>&gt;<i> channel.exchange_declare(exchange='workflow',
</I>&gt;<i>                           type='topic')
</I>&gt;<i>
</I>&gt;<i> routing_key = sys.argv[1] if len(sys.argv) &gt; 1 else 'anonymous.info'
</I>&gt;<i> message = ' '.join(sys.argv[2:]) or 'Hello World!'
</I>&gt;<i> channel.basic_publish(exchange='workflow',
</I>&gt;<i>                        routing_key=routing_key,
</I>&gt;<i>                        body=message)
</I>&gt;<i> print &quot; [x] Sent %r:%r&quot; % (routing_key, message)
</I>&gt;<i> connection.close()
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> and receive_1.py
</I>&gt;<i> ============================================
</I>&gt;<i> #!/usr/bin/env python
</I>&gt;<i> import pika
</I>&gt;<i> import sys
</I>&gt;<i>
</I>&gt;<i> connection = pika.BlockingConnection(pika.ConnectionParameters(
</I>&gt;<i>          host='localhost'))
</I>&gt;<i> channel = connection.channel()
</I>&gt;<i>
</I>&gt;<i> channel.exchange_declare(exchange='workflow',
</I>&gt;<i>                           type='topic')
</I>&gt;<i>
</I>&gt;<i> result = channel.queue_declare(queue='workflow')
</I>&gt;<i> queue_name = result.method.queue
</I>&gt;<i>
</I>&gt;<i> binding_keys = sys.argv[1:]
</I>&gt;<i> if not binding_keys:
</I>&gt;<i>      print &gt;&gt; sys.stderr, &quot;Usage: %s [binding_key]...&quot; % (sys.argv[0],)
</I>&gt;<i>      sys.exit(1)
</I>&gt;<i>
</I>&gt;<i> for binding_key in binding_keys:
</I>&gt;<i>      print &quot;binding_key &quot;,binding_key
</I>&gt;<i>      channel.queue_bind(exchange='workflow',
</I>&gt;<i>                         queue=queue_name,
</I>&gt;<i>                         routing_key=binding_key)
</I>&gt;<i>
</I>&gt;<i> print ' [*] Waiting for logs. To exit press CTRL+C'
</I>&gt;<i>
</I>&gt;<i> def callback(ch, method, properties, body):
</I>&gt;<i>      print &quot; [x] %r:%r&quot; % (method.routing_key, body,)
</I>&gt;<i>
</I>&gt;<i> channel.basic_consume(callback,
</I>&gt;<i>                        queue=queue_name,
</I>&gt;<i>                        no_ack=True)
</I>&gt;<i>
</I>&gt;<i> channel.start_consuming()
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>

-- 
Simon MacMullen
RabbitMQ, Pivotal
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029832.html">[rabbitmq-discuss] Help with topics not working from Pika
</A></li>
	<LI>Next message: <A HREF="029834.html">[rabbitmq-discuss] Help with topics not working from Pika
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29833">[ date ]</a>
              <a href="thread.html#29833">[ thread ]</a>
              <a href="subject.html#29833">[ subject ]</a>
              <a href="author.html#29833">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
