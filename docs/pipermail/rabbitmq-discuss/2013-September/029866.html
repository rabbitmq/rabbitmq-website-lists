<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Connections made to slaves when a master fail (and a slave is promoted) stop receiving messages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Connections%20made%20to%20slaves%20when%20a%20master%0A%20fail%20%28and%20a%20slave%20is%20promoted%29%20stop%20receiving%20messages&In-Reply-To=%3C3CE1D10F927704449D41EF6BCB35373D41775C%40hermes%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029864.html">
   <LINK REL="Next"  HREF="029858.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Connections made to slaves when a master fail (and a slave is promoted) stop receiving messages</H1>
    <B>Tobias Gutzmann</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Connections%20made%20to%20slaves%20when%20a%20master%0A%20fail%20%28and%20a%20slave%20is%20promoted%29%20stop%20receiving%20messages&In-Reply-To=%3C3CE1D10F927704449D41EF6BCB35373D41775C%40hermes%3E"
       TITLE="[rabbitmq-discuss] Connections made to slaves when a master fail (and a slave is promoted) stop receiving messages">Tobias.Gutzmann at ist.com
       </A><BR>
    <I>Thu Sep  5 08:01:52 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029864.html">[rabbitmq-discuss] Connections made to slaves when a master fail (and a slave is promoted) stop receiving messages
</A></li>
        <LI>Next message: <A HREF="029858.html">[rabbitmq-discuss] Regarding Rabbitmq server doubt
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29866">[ date ]</a>
              <a href="thread.html#29866">[ thread ]</a>
              <a href="subject.html#29866">[ subject ]</a>
              <a href="author.html#29866">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

It&#8217;s not HA specific but in general a clustering issue. As far as I can tell, it&#8217;s a miss in the AMQP 0.9.1 specification, but luckily there is a RabbitMQ specific extension called &#8220;consumer cancellation&#8221;: <A HREF="http://www.rabbitmq.com/consumer-cancel.html">http://www.rabbitmq.com/consumer-cancel.html</A>
RabbitMQ 2.8 broker supports that, the question is if your client does.

Regards,
Tobias


Fr&#229;n: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A> [mailto:<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss-bounces at lists.rabbitmq.com</A>] F&#246;r Guillermo L&#243;pez Leal
Skickat: den 4 september 2013 22:55
Till: <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at googlegroups.com</A>
&#196;mne: [rabbitmq-discuss] Connections made to slaves when a master fail (and a slave is promoted) stop receiving messages

Hi guys,

after complaining about RabbitMQ HA mode in twitter[1], I got a response by &#193;lvaro (@old_sound)[2] stating that I should post my problem here. Fair enough, here are my details:

Architecture: simple RabbitMQ 2.8.x cluster with two machines.
Usage: really simple pub-sub on a topic. Nothing fancy. Queues on 'all' mirroring.
Library: node-amqp for Node.js [3], v0.1.7, as published on npm, not on github)

The symptons are:

1) We connect to several logical brokers from each of our nodes. This means that we are connected to the master and slaves of each queue.
2) When the master fails, RabbitMQ selects the eldest slave and promotes to be the master.
3) &quot;The slave considers all previous consumers to have been abruptly disconnected.&quot;[4] So we end up with the connections NOT being closed but not binded to any queue, and no information from RabbitMQ to the &quot;slave&quot; consumers. This means that we have the connection, we do not have any error message, but we stop receiving any further messages.

I have read the documentation and I think this is the expected behaviour, but I'm more than open to improve our code to solve this problems.

Thanks,

Guillermo


[1] <A HREF="https://twitter.com/willyaranda/status/375343649896538112">https://twitter.com/willyaranda/status/375343649896538112</A>
[2] <A HREF="https://twitter.com/old_sound/status/375353677319376896">https://twitter.com/old_sound/status/375353677319376896</A>
[3] <A HREF="https://github.com/postwait/node-amqp">https://github.com/postwait/node-amqp</A>
[4] <A HREF="http://www.rabbitmq.com/ha.html">http://www.rabbitmq.com/ha.html</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130905/fe3dfa57/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130905/fe3dfa57/attachment.htm</A>&gt;
</PRE>



























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029864.html">[rabbitmq-discuss] Connections made to slaves when a master fail (and a slave is promoted) stop receiving messages
</A></li>
	<LI>Next message: <A HREF="029858.html">[rabbitmq-discuss] Regarding Rabbitmq server doubt
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29866">[ date ]</a>
              <a href="thread.html#29866">[ thread ]</a>
              <a href="subject.html#29866">[ subject ]</a>
              <a href="author.html#29866">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
