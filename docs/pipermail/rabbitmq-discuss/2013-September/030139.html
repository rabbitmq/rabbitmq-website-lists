<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Proper process to change erlang cookie?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Proper%20process%20to%20change%20erlang%20cookie%3F&In-Reply-To=%3CCAMcAHLX4Q3V_dT74kCDdMm%3DMs1Kh8nU1G5XcRtB__gkObGc_vw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030135.html">
   <LINK REL="Next"  HREF="030186.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Proper process to change erlang cookie?</H1>
    <B>Alvaro Videla</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Proper%20process%20to%20change%20erlang%20cookie%3F&In-Reply-To=%3CCAMcAHLX4Q3V_dT74kCDdMm%3DMs1Kh8nU1G5XcRtB__gkObGc_vw%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Proper process to change erlang cookie?">videlalvaro at gmail.com
       </A><BR>
    <I>Sat Sep 14 18:51:56 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030135.html">[rabbitmq-discuss]  Re:  Proper process to change erlang cookie?
</A></li>
        <LI>Next message: <A HREF="030186.html">[rabbitmq-discuss]  Re:  Proper process to change erlang cookie?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30139">[ date ]</a>
              <a href="thread.html#30139">[ thread ]</a>
              <a href="subject.html#30139">[ subject ]</a>
              <a href="author.html#30139">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You will have one Erlang cookie per user that started a distributed Erlang
VM. Say you run RrabbitMQ as the user &quot;rabbit&quot;. Erlang will create a cookie
for that user.

Then with your own user you try to run rabbitmqctl. That will create an
Erlang cookie in your home folder, and that cookie _won't_ match the one
created for RabbitMQ. What you have to do is either make sure both files
have the same content, or set the cookie during startup, or update it
afterwards to match the one of the other node you are trying to connect to.

See: <A HREF="http://www.erlang.org/doc/reference_manual/distributed.html#id83622">http://www.erlang.org/doc/reference_manual/distributed.html#id83622</A>


On Fri, Sep 13, 2013 at 3:45 PM, Ben Hsu &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ben.hsu at criticalmedia.com</A>&gt; wrote:

&gt;<i> Thank you Alvaro,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I understand  the difference between rabbitmq-server and rabbitmqctl now.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm still not able to copy or edit the Erlang cookie without killing the
</I>&gt;<i> process. I see two different .erlang.cookie files: one in /var/lib/rabbitmq
</I>&gt;<i> and one in the users home directory. I copied the first to the second and
</I>&gt;<i> still got the &quot;unable to connect&quot; problem
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I am running version 3.1.3.1 on CentOS
</I>&gt;<i> -- Ben HsuSent with Airmail &lt;<A HREF="http://airmailapp.com/tracking">http://airmailapp.com/tracking</A>&gt;
</I>&gt;<i>
</I>&gt;<i> On September 13, 2013 at 7:39:41 PM, Ben Hsu (<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">ben.hsu at criticalmedia.com</A>)
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;<i> The Erlang cookie belongs to each particular user on your machines.
</I>&gt;<i> The cookie can be found on ~/.erlang.cookie and you need to have the same
</I>&gt;<i> value there for every node in the cluster.
</I>&gt;<i>
</I>&gt;<i> start_app stops the Rabbit application inside the Erlang VM but the VM has
</I>&gt;<i> to be running for that to work.
</I>&gt;<i>
</I>&gt;<i> stop_app will stop the rabbit app, but not the Erlang VM
</I>&gt;<i>
</I>&gt;<i> rabbitmq-server takes care of preparing the env parameters and starting
</I>&gt;<i> the Erlang VM to then run RabbitMQ on it.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Alvaro
</I>&gt;<i>
</I>&gt;<i> On Friday, September 13, 2013, Ben Hsu wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hello all
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I need to change the erlang cookie on my RabbitMQ server to get
</I>&gt;&gt;<i> clustering working, and wish to know the correct procedure.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I tried doing this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> rabbitmqctl stop_app
</I>&gt;&gt;<i> vi /var/lib/rabbitmq/.erlang.cookie
</I>&gt;&gt;<i> rabbitmqctl start_app # this gave me an error message: *Error: unable to
</I>&gt;&gt;<i> connect to node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ben-amqp-test4</A>': nodedown*
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> By trial and error, I found this worked:
</I>&gt;&gt;<i> pkill beam
</I>&gt;&gt;<i> pkill epmd
</I>&gt;&gt;<i> vi /var/lib/rabbitmq/.erlang.cookie
</I>&gt;&gt;<i> rabbitmq-server
</I>&gt;&gt;<i> # now in a separate window, for some reason it didn't work with
</I>&gt;&gt;<i> rabbitmq-server -detached
</I>&gt;&gt;<i> rabbitmqctl start_app
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That seemed to work, but is ugly, and doesn't feel like the right way of
</I>&gt;&gt;<i> doing it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Also, what is the difference between &quot;rabbitmqctl start_app&quot; and
</I>&gt;&gt;<i> &quot;rabbitmq-server&quot;?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks in advance
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Ben Hsu
</I>&gt;&gt;<i> Sent with Airmail &lt;<A HREF="http://airmailapp.com/tracking">http://airmailapp.com/tracking</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130914/8a5cd094/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130914/8a5cd094/attachment.htm</A>&gt;
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030135.html">[rabbitmq-discuss]  Re:  Proper process to change erlang cookie?
</A></li>
	<LI>Next message: <A HREF="030186.html">[rabbitmq-discuss]  Re:  Proper process to change erlang cookie?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30139">[ date ]</a>
              <a href="thread.html#30139">[ thread ]</a>
              <a href="subject.html#30139">[ subject ]</a>
              <a href="author.html#30139">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
