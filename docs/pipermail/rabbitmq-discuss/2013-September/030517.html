<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] problem with ncreasing response times
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20problem%20with%20ncreasing%20response%20times&In-Reply-To=%3CCAFztWsv17jz%2B27B-rcbKLa%3D5RtH%2BsRUT7kj42gkNt%3DHZZROiig%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030514.html">
   <LINK REL="Next"  HREF="030518.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] problem with ncreasing response times</H1>
    <B>tgv amni</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20problem%20with%20ncreasing%20response%20times&In-Reply-To=%3CCAFztWsv17jz%2B27B-rcbKLa%3D5RtH%2BsRUT7kj42gkNt%3DHZZROiig%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] problem with ncreasing response times">tgvt53 at gmail.com
       </A><BR>
    <I>Sun Sep 29 20:50:17 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030514.html">[rabbitmq-discuss] ANN php-amqplib adds support for protocol	extensions
</A></li>
        <LI>Next message: <A HREF="030518.html">[rabbitmq-discuss] problem with increasing response times
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30517">[ date ]</a>
              <a href="thread.html#30517">[ thread ]</a>
              <a href="subject.html#30517">[ subject ]</a>
              <a href="author.html#30517">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We use rabbitmq 3.1.5. This is installed on a red hat linux server (6.4),
the same server where our application is also running. The database
(postgresql) is on a separate server.

I ran a test where concurrent users post to a rest service (say R). This
service basically expects  two UUIDs (UUID_A and UUID_B), that identify two
database entities  A and B. Once the service is called with these two
values, it publishes to the default exchange. There are two queues bound to
this exchange. QueueA and QueueB. Two services,  Service A and Service B,
each listen on QueueA and QueueB respectively.  There are no other
consumers to these queues. Service A picks up the message and validates  UUID_A
exists in the database. Service B validates UUID_B exists. If they are both
valid, an entry is made to the db, mapping these two values.
I find as the test progresses, response  time of this overall post
increases.  A lot of the time is being spent in  Unsafe.park (boolean,long)
in sun.misc package.
Here is the call stack that shows classes where this being involved from.
It appears to be called from spring framework&#8217;s RabbitTemplate class.

A problem with increasing response times.

We use rabbitmq 3.1.5. This is installed on a red hat linux server (6.4),
the same server where our application is also running. The database
(postgresql) is on a separate server.

I ran a test where concurrent users post to a rest service (say R). This
service basically expects  two UUIDs (UUID_A and UUID_B), that identify two
database entities  A and B. Once the service is called with these two
values, it publishes to the default exchange. There are two queues bound to
this exchange. QueueA and QueueB. Two services,  Service A and Service B,
each listen on QueueA and QueueB respectively.  There are no other
consumers to these queues. Service A picks up the message and validates  UUID_A
exists in the database. Service B validates UUID_B exists. If they are both
valid, an entry is made to the db, mapping these two values.

I find as the test progresses, response  time of this overall post
increases.  A lot of the time is being spent in  Unsafe.park (boolean,long)
in sun.misc package. I am wondering why this is so&#8230;

Here is the call stack that shows classes where this being involved from.
It appears to be called from spring framework&#8217;s RabbitTemplate class.

Unsafe.park

-LockSupportparkNanos(Object,Long)



As the test progresses where the load increases from 50 users to 200 users
over a period of 20 mins, this response time increases from 50 ms to almost
2 seconds. 99% of the response time is spent in Unsafe.park.

Why is this so ? It looks like there is a wait for some resource lock. I am
not sure why this wait increases with time/ load.

We are using  rabbitMQ default configuration. Everyone is new to rabbitMQ,
so we haven&#8217;t changed any of the default parameters.



Also is there a plug-in to monitor cpu usage on the broker ?

Thanks



 As the test progresses where the load increases from 50 users to 200 users
over a period of 20 mins, this response time increases from 50 ms to almost
2 seconds. 99% of the response time is spent in Unsafe.park.

Why is this so ? It looks like there is a wait for some resource lock. I am
not sure why this wait increases with time/ load.

We are using  rabbitMQ default configuration. Everyone is new to rabbitMQ,
so we haven&#8217;t changed any of the default parameters.



Also is there a plug-in to monitor cpu usage on the broker ?

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130929/d82ea2b9/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130929/d82ea2b9/attachment.htm</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030514.html">[rabbitmq-discuss] ANN php-amqplib adds support for protocol	extensions
</A></li>
	<LI>Next message: <A HREF="030518.html">[rabbitmq-discuss] problem with increasing response times
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30517">[ date ]</a>
              <a href="thread.html#30517">[ thread ]</a>
              <a href="subject.html#30517">[ subject ]</a>
              <a href="author.html#30517">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
