<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How do the Producer gets response from the subscribers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20do%20the%20Producer%20gets%20response%20from%20the%0A%20subscribers&In-Reply-To=%3C52400705.3000600%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030277.html">
   <LINK REL="Next"  HREF="030272.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How do the Producer gets response from the subscribers</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20do%20the%20Producer%20gets%20response%20from%20the%0A%20subscribers&In-Reply-To=%3C52400705.3000600%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] How do the Producer gets response from the subscribers">matthias at rabbitmq.com
       </A><BR>
    <I>Mon Sep 23 10:16:53 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030277.html">[rabbitmq-discuss] How do the Producer gets response from the	subscribers
</A></li>
        <LI>Next message: <A HREF="030272.html">[rabbitmq-discuss] RabbitMQ Meetup in Santa Monica 10/18 (Fri) -	seeking venue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30329">[ date ]</a>
              <a href="thread.html#30329">[ thread ]</a>
              <a href="subject.html#30329">[ subject ]</a>
              <a href="author.html#30329">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 19/09/13 13:15, ramkkk wrote:
&gt;<i> Producer the sends a command to the consumer  to spawn the process . so each
</I>&gt;<i> consumer has to give the response back to the Producer ..
</I>&gt;<i>
</I>&gt;<i>   but i am not getting the response back to the Producer, consumer is going
</I>&gt;<i> on the infinite loop...
</I>&gt;<i> [...]
</I>&gt;<i> consumer code
</I>&gt;<i> [...]
</I>&gt;<i>      def on_request(self,ch, method, props, body):
</I>&gt;<i>          self.spawn_processes(2)
</I>&gt;<i>          self.response = [process.pid for process in self.spawned_processes]
</I>&gt;<i>          ch.basic_publish(exchange='logs',
</I>&gt;<i>                       routing_key='',
</I>&gt;<i>                       properties=pika.BasicProperties(correlation_id = \
</I>&gt;<i>                                                       props.correlation_id,
</I>&gt;<i>                                                       delivery_mode=2 ,
</I>&gt;<i>                                                       ),
</I>&gt;<i>
</I>&gt;<i>                       body=str(self.response))
</I>&gt;<i>          ch.basic_ack(delivery_tag = method.delivery_tag)
</I>
The consumer is publishing the response to the 'logs' exchange with a '' 
routing key, whereas...

&gt;<i> Producer
</I>&gt;<i> [...]
</I>&gt;<i>      def __init__(self):
</I>&gt;<i>          self.connection = pika.BlockingConnection(pika.ConnectionParameters(
</I>&gt;<i>                  host='localhost'))
</I>&gt;<i>          self.channel = self.connection.channel()
</I>&gt;<i>          self.channel.exchange_declare(exchange='logs',
</I>&gt;<i>                           type='fanout')
</I>&gt;<i>          result = self.channel.queue_declare(exclusive=True)
</I>&gt;<i>          self.callback_queue = result.method.queue
</I>&gt;<i>
</I>&gt;<i>          self.channel.basic_qos(prefetch_count=1)
</I>&gt;<i>          self.channel.basic_consume(self.on_response, no_ack=True,
</I>&gt;<i>                                     queue=self.callback_queue)
</I>
...the producer is expecting replies on an exclusive, server-named queue.

Clearly that isn't going to work. And because the 'logs' exchange is 
also the exchange on which the consumer queue is bound you end up with 
the 'infinite loop' at the consumer since the response published by the 
consumer will be consumed by the consumer!

You need to change your consumer to publish the response to the default 
exchange ('') with the routing_key taken from props.reply_to of the request.

Matthias.
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030277.html">[rabbitmq-discuss] How do the Producer gets response from the	subscribers
</A></li>
	<LI>Next message: <A HREF="030272.html">[rabbitmq-discuss] RabbitMQ Meetup in Santa Monica 10/18 (Fri) -	seeking venue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30329">[ date ]</a>
              <a href="thread.html#30329">[ thread ]</a>
              <a href="subject.html#30329">[ subject ]</a>
              <a href="author.html#30329">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
