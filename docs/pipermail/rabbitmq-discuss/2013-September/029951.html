<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Broken Pipe in RabbitMQ	ConnectionFactory.newConnection()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Broken%20Pipe%20in%20RabbitMQ%0A%09ConnectionFactory.newConnection%28%29&In-Reply-To=%3C522D3B66.8060704%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029950.html">
   <LINK REL="Next"  HREF="029957.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Broken Pipe in RabbitMQ	ConnectionFactory.newConnection()</H1>
    <B>Matthias Radestock</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Broken%20Pipe%20in%20RabbitMQ%0A%09ConnectionFactory.newConnection%28%29&In-Reply-To=%3C522D3B66.8060704%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Broken Pipe in RabbitMQ	ConnectionFactory.newConnection()">matthias at rabbitmq.com
       </A><BR>
    <I>Mon Sep  9 04:07:18 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029950.html">[rabbitmq-discuss] Broken Pipe in RabbitMQ	ConnectionFactory.newConnection()
</A></li>
        <LI>Next message: <A HREF="029957.html">[rabbitmq-discuss] Broken Pipe in RabbitMQ	ConnectionFactory.newConnection()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29951">[ date ]</a>
              <a href="thread.html#29951">[ thread ]</a>
              <a href="subject.html#29951">[ subject ]</a>
              <a href="author.html#29951">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 08/09/13 23:04, Michael Klishin wrote:
&gt;<i> I can imagine there are potential issues in connection shutdown code
</I>&gt;<i> in some clients
</I>
But there shouldn't be. If so, there's a bug that I'd rather see fixed. 
I don't think there is though...

The OP's problem has all the hallmarks of the client, server, or network 
being overloaded. The &quot;{handshake_timeout,frame_header}&quot; in the logs 
indicates that the connection establishment handshake took longer than 
10 seconds. The reported connection.close hang is another indication. To 
the OP: it should not hang indefinitely; it would be good to find out 
how long it takes to return and what 'rabbitmqctl list_connections' says 
at the time.

&gt;<i> Consider using a long-lived connection
</I>
That's good advise. I also recommend re-using the temporary reply 
queues; creating one queue per rpc is really inefficient. And finally, 
get rid of the semi-busy loop in the consuming code. What's the point of 
calling nextDelivery with a 100ms timeout, when the code simply loops 
around on timeout?!

Oh, and another thing...

The code is setting an expiry on the published message. If that ever 
gets triggered, then no reply will be sent and the code becomes stuck 
going round the aforementioned consumer loop forever.

Regards,

Matthias.
</PRE>






















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029950.html">[rabbitmq-discuss] Broken Pipe in RabbitMQ	ConnectionFactory.newConnection()
</A></li>
	<LI>Next message: <A HREF="029957.html">[rabbitmq-discuss] Broken Pipe in RabbitMQ	ConnectionFactory.newConnection()
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29951">[ date ]</a>
              <a href="thread.html#29951">[ thread ]</a>
              <a href="subject.html#29951">[ subject ]</a>
              <a href="author.html#29951">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
