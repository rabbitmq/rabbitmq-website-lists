<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Lower delivery rate than publish rate - why?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lower%20delivery%20rate%20than%20publish%20rate%20-%20why%3F&In-Reply-To=%3C2F8BD3B1-939D-49CD-84CC-403D5799460C%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="029849.html">
   <LINK REL="Next"  HREF="029856.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Lower delivery rate than publish rate - why?</H1>
    <B>Tim Watson</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Lower%20delivery%20rate%20than%20publish%20rate%20-%20why%3F&In-Reply-To=%3C2F8BD3B1-939D-49CD-84CC-403D5799460C%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] Lower delivery rate than publish rate - why?">tim at rabbitmq.com
       </A><BR>
    <I>Wed Sep  4 21:00:35 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="029849.html">[rabbitmq-discuss] Lower delivery rate than publish rate - why?
</A></li>
        <LI>Next message: <A HREF="029856.html">[rabbitmq-discuss] Lower delivery rate than publish rate - why?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29854">[ date ]</a>
              <a href="thread.html#29854">[ thread ]</a>
              <a href="subject.html#29854">[ subject ]</a>
              <a href="author.html#29854">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As I said to Tyson, if you ant more specific guidance then you'll need to provide further information about how you are consuming, what your topology looks like and so on. It's great that the cluster topology, environment details and use of HA and durability are specified, but how many queues are we talking about, how many consumers per queue, how are consumers configured, etc etc? Feel free to post that info and we can try to point out what might be causing this kind of behaviour. For just one example, if a network connection to one of the consumers is slow, or a consumer is slow to respond, and you have prefect-count set to 1, then *all* the consumers will be affected.

Cheers,
Tim

On 4 Sep 2013, at 19:21, <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">sergey at openbridge.com</A> wrote:

&gt;<i> I would also like to hear the answer to this question, because my situation is almost identical. And we thought it's a network problem, and about to move to the bigger instance type, just for the test.
</I>&gt;<i> 
</I>&gt;<i> On Saturday, August 31, 2013 7:30:24 PM UTC-4, Tyson Stewart wrote:
</I>&gt;<i> Hello everyone!
</I>&gt;<i> 
</I>&gt;<i> We've been experiencing some behavior that I don't understand, and none of my searching or documentation-reading has been fruitful, so I'm here to ask you all for expert knowledge.
</I>&gt;<i> 
</I>&gt;<i> Broadly, we're seeing a lower delivery rate than publish rate. I've attached an image to this message that shows how we're able to keep up when the publish rate is less than 600 messages/second, but above that, consumption falls behind publication. Around 16:00 on that chart, we doubled the number of consumers, and it made no difference that we could tell. The erratic behavior of the publish rate is us turning off publishes of the most active queue because we were falling far enough behind that we became worried. When the backlog would get low enough, we would turn it back on, and we did that a few times.
</I>&gt;<i> 
</I>&gt;<i> Here are some vitals to our cluster:
</I>&gt;<i> 2 nodes
</I>&gt;<i> Each node is a m1.xlarge instance hosted in EC2
</I>&gt;<i> We have 133 queues in the cluster (see note below)
</I>&gt;<i> All queues are mirrored (they all use a policy that makes them highly available)
</I>&gt;<i> All queues are durable; we use AWS provisioned IOPS to guarantee enough throughput
</I>&gt;<i> We only use the direct exchange
</I>&gt;<i> Regarding the number of queues, there are four kinds: the &quot;main&quot; queues, retry-a queues, retry-b queues, and poison queues. Messages that fail for whatever reason during consumption will get put into the retry queues, and if they fail long enough, they'll wind up in the poison queue where they will stay until we do something with them manually much later. The main queues then see the majority of activity.
</I>&gt;<i> 
</I>&gt;<i> The average message size is less than 1MB. At nearly one million messages, we were still under 1GB of memory usage, and our high watermark is 5.9GB. 
</I>&gt;<i> 
</I>&gt;<i> Disk IOPS don't appear to be the problem. Metrics indicated we still had plenty of headroom. Furthermore, if IOPS were the limitation, I would have expected the delivery rate to increase as the publish rate decreased while the consumers worked through the queue. It did not, however, as shown on the chart.
</I>&gt;<i> 
</I>&gt;<i> My question primarily is: What do you think is limiting our consumption rate? I'm curious about what affects consumption rate in general, though. Any advice would be appreciated at this point. Questions for clarification are also welcome!
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130904/52393cf3/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130904/52393cf3/attachment.htm</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="029849.html">[rabbitmq-discuss] Lower delivery rate than publish rate - why?
</A></li>
	<LI>Next message: <A HREF="029856.html">[rabbitmq-discuss] Lower delivery rate than publish rate - why?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29854">[ date ]</a>
              <a href="thread.html#29854">[ thread ]</a>
              <a href="subject.html#29854">[ subject ]</a>
              <a href="author.html#29854">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
