<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Getting SocketTimeoutException on java Producer client during load testing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Getting%20SocketTimeoutException%20on%20java%0A%20Producer%20client%20during%20load%20testing&In-Reply-To=%3CCALfRy2cs6ZPA%2BZ%2BW7NycvrUM19mnwKCMRj1qKkEr1dW-m8PyHQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="030038.html">
   <LINK REL="Next"  HREF="030040.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Getting SocketTimeoutException on java Producer client during load testing</H1>
    <B>Sean Stephens</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Getting%20SocketTimeoutException%20on%20java%0A%20Producer%20client%20during%20load%20testing&In-Reply-To=%3CCALfRy2cs6ZPA%2BZ%2BW7NycvrUM19mnwKCMRj1qKkEr1dW-m8PyHQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Getting SocketTimeoutException on java Producer client during load testing">errant01 at gmail.com
       </A><BR>
    <I>Wed Sep 11 18:19:21 BST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="030038.html">[rabbitmq-discuss] Getting SocketTimeoutException on java	Producer client during load testing
</A></li>
        <LI>Next message: <A HREF="030040.html">[rabbitmq-discuss] Suddenly dropping all conns?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30039">[ date ]</a>
              <a href="thread.html#30039">[ thread ]</a>
              <a href="subject.html#30039">[ subject ]</a>
              <a href="author.html#30039">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On my last test attempt, this is what I received in the rabbitmq log

=WARNING REPORT==== 11-Sep-2013::16:02:40 ===
file descriptor limit alarm set.

********************************************************************
*** New connections will not be accepted until this alarm clears ***
********************************************************************


After running 2 separate loads with only 1 thread driving the load, 500
msgs ran on the producer and 500 were consumed. on the second, only 230
ran... totalling 730 which gets close to the default connection limit.
Apparently I'm doing something wrong with my Producer connections.

I've set the FD limit on the linux server to something abnormally high
(1024000), so it shouldn't be the OS causing the problem.

And just to close the loop.... problem is solved now. I was creating a new
connection for each sent message and not closing it.  The proper way to do
it is to create one shared connection and open new channels on that
connection for each send. The thing to remember is to close the connections
on client reset.

Thanks for your help!


On Wed, Sep 11, 2013 at 10:44 AM, Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>&gt;wrote:

&gt;<i> Sean Stephens:
</I>&gt;<i>
</I>&gt;<i> &gt; My belief at this point is that my producer load has overrun the
</I>&gt;<i> connection factory pool in writing to the queues.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I have been unable to locate information on settings related to the
</I>&gt;<i> connection factory pool to make it larger or change the timeout.  When the
</I>&gt;<i> connections do timeout, it doesn't look like the pool catches up unless I
</I>&gt;<i> kill the Producer application.  Anyone have advice on how to get past this
</I>&gt;<i> issue?
</I>&gt;<i>
</I>&gt;<i> ConnectionFactory does not pool connections. Can you take a look at
</I>&gt;<i> rabbitmq log to see if
</I>&gt;<i> there are any warnings about alarms and blocked publishers?
</I>&gt;<i>
</I>&gt;<i> &gt; Is there a way to throttle the load at the Producer connection, or will
</I>&gt;<i> it be necessary to just add more nodes to handle the incoming load?
</I>&gt;<i>
</I>&gt;<i> You can implement throttling logic in your own code but in general, you
</I>&gt;<i> need to have enough
</I>&gt;<i> consumer capacity to keep up with producers, or RabbitMQ will block
</I>&gt;<i> connections that publish
</I>&gt;<i> (there will be a very visible warning in the log).
</I>&gt;<i>
</I>&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130911/81315d89/attachment.htm">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20130911/81315d89/attachment.htm</A>&gt;
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="030038.html">[rabbitmq-discuss] Getting SocketTimeoutException on java	Producer client during load testing
</A></li>
	<LI>Next message: <A HREF="030040.html">[rabbitmq-discuss] Suddenly dropping all conns?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#30039">[ date ]</a>
              <a href="thread.html#30039">[ thread ]</a>
              <a href="subject.html#30039">[ subject ]</a>
              <a href="author.html#30039">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
