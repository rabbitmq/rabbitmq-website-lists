<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Possible memory leak in the management plugin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20memory%20leak%20in%20the%20management%20plugin&In-Reply-To=%3C1397185961431-34791.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035235.html">
   <LINK REL="Next"  HREF="035248.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Possible memory leak in the management plugin</H1>
    <B>Pavel</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20memory%20leak%20in%20the%20management%20plugin&In-Reply-To=%3C1397185961431-34791.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] Possible memory leak in the management plugin">pmaisenovich at blizzard.com
       </A><BR>
    <I>Fri Apr 11 04:12:41 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035235.html">[rabbitmq-discuss] Possible memory leak in the management plugin
</A></li>
        <LI>Next message: <A HREF="035248.html">[rabbitmq-discuss] Possible memory leak in the management plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35236">[ date ]</a>
              <a href="thread.html#35236">[ thread ]</a>
              <a href="subject.html#35236">[ subject ]</a>
              <a href="author.html#35236">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm attaching three tests data. 

In Test 2 and 3 there was 1000 channels x 999 exchanges with only difference
in publish rate. Both tests led to Rabbit running OOM (high watermark) and
throttling publishers. One new thing I noted after plotting the
mgmt_stats_db used memory is that it spikes rapidly shortly before
throttling triggered. This is not related to continuous aggregated_stats
growth (or it doesn't seem so), but also very concerning.

In Test 4 (which is still running) I've reduced number of channels and
exchanges by half (500 and 499) to prove the theory of aggregated_stats
growth. As you can see from the plot, the number of items in
aggregated_stats table have not changed for about an hour, yet the size of
the table continues to grow. It's worth noting, that while Rabbit didn't
reach high watermark (current usage is [{total,2884223408},
{mgmt_db,1764414344}]) in this test (yet), the management plugin UI is
completely unresponsive. The test continues to publish at a steady 500/s
rate and I'll leave for the night to see how far it will push the RAM.

Test_2_-_1000ch_x_999ex_sequential_publish_with_2ms_delay_(300_per_sec)_-_2_hours.xlsx
&lt;<A HREF="http://rabbitmq.1065348.n5.nabble.com/file/n34791/Test_2_-_1000ch_x_999ex_sequential_publish_with_2ms_delay_%28300_per_sec%29_-_2_hours.xlsx">http://rabbitmq.1065348.n5.nabble.com/file/n34791/Test_2_-_1000ch_x_999ex_sequential_publish_with_2ms_delay_%28300_per_sec%29_-_2_hours.xlsx</A>&gt;  

Test_3_-_1000ch_x_999ex_sequential_publish_with_3ms_delay_(250_per_sec)_-_1_hour.xlsx
&lt;<A HREF="http://rabbitmq.1065348.n5.nabble.com/file/n34791/Test_3_-_1000ch_x_999ex_sequential_publish_with_3ms_delay_%28250_per_sec%29_-_1_hour.xlsx">http://rabbitmq.1065348.n5.nabble.com/file/n34791/Test_3_-_1000ch_x_999ex_sequential_publish_with_3ms_delay_%28250_per_sec%29_-_1_hour.xlsx</A>&gt;  

Test_4_-_500ch_x_499ex_sequential_publish_with_1ms_delay_(500_per_sec).xlsx
&lt;<A HREF="http://rabbitmq.1065348.n5.nabble.com/file/n34791/Test_4_-_500ch_x_499ex_sequential_publish_with_1ms_delay_%28500_per_sec%29.xlsx">http://rabbitmq.1065348.n5.nabble.com/file/n34791/Test_4_-_500ch_x_499ex_sequential_publish_with_1ms_delay_%28500_per_sec%29.xlsx</A>&gt;  



--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Possible-memory-leak-in-the-management-plugin-tp27414p34791.html">http://rabbitmq.1065348.n5.nabble.com/Possible-memory-leak-in-the-management-plugin-tp27414p34791.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035235.html">[rabbitmq-discuss] Possible memory leak in the management plugin
</A></li>
	<LI>Next message: <A HREF="035248.html">[rabbitmq-discuss] Possible memory leak in the management plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35236">[ date ]</a>
              <a href="thread.html#35236">[ thread ]</a>
              <a href="subject.html#35236">[ subject ]</a>
              <a href="author.html#35236">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
