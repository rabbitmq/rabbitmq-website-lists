<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] [RUBY-AMQP GEM] How do we can retry publish message on errors?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5BRUBY-AMQP%20GEM%5D%20How%20do%20we%20can%20retry%20publish%0A%20message%20on%20errors%3F&In-Reply-To=%3CCAD_i5MEhPpYxzZE10CKgw2F9A9u5iY4E3%2B3htG%3DoFrdYa8b5hA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035567.html">
   <LINK REL="Next"  HREF="035569.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] [RUBY-AMQP GEM] How do we can retry publish message on errors?</H1>
    <B>Loganathan Sellapa</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20%5BRUBY-AMQP%20GEM%5D%20How%20do%20we%20can%20retry%20publish%0A%20message%20on%20errors%3F&In-Reply-To=%3CCAD_i5MEhPpYxzZE10CKgw2F9A9u5iY4E3%2B3htG%3DoFrdYa8b5hA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] [RUBY-AMQP GEM] How do we can retry publish message on errors?">loganathan.ms at gmail.com
       </A><BR>
    <I>Mon Apr 28 14:04:29 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035567.html">[rabbitmq-discuss] [RUBY-AMQP GEM] How do we can retry publish message on errors?
</A></li>
        <LI>Next message: <A HREF="035569.html">[rabbitmq-discuss] [RUBY-AMQP GEM] How do we can retry publish message on errors?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35568">[ date ]</a>
              <a href="thread.html#35568">[ thread ]</a>
              <a href="subject.html#35568">[ subject ]</a>
              <a href="author.html#35568">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ok, I updated the coed as below.

   ch1.on_ack do |basic_ack|
        puts &quot;Received basic_ack: multiple = #{basic_ack.multiple},
delivery_tag = #{basic_ack.delivery_tag}&quot;
   end

      10.times do
        @ns_x.publish(message_body,  :routing_key =&gt;
&quot;ipamAgent.operations&quot;, :headers =&gt; message_headers, :mandatory =&gt; true)
      end

Can you let me know  your comments for the below questions

1.  How can I identify the message along with the message contents for
which didn't get the acknowledgement ?

2. While publishing the 10 messages, I received acknowledgement for 5
messages only. I suspect RabbitMq sent acknowledgement for multiple
messages on 5 &amp; 10, if so then how can we make sure that the
acknowledgement is meant for message 1,2,3,4 and 5 in &quot;Received basic_ack:
multiple = #&lt;AMQ::Protocol::Basic::Ack:0x96d6560 @delivery_tag=5,
@multiple=true&gt;, delivery_tag = 5&quot;

*Acknowledgement O/p for 10 messages:*

 Received basic_ack: multiple = #&lt;AMQ::Protocol::Basic::Ack:0x96d6560
@delivery_tag=5, @multiple=true&gt;, delivery_tag = 5
Received basic_ack: multiple = #&lt;AMQ::Protocol::Basic::Ack:0x96d5f84
@delivery_tag=6, @multiple=false&gt;, delivery_tag = 6
Received basic_ack: multiple = #&lt;AMQ::Protocol::Basic::Ack:0x96d5700
@delivery_tag=7, @multiple=false&gt;, delivery_tag = 7
Received basic_ack: multiple = #&lt;AMQ::Protocol::Basic::Ack:0x96d50c0
@delivery_tag=8, @multiple=false&gt;, delivery_tag = 8
Received basic_ack: multiple = #&lt;AMQ::Protocol::Basic::Ack:0x972ce10
@delivery_tag=10, @multiple=true&gt;, delivery_tag = 10

3. How do we ensure that message is successfully published to the
exchange.(I want some way to identify the message is sent from ruby client
to RabbitMq exchange successfully)

regards,
Loganathan
Mob: +91 7760780741 | +91 9944414388
Skype: loganathan.sellappa
ViewMe &lt;<A HREF="http://vizualize.me/loganathan">http://vizualize.me/loganathan</A>&gt;



On Mon, Apr 28, 2014 at 6:22 PM, Michael Klishin &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mklishin at gopivotal.com</A>&gt;wrote:

&gt;<i> On 28 April 2014 at 16:47:24, Loganathan Sellapa (<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">loganathan.ms at gmail.com</A>)
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; &gt; @ns_x.publish(message_body, :routing_key =&gt; &quot;ipamAgent.operations&quot;,
</I>&gt;<i> &gt; :headers =&gt; message_headers, :mandatory =&gt; true)
</I>&gt;<i> &gt; end
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ch1.on_ack do |basic_ack|
</I>&gt;<i> &gt; puts &quot;Received basic_ack: multiple = #{basic_ack.multiple},
</I>&gt;<i> &gt; delivery_tag = #{basic_ack.delivery_tag}&quot;
</I>&gt;<i> &gt; end
</I>&gt;<i>
</I>&gt;<i> You need to define the handler before you publish, otherwise you have
</I>&gt;<i> a race condition  (it makes sense
</I>&gt;<i> to do this right after calling confirm_select).
</I>&gt;<i> --
</I>&gt;<i> MK
</I>&gt;<i>
</I>&gt;<i> Software Engineer, Pivotal/RabbitMQ
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140428/141adcca/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140428/141adcca/attachment.html</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035567.html">[rabbitmq-discuss] [RUBY-AMQP GEM] How do we can retry publish message on errors?
</A></li>
	<LI>Next message: <A HREF="035569.html">[rabbitmq-discuss] [RUBY-AMQP GEM] How do we can retry publish message on errors?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35568">[ date ]</a>
              <a href="thread.html#35568">[ thread ]</a>
              <a href="subject.html#35568">[ subject ]</a>
              <a href="author.html#35568">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
