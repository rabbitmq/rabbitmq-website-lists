<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Scaling with RabbitMQ
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Scaling%20with%20RabbitMQ&In-Reply-To=%3C4A7DAC2A-2561-4D00-87B5-285C988741DC%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035465.html">
   <LINK REL="Next"  HREF="035450.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Scaling with RabbitMQ</H1>
    <B>Bj&#246;rn H&#228;user</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Scaling%20with%20RabbitMQ&In-Reply-To=%3C4A7DAC2A-2561-4D00-87B5-285C988741DC%40gmail.com%3E"
       TITLE="[rabbitmq-discuss] Scaling with RabbitMQ">bjoernhaeuser at gmail.com
       </A><BR>
    <I>Tue Apr 22 18:35:51 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035465.html">[rabbitmq-discuss] Zero message rates in management interface
</A></li>
        <LI>Next message: <A HREF="035450.html">[rabbitmq-discuss] Scaling with RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35447">[ date ]</a>
              <a href="thread.html#35447">[ thread ]</a>
              <a href="subject.html#35447">[ subject ]</a>
              <a href="author.html#35447">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

we are currently reviewing our current architecture, which is mostly based on RabbitMQ and Java.

To keep up with the expected growth of our whole system, I want to discuss if our current approach of using RabbitMQ is in a good shape.

We have several services, each running with at least two instances. Each service registers several queues (between 5 and 25). Each queue has two bindings. 
Every instance has one connection to rabbitmq, for every queue we are opening a new channel. One additional channel is used for publishing messages. 

The services communicate with each other through one topic exchange. We are not using any wild card bindings currently and do not plan to use many of them in the near future. 

We are not aiming for maximal throughput, our goal is maximum durability. Therefore we are using delivery_mode = 2, durable and ha queues. We are currently running a cluster which consists of two nodes (each has 4GB RAM and 4 CPUs, using EXT4).

These are the numbers of our production system:

34 Connections
431 Channels
227 Queues
393 Consumers

I tried to find these information on the rabbitmq website, but was not able to find them.

Here are the questions I currently don&#8217;t have an answer to:

1. Topic exchange is the slowest exchange type. Direct exchange would be faster. We would lose the ability to have wildcard bindings. Can someone put a number of how much would we gain when we switch to a direct exchange?

2. Publishing rate depends on how many queues have a binding for the published message. We use java class names as routing keys. (com.foo.bar.xxx.zzz). The messages start to differ from the xxx part. Does the structure of the routing key influences publishing speed? What would be the impact of drastically increasing the number of queues (and bindings)? I am thinking of having thousand queues.

3. Is it wise to run everything over the same exchange? As far as I read on the mailing list, different exchanges on the same cluster do not influence each other - as long as there are enough physical resources.

4. How do we know, that we hit some limit of rabbitmq by using it the wrong way? Is there any way to see and monitor internal rabbitmq metrics? What&#8217;s your favorite tool to monitor RabbitMQ?

5. What do you think about having a Channel per Queue? That decision made us able to set the prefetch size and thread count per queue on the client side.

Finally I want to thank you for reading my mail. If this is complete nonsense, please tell me. I am new to the land of rabbits (sorry for this bad joke).

And additionally I want to thank every developer who puts his time into rabbitmq. It is an awesome piece of software.

Thanks
Bj&#246;rn









</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035465.html">[rabbitmq-discuss] Zero message rates in management interface
</A></li>
	<LI>Next message: <A HREF="035450.html">[rabbitmq-discuss] Scaling with RabbitMQ
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35447">[ date ]</a>
              <a href="thread.html#35447">[ thread ]</a>
              <a href="subject.html#35447">[ subject ]</a>
              <a href="author.html#35447">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
