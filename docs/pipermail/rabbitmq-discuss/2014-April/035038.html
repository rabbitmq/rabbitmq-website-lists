<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] 3.3.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%203.3.0&In-Reply-To=%3C534273DC.7020707%40rabbitmq.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035018.html">
   <LINK REL="Next"  HREF="035020.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] 3.3.0</H1>
    <B>Simon MacMullen</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%203.3.0&In-Reply-To=%3C534273DC.7020707%40rabbitmq.com%3E"
       TITLE="[rabbitmq-discuss] 3.3.0">simon at rabbitmq.com
       </A><BR>
    <I>Mon Apr  7 10:46:04 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035018.html">[rabbitmq-discuss] 3.3.0
</A></li>
        <LI>Next message: <A HREF="035020.html">[rabbitmq-discuss] Dynamic Shovel and HA with 3.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35038">[ date ]</a>
              <a href="thread.html#35038">[ thread ]</a>
              <a href="subject.html#35038">[ subject ]</a>
              <a href="author.html#35038">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The #event{} record has changed in a source-compatible(ish) but 
binary-incompatible way. So you will definitely need to recompile if you 
have not already done so. You might also want to make a small source 
change to get better behaviour in the event of events being reissued.

The reason it's changed is so that you can filter out reissued events 
which were requested (by calling rabbit:force_event_refresh/1) by 
something that was not your plugin, by checking the 'reference' field. 
An example would be when the mgmt DB fails over: it calls 
rabbit:force_event_refresh/1 and thus a load of events are emitted for 
things which already exist.

If you never call rabbit:force_event_refresh/1 you can just match on 
reference = none to filter these out.

Cheers, Simon

On 06/04/2014 12:18, Dmitry Andrianov wrote:
&gt;<i> Hello.
</I>&gt;<i> It looks like one of our RabbitMQ plugins stopped working after we
</I>&gt;<i> upgraded to 3.0.0.
</I>&gt;<i> Of course it can be that we are doing something wrong, I do not know any
</I>&gt;<i> details yet, just wanted to check if there is a known change I should be
</I>&gt;<i> aware of.
</I>&gt;<i>
</I>&gt;<i> The plugin that stopped working was hooking into the events to do its
</I>&gt;<i> stuff when new exchange is created.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -export([init/1, handle_call/2, handle_event/2, handle_info/2,
</I>&gt;<i>           terminate/2, code_change/3]).
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;<i> handle_event(Event = #event{type = exchange_created, props = [{name,
</I>&gt;<i> ExchangeName = #resource{}} | _]},
</I>&gt;<i>               State) -&gt;
</I>&gt;<i>
</I>&gt;<i>      rabbit_log:info(&quot;handle_event (Event=~p, State=~p)~n&quot;, [Event, State]),
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> the INFO which used to appear in the log for 3.1.1 to 3.2.3 does not
</I>&gt;<i> appear anymore.
</I>&gt;<i> I downgraded for now until I have time to debug it properly.
</I>&gt;<i>
</I>&gt;<i> Thanks
</I>&gt;<i> This email is for the use of the intended recipient(s) only. If you have
</I>&gt;<i> received this email in error, please notify the sender immediately and
</I>&gt;<i> then delete it. If you are not the intended recipient, you must not use,
</I>&gt;<i> disclose or distribute this email without the author's prior permission.
</I>&gt;<i> AlertMe.com Ltd. is not responsible for any personal views expressed in
</I>&gt;<i> this message or any attachments that are those of the individual sender.
</I>&gt;<i>
</I>&gt;<i> AlertMe.com Ltd, 30 Station Road, Cambridge, CB1 2RE, UK.
</I>&gt;<i> Registered in England, Company number 578 2908, VAT registration number
</I>&gt;<i> GB 895 9914 42.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> rabbitmq-discuss mailing list
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbitmq-discuss at lists.rabbitmq.com</A>
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss</A>
</I>&gt;<i>
</I>
</PRE>




































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035018.html">[rabbitmq-discuss] 3.3.0
</A></li>
	<LI>Next message: <A HREF="035020.html">[rabbitmq-discuss] Dynamic Shovel and HA with 3.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35038">[ date ]</a>
              <a href="thread.html#35038">[ thread ]</a>
              <a href="subject.html#35038">[ subject ]</a>
              <a href="author.html#35038">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
