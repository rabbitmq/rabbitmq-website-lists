<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] How to shutdown cleanly a Java application using	Consumers?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20shutdown%20cleanly%20a%20Java%20application%20using%0A%09Consumers%3F&In-Reply-To=%3C533C6CCB.6070505%40step.polymtl.ca%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035315.html">
   <LINK REL="Next"  HREF="034952.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] How to shutdown cleanly a Java application using	Consumers?</H1>
    <B>Bertrand Guay-Paquet</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20How%20to%20shutdown%20cleanly%20a%20Java%20application%20using%0A%09Consumers%3F&In-Reply-To=%3C533C6CCB.6070505%40step.polymtl.ca%3E"
       TITLE="[rabbitmq-discuss] How to shutdown cleanly a Java application using	Consumers?">bernie at step.polymtl.ca
       </A><BR>
    <I>Wed Apr  2 21:02:19 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035315.html">[rabbitmq-discuss] Upgrade fail
</A></li>
        <LI>Next message: <A HREF="034952.html">[rabbitmq-discuss] How to shutdown cleanly a Java application using Consumers?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34951">[ date ]</a>
              <a href="thread.html#34951">[ thread ]</a>
              <a href="subject.html#34951">[ subject ]</a>
              <a href="author.html#34951">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I'm using the RabbitMQ Java client API and need some guidance on the 
proper application shutdown procedure.

Here's how I start the application:
1-Create a Connection
2-Create different types of consumers, each with its own channel, and 
call channel.basicConsume(&quot;queue&quot;, false, consumer)
3-Let it all run

This works great, but I can't figure out how to cleanly shutdown the 
application. If I simply close the Connection, each created channel 
immediately (or soon enough) becomes invalid and any Consumer currently 
doing some work fails when trying to ack their current message or 
perform any other action on the channel. I'd like to let the consumers 
finish whatever message they're processing and then close everything 
down. I guess I need to keep track of the created Consumers and somehow 
signal them to stop accepting new messages and after they're all done 
with their current job, close the connection? Is that possible or is 
there another way? I haven't found any management methods for the 
consumer classes to control or query their status.

The information I found so far is related to manually created threads 
that poll the queues to process messages. In that case, it's really easy 
because I can just set a flag on each runnable to exit after processing 
their current message and join on all the threads before closing the 
underlying connection. So this leads me to ask, as a side note: are 
Consumers the way to go to use RabbitMQ in real-world scenarios or 
should I poll on the queues? It seems to me that Consumers would be the 
better choice (polling is bad), but if they're less powerful, perhaps 
they're not a silver bullet in my case.

Thank you,
Bertrand
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035315.html">[rabbitmq-discuss] Upgrade fail
</A></li>
	<LI>Next message: <A HREF="034952.html">[rabbitmq-discuss] How to shutdown cleanly a Java application using Consumers?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34951">[ date ]</a>
              <a href="thread.html#34951">[ thread ]</a>
              <a href="subject.html#34951">[ subject ]</a>
              <a href="author.html#34951">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
