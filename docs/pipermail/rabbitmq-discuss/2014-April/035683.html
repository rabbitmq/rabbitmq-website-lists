<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Best way to live migrate RabbitMQ consumer load	from one cluster to another
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Best%20way%20to%20live%20migrate%20RabbitMQ%20consumer%20load%0A%09from%20one%20cluster%20to%20another&In-Reply-To=%3CCACLE7iz0A2U6TeHVv7-%2BdV%2B4Hj1AF%3DnzwWwomGsJs56%2BbB-osQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035686.html">
   <LINK REL="Next"  HREF="035684.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Best way to live migrate RabbitMQ consumer load	from one cluster to another</H1>
    <B>Matt Pietrek</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Best%20way%20to%20live%20migrate%20RabbitMQ%20consumer%20load%0A%09from%20one%20cluster%20to%20another&In-Reply-To=%3CCACLE7iz0A2U6TeHVv7-%2BdV%2B4Hj1AF%3DnzwWwomGsJs56%2BbB-osQ%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Best way to live migrate RabbitMQ consumer load	from one cluster to another">mpietrek at skytap.com
       </A><BR>
    <I>Wed Apr 30 18:49:14 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035686.html">[rabbitmq-discuss] Core Dump when /proc is not mounted (chroot)
</A></li>
        <LI>Next message: <A HREF="035684.html">[rabbitmq-discuss] RabbitMQ backward compatibility policy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35683">[ date ]</a>
              <a href="thread.html#35683">[ thread ]</a>
              <a href="subject.html#35683">[ subject ]</a>
              <a href="author.html#35683">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Apologies if this has been answered somewhere already, but my searching
isn't turning up anything.

I'm looking for advice on how to best move client traffic from one RabbitMQ
cluster to another without service interruption. I suspect it can be done
with HA-proxy, but I can't figure out the steps. I'm open to other ideas as
well.

Scenario: We have a 2-node cluster with all queues mirrored. Let's say it's
running RabbitMQ 3.2.2. Clients connect to this cluster through a VIP
maintained by keepalived on both RabbitMQ hosts.

We now want to move to a different identical cluster, but running 3.3.1.
I'm thinking I can bring up this new cluster &quot;side-by-side&quot; with the old
cluster, such that they're running concurrently. All new connections would
go to the new cluster, while already established connections to the 3.2.2
cluster will remain alive and working, until all clients have eventually
connected to the new cluster. At that point the 3.2.2 cluster can be shut
down.

I have a hunch I can put HA-proxy in front of both clusters, and though
live configuration changes have it migrate the traffic to the new cluster
while leaving existing cluster connections alone. What I don't know is the
commands/configuration options/steps to implement it.

Thoughts and guidance on how to best do this?

Thanks,

Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140430/401c7e18/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140430/401c7e18/attachment.html</A>&gt;
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035686.html">[rabbitmq-discuss] Core Dump when /proc is not mounted (chroot)
</A></li>
	<LI>Next message: <A HREF="035684.html">[rabbitmq-discuss] RabbitMQ backward compatibility policy
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35683">[ date ]</a>
              <a href="thread.html#35683">[ thread ]</a>
              <a href="subject.html#35683">[ subject ]</a>
              <a href="author.html#35683">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
