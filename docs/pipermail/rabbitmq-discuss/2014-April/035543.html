<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] 3 node rabbitmq cluster behind the load balancer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%203%20node%20rabbitmq%20cluster%20behind%20the%20load%0A%20balancer&In-Reply-To=%3CetPan.535ce3ed.12200854.170%40mercurio.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035542.html">
   <LINK REL="Next"  HREF="035545.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] 3 node rabbitmq cluster behind the load balancer</H1>
    <B>Michael Klishin</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%203%20node%20rabbitmq%20cluster%20behind%20the%20load%0A%20balancer&In-Reply-To=%3CetPan.535ce3ed.12200854.170%40mercurio.local%3E"
       TITLE="[rabbitmq-discuss] 3 node rabbitmq cluster behind the load balancer">mklishin at gopivotal.com
       </A><BR>
    <I>Sun Apr 27 12:02:39 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035542.html">[rabbitmq-discuss] 3 node rabbitmq cluster behind the load balancer
</A></li>
        <LI>Next message: <A HREF="035545.html">[rabbitmq-discuss] Server Clustering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35543">[ date ]</a>
              <a href="thread.html#35543">[ thread ]</a>
              <a href="subject.html#35543">[ subject ]</a>
              <a href="author.html#35543">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 27 April 2014 at 08:12:14, sagu prf (<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">sagu.prf1 at gmail.com</A>) wrote:
&gt;<i> &gt; How effieciently, we can setup 6 node rabbitmq cluster with  
</I>&gt;<i> HA mirror
</I>&gt;<i> queues behinde the Load balancer?
</I>
It depends on what exactly you mean by &#8220;efficiently&#8221; but one good
idea in a 6 node cluster is to not use ha-mode = &#8220;all&#8221; for your queues.

Use ha-mode = &#8220;exactly&#8221; and mirror to 2 or 3 nodes (depending on how valuable
their contents is for your system). Mirroring to more nodes will only make
RabbitMQ do more work and increase intra-cluster traffic, at no real benefit
for the described setup.

See&#160;<A HREF="http://www.rabbitmq.com/ha.html.">http://www.rabbitmq.com/ha.html.</A>

&gt;<i> Loadbalancer will place the publishing and consuming request  
</I>&gt;<i> across
</I>&gt;<i> the node and how does the rabbitmq works ?
</I>
In a RabbitMQ cluster, clients can connect to and work with any node.
However, queues have a master node that all requests are routed to.
You will reduce intra-cluster traffic and thus improve throughput
and reduce latency if you publish on a node that hosts a cluster for
the queue(s) of interest. The same is true for consumers.

There are multiple load balancing strategies available in modern
tools but they are unaware of the above point. Which brings us to my
(very general) recommendation: if you don&#8217;t have extreme throughput
requirements, you can use virtually any load balancing strategy.&#160;
With HAproxy, leastconn [1] is a good idea if you expect a lot of client
connections.

If you do have extreme throughput requirements, you need to infer queue
masters via HTTP API and make your clients connect to master nodes,
and reconnect when it fails.

1.&#160;<A HREF="http://haproxy.1wt.eu/download/1.5/doc/configuration.txt,">http://haproxy.1wt.eu/download/1.5/doc/configuration.txt,</A> search for &#8220;balance &lt;algorithm&gt;&quot;
--  
MK  

Software Engineer, Pivotal/RabbitMQ
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035542.html">[rabbitmq-discuss] 3 node rabbitmq cluster behind the load balancer
</A></li>
	<LI>Next message: <A HREF="035545.html">[rabbitmq-discuss] Server Clustering
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35543">[ date ]</a>
              <a href="thread.html#35543">[ thread ]</a>
              <a href="subject.html#35543">[ subject ]</a>
              <a href="author.html#35543">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
