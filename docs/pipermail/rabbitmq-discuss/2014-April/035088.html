<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbit MQ Crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbit%20MQ%20Crash&In-Reply-To=%3CCAFa8q3aesqYmsdo4DpKxQ1XCmbNS7efKeowU07J4Tgq623q9rg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035087.html">
   <LINK REL="Next"  HREF="035089.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbit MQ Crash</H1>
    <B>Michael Sander</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbit%20MQ%20Crash&In-Reply-To=%3CCAFa8q3aesqYmsdo4DpKxQ1XCmbNS7efKeowU07J4Tgq623q9rg%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Rabbit MQ Crash">mes65 at cornell.edu
       </A><BR>
    <I>Tue Apr  8 08:42:28 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035087.html">[rabbitmq-discuss] Rabbit MQ Crash
</A></li>
        <LI>Next message: <A HREF="035089.html">[rabbitmq-discuss] Rabbit MQ Crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35088">[ date ]</a>
              <a href="thread.html#35088">[ thread ]</a>
              <a href="subject.html#35088">[ subject ]</a>
              <a href="author.html#35088">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Matthias,

I just checked rabbit the second after sending that, and it appears to have
crashed.  Here is some output, that you may find useful.  Notice that
erlang appears to be alive even though rabbitmq is not.

~$ ps aux|grep rabbit
rabbitmq  1761  0.0  0.0  10836   160 ?        S    Apr07   0:01
/usr/lib/erlang/erts-5.9.1/bin/epmd -daemon
1001     26076  0.0  0.0   6308   600 pts/1    S+   07:34   0:00 grep rabbit
~$ ps aux|grep erlan
rabbitmq  1761  0.0  0.0  10836   160 ?        S    Apr07   0:01
/usr/lib/erlang/erts-5.9.1/bin/epmd -daemon
1001     26078  0.0  0.0   6308   600 pts/1    S+   07:34   0:00 grep erlan
~$ df -h
Filesystem                                              Size  Used Avail
Use% Mounted on
rootfs                                                  9.9G  6.1G  3.3G
 65% /
udev                                                     10M     0   10M
0% /dev
tmpfs                                                   181M  128K  181M
1% /run
/dev/disk/by-uuid/36fd30d4-ea87-419f-a6a4-a1a3cf290ff1  9.9G  6.1G  3.3G
 65% /
tmpfs                                                   5.0M     0  5.0M
0% /run/lock
tmpfs                                                   362M     0  362M
0% /run/shm
~$ sudo df -h
Filesystem                                              Size  Used Avail
Use% Mounted on
rootfs                                                  9.9G  6.1G  3.3G
 65% /
udev                                                     10M     0   10M
0% /dev
tmpfs                                                   181M  128K  181M
1% /run
/dev/disk/by-uuid/36fd30d4-ea87-419f-a6a4-a1a3cf290ff1  9.9G  6.1G  3.3G
 65% /
tmpfs                                                   5.0M     0  5.0M
0% /run/lock
tmpfs                                                   362M     0  362M
0% /run/shm
~$ tail -n 100 /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ocr-proc-2-sasl.log</A>
~$ tail -n 100 /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ocr-proc-2-sasl.log.1</A>
  crasher:
    initial call: rabbit_disk_monitor:init/1
    pid: &lt;0.19499.0&gt;
    registered_name: []
    exception exit: unsupported_platform
      in function  gen_server:init_it/6 (gen_server.erl, line 320)
    ancestors: [rabbit_disk_monitor_sup,rabbit_sup,&lt;0.157.0&gt;]
    messages: []
    links: [&lt;0.180.0&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 6765
    stack_size: 24
    reductions: 13592
  neighbours:

=SUPERVISOR REPORT==== 8-Apr-2014::00:38:08 ===
     Supervisor: {local,rabbit_disk_monitor_sup}
     Context:    start_error
     Reason:     unsupported_platform
     Offender:   [{pid,{restarting,&lt;0.5000.0&gt;}},
                  {name,rabbit_disk_monitor},
                  {mfargs,{rabbit_disk_monitor,start_link,[50000000]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 8-Apr-2014::00:38:08 ===
  crasher:
    initial call: rabbit_disk_monitor:init/1
    pid: &lt;0.19502.0&gt;
    registered_name: []
    exception exit: unsupported_platform
      in function  gen_server:init_it/6 (gen_server.erl, line 320)
    ancestors: [rabbit_disk_monitor_sup,rabbit_sup,&lt;0.157.0&gt;]
    messages: []
    links: [&lt;0.180.0&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 6765
    stack_size: 24
    reductions: 13592
  neighbours:

=SUPERVISOR REPORT==== 8-Apr-2014::00:38:08 ===
     Supervisor: {local,rabbit_disk_monitor_sup}
     Context:    start_error
     Reason:     unsupported_platform
     Offender:   [{pid,{restarting,&lt;0.5000.0&gt;}},
                  {name,rabbit_disk_monitor},
                  {mfargs,{rabbit_disk_monitor,start_link,[50000000]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=CRASH REPORT==== 8-Apr-2014::00:38:08 ===
  crasher:
    initial call: rabbit_disk_monitor:init/1
    pid: &lt;0.19505.0&gt;
    registered_name: []
    exception exit: unsupported_platform
      in function  gen_server:init_it/6 (gen_server.erl, line 320)
    ancestors: [rabbit_disk_monitor_sup,rabbit_sup,&lt;0.157.0&gt;]
    messages: []
    links: [&lt;0.180.0&gt;]
    dictionary: []
    trap_exit: false
    status: running
    heap_size: 6765
    stack_size: 24
    reductions: 13592
  neighbours:

=SUPERVISOR REPORT==== 8-Apr-2014::00:38:08 ===
     Supervisor: {local,rabbit_disk_monitor_sup}
     Context:    start_error
     Reason:     unsupported_platform
     Offender:   [{pid,{restarting,&lt;0.5000.0&gt;}},
                  {name,rabbit_disk_monitor},
                  {mfargs,{rabbit_disk_monitor,start_link,[50000000]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]


=SUPERVISOR REPORT==== 8-Apr-2014::00:38:08 ===
     Supervisor: {local,rabbit_disk_monitor_sup}
     Context:    shutdown
     Reason:     reached_max_restart_intensity
     Offender:   [{pid,{restarting,&lt;0.5000.0&gt;}},
                  {name,rabbit_disk_monitor},
                  {mfargs,{rabbit_disk_monitor,start_link,[50000000]}},
                  {restart_type,transient},
                  {shutdown,4294967295},
                  {child_type,worker}]
~$ tail -n 100 /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ocr-proc-2.log</A>
=WARNING REPORT==== 8-Apr-2014::07:29:47 ===
closing AMQP connection &lt;0.20361.1&gt; (127.0.0.1:48568 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

=WARNING REPORT==== 8-Apr-2014::07:29:47 ===
closing AMQP connection &lt;0.20392.1&gt; (127.0.0.1:48586 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

=WARNING REPORT==== 8-Apr-2014::07:29:49 ===
closing AMQP connection &lt;0.20401.1&gt; (127.0.0.1:48589 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

=WARNING REPORT==== 8-Apr-2014::07:29:50 ===
closing AMQP connection &lt;0.22633.1&gt; (127.0.0.1:50329 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

=WARNING REPORT==== 8-Apr-2014::07:29:51 ===
closing AMQP connection &lt;0.16156.1&gt; (127.0.0.1:44692 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 8-Apr-2014::07:30:11 ===
accepting AMQP connection &lt;0.22761.1&gt; (127.0.0.1:50370 -&gt; 127.0.0.1:5672)

=WARNING REPORT==== 8-Apr-2014::07:30:11 ===
closing AMQP connection &lt;0.22608.1&gt; (127.0.0.1:50316 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 8-Apr-2014::07:30:11 ===
accepting AMQP connection &lt;0.22774.1&gt; (127.0.0.1:50371 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:11 ===
accepting AMQP connection &lt;0.22777.1&gt; (127.0.0.1:50372 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:26 ===
accepting AMQP connection &lt;0.22796.1&gt; (127.0.0.1:50383 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:26 ===
accepting AMQP connection &lt;0.22805.1&gt; (127.0.0.1:50384 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:26 ===
accepting AMQP connection &lt;0.22810.1&gt; (127.0.0.1:50385 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:27 ===
accepting AMQP connection &lt;0.22825.1&gt; (127.0.0.1:50386 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:29 ===
accepting AMQP connection &lt;0.22834.1&gt; (127.0.0.1:50387 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:30 ===
accepting AMQP connection &lt;0.22843.1&gt; (127.0.0.1:50388 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:31 ===
accepting AMQP connection &lt;0.22852.1&gt; (127.0.0.1:50389 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:34 ===
accepting AMQP connection &lt;0.22863.1&gt; (127.0.0.1:50394 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:34 ===
accepting AMQP connection &lt;0.22866.1&gt; (127.0.0.1:50395 -&gt; 127.0.0.1:5672)

=WARNING REPORT==== 8-Apr-2014::07:30:36 ===
closing AMQP connection &lt;0.22852.1&gt; (127.0.0.1:50389 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 8-Apr-2014::07:30:36 ===
accepting AMQP connection &lt;0.22883.1&gt; (127.0.0.1:50399 -&gt; 127.0.0.1:5672)

=WARNING REPORT==== 8-Apr-2014::07:30:37 ===
closing AMQP connection &lt;0.22761.1&gt; (127.0.0.1:50370 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

=WARNING REPORT==== 8-Apr-2014::07:30:38 ===
closing AMQP connection &lt;0.22796.1&gt; (127.0.0.1:50383 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 8-Apr-2014::07:30:39 ===
accepting AMQP connection &lt;0.22893.1&gt; (127.0.0.1:50403 -&gt; 127.0.0.1:5672)

=WARNING REPORT==== 8-Apr-2014::07:30:39 ===
closing AMQP connection &lt;0.22810.1&gt; (127.0.0.1:50385 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 8-Apr-2014::07:30:41 ===
accepting AMQP connection &lt;0.22902.1&gt; (127.0.0.1:50409 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:43 ===
accepting AMQP connection &lt;0.22913.1&gt; (127.0.0.1:50411 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:49 ===
accepting AMQP connection &lt;0.22925.1&gt; (127.0.0.1:50420 -&gt; 127.0.0.1:5672)

=INFO REPORT==== 8-Apr-2014::07:30:49 ===
accepting AMQP connection &lt;0.22928.1&gt; (127.0.0.1:50421 -&gt; 127.0.0.1:5672)

=WARNING REPORT==== 8-Apr-2014::07:30:50 ===
closing AMQP connection &lt;0.22660.1&gt; (127.0.0.1:50332 -&gt; 127.0.0.1:5672):
connection_closed_abruptly

=INFO REPORT==== 8-Apr-2014::07:30:51 ===
accepting AMQP connection &lt;0.22945.1&gt; (127.0.0.1:50423 -&gt; 127.0.0.1:5672)
~$ tail -n 100 /var/log/rabbitmq/shutdown_err
/usr/lib/rabbitmq/bin/rabbitmqctl: 1: /etc/rabbitmq/rabbitmq-env.conf:
ocr-proc-2=<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>: not found
~$ tail -n 100 /var/log/rabbitmq/shutdown_log
Stopping and halting node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ocr-proc-2</A>' ...
...done.
~$ tail -n 100 /var/log/rabbitmq/startup_err
/usr/lib/rabbitmq/bin/rabbitmq-server: 1: /etc/rabbitmq/rabbitmq-env.conf:
ocr-proc-2=<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at localhost</A>: not found
Killed
~$ tail -n 100 /var/log/rabbitmq/startup_log

              RabbitMQ 3.2.4. Copyright (C) 2007-2013 GoPivotal, Inc.
  ##  ##      Licensed under the MPL.  See <A HREF="http://www.rabbitmq.com/">http://www.rabbitmq.com/</A>
  ##  ##
  ##########  Logs: /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ocr-proc-2.log</A>
  ######  ##        /var/log/rabbitmq/<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at ocr-proc-2-sasl.log</A>
  ##########
              Starting broker... completed with 6 plugins.



&#5159;

Michael Sander
<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mes65 at cornell.edu</A>
607-227-9859


On Tue, Apr 8, 2014 at 3:33 AM, Michael Sander &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mes65 at cornell.edu</A>&gt; wrote:

&gt;<i> Hi Matthais,
</I>&gt;<i>
</I>&gt;<i> What I sent you was everything I had. However, I did check ps -aux after
</I>&gt;<i> the crash and rabbitmq-server was definitely not in there. I will turn off
</I>&gt;<i> the cron jobs that automatically restart rabbitmq, and I'll let you know if
</I>&gt;<i> I see it again.
</I>&gt;<i>
</I>&gt;<i> Here is the output of the command.
</I>&gt;<i>
</I>&gt;<i> $ sudo rabbitmqctl eval 'rabbit_misc:os_cmd(&quot;/bin/df -kP
</I>&gt;<i> /var/lib/rabbitmq/mnes
</I>&gt;<i> ia/&quot;).'
</I>&gt;<i> &quot;Filesystem                                             1024-blocks
</I>&gt;<i>  Used Available Capacity Mounted
</I>&gt;<i> on\n/dev/disk/by-uuid/36fd30d4-ea87-419f-a6a4-a1a3cf290ff1    10320184
</I>&gt;<i> 6348300   3447648      65% /\n&quot;
</I>&gt;<i> ...done.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Also, I'm not sure whether it will help you, but attached is a screenshot
</I>&gt;<i> of the rabbitmq console.  If you see the start of the top chart at 19:00,
</I>&gt;<i> there is a sharp increase in the queued messages.  That's when I restarted
</I>&gt;<i> rabbitmq after the crash.  Everything before that was flat.  Another point
</I>&gt;<i> to note is that it currently says that the disk space is unavailable.  I
</I>&gt;<i> definitely remember seeing a value there at some point before, I don't know
</I>&gt;<i> what causes that to occur.
</I>&gt;<i>
</I>&gt;<i> I've turned off my rabbimq auto-start cron jobs, I'll let you know if I
</I>&gt;<i> see the crash again.
</I>&gt;<i>
</I>&gt;<i> Thanks again.
</I>&gt;<i>
</I>&gt;<i> Best,
</I>&gt;<i>
</I>&gt;<i> Michael Sander
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, Apr 8, 2014 at 1:18 AM, Matthias Radestock &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">matthias at rabbitmq.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Michael,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 08/04/14 02:50, Michael Sander wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Full logs are attached.  You'll notice that it crashes pretty often now.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The disk_monitor is crashing frequently, yes, but in none of the
</I>&gt;&gt;<i> instances in the logs that actually took down rabbit (notice that there are
</I>&gt;&gt;<i> no rabbit starts recorded in the rabbit.log); the disk_monitor restarts
</I>&gt;&gt;<i> just fine and the bunny lives on.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Do you have the logs covering the time period around the crash?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Here are the output of the commands
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     $ sudo rabbitmqctl eval 'rabbit_misc:os_cmd(&quot;/bin/df -kP
</I>&gt;&gt;&gt;<i>     /var/lib/rabbitmq/mnesia/&quot;)'
</I>&gt;&gt;&gt;<i>     Error: syntax error before:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ah, sorry, missed a full stop. Should be
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     sudo rabbitmqctl eval 'rabbit_misc:os_cmd(&quot;/bin/df -kP
</I>&gt;&gt;<i> /var/lib/rabbitmq/mnesia/&quot;).'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Matthias.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140408/dc644dfc/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140408/dc644dfc/attachment.html</A>&gt;
</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035087.html">[rabbitmq-discuss] Rabbit MQ Crash
</A></li>
	<LI>Next message: <A HREF="035089.html">[rabbitmq-discuss] Rabbit MQ Crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35088">[ date ]</a>
              <a href="thread.html#35088">[ thread ]</a>
              <a href="subject.html#35088">[ subject ]</a>
              <a href="author.html#35088">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
