<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] New RabbitMQ 3.3.0 Web_stomp SSL problems
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20New%20RabbitMQ%203.3.0%20Web_stomp%20SSL%20problems&In-Reply-To=%3C1e6f76f9-f85e-4f73-8b42-588e504a3c37%40googlegroups.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035565.html">
   <LINK REL="Next"  HREF="035527.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] New RabbitMQ 3.3.0 Web_stomp SSL problems</H1>
    <B>brad at debtpaypro.com</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20New%20RabbitMQ%203.3.0%20Web_stomp%20SSL%20problems&In-Reply-To=%3C1e6f76f9-f85e-4f73-8b42-588e504a3c37%40googlegroups.com%3E"
       TITLE="[rabbitmq-discuss] New RabbitMQ 3.3.0 Web_stomp SSL problems">brad at debtpaypro.com
       </A><BR>
    <I>Wed Apr 30 23:04:56 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035565.html">[rabbitmq-discuss] New RabbitMQ 3.3.0 Web_stomp SSL problems
</A></li>
        <LI>Next message: <A HREF="035527.html">[rabbitmq-discuss] RabbitMQ.Client.Exceptions.AuthenticationFailureException / ACCESS_REFUSED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35696">[ date ]</a>
              <a href="thread.html#35696">[ thread ]</a>
              <a href="subject.html#35696">[ subject ]</a>
              <a href="author.html#35696">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm having a similar, or possibly the same, problem.  My config is 
basically the same as yours.  I'm running version 3.3.1.  When starting up, 
a message is logged that says &quot;rabbit_web_stomp: listening for HTTPS 
connections on 0.0.0.0:15675&quot;, but netstat shows that nothing is listening 
on port 15675 and connections to my server on port 15675 fail.  There 
aren't any other interesting log messages in any of the rabbit log files.  
I have tried changing the port several time but the same message is logged 
and nothing listens on the new port.  I know the certificates are good 
since we're using the on our live sites.  If I change the config to point 
to files that do not exist for the certificates, the same thing happens.

rabbitmq.config:

[
  {rabbit, [
    {auth_backends, [rabbit_auth_backend_internal]},
    {log_levels, [
      {connection, info},
      {mirroring, info}
    ]},
    {heartbeat, 10},
    {collect_statistics_interval, 1000},
    {delegate_count, 32},
    {cluster_partition_handling, pause_minority}
  ]},
  {rabbitmq_management, [
    {sample_retention_policies, [
      {global, [{3600, 5}, {86400, 60}, {604800, 600}]},
      {basic, [{60, 5}, {3600, 60}]},
      {detailed, [{30, 1}]}
    ]},
    {http_log_dir, &quot;/tmp/rabbit-mgmt&quot;}
  ]},
  {kernel, [
    {net_ticktime, 5}
  ]},
  {rabbitmq_web_stomp, [
    {ssl_config, [
      {port,       15674},
      {backlog,    1024},
      {certfile,   &quot;/etc/pki/tls/certs/dpp.crt&quot;},
      {keyfile,    &quot;/etc/pki/tls/private/dpp.key&quot;}
    ]}
  ]}
].


status:

 {running_applications,
     [{rabbitmq_web_stomp,&quot;Rabbit WEB-STOMP - WebSockets to Stomp adapter&quot;,
          &quot;3.3.1&quot;},
      {ssl,&quot;Erlang/OTP SSL application&quot;,&quot;4.1.6&quot;},
      {public_key,&quot;Public key infrastructure&quot;,&quot;0.13&quot;},
      {crypto,&quot;CRYPTO version 2&quot;,&quot;2.0.4&quot;},
      {rabbitmq_stomp,&quot;Embedded Rabbit Stomp Adapter&quot;,&quot;3.3.1&quot;},
      {rabbitmq_management_visualiser,&quot;RabbitMQ Visualiser&quot;,&quot;3.3.1&quot;},
      {rabbitmq_management,&quot;RabbitMQ Management Console&quot;,&quot;3.3.1&quot;},
      {rabbitmq_management_agent,&quot;RabbitMQ Management Agent&quot;,&quot;3.3.1&quot;},
      {rabbitmq_amqp1_0,&quot;AMQP 1.0 support for RabbitMQ&quot;,&quot;3.3.1&quot;},
      {rabbit,&quot;RabbitMQ&quot;,&quot;3.3.1&quot;},
      {os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.7&quot;},
      {rabbitmq_web_dispatch,&quot;RabbitMQ Web Dispatcher&quot;,&quot;3.3.1&quot;},
      {webmachine,&quot;webmachine&quot;,&quot;1.10.3-rmq3.3.1-gite9359c7&quot;},
      {mochiweb,&quot;MochiMedia Web Server&quot;,&quot;2.7.0-rmq3.3.1-git680dba8&quot;},
      {xmerl,&quot;XML parser&quot;,&quot;1.2.10&quot;},
      {cowboy,&quot;Small, fast, modular HTTP 
server.&quot;,&quot;0.5.0-rmq3.3.1-git4b93c2d&quot;},
      {sockjs,&quot;SockJS&quot;,&quot;0.3.4-rmq3.3.1-git3132eb9&quot;},
      {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.7.1&quot;},
      {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.5&quot;},
      {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;3.3.1&quot;},
      {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.1.10&quot;},
      {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.17.5&quot;},
      {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.14.5&quot;}]},
 {os,{unix,linux}},
 {erlang_version, 
     &quot;Erlang R14B04 (erts-5.8.5) [source] [64-bit] [smp:24:24] [rq:24] 
[async-threads:30] [kernel-poll:true]\n&quot;},


On Friday, April 25, 2014 4:34:22 PM UTC-5, Sebastien Dubois wrote:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i>   Up to recently we've been using RabbitMQ 3.2.3/Erlang R15B01 with the 
</I>&gt;<i> web_Stomp plugin over SSL.  Since this was not supported, we had to rebuilt 
</I>&gt;<i> the web_stomp plugin using a patched branch as described at 
</I>&gt;<i> <A HREF="https://gist.github.com/berico-rclayton/5475365">https://gist.github.com/berico-rclayton/5475365</A> (also see 
</I>&gt;<i> <A HREF="https://github.com/rabbitmq/rabbitmq-web-stomp/pull/3">https://github.com/rabbitmq/rabbitmq-web-stomp/pull/3</A>).  This has been 
</I>&gt;<i> working fine for months.
</I>&gt;<i>
</I>&gt;<i>   We recently realized that the fix for SSL support in web_stomp was 
</I>&gt;<i> systemized in RabbitMQ 3.3.0/Erlang R16B03.  So we installed it and updated 
</I>&gt;<i> our configuration.  However, using the exact same setup and self-signed 
</I>&gt;<i> keys/certificates, we cannot get the new version to work properly while 
</I>&gt;<i> using SSL over stomp.  Connecting to <A HREF="https://&lt;rabbit">https://&lt;rabbit</A> server IP&gt;:15678/stomp 
</I>&gt;<i> just fails, although from the log web_stomp seems to be listening correctly 
</I>&gt;<i> on port 15678.  We tried to regenerate a new set of keys, but it did not do 
</I>&gt;<i> anything.
</I>&gt;<i>
</I>&gt;<i> Our old rabbitMQ config (patched 3.2.3 web_stomp) was:
</I>&gt;<i>
</I>&gt;<i>   {rabbitmq_web_stomp, [
</I>&gt;<i>
</I>&gt;<i>         {ssl_enabled, true},
</I>&gt;<i>
</I>&gt;<i>         {https_port, 15678},
</I>&gt;<i>
</I>&gt;<i>         {ssl_key_file, &quot;/usr/local/ssl/private/server.key&quot;},
</I>&gt;<i>
</I>&gt;<i>         {ssl_key_password, &quot;password&quot;},
</I>&gt;<i>
</I>&gt;<i>         {ssl_ca_certificate_file, &quot;/usr/local/ssl/crt/public.crt&quot;},
</I>&gt;<i>
</I>&gt;<i>         {ssl_certificate_file, &quot;/usr/local/ssl/crt/public.crt&quot;}
</I>&gt;<i>
</I>&gt;<i>    ] },
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> And the corresponding new config on RabbitMQ 3.3.0 is
</I>&gt;<i>
</I>&gt;<i>   {rabbitmq_web_stomp,
</I>&gt;<i>
</I>&gt;<i>       [{ssl_config, [{port,       15678},
</I>&gt;<i>
</I>&gt;<i>                      {backlog,    1024},
</I>&gt;<i>
</I>&gt;<i>                      {certfile,   &quot;/usr/local/ssl/crt/public.crt&quot;},
</I>&gt;<i>
</I>&gt;<i>                      {keyfile,    &quot;/usr/local/ssl/private/server.key&quot;},
</I>&gt;<i>
</I>&gt;<i>                      {cacertfile, &quot;/usr/local/ssl/crt/public.crt&quot;},
</I>&gt;<i>
</I>&gt;<i> {password, &quot;password&quot;}
</I>&gt;<i>
</I>&gt;<i>       ]}
</I>&gt;<i>
</I>&gt;<i>   ]},
</I>&gt;<i>
</I>&gt;<i> Is our config ok?  does anybody experienced similar problems or have any 
</I>&gt;<i> idea what we could be doing wrong?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks in advance,
</I>&gt;<i>
</I>&gt;<i> /Sebas
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140430/bfc20bd6/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140430/bfc20bd6/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035565.html">[rabbitmq-discuss] New RabbitMQ 3.3.0 Web_stomp SSL problems
</A></li>
	<LI>Next message: <A HREF="035527.html">[rabbitmq-discuss] RabbitMQ.Client.Exceptions.AuthenticationFailureException / ACCESS_REFUSED
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35696">[ date ]</a>
              <a href="thread.html#35696">[ thread ]</a>
              <a href="subject.html#35696">[ subject ]</a>
              <a href="author.html#35696">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
