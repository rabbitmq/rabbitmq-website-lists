<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Rabbit startup command is hanging
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbit%20startup%20command%20is%20hanging&In-Reply-To=%3CCAD6m6fHmF_N6s5XGx3_c3FtcbAWDHeNY-zik7fB8f%3DqwQAhkoA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035232.html">
   <LINK REL="Next"  HREF="035233.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Rabbit startup command is hanging</H1>
    <B>Jason McIntosh</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Rabbit%20startup%20command%20is%20hanging&In-Reply-To=%3CCAD6m6fHmF_N6s5XGx3_c3FtcbAWDHeNY-zik7fB8f%3DqwQAhkoA%40mail.gmail.com%3E"
       TITLE="[rabbitmq-discuss] Rabbit startup command is hanging">mcintoshj at gmail.com
       </A><BR>
    <I>Fri Apr 11 15:20:29 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035232.html">[rabbitmq-discuss] Rabbit startup command is hanging
</A></li>
        <LI>Next message: <A HREF="035233.html">[rabbitmq-discuss] ANN rabbitpy 0.16.0 is released
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35249">[ date ]</a>
              <a href="thread.html#35249">[ thread ]</a>
              <a href="subject.html#35249">[ subject ]</a>
              <a href="author.html#35249">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>SO a final email on this.  I ended up having to kill all the processes on
all nodes in the cluster, then starting them back up in order to recover.
At that point, the node that wouldn't rejoin the cluster came online and
started syncing messages and responding fine.  I'm guessing I had a
deadlock someplace though I'm not totally sure where it would be.  I'll
keep an eye on this and see what else I can discover.  *SIGH* I really need
to learn to debug and work with erlang better,
Thanks all,
Jason


On Thu, Apr 10, 2014 at 4:22 PM, Jason McIntosh &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mcintoshj at gmail.com</A>&gt; wrote:

&gt;<i> SO now the fun part.  I decided to try and rebuild the middle node (I have
</I>&gt;<i> boxes 10, 11 and 12).  However, I can't get the middle node to reconnect to
</I>&gt;<i> the cluster.  Removing it's mnesia directory allowed it to start, but it
</I>&gt;<i> can't rejoin the cluster.  SO I tried removing the node from the cluster,
</I>&gt;<i> e.g.:
</I>&gt;<i>
</I>&gt;<i> rabbitmqctl -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cluster at rabbitmqm10</A> forget_cluster_node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cluster at rabbitmqm11</A>
</I>&gt;<i>
</I>&gt;<i> But the above never responds - it's just sitting there hanging.
</I>&gt;<i>
</I>&gt;<i> rabbitmqctl -n <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cluster at rabbitmqm11</A> status FROM the other nodes all works
</I>&gt;<i> fine. I'm about at a loss as to how the heck to repair things.  I can't
</I>&gt;<i> remove the node from the cluster, I can't start it with the mnesia
</I>&gt;<i> directory in it's current state, and removing the mnesia directory and
</I>&gt;<i> trying to add it back in is failing - it fails with &quot;....done
</I>&gt;<i> (already_member).&quot;.  Trying to do rabbitmqctl update_cluster_nodes
</I>&gt;<i> <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cluster at rabbitmqm10</A> is sitting there doing nothing and not responding
</I>&gt;<i> either.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm starting to really worry I'm going to have to completely rebuild my
</I>&gt;<i> cluster...
</I>&gt;<i> Jason
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Apr 10, 2014 at 2:55 PM, Jason McIntosh &lt;<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">mcintoshj at gmail.com</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Not sure what's going on here.  Just ugpraded my cluster from 3.2.3 to
</I>&gt;&gt;<i> 3.2.4 (including a restart of the machine).  On startup, two of my initial
</I>&gt;&gt;<i> nodes started fine, but when the third node in the cluster started, the
</I>&gt;&gt;<i> &quot;/etc/init.d/rabbitmq-server start&quot; just sits at &quot;Starting rabbitmq-server:
</I>&gt;&gt;<i> &quot; without ever finishing.  Doing a rabbitmqctl status shows:
</I>&gt;&gt;<i> Status of node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">cluster at rabbitmqm11p</A> ...
</I>&gt;&gt;<i> [{pid,62505},
</I>&gt;&gt;<i>  {running_applications,[{os_mon,&quot;CPO  CXC 138 46&quot;,&quot;2.2.14&quot;},
</I>&gt;&gt;<i>                         {inets,&quot;INETS  CXC 138 49&quot;,&quot;5.9.8&quot;},
</I>&gt;&gt;<i>                         {mnesia,&quot;MNESIA  CXC 138 12&quot;,&quot;4.11&quot;},
</I>&gt;&gt;<i>                         {amqp_client,&quot;RabbitMQ AMQP Client&quot;,&quot;3.2.4&quot;},
</I>&gt;&gt;<i>                         {xmerl,&quot;XML parser&quot;,&quot;1.3.6&quot;},
</I>&gt;&gt;<i>                         {eldap,&quot;Ldap api&quot;,&quot;1.0.2&quot;},
</I>&gt;&gt;<i>                         {sasl,&quot;SASL  CXC 138 11&quot;,&quot;2.3.4&quot;},
</I>&gt;&gt;<i>                         {stdlib,&quot;ERTS  CXC 138 10&quot;,&quot;1.19.4&quot;},
</I>&gt;&gt;<i>                         {kernel,&quot;ERTS  CXC 138 10&quot;,&quot;2.16.4&quot;}]},
</I>&gt;&gt;<i>  {os,{unix,linux}},
</I>&gt;&gt;<i>  {erlang_version,&quot;Erlang R16B03-1 (erts-5.10.4) [source] [64-bit]
</I>&gt;&gt;<i> [smp:24:24] [async-threads:30] [hipe] [kernel-poll:true]\n&quot;},
</I>&gt;&gt;<i>  {memory,[{total,48504352},
</I>&gt;&gt;<i>           {connection_procs,2808},
</I>&gt;&gt;<i>           {queue_procs,0},
</I>&gt;&gt;<i>           {plugins,0},
</I>&gt;&gt;<i>           {other_proc,16290632},
</I>&gt;&gt;<i>           {mnesia,1783536},
</I>&gt;&gt;<i>           {mgmt_db,0},
</I>&gt;&gt;<i>           {msg_index,0},
</I>&gt;&gt;<i>           {other_ets,1120896},
</I>&gt;&gt;<i>           {binary,725448},
</I>&gt;&gt;<i>           {code,19691642},
</I>&gt;&gt;<i>           {atom,703377},
</I>&gt;&gt;<i>           {other_system,8186013}]},
</I>&gt;&gt;<i>  {file_descriptors,[{total_limit,12188},
</I>&gt;&gt;<i>                     {total_used,0},
</I>&gt;&gt;<i>                     {sockets_limit,10967},
</I>&gt;&gt;<i>                     {sockets_used,0}]},
</I>&gt;&gt;<i>  {processes,[{limit,1048576},{used,117}]},
</I>&gt;&gt;<i>  {run_queue,0},
</I>&gt;&gt;<i>  {uptime,83}]
</I>&gt;&gt;<i> ...done.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In the web management interface, I see this:
</I>&gt;&gt;<i> Node statistics not available
</I>&gt;&gt;<i> Memory details
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Connections 2.7kB  Queues 0B  Plugins 0B  Other process memory 16MB
</I>&gt;&gt;<i> Mnesia 1.7MB  Message store index 0B  Management database 0B  Other ETS
</I>&gt;&gt;<i> tables 1.1MB   Binaries 708kB  Code 19MB  Atoms 687kB  Other system 7.8MB
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> SO rabbit appears to have sort of started, but certain things are not
</I>&gt;&gt;<i> started (e.g. plugins).  Plugins list is:
</I>&gt;&gt;<i> [e] amqp_client                       3.2.4
</I>&gt;&gt;<i> [ ] cowboy                            0.5.0-rmq3.2.4-git4b93c2d
</I>&gt;&gt;<i> [ ] eldap                             3.2.4-gite309de4
</I>&gt;&gt;<i> [e] mochiweb                          2.7.0-rmq3.2.4-git680dba8
</I>&gt;&gt;<i> [ ] rabbitmq_amqp1_0                  3.2.4
</I>&gt;&gt;<i> [E] rabbitmq_auth_backend_ldap        3.2.4
</I>&gt;&gt;<i> [ ] rabbitmq_auth_mechanism_ssl       3.2.4
</I>&gt;&gt;<i> [E] rabbitmq_consistent_hash_exchange 3.2.4
</I>&gt;&gt;<i> [E] rabbitmq_federation               3.2.4
</I>&gt;&gt;<i> [E] rabbitmq_federation_management    3.2.4
</I>&gt;&gt;<i> [ ] rabbitmq_jsonrpc                  3.2.4
</I>&gt;&gt;<i> [ ] rabbitmq_jsonrpc_channel          3.2.4
</I>&gt;&gt;<i> [ ] rabbitmq_jsonrpc_channel_examples 3.2.4
</I>&gt;&gt;<i> [E] rabbitmq_management               3.2.4
</I>&gt;&gt;<i> [E] rabbitmq_management_agent         3.2.4
</I>&gt;&gt;<i> [E] rabbitmq_management_visualiser    3.2.4
</I>&gt;&gt;<i> [ ] rabbitmq_mqtt                     3.2.4
</I>&gt;&gt;<i> [E] rabbitmq_shovel                   3.2.4
</I>&gt;&gt;<i> [E] rabbitmq_shovel_management        3.2.4
</I>&gt;&gt;<i> [ ] rabbitmq_stomp                    3.2.4
</I>&gt;&gt;<i> [ ] rabbitmq_tracing                  3.2.4
</I>&gt;&gt;<i> [e] rabbitmq_web_dispatch             3.2.4
</I>&gt;&gt;<i> [ ] rabbitmq_web_stomp                3.2.4
</I>&gt;&gt;<i> [ ] rabbitmq_web_stomp_examples       3.2.4
</I>&gt;&gt;<i> [ ] rfc4627_jsonrpc                   3.2.4-git5e67120
</I>&gt;&gt;<i> [ ] sockjs                            0.3.4-rmq3.2.4-git3132eb9
</I>&gt;&gt;<i> [e] webmachine                        1.10.3-rmq3.2.4-gite9359c7
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any suggestions on next steps on debugging this?  Or what I can do to get
</I>&gt;&gt;<i> this back up and in a &quot;healthy&quot; state?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks!
</I>&gt;&gt;<i> Jason
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Jason McIntosh
</I>&gt;&gt;<i> <A HREF="https://github.com/jasonmcintosh/">https://github.com/jasonmcintosh/</A>
</I>&gt;&gt;<i> 573-424-7612
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Jason McIntosh
</I>&gt;<i> <A HREF="https://github.com/jasonmcintosh/">https://github.com/jasonmcintosh/</A>
</I>&gt;<i> 573-424-7612
</I>&gt;<i>
</I>


-- 
Jason McIntosh
<A HREF="https://github.com/jasonmcintosh/">https://github.com/jasonmcintosh/</A>
573-424-7612
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140411/1ea41ba8/attachment.html">http://lists.rabbitmq.com/pipermail/rabbitmq-discuss/attachments/20140411/1ea41ba8/attachment.html</A>&gt;
</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035232.html">[rabbitmq-discuss] Rabbit startup command is hanging
</A></li>
	<LI>Next message: <A HREF="035233.html">[rabbitmq-discuss] ANN rabbitpy 0.16.0 is released
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35249">[ date ]</a>
              <a href="thread.html#35249">[ thread ]</a>
              <a href="subject.html#35249">[ subject ]</a>
              <a href="author.html#35249">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
