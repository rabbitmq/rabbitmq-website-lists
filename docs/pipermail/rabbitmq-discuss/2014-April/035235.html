<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] Possible memory leak in the management plugin
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20memory%20leak%20in%20the%20management%20plugin&In-Reply-To=%3C1397171854071-34790.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035228.html">
   <LINK REL="Next"  HREF="035236.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] Possible memory leak in the management plugin</H1>
    <B>Pavel</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20Possible%20memory%20leak%20in%20the%20management%20plugin&In-Reply-To=%3C1397171854071-34790.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] Possible memory leak in the management plugin">pmaisenovich at blizzard.com
       </A><BR>
    <I>Fri Apr 11 00:17:34 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035228.html">[rabbitmq-discuss] Possible memory leak in the management plugin
</A></li>
        <LI>Next message: <A HREF="035236.html">[rabbitmq-discuss] Possible memory leak in the management plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35235">[ date ]</a>
              <a href="thread.html#35235">[ thread ]</a>
              <a href="subject.html#35235">[ subject ]</a>
              <a href="author.html#35235">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> 2) Because the GC-ing process has constant rate (100 or 1% rows each
</I>&gt;<i> 5 seconds), there is always a possibility that aggregated_stats table
</I>&gt;<i> growth will outpace the clean up efforts.
</I>
&gt;<i> No, there isn't. 
</I>
Well, something is happening and I'm just trying to get down to the cause.
That theory seemed plausible given my test results.

I've been running a throttled test (RabbitSmasher 1000 1 1000000 1000 false
true) which was publishing at 500/s rate rotating through 1000 channels and
1000 exchanges on every message for ~10 hours. aggregated_stats table was
growing steadily for almost 4 hours straight until it reached 2.5Gb when
Rabbit RAM hit high watermark of 4Gb and publisher channels start getting
throttled. From there Rabbit started flipping between &quot;publisher runs,
memory grows&quot; and &quot;publisher blocked, memory GCed&quot; states for next 6 hours. 

One thing I noticed is that during &quot;publisher blocked&quot; phase the memory used
by aggregated_stats would go down, but it's size wouldn't. The number of
items in that table will always keep growing for the duration of entire test
(albeit much slower since hitting watermark threshold) up to 1006782 records
when I stopped the script. If I understood it right, that table contains at
least one record per each channel x exchange and channel x queue
permutation, which is 2M in my case. 

Perhaps if I had enough memory before high watermark to keep (short) history
for each of 2M permutations of stats data points it will eventually
stabilize at that point? I'll run more tests to check that.

I have ETS memory snapshot logs for this 10 hours test if you are interested
to see it yourself. 





--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/Possible-memory-leak-in-the-management-plugin-tp27414p34790.html">http://rabbitmq.1065348.n5.nabble.com/Possible-memory-leak-in-the-management-plugin-tp27414p34790.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035228.html">[rabbitmq-discuss] Possible memory leak in the management plugin
</A></li>
	<LI>Next message: <A HREF="035236.html">[rabbitmq-discuss] Possible memory leak in the management plugin
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#35235">[ date ]</a>
              <a href="thread.html#35235">[ thread ]</a>
              <a href="subject.html#35235">[ subject ]</a>
              <a href="author.html#35235">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
