<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [rabbitmq-discuss] cluster meltdown
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20cluster%20meltdown&In-Reply-To=%3C1396325414968-34453.post%40n5.nabble.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="035178.html">
   <LINK REL="Next"  HREF="034906.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[rabbitmq-discuss] cluster meltdown</H1>
    <B>carlhoerberg</B> 
    <A HREF="mailto:rabbitmq-discuss%40lists.rabbitmq.com?Subject=Re%3A%20%5Brabbitmq-discuss%5D%20cluster%20meltdown&In-Reply-To=%3C1396325414968-34453.post%40n5.nabble.com%3E"
       TITLE="[rabbitmq-discuss] cluster meltdown">carl.hoerberg at gmail.com
       </A><BR>
    <I>Tue Apr  1 05:10:14 BST 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="035178.html">[rabbitmq-discuss] Do WebStomp/Sock.JS require a constant connection?
</A></li>
        <LI>Next message: <A HREF="034906.html">[rabbitmq-discuss] How long interval fetching message from MQ	SERVER?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34904">[ date ]</a>
              <a href="thread.html#34904">[ thread ]</a>
              <a href="subject.html#34904">[ subject ]</a>
              <a href="author.html#34904">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We have a two node cluster, an AWS node froze for us, we could neither start
or stop it. That made the first node unresponsive to mgmt db actions, all
API request timed out. We restart the first node but a lot of queues are
then inaccessible:  

=ERROR REPORT==== 1-Apr-2014::02:58:03 ===
connection &lt;0.5559.279&gt;, channel 1 - soft error:
{amqp_error,not_found,
            &quot;home node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A>' of durable queue 'celery' in vhost
'vhost1' is down or inaccessible&quot;,
            'queue.declare'}

We issue rabbitmqctl forget_cluster_node <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A> as we still can't
access node2. 

Node1 continue to report a lot of &quot;home node of queue is down&quot;. 

Node2 has now restarted, but can't join the cluster. Is there a way to
rejoin the cluster without resetting? 

We reset node2 and tries to join_cluster again but with the following
result: 
Clustering node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A>' with '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node1</A>' ...
...done (already_member).

node2# rabbitmqctl cluster_status

Cluster status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A>' ...
[{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A>']}]},
 {running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A>']},
 {partitions,[]}]
...done.

But start_app doesn't join node1. 
 
node1# rabbitmqctl cluster_status
Cluster status of node '<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node1</A>' ...
[{nodes,[{disc,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node1</A>','<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node2</A>']}]},
 {running_nodes,['<A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node1</A>']},
 {partitions,[]}]
...done.

node2# rabbitmqctl update_cluster_nodes <A HREF="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">rabbit at node1</A>

Now node2 understands that it's clustered with node1 and with start_app it
starts and joins node1. 

RabbitMQ 3.2.3, Erlang R16B03-1



--
View this message in context: <A HREF="http://rabbitmq.1065348.n5.nabble.com/cluster-meltdown-tp34453.html">http://rabbitmq.1065348.n5.nabble.com/cluster-meltdown-tp34453.html</A>
Sent from the RabbitMQ mailing list archive at Nabble.com.
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="035178.html">[rabbitmq-discuss] Do WebStomp/Sock.JS require a constant connection?
</A></li>
	<LI>Next message: <A HREF="034906.html">[rabbitmq-discuss] How long interval fetching message from MQ	SERVER?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#34904">[ date ]</a>
              <a href="thread.html#34904">[ thread ]</a>
              <a href="subject.html#34904">[ subject ]</a>
              <a href="author.html#34904">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.rabbitmq.com/cgi-bin/mailman/listinfo/rabbitmq-discuss">More information about the rabbitmq-discuss
mailing list</a><br>
</body></html>
